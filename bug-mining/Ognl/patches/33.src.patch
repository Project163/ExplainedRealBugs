diff --git a/src/main/java/org/apache/commons/ognl/ASTAdd.java b/src/main/java/org/apache/commons/ognl/ASTAdd.java
index 11df871..e8e5566 100644
--- a/src/main/java/org/apache/commons/ognl/ASTAdd.java
+++ b/src/main/java/org/apache/commons/ognl/ASTAdd.java
@@ -345,7 +345,8 @@ class ASTAdd
         }
     }
     
-    public <R, P> R accept( NodeVisitor<? extends R, ? super P> visitor, P data ) 
+    public <R, P> R accept( NodeVisitor<? extends R, ? super P> visitor, P data )
+        throws OgnlException
     {
         return visitor.visit( this, data );
     }
diff --git a/src/main/java/org/apache/commons/ognl/ASTAnd.java b/src/main/java/org/apache/commons/ognl/ASTAnd.java
index a976d48..c72b387 100644
--- a/src/main/java/org/apache/commons/ognl/ASTAnd.java
+++ b/src/main/java/org/apache/commons/ognl/ASTAnd.java
@@ -243,7 +243,8 @@ public class ASTAnd
     /* (non-Javadoc)
      * @see org.apache.commons.ognl.Node#accept(org.apache.commons.ognl.NodeVisitor, java.lang.Object)
      */
-    public <R, P> R accept( NodeVisitor<? extends R, ? super P> visitor, P data ) 
+    public <R, P> R accept( NodeVisitor<? extends R, ? super P> visitor, P data )
+        throws OgnlException
     {
         return visitor.visit( this, data );
     }
diff --git a/src/main/java/org/apache/commons/ognl/ASTAssign.java b/src/main/java/org/apache/commons/ognl/ASTAssign.java
index 1171f4b..3375908 100644
--- a/src/main/java/org/apache/commons/ognl/ASTAssign.java
+++ b/src/main/java/org/apache/commons/ognl/ASTAssign.java
@@ -100,13 +100,10 @@ class ASTAssign
             result =
                 OgnlRuntime
                     .getCompiler()
-                    .createLocalReference( 
-                       context,
-                        "org.apache.commons.ognl.OgnlOps.returnValue(($w)"
-                            + result
-                            + ", ($w)"
-                            + ( (OrderedReturn) _children[0] ).getLastExpression()
-                            + ")", Object.class );
+                    .createLocalReference( context,
+                                           "org.apache.commons.ognl.OgnlOps.returnValue(($w)" + result + ", ($w)"
+                                               + ( (OrderedReturn) _children[0] ).getLastExpression() + ")",
+                                           Object.class );
         }
 
         return result;
@@ -148,7 +145,8 @@ class ASTAssign
         return result + value + ")";
     }
     
-    public <R, P> R accept( NodeVisitor<? extends R, ? super P> visitor, P data ) 
+    public <R, P> R accept( NodeVisitor<? extends R, ? super P> visitor, P data )
+        throws OgnlException
     {
         return visitor.visit( this, data );
     }
diff --git a/src/main/java/org/apache/commons/ognl/ASTBitAnd.java b/src/main/java/org/apache/commons/ognl/ASTBitAnd.java
index c8ede86..94d3a04 100644
--- a/src/main/java/org/apache/commons/ognl/ASTBitAnd.java
+++ b/src/main/java/org/apache/commons/ognl/ASTBitAnd.java
@@ -63,8 +63,9 @@ class ASTBitAnd
         return "(long)" + super.coerceToNumeric( source, context, child );
     }
     
-    public <R, P> R accept( NodeVisitor<? extends R, ? super P> visitor, P data ) 
+    public <R, P> R accept( NodeVisitor<? extends R, ? super P> visitor, P data )
+        throws OgnlException
     {
         return visitor.visit( this, data );
     }
-}
\ No newline at end of file
+}
diff --git a/src/main/java/org/apache/commons/ognl/ASTBitNegate.java b/src/main/java/org/apache/commons/ognl/ASTBitNegate.java
index 0da8b90..9bf56ec 100644
--- a/src/main/java/org/apache/commons/ognl/ASTBitNegate.java
+++ b/src/main/java/org/apache/commons/ognl/ASTBitNegate.java
@@ -57,7 +57,8 @@ class ASTBitNegate
         }
     }
     
-    public <R, P> R accept( NodeVisitor<? extends R, ? super P> visitor, P data ) 
+    public <R, P> R accept( NodeVisitor<? extends R, ? super P> visitor, P data )
+        throws OgnlException
     {
         return visitor.visit( this, data );
     }
diff --git a/src/main/java/org/apache/commons/ognl/ASTBitOr.java b/src/main/java/org/apache/commons/ognl/ASTBitOr.java
index 2be2670..4520de3 100644
--- a/src/main/java/org/apache/commons/ognl/ASTBitOr.java
+++ b/src/main/java/org/apache/commons/ognl/ASTBitOr.java
@@ -58,7 +58,8 @@ class ASTBitOr
         return "|";
     }
     
-    public <R, P> R accept( NodeVisitor<? extends R, ? super P> visitor, P data ) 
+    public <R, P> R accept( NodeVisitor<? extends R, ? super P> visitor, P data )
+        throws OgnlException
     {
         return visitor.visit( this, data );
     }
diff --git a/src/main/java/org/apache/commons/ognl/ASTChain.java b/src/main/java/org/apache/commons/ognl/ASTChain.java
index 1c4fc3e..8b95952 100644
--- a/src/main/java/org/apache/commons/ognl/ASTChain.java
+++ b/src/main/java/org/apache/commons/ognl/ASTChain.java
@@ -496,7 +496,8 @@ public class ASTChain
         return result;
     }
     
-    public <R, P> R accept( NodeVisitor<? extends R, ? super P> visitor, P data ) 
+    public <R, P> R accept( NodeVisitor<? extends R, ? super P> visitor, P data )
+        throws OgnlException
     {
         return visitor.visit( this, data );
     }
diff --git a/src/main/java/org/apache/commons/ognl/ASTConst.java b/src/main/java/org/apache/commons/ognl/ASTConst.java
index 8c3f8f5..c2def7f 100644
--- a/src/main/java/org/apache/commons/ognl/ASTConst.java
+++ b/src/main/java/org/apache/commons/ognl/ASTConst.java
@@ -170,7 +170,8 @@ public class ASTConst
         return toGetSourceString( context, target );
     }
     
-    public <R, P> R accept( NodeVisitor<? extends R, ? super P> visitor, P data ) 
+    public <R, P> R accept( NodeVisitor<? extends R, ? super P> visitor, P data )
+        throws OgnlException
     {
         return visitor.visit( this, data );
     }
diff --git a/src/main/java/org/apache/commons/ognl/ASTCtor.java b/src/main/java/org/apache/commons/ognl/ASTCtor.java
index 2a0c7da..d3fd762 100644
--- a/src/main/java/org/apache/commons/ognl/ASTCtor.java
+++ b/src/main/java/org/apache/commons/ognl/ASTCtor.java
@@ -370,6 +370,7 @@ public class ASTCtor
     }
 
     public <R,P> R accept(NodeVisitor<? extends R, ? super P> visitor, P data)
+        throws OgnlException
     {
         return visitor.visit( this, data );
     }
diff --git a/src/main/java/org/apache/commons/ognl/ASTDivide.java b/src/main/java/org/apache/commons/ognl/ASTDivide.java
index a1481d7..60f11f4 100644
--- a/src/main/java/org/apache/commons/ognl/ASTDivide.java
+++ b/src/main/java/org/apache/commons/ognl/ASTDivide.java
@@ -51,7 +51,8 @@ class ASTDivide
     }
 
     
-    public <R, P> R accept( NodeVisitor<? extends R, ? super P> visitor, P data ) 
+    public <R, P> R accept( NodeVisitor<? extends R, ? super P> visitor, P data )
+        throws OgnlException
     {
         return visitor.visit( this, data );
     }
diff --git a/src/main/java/org/apache/commons/ognl/ASTEq.java b/src/main/java/org/apache/commons/ognl/ASTEq.java
index 19658e5..82f4854 100644
--- a/src/main/java/org/apache/commons/ognl/ASTEq.java
+++ b/src/main/java/org/apache/commons/ognl/ASTEq.java
@@ -55,7 +55,8 @@ class ASTEq
         return "org.apache.commons.ognl.OgnlOps.equal";
     }
     
-    public <R, P> R accept( NodeVisitor<? extends R, ? super P> visitor, P data ) 
+    public <R, P> R accept( NodeVisitor<? extends R, ? super P> visitor, P data )
+        throws OgnlException
     {
         return visitor.visit( this, data );
     }
diff --git a/src/main/java/org/apache/commons/ognl/ASTEval.java b/src/main/java/org/apache/commons/ognl/ASTEval.java
index 9325cab..3d3d3b0 100644
--- a/src/main/java/org/apache/commons/ognl/ASTEval.java
+++ b/src/main/java/org/apache/commons/ognl/ASTEval.java
@@ -89,7 +89,8 @@ class ASTEval
         throw new UnsupportedCompilationException( "Map expressions not supported as native java yet." );
     }
     
-    public <R, P> R accept( NodeVisitor<? extends R, ? super P> visitor, P data ) 
+    public <R, P> R accept( NodeVisitor<? extends R, ? super P> visitor, P data )
+        throws OgnlException
     {
         return visitor.visit( this, data );
     }
diff --git a/src/main/java/org/apache/commons/ognl/ASTGreater.java b/src/main/java/org/apache/commons/ognl/ASTGreater.java
index 88f7450..24ba9b3 100644
--- a/src/main/java/org/apache/commons/ognl/ASTGreater.java
+++ b/src/main/java/org/apache/commons/ognl/ASTGreater.java
@@ -56,7 +56,8 @@ class ASTGreater
         return "org.apache.commons.ognl.OgnlOps.greater";
     }
     
-    public <R, P> R accept( NodeVisitor<? extends R, ? super P> visitor, P data ) 
+    public <R, P> R accept( NodeVisitor<? extends R, ? super P> visitor, P data )
+        throws OgnlException
     {
         return visitor.visit( this, data );
     }
diff --git a/src/main/java/org/apache/commons/ognl/ASTGreaterEq.java b/src/main/java/org/apache/commons/ognl/ASTGreaterEq.java
index 1a45e36..6f55be7 100644
--- a/src/main/java/org/apache/commons/ognl/ASTGreaterEq.java
+++ b/src/main/java/org/apache/commons/ognl/ASTGreaterEq.java
@@ -55,7 +55,8 @@ class ASTGreaterEq
         return "!org.apache.commons.ognl.OgnlOps.less";
     }
     
-    public <R, P> R accept( NodeVisitor<? extends R, ? super P> visitor, P data ) 
+    public <R, P> R accept( NodeVisitor<? extends R, ? super P> visitor, P data )
+        throws OgnlException
     {
         return visitor.visit( this, data );
     }
diff --git a/src/main/java/org/apache/commons/ognl/ASTIn.java b/src/main/java/org/apache/commons/ognl/ASTIn.java
index 68ec17d..3356173 100644
--- a/src/main/java/org/apache/commons/ognl/ASTIn.java
+++ b/src/main/java/org/apache/commons/ognl/ASTIn.java
@@ -94,7 +94,8 @@ class ASTIn
         throw new UnsupportedCompilationException( "Map expressions not supported as native java yet." );
     }
     
-    public <R, P> R accept( NodeVisitor<? extends R, ? super P> visitor, P data ) 
+    public <R, P> R accept( NodeVisitor<? extends R, ? super P> visitor, P data )
+        throws OgnlException
     {
         return visitor.visit( this, data );
     }
diff --git a/src/main/java/org/apache/commons/ognl/ASTInstanceof.java b/src/main/java/org/apache/commons/ognl/ASTInstanceof.java
index c519eb7..b2d16fe 100644
--- a/src/main/java/org/apache/commons/ognl/ASTInstanceof.java
+++ b/src/main/java/org/apache/commons/ognl/ASTInstanceof.java
@@ -97,7 +97,8 @@ public class ASTInstanceof
         return toGetSourceString( context, target );
     }
     
-    public <R, P> R accept( NodeVisitor<? extends R, ? super P> visitor, P data ) 
+    public <R, P> R accept( NodeVisitor<? extends R, ? super P> visitor, P data )
+        throws OgnlException
     {
         return visitor.visit( this, data );
     }
diff --git a/src/main/java/org/apache/commons/ognl/ASTKeyValue.java b/src/main/java/org/apache/commons/ognl/ASTKeyValue.java
index 06b487e..e32af82 100644
--- a/src/main/java/org/apache/commons/ognl/ASTKeyValue.java
+++ b/src/main/java/org/apache/commons/ognl/ASTKeyValue.java
@@ -56,7 +56,8 @@ class ASTKeyValue
         return null;
     }
 
-    public <R, P> R accept( NodeVisitor<? extends R, ? super P> visitor, P data ) 
+    public <R, P> R accept( NodeVisitor<? extends R, ? super P> visitor, P data )
+        throws OgnlException
     {
         return visitor.visit( this, data );
     }
diff --git a/src/main/java/org/apache/commons/ognl/ASTLess.java b/src/main/java/org/apache/commons/ognl/ASTLess.java
index 261501a..293dfec 100644
--- a/src/main/java/org/apache/commons/ognl/ASTLess.java
+++ b/src/main/java/org/apache/commons/ognl/ASTLess.java
@@ -56,7 +56,8 @@ class ASTLess
         return "org.apache.commons.ognl.OgnlOps.less";
     }
     
-    public <R, P> R accept( NodeVisitor<? extends R, ? super P> visitor, P data ) 
+    public <R, P> R accept( NodeVisitor<? extends R, ? super P> visitor, P data )
+        throws OgnlException
     {
         return visitor.visit( this, data );
     }
diff --git a/src/main/java/org/apache/commons/ognl/ASTLessEq.java b/src/main/java/org/apache/commons/ognl/ASTLessEq.java
index 8e06dba..38094ba 100644
--- a/src/main/java/org/apache/commons/ognl/ASTLessEq.java
+++ b/src/main/java/org/apache/commons/ognl/ASTLessEq.java
@@ -56,7 +56,8 @@ class ASTLessEq
     }
 
     
-    public <R, P> R accept( NodeVisitor<? extends R, ? super P> visitor, P data ) 
+    public <R, P> R accept( NodeVisitor<? extends R, ? super P> visitor, P data )
+        throws OgnlException
     {
         return visitor.visit( this, data );
     }
diff --git a/src/main/java/org/apache/commons/ognl/ASTList.java b/src/main/java/org/apache/commons/ognl/ASTList.java
index f06d395..3e847ae 100644
--- a/src/main/java/org/apache/commons/ognl/ASTList.java
+++ b/src/main/java/org/apache/commons/ognl/ASTList.java
@@ -144,14 +144,9 @@ public class ASTList
                         value =
                             OgnlRuntime
                                 .getCompiler()
-                                .createLocalReference( context,
-                                                        "("
-                                                            + ExpressionCompiler.getCastString( ctorClass )
-                                                            + ")org.apache.commons.ognl.OgnlOps.toArray("
-                                                            + value
-                                                            + ", "
-                                                            + ctorClass.getComponentType().getName()
-                                                            + ".class, true)", ctorClass );
+                                .createLocalReference( context, "(" + ExpressionCompiler.getCastString( ctorClass )
+                                    + ")org.apache.commons.ognl.OgnlOps.toArray(" + value + ", "
+                                    + ctorClass.getComponentType().getName() + ".class, true)", ctorClass );
 
                     }
                     else if ( ctorClass.isPrimitive() )
@@ -162,16 +157,10 @@ public class ASTList
                         value =
                             OgnlRuntime
                                 .getCompiler()
-                                .createLocalReference( context,
-                                                        "(("
-                                                            + wrapClass.getName()
-                                                            + ")org.apache.commons.ognl.OgnlOps.convertValue("
-                                                            + value
-                                                            + ","
-                                                            + wrapClass.getName()
-                                                            + ".class, true))."
-                                                            + OgnlRuntime.getNumericValueGetter( wrapClass ),
-                                                        ctorClass );
+                                .createLocalReference( context, "((" + wrapClass.getName()
+                                    + ")org.apache.commons.ognl.OgnlOps.convertValue(" + value + ","
+                                    + wrapClass.getName() + ".class, true))." + OgnlRuntime.getNumericValueGetter(
+                                    wrapClass ), ctorClass );
                     }
                     else if ( ctorClass != Object.class )
                     {
@@ -179,13 +168,9 @@ public class ASTList
                         value =
                             OgnlRuntime
                                 .getCompiler()
-                                .createLocalReference( 
-                                                        context,
-                                                        "("
-                                                            + ctorClass.getName()
-                                                            + ")org.apache.commons.ognl.OgnlOps.convertValue("
-                                                            + value + "," + ctorClass.getName()
-                                                            + ".class)", ctorClass );
+                                .createLocalReference( context, "(" + ctorClass.getName()
+                                    + ")org.apache.commons.ognl.OgnlOps.convertValue(" + value + ","
+                                    + ctorClass.getName() + ".class)", ctorClass );
 
                     }
                     else if ( ( NodeType.class.isInstance( _children[i] )
@@ -238,7 +223,8 @@ public class ASTList
         throw new UnsupportedCompilationException( "Can't generate setter for ASTList." );
     }
     
-    public <R, P> R accept( NodeVisitor<? extends R, ? super P> visitor, P data ) 
+    public <R, P> R accept( NodeVisitor<? extends R, ? super P> visitor, P data )
+        throws OgnlException
     {
         return visitor.visit( this, data );
     }
diff --git a/src/main/java/org/apache/commons/ognl/ASTMap.java b/src/main/java/org/apache/commons/ognl/ASTMap.java
index 69863db..c3e5e6b 100644
--- a/src/main/java/org/apache/commons/ognl/ASTMap.java
+++ b/src/main/java/org/apache/commons/ognl/ASTMap.java
@@ -127,7 +127,8 @@ class ASTMap
         throw new UnsupportedCompilationException( "Map expressions not supported as native java yet." );
     }
     
-    public <R, P> R accept( NodeVisitor<? extends R, ? super P> visitor, P data ) 
+    public <R, P> R accept( NodeVisitor<? extends R, ? super P> visitor, P data )
+        throws OgnlException
     {
         return visitor.visit( this, data );
     }
diff --git a/src/main/java/org/apache/commons/ognl/ASTMethod.java b/src/main/java/org/apache/commons/ognl/ASTMethod.java
index 3d8c751..847181f 100644
--- a/src/main/java/org/apache/commons/ognl/ASTMethod.java
+++ b/src/main/java/org/apache/commons/ognl/ASTMethod.java
@@ -294,14 +294,9 @@ public class ASTMethod
                             parmString =
                                 OgnlRuntime
                                     .getCompiler()
-                                    .createLocalReference( context,
-                                                            "("
-                                                                + ExpressionCompiler.getCastString( parms[i] )
-                                                                + ")org.apache.commons.ognl.OgnlOps#toArray("
-                                                                + parmString
-                                                                + ", "
-                                                                + parms[i].getComponentType().getName()
-                                                                + ".class, true)", parms[i] );
+                                    .createLocalReference( context, "(" + ExpressionCompiler.getCastString( parms[i] )
+                                        + ")org.apache.commons.ognl.OgnlOps#toArray(" + parmString + ", "
+                                        + parms[i].getComponentType().getName() + ".class, true)", parms[i] );
 
                         }
                         else if ( parms[i].isPrimitive() )
@@ -312,16 +307,10 @@ public class ASTMethod
                             parmString =
                                 OgnlRuntime
                                     .getCompiler()
-                                    .createLocalReference( context,
-                                                            "(("
-                                                                + wrapClass.getName()
-                                                                + ")org.apache.commons.ognl.OgnlOps#convertValue("
-                                                                + parmString
-                                                                + ","
-                                                                + wrapClass.getName()
-                                                                + ".class, true))."
-                                                                + OgnlRuntime.getNumericValueGetter( wrapClass ),
-                                                            parms[i] );
+                                    .createLocalReference( context, "((" + wrapClass.getName()
+                                        + ")org.apache.commons.ognl.OgnlOps#convertValue(" + parmString + ","
+                                        + wrapClass.getName() + ".class, true))." + OgnlRuntime.getNumericValueGetter(
+                                        wrapClass ), parms[i] );
 
                         }
                         else if ( parms[i] != Object.class )
@@ -329,13 +318,9 @@ public class ASTMethod
                             parmString =
                                 OgnlRuntime
                                     .getCompiler()
-                                    .createLocalReference( context,
-                                                            "("
-                                                                + parms[i].getName()
-                                                                + ")org.apache.commons.ognl.OgnlOps#convertValue("
-                                                                + parmString + ","
-                                                                + parms[i].getName() + ".class)",
-                                                            parms[i] );
+                                    .createLocalReference( context, "(" + parms[i].getName()
+                                        + ")org.apache.commons.ognl.OgnlOps#convertValue(" + parmString + ","
+                                        + parms[i].getName() + ".class)", parms[i] );
                         }
                         else if ( ( NodeType.class.isInstance( _children[i] )
                             && ( (NodeType) _children[i] ).getGetterClass() != null 
@@ -505,14 +490,9 @@ public class ASTMethod
                             parmString =
                                 OgnlRuntime
                                     .getCompiler()
-                                    .createLocalReference( context,
-                                                            "("
-                                                                + ExpressionCompiler.getCastString( parms[i] )
-                                                                + ")org.apache.commons.ognl.OgnlOps#toArray("
-                                                                + parmString
-                                                                + ", "
-                                                                + parms[i].getComponentType().getName()
-                                                                + ".class)", parms[i] );
+                                    .createLocalReference( context, "(" + ExpressionCompiler.getCastString( parms[i] )
+                                        + ")org.apache.commons.ognl.OgnlOps#toArray(" + parmString + ", "
+                                        + parms[i].getComponentType().getName() + ".class)", parms[i] );
 
                         }
                         else if ( parms[i].isPrimitive() )
@@ -522,16 +502,10 @@ public class ASTMethod
                             parmString =
                                 OgnlRuntime
                                     .getCompiler()
-                                    .createLocalReference( context,
-                                                            "(("
-                                                                + wrapClass.getName()
-                                                                + ")org.apache.commons.ognl.OgnlOps#convertValue("
-                                                                + parmString
-                                                                + ","
-                                                                + wrapClass.getName()
-                                                                + ".class, true))."
-                                                                + OgnlRuntime.getNumericValueGetter( wrapClass ),
-                                                            parms[i] );
+                                    .createLocalReference( context, "((" + wrapClass.getName()
+                                        + ")org.apache.commons.ognl.OgnlOps#convertValue(" + parmString + ","
+                                        + wrapClass.getName() + ".class, true))." + OgnlRuntime.getNumericValueGetter(
+                                        wrapClass ), parms[i] );
 
                         }
                         else if ( parms[i] != Object.class )
@@ -539,13 +513,9 @@ public class ASTMethod
                             parmString =
                                 OgnlRuntime
                                     .getCompiler()
-                                    .createLocalReference( context,
-                                                            "("
-                                                                + parms[i].getName()
-                                                                + ")org.apache.commons.ognl.OgnlOps#convertValue("
-                                                                + parmString + ","
-                                                                + parms[i].getName() + ".class)",
-                                                            parms[i] );
+                                    .createLocalReference( context, "(" + parms[i].getName()
+                                        + ")org.apache.commons.ognl.OgnlOps#convertValue(" + parmString + ","
+                                        + parms[i].getName() + ".class)", parms[i] );
 
                         }
                         else if ( ( NodeType.class.isInstance( _children[i] )
@@ -592,7 +562,8 @@ public class ASTMethod
         return result + ")" + post;
     }
     
-    public <R, P> R accept( NodeVisitor<? extends R, ? super P> visitor, P data ) 
+    public <R, P> R accept( NodeVisitor<? extends R, ? super P> visitor, P data )
+        throws OgnlException
     {
         return visitor.visit( this, data );
     }
diff --git a/src/main/java/org/apache/commons/ognl/ASTMultiply.java b/src/main/java/org/apache/commons/ognl/ASTMultiply.java
index 47f2024..55d0b89 100644
--- a/src/main/java/org/apache/commons/ognl/ASTMultiply.java
+++ b/src/main/java/org/apache/commons/ognl/ASTMultiply.java
@@ -59,7 +59,8 @@ class ASTMultiply
         return "*";
     }
     
-    public <R, P> R accept( NodeVisitor<? extends R, ? super P> visitor, P data ) 
+    public <R, P> R accept( NodeVisitor<? extends R, ? super P> visitor, P data )
+        throws OgnlException
     {
         return visitor.visit( this, data );
     }
diff --git a/src/main/java/org/apache/commons/ognl/ASTNegate.java b/src/main/java/org/apache/commons/ognl/ASTNegate.java
index 4dda2d6..f699102 100644
--- a/src/main/java/org/apache/commons/ognl/ASTNegate.java
+++ b/src/main/java/org/apache/commons/ognl/ASTNegate.java
@@ -57,7 +57,8 @@ class ASTNegate
         }
     }
     
-    public <R, P> R accept( NodeVisitor<? extends R, ? super P> visitor, P data ) 
+    public <R, P> R accept( NodeVisitor<? extends R, ? super P> visitor, P data )
+        throws OgnlException
     {
         return visitor.visit( this, data );
     }
diff --git a/src/main/java/org/apache/commons/ognl/ASTNot.java b/src/main/java/org/apache/commons/ognl/ASTNot.java
index 1e6f0b8..cc40e75 100644
--- a/src/main/java/org/apache/commons/ognl/ASTNot.java
+++ b/src/main/java/org/apache/commons/ognl/ASTNot.java
@@ -71,7 +71,8 @@ class ASTNot
         }
     }
     
-    public <R, P> R accept( NodeVisitor<? extends R, ? super P> visitor, P data ) 
+    public <R, P> R accept( NodeVisitor<? extends R, ? super P> visitor, P data )
+        throws OgnlException
     {
         return visitor.visit( this, data );
     }
diff --git a/src/main/java/org/apache/commons/ognl/ASTNotEq.java b/src/main/java/org/apache/commons/ognl/ASTNotEq.java
index 8882cb8..fbdd390 100644
--- a/src/main/java/org/apache/commons/ognl/ASTNotEq.java
+++ b/src/main/java/org/apache/commons/ognl/ASTNotEq.java
@@ -56,7 +56,8 @@ class ASTNotEq
         return "!org.apache.commons.ognl.OgnlOps.equal";
     }
     
-    public <R, P> R accept( NodeVisitor<? extends R, ? super P> visitor, P data ) 
+    public <R, P> R accept( NodeVisitor<? extends R, ? super P> visitor, P data )
+        throws OgnlException
     {
         return visitor.visit( this, data );
     }
diff --git a/src/main/java/org/apache/commons/ognl/ASTNotIn.java b/src/main/java/org/apache/commons/ognl/ASTNotIn.java
index bc7f1fe..efe8283 100644
--- a/src/main/java/org/apache/commons/ognl/ASTNotIn.java
+++ b/src/main/java/org/apache/commons/ognl/ASTNotIn.java
@@ -88,7 +88,8 @@ class ASTNotIn
         }
     }
     
-    public <R, P> R accept( NodeVisitor<? extends R, ? super P> visitor, P data ) 
+    public <R, P> R accept( NodeVisitor<? extends R, ? super P> visitor, P data )
+        throws OgnlException
     {
         return visitor.visit( this, data );
     }
diff --git a/src/main/java/org/apache/commons/ognl/ASTOr.java b/src/main/java/org/apache/commons/ognl/ASTOr.java
index 15e47b0..61d7111 100644
--- a/src/main/java/org/apache/commons/ognl/ASTOr.java
+++ b/src/main/java/org/apache/commons/ognl/ASTOr.java
@@ -200,7 +200,8 @@ public class ASTOr
         return result;
     }
     
-    public <R, P> R accept( NodeVisitor<? extends R, ? super P> visitor, P data ) 
+    public <R, P> R accept( NodeVisitor<? extends R, ? super P> visitor, P data )
+        throws OgnlException
     {
         return visitor.visit( this, data );
     }
diff --git a/src/main/java/org/apache/commons/ognl/ASTProject.java b/src/main/java/org/apache/commons/ognl/ASTProject.java
index 2bbb7f7..87b943a 100644
--- a/src/main/java/org/apache/commons/ognl/ASTProject.java
+++ b/src/main/java/org/apache/commons/ognl/ASTProject.java
@@ -71,7 +71,8 @@ class ASTProject
         throw new UnsupportedCompilationException( "Projection expressions not supported as native java yet." );
     }
     
-    public <R, P> R accept( NodeVisitor<? extends R, ? super P> visitor, P data ) 
+    public <R, P> R accept( NodeVisitor<? extends R, ? super P> visitor, P data )
+        throws OgnlException
     {
         return visitor.visit( this, data );
     }
diff --git a/src/main/java/org/apache/commons/ognl/ASTProperty.java b/src/main/java/org/apache/commons/ognl/ASTProperty.java
index af59a94..03f64c5 100644
--- a/src/main/java/org/apache/commons/ognl/ASTProperty.java
+++ b/src/main/java/org/apache/commons/ognl/ASTProperty.java
@@ -690,7 +690,8 @@ public class ASTProperty
         return result;
     }
     
-    public <R, P> R accept( NodeVisitor<? extends R, ? super P> visitor, P data ) 
+    public <R, P> R accept( NodeVisitor<? extends R, ? super P> visitor, P data )
+        throws OgnlException
     {
         return visitor.visit( this, data );
     }
diff --git a/src/main/java/org/apache/commons/ognl/ASTRemainder.java b/src/main/java/org/apache/commons/ognl/ASTRemainder.java
index 74d0169..7b0979e 100644
--- a/src/main/java/org/apache/commons/ognl/ASTRemainder.java
+++ b/src/main/java/org/apache/commons/ognl/ASTRemainder.java
@@ -50,7 +50,8 @@ class ASTRemainder
         return "%";
     }
     
-    public <R, P> R accept( NodeVisitor<? extends R, ? super P> visitor, P data ) 
+    public <R, P> R accept( NodeVisitor<? extends R, ? super P> visitor, P data )
+        throws OgnlException
     {
         return visitor.visit( this, data );
     }
diff --git a/src/main/java/org/apache/commons/ognl/ASTRootVarRef.java b/src/main/java/org/apache/commons/ognl/ASTRootVarRef.java
index 41edde8..cd94aa0 100644
--- a/src/main/java/org/apache/commons/ognl/ASTRootVarRef.java
+++ b/src/main/java/org/apache/commons/ognl/ASTRootVarRef.java
@@ -76,7 +76,8 @@ public class ASTRootVarRef
             return "$3";
     }
     
-    public <R, P> R accept( NodeVisitor<? extends R, ? super P> visitor, P data ) 
+    public <R, P> R accept( NodeVisitor<? extends R, ? super P> visitor, P data )
+        throws OgnlException
     {
         return visitor.visit( this, data );
     }
diff --git a/src/main/java/org/apache/commons/ognl/ASTSelect.java b/src/main/java/org/apache/commons/ognl/ASTSelect.java
index 081b8ac..2dd117c 100644
--- a/src/main/java/org/apache/commons/ognl/ASTSelect.java
+++ b/src/main/java/org/apache/commons/ognl/ASTSelect.java
@@ -73,7 +73,8 @@ class ASTSelect
         throw new UnsupportedCompilationException( "Eval expressions not supported as native java yet." );
     }
     
-    public <R, P> R accept( NodeVisitor<? extends R, ? super P> visitor, P data ) 
+    public <R, P> R accept( NodeVisitor<? extends R, ? super P> visitor, P data )
+        throws OgnlException
     {
         return visitor.visit( this, data );
     }
diff --git a/src/main/java/org/apache/commons/ognl/ASTSelectFirst.java b/src/main/java/org/apache/commons/ognl/ASTSelectFirst.java
index f67037b..becdc5d 100644
--- a/src/main/java/org/apache/commons/ognl/ASTSelectFirst.java
+++ b/src/main/java/org/apache/commons/ognl/ASTSelectFirst.java
@@ -73,7 +73,8 @@ class ASTSelectFirst
         throw new UnsupportedCompilationException( "Eval expressions not supported as native java yet." );
     }
     
-    public <R, P> R accept( NodeVisitor<? extends R, ? super P> visitor, P data ) 
+    public <R, P> R accept( NodeVisitor<? extends R, ? super P> visitor, P data )
+        throws OgnlException
     {
         return visitor.visit( this, data );
     }
diff --git a/src/main/java/org/apache/commons/ognl/ASTSelectLast.java b/src/main/java/org/apache/commons/ognl/ASTSelectLast.java
index c0753d8..96cf0bb 100644
--- a/src/main/java/org/apache/commons/ognl/ASTSelectLast.java
+++ b/src/main/java/org/apache/commons/ognl/ASTSelectLast.java
@@ -73,7 +73,8 @@ class ASTSelectLast
         throw new UnsupportedCompilationException( "Eval expressions not supported as native java yet." );
     }
     
-    public <R, P> R accept( NodeVisitor<? extends R, ? super P> visitor, P data ) 
+    public <R, P> R accept( NodeVisitor<? extends R, ? super P> visitor, P data )
+        throws OgnlException
     {
         return visitor.visit( this, data );
     }
diff --git a/src/main/java/org/apache/commons/ognl/ASTSequence.java b/src/main/java/org/apache/commons/ognl/ASTSequence.java
index 3895942..e26d7f7 100644
--- a/src/main/java/org/apache/commons/ognl/ASTSequence.java
+++ b/src/main/java/org/apache/commons/ognl/ASTSequence.java
@@ -153,7 +153,8 @@ public class ASTSequence
         return result;
     }
     
-    public <R, P> R accept( NodeVisitor<? extends R, ? super P> visitor, P data ) 
+    public <R, P> R accept( NodeVisitor<? extends R, ? super P> visitor, P data )
+        throws OgnlException
     {
         return visitor.visit( this, data );
     }
diff --git a/src/main/java/org/apache/commons/ognl/ASTShiftLeft.java b/src/main/java/org/apache/commons/ognl/ASTShiftLeft.java
index b536107..cac65e0 100644
--- a/src/main/java/org/apache/commons/ognl/ASTShiftLeft.java
+++ b/src/main/java/org/apache/commons/ognl/ASTShiftLeft.java
@@ -50,7 +50,8 @@ class ASTShiftLeft
         return "<<";
     }
     
-    public <R, P> R accept( NodeVisitor<? extends R, ? super P> visitor, P data ) 
+    public <R, P> R accept( NodeVisitor<? extends R, ? super P> visitor, P data )
+        throws OgnlException
     {
         return visitor.visit( this, data );
     }
diff --git a/src/main/java/org/apache/commons/ognl/ASTShiftRight.java b/src/main/java/org/apache/commons/ognl/ASTShiftRight.java
index eb336f4..f9c7fc5 100644
--- a/src/main/java/org/apache/commons/ognl/ASTShiftRight.java
+++ b/src/main/java/org/apache/commons/ognl/ASTShiftRight.java
@@ -50,7 +50,8 @@ class ASTShiftRight
         return ">>";
     }
     
-    public <R, P> R accept( NodeVisitor<? extends R, ? super P> visitor, P data ) 
+    public <R, P> R accept( NodeVisitor<? extends R, ? super P> visitor, P data )
+        throws OgnlException
     {
         return visitor.visit( this, data );
     }
diff --git a/src/main/java/org/apache/commons/ognl/ASTStaticField.java b/src/main/java/org/apache/commons/ognl/ASTStaticField.java
index 8300be1..07d612a 100644
--- a/src/main/java/org/apache/commons/ognl/ASTStaticField.java
+++ b/src/main/java/org/apache/commons/ognl/ASTStaticField.java
@@ -209,7 +209,8 @@ public class ASTStaticField
         return className + "." + fieldName;
     }
     
-    public <R, P> R accept( NodeVisitor<? extends R, ? super P> visitor, P data ) 
+    public <R, P> R accept( NodeVisitor<? extends R, ? super P> visitor, P data )
+        throws OgnlException
     {
         return visitor.visit( this, data );
     }
diff --git a/src/main/java/org/apache/commons/ognl/ASTStaticMethod.java b/src/main/java/org/apache/commons/ognl/ASTStaticMethod.java
index 965b8ce..1bd81c0 100644
--- a/src/main/java/org/apache/commons/ognl/ASTStaticMethod.java
+++ b/src/main/java/org/apache/commons/ognl/ASTStaticMethod.java
@@ -244,7 +244,8 @@ public class ASTStaticMethod
         return toGetSourceString( context, target );
     }
     
-    public <R, P> R accept( NodeVisitor<? extends R, ? super P> visitor, P data ) 
+    public <R, P> R accept( NodeVisitor<? extends R, ? super P> visitor, P data )
+        throws OgnlException
     {
         return visitor.visit( this, data );
     }
diff --git a/src/main/java/org/apache/commons/ognl/ASTSubtract.java b/src/main/java/org/apache/commons/ognl/ASTSubtract.java
index 73c04d6..1f559cc 100644
--- a/src/main/java/org/apache/commons/ognl/ASTSubtract.java
+++ b/src/main/java/org/apache/commons/ognl/ASTSubtract.java
@@ -50,7 +50,8 @@ class ASTSubtract
         return "-";
     }
     
-    public <R, P> R accept( NodeVisitor<? extends R, ? super P> visitor, P data ) 
+    public <R, P> R accept( NodeVisitor<? extends R, ? super P> visitor, P data )
+        throws OgnlException
     {
         return visitor.visit( this, data );
     }
diff --git a/src/main/java/org/apache/commons/ognl/ASTTest.java b/src/main/java/org/apache/commons/ognl/ASTTest.java
index 60b2985..a87af78 100644
--- a/src/main/java/org/apache/commons/ognl/ASTTest.java
+++ b/src/main/java/org/apache/commons/ognl/ASTTest.java
@@ -135,7 +135,8 @@ class ASTTest
         }
     }
     
-    public <R, P> R accept( NodeVisitor<? extends R, ? super P> visitor, P data ) 
+    public <R, P> R accept( NodeVisitor<? extends R, ? super P> visitor, P data )
+        throws OgnlException
     {
         return visitor.visit( this, data );
     }
diff --git a/src/main/java/org/apache/commons/ognl/ASTThisVarRef.java b/src/main/java/org/apache/commons/ognl/ASTThisVarRef.java
index a9d0f22..2bdbb0f 100644
--- a/src/main/java/org/apache/commons/ognl/ASTThisVarRef.java
+++ b/src/main/java/org/apache/commons/ognl/ASTThisVarRef.java
@@ -62,7 +62,8 @@ public class ASTThisVarRef
         throw new UnsupportedCompilationException( "Unable to compile this references." );
     }
     
-    public <R, P> R accept( NodeVisitor<? extends R, ? super P> visitor, P data ) 
+    public <R, P> R accept( NodeVisitor<? extends R, ? super P> visitor, P data )
+        throws OgnlException
     {
         return visitor.visit( this, data );
     }
diff --git a/src/main/java/org/apache/commons/ognl/ASTUnsignedShiftRight.java b/src/main/java/org/apache/commons/ognl/ASTUnsignedShiftRight.java
index e8e40f8..8ec0d98 100644
--- a/src/main/java/org/apache/commons/ognl/ASTUnsignedShiftRight.java
+++ b/src/main/java/org/apache/commons/ognl/ASTUnsignedShiftRight.java
@@ -86,7 +86,8 @@ class ASTUnsignedShiftRight
         return result;
     }
     
-    public <R, P> R accept( NodeVisitor<? extends R, ? super P> visitor, P data ) 
+    public <R, P> R accept( NodeVisitor<? extends R, ? super P> visitor, P data )
+        throws OgnlException
     {
         return visitor.visit( this, data );
     }
diff --git a/src/main/java/org/apache/commons/ognl/ASTVarRef.java b/src/main/java/org/apache/commons/ognl/ASTVarRef.java
index e98918b..9ea72c1 100644
--- a/src/main/java/org/apache/commons/ognl/ASTVarRef.java
+++ b/src/main/java/org/apache/commons/ognl/ASTVarRef.java
@@ -141,6 +141,7 @@ public class ASTVarRef
     }
 
     public <R,P> R accept(NodeVisitor<? extends R, ? super P> visitor, P data)
+        throws OgnlException
     {
         return visitor.visit( this, data );
     }
diff --git a/src/main/java/org/apache/commons/ognl/ASTXor.java b/src/main/java/org/apache/commons/ognl/ASTXor.java
index 109d12a..efbcdc0 100644
--- a/src/main/java/org/apache/commons/ognl/ASTXor.java
+++ b/src/main/java/org/apache/commons/ognl/ASTXor.java
@@ -58,7 +58,8 @@ class ASTXor
         return "^";
     }
     
-    public <R, P> R accept( NodeVisitor<? extends R, ? super P> visitor, P data ) 
+    public <R, P> R accept( NodeVisitor<? extends R, ? super P> visitor, P data )
+        throws OgnlException
     {
         return visitor.visit( this, data );
     }
diff --git a/src/main/java/org/apache/commons/ognl/Node.java b/src/main/java/org/apache/commons/ognl/Node.java
index 9f41a93..4912fbf 100644
--- a/src/main/java/org/apache/commons/ognl/Node.java
+++ b/src/main/java/org/apache/commons/ognl/Node.java
@@ -104,6 +104,7 @@ public interface Node
      * @throws NullPointerException if visitor is null
      * @throws RuntimeException if visitor.visit throws an exception.
      */
-    <R,P> R accept(NodeVisitor<? extends R, ? super P> visitor, P data);
+    <R,P> R accept(NodeVisitor<? extends R, ? super P> visitor, P data)
+        throws OgnlException;
 
 }
diff --git a/src/main/java/org/apache/commons/ognl/NodeVisitor.java b/src/main/java/org/apache/commons/ognl/NodeVisitor.java
index 4eab67a..c3a0345 100644
--- a/src/main/java/org/apache/commons/ognl/NodeVisitor.java
+++ b/src/main/java/org/apache/commons/ognl/NodeVisitor.java
@@ -22,50 +22,50 @@ package org.apache.commons.ognl;
 
 public interface NodeVisitor<R, P>
 {
-  public R visit(ASTSequence node, P data);
-  public R visit(ASTAssign node, P data);
-  public R visit(ASTTest node, P data);
-  public R visit(ASTOr node, P data);
-  public R visit(ASTAnd node, P data);
-  public R visit(ASTBitOr node, P data);
-  public R visit(ASTXor node, P data);
-  public R visit(ASTBitAnd node, P data);
-  public R visit(ASTEq node, P data);
-  public R visit(ASTNotEq node, P data);
-  public R visit(ASTLess node, P data);
-  public R visit(ASTGreater node, P data);
-  public R visit(ASTLessEq node, P data);
-  public R visit(ASTGreaterEq node, P data);
-  public R visit(ASTIn node, P data);
-  public R visit(ASTNotIn node, P data);
-  public R visit(ASTShiftLeft node, P data);
-  public R visit(ASTShiftRight node, P data);
-  public R visit(ASTUnsignedShiftRight node, P data);
-  public R visit(ASTAdd node, P data);
-  public R visit(ASTSubtract node, P data);
-  public R visit(ASTMultiply node, P data);
-  public R visit(ASTDivide node, P data);
-  public R visit(ASTRemainder node, P data);
-  public R visit(ASTNegate node, P data);
-  public R visit(ASTBitNegate node, P data);
-  public R visit(ASTNot node, P data);
-  public R visit(ASTInstanceof node, P data);
-  public R visit(ASTChain node, P data);
-  public R visit(ASTEval node, P data);
-  public R visit(ASTConst node, P data);
-  public R visit(ASTThisVarRef node, P data);
-  public R visit(ASTRootVarRef node, P data);
-  public R visit(ASTVarRef node, P data);
-  public R visit(ASTList node, P data);
-  public R visit(ASTMap node, P data);
-  public R visit(ASTKeyValue node, P data);
-  public R visit(ASTStaticField node, P data);
-  public R visit(ASTCtor node, P data);
-  public R visit(ASTProperty node, P data);
-  public R visit(ASTStaticMethod node, P data);
-  public R visit(ASTMethod node, P data);
-  public R visit(ASTProject node, P data);
-  public R visit(ASTSelect node, P data);
-  public R visit(ASTSelectFirst node, P data);
-  public R visit(ASTSelectLast node, P data);
+  public R visit(ASTSequence node, P data) throws OgnlException;
+  public R visit(ASTAssign node, P data) throws OgnlException;
+  public R visit(ASTTest node, P data) throws OgnlException;
+  public R visit(ASTOr node, P data) throws OgnlException;
+  public R visit(ASTAnd node, P data) throws OgnlException;
+  public R visit(ASTBitOr node, P data) throws OgnlException;
+  public R visit(ASTXor node, P data) throws OgnlException;
+  public R visit(ASTBitAnd node, P data) throws OgnlException;
+  public R visit(ASTEq node, P data) throws OgnlException;
+  public R visit(ASTNotEq node, P data) throws OgnlException;
+  public R visit(ASTLess node, P data) throws OgnlException;
+  public R visit(ASTGreater node, P data) throws OgnlException;
+  public R visit(ASTLessEq node, P data) throws OgnlException;
+  public R visit(ASTGreaterEq node, P data) throws OgnlException;
+  public R visit(ASTIn node, P data) throws OgnlException;
+  public R visit(ASTNotIn node, P data) throws OgnlException;
+  public R visit(ASTShiftLeft node, P data) throws OgnlException;
+  public R visit(ASTShiftRight node, P data) throws OgnlException;
+  public R visit(ASTUnsignedShiftRight node, P data) throws OgnlException;
+  public R visit(ASTAdd node, P data) throws OgnlException;
+  public R visit(ASTSubtract node, P data) throws OgnlException;
+  public R visit(ASTMultiply node, P data) throws OgnlException;
+  public R visit(ASTDivide node, P data) throws OgnlException;
+  public R visit(ASTRemainder node, P data) throws OgnlException;
+  public R visit(ASTNegate node, P data) throws OgnlException;
+  public R visit(ASTBitNegate node, P data) throws OgnlException;
+  public R visit(ASTNot node, P data) throws OgnlException;
+  public R visit(ASTInstanceof node, P data) throws OgnlException;
+  public R visit(ASTChain node, P data) throws OgnlException;
+  public R visit(ASTEval node, P data) throws OgnlException;
+  public R visit(ASTConst node, P data) throws OgnlException;
+  public R visit(ASTThisVarRef node, P data) throws OgnlException;
+  public R visit(ASTRootVarRef node, P data) throws OgnlException;
+  public R visit(ASTVarRef node, P data) throws OgnlException;
+  public R visit(ASTList node, P data) throws OgnlException;
+  public R visit(ASTMap node, P data) throws OgnlException;
+  public R visit(ASTKeyValue node, P data) throws OgnlException;
+  public R visit(ASTStaticField node, P data) throws OgnlException;
+  public R visit(ASTCtor node, P data) throws OgnlException;
+  public R visit(ASTProperty node, P data) throws OgnlException;
+  public R visit(ASTStaticMethod node, P data) throws OgnlException;
+  public R visit(ASTMethod node, P data) throws OgnlException;
+  public R visit(ASTProject node, P data) throws OgnlException;
+  public R visit(ASTSelect node, P data) throws OgnlException;
+  public R visit(ASTSelectFirst node, P data) throws OgnlException;
+  public R visit(ASTSelectLast node, P data) throws OgnlException;
 }
diff --git a/src/main/java/org/apache/commons/ognl/SimpleNode.java b/src/main/java/org/apache/commons/ognl/SimpleNode.java
index 05f35cc..86d5df7 100644
--- a/src/main/java/org/apache/commons/ognl/SimpleNode.java
+++ b/src/main/java/org/apache/commons/ognl/SimpleNode.java
@@ -113,7 +113,16 @@ public abstract class SimpleNode
     @Override
     public String toString()
     {
-        return accept( ToStringVisitor.INSTANCE, new StringBuilder()).toString();
+        final StringBuilder data = new StringBuilder();
+        try
+        {
+            accept( ToStringVisitor.INSTANCE, data );
+        }
+        catch ( OgnlException e )
+        {
+            // ignored.
+        }
+        return data.toString();
     }
 
     // OGNL additions
diff --git a/src/main/java/org/apache/commons/ognl/ToStringVisitor.java b/src/main/java/org/apache/commons/ognl/ToStringVisitor.java
index 7d17dc0..f7addf4 100644
--- a/src/main/java/org/apache/commons/ognl/ToStringVisitor.java
+++ b/src/main/java/org/apache/commons/ognl/ToStringVisitor.java
@@ -452,7 +452,15 @@ public class ToStringVisitor
 
     private StringBuilder recurse( Node child, StringBuilder data )
     {
-        return child == null ? data.append( "null" ) : child.accept( this, data );
+        try
+        {
+            return child == null ? data.append( "null" ) : child.accept( this, data );
+        }
+        catch ( OgnlException e )
+        {
+            // This should never happen, but delegate it on just in case.
+            throw new RuntimeException( e );
+        }
     }
 
 }
