<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 22:08:53 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[TIKA-3687] Email file detected as text/html</title>
                <link>https://issues.apache.org/jira/browse/TIKA-3687</link>
                <project id="12310631" key="TIKA">Tika</project>
                    <description>&lt;p&gt;The attached email (which I redacted from a real email received from Office365) is detected a HTML.&lt;/p&gt;

&lt;p&gt;This is because it contains ARC * headers, but they&apos;re not the first one, so the matcher that looks for ARC headers fails, and the matcher for regular &apos;From&apos; header also fails because the &apos;From&apos; headers occurs after 1024 characters.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13431781">TIKA-3687</key>
            <summary>Email file detected as text/html</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="tguerin">Thierry Gu&#233;rin</reporter>
                        <labels>
                    </labels>
                <created>Thu, 3 Mar 2022 17:55:31 +0000</created>
                <updated>Fri, 20 May 2022 13:21:09 +0000</updated>
                            <resolved>Thu, 3 Mar 2022 19:13:10 +0000</resolved>
                                    <version>2.3.0</version>
                                    <fixVersion>2.4.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="17500953" author="githubbot" created="Thu, 3 Mar 2022 18:02:14 +0000"  >&lt;p&gt;SchwingSK opened a new pull request #520:&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/tika/pull/520&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/tika/pull/520&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;   1024  is maybe a bit overkill for the X|DKIM|ARC headers lookahead ?&lt;/p&gt;


&lt;p&gt;&amp;#8211; &lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on to GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;To unsubscribe, e-mail: dev-unsubscribe@tika.apache.org&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="17500962" author="tguerin" created="Thu, 3 Mar 2022 18:16:27 +0000"  >&lt;p&gt;Created a pull request: &lt;a href=&quot;https://github.com/apache/tika/pull/520.&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/tika/pull/520.&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;I went with changing the X|DKIM|ARC headers look-ahead, which was 0 to 1024. Other solution was to increase 1024 to at least 8000 (I have another email in which the first &apos;From:&apos; is around 6400) in lines 6407-6420. I&apos;m sure someone here has a good idea on which version is the most efficient.&lt;/p&gt;

&lt;p&gt;As of now, I only found examples where there was one &apos;Received:&apos; header before the &apos;ARC*&apos; headers, that&apos;s why I think that 1024 may be overkill.&lt;/p&gt;</comment>
                            <comment id="17500966" author="githubbot" created="Thu, 3 Mar 2022 18:22:20 +0000"  >&lt;p&gt;tballison commented on a change in pull request #520:&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/tika/pull/520#discussion_r818943762&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/tika/pull/520#discussion_r818943762&lt;/a&gt;&lt;/p&gt;



&lt;p&gt;##########&lt;br/&gt;
File path: tika-core/src/main/resources/org/apache/tika/mime/tika-mimetypes.xml&lt;br/&gt;
##########&lt;br/&gt;
@@ -6422,7 +6422,7 @@&lt;br/&gt;
       &amp;lt;!-- match X- DKIM- ARC- at start of file and then require at least one&lt;br/&gt;
            of the usual: from, received, date...but look farther into the file&lt;br/&gt;
            because of the X|DKIM|ARC headers--&amp;gt;&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;&amp;lt;match value=&quot;(X|DKIM|ARC)-&quot; type=&quot;regex&quot; offset=&quot;0&quot;&amp;gt;&lt;br/&gt;
+      &amp;lt;match value=&quot;(X|DKIM|ARC)-&quot; type=&quot;regex&quot; offset=&quot;0:1024&quot;&amp;gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Review comment:&lt;br/&gt;
       I worry about looking for X- anywhere in the first 1024 without requiring a \n before it.&lt;/p&gt;

&lt;p&gt;   What would you think of adding something like this into the previous minShouldMatch=2 clause?&lt;br/&gt;
   `&lt;br/&gt;
   &amp;lt;match value=&quot;\nX-&quot; type=&quot;string&quot; offset=&quot;0:1024&quot;&amp;gt;&lt;br/&gt;
   &amp;lt;match value=&quot;\nDKIM-&quot; type=&quot;string&quot; offset=&quot;0:1024&quot;&amp;gt;&lt;br/&gt;
   &amp;lt;match value=&quot;\nARC-&quot; type=&quot;string&quot; offset=&quot;0:1024&quot;&amp;gt;&lt;br/&gt;
   `&lt;/p&gt;





&lt;p&gt;&amp;#8211; &lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on to GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;To unsubscribe, e-mail: dev-unsubscribe@tika.apache.org&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="17500974" author="githubbot" created="Thu, 3 Mar 2022 18:41:53 +0000"  >&lt;p&gt;SchwingSK commented on a change in pull request #520:&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/tika/pull/520#discussion_r818959865&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/tika/pull/520#discussion_r818959865&lt;/a&gt;&lt;/p&gt;



&lt;p&gt;##########&lt;br/&gt;
File path: tika-core/src/main/resources/org/apache/tika/mime/tika-mimetypes.xml&lt;br/&gt;
##########&lt;br/&gt;
@@ -6422,7 +6422,7 @@&lt;br/&gt;
       &amp;lt;!-- match X- DKIM- ARC- at start of file and then require at least one&lt;br/&gt;
            of the usual: from, received, date...but look farther into the file&lt;br/&gt;
            because of the X|DKIM|ARC headers--&amp;gt;&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;&amp;lt;match value=&quot;(X|DKIM|ARC)-&quot; type=&quot;regex&quot; offset=&quot;0&quot;&amp;gt;&lt;br/&gt;
+      &amp;lt;match value=&quot;(X|DKIM|ARC)-&quot; type=&quot;regex&quot; offset=&quot;0:1024&quot;&amp;gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Review comment:&lt;br/&gt;
       Good point, I like your solution better. Code changed accordingly.&lt;/p&gt;




&lt;p&gt;&amp;#8211; &lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on to GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;To unsubscribe, e-mail: dev-unsubscribe@tika.apache.org&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="17500986" author="githubbot" created="Thu, 3 Mar 2022 19:09:40 +0000"  >&lt;p&gt;tballison merged pull request #520:&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/tika/pull/520&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/tika/pull/520&lt;/a&gt;&lt;/p&gt;





&lt;p&gt;&amp;#8211; &lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on to GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;To unsubscribe, e-mail: dev-unsubscribe@tika.apache.org&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="17500990" author="tallison@mitre.org" created="Thu, 3 Mar 2022 19:13:10 +0000"  >&lt;p&gt;Thank you &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tguerin&quot; class=&quot;user-hover&quot; rel=&quot;tguerin&quot;&gt;tguerin&lt;/a&gt;!&lt;/p&gt;</comment>
                            <comment id="17501040" author="hudson" created="Thu, 3 Mar 2022 21:12:29 +0000"  >&lt;p&gt;SUCCESS: Integrated in Jenkins build Tika &#187; tika-main-jdk8 #475 (See &lt;a href=&quot;https://ci-builds.apache.org/job/Tika/job/tika-main-jdk8/475/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://ci-builds.apache.org/job/Tika/job/tika-main-jdk8/475/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/TIKA-3687&quot; title=&quot;Email file detected as text/html&quot; class=&quot;issue-link&quot; data-issue-key=&quot;TIKA-3687&quot;&gt;&lt;del&gt;TIKA-3687&lt;/del&gt;&lt;/a&gt; Fix email detection (#520) (github: &lt;a href=&quot;https://github.com/apache/tika/commit/5444f80d1b71845ff47c91376f5c90a40dae5a4f&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/tika/commit/5444f80d1b71845ff47c91376f5c90a40dae5a4f&lt;/a&gt;)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;(edit) tika-core/src/main/resources/org/apache/tika/mime/tika-mimetypes.xml&lt;/li&gt;
	&lt;li&gt;(add) tika-parsers/tika-parsers-standard/tika-parsers-standard-modules/tika-parser-mail-module/src/test/resources/test-documents/testRFC822-ARC&lt;/li&gt;
	&lt;li&gt;(edit) tika-parsers/tika-parsers-standard/tika-parsers-standard-modules/tika-parser-mail-module/src/test/java/org/apache/tika/parser/mail/RFC822ParserTest.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="17501954" author="githubbot" created="Sun, 6 Mar 2022 13:15:47 +0000"  >&lt;p&gt;lfcnassif commented on pull request #520:&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/tika/pull/520#issuecomment-1059961092&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/tika/pull/520#issuecomment-1059961092&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;   Sorry, late to the party... I think maybe the new \nX- 0:1024 could cause false positives in regression tests. If yes, I would check for additional headers after it matches, like done for mbox mimetype.&lt;/p&gt;


&lt;p&gt;&amp;#8211; &lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on to GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;To unsubscribe, e-mail: dev-unsubscribe@tika.apache.org&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="17501957" author="githubbot" created="Sun, 6 Mar 2022 13:27:57 +0000"  >&lt;p&gt;lfcnassif commented on pull request #520:&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/tika/pull/520#issuecomment-1059962861&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/tika/pull/520#issuecomment-1059962861&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;   Also, if we look for additional headers if X|DKIM|ARC matches at the beginning, why not look for other headers if they match in a wide range of positions? (ok there is the \n but it is pretty common in txt files).&lt;/p&gt;

&lt;p&gt;   Maybe we could use a regex to put all definitions together, regardless if they are at the beginning at the file or at the beginning of lines in the first 1024...&lt;/p&gt;


&lt;p&gt;&amp;#8211; &lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on to GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;To unsubscribe, e-mail: dev-unsubscribe@tika.apache.org&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="17501959" author="githubbot" created="Sun, 6 Mar 2022 13:29:25 +0000"  >&lt;p&gt;lfcnassif edited a comment on pull request #520:&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/tika/pull/520#issuecomment-1059962861&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/tika/pull/520#issuecomment-1059962861&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;   Also, if we look for additional headers if X|DKIM|ARC matches at the beginning, why not look for other headers if they match in a wide range of positions? (ok there is the \n but it is pretty common in txt files).&lt;/p&gt;

&lt;p&gt;   Maybe we could use a regex to put all definitions together, regardless if they are at the beginning of the file or at the beginning of lines in the first 1024...&lt;/p&gt;


&lt;p&gt;&amp;#8211; &lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on to GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;To unsubscribe, e-mail: dev-unsubscribe@tika.apache.org&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="17501963" author="githubbot" created="Sun, 6 Mar 2022 13:50:25 +0000"  >&lt;p&gt;lfcnassif commented on pull request #520:&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/tika/pull/520#issuecomment-1059966314&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/tika/pull/520#issuecomment-1059966314&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;   I just saw the minShouldMatch=2 clause (I was on the small cellphone screen...), let&apos;s wait for the regression tests...&lt;/p&gt;


&lt;p&gt;&amp;#8211; &lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on to GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;To unsubscribe, e-mail: dev-unsubscribe@tika.apache.org&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="17540122" author="githubbot" created="Fri, 20 May 2022 13:18:02 +0000"  >&lt;p&gt;lfcnassif commented on PR #520:&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/tika/pull/520#issuecomment-1132891085&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/tika/pull/520#issuecomment-1132891085&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;@SchwingSK I detected some false positives (see &lt;a href=&quot;https://issues.apache.org/jira/browse/TIKA-3771&quot; title=&quot;Regression from TIKA-3687: Files wrongly detected as EML &quot; class=&quot;issue-link&quot; data-issue-key=&quot;TIKA-3771&quot;&gt;&lt;del&gt;TIKA-3771&lt;/del&gt;&lt;/a&gt;) after this. The &amp;lt;match value=&quot;\nX-&quot; type=&quot;string&quot; offset=&quot;0:1024&quot;/&amp;gt; rule is not needed to detect the EML sample you provided in &lt;a href=&quot;https://issues.apache.org/jira/browse/TIKA-3687&quot; title=&quot;Email file detected as text/html&quot; class=&quot;issue-link&quot; data-issue-key=&quot;TIKA-3687&quot;&gt;&lt;del&gt;TIKA-3687&lt;/del&gt;&lt;/a&gt;. Not sure if this is the best option, but if we remove it, will EML files in your dataset continue to be detected?&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="13040695" name="testRFC822-ARC.eml" size="5761" author="tguerin" created="Thu, 3 Mar 2022 17:47:32 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            3 years, 25 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z1051c:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>