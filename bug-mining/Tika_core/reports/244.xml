<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 22:08:00 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[TIKA-2170] Tika 1.13 ForkParser fails intermittently with very large MS Word docx</title>
                <link>https://issues.apache.org/jira/browse/TIKA-2170</link>
                <project id="12310631" key="TIKA">Tika</project>
                    <description>&lt;p&gt;If the ForkParser is run in a for-loop over and over against a single large Microsoft Word DOCX file, it fails intermittently. Sometimes it will fail on the very first iteration. Sometimes it will run through several iterations before failing. Results are inconsistent. &lt;/p&gt;

&lt;p&gt;A small test application is enclosed. For the test, I use a Word docx with the full text of &quot;War and Peace&quot;. 2.8MB, 1141 pages of text.&lt;/p&gt;</description>
                <environment>&lt;p&gt;Windows 10&lt;/p&gt;</environment>
        <key id="13018866">TIKA-2170</key>
            <summary>Tika 1.13 ForkParser fails intermittently with very large MS Word docx</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="tkingsbury@lenovo.com">Tim Kingsbury</reporter>
                        <labels>
                    </labels>
                <created>Mon, 7 Nov 2016 15:46:14 +0000</created>
                <updated>Mon, 12 Apr 2021 12:59:07 +0000</updated>
                            <resolved>Thu, 10 Nov 2016 14:30:56 +0000</resolved>
                                    <version>1.13</version>
                                    <fixVersion>1.15</fixVersion>
                    <fixVersion>2.0.0</fixVersion>
                                    <component>parser</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="15644532" author="tkingsbury@lenovo.com" created="Mon, 7 Nov 2016 15:47:44 +0000"  >&lt;p&gt;Sample Java app to demonstrate problem&lt;/p&gt;</comment>
                            <comment id="15645282" author="tallison@mitre.org" created="Mon, 7 Nov 2016 20:10:51 +0000"  >&lt;p&gt;I&apos;m able to reproduce this problem.  The ForkServer is shutting down with exit value 0, which is a good thing.&lt;/p&gt;

&lt;p&gt;I think the problem is that the ForkServer shuts down if it hasn&apos;t received or sent any data in 5 seconds.  &lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;    public void run() {
        try {
            while (active) {
                active = false;
                Thread.sleep(5000);
            }
            System.exit(0);
        } catch (InterruptedException e) {
        }
    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;When I remove the call to sleep() in your example code, I&apos;m not able to reproduce the problem.&lt;/p&gt;

&lt;p&gt;Even without your call to sleep, though, if a parser takes &amp;gt; 5 seconds to do something...let&apos;s say the parser slurps the entire input stream and then spends a long time parsing it before writing any output, then the ForkServer will shutdown.&lt;/p&gt;

&lt;p&gt;We could parameterize the amount of sleep before shutting-down-on-no-stream-activity if that would help.&lt;/p&gt;</comment>
                            <comment id="15645320" author="tkingsbury@lenovo.com" created="Mon, 7 Nov 2016 20:23:28 +0000"  >&lt;p&gt;Hey Tim, &lt;br/&gt;
The 5 second sleep on my side is definitely not required (that was just an experiment). It&apos;s interesting that you guys time out after 5 seconds of inactivity. How long you spend parsing a very large file is going to be hardware dependent. Perhaps your machine is a bit faster than mine?  I see it fail about 20% of the time at random. If I try with a smaller file, things become stable.&lt;/p&gt;

&lt;p&gt;&amp;gt;&amp;gt;We could parameterize the amount of sleep before shutting-down-on-no-stream-activity if that would help.&lt;/p&gt;

&lt;p&gt;That sounds like a perfect solution to me. I would bet that if I could bump the timeout up to 30 seconds, the problem might go away entirely.&lt;/p&gt;

&lt;p&gt;-Tim&lt;/p&gt;</comment>
                            <comment id="15645348" author="tallison@mitre.org" created="Mon, 7 Nov 2016 20:32:32 +0000"  >&lt;blockquote&gt;&lt;p&gt;That sounds like a perfect solution to me. I would bet that if I could bump the timeout up to 30 seconds, the problem might go away entirely.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;If only someone had suggested and implemented this &lt;a href=&quot;https://issues.apache.org/jira/browse/TIKA-456?focusedCommentId=14343193&amp;amp;page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-14343193&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;earlier&lt;/a&gt;... &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;Will do.&lt;/p&gt;</comment>
                            <comment id="15645373" author="tkingsbury@lenovo.com" created="Mon, 7 Nov 2016 20:39:05 +0000"  >&lt;p&gt;Awesome &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;  &lt;br/&gt;
Do you have any sort of a wild guess for an ETA?&lt;/p&gt;
</comment>
                            <comment id="15645437" author="tallison@mitre.org" created="Mon, 7 Nov 2016 20:59:15 +0000"  >&lt;p&gt;Wed in trunk, but it won&apos;t make it into 1.14 which is soon to be released.&lt;/p&gt;</comment>
                            <comment id="15645490" author="tallison@mitre.org" created="Mon, 7 Nov 2016 21:18:28 +0000"  >&lt;p&gt;This changes the &amp;lt;init&amp;gt; signature of some package-private classes.  If there are any objections or other recommendations, I&apos;m happy to modify.  If I don&apos;t hear anything back by, say, November 9, I&apos;ll commit this.&lt;/p&gt;</comment>
                            <comment id="15645519" author="tkingsbury@lenovo.com" created="Mon, 7 Nov 2016 21:28:55 +0000"  >&lt;p&gt;Cool. I&apos;ll be eagerly awaiting Tika 1.15 in the coming months.&lt;/p&gt;</comment>
                            <comment id="15645617" author="tkingsbury@lenovo.com" created="Mon, 7 Nov 2016 22:06:04 +0000"  >&lt;p&gt;Hey Tim, one more question: When the forkparser exits abnormally, two files (.jar and .tmp) are being left behind in the user&apos;s Temp folder. If we experience a large number of failures over a week, we have a risk of running out of disk space. Should I log this as a separate bug?&lt;/p&gt;</comment>
                            <comment id="15645967" author="tallison@mitre.org" created="Tue, 8 Nov 2016 00:35:33 +0000"  >&lt;p&gt;Y. Please re-open &lt;a href=&quot;https://issues.apache.org/jira/browse/TIKA-1933&quot; title=&quot;ForkParser leaves tmp jars behind on Windows (at least)&quot; class=&quot;issue-link&quot; data-issue-key=&quot;TIKA-1933&quot;&gt;&lt;del&gt;TIKA-1933&lt;/del&gt;&lt;/a&gt;.  I&apos;m not sure there is a quick fix, but I can look again.&lt;/p&gt;</comment>
                            <comment id="15654190" author="tallison@mitre.org" created="Thu, 10 Nov 2016 14:30:57 +0000"  >&lt;p&gt;Please reopen if you&apos;re still having problems after increasing the timeout.&lt;/p&gt;</comment>
                            <comment id="15654227" author="hudson" created="Thu, 10 Nov 2016 14:44:28 +0000"  >&lt;p&gt;UNSTABLE: Integrated in Jenkins build Tika-trunk #1140 (See &lt;a href=&quot;https://builds.apache.org/job/Tika-trunk/1140/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/Tika-trunk/1140/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/TIKA-2170&quot; title=&quot;Tika 1.13 ForkParser fails intermittently with very large MS Word docx&quot; class=&quot;issue-link&quot; data-issue-key=&quot;TIKA-2170&quot;&gt;&lt;del&gt;TIKA-2170&lt;/del&gt;&lt;/a&gt; &amp;#8211; allow users to configure timeout for ForkServer (tallison: rev e8bf985040e8b4fe6975468a6b912edd2d3e03d5)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;(edit) tika-core/src/main/java/org/apache/tika/fork/ForkServer.java&lt;/li&gt;
	&lt;li&gt;(edit) tika-core/src/main/java/org/apache/tika/fork/ForkClient.java&lt;/li&gt;
	&lt;li&gt;(edit) CHANGES.txt&lt;/li&gt;
	&lt;li&gt;(edit) tika-core/src/test/java/org/apache/tika/fork/ForkParserTest.java&lt;/li&gt;
	&lt;li&gt;(edit) tika-core/src/main/java/org/apache/tika/fork/ForkParser.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="15654393" author="hudson" created="Thu, 10 Nov 2016 15:54:30 +0000"  >&lt;p&gt;SUCCESS: Integrated in Jenkins build Tika-trunk #1141 (See &lt;a href=&quot;https://builds.apache.org/job/Tika-trunk/1141/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/Tika-trunk/1141/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/TIKA-2170&quot; title=&quot;Tika 1.13 ForkParser fails intermittently with very large MS Word docx&quot; class=&quot;issue-link&quot; data-issue-key=&quot;TIKA-2170&quot;&gt;&lt;del&gt;TIKA-2170&lt;/del&gt;&lt;/a&gt; &amp;#8211; fix unit test to allow for different exceptions to be (tallison: rev 2e325cb7103f3e7090433264a52f9787200c526e)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;(edit) tika-core/src/test/java/org/apache/tika/fork/ForkParserTest.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="15654401" author="hudson" created="Thu, 10 Nov 2016 15:57:27 +0000"  >&lt;p&gt;FAILURE: Integrated in Jenkins build tika-2.x-windows #75 (See &lt;a href=&quot;https://builds.apache.org/job/tika-2.x-windows/75/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/tika-2.x-windows/75/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/TIKA-2170&quot; title=&quot;Tika 1.13 ForkParser fails intermittently with very large MS Word docx&quot; class=&quot;issue-link&quot; data-issue-key=&quot;TIKA-2170&quot;&gt;&lt;del&gt;TIKA-2170&lt;/del&gt;&lt;/a&gt; allow configuration of timeout for ForkServer (tallison: rev 7adfe1cb5490bed1c912c21ccb29f56244485017)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;(edit) tika-core/src/main/java/org/apache/tika/fork/ForkParser.java&lt;/li&gt;
	&lt;li&gt;(edit) tika-core/src/test/java/org/apache/tika/fork/ForkParserTest.java&lt;/li&gt;
	&lt;li&gt;(edit) CHANGES.txt&lt;/li&gt;
	&lt;li&gt;(edit) tika-core/src/main/java/org/apache/tika/fork/ForkServer.java&lt;/li&gt;
	&lt;li&gt;(edit) tika-core/src/main/java/org/apache/tika/fork/ForkClient.java&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/TIKA-2170&quot; title=&quot;Tika 1.13 ForkParser fails intermittently with very large MS Word docx&quot; class=&quot;issue-link&quot; data-issue-key=&quot;TIKA-2170&quot;&gt;&lt;del&gt;TIKA-2170&lt;/del&gt;&lt;/a&gt; fix unit test to allow for different exceptions depending on (tallison: rev 7df6fe4be6ac92fcf3ed7773ae83a1061ee8db02)&lt;/li&gt;
	&lt;li&gt;(edit) tika-core/src/test/java/org/apache/tika/fork/ForkParserTest.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="15654409" author="hudson" created="Thu, 10 Nov 2016 16:00:22 +0000"  >&lt;p&gt;SUCCESS: Integrated in Jenkins build tika-2.x #174 (See &lt;a href=&quot;https://builds.apache.org/job/tika-2.x/174/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/tika-2.x/174/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/TIKA-2170&quot; title=&quot;Tika 1.13 ForkParser fails intermittently with very large MS Word docx&quot; class=&quot;issue-link&quot; data-issue-key=&quot;TIKA-2170&quot;&gt;&lt;del&gt;TIKA-2170&lt;/del&gt;&lt;/a&gt; allow configuration of timeout for ForkServer (tallison: rev 7adfe1cb5490bed1c912c21ccb29f56244485017)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;(edit) tika-core/src/main/java/org/apache/tika/fork/ForkServer.java&lt;/li&gt;
	&lt;li&gt;(edit) tika-core/src/main/java/org/apache/tika/fork/ForkClient.java&lt;/li&gt;
	&lt;li&gt;(edit) CHANGES.txt&lt;/li&gt;
	&lt;li&gt;(edit) tika-core/src/test/java/org/apache/tika/fork/ForkParserTest.java&lt;/li&gt;
	&lt;li&gt;(edit) tika-core/src/main/java/org/apache/tika/fork/ForkParser.java&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/TIKA-2170&quot; title=&quot;Tika 1.13 ForkParser fails intermittently with very large MS Word docx&quot; class=&quot;issue-link&quot; data-issue-key=&quot;TIKA-2170&quot;&gt;&lt;del&gt;TIKA-2170&lt;/del&gt;&lt;/a&gt; fix unit test to allow for different exceptions depending on (tallison: rev 7df6fe4be6ac92fcf3ed7773ae83a1061ee8db02)&lt;/li&gt;
	&lt;li&gt;(edit) tika-core/src/test/java/org/apache/tika/fork/ForkParserTest.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12468587">TIKA-456</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12837840" name="TIKA_2170.patch" size="8125" author="tallison" created="Mon, 7 Nov 2016 21:18:28 +0000"/>
                            <attachment id="12837788" name="TikaForkParserExample.java" size="2585" author="tkingsbury@lenovo.com" created="Mon, 7 Nov 2016 15:47:43 +0000"/>
                            <attachment id="12837790" name="War and Peace.docx" size="2941903" author="tkingsbury@lenovo.com" created="Mon, 7 Nov 2016 15:48:08 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 1 week, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i360cv:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>