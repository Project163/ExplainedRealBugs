<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 22:08:40 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[TIKA-3110] cannot extract metadata from 7z .tar archive</title>
                <link>https://issues.apache.org/jira/browse/TIKA-3110</link>
                <project id="12310631" key="TIKA">Tika</project>
                    <description>&lt;p&gt;When I extracted metadata from .tar archive wich was created by linux bash it&apos;s works&#160;as I expect but if .tar archive was created by 7z I got an error:&lt;br/&gt;
 TikaException: &lt;a href=&quot;https://issues.apache.org/jira/browse/TIKA-198&quot; title=&quot;Better distinction between IOException and TikaException&quot; class=&quot;issue-link&quot; data-issue-key=&quot;TIKA-198&quot;&gt;&lt;del&gt;TIKA-198&lt;/del&gt;&lt;/a&gt;: Illegal IOException from org.apache.tika.parser.pkg.PackageParser@4d0f2471&#160;&lt;br/&gt;
I created a project on GitHub for your convenience. It includes 2 files and code for play around:&#160;&lt;a href=&quot;https://github.com/AlexOkayJ/apache-tika-tar-issue.git&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/AlexOkayJ/apache-tika-tar-issue.git&lt;/a&gt;&lt;br/&gt;
 &#160;&lt;/p&gt;</description>
                <environment></environment>
        <key id="13310752">TIKA-3110</key>
            <summary>cannot extract metadata from 7z .tar archive</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="1" iconUrl="https://issues.apache.org/jira/images/icons/statuses/open.png" description="The issue is open and ready for the assignee to start work on it.">Open</status>
                    <statusCategory id="2" key="new" colorName="blue-gray"/>
                                    <resolution id="-1">Unresolved</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="AlexJokay">Alex</reporter>
                        <labels>
                    </labels>
                <created>Wed, 10 Jun 2020 20:56:13 +0000</created>
                <updated>Tue, 16 Jun 2020 19:15:27 +0000</updated>
                                            <version>1.24.1</version>
                                                    <component>mime</component>
                    <component>parser</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="17132728" author="tallison@mitre.org" created="Wed, 10 Jun 2020 21:28:45 +0000"  >&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Caused by: java.io.IOException: tried to skip 7168 but actually skipped: 0
	at org.apache.tika.io.TikaInputStream.skip(TikaInputStream.java:717)
	at org.apache.commons.io.input.ProxyInputStream.skip(ProxyInputStream.java:117)
	at org.apache.commons.compress.utils.IOUtils.skip(IOUtils.java:113)
	at org.apache.commons.compress.archivers.tar.TarArchiveInputStream.consumeRemainderOfLastBlock(TarArchiveInputStream.java:987)
	at org.apache.commons.compress.archivers.tar.TarArchiveInputStream.getRecord(TarArchiveInputStream.java:487)
	at org.apache.commons.compress.archivers.tar.TarArchiveInputStream.getNextTarEntry(TarArchiveInputStream.java:360)
	at org.apache.commons.compress.archivers.tar.TarArchiveInputStream.getNextEntry(TarArchiveInputStream.java:799)

&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This is a regression (or new feature?) going from 1.24 -&amp;gt; 1.24.1.&lt;/p&gt;

&lt;p&gt;For the sake of security, I changed TikaInputStream&apos;s skip() to require that the given number of bytes actually be skipped.  This prevents infinite loops in parsers that forget to check and/or trust FileInputStream.skip() which no one ever, ever should.&lt;/p&gt;

&lt;p&gt;My sense was that there may be some mp4&apos;s out there that will cause problems (e.g. they sometimes can end mid frame), and I&apos;m now thinking we hit this earlier with .tar files.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=bodewig&quot; class=&quot;user-hover&quot; rel=&quot;bodewig&quot;&gt;bodewig&lt;/a&gt; would you or a colleague on commons-compress know if we should expect this behavior for tar files...where they allege they have more data but actually don&apos;t. &lt;/p&gt;

&lt;p&gt;In short, is this something we should throw an exception for or should we happily let the tar file allege it has more bytes than it does?&lt;/p&gt;</comment>
                            <comment id="17132730" author="tallison@mitre.org" created="Wed, 10 Jun 2020 21:29:48 +0000"  >&lt;p&gt;FTR, I have never in my life seen a user create a repo that shows the problem.  Woah!  THANK YOU!&lt;/p&gt;</comment>
                            <comment id="17132732" author="tallison@mitre.org" created="Wed, 10 Jun 2020 21:30:32 +0000"  >&lt;p&gt;I&apos;m attaching the file here in the hopes that our issue-tracker crawler will one day pick up this file and stick it in our regression corpus. &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/biggrin.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="17134328" author="bodewig" created="Fri, 12 Jun 2020 16:01:48 +0000"  >&lt;p&gt;The short answer is: yes.&lt;/p&gt;

&lt;p&gt;The longer version: don&apos;t assume anything when dealing with archiving formats that have been around for decades. If only there was &lt;b&gt;the&lt;/b&gt; tar format. &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;I will avoid the terms block and record as GNU tar and BSD tar seem to use them differently.&lt;/p&gt;

&lt;p&gt;Traditionally the tar format contains chunks of 512 bytes of data and groups 10 such chunks to a larger unit. Likely because it could be written to a tape more easily if you wrote this bigger amount of data. Back then all tar archives would consist of 5kB blocks and the archive would be padded by 0s to make it reach a multiple of 5kB if the last entry didn&apos;t fill the unit entirely.&lt;/p&gt;

&lt;p&gt;A lot of dialects spawned. Some tar tools will not fill the last unit. In order to make things worse tar archives are supposed to signal EOF by two 512 byte chunks of zeros. Some archivers create such markers, others only add one chunk, others don&apos;t do either.&lt;/p&gt;

&lt;p&gt;consumeRemainderOfLastBlock tries to consume the whole 5kB unit it is looking at and if the stream ends permaturely, wll, then it has probably been created by an archiver that didn&apos;t care and we won&apos;t complain.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="17134371" author="tallison@mitre.org" created="Fri, 12 Jun 2020 16:45:32 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=bodewig&quot; class=&quot;user-hover&quot; rel=&quot;bodewig&quot;&gt;bodewig&lt;/a&gt;, I&apos;m so very, very grateful for your expertise in this and thoughtful response.  Thank you!&lt;/p&gt;

&lt;p&gt;Now how to figure out how to allow this for tar, but not other parsers.&lt;/p&gt;

&lt;p&gt;Again, thank you!&lt;/p&gt;</comment>
                            <comment id="17134381" author="laeubi" created="Fri, 12 Jun 2020 17:01:24 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tallison&quot; class=&quot;user-hover&quot; rel=&quot;tallison&quot;&gt;tallison&lt;/a&gt; from an API point of view I think TikaInputstream behaves wrong. The &lt;a href=&quot;https://docs.oracle.com/javase/7/docs/api/java/io/InputStream.html#skip(long)&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;javadoc&lt;/a&gt; states that &lt;blockquote&gt;&lt;p&gt;The skip method may, for a variety of reasons, end up skipping over some smaller number of bytes, possibly 0. This may result from any of a number of conditions; reaching end of file before n bytes have been skipped is only one possibility&lt;/p&gt;&lt;/blockquote&gt; so skipping over EOF is clearly allowed and should result in returning the number of bytes skipped (possibly zero), IOException is only to be expected if IO operation fails or the stream does not support skip at all...&lt;/p&gt;</comment>
                            <comment id="17134385" author="tallison@mitre.org" created="Fri, 12 Jun 2020 17:08:58 +0000"  >&lt;p&gt;Y, I completely agree with that.  I made the decision to do that to TikaInputStream because of the number of our dependencies that might not notice they&apos;ve hit EOF and enter into an infinite loop.&lt;/p&gt;

&lt;p&gt;We can certainly turn that back off.&lt;/p&gt;</comment>
                            <comment id="17134389" author="laeubi" created="Fri, 12 Jun 2020 17:09:56 +0000"  >&lt;p&gt;BTW: Commons.io has a foreMkDir maybe a dedicated &quot;forceSkip&quot; might be better? The method could behave in the following way:&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;use skip() and check if it has skipped the desired number of bytes&lt;/li&gt;
	&lt;li&gt;if less bytes where skipped try reading the remainder bytes with read(byte&lt;span class=&quot;error&quot;&gt;&amp;#91;remaining&amp;#93;&lt;/span&gt;) as one block&lt;/li&gt;
	&lt;li&gt;if still there are bytes left it could the read one byte at a time until either:
	&lt;ol&gt;
		&lt;li&gt;it encountered an EOF and throw EOFException&lt;/li&gt;
		&lt;li&gt;has read (aka skip) as much bytes as requested&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;
</comment>
                            <comment id="17134396" author="tallison@mitre.org" created="Fri, 12 Jun 2020 17:15:25 +0000"  >&lt;p&gt;Hahaha, y, I was going to point out something similar...actually, FileInputStream&apos;s returned &quot;bytes skipped&quot; can be inaccurate (&lt;a href=&quot;https://docs.oracle.com/javase/7/docs/api/java/io/FileInputStream.html#skip(long&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://docs.oracle.com/javase/7/docs/api/java/io/FileInputStream.html#skip(long&lt;/a&gt;)), it can lie&lt;/p&gt;

&lt;p&gt;&amp;gt;This produces no exception and the number of bytes skipped may include some number of bytes that were beyond the EOF of the backing file.&lt;/p&gt;

&lt;p&gt;Which is why IOUtils reads rather than skips:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/commons-io/blob/master/src/main/java/org/apache/commons/io/IOUtils.java#L1942&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/commons-io/blob/master/src/main/java/org/apache/commons/io/IOUtils.java#L1942&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17134403" author="tallison@mitre.org" created="Fri, 12 Jun 2020 17:21:29 +0000"  >&lt;p&gt;We&apos;ve been bitten by FileInputStream being wrong... IIRC that led to an infinite loop in one of our dependencies.&lt;/p&gt;

&lt;p&gt;Let&apos;s revert the change so that we&apos;re meeting the Java contract and hope that we can fix security vulnerabilities in our dependencies when we identify them?&lt;/p&gt;</comment>
                            <comment id="17134426" author="laeubi" created="Fri, 12 Jun 2020 17:46:51 +0000"  >&lt;p&gt;If you are only concerned about FileInputStream and alike, you still can implement skip in TikaInputstream in terms of read()...  and do it always right.&lt;br/&gt;
That might just be slower than a real skip but safer. Anyways, code that fails should be fixed, the skip contract is clearly wrecked and if it could be an issue code should not use that method.&lt;/p&gt;</comment>
                            <comment id="17134475" author="tallison@mitre.org" created="Fri, 12 Jun 2020 19:41:21 +0000"  >&lt;p&gt;Reverted in master; will cherry-pick to branch_1x early next week.&lt;/p&gt;

&lt;p&gt;&amp;gt;the skip contract is clearly wrecked&lt;br/&gt;
To reiterate, I added that check knowing that I&apos;d break the contract on skip because of all of the infinite loops I&apos;ve seen in dependencies.  I haven&apos;t had time to fix all of the problems we&apos;ve found via fuzzing.  This was a shortcut to help with a class of problems.&lt;/p&gt;

&lt;p&gt;skip now respects the contract, again.&lt;/p&gt;</comment>
                            <comment id="17134482" author="tallison@mitre.org" created="Fri, 12 Jun 2020 19:47:12 +0000"  >&lt;p&gt;The next issue that the file points to is that we aren&apos;t detecting parquet files...opening a separate issue for that.&lt;/p&gt;</comment>
                            <comment id="17134530" author="hudson" created="Fri, 12 Jun 2020 20:50:15 +0000"  >&lt;p&gt;SUCCESS: Integrated in Jenkins build Tika-trunk #1822 (See &lt;a href=&quot;https://builds.apache.org/job/Tika-trunk/1822/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/Tika-trunk/1822/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/TIKA-3110&quot; title=&quot;cannot extract metadata from 7z .tar archive&quot; class=&quot;issue-link&quot; data-issue-key=&quot;TIKA-3110&quot;&gt;TIKA-3110&lt;/a&gt; &amp;#8211; revert throwing IOException if a parser tries to skip past (tallison: &lt;a href=&quot;https://github.com/apache/tika/commit/04127faaa35a24479cfd47f460139a49c6dc80c7&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/tika/commit/04127faaa35a24479cfd47f460139a49c6dc80c7&lt;/a&gt;)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;(edit) tika-core/src/main/java/org/apache/tika/io/TikaInputStream.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="17134730" author="bodewig" created="Sat, 13 Jun 2020 10:33:57 +0000"  >&lt;p&gt;I see you have in a way reverted the behavior, good. Otherwise I would have pointed out that tar is not the only format with some weird dialects (but I think it is the worst of them).&lt;/p&gt;

&lt;p&gt;In Commons Compress we have decided to stick to &lt;tt&gt;skip&lt;/tt&gt; and provide &lt;tt&gt;SkipShieldingInputStream&lt;/tt&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt; instead, but being a library we can easily put the burden on our callers. The situation is certainly&#160; different for Tika.&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt; &lt;a href=&quot;https://github.com/apache/commons-compress/blob/master/src/main/java/org/apache/commons/compress/utils/SkipShieldingInputStream.java&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/commons-compress/blob/master/src/main/java/org/apache/commons/compress/utils/SkipShieldingInputStream.java&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17134737" author="tallison@mitre.org" created="Sat, 13 Jun 2020 10:50:57 +0000"  >&lt;p&gt;This is helpful. We can do the opposite...keep TikaInputStream as it now is, but override skip to skipfully for parsers we know have infinite loop vulnerabilities.&lt;/p&gt;
</comment>
                            <comment id="17137867" author="hudson" created="Tue, 16 Jun 2020 19:15:27 +0000"  >&lt;p&gt;SUCCESS: Integrated in Jenkins build tika-branch-1x #341 (See &lt;a href=&quot;https://builds.apache.org/job/tika-branch-1x/341/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/tika-branch-1x/341/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/TIKA-3110&quot; title=&quot;cannot extract metadata from 7z .tar archive&quot; class=&quot;issue-link&quot; data-issue-key=&quot;TIKA-3110&quot;&gt;TIKA-3110&lt;/a&gt; &amp;#8211; revert throwing IOException if a parser tries to skip past (tallison: &lt;a href=&quot;https://github.com/apache/tika/commit/aad237c717672b0369ec1696e74075aa4fb3e383&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/tika/commit/aad237c717672b0369ec1696e74075aa4fb3e383&lt;/a&gt;)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;(edit) tika-core/src/main/java/org/apache/tika/io/TikaInputStream.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                    </comments>
                    <attachments>
                            <attachment id="13005430" name="7ztar.tar" size="115712" author="tallison" created="Wed, 10 Jun 2020 21:30:03 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            5 years, 21 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0fqeg:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>