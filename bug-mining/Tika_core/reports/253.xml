<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 22:08:11 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[TIKA-2244] excessive memory usage when parsing a large nested package file</title>
                <link>https://issues.apache.org/jira/browse/TIKA-2244</link>
                <project id="12310631" key="TIKA">Tika</project>
                    <description>&lt;p&gt;When parsing large nested files(a couple good examples are maven jars and git objects), a large number of BufferedInputStreams get generated taking up large amounts of memory with their buffers. Upon looking through the relevant code I saw that many of these allocations were coming from TikaInputStream.get(InputStream, TemporaryResources)&lt;br/&gt;
which checks if the InputStream is a BufferedInputStream or ByteArrayInputStream in order to determine whether on not mark is supported. Unfortunately it is common practice to wrap InputStreams in CloseShieldInputStreams, causing it to fail even if mark is in fact supported.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13036018">TIKA-2244</key>
            <summary>excessive memory usage when parsing a large nested package file</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="joshbooks">Joshua Hight</reporter>
                        <labels>
                    </labels>
                <created>Wed, 18 Jan 2017 22:24:03 +0000</created>
                <updated>Mon, 12 Apr 2021 13:01:04 +0000</updated>
                            <resolved>Tue, 24 Jan 2017 19:07:32 +0000</resolved>
                                    <version>2.0.0</version>
                                    <fixVersion>1.15</fixVersion>
                    <fixVersion>2.0.0</fixVersion>
                                    <component>core</component>
                    <component>parser</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="15829867" author="tallison@mitre.org" created="Thu, 19 Jan 2017 13:00:29 +0000"  >&lt;p&gt;PR committed.  Thank you!  I found a few other places to check &lt;tt&gt;markSupported&lt;/tt&gt; before wrapping in a new &lt;tt&gt;BufferedInputStream&lt;/tt&gt; in tika-parsers.&lt;/p&gt;

&lt;p&gt;Should we also update &lt;tt&gt;AutoDetectReader&lt;/tt&gt; to check for &lt;tt&gt;markSupported&lt;/tt&gt; before wrapping?&lt;/p&gt;</comment>
                            <comment id="15829947" author="hudson" created="Thu, 19 Jan 2017 13:44:07 +0000"  >&lt;p&gt;SUCCESS: Integrated in Jenkins build tika-2.x #204 (See &lt;a href=&quot;https://builds.apache.org/job/tika-2.x/204/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/tika-2.x/204/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/TIKA-2244&quot; title=&quot;excessive memory usage when parsing a large nested package file&quot; class=&quot;issue-link&quot; data-issue-key=&quot;TIKA-2244&quot;&gt;&lt;del&gt;TIKA-2244&lt;/del&gt;&lt;/a&gt; &amp;#8211;  be more parsimonious with BufferedInputStream via Josh (tallison: rev 78828176a5da851c555f09688075983dfe4d8e49)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;(edit) tika-core/src/main/java/org/apache/tika/io/TikaInputStream.java&lt;/li&gt;
	&lt;li&gt;(edit) tika-parser-modules/tika-parser-package-module/src/main/java/org/apache/tika/parser/pkg/PackageParser.java&lt;/li&gt;
	&lt;li&gt;(edit) CHANGES.txt&lt;/li&gt;
	&lt;li&gt;(edit) tika-parser-modules/tika-parser-multimedia-module/src/main/java/org/apache/tika/parser/audio/MidiParser.java&lt;/li&gt;
	&lt;li&gt;(edit) tika-parser-modules/tika-parser-package-module/src/main/java/org/apache/tika/parser/pkg/CompressorParser.java&lt;/li&gt;
	&lt;li&gt;(edit) tika-parser-modules/tika-parser-office-module/src/main/java/org/apache/tika/parser/wordperfect/WPInputStream.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="15829953" author="hudson" created="Thu, 19 Jan 2017 13:46:01 +0000"  >&lt;p&gt;SUCCESS: Integrated in Jenkins build Tika-trunk #1185 (See &lt;a href=&quot;https://builds.apache.org/job/Tika-trunk/1185/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/Tika-trunk/1185/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/TIKA-2244&quot; title=&quot;excessive memory usage when parsing a large nested package file&quot; class=&quot;issue-link&quot; data-issue-key=&quot;TIKA-2244&quot;&gt;&lt;del&gt;TIKA-2244&lt;/del&gt;&lt;/a&gt; &amp;#8211; be more parsimonious with BufferedInputStream. This closes (tallison: rev 4cc15e2a3f813dce8001c1eb4aae712b05c557d4)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;(edit) tika-parsers/src/main/java/org/apache/tika/parser/audio/MidiParser.java&lt;/li&gt;
	&lt;li&gt;(edit) tika-parsers/src/main/java/org/apache/tika/parser/wordperfect/WPInputStream.java&lt;/li&gt;
	&lt;li&gt;(edit) CHANGES.txt&lt;/li&gt;
	&lt;li&gt;(edit) tika-parsers/src/main/java/org/apache/tika/parser/pkg/PackageParser.java&lt;/li&gt;
	&lt;li&gt;(edit) tika-parsers/src/main/java/org/apache/tika/parser/pkg/CompressorParser.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="15830501" author="joshbooks" created="Thu, 19 Jan 2017 19:53:33 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tallison%40apache.org&quot; class=&quot;user-hover&quot; rel=&quot;tallison@apache.org&quot;&gt;tallison@apache.org&lt;/a&gt; yep, it looks like AutoDetectReader and MidiParser are the only other two places doing this sort of thing, shall I submit another PR? if so would you prefer I create another bug or reference this one?&lt;/p&gt;</comment>
                            <comment id="15830517" author="tallison@mitre.org" created="Thu, 19 Jan 2017 20:07:58 +0000"  >&lt;p&gt;Just wanted confirmation.  I&apos;ll fix those prob early next week.  Thank you!&lt;/p&gt;</comment>
                            <comment id="15836469" author="tallison@mitre.org" created="Tue, 24 Jan 2017 19:07:32 +0000"  >&lt;p&gt;Updated AutoDetectReader.  Thank you for opening this.&lt;/p&gt;

&lt;p&gt;Out of curiosity, if you can share any metrics on decreased memory consumption that this change helped with, that&apos;d be great!  Did you use hprof or other memory profiling tool to see a difference btwn before/after this change? &lt;/p&gt;</comment>
                            <comment id="15836536" author="hudson" created="Tue, 24 Jan 2017 19:53:25 +0000"  >&lt;p&gt;SUCCESS: Integrated in Jenkins build Tika-trunk #1187 (See &lt;a href=&quot;https://builds.apache.org/job/Tika-trunk/1187/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/Tika-trunk/1187/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/TIKA-2244&quot; title=&quot;excessive memory usage when parsing a large nested package file&quot; class=&quot;issue-link&quot; data-issue-key=&quot;TIKA-2244&quot;&gt;&lt;del&gt;TIKA-2244&lt;/del&gt;&lt;/a&gt; &amp;#8211; be more parsimonious with BufferedInputStream &amp;#8211; (tallison: rev 836e2d9040bacd7a8ffe88095187aa28ff26c6ba)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;(edit) tika-core/src/main/java/org/apache/tika/detect/AutoDetectReader.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="15836560" author="joshbooks" created="Tue, 24 Jan 2017 20:09:12 +0000"  >&lt;p&gt;Sweet! Thanks for making open source awesome. I can&apos;t give you all the details, but I was using yourkit memory snapshots, and I definitely noticed a difference after the change. If you&apos;re having difficulty reproducing I found that parsing git FETCH_HEAD files for large repositories tends to trigger the behavior&lt;/p&gt;</comment>
                            <comment id="15836564" author="tallison@mitre.org" created="Tue, 24 Jan 2017 20:12:43 +0000"  >&lt;p&gt;Good enough.  Thank you for diagnosing that inefficiency.  Let us know what else you find! &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 42 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i38wdr:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>