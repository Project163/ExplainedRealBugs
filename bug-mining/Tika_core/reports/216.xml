<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 22:07:34 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[TIKA-1507] Under OSGi, ForkParser failes to send core parser classes like ExternalParser</title>
                <link>https://issues.apache.org/jira/browse/TIKA-1507</link>
                <project id="12310631" key="TIKA">Tika</project>
                    <description>&lt;p&gt;Under OSGi, if you try to use ForkParser with the Tesseract OCR parser, it will fail with:&lt;/p&gt;

&lt;p&gt;java.lang.NoClassDefFoundError: org/apache/tika/parser/external/ExternalParser&lt;br/&gt;
	at org.apache.tika.parser.ocr.TesseractOCRParser.hasTesseract(TesseractOCRParser.java:117)&lt;br/&gt;
	at org.apache.tika.parser.ocr.TesseractOCRParser.getSupportedTypes(TesseractOCRParser.java:91)&lt;br/&gt;
	at org.apache.tika.parser.CompositeParser.getParsers(CompositeParser.java:81)&lt;br/&gt;
	at org.apache.tika.parser.DefaultParser.getParsers(DefaultParser.java:95)&lt;br/&gt;
	at org.apache.tika.parser.CompositeParser.getParser(CompositeParser.java:209)&lt;br/&gt;
	at org.apache.tika.parser.CompositeParser.parse(CompositeParser.java:244)&lt;br/&gt;
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)&lt;br/&gt;
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:57)&lt;br/&gt;
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)&lt;br/&gt;
	at java.lang.reflect.Method.invoke(Method.java:622)&lt;br/&gt;
	at org.apache.tika.fork.ForkServer.call(ForkServer.java:144)&lt;br/&gt;
	at org.apache.tika.fork.ForkServer.processRequests(ForkServer.java:124)&lt;br/&gt;
	at org.apache.tika.fork.ForkServer.main(ForkServer.java:69)&lt;br/&gt;
Caused by: java.lang.ClassNotFoundException: Unable to find class org.apache.tika.parser.external.ExternalParser&lt;br/&gt;
	at org.apache.tika.fork.ClassLoaderProxy.findClass(ClassLoaderProxy.java:117)&lt;br/&gt;
	at java.lang.ClassLoader.loadClass(ClassLoader.java:323)&lt;br/&gt;
	at java.lang.ClassLoader.loadClass(ClassLoader.java:268)&lt;br/&gt;
	... 13 more&lt;/p&gt;

&lt;p&gt;ExternalParser lives in the Tika Core jar, not the Tika Parsers one. This all works fine outside of OSGi, so it looks like something about the OSGi bundling is causing the fork parser to fail to send the parser-related classes from Tika Core over to the forked JVM&lt;/p&gt;</description>
                <environment></environment>
        <key id="12765391">TIKA-1507</key>
            <summary>Under OSGi, ForkParser failes to send core parser classes like ExternalParser</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="bobpaulin">Bob Paulin</assignee>
                                    <reporter username="nick">Nick Burch</reporter>
                        <labels>
                    </labels>
                <created>Wed, 7 Jan 2015 15:26:07 +0000</created>
                <updated>Wed, 4 Nov 2015 04:53:35 +0000</updated>
                            <resolved>Wed, 4 Nov 2015 04:05:41 +0000</resolved>
                                    <version>1.6</version>
                    <version>1.7</version>
                                    <fixVersion>1.12</fixVersion>
                                    <component>packaging</component>
                    <component>parser</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="14267754" author="gagravarr" created="Wed, 7 Jan 2015 15:32:20 +0000"  >&lt;p&gt;To reproduce this, remove the try/catch NoClassDefFoundError in TesseractOCRParser.hasTesseract&lt;/p&gt;</comment>
                            <comment id="14267774" author="hudson" created="Wed, 7 Jan 2015 15:43:25 +0000"  >&lt;p&gt;UNSTABLE: Integrated in tika-trunk-jdk1.7 #414 (See &lt;a href=&quot;https://builds.apache.org/job/tika-trunk-jdk1.7/414/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/tika-trunk-jdk1.7/414/&lt;/a&gt;)&lt;br/&gt;
Temporary workaround for the &lt;a href=&quot;https://issues.apache.org/jira/browse/TIKA-1507&quot; title=&quot;Under OSGi, ForkParser failes to send core parser classes like ExternalParser&quot; class=&quot;issue-link&quot; data-issue-key=&quot;TIKA-1507&quot;&gt;&lt;del&gt;TIKA-1507&lt;/del&gt;&lt;/a&gt; ForkParser / OGI issue (nick: &lt;a href=&quot;http://svn.apache.org/viewvc/tika/trunk/?view=rev&amp;amp;rev=1650083&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/viewvc/tika/trunk/?view=rev&amp;amp;rev=1650083&lt;/a&gt;)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/tika/trunk/tika-parsers/src/main/java/org/apache/tika/parser/ocr/TesseractOCRParser.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="14267797" author="hudson" created="Wed, 7 Jan 2015 16:01:23 +0000"  >&lt;p&gt;UNSTABLE: Integrated in tika-trunk-jdk1.6 #398 (See &lt;a href=&quot;https://builds.apache.org/job/tika-trunk-jdk1.6/398/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/tika-trunk-jdk1.6/398/&lt;/a&gt;)&lt;br/&gt;
Temporary workaround for the &lt;a href=&quot;https://issues.apache.org/jira/browse/TIKA-1507&quot; title=&quot;Under OSGi, ForkParser failes to send core parser classes like ExternalParser&quot; class=&quot;issue-link&quot; data-issue-key=&quot;TIKA-1507&quot;&gt;&lt;del&gt;TIKA-1507&lt;/del&gt;&lt;/a&gt; ForkParser / OGI issue (nick: &lt;a href=&quot;http://svn.apache.org/viewvc/tika/trunk/?view=rev&amp;amp;rev=1650083&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/viewvc/tika/trunk/?view=rev&amp;amp;rev=1650083&lt;/a&gt;)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/tika/trunk/tika-parsers/src/main/java/org/apache/tika/parser/ocr/TesseractOCRParser.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="14498923" author="bobpaulin" created="Thu, 16 Apr 2015 22:54:11 +0000"  >&lt;p&gt;Issue appear to be related to the pom.xml.  &lt;br/&gt;
The external parser&apos;s package is negated.  Which will prevent it from being exported out of the bundle.  The org.apache.tika.parser package is also negated but it appears to be added back due to the last line.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;             &amp;lt;Export-Package&amp;gt;
              !org.apache.tika.parser,
              !org.apache.tika.parser.external,
              org.apache.tika.parser.*
            &amp;lt;/Export-Package&amp;gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I would recommend removing the negations as below.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;            &amp;lt;Export-Package&amp;gt;
              org.apache.tika.parser.*
            &amp;lt;/Export-Package&amp;gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="14499080" author="bobpaulin" created="Fri, 17 Apr 2015 01:05:22 +0000"  >&lt;p&gt;Attached a patch for this change.&lt;/p&gt;</comment>
                            <comment id="14501351" author="tallison@mitre.org" created="Sat, 18 Apr 2015 13:12:55 +0000"  >&lt;p&gt;Thank you, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=bobpaulin&quot; class=&quot;user-hover&quot; rel=&quot;bobpaulin&quot;&gt;bobpaulin&lt;/a&gt;! Those negations were added as a refactoring in r1196041 by &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jukkaz&quot; class=&quot;user-hover&quot; rel=&quot;jukkaz&quot;&gt;jukkaz&lt;/a&gt;. Does anyone remember the reason? Can we even expect external parsers to work within OSGi?&lt;/p&gt;</comment>
                            <comment id="14501394" author="bobpaulin" created="Sat, 18 Apr 2015 14:43:49 +0000"  >&lt;p&gt;For what it&apos;s worth it appears the ExternalParser is simply to run commands outside the JVM (ie as in a CLI).  I can&apos;t think of any OSGi restrictions on this type of activity.&lt;/p&gt;</comment>
                            <comment id="14623652" author="bobpaulin" created="Sun, 12 Jul 2015 02:12:14 +0000"  >&lt;p&gt;Is there anything holding this up?  I&apos;d like to use Tesseract in OSGi.&lt;/p&gt;</comment>
                            <comment id="14623653" author="bobpaulin" created="Sun, 12 Jul 2015 02:30:11 +0000"  >&lt;p&gt;Actually hold up.  I think I see something else here.&lt;/p&gt;</comment>
                            <comment id="14623835" author="bobpaulin" created="Sun, 12 Jul 2015 14:44:18 +0000"  >&lt;p&gt;I unzipped the tika-parser jar I noticed that the org.apache.tika.parser.external package is not listed in the MANIFEST.MF Import-Package entry.  This means that OSGi will not load the ExternalParser class into the tika-parser classloader.  This will lead to the NoClassDefFoundError.  The package is being exported by the tika-core project&apos;s MANIFEST.MF so I can&apos;t think of a reason why the maven-bundle-plugin would not pick it up as an import for tika-parser.  For this I&apos;ve filed a bug against the maven-bundle-plugin project to see if they have any thoughts: &lt;a href=&quot;https://issues.apache.org/jira/browse/FELIX-4958&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/FELIX-4958&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;One possible workaround is an explicit Export-Package statement in the pom of the parser project.  Exported packages are automatically included as imports in the plugin so I found adding the attached patch allows the proper classloading to take place.  However I have it to export all the classes under org.apache.tika.parser.* which will re-export the classes from the tika-core bundle under the tika-parser bundle.  This could cause other bundles that use the org.apache.tika.parser.* to import these packages from tika-parser instead of tika-core.  It&apos;s the same classes so it&apos;s harmless but a bit odd. &lt;/p&gt;

&lt;p&gt;I&apos;ve attached a new patch with this update to the pom.&lt;/p&gt;</comment>
                            <comment id="14623854" author="bobpaulin" created="Sun, 12 Jul 2015 15:33:18 +0000"  >&lt;p&gt;Stuart McCulloch got back to me from the maven-bundle-plugin side.  I missed the fact that there is a resource under org.apache.tika.parser.external in the parser project which causes a split package.  I would suggest we look into moving that file to another package location or up into tika-core to resolve the split package.  If we do this we can disregard the patch.&lt;/p&gt;</comment>
                            <comment id="14623932" author="bobpaulin" created="Sun, 12 Jul 2015 18:21:56 +0000"  >&lt;p&gt;Attached a patch with a potential solution for your review.  Create a new package under tika-parser org.apache.tika.parser.configuration for this type of file.  This allows the removal of the org.apache.tika.parser.external package in the tika-parser project.  This prevents tika-core and tika-parser from having packages with the same name (split packages).  This allows the pom files to remain as is and allows each bundle to only export their own packages.  A small change to the ExternalParserFactory file is also required to load the file from the new directory.  Sorry for all the noise.&lt;/p&gt;</comment>
                            <comment id="14632289" author="hlavki" created="Sat, 18 Jul 2015 05:57:45 +0000"  >&lt;p&gt;I didn&apos;t find &quot;good&quot; solution to use ForkParser in OSGi. Everytime it breaks something else, so I created parallel tika-bundle which works with ForkParser.&lt;br/&gt;
Link: &lt;a href=&quot;https://github.com/hlavki/tika-bundle-fork&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/hlavki/tika-bundle-fork&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14988840" author="bobpaulin" created="Wed, 4 Nov 2015 04:05:23 +0000"  >&lt;p&gt;This is resolved by moving the tika-external-parsers.xml to the tika-core project which resolves the split package issue.  Fixed in rev 1712462.&lt;/p&gt;</comment>
                            <comment id="14988874" author="hudson" created="Wed, 4 Nov 2015 04:53:35 +0000"  >&lt;p&gt;SUCCESS: Integrated in tika-trunk-jdk1.7 #880 (See &lt;a href=&quot;https://builds.apache.org/job/tika-trunk-jdk1.7/880/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/tika-trunk-jdk1.7/880/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/TIKA-1507&quot; title=&quot;Under OSGi, ForkParser failes to send core parser classes like ExternalParser&quot; class=&quot;issue-link&quot; data-issue-key=&quot;TIKA-1507&quot;&gt;&lt;del&gt;TIKA-1507&lt;/del&gt;&lt;/a&gt; - Moved tika-external-parsers.xml to tika-core to prevent OSGi split package issue. (bob: &lt;a href=&quot;http://svn.apache.org/viewvc/tika/trunk/?view=rev&amp;amp;rev=1712462&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/viewvc/tika/trunk/?view=rev&amp;amp;rev=1712462&lt;/a&gt;)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;trunk/tika-bundle/src/test/java/org/apache/tika/bundle/BundleIT.java&lt;/li&gt;
	&lt;li&gt;trunk/tika-bundle/src/test/resources/testOCR.jpg&lt;/li&gt;
	&lt;li&gt;trunk/tika-core/src/main/resources/org/apache/tika/parser&lt;/li&gt;
	&lt;li&gt;trunk/tika-core/src/main/resources/org/apache/tika/parser/external&lt;/li&gt;
	&lt;li&gt;trunk/tika-core/src/main/resources/org/apache/tika/parser/external/tika-external-parsers.xml&lt;/li&gt;
	&lt;li&gt;trunk/tika-parsers/src/main/java/org/apache/tika/parser/ocr/TesseractOCRParser.java&lt;/li&gt;
	&lt;li&gt;trunk/tika-parsers/src/main/resources/org/apache/tika/parser/external&lt;/li&gt;
&lt;/ul&gt;
</comment>
                    </comments>
                    <attachments>
                            <attachment id="12744947" name="TIKA-1507C.patch" size="10967" author="bobpaulin" created="Sun, 12 Jul 2015 18:14:07 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 2 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i241bj:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>