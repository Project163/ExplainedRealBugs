{"url":"https://api.github.com/repos/go-swagger/go-swagger/issues/1392","repository_url":"https://api.github.com/repos/go-swagger/go-swagger","labels_url":"https://api.github.com/repos/go-swagger/go-swagger/issues/1392/labels{/name}","comments_url":"https://api.github.com/repos/go-swagger/go-swagger/issues/1392/comments","events_url":"https://api.github.com/repos/go-swagger/go-swagger/issues/1392/events","html_url":"https://github.com/go-swagger/go-swagger/issues/1392","id":292548108,"node_id":"MDU6SXNzdWUyOTI1NDgxMDg=","number":1392,"title":"No validation is called on body of array type parameter.","user":{"login":"zerbitx","id":100507,"node_id":"MDQ6VXNlcjEwMDUwNw==","avatar_url":"https://avatars.githubusercontent.com/u/100507?v=4","gravatar_id":"","url":"https://api.github.com/users/zerbitx","html_url":"https://github.com/zerbitx","followers_url":"https://api.github.com/users/zerbitx/followers","following_url":"https://api.github.com/users/zerbitx/following{/other_user}","gists_url":"https://api.github.com/users/zerbitx/gists{/gist_id}","starred_url":"https://api.github.com/users/zerbitx/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/zerbitx/subscriptions","organizations_url":"https://api.github.com/users/zerbitx/orgs","repos_url":"https://api.github.com/users/zerbitx/repos","events_url":"https://api.github.com/users/zerbitx/events{/privacy}","received_events_url":"https://api.github.com/users/zerbitx/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":148436504,"node_id":"MDU6TGFiZWwxNDg0MzY1MDQ=","url":"https://api.github.com/repos/go-swagger/go-swagger/labels/bug","name":"bug","color":"fc2929","default":true,"description":null},{"id":493024330,"node_id":"MDU6TGFiZWw0OTMwMjQzMzA=","url":"https://api.github.com/repos/go-swagger/go-swagger/labels/generator","name":"generator","color":"bfdadc","default":false,"description":null}],"state":"closed","locked":false,"assignee":{"login":"fredbi","id":14262513,"node_id":"MDQ6VXNlcjE0MjYyNTEz","avatar_url":"https://avatars.githubusercontent.com/u/14262513?v=4","gravatar_id":"","url":"https://api.github.com/users/fredbi","html_url":"https://github.com/fredbi","followers_url":"https://api.github.com/users/fredbi/followers","following_url":"https://api.github.com/users/fredbi/following{/other_user}","gists_url":"https://api.github.com/users/fredbi/gists{/gist_id}","starred_url":"https://api.github.com/users/fredbi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/fredbi/subscriptions","organizations_url":"https://api.github.com/users/fredbi/orgs","repos_url":"https://api.github.com/users/fredbi/repos","events_url":"https://api.github.com/users/fredbi/events{/privacy}","received_events_url":"https://api.github.com/users/fredbi/received_events","type":"User","user_view_type":"public","site_admin":false},"assignees":[{"login":"fredbi","id":14262513,"node_id":"MDQ6VXNlcjE0MjYyNTEz","avatar_url":"https://avatars.githubusercontent.com/u/14262513?v=4","gravatar_id":"","url":"https://api.github.com/users/fredbi","html_url":"https://github.com/fredbi","followers_url":"https://api.github.com/users/fredbi/followers","following_url":"https://api.github.com/users/fredbi/following{/other_user}","gists_url":"https://api.github.com/users/fredbi/gists{/gist_id}","starred_url":"https://api.github.com/users/fredbi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/fredbi/subscriptions","organizations_url":"https://api.github.com/users/fredbi/orgs","repos_url":"https://api.github.com/users/fredbi/repos","events_url":"https://api.github.com/users/fredbi/events{/privacy}","received_events_url":"https://api.github.com/users/fredbi/received_events","type":"User","user_view_type":"public","site_admin":false}],"milestone":null,"comments":2,"created_at":"2018-01-29T20:25:38Z","updated_at":"2018-03-09T19:20:35Z","closed_at":"2018-03-09T19:20:35Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"## Problem statement\r\nWhen the body parameter is an array type, referencing another type, none of the validation is called.\r\n\r\nIts possible I'm just defining it incorrectly (as I'm new to writing swagger specs), but I can't seem to get it to satisfy the criteria around [this line of parameter.gotmpl](https://github.com/go-swagger/go-swagger/blob/master/generator/templates/server/parameter.gotmpl#L203)\r\n\r\nIf the validation checking done [around here](https://github.com/go-swagger/go-swagger/blob/master/generator/templates/server/parameter.gotmpl#L209) is done it works correctly, sending back a 400 any \"state\" that's not in the enum. But it never gets into this section because it passes the [{{ if .Child }} check](https://github.com/go-swagger/go-swagger/blob/master/generator/templates/server/parameter.gotmpl#L203)\r\n\r\nIn the \"Generated Code\" section below, the Validate method for the `BulkUpdateState` type is created correctly, but never called in `BindRequest`\r\n\r\n## Swagger specification\r\n```\r\nswagger: \"2.0\"\r\ninfo:\r\n  title: Bug? Demo\r\n  description: Description.\r\n  version: \"0.1.0\"\r\nschemes:\r\n  - http\r\nproduces:\r\n  - application/json\r\nconsumes:\r\n  - application/json\r\nresponses:\r\n  200:\r\n    description: OK\r\n    schema:\r\n      type: string\r\n  400:\r\n    description: Bad Request\r\npaths:\r\n  /someResource/:\r\n    patch:\r\n      consumes:\r\n        - application/json\r\n      summary: Update the state of multiple stuff and things at once.\r\n      parameters:\r\n        - in: body\r\n          name: massUpdate\r\n          schema:\r\n            $ref: '#/definitions/BulkUpdateState'\r\n      responses:\r\n        200:\r\n          $ref: '#/responses/200'\r\n        400:\r\n          $ref: '#/responses/400'\r\n      tags:\r\n        - SomeResource\r\ndefinitions:\r\n  BulkUpdateState:\r\n    type: array\r\n    items:\r\n      $ref: '#/definitions/UpdateStateRequest'\r\n  UpdateStateRequest:\r\n    type: object\r\n    required:\r\n      - ID\r\n      - state\r\n    properties:\r\n      ID:\r\n        type: string\r\n        x-nullable: false\r\n      state:\r\n        $ref: '#/definitions/StateEnum'\r\n  UpdateRequest:\r\n    type: object\r\n  StateEnum:\r\n    type: string\r\n    enum:\r\n      - todo\r\n      - done\r\n      - blocked\r\n      - skipped\r\n      - unenrolled\r\n      - custom\r\n```\r\n## Steps to reproduce\r\n- Generate the server based on this swagger.\r\n- Add a handler\r\n- Hit the /someResource route with a patch request, containing JSON array with states other than listed in the enum.\r\n- See that requests make it to the handler.\r\n\r\n## Generated Code\r\n\r\n```\r\n// BulkUpdateState bulk update state\r\n// swagger:model BulkUpdateState\r\ntype BulkUpdateState []*UpdateStateRequest\r\n\r\n// Validate validates this bulk update state\r\nfunc (m BulkUpdateState) Validate(formats strfmt.Registry) error {\r\n\tvar res []error\r\n\r\n\tfor i := 0; i < len(m); i++ {\r\n\r\n\t\tif swag.IsZero(m[i]) { // not required\r\n\t\t\tcontinue\r\n\t\t}\r\n\r\n\t\tif m[i] != nil {\r\n\r\n\t\t\tif err := m[i].Validate(formats); err != nil {\r\n\t\t\t\tif ve, ok := err.(*errors.Validation); ok {\r\n\t\t\t\t\treturn ve.ValidateName(strconv.Itoa(i))\r\n\t\t\t\t}\r\n\t\t\t\treturn err\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tif len(res) > 0 {\r\n\t\treturn errors.CompositeValidationError(res...)\r\n\t}\r\n\treturn nil\r\n}\r\n```\r\n\r\n```\r\n// BindRequest both binds and validates a request, it assumes that complex things implement a Validatable(strfmt.Registry) error interface\r\n// for simple values it will use straight method calls\r\nfunc (o *PatchSomeResourceParams) BindRequest(r *http.Request, route *middleware.MatchedRoute) error {\r\n\tvar res []error\r\n\to.HTTPRequest = r\r\n\r\n\tif runtime.HasBody(r) {\r\n\t\tdefer r.Body.Close()\r\n\t\tvar body models.BulkUpdateState\r\n\t\tif err := route.Consumer.Consume(r.Body, &body); err != nil {\r\n\t\t\tres = append(res, errors.NewParseError(\"massUpdate\", \"body\", \"\", err))\r\n\t\t} else {\r\n\r\n\t\t\tif len(res) == 0 {\r\n\t\t\t\to.MassUpdate = body\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tif len(res) > 0 {\r\n\t\treturn errors.CompositeValidationError(res...)\r\n\t}\r\n\treturn nil\r\n}\r\n```\r\n\r\n## Environment\r\nswagger version: 0.13.0\r\ngo version: 1.9.2\r\nOS:   Mac OS 10.13.2\r\n","closed_by":{"login":"casualjim","id":456109,"node_id":"MDQ6VXNlcjQ1NjEwOQ==","avatar_url":"https://avatars.githubusercontent.com/u/456109?v=4","gravatar_id":"","url":"https://api.github.com/users/casualjim","html_url":"https://github.com/casualjim","followers_url":"https://api.github.com/users/casualjim/followers","following_url":"https://api.github.com/users/casualjim/following{/other_user}","gists_url":"https://api.github.com/users/casualjim/gists{/gist_id}","starred_url":"https://api.github.com/users/casualjim/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/casualjim/subscriptions","organizations_url":"https://api.github.com/users/casualjim/orgs","repos_url":"https://api.github.com/users/casualjim/repos","events_url":"https://api.github.com/users/casualjim/events{/privacy}","received_events_url":"https://api.github.com/users/casualjim/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/go-swagger/go-swagger/issues/1392/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/go-swagger/go-swagger/issues/1392/timeline","performed_via_github_app":null,"state_reason":"completed"}