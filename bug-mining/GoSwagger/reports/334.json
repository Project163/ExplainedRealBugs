{"url":"https://api.github.com/repos/go-swagger/go-swagger/issues/2919","repository_url":"https://api.github.com/repos/go-swagger/go-swagger","labels_url":"https://api.github.com/repos/go-swagger/go-swagger/issues/2919/labels{/name}","comments_url":"https://api.github.com/repos/go-swagger/go-swagger/issues/2919/comments","events_url":"https://api.github.com/repos/go-swagger/go-swagger/issues/2919/events","html_url":"https://github.com/go-swagger/go-swagger/issues/2919","id":1652484423,"node_id":"I_kwDOAZfQX85ifulH","number":2919,"title":"v0.30.4 panics during flatten","user":{"login":"andrewpmartinez","id":199856,"node_id":"MDQ6VXNlcjE5OTg1Ng==","avatar_url":"https://avatars.githubusercontent.com/u/199856?v=4","gravatar_id":"","url":"https://api.github.com/users/andrewpmartinez","html_url":"https://github.com/andrewpmartinez","followers_url":"https://api.github.com/users/andrewpmartinez/followers","following_url":"https://api.github.com/users/andrewpmartinez/following{/other_user}","gists_url":"https://api.github.com/users/andrewpmartinez/gists{/gist_id}","starred_url":"https://api.github.com/users/andrewpmartinez/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/andrewpmartinez/subscriptions","organizations_url":"https://api.github.com/users/andrewpmartinez/orgs","repos_url":"https://api.github.com/users/andrewpmartinez/repos","events_url":"https://api.github.com/users/andrewpmartinez/events{/privacy}","received_events_url":"https://api.github.com/users/andrewpmartinez/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":148436504,"node_id":"MDU6TGFiZWwxNDg0MzY1MDQ=","url":"https://api.github.com/repos/go-swagger/go-swagger/labels/bug","name":"bug","color":"fc2929","default":true,"description":null},{"id":840891559,"node_id":"MDU6TGFiZWw4NDA4OTE1NTk=","url":"https://api.github.com/repos/go-swagger/go-swagger/labels/flatten","name":"flatten","color":"73e296","default":false,"description":"Related to spec flattening"},{"id":975136500,"node_id":"MDU6TGFiZWw5NzUxMzY1MDA=","url":"https://api.github.com/repos/go-swagger/go-swagger/labels/pending%20PR","name":"pending PR","color":"7ff47f","default":false,"description":""}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":2,"created_at":"2023-04-03T17:33:16Z","updated_at":"2023-12-23T11:47:20Z","closed_at":"2023-12-23T11:47:20Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"## Problem statement\r\n\r\nA OAS2.0 spec that flattens multiple files fine in v0.28.0 and v0.29.0, but panics in v0.30.4.\r\n\r\n```\r\n> swagger flatten .\\client.yml -o ..\\client.yml --format yaml\r\n2023/04/03 13:32:27 format =  yaml\r\npanic: runtime error: invalid memory address or nil pointer dereference [recovered]\r\n        panic: runtime error: invalid memory address or nil pointer dereference\r\n[signal 0xc0000005 code=0x0 addr=0x0 pc=0x833f51]\r\n\r\ngoroutine 1 [running]:\r\ngopkg.in/yaml%2ev3.handleErr(0xc0005598d0)\r\n        /home/runner/go/pkg/mod/gopkg.in/yaml.v3@v3.0.1/yaml.go:294 +0x6d\r\npanic({0xd6cbe0, 0x14e4930})\r\n        /opt/hostedtoolcache/go/1.19.5/x64/src/runtime/panic.go:884 +0x212\r\ngopkg.in/yaml%2ev3.(*encoder).node(0xc000c80c00?, 0xc000eebe00?, {0x0?, 0x0?})\r\n        /home/runner/go/pkg/mod/gopkg.in/yaml.v3@v3.0.1/encode.go:434 +0x31\r\ngopkg.in/yaml%2ev3.(*encoder).node(0xc000c80c00, 0xc000eeb4a0, {0x0, 0x0})\r\n        /home/runner/go/pkg/mod/gopkg.in/yaml.v3@v3.0.1/encode.go:526 +0x11e5\r\ngopkg.in/yaml%2ev3.(*encoder).node(0xc000c80c00, 0xc000eeb400, {0x0, 0x0})\r\n        /home/runner/go/pkg/mod/gopkg.in/yaml.v3@v3.0.1/encode.go:526 +0x11e5\r\ngopkg.in/yaml%2ev3.(*encoder).node(0xc000c80c00, 0xc000eeb360, {0x0, 0x0})\r\n        /home/runner/go/pkg/mod/gopkg.in/yaml.v3@v3.0.1/encode.go:526 +0x11e5\r\ngopkg.in/yaml%2ev3.(*encoder).node(0xc000c80c00, 0xc000eeaf00, {0x0, 0x0})\r\n        /home/runner/go/pkg/mod/gopkg.in/yaml.v3@v3.0.1/encode.go:526 +0x11e5\r\ngopkg.in/yaml%2ev3.(*encoder).node(0xc000c80c00, 0xc000ee7400, {0x0, 0x0})\r\n        /home/runner/go/pkg/mod/gopkg.in/yaml.v3@v3.0.1/encode.go:526 +0x11e5\r\ngopkg.in/yaml%2ev3.(*encoder).node(0xc000c80c00, 0xc000ee70e0, {0x0, 0x0})\r\n        /home/runner/go/pkg/mod/gopkg.in/yaml.v3@v3.0.1/encode.go:526 +0x11e5\r\ngopkg.in/yaml%2ev3.(*encoder).node(0xc000c80c00, 0xc00033d4a0, {0x0, 0x0})\r\n        /home/runner/go/pkg/mod/gopkg.in/yaml.v3@v3.0.1/encode.go:526 +0x11e5\r\ngopkg.in/yaml%2ev3.(*encoder).node(0xc000c80c00, 0xc0004e9860, {0x0, 0x0})\r\n        /home/runner/go/pkg/mod/gopkg.in/yaml.v3@v3.0.1/encode.go:526 +0x11e5\r\ngopkg.in/yaml%2ev3.(*encoder).node(0xc000c80c00, 0xc0006f1e00, {0x0, 0x0})\r\n        /home/runner/go/pkg/mod/gopkg.in/yaml.v3@v3.0.1/encode.go:526 +0x11e5\r\ngopkg.in/yaml%2ev3.(*encoder).node(0xc000c80c00, 0xc000402000, {0x0, 0x0})\r\n        /home/runner/go/pkg/mod/gopkg.in/yaml.v3@v3.0.1/encode.go:477 +0x1685\r\ngopkg.in/yaml%2ev3.(*encoder).nodev(0xdcdb40?, {0xdcdb40?, 0xc000402000?, 0x30001?})\r\n        /home/runner/go/pkg/mod/gopkg.in/yaml.v3@v3.0.1/encode.go:429 +0x53\r\ngopkg.in/yaml%2ev3.(*encoder).marshalDoc(0xc000c80c00, {0x0, 0x0}, {0xdcdb40?, 0xc000402000?, 0x0?})\r\n        /home/runner/go/pkg/mod/gopkg.in/yaml.v3@v3.0.1/encode.go:101 +0xc5\r\ngopkg.in/yaml%2ev3.Marshal({0xdcdb40?, 0xc000402000})\r\n        /home/runner/go/pkg/mod/gopkg.in/yaml.v3@v3.0.1/yaml.go:222 +0x389\r\ngithub.com/go-openapi/swag.JSONMapSlice.MarshalYAML({0xc0006b0400, 0xa, 0x1a000?})\r\n        /home/runner/go/pkg/mod/github.com/go-openapi/swag@v0.22.3/yaml.go:245 +0x131\r\ngithub.com/go-swagger/go-swagger/cmd/swagger/commands.writeToFile(0xc000913040?, 0x1, {0xc0001260f0?, 0xc?}, {0xc0001260d0, 0xd})\r\n        /home/runner/work/go-swagger/go-swagger/cmd/swagger/commands/expand.go:65 +0x1ba\r\ngithub.com/go-swagger/go-swagger/cmd/swagger/commands.(*FlattenSpec).Execute(0xc0003fb090, {0xc000188840?, 0xc0003fb090?, 0x6?})\r\n        /home/runner/work/go-swagger/go-swagger/cmd/swagger/commands/flatten.go:47 +0x186\r\ngithub.com/jessevdk/go-flags.(*Parser).ParseArgs(0xc0001f27e0, {0xc000152010, 0x6, 0x7})\r\n        /home/runner/go/pkg/mod/github.com/jessevdk/go-flags@v1.5.0/parser.go:335 +0x8a2\r\ngithub.com/jessevdk/go-flags.(*Parser).Parse(...)\r\n        /home/runner/go/pkg/mod/github.com/jessevdk/go-flags@v1.5.0/parser.go:191\r\nmain.main()\r\n        /home/runner/work/go-swagger/go-swagger/cmd/swagger/swagger.go:140 +0x971\r\n```\r\n\r\n## Swagger specification\r\n\r\nhttps://github.com/openziti/edge-api/tree/main/source contains a `management.yml` and `client.yml` that needs to be flattened. Used to generate `management.yml` and `client.yml` in the directory above.\r\n\r\n## Steps to reproduce\r\n\r\n1) clone https://github.com/openziti/edge-api\r\n2) `git checkout f8a274ee0645c2cd27b29bd838916b7b617a8d6a` (should work on main, but this is the commit I was on when the issue present itself)\r\n3) `cd edge-api/source`\r\n4) `swagger flatten .\\client.yml -o ..\\client.yml --format yaml`\r\n\r\n\r\n## Environment\r\n\r\nWorks:\r\n\r\nversion: v0.28.0\r\ncommit: 48a66e4bdbcde02c8c6c95ff9a08f64fe40b1b50\r\n\r\nWorks:\r\n\r\nversion: v0.29.0\r\ncommit: 09ae1192ca9a941bbb534aca09e6bdc562c95ef3\r\n\r\nPanics:\r\n\r\nversion: v0.30.4\r\ncommit: df6da9b77aa9751f06bedb17fcf92b1ab67a7a47\r\n\r\nOS:   Windows 11 & Ubuntu 20\r\n","closed_by":{"login":"fredbi","id":14262513,"node_id":"MDQ6VXNlcjE0MjYyNTEz","avatar_url":"https://avatars.githubusercontent.com/u/14262513?v=4","gravatar_id":"","url":"https://api.github.com/users/fredbi","html_url":"https://github.com/fredbi","followers_url":"https://api.github.com/users/fredbi/followers","following_url":"https://api.github.com/users/fredbi/following{/other_user}","gists_url":"https://api.github.com/users/fredbi/gists{/gist_id}","starred_url":"https://api.github.com/users/fredbi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/fredbi/subscriptions","organizations_url":"https://api.github.com/users/fredbi/orgs","repos_url":"https://api.github.com/users/fredbi/repos","events_url":"https://api.github.com/users/fredbi/events{/privacy}","received_events_url":"https://api.github.com/users/fredbi/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/go-swagger/go-swagger/issues/2919/reactions","total_count":1,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":1},"timeline_url":"https://api.github.com/repos/go-swagger/go-swagger/issues/2919/timeline","performed_via_github_app":null,"state_reason":"completed"}