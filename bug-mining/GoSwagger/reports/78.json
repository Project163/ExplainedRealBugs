{"url":"https://api.github.com/repos/go-swagger/go-swagger/issues/175","repository_url":"https://api.github.com/repos/go-swagger/go-swagger","labels_url":"https://api.github.com/repos/go-swagger/go-swagger/issues/175/labels{/name}","comments_url":"https://api.github.com/repos/go-swagger/go-swagger/issues/175/comments","events_url":"https://api.github.com/repos/go-swagger/go-swagger/issues/175/events","html_url":"https://github.com/go-swagger/go-swagger/issues/175","id":123379986,"node_id":"MDU6SXNzdWUxMjMzNzk5ODY=","number":175,"title":"Polymorphic/generic subtypes: discriminator getter method, and unmarshal function do not use definition name","user":{"login":"chancez","id":1400401,"node_id":"MDQ6VXNlcjE0MDA0MDE=","avatar_url":"https://avatars.githubusercontent.com/u/1400401?v=4","gravatar_id":"","url":"https://api.github.com/users/chancez","html_url":"https://github.com/chancez","followers_url":"https://api.github.com/users/chancez/followers","following_url":"https://api.github.com/users/chancez/following{/other_user}","gists_url":"https://api.github.com/users/chancez/gists{/gist_id}","starred_url":"https://api.github.com/users/chancez/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/chancez/subscriptions","organizations_url":"https://api.github.com/users/chancez/orgs","repos_url":"https://api.github.com/users/chancez/repos","events_url":"https://api.github.com/users/chancez/events{/privacy}","received_events_url":"https://api.github.com/users/chancez/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":148436504,"node_id":"MDU6TGFiZWwxNDg0MzY1MDQ=","url":"https://api.github.com/repos/go-swagger/go-swagger/labels/bug","name":"bug","color":"fc2929","default":true,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":{"url":"https://api.github.com/repos/go-swagger/go-swagger/milestones/1","html_url":"https://github.com/go-swagger/go-swagger/milestone/1","labels_url":"https://api.github.com/repos/go-swagger/go-swagger/milestones/1/labels","id":1161275,"node_id":"MDk6TWlsZXN0b25lMTE2MTI3NQ==","number":1,"title":"Minimal first release","description":"This first release is focussed on getting a baseline in functionality set.\r\n\r\nIt should however promise API stability to support the entire planned feature set:\r\n\r\nBaseline functionality: \r\n\r\n* validate a spec, including extended validations\r\n* generate a client from a spec\r\n* generate a spec through go code analysis\r\n* generate a server from a spec\r\n\r\nAPI stability:\r\n\r\n* serialization format agnostic\r\n* transport agnostic, this should be a matter of config\r\n* validation for client and server ","creator":{"login":"casualjim","id":456109,"node_id":"MDQ6VXNlcjQ1NjEwOQ==","avatar_url":"https://avatars.githubusercontent.com/u/456109?v=4","gravatar_id":"","url":"https://api.github.com/users/casualjim","html_url":"https://github.com/casualjim","followers_url":"https://api.github.com/users/casualjim/followers","following_url":"https://api.github.com/users/casualjim/following{/other_user}","gists_url":"https://api.github.com/users/casualjim/gists{/gist_id}","starred_url":"https://api.github.com/users/casualjim/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/casualjim/subscriptions","organizations_url":"https://api.github.com/users/casualjim/orgs","repos_url":"https://api.github.com/users/casualjim/repos","events_url":"https://api.github.com/users/casualjim/events{/privacy}","received_events_url":"https://api.github.com/users/casualjim/received_events","type":"User","user_view_type":"public","site_admin":false},"open_issues":0,"closed_issues":61,"state":"closed","created_at":"2015-06-12T03:22:12Z","updated_at":"2016-01-04T02:34:41Z","due_on":"2016-01-10T08:00:00Z","closed_at":"2016-01-04T02:34:41Z"},"comments":0,"created_at":"2015-12-21T23:18:57Z","updated_at":"2015-12-22T08:49:53Z","closed_at":"2015-12-22T08:49:53Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"This is a nice edge case I found when I realized the API I'm using doesn't quite adhere to swagger's discriminator requirements. I adjusted my schema so that it would meet the swagger requirements, but I found that the generated code didn't change when I change the definition's to not have an uppercased first letter (to match what the JSON response gives me).\n\nInstead of using the definition's name to switch on for a discriminator in the generated unmarshal function, it uses the go type name. Unfortunately this means that if a definition starts with a lowercase, and the discriminator values have a lowercased first letter, than unmarshalling the type doesn't work.\n\nGiven the following generic parent type:\n\n```\n    \"PricingComponent\": {\n      \"type\": \"object\",\n      \"required\": [\n        \"@type\"\n      ],\n      \"discriminator\": \"@type\",\n      \"properties\": {\n        \"@type\": {\n          \"type\": \"string\",\n          \"enum\": [\n            \"tieredPricingComponent\",\n            \"flatPricingComponent\",\n            \"tieredVolumePricingComponent\"\n          ]\n        },\n...\n```\n\nThe subtypes are defined like this (note the first letter is not capitalized)\n\n```\n...\n    \"flatPricingComponent\": {\n      \"allOf\": [\n        {\n          \"$ref\": \"#/definitions/PricingComponent\"\n        },\n        {\n          \"type\": \"object\",\n          \"properties\": {}\n        }\n      ]\n    },\n....\n```\n\nThe actual JSON response has the `@type` property set like `\"@type\" : \"flatPricingComponent\",` (note the first letter is not capitalized)\n\nBut the unmarshal code uses the Go type's name to switch off of the discriminator, rather than the swagger definition's value.\n\nThe following is the Unmarshal code, as you can see, it's using `case \"FlatPricingComponent\":` when i should be `case \"flatPricingComponent\":`\n\n```\nfunc UnmarshalPricingComponent(reader io.Reader, consumer httpkit.Consumer) (PricingComponent, error) {\n    // we need to read this twice, so first into a buffer\n    data, err := ioutil.ReadAll(reader)\n    if err != nil {\n        return nil, err\n    }\n    buf := bytes.NewBuffer(data)\n\n    // the first time this is read is to fetch the value of the @type property.\n    var getType struct {\n        Type string `json:\"@type\"`\n    }\n    if err := consumer.Consume(buf, &getType); err != nil {\n        return nil, err\n    }\n\n    if err := validate.RequiredString(\"@type\", \"body\", getType.Type); err != nil {\n        return nil, err\n    }\n\n    // The value of @type is used to determine which type to create and unmarshal the data into\n    switch getType.Type {\n    case \"FlatPricingComponent\":\n        var result FlatPricingComponent\n        if err := consumer.Consume(buf, &result); err != nil {\n            return nil, err\n        }\n        return &result, nil\n\n    case \"TieredPricingComponent\":\n        var result TieredPricingComponent\n        if err := consumer.Consume(buf, &result); err != nil {\n            return nil, err\n        }\n        return &result, nil\n\n    case \"TieredVolumePricingComponent\":\n        var result TieredVolumePricingComponent\n        if err := consumer.Consume(buf, &result); err != nil {\n            return nil, err\n        }\n        return &result, nil\n\n    }\n    return nil, errors.New(422, \"invalid @type value: %q\", getType.Type)\n\n}\n```\n","closed_by":{"login":"casualjim","id":456109,"node_id":"MDQ6VXNlcjQ1NjEwOQ==","avatar_url":"https://avatars.githubusercontent.com/u/456109?v=4","gravatar_id":"","url":"https://api.github.com/users/casualjim","html_url":"https://github.com/casualjim","followers_url":"https://api.github.com/users/casualjim/followers","following_url":"https://api.github.com/users/casualjim/following{/other_user}","gists_url":"https://api.github.com/users/casualjim/gists{/gist_id}","starred_url":"https://api.github.com/users/casualjim/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/casualjim/subscriptions","organizations_url":"https://api.github.com/users/casualjim/orgs","repos_url":"https://api.github.com/users/casualjim/repos","events_url":"https://api.github.com/users/casualjim/events{/privacy}","received_events_url":"https://api.github.com/users/casualjim/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/go-swagger/go-swagger/issues/175/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/go-swagger/go-swagger/issues/175/timeline","performed_via_github_app":null,"state_reason":"completed"}