{"url":"https://api.github.com/repos/go-swagger/go-swagger/issues/2657","repository_url":"https://api.github.com/repos/go-swagger/go-swagger","labels_url":"https://api.github.com/repos/go-swagger/go-swagger/issues/2657/labels{/name}","comments_url":"https://api.github.com/repos/go-swagger/go-swagger/issues/2657/comments","events_url":"https://api.github.com/repos/go-swagger/go-swagger/issues/2657/events","html_url":"https://github.com/go-swagger/go-swagger/issues/2657","id":1037871448,"node_id":"I_kwDOAZfQX8493KlY","number":2657,"title":"`remove-unused` does not remove all unused definitions","user":{"login":"said-saifi","id":65585157,"node_id":"MDQ6VXNlcjY1NTg1MTU3","avatar_url":"https://avatars.githubusercontent.com/u/65585157?v=4","gravatar_id":"","url":"https://api.github.com/users/said-saifi","html_url":"https://github.com/said-saifi","followers_url":"https://api.github.com/users/said-saifi/followers","following_url":"https://api.github.com/users/said-saifi/following{/other_user}","gists_url":"https://api.github.com/users/said-saifi/gists{/gist_id}","starred_url":"https://api.github.com/users/said-saifi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/said-saifi/subscriptions","organizations_url":"https://api.github.com/users/said-saifi/orgs","repos_url":"https://api.github.com/users/said-saifi/repos","events_url":"https://api.github.com/users/said-saifi/events{/privacy}","received_events_url":"https://api.github.com/users/said-saifi/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":148436504,"node_id":"MDU6TGFiZWwxNDg0MzY1MDQ=","url":"https://api.github.com/repos/go-swagger/go-swagger/labels/bug","name":"bug","color":"fc2929","default":true,"description":null},{"id":840891559,"node_id":"MDU6TGFiZWw4NDA4OTE1NTk=","url":"https://api.github.com/repos/go-swagger/go-swagger/labels/flatten","name":"flatten","color":"73e296","default":false,"description":"Related to spec flattening"},{"id":975136500,"node_id":"MDU6TGFiZWw5NzUxMzY1MDA=","url":"https://api.github.com/repos/go-swagger/go-swagger/labels/pending%20PR","name":"pending PR","color":"7ff47f","default":false,"description":""}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":1,"created_at":"2021-10-27T21:18:54Z","updated_at":"2023-12-27T23:53:46Z","closed_at":"2023-12-27T23:53:46Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"## Problem statement\r\n\r\n`swagger flatten --with-flatten=remove-unused` does not remove models that were only referenced by models that were just removed.\r\n\r\nThat is, if I have model `Book` which uses model `Author`, if both of them are not used, and I run `swagger flatten --with-flatten=remove-unused` then it will only remove `Book` model, but will keep `Author` as it was considered as used, but it's not really used anymore.\r\n\r\n## Steps to reproduce\r\n1. Let's say you have this simple schema.json\r\n\r\n```json\r\n{\r\n  \"consumes\": [\r\n    \"application/json\"\r\n  ],\r\n  \"produces\": [\r\n    \"application/json\"\r\n  ],\r\n  \"schemes\": [\r\n    \"http\",\r\n    \"https\"\r\n  ],\r\n  \"swagger\": \"2.0\",\r\n  \"info\": {\r\n    \"title\": \"Sample API.\",\r\n    \"version\": \"1.0.0\"\r\n  },\r\n  \"paths\": {\r\n    \"/hello\": {\r\n      \"get\": {\r\n        \"description\": \"Hello\",\r\n        \"operationId\": \"hello\",\r\n        \"responses\": {\r\n          \"200\": {\r\n            \"description\": \"success\"\r\n          }\r\n        }\r\n      }\r\n    }\r\n  },\r\n  \"definitions\": {\r\n    \"Author\": {\r\n      \"type\": \"object\",\r\n      \"properties\": {\r\n        \"name\": {\r\n          \"type\": \"string\"\r\n        }\r\n      }\r\n    },\r\n    \"Book\": {\r\n      \"type\": \"object\",\r\n      \"properties\": {\r\n        \"author\": {\r\n          \"$ref\": \"#/definitions/Author\"\r\n        }\r\n      }\r\n    }\r\n  }\r\n}\r\n```\r\nas you can see `Author` and `Book` are not referenced by any route, however `Book` references `Author`. \r\n\r\n2. run `swagger flatten --with-flatten=remove-unused -o=schema.json schema.json`\r\nThe update `schema.json` does not have `Book` anymore as expected, but still has the `Author`, which is not really being used as well. So `Author` should have been removed as well but it was not.\r\n\r\n## Temporary Solution\r\nYou can run `swagger flatten --with-flatten=remove-unused -o=schema.json schema.json` one more time and `Author` will be removed, but ideally this tool should be able to remove all unused definitions in one single execution.\r\n\r\n\r\n## Environment\r\nswagger version: 0.26.1  \r\ngo version: 1.17\r\nOS:  macOS  \r\n","closed_by":{"login":"fredbi","id":14262513,"node_id":"MDQ6VXNlcjE0MjYyNTEz","avatar_url":"https://avatars.githubusercontent.com/u/14262513?v=4","gravatar_id":"","url":"https://api.github.com/users/fredbi","html_url":"https://github.com/fredbi","followers_url":"https://api.github.com/users/fredbi/followers","following_url":"https://api.github.com/users/fredbi/following{/other_user}","gists_url":"https://api.github.com/users/fredbi/gists{/gist_id}","starred_url":"https://api.github.com/users/fredbi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/fredbi/subscriptions","organizations_url":"https://api.github.com/users/fredbi/orgs","repos_url":"https://api.github.com/users/fredbi/repos","events_url":"https://api.github.com/users/fredbi/events{/privacy}","received_events_url":"https://api.github.com/users/fredbi/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/go-swagger/go-swagger/issues/2657/reactions","total_count":3,"+1":3,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/go-swagger/go-swagger/issues/2657/timeline","performed_via_github_app":null,"state_reason":"completed"}