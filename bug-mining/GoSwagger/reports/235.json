{"url":"https://api.github.com/repos/go-swagger/go-swagger/issues/1755","repository_url":"https://api.github.com/repos/go-swagger/go-swagger","labels_url":"https://api.github.com/repos/go-swagger/go-swagger/issues/1755/labels{/name}","comments_url":"https://api.github.com/repos/go-swagger/go-swagger/issues/1755/comments","events_url":"https://api.github.com/repos/go-swagger/go-swagger/issues/1755/events","html_url":"https://github.com/go-swagger/go-swagger/issues/1755","id":369493183,"node_id":"MDU6SXNzdWUzNjk0OTMxODM=","number":1755,"title":"go-swagger generate server: minItems (maxItems) on array fails during validation. ","user":{"login":"Equanox","id":3776893,"node_id":"MDQ6VXNlcjM3NzY4OTM=","avatar_url":"https://avatars.githubusercontent.com/u/3776893?v=4","gravatar_id":"","url":"https://api.github.com/users/Equanox","html_url":"https://github.com/Equanox","followers_url":"https://api.github.com/users/Equanox/followers","following_url":"https://api.github.com/users/Equanox/following{/other_user}","gists_url":"https://api.github.com/users/Equanox/gists{/gist_id}","starred_url":"https://api.github.com/users/Equanox/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Equanox/subscriptions","organizations_url":"https://api.github.com/users/Equanox/orgs","repos_url":"https://api.github.com/users/Equanox/repos","events_url":"https://api.github.com/users/Equanox/events{/privacy}","received_events_url":"https://api.github.com/users/Equanox/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":148436504,"node_id":"MDU6TGFiZWwxNDg0MzY1MDQ=","url":"https://api.github.com/repos/go-swagger/go-swagger/labels/bug","name":"bug","color":"fc2929","default":true,"description":null},{"id":784279907,"node_id":"MDU6TGFiZWw3ODQyNzk5MDc=","url":"https://api.github.com/repos/go-swagger/go-swagger/labels/model","name":"model","color":"cce878","default":false,"description":"Related to swagger generate model command"},{"id":975136500,"node_id":"MDU6TGFiZWw5NzUxMzY1MDA=","url":"https://api.github.com/repos/go-swagger/go-swagger/labels/pending%20PR","name":"pending PR","color":"7ff47f","default":false,"description":""}],"state":"closed","locked":false,"assignee":{"login":"fredbi","id":14262513,"node_id":"MDQ6VXNlcjE0MjYyNTEz","avatar_url":"https://avatars.githubusercontent.com/u/14262513?v=4","gravatar_id":"","url":"https://api.github.com/users/fredbi","html_url":"https://github.com/fredbi","followers_url":"https://api.github.com/users/fredbi/followers","following_url":"https://api.github.com/users/fredbi/following{/other_user}","gists_url":"https://api.github.com/users/fredbi/gists{/gist_id}","starred_url":"https://api.github.com/users/fredbi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/fredbi/subscriptions","organizations_url":"https://api.github.com/users/fredbi/orgs","repos_url":"https://api.github.com/users/fredbi/repos","events_url":"https://api.github.com/users/fredbi/events{/privacy}","received_events_url":"https://api.github.com/users/fredbi/received_events","type":"User","user_view_type":"public","site_admin":false},"assignees":[{"login":"fredbi","id":14262513,"node_id":"MDQ6VXNlcjE0MjYyNTEz","avatar_url":"https://avatars.githubusercontent.com/u/14262513?v=4","gravatar_id":"","url":"https://api.github.com/users/fredbi","html_url":"https://github.com/fredbi","followers_url":"https://api.github.com/users/fredbi/followers","following_url":"https://api.github.com/users/fredbi/following{/other_user}","gists_url":"https://api.github.com/users/fredbi/gists{/gist_id}","starred_url":"https://api.github.com/users/fredbi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/fredbi/subscriptions","organizations_url":"https://api.github.com/users/fredbi/orgs","repos_url":"https://api.github.com/users/fredbi/repos","events_url":"https://api.github.com/users/fredbi/events{/privacy}","received_events_url":"https://api.github.com/users/fredbi/received_events","type":"User","user_view_type":"public","site_admin":false}],"milestone":null,"comments":1,"created_at":"2018-10-12T10:29:10Z","updated_at":"2018-11-30T09:29:13Z","closed_at":"2018-11-17T18:00:46Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"## Problem statement\r\nWhen using _minItems_ on a array the validation always fails. This should also be true for _maxItems_.\r\n\r\n## Problem solution\r\nI could verify that there is a error in the generated code.\r\nUse the swagger spec below to generate a server model:\r\nIn _restapi/operations/assets/register_asset_parameters.go_ the generated code (in func BindRequest) looks something like this\r\n```golang\r\n 1: var body []*models.AssetProperties\r\n 2: if err := route.Consumer.Consume(r.Body, &body); err != nil {\r\n 3:     // .......\r\n 4: } else {\r\n 5:\tassetPropertiesSize := int64(len(o.AssetProperties)) //!!!This is Wrong!!!\r\n 6:\r\n 7:\t// minItems: 1\r\n 8:\tif err := validate.MinItems(\"assetProperties\", \"body\", assetPropertiesSize, 1); err != nil {\r\n 9:\t\treturn err\r\n10:\t}\r\n11:       \r\n12:        //... etc. ///\r\n13:\tif len(res) == 0 {\r\n14:\t\to.AssetProperties = body\r\n15:\t}\r\n16:}\r\n```\r\n**Problem**: ` o.assetProperties` in _Line 5:_ is always a empty slice at this point in time.    \r\n\r\nThe line  `assetPropertiesSize := int64(len(o.AssetProperties))` must change to `assetPropertiesSize := int64(len(body))`. \r\n\r\nI could narrow the source of the error down to this position https://github.com/go-swagger/go-swagger/blob/bd1430eff0dbcb141837b6f411cd6dcfeb192892/generator/templates/server/parameter.gotmpl#L113 .\r\n\r\nI think someone with more experience in templates than me can fix this fairly easy.\r\n\r\n## Swagger specification\r\n```\r\nswagger: \"2.0\"\r\ninfo:\r\n  title: Example\r\n  version: 0.1.0\r\npaths:\r\n  /assets:\r\n    post:\r\n      description: >-\r\n        Create a new ressource\r\n      operationId: registerAsset\r\n      tags:\r\n        - Assets\r\n      consumes:\r\n        - application/json\r\n      produces:\r\n        - application/json\r\n      parameters:\r\n        - in: body\r\n          description: New Asset\r\n          required: true\r\n          name: assetProperties\r\n          schema:\r\n            type: array\r\n            items:\r\n              $ref: '#/definitions/AssetProperties'\r\n            minItems: 1\r\n      responses:\r\n        '201':\r\n          description: Asset successfully created.\r\ndefinitions:\r\n  AssetProperties:\r\n      type: object\r\n      properties:\r\n        name:\r\n          type: string\r\n          description: Name of Asset\r\n```\r\n\r\n## Steps to reproduce\r\n```\r\ngo-swagger generate server (... with given swagger spec)\r\n```\r\nThen see _restapi/operations/assets/register_asset_parameterts.go_\r\n\r\n## Environment\r\nswagger version: 2.0.0  \r\ngo version: 1.11  \r\nOS:   Ubuntu 16.04\r\n","closed_by":{"login":"fredbi","id":14262513,"node_id":"MDQ6VXNlcjE0MjYyNTEz","avatar_url":"https://avatars.githubusercontent.com/u/14262513?v=4","gravatar_id":"","url":"https://api.github.com/users/fredbi","html_url":"https://github.com/fredbi","followers_url":"https://api.github.com/users/fredbi/followers","following_url":"https://api.github.com/users/fredbi/following{/other_user}","gists_url":"https://api.github.com/users/fredbi/gists{/gist_id}","starred_url":"https://api.github.com/users/fredbi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/fredbi/subscriptions","organizations_url":"https://api.github.com/users/fredbi/orgs","repos_url":"https://api.github.com/users/fredbi/repos","events_url":"https://api.github.com/users/fredbi/events{/privacy}","received_events_url":"https://api.github.com/users/fredbi/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/go-swagger/go-swagger/issues/1755/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/go-swagger/go-swagger/issues/1755/timeline","performed_via_github_app":null,"state_reason":"completed"}