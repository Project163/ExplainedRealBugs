diff --git a/cmd/swagger/commands/diff.go b/cmd/swagger/commands/diff.go
index 509d673d..745d5ca4 100644
--- a/cmd/swagger/commands/diff.go
+++ b/cmd/swagger/commands/diff.go
@@ -2,11 +2,14 @@ package commands
 
 import (
 	"encoding/json"
-	"errors"
+	"fmt"
+	"io"
 	"io/ioutil"
 	"log"
 	"os"
 
+	"errors"
+
 	"github.com/go-openapi/loads"
 	"github.com/go-swagger/go-swagger/cmd/swagger/commands/diff"
 )
@@ -22,32 +25,46 @@ type DiffCommand struct {
 	Format              string `long:"format" short:"f" description:"When present, writes output as json" default:"txt" choice:"txt" choice:"json"`
 	IgnoreFile          string `long:"ignore" short:"i" description:"Exception file of diffs to ignore (copy output from json diff format)"  default:"none specified"`
 	Destination         string `long:"dest" short:"d" description:"Output destination file or stdout" default:"stdout"`
+	Args                struct {
+		OldSpec string `positional-arg-name:"{old spec}"`
+		NewSpec string `positional-arg-name:"{new spec}"`
+	} `required:"2" positional-args:"specs" description:"Input specs to be diff-ed"`
 }
 
 // Execute diffs the two specs provided
-func (c *DiffCommand) Execute(args []string) error {
-	if len(args) != 2 {
-		msg := `missing arguments for diff command (use --help for more info)`
-		return errors.New(msg)
+func (c *DiffCommand) Execute(_ []string) error {
+	if c.Args.OldSpec == "" || c.Args.NewSpec == "" {
+		return errors.New(`missing arguments for diff command (use --help for more info)`)
 	}
 
-	log.Println("Run Config:")
-	log.Printf("Spec1: %s", args[0])
-	log.Printf("Spec2: %s", args[1])
-	log.Printf("ReportOnlyBreakingChanges (-c) :%v", c.OnlyBreakingChanges)
-	log.Printf("OutputFormat (-f) :%s", c.Format)
-	log.Printf("IgnoreFile (-i) :%s", c.IgnoreFile)
-	log.Printf("Diff Report Destination (-d) :%s", c.Destination)
+	c.printInfo()
 
-	diffs, err := getDiffs(args[0], args[1])
+	var (
+		output io.WriteCloser
+		err    error
+	)
+	if c.Destination != "" {
+		output, err = os.OpenFile(c.Destination, os.O_CREATE|os.O_TRUNC|os.O_WRONLY, 0600)
+		if err != nil {
+			return fmt.Errorf("%s: %w", c.Destination, err)
+		}
+		defer func() {
+			_ = output.Close()
+		}()
+	} else {
+		output = os.Stdout
+	}
+
+	diffs, err := c.getDiffs()
 	if err != nil {
 		return err
 	}
 
-	ignores, err := readIgnores(c.IgnoreFile)
+	ignores, err := c.readIgnores()
 	if err != nil {
 		return err
 	}
+
 	diffs = diffs.FilterIgnores(ignores)
 	if len(ignores) > 0 {
 		log.Printf("Diff Report Ignored Items from IgnoreFile")
@@ -56,42 +73,44 @@ func (c *DiffCommand) Execute(args []string) error {
 		}
 	}
 
-	if c.Format == JSONFormat {
-		err = diffs.ReportAllDiffs(true)
-		if err != nil {
-			return err
-		}
+	var (
+		input io.Reader
+		warn  error
+	)
+	if c.Format != JSONFormat && c.OnlyBreakingChanges {
+		input, err, warn = diffs.ReportCompatibility()
 	} else {
-		if c.OnlyBreakingChanges {
-			err = diffs.ReportCompatibility()
-		} else {
-			err = diffs.ReportAllDiffs(false)
-		}
+		input, err, warn = diffs.ReportAllDiffs(c.Format == JSONFormat)
 	}
-	return err
+	if err != nil {
+		return err
+	}
+	_, err = io.Copy(output, input)
+	if err != nil {
+		return err
+	}
+	return warn
 }
 
-func readIgnores(ignoreFile string) (diff.SpecDifferences, error) {
+func (c *DiffCommand) readIgnores() (diff.SpecDifferences, error) {
+	ignoreFile := c.IgnoreFile
 	ignoreDiffs := diff.SpecDifferences{}
 
-	if ignoreFile == "none specified" {
+	if ignoreFile == "none specified" || ignoreFile == "" {
 		return ignoreDiffs, nil
 	}
 	// Open our jsonFile
 	jsonFile, err := os.Open(ignoreFile)
-	// if we os.Open returns an error then handle it
 	if err != nil {
-		return nil, err
+		return nil, fmt.Errorf("%s: %w", ignoreFile, err)
 	}
-	// defer the closing of our jsonFile so that we can parse it later on
 	defer func() {
 		_ = jsonFile.Close()
 	}()
 	byteValue, err := ioutil.ReadAll(jsonFile)
 	if err != nil {
-		return nil, err
+		return nil, fmt.Errorf("reading %s: %w", ignoreFile, err)
 	}
-	// def
 	err = json.Unmarshal(byteValue, &ignoreDiffs)
 	if err != nil {
 		return nil, err
@@ -99,10 +118,10 @@ func readIgnores(ignoreFile string) (diff.SpecDifferences, error) {
 	return ignoreDiffs, nil
 }
 
-func getDiffs(oldSpecPath, newSpecPath string) (diff.SpecDifferences, error) {
+func (c *DiffCommand) getDiffs() (diff.SpecDifferences, error) {
+	oldSpecPath, newSpecPath := c.Args.OldSpec, c.Args.NewSpec
 	swaggerDoc1 := oldSpecPath
 	specDoc1, err := loads.Spec(swaggerDoc1)
-
 	if err != nil {
 		return nil, err
 	}
@@ -115,3 +134,13 @@ func getDiffs(oldSpecPath, newSpecPath string) (diff.SpecDifferences, error) {
 
 	return diff.Compare(specDoc1.Spec(), specDoc2.Spec())
 }
+
+func (c *DiffCommand) printInfo() {
+	log.Println("Run Config:")
+	log.Printf("Spec1: %s", c.Args.OldSpec)
+	log.Printf("Spec2: %s", c.Args.NewSpec)
+	log.Printf("ReportOnlyBreakingChanges (-c) :%v", c.OnlyBreakingChanges)
+	log.Printf("OutputFormat (-f) :%s", c.Format)
+	log.Printf("IgnoreFile (-i) :%s", c.IgnoreFile)
+	log.Printf("Diff Report Destination (-d) :%s", c.Destination)
+}
diff --git a/cmd/swagger/commands/diff/array_diff.go b/cmd/swagger/commands/diff/array_diff.go
index a979cca7..6e2fef3b 100644
--- a/cmd/swagger/commands/diff/array_diff.go
+++ b/cmd/swagger/commands/diff/array_diff.go
@@ -2,22 +2,29 @@ package diff
 
 // This is a simple DSL for diffing arrays
 
-// FromArrayStruct utility struct to encompass diffing of string arrays
-type FromArrayStruct struct {
+// fromArrayStruct utility struct to encompass diffing of string arrays
+type fromArrayStruct struct {
 	from []string
 }
 
-// FromStringArray starts a fluent diff expression
-func FromStringArray(from []string) FromArrayStruct {
-	return FromArrayStruct{from}
+// fromStringArray starts a fluent diff expression
+func fromStringArray(from []string) fromArrayStruct {
+	return fromArrayStruct{from}
 }
 
-// DiffsTo completes a fluent dff expression
-func (f FromArrayStruct) DiffsTo(toArray []string) (added, deleted, common []string) {
+// DiffsTo completes a fluent diff expression
+func (f fromArrayStruct) DiffsTo(toArray []string) (added, deleted, common []string) {
 	inFrom := 1
 	inTo := 2
 
-	m := make(map[string]int)
+	if f.from == nil {
+		return toArray, []string{}, []string{}
+	}
+
+	m := make(map[string]int, len(toArray))
+	added = make([]string, 0, len(toArray))
+	deleted = make([]string, 0, len(f.from))
+	common = make([]string, 0, len(f.from))
 
 	for _, item := range f.from {
 		m[item] = inFrom
@@ -43,14 +50,14 @@ func (f FromArrayStruct) DiffsTo(toArray []string) (added, deleted, common []str
 	return
 }
 
-// FromMapStruct utility struct to encompass diffing of string arrays
-type FromMapStruct struct {
+// fromMapStruct utility struct to encompass diffing of string arrays
+type fromMapStruct struct {
 	srcMap map[string]interface{}
 }
 
-// FromStringMap starts a comparison by declaring a source map
-func FromStringMap(srcMap map[string]interface{}) FromMapStruct {
-	return FromMapStruct{srcMap}
+// fromStringMap starts a comparison by declaring a source map
+func fromStringMap(srcMap map[string]interface{}) fromMapStruct {
+	return fromMapStruct{srcMap}
 }
 
 // Pair stores a pair of items which share a key in two maps
@@ -60,7 +67,7 @@ type Pair struct {
 }
 
 // DiffsTo - generates diffs for a comparison
-func (f FromMapStruct) DiffsTo(destMap map[string]interface{}) (added, deleted, common map[string]interface{}) {
+func (f fromMapStruct) DiffsTo(destMap map[string]interface{}) (added, deleted, common map[string]interface{}) {
 	added = make(map[string]interface{})
 	deleted = make(map[string]interface{})
 	common = make(map[string]interface{})
diff --git a/cmd/swagger/commands/diff/array_diff_test.go b/cmd/swagger/commands/diff/array_diff_test.go
index 1ce2f4ac..cdd1c86e 100644
--- a/cmd/swagger/commands/diff/array_diff_test.go
+++ b/cmd/swagger/commands/diff/array_diff_test.go
@@ -1,101 +1,38 @@
 package diff
 
 import (
-	"fmt"
 	"testing"
 
-	"github.com/corbym/gocrest"
-	"github.com/corbym/gocrest/then"
+	"github.com/stretchr/testify/require"
 )
 
-var assertThat = then.AssertThat
-
 func TestArrayDiff(t *testing.T) {
 	listA := []string{"abc", "def", "ghi", "jkl"}
-	added, deleted, common := FromStringArray(listA).
-		DiffsTo(listA)
-	assertThat(t, added, isListWithItems([]string{}))
-	assertThat(t, deleted, isListWithItems([]string{}))
-	assertThat(t, common, isListWithItems(listA))
+	added, deleted, common := fromStringArray(listA).DiffsTo(listA)
+	require.Equal(t, []string{}, added)
+	require.Equal(t, []string{}, deleted)
+	require.ElementsMatch(t, listA, common)
 
 	listB := []string{"abc", "ghi", "jkl", "xyz", "fgh"}
-	added, deleted, common = FromStringArray(listA).
-		DiffsTo(listB)
-	assertThat(t, added, isListWithItems([]string{"xyz", "fgh"}))
-	assertThat(t, deleted, isListWithItems([]string{"def"}))
-	assertThat(t, common, isListWithItems([]string{"abc", "ghi", "jkl"}))
-
+	added, deleted, common = fromStringArray(listA).DiffsTo(listB)
+	require.ElementsMatch(t, []string{"xyz", "fgh"}, added)
+	require.ElementsMatch(t, []string{"def"}, deleted)
+	require.ElementsMatch(t, []string{"abc", "ghi", "jkl"}, common)
 }
+
 func TestMapDiff(t *testing.T) {
 	mapA := map[string]interface{}{"abc": 1, "def": 2, "ghi": 3, "jkl": 4}
-	added, deleted, common := FromStringMap(mapA).
-		DiffsTo(mapA)
-	assertThat(t, added, isMapWithItems(map[string]interface{}{}))
-	assertThat(t, deleted, isMapWithItems(map[string]interface{}{}))
-	commonDiffs := map[string]interface{}{"abc": Pair{1, 1}, "def": Pair{2, 2}, "ghi": Pair{3, 3}, "jkl": Pair{4, 4}}
+	added, deleted, common := fromStringMap(mapA).DiffsTo(mapA)
+	require.Equal(t, map[string]interface{}{}, added)
+	require.Equal(t, map[string]interface{}{}, deleted)
 
-	assertThat(t, common, isMapWithItems(commonDiffs))
+	commonDiffs := map[string]interface{}{"abc": Pair{1, 1}, "def": Pair{2, 2}, "ghi": Pair{3, 3}, "jkl": Pair{4, 4}}
+	require.Equal(t, commonDiffs, common)
 
 	mapB := map[string]interface{}{"abc": 2, "ghi": 3, "jkl": 4, "xyz": 5, "fgh": 6}
-	added, deleted, common = FromStringMap(mapA).
-		DiffsTo(mapB)
-	assertThat(t, added, isMapWithItems(map[string]interface{}{"xyz": 5, "fgh": 6}))
-	assertThat(t, deleted, isMapWithItems(map[string]interface{}{"def": 2}))
+	added, deleted, common = fromStringMap(mapA).DiffsTo(mapB)
+	require.Equal(t, map[string]interface{}{"xyz": 5, "fgh": 6}, added)
+	require.Equal(t, map[string]interface{}{"def": 2}, deleted)
 	commonDiffs = map[string]interface{}{"abc": Pair{1, 2}, "ghi": Pair{3, 3}, "jkl": Pair{4, 4}}
-	assertThat(t, common, isMapWithItems(commonDiffs))
-
-}
-
-func isListWithItems(other []string) *gocrest.Matcher {
-	matcher := new(gocrest.Matcher)
-	matcher.Describe = fmt.Sprintf("list with items:%v", other)
-	matcher.Matches = func(actual interface{}) bool {
-		if actual == nil {
-			return other == nil
-		}
-		if actualValue, ok := actual.([]string); ok {
-			if len(actualValue) == 0 {
-				return len(other) == 0
-			}
-			leftToMatch := len(actualValue)
-			for _, actualItem := range actualValue {
-				for _, otherItem := range other {
-					if actualItem == otherItem {
-						leftToMatch--
-						break
-					}
-				}
-			}
-			return leftToMatch == 0
-		}
-		return false
-	}
-	return matcher
-}
-
-func isMapWithItems(other map[string]interface{}) *gocrest.Matcher {
-	matcher := new(gocrest.Matcher)
-	matcher.Describe = fmt.Sprintf("map with items:%v", other)
-	matcher.Matches = func(actual interface{}) bool {
-		if actual == nil {
-			return other == nil
-		}
-		if actualValue, ok := actual.(map[string]interface{}); ok {
-			if len(actualValue) == 0 {
-				return len(other) == 0
-			}
-			leftToMatch := len(actualValue)
-			for keyActual, actualItem := range actualValue {
-				for keyOther, otherItem := range other {
-					if actualItem == otherItem && keyActual == keyOther {
-						leftToMatch--
-						break
-					}
-				}
-			}
-			return leftToMatch == 0
-		}
-		return false
-	}
-	return matcher
+	require.Equal(t, commonDiffs, common)
 }
diff --git a/cmd/swagger/commands/diff/difftypes.go b/cmd/swagger/commands/diff/difftypes.go
index 34f7a31b..32225075 100644
--- a/cmd/swagger/commands/diff/difftypes.go
+++ b/cmd/swagger/commands/diff/difftypes.go
@@ -4,6 +4,7 @@ import (
 	"bytes"
 	"encoding/json"
 	"fmt"
+	"log"
 )
 
 // SpecChangeCode enumerates the various types of diffs from one spec to another
@@ -175,18 +176,18 @@ var toStringSpecChangeCode = map[SpecChangeCode]string{
 var toIDSpecChangeCode = map[string]SpecChangeCode{}
 
 // Description returns an english version of this error
-func (s *SpecChangeCode) Description() (result string) {
-	result, ok := toLongStringSpecChangeCode[*s]
+func (s SpecChangeCode) Description() (result string) {
+	result, ok := toLongStringSpecChangeCode[s]
 	if !ok {
-		fmt.Printf("WARNING: No description for %v", *s)
+		log.Printf("warning: No description for %v", s)
 		result = "UNDEFINED"
 	}
 	return
 }
 
 // MarshalJSON marshals the enum as a quoted json string
-func (s *SpecChangeCode) MarshalJSON() ([]byte, error) {
-	return stringAsQuotedBytes(toStringSpecChangeCode[*s])
+func (s SpecChangeCode) MarshalJSON() ([]byte, error) {
+	return stringAsQuotedBytes(toStringSpecChangeCode[s])
 }
 
 // UnmarshalJSON unmashalls a quoted json string to the enum value
@@ -228,8 +229,8 @@ var toStringCompatibility = map[Compatibility]string{
 var toIDCompatibility = map[string]Compatibility{}
 
 // MarshalJSON marshals the enum as a quoted json string
-func (s *Compatibility) MarshalJSON() ([]byte, error) {
-	return stringAsQuotedBytes(toStringCompatibility[*s])
+func (s Compatibility) MarshalJSON() ([]byte, error) {
+	return stringAsQuotedBytes(toStringCompatibility[s])
 }
 
 // UnmarshalJSON unmashals a quoted json string to the enum value
diff --git a/cmd/swagger/commands/diff/difftypes_test.go b/cmd/swagger/commands/diff/difftypes_test.go
new file mode 100644
index 00000000..e91e65de
--- /dev/null
+++ b/cmd/swagger/commands/diff/difftypes_test.go
@@ -0,0 +1,73 @@
+package diff
+
+import (
+	"encoding/json"
+	"io/ioutil"
+	"log"
+	"os"
+	"testing"
+
+	"github.com/stretchr/testify/assert"
+	"github.com/stretchr/testify/require"
+)
+
+func TestSpecChangeCode(t *testing.T) {
+	log.SetOutput(ioutil.Discard)
+	defer func() {
+		log.SetOutput(os.Stdout)
+	}()
+
+	c := NoChangeDetected
+	assert.Equal(t, toLongStringSpecChangeCode[NoChangeDetected], c.Description())
+	assert.Equal(t, "UNDEFINED", SpecChangeCode(9999999999999).Description())
+
+	res, err := json.Marshal(c)
+	require.NoError(t, err)
+	assert.JSONEq(t, `"NoChangeDetected"`, string(res))
+
+	var d SpecChangeCode
+	in := []byte(`"NoChangeDetected"`)
+	err = json.Unmarshal(in, &d)
+	require.NoError(t, err)
+	assert.Equal(t, NoChangeDetected, d)
+
+	in = []byte(`"dummy"`) // invalid enum
+	err = json.Unmarshal(in, &d)
+	assert.Error(t, err)
+	assert.Contains(t, err.Error(), "unknown enum value")
+
+	in = []byte(`{"dummy"`) // invalid json
+	err = json.Unmarshal(in, &d)
+	assert.Error(t, err)
+	assert.Contains(t, err.Error(), "JSON")
+}
+
+func TestCompatibiliyCode(t *testing.T) {
+	log.SetOutput(ioutil.Discard)
+	defer func() {
+		log.SetOutput(os.Stdout)
+	}()
+
+	c := Breaking
+	assert.Equal(t, toStringCompatibility[Breaking], c.String())
+
+	res, err := json.Marshal(c)
+	require.NoError(t, err)
+	assert.JSONEq(t, `"Breaking"`, string(res))
+
+	var d Compatibility
+	in := []byte(`"Breaking"`)
+	err = json.Unmarshal(in, &d)
+	require.NoError(t, err)
+	assert.Equal(t, Breaking, d)
+
+	in = []byte(`"dummy"`) // invalid enum
+	err = json.Unmarshal(in, &d)
+	assert.Error(t, err)
+	assert.Contains(t, err.Error(), "unknown enum value")
+
+	in = []byte(`{"dummy"`) // invalid json
+	err = json.Unmarshal(in, &d)
+	assert.Error(t, err)
+	assert.Contains(t, err.Error(), "JSON")
+}
diff --git a/cmd/swagger/commands/diff/reporting.go b/cmd/swagger/commands/diff/reporting.go
index cf7687bb..020660f7 100644
--- a/cmd/swagger/commands/diff/reporting.go
+++ b/cmd/swagger/commands/diff/reporting.go
@@ -4,6 +4,7 @@ import (
 	"bytes"
 	"encoding/json"
 	"fmt"
+	"io"
 	"net/url"
 	"strings"
 
@@ -153,10 +154,10 @@ var numberWideness = map[string]int{
 	"integer.int32": 0,
 }
 
-func prettyprint(b []byte) ([]byte, error) {
+func prettyprint(b []byte) (io.ReadWriter, error) {
 	var out bytes.Buffer
 	err := json.Indent(&out, b, "", "  ")
-	return out.Bytes(), err
+	return &out, err
 }
 
 // JSONMarshal allows the item to be correctly rendered to json
diff --git a/cmd/swagger/commands/diff/spec_analyser.go b/cmd/swagger/commands/diff/spec_analyser.go
index f35c9e37..eb516f3c 100644
--- a/cmd/swagger/commands/diff/spec_analyser.go
+++ b/cmd/swagger/commands/diff/spec_analyser.go
@@ -59,7 +59,7 @@ func (sd *SpecAnalyser) Analyse(spec1, spec2 *spec.Swagger) error {
 
 func (sd *SpecAnalyser) analyseSpecMetadata(spec1, spec2 *spec.Swagger) {
 	// breaking if it no longer consumes any formats
-	added, deleted, _ := FromStringArray(spec1.Consumes).DiffsTo(spec2.Consumes)
+	added, deleted, _ := fromStringArray(spec1.Consumes).DiffsTo(spec2.Consumes)
 
 	node := getNameOnlyDiffNode("Spec")
 	location := DifferenceLocation{Node: node}
@@ -74,7 +74,7 @@ func (sd *SpecAnalyser) analyseSpecMetadata(spec1, spec2 *spec.Swagger) {
 	}
 
 	// // breaking if it no longer produces any formats
-	added, deleted, _ = FromStringArray(spec1.Produces).DiffsTo(spec2.Produces)
+	added, deleted, _ = fromStringArray(spec1.Produces).DiffsTo(spec2.Produces)
 	producesLocation := location.AddNode(getNameOnlyDiffNode("produces"))
 	for _, eachAdded := range added {
 		sd.Diffs = sd.Diffs.addDiff(SpecDifference{DifferenceLocation: producesLocation, Code: AddedProducesFormat, Compatibility: NonBreaking, DiffInfo: eachAdded})
@@ -84,7 +84,7 @@ func (sd *SpecAnalyser) analyseSpecMetadata(spec1, spec2 *spec.Swagger) {
 	}
 
 	// // breaking if it no longer supports a scheme
-	added, deleted, _ = FromStringArray(spec1.Schemes).DiffsTo(spec2.Schemes)
+	added, deleted, _ = fromStringArray(spec1.Schemes).DiffsTo(spec2.Schemes)
 	schemesLocation := location.AddNode(getNameOnlyDiffNode("schemes"))
 
 	for _, eachAdded := range added {
@@ -120,7 +120,7 @@ func (sd *SpecAnalyser) analyseEndpointData() {
 
 	for URLMethod, op2 := range sd.urlMethods2 {
 		if op1, ok := sd.urlMethods1[URLMethod]; ok {
-			addedTags, deletedTags, _ := FromStringArray(op1.Operation.Tags).DiffsTo(op2.Operation.Tags)
+			addedTags, deletedTags, _ := fromStringArray(op1.Operation.Tags).DiffsTo(op2.Operation.Tags)
 			location := DifferenceLocation{URL: URLMethod.Path, Method: URLMethod.Method}
 
 			for _, eachAddedTag := range addedTags {
@@ -566,7 +566,7 @@ func (sd *SpecAnalyser) compareEnums(left, right []interface{}) []TypeDiff {
 	for _, eachRight := range right {
 		rightStrs = append(rightStrs, fmt.Sprintf("%v", eachRight))
 	}
-	added, deleted, _ := FromStringArray(leftStrs).DiffsTo(rightStrs)
+	added, deleted, _ := fromStringArray(leftStrs).DiffsTo(rightStrs)
 	if len(added) > 0 {
 		typeChange := strings.Join(added, ",")
 		diffs = append(diffs, TypeDiff{Change: AddedEnumValue, Description: typeChange})
diff --git a/cmd/swagger/commands/diff/spec_analyser_test.go b/cmd/swagger/commands/diff/spec_analyser_test.go
index 9e80f4f0..bf01d1b8 100644
--- a/cmd/swagger/commands/diff/spec_analyser_test.go
+++ b/cmd/swagger/commands/diff/spec_analyser_test.go
@@ -1,111 +1,72 @@
 package diff
 
 import (
-	"io/ioutil"
+	"io"
 	"os"
 	"path/filepath"
 	"strings"
 	"testing"
 
-	"github.com/corbym/gocrest/is"
 	"github.com/go-openapi/loads"
+	"github.com/go-swagger/go-swagger/cmd/swagger/commands/internal/cmdtest"
+	"github.com/stretchr/testify/require"
 )
 
-const (
-	basePath = "../../../../fixtures/diff"
-)
+func fixturePath(file string, parts ...string) string {
+	return filepath.Join("..", "..", "..", "..", "fixtures", "diff", strings.Join(append([]string{file}, parts...), ""))
+}
 
 type testCaseData struct {
 	name          string
 	oldSpec       string
 	newSpec       string
-	expectedLines string
+	expectedLines io.Reader
+	expectedFile  string
+}
+
+func fixturePart(file string) string {
+	base := filepath.Base(file)
+	parts := strings.Split(base, ".diff.txt")
+	return parts[0]
 }
 
 // TestDiffForVariousCombinations - computes the diffs for a number
 // of scenarios and compares the computed diff with expected diffs
 func TestDiffForVariousCombinations(t *testing.T) {
 
-	diffRootPath := basePath + "/"
-	pattern := diffRootPath + "*.diff.txt"
+	pattern := fixturePath("*.diff.txt")
+	allTests, err := filepath.Glob(pattern)
+	require.NoError(t, err)
+	require.True(t, len(allTests) > 0)
 
 	// To filter cases for debugging poke an individual case here eg "path", "enum" etc
 	// see the test cases in fixtures/diff
 	// Don't forget to remove it once you're done.
 	// (There's a test at the end to check all cases were run)
-	matches := []string{}
-
-	allTests, err := filepath.Glob(pattern)
-
-	if err != nil || len(allTests) == 0 {
-		t.Fatalf("Couldn't find files")
-	}
-
-	if len(matches) == 0 {
-		matches = allTests
-	}
-
-	testCases := []testCaseData{}
+	matches := allTests
 
-	for _, eachFile := range matches {
-		base := filepath.Base(eachFile)
-		parts := strings.Split(base, ".diff.txt")
-		namePart := parts[0]
-		testCases = append(
-			testCases, testCaseData{
-				name:          namePart,
-				oldSpec:       diffRootPath + namePart + ".v1.json",
-				newSpec:       diffRootPath + namePart + ".v2.json",
-				expectedLines: LinesInFile(diffRootPath + namePart + ".diff.txt"),
-			})
+	testCases := makeTestCases(t, matches)
 
-	}
-	for _, tc := range testCases {
+	for i, tc := range testCases {
 		tc := tc
 		t.Run(tc.name, func(t *testing.T) {
 			diffs, err := getDiffs(tc.oldSpec, tc.newSpec)
-			assertThat(t, err, is.Nil())
-
-			if err == nil {
-				diffsStr := catchStdOut(t, func() {
-					err = diffs.ReportAllDiffs(false)
-					if diffs.BreakingChangeCount() > 0 {
-						assertThat(t, err, is.Not(is.Nil()))
-					}
-				})
-				assertThat(t, diffsStr, is.EqualToIgnoringWhitespace(tc.expectedLines))
-			}
-		})
-	}
+			require.NoError(t, err)
 
-	assertThat(t, len(matches), is.EqualTo(len(allTests)).Reason("All test cases were not run. Remove filter."))
-}
+			out, err, warn := diffs.ReportAllDiffs(false)
+			require.NoError(t, err)
 
-func LinesInFile(fileName string) string {
-	bytes, _ := ioutil.ReadFile(fileName)
-	return string(bytes)
-}
-
-func catchStdOut(t *testing.T, runnable func()) string {
-
-	realStdout := os.Stdout
-	defer func() { os.Stdout = realStdout }()
-	r, fakeStdout, err := os.Pipe()
-	dieOn(err, t)
-	os.Stdout = fakeStdout
-	runnable()
-	// need to close here, otherwise ReadAll never gets "EOF".
-	dieOn(fakeStdout.Close(), t)
-	newOutBytes, err := ioutil.ReadAll(r)
-	dieOn(err, t)
-	dieOn(r.Close(), t)
-	return string(newOutBytes)
-}
+			if !cmdtest.AssertReadersContent(t, true, tc.expectedLines, out) {
+				t.Logf("unexpected content for fixture %q[%d] (file: %s)", tc.name, i, tc.expectedFile)
+			}
 
-func dieOn(err error, t *testing.T) {
-	if err != nil {
-		t.Fatal(err)
+			if diffs.BreakingChangeCount() > 0 {
+				require.Error(t, warn)
+			}
+		})
 	}
+
+	require.Equalf(t, len(matches), len(allTests), "All test cases were not run. Remove filter")
 }
 
 func getDiffs(oldSpecPath, newSpecPath string) (SpecDifferences, error) {
@@ -124,3 +85,24 @@ func getDiffs(oldSpecPath, newSpecPath string) (SpecDifferences, error) {
 
 	return Compare(specDoc1.Spec(), specDoc2.Spec())
 }
+
+func makeTestCases(t testing.TB, matches []string) []testCaseData {
+	testCases := make([]testCaseData, 0, len(matches))
+	for _, eachFile := range matches {
+		namePart := fixturePart(eachFile)
+		testCases = append(
+			testCases, testCaseData{
+				name:          namePart,
+				oldSpec:       fixturePath(namePart, ".v1.json"),
+				newSpec:       fixturePath(namePart, ".v2.json"),
+				expectedLines: linesInFile(t, fixturePath(namePart, ".diff.txt")),
+			})
+	}
+	return testCases
+}
+
+func linesInFile(t testing.TB, fileName string) io.ReadCloser {
+	file, err := os.Open(fileName)
+	require.NoError(t, err)
+	return file
+}
diff --git a/cmd/swagger/commands/diff/spec_difference.go b/cmd/swagger/commands/diff/spec_difference.go
index ead620b3..222ea89b 100644
--- a/cmd/swagger/commands/diff/spec_difference.go
+++ b/cmd/swagger/commands/diff/spec_difference.go
@@ -1,8 +1,10 @@
 package diff
 
 import (
+	"bytes"
+	"errors"
 	"fmt"
-	"log"
+	"io"
 	"sort"
 )
 
@@ -131,19 +133,23 @@ func (sd SpecDifferences) addDiff(diff SpecDifference) SpecDifferences {
 }
 
 // ReportCompatibility lists and spec
-func (sd *SpecDifferences) ReportCompatibility() error {
+func (sd *SpecDifferences) ReportCompatibility() (io.Reader, error, error) {
+	var out bytes.Buffer
 	breakingCount := sd.BreakingChangeCount()
 	if breakingCount > 0 {
-		fmt.Printf("\nBREAKING CHANGES:\n=================\n")
-		sd.reportChanges(Breaking)
-		return fmt.Errorf("compatibility Test FAILED: %d Breaking changes detected", breakingCount)
+		fmt.Fprintln(&out, "\nBREAKING CHANGES:\n=================")
+		_, _ = out.ReadFrom(sd.reportChanges(Breaking))
+		msg := fmt.Sprintf("compatibility test FAILED: %d breaking changes detected", breakingCount)
+		fmt.Fprintln(&out, msg)
+		return &out, nil, errors.New(msg)
 	}
-	log.Printf("Compatibility test OK. No breaking changes identified.")
-	return nil
+	fmt.Fprintf(&out, "compatibility test OK. No breaking changes identified.")
+	return &out, nil, nil
 }
 
-func (sd SpecDifferences) reportChanges(compat Compatibility) {
+func (sd SpecDifferences) reportChanges(compat Compatibility) io.Reader {
 	toReportList := []string{}
+	var out bytes.Buffer
 
 	for _, diff := range sd {
 		if diff.Compatibility == compat {
@@ -156,35 +162,36 @@ func (sd SpecDifferences) reportChanges(compat Compatibility) {
 	})
 
 	for _, eachDiff := range toReportList {
-		fmt.Println(eachDiff)
+		fmt.Fprintln(&out, eachDiff)
 	}
+	return &out
 }
 
 // ReportAllDiffs lists all the diffs between two specs
-func (sd SpecDifferences) ReportAllDiffs(fmtJSON bool) error {
+func (sd SpecDifferences) ReportAllDiffs(fmtJSON bool) (io.Reader, error, error) {
 	if fmtJSON {
-
 		b, err := JSONMarshal(sd)
 		if err != nil {
-			log.Fatalf("Couldn't print results: %v", err)
-		}
-		pretty, err := prettyprint(b)
-		if err != nil {
-			log.Fatalf("Couldn't print results: %v", err)
+			return nil, fmt.Errorf("couldn't print results: %v", err), nil
 		}
-		fmt.Println(string(pretty))
-		return nil
+		out, err := prettyprint(b)
+		return out, err, nil
 	}
 	numDiffs := len(sd)
 	if numDiffs == 0 {
-		fmt.Println("No changes identified")
-		return nil
+		return bytes.NewBuffer([]byte("No changes identified")), nil, nil
 	}
 
+	var out bytes.Buffer
 	if numDiffs != sd.BreakingChangeCount() {
-		fmt.Println("NON-BREAKING CHANGES:\n=====================")
-		sd.reportChanges(NonBreaking)
+		fmt.Fprintln(&out, "NON-BREAKING CHANGES:\n=====================")
+		_, _ = out.ReadFrom(sd.reportChanges(NonBreaking))
 	}
 
-	return sd.ReportCompatibility()
+	more, err, warn := sd.ReportCompatibility()
+	if err != nil {
+		return nil, err, warn
+	}
+	_, _ = out.ReadFrom(more)
+	return &out, nil, warn
 }
diff --git a/cmd/swagger/commands/diff/spec_difference_test.go b/cmd/swagger/commands/diff/spec_difference_test.go
index 2898bd6f..205253f6 100644
--- a/cmd/swagger/commands/diff/spec_difference_test.go
+++ b/cmd/swagger/commands/diff/spec_difference_test.go
@@ -3,21 +3,17 @@ package diff_test
 import (
 	"testing"
 
-	"github.com/corbym/gocrest/is"
-	"github.com/corbym/gocrest/then"
 	"github.com/go-swagger/go-swagger/cmd/swagger/commands/diff"
+	"github.com/stretchr/testify/require"
 )
 
-var assertThat = then.AssertThat
-var equals = is.EqualTo
-
 func TestMatches(t *testing.T) {
 	urlOnly := diff.SpecDifference{DifferenceLocation: diff.DifferenceLocation{URL: "bob"}}
 	urlOnlyDiff := diff.SpecDifference{DifferenceLocation: diff.DifferenceLocation{URL: "notbob"}}
 	urlOnlySame := diff.SpecDifference{DifferenceLocation: diff.DifferenceLocation{URL: "bob"}}
 
-	assertThat(t, urlOnly.Matches(urlOnlySame), equals(true))
-	assertThat(t, urlOnly.Matches(urlOnlyDiff), equals(false))
+	require.True(t, urlOnly.Matches(urlOnlySame))
+	require.False(t, urlOnly.Matches(urlOnlyDiff))
 
 	withMethod := urlOnly
 	withMethod.DifferenceLocation.Method = "PUT"
@@ -25,8 +21,8 @@ func TestMatches(t *testing.T) {
 	withMethodDiff := withMethod
 	withMethodDiff.DifferenceLocation.Method = "GET"
 
-	assertThat(t, withMethod.Matches(withMethodSame), equals(true))
-	assertThat(t, withMethod.Matches(withMethodDiff), equals(false))
+	require.True(t, withMethod.Matches(withMethodSame))
+	require.False(t, withMethod.Matches(withMethodDiff))
 
 	withResponse := urlOnly
 	withResponse.DifferenceLocation.Response = 0
@@ -34,8 +30,8 @@ func TestMatches(t *testing.T) {
 	withResponseDiff := withResponse
 	withResponseDiff.DifferenceLocation.Response = 2
 
-	assertThat(t, withResponse.Matches(withResponseSame), equals(true))
-	assertThat(t, withResponse.Matches(withResponseDiff), equals(false))
+	require.True(t, withResponse.Matches(withResponseSame))
+	require.False(t, withResponse.Matches(withResponseDiff))
 
 	withNode := urlOnly
 	withNode.DifferenceLocation.Node = &diff.Node{Field: "FieldA", TypeName: "TypeA"}
@@ -45,13 +41,13 @@ func TestMatches(t *testing.T) {
 	withNodeDiff := withNode
 	withNodeDiff.DifferenceLocation.Node = &diff.Node{Field: "FieldA", TypeName: "TypeB"}
 
-	assertThat(t, withNode.Matches(withNodeSame), equals(true))
-	assertThat(t, withNode.Matches(withNodeDiff), equals(false))
+	require.True(t, withNode.Matches(withNodeSame))
+	require.False(t, withNode.Matches(withNodeDiff))
 
 	withNodeDiff.DifferenceLocation.Node = &diff.Node{Field: "FieldB", TypeName: "TypeA"}
 
-	assertThat(t, withNode.Matches(withNodeSame), equals(true))
-	assertThat(t, withNode.Matches(withNodeDiff), equals(false))
+	require.True(t, withNode.Matches(withNodeSame))
+	require.False(t, withNode.Matches(withNodeDiff))
 
 	withNestedNode := withNode
 	withNestedNode.DifferenceLocation = withNestedNode.DifferenceLocation.AddNode(&diff.Node{Field: "ChildA", TypeName: "ChildA"})
@@ -60,7 +56,6 @@ func TestMatches(t *testing.T) {
 	withNestedNodeDiff := withNode
 	withNestedNodeDiff.DifferenceLocation = withNestedNodeDiff.DifferenceLocation.AddNode(&diff.Node{Field: "ChildB", TypeName: "ChildA"})
 
-	assertThat(t, withNestedNode.Matches(withNestedNodeSame), equals(true))
-	assertThat(t, withNestedNode.Matches(withNestedNodeDiff), equals(false))
-
+	require.True(t, withNestedNode.Matches(withNestedNodeSame))
+	require.False(t, withNestedNode.Matches(withNestedNodeDiff))
 }
diff --git a/cmd/swagger/commands/diff_test.go b/cmd/swagger/commands/diff_test.go
index 1ad42976..f3e7415f 100644
--- a/cmd/swagger/commands/diff_test.go
+++ b/cmd/swagger/commands/diff_test.go
@@ -1,7 +1,10 @@
 package commands
 
 import (
+	"bytes"
+	"io"
 	"io/ioutil"
+	"log"
 	"os"
 	"path/filepath"
 	"strings"
@@ -9,91 +12,86 @@ import (
 	"testing"
 
 	"github.com/go-swagger/go-swagger/cmd/swagger/commands/diff"
-
-	"github.com/corbym/gocrest/is"
-	"github.com/corbym/gocrest/then"
+	"github.com/go-swagger/go-swagger/cmd/swagger/commands/internal/cmdtest"
+	"github.com/stretchr/testify/assert"
+	"github.com/stretchr/testify/require"
 )
 
-var assertThat = then.AssertThat
-var equals = is.EqualTo
-
-const (
-	basePath = "../../../fixtures/diff"
-)
+func fixturePath(file string, parts ...string) string {
+	return filepath.Join("..", "..", "..", "fixtures", "diff", strings.Join(append([]string{file}, parts...), ""))
+}
 
 type testCaseData struct {
-	name          string
-	oldSpec       string
-	newSpec       string
-	expectedLines string
+	name            string
+	oldSpec         string
+	newSpec         string
+	expectedError   bool
+	expectedWarning bool
+	expectedLines   io.ReadCloser
+	expectedFile    string
 }
 
 // TestDiffForVariousCombinations - computes the diffs for a number
 // of scenarios and compares the computed diff with expected diffs
 func TestDiffForVariousCombinations(t *testing.T) {
 
-	diffRootPath := basePath + "/"
-	pattern := diffRootPath + "*.diff.txt"
+	pattern := fixturePath("*.diff.txt")
 
 	// To filter cases for debugging poke an individual case here eg "path", "enum" etc
 	// see the test cases in fixtures/diff
 	// Don't forget to remove it once you're done.
 	// (There's a test at the end to check all cases were run)
-	matches := []string{"path"}
-
 	allTests, err := filepath.Glob(pattern)
+	require.NoErrorf(t, err, "could not find test files")
+	require.False(t, len(allTests) == 0, "could not find test files")
 
-	if err != nil || len(allTests) == 0 {
-		t.Fatalf("Couldn't find files")
-	}
-
-	if len(matches) == 0 {
-		matches = allTests
-	}
-
-	testCases := []testCaseData{}
-
-	for _, eachFile := range matches {
-		base := filepath.Base(eachFile)
-		parts := strings.Split(base, ".diff.txt")
-		namePart := parts[0]
-		testCases = append(
-			testCases, testCaseData{
-				name:          namePart,
-				oldSpec:       diffRootPath + namePart + ".v1.json",
-				newSpec:       diffRootPath + namePart + ".v2.json",
-				expectedLines: LinesInFile(diffRootPath + namePart + ".diff.txt"),
-			})
+	testCases := makeTestCases(t, allTests)
 
-	}
-	for _, tc := range testCases {
+	for i, tc := range testCases {
 		tc := tc
 		t.Run(tc.name, func(t *testing.T) {
+			cmd := DiffCommand{}
+			cmd.Args.OldSpec = tc.oldSpec
+			cmd.Args.NewSpec = tc.newSpec
+			diffs, err := cmd.getDiffs()
+
+			if tc.expectedError {
+				// edge cases with error
+				require.Error(t, err)
+				return
+			}
+			require.NoError(t, err)
 
-			diffs, err := getDiffs(tc.oldSpec, tc.newSpec)
-
-			assertThat(t, err, is.Nil())
+			out, err, warn := diffs.ReportAllDiffs(false)
+			require.NoError(t, err)
 
-			if err == nil {
+			// breaking changes reported with a warning
+			if tc.expectedWarning {
+				assert.Error(t, warn)
+			} else {
+				assert.NoError(t, warn)
+			}
 
-				diffsStr := catchStdOut(t, func() {
-					err = diffs.ReportAllDiffs(false)
-					assertThat(t, err, is.Not(is.Nil()))
-				})
-				assertThat(t, diffsStr, is.EqualToIgnoringWhitespace(tc.expectedLines))
+			if !cmdtest.AssertReadersContent(t, true, tc.expectedLines, out) {
+				t.Logf("unexpected content for fixture %q[%d] (file: %s)", tc.name, i, tc.expectedFile)
 			}
 		})
 	}
 }
 
-func TestReadIgnores(t *testing.T) {
+func TestDiffReadIgnores(t *testing.T) {
+	log.SetOutput(ioutil.Discard)
+	defer func() {
+		log.SetOutput(os.Stdout)
+	}()
 
-	diffRootPath := basePath + "/"
-	ignorePath := diffRootPath + "ignoreFile.json"
-	ignores, err := readIgnores(ignorePath)
+	cmd := DiffCommand{
+		IgnoreFile: fixturePath("ignoreFile.json"),
+	}
 
-	assertThat(t, err, is.Nil())
-	assertThat(t, len(ignores), is.Not(equals(0)))
+	ignores, err := cmd.readIgnores()
+	require.NoError(t, err)
+	require.True(t, len(ignores) > 0)
 
 	isIn := diff.SpecDifference{DifferenceLocation: diff.DifferenceLocation{
 		Method:   "get",
@@ -105,66 +103,192 @@ func TestReadIgnores(t *testing.T) {
 		Compatibility: diff.NonBreaking,
 		DiffInfo:      "extrovert",
 	}
-	assertThat(t, ignores.Contains(isIn), equals(true))
+	assert.Contains(t, ignores, isIn)
 
-}
-
-func dieOn(err error, t *testing.T) {
-	if err != nil {
-		t.Fatal(err)
+	// edge case
+	cmd = DiffCommand{
+		IgnoreFile: "/someplace/wrong",
 	}
+	_, err = cmd.readIgnores()
+	require.Error(t, err)
+	assert.Contains(t, err.Error(), "/someplace/wrong")
 }
 
-func TestProcessIgnores(t *testing.T) {
-	diffRootPath := basePath + "/"
-	namePart := "enum"
+func TestDiffProcessIgnores(t *testing.T) {
+	log.SetOutput(ioutil.Discard)
+	defer func() {
+		log.SetOutput(os.Stdout)
+	}()
+
+	const namePart = "enum"
 	tc := testCaseData{
 		name:          namePart,
-		oldSpec:       diffRootPath + namePart + ".v1.json",
-		newSpec:       diffRootPath + namePart + ".v2.json",
-		expectedLines: LinesInFile(diffRootPath + "ignoreDiffs.json"),
+		oldSpec:       fixturePath(namePart, ".v1.json"),
+		newSpec:       fixturePath(namePart, ".v2.json"),
+		expectedLines: linesInFile(t, fixturePath("ignoreDiffs.json")),
 	}
 
+	reportFile, err := ioutil.TempFile("", "report.txt")
+	require.NoError(t, err)
+	defer func() {
+		_ = os.Remove(reportFile.Name())
+	}()
+
 	cmd := DiffCommand{
-		Format:     "json",
-		IgnoreFile: diffRootPath + "ignoreFile.json",
+		Format:      "json",
+		IgnoreFile:  fixturePath("ignoreFile.json"),
+		Destination: reportFile.Name(),
 	}
+	cmd.Args.OldSpec = tc.oldSpec
+	cmd.Args.NewSpec = tc.newSpec
+
+	err = cmd.Execute([]string{tc.oldSpec, tc.newSpec})
+	require.NoError(t, err)
 
-	diffsStr := catchStdOut(t, func() {
-		err := cmd.Execute([]string{tc.oldSpec, tc.newSpec})
-		assertThat(t, err, is.Nil())
-	})
-	assertThat(t, diffsStr, is.EqualToIgnoringWhitespace(tc.expectedLines))
+	output, err := os.Open(cmd.Destination)
+	require.NoError(t, err)
+	defer func() {
+		_ = output.Close()
+	}()
+
+	cmdtest.AssertReadersContent(t, true, tc.expectedLines, output)
 }
 
-func TestNoArgs(t *testing.T) {
+func TestDiffNoArgs(t *testing.T) {
 
 	cmd := DiffCommand{
 		Format:     "json",
 		IgnoreFile: "",
 	}
+	require.Error(t, cmd.Execute(nil))
+
+	cmd.Args.NewSpec = "x"
+	require.Error(t, cmd.Execute(nil))
+}
+
+func TestDiffCannotReport(t *testing.T) {
+	log.SetOutput(ioutil.Discard)
+	defer func() {
+		log.SetOutput(os.Stdout)
+	}()
+
+	cmd := DiffCommand{
+		OnlyBreakingChanges: true,
+		Format:              "txt",
+		IgnoreFile:          "",
+		Destination:         "/someplace/wrong",
+	}
+	const namePart = "enum"
+	cmd.Args.OldSpec = fixturePath(namePart, ".v1.json")
+	cmd.Args.NewSpec = fixturePath(namePart, ".v2.json")
+	err := cmd.Execute(nil)
+	require.Error(t, err)
+	assert.Contains(t, err.Error(), "/someplace/wrong")
+}
+
+func TestDiffOnlyBreaking(t *testing.T) {
+	log.SetOutput(ioutil.Discard)
+	defer func() {
+		log.SetOutput(os.Stdout)
+	}()
+
+	reportDir, err := ioutil.TempDir("", "diff-reports")
+	require.NoError(t, err)
+	defer func() {
+		_ = os.RemoveAll(reportDir)
+	}()
+	txtReport := filepath.Join(reportDir, "report.txt")
+
+	cmd := DiffCommand{
+		OnlyBreakingChanges: true,
+		Format:              "txt",
+		IgnoreFile:          "",
+		Destination:         txtReport,
+	}
 
-	err := cmd.Execute([]string{})
-	assertThat(t, err, is.Not(is.Nil()))
+	const namePart = "enum"
+	cmd.Args.OldSpec = fixturePath(namePart, ".v1.json")
+	cmd.Args.NewSpec = fixturePath(namePart, ".v2.json")
+	err = cmd.Execute(nil)
+	require.Error(t, err)
+	assert.Contains(t, err.Error(), "compatibility test FAILED")
+
+	actual, err := os.Open(txtReport)
+	require.NoError(t, err)
+	defer func() {
+		_ = actual.Close()
+	}()
+
+	expected, err := os.Open(fixturePath("enum", ".diff.breaking.txt"))
+	require.NoError(t, err)
+	defer func() {
+		_ = expected.Close()
+	}()
+
+	cmdtest.AssertReadersContent(t, true, expected, actual)
+
+	// assert stdout just the same (we do it just once, so there is no race condition on os.Stdout)
+	cmd.Destination = ""
+	output, err := cmdtest.CatchStdOut(t, func() error { return cmd.Execute(nil) })
+	require.Error(t, err)
+	assert.Contains(t, err.Error(), "compatibility test FAILED")
+
+	expected.Seek(0, os.SEEK_SET)
+	result := bytes.NewBuffer(output)
+	cmdtest.AssertReadersContent(t, true, expected, result)
 }
 
-func LinesInFile(fileName string) string {
-	bytes, _ := ioutil.ReadFile(fileName)
-	return string(bytes)
+func fixturePart(file string) string {
+	base := filepath.Base(file)
+	parts := strings.Split(base, ".diff.txt")
+	return parts[0]
+}
+
+func hasFixtureBreaking(part string) bool {
+	// these fixtures expect some breaking changes
+	switch part {
+	case "enum", "kitchensink", "param", "path", "response":
+		return true
+	default:
+		return false
+	}
+}
+
+func makeTestCases(t testing.TB, matches []string) []testCaseData {
+	testCases := make([]testCaseData, 0, len(matches)+2)
+	for _, eachFile := range matches {
+		namePart := fixturePart(eachFile)
+
+		testCases = append(
+			testCases, testCaseData{
+				name:            namePart,
+				oldSpec:         fixturePath(namePart, ".v1.json"),
+				newSpec:         fixturePath(namePart, ".v2.json"),
+				expectedLines:   linesInFile(t, fixturePath(namePart, ".diff.txt")),
+				expectedFile:    fixturePath(namePart, ".diff.txt"), // only for debugging failed tests
+				expectedWarning: hasFixtureBreaking(namePart),
+			})
+	}
+
+	// edge cases with errors
+	testCases = append(testCases, testCaseData{
+		name:          "failure to load old spec",
+		oldSpec:       "nowhere.json",
+		newSpec:       fixturePath("enum", ".v2.json"),
+		expectedError: true,
+	},
+		testCaseData{
+			name:          "failure to load new spec",
+			oldSpec:       fixturePath("enum", ".v1.json"),
+			newSpec:       "nowhere.json",
+			expectedError: true,
+		},
+	)
+	return testCases
 }
 
-func catchStdOut(t *testing.T, runnable func()) string {
-
-	realStdout := os.Stdout
-	defer func() { os.Stdout = realStdout }()
-	r, fakeStdout, err := os.Pipe()
-	dieOn(err, t)
-	os.Stdout = fakeStdout
-	runnable()
-	// need to close here, otherwise ReadAll never gets "EOF".
-	dieOn(fakeStdout.Close(), t)
-	newOutBytes, err := ioutil.ReadAll(r)
-	dieOn(err, t)
-	dieOn(r.Close(), t)
-	return string(newOutBytes)
+func linesInFile(t testing.TB, fileName string) io.ReadCloser {
+	file, err := os.Open(fileName)
+	require.NoError(t, err)
+	return file
 }
diff --git a/cmd/swagger/commands/internal/cmdtest/output.go b/cmd/swagger/commands/internal/cmdtest/output.go
new file mode 100644
index 00000000..7d8998cc
--- /dev/null
+++ b/cmd/swagger/commands/internal/cmdtest/output.go
@@ -0,0 +1,50 @@
+// Package cmdtest provides test utilities
+// to assert the output of CLI commands
+package cmdtest
+
+import (
+	"io"
+	"io/ioutil"
+	"os"
+	"strings"
+	"testing"
+
+	"github.com/stretchr/testify/assert"
+	"github.com/stretchr/testify/require"
+)
+
+// AssertReadersContent compares the contents from io.Readers, optionally stripping blanks
+func AssertReadersContent(t testing.TB, noBlanks bool, expected, actual io.Reader) bool {
+	e, err := ioutil.ReadAll(expected)
+	require.NoError(t, err)
+
+	a, err := ioutil.ReadAll(actual)
+	require.NoError(t, err)
+
+	var wants, got strings.Builder
+	_, _ = wants.Write(e)
+	_, _ = got.Write(a)
+
+	if noBlanks {
+		r := strings.NewReplacer(" ", "", "\t", "", "\n", "")
+		return assert.Equalf(t, r.Replace(wants.String()), r.Replace(got.String()), "expected:\n%s\ngot %s", wants.String(), got.String())
+	}
+	return assert.Equal(t, wants.String(), got.String())
+}
+
+// CatchStdOut captures the standard output from a runnable function.
+// You shouln't run this in parallel.
+func CatchStdOut(t testing.TB, runnable func() error) ([]byte, error) {
+	realStdout := os.Stdout
+	defer func() { os.Stdout = realStdout }()
+	r, fakeStdout, err := os.Pipe()
+	require.NoError(t, err)
+	os.Stdout = fakeStdout
+	e := runnable()
+	// need to close here, otherwise ReadAll never gets "EOF".
+	require.NoError(t, fakeStdout.Close())
+	newOutBytes, err := ioutil.ReadAll(r)
+	require.NoError(t, err)
+	require.NoError(t, r.Close())
+	return newOutBytes, e
+}
diff --git a/docs/SUMMARY.md b/docs/SUMMARY.md
index 0ce37da0..92f534c8 100644
--- a/docs/SUMMARY.md
+++ b/docs/SUMMARY.md
@@ -16,8 +16,8 @@
   - [Options and commands](usage/swagger.md)
   - [Serve UI](usage/serve_ui.md)
   - [Validate](usage/validate.md)
+  - [Diff](usage/diff.md)
   - [Transform spec](use/transform.md)
-    - [Diff](usage/diff.md)
     - [Expand](usage/expand.md)
     - [Flatten](usage/flatten.md)
     - [Mixin](usage/mixin.md)
diff --git a/docs/diff/diff.md b/docs/diff/diff.md
index 7dc01baa..29a15b67 100644
--- a/docs/diff/diff.md
+++ b/docs/diff/diff.md
@@ -6,13 +6,13 @@ The toolkit has a command that will let you find the changes in a spec.
 
 ```
 Usage:
-  swagger [OPTIONS] diff [diff-OPTIONS] spec1 spec2
+  swagger [OPTIONS] diff [diff-OPTIONS] {original spec} {spec}
 
-diff two swagger spec files
+diff specs showing which changes will break existing clients
 
 Application Options:
   -q, --quiet                    silence logs
-  -o, --output=LOG-FILE          redirect logs to file
+      --log-output=LOG-FILE      redirect logs to file
 
 Help Options:
   -h, --help                     Show this help message
@@ -20,10 +20,8 @@ Help Options:
 [diff command options]
       -b, --break                When present, only shows incompatible changes
       -f, --format=[txt|json]    When present, writes output as json (default: txt)
-      -i, --ignore=              Exception file of diffs to ignore (copy output from json diff format) (default: none
-                                 specified)
+      -i, --ignore=              Exception file of diffs to ignore (copy output from json diff format) (default: none specified)
       -d, --dest=                Output destination file or stdout (default: stdout)
-
 ```
 
 ### Diff output
diff --git a/docs/usage/diff.md b/docs/usage/diff.md
index 4e588009..9ab401a3 100644
--- a/docs/usage/diff.md
+++ b/docs/usage/diff.md
@@ -8,7 +8,7 @@ To diff specifications:
 
 ```
 Usage:
-  swagger [OPTIONS] diff [diff-OPTIONS]
+  swagger [OPTIONS] diff [diff-OPTIONS] {original spec} {spec}
 
 diff specs showing which changes will break existing clients
 
diff --git a/fixtures/diff/enum.diff.breaking.txt b/fixtures/diff/enum.diff.breaking.txt
new file mode 100644
index 00000000..3273300b
--- /dev/null
+++ b/fixtures/diff/enum.diff.breaking.txt
@@ -0,0 +1,8 @@
+            BREAKING CHANGES:
+            =================
+            /a/:get -> 200 Response - array[A1].personality : string - Added possible enumeration(s) <sane>
+            /a/:get Request - Query.personality - Deleted possible enumeration(s) <saucy>
+            /a/{id}:get -> 200 Response - array[A1].personality : string - Added possible enumeration(s) <sane>
+            /b/:get -> 200 Response - array[A1].personality : string - Added possible enumeration(s) <sane>
+
+compatibility test FAILED: 4 breaking changes detected
diff --git a/fixtures/diff/enum.diff.txt b/fixtures/diff/enum.diff.txt
index 7773896b..394ff56c 100644
--- a/fixtures/diff/enum.diff.txt
+++ b/fixtures/diff/enum.diff.txt
@@ -4,11 +4,12 @@ NON-BREAKING CHANGES:
             /a/:get Request - Query.personality - Added possible enumeration(s) <extrovert>
             /a/{id}:get -> 200 Response - array[A1].personality : string - Deleted possible enumeration(s) <crazy>
             /b/:get -> 200 Response - array[A1].personality : string - Deleted possible enumeration(s) <crazy>
-            
+
             BREAKING CHANGES:
             =================
             /a/:get -> 200 Response - array[A1].personality : string - Added possible enumeration(s) <sane>
             /a/:get Request - Query.personality - Deleted possible enumeration(s) <saucy>
             /a/{id}:get -> 200 Response - array[A1].personality : string - Added possible enumeration(s) <sane>
             /b/:get -> 200 Response - array[A1].personality : string - Added possible enumeration(s) <sane>
-            
\ No newline at end of file
+
+compatibility test FAILED: 4 breaking changes detected
diff --git a/fixtures/diff/kitchensink.diff.txt b/fixtures/diff/kitchensink.diff.txt
index 44d035c8..08d19894 100644
--- a/fixtures/diff/kitchensink.diff.txt
+++ b/fixtures/diff/kitchensink.diff.txt
@@ -10,7 +10,7 @@ NON-BREAKING CHANGES:
             /a/:get Request - Query.changeMaxInt - Widened type <Maximum 200.000000->300.000000>
             /a/:get Request - Query.removeMaxInt - Widened type <Exclusive Maximum Removed:true->false>
             /a/:get Request - Query.wideryString - Widened type <integer -> string>
-            
+
             BREAKING CHANGES:
             =================
              Metadata - Spec Metadata - Changed base path </api -> /apibaby>
@@ -24,4 +24,5 @@ NON-BREAKING CHANGES:
             /a/:get Request - Query.changeMinInt - Narrowed type <Minimum 200.000000->300.000000>
             /a/:get Request - Query.changeyPattern - Changed type <Pattern Changed:*->anewpattern>
             /a/:get Request - Query.primToObj : A2 - Changed type <integer -> obj>
-            
\ No newline at end of file
+
+compatibility test FAILED: 11 breaking changes detected
diff --git a/fixtures/diff/param.diff.txt b/fixtures/diff/param.diff.txt
index 3d1a2b3a..cc8e475c 100644
--- a/fixtures/diff/param.diff.txt
+++ b/fixtures/diff/param.diff.txt
@@ -7,7 +7,7 @@ NON-BREAKING CHANGES:
             /a/{id}:post Request - Header.newboris - Added optional param
             /a/{id}:post Request - Header.optboris - Deleted optional param
             /a/{id}:post Request - Header.reqdboris - Deleted required param
-            
+
             BREAKING CHANGES:
             =================
             /a/:post -> 200 Response - otherDeletedName : string - Deleted property
@@ -18,4 +18,5 @@ NON-BREAKING CHANGES:
             /a/{id}:post -> 200 Response - otherDeletedName : string - Deleted property
             /a/{id}:post Request - Header.changedboris - Narrowed type <string -> integer>
             /b/:post -> 200 Response - otherDeletedName : string - Deleted property
-            
\ No newline at end of file
+
+compatibility test FAILED: 8 breaking changes detected
diff --git a/fixtures/diff/path.diff.txt b/fixtures/diff/path.diff.txt
index b3ef7e0d..6f117bd0 100644
--- a/fixtures/diff/path.diff.txt
+++ b/fixtures/diff/path.diff.txt
@@ -3,9 +3,10 @@ NON-BREAKING CHANGES:
             /a/:put Request- Added endpoint
             /a/{id}:post Request- Deleted a deprecated endpoint
             /newpath/:post Request- Added endpoint
-            
+
             BREAKING CHANGES:
             =================
             /a/:post Request- Deleted endpoint
             /b/:post Request- Deleted endpoint
-            
\ No newline at end of file
+
+compatibility test FAILED: 2 breaking changes detected
diff --git a/fixtures/diff/response.diff.txt b/fixtures/diff/response.diff.txt
index e956f99a..e8704420 100644
--- a/fixtures/diff/response.diff.txt
+++ b/fixtures/diff/response.diff.txt
@@ -5,8 +5,9 @@ NON-BREAKING CHANGES:
             /a/:put -> 200 Response - description : string - Narrowed type <string -> integer.int32>
             /a/{id}:get -> 200 Response - colour : string - Added property
             /a/{id}:get -> 200 Response - description : string - Narrowed type <string -> integer.int32>
-            
+
             BREAKING CHANGES:
             =================
             /a/:get -> 200 Response- Deleted response
-            
\ No newline at end of file
+
+compatibility test FAILED: 1 breaking changes detected
diff --git a/fixtures/diff/uber.diff.txt b/fixtures/diff/uber.diff.txt
index 9b89651f..3ef8f4b9 100644
--- a/fixtures/diff/uber.diff.txt
+++ b/fixtures/diff/uber.diff.txt
@@ -5,4 +5,5 @@ NON-BREAKING CHANGES:
             /estimates/price:get Request- Deleted a tag <DeadTagWalking>
             /products:get Request - latitude - Deleted a description
             /products:get Request- Deleted a description
-           
\ No newline at end of file
+
+compatibility test OK. No breaking changes identified.
diff --git a/generator/bindata.go b/generator/bindata.go
index 77793faa..3c736531 100644
--- a/generator/bindata.go
+++ b/generator/bindata.go
@@ -58,7 +58,7 @@ import (
 func bindataRead(data []byte, name string) ([]byte, error) {
 	gz, err := gzip.NewReader(bytes.NewBuffer(data))
 	if err != nil {
-		return nil, fmt.Errorf("read %q: %w", name, err)
+		return nil, fmt.Errorf("read %q: %v", name, err)
 	}
 
 	var buf bytes.Buffer
@@ -66,7 +66,7 @@ func bindataRead(data []byte, name string) ([]byte, error) {
 	clErr := gz.Close()
 
 	if err != nil {
-		return nil, fmt.Errorf("read %q: %w", name, err)
+		return nil, fmt.Errorf("read %q: %v", name, err)
 	}
 	if clErr != nil {
 		return nil, err
@@ -1019,9 +1019,6 @@ var _bindata = map[string]func() (*asset, error){
 	"templates/validation/structfield.gotmpl":                     templatesValidationStructfieldGotmpl,
 }
 
-// AssetDebug is true if the assets were built with the debug flag enabled.
-const AssetDebug = false
-
 // AssetDir returns the file names below a certain
 // directory embedded in the file by go-bindata.
 // For example if you run go-bindata on data/... and data contains the
diff --git a/go.mod b/go.mod
index f5baaf30..f41ef476 100644
--- a/go.mod
+++ b/go.mod
@@ -3,7 +3,6 @@ module github.com/go-swagger/go-swagger
 go 1.14
 
 require (
-	github.com/corbym/gocrest v1.0.3
 	github.com/coreos/go-oidc v2.2.1+incompatible
 	github.com/davecgh/go-spew v1.1.1
 	github.com/dgrijalva/jwt-go v3.2.0+incompatible
diff --git a/go.sum b/go.sum
index a4b7b401..b6d2c1fa 100644
--- a/go.sum
+++ b/go.sum
@@ -41,8 +41,6 @@ github.com/bketelsen/crypt v0.0.3-0.20200106085610-5cbc8cc4026c/go.mod h1:MKsuJm
 github.com/census-instrumentation/opencensus-proto v0.2.1/go.mod h1:f6KPmirojxKA12rnyqOA5BBL4O983OfeGPqjHWSTneU=
 github.com/cespare/xxhash v1.1.0/go.mod h1:XrSqR1VqqWfGrhpAt58auRo0WTKS1nRRg3ghfAqPWnc=
 github.com/client9/misspell v0.3.4/go.mod h1:qj6jICC3Q7zFZvVWo7KLAzC3yx5G7kyvSDkc90ppPyw=
-github.com/corbym/gocrest v1.0.3 h1:gwEdq6RkTmq+09CTuM29DfKOCtZ7G7bcyxs3IZ6EVdU=
-github.com/corbym/gocrest v1.0.3/go.mod h1:maVFL5lbdS2PgfOQgGRWDYTeunSWQeiEgoNdTABShCs=
 github.com/coreos/bbolt v1.3.2/go.mod h1:iRUV2dpdMOn7Bo10OQBFzIJO9kkE559Wcmn+qkEiiKk=
 github.com/coreos/etcd v3.3.13+incompatible/go.mod h1:uF7uidLiAD3TWHmW31ZFd/JWoc32PjwdhPthX9715RE=
 github.com/coreos/go-oidc v2.2.1+incompatible h1:mh48q/BqXqgjVHpy2ZY7WnWAbenxRjsz9N1i1YxjHAk=
