{"url":"https://api.github.com/repos/rspec/rspec-core/issues/1991","repository_url":"https://api.github.com/repos/rspec/rspec-core","labels_url":"https://api.github.com/repos/rspec/rspec-core/issues/1991/labels{/name}","comments_url":"https://api.github.com/repos/rspec/rspec-core/issues/1991/comments","events_url":"https://api.github.com/repos/rspec/rspec-core/issues/1991/events","html_url":"https://github.com/rspec/rspec-core/issues/1991","id":87512857,"node_id":"MDU6SXNzdWU4NzUxMjg1Nw==","number":1991,"title":"Getting \"Unable to find matching line from backtrace\" from expectation in spec support file","user":{"login":"myronmarston","id":49391,"node_id":"MDQ6VXNlcjQ5Mzkx","avatar_url":"https://avatars.githubusercontent.com/u/49391?v=4","gravatar_id":"","url":"https://api.github.com/users/myronmarston","html_url":"https://github.com/myronmarston","followers_url":"https://api.github.com/users/myronmarston/followers","following_url":"https://api.github.com/users/myronmarston/following{/other_user}","gists_url":"https://api.github.com/users/myronmarston/gists{/gist_id}","starred_url":"https://api.github.com/users/myronmarston/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/myronmarston/subscriptions","organizations_url":"https://api.github.com/users/myronmarston/orgs","repos_url":"https://api.github.com/users/myronmarston/repos","events_url":"https://api.github.com/users/myronmarston/events{/privacy}","received_events_url":"https://api.github.com/users/myronmarston/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[],"state":"closed","locked":true,"assignee":null,"assignees":[],"milestone":null,"comments":1,"created_at":"2015-06-11T21:54:21Z","updated_at":"2015-10-14T15:44:22Z","closed_at":"2015-10-14T15:44:22Z","author_association":"MEMBER","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"Currently our [logic that looks for a matching line in the backtrace](https://github.com/rspec/rspec-core/blob/9eba761472a3447b4746a1e3fe0a9daabbfc4aca/lib/rspec/core/formatters/exception_presenter.rb#L130-L136) limits its search to backtrace lines from the file where the example is defined.  This fails if you have a shared context in `spec_helper` or a support file that defines an `after` hook that has a failing expectation.  It's not a good experience to get \"Unable to find matching line from backtrace\".   We should fix this, but it's not obvious what the right fix is.\n\nUltimately, \"Unable to find matching line form backtrace\" is really sub-optimal so I think it's worth having some fallback logic.  Here's one idea of how to do that:\n- Look through the backtrace to find the first line from the definition file.\n- If that fails, look again to find the first line from a file in your project (e.g. a file that does not contain `/gem/` in its path or similar...).\n- If that fails, take the first line.\n\nThoughts?\n","closed_by":{"login":"myronmarston","id":49391,"node_id":"MDQ6VXNlcjQ5Mzkx","avatar_url":"https://avatars.githubusercontent.com/u/49391?v=4","gravatar_id":"","url":"https://api.github.com/users/myronmarston","html_url":"https://github.com/myronmarston","followers_url":"https://api.github.com/users/myronmarston/followers","following_url":"https://api.github.com/users/myronmarston/following{/other_user}","gists_url":"https://api.github.com/users/myronmarston/gists{/gist_id}","starred_url":"https://api.github.com/users/myronmarston/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/myronmarston/subscriptions","organizations_url":"https://api.github.com/users/myronmarston/orgs","repos_url":"https://api.github.com/users/myronmarston/repos","events_url":"https://api.github.com/users/myronmarston/events{/privacy}","received_events_url":"https://api.github.com/users/myronmarston/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/rspec/rspec-core/issues/1991/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/rspec/rspec-core/issues/1991/timeline","performed_via_github_app":null,"state_reason":"completed"}