{"url":"https://api.github.com/repos/rspec/rspec-core/issues/42","repository_url":"https://api.github.com/repos/rspec/rspec-core","labels_url":"https://api.github.com/repos/rspec/rspec-core/issues/42/labels{/name}","comments_url":"https://api.github.com/repos/rspec/rspec-core/issues/42/comments","events_url":"https://api.github.com/repos/rspec/rspec-core/issues/42/events","html_url":"https://github.com/rspec/rspec-core/issues/42","id":223978,"node_id":"MDU6SXNzdWUyMjM5Nzg=","number":42,"title":"Access to arbitrary options metadata within \"before\" block","user":{"login":"wincent","id":7074,"node_id":"MDQ6VXNlcjcwNzQ=","avatar_url":"https://avatars.githubusercontent.com/u/7074?v=4","gravatar_id":"","url":"https://api.github.com/users/wincent","html_url":"https://github.com/wincent","followers_url":"https://api.github.com/users/wincent/followers","following_url":"https://api.github.com/users/wincent/following{/other_user}","gists_url":"https://api.github.com/users/wincent/gists{/gist_id}","starred_url":"https://api.github.com/users/wincent/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wincent/subscriptions","organizations_url":"https://api.github.com/users/wincent/orgs","repos_url":"https://api.github.com/users/wincent/repos","events_url":"https://api.github.com/users/wincent/events{/privacy}","received_events_url":"https://api.github.com/users/wincent/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[],"state":"closed","locked":true,"assignee":null,"assignees":[],"milestone":null,"comments":9,"created_at":"2010-06-16T15:04:51Z","updated_at":"2017-04-05T18:23:05Z","closed_at":"2010-06-18T09:49:23Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"I'm trying to use Steak and Capybara to run some scenarios using a JavaScript-capable backend (Culerity) and others using the standard rack_test backend.\n\nIn Cucumber this was done using tags, but with Steak and RSpec 1.3 I'm told you can do something like this:\n\n```\nscenario 'foo', :js => true do\n  # ... this one runs under culerity\nend\n\nscenario 'bar' do\n  # ... this one runs under rack_test\nend\n```\n\nThis is enabled by this config:\n\n```\nSpec::Runner.configure do |config|    \n  config.before :each do\n    Capybara.current_driver = :culerity if options[:js]\n  end\n\n  config.after :each do\n    Capybara.use_default_driver if options[:js]\n  end\nend\n```\n\nUnder RSpec 2 this trick won't work; it seems that \"options\" isn't available in the scope of these before/after config blocks. I've been able to dig out the options via some very ugly \"instance_variable_get\" inspection:\n\n```\nRSpec.configure do |config|\n  config.before :each do\n    if self.running_example.instance_variable_get(:@options)[:js]\n      Capybara.current_driver = :culerity\n    end\n  end\n\n  config.after :each do\n    if self.running_example.instance_variable_get(:@options)[:js]\n      Capybara.use_default_driver\n    end\n  end\nend\n```\n\nSo this ticket is about getting access to the arbitrary metadata that can be passed in to \"describe\" and \"it\" blocks via the options hash.\n\nNote that in the use case I'm talking about above, using the \"filter_run\" stuff won't give me what I want (that's for selecting a _subset_ of the examples to run, but I want to run _all_ of the examples, but switch Capybara drivers on the fly).\n\nWhat do you think about providing access to the options via an accessor?\n\nI've noticed that I can get at the options passed in to the RSpec::Core::Example subclass; ie:\n\n```\nit \"should foo\", :stuff => true do\n  ...\nend\n```\n\nBut I can't seem to get at the stuff passed in to the RSpec::Core::ExampleGroup subclass; ie:\n\n```\ndescribe \"foo\", :thing => true do\n  ...\nend\n```\n\nIn practice I don't really care too much about access to that metadata, because I want to switch drivers on a per-scenario basis (ie. at the \"it/scenario\" level). But if you agree to making the metadata available at that level, I guess it makes sense to make the metadata at the \"describe/feature\" level available too.\n\nWhat do you think?\n\nIf I can get a \"green light\" on the idea I'm happy to put a patch together.\n\nCheers,\nWincent\n","closed_by":null,"reactions":{"url":"https://api.github.com/repos/rspec/rspec-core/issues/42/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/rspec/rspec-core/issues/42/timeline","performed_via_github_app":null,"state_reason":"completed"}