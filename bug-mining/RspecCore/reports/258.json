{"url":"https://api.github.com/repos/rspec/rspec-core/issues/1989","repository_url":"https://api.github.com/repos/rspec/rspec-core","labels_url":"https://api.github.com/repos/rspec/rspec-core/issues/1989/labels{/name}","comments_url":"https://api.github.com/repos/rspec/rspec-core/issues/1989/comments","events_url":"https://api.github.com/repos/rspec/rspec-core/issues/1989/events","html_url":"https://github.com/rspec/rspec-core/issues/1989","id":87155108,"node_id":"MDU6SXNzdWU4NzE1NTEwOA==","number":1989,"title":"Profiling changes from #1971 are buggy","user":{"login":"myronmarston","id":49391,"node_id":"MDQ6VXNlcjQ5Mzkx","avatar_url":"https://avatars.githubusercontent.com/u/49391?v=4","gravatar_id":"","url":"https://api.github.com/users/myronmarston","html_url":"https://github.com/myronmarston","followers_url":"https://api.github.com/users/myronmarston/followers","following_url":"https://api.github.com/users/myronmarston/following{/other_user}","gists_url":"https://api.github.com/users/myronmarston/gists{/gist_id}","starred_url":"https://api.github.com/users/myronmarston/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/myronmarston/subscriptions","organizations_url":"https://api.github.com/users/myronmarston/orgs","repos_url":"https://api.github.com/users/myronmarston/repos","events_url":"https://api.github.com/users/myronmarston/events{/privacy}","received_events_url":"https://api.github.com/users/myronmarston/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[],"state":"closed","locked":true,"assignee":{"login":"myronmarston","id":49391,"node_id":"MDQ6VXNlcjQ5Mzkx","avatar_url":"https://avatars.githubusercontent.com/u/49391?v=4","gravatar_id":"","url":"https://api.github.com/users/myronmarston","html_url":"https://github.com/myronmarston","followers_url":"https://api.github.com/users/myronmarston/followers","following_url":"https://api.github.com/users/myronmarston/following{/other_user}","gists_url":"https://api.github.com/users/myronmarston/gists{/gist_id}","starred_url":"https://api.github.com/users/myronmarston/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/myronmarston/subscriptions","organizations_url":"https://api.github.com/users/myronmarston/orgs","repos_url":"https://api.github.com/users/myronmarston/repos","events_url":"https://api.github.com/users/myronmarston/events{/privacy}","received_events_url":"https://api.github.com/users/myronmarston/received_events","type":"User","user_view_type":"public","site_admin":false},"assignees":[{"login":"myronmarston","id":49391,"node_id":"MDQ6VXNlcjQ5Mzkx","avatar_url":"https://avatars.githubusercontent.com/u/49391?v=4","gravatar_id":"","url":"https://api.github.com/users/myronmarston","html_url":"https://github.com/myronmarston","followers_url":"https://api.github.com/users/myronmarston/followers","following_url":"https://api.github.com/users/myronmarston/following{/other_user}","gists_url":"https://api.github.com/users/myronmarston/gists{/gist_id}","starred_url":"https://api.github.com/users/myronmarston/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/myronmarston/subscriptions","organizations_url":"https://api.github.com/users/myronmarston/orgs","repos_url":"https://api.github.com/users/myronmarston/repos","events_url":"https://api.github.com/users/myronmarston/events{/privacy}","received_events_url":"https://api.github.com/users/myronmarston/received_events","type":"User","user_view_type":"public","site_admin":false}],"milestone":null,"comments":3,"created_at":"2015-06-11T00:23:48Z","updated_at":"2015-06-12T14:53:11Z","closed_at":"2015-06-12T14:53:11Z","author_association":"MEMBER","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"I  just noticed this output from our spec suite:\n\n```\nTop 5 slowest example groups:\n  Migrations\n    Inf seconds average (13.52 seconds / 0 examples) RSpec::ExampleGroups::Migrations::Sharded::TestingAllRecentMigrations\n  Migrations\n    Inf seconds average (25.85 seconds / 0 examples) RSpec::ExampleGroups::Migrations::Sharded\n  Migrations\n    Inf seconds average (0.68397 seconds / 0 examples) RSpec::ExampleGroups::Migrations::NonSharded\n  the current generated schema dump\n    12.06 seconds average (12.06 seconds / 1 example) RSpec::ExampleGroups::TheCurrentGeneratedSchemaDump\n  Migrations\n    8.85 seconds average (26.54 seconds / 3 examples) RSpec::ExampleGroups::Migrations\n```\n\n\"Inf\" seconds!\n\nThe problem is that `float / 0` returns infinity, and the example count is 0 due to a mismatch in the [profiler](https://github.com/rspec/rspec-core/blob/5778abd5d389d7a20592b047d8f967951838b89d/lib/rspec/core/profiler.rb).  The `example_started` notification only counts the example against the outermost example group, whereas the other notifications update the hash entry for the innermost example group.  As a result, there are entries in the hash that have an example count of 0.\n\nI think we only want to consider the outer example group for the purposes of group comparison anyway, right?  So I'm thinking we will want to use the outer example group for all of those methods.  @JonRowe can you work up a fix?  I think we should hold off releasing 3.3 until this is fixed.\n","closed_by":{"login":"myronmarston","id":49391,"node_id":"MDQ6VXNlcjQ5Mzkx","avatar_url":"https://avatars.githubusercontent.com/u/49391?v=4","gravatar_id":"","url":"https://api.github.com/users/myronmarston","html_url":"https://github.com/myronmarston","followers_url":"https://api.github.com/users/myronmarston/followers","following_url":"https://api.github.com/users/myronmarston/following{/other_user}","gists_url":"https://api.github.com/users/myronmarston/gists{/gist_id}","starred_url":"https://api.github.com/users/myronmarston/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/myronmarston/subscriptions","organizations_url":"https://api.github.com/users/myronmarston/orgs","repos_url":"https://api.github.com/users/myronmarston/repos","events_url":"https://api.github.com/users/myronmarston/events{/privacy}","received_events_url":"https://api.github.com/users/myronmarston/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/rspec/rspec-core/issues/1989/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/rspec/rspec-core/issues/1989/timeline","performed_via_github_app":null,"state_reason":"completed"}