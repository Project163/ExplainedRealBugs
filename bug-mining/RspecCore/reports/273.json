{"url":"https://api.github.com/repos/rspec/rspec-core/issues/1790","repository_url":"https://api.github.com/repos/rspec/rspec-core","labels_url":"https://api.github.com/repos/rspec/rspec-core/issues/1790/labels{/name}","comments_url":"https://api.github.com/repos/rspec/rspec-core/issues/1790/comments","events_url":"https://api.github.com/repos/rspec/rspec-core/issues/1790/events","html_url":"https://github.com/rspec/rspec-core/issues/1790","id":49934138,"node_id":"MDU6SXNzdWU0OTkzNDEzOA==","number":1790,"title":"Consider changing the semantics of shared example group metadata","user":{"login":"myronmarston","id":49391,"node_id":"MDQ6VXNlcjQ5Mzkx","avatar_url":"https://avatars.githubusercontent.com/u/49391?v=4","gravatar_id":"","url":"https://api.github.com/users/myronmarston","html_url":"https://github.com/myronmarston","followers_url":"https://api.github.com/users/myronmarston/followers","following_url":"https://api.github.com/users/myronmarston/following{/other_user}","gists_url":"https://api.github.com/users/myronmarston/gists{/gist_id}","starred_url":"https://api.github.com/users/myronmarston/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/myronmarston/subscriptions","organizations_url":"https://api.github.com/users/myronmarston/orgs","repos_url":"https://api.github.com/users/myronmarston/repos","events_url":"https://api.github.com/users/myronmarston/events{/privacy}","received_events_url":"https://api.github.com/users/myronmarston/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[],"state":"closed","locked":true,"assignee":null,"assignees":[],"milestone":{"url":"https://api.github.com/repos/rspec/rspec-core/milestones/14","html_url":"https://github.com/rspec/rspec-core/milestone/14","labels_url":"https://api.github.com/repos/rspec/rspec-core/milestones/14/labels","id":693817,"node_id":"MDk6TWlsZXN0b25lNjkzODE3","number":14,"title":"4.0","description":"Changes that will go in 4.0","creator":{"login":"myronmarston","id":49391,"node_id":"MDQ6VXNlcjQ5Mzkx","avatar_url":"https://avatars.githubusercontent.com/u/49391?v=4","gravatar_id":"","url":"https://api.github.com/users/myronmarston","html_url":"https://github.com/myronmarston","followers_url":"https://api.github.com/users/myronmarston/followers","following_url":"https://api.github.com/users/myronmarston/following{/other_user}","gists_url":"https://api.github.com/users/myronmarston/gists{/gist_id}","starred_url":"https://api.github.com/users/myronmarston/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/myronmarston/subscriptions","organizations_url":"https://api.github.com/users/myronmarston/orgs","repos_url":"https://api.github.com/users/myronmarston/repos","events_url":"https://api.github.com/users/myronmarston/events{/privacy}","received_events_url":"https://api.github.com/users/myronmarston/received_events","type":"User","user_view_type":"public","site_admin":false},"open_issues":0,"closed_issues":35,"state":"open","created_at":"2014-06-17T17:00:11Z","updated_at":"2024-11-27T20:22:17Z","due_on":null,"closed_at":null},"comments":5,"created_at":"2014-11-24T19:54:15Z","updated_at":"2016-06-05T17:07:44Z","closed_at":"2016-06-05T17:07:44Z","author_association":"MEMBER","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"Currently, you can tag a shared example group definition with some metadata:\n\n``` ruby\nRSpec.shared_context \"DB support\", :db do\n  # ...\nend\n```\n\n...and that will cause the shared example group to be automatically included in matching example groups:\n\n``` ruby\nRSpec.describe MyModelThatUsesTheDB, :db do\n  # ...\nend\n```\n\nThis works fine (and was originally my idea, IIRC), but I've realized a few problems with it:\n- The first argument to `shared_context` (the shared group name) is superfluous.  It feels a bit like \"what's this argument for again?\"  (Note that you could still use it with `include_context` to include the group manually, but it's a bit odd to mix-and-match the approaches).\n- Some users have expressed surprised that the metadata is treated \"special\" here and isn't simply applied to the shared example group like it is applied to a normal example group.\n- It makes it impossible to attach some metadata to a shared example group that will be automatically applied to including example groups.  While no user has asked for this, I've occasionally wanted to temporarily add `:focus`, `:skip` or `:pending` metadata to a shared example group so that that behavior applies to all inclusions of the shared group.\n- There's no obvious way to make a shared example group get auto-included in every example group (e.g. for a global `before` hook or `let` you want to make available everywhere...).  You could do something like `RSpec.shared_context \"...\", :description => //`, since `//` will match the description of every example group, but that's pretty indirect and non-obvious.\n- It doesn't gel well with the scoping behavior of shared contexts (see #1762).\n- It's inconsistent with how module inclusion works (e.g. `config.include mod, *metadata`).\n\nI think we can rectify all of these with a few simple changes:\n- Add a new `config.include_context` API that is similar to `config.include` but is for shared contexts. This would solve the \"no obvious way to auto-include a shared group everywhere\" issue mentioned above and provide a sister API to `config.include` for consistency.\n- Stop using the metadata passed to `shared_context` as a means to determine which example groups should have the context auto-included, instead allowing it the metadata to get applied to including example groups.\n\nThe first change is a new API and could be made in any 3.x release.  The latter is a breaking change and either has to wait until RSpec 4 or we have to add a config option.  I lean towards the latter -- something like `config.use_shared_example_group_metadata_for_auto_inclusion = true` (although that is a bit ambiguous -- the `config.include_context` API would still use it for auto-inclusion -- maybe someone has a better idea?)\n\nThoughts?\n\n/cc @rspec/rspec \n","closed_by":{"login":"myronmarston","id":49391,"node_id":"MDQ6VXNlcjQ5Mzkx","avatar_url":"https://avatars.githubusercontent.com/u/49391?v=4","gravatar_id":"","url":"https://api.github.com/users/myronmarston","html_url":"https://github.com/myronmarston","followers_url":"https://api.github.com/users/myronmarston/followers","following_url":"https://api.github.com/users/myronmarston/following{/other_user}","gists_url":"https://api.github.com/users/myronmarston/gists{/gist_id}","starred_url":"https://api.github.com/users/myronmarston/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/myronmarston/subscriptions","organizations_url":"https://api.github.com/users/myronmarston/orgs","repos_url":"https://api.github.com/users/myronmarston/repos","events_url":"https://api.github.com/users/myronmarston/events{/privacy}","received_events_url":"https://api.github.com/users/myronmarston/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/rspec/rspec-core/issues/1790/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/rspec/rspec-core/issues/1790/timeline","performed_via_github_app":null,"state_reason":"completed"}