[{"actor":{"login":"myronmarston","id":49391,"node_id":"MDQ6VXNlcjQ5Mzkx","avatar_url":"https://avatars.githubusercontent.com/u/49391?v=4","gravatar_id":"","url":"https://api.github.com/users/myronmarston","html_url":"https://github.com/myronmarston","followers_url":"https://api.github.com/users/myronmarston/followers","following_url":"https://api.github.com/users/myronmarston/following{/other_user}","gists_url":"https://api.github.com/users/myronmarston/gists{/gist_id}","starred_url":"https://api.github.com/users/myronmarston/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/myronmarston/subscriptions","organizations_url":"https://api.github.com/users/myronmarston/orgs","repos_url":"https://api.github.com/users/myronmarston/repos","events_url":"https://api.github.com/users/myronmarston/events{/privacy}","received_events_url":"https://api.github.com/users/myronmarston/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2014-11-29T00:03:56Z","updated_at":"2014-11-29T00:03:56Z","source":{"type":"issue","issue":{"url":"https://api.github.com/repos/rspec/rspec-core/issues/1749","repository_url":"https://api.github.com/repos/rspec/rspec-core","labels_url":"https://api.github.com/repos/rspec/rspec-core/issues/1749/labels{/name}","comments_url":"https://api.github.com/repos/rspec/rspec-core/issues/1749/comments","events_url":"https://api.github.com/repos/rspec/rspec-core/issues/1749/events","html_url":"https://github.com/rspec/rspec-core/pull/1749","id":47088401,"node_id":"MDExOlB1bGxSZXF1ZXN0MjM0OTQ4NTQ=","number":1749,"title":"Apply module/shared context inclusion to individual examples","user":{"login":"myronmarston","id":49391,"node_id":"MDQ6VXNlcjQ5Mzkx","avatar_url":"https://avatars.githubusercontent.com/u/49391?v=4","gravatar_id":"","url":"https://api.github.com/users/myronmarston","html_url":"https://github.com/myronmarston","followers_url":"https://api.github.com/users/myronmarston/followers","following_url":"https://api.github.com/users/myronmarston/following{/other_user}","gists_url":"https://api.github.com/users/myronmarston/gists{/gist_id}","starred_url":"https://api.github.com/users/myronmarston/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/myronmarston/subscriptions","organizations_url":"https://api.github.com/users/myronmarston/orgs","repos_url":"https://api.github.com/users/myronmarston/repos","events_url":"https://api.github.com/users/myronmarston/events{/privacy}","received_events_url":"https://api.github.com/users/myronmarston/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[],"state":"closed","locked":true,"assignee":null,"assignees":[],"milestone":null,"comments":45,"created_at":"2014-10-28T22:13:28Z","updated_at":"2015-01-20T05:51:30Z","closed_at":"2015-01-20T05:51:29Z","author_association":"MEMBER","type":null,"active_lock_reason":null,"draft":false,"repository":{"id":238972,"node_id":"MDEwOlJlcG9zaXRvcnkyMzg5NzI=","name":"rspec-core","full_name":"rspec/rspec-core","private":false,"owner":{"login":"rspec","id":22388,"node_id":"MDEyOk9yZ2FuaXphdGlvbjIyMzg4","avatar_url":"https://avatars.githubusercontent.com/u/22388?v=4","gravatar_id":"","url":"https://api.github.com/users/rspec","html_url":"https://github.com/rspec","followers_url":"https://api.github.com/users/rspec/followers","following_url":"https://api.github.com/users/rspec/following{/other_user}","gists_url":"https://api.github.com/users/rspec/gists{/gist_id}","starred_url":"https://api.github.com/users/rspec/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rspec/subscriptions","organizations_url":"https://api.github.com/users/rspec/orgs","repos_url":"https://api.github.com/users/rspec/repos","events_url":"https://api.github.com/users/rspec/events{/privacy}","received_events_url":"https://api.github.com/users/rspec/received_events","type":"Organization","user_view_type":"public","site_admin":false},"html_url":"https://github.com/rspec/rspec-core","description":"RSpec runner and formatters","fork":false,"url":"https://api.github.com/repos/rspec/rspec-core","forks_url":"https://api.github.com/repos/rspec/rspec-core/forks","keys_url":"https://api.github.com/repos/rspec/rspec-core/keys{/key_id}","collaborators_url":"https://api.github.com/repos/rspec/rspec-core/collaborators{/collaborator}","teams_url":"https://api.github.com/repos/rspec/rspec-core/teams","hooks_url":"https://api.github.com/repos/rspec/rspec-core/hooks","issue_events_url":"https://api.github.com/repos/rspec/rspec-core/issues/events{/number}","events_url":"https://api.github.com/repos/rspec/rspec-core/events","assignees_url":"https://api.github.com/repos/rspec/rspec-core/assignees{/user}","branches_url":"https://api.github.com/repos/rspec/rspec-core/branches{/branch}","tags_url":"https://api.github.com/repos/rspec/rspec-core/tags","blobs_url":"https://api.github.com/repos/rspec/rspec-core/git/blobs{/sha}","git_tags_url":"https://api.github.com/repos/rspec/rspec-core/git/tags{/sha}","git_refs_url":"https://api.github.com/repos/rspec/rspec-core/git/refs{/sha}","trees_url":"https://api.github.com/repos/rspec/rspec-core/git/trees{/sha}","statuses_url":"https://api.github.com/repos/rspec/rspec-core/statuses/{sha}","languages_url":"https://api.github.com/repos/rspec/rspec-core/languages","stargazers_url":"https://api.github.com/repos/rspec/rspec-core/stargazers","contributors_url":"https://api.github.com/repos/rspec/rspec-core/contributors","subscribers_url":"https://api.github.com/repos/rspec/rspec-core/subscribers","subscription_url":"https://api.github.com/repos/rspec/rspec-core/subscription","commits_url":"https://api.github.com/repos/rspec/rspec-core/commits{/sha}","git_commits_url":"https://api.github.com/repos/rspec/rspec-core/git/commits{/sha}","comments_url":"https://api.github.com/repos/rspec/rspec-core/comments{/number}","issue_comment_url":"https://api.github.com/repos/rspec/rspec-core/issues/comments{/number}","contents_url":"https://api.github.com/repos/rspec/rspec-core/contents/{+path}","compare_url":"https://api.github.com/repos/rspec/rspec-core/compare/{base}...{head}","merges_url":"https://api.github.com/repos/rspec/rspec-core/merges","archive_url":"https://api.github.com/repos/rspec/rspec-core/{archive_format}{/ref}","downloads_url":"https://api.github.com/repos/rspec/rspec-core/downloads","issues_url":"https://api.github.com/repos/rspec/rspec-core/issues{/number}","pulls_url":"https://api.github.com/repos/rspec/rspec-core/pulls{/number}","milestones_url":"https://api.github.com/repos/rspec/rspec-core/milestones{/number}","notifications_url":"https://api.github.com/repos/rspec/rspec-core/notifications{?since,all,participating}","labels_url":"https://api.github.com/repos/rspec/rspec-core/labels{/name}","releases_url":"https://api.github.com/repos/rspec/rspec-core/releases{/id}","deployments_url":"https://api.github.com/repos/rspec/rspec-core/deployments","created_at":"2009-06-29T15:41:05Z","updated_at":"2025-10-27T11:17:33Z","pushed_at":"2024-11-30T10:40:27Z","git_url":"git://github.com/rspec/rspec-core.git","ssh_url":"git@github.com:rspec/rspec-core.git","clone_url":"https://github.com/rspec/rspec-core.git","svn_url":"https://github.com/rspec/rspec-core","homepage":"http://rspec.info","size":12027,"stargazers_count":1232,"watchers_count":1232,"language":"Ruby","has_issues":true,"has_projects":true,"has_downloads":false,"has_wiki":false,"has_pages":false,"has_discussions":false,"forks_count":752,"mirror_url":null,"archived":true,"disabled":false,"open_issues_count":0,"license":{"key":"mit","name":"MIT License","spdx_id":"MIT","url":"https://api.github.com/licenses/mit","node_id":"MDc6TGljZW5zZTEz"},"allow_forking":true,"is_template":false,"web_commit_signoff_required":false,"topics":["rspec","ruby"],"visibility":"public","forks":752,"open_issues":0,"watchers":1232,"default_branch":"main","permissions":{"admin":false,"maintain":false,"push":false,"triage":false,"pull":true}},"pull_request":{"url":"https://api.github.com/repos/rspec/rspec-core/pulls/1749","html_url":"https://github.com/rspec/rspec-core/pull/1749","diff_url":"https://github.com/rspec/rspec-core/pull/1749.diff","patch_url":"https://github.com/rspec/rspec-core/pull/1749.patch","merged_at":"2015-01-20T05:51:29Z"},"body":"**This is an idea I'm toying with.  I lean towards including it but I'm not totally sold on the idea yet.**\n\n<hr>\n### The problem\n\nWe have two different mechanisms for defining metadata-filtered shared context. On the configuration object:\n\n``` ruby\nRSpec.configure do |config|\n  config.around(:example, :db_1) { |ex| DB.transaction(:always_rollback => true, &ex) }\nend\n```\n\n...and as a shared context:\n\n``` ruby\nRSpec.shared_context \"with a DB transaction\", :db_2 do\n  around(:example) { |ex| DB.transaction(:always_rollback => true, &ex) }\nend\n```\n\nThe latter is generally more useful because `shared_context` supports all rspec-core constructs, including `let`, helper methods, etc...where as the config object only provides the means to define hooks that way.  So I'd consider the latter form to be generally \"better\" but it has a downside:\n\n``` ruby\nRSpec.describe \"Group with both approaches applied\", :db_1, :db_2 do\n  # examples\nend\n\nRSpec.describe \"Group with an example that has both approaches applied\" do\n  it \"does stuff\", :db_1, :db_2 do\n  end\nend\n```\n\nBoth forms work fine in the first example (where the metadata has been applied to the group), but only the config-based approach (`:db_1`) works in the second example.  The problem is that the `shared_context` is included (or not) in example groups, not individual examples, whereas the config can apply just fine.  A user might reasonably expect the 2nd example to work, but as things currently stand, it won't.  I myself have run into this a few times, where I had something that I had defined as a `shared_context` but thought I had defined on `config`, and I tagged an example and it didn't work.\n### Solution\n\nI realized recently that ruby's object model (particularly the `singleton_class`) provides a means to very simply address this issue: we can include modules/shared contexts directly in the singleton class of the example group instance owned by an individual example.  This allows the contents of the module or shared context to apply to one example, but not others in the group.  I'm pleased with how simple the implementation was.\n\nHowever, I'm not 100% sold on this, for a few reasons:\n- It's potentially surprising behavior for people that have a good mental model of example groups vs examples...those users probably wouldn't expect this to work.\n- It feels a little bit \"magical\" (even though in practice, it's actually really simple and is just leveraging ruby's object model).\n- It adds some additional processing to each example when it runs, potentially making RSpec a bit slower.\n- Including a module in an object's singleton class at run time busts the method cache, potentially having an even bigger affect on perf.  (However, every time rspec-mocks features are used, the method cache gets busted since it has to do similar things all the time).\n- There's some slightly odd semantics with `before(:context)`/`after(:context)` hooks that are defined in the shared context.  As currently implemented, when the context is applied to one example, these do not run.  However, they potentially setup and teardown some state that other parts of the context (such as an `around` hook) use, so not running them could cause problems.  I'm on the fence about whether or not they should be run.\n- This could be a breaking change for some folks. Although, I would not consider it a SemVer violation.\n- It's potentially confusing that `config.extend` modules aren't treated the same way.  I didn't think it made sense to apply those modules the same, since they generally define class-level helper methods (e.g. macros) that are called from within a `describe` or `context` block.  (But can anyone thing of a need or use to treat them the same way?)\n### TODO:\n- [x] Get the build to pass on all rubies (I want to discuss this before putting effort into that).\n- [x] Benchmark the perf difference this has.\n- [x] Decide how to handle `:context` hooks.\n- [x] Figure out how this should be documented.\n\nFeedback wanted.\n\n/cc @rspec/rspec \n","reactions":{"url":"https://api.github.com/repos/rspec/rspec-core/issues/1749/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/rspec/rspec-core/issues/1749/timeline","performed_via_github_app":null,"state_reason":null}},"event":"cross-referenced"},{"id":206525616,"node_id":"MDE1OlJlZmVyZW5jZWRFdmVudDIwNjUyNTYxNg==","url":"https://api.github.com/repos/rspec/rspec-core/issues/events/206525616","actor":{"login":"myronmarston","id":49391,"node_id":"MDQ6VXNlcjQ5Mzkx","avatar_url":"https://avatars.githubusercontent.com/u/49391?v=4","gravatar_id":"","url":"https://api.github.com/users/myronmarston","html_url":"https://github.com/myronmarston","followers_url":"https://api.github.com/users/myronmarston/followers","following_url":"https://api.github.com/users/myronmarston/following{/other_user}","gists_url":"https://api.github.com/users/myronmarston/gists{/gist_id}","starred_url":"https://api.github.com/users/myronmarston/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/myronmarston/subscriptions","organizations_url":"https://api.github.com/users/myronmarston/orgs","repos_url":"https://api.github.com/users/myronmarston/repos","events_url":"https://api.github.com/users/myronmarston/events{/privacy}","received_events_url":"https://api.github.com/users/myronmarston/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"referenced","commit_id":"5479838cc7bb9a24111aa709da8f8b0e0cb04007","commit_url":"https://api.github.com/repos/rspec/rspec-core/commits/5479838cc7bb9a24111aa709da8f8b0e0cb04007","created_at":"2014-12-12T00:29:12Z","performed_via_github_app":null},{"id":207975841,"node_id":"MDE1OlJlZmVyZW5jZWRFdmVudDIwNzk3NTg0MQ==","url":"https://api.github.com/repos/rspec/rspec-core/issues/events/207975841","actor":{"login":"myronmarston","id":49391,"node_id":"MDQ6VXNlcjQ5Mzkx","avatar_url":"https://avatars.githubusercontent.com/u/49391?v=4","gravatar_id":"","url":"https://api.github.com/users/myronmarston","html_url":"https://github.com/myronmarston","followers_url":"https://api.github.com/users/myronmarston/followers","following_url":"https://api.github.com/users/myronmarston/following{/other_user}","gists_url":"https://api.github.com/users/myronmarston/gists{/gist_id}","starred_url":"https://api.github.com/users/myronmarston/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/myronmarston/subscriptions","organizations_url":"https://api.github.com/users/myronmarston/orgs","repos_url":"https://api.github.com/users/myronmarston/repos","events_url":"https://api.github.com/users/myronmarston/events{/privacy}","received_events_url":"https://api.github.com/users/myronmarston/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"referenced","commit_id":"cb35a2b2947ce480c65d63ffe1591f2767cdc216","commit_url":"https://api.github.com/repos/rspec/rspec-core/commits/cb35a2b2947ce480c65d63ffe1591f2767cdc216","created_at":"2014-12-15T23:18:23Z","performed_via_github_app":null},{"id":207989904,"node_id":"MDExOkNsb3NlZEV2ZW50MjA3OTg5OTA0","url":"https://api.github.com/repos/rspec/rspec-core/issues/events/207989904","actor":{"login":"myronmarston","id":49391,"node_id":"MDQ6VXNlcjQ5Mzkx","avatar_url":"https://avatars.githubusercontent.com/u/49391?v=4","gravatar_id":"","url":"https://api.github.com/users/myronmarston","html_url":"https://github.com/myronmarston","followers_url":"https://api.github.com/users/myronmarston/followers","following_url":"https://api.github.com/users/myronmarston/following{/other_user}","gists_url":"https://api.github.com/users/myronmarston/gists{/gist_id}","starred_url":"https://api.github.com/users/myronmarston/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/myronmarston/subscriptions","organizations_url":"https://api.github.com/users/myronmarston/orgs","repos_url":"https://api.github.com/users/myronmarston/repos","events_url":"https://api.github.com/users/myronmarston/events{/privacy}","received_events_url":"https://api.github.com/users/myronmarston/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"closed","commit_id":"cb35a2b2947ce480c65d63ffe1591f2767cdc216","commit_url":"https://api.github.com/repos/rspec/rspec-core/commits/cb35a2b2947ce480c65d63ffe1591f2767cdc216","created_at":"2014-12-15T23:51:52Z","state_reason":null,"performed_via_github_app":null},{"id":3941610427,"node_id":"MDE1OlJlZmVyZW5jZWRFdmVudDM5NDE2MTA0Mjc=","url":"https://api.github.com/repos/rspec/rspec-core/issues/events/3941610427","actor":{"login":"MatheusRich","id":20938712,"node_id":"MDQ6VXNlcjIwOTM4NzEy","avatar_url":"https://avatars.githubusercontent.com/u/20938712?v=4","gravatar_id":"","url":"https://api.github.com/users/MatheusRich","html_url":"https://github.com/MatheusRich","followers_url":"https://api.github.com/users/MatheusRich/followers","following_url":"https://api.github.com/users/MatheusRich/following{/other_user}","gists_url":"https://api.github.com/users/MatheusRich/gists{/gist_id}","starred_url":"https://api.github.com/users/MatheusRich/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/MatheusRich/subscriptions","organizations_url":"https://api.github.com/users/MatheusRich/orgs","repos_url":"https://api.github.com/users/MatheusRich/repos","events_url":"https://api.github.com/users/MatheusRich/events{/privacy}","received_events_url":"https://api.github.com/users/MatheusRich/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"referenced","commit_id":"2a81fd04be9534ac9ad0b0c3e2cb278ae9e485aa","commit_url":"https://api.github.com/repos/MatheusRich/rspec-core/commits/2a81fd04be9534ac9ad0b0c3e2cb278ae9e485aa","created_at":"2020-10-30T14:51:04Z","performed_via_github_app":null}]