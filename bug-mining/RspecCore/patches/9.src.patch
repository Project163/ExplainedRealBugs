diff --git a/features/hooks/before_and_after_hooks.feature b/features/hooks/before_and_after_hooks.feature
index 79603419..2790f65c 100644
--- a/features/hooks/before_and_after_hooks.feature
+++ b/features/hooks/before_and_after_hooks.feature
@@ -166,6 +166,10 @@ Feature: before and after hooks
         example "in outer group" do
         end
 
+        after(:all) do
+          puts "outer after all"
+        end
+
         describe "nested group" do
           before(:all) do
             puts "inner before all"
@@ -179,10 +183,6 @@ Feature: before and after hooks
           end
         end
 
-        after(:all) do
-          puts "outer after all"
-        end
-
       end
       """
     When I run "rspec ./before_and_after_all_spec.rb"
@@ -197,6 +197,42 @@ Feature: before and after hooks
     Then I should see "1 example, 0 failures"
     Then I should see matching /outer before all\n.outer after all\n\n\n\nFinished/
 
+  Scenario: before/after all blocks have access to state
+    Given a file named "before_and_after_all_spec.rb" with:
+      """
+      describe "before and after callbacks" do
+        before(:all) do
+          @outer_state = "set in outer before all"
+        end
+
+        example "in outer group" do
+          @outer_state.should eq("set in outer before all")
+        end
+
+        describe "nested group" do
+          before(:all) do
+            @inner_state = "set in inner before all"
+          end
+
+          example "in nested group" do
+            @outer_state.should eq("set in outer before all")
+            @inner_state.should eq("set in inner before all")
+          end
+
+          after(:all) do
+            @inner_state.should eq("set in inner before all")
+          end
+        end
+
+        after(:all) do
+          # p @outer_state.nil?
+          @outer_state.should eq("set in outer before all")
+        end
+      end
+      """
+    When I run "rspec ./before_and_after_all_spec.rb"
+    Then I should see "2 examples, 0 failures"
+
   Scenario: exception in before(:each) is captured and reported as failure
     Given a file named "error_in_before_each_spec.rb" with:
       """
diff --git a/lib/rspec/core/example_group.rb b/lib/rspec/core/example_group.rb
index 9377717f..ad06e0e1 100644
--- a/lib/rspec/core/example_group.rb
+++ b/lib/rspec/core/example_group.rb
@@ -156,13 +156,13 @@ module RSpec
 
       def self.eval_after_alls(running_example)
         return if filtered_examples.empty?
+        before_all_ivars.each { |ivar, val| running_example.instance_variable_set(ivar, val) }
         ancestors.each do |ancestor|
           until ancestor.after_alls.empty?
             running_example.instance_eval &ancestor.after_alls.pop
           end
         end
         world.run_hook(:after, :all, self, running_example)
-        before_all_ivars.keys.each { |ivar| before_all_ivars[ivar] = running_example.instance_variable_get(ivar) }
       end
 
       def self.run(reporter)
diff --git a/spec/rspec/core/example_group_spec.rb b/spec/rspec/core/example_group_spec.rb
index b1ffea47..86c08493 100644
--- a/spec/rspec/core/example_group_spec.rb
+++ b/spec/rspec/core/example_group_spec.rb
@@ -238,6 +238,17 @@ module RSpec::Core
         ]
       end
 
+      it "accesses before(:all) state in after(:all)" do
+        group = ExampleGroup.describe
+        group.before(:all) { @ivar = "value" }
+        group.after(:all)  { @ivar.should eq("value") }
+        group.example("ignore") {  }
+
+        expect do
+          group.run_all
+        end.to_not raise_error
+      end
+
       it "exposes the around each blocks at after_alls" do
         group = ExampleGroup.describe
         group.around(:each) { 'foo' }
