diff --git a/lib/rspec/core/filter_manager.rb b/lib/rspec/core/filter_manager.rb
index a90718f5..72d63f17 100644
--- a/lib/rspec/core/filter_manager.rb
+++ b/lib/rspec/core/filter_manager.rb
@@ -35,12 +35,15 @@ module RSpec
         examples = prune_conditionally_filtered_examples(examples)
 
         if inclusions.standalone?
-          examples.select { |e| include?(e) }
+          examples.select { |e| inclusions.include_example?(e) }
         else
-          locations = inclusions.fetch(:locations) { Hash.new([]) }
-          ids       = inclusions.fetch(:ids)       { Hash.new([]) }
+          locations, ids, non_scoped_inclusions = inclusions.split_file_scoped_rules
 
-          examples.select { |e| priority_include?(e, ids, locations) || (!exclude?(e) && include?(e)) }
+          examples.select do |ex|
+            file_scoped_include?(ex.metadata, ids, locations) do
+              !exclusions.include_example?(ex) && non_scoped_inclusions.include_example?(ex)
+            end
+          end
         end
       end
 
@@ -76,14 +79,6 @@ module RSpec
         inclusions.add(filter_key => filter)
       end
 
-      def exclude?(example)
-        exclusions.include_example?(example)
-      end
-
-      def include?(example)
-        inclusions.include_example?(example)
-      end
-
       def prune_conditionally_filtered_examples(examples)
         examples.reject do |ex|
           meta = ex.metadata
@@ -96,10 +91,14 @@ module RSpec
       # and there is a `:slow => true` exclusion filter), but only for specs
       # defined in the same file as the location filters. Excluded specs in
       # other files should still be excluded.
-      def priority_include?(example, ids, locations)
-        return true if MetadataFilter.filter_applies?(:ids, ids, example.metadata)
-        return false if locations[example.metadata[:absolute_file_path]].empty?
-        MetadataFilter.filter_applies?(:locations, locations, example.metadata)
+      def file_scoped_include?(ex_metadata, ids, locations)
+        no_location_filters = locations[ex_metadata[:absolute_file_path]].empty?
+        no_id_filters = ids[ex_metadata[:rerun_file_path]].empty?
+
+        return yield if no_location_filters && no_id_filters
+
+        MetadataFilter.filter_applies?(:ids, ids, ex_metadata) ||
+        MetadataFilter.filter_applies?(:locations, locations, ex_metadata)
       end
     end
 
@@ -119,8 +118,8 @@ module RSpec
         [exclusions, inclusions]
       end
 
-      def initialize(*args, &block)
-        @rules = Hash.new(*args, &block)
+      def initialize(rules={})
+        @rules = rules
       end
 
       def add(updated)
@@ -196,6 +195,14 @@ module RSpec
         is_standalone_filter?(@rules)
       end
 
+      def split_file_scoped_rules
+        rules_dup = @rules.dup
+        locations = rules_dup.delete(:locations) { Hash.new([]) }
+        ids       = rules_dup.delete(:ids)       { Hash.new([]) }
+
+        return locations, ids, self.class.new(rules_dup)
+      end
+
     private
 
       def apply_standalone_filter(updated)
diff --git a/lib/rspec/core/metadata_filter.rb b/lib/rspec/core/metadata_filter.rb
index e529e3ae..9c58d7f1 100644
--- a/lib/rspec/core/metadata_filter.rb
+++ b/lib/rspec/core/metadata_filter.rb
@@ -53,7 +53,7 @@ module RSpec
 
         def location_filter_applies?(locations, metadata)
           line_numbers = example_group_declaration_lines(locations, metadata)
-          line_numbers.empty? || line_number_filter_applies?(line_numbers, metadata)
+          line_number_filter_applies?(line_numbers, metadata)
         end
 
         def line_number_filter_applies?(line_numbers, metadata)
diff --git a/spec/integration/filtering_spec.rb b/spec/integration/filtering_spec.rb
index a8f3284f..d9a8a179 100644
--- a/spec/integration/filtering_spec.rb
+++ b/spec/integration/filtering_spec.rb
@@ -123,6 +123,28 @@ RSpec.describe 'Filtering' do
       expect(last_cmd_stdout).to match(/3 examples, 0 failures/)
       expect(last_cmd_stdout).not_to match(/fails/)
     end
+
+    it 'applies command line tag filters only to files that lack a line number filter' do
+      write_file_formatted "spec/file_1_spec.rb", "
+        RSpec.describe 'File 1' do
+          it('is selected by line')   { }
+          it('is not selected', :tag) { }
+        end
+      "
+
+      write_file_formatted "spec/file_2_spec.rb", "
+        RSpec.describe 'File 2' do
+          it('is not selected')          { }
+          it('is selected by tag', :tag) { }
+        end
+      "
+
+      run_command "spec/file_1_spec.rb:2 spec/file_2_spec.rb --tag tag -fd"
+      expect(last_cmd_stdout).to include(
+        "2 examples, 0 failures",
+        "is selected by line", "is selected by tag"
+      ).and exclude("not selected")
+    end
   end
 
   context "passing example ids at the command line" do
diff --git a/spec/rspec/core/filter_manager_spec.rb b/spec/rspec/core/filter_manager_spec.rb
index 49f693ef..ab46d9cf 100644
--- a/spec/rspec/core/filter_manager_spec.rb
+++ b/spec/rspec/core/filter_manager_spec.rb
@@ -129,6 +129,25 @@ module RSpec::Core
 
           expect(filter_manager.prune([included, excluded])).to eq([included])
         end
+
+        it "still applies inclusion filters to examples from files with no #{type} filters" do
+          group = RSpec.describe("group")
+          included_via_loc_or_id = group.example("inc via #{type}"); line = __LINE__
+          excluded_via_loc_or_id = group.example("exc via #{type}", :foo)
+
+          included_via_tag, excluded_via_tag = instance_eval <<-EOS, "some/other_spec.rb", 1
+            group = RSpec.describe("group")
+            [group.example("inc via tag", :foo), group.example("exc via tag")]
+          EOS
+
+          add_filter(:line_number => line, :scoped_id => "1:1")
+          filter_manager.include_with_low_priority :foo => true
+
+          expect(filter_manager.prune([
+            included_via_loc_or_id, excluded_via_loc_or_id,
+            included_via_tag, excluded_via_tag
+          ]).map(&:description)).to eq([included_via_loc_or_id, included_via_tag].map(&:description))
+        end
       end
 
       describe "location filtering" do
@@ -299,6 +318,24 @@ module RSpec::Core
           filter_manager.add_ids(Metadata.relative_path(__FILE__), %w[ 2 ])
           expect(filter_manager.prune([ex_1, ex_2, ex_3])).to eq([ex_2, ex_3])
         end
+
+        it 'uses the rerun file path when applying the id filter' do
+          ex_1, ex_2 = instance_eval <<-EOS, "./some/spec.rb", 1
+            ex_1 = ex_2 = nil
+
+            RSpec.shared_examples "shared" do
+              ex_1 = example("ex 1")
+              ex_2 = example("ex 2")
+            end
+
+            [ex_1, ex_2]
+          EOS
+
+          RSpec.describe { include_examples "shared" }
+
+          filter_manager.add_ids(__FILE__, %w[ 1:1 ])
+          expect(filter_manager.prune([ex_1, ex_2]).map(&:description)).to eq([ex_1].map(&:description))
+        end
       end
     end
 
