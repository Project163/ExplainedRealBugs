diff --git a/Changelog.md b/Changelog.md
index 372d0d31..74b18ac2 100644
--- a/Changelog.md
+++ b/Changelog.md
@@ -13,6 +13,10 @@ Enhancements:
 * Removed dependency on pathname from stdlib. (Sam Phippen, #1703)
 * Improve the message presented when a user hits Ctrl-C.
   (Alex Chaffee #1717, #1742)
+* Improve shared example group inclusion backtrace displayed
+  in failed example output so that it works for all methods
+  of including shared example groups and shows all inclusion
+  locations. (Myron Marston, #1763)
 
 ### 3.1.8 Development
 
diff --git a/lib/rspec/core/example_group.rb b/lib/rspec/core/example_group.rb
index d3cb0f77..7b0f820f 100644
--- a/lib/rspec/core/example_group.rb
+++ b/lib/rspec/core/example_group.rb
@@ -594,9 +594,33 @@ module RSpec
     end
 
     # Contains information about the inclusion site of a shared example group.
-    # @attr shared_group_name [String] the name of the shared example group
-    # @attr inclusion_location [String] the location where the shared example was included
-    SharedExampleGroupInclusionStackFrame = Struct.new(:shared_group_name, :inclusion_location) do
+    class SharedExampleGroupInclusionStackFrame
+      # @return [String] the name of the shared example group
+      attr_reader :shared_group_name
+      # @return [String] the location where the shared example was included
+      attr_reader :inclusion_location
+
+      def initialize(shared_group_name, inclusion_location)
+        @shared_group_name  = shared_group_name
+        @inclusion_location = inclusion_location
+      end
+
+      # @return [String] The {#inclusion_location}, formatted for display by a formatter.
+      def formatted_inclusion_location
+        @formatted_inclusion_location ||= begin
+          RSpec.configuration.backtrace_formatter.backtrace_line(
+            inclusion_location.sub(/(:\d+):in .+$/, '\1')
+          )
+        end
+      end
+
+      # @return [String] Description of this stack frame, in the form used by
+      #   RSpec's built-in formatters.
+      def description
+        @description ||= "Shared Example Group: #{shared_group_name.inspect} " \
+          "called from #{formatted_inclusion_location}"
+      end
+
       # @private
       def self.current_backtrace
         RSpec.thread_local_metadata[:shared_example_group_inclusions].reverse
diff --git a/lib/rspec/core/notifications.rb b/lib/rspec/core/notifications.rb
index 5173a012..1122d6d7 100644
--- a/lib/rspec/core/notifications.rb
+++ b/lib/rspec/core/notifications.rb
@@ -153,7 +153,7 @@ module RSpec::Core
       #
       # @return [Array(String)] The example failure message
       def message_lines
-        add_shared_group_line(failure_lines, NullColorizer)
+        add_shared_group_lines(failure_lines, NullColorizer)
       end
 
       # Returns the message generated for this failure colorized line by line.
@@ -161,7 +161,7 @@ module RSpec::Core
       # @param colorizer [#wrap] An object to colorize the message_lines by
       # @return [Array(String)] The example failure message colorized
       def colorized_message_lines(colorizer=::RSpec::Core::Formatters::ConsoleCodes)
-        add_shared_group_line(failure_lines, colorizer).map do |line|
+        add_shared_group_lines(failure_lines, colorizer).map do |line|
           colorizer.wrap line, RSpec.configuration.failure_color
         end
       end
@@ -232,29 +232,12 @@ module RSpec::Core
           end
       end
 
-      def add_shared_group_line(lines, colorizer)
-        unless shared_group_line == ""
-          lines << colorizer.wrap(shared_group_line, RSpec.configuration.default_color)
+      def add_shared_group_lines(lines, colorizer)
+        example.metadata[:shared_group_inclusion_backtrace].each do |frame|
+          lines << colorizer.wrap(frame.description, RSpec.configuration.default_color)
         end
-        lines
-      end
-
-      def shared_group
-        @shared_group ||= group_and_parent_groups.find { |group| group.metadata[:shared_group_name] }
-      end
 
-      def shared_group_line
-        @shared_group_line ||=
-          if shared_group
-            "Shared Example Group: \"#{shared_group.metadata[:shared_group_name]}\"" \
-             " called from #{backtrace_formatter.backtrace_line(shared_group.location)}"
-          else
-            ""
-          end
-      end
-
-      def group_and_parent_groups
-        example.example_group.parent_groups + [example.example_group]
+        lines
       end
 
       def read_failed_line
diff --git a/spec/rspec/core/formatters/base_text_formatter_spec.rb b/spec/rspec/core/formatters/base_text_formatter_spec.rb
index 16eb163f..51dbddc7 100644
--- a/spec/rspec/core/formatters/base_text_formatter_spec.rb
+++ b/spec/rspec/core/formatters/base_text_formatter_spec.rb
@@ -129,40 +129,71 @@ RSpec.describe RSpec::Core::Formatters::BaseTextFormatter do
       end
     end
 
-    context 'for #shared_examples' do
-      it 'outputs the name and location' do
-        group.shared_examples 'foo bar' do
-          it("example name") { expect("this").to eq("that") }
-        end
-
-        line = __LINE__.next
-        group.it_should_behave_like('foo bar')
-
-        run_all_and_dump_failures
-
-        expect(output.string).to include(
-          'Shared Example Group: "foo bar" called from ' +
-            "#{RSpec::Core::Metadata.relative_path(__FILE__)}:#{line}"
-        )
-      end
-
-      context 'that contains nested example groups' do
+    %w[ include_examples it_should_behave_like ].each do |inclusion_method|
+      context "for #shared_examples included using #{inclusion_method}" do
         it 'outputs the name and location' do
           group.shared_examples 'foo bar' do
-            describe 'nested group' do
-              it("example name") { expect("this").to eq("that") }
-            end
+            it("example name") { expect("this").to eq("that") }
           end
 
           line = __LINE__.next
-          group.it_should_behave_like('foo bar')
+          group.__send__(inclusion_method, 'foo bar')
 
           run_all_and_dump_failures
 
-          expect(output.string).to include(
+          expect(output.string.lines).to include(a_string_ending_with(
             'Shared Example Group: "foo bar" called from ' +
-              "./spec/rspec/core/formatters/base_text_formatter_spec.rb:#{line}"
-          )
+              "#{RSpec::Core::Metadata.relative_path(__FILE__)}:#{line}\n"
+          ))
+        end
+
+        context 'that contains nested example groups' do
+          it 'outputs the name and location' do
+            group.shared_examples 'foo bar' do
+              describe 'nested group' do
+                it("example name") { expect("this").to eq("that") }
+              end
+            end
+
+            line = __LINE__.next
+            group.__send__(inclusion_method, 'foo bar')
+
+            run_all_and_dump_failures
+
+            expect(output.string.lines).to include(a_string_ending_with(
+              'Shared Example Group: "foo bar" called from ' +
+                "./spec/rspec/core/formatters/base_text_formatter_spec.rb:#{line}\n"
+            ))
+          end
+        end
+
+        context "that contains shared group nesting" do
+          it 'includes each inclusion location in the output' do
+            group.shared_examples "inner" do
+              example { expect(1).to eq(2) }
+            end
+
+            inner_line = __LINE__ + 2
+            group.shared_examples "outer" do
+              __send__(inclusion_method, "inner")
+            end
+
+            outer_line = __LINE__ + 1
+            group.__send__(inclusion_method, 'outer')
+
+            run_all_and_dump_failures
+
+            expect(output.string.lines.grep(/Shared Example Group/)).to match [
+              a_string_ending_with(
+                'Shared Example Group: "inner" called from ' +
+                  "./spec/rspec/core/formatters/base_text_formatter_spec.rb:#{inner_line}\n"
+              ),
+              a_string_ending_with(
+                'Shared Example Group: "outer" called from ' +
+                  "./spec/rspec/core/formatters/base_text_formatter_spec.rb:#{outer_line}\n"
+              ),
+            ]
+          end
         end
       end
     end
diff --git a/spec/rspec/core/notifications_spec.rb b/spec/rspec/core/notifications_spec.rb
index 2d3eded4..47f0ac93 100644
--- a/spec/rspec/core/notifications_spec.rb
+++ b/spec/rspec/core/notifications_spec.rb
@@ -83,7 +83,9 @@ RSpec.describe "FailedExampleNotification" do
     end
 
     it 'returns failures_lines without color when they are part of a shared example group' do
-      allow(example_group).to receive(:metadata) { {:shared_group_name => 'double shared group'} }
+      example.metadata[:shared_group_inclusion_backtrace] <<
+        RSpec::Core::SharedExampleGroupInclusionStackFrame.new("foo", "bar")
+
       lines = notification.message_lines
       expect(lines[0]).to match %r{\AFailure\/Error}
       expect(lines[1]).to match %r{\A\s*Test exception\z}
diff --git a/spec/support/formatter_support.rb b/spec/support/formatter_support.rb
index 64455f16..50df7105 100644
--- a/spec/support/formatter_support.rb
+++ b/spec/support/formatter_support.rb
@@ -203,7 +203,9 @@ module FormatterSupport
                         :full_description  => "Example",
                         :execution_result  => result,
                         :location          => "",
-                        :metadata          => {}
+                        :metadata          => {
+                          :shared_group_inclusion_backtrace => []
+                        }
                        )
       end
   end
