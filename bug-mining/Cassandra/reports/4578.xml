<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 23:05:50 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-13021] Nodetool compactionstats fails with NullPointerException</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-13021</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;Found in 3.0.10:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;$ nodetool compactionstats
pending tasks: 2
error: &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;
-- StackTrace --
java.lang.NullPointerException
        at org.apache.cassandra.tools.nodetool.CompactionStats.addLine(CompactionStats.java:102)
        at org.apache.cassandra.tools.nodetool.CompactionStats.execute(CompactionStats.java:70)
        at org.apache.cassandra.tools.NodeTool$NodeToolCmd.run(NodeTool.java:247)
        at org.apache.cassandra.tools.NodeTool.main(NodeTool.java:161)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment>&lt;p&gt;3.0.10&lt;/p&gt;</environment>
        <key id="13026797">CASSANDRA-13021</key>
            <summary>Nodetool compactionstats fails with NullPointerException</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10002" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Normal</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="jay.zhuang">Jay Zhuang</assignee>
                                    <reporter username="jay.zhuang">Jay Zhuang</reporter>
                        <labels>
                    </labels>
                <created>Thu, 8 Dec 2016 21:53:01 +0000</created>
                <updated>Tue, 16 Apr 2019 09:30:13 +0000</updated>
                            <resolved>Tue, 13 Dec 2016 12:38:14 +0000</resolved>
                                        <fixVersion>3.0.11</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="15733661" author="jay.zhuang" created="Thu, 8 Dec 2016 23:03:19 +0000"  >&lt;p&gt;Please review:&lt;br/&gt;
&lt;a href=&quot;https://github.com/cooldoger/cassandra/tree/13021-3.0&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/cooldoger/cassandra/tree/13021-3.0&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15737420" author="jasonstack" created="Sat, 10 Dec 2016 07:28:58 +0000"  >&lt;p&gt;quite curious when the value will be NULL.&lt;/p&gt;

&lt;p&gt;maybe using ` &quot;null&quot;.length() ` is more clear than `4`&lt;/p&gt;</comment>
                            <comment id="15738690" author="jay.zhuang" created="Sat, 10 Dec 2016 23:50:43 +0000"  >&lt;p&gt;Make sense. Updated.&lt;/p&gt;</comment>
                            <comment id="15741957" author="jasobrown" created="Mon, 12 Dec 2016 13:56:02 +0000"  >&lt;p&gt;ftr, it looks like &lt;tt&gt;CompactionInfo#asMap&lt;/tt&gt; can return &lt;tt&gt;null&lt;/tt&gt; for some of those values that are in the map, as there are fields in {[CompactionInfo}} that are allowed to be null.&lt;/p&gt;

&lt;p&gt;wrt to the patch, it looks like this behavior is in 2.2, at least, and 3.0. Things were refactored in 3.X and there is an equivalent &lt;a href=&quot;https://github.com/apache/cassandra/blob/cassandra-3.X/src/java/org/apache/cassandra/tools/nodetool/formatter/TableBuilder.java#L80&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;null check already&lt;/a&gt;. I propose you use 1 as your space marker (like 3.X and up), instead of 4 or the length of an arbitrary string. wdyt?&lt;/p&gt;</comment>
                            <comment id="15743333" author="jay.zhuang" created="Mon, 12 Dec 2016 22:19:12 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jasobrown&quot; class=&quot;user-hover&quot; rel=&quot;jasobrown&quot;&gt;jasobrown&lt;/a&gt; Thanks for the review.&lt;br/&gt;
Updated the patch to use 1 and print empty string instead of &quot;null&quot;. Which will be consistent with 3.X.&lt;/p&gt;

&lt;p&gt;In 3.x, null value is printed as empty: &lt;a href=&quot;https://github.com/apache/cassandra/blob/cassandra-3.X/src/java/org/apache/cassandra/tools/nodetool/formatter/TableBuilder.java#L96&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/cassandra/blob/cassandra-3.X/src/java/org/apache/cassandra/tools/nodetool/formatter/TableBuilder.java#L96&lt;/a&gt;&lt;br/&gt;
But in 3.0, it&apos;s printed as string &lt;tt&gt;&quot;null&quot;&lt;/tt&gt;: &lt;a href=&quot;https://github.com/apache/cassandra/blob/cassandra-3.0/src/java/org/apache/cassandra/tools/nodetool/CompactionStats.java#L86&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/cassandra/blob/cassandra-3.0/src/java/org/apache/cassandra/tools/nodetool/CompactionStats.java#L86&lt;/a&gt; &lt;/p&gt;

&lt;p&gt;sample output when id is null:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;$ ./nodetool compactionstats
pending tasks: 1
   id   compaction type                keyspace        table     completed          total    unit   progress
             Compaction   this_is_test_keyspace   test_table   38987528168   108264402785   bytes     36.01%
Active compaction remaining time :   0h05m30s
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12842886/13021-3.0-update2.txt&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;13021-3.0-update2.txt&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15745054" author="jasobrown" created="Tue, 13 Dec 2016 12:38:16 +0000"  >&lt;p&gt;lgtm, +1&lt;/p&gt;

&lt;p&gt;committed only to 3.0 as sha 5d8f6c64c40612462bbecaef8e21c0f7baf5b815&lt;/p&gt;</comment>
                            <comment id="16133319" author="s_delima" created="Fri, 18 Aug 2017 17:28:11 +0000"  >&lt;p&gt;Can you please backport this to 2.2?&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12842684" name="13021-3.0-update.txt" size="1240" author="jay.zhuang" created="Sat, 10 Dec 2016 23:49:37 +0000"/>
                            <attachment id="12842886" name="13021-3.0-update2.txt" size="1822" author="jay.zhuang" created="Mon, 12 Dec 2016 22:20:49 +0000"/>
                            <attachment id="12842439" name="13021-3.0.txt" size="1219" author="jay.zhuang" created="Thu, 8 Dec 2016 23:03:44 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[jay.zhuang]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 13 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i37dbb:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12311421" key="com.atlassian.jira.plugin.system.customfieldtypes:multiversion">
                        <customfieldname>Reproduced In</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="12338291">3.0.10</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>jasobrown</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[jasobrown]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12962"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>