<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 22:19:28 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-2212] Cannot get range slice of super columns in reversed order</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-2212</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;I cannot get range slice of super columns in reversed order.  These data are stored in Cassandra in advance.  On the other hand, range slice of these data in normal order can be acquired.&lt;/p&gt;

&lt;p&gt;You can reproduce the bug by executing attached programs.  &lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;1. Start Cassandra daemon on localhost (number of thrift port is 9160)&lt;/li&gt;
	&lt;li&gt;2. Create keyspace and column family, according to &quot;create_table.cli&quot;,&lt;/li&gt;
	&lt;li&gt;3. Execute &quot;cassandra_sample_insert.py&quot;, storing pairs of row keys and super columns&lt;/li&gt;
	&lt;li&gt;4. Execute &quot;cassandra_sample_rangeslice.py&quot; and get range slice of stored super columns&lt;br/&gt;
&quot;cassandra_sample_insert.py&quot; and &quot;cassandra_sample_rangeslice.py&quot; require pycassa.  &lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;You will need to execute 4.&quot;cassandra_sample_rangeslice.py&quot; with following options so that you get range slice of super columns in reversed order.  &lt;/p&gt;

&lt;p&gt; % python cassandra_sample_rangeslice.py -r 00082 00083&lt;/p&gt;

&lt;p&gt;On the other hand, to get range slice in normal order, you will need to use following options.  &lt;/p&gt;

&lt;p&gt; % python cassandra_sample_rangeslice.py -f 00082 00083&lt;/p&gt;

&lt;p&gt;00082 and 00083 are the specified key range.  Range slice can be acquired in normal order but, I cannot get it in reversed order.  &lt;/p&gt;

&lt;p&gt;I assume that there may be a bug within the code for acquiring the index block of specified range.  In fact, 00083 is included in gap between lastName of index block and firstName of next index block.   &lt;/p&gt;</description>
                <environment>&lt;p&gt;Fedore 11, Intel Core i5&lt;/p&gt;</environment>
        <key id="12499291">CASSANDRA-2212</key>
            <summary>Cannot get range slice of super columns in reversed order</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10002" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Normal</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="slebresne">Sylvain Lebresne</assignee>
                                    <reporter username="muga_nishizawa">Muga Nishizawa</reporter>
                        <labels>
                    </labels>
                <created>Tue, 22 Feb 2011 02:36:19 +0000</created>
                <updated>Tue, 16 Apr 2019 09:33:06 +0000</updated>
                            <resolved>Wed, 23 Feb 2011 17:55:14 +0000</resolved>
                                        <fixVersion>0.6.13</fixVersion>
                    <fixVersion>0.7.3</fixVersion>
                                        <due></due>
                            <votes>1</votes>
                                    <watches>3</watches>
                                    <workratio workratioPercent="0"/>
                                    <progress percentage="0">
                                    <originalProgress>
                                                    <row percentage="100" backgroundColor="#89afd7"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="0" backgroundColor="#51a825"/>
                                                    <row percentage="100" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="0">
                                    <originalProgress>
                                                    <row percentage="100" backgroundColor="#89afd7"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="0" backgroundColor="#51a825"/>
                                                    <row percentage="100" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                    <timeoriginalestimate seconds="21600">6h</timeoriginalestimate>
                            <timeestimate seconds="21600">6h</timeestimate>
                                        <comments>
                            <comment id="12997642" author="thobbs" created="Tue, 22 Feb 2011 05:11:53 +0000"  >&lt;p&gt;I am able to reproduce this with revision r1072164 (from Feb. 18, a couple days after 0.7.2) on a single node.  Other column ranges work as expected for reversed slices.&lt;/p&gt;</comment>
                            <comment id="12998394" author="slebresne" created="Wed, 23 Feb 2011 14:53:17 +0000"  >&lt;p&gt;Thanks a lot Muga for the test script, and you are right, this a bug in getting the index block during reverse queries.&lt;/p&gt;

&lt;p&gt;Patch attached with unit tests for IndexHelper.&lt;/p&gt;</comment>
                            <comment id="12998456" author="jbellis" created="Wed, 23 Feb 2011 17:15:38 +0000"  >&lt;p&gt;Sylvain, can you summarize the bug and how this patch fixes it?&lt;/p&gt;</comment>
                            <comment id="12998462" author="slebresne" created="Wed, 23 Feb 2011 17:32:15 +0000"  >&lt;p&gt;Sure.&lt;/p&gt;

&lt;p&gt;The problem is that we were not picking the right index slot for reverse query. Let&apos;s take the example from the unit test, and say your index look like this:&lt;br/&gt;
  &lt;span class=&quot;error&quot;&gt;&amp;#91;0..5&amp;#93;&lt;/span&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;10..15&amp;#93;&lt;/span&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;20..25&amp;#93;&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;And say you look for the slice &lt;span class=&quot;error&quot;&gt;&amp;#91;13..17&amp;#93;&lt;/span&gt;. When doing forward slice, we we doing a binary search comparing 13 (the start of the query) to the lastName part of the index slot, which is fine. You&apos;ll end up with the &quot;first&quot; slot, going from left to right, that may contain the start.&lt;/p&gt;

&lt;p&gt;When doing a reverse query, we were doing the same thing, only using as a start column the end of the query, aka 17 in my example. However, comparing 17 with the lastName of each index slot, you end up selecting the last slot, which is wrong (the slice exit early since 17 is not in the range).&lt;/p&gt;

&lt;p&gt;What you want to do is pick the &quot;first&quot; slot, but now going from right to left, that may contain start. So you want to find the slot where firstName &amp;gt; start and take the slot just before.&lt;/p&gt;

&lt;p&gt;I hope I&apos;m clear. Anyway, that&apos;s what the patch does. &lt;/p&gt;</comment>
                            <comment id="12998472" author="jbellis" created="Wed, 23 Feb 2011 17:55:14 +0000"  >&lt;p&gt;committed, with your explanation added as a comment to indexFor &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="12998502" author="hudson" created="Wed, 23 Feb 2011 18:54:06 +0000"  >&lt;p&gt;Integrated in Cassandra-0.7 #311 (See &lt;a href=&quot;https://hudson.apache.org/hudson/job/Cassandra-0.7/311/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://hudson.apache.org/hudson/job/Cassandra-0.7/311/&lt;/a&gt;)&lt;br/&gt;
    fix reversed slice queries on large rows&lt;br/&gt;
patch by slebresne; reviewed by jbellis for &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-2212&quot; title=&quot;Cannot get range slice of super columns in reversed order&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-2212&quot;&gt;&lt;del&gt;CASSANDRA-2212&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13008370" author="paulrbrown" created="Fri, 18 Mar 2011 08:13:37 +0000"  >&lt;p&gt;I think that I have a situation where this occurs against 0.6.8 as well.  Is this fix suitable for backporting onto 0.6?&lt;/p&gt;</comment>
                            <comment id="13008446" author="slebresne" created="Fri, 18 Mar 2011 14:17:07 +0000"  >&lt;p&gt;Attaching patch against 0.6&lt;/p&gt;</comment>
                            <comment id="13008559" author="jbellis" created="Fri, 18 Mar 2011 18:11:34 +0000"  >&lt;p&gt;committed for 0.6.13&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12471739" name="0001-Fix-IndexHelp.indexFor-for-reverse-query.patch" size="7243" author="slebresne" created="Wed, 23 Feb 2011 14:53:17 +0000"/>
                            <attachment id="12473997" name="2212_0.6.patch" size="7123" author="slebresne" created="Fri, 18 Mar 2011 14:17:07 +0000"/>
                            <attachment id="12471596" name="cassandra_sample_insert.py" size="1305" author="muga_nishizawa" created="Tue, 22 Feb 2011 02:39:53 +0000"/>
                            <attachment id="12471597" name="cassandra_sample_rangeslice.py" size="961" author="muga_nishizawa" created="Tue, 22 Feb 2011 02:40:07 +0000"/>
                            <attachment id="12471595" name="create_table.cli" size="134" author="muga_nishizawa" created="Tue, 22 Feb 2011 02:39:32 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>5.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[slebresne]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>20508</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            14 years, 36 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0ga07:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>93051</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>jbellis</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[jbellis]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12962"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>