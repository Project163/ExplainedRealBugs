<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 22:48:52 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-8066] High Heap Consumption due to high number of SSTableReader</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-8066</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;Given a workload with quite a lot of reads, I recently encountered high heap memory consumption. Given 2GB of Heap, it appears I have 750.000+ tasks in SSTableReader.syncExecutor, consuming more than 1.2GB. These tasks have type SSTableReader$5, which I guess corresponds to :&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;readMeterSyncFuture = syncExecutor.scheduleAtFixedRate(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;Runnable&lt;/span&gt;()
{
&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void run()
{
&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (!isCompacted.get())
{
meterSyncThrottle.acquire();
SystemKeyspace.persistSSTableReadMeter(desc.ksname, desc.cfname, desc.generation, readMeter);
}
}
}, 1, 5, TimeUnit.MINUTES);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I do not have have to the environment right now, but I could provide a threaddump later if necessary.&lt;/p&gt;</description>
                <environment>&lt;p&gt;Cassandra 2.1.0&lt;/p&gt;</environment>
        <key id="12746341">CASSANDRA-8066</key>
            <summary>High Heap Consumption due to high number of SSTableReader</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10002" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Normal</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="tjake">T Jake Luciani</assignee>
                                    <reporter username="blasd">Benoit Lacelle</reporter>
                        <labels>
                    </labels>
                <created>Tue, 7 Oct 2014 07:39:17 +0000</created>
                <updated>Tue, 16 Apr 2019 09:31:32 +0000</updated>
                            <resolved>Tue, 14 Oct 2014 12:58:37 +0000</resolved>
                                        <fixVersion>2.1.1</fixVersion>
                                    <component>Legacy/Local Write-Read Paths</component>
                    <component>Local/Compaction</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="14165441" author="tjake" created="Thu, 9 Oct 2014 17:59:35 +0000"  >&lt;p&gt;I suspect the early opening and re-opening of  sstables during compaction is creating many entries in the queue.&lt;/p&gt;

&lt;p&gt;We should perhaps postpone this read meter tracking until the sstable has been fully written.&lt;/p&gt;
</comment>
                            <comment id="14169630" author="tjake" created="Mon, 13 Oct 2014 17:52:01 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=blasd&quot; class=&quot;user-hover&quot; rel=&quot;blasd&quot;&gt;blasd&lt;/a&gt; Could you describe your schema for me?   How much data is on this node?&lt;/p&gt;</comment>
                            <comment id="14169722" author="blasd" created="Mon, 13 Oct 2014 18:38:00 +0000"  >&lt;p&gt;I have a single node. The schema holds around 8 tables. A few of them are counter tables.&lt;/p&gt;

&lt;p&gt;I regularly run nearly-full scan on on a not-counter table. Else, it is mainly an equivalent of reads and writes on 2 given tables. These tables have a few million of rows.&lt;/p&gt;

&lt;p&gt;Do you need more details?&lt;/p&gt;</comment>
                            <comment id="14169740" author="tjake" created="Mon, 13 Oct 2014 18:46:34 +0000"  >&lt;blockquote&gt;&lt;p&gt;Do you need more details?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Yes actual data size and number of sstables in the largest keyspace&lt;/p&gt;</comment>
                            <comment id="14169775" author="blasd" created="Mon, 13 Oct 2014 19:08:25 +0000"  >&lt;p&gt;Here is the output for nodetool cfstats&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;Keyspace: prod_7
	Read Count: 1424130
	Read Latency: 3.122707294980093 ms.
	Write Count: 8808265
	Write Latency: 0.03234213866181365 ms.
	Pending Flushes: 0
		Table: alerts
		SSTable count: 2
		Space used (live), bytes: 10237
		Space used (total), bytes: 10237
		Space used by snapshots (total), bytes: 0
		SSTable Compression Ratio: 0.6354418105671432
		Memtable cell count: 0
		Memtable data size, bytes: 0
		Memtable &lt;span class=&quot;code-keyword&quot;&gt;switch&lt;/span&gt; count: 0
		Local read count: 0
		Local read latency: NaN ms
		Local write count: 0
		Local write latency: NaN ms
		Pending flushes: 0
		Bloom filter &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt; positives: 0
		Bloom filter &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt; ratio: 0.00000
		Bloom filter space used, bytes: 32
		Compacted partition minimum bytes: 259
		Compacted partition maximum bytes: 372
		Compacted partition mean bytes: 341
		Average live cells per slice (last five minutes): 0.0
		Average tombstones per slice (last five minutes): 0.0

		Table: details
		SSTable count: 103
		Space used (live), bytes: 578266489
		Space used (total), bytes: 578266489
		Space used by snapshots (total), bytes: 0
		SSTable Compression Ratio: 0.724988344517149
		Memtable cell count: 67212
		Memtable data size, bytes: 18468770
		Memtable &lt;span class=&quot;code-keyword&quot;&gt;switch&lt;/span&gt; count: 23
		Local read count: 6
		Local read latency: 10.742 ms
		Local write count: 2036971
		Local write latency: 0.017 ms
		Pending flushes: 0
		Bloom filter &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt; positives: 0
		Bloom filter &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt; ratio: 0.00000
		Bloom filter space used, bytes: 5136
		Compacted partition minimum bytes: 87
		Compacted partition maximum bytes: 129557750
		Compacted partition mean bytes: 2595076
		Average live cells per slice (last five minutes): 0.3333333333333333
		Average tombstones per slice (last five minutes): 0.0

		Table: domains
		SSTable count: 21
		Space used (live), bytes: 122407
		Space used (total), bytes: 122407
		Space used by snapshots (total), bytes: 0
		SSTable Compression Ratio: 0.5848437821906775
		Memtable cell count: 238238
		Memtable data size, bytes: 2793
		Memtable &lt;span class=&quot;code-keyword&quot;&gt;switch&lt;/span&gt; count: 1
		Local read count: 60281
		Local read latency: 0.162 ms
		Local write count: 402903
		Local write latency: 0.012 ms
		Pending flushes: 0
		Bloom filter &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt; positives: 25
		Bloom filter &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt; ratio: 0.08929
		Bloom filter space used, bytes: 664
		Compacted partition minimum bytes: 87
		Compacted partition maximum bytes: 372
		Compacted partition mean bytes: 171
		Average live cells per slice (last five minutes): 0.9985401459854014
		Average tombstones per slice (last five minutes): 0.0

		Table: domains_statistics
		SSTable count: 7
		Space used (live), bytes: 302413
		Space used (total), bytes: 302413
		Space used by snapshots (total), bytes: 0
		SSTable Compression Ratio: 0.6144160676068052
		Memtable cell count: 849893
		Memtable data size, bytes: 42569
		Memtable &lt;span class=&quot;code-keyword&quot;&gt;switch&lt;/span&gt; count: 1
		Local read count: 60511
		Local read latency: 0.141 ms
		Local write count: 1055892
		Local write latency: 0.013 ms
		Pending flushes: 0
		Bloom filter &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt; positives: 0
		Bloom filter &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt; ratio: 0.00000
		Bloom filter space used, bytes: 416
		Compacted partition minimum bytes: 87
		Compacted partition maximum bytes: 24601
		Compacted partition mean bytes: 3795
		Average live cells per slice (last five minutes): 0.9894160583941606
		Average tombstones per slice (last five minutes): 0.0

		Table: latest_urls
		SSTable count: 3
		Space used (live), bytes: 10239518
		Space used (total), bytes: 10239518
		Space used by snapshots (total), bytes: 559781
		SSTable Compression Ratio: 0.20808927427548127
		Memtable cell count: 0
		Memtable data size, bytes: 0
		Memtable &lt;span class=&quot;code-keyword&quot;&gt;switch&lt;/span&gt; count: 0
		Local read count: 0
		Local read latency: NaN ms
		Local write count: 0
		Local write latency: NaN ms
		Pending flushes: 0
		Bloom filter &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt; positives: 0
		Bloom filter &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt; ratio: 0.00000
		Bloom filter space used, bytes: 1400
		Compacted partition minimum bytes: 125
		Compacted partition maximum bytes: 5839588
		Compacted partition mean bytes: 457273
		Average live cells per slice (last five minutes): 0.0
		Average tombstones per slice (last five minutes): 0.0

		Table: prices
		SSTable count: 65
		Space used (live), bytes: 1352522066
		Space used (total), bytes: 1352522066
		Space used by snapshots (total), bytes: 0
		SSTable Compression Ratio: 0.5120312303948739
		Memtable cell count: 34010
		Memtable data size, bytes: 8204495
		Memtable &lt;span class=&quot;code-keyword&quot;&gt;switch&lt;/span&gt; count: 23
		Local read count: 1235465
		Local read latency: 1.262 ms
		Local write count: 1073392
		Local write latency: 0.028 ms
		Pending flushes: 0
		Bloom filter &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt; positives: 0
		Bloom filter &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt; ratio: 0.00000
		Bloom filter space used, bytes: 4024
		Compacted partition minimum bytes: 150
		Compacted partition maximum bytes: 802187438
		Compacted partition mean bytes: 16664521
		Average live cells per slice (last five minutes): 3.2496266587883915
		Average tombstones per slice (last five minutes): 0.0

		Table (index): urls.price_bucket
		SSTable count: 2
		SSTables in each level: [2, 0, 0, 0, 0, 0, 0, 0, 0]
		Space used (live), bytes: -63707053
		Space used (total), bytes: -63707053
		Space used by snapshots (total), bytes: 0
		SSTable Compression Ratio: 0.25296860730951387
		Memtable cell count: 3313
		Memtable data size, bytes: 581313
		Memtable &lt;span class=&quot;code-keyword&quot;&gt;switch&lt;/span&gt; count: 0
		Local read count: 229
		Local read latency: 0.611 ms
		Local write count: 2849164
		Local write latency: 0.019 ms
		Pending flushes: 0
		Bloom filter &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt; positives: 0
		Bloom filter &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt; ratio: 0.00000
		Bloom filter space used, bytes: 4944
		Compacted partition minimum bytes: 73
		Compacted partition maximum bytes: 107964792
		Compacted partition mean bytes: 72761
		Average live cells per slice (last five minutes): 6.9475982532751095
		Average tombstones per slice (last five minutes): 0.043668122270742356

		Table: urls
		SSTable count: 8
		SSTables in each level: [1, 7, 0, 0, 0, 0, 0, 0, 0]
		Space used (live), bytes: 1559974255
		Space used (total), bytes: 1559974255
		Space used by snapshots (total), bytes: 0
		SSTable Compression Ratio: 0.245083421589559
		Memtable cell count: 18694
		Memtable data size, bytes: 2717755
		Memtable &lt;span class=&quot;code-keyword&quot;&gt;switch&lt;/span&gt; count: 76
		Local read count: 67637
		Local read latency: 42.431 ms
		Local write count: 1389930
		Local write latency: 0.110 ms
		Pending flushes: 0
		Bloom filter &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt; positives: 0
		Bloom filter &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt; ratio: 0.00000
		Bloom filter space used, bytes: 416
		Compacted partition minimum bytes: 61
		Compacted partition maximum bytes: 1386179893
		Compacted partition mean bytes: 34941561
		Average live cells per slice (last five minutes): 4831.0001626328785
		Average tombstones per slice (last five minutes): 0.0

		Table: urls_statistics
		SSTable count: 5
		Space used (live), bytes: 180362447
		Space used (total), bytes: 180362447
		Space used by snapshots (total), bytes: 0
		SSTable Compression Ratio: 0.35160611896275673
		Memtable cell count: 7
		Memtable data size, bytes: 601
		Memtable &lt;span class=&quot;code-keyword&quot;&gt;switch&lt;/span&gt; count: 1
		Local read count: 2
		Local read latency: 9.025 ms
		Local write count: 19
		Local write latency: 0.068 ms
		Pending flushes: 0
		Bloom filter &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt; positives: 0
		Bloom filter &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt; ratio: 0.00000
		Bloom filter space used, bytes: 2800
		Compacted partition minimum bytes: 104
		Compacted partition maximum bytes: 74975550
		Compacted partition mean bytes: 4751784
		Average live cells per slice (last five minutes): 0.0
		Average tombstones per slice (last five minutes): 0.0

		Table: user_prices
		SSTable count: 0
		Space used (live), bytes: 0
		Space used (total), bytes: 0
		Space used by snapshots (total), bytes: 0
		SSTable Compression Ratio: 0.0
		Memtable cell count: 0
		Memtable data size, bytes: 0
		Memtable &lt;span class=&quot;code-keyword&quot;&gt;switch&lt;/span&gt; count: 0
		Local read count: 0
		Local read latency: NaN ms
		Local write count: 0
		Local write latency: NaN ms
		Pending flushes: 0
		Bloom filter &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt; positives: 0
		Bloom filter &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt; ratio: 0.00000
		Bloom filter space used, bytes: 0
		Compacted partition minimum bytes: 0
		Compacted partition maximum bytes: 0
		Compacted partition mean bytes: 0
		Average live cells per slice (last five minutes): 0.0
		Average tombstones per slice (last five minutes): 0.0

&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="14169905" author="tjake" created="Mon, 13 Oct 2014 20:38:46 +0000"  >&lt;p&gt;Patch to only add to the queue under normal open circumstances (not a openEarly or moveStarts call)&lt;/p&gt;

&lt;p&gt;This greatly reduces the number of entries to the queue since before moveStarts was called on every sstable being compacted every 50MB&lt;/p&gt;</comment>
                            <comment id="14169938" author="jasobrown" created="Mon, 13 Oct 2014 20:48:18 +0000"  >&lt;p&gt;+1&lt;/p&gt;</comment>
                            <comment id="14170877" author="tjake" created="Tue, 14 Oct 2014 12:58:37 +0000"  >&lt;p&gt;committed&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12674587" name="8066.txt" size="9567" author="tjake" created="Mon, 13 Oct 2014 20:38:46 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[tjake]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            11 years, 6 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i20vf3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>jasobrown</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[jasobrown]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12962"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>