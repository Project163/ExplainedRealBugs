<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 22:20:26 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-2420] row cache / streaming aren&apos;t aware of each other</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-2420</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;SSTableWriter.Builder.build() takes tables that resulted from streaming, repair, bootstrapping, et cetera and builds the indexes and bloom filters before &quot;adding&quot; it so the current node is aware of it.&lt;/p&gt;

&lt;p&gt;However, if there is data present in the cache for a row that is also present in the streamed table the row cache can over shadow the data in the newly built table.  In other words, until the row in row cache is removed from the cache (e.g. because it&apos;s pushed out because of size, the node is restarted, the cache is manually cleared) the data in the newly built table will never be returned to clients.&lt;/p&gt;

&lt;p&gt;The solution that seems most reasonable at this point is to have SSTableWriter.Builder.build() (or something below it) update the row cache if the row key in the table being built is also present in the cache.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12503457">CASSANDRA-2420</key>
            <summary>row cache / streaming aren&apos;t aware of each other</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10003" iconUrl="https://issues.apache.org/jira/images/icons/priorities/trivial.svg">Low</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="slebresne">Sylvain Lebresne</assignee>
                                    <reporter username="mdennis">Matthew F. Dennis</reporter>
                        <labels>
                    </labels>
                <created>Tue, 5 Apr 2011 21:26:50 +0000</created>
                <updated>Tue, 16 Apr 2019 09:33:02 +0000</updated>
                            <resolved>Mon, 18 Apr 2011 14:52:25 +0000</resolved>
                                        <fixVersion>0.7.5</fixVersion>
                    <fixVersion>0.8 beta 1</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="13018538" author="slebresne" created="Mon, 11 Apr 2011 19:54:56 +0000"  >&lt;p&gt;There is a very simple patch for this issue. It consists in invalidating the cache for each key we index. The downside is that this will invalidate all key that gets repaired, but updating the cache (instead of invalidating) implies reading on disk so doing this during the indexing or at the next read may not matter much. In any case, this is better that the current situation and after all .&lt;/p&gt;

&lt;p&gt;I however attached a patch (against trunk for now) that &apos;do the right thing&apos; and will update the cache in the case of repair instead of invalidating. I mentioned the first solution in case we consider that the &apos;right one&apos; is too disruptive for 0.7 for instance (not that the patch is very complicated).&lt;/p&gt;

&lt;p&gt;Note that the patch fixes a tiny unrelated issue: the writeStat are not updated during a write if the used cache has &apos;isPutCopying&apos; (this could be fixed separately).&lt;/p&gt;</comment>
                            <comment id="13018560" author="jbellis" created="Mon, 11 Apr 2011 20:49:09 +0000"  >&lt;p&gt;I would be more comfortable having LCR throw UnsupportedOperation if asked for full row, since You Shouldn&apos;t Do That.&lt;/p&gt;

&lt;p&gt;Would prefer the updateCache case to be AES: ... default: invalidate and break; it&apos;s more obvious looking at it what the point is, and &quot;unnecessary&quot; invalidate calls will be harmless.&lt;/p&gt;</comment>
                            <comment id="13019400" author="slebresne" created="Wed, 13 Apr 2011 16:06:48 +0000"  >&lt;blockquote&gt;&lt;p&gt;I would be more comfortable having LCR throw UnsupportedOperation if asked for full row, since You Shouldn&apos;t Do That.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Updated patch defines getFullColumnFamily() only for AbstractCompactedRow. However I think it would be a bad idea to fail in the Builder, so the Builder now simply invalidate the cache if he is facing a big row (hence not fitting it in memory) and log a warning since if that happens &quot;you&apos;re doing it wrong&quot;.&lt;/p&gt;

&lt;p&gt;I&apos;ve also changed the switch case in updateCache.&lt;/p&gt;</comment>
                            <comment id="13020018" author="jbellis" created="Thu, 14 Apr 2011 20:30:34 +0000"  >&lt;p&gt;+1&lt;/p&gt;</comment>
                            <comment id="13020020" author="jbellis" created="Thu, 14 Apr 2011 20:32:41 +0000"  >&lt;p&gt;nit: s/higly/highly/ in the logged warning&lt;/p&gt;</comment>
                            <comment id="13020977" author="hudson" created="Mon, 18 Apr 2011 11:21:40 +0000"  >&lt;p&gt;Integrated in Cassandra #854 (See &lt;a href=&quot;https://hudson.apache.org/hudson/job/Cassandra/854/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://hudson.apache.org/hudson/job/Cassandra/854/&lt;/a&gt;)&lt;br/&gt;
    Merge &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-2420&quot; title=&quot;row cache / streaming aren&amp;#39;t aware of each other&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-2420&quot;&gt;&lt;del&gt;CASSANDRA-2420&lt;/del&gt;&lt;/a&gt; from 0.8&lt;/p&gt;</comment>
                            <comment id="13020983" author="hudson" created="Mon, 18 Apr 2011 11:34:52 +0000"  >&lt;p&gt;Integrated in Cassandra-0.8 #13 (See &lt;a href=&quot;https://hudson.apache.org/hudson/job/Cassandra-0.8/13/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://hudson.apache.org/hudson/job/Cassandra-0.8/13/&lt;/a&gt;)&lt;br/&gt;
    Update row cache post streaming&lt;br/&gt;
patch by slebresne; reviewed by jbellis for &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-2420&quot; title=&quot;row cache / streaming aren&amp;#39;t aware of each other&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-2420&quot;&gt;&lt;del&gt;CASSANDRA-2420&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13021023" author="slebresne" created="Mon, 18 Apr 2011 13:21:15 +0000"  >&lt;p&gt;Committed to 0.8 and trunk.&lt;br/&gt;
Was should we do about 0.7 ? I realized that we do not differentiate between the different reason for streaming in 0.7, so the simplest way to deal with this would probably be to just blindly invalidate the cache. Sounds reasonable ?&lt;/p&gt;</comment>
                            <comment id="13021024" author="jbellis" created="Mon, 18 Apr 2011 13:30:13 +0000"  >&lt;p&gt;Yes.&lt;/p&gt;</comment>
                            <comment id="13021048" author="slebresne" created="Mon, 18 Apr 2011 14:32:15 +0000"  >&lt;p&gt;Attaching simple patch targeting 0.7. I put it for review individually because it&apos;s different enough from previous patch (but it&apos;s a one-liner, so should be too long to review anyway)&lt;/p&gt;</comment>
                            <comment id="13021049" author="jbellis" created="Mon, 18 Apr 2011 14:38:26 +0000"  >&lt;p&gt;+1&lt;/p&gt;</comment>
                            <comment id="13021054" author="slebresne" created="Mon, 18 Apr 2011 14:52:25 +0000"  >&lt;p&gt;Committed to 0.7 and 0.7/trunk&lt;/p&gt;</comment>
                            <comment id="13021059" author="hudson" created="Mon, 18 Apr 2011 15:06:45 +0000"  >&lt;p&gt;Integrated in Cassandra-0.7 #437 (See &lt;a href=&quot;https://hudson.apache.org/hudson/job/Cassandra-0.7/437/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://hudson.apache.org/hudson/job/Cassandra-0.7/437/&lt;/a&gt;)&lt;br/&gt;
    Invalidate cache for streamed rows&lt;br/&gt;
patch by slebresne; reviewed by jbellis for &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-2420&quot; title=&quot;row cache / streaming aren&amp;#39;t aware of each other&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-2420&quot;&gt;&lt;del&gt;CASSANDRA-2420&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12476252" name="0001-Handle-the-row-cache-for-streamed-row-v2.patch" size="11805" author="slebresne" created="Wed, 13 Apr 2011 16:03:06 +0000"/>
                            <attachment id="12476045" name="0001-Handle-the-row-cache-for-streamed-row.patch" size="13064" author="slebresne" created="Mon, 11 Apr 2011 19:54:56 +0000"/>
                            <attachment id="12476612" name="2420-for-0.7.patch" size="1333" author="slebresne" created="Mon, 18 Apr 2011 14:32:15 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[slebresne]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>20614</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            14 years, 32 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0gb9r:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>93256</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>jbellis</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[jbellis]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12961"><![CDATA[Low]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>