<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 22:57:28 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-10156] Creating Materialized views concurrently leads to missing data</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-10156</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=nutbunnies&quot; class=&quot;user-hover&quot; rel=&quot;nutbunnies&quot;&gt;nutbunnies&lt;/a&gt; was writing dtests that create multiple tables concurrently. He also wrote a test that creates multiple MV but has not been able to get it works properly. After some debugging outside of dtest, it seems that there is an issue if we create more than 1 MV at the same time. There is no errors in the log but the MV are never entirely populated and are missing data.&lt;/p&gt;

&lt;p&gt;I&apos;ve attached 2 scripts:&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;nobr&quot;&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12751882/12751882_mv_test_bad.sh&quot; title=&quot;mv_test_bad.sh attached to CASSANDRA-10156&quot;&gt;mv_test_bad.sh&lt;sup&gt;&lt;img class=&quot;rendericon&quot; src=&quot;https://issues.apache.org/jira/images/icons/link_attachment_7.gif&quot; height=&quot;7&quot; width=&quot;7&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/sup&gt;&lt;/a&gt;&lt;/span&gt;: is the one that reproduce the issue. It creates 4 MVs at the same time. At the end, some data are missing in the MVs and there is nothing in system.hints or system.batchlog.&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;nobr&quot;&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12751883/12751883_mv_test_good.sh&quot; title=&quot;mv_test_good.sh attached to CASSANDRA-10156&quot;&gt;mv_test_good.sh&lt;sup&gt;&lt;img class=&quot;rendericon&quot; src=&quot;https://issues.apache.org/jira/images/icons/link_attachment_7.gif&quot; height=&quot;7&quot; width=&quot;7&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/sup&gt;&lt;/a&gt;&lt;/span&gt;: is the same script but that waits 10 seconds between each MV creation, which results in 4 MVs with all the data.&lt;/p&gt;

&lt;p&gt;Some more notes from Andrew:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;- lowering the number of rows inserted below ~1000 won&apos;t exhibit the inconsistent behavior
- adding more columns/MV make it worse -- more of the MVs counts are consistently wrong
- multiple runs will range in disagreement -- usually one of the MVs is correct though
- the describe cluster and system.mv* queries always &lt;span class=&quot;code-quote&quot;&gt;&quot;look&quot;&lt;/span&gt; good
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Thanks Andrew for finding this bug and providing the test scripts! &lt;/p&gt;

&lt;p&gt;//cc &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=carlyeks&quot; class=&quot;user-hover&quot; rel=&quot;carlyeks&quot;&gt;carlyeks&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tjake&quot; class=&quot;user-hover&quot; rel=&quot;tjake&quot;&gt;tjake&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=enigmacurry&quot; class=&quot;user-hover&quot; rel=&quot;enigmacurry&quot;&gt;enigmacurry&lt;/a&gt;&lt;/p&gt;</description>
                <environment></environment>
        <key id="12858068">CASSANDRA-10156</key>
            <summary>Creating Materialized views concurrently leads to missing data</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10002" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Normal</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="tjake">T Jake Luciani</assignee>
                                    <reporter username="aboudreault">Alan Boudreault</reporter>
                        <labels>
                    </labels>
                <created>Sat, 22 Aug 2015 14:47:08 +0000</created>
                <updated>Tue, 16 Apr 2019 09:30:59 +0000</updated>
                            <resolved>Fri, 28 Aug 2015 14:18:58 +0000</resolved>
                                        <fixVersion>3.0 beta 2</fixVersion>
                                    <component>Feature/Materialized Views</component>
                    <component>Legacy/Coordination</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="14708056" author="aboudreault" created="Sat, 22 Aug 2015 14:56:39 +0000"  >&lt;p&gt;This an output example of the script:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;(cassandra3_env)2.2.2 ~/Desktop
&#10095; sh mv_test.sh
creating 3 node c*3.0 cluster
http:&lt;span class=&quot;code-comment&quot;&gt;//git-wip-us.apache.org/repos/asf/cassandra.git git:cassandra-3.0
&lt;/span&gt;Fetching Cassandra updates...
Current cluster is now: mv_test
[node1 ERROR] objc[65819]: &lt;span class=&quot;code-object&quot;&gt;Class&lt;/span&gt; JavaLaunchHelper is implemented in both /Library/Java/JavaVirtualMachines/jdk1.8.0_51.jdk/Contents/Home/bin/java and /Library/Java/JavaVirtualMachines/jdk1.8.0_51.jdk/Contents/Home/jre/lib/libinstrument.dylib. One of the two will be used. Which one is undefined.
[node3 ERROR] objc[65818]: &lt;span class=&quot;code-object&quot;&gt;Class&lt;/span&gt; JavaLaunchHelper is implemented in both /Library/Java/JavaVirtualMachines/jdk1.8.0_51.jdk/Contents/Home/bin/java and /Library/Java/JavaVirtualMachines/jdk1.8.0_51.jdk/Contents/Home/jre/lib/libinstrument.dylib. One of the two will be used. Which one is undefined.
[node2 ERROR] objc[65817]: &lt;span class=&quot;code-object&quot;&gt;Class&lt;/span&gt; JavaLaunchHelper is implemented in both /Library/Java/JavaVirtualMachines/jdk1.8.0_51.jdk/Contents/Home/bin/java and /Library/Java/JavaVirtualMachines/jdk1.8.0_51.jdk/Contents/Home/jre/lib/libinstrument.dylib. One of the two will be used. Which one is undefined.


creating keyspace and base table with 5000 rows of data


adding materialized views


napping &lt;span class=&quot;code-keyword&quot;&gt;while&lt;/span&gt; the work gets done


cluster schema in sync?
objc[65939]: &lt;span class=&quot;code-object&quot;&gt;Class&lt;/span&gt; JavaLaunchHelper is implemented in both /Library/Java/JavaVirtualMachines/jdk1.8.0_51.jdk/Contents/Home/bin/java and /Library/Java/JavaVirtualMachines/jdk1.8.0_51.jdk/Contents/Home/jre/lib/libinstrument.dylib. One of the two will be used. Which one is undefined.

Cluster Information:
    Name: mv_test
    Snitch: org.apache.cassandra.locator.DynamicEndpointSnitch
    Partitioner: org.apache.cassandra.dht.Murmur3Partitioner
    Schema versions:
        97154a8b-4863-347e-b3d4-ca8ffcf7884b: [127.0.0.1, 127.0.0.2, 127.0.0.3]


objc[65961]: &lt;span class=&quot;code-object&quot;&gt;Class&lt;/span&gt; JavaLaunchHelper is implemented in both /Library/Java/JavaVirtualMachines/jdk1.8.0_51.jdk/Contents/Home/bin/java and /Library/Java/JavaVirtualMachines/jdk1.8.0_51.jdk/Contents/Home/jre/lib/libinstrument.dylib. One of the two will be used. Which one is undefined.

Cluster Information:
    Name: mv_test
    Snitch: org.apache.cassandra.locator.DynamicEndpointSnitch
    Partitioner: org.apache.cassandra.dht.Murmur3Partitioner
    Schema versions:
        97154a8b-4863-347e-b3d4-ca8ffcf7884b: [127.0.0.1, 127.0.0.2, 127.0.0.3]


objc[65983]: &lt;span class=&quot;code-object&quot;&gt;Class&lt;/span&gt; JavaLaunchHelper is implemented in both /Library/Java/JavaVirtualMachines/jdk1.8.0_51.jdk/Contents/Home/bin/java and /Library/Java/JavaVirtualMachines/jdk1.8.0_51.jdk/Contents/Home/jre/lib/libinstrument.dylib. One of the two will be used. Which one is undefined.

Cluster Information:
    Name: mv_test
    Snitch: org.apache.cassandra.locator.DynamicEndpointSnitch
    Partitioner: org.apache.cassandra.dht.Murmur3Partitioner
    Schema versions:
        97154a8b-4863-347e-b3d4-ca8ffcf7884b: [127.0.0.1, 127.0.0.2, 127.0.0.3]




checking mv system tables on node1

 keyspace_name | view_name | generation_number | last_token
---------------+-----------+-------------------+------------

(0 rows)

 keyspace_name | view_name
---------------+-----------
  lots_o_views | src_by_c1
  lots_o_views | src_by_c2
  lots_o_views | src_by_c3
  lots_o_views | src_by_c4

(4 rows)


checking mv system tables on node2

 keyspace_name | view_name | generation_number | last_token
---------------+-----------+-------------------+------------

(0 rows)

 keyspace_name | view_name
---------------+-----------
  lots_o_views | src_by_c1
  lots_o_views | src_by_c2
  lots_o_views | src_by_c3
  lots_o_views | src_by_c4

(4 rows)


checking mv system tables on node3

 keyspace_name | view_name | generation_number | last_token
---------------+-----------+-------------------+------------

(0 rows)

 keyspace_name | view_name
---------------+-----------
  lots_o_views | src_by_c1
  lots_o_views | src_by_c2
  lots_o_views | src_by_c3
  lots_o_views | src_by_c4

(4 rows)


checking counts on table and mvs -- all should be 5000
Consistency level set to ALL.

 count
-------
  5000

(1 rows)

Warnings :
Aggregation query used without partition key


 count
-------
  2012

(1 rows)

Warnings :
Aggregation query used without partition key


 count
-------
  1807

(1 rows)

Warnings :
Aggregation query used without partition key


 count
-------
  3625

(1 rows)

Warnings :
Aggregation query used without partition key


 count
-------
  5000

(1 rows)

Warnings :
Aggregation query used without partition key

COMPLETED
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="14717399" author="tjake" created="Thu, 27 Aug 2015 19:54:46 +0000"  >&lt;p&gt;Simple fix, we restart the builder on each MV schema change but it was accidentally completing the run.&lt;/p&gt;

&lt;p&gt;Could this be turned into a dtest &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=aboudreault&quot; class=&quot;user-hover&quot; rel=&quot;aboudreault&quot;&gt;aboudreault&lt;/a&gt;?&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/tjake/cassandra/tree/10156&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;fix&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14717410" author="aboudreault" created="Thu, 27 Aug 2015 19:59:40 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=nutbunnies&quot; class=&quot;user-hover&quot; rel=&quot;nutbunnies&quot;&gt;nutbunnies&lt;/a&gt; Can you test your dtest with this fix/branch? I will also test it tomorrow morning. We&apos;ll together if it also requires a specific dtest.&lt;/p&gt;</comment>
                            <comment id="14717657" author="nutbunnies" created="Thu, 27 Aug 2015 22:21:49 +0000"  >&lt;p&gt;Confirmed patch corrects problem:&lt;/p&gt;

&lt;p&gt;Failed as expected on:&lt;br/&gt;
origin/trunk : &lt;tt&gt;f744b6c05537b84b60f53917fafb32bc1d8b1b03&lt;/tt&gt;&lt;/p&gt;

&lt;p&gt;Passes on:&lt;br/&gt;
tjake/10156 : &lt;tt&gt;0edab864030817d1fe3739832a72453f084179b4&lt;/tt&gt;&lt;/p&gt;

&lt;p&gt;Once this is merged I&apos;ll un-skip the &lt;a href=&quot;https://github.com/riptano/cassandra-dtest/blob/master/concurrent_schema_changes_test.py#L243&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;dtest&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14718572" author="carlyeks" created="Fri, 28 Aug 2015 13:36:07 +0000"  >&lt;p&gt;+1&lt;/p&gt;</comment>
                            <comment id="14718628" author="tjake" created="Fri, 28 Aug 2015 14:18:58 +0000"  >&lt;p&gt;Committed&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12751882" name="mv_test_bad.sh" size="2420" author="aboudreault" created="Sat, 22 Aug 2015 14:47:08 +0000"/>
                            <attachment id="12751883" name="mv_test_good.sh" size="2790" author="aboudreault" created="Sat, 22 Aug 2015 14:47:08 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[tjake]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 12 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2j8xj:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12311421" key="com.atlassian.jira.plugin.system.customfieldtypes:multiversion">
                        <customfieldname>Reproduced In</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="12332361">3.0 alpha 1</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>carlyeks</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[carlyeks]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12962"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311124" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Tester</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>aboudreault</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>