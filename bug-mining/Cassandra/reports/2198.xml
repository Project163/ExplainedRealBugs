<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 22:38:52 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-5576] CREATE/DROP TRIGGER in CQL</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-5576</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description></description>
                <environment></environment>
        <key id="12648170">CASSANDRA-5576</key>
            <summary>CREATE/DROP TRIGGER in CQL</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10002" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Normal</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="vijay2win@yahoo.com">Vijay</assignee>
                                    <reporter username="jbellis">Jonathan Ellis</reporter>
                        <labels>
                    </labels>
                <created>Fri, 17 May 2013 12:24:48 +0000</created>
                <updated>Tue, 14 Oct 2025 12:13:57 +0000</updated>
                            <resolved>Sun, 16 Jun 2013 23:00:23 +0000</resolved>
                                        <fixVersion>2.0 beta 1</fixVersion>
                                    <component>Legacy/CQL</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>11</watches>
                                                                                                                <comments>
                            <comment id="13669016" author="vijay2win@yahoo.com" created="Wed, 29 May 2013 05:29:17 +0000"  >&lt;p&gt;Just to clarify is this what we are looking for?&lt;/p&gt;

&lt;p&gt;CREATE TRIGGER &amp;lt;trigger_name&amp;gt; ON &amp;lt;table_name&amp;gt; FOR EACH MUTATION &amp;lt;trigger_class&amp;gt;;&lt;/p&gt;

&lt;p&gt;or are we expecting something like this?&lt;/p&gt;

&lt;p&gt;CREATE TRIGGER &amp;lt;trigger_name&amp;gt; FOR EACH MUTATION &amp;lt;trigger_class&amp;gt;;&lt;br/&gt;
ALTER TABLE ADD TRIGGER &amp;lt;trigger_name&amp;gt;;&lt;/p&gt;</comment>
                            <comment id="13669283" author="jbellis" created="Wed, 29 May 2013 14:16:36 +0000"  >&lt;p&gt;Whichever is easier. &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="13669381" author="iamaleksey" created="Wed, 29 May 2013 16:18:41 +0000"  >&lt;p&gt;I would drop &apos;FOR EACH MUTATION&apos; for now - until we have other trigger types (if we ever do at all).&lt;/p&gt;

&lt;p&gt;Also, we might (and probably will) need to store additional info - or at least add the ability to parametrize triggers. So a column in schema_columnfamilies won&apos;t do (even a map, to keep the names).&lt;/p&gt;

&lt;p&gt;We should add another system schema cf, something like this:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;CREATE TABLE schema_triggers (
  keyspace_name text,
  columnfamily_name text,
  trigger_name text,
  trigger_options map&amp;lt;text, text&amp;gt;,
  PRIMARY KEY (keyspace_name, columnfamily_name, trigger_name)
);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;And for consistency with CREATE CUSTOM INDEX and other CREATE&apos;s, use the following syntax for CREATE TRIGGER:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;CREATE TRIGGER &amp;lt;name&amp;gt; ON &amp;lt;cfname&amp;gt; WITH options = {&apos;class&apos;: &#8230;, ..}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;(Support only &apos;class&apos; for now).&lt;/p&gt;

&lt;p&gt;This makes &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-5578&quot; title=&quot;update trigger schema to use Set instead of CDL text&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-5578&quot;&gt;&lt;del&gt;CASSANDRA-5578&lt;/del&gt;&lt;/a&gt; semi-irrelevant, since we are not going to keep triggers info in schema_columnfamilies anymore.&lt;/p&gt;</comment>
                            <comment id="13672699" author="vijay2win@yahoo.com" created="Sun, 2 Jun 2013 22:20:23 +0000"  >&lt;p&gt;Alright i have pushed the changes to &lt;a href=&quot;https://github.com/Vijay2win/cassandra/commits/5576&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/Vijay2win/cassandra/commits/5576&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;The trigger schematics is as follows:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;cqlsh&amp;gt;CREATE TRIGGER index_logger ON &lt;span class=&quot;code-quote&quot;&gt;&quot;Keyspace1&quot;&lt;/span&gt;.&lt;span class=&quot;code-quote&quot;&gt;&quot;Standard1&quot;&lt;/span&gt; EXECUTE (&lt;span class=&quot;code-quote&quot;&gt;&apos;org.apache.cassandra.triggers.InvertedIndex&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;org.apache.cassandra.triggers.LogColumnUpdates&apos;&lt;/span&gt;); 
cqlsh&amp;gt;DROP TRIGGER index_logger ON &lt;span class=&quot;code-quote&quot;&gt;&quot;Keyspace1&quot;&lt;/span&gt;.&lt;span class=&quot;code-quote&quot;&gt;&quot;Standard1&quot;&lt;/span&gt;;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;CLI&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;update column family Standard1 with triggers=&lt;span class=&quot;code-quote&quot;&gt;&apos;{&lt;span class=&quot;code-quote&quot;&gt;&quot;test&quot;&lt;/span&gt;:[&lt;span class=&quot;code-quote&quot;&gt;&quot;org.apache.cassandra.triggers.InvertedIndex&quot;&lt;/span&gt;,&lt;span class=&quot;code-quote&quot;&gt;&quot;org.apache.cassandra.triggers.LogColumnUpdates&quot;&lt;/span&gt;]}&apos;&lt;/span&gt;;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="13673552" author="iamaleksey" created="Mon, 3 Jun 2013 20:58:19 +0000"  >&lt;p&gt;Was there an issue with any of the suggestions in &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-5576?focusedCommentId=13669381&amp;amp;page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13669381?&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/CASSANDRA-5576?focusedCommentId=13669381&amp;amp;page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13669381?&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;CQL is part of public API, we &lt;b&gt;try&lt;/b&gt; not to change it too often, and to keep it consistent.&lt;/p&gt;

&lt;p&gt;One issue with&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;CREATE TRIGGER index_logger ON &quot;Keyspace1&quot;.&quot;Standard1&quot; EXECUTE (&apos;org.apache.cassandra.triggers.InvertedIndex&apos;, &apos;org.apache.cassandra.triggers.LogColumnUpdates&apos;);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Is that it closes the door to future parametrization of trigger classes (which is not planned for 2.0, but will probably happen eventually). Another is that I just see no value in being able to bundle several trigger classes under one name - what exactly does it buy us?&lt;/p&gt;

&lt;p&gt;So, ideally, I&apos;d rather see&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;CREATE TRIGGER indexer ON &quot;Keyspace1&quot;.&quot;Standard1&quot; WITH options = {&apos;class&apos;: &apos;org.apache.cassandra.triggers.InvertedIndex&apos;}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;(Use map syntax, even if we are only going to support one option - &apos;class&apos;, for now. You can look at CREATE CUSTOM INDEX implementation to see what exactly I mean).&lt;/p&gt;

&lt;p&gt;We also &lt;b&gt;don&apos;t&lt;/b&gt; want to serialize anything as JSON in schema columns anymore (this is what &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-5578&quot; title=&quot;update trigger schema to use Set instead of CDL text&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-5578&quot;&gt;&lt;del&gt;CASSANDRA-5578&lt;/del&gt;&lt;/a&gt; was about). The original plan was to use a set&amp;lt;text&amp;gt; field for the triggers, but now that we can attach names to them, and potentially want to be able to parametrize them, neither a set&amp;lt;text&amp;gt; or a map&amp;lt;text, text&amp;gt; will do. So we need a separate schema-table - I listed one example schema in the comment before this one.&lt;/p&gt;</comment>
                            <comment id="13673996" author="vijay2win@yahoo.com" created="Tue, 4 Jun 2013 03:26:48 +0000"  >&lt;blockquote&gt;
&lt;p&gt;Was there an issue with any of the suggestions&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Didn&apos;t we just drop the options (Map&amp;lt;String, String&amp;gt;) style configuration on CF in &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-4795&quot; title=&quot;replication, compaction, compression? options are not validated&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-4795&quot;&gt;&lt;del&gt;CASSANDRA-4795&lt;/del&gt;&lt;/a&gt;? Future extension can do simple match on the input parameter which i think is not that bad...&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;what exactly does it buy us?&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;It allows the user to group things so they can drop and manage a set of triggers than individual ones... I am fine dropping that and having one to one relationship (name to class names).&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;We also don&apos;t want to serialize anything as JSON in schema columns anymore&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Well it was not just simple type specification in table definition the announce method has to change, let me spend more time troubleshooting. Hope everything else is alright.&lt;/p&gt;

</comment>
                            <comment id="13674384" author="iamaleksey" created="Tue, 4 Jun 2013 13:47:45 +0000"  >&lt;blockquote&gt;&lt;p&gt;Didn&apos;t we just drop the options (Map&amp;lt;String, String&amp;gt;) style configuration on CF in &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-4795&quot; title=&quot;replication, compaction, compression? options are not validated&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-4795&quot;&gt;&lt;del&gt;CASSANDRA-4795&lt;/del&gt;&lt;/a&gt;?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;We didn&apos;t. We made the validation stricter, that&apos;s all.&lt;/p&gt;</comment>
                            <comment id="13676689" author="jbellis" created="Thu, 6 Jun 2013 04:28:59 +0000"  >&lt;blockquote&gt;&lt;p&gt;I just see no value in being able to bundle several trigger classes under one name &lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;+1&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;CREATE TRIGGER indexer ON &quot;Keyspace1&quot;.&quot;Standard1&quot; WITH options = {&apos;class&apos;: &apos;org.apache.cassandra.triggers.InvertedIndex&apos;}&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;-0 &amp;#8211; I see the value of &quot;options&quot; when we introduce parameterization, but having the actual trigger class be part of that seems odd, since that&apos;s something every trigger needs (i.e. a requirement, not an option or parameter).&lt;/p&gt;

&lt;p&gt;So I think I&apos;d prefer to have the EXECUTE syntax, with a single target.  We can add &lt;tt&gt;WITH options&lt;/tt&gt; later.  (But I agree that it&apos;s a good idea to split the triggers into a separate system table to make that easier.)&lt;/p&gt;</comment>
                            <comment id="13676755" author="iamaleksey" created="Thu, 6 Jun 2013 06:38:09 +0000"  >&lt;blockquote&gt;
&lt;p&gt;-0 &#8211; I see the value of &quot;options&quot; when we introduce parameterization, but having the actual trigger class be part of that seems odd, since that&apos;s something every trigger needs (i.e. a requirement, not an option or parameter).&lt;/p&gt;

&lt;p&gt;So I think I&apos;d prefer to have the EXECUTE syntax, with a single target. We can add WITH options later. (But I agree that it&apos;s a good idea to split the triggers into a separate system table to make that easier.)&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I would agree with you if there were no precedent. But that&apos;s the syntax we already use for CREATE CUSTOM INDEX (&lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-5484&quot; title=&quot;Support custom secondary indexes in CQL&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-5484&quot;&gt;&lt;del&gt;CASSANDRA-5484&lt;/del&gt;&lt;/a&gt;), and it&apos;s worth reusing it just for consistency&apos;s sake, IMO.&lt;/p&gt;</comment>
                            <comment id="13677023" author="jbellis" created="Thu, 6 Jun 2013 13:46:18 +0000"  >&lt;p&gt;I don&apos;t buy &quot;we made a mistake in 5484 so we should keep perpetuating the mistake in other places&quot; argument.  We should do it right here and update CREATE CUSTOM INDEX syntax for 2.0 to be consistent with this, instead of the other way around.&lt;/p&gt;</comment>
                            <comment id="13677161" author="iamaleksey" created="Thu, 6 Jun 2013 15:52:57 +0000"  >&lt;p&gt;I don&apos;t think it was a mistake in case of 5484. Do you have better suggestions?&lt;/p&gt;

&lt;p&gt;But, all right, I&apos;m okay with your suggestion for CREATE TRIGGER.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=slebresne&quot; class=&quot;user-hover&quot; rel=&quot;slebresne&quot;&gt;slebresne&lt;/a&gt; any ideas re: changing 5484 and syntax for CREATE TRIGGER?&lt;/p&gt;</comment>
                            <comment id="13677175" author="jbellis" created="Thu, 6 Jun 2013 16:07:40 +0000"  >&lt;blockquote&gt;&lt;p&gt;I don&apos;t think it was a mistake in case of 5484.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Hmm.  I see what you mean wrt compaction, compression configuration.  Damn it.  All right, I guess I&apos;m sold on &quot;everything in options map.&quot;&lt;/p&gt;</comment>
                            <comment id="13677186" author="slebresne" created="Thu, 6 Jun 2013 16:17:09 +0000"  >&lt;p&gt;I don&apos;t think I care too much which syntax we pick, though I&apos;m definitely in favor of more consistency over less.&lt;/p&gt;

&lt;p&gt;It does slightly bug me to change the syntax for custom indexes after it&apos;s been release. But, given that nobody is probably using the custom index syntax at this point (it&apos;s not really properly documented yet typically), I&apos;m fine with it if you guys think it measurably improve the syntax (I have no real opinion for once on that question). But I&apos;d &lt;b&gt;really&lt;/b&gt; prefer doing it now rather than leaving the current syntax in 1.2 and changing it in 2.0.  &lt;/p&gt;

&lt;p&gt;Though if we do change the custom index syntax, what are we talking about? Something like:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;CREATE CUSTOM INDEX ON &amp;lt;table&amp;gt;(&amp;lt;column&amp;gt;) USING &amp;lt;classname&amp;gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;with a trigger syntax that would be&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;CREATE TRIGGER &amp;lt;name&amp;gt; ON &amp;lt;table&amp;gt; EXECUTE &amp;lt;classname&amp;gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Knowing that for both we could add support for {{WITH options={...} }} whenever we actually have options?&lt;/p&gt;
</comment>
                            <comment id="13677200" author="iamaleksey" created="Thu, 6 Jun 2013 16:28:29 +0000"  >&lt;p&gt;btw, if we do go with USING for CREATE CUSTOM INDEX, a more consistent&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;CREATE TRIGGER &amp;lt;name&amp;gt; on &amp;lt;table&amp;gt; USING &amp;lt;class&amp;gt; WITH options
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;also sounds okay to me (and avoids adding an extra keyword, too).&lt;/p&gt;

&lt;p&gt;But I&apos;m equally fine with &apos;everything in options map&apos;. As long as we are consistent, at least betweetn CREATE CUSTOM INDEX and CREATE TRIGGER.&lt;/p&gt;</comment>
                            <comment id="13677372" author="jbellis" created="Thu, 6 Jun 2013 18:52:38 +0000"  >&lt;p&gt;If everyone is fine with both options then I move we leave the final decision to Vijay who is coding it up. &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="13680227" author="vijay2win@yahoo.com" created="Tue, 11 Jun 2013 05:39:09 +0000"  >&lt;p&gt;It took longer than expected to troubleshoot CFMetaData, &lt;br/&gt;
&lt;a href=&quot;https://github.com/Vijay2win/cassandra/commits/5576-v2&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/Vijay2win/cassandra/commits/5576-v2&lt;/a&gt; has the following semantics...&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;cqlsh&amp;gt; create TRIGGER test2 ON &lt;span class=&quot;code-quote&quot;&gt;&quot;Keyspace1&quot;&lt;/span&gt;.&lt;span class=&quot;code-quote&quot;&gt;&quot;Standard1&quot;&lt;/span&gt; using &lt;span class=&quot;code-quote&quot;&gt;&apos;org.apache.cassandra.triggers.InvertedIndex&apos;&lt;/span&gt;;
cqlsh&amp;gt; SELECT * FROM system.schema_triggers WHERE keyspace_name=&lt;span class=&quot;code-quote&quot;&gt;&apos;Keyspace1&apos;&lt;/span&gt; AND column_family=&lt;span class=&quot;code-quote&quot;&gt;&apos;Standard1&apos;&lt;/span&gt;;

 keyspace_name | column_family | trigger_classes
---------------+---------------+------------------------------------------------------
     Keyspace1 |     Standard1 | {test2: org.apache.cassandra.triggers.InvertedIndex}

cqlsh&amp;gt; drop trigger test2 on &lt;span class=&quot;code-quote&quot;&gt;&quot;Keyspace1&quot;&lt;/span&gt;.&lt;span class=&quot;code-quote&quot;&gt;&quot;Standard1&quot;&lt;/span&gt;;                           
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The trigger data is now stored in schema_triggers and cli is as follows&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;update column family Standard1 with triggers= &lt;span class=&quot;code-quote&quot;&gt;&apos;{&lt;span class=&quot;code-quote&quot;&gt;&quot;test&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;org.apache.cassandra.triggers.InvertedIndex&quot;&lt;/span&gt;}&apos;&lt;/span&gt;;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="13681562" author="iamaleksey" created="Wed, 12 Jun 2013 19:52:58 +0000"  >&lt;p&gt;Yep, that&apos;s the CQL3 syntax we want. I&apos;ll open a ticket for me to update CREATE CUSTOM INDEX to switch to USING as well.&lt;/p&gt;

&lt;p&gt;I&apos;m afraid that schema_triggers schema like this is not enough - won&apos;t allow options in the future (and changing this schema is gonna be &lt;b&gt;a lot&lt;/b&gt; more painful than adding WITH to the CREATE statement).&lt;/p&gt;

&lt;p&gt;Can&apos;t we use&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;CREATE TABLE schema_triggers (
  keyspace_name text,
  columnfamily_name text,
  trigger_name text,
  trigger_options map&amp;lt;text, text&amp;gt;,
  PRIMARY KEY (keyspace_name, columnfamily_name, trigger_name)
);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;, as it was suggested in &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-5576?focusedCommentId=13669381&amp;amp;page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13669381&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/CASSANDRA-5576?focusedCommentId=13669381&amp;amp;page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13669381&lt;/a&gt; initially?&lt;/p&gt;

&lt;p&gt;Your example would translate to&lt;br/&gt;
keyspace_name=Keyspace1, column_family=Standard1, trigger_name=test2, trigger_options=&lt;/p&gt;
{class:org.apache.cassandra.triggers.InvertedIndex}

&lt;p&gt;Will also need to update the cli syntax to something column_metadata-like&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;update column family Standard1 with triggers = [
{trigger_name: test2, class: org.apache.cassandra.triggers.InvertedIndex}
];
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="13683136" author="vijay2win@yahoo.com" created="Fri, 14 Jun 2013 06:23:10 +0000"  >&lt;p&gt;Done with all the above changes and pushed to the same branch. Let me know... Thanks!&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;          update column family Standard1 with triggers =
              &lt;span class=&quot;code-quote&quot;&gt;&apos;[{&lt;span class=&quot;code-quote&quot;&gt;&quot;name&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;test&quot;&lt;/span&gt;,&lt;span class=&quot;code-quote&quot;&gt;&quot;class&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;org.apache.cassandra.triggers.InvertedIndex&quot;&lt;/span&gt;}]&apos;&lt;/span&gt;;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="13683474" author="jbellis" created="Fri, 14 Jun 2013 16:02:06 +0000"  >&lt;p&gt;I don&apos;t see Aleksey&apos;s schema change; am I missing something?&lt;/p&gt;</comment>
                            <comment id="13683495" author="vijay2win@yahoo.com" created="Fri, 14 Jun 2013 16:28:27 +0000"  >&lt;p&gt;Yep, We do have it in &lt;a href=&quot;https://github.com/Vijay2win/cassandra/commit/ee36fe0fe99252f7ca7268863f33a9bc585a4c58#L0R165&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/Vijay2win/cassandra/commit/ee36fe0fe99252f7ca7268863f33a9bc585a4c58#L0R165&lt;/a&gt; i separated into 2 commits but will squash before merging to trunk.&lt;/p&gt;</comment>
                            <comment id="13683509" author="JIRAUSER308715" created="Fri, 14 Jun 2013 16:40:03 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=vijay2win%40yahoo.com&quot; class=&quot;user-hover&quot; rel=&quot;vijay2win@yahoo.com&quot;&gt;vijay2win@yahoo.com&lt;/a&gt; I think the change he is refering to is using:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;  trigger_options map&amp;lt;text, text&amp;gt;,
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;instead of&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;trigger_class text,
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;So that adding more parameters later doesn&apos;t require a schema change.&lt;/p&gt;</comment>
                            <comment id="13683534" author="vijay2win@yahoo.com" created="Fri, 14 Jun 2013 17:05:53 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jjordan&quot; class=&quot;user-hover&quot; rel=&quot;jjordan&quot;&gt;jjordan&lt;/a&gt; the options can be additional columns which can be defined later (same way we do SCHEMA_COLUMNFAMILIES_CF) when we add them we need to validate them anyways.... &lt;br/&gt;
If they are dynamic then they can be additional columns like list&amp;lt;map&amp;lt;String, map&amp;lt;String, String&amp;gt;&amp;gt; i believe this schema provides a lot of flexibility for now.&lt;/p&gt;

&lt;p&gt;I really dont have a lot of opinion on it, it just was more logical with the rest of the code (Specially with querying and dropping etc)... &lt;br/&gt;
if you want to change it, i can change it. Then we just need to special case trigger name from the map etc..&lt;/p&gt;</comment>
                            <comment id="13683934" author="jbellis" created="Fri, 14 Jun 2013 23:59:17 +0000"  >&lt;blockquote&gt;&lt;p&gt;the options can be additional columns which can be defined later&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I think compaction options is a better example &amp;#8211; valid options are defined by the implementing class, so we just want a Map&amp;lt;option, value&amp;gt; that we can pass to the constructor.&lt;/p&gt;</comment>
                            <comment id="13684073" author="iamaleksey" created="Sat, 15 Jun 2013 04:52:14 +0000"  >&lt;p&gt;Yes, options should definitely be a map&amp;lt;text, text&amp;gt;. Question is, should class be a separate column or should it be simply one of the options in that map.&lt;/p&gt;

&lt;p&gt;Cases where class is part of the options and not a separate column:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;custom 2i (schema_columns.index_options)&lt;/li&gt;
	&lt;li&gt;compression (schema_columnfamilies.compression_parameters)&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Cases where class is a separate column:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;replication (schema_keyspaces.strategy_class)&lt;/li&gt;
	&lt;li&gt;compaction (schema_columnfamilies.compaction_strategy_class)&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;In the last two cases, even though they are stored separately, in CQL3 CREATE/ALTER the class is still conceptually part of the options map:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;CREATE KEYSPACE &amp;lt;name&amp;gt; WITH replication = 
{&apos;class&apos;: &apos;path.to.strategy.class&apos;, &apos;option1&apos;: &apos;value1&apos;, &apos;optionX&apos;: ...}&lt;/li&gt;
	&lt;li&gt;ALTER TABLE &amp;lt;name&amp;gt; WITH compaction = 
{&apos;class&apos;: &apos;SizeTieredCompactionStrategy&apos;, &apos;option1&apos;: &apos;value1&apos;, &apos;optionX&apos;: ...}&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Now, once we add parameters support to triggers, we could just add trigger_options map&amp;lt;text, text&amp;gt; and to keep all but class there. Adding columns to system tables is okay, dropping them isn&apos;t. But adding trigger_options map&amp;lt;text,text&amp;gt; right now and storing the class there (with &apos;class&apos; key) will let us to leave schema_triggers schema like this forever, future-proofing it (this is what I suggested in &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-5576?focusedCommentId=13681562&amp;amp;page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13681562&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/CASSANDRA-5576?focusedCommentId=13681562&amp;amp;page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13681562&lt;/a&gt; and in &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-5576?focusedCommentId=13669381&amp;amp;page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13669381&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/CASSANDRA-5576?focusedCommentId=13669381&amp;amp;page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13669381&lt;/a&gt; before that).&lt;/p&gt;</comment>
                            <comment id="13684077" author="vijay2win@yahoo.com" created="Sat, 15 Jun 2013 05:03:25 +0000"  >&lt;blockquote&gt;
&lt;p&gt; dropping them isn&apos;t.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;With range tombstone we just delete all the Composite columns with a prefix &quot;where trigger_name=&apos;xyz&apos;&quot;... thats what the patch does &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="13684080" author="iamaleksey" created="Sat, 15 Jun 2013 05:08:48 +0000"  >&lt;p&gt;I&apos;m talking about removing columns from schema of system tables themselves, not the values (say, getting rid of schema_columnfamilies.compaction_strategy_class column altogether). Values, sure.&lt;/p&gt;</comment>
                            <comment id="13684083" author="iamaleksey" created="Sat, 15 Jun 2013 05:17:44 +0000"  >&lt;p&gt;Mentioned it to highlight how important getting the schema of system tables right the first time is. Changing it is hard. Removing columns - almost impossible. If we can have one less from the start, I&apos;d much rather prefer it. And we &lt;b&gt;will&lt;/b&gt; add trigger parametrization in the future - so why not add trigger_options map&amp;lt;text,text&amp;gt; right now and keep the class there, instead of having a separate trigger_class column? Not having to touch schema_triggers schema in the future = win.&lt;/p&gt;</comment>
                            <comment id="13684088" author="vijay2win@yahoo.com" created="Sat, 15 Jun 2013 06:10:02 +0000"  >&lt;p&gt;Pushed the schema change to the same branch. Thanks!&lt;/p&gt;</comment>
                            <comment id="13684099" author="iamaleksey" created="Sat, 15 Jun 2013 07:29:37 +0000"  >&lt;p&gt;Thanks! Everything looks good except some 1-line-fixable things and thrift/cli issue:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;DropTriggerStatement.checkAccess() should check for ALTER - we are altering a table here, not dropping it&lt;/li&gt;
	&lt;li&gt;DropTriggerStatement.changeType() should return UPDATED, for the same reason&lt;/li&gt;
	&lt;li&gt;in Cql.g should probably add K_TRIGGER to unreserved_function_keyword to not break people&apos;s queries if they have a column named &apos;trigger&apos; somewhere. The less reserved keywords we got, the better&lt;/li&gt;
	&lt;li&gt;(nit) in CFMetaData, SchemaTriggerCf = compile(5, ...) - there is no need for oldCfId argument here (5), since the table has never existed in 1.1&lt;/li&gt;
	&lt;li&gt;(nit) CFMetaData.getTriggerClass() should be renamed to CFMetaData.getTriggerClasses() - it returns a collection, after all&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Thrift/cli issue:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;43: optional list&amp;lt;map&amp;lt;string, string&amp;gt;&amp;gt; triggers,
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Is not future-parametrization proof.&lt;/p&gt;

&lt;p&gt;Also, cli syntax is using json, instead of using arrayConstruct from Cli.g (with nested hashConstruct). The former requires json where there shouldn&apos;t be, and quotes around key names (and quotes around the whole thing), which it shouldn&apos;t.&lt;/p&gt;

&lt;p&gt;&lt;b&gt;HOWEVER&lt;/b&gt; I suggest not fixing it at all and removing triggers entirely from CLI and thrift APIs. CLI is deprecated. And with Thrift you won&apos;t be able to add/remove triggers from CQL3 tables, anyway, because you can&apos;t even see them. With CQL3 CREATE TRIGGER/DROP TRIGGER, however, you can modify both CQL3 and old-style tables, easily. So let&apos;s just rely on them/cqlsh for modifying triggers.&lt;/p&gt;

&lt;p&gt;I&apos;m open to debate about thirft/cli here. But if we are going to support trigger modification from cli/thrift, it&apos;ll be done right, and I can&apos;t justify wasting any more of your time on that.&lt;/p&gt;</comment>
                            <comment id="13684723" author="vijay2win@yahoo.com" created="Sun, 16 Jun 2013 18:24:00 +0000"  >&lt;p&gt;Removed cli support for it, but thrift i am not sure there is a lot of automation in testing which relies on it... &lt;/p&gt;

&lt;p&gt;As a user i use thrift for various reasons like performance and i am not sure if i would switch that soon, specially with the cross platforms we have to deal with.&lt;/p&gt;

&lt;p&gt;v4 addresses the nits too. &lt;a href=&quot;https://github.com/Vijay2win/cassandra/commits/5576-v4&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/Vijay2win/cassandra/commits/5576-v4&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13684739" author="iamaleksey" created="Sun, 16 Jun 2013 18:56:20 +0000"  >&lt;blockquote&gt;&lt;p&gt;As a user i use thrift for various reasons like performance and i am not sure if i would switch that soon, specially with the cross platforms we have to deal with.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;You&apos;d only have to use CQL3 for DROP and CREATE TRIGGER (via thfit.execute_cql3_query()) and ignore it otherwise. Speed not affected (unless you are talking about the speed of creating a trigger (: ). Though I can see some value of being able to modify triggers via thrift.system_update_column_family() if one has no CQL3 tables at all and doesn&apos;t want to bother with it, ever.&lt;/p&gt;

&lt;p&gt;Can you make it map&amp;lt;string, map&amp;lt;string, string&amp;gt;&amp;gt; (index name -&amp;gt; index options, including class) then? So that once we add parametrization support, thrift wouldn&apos;t have to change at all?&lt;/p&gt;

&lt;p&gt;Other than this, everything looks fine to me.&lt;/p&gt;

&lt;p&gt;(tiny nit: FBUtilities.fromJsonListObject() is now unused and can be removed)&lt;/p&gt;</comment>
                            <comment id="13684752" author="iamaleksey" created="Sun, 16 Jun 2013 19:17:28 +0000"  >&lt;p&gt;Also, TriggerOptions should be moved to org.apache.cassandra.config (and ideally renamed to just &quot;Triggers&quot;).&lt;/p&gt;

&lt;p&gt;This is all.&lt;/p&gt;</comment>
                            <comment id="13684829" author="vijay2win@yahoo.com" created="Sun, 16 Jun 2013 22:59:04 +0000"  >&lt;blockquote&gt;
&lt;p&gt;Speed not affected&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;I am talking about libraries that are written on thrift which has to special case just for triggers if we dont support, though it is not required per say.&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;renamed to just &quot;Triggers&quot;&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Triggers class name will cause confusion and hence left it alone and moved it to config, though I am not sure if thats the right place for it.&lt;/p&gt;

&lt;p&gt;Committed to trunk, Glad it is done... and has map&amp;lt;string, map&amp;lt;string, string&amp;gt; now &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;, Thanks!&lt;/p&gt;</comment>
                            <comment id="13684831" author="iamaleksey" created="Sun, 16 Jun 2013 23:01:56 +0000"  >&lt;p&gt;Good (:&lt;/p&gt;</comment>
                            <comment id="13684910" author="jbellis" created="Mon, 17 Jun 2013 02:13:20 +0000"  >&lt;p&gt;\o/&lt;/p&gt;

&lt;p&gt;On Sun, Jun 16, 2013 at 6:03 PM, Aleksey Yeschenko (JIRA)&lt;/p&gt;



&lt;p&gt;&amp;#8211; &lt;br/&gt;
Jonathan Ellis&lt;br/&gt;
Project Chair, Apache Cassandra&lt;br/&gt;
co-founder, &lt;a href=&quot;http://www.datastax.com&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://www.datastax.com&lt;/a&gt;&lt;br/&gt;
@spyced&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                                                <inwardlinks description="is duplicated by">
                                        <issuelink>
            <issuekey id="12648214">CASSANDRA-5578</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[vijay2win@yahoo.com]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>328526</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            12 years, 23 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1kokv:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>328870</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>aleksey</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[aleksey]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12962"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>