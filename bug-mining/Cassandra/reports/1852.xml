<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 22:35:44 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-4803] CFRR wide row iterators improvements</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-4803</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt; &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;float&lt;/span&gt; getProgress()
    {
        &lt;span class=&quot;code-comment&quot;&gt;// TODO &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; is totally broken &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; wide rows
&lt;/span&gt;        &lt;span class=&quot;code-comment&quot;&gt;// the progress is likely to be reported slightly off the actual but close enough
&lt;/span&gt;        &lt;span class=&quot;code-object&quot;&gt;float&lt;/span&gt; progress = ((&lt;span class=&quot;code-object&quot;&gt;float&lt;/span&gt;) iter.rowsRead() / totalRowCount);
        &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; progress &amp;gt; 1.0F ? 1.0F : progress;
    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The problem is iter.rowsRead() does not return the number of rows read from the wide row iterator, but returns number of &lt;b&gt;columns&lt;/b&gt; (every row is counted multiple times). &lt;/p&gt;</description>
                <environment></environment>
        <key id="12611668">CASSANDRA-4803</key>
            <summary>CFRR wide row iterators improvements</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10002" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Normal</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="pkolaczk">Piotr Kolaczkowski</assignee>
                                    <reporter username="pkolaczk">Piotr Kolaczkowski</reporter>
                        <labels>
                    </labels>
                <created>Sat, 13 Oct 2012 08:16:56 +0000</created>
                <updated>Tue, 16 Apr 2019 09:32:25 +0000</updated>
                            <resolved>Sat, 1 Dec 2012 07:05:21 +0000</resolved>
                                        <fixVersion>1.1.8</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="13479005" author="pkolaczk" created="Thu, 18 Oct 2012 13:48:14 +0000"  >&lt;p&gt;I attach a list of patches affecting operation of CFRR:&lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;Fix for obvious counting bug in wide row iterator that was counting columns instead of rows.&lt;/li&gt;
	&lt;li&gt;Several fixes in describe_splits:&lt;br/&gt;
   fixed non-uniform splitting - caused by integer math roundoff errors&lt;br/&gt;
   fixed insane behaviour when number of splits was higher than number of key samples&lt;br/&gt;
   added estimated size of the split to the result, and make use of it in CFIF&lt;/li&gt;
	&lt;li&gt;This is a patch for broken get_paged_slice; addressed in a separate ticket, but I had to include it in order to test my code&lt;/li&gt;
	&lt;li&gt;Fix for creating excessively small splits (and wrong progress reporting) due to range wrap around.&lt;/li&gt;
	&lt;li&gt;get_range_slices allows for (start_key, end_token) exactly the same as get_paged_slice&lt;/li&gt;
	&lt;li&gt;I tried to de-spaghettize CFRR code a little. This also fixes some bug that accidentally slipped in with previous patches.&lt;/li&gt;
&lt;/ol&gt;
</comment>
                            <comment id="13480522" author="jbellis" created="Fri, 19 Oct 2012 23:31:36 +0000"  >&lt;p&gt;reviewed + committed patches 01 and 02, rest still pending.&lt;/p&gt;</comment>
                            <comment id="13483522" author="jbellis" created="Wed, 24 Oct 2012 19:57:54 +0000"  >&lt;p&gt;03 committed in &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-4816&quot; title=&quot;Broken get_paged_slice&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-4816&quot;&gt;&lt;del&gt;CASSANDRA-4816&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;Not sure about 04 &amp;#8211; I&apos;m a fan of the simplifications we get from letting CFRR only need to deal with non-wrapping splits.&lt;/p&gt;</comment>
                            <comment id="13490531" author="pkolaczk" created="Mon, 5 Nov 2012 09:36:10 +0000"  >&lt;p&gt;#04 - what about virtual nodes in 1.2? Do we insist that split may not span more than one contiguous token range? It will be harder to avoid too small splits. And too small split = bigger task book-keeping overhead.&lt;/p&gt;</comment>
                            <comment id="13490548" author="pkolaczk" created="Mon, 5 Nov 2012 10:13:26 +0000"  >&lt;p&gt;Hold on with applying patch 2 for a while. We just discovered it breaks running hive queries while doing rolling upgrade. There is a need for falling back to old describe_splits method if describe_splits_ex is not found.&lt;/p&gt;</comment>
                            <comment id="13491570" author="pkolaczk" created="Tue, 6 Nov 2012 16:11:02 +0000"  >&lt;p&gt;Attaching a patch allowing to generate splits also when talking to an older version of thrift server.&lt;/p&gt;</comment>
                            <comment id="13495174" author="pkolaczk" created="Mon, 12 Nov 2012 09:40:30 +0000"  >&lt;p&gt;Rebased patches for recent 1.1. Some patches have been already applied, so removed them from the list.&lt;/p&gt;</comment>
                            <comment id="13499404" author="jbellis" created="Sat, 17 Nov 2012 13:02:36 +0000"  >&lt;blockquote&gt;&lt;p&gt;what about virtual nodes in 1.2? Do we insist that split may not span more than one contiguous token range?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;That&apos;s kind of orthogonal to wrapping ranges per se &amp;#8211; you&apos;ll still only have a single &lt;span class=&quot;error&quot;&gt;&amp;#91;virtual&amp;#93;&lt;/span&gt; node whose range wraps.  So vnodes won&apos;t make that worse.  Moreover, you&apos;re still going to need two scans at the disk level since a wrapping range won&apos;t be contiguous there.  (Currently wrapping ranges are split by StorageProxy.getRestrictedRanges but this may change for &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-4858&quot; title=&quot;Coverage analysis for low-CL queries&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-4858&quot;&gt;&lt;del&gt;CASSANDRA-4858&lt;/del&gt;&lt;/a&gt;.)  Doing an extra Thrift or CQL query is negligible overhead compared to the actual scan.&lt;/p&gt;

&lt;p&gt;Finally, getRestrictedRanges &lt;b&gt;will&lt;/b&gt; split it up into scan-per-vnode which I agree is something we should fix but I don&apos;t think this patch does it.  As an optimization I don&apos;t think it&apos;s something we should block 1.2.0 for.  Should we split this into a separate ticket?&lt;/p&gt;</comment>
                            <comment id="13499405" author="jbellis" created="Sat, 17 Nov 2012 13:02:39 +0000"  >&lt;p&gt;0006: Can you split out the bug fix and rebase?  Refactoring is fine but let&apos;s keep it separate from bug fixes.&lt;/p&gt;

&lt;p&gt;0007: I&apos;m unclear what this is useful for, anyone running a 1.1 recent enough to have this patch, would also have describe_splits_ex, no?&lt;/p&gt;</comment>
                            <comment id="13501242" author="pkolaczk" created="Tue, 20 Nov 2012 15:48:30 +0000"  >&lt;p&gt;0007 - this is for rolling upgrade. When you upgrade one node and the other nodes don&apos;t have describe_splits_ex yet, starting a hadoop job on a newly upgraded node fails.&lt;/p&gt;

&lt;p&gt;As for 0004 / 0006 fixes - I agree. Let&apos;s move them to a separate ticket. &lt;/p&gt;</comment>
                            <comment id="13501243" author="pkolaczk" created="Tue, 20 Nov 2012 15:49:42 +0000"  >&lt;p&gt;BTW: I don&apos;t get email notifications from ASF Jira. It is because I registered long, long time ago and my email is obsolete. How to change my email to a newer one? I can&apos;t see an option in the user profile for doing that. &lt;/p&gt;</comment>
                            <comment id="13501885" author="jbellis" created="Wed, 21 Nov 2012 11:48:45 +0000"  >&lt;p&gt;Is there a more specific exception we can catch besides TException?&lt;/p&gt;</comment>
                            <comment id="13501886" author="jbellis" created="Wed, 21 Nov 2012 11:49:46 +0000"  >&lt;p&gt;Without trying it, I think it would be TApplicationException.WRONG_METHOD_NAME.&lt;/p&gt;</comment>
                            <comment id="13502291" author="pkolaczk" created="Wed, 21 Nov 2012 20:33:54 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jbellis&quot; class=&quot;user-hover&quot; rel=&quot;jbellis&quot;&gt;jbellis&lt;/a&gt; right, I change it.&lt;/p&gt;</comment>
                            <comment id="13502660" author="pkolaczk" created="Thu, 22 Nov 2012 08:58:57 +0000"  >&lt;p&gt;0007-Fallback-to-describe-splits-v2.patch: Catching TApplicationException and checking its type. &lt;/p&gt;</comment>
                            <comment id="13503553" author="pkolaczk" created="Sun, 25 Nov 2012 21:08:53 +0000"  >&lt;p&gt;Attached third version of the patch - this time it works. The right error code is UNKNOWN_METHOD (1), not WRONG_METHOD_NAME.&lt;/p&gt;</comment>
                            <comment id="13507888" author="jbellis" created="Sat, 1 Dec 2012 07:05:21 +0000"  >&lt;p&gt;(committed)&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12554809" name="0007-Fallback-to-describe_splits-v3.patch" size="2865" author="pkolaczk" created="Sun, 25 Nov 2012 21:08:53 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[pkolaczk]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>248417</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            12 years, 51 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i09uxz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>55446</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>jbellis</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[jbellis]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12962"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>