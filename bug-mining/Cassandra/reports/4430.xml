<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 23:04:30 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-11594] Too many open files on directories</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-11594</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;I have a 6 nodes cluster in prod in 3 racks.&lt;br/&gt;
each node :&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;4Gb commitlogs on 343 files&lt;/li&gt;
	&lt;li&gt;275Gb data on 504 files&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;On saturday, 1 node in each rack crash with with too many open files (seems to be the similar node in each rack).&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;lsof -n -p $PID give me 66899 out of 65826 max
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;it contains 64527 open directories (2371 uniq)&lt;/p&gt;


&lt;p&gt;a part of the list :&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;java    19076 root 2140r      DIR   8,17      143360 4386718705 /opt/stage2/pod-cassandra-aci-cassandra/rootfs/data/keyspaces/email_logs_query/emails-2d4abd00e9ea11e591199d740e07bd95
java    19076 root 2141r      DIR   8,17      143360 4386718705 /opt/stage2/pod-cassandra-aci-cassandra/rootfs/data/keyspaces/email_logs_query/emails-2d4abd00e9ea11e591199d740e07bd95
java    19076 root 2142r      DIR   8,17      143360 4386718705 /opt/stage2/pod-cassandra-aci-cassandra/rootfs/data/keyspaces/email_logs_query/emails-2d4abd00e9ea11e591199d740e07bd95
java    19076 root 2143r      DIR   8,17      143360 4386718705 /opt/stage2/pod-cassandra-aci-cassandra/rootfs/data/keyspaces/email_logs_query/emails-2d4abd00e9ea11e591199d740e07bd95
java    19076 root 2144r      DIR   8,17      143360 4386718705 /opt/stage2/pod-cassandra-aci-cassandra/rootfs/data/keyspaces/email_logs_query/emails-2d4abd00e9ea11e591199d740e07bd95
java    19076 root 2145r      DIR   8,17      143360 4386718705 /opt/stage2/pod-cassandra-aci-cassandra/rootfs/data/keyspaces/email_logs_query/emails-2d4abd00e9ea11e591199d740e07bd95
java    19076 root 2146r      DIR   8,17      143360 4386718705 /opt/stage2/pod-cassandra-aci-cassandra/rootfs/data/keyspaces/email_logs_query/emails-2d4abd00e9ea11e591199d740e07bd95
java    19076 root 2147r      DIR   8,17      143360 4386718705 /opt/stage2/pod-cassandra-aci-cassandra/rootfs/data/keyspaces/email_logs_query/emails-2d4abd00e9ea11e591199d740e07bd95
java    19076 root 2148r      DIR   8,17      143360 4386718705 /opt/stage2/pod-cassandra-aci-cassandra/rootfs/data/keyspaces/email_logs_query/emails-2d4abd00e9ea11e591199d740e07bd95
java    19076 root 2149r      DIR   8,17      143360 4386718705 /opt/stage2/pod-cassandra-aci-cassandra/rootfs/data/keyspaces/email_logs_query/emails-2d4abd00e9ea11e591199d740e07bd95
java    19076 root 2150r      DIR   8,17      143360 4386718705 /opt/stage2/pod-cassandra-aci-cassandra/rootfs/data/keyspaces/email_logs_query/emails-2d4abd00e9ea11e591199d740e07bd95
java    19076 root 2151r      DIR   8,17      143360 4386718705 /opt/stage2/pod-cassandra-aci-cassandra/rootfs/data/keyspaces/email_logs_query/emails-2d4abd00e9ea11e591199d740e07bd95
java    19076 root 2152r      DIR   8,17      143360 4386718705 /opt/stage2/pod-cassandra-aci-cassandra/rootfs/data/keyspaces/email_logs_query/emails-2d4abd00e9ea11e591199d740e07bd95
java    19076 root 2153r      DIR   8,17      143360 4386718705 /opt/stage2/pod-cassandra-aci-cassandra/rootfs/data/keyspaces/email_logs_query/emails-2d4abd00e9ea11e591199d740e07bd95
java    19076 root 2154r      DIR   8,17      143360 4386718705 /opt/stage2/pod-cassandra-aci-cassandra/rootfs/data/keyspaces/email_logs_query/emails-2d4abd00e9ea11e591199d740e07bd95
java    19076 root 2155r      DIR   8,17      143360 4386718705 /opt/stage2/pod-cassandra-aci-cassandra/rootfs/data/keyspaces/email_logs_query/emails-2d4abd00e9ea11e591199d740e07bd95
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;


&lt;p&gt;The 3 others nodes crashes 4 hours later&lt;/p&gt;</description>
                <environment></environment>
        <key id="12959587">CASSANDRA-11594</key>
            <summary>Too many open files on directories</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10000" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Urgent</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="stefania">Stefania Alborghetti</assignee>
                                    <reporter username="n0rad">n0rad</reporter>
                        <labels>
                    </labels>
                <created>Mon, 18 Apr 2016 09:23:45 +0000</created>
                <updated>Tue, 16 Apr 2019 09:30:35 +0000</updated>
                            <resolved>Fri, 26 Aug 2016 17:08:28 +0000</resolved>
                                        <fixVersion>3.0.9</fixVersion>
                    <fixVersion>3.10</fixVersion>
                                    <component>Legacy/Core</component>
                        <due></due>
                            <votes>1</votes>
                                    <watches>8</watches>
                                                                                                                <comments>
                            <comment id="15245491" author="blerer" created="Mon, 18 Apr 2016 11:32:12 +0000"  >&lt;p&gt;Are you using a compressed commit log?&lt;/p&gt;</comment>
                            <comment id="15245495" author="n0rad" created="Mon, 18 Apr 2016 11:34:17 +0000"  >&lt;p&gt;no, default conf on this part&lt;/p&gt;</comment>
                            <comment id="15245826" author="n0rad" created="Mon, 18 Apr 2016 15:06:54 +0000"  >&lt;p&gt;I have restarted all down nodes and run a full repair on 1 node 4 hours ago.&lt;/p&gt;

&lt;p&gt;the node just crashed with too many open files again with 64491 open dirs&lt;/p&gt;</comment>
                            <comment id="15246363" author="n0rad" created="Mon, 18 Apr 2016 19:18:06 +0000"  >&lt;p&gt;here is the evolution of openfiles on 4 days on all servers. I don&apos;t know if it can help&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;image-wrap&quot; style=&quot;&quot;&gt;&lt;img src=&quot;https://issues.apache.org/jira/secure/attachment/12799327/12799327_screenshot.png&quot; style=&quot;border: 0px solid black&quot; /&gt;&lt;/span&gt;&lt;/p&gt;</comment>
                            <comment id="15246388" author="doanduyhai" created="Mon, 18 Apr 2016 19:29:33 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=n0rad&quot; class=&quot;user-hover&quot; rel=&quot;n0rad&quot;&gt;n0rad&lt;/a&gt; Do you know which event that triggers the spikes in open folders/files ? Compaction ? Repair ? &lt;/p&gt;</comment>
                            <comment id="15246402" author="n0rad" created="Mon, 18 Apr 2016 19:47:53 +0000"  >&lt;p&gt;on the 15 at start, a little bit more activity than usual with around 2 pending compactions until the crash. no repair.&lt;/p&gt;

&lt;p&gt;today&apos;s crash is probably linked to my full repair on node 1.&lt;br/&gt;
I have restarted all nodes with a huge max open files just after.&lt;/p&gt;

&lt;p&gt;I will re-run the repair tomorrow.&lt;/p&gt;</comment>
                            <comment id="15246407" author="n0rad" created="Mon, 18 Apr 2016 19:51:04 +0000"  >&lt;p&gt;I&apos;ve just attached the list of open files on cassandra process on node 1 that crashes today during the repair&lt;/p&gt;</comment>
                            <comment id="15246449" author="doanduyhai" created="Mon, 18 Apr 2016 20:15:27 +0000"  >&lt;p&gt;Can you also upload some logs with full exception stack trace to narrow down the root cause ?&lt;/p&gt;</comment>
                            <comment id="15249409" author="blerer" created="Wed, 20 Apr 2016 07:19:08 +0000"  >&lt;p&gt;Could it be related to: &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-11412&quot; title=&quot;Many sstablescanners opened during repair&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-11412&quot;&gt;&lt;del&gt;CASSANDRA-11412&lt;/del&gt;&lt;/a&gt;?&lt;/p&gt;</comment>
                            <comment id="15249446" author="n0rad" created="Wed, 20 Apr 2016 07:48:45 +0000"  >&lt;p&gt;Probably not in the repair process itself. the first crash was the same and I had no repair process at that time. I run it manually after to try to repair the crash.&lt;/p&gt;</comment>
                            <comment id="15253569" author="ifesdjeen" created="Fri, 22 Apr 2016 08:56:14 +0000"  >&lt;p&gt;I&apos;ve noticed there&apos;re many handles open against directories (24K vs 2,5K opened against files in this directory, similar situation with another directory).&lt;br/&gt;
Stressing node so far revealed no obvious leaks. Are &lt;tt&gt;emails_by_user_id&lt;/tt&gt; and &lt;tt&gt;email_logs_query&lt;/tt&gt; MVs?&lt;/p&gt;</comment>
                            <comment id="15253573" author="n0rad" created="Fri, 22 Apr 2016 08:59:32 +0000"  >&lt;p&gt;`emails_by_user_id` is a MV from `emails`.&lt;/p&gt;

&lt;p&gt;`email_logs_query` is the keyspace&apos;s name.&lt;/p&gt;
</comment>
                            <comment id="15253579" author="ifesdjeen" created="Fri, 22 Apr 2016 09:04:28 +0000"  >&lt;p&gt;Thanks, I&apos;ve meant &lt;tt&gt;emails&lt;/tt&gt; not &lt;tt&gt;email_logs_query&lt;/tt&gt;, typed it in wrong.&lt;/p&gt;</comment>
                            <comment id="15416715" author="n0rad" created="Thu, 11 Aug 2016 07:55:32 +0000"  >&lt;p&gt;A comment to let you know that it still occur on 3.0.7, the cluster is slowly growing in openfiles.&lt;/p&gt;

&lt;p&gt;I&apos;m not running running repair on the cluster to be sure it will not crash.&lt;/p&gt;

&lt;p&gt;A month ago, I had a down node for 12h. I get it back with a rebuild but had to stop it at 80K openfiles&lt;/p&gt;</comment>
                            <comment id="15422353" author="blerer" created="Tue, 16 Aug 2016 07:36:59 +0000"  >&lt;p&gt;I think we should ty to narrow down the problem as we cannot reproduce the problem on our side.&lt;br/&gt;
Do you have identified what is causing the increase of open files? normal activity, compaction or repair.&lt;br/&gt;
Do you have multiple keyspaces? Is only one affected by this problem? what is your Operating System and File System?&lt;/p&gt;</comment>
                            <comment id="15422453" author="n0rad" created="Tue, 16 Aug 2016 09:02:11 +0000"  >&lt;p&gt;Normal activity make it grow slowly. Repair make it grow faster and reaching 80K in few hours.&lt;br/&gt;
Nodes starts with about 600-700 openfiles. Normal activity is about 50 write/s by nodes on 6 nodes.&lt;br/&gt;
It reaches about 5K openfiles in 2 weeks (without repair).&lt;/p&gt;

&lt;p&gt;I have only one keyspace, 3 tables, 1 MV.&lt;/p&gt;

&lt;p&gt;The cluster is installed with a debian jessie base using apache deb repo and jessie-backports for openjdk.&lt;br/&gt;
Nodes are running on rkt containers.&lt;/p&gt;

&lt;p&gt;I have 2 other 2.1 clusters installed and running exactly the same way that do not have the issue.&lt;br/&gt;
I also have a 2.2 cluster but there is not enough activity on it to tell if there is the problem there.&lt;/p&gt;
</comment>
                            <comment id="15422497" author="blerer" created="Tue, 16 Aug 2016 09:42:01 +0000"  >&lt;p&gt;What compaction strategy do you use?&lt;/p&gt;</comment>
                            <comment id="15422580" author="n0rad" created="Tue, 16 Aug 2016 10:47:54 +0000"  >&lt;p&gt;Sorry It&apos;s actually 2 keyspaces : &lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;CREATE KEYSPACE email_logs_query WITH replication = {&lt;span class=&quot;code-quote&quot;&gt;&apos;class&apos;&lt;/span&gt;: &lt;span class=&quot;code-quote&quot;&gt;&apos;NetworkTopologyStrategy&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;DC1&apos;&lt;/span&gt;: &lt;span class=&quot;code-quote&quot;&gt;&apos;1&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;DC2&apos;&lt;/span&gt;: &lt;span class=&quot;code-quote&quot;&gt;&apos;3&apos;&lt;/span&gt;}  AND durable_writes = &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;;

CREATE TYPE email_logs_query.click_user_type (
    created_at timeuuid,
    link_category text
);

CREATE TABLE email_logs_query.emails (
    email_id text,
    user_id blob,
    clicks list&amp;lt;frozen&amp;lt;click_user_type&amp;gt;&amp;gt;,
    created_at timeuuid,
    email text,
    lang text,
    opens list&amp;lt;timeuuid&amp;gt;,
    sender text,
    site_id &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;,
    type text,
    PRIMARY KEY (email_id, user_id)
) WITH CLUSTERING ORDER BY (user_id ASC)
    AND bloom_filter_fp_chance = 0.1
    AND caching = {&lt;span class=&quot;code-quote&quot;&gt;&apos;keys&apos;&lt;/span&gt;: &lt;span class=&quot;code-quote&quot;&gt;&apos;ALL&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;rows_per_partition&apos;&lt;/span&gt;: &lt;span class=&quot;code-quote&quot;&gt;&apos;NONE&apos;&lt;/span&gt;}
    AND comment = &apos;&apos;
    AND compaction = {&lt;span class=&quot;code-quote&quot;&gt;&apos;class&apos;&lt;/span&gt;: &lt;span class=&quot;code-quote&quot;&gt;&apos;org.apache.cassandra.db.compaction.SizeTieredCompactionStrategy&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;max_threshold&apos;&lt;/span&gt;: &lt;span class=&quot;code-quote&quot;&gt;&apos;32&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;min_threshold&apos;&lt;/span&gt;: &lt;span class=&quot;code-quote&quot;&gt;&apos;4&apos;&lt;/span&gt;}
    AND compression = {&lt;span class=&quot;code-quote&quot;&gt;&apos;chunk_length_in_kb&apos;&lt;/span&gt;: &lt;span class=&quot;code-quote&quot;&gt;&apos;64&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;class&apos;&lt;/span&gt;: &lt;span class=&quot;code-quote&quot;&gt;&apos;org.apache.cassandra.io.compress.LZ4Compressor&apos;&lt;/span&gt;}
    AND crc_check_chance = 1.0
    AND dclocal_read_repair_chance = 0.1
    AND default_time_to_live = 0
    AND gc_grace_seconds = 864000
    AND max_index_interval = 2048
    AND memtable_flush_period_in_ms = 0
    AND min_index_interval = 128
    AND read_repair_chance = 0.0
    AND speculative_retry = &lt;span class=&quot;code-quote&quot;&gt;&apos;99PERCENTILE&apos;&lt;/span&gt;;

CREATE MATERIALIZED VIEW email_logs_query.emails_by_user_id AS
    SELECT *
    FROM email_logs_query.emails
    WHERE user_id IS NOT NULL AND created_at IS NOT NULL AND email_id IS NOT NULL
    PRIMARY KEY (user_id, created_at, email_id)
    WITH CLUSTERING ORDER BY (created_at DESC, email_id ASC)
    AND bloom_filter_fp_chance = 0.01
    AND caching = {&lt;span class=&quot;code-quote&quot;&gt;&apos;keys&apos;&lt;/span&gt;: &lt;span class=&quot;code-quote&quot;&gt;&apos;ALL&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;rows_per_partition&apos;&lt;/span&gt;: &lt;span class=&quot;code-quote&quot;&gt;&apos;NONE&apos;&lt;/span&gt;}
    AND comment = &apos;&apos;
    AND compaction = {&lt;span class=&quot;code-quote&quot;&gt;&apos;class&apos;&lt;/span&gt;: &lt;span class=&quot;code-quote&quot;&gt;&apos;org.apache.cassandra.db.compaction.SizeTieredCompactionStrategy&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;max_threshold&apos;&lt;/span&gt;: &lt;span class=&quot;code-quote&quot;&gt;&apos;32&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;min_threshold&apos;&lt;/span&gt;: &lt;span class=&quot;code-quote&quot;&gt;&apos;4&apos;&lt;/span&gt;}
    AND compression = {&lt;span class=&quot;code-quote&quot;&gt;&apos;chunk_length_in_kb&apos;&lt;/span&gt;: &lt;span class=&quot;code-quote&quot;&gt;&apos;64&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;class&apos;&lt;/span&gt;: &lt;span class=&quot;code-quote&quot;&gt;&apos;org.apache.cassandra.io.compress.LZ4Compressor&apos;&lt;/span&gt;}
    AND crc_check_chance = 1.0
    AND dclocal_read_repair_chance = 0.1
    AND default_time_to_live = 0
    AND gc_grace_seconds = 864000
    AND max_index_interval = 2048
    AND memtable_flush_period_in_ms = 0
    AND min_index_interval = 128
    AND read_repair_chance = 0.0
    AND speculative_retry = &lt;span class=&quot;code-quote&quot;&gt;&apos;99PERCENTILE&apos;&lt;/span&gt;;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;CREATE KEYSPACE email_logs_command WITH replication = {&lt;span class=&quot;code-quote&quot;&gt;&apos;class&apos;&lt;/span&gt;: &lt;span class=&quot;code-quote&quot;&gt;&apos;NetworkTopologyStrategy&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;DC1&apos;&lt;/span&gt;: &lt;span class=&quot;code-quote&quot;&gt;&apos;1&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;DC2&apos;&lt;/span&gt;: &lt;span class=&quot;code-quote&quot;&gt;&apos;3&apos;&lt;/span&gt;}  AND durable_writes = &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;;

CREATE TABLE email_logs_command.events (
    bucket bigint,
    date timeuuid,
    event_type text,
    version &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;,
    event text,
    PRIMARY KEY (bucket, date, event_type, version)
) WITH CLUSTERING ORDER BY (date ASC, event_type ASC, version ASC)
    AND bloom_filter_fp_chance = 0.01
    AND caching = {&lt;span class=&quot;code-quote&quot;&gt;&apos;keys&apos;&lt;/span&gt;: &lt;span class=&quot;code-quote&quot;&gt;&apos;ALL&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;rows_per_partition&apos;&lt;/span&gt;: &lt;span class=&quot;code-quote&quot;&gt;&apos;NONE&apos;&lt;/span&gt;}
    AND comment = &apos;&apos;
    AND compaction = {&lt;span class=&quot;code-quote&quot;&gt;&apos;class&apos;&lt;/span&gt;: &lt;span class=&quot;code-quote&quot;&gt;&apos;org.apache.cassandra.db.compaction.SizeTieredCompactionStrategy&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;max_threshold&apos;&lt;/span&gt;: &lt;span class=&quot;code-quote&quot;&gt;&apos;32&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;min_threshold&apos;&lt;/span&gt;: &lt;span class=&quot;code-quote&quot;&gt;&apos;4&apos;&lt;/span&gt;}
    AND compression = {&lt;span class=&quot;code-quote&quot;&gt;&apos;chunk_length_in_kb&apos;&lt;/span&gt;: &lt;span class=&quot;code-quote&quot;&gt;&apos;64&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;class&apos;&lt;/span&gt;: &lt;span class=&quot;code-quote&quot;&gt;&apos;org.apache.cassandra.io.compress.LZ4Compressor&apos;&lt;/span&gt;}
    AND crc_check_chance = 1.0
    AND dclocal_read_repair_chance = 0.1
    AND default_time_to_live = 0
    AND gc_grace_seconds = 864000
    AND max_index_interval = 2048
    AND memtable_flush_period_in_ms = 0
    AND min_index_interval = 128
    AND read_repair_chance = 0.0
    AND speculative_retry = &lt;span class=&quot;code-quote&quot;&gt;&apos;99PERCENTILE&apos;&lt;/span&gt;;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="15427488" author="stefania" created="Fri, 19 Aug 2016 01:58:52 +0000"  >&lt;p&gt;I&apos;ve assigned this ticket to myself, what I plan to do is create a distributed test with the same topology and schema, that runs repair and monitors the file descriptors, cc &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=cassandra-te&quot; class=&quot;user-hover&quot; rel=&quot;cassandra-te&quot;&gt;cassandra-te&lt;/a&gt; in case they have resources to assist with this.&lt;/p&gt;

&lt;p&gt;If we cannot reproduce it that way, we could analyze a heap dump taken while the problem occurs. We would search for any file input stream instances and look at the GC roots. Let us know if you would be able to share a heap dump &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=n0rad&quot; class=&quot;user-hover&quot; rel=&quot;n0rad&quot;&gt;n0rad&lt;/a&gt; as that might speed things up.&lt;/p&gt;</comment>
                            <comment id="15430979" author="philipthompson" created="Mon, 22 Aug 2016 15:22:52 +0000"  >&lt;p&gt;We&apos;re currently working on several other tickets, and could only pick this up if we bumped one of those. Is that something we should do? We can talk offline.&lt;/p&gt;</comment>
                            <comment id="15431966" author="stefania" created="Tue, 23 Aug 2016 01:52:34 +0000"  >&lt;p&gt;Thanks, I don&apos;t think we need to bump any other ticket for now. &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=sean.mccarthy&quot; class=&quot;user-hover&quot; rel=&quot;sean.mccarthy&quot;&gt;sean.mccarthy&lt;/a&gt; is already working on &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-11906&quot; title=&quot;Unstable JVM due too many files when anticompacting big LCS tables&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-11906&quot;&gt;&lt;del&gt;CASSANDRA-11906&lt;/del&gt;&lt;/a&gt;, and there is a good chance that it might be the same root cause. I left a comment on that ticket with more details. So let&apos;s continue with 11906 for now and see what that gives.&lt;/p&gt;

&lt;p&gt;I should also be able to start working on this myself in the next few days.&lt;/p&gt;</comment>
                            <comment id="15432661" author="n0rad" created="Tue, 23 Aug 2016 11:52:17 +0000"  >&lt;p&gt;So yesterday, I worked on getting a dump :&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;image-wrap&quot; style=&quot;&quot;&gt;&lt;img src=&quot;https://issues.apache.org/jira/secure/attachment/12825037/Grafana%20%20%20Cassandra%20%20%20Cluster.png&quot; style=&quot;border: 0px solid black&quot; /&gt;&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;I wanted to let the night pass and do repair on other nodes to reach something like 70k before dumping but 3 nodes crashed at 7am and let the cluster unavailable.&lt;br/&gt;
Since it&apos;s a production cluster I dumped node2 &#224; ~20k and get back production to life.&lt;/p&gt;
</comment>
                            <comment id="15432669" author="n0rad" created="Tue, 23 Aug 2016 11:56:47 +0000"  >&lt;p&gt;dump is here : &lt;a href=&quot;https://drive.google.com/file/d/0B7CxMee2BQoVd2l0WXpyckEyTUE/view?usp=sharing&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://drive.google.com/file/d/0B7CxMee2BQoVd2l0WXpyckEyTUE/view?usp=sharing&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;I can reproduce If needed.&lt;/p&gt;

&lt;p&gt;repair command was -pr -seq&lt;/p&gt;</comment>
                            <comment id="15434244" author="stefania" created="Wed, 24 Aug 2016 06:17:58 +0000"  >&lt;p&gt;Thanks for the heap dump, I&apos;ve downloaded it and I&apos;m taking a look.&lt;/p&gt;</comment>
                            <comment id="15434675" author="stefania" created="Wed, 24 Aug 2016 10:40:01 +0000"  >&lt;p&gt;I may have found something that could explain this and here is the patch:&lt;/p&gt;

&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;3.0&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;trunk&lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/stef1927/cassandra/commits/11594-3.0&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;patch&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/stef1927/cassandra/commits/11594&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;patch&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/stef1927/job/stef1927-11594-3.0-testall/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;testall&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/stef1927/job/stef1927-11594-testall/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;testall&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/stef1927/job/stef1927-11594-3.0-dtest/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;dtest&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/stef1927/job/stef1927-11594-dtest/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;dtest&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;


&lt;p&gt;However, I am trying to reproduce the problem with a &lt;a href=&quot;https://github.com/stef1927/cassandra-dtest/commit/c148972797c725a37ee8d2d59119039e32149f0f#diff-60812631a43b8e1f0c9fb53d9f7487ebR208&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;test&lt;/a&gt; and I am failing to do so. I think I need more data. I&apos;ll continue tomorrow.&lt;/p&gt;</comment>
                            <comment id="15436259" author="stefania" created="Thu, 25 Aug 2016 04:13:46 +0000"  >&lt;p&gt;I&apos;ve reproduced a leak of directory descriptors with a &lt;a href=&quot;https://github.com/stef1927/cassandra-dtest/commit/6ca5ae864676589132e656105da4c204621692be#diff-60812631a43b8e1f0c9fb53d9f7487ebR209&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;test&lt;/a&gt;. The bug mentioned above would leak file descriptors for directories if:&lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;A transaction log file is present, this means there is an ongoing transaction such as flushing or compaction (note that repair uses many validation compactions)&lt;/li&gt;
	&lt;li&gt;A request to list the files in a table directory is issued in parallel, this would occur in the following cases:
	&lt;ol&gt;
		&lt;li&gt;when loading sstables at startup or via nodetool&lt;/li&gt;
		&lt;li&gt;when calculating the snapshots size via nodetool listsnapshots or reading the SnapshotSize metric&lt;/li&gt;
		&lt;li&gt;when adding new tables to the schema or updating the keyspace&lt;/li&gt;
		&lt;li&gt;when creating indexes or materialized views, or when they get rebuilt&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;Of all the points above, I think the most likely is the SnapshotSize metric being monitored, which is how I reproduced the leak in my test, by inserting data in parallel with a repair and with a nodetool listshapshots (which exercises the same code as reading SnapshotSize does).&lt;/p&gt;

&lt;p&gt;So &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=n0rad&quot; class=&quot;user-hover&quot; rel=&quot;n0rad&quot;&gt;n0rad&lt;/a&gt; do you monitor SnapshotSize by any chance, or can you think of any other of the points above that might apply? If you want to test the patch let us know, I can apply it to your release version.&lt;/p&gt;</comment>
                            <comment id="15436405" author="n0rad" created="Thu, 25 Aug 2016 07:21:00 +0000"  >&lt;p&gt;I have a prometheus exporter that go through everything exposed in JMX every 20sec and I have a listsnapshots every day to get old snapshots to clear&lt;br/&gt;
So it&apos;s probably prometheus exporter that cause so much leak.&lt;/p&gt;

&lt;p&gt;I will try to test the patch in the following 12h.&lt;/p&gt;</comment>
                            <comment id="15436412" author="doanduyhai" created="Thu, 25 Aug 2016 07:27:31 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=n0rad&quot; class=&quot;user-hover&quot; rel=&quot;n0rad&quot;&gt;n0rad&lt;/a&gt; To confirm that prometheus exporter is the culprit, you can also try to deactivate it for a few time and watch if the number of open files decreases or remains stable&lt;/p&gt;</comment>
                            <comment id="15436418" author="stefania" created="Thu, 25 Aug 2016 07:34:23 +0000"  >&lt;p&gt;The number of open file descriptors won&apos;t decrease because they are leaked permanently till a restart, but they should stop increasing. &lt;/p&gt;

&lt;p&gt;Do you need a custom branch or jar to test the patch? If so let me know if you current release version is still 3.0.5.&lt;/p&gt;</comment>
                            <comment id="15436471" author="n0rad" created="Thu, 25 Aug 2016 08:23:15 +0000"  >&lt;p&gt;I&apos;m on 3.0.8. A jar is welcome&lt;/p&gt;</comment>
                            <comment id="15436492" author="ostefano" created="Thu, 25 Aug 2016 08:36:16 +0000"  >&lt;p&gt;3.0.8 here too, would use the jar too.&lt;br/&gt;
Is this fix going to make it for the next release, 3.0.9?&lt;/p&gt;</comment>
                            <comment id="15436511" author="stefania" created="Thu, 25 Aug 2016 08:45:09 +0000"  >&lt;p&gt;Attached &lt;span class=&quot;nobr&quot;&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12825434/12825434_apache-cassandra-3.0.8-SNAPSHOT.jar&quot; title=&quot;apache-cassandra-3.0.8-SNAPSHOT.jar attached to CASSANDRA-11594&quot;&gt;apache-cassandra-3.0.8-SNAPSHOT.jar&lt;sup&gt;&lt;img class=&quot;rendericon&quot; src=&quot;https://issues.apache.org/jira/images/icons/link_attachment_7.gif&quot; height=&quot;7&quot; width=&quot;7&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/sup&gt;&lt;/a&gt;&lt;/span&gt; built from &lt;a href=&quot;https://github.com/stef1927/cassandra/commits/11594-3.0.8&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;this branch&lt;/a&gt; with &lt;tt&gt;ant realclean build-test stress-build jar&lt;/tt&gt;.&lt;/p&gt;

&lt;p&gt;Double check that the size is approximately the same as the 3.0.8 jar, as I normally don&apos;t build releases and so there is a chance I may have made a mistake. If you could try it out in a test environment first that would be highly advised.&lt;/p&gt;</comment>
                            <comment id="15436517" author="stefania" created="Thu, 25 Aug 2016 08:46:59 +0000"  >&lt;p&gt;Yes as far as I know 3.0.9 is not closed yet.&lt;/p&gt;</comment>
                            <comment id="15436556" author="ostefano" created="Thu, 25 Aug 2016 09:14:44 +0000"  >&lt;p&gt;That&apos;s good news!&lt;/p&gt;</comment>
                            <comment id="15436784" author="ostefano" created="Thu, 25 Aug 2016 12:55:13 +0000"  >&lt;p&gt;I can confirm the size is approximately the same (and 2 bytes off from the one I compiled locally)&lt;/p&gt;</comment>
                            <comment id="15436867" author="n0rad" created="Thu, 25 Aug 2016 13:33:40 +0000"  >&lt;p&gt;I have repaired 3 nodes without going over 600 openfiles. But I have a strange thing, the nodetool repair command stick at 4% and never end while there is no more active/pending repair tasks.&lt;br/&gt;
Not sure what is going on.&lt;/p&gt;</comment>
                            <comment id="15436872" author="ostefano" created="Thu, 25 Aug 2016 13:37:04 +0000"  >&lt;p&gt;&lt;del&gt;What is the output of &quot;nodetool compactionstats&quot;?&lt;/del&gt;&lt;/p&gt;

&lt;p&gt;Scratch, just read your message.&lt;br/&gt;
Anything weird inside debug.log?&lt;/p&gt;</comment>
                            <comment id="15436885" author="stefania" created="Thu, 25 Aug 2016 13:50:31 +0000"  >&lt;p&gt;Take a thread dump of the Cassandra and nodetool processes if they are is still running, and then attach them along with debug.log. I will take a look tomorrow.&lt;/p&gt;

&lt;p&gt;If you cannot work it out, safest thing is to return to the official 3.0.8 release jar file and avoid monitoring the snapshot size until 3.0.9 is released.&lt;/p&gt;

&lt;p&gt;I think we can safely say that the directory descriptors leak is fixed, thank you so much for your help.&lt;/p&gt;</comment>
                            <comment id="15436896" author="n0rad" created="Thu, 25 Aug 2016 13:55:16 +0000"  >&lt;p&gt;actually, it&apos;s the repair command that was stuck at 4%&lt;/p&gt;

&lt;p&gt;the compactionstats looks in progress on &quot;Anticompaction after repair&quot;&lt;/p&gt;


&lt;p&gt;It may be due to the fact it&apos;s the first repair I will get to the end.&lt;/p&gt;

</comment>
                            <comment id="15436901" author="ostefano" created="Thu, 25 Aug 2016 13:57:44 +0000"  >&lt;p&gt;I can confirm that AntiCompactions do take a while.&lt;/p&gt;</comment>
                            <comment id="15438713" author="ostefano" created="Fri, 26 Aug 2016 09:32:14 +0000"  >&lt;p&gt;Had one node crashing for too many files open even if I wasn&apos;t repairing.&lt;br/&gt;
I replaced the updated JAR, issued a repair (node was down for 2 hours) and monitoring the opened files.&lt;br/&gt;
So far so good.&lt;/p&gt;</comment>
                            <comment id="15438726" author="ostefano" created="Fri, 26 Aug 2016 09:46:57 +0000"  >&lt;p&gt;In the meanwhile I am also monitoring another node which is exhibiting a high number of files, and I can confirm that most are duplicate directory descriptors.&lt;/p&gt;

&lt;p&gt;I can also confirm that the patched nodes open and close those file descriptors (opened directories are a handful and never the same, this while repairing)&lt;/p&gt;</comment>
                            <comment id="15438730" author="ostefano" created="Fri, 26 Aug 2016 09:51:29 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=Stefania&quot; class=&quot;user-hover&quot; rel=&quot;stefania&quot;&gt;Stefania&lt;/a&gt; the patch seems to be working quite well. Thanks a lot! &lt;br/&gt;
How can we make sure is it going to be merged before 3.0.9? &lt;br/&gt;
Is there anyone I should ping on C* IRC channel?&lt;/p&gt;</comment>
                            <comment id="15438744" author="ostefano" created="Fri, 26 Aug 2016 09:59:06 +0000"  >&lt;p&gt;Current situation:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;root@node6:~# lsof -n -p 22494 | sort | grep DIR
java    22494 cassandra 2413r      DIR              252,2      4096     262584 /var/lib/cassandra/hints
java    22494 cassandra 2414r      DIR              252,2      4096     262584 /var/lib/cassandra/hints
java    22494 cassandra 3011r      DIR              252,3     40960   48365594 /data/cassandra/data/keyspace/cf1-c2ad7cf0800c11e48a94fb3921529dd4
java    22494 cassandra 4306r      DIR              252,3     69632   48759090 /data/cassandra/data/keyspace/cf2-7d2f379014a311e69af3cdff32bdcb0d
java    22494 cassandra 6263r      DIR              252,3    253952   48365591 /data/cassandra/data/keyspace/cf3-bca9b940800c11e48a94fb3921529dd4
java    22494 cassandra 6458r      DIR              252,3    380928   48365671 /data/cassandra/data/keyspace/cf4-37a9cb90b7ac11e48a9b6776bf484396
java    22494 cassandra  cwd       DIR              252,1      4096          2 /
java    22494 cassandra  rtd       DIR              252,1      4096          2 /
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="15438760" author="stefania" created="Fri, 26 Aug 2016 10:17:31 +0000"  >&lt;p&gt;Thanks for the updates &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ostefano&quot; class=&quot;user-hover&quot; rel=&quot;ostefano&quot;&gt;ostefano&lt;/a&gt;, it&apos;s great to know the patch is working.&lt;/p&gt;

&lt;p&gt;Regarding 3.0.9, in the worst of cases one can vote down the release with a non-binding -1 on the dev mailing list, should the vote be started before this is committed.  However, I&apos;ll try to find a reviewer so that it gets committed before 3.0.9 is tagged, cc &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=thobbs&quot; class=&quot;user-hover&quot; rel=&quot;thobbs&quot;&gt;thobbs&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="15439403" author="thobbs" created="Fri, 26 Aug 2016 17:08:28 +0000"  >&lt;p&gt;+1, committed as &lt;tt&gt;da07130e4e08cd8645001c6f7fa9ea2acb2072ca&lt;/tt&gt; to 3.0 and merged to trunk.  I did make one minor change when committing: I added a &lt;tt&gt;&amp;#64;SuppressWarnings(&quot;resource&quot;)&lt;/tt&gt; in &lt;tt&gt;LogReplicaSet&lt;/tt&gt; to the &lt;tt&gt;LogReplica.create()&lt;/tt&gt; call since that resulted in a new eclipse warning.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                            <outwardlinks description="duplicates">
                                        <issuelink>
            <issuekey id="12973419">CASSANDRA-11906</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="13035922">CASSANDRA-13133</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12825037" name="Grafana   Cassandra   Cluster.png" size="91049" author="n0rad" created="Tue, 23 Aug 2016 11:47:55 +0000"/>
                            <attachment id="12825434" name="apache-cassandra-3.0.8-SNAPSHOT.jar" size="5314815" author="stefania" created="Thu, 25 Aug 2016 08:45:09 +0000"/>
                            <attachment id="12799337" name="openfiles.zip" size="238017" author="n0rad" created="Mon, 18 Apr 2016 19:51:04 +0000"/>
                            <attachment id="12799327" name="screenshot.png" size="131629" author="n0rad" created="Mon, 18 Apr 2016 19:18:06 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>4.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[stefania]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 12 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2w913:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12311421" key="com.atlassian.jira.plugin.system.customfieldtypes:multiversion">
                        <customfieldname>Reproduced In</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="12334964">3.0.5</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>thobbs</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[thobbs]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12963"><![CDATA[Critical]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>