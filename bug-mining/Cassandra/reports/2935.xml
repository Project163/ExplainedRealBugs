<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 22:46:18 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-7403] Reconciliation doesn&apos;t consider fields specific to expiring cells</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-7403</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;Reconciling 2 ExpiringColumns which are equal in every way except for the localExpirationTime field will always favour the instance on which reconcile is called as fields specific to expiration are not considered. &lt;/p&gt;

&lt;p&gt;This is actually beneficial in pre-2.1 versions as in AtomicSortedColumns.Holder.addColumn we call reconcile on the new column, which &apos;wins&apos; the reconcilliation and so the localExpirationTime is effectively extended.&lt;/p&gt;

&lt;p&gt;From 2.1 onwards, reconcile is actually called on the existing value (in BTreeSortedColumns.ColumnUpdater) and so it wins the reconcilliation and the ttl doesn&apos;t get extended. The same thing happens in the iterator returned from MergeIterator.Reducer.getReducer() so we see the same behaviour when merging cells from the multiple SSTables and/or memtables.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12721491">CASSANDRA-7403</key>
            <summary>Reconciliation doesn&apos;t consider fields specific to expiring cells</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10002" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Normal</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="benedict">Benedict Elliott Smith</assignee>
                                    <reporter username="samt">Sam Tunnicliffe</reporter>
                        <labels>
                    </labels>
                <created>Mon, 16 Jun 2014 19:33:42 +0000</created>
                <updated>Tue, 16 Apr 2019 09:31:42 +0000</updated>
                            <resolved>Tue, 8 Jul 2014 12:01:03 +0000</resolved>
                                        <fixVersion>2.1 rc3</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="14052279" author="benedict" created="Fri, 4 Jul 2014 09:04:42 +0000"  >&lt;p&gt;Patch available &lt;a href=&quot;https://github.com/belliottsmith/cassandra/tree/7403-ttlreconcile&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;here&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14053639" author="slebresne" created="Mon, 7 Jul 2014 13:24:04 +0000"  >&lt;p&gt;Technically, the patch lgtm. I&apos;m not sure I would have changed the rules for expiring cells to compare the expiration before comparing the values however, mainly for the sake of not changing an existing rule that was not really a bug. Of course, there is a real chance that no-one rely on this existing behaviour, but I&apos;m not sure there is much benefits to taking that chance. Or more precisely, what does changing the behaviour in that case buys us? (note that I buy that for equal values favouring the longer TTL makes sense as it gives you some kind of &quot;update the TTL in place&quot;, it&apos;s the unequal values case that is less clear to me).&lt;/p&gt;</comment>
                            <comment id="14053646" author="benedict" created="Mon, 7 Jul 2014 13:30:30 +0000"  >&lt;p&gt;I don&apos;t feel strongly about it tbh, however value comparison for reconciliation is basically a last resort and I think using TTLs here is better because:&lt;/p&gt;

&lt;p&gt;1) value reconciliation does not apply uniformly for a single update, so we could end up with a mix of both TTLs and values from different writes, where we might have a chance to uniformly select with TTLs&lt;br/&gt;
2) There is some indication the data itself takes greater precedence if you want to keep it longer&lt;/p&gt;
</comment>
                            <comment id="14053672" author="slebresne" created="Mon, 7 Jul 2014 14:00:57 +0000"  >&lt;p&gt;To be clear, I don&apos;t feel strongly on whether we should favour values-over-ttl or ttl-over-values in theory, I don&apos;t think it matters much on paper. But that&apos;s why I prefer keeping the existing behaviour.&lt;/p&gt;</comment>
                            <comment id="14053715" author="iamaleksey" created="Mon, 7 Jul 2014 14:49:12 +0000"  >&lt;p&gt;We should be comparing the parts common to all the types of cells first, otherwise you can get into tricky inconsistencies at least during the writes, if there are cells of different types on different nodes being potentially overwritten.&lt;/p&gt;</comment>
                            <comment id="14053860" author="jbellis" created="Mon, 7 Jul 2014 16:59:13 +0000"  >&lt;blockquote&gt;&lt;p&gt;value reconciliation does not apply uniformly for a single update, so we could end up with a mix of both TTLs and values from different writes, where we might have a chance to uniformly select with TTLs&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Pretty sure there are other situations where values gives you uniformity and TTL does not, as alluded to by Aleksey.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;There is some indication the data itself takes greater precedence if you want to keep it longer&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I don&apos;t think this is a strong enough reason to change things at this point.&lt;/p&gt;</comment>
                            <comment id="14054086" author="benedict" created="Mon, 7 Jul 2014 19:35:03 +0000"  >&lt;p&gt;I should note for the record that I don&apos;t fully agree with the reasoning(s) stated, however I definitely don&apos;t feel strongly enough about this to perpetuate the discussion.&lt;/p&gt;

&lt;p&gt;I&apos;ve uploaded a new version of the patch with reconcile order for expiring cells switched to ts,isdeleted,value,ttl&lt;/p&gt;</comment>
                            <comment id="14054103" author="iamaleksey" created="Mon, 7 Jul 2014 19:47:14 +0000"  >&lt;p&gt;+1&lt;/p&gt;</comment>
                            <comment id="14054156" author="benedict" created="Mon, 7 Jul 2014 20:17:34 +0000"  >&lt;p&gt;Committed&lt;/p&gt;</comment>
                            <comment id="14054792" author="slebresne" created="Tue, 8 Jul 2014 10:03:49 +0000"  >&lt;p&gt;The commit broke ColumnFamilyStoreTest.testIndexUpdateOverwritingExpiringColumns. It&apos;s not really the fault of the patch, it&apos;s more an incompleteness of &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-7268&quot; title=&quot;Secondary Index can miss data without an error&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-7268&quot;&gt;&lt;del&gt;CASSANDRA-7268&lt;/del&gt;&lt;/a&gt;, but since the later has been committed in released versions and the tests broke with this commit, let&apos;s quickly follow up here.&lt;/p&gt;

&lt;p&gt;The problem is that the patch &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-7268&quot; title=&quot;Secondary Index can miss data without an error&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-7268&quot;&gt;&lt;del&gt;CASSANDRA-7268&lt;/del&gt;&lt;/a&gt; was not properly rebased on 2.1: the &lt;tt&gt;shouldCleanupOldValue&lt;/tt&gt; path was only skipped in the case the new cell is not live (which is not too useful). Attaching simple followup that fixes that (I removed the SecondaryIndex.upate method because it was getting in the way, I figure that was not a big deal but maybe it is for custom indexes?). The patch also include minor updates of the comments of the patch for this ticket.&lt;/p&gt;</comment>
                            <comment id="14054797" author="slebresne" created="Tue, 8 Jul 2014 10:13:39 +0000"  >&lt;p&gt;Actually, seems like the &lt;tt&gt;SecondaryIndex.update&lt;/tt&gt; method was added on purpose (&lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-6640&quot; title=&quot;Improve custom 2i performance and abstraction&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-6640&quot;&gt;&lt;del&gt;CASSANDRA-6640&lt;/del&gt;&lt;/a&gt;) so I&apos;ve update the followup patch to preserve it (it&apos;s a bit more ugly imo but that will have to for now).&lt;/p&gt;</comment>
                            <comment id="14054820" author="beobal" created="Tue, 8 Jul 2014 10:53:35 +0000"  >&lt;p&gt;Sorry, my fault for screwing up the rebase of the 7268 patch for 2.1. &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=slebresne&quot; class=&quot;user-hover&quot; rel=&quot;slebresne&quot;&gt;slebresne&lt;/a&gt;, your latest update looks good to me.&lt;/p&gt;</comment>
                            <comment id="14054864" author="slebresne" created="Tue, 8 Jul 2014 12:01:03 +0000"  >&lt;p&gt;Alright, committed, thanks.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12654563" name="7403-followup.txt" size="6663" author="slebresne" created="Tue, 8 Jul 2014 10:13:39 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[benedict]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>399687</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            11 years, 20 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1wt07:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>399796</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12311421" key="com.atlassian.jira.plugin.system.customfieldtypes:multiversion">
                        <customfieldname>Reproduced In</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="12326174">1.2.16</customfieldvalue>
    <customfieldvalue id="12326712">2.0.8</customfieldvalue>
    <customfieldvalue id="12326658">2.1 rc1</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>aleksey</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[aleksey]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12962"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>