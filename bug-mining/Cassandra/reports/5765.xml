<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 23:21:02 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-16689] Flaky LeaveAndBootstrapTest</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-16689</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;Failing in a circle run &lt;a href=&quot;https://app.circleci.com/pipelines/github/bereng/cassandra/309/workflows/a645b956-dcd7-431e-b109-7857af3c523f/jobs/2937&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;here&lt;/a&gt;&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Testcase: testStateJumpToNormal(org.apache.cassandra.service.LeaveAndBootstrapTest):	Caused an ERROR
[junit-timeout] null
[junit-timeout] java.lang.NullPointerException
[junit-timeout] 	at org.apache.cassandra.service.StorageService.updatePeerInfo(StorageService.java:2418)
[junit-timeout] 	at org.apache.cassandra.service.StorageService.handleStateNormal(StorageService.java:2756)
[junit-timeout] 	at org.apache.cassandra.service.StorageService.onChange(StorageService.java:2299)
[junit-timeout] 	at org.apache.cassandra.Util.createInitialRing(Util.java:236)
[junit-timeout] 	at org.apache.cassandra.service.LeaveAndBootstrapTest.testStateJumpToNormal(LeaveAndBootstrapTest.java:550)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="13380029">CASSANDRA-16689</key>
            <summary>Flaky LeaveAndBootstrapTest</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10002" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Normal</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="brandon.williams">Brandon Williams</assignee>
                                    <reporter username="bereng">Berenguer Blasi</reporter>
                        <labels>
                    </labels>
                <created>Mon, 24 May 2021 06:26:25 +0000</created>
                <updated>Sat, 31 Jul 2021 21:28:43 +0000</updated>
                            <resolved>Tue, 15 Jun 2021 19:55:34 +0000</resolved>
                                        <fixVersion>4.0-rc1</fixVersion>
                    <fixVersion>4.0-rc2</fixVersion>
                    <fixVersion>4.0</fixVersion>
                                    <component>Test/unit</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="17355800" author="brandon.williams" created="Wed, 2 Jun 2021 15:25:19 +0000"  >&lt;p&gt;This is rather odd since this occurs in Util.createInitialRing, where it does not appear to be used incorrectly, so I would expect this to be more widespread given the use of this function in about 8 other tests.  I have not been able to reproduce myself and the multiplexer has been no help there either: &lt;a href=&quot;https://app.circleci.com/pipelines/github/driftx/cassandra/141/workflows/5b322f7d-32ce-41ec-88cb-7af1236af133/jobs/1099/steps&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://app.circleci.com/pipelines/github/driftx/cassandra/141/workflows/5b322f7d-32ce-41ec-88cb-7af1236af133/jobs/1099/steps&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17357439" author="brandon.williams" created="Fri, 4 Jun 2021 15:32:07 +0000"  >&lt;p&gt;It is also interesting to note that this NPE is rooted in getting the &lt;a href=&quot;https://github.com/apache/cassandra/blob/cassandra-4.0/src/java/org/apache/cassandra/service/StorageService.java#L2418&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;native_transport_port&lt;/a&gt; which is explicitly defined in &lt;a href=&quot;https://github.com/apache/cassandra/blob/cassandra-4.0/src/java/org/apache/cassandra/config/Config.java#L186&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;Config.java&lt;/a&gt; and so it would need to be explicitly nulled out somehow for this to occur, yet nowhere do we keep a yaml with it unset, and there are no -D overrides for it either, so it&apos;s rather confounding where this is even coming from.&lt;/p&gt;</comment>
                            <comment id="17358767" author="brandon.williams" created="Mon, 7 Jun 2021 17:55:13 +0000"  >&lt;p&gt;I don&apos;t see anywhere to go from here, so unassigning and hoping someone else comes up with something actionable.&lt;/p&gt;</comment>
                            <comment id="17359078" author="bereng" created="Tue, 8 Jun 2021 06:53:30 +0000"  >&lt;p&gt;You&apos;re looking at the wrong code. If you check the SHA of the test failure you&apos;ll see the NPE comes from &lt;a href=&quot;https://github.com/bereng/cassandra/blob/f7cd1c1f2508a9faf36c9ac2023f65841bb4628d/src/java/org/apache/cassandra/service/StorageService.java#L2418&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;pulling endpoint states&lt;/a&gt; not from config loading iiuc #collaborating&lt;/p&gt;</comment>
                            <comment id="17361849" author="adelapena" created="Fri, 11 Jun 2021 15:24:05 +0000"  >&lt;p&gt;I haven&apos;t been able to reproduce the failure in &lt;tt&gt;LeaveAndBootstrapTest.testStateJumpToNormal&lt;/tt&gt;, but I have found the same NPE in &lt;tt&gt;LeaveAndBootstrapTest.newTestWriteEndpointsDuringLeave&lt;/tt&gt; and &lt;tt&gt;LeaveAndBootstrapTest.testSimultaneousMove&lt;/tt&gt; while running the entire class in the multiplexer 10K times:&lt;/p&gt;
&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;&lt;a href=&quot;https://app.circleci.com/pipelines/github/adelapena/cassandra/575/workflows/2286e1e3-f103-422d-9492-c8c951b49e01/jobs/5367&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;j8-j8&lt;/a&gt;&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;&lt;a href=&quot;https://app.circleci.com/pipelines/github/adelapena/cassandra/575/workflows/2286e1e3-f103-422d-9492-c8c951b49e01/jobs/5368&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;j8-j11&lt;/a&gt;&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;&lt;a href=&quot;https://app.circleci.com/pipelines/github/adelapena/cassandra/575/workflows/9823e967-29ca-4f2f-ac5c-623b0dfca5b9/jobs/5361&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;j11-j11&lt;/a&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;


&lt;p&gt;The failure can also be reproduced by running &lt;tt&gt;testSimultaneousMove&lt;/tt&gt; in isolation, for example &lt;a href=&quot;https://app.circleci.com/pipelines/github/adelapena/cassandra/576/workflows/9060086d-4c2a-4689-9987-bd3354532777/jobs/5377&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;here&lt;/a&gt;, so it doesn&apos;t seem a problem of interaction between tests.&lt;/p&gt;</comment>
                            <comment id="17363001" author="brandon.williams" created="Mon, 14 Jun 2021 14:31:03 +0000"  >&lt;p&gt;Thanks for these!  Indeed it looks like the same problem rooted in createInitialRing.&lt;/p&gt;</comment>
                            <comment id="17363753" author="brandon.williams" created="Tue, 15 Jun 2021 16:25:33 +0000"  >&lt;blockquote&gt;&lt;p&gt;so it doesn&apos;t seem a problem of interaction between tests.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;On the surface it doesn&apos;t but in that case it was actually previous runs of the same test interfering, which is the entire cause of the failures in all these tests, since the bootstrapping (gossip-only) clients are sometimes being expired due to the modified (1s) ring delay at just the right time to break things.&lt;/p&gt;

&lt;p&gt;With the ring delay changes removed these pass the 10k test:&lt;br/&gt;
&lt;a href=&quot;https://app.circleci.com/pipelines/github/driftx/cassandra/150/workflows/80a208ec-3b42-4de4-965c-f8a900311c30/jobs/1271&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://app.circleci.com/pipelines/github/driftx/cassandra/150/workflows/80a208ec-3b42-4de4-965c-f8a900311c30/jobs/1271&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;but obviously doing that is too broad for all the tests.  I will work on another solution.&lt;/p&gt;</comment>
                            <comment id="17363847" author="brandon.williams" created="Tue, 15 Jun 2021 18:43:12 +0000"  >&lt;p&gt;Added a clearUnsafe to Gossiper similar to TMD &lt;a href=&quot;https://github.com/driftx/cassandra/tree/CASSANDRA-16689&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;here&lt;/a&gt; that allows us to pass the &lt;a href=&quot;https://app.circleci.com/pipelines/github/driftx/cassandra/152/workflows/4d317e35-ed5a-4ae1-a7cd-1b265afe149c/jobs/1287&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;10k test&lt;/a&gt;.  Given how many times I&apos;ve seen this kind of problem with just ring delay alone, I almost added it to TMD.clearUnsafe since if you&apos;re clearing that, you probably want to clear the gossiper too, but I didn&apos;t want to make a large sweeping change.&lt;/p&gt;</comment>
                            <comment id="17363880" author="adelapena" created="Tue, 15 Jun 2021 19:45:17 +0000"  >&lt;p&gt;Nice investigation! Looks good to me, +1.&lt;/p&gt;

&lt;p&gt;Adding the clearing of &lt;tt&gt;Gossiper&lt;/tt&gt; to &lt;tt&gt;TokenMetadata&lt;/tt&gt; sounds tempting but I agree that maybe it&apos;s better to leave that change for the future.&lt;/p&gt;

&lt;p&gt;I have left a trivial comment on the patch that can be addressed on commit, if needed.&lt;/p&gt;</comment>
                            <comment id="17363890" author="brandon.williams" created="Tue, 15 Jun 2021 19:55:34 +0000"  >&lt;p&gt;Committed w/nits addressed.  Thanks!&lt;/p&gt;</comment>
                            <comment id="17364055" author="bereng" created="Wed, 16 Jun 2021 04:55:17 +0000"  >&lt;p&gt;Nice investigation!&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[brandon.williams]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12313825" key="com.atlassian.jira.plugin.system.customfieldtypes:cascadingselect">
                        <customfieldname>Bug Category</customfieldname>
                        <customfieldvalues>
                                                    <customfieldvalue key="12982" cascade-level=""><![CDATA[Correctness]]></customfieldvalue>
            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12313821" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Complexity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12965"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313822" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Discovered By</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12970"><![CDATA[Unit Test]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12313922" key="jira.plugin.projectspecificselectfield.jpssf:multicftype">
                        <customfieldname>Impacts</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="13100"><![CDATA[None]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            4 years, 21 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12313921" key="jira.plugin.projectspecificselectfield.jpssf:multicftype">
                        <customfieldname>Platform</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="13076"><![CDATA[All]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0raxk:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[adelapena]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12962"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12311420" key="com.atlassian.jira.plugin.system.customfieldtypes:version">
                        <customfieldname>Since Version</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="12348835">NA</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313924" key="com.atlassian.jira.plugin.system.customfieldtypes:textfield">
                        <customfieldname>Source Control Link</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>&lt;p&gt;&lt;a href=&quot;https://github.com/apache/cassandra/commit/658e08dc7e7561a6313675a73a6dbd43c73bbde4&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/cassandra/commit/658e08dc7e7561a6313675a73a6dbd43c73bbde4&lt;/a&gt;&lt;/p&gt;</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313823" key="com.atlassian.jira.plugin.system.customfieldtypes:textarea">
                        <customfieldname>Test and Documentation Plan</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>&lt;p&gt;test&lt;/p&gt;</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>