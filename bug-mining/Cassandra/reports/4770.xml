<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 23:07:42 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-13559] Schema version id mismatch while upgrading to 3.0.13</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-13559</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;As the order of SchemaKeyspace is changed (&lt;a href=&quot;https://github.com/apache/cassandra/commit/6991556e431a51575744248a4c484270c4f918c9&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;6991556 &lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-12213&quot; title=&quot;dtest failure in write_failures_test.TestWriteFailures.test_paxos_any&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-12213&quot;&gt;&lt;del&gt;CASSANDRA-12213&lt;/del&gt;&lt;/a&gt;), the result of function &lt;a href=&quot;https://github.com/apache/cassandra/blob/cassandra-3.0/src/java/org/apache/cassandra/schema/SchemaKeyspace.java#L311&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;&lt;tt&gt;calculateSchemaDigest&lt;/tt&gt;&lt;/a&gt; is also changed for the same schema. Which causes schema mismatch while upgrading 3.0.x -&amp;gt; 3.0.13.&lt;br/&gt;
It could cause cassandra fail to start because Unknown CF exception. And streaming will fail:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;ERROR [main] 2017-05-26 18:58:57,572 CassandraDaemon.java:709 - Exception encountered during startup
java.lang.IllegalArgumentException: Unknown CF 83c8eae0-3a65-11e7-9a27-e17fd11571e3
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;WARN  [MessagingService-Incoming-/IP] 2017-05-26 19:27:11,523 IncomingTcpConnection.java:101 - UnknownColumnFamilyException reading from socket; closing
org.apache.cassandra.db.UnknownColumnFamilyException: Couldn&apos;t find table for cfId 922b7940-3a65-11e7-adf3-a3ff55d9bcf1. If a table was just created, this is likely due to the schema not being fully propagated.  Please wait for schema agreement on table creation.
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Restart the new node will cause:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Exception (java.lang.NoSuchFieldError) encountered during startup: ALL
java.lang.NoSuchFieldError: ALL
        at org.apache.cassandra.service.ClientState.&amp;lt;clinit&amp;gt;(ClientState.java:67)
        at org.apache.cassandra.cql3.QueryProcessor$InternalStateInstance.&amp;lt;init&amp;gt;(QueryProcessor.java:155)
        at org.apache.cassandra.cql3.QueryProcessor$InternalStateInstance.&amp;lt;clinit&amp;gt;(QueryProcessor.java:149)
        at org.apache.cassandra.cql3.QueryProcessor.internalQueryState(QueryProcessor.java:163)
        at org.apache.cassandra.cql3.QueryProcessor.prepareInternal(QueryProcessor.java:286)
        at org.apache.cassandra.cql3.QueryProcessor.executeInternal(QueryProcessor.java:294)
        at org.apache.cassandra.db.SystemKeyspace.checkHealth(SystemKeyspace.java:900)
        at org.apache.cassandra.service.StartupChecks$9.execute(StartupChecks.java:354)
        at org.apache.cassandra.service.StartupChecks.verify(StartupChecks.java:110)
        at org.apache.cassandra.service.CassandraDaemon.setup(CassandraDaemon.java:179)
        at org.apache.cassandra.service.CassandraDaemon.activate(CassandraDaemon.java:569)
        at org.apache.cassandra.service.CassandraDaemon.main(CassandraDaemon.java:697)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I would suggest to have the older list back for digest calculation and release 3.0.14.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13075498">CASSANDRA-13559</key>
            <summary>Schema version id mismatch while upgrading to 3.0.13</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10000" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Urgent</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="jay.zhuang">Jay Zhuang</assignee>
                                    <reporter username="jay.zhuang">Jay Zhuang</reporter>
                        <labels>
                    </labels>
                <created>Mon, 29 May 2017 00:59:17 +0000</created>
                <updated>Tue, 16 Apr 2019 09:30:04 +0000</updated>
                            <resolved>Wed, 31 May 2017 16:19:55 +0000</resolved>
                                        <fixVersion>3.0.14</fixVersion>
                    <fixVersion>3.11.0</fixVersion>
                                    <component>Legacy/Core</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>16</watches>
                                                                                                                <comments>
                            <comment id="16027990" author="jay.zhuang" created="Mon, 29 May 2017 01:35:12 +0000"  >&lt;p&gt;Here is the patch: &lt;a href=&quot;https://github.com/apache/cassandra/compare/cassandra-3.0...cooldoger:13559-3.0?expand=1&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/cassandra/compare/cassandra-3.0...cooldoger:13559-3.0?expand=1&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To remove the older list, maybe we should bump the message version.&lt;/p&gt;</comment>
                            <comment id="16030574" author="stefania" created="Wed, 31 May 2017 03:41:07 +0000"  >&lt;p&gt;I agree this is a problem, thanks for reporting it. Since we need both the new and old orders, I prefer to only change the order for flushing and restore the old order for everything else. I am going to prepare a patch shortly.&lt;/p&gt;</comment>
                            <comment id="16030598" author="jjirsa" created="Wed, 31 May 2017 04:07:31 +0000"  >&lt;p&gt;Any thoughts on an upgrade path from 3.0.13 - 3.0.14 Stefania?&lt;/p&gt;</comment>
                            <comment id="16030763" author="stefania" created="Wed, 31 May 2017 07:22:40 +0000"  >&lt;p&gt;Here are the patches for 3.0 and 3.11:&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/stef1927/cassandra/tree/13559-3.0&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;patch for 3.0&lt;/a&gt;&lt;br/&gt;
&lt;a href=&quot;https://github.com/stef1927/cassandra/tree/13559-3.11&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;patch for 3.11&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Since we don&apos;t need it for 4.0, I decided to keep the initial patch suggested by &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jay.zhuang&quot; class=&quot;user-hover&quot; rel=&quot;jay.zhuang&quot;&gt;jay.zhuang&lt;/a&gt;, I merely added some comments and the entry into CHANGES.txt. I&apos;m running the tests for 3.0 on our internal CI hosts. I will post a comment when the results are available.&lt;/p&gt;

&lt;p&gt;Regarding the upgrade from 3.0.13 to 3.0.14, I don&apos;t think there is much we can do without a bump in the messaging version. I would tend to think we should release 3.0.14 with the patch asap. I also wonder why we did not notice this at all in our &lt;a href=&quot;http://cassci.datastax.com/job/cassandra-3.0_dtest_upgrade/lastCompletedBuild/testReport/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;upgrade tests&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;For 3.11 we definitely need the patch since we haven&apos;t released it yet; whilst for 4.0 we don&apos;t need it because the messaging version has been bumped and hence the schema version will not be compared.&lt;/p&gt;

&lt;p&gt;Regarding the &lt;tt&gt;NoSuchFieldError&lt;/tt&gt; in the ticket description, it doesn&apos;t make much sense to me and I cannot reproduce it. The node starts without problems, perhaps a build issue? &lt;/p&gt;</comment>
                            <comment id="16030905" author="stefania" created="Wed, 31 May 2017 09:41:03 +0000"  >&lt;p&gt;The test results look good, no failures for the unit tests and 5 known failures for the dtests.&lt;/p&gt;</comment>
                            <comment id="16030935" author="snazy" created="Wed, 31 May 2017 10:08:50 +0000"  >&lt;p&gt;+1, assuming tests look good.&lt;/p&gt;</comment>
                            <comment id="16030973" author="ostefano" created="Wed, 31 May 2017 10:41:49 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=Stefania&quot; class=&quot;user-hover&quot; rel=&quot;stefania&quot;&gt;Stefania&lt;/a&gt;, could you please elaborate a bit further on the .13-.14 upgrade path?&lt;br/&gt;
I am running .13 in production and I am quite concerned what to expect during the next round of upgrades.&lt;/p&gt;</comment>
                            <comment id="16031118" author="iamaleksey" created="Wed, 31 May 2017 13:06:37 +0000"  >&lt;p&gt;+1 from me as well. Sorry for not spotting the issue in the original ticket, or even steering the implementation towards this issue.&lt;/p&gt;</comment>
                            <comment id="16031144" author="jjirsa" created="Wed, 31 May 2017 13:27:33 +0000"  >&lt;p&gt;Can someone explain the upgrade path from 3.0.13 to 3.0.14 please?&lt;/p&gt;</comment>
                            <comment id="16031159" author="iamaleksey" created="Wed, 31 May 2017 13:35:23 +0000"  >&lt;p&gt;You face the storm; no way around it it seems.&lt;/p&gt;

&lt;p&gt;Pragmatically however there will be a lot more people upgrading from versions that aren&apos;t 3.0.13 then from the single recently released 3.0.13, so it makes sense to optimise for the majority of the users.&lt;/p&gt;</comment>
                            <comment id="16031162" author="jjirsa" created="Wed, 31 May 2017 13:40:40 +0000"  >&lt;p&gt;There are three stack traces in the ticket that aren&apos;t just migration storm, and 2 of them are fail-to-startup errors. How does changing the schema version cause any of those?&lt;/p&gt;

&lt;p&gt;I realize I can go run through minor version uploads and try to hit this myself, but I don&apos;t intuitively &quot;get&quot; why those stacks happen with &quot;just&quot; changing the schema version, but it seems likely they&apos;ll happen for anyone going 3.0.13 -&amp;gt; 3.0.14.&lt;/p&gt;

</comment>
                            <comment id="16031170" author="iamaleksey" created="Wed, 31 May 2017 13:44:37 +0000"  >&lt;blockquote&gt;&lt;p&gt;How does changing the schema version cause any of those?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;It can&apos;t and it doesn&apos;t. Those should be separate JIRA tickets, if valid at all.&lt;/p&gt;

&lt;p&gt;This patch is only addressing the difference in digest calculation, which is objectively an issue and has been reproduced.&lt;/p&gt;</comment>
                            <comment id="16031243" author="stefania" created="Wed, 31 May 2017 14:33:23 +0000"  >&lt;blockquote&gt;&lt;p&gt;could you please elaborate a bit further on the .13-.14 upgrade path?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;When an upgraded node joins the ring, all non-upgraded nodes will pull the schema from it, after 1 minute. They shouldn&apos;t pull any longer from this node unless a real schema change happens. Since the schema is identical, a schema pull results in all schema mutations being applied and the schema tables being flushed, nothing else since the delta would be nil. When another node is upgraded and joins, the process repeats itself. &lt;/p&gt;

&lt;p&gt;Furthermore, the upgraded nodes will see the schema of the non-upgraded nodes as different and pull from them. Eventually the process converges, when all nodes are upgraded the schema versions will be the same. &lt;/p&gt;

&lt;p&gt;Things visible to the operator should be the schema migrations in the logs. Other noticeable things will be the schema version logged, which will be different after the upgrade, and different schema versions appearing in &lt;tt&gt;nodetool describecluster|describering&lt;/tt&gt;. Also, in the system local table. This means that if any problems are likely to occur, they will mostly likely be client side, i.e. clients will not see a schema agreement until the upgrade is completed. This might cause issues in some applications. &lt;/p&gt;

&lt;p&gt;To limit the flow of schema pulls. the schema should not be changed during the upgrade, if at all possible. I&apos;ll add a section to NEWS.txt. &lt;/p&gt;

&lt;p&gt;That&apos;s all I could find from code inspection. &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=spodxx%40gmail.com&quot; class=&quot;user-hover&quot; rel=&quot;spodxx@gmail.com&quot;&gt;spodxx@gmail.com&lt;/a&gt; rightly pointed out in the dev mailing list that the only urgent thing is to pull 3.0.13. We can take our time before releasing 3.0.14, at a minimum we should write an upgrade test.&lt;/p&gt;

&lt;p&gt;The startup problem is not related to the digest mismatch: the &lt;tt&gt;ALL&lt;/tt&gt; field exists, so I don&apos;t understand it at all. I also struggle to explain the unknown cf exceptions, they are probably unrelated but the upgrade test should shed some light.&lt;/p&gt;</comment>
                            <comment id="16031255" author="jjirsa" created="Wed, 31 May 2017 14:43:39 +0000"  >&lt;p&gt;If this is really just a single version change, this is a minor issue that doesn&apos;t justify pulling the package - &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-13441&quot; title=&quot;Schema version changes for each upgraded node in a rolling upgrade, causing migration storms&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-13441&quot;&gt;&lt;del&gt;CASSANDRA-13441&lt;/del&gt;&lt;/a&gt; is present in .13 and earlier 3.0 versions will cause far more schema changes than this patch will for anyone upgrading from 2.1/2.2. This is worth fixing, but I don&apos;t see why it&apos;s worth pulling binaries.&lt;/p&gt;</comment>
                            <comment id="16031268" author="iamaleksey" created="Wed, 31 May 2017 14:49:16 +0000"  >&lt;blockquote&gt;&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-13441&quot; title=&quot;Schema version changes for each upgraded node in a rolling upgrade, causing migration storms&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-13441&quot;&gt;&lt;del&gt;CASSANDRA-13441&lt;/del&gt;&lt;/a&gt; is present in .13 and earlier 3.0 versions will cause far more schema changes than this patch will for anyone upgrading from 2.1/2.2&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Yeah, but for people upgrading from 3.0.x that aren&apos;t 3.0.13 the fix would still be nice, and there are more of those than people on 3.0.13 - I would assume.&lt;/p&gt;

&lt;p&gt;Not advocating for pulling binaries. Neither is a an urgent 3.0.14 release necessary imo. But the fix should go in. &lt;/p&gt;</comment>
                            <comment id="16031336" author="spodxx@gmail.com" created="Wed, 31 May 2017 15:22:45 +0000"  >&lt;p&gt;There are two different upgrade issues here. Let&apos;s not mix those up.&lt;/p&gt;


&lt;p&gt;&lt;b&gt;3.0.x -&amp;gt; 3.0.13&lt;/b&gt;&lt;/p&gt;

&lt;p&gt;Based on the description by &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jay.zhuang&quot; class=&quot;user-hover&quot; rel=&quot;jay.zhuang&quot;&gt;jay.zhuang&lt;/a&gt; for this ticket, any node on  3.0.x that will be upgraded to the latest 3.0.13 bug fix release, will fail to start. This is the actual point why pulling the .13 release from the download page is probably a good idea, so people won&apos;t upgrade their cluster just to find themselves in a situation unable to bring any node up again.&lt;/p&gt;

&lt;p&gt;&lt;b&gt;3.0.13 -&amp;gt; 3.0.14 (unrelease)&lt;/b&gt;&lt;/p&gt;

&lt;p&gt;Some users may already run 3.0.13 (e.g. by upgrading from 2.x or fresh installs). Maybe even on large production clusters. If we change the schema digest calculation in .14 again, we need to make sure that the users on .13 will be able to upgrade to .14 as well without seeing major issues, e.g. with schema migration storms. &lt;/p&gt;</comment>
                            <comment id="16031377" author="ostefano" created="Wed, 31 May 2017 15:43:57 +0000"  >&lt;blockquote&gt;&lt;p&gt;Some users may already run 3.0.13 (e.g. by upgrading from 2.x or fresh installs).&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I am not quite sure the issue as described by Jay Zhuang was meant to be deterministic.&lt;br/&gt;
I have upgraded from 3.0.12 to 3.0.13 without issues but the schema change storm.&lt;/p&gt;</comment>
                            <comment id="16031391" author="spodxx@gmail.com" created="Wed, 31 May 2017 15:48:28 +0000"  >&lt;p&gt;Regarding the &lt;tt&gt;NoSuchFieldError&lt;/tt&gt; startup error seems to be caused by some dirty class files. I can always reproduce this locally by doing something like this:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;git checkout cassandra-3.0.12
ant clean jar
ccm create 3.0-3n --install-dir=/home/spod/git/cassandra-3.0 -n 3
ccm start
ccm node3 stop
git checkout cassandra-3.0.13
ant jar # NO CLEAN
ccm node3 start
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;If I do &quot;ant clean jar&quot; instead, the node is starting up fine. &lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jay.zhuang&quot; class=&quot;user-hover&quot; rel=&quot;jay.zhuang&quot;&gt;jay.zhuang&lt;/a&gt;, are you sure you&apos;ve installed the vanilla Apacha tarbar cleanly on your side?&lt;/p&gt;</comment>
                            <comment id="16031411" author="iamaleksey" created="Wed, 31 May 2017 15:57:03 +0000"  >&lt;blockquote&gt;&lt;p&gt;There are two different upgrade issues here. Let&apos;s not mix those up.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;There is only one confirmed issue here. It&apos;s a shame the JIRA is mixed up. We accidentally changed the way the digest is calculated, slightly, in 3.0.13. The issue is increased migration traffic. Not a big deal, but we should roll it back, so that the majority (lagging behind latest, always) is not affected.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;If we change the schema digest calculation in .14 again, we need to make sure that the users on .13 will be able to upgrade to .14 as well without seeing major issues, e.g. with schema migration storms.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Well, we can&apos;t, so you have to choose one:&lt;br/&gt;
1. prevent extra migration traffic for those migrating from &lt;span class=&quot;error&quot;&gt;&amp;#91;3.0.0, 3.0.12&amp;#93;&lt;/span&gt; to 3.0.14+&lt;br/&gt;
2. prevent extra migration traffic for those migrating from 3.0.13 to 3.0.14+&lt;/p&gt;

&lt;p&gt;With 3.0.13 being super fresh, with relatively few people on it (who already went through some extra migrations and survived anyway), I would say (1) is more important than (2).&lt;/p&gt;</comment>
                            <comment id="16031425" author="spodxx@gmail.com" created="Wed, 31 May 2017 16:03:03 +0000"  >&lt;p&gt;That makes it much clearer, thanks for the wrap up! &lt;/p&gt;</comment>
                            <comment id="16031442" author="jay.zhuang" created="Wed, 31 May 2017 16:17:31 +0000"  >&lt;p&gt;Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=Stefania&quot; class=&quot;user-hover&quot; rel=&quot;stefania&quot;&gt;Stefania&lt;/a&gt; for the quick fix.&lt;/p&gt;

&lt;p&gt;For a normal upgrade, I don&apos;t see the &quot;fail to start&quot; issue. &lt;/p&gt;

&lt;p&gt;For call stack:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;ERROR [main] 2017-05-26 18:58:57,572 CassandraDaemon.java:709 - Exception encountered during startup
java.lang.IllegalArgumentException: Unknown CF 83c8eae0-3a65-11e7-9a27-e17fd11571e3
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;It happens when the schema is changed while upgrading. For our case, a few nodes are not upgraded, so we have a cluster with mixed versions (3.0.x and 3.0.13) plus we add a table during that time which causes this issue.&lt;/p&gt;

&lt;p&gt;For&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Exception (java.lang.NoSuchFieldError) encountered during startup: ALL
java.lang.NoSuchFieldError: ALL
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;I don&apos;t think it&apos;s caused by this issue.&lt;/p&gt;

&lt;p&gt;Schema version id mismatch also happens when upgrading from 2.2.x -&amp;gt; 3.0.x and maybe other major/minor version upgrade. I think it not worth pulling 3.0.13 binaries.&lt;/p&gt;</comment>
                            <comment id="16031444" author="iamaleksey" created="Wed, 31 May 2017 16:18:01 +0000"  >&lt;p&gt;Committed to 3.0 as &lt;a href=&quot;https://github.com/apache/cassandra/commit/f96a5dc5840c7d1fea99aa450543af8e889c161e&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;f96a5dc5840c7d1fea99aa450543af8e889c161e&lt;/a&gt; and merged into 3.11, trunk omitted. Thanks.&lt;/p&gt;</comment>
                            <comment id="16031448" author="iamaleksey" created="Wed, 31 May 2017 16:20:44 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jay.zhuang&quot; class=&quot;user-hover&quot; rel=&quot;jay.zhuang&quot;&gt;jay.zhuang&lt;/a&gt; Feel free to continue in a new JIRA ticket to handle your remaining issues.&lt;/p&gt;</comment>
                            <comment id="16032373" author="stefania" created="Thu, 1 Jun 2017 03:22:58 +0000"  >&lt;p&gt;Thank you for committing the ticket &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=iamaleksey&quot; class=&quot;user-hover&quot; rel=&quot;iamaleksey&quot;&gt;iamaleksey&lt;/a&gt; and to everybody for the clarifications.&lt;/p&gt;

&lt;p&gt;I&apos;ve created an upgrade test &lt;a href=&quot;https://github.com/riptano/cassandra-dtest/compare/master...stef1927:13559&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;here&lt;/a&gt;. To run it export &lt;tt&gt;JAVA8_HOME&lt;/tt&gt; and then choose one of the following test combinations:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;upgrade_tests/regression_test.py:TestForRegressionsUpgrade_released_3_0_12_To_released_3_0_13.test_schema_agreement
upgrade_tests/regression_test.py:TestForRegressionsUpgrade_released_3_0_13_To_indev_3_0_x.test_schema_agreement
upgrade_tests/regression_test.py:TestForRegressionsUpgrade_released_3_0_12_To_indev_3_0_x.test_schema_agreement
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The test verifies that the schemas match before and during upgrade, when creating a table before and during upgrade. 3.0.12 -&amp;gt; current will succeed, whilst 3.0.12 -&amp;gt; 3.0.13 and 3.0.13 -&amp;gt; current will fail. In the logs we can see the schema pulls but no other issues (the test checks for a schema match before creating the table during the upgrade). &lt;/p&gt;

&lt;p&gt;I&apos;ll leave the test with the custom versions available for a few days, if people won&apos;t to play with it, e.g. by testing with a larger cluster or by adding more functionality during the upgrade. Before creating a pull request, we need to uncomment  &lt;tt&gt;@since(&apos;3.0.14&apos;, max_version=&apos;3.99&apos;)&lt;/tt&gt; and remove the lines in &lt;a href=&quot;https://github.com/riptano/cassandra-dtest/compare/master...stef1927:13559#diff-7de72be82b9e05ef3451358461197944R121&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;&lt;tt&gt;OVERRIDE_MANIFEST&lt;/tt&gt;&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="16034501" author="spodxx@gmail.com" created="Fri, 2 Jun 2017 11:03:04 +0000"  >&lt;p&gt;I&apos;ve now created &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-13569&quot; title=&quot;Schedule schema pulls just once per endpoint&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-13569&quot;&gt;CASSANDRA-13569&lt;/a&gt;, which should help making any schema pulls created by mismatching schemas less stormy. Should be a good idea to get this in along with this patch in 3.0.14.&lt;/p&gt;</comment>
                            <comment id="16034542" author="spodxx@gmail.com" created="Fri, 2 Jun 2017 11:40:57 +0000"  >&lt;p&gt;Looks like hints will also not get dispatched in cases of mismatching schema IDs (see HintsDispatchTrigger). This should also be put in the yet to be updated NEWS.txt.&lt;/p&gt;</comment>
                            <comment id="16034544" author="iamaleksey" created="Fri, 2 Jun 2017 11:44:28 +0000"  >&lt;blockquote&gt;&lt;p&gt;Looks like hints will also not get dispatched in cases of mismatching schema IDs (see HintsDispatchTrigger). This should also be put in the yet to be updated NEWS.txt.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Only until the pair of nodes converges on the same schema - eventually. Just like with regular convergence. Not sure it&apos;s NEWSworthy.&lt;/p&gt;</comment>
                            <comment id="16036449" author="stefania" created="Mon, 5 Jun 2017 01:31:16 +0000"  >&lt;p&gt;&lt;tt&gt;NEWS.txt&lt;/tt&gt; updated (only for schema migrations and only in 3.0.x), see commit &lt;a href=&quot;https://github.com/apache/cassandra/commit/6b36d9f0506351f03555efaa3a0784d097913adf&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;6b36d9&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;Pull request for upgrade test created &lt;a href=&quot;https://github.com/riptano/cassandra-dtest/pull/1477&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;here&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="16484388" author="scubadrew" created="Tue, 22 May 2018 18:22:44 +0000"  >&lt;p&gt;Hello everyone. I am seeing this error when restarting a 3.0.12 node.&lt;/p&gt;

&lt;p&gt;ERROR &lt;span class=&quot;error&quot;&gt;&amp;#91;main&amp;#93;&lt;/span&gt; 2018-05-22 17:53:09,355 CassandraDaemon.java:710 - Exception encountered during startup&lt;br/&gt;
java.lang.IllegalArgumentException: Unknown CF 10c30740-1284-11e8-862f-5f9049872b18&lt;br/&gt;
 at org.apache.cassandra.db.Keyspace.getColumnFamilyStore(Keyspace.java:206) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;apache-cassandra-3.0.12.jar:3.0.12&amp;#93;&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;I realize this thread is mostly concerned with upgrades. We are not trying to upgrade. Simply trying to stop and then restart the service on a single node in a long running cluster.&lt;/p&gt;

&lt;p&gt;Any advice how we can recover this node?&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[jay.zhuang]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 26 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3fks7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12311421" key="com.atlassian.jira.plugin.system.customfieldtypes:multiversion">
                        <customfieldname>Reproduced In</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="12339942">3.0.13</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>stefania</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[stefania]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12963"><![CDATA[Critical]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>