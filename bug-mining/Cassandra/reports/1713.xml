<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 22:34:27 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-4456] AssertionError in ColumnFamilyStore.getOverlappingSSTables() during repair</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-4456</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;We have hit the following exception on several nodes while running repairs across our 1.1.2 ring. We&apos;ve observed it happen on either the node executing the repair or a participating replica in the repair operation. The result in either case is that the repair hangs.&lt;/p&gt;


&lt;p&gt;ERROR &lt;span class=&quot;error&quot;&gt;&amp;#91;ValidationExecutor:9&amp;#93;&lt;/span&gt; 2012-07-21 01:54:03,019 AbstractCassandraDaemon.java (line 134) Exception in thread Thread&lt;span class=&quot;error&quot;&gt;&amp;#91;ValidationExecutor:9,1,main&amp;#93;&lt;/span&gt;&lt;br/&gt;
java.lang.AssertionError&lt;br/&gt;
        at org.apache.cassandra.db.ColumnFamilyStore.getOverlappingSSTables(ColumnFamilyStore.java:874)&lt;br/&gt;
        at org.apache.cassandra.db.compaction.CompactionController.&amp;lt;init&amp;gt;(CompactionController.java:69)&lt;br/&gt;
        at org.apache.cassandra.db.compaction.CompactionManager$ValidationCompactionIterable.&amp;lt;init&amp;gt;(CompactionManager.java:834)&lt;br/&gt;
        at org.apache.cassandra.db.compaction.CompactionManager.doValidationCompaction(CompactionManager.java:698)&lt;br/&gt;
        at org.apache.cassandra.db.compaction.CompactionManager.access$600(CompactionManager.java:68)&lt;br/&gt;
        at org.apache.cassandra.db.compaction.CompactionManager$8.call(CompactionManager.java:438)&lt;br/&gt;
        at java.util.concurrent.FutureTask$Sync.innerRun(FutureTask.java:303)&lt;br/&gt;
        at java.util.concurrent.FutureTask.run(FutureTask.java:138)&lt;br/&gt;
        at java.util.concurrent.ThreadPoolExecutor$Worker.runTask(ThreadPoolExecutor.java:886)&lt;br/&gt;
        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:908)&lt;br/&gt;
        at java.lang.Thread.run(Thread.java:662)&lt;/p&gt;


&lt;p&gt;In building this ring we migrated sstables from an identical 0.8.8 ring by:&lt;/p&gt;

&lt;p&gt; 1. Creating the schema on our new 1.1.2 ring.&lt;br/&gt;
 2. Rsyncing over sstables from 0.8.8 ring.&lt;br/&gt;
 3. Renaming the sstables to match the directory and file naming structure of 1.1.x.&lt;br/&gt;
 4. Ran nodetool refresh &amp;lt;keyspace&amp;gt; &amp;lt;cf&amp;gt; for each CF across each node.&lt;br/&gt;
 5. Ran nodetool upgradesstables for each CF across each node.&lt;/p&gt;

&lt;p&gt;When those steps had completed, we began rolling repairs. Not all of the repair operations have hit the exception &amp;#8211; some of the repairs have completed successfully.&lt;/p&gt;</description>
                <environment>&lt;p&gt;Ubuntu 11.04 64-bit&lt;/p&gt;</environment>
        <key id="12599726">CASSANDRA-4456</key>
            <summary>AssertionError in ColumnFamilyStore.getOverlappingSSTables() during repair</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10002" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Normal</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="slebresne">Sylvain Lebresne</assignee>
                                    <reporter username="mheffner">Mike Heffner</reporter>
                        <labels>
                    </labels>
                <created>Sat, 21 Jul 2012 14:07:01 +0000</created>
                <updated>Tue, 16 Apr 2019 09:32:30 +0000</updated>
                            <resolved>Mon, 23 Jul 2012 19:36:36 +0000</resolved>
                                        <fixVersion>1.1.3</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="13419912" author="mtheroux2" created="Sat, 21 Jul 2012 19:15:17 +0000"  >&lt;p&gt;I just hit this problem myself today, on a single node in a six node cluster.  I was running nodetool repair, and it halted with this exception in the log.  I was monitoring the repair pretty closely.  A couple of observations:&lt;/p&gt;

&lt;p&gt;1) It happened while compaction of the same column family was happening simultaneously&lt;br/&gt;
2) When I re-ran it, it worked.&lt;/p&gt;

&lt;p&gt;Note: I am not a cassandra developer, but I looked at the code.  A highly uneducated guess is that an sstable was compacted and deleted while validation was expecting it to be there?  &lt;/p&gt;</comment>
                            <comment id="13419913" author="mtheroux2" created="Sat, 21 Jul 2012 19:15:37 +0000"  >&lt;p&gt;I am also on 1.1.2.&lt;/p&gt;</comment>
                            <comment id="13420685" author="jbellis" created="Mon, 23 Jul 2012 14:46:42 +0000"  >&lt;p&gt;I think this was introduced by &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-3721&quot; title=&quot;Staggering repair&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-3721&quot;&gt;&lt;del&gt;CASSANDRA-3721&lt;/del&gt;&lt;/a&gt;: getOverlappingSSTables assumes that the sstables we check for overlaps are part of the live set, but now we can validate over a snapshot instead.&lt;/p&gt;</comment>
                            <comment id="13420746" author="slebresne" created="Mon, 23 Jul 2012 16:16:26 +0000"  >&lt;p&gt;Actually I think this can happen even when snapshots are not used since a sstable can finish to be compacted just between when we chose sstable for repair and when we create the CompactionController for the validation compaction. In particular, I wonder if Michael and Mike have used -snapshot for their compaction. Though it&apos;s true that repair on snapshot will make that way more likely to happen.&lt;/p&gt;

&lt;p&gt;But actually I don&apos;t think we need to call getOverlappingSStables at all in the first place for repair, since this is used only to decide if we can purge but repair does not do purging. Attaching a simple patch to skip the call entirely.&lt;/p&gt;</comment>
                            <comment id="13420755" author="jbellis" created="Mon, 23 Jul 2012 16:29:11 +0000"  >&lt;p&gt;You need to wire VCC in to ValidationCompactionIterable, but otherwise +1.&lt;/p&gt;</comment>
                            <comment id="13420903" author="slebresne" created="Mon, 23 Jul 2012 19:36:36 +0000"  >&lt;p&gt;Oups indeed. Committed with the thing wired up. Thanks.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12537576" name="4456.txt" size="1988" author="slebresne" created="Mon, 23 Jul 2012 16:16:40 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[slebresne]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>256172</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            13 years, 18 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0gw2v:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>96627</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>jbellis</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[jbellis]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12962"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>