<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 22:40:50 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-6154] Inserts are blocked in 2.1</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-6154</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;With cluster sizes &amp;gt;1 inserts are blocked indefinitely:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;$ ccm create -v git:trunk test
Fetching Cassandra updates...
Current cluster is now: test
$ ccm populate -n 2
$ ccm start
$ ccm node1 cqlsh
Connected to test at 127.0.0.1:9160.
[cqlsh 4.0.1 | Cassandra 2.1-SNAPSHOT | CQL spec 3.1.1 | Thrift protocol 19.37.0]
Use HELP &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; help.
cqlsh&amp;gt; CREATE KEYSPACE timeline WITH replication = {&lt;span class=&quot;code-quote&quot;&gt;&apos;class&apos;&lt;/span&gt;: &lt;span class=&quot;code-quote&quot;&gt;&apos;SimpleStrategy&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;replication_factor&apos;&lt;/span&gt;: 1};
cqlsh&amp;gt; USE timeline;
cqlsh:timeline&amp;gt; CREATE TABLE user_events (userid text, event timestamp, value text, PRIMARY KEY (userid, event));
cqlsh:timeline&amp;gt; INSERT INTO user_events (userid, event , value ) VALUES ( &lt;span class=&quot;code-quote&quot;&gt;&apos;ryan&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;2013-10-07&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;attempt&apos;&lt;/span&gt;);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The last INSERT statement never returns..&lt;/p&gt;</description>
                <environment></environment>
        <key id="12672654">CASSANDRA-6154</key>
            <summary>Inserts are blocked in 2.1</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10000" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Urgent</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="jbellis">Jonathan Ellis</assignee>
                                    <reporter username="enigmacurry">Ryan McGuire</reporter>
                        <labels>
                    </labels>
                <created>Mon, 7 Oct 2013 17:41:21 +0000</created>
                <updated>Tue, 16 Apr 2019 09:32:03 +0000</updated>
                            <resolved>Tue, 8 Oct 2013 22:30:46 +0000</resolved>
                                                            <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="13788453" author="brandon.williams" created="Mon, 7 Oct 2013 19:11:25 +0000"  >&lt;p&gt;Bisect points at &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-6132&quot; title=&quot;CL.ANY writes can still time out&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-6132&quot;&gt;&lt;del&gt;CASSANDRA-6132&lt;/del&gt;&lt;/a&gt;, specfically the ninja commit in 5440a0a6767544d6ea1ba34f5d2a3e223f260fb5&lt;/p&gt;</comment>
                            <comment id="13788494" author="jbellis" created="Mon, 7 Oct 2013 19:42:41 +0000"  >&lt;p&gt;Looks like merge to trunk from 2.0 was syntactically correct but semantically broken.  Attached.&lt;/p&gt;</comment>
                            <comment id="13788517" author="brandon.williams" created="Mon, 7 Oct 2013 20:14:07 +0000"  >&lt;p&gt;Not quite.&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;ERROR [GossipStage:1] 2013-10-07 20:09:15,849 Caller+0   at org.apache.cassandra.service.CassandraDaemon$2.uncaughtException(CassandraDaemon.java:134)
 - Exception in thread Thread[GossipStage:1,5,main]
java.lang.AssertionError: null
        at org.apache.cassandra.net.MessagingService.addCallback(MessagingService.java:552) ~[main/:na]
        at org.apache.cassandra.net.MessagingService.sendRR(MessagingService.java:576) ~[main/:na]
        at org.apache.cassandra.net.MessagingService.sendRR(MessagingService.java:571) ~[main/:na]
        at org.apache.cassandra.gms.Gossiper.markAlive(Gossiper.java:808) ~[main/:na]
        at org.apache.cassandra.gms.Gossiper.handleMajorStateChange(Gossiper.java:849) ~[main/:na]
        at org.apache.cassandra.gms.Gossiper.applyStateLocally(Gossiper.java:934) ~[main/:na]
        at org.apache.cassandra.gms.GossipDigestAck2VerbHandler.doVerb(GossipDigestAck2VerbHandler.java:49) ~[main/:na]
        at org.apache.cassandra.net.MessageDeliveryTask.run(MessageDeliveryTask.java:56) ~[main/:na]
        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1145) ~[na:1.7.0_17]
        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:615) ~[na:1.7.0_17]
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="13788585" author="jbellis" created="Mon, 7 Oct 2013 21:16:55 +0000"  >&lt;p&gt;v2&lt;/p&gt;</comment>
                            <comment id="13788608" author="brandon.williams" created="Mon, 7 Oct 2013 21:37:27 +0000"  >&lt;p&gt;+1&lt;/p&gt;</comment>
                            <comment id="13788619" author="jbellis" created="Mon, 7 Oct 2013 21:47:58 +0000"  >&lt;p&gt;committed&lt;/p&gt;</comment>
                            <comment id="13789507" author="enigmacurry" created="Tue, 8 Oct 2013 18:42:22 +0000"  >&lt;p&gt;Thanks, working now.&lt;/p&gt;</comment>
                            <comment id="13789617" author="brandon.williams" created="Tue, 8 Oct 2013 20:03:35 +0000"  >&lt;p&gt;Actually, there&apos;s something wrong in the 2.0 branch that points at this commit too, but it&apos;s harder to trigger.  Using a batch such as:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;            BEGIN BATCH
            INSERT INTO users (id, firstname, lastname) VALUES (0, &apos;Jack&apos;, &apos;Sparrow&apos;)
            INSERT INTO users (id, firstname, lastname) VALUES (1, &apos;Will&apos;, &apos;Turner&apos;)
            APPLY BATCH
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;at ONE with 2 of 3 nodes down should timeout, but never returns.&lt;/p&gt;</comment>
                            <comment id="13789695" author="jbellis" created="Tue, 8 Oct 2013 20:59:41 +0000"  >&lt;p&gt;Can you set trace probability to 100% and get a trace?&lt;/p&gt;</comment>
                            <comment id="13789716" author="jbellis" created="Tue, 8 Oct 2013 21:27:19 +0000"  >&lt;p&gt;Suspect patch for 6165 will fix this too.&lt;/p&gt;</comment>
                            <comment id="13789737" author="lizou" created="Tue, 8 Oct 2013 21:46:04 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jbellis&quot; class=&quot;user-hover&quot; rel=&quot;jbellis&quot;&gt;jbellis&lt;/a&gt; I just pulled the Cassandra-2.0 source code and did a quick testing. Though slightly better than yesterday&apos;s trunk load. But there are still lots of assertion errors for  &lt;tt&gt;MessagingService.addCallback()&lt;/tt&gt; without the argument of consistency level for MessageOut&amp;lt;RowMutation&amp;gt;. E.g.&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;   private void doDeliverHintsToEndpoint(InetAddress endpoint)
    {
     ...
                MessageOut&amp;lt;RowMutation&amp;gt; message = rm.createMessage();
     ...
                MessagingService.instance().sendRR(message, endpoint, responseHandler);
                responseHandlers.add(responseHandler);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;and&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;    public static void sendToHintedEndpoints(final RowMutation rm,
                                             Iterable&amp;lt;InetAddress&amp;gt; targets,
                                             AbstractWriteResponseHandler responseHandler,
                                             String localDataCenter,
                                             ConsistencyLevel consistency_level)
    throws OverloadedException
    {
    ...
                    // belongs on a different server
                    if (message == null)
                        message = rm.createMessage();
                    String dc = DatabaseDescriptor.getEndpointSnitch().getDatacenter(destination);
                    // direct writes to local DC or old Cassandra versions
                    // (1.1 knows how to forward old-style String message IDs; updated to int in 2.0)
                    if (localDataCenter.equals(dc) || MessagingService.instance().getVersion(destination) &amp;lt; MessagingService.VERSION_20)
                    {
                        MessagingService.instance().sendRR(message, destination, responseHandler);
                    }
...
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;In the above examples, the &lt;tt&gt;sendRR()&lt;/tt&gt; will call &lt;tt&gt;addCallback()&lt;/tt&gt; which asserts as the message is of  type RowMutation.&lt;/p&gt;</comment>
                            <comment id="13789748" author="jbellis" created="Tue, 8 Oct 2013 21:53:09 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-6165&quot; title=&quot;AE in hinted handoff delivery&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-6165&quot;&gt;&lt;del&gt;CASSANDRA-6165&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13789768" author="lizou" created="Tue, 8 Oct 2013 22:03:47 +0000"  >&lt;p&gt;Yes, this has been observed in my test this afternoon after one node was killed.&lt;/p&gt;

&lt;p&gt;I think that we should systematically check for this issue, as some other places can also have this &lt;tt&gt;MessagingService.addCallback()&lt;/tt&gt; assertion issue.&lt;/p&gt;</comment>
                            <comment id="13789780" author="brandon.williams" created="Tue, 8 Oct 2013 22:15:29 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-6165&quot; title=&quot;AE in hinted handoff delivery&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-6165&quot;&gt;&lt;del&gt;CASSANDRA-6165&lt;/del&gt;&lt;/a&gt; did indeed fix the batchlog problem here.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12607242" name="6154-v2.txt" size="4580" author="jbellis" created="Mon, 7 Oct 2013 21:16:55 +0000"/>
                            <attachment id="12607223" name="6154.txt" size="4141" author="jbellis" created="Mon, 7 Oct 2013 19:42:41 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[jbellis]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>352277</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            12 years, 7 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1oqjb:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>352565</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12311421" key="com.atlassian.jira.plugin.system.customfieldtypes:multiversion">
                        <customfieldname>Reproduced In</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="12324159">2.1 rc3</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>brandon.williams</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[brandon.williams]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12963"><![CDATA[Critical]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>