<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 23:09:31 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-13786] Validation compactions can cause orphan sstable warnings</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-13786</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;I&apos;ve seen LevelledCompactionStrategy occasionally logging: &lt;blockquote&gt;&lt;p&gt;&amp;lt;sstable_name&amp;gt; from level 0 is not on corresponding level in the leveled manifest. This is not a problem per se, but may indicate an orphaned sstable due to a failed compaction not cleaned up properly.&quot;&lt;/p&gt;&lt;/blockquote&gt; warnings from a ValidationExecutor thread.&lt;/p&gt;

&lt;p&gt;What&apos;s happening here is that a compaction running concurrently with the validation is promoting (or demoting) sstables as part of an incremental repair, and an sstable has changed hands by the time the validation compaction gets around to getting scanners for it. The sstable isolation/synchronization done by validation compactions is a lot looser than normal compactions, so seeing this happen isn&apos;t very surprising. Given that it&apos;s harmless, and not unexpected, I think it would be best to not log these during validation compactions.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13096866">CASSANDRA-13786</key>
            <summary>Validation compactions can cause orphan sstable warnings</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10003" iconUrl="https://issues.apache.org/jira/images/icons/priorities/trivial.svg">Low</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="bdeggleston">Blake Eggleston</assignee>
                                    <reporter username="bdeggleston">Blake Eggleston</reporter>
                        <labels>
                    </labels>
                <created>Tue, 22 Aug 2017 23:00:41 +0000</created>
                <updated>Fri, 15 May 2020 08:04:22 +0000</updated>
                            <resolved>Tue, 12 Sep 2017 20:34:03 +0000</resolved>
                                        <fixVersion>4.0-alpha1</fixVersion>
                    <fixVersion>4.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="16137567" author="bdeggleston" created="Tue, 22 Aug 2017 23:01:54 +0000"  >&lt;p&gt;I have a fix pushed &lt;a href=&quot;https://github.com/bdeggleston/cassandra/commits/orphan-sstables&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;here&lt;/a&gt;, but I don&apos;t like that it&apos;s changing the compaction strategy interface, anyone have any ideas on alternate solutions?&lt;/p&gt;

&lt;p&gt;/cc &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=krummas&quot; class=&quot;user-hover&quot; rel=&quot;krummas&quot;&gt;krummas&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jjirsa&quot; class=&quot;user-hover&quot; rel=&quot;jjirsa&quot;&gt;jjirsa&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16137580" author="jjirsa" created="Tue, 22 Aug 2017 23:13:17 +0000"  >&lt;p&gt;Not a review and haven&apos;t read the code, but you&apos;re just targeting 4.0? Seems like if we&apos;re going to break an interface, that&apos;s probably the time to do it.&lt;/p&gt;</comment>
                            <comment id="16137691" author="bdeggleston" created="Wed, 23 Aug 2017 00:49:54 +0000"  >&lt;p&gt;Yeah for sure. It just seems like changing the interface is an oversize solution to the minor annoyance of getting periodic warnings in the logs. Maybe we don&apos;t need the log entry anymore, or it can be demoted to info, or there&apos;s a solution I haven&apos;t though of. That said, there probably aren&apos;t many 3rd party compaction strategies written against vanilla Cassandra these days.&lt;/p&gt;</comment>
                            <comment id="16137976" author="krummas" created="Wed, 23 Aug 2017 06:39:53 +0000"  >&lt;p&gt;Lets just drop it to DEBUG? It is pretty unclear what a user needs to do to avoid/fix it but keeping it around to make debugging easier might make sense?&lt;/p&gt;</comment>
                            <comment id="16140617" author="bdeggleston" created="Thu, 24 Aug 2017 20:10:31 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=kohlisankalp&quot; class=&quot;user-hover&quot; rel=&quot;kohlisankalp&quot;&gt;kohlisankalp&lt;/a&gt; and I were talking about this, and he mentioned that even if the operator can&apos;t do anything to fix, it&apos;s still good to know it&apos;s happening. I coded up a more &quot;correct&quot; solution. &lt;a href=&quot;https://github.com/bdeggleston/cassandra/tree/orphan-sstables2&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;This branch&lt;/a&gt; adjusts how mutating repairedAt is synchronized, and how getScanners is synchronized. So that the scenario causing the warning in this case shouldn&apos;t be able to happen.&lt;/p&gt;

&lt;p&gt;1. for &lt;tt&gt;getScanners&lt;/tt&gt;, it moves the organizing of sstables into unrepaired/pending/repaired into the same read locked block that actually gets the scanners&lt;br/&gt;
2. adds a &lt;tt&gt;mutateRepaired&lt;/tt&gt; method to &lt;tt&gt;CompactionStrategyManager&lt;/tt&gt; that is used to mutate the repaired time and move the sstables between compaction strategies with a write lock held.&lt;/p&gt;</comment>
                            <comment id="16143758" author="krummas" created="Mon, 28 Aug 2017 13:17:58 +0000"  >&lt;p&gt;makes sense, added 2 comments on the gh branch&lt;/p&gt;</comment>
                            <comment id="16146197" author="bdeggleston" created="Tue, 29 Aug 2017 21:47:56 +0000"  >&lt;p&gt;Fixed&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/bdeggleston/cassandra/tree/orphan-sstables2&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;trunk&lt;/a&gt;&lt;br/&gt;
&lt;a href=&quot;https://circleci.com/gh/bdeggleston/cassandra/tree/orphan-sstables2&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;utest&lt;/a&gt;&lt;br/&gt;
&lt;a href=&quot;https://builds.apache.org/view/A-D/view/Cassandra/job/Cassandra-devbranch-dtest/230/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;dtest&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16146828" author="krummas" created="Wed, 30 Aug 2017 07:45:08 +0000"  >&lt;p&gt;restarted dtests: &lt;a href=&quot;https://builds.apache.org/view/A-D/view/Cassandra/job/Cassandra-devbranch-dtest/236/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/view/A-D/view/Cassandra/job/Cassandra-devbranch-dtest/236/&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16148691" author="krummas" created="Thu, 31 Aug 2017 09:09:43 +0000"  >&lt;p&gt;code lgtm, but dtest runs seem to die, restarted again: &lt;a href=&quot;https://builds.apache.org/view/A-D/view/Cassandra/job/Cassandra-devbranch-dtest/256&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/view/A-D/view/Cassandra/job/Cassandra-devbranch-dtest/256&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16162190" author="bdeggleston" created="Mon, 11 Sep 2017 23:00:57 +0000"  >&lt;p&gt;rebased on latest trunk: &lt;a href=&quot;https://builds.apache.org/view/A-D/view/Cassandra/job/Cassandra-devbranch-dtest/297/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;dtest&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16163612" author="bdeggleston" created="Tue, 12 Sep 2017 20:34:04 +0000"  >&lt;p&gt;Got a clean utest run locally, dtest failures were also all failing on trunk.&lt;br/&gt;
Committed as &lt;tt&gt;7d4d1a32581ff40ed1049833631832054bcf2316&lt;/tt&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[bdeggleston]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 10 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3j5xb:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>marcuse</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[marcuse]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12961"><![CDATA[Low]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>