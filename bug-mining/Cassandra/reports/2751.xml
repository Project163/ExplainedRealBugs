<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 22:44:17 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-7053] USING TIMESTAMP for batches does not work</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-7053</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;When using the &quot;USING TIMESTAMP &amp;lt;timestamp&amp;gt;&quot; syntax for a batch statement, the supplied timestamp is ignored.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12709166">CASSANDRA-7053</key>
            <summary>USING TIMESTAMP for batches does not work</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10002" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Normal</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="mishail">Mikhail Stepura</assignee>
                                    <reporter username="Supencheck">Robert Supencheck</reporter>
                        <labels>
                            <label>LWT</label>
                            <label>cqlsh</label>
                    </labels>
                <created>Thu, 17 Apr 2014 22:26:05 +0000</created>
                <updated>Fri, 25 Oct 2019 13:11:16 +0000</updated>
                            <resolved>Mon, 21 Apr 2014 21:56:25 +0000</resolved>
                                        <fixVersion>2.0.8</fixVersion>
                                    <component>Feature/Lightweight Transactions</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                                                            <comments>
                            <comment id="13973522" author="supencheck" created="Thu, 17 Apr 2014 22:34:19 +0000"  >&lt;p&gt;Replication steps:&lt;/p&gt;

&lt;p&gt;1)  Invoke the cqlsh&amp;gt; prompt;&lt;br/&gt;
2)  Create a keyspace:&lt;br/&gt;
create keyspace test with replication = &lt;/p&gt;
{&apos;class&apos;:&apos;SimpleStrategy&apos;,&apos;replication_factor&apos;:1}
&lt;p&gt;;&lt;br/&gt;
3)  Choose to use the keyspace, &quot;test&quot;;&lt;br/&gt;
4)  Create a table in the &quot;test&quot; keyspace:&lt;br/&gt;
CREATE TABLE test_table ( key text PRIMARY KEY, data text) ;&lt;br/&gt;
5)  Attempt a batch insert, using a timestamp, in the table, &quot;test_table&quot;:&lt;br/&gt;
BEGIN BATCH USING TIMESTAMP 1111111111111111 INSERT INTO test_table (key, data ) VALUES ( &apos;key1&apos;, &apos;some data 1&apos;); INSERT INTO test_table (key, data) VALUES ( &apos;key2&apos;, &apos;some data 2&apos;) ; APPLY BATCH ;&lt;br/&gt;
6)  View the timestamps on the newly inserted table entries to observe that the timestamps are not as specified:&lt;br/&gt;
select writetime(data), key, data from test_table;&lt;/p&gt;

&lt;p&gt; writetime(data)  | key  | data&lt;br/&gt;
-----------------&lt;del&gt;&lt;ins&gt;&lt;/del&gt;----&lt;del&gt;&lt;/ins&gt;&lt;/del&gt;------------&lt;br/&gt;
 1397772023766000 | key1 | some data 1&lt;br/&gt;
 1397772023766000 | key2 | some data 2&lt;/p&gt;

&lt;p&gt;(2 rows)&lt;/p&gt;

&lt;p&gt;*******************&lt;br/&gt;
The expected behavior is that the timestamps in the resulting table should be &quot;1111111111111111.&quot;&lt;/p&gt;</comment>
                            <comment id="13973613" author="mishail" created="Fri, 18 Apr 2014 00:20:24 +0000"  >&lt;p&gt;Attaching the patch which fix the described scenario. The &lt;tt&gt;timestamp&lt;/tt&gt; from &lt;tt&gt;Attributes&lt;/tt&gt; wasn&apos;t used in &lt;tt&gt;executeWithoutConditions&lt;/tt&gt;&lt;/p&gt;</comment>
                            <comment id="13973616" author="mishail" created="Fri, 18 Apr 2014 00:22:38 +0000"  >&lt;p&gt;There are a couple of places in &lt;tt&gt;executeWithConditions&lt;/tt&gt; which use &lt;tt&gt;now&lt;/tt&gt; instead &lt;tt&gt;timestam&lt;/tt&gt;, though. Should those be fixed as well?&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;....
conditions = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; CQL3CasConditions(statement.cfm, now);

...
UpdateParameters params = statement.makeUpdateParameters(Collections.singleton(key), clusteringPrefix, statementVariables, &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;, cl, now);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="13973761" author="mishail" created="Fri, 18 Apr 2014 03:47:34 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=iamaleksey&quot; class=&quot;user-hover&quot; rel=&quot;iamaleksey&quot;&gt;iamaleksey&lt;/a&gt; could you please review?&lt;/p&gt;</comment>
                            <comment id="13974639" author="iamaleksey" created="Fri, 18 Apr 2014 23:35:34 +0000"  >&lt;p&gt;+1&lt;/p&gt;</comment>
                            <comment id="13975997" author="mishail" created="Mon, 21 Apr 2014 20:28:06 +0000"  >&lt;p&gt;Hmm,&lt;/p&gt;

&lt;p&gt;I&apos;ve created a dtest which still fails. It looks like CAS/paxos stuff always uses server timestamps. &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=iamaleksey&quot; class=&quot;user-hover&quot; rel=&quot;iamaleksey&quot;&gt;iamaleksey&lt;/a&gt; is that expected behavior?&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;    def batch_with_conditions_uses_proper_timestamp_test(self):
        &lt;span class=&quot;code-quote&quot;&gt;&quot;&quot;&quot; Test that each statement will be executed with provided BATCH timestamp &quot;&lt;/span&gt;&quot;&quot;
        cursor = self.prepare()
        cursor.execute(&quot;&quot;&quot;
            BEGIN BATCH USING TIMESTAMP 1111111111111111
            INSERT INTO users (id, firstname, lastname) VALUES (999, &lt;span class=&quot;code-quote&quot;&gt;&apos;Jack&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;Sparrow&apos;&lt;/span&gt;)  IF NOT EXISTS
            APPLY BATCH
        &quot;&quot;&quot;)
        cursor.execute(&lt;span class=&quot;code-quote&quot;&gt;&quot;SELECT id, firstname, lastname, writetime(firstname), writetime(lastname) FROM users&quot;&lt;/span&gt;)
        res = sorted(cursor.fetchall())
        &lt;span class=&quot;code-keyword&quot;&gt;assert&lt;/span&gt; res == [[999, u&lt;span class=&quot;code-quote&quot;&gt;&apos;Jack&apos;&lt;/span&gt;, u&lt;span class=&quot;code-quote&quot;&gt;&apos;Sparrow&apos;&lt;/span&gt;, 1111111111111111, 1111111111111111]], res
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeHeader panelHeader&quot; style=&quot;border-bottom-width: 1px;&quot;&gt;&lt;b&gt;failure&lt;/b&gt;&lt;/div&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;Failure
Traceback (most recent call last):
  File &lt;span class=&quot;code-quote&quot;&gt;&quot;/usr/local/Cellar/python/2.7.6_1/Frameworks/Python.framework/Versions/2.7/lib/python2.7/unittest/&lt;span class=&quot;code-keyword&quot;&gt;case&lt;/span&gt;.py&quot;&lt;/span&gt;, line 331, in run
    testMethod()
  File &lt;span class=&quot;code-quote&quot;&gt;&quot;/Users/mikhail/Documents/workspace/cassandra-dtest/batch_test.py&quot;&lt;/span&gt;, line 179, in batch_with_conditions_uses_proper_timestamp_test
    &lt;span class=&quot;code-keyword&quot;&gt;assert&lt;/span&gt; res == [[999, u&lt;span class=&quot;code-quote&quot;&gt;&apos;Jack&apos;&lt;/span&gt;, u&lt;span class=&quot;code-quote&quot;&gt;&apos;Sparrow&apos;&lt;/span&gt;, 1111111111111111, 1111111111111111]], res
AssertionError: [[999, u&lt;span class=&quot;code-quote&quot;&gt;&apos;Jack&apos;&lt;/span&gt;, u&lt;span class=&quot;code-quote&quot;&gt;&apos;Sparrow&apos;&lt;/span&gt;, 1398111666371000, 1398111666371000]]
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="13976017" author="iamaleksey" created="Mon, 21 Apr 2014 20:47:12 +0000"  >&lt;blockquote&gt;&lt;p&gt;It looks like CAS/paxos stuff always uses server timestamps&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Yes, it&apos;s supposed to be that way.&lt;/p&gt;</comment>
                            <comment id="13976019" author="mishail" created="Mon, 21 Apr 2014 20:50:04 +0000"  >&lt;p&gt;OK, I&apos;m going to commit my patch as is then, without any changes for &lt;tt&gt;executeWithConditions&lt;/tt&gt;&lt;/p&gt;</comment>
                            <comment id="13976099" author="mishail" created="Mon, 21 Apr 2014 21:56:25 +0000"  >&lt;p&gt;Committed &lt;/p&gt;</comment>
                            <comment id="13976478" author="slebresne" created="Tue, 22 Apr 2014 07:17:53 +0000"  >&lt;blockquote&gt;&lt;p&gt;It looks like CAS/paxos stuff always uses server timestamps&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;While it does is supposed to be that way, we should probably refuse CAS batch that have a &apos;USING TIMESTAMP&apos;, since that make no sense.&lt;/p&gt;</comment>
                            <comment id="13977045" author="mishail" created="Tue, 22 Apr 2014 16:52:24 +0000"  >&lt;blockquote&gt;&lt;p&gt;we should probably refuse CAS batch that have a &apos;USING TIMESTAMP&apos;, since that make no sense.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-7067&quot; title=&quot;Refuse CAS batch that have a &amp;#39;USING TIMESTAMP&amp;#39;&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-7067&quot;&gt;&lt;del&gt;CASSANDRA-7067&lt;/del&gt;&lt;/a&gt; for that&lt;/p&gt;</comment>
                            <comment id="13977389" author="supencheck" created="Tue, 22 Apr 2014 20:47:01 +0000"  >&lt;p&gt;For what it is worth, the patch provided by Mikhail has been verified to work.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12640744" name="cassandra-2.0-7053.patch" size="1322" author="mishail" created="Fri, 18 Apr 2014 00:20:24 +0000"/>
                    </attachments>
                <subtasks>
                            <subtask id="12709810">CASSANDRA-7067</subtask>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[mishail]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>387489</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            11 years, 31 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1ur1j:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>387751</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12311421" key="com.atlassian.jira.plugin.system.customfieldtypes:multiversion">
                        <customfieldname>Reproduced In</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="12326170">2.0.6</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>aleksey</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[aleksey]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12962"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>