<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 22:41:12 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-6180] NPE in CqlRecordWriter: Related to AbstractCassandraStorage handling null values</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-6180</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;I encountered an issue with the &lt;tt&gt;CqlStorage&lt;/tt&gt; and it&apos;s handling of null values. The &lt;tt&gt;CqlRecordWriter&lt;/tt&gt; throws an NPE when a value is null. I found a related ticket &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-5885&quot; title=&quot;NPE in CqlRecordWriter when sinking null values&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-5885&quot;&gt;&lt;del&gt;CASSANDRA-5885&lt;/del&gt;&lt;/a&gt; and applied the there stated fix to the &lt;tt&gt;AbstractCassandraStorage&lt;/tt&gt;.&lt;br/&gt;
Instead of converting &lt;tt&gt;null&lt;/tt&gt; values to &lt;tt&gt;ByteBuffer.wrap(new byte&lt;span class=&quot;error&quot;&gt;&amp;#91;0&amp;#93;&lt;/span&gt;)&lt;/tt&gt; &lt;tt&gt;AbstractCassandraStorage&lt;/tt&gt; returns &lt;tt&gt;(ByteBuffer)null&lt;/tt&gt;&lt;/p&gt;

&lt;p&gt;This issue can be reproduced with the attached files: &lt;tt&gt;test_null.cql&lt;/tt&gt;, &lt;tt&gt;test_null_data&lt;/tt&gt;, &lt;tt&gt;null_test.pig&lt;/tt&gt;&lt;/p&gt;

&lt;p&gt;A fix can be found in the attached patch.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;java.io.IOException: java.lang.NullPointerException
	at org.apache.cassandra.hadoop.cql3.CqlRecordWriter$RangeClient.run(CqlRecordWriter.java:248)
Caused by: java.lang.NullPointerException
	at org.apache.thrift.protocol.TBinaryProtocol.writeBinary(TBinaryProtocol.java:194)
	at org.apache.cassandra.thrift.Cassandra$execute_prepared_cql3_query_args.write(Cassandra.java:41253)
	at org.apache.thrift.TServiceClient.sendBase(TServiceClient.java:63)
	at org.apache.cassandra.thrift.Cassandra$Client.send_execute_prepared_cql3_query(Cassandra.java:1683)
	at org.apache.cassandra.thrift.Cassandra$Client.execute_prepared_cql3_query(Cassandra.java:1673)
	at org.apache.cassandra.hadoop.cql3.CqlRecordWriter$RangeClient.run(CqlRecordWriter.java:232)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment>&lt;p&gt;Pig, CqlStorage&lt;/p&gt;</environment>
        <key id="12673418">CASSANDRA-6180</key>
            <summary>NPE in CqlRecordWriter: Related to AbstractCassandraStorage handling null values</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10002" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Normal</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="alexliu68">Alex Liu</assignee>
                                    <reporter username="hkropp">Henning Kropp</reporter>
                        <labels>
                    </labels>
                <created>Fri, 11 Oct 2013 11:56:11 +0000</created>
                <updated>Tue, 16 Apr 2019 09:32:03 +0000</updated>
                            <resolved>Fri, 25 Oct 2013 16:13:34 +0000</resolved>
                                        <fixVersion>1.2.12</fixVersion>
                    <fixVersion>2.0.3</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="13792546" author="hkropp" created="Fri, 11 Oct 2013 11:57:45 +0000"  >&lt;p&gt;Files to reproduce this issue and a patch.&lt;/p&gt;</comment>
                            <comment id="13793707" author="jbellis" created="Sun, 13 Oct 2013 16:57:46 +0000"  >&lt;p&gt;I don&apos;t think this is semantically correct.  &quot;UPDATE foo SET x = null&quot; means &quot;set x to a tombstone,&quot; which is not the same as setting it to an empty byte[].&lt;/p&gt;

&lt;p&gt;/cc &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=alexliu68&quot; class=&quot;user-hover&quot; rel=&quot;alexliu68&quot;&gt;alexliu68&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13793923" author="alexliu68" created="Mon, 14 Oct 2013 05:36:45 +0000"  >&lt;p&gt;Thrift API TBinaryProtocol.writeBinary method &lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void writeBinary(ByteBuffer buffer) &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; TException
    {
        writeI32(buffer.remaining());

        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (buffer.hasArray())
        {
            trans_.write(buffer.array(), buffer.position() + buffer.arrayOffset(), buffer.remaining());
        }
        &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt;
        {
            &lt;span class=&quot;code-object&quot;&gt;byte&lt;/span&gt;[] bytes = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;byte&lt;/span&gt;[buffer.remaining()];

            &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; j = 0;
            &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; (&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; i = buffer.position(); i &amp;lt; buffer.limit(); i++)
            {
                bytes[j++] = buffer.get(i);
            }

            trans_.write(bytes);
        }
    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;throws NPE if the variable is null instead of a BufferBuffer with empty byte. It looks like a bug for thrift execute_prepared_cql3_query which can&apos;t handle a null variable.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-5081&quot; title=&quot;Support null values in PreparedStatements parameters&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-5081&quot;&gt;&lt;del&gt;CASSANDRA-5081&lt;/del&gt;&lt;/a&gt; may only work for binary protocol.&lt;/p&gt;</comment>
                            <comment id="13793932" author="alexliu68" created="Mon, 14 Oct 2013 05:55:06 +0000"  >&lt;p&gt;If we do need use  ByteBuffer.wrap(new byte&lt;span class=&quot;error&quot;&gt;&amp;#91;0&amp;#93;&lt;/span&gt;) to fix the issue, this should only apply to CqlStorage, CassandraStorage should stay the old way.&lt;/p&gt;</comment>
                            <comment id="13793998" author="hkropp" created="Mon, 14 Oct 2013 09:04:47 +0000"  >&lt;p&gt;I agree that &lt;tt&gt;byte[]&lt;/tt&gt; is not semantically equivalent to &lt;tt&gt;null&lt;/tt&gt;. The representation of &lt;tt&gt;null&lt;/tt&gt; in Cassandra seems to me like an issue on it&apos;s own.&lt;/p&gt;

&lt;p&gt;How about limiting it to &lt;tt&gt;CqlStorage&lt;/tt&gt; and making it configurable? So the user can deliberately change the representation of &lt;tt&gt;null&lt;/tt&gt;/empty values.&lt;/p&gt;

&lt;p&gt;At least I can query easily for &lt;tt&gt;byte[]&lt;/tt&gt; but not for &lt;tt&gt;null&lt;/tt&gt;.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&amp;gt; CREATE INDEX null_idx ON null_table(null_value);
&amp;gt; DELETE null_value FROM null_table WHERE null_id = &lt;span class=&quot;code-quote&quot;&gt;&apos;a&apos;&lt;/span&gt;;
&amp;gt; SELECT COUNT(*) FROM null_table WHERE null_value = &apos;&apos;;
 count
-------
     6 
&amp;gt; SELECT * FROM null_table WHERE null_value = &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;;
Bad Request: Unsupported &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; value &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; indexed column null_value
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="13802708" author="alexliu68" created="Wed, 23 Oct 2013 08:25:41 +0000"  >&lt;p&gt;6180-v2-1.2-branch.txt is attached to set it to empty byte array for CqlStorage, keep it null for CassandraStorage&lt;/p&gt;</comment>
                            <comment id="13805418" author="brandon.williams" created="Fri, 25 Oct 2013 16:13:34 +0000"  >&lt;p&gt;Committed.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12609824" name="6180-v2-1.2-branch.txt" size="2142" author="alexliu68" created="Wed, 23 Oct 2013 08:24:31 +0000"/>
                            <attachment id="12607982" name="null_test.pig" size="561" author="hkropp" created="Fri, 11 Oct 2013 11:57:45 +0000"/>
                            <attachment id="12607985" name="patch.txt" size="754" author="hkropp" created="Fri, 11 Oct 2013 11:57:45 +0000"/>
                            <attachment id="12607983" name="test_null.cql" size="260" author="hkropp" created="Fri, 11 Oct 2013 11:57:45 +0000"/>
                            <attachment id="12607984" name="test_null_data" size="58" author="hkropp" created="Fri, 11 Oct 2013 11:57:45 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>5.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[alexliu68]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>353041</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            12 years, 4 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1ov87:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>353328</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12311421" key="com.atlassian.jira.plugin.system.customfieldtypes:multiversion">
                        <customfieldname>Reproduced In</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="12324948">1.2.10</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>brandon.williams</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[brandon.williams]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12962"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>