<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 22:22:26 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-3036] Vague primary key references in CQL</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-3036</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;create columnfamily wonk (id &apos;utf8&apos; primary key, id int)&lt;br/&gt;
update wonk set id=1 where id=&apos;test&apos;&lt;br/&gt;
create index wonk_id on wonk (id)&lt;/p&gt;

&lt;p&gt;This does what you would expect but then the results are unclear when using &apos;id&apos; in a where clause.&lt;/p&gt;

&lt;p&gt;&quot;select * from wonk where id=1&quot; returns nothing and &quot;select * from wonk where id=&apos;test&apos;&quot; works fine.&lt;/p&gt;

&lt;p&gt;Perhaps secondary indexes should not be allowed on columns that have the same name as the key_alias? At least a warning or something should be thrown to indicate you&apos;ve just made a useless index.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12518838">CASSANDRA-3036</key>
            <summary>Vague primary key references in CQL</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10003" iconUrl="https://issues.apache.org/jira/images/icons/priorities/trivial.svg">Low</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="xedin">Pavel Yaskevich</assignee>
                                    <reporter username="kreynolds">Kelley Reynolds</reporter>
                        <labels>
                            <label>core</label>
                            <label>cql</label>
                    </labels>
                <created>Sun, 14 Aug 2011 19:24:31 +0000</created>
                <updated>Tue, 16 Apr 2019 09:32:53 +0000</updated>
                            <resolved>Wed, 17 Aug 2011 22:18:34 +0000</resolved>
                                        <fixVersion>0.8.5</fixVersion>
                                    <component>Legacy/CQL</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                                                                <comments>
                            <comment id="13085810" author="jbellis" created="Tue, 16 Aug 2011 16:19:59 +0000"  >&lt;p&gt;We should validate that column_metadata does not get created with the key_alias, or column insertions where the column name is the key_alias.  (For both CQL and &quot;old&quot; paths.)&lt;/p&gt;</comment>
                            <comment id="13086272" author="xedin" created="Wed, 17 Aug 2011 12:42:14 +0000"  >&lt;p&gt;That is impossible to validate when comparator is not AsciiType because we force key_alias to be ascii&lt;/p&gt;</comment>
                            <comment id="13086307" author="jbellis" created="Wed, 17 Aug 2011 13:34:12 +0000"  >&lt;p&gt;Well, there&apos;s two ways we can compare them anyway:&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;compare the native bytes&lt;/li&gt;
	&lt;li&gt;compare the human-readable strings&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;I think I&apos;d prefer #1, because 99.9% of the time these are going to give the same answer for names/aliases that do not conflict, and String creation is relatively expensive so I&apos;d rather not do that.&lt;/p&gt;</comment>
                            <comment id="13086323" author="xedin" created="Wed, 17 Aug 2011 14:05:23 +0000"  >&lt;p&gt;Sorry this is my bad because it thought that AsciiType.decompose and UTF8Type.decompose won&apos;t produce the same bytes, tested now. So yes, we can just check for default/column comparator and if it is Ascii/UTF8/Bytes we can just compare native bytes.&lt;/p&gt;</comment>
                            <comment id="13086339" author="jbellis" created="Wed, 17 Aug 2011 14:26:23 +0000"  >&lt;p&gt;My point is we can &lt;b&gt;always&lt;/b&gt; just compare native bytes.&lt;/p&gt;</comment>
                            <comment id="13086342" author="xedin" created="Wed, 17 Aug 2011 14:28:29 +0000"  >&lt;p&gt;ok&lt;/p&gt;</comment>
                            <comment id="13086579" author="jbellis" created="Wed, 17 Aug 2011 20:43:11 +0000"  >&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;let&apos;s name the ColumnDef variable in validateCfDef something other than &quot;column&quot; (which usually means an IColumn or similar)&lt;/li&gt;
	&lt;li&gt;when we throw an invalid column name error, we should use the CF&apos;s comparator rather than AsciiType (which will error out on many binary column names)&lt;/li&gt;
	&lt;li&gt;CCFS calls getByteBuffer which catches MarshallException and turns it into IRE.  Suggest doing the validation ones from CCFS.validate, that way we don&apos;t have to do it again in CCFS.getColumns.  (Can just call AbstractType.fromString directly)&lt;/li&gt;
	&lt;li&gt;go ahead and commit the println removal separately &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13086596" author="xedin" created="Wed, 17 Aug 2011 21:08:12 +0000"  >&lt;blockquote&gt;&lt;p&gt;let&apos;s name the ColumnDef variable in validateCfDef something other than &quot;column&quot; (which usually means an IColumn or similar)&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Renamed to columnDef&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;when we throw an invalid column name error, we should use the CF&apos;s comparator rather than AsciiType (which will error out on many binary column names)&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I use cf.key_alias in there which we force to be AsciiType so it should be fine&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;CCFS calls getByteBuffer which catches MarshallException and turns it into IRE. Suggest doing the validation ones from CCFS.validate, that way we don&apos;t have to do it again in CCFS.getColumns. (Can just call AbstractType.fromString directly)&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;changed CCFS.getColumns to use comparator.fromString and changed validate method as you mentioned.&lt;/p&gt;</comment>
                            <comment id="13086619" author="jbellis" created="Wed, 17 Aug 2011 21:50:20 +0000"  >&lt;p&gt;+1&lt;/p&gt;</comment>
                            <comment id="13086640" author="xedin" created="Wed, 17 Aug 2011 22:18:34 +0000"  >&lt;p&gt;Committed.&lt;/p&gt;</comment>
                            <comment id="13086673" author="hudson" created="Wed, 17 Aug 2011 23:20:53 +0000"  >&lt;p&gt;Integrated in Cassandra-0.8 #284 (See &lt;a href=&quot;https://builds.apache.org/job/Cassandra-0.8/284/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/Cassandra-0.8/284/&lt;/a&gt;)&lt;br/&gt;
    Validate that column names in column_metadata does not equal to key_alias on create/update of the ColumnFamily and CQL &apos;ALTER&apos; statement.&lt;br/&gt;
patch by Pavel Yaskevich; reviewed by Jonathan Ellis for &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-3036&quot; title=&quot;Vague primary key references in CQL&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-3036&quot;&gt;&lt;del&gt;CASSANDRA-3036&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;xedin : &lt;a href=&quot;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1158939&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1158939&lt;/a&gt;&lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/cassandra/branches/cassandra-0.8/test/system/test_cql.py&lt;/li&gt;
	&lt;li&gt;/cassandra/branches/cassandra-0.8/test/unit/org/apache/cassandra/thrift/ThriftValidationTest.java&lt;/li&gt;
	&lt;li&gt;/cassandra/branches/cassandra-0.8/CHANGES.txt&lt;/li&gt;
	&lt;li&gt;/cassandra/branches/cassandra-0.8/src/java/org/apache/cassandra/thrift/ThriftValidation.java&lt;/li&gt;
	&lt;li&gt;/cassandra/branches/cassandra-0.8/src/java/org/apache/cassandra/cql/CreateColumnFamilyStatement.java&lt;/li&gt;
	&lt;li&gt;/cassandra/branches/cassandra-0.8/src/java/org/apache/cassandra/cql/QueryProcessor.java&lt;/li&gt;
	&lt;li&gt;/cassandra/branches/cassandra-0.8/src/java/org/apache/cassandra/cql/AlterTableStatement.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                    </comments>
                    <attachments>
                            <attachment id="12490699" name="CASSANDRA-3036-v2.patch" size="13941" author="xedin" created="Wed, 17 Aug 2011 21:08:12 +0000"/>
                            <attachment id="12490674" name="CASSANDRA-3036.patch" size="13420" author="xedin" created="Wed, 17 Aug 2011 17:36:10 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[xedin]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>20943</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            14 years, 14 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0gezb:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>93857</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>jbellis</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[jbellis]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12961"><![CDATA[Low]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>