<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 23:11:00 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-11163] Summaries are needlessly rebuilt when the BF FP ratio is changed</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-11163</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;This is from trunk, but I also saw this happen on 2.0:&lt;/p&gt;

&lt;p&gt;Before:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;root@bw-1:/srv/cassandra# ls -ltr /var/lib/cassandra/data/keyspace1/standard1-071efdc0d11811e590c3413ee28a6c90/
total 221460
drwxr-xr-x 2 root root      4096 Feb 11 23:34 backups
-rw-r--r-- 1 root root        80 Feb 11 23:50 ma-6-big-TOC.txt
-rw-r--r-- 1 root root     26518 Feb 11 23:50 ma-6-big-Summary.db
-rw-r--r-- 1 root root     10264 Feb 11 23:50 ma-6-big-Statistics.db
-rw-r--r-- 1 root root   2607705 Feb 11 23:50 ma-6-big-Index.db
-rw-r--r-- 1 root root    192440 Feb 11 23:50 ma-6-big-Filter.db
-rw-r--r-- 1 root root        10 Feb 11 23:50 ma-6-big-Digest.crc32
-rw-r--r-- 1 root root  35212125 Feb 11 23:50 ma-6-big-Data.db
-rw-r--r-- 1 root root      2156 Feb 11 23:50 ma-6-big-CRC.db
-rw-r--r-- 1 root root        80 Feb 11 23:50 ma-7-big-TOC.txt
-rw-r--r-- 1 root root     26518 Feb 11 23:50 ma-7-big-Summary.db
-rw-r--r-- 1 root root     10264 Feb 11 23:50 ma-7-big-Statistics.db
-rw-r--r-- 1 root root   2607614 Feb 11 23:50 ma-7-big-Index.db
-rw-r--r-- 1 root root    192432 Feb 11 23:50 ma-7-big-Filter.db
-rw-r--r-- 1 root root         9 Feb 11 23:50 ma-7-big-Digest.crc32
-rw-r--r-- 1 root root  35190400 Feb 11 23:50 ma-7-big-Data.db
-rw-r--r-- 1 root root      2152 Feb 11 23:50 ma-7-big-CRC.db
-rw-r--r-- 1 root root        80 Feb 11 23:50 ma-5-big-TOC.txt
-rw-r--r-- 1 root root    104178 Feb 11 23:50 ma-5-big-Summary.db
-rw-r--r-- 1 root root     10264 Feb 11 23:50 ma-5-big-Statistics.db
-rw-r--r-- 1 root root  10289077 Feb 11 23:50 ma-5-big-Index.db
-rw-r--r-- 1 root root    757384 Feb 11 23:50 ma-5-big-Filter.db
-rw-r--r-- 1 root root         9 Feb 11 23:50 ma-5-big-Digest.crc32
-rw-r--r-- 1 root root 139201355 Feb 11 23:50 ma-5-big-Data.db
-rw-r--r-- 1 root root      8508 Feb 11 23:50 ma-5-big-CRC.db
root@bw-1:/srv/cassandra# md5sum /var/lib/cassandra/data/keyspace1/standard1-071efdc0d11811e590c3413ee28a6c90/ma-5-big-Summary.db
5fca154fc790f7cfa37e8ad6d1c7552c
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;BF ratio changed, node restarted:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;root@bw-1:/srv/cassandra# ls -ltr /var/lib/cassandra/data/keyspace1/standard1-071efdc0d11811e590c3413ee28a6c90/
total 242168
drwxr-xr-x 2 root root      4096 Feb 11 23:34 backups
-rw-r--r-- 1 root root        80 Feb 11 23:50 ma-6-big-TOC.txt
-rw-r--r-- 1 root root     10264 Feb 11 23:50 ma-6-big-Statistics.db
-rw-r--r-- 1 root root   2607705 Feb 11 23:50 ma-6-big-Index.db
-rw-r--r-- 1 root root    192440 Feb 11 23:50 ma-6-big-Filter.db
-rw-r--r-- 1 root root        10 Feb 11 23:50 ma-6-big-Digest.crc32
-rw-r--r-- 1 root root  35212125 Feb 11 23:50 ma-6-big-Data.db
-rw-r--r-- 1 root root      2156 Feb 11 23:50 ma-6-big-CRC.db
-rw-r--r-- 1 root root        80 Feb 11 23:50 ma-7-big-TOC.txt
-rw-r--r-- 1 root root     10264 Feb 11 23:50 ma-7-big-Statistics.db
-rw-r--r-- 1 root root   2607614 Feb 11 23:50 ma-7-big-Index.db
-rw-r--r-- 1 root root    192432 Feb 11 23:50 ma-7-big-Filter.db
-rw-r--r-- 1 root root         9 Feb 11 23:50 ma-7-big-Digest.crc32
-rw-r--r-- 1 root root  35190400 Feb 11 23:50 ma-7-big-Data.db
-rw-r--r-- 1 root root      2152 Feb 11 23:50 ma-7-big-CRC.db
-rw-r--r-- 1 root root        80 Feb 11 23:50 ma-5-big-TOC.txt
-rw-r--r-- 1 root root     10264 Feb 11 23:50 ma-5-big-Statistics.db
-rw-r--r-- 1 root root  10289077 Feb 11 23:50 ma-5-big-Index.db
-rw-r--r-- 1 root root    757384 Feb 11 23:50 ma-5-big-Filter.db
-rw-r--r-- 1 root root         9 Feb 11 23:50 ma-5-big-Digest.crc32
-rw-r--r-- 1 root root 139201355 Feb 11 23:50 ma-5-big-Data.db
-rw-r--r-- 1 root root      8508 Feb 11 23:50 ma-5-big-CRC.db
-rw-r--r-- 1 root root        80 Feb 12 00:03 ma-8-big-TOC.txt
-rw-r--r-- 1 root root     14902 Feb 12 00:03 ma-8-big-Summary.db
-rw-r--r-- 1 root root     10264 Feb 12 00:03 ma-8-big-Statistics.db
-rw-r--r-- 1 root root   1458631 Feb 12 00:03 ma-8-big-Index.db
-rw-r--r-- 1 root root     10808 Feb 12 00:03 ma-8-big-Filter.db
-rw-r--r-- 1 root root        10 Feb 12 00:03 ma-8-big-Digest.crc32
-rw-r--r-- 1 root root  19660275 Feb 12 00:03 ma-8-big-Data.db
-rw-r--r-- 1 root root      1204 Feb 12 00:03 ma-8-big-CRC.db
-rw-r--r-- 1 root root     26518 Feb 12 00:04 ma-7-big-Summary.db
-rw-r--r-- 1 root root     26518 Feb 12 00:04 ma-6-big-Summary.db
-rw-r--r-- 1 root root    104178 Feb 12 00:04 ma-5-big-Summary.db
root@bw-1:/srv/cassandra# md5sum /var/lib/cassandra/data/keyspace1/standard1-071efdc0d11811e590c3413ee28a6c90/ma-5-big-Summary.db 
5fca154fc790f7cfa37e8ad6d1c7552c 
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This hurts startup time and appears to do nothing useful whatsoever.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12938653">CASSANDRA-11163</key>
            <summary>Summaries are needlessly rebuilt when the BF FP ratio is changed</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10002" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Normal</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="KurtG">Kurt Greaves</assignee>
                                    <reporter username="brandon.williams">Brandon Williams</reporter>
                        <labels>
                    </labels>
                <created>Fri, 12 Feb 2016 00:08:41 +0000</created>
                <updated>Fri, 15 May 2020 07:59:42 +0000</updated>
                            <resolved>Mon, 12 Mar 2018 08:36:41 +0000</resolved>
                                        <fixVersion>3.0.17</fixVersion>
                    <fixVersion>3.11.3</fixVersion>
                    <fixVersion>4.0-alpha1</fixVersion>
                    <fixVersion>4.0</fixVersion>
                                    <component>Legacy/Core</component>
                        <due></due>
                            <votes>1</votes>
                                    <watches>12</watches>
                                                                                                                <comments>
                            <comment id="15143811" author="jjirsa" created="Fri, 12 Feb 2016 00:58:08 +0000"  >&lt;p&gt;Also, the bloom filter is rebuilt on load(), but the rebuild (corrected) filter isn&apos;t persisted to disk (could make the argument that rebuilding the BF is right, but if you&apos;re going to take the time to do that, should also persist it to disk in the same way index summary is persisted).&lt;/p&gt;
</comment>
                            <comment id="15832423" author="_soumya_" created="Fri, 20 Jan 2017 21:26:29 +0000"  >&lt;p&gt;FWIW - this is causing startup on nodes in our cluster to take in excess of 15mins. We do have roughly 1.5TB on disk. We&apos;re on a patched version of 3.9.&lt;/p&gt;

&lt;p&gt;What I don&apos;t quite understand is why this behavior persists past the first restart of the BF FP?&lt;/p&gt;</comment>
                            <comment id="15832752" author="jjirsa" created="Sat, 21 Jan 2017 02:36:06 +0000"  >&lt;p&gt;It persists until all sstables are rewritten - the bloom filter is recalculated on startup but not persisted to disk until compaction runs. You can force the bloom filter to be rewritten without waiting dircompaction or this bug to be fixed by running &quot;nodetool upgradesstables -a&quot; to rewrite all of the sstables (note that this can be IO intensive and impact your latencies)&lt;/p&gt;</comment>
                            <comment id="16338593" author="jjirsa" created="Thu, 25 Jan 2018 01:55:52 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=KurtG&quot; class=&quot;user-hover&quot; rel=&quot;KurtG&quot;&gt;KurtG&lt;/a&gt; when you&apos;re patch available on this, ping me, I&apos;ll review and commit it for you.&lt;/p&gt;

&lt;p&gt;Also marking as 3.0+ because it&apos;s a legit bug and not a feature; if you don&apos;t plan on doing a 3.0 patch, let me know and I&apos;ll adjust.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="16342796" author="kurtg" created="Mon, 29 Jan 2018 00:28:26 +0000"  >&lt;p&gt;I&apos;ll have a patch up soon (next few days). Just need to write some tests. Will likely also solve &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-14166&quot; title=&quot;sstabledump tries to delete a file&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-14166&quot;&gt;&lt;del&gt;CASSANDRA-14166&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16349501" author="kurtg" created="Thu, 1 Feb 2018 23:35:28 +0000"  >&lt;p&gt;Patches for each branch below. So far I&apos;ve only got a green test run for trunk. Failures for 3.0 and 3.11 seem flaky/unrelated so will keep trying.&lt;/p&gt;
&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/apache/cassandra/compare/trunk...kgreav:14166-trunk&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;trunk&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/apache/cassandra/compare/cassandra-3.11...kgreav:14166-3.11&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;3.11&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/apache/cassandra/compare/cassandra-3.0...kgreav:14166-3.0&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;3.0&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://circleci.com/gh/kgreav/cassandra/66&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;utests&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;


&lt;p&gt;This patch also solves &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-14166&quot; title=&quot;sstabledump tries to delete a file&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-14166&quot;&gt;&lt;del&gt;CASSANDRA-14166&lt;/del&gt;&lt;/a&gt;. Basically I&apos;ve completely stopped regeneration of Summaries on startup (if BFFP is changed), and also stopped the behaviour implemented in &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-5015&quot; title=&quot;move bloom_filter_fp_chance to compaction options&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-5015&quot;&gt;&lt;del&gt;CASSANDRA-5015&lt;/del&gt;&lt;/a&gt; which would also regenerate the bloomfilters on startup.&lt;br/&gt;
There&apos;s definitely no reason to regenerate Summaries in this case, and as previously mentioned it&apos;s not great regenerating the bloomfilter unless you&apos;re going to persist it. I have added persistence for the bloomfilter (when it is regenerated), however I think it&apos;s a bad idea to do this on startup as it will likely be more time consuming than regenerating the summaries.&lt;/p&gt;

&lt;p&gt;If an operator chooses to these can be regenerated through &lt;tt&gt;upgradesstables -a&lt;/tt&gt;. Albeit that&apos;s not super efficient if you&apos;re just updating the bloomfilter, however I think it&apos;s good enough for the moment and a potential follow up ticket would be to add a nodetool command to regenerate bloomfilter/summaries/index/etc.&lt;/p&gt;

&lt;p&gt;The new behaviour would be to:&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;Never recreate Summary or bloomfilter when using an offline tool. Note that if the summary doesn&apos;t exist the tool will still create it in memory, but it won&apos;t persist it to disk (solving &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-14166&quot; title=&quot;sstabledump tries to delete a file&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-14166&quot;&gt;&lt;del&gt;CASSANDRA-14166&lt;/del&gt;&lt;/a&gt;)&lt;/li&gt;
	&lt;li&gt;Only regenerate the summary when it can&apos;t be loaded, OR when we&apos;ve said to recreate the bloomfilter. However we only save the summary if we&apos;ve been explicitly told to (which should be always EXCEPT for offline tools).&lt;/li&gt;
	&lt;li&gt;Only regenerate and persist the bloomfilter when it&apos;s missing - not when it has changed. This means we rely on compactions/upgradesstables to update the bloomfilter.&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;I&apos;ve updated &lt;tt&gt;org.apache.cassandra.io.sstable.SSTableReaderTest#testOpeningSSTable&lt;/tt&gt; to hopefully test all of these cases.&lt;/p&gt;</comment>
                            <comment id="16371081" author="cnlwsu" created="Wed, 21 Feb 2018 08:24:38 +0000"  >&lt;ul&gt;
	&lt;li&gt;In &lt;tt&gt;load(ValidationMetadata validation, boolean isOffline)&lt;/tt&gt; everywhere your calling &lt;tt&gt;load( bool , true )&lt;/tt&gt; you can instead call {{ load( bool, !isOffline) }} since you never want to save the summary in those other situations either. This will break your test but IMHO thats checking that the wrong case occurs. If the summary file is not there, it should not create it. Tools and such may be running with a different user, if someone runs this on a data directory and this occurs it will create a file that C* would be unable to delete, causing compaction threads to die and backup etc. I think, in offline mode the tools should &lt;em&gt;never&lt;/em&gt; delete, touch or create unnecessary files, especially the summary/bf files since they are mostly there to speed up startup and not necessary for the reader to work anyway. You can also make the &quot;recreateBloomFilter&quot; always false in offline mode (whenever its true, instead put !isOffline) since it will then just use whats there. With one exception of where the FILTER component is missing, where you can just put AlwaysPresent bf and skip so that code that uses it doesn&apos;t NPE.&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;In unit tests, is the 1000ms sleep necessary? the lastModified is in ms so I thought it may be ok to set lower&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;Just checking it out and running it over and over, the unit tests fails occasionally (rarely) (line 407 check &lt;tt&gt;assertNotEquals(bloomModified, bloomFile.lastModified());&lt;/tt&gt; is the same)&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;NP: I think you can reuse the last option (track hotness) since its only false currently in situations where we dont want or need to recreate currently. If rename it to like &quot;allowChanges&quot;. That way we are not adding additional booleans to end of that load function.&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="16383009" author="kurtg" created="Fri, 2 Mar 2018 02:04:46 +0000"  >&lt;p&gt;Thanks for the review Chris. Made changes according to your comments and updated the branches.&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;That works. It also didn&apos;t break tests because there was that initial catchall isOfflline at the top which covered all those cases. Note that ATM the only way the summary is recreated is by online operations (using open, rather than openNoValidation).&lt;/li&gt;
	&lt;li&gt;No it wasn&apos;t, assumed in Java we only had access to second precision which is not true in Java 8, as long as you use &lt;tt&gt;Files&lt;/tt&gt;. I&apos;ve updated the test to use 10ms sleeps with ms precision and it seems to be much more reliable. 99% sure the rare failures before were just because the second precision of &lt;tt&gt;lastModified()&lt;/tt&gt;&lt;/li&gt;
	&lt;li&gt;I&apos;ve updated to just use &lt;tt&gt;isOffline&lt;/tt&gt;. It seemed to make more sense than &lt;tt&gt;allowChanges&lt;/tt&gt; to me, in that &quot;we don&apos;t track hotness or touch files if we&apos;re offline&quot;. I&apos;ll note that this changed the behaviour of &lt;tt&gt;org.apache.cassandra.db.ColumnFamilyStore#getSnapshotSSTableReader&lt;/tt&gt; to be &quot;offline&quot;, however I think that makes sense in this case, as we shouldn&apos;t be regenerating summaries/BF&apos;s for snapshots anyway.&lt;/li&gt;
&lt;/ol&gt;


&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/apache/cassandra/compare/cassandra-3.0...kgreav:14166-3.0&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;3.0&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/apache/cassandra/compare/cassandra-3.11...kgreav:14166-3.11&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;3.11&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/apache/cassandra/compare/trunk...kgreav:14166-trunk&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;trunk&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;
</comment>
                            <comment id="16386338" author="cnlwsu" created="Mon, 5 Mar 2018 16:51:43 +0000"  >&lt;p&gt;Doesnt this now miss case where under normal (not offline) run and they change bf ratio it no longer recreates them? &lt;tt&gt;(validation.bloomFilterFPChance != metadata().params.bloomFilterFpChance)&lt;/tt&gt;. With this it will just load the old bf so theres no way to change it.&lt;/p&gt;</comment>
                            <comment id="16387002" author="kurtg" created="Tue, 6 Mar 2018 00:00:58 +0000"  >&lt;p&gt;Correct. As I noted previously&#160;&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;Only regenerate and persist the bloomfilter when it&apos;s missing - not when it has changed. This means we rely on compactions/upgradesstables to update the bloomfilter.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;There&apos;s definitely no reason to regenerate Summaries in this case, and as previously mentioned it&apos;s not great regenerating the bloomfilter unless you&apos;re going to persist it. I have added persistence for the bloomfilter (when it is regenerated), however I think it&apos;s a bad idea to do this on startup as it will likely be more time consuming than regenerating the summaries.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;So the previous behaviour was to regenerate the BF in this case but &lt;b&gt;not&lt;/b&gt; persist it on the next startup (this meant it would happen on every startup until compactions/upgrades had occured). The summaries would be regenerated and persisted on the next startup (pointlessly). Both of these things would slow startup time pretty significantly depending on how much data you had.&lt;/p&gt;

&lt;p&gt;The new behaviour would be to avoid regenerating BF/Summaries at all on startup and instead rely on upgradesstables/compactions to update them. Summaries would only be recreated when necessary (when not loaded/corrupt/missing).&lt;/p&gt;

&lt;p&gt;In trunk it might make sense to also add a nodetool command that will allow us to regenerate the bloomfilters/summaries/etc without re-writing the whole data file.&lt;/p&gt;</comment>
                            <comment id="16387009" author="cnlwsu" created="Tue, 6 Mar 2018 00:05:25 +0000"  >&lt;p&gt;gotcha +1 on patch from me&lt;/p&gt;

&lt;p&gt;I like idea of a &lt;tt&gt;nodetool recreatecomponent&lt;/tt&gt; or something but that would be a different jira.&lt;/p&gt;</comment>
                            <comment id="16387062" author="kurtg" created="Tue, 6 Mar 2018 00:47:58 +0000"  >&lt;p&gt;Thanks for the review &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=cnlwsu&quot; class=&quot;user-hover&quot; rel=&quot;cnlwsu&quot;&gt;cnlwsu&lt;/a&gt;. Created &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-14291&quot; title=&quot;Nodetool command to recreate SSTable components&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-14291&quot;&gt;CASSANDRA-14291&lt;/a&gt; as a follow up.&lt;/p&gt;</comment>
                            <comment id="16392525" author="michaelsembwever" created="Fri, 9 Mar 2018 07:25:02 +0000"  >&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;branch&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;testall&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;dtest&lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/kgreav/cassandra/tree/14166-3.0&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;14166-3.0&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://circleci.com/gh/kgreav/cassandra/tree/14166-3.0&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;testall&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://builds.apache.org/view/A-D/view/Cassandra/job/Cassandra-devbranch-dtest/506/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;dtest&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/kgreav/cassandra/tree/14166-3.11&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;14166-3.11&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://circleci.com/gh/kgreav/cassandra/tree/14166-3.11&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;testall&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://builds.apache.org/view/A-D/view/Cassandra/job/Cassandra-devbranch-dtest/507&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;dtest&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/kgreav/cassandra/tree/14166-trunk&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;14166-trunk&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://circleci.com/gh/kgreav/cassandra/tree/14166-trunk&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;testall&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://builds.apache.org/view/A-D/view/Cassandra/job/Cassandra-devbranch-dtest/508&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;dtest&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;


&lt;p&gt;EDIT: i had &lt;a href=&quot;https://builds.apache.org/view/A-D/view/Cassandra/job/Cassandra-devbranch-dtest/510/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;troubles&lt;/a&gt; getting the trunk patch dtests to run. As upstream trunk dtests appear to now be &lt;a href=&quot;https://builds.apache.org/view/A-D/view/Cassandra/job/Cassandra-trunk-dtest/462/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;working&lt;/a&gt;, I, off a &lt;a href=&quot;https://github.com/thelastpickle/cassandra/tree/14166-trunk&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;thelastpickle&lt;/a&gt; fork, rebased that patch off trunk and am running the dtests &lt;a href=&quot;https://builds.apache.org/view/A-D/view/Cassandra/job/Cassandra-devbranch-dtest/511/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;again&lt;/a&gt;&#8230;&lt;/p&gt;</comment>
                            <comment id="16394747" author="michaelsembwever" created="Mon, 12 Mar 2018 02:44:35 +0000"  >&lt;p&gt;Rebased trunk patch run the dtests.&#160;&lt;/p&gt;

&lt;p&gt;I don&apos;t believe the failed test has anything to do with this ticket:&#160;&lt;a href=&quot;https://builds.apache.org/view/A-D/view/Cassandra/job/Cassandra-devbranch-dtest/511/testReport/junit/repair_tests.repair_test/TestRepair/test_dc_parallel_repair/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;repair_tests.repair_test.TestRepair.test_dc_parallel_repair&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16394947" author="michaelsembwever" created="Mon, 12 Mar 2018 08:37:19 +0000"  >&lt;p&gt;Committed.&lt;/p&gt;</comment>
                            <comment id="16458549" author="iamaleksey" created="Mon, 30 Apr 2018 13:01:35 +0000"  >&lt;p&gt;This commit broke 3.0 unit tests (maybe 3.11 too, haven&apos;t checked).&lt;/p&gt;

&lt;p&gt;See &lt;a href=&quot;https://builds.apache.org/view/A-D/view/Cassandra/job/Cassandra-3.0-test-all/lastCompletedBuild/testReport/org.apache.cassandra.io.sstable/SSTableReaderTest/testOpeningSSTable/history/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/view/A-D/view/Cassandra/job/Cassandra-3.0-test-all/lastCompletedBuild/testReport/org.apache.cassandra.io.sstable/SSTableReaderTest/testOpeningSSTable/history/&lt;/a&gt; and &lt;a href=&quot;https://builds.apache.org/view/A-D/view/Cassandra/job/Cassandra-3.0-test-all/248/changes&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/view/A-D/view/Cassandra/job/Cassandra-3.0-test-all/248/changes&lt;/a&gt;. It&apos;s also failing locally and I&apos;m pretty sure will be failing &lt;a href=&quot;https://circleci.com/gh/iamaleksey/cassandra/234&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;here&lt;/a&gt; too.&lt;/p&gt;

&lt;p&gt;We should be more careful about committing things. But in the meantime, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mck&quot; class=&quot;user-hover&quot; rel=&quot;mck&quot;&gt;mck&lt;/a&gt; can you please fix this or revert this until there is a fix? Cheers.&lt;/p&gt;</comment>
                            <comment id="16458556" author="cnlwsu" created="Mon, 30 Apr 2018 13:12:51 +0000"  >&lt;p&gt;thought this was fixed in &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-14387&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/CASSANDRA-14387&lt;/a&gt; ? time resolution being different on causing it to fail on some systems.&lt;/p&gt;</comment>
                            <comment id="16458561" author="iamaleksey" created="Mon, 30 Apr 2018 13:18:05 +0000"  >&lt;p&gt;Yeah. As you (and Marcus, offline) mentioned, &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-14387&quot; title=&quot;SSTableReaderTest#testOpeningSSTable fails on macOS&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-14387&quot;&gt;&lt;del&gt;CASSANDRA-14387&lt;/del&gt;&lt;/a&gt; was only committed to trunk, so 3.0 tests are still failing elsewhere (incl. Jenkins, but not Circle). We just need to commit 14387 to 3.0 and 3.11.&lt;/p&gt;</comment>
                            <comment id="16459267" author="michaelsembwever" created="Mon, 30 Apr 2018 23:30:54 +0000"  >&lt;blockquote&gt;&lt;p&gt;Cherry-plicked into 3.0 as&#160;&lt;a href=&quot;https://github.com/apache/cassandra/commit/e16f0ed0698c5cb47ab2bb0a0b04966d5bdbcde0&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;e16f0ed0698c5cb47ab2bb0a0b04966d5bdbcde0&lt;/a&gt;&#160;and merged upwards&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=iamaleksey&quot; class=&quot;user-hover&quot; rel=&quot;iamaleksey&quot;&gt;iamaleksey&lt;/a&gt; for fixing&#160;this.&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;We should be more careful about committing things.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Yes, I should have noticed that &lt;tt&gt;SSTableReaderTest&lt;/tt&gt; was a new failure in&#160;&#160;&lt;a href=&quot;https://builds.apache.org/view/A-D/view/Cassandra/job/Cassandra-3.0-test-all/248/#showFailuresLink&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/view/A-D/view/Cassandra/job/Cassandra-3.0-test-all/248/#showFailuresLink&lt;/a&gt;&#160;&lt;/p&gt;

&lt;p&gt;Up until now I&apos;ve only been using circleci unit test reports, as illustrated in the &quot;branch|testall|dtest&quot; comment above, which reported it all green.&lt;/p&gt;

&lt;p&gt;As CircleCI hasn&apos;t failed on this test, what&apos;s the difference&#160;here?&#160;&lt;br/&gt;
Aleksey&apos;s circleci build #234 &lt;a href=&quot;https://circleci.com/gh/iamaleksey/cassandra/234#tests/containers/2&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;passed&#160;SSTableReaderTest&lt;/a&gt;&#160;,&#160;as did Kurt&apos;s &lt;a href=&quot;https://circleci.com/gh/kgreav/cassandra/116#tests/containers/1&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;here&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;If&#160;CircleCi and Jenkins can both identify failures separately then &quot;test-all&quot; column should be split into two,&#160;to link to each.&lt;/p&gt;

&lt;p&gt;Otherwise, does Jenkins have any form of alerting or reporting on tests that go from stable to flakey? Would have been&#160;ideal to have automatically have receive the breakage information before it affected you &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=iamaleksey&quot; class=&quot;user-hover&quot; rel=&quot;iamaleksey&quot;&gt;iamaleksey&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16459269" author="cnlwsu" created="Mon, 30 Apr 2018 23:32:20 +0000"  >&lt;p&gt;the granularity of the file timestamp depends on the filesystem&lt;/p&gt;</comment>
                            <comment id="16459274" author="michaelsembwever" created="Mon, 30 Apr 2018 23:36:44 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=cnlwsu&quot; class=&quot;user-hover&quot; rel=&quot;cnlwsu&quot;&gt;cnlwsu&lt;/a&gt;,&#160;oh! not os but filesystem, and circleci and jenkins differ there. Ouch.&#160;&lt;br/&gt;
How should we&#160;test against that?&lt;/p&gt;</comment>
                            <comment id="16459370" author="kurtg" created="Tue, 1 May 2018 01:28:37 +0000"  >&lt;p&gt;Hm, sorry about that. Originally started with second delays but changed it to speed up the test.&#160;Thought ms would be safe in this day and age. 2018 and all that.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;How should we&#160;test against that?&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;We don&apos;t, just have to go with the lowest resolution which will hopefully be seconds. No point putting workarounds in to speed up a test by a few seconds on &lt;em&gt;some&lt;/em&gt; platforms. Having said that, what filesystem is jenkins running? Seems odd it&apos;d only have second precision. But then again it&apos;s probably an ancient server.&lt;/p&gt;</comment>
                            <comment id="16459476" author="djoshi3" created="Tue, 1 May 2018 06:25:40 +0000"  >&lt;p&gt;There isn&apos;t a clean or standard way to determine if a file system supports sub-second date/time resolution for file modifications.&lt;/p&gt;</comment>
                            <comment id="16459598" author="iamaleksey" created="Tue, 1 May 2018 10:39:12 +0000"  >&lt;blockquote&gt;&lt;p&gt;Yes, I should have noticed that SSTableReaderTest was a new failure in  &lt;a href=&quot;https://builds.apache.org/view/A-D/view/Cassandra/job/Cassandra-3.0-test-all/248/#showFailuresLink&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/view/A-D/view/Cassandra/job/Cassandra-3.0-test-all/248/#showFailuresLink&lt;/a&gt; &lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Realistically, you shouldn&apos;t have. Looking at Circle should be sufficient enough. I just assumed that it would break on Circle just like it broke in our internal CI and Jenkins, and that was wrong. My apologies for the somewhat passive-aggressive righteous tone.&lt;/p&gt;

&lt;p&gt;If Circle is green, we should be free to commit, and we should be checking with ASF Jenkins from time to time, but it should not be required for every commit.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310060">
                    <name>Container</name>
                                            <outwardlinks description="contains">
                                        <issuelink>
            <issuekey id="13130544">CASSANDRA-14166</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                            <issuelinktype id="12310560">
                    <name>Problem/Incident</name>
                                            <outwardlinks description="causes">
                                        <issuelink>
            <issuekey id="13152775">CASSANDRA-14387</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[KurtG]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 29 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2sqw7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>cnlwsu</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[cnlwsu]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12962"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>