<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 23:22:20 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-16975] CompactionTask#runMayThrow should not release new SSTables for offline transactions</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-16975</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;Right now, &lt;tt&gt;CompactionTask#runMayThrow&lt;/tt&gt; releases new SSTables for offline transactions (&lt;a href=&quot;https://github.com/apache/cassandra/blob/f7c71f65c000c2c3ef7df1b034b8fdd822a396d8/src/java/org/apache/cassandra/db/compaction/CompactionTask.java#L227-L230&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;code&lt;/a&gt;). This change was added in &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-8962&quot; title=&quot;Fix SSTableRewriterTest on Windows&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-8962&quot;&gt;&lt;del&gt;CASSANDRA-8962&lt;/del&gt;&lt;/a&gt;, prior to the introduction of lifecycle transactions in &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-8568&quot; title=&quot;Extend Transactional API to sstable lifecycle management&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-8568&quot;&gt;&lt;del&gt;CASSANDRA-8568&lt;/del&gt;&lt;/a&gt;. I suspect that this behavior might be undesired and could have just fallen through the cracks.&lt;/p&gt;

&lt;p&gt;To my knowledge, this code does not cause any known bugs solely because in-tree tools do not access the SSTables they produce before exiting. However, if someone is to write, say, offline compaction daemon, it might break on subsequent compactions because newly created SSTables will be released.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13402008">CASSANDRA-16975</key>
            <summary>CompactionTask#runMayThrow should not release new SSTables for offline transactions</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10002" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Normal</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="Gerrrr">Alex Sorokoumov</assignee>
                                    <reporter username="Gerrrr">Alex Sorokoumov</reporter>
                        <labels>
                    </labels>
                <created>Sat, 18 Sep 2021 16:03:03 +0000</created>
                <updated>Fri, 27 May 2022 19:24:59 +0000</updated>
                            <resolved>Thu, 30 Sep 2021 12:19:57 +0000</resolved>
                                        <fixVersion>3.0.26</fixVersion>
                    <fixVersion>3.11.12</fixVersion>
                    <fixVersion>4.0.2</fixVersion>
                    <fixVersion>4.1-alpha1</fixVersion>
                    <fixVersion>4.1</fixVersion>
                                    <component>Local/Compaction</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="17417326" author="gerrrr" created="Sun, 19 Sep 2021 12:28:39 +0000"  >&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;Branch&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;CI&lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/apache/cassandra/compare/cassandra-3.0...Gerrrr:16975-3.0?expand=1&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;3.0&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://app.circleci.com/pipelines/github/Gerrrr/cassandra/208/workflows/ed8ff9b7-f126-477b-8191-b39efd61345d&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;j8&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/apache/cassandra/compare/cassandra-3.11...Gerrrr:16975-3.11?expand=1&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;3.11&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://app.circleci.com/pipelines/github/Gerrrr/cassandra/207/workflows/12bf105b-60b2-4fec-b98e-ab08ef6d33bc&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;j8&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/apache/cassandra/compare/trunk...Gerrrr:CASSANDRA-16975?expand=1&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;4.0&lt;/a&gt;&#160;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://app.circleci.com/pipelines/github/Gerrrr/cassandra/200/workflows/9f0978f7-b363-440d-aa88-1a8a2b4b6316&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;j8&lt;/a&gt; &lt;a href=&quot;https://app.circleci.com/pipelines/github/Gerrrr/cassandra/200/workflows/6fbd5910-0e98-457f-8d1a-0b1f2048052c&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;j11&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;


&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="17417974" author="blambov" created="Tue, 21 Sep 2021 08:18:11 +0000"  >&lt;p&gt;Within compaction itself clearly isn&apos;t the right place to clear these references, but don&apos;t we still want to do this in the tools?&lt;/p&gt;</comment>
                            <comment id="17417982" author="blambov" created="Tue, 21 Sep 2021 08:39:53 +0000"  >&lt;p&gt;On second thought, clearing the reference will bring it to 0, which might trigger some obsoletion we really don&apos;t want to happen to the outputs. In other words, it&apos;s best if the tools exit with a reference to their outputs.&lt;/p&gt;

&lt;p&gt;Patch LGTM.&lt;/p&gt;</comment>
                            <comment id="17419112" author="adelapena" created="Thu, 23 Sep 2021 10:24:41 +0000"  >&lt;p&gt;Looks good to me. Should we apply this to 3.0/3.11?&lt;/p&gt;

&lt;p&gt;Nit: the &lt;tt&gt;throws Exception&lt;/tt&gt; in the test is not needed.&lt;/p&gt;</comment>
                            <comment id="17419144" author="gerrrr" created="Thu, 23 Sep 2021 11:24:27 +0000"  >&lt;p&gt;I removed &lt;tt&gt;throws Exception&lt;/tt&gt; from the test and added patches + CI for 3.0 and 3.11 to the table in the previous comment.&lt;/p&gt;</comment>
                            <comment id="17420909" author="adelapena" created="Mon, 27 Sep 2021 16:54:47 +0000"  >&lt;p&gt;Great, +1&lt;/p&gt;</comment>
                            <comment id="17422601" author="gerrrr" created="Thu, 30 Sep 2021 08:10:39 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=adelapena&quot; class=&quot;user-hover&quot; rel=&quot;adelapena&quot;&gt;adelapena&lt;/a&gt; As this patch has two +1s, should I move it to &lt;tt&gt;READY TO COMMIT&lt;/tt&gt;?&lt;/p&gt;</comment>
                            <comment id="17422654" author="adelapena" created="Thu, 30 Sep 2021 09:27:34 +0000"  >&lt;p&gt;Sure, I&apos;ll commit it in a bit.&lt;/p&gt;</comment>
                            <comment id="17422664" author="gerrrr" created="Thu, 30 Sep 2021 09:47:35 +0000"  >&lt;p&gt;Thank you!&lt;/p&gt;</comment>
                            <comment id="17422673" author="adelapena" created="Thu, 30 Sep 2021 10:13:39 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=Gerrrr&quot; class=&quot;user-hover&quot; rel=&quot;Gerrrr&quot;&gt;Gerrrr&lt;/a&gt; I understand that the patch should also be applied to trunk, is this right? I have prepared a patch for trunk &lt;a href=&quot;https://github.com/apache/cassandra/compare/trunk...adelapena:16975-trunk-review&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;here&lt;/a&gt;, with CI runs for &lt;a href=&quot;https://app.circleci.com/pipelines/github/adelapena/cassandra/936/workflows/0d59df0e-ac26-4c88-afc5-404bf767c033&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;j8&lt;/a&gt; and &lt;a href=&quot;https://app.circleci.com/pipelines/github/adelapena/cassandra/936/workflows/2f4fd070-4fd2-4753-a4e6-2137379f8997&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;j11&lt;/a&gt;. The runs contain 100 rounds of the new test, just in case.&lt;/p&gt;</comment>
                            <comment id="17422678" author="gerrrr" created="Thu, 30 Sep 2021 10:22:38 +0000"  >&lt;p&gt;Ah, you are right! I am still not used to the fact that 4.0 is not trunk &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="17422731" author="adelapena" created="Thu, 30 Sep 2021 12:19:13 +0000"  >&lt;p&gt;No worries, too many branches &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;Committed to 3.0 as &lt;a href=&quot;https://github.com/apache/cassandra/commit/3e6faca572a5ca1de5906b39b8c0a6bf4deb40e9&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;3e6faca572a5ca1de5906b39b8c0a6bf4deb40e9&lt;/a&gt; and merged to &lt;a href=&quot;https://github.com/apache/cassandra/commit/dcc95492e9b05e1b8ceb3af332d5c0989c7272b0&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;3.11&lt;/a&gt;, &lt;a href=&quot;https://github.com/apache/cassandra/commit/c0916d67be25c700e5de93242afa7244c7fbbb02&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;4.0&lt;/a&gt; and &lt;a href=&quot;https://github.com/apache/cassandra/commit/b6e400d0c3c3f74d17261caaa6388e6c70df322f&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;trunk&lt;/a&gt;.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[Gerrrr]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12313825" key="com.atlassian.jira.plugin.system.customfieldtypes:cascadingselect">
                        <customfieldname>Bug Category</customfieldname>
                        <customfieldvalues>
                                                    <customfieldvalue key="12982" cascade-level=""><![CDATA[Correctness]]></customfieldvalue>
            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12313821" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Complexity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12965"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313822" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Discovered By</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12975"><![CDATA[Code Inspection]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12313922" key="jira.plugin.projectspecificselectfield.jpssf:multicftype">
                        <customfieldname>Impacts</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="13100"><![CDATA[None]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            4 years, 6 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12313921" key="jira.plugin.projectspecificselectfield.jpssf:multicftype">
                        <customfieldname>Platform</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="13076"><![CDATA[All]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0v2ds:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[adelapena]]></customfieldvalue>
        <customfieldvalue><![CDATA[blambov]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12961"><![CDATA[Low]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12311420" key="com.atlassian.jira.plugin.system.customfieldtypes:version">
                        <customfieldname>Since Version</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="12348835">NA</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313924" key="com.atlassian.jira.plugin.system.customfieldtypes:textfield">
                        <customfieldname>Source Control Link</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>&lt;p&gt;&lt;a href=&quot;https://github.com/apache/cassandra/commit/3e6faca572a5ca1de5906b39b8c0a6bf4deb40e9&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/cassandra/commit/3e6faca572a5ca1de5906b39b8c0a6bf4deb40e9&lt;/a&gt;&lt;/p&gt;</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313823" key="com.atlassian.jira.plugin.system.customfieldtypes:textarea">
                        <customfieldname>Test and Documentation Plan</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>&lt;p&gt;I added a test to &lt;tt&gt;CompactionTaskTest&lt;/tt&gt; that ensures that SSTables produced by offline CompactionTasks are not released.&lt;/p&gt;</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>