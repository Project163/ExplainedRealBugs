<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 22:19:43 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-2244] secondary indexes aren&apos;t created on pre-existing or streamed data</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-2244</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;The repaired node neither receives indexes from the replicas, nor does it generate them afterwards.  The same bug prevents generation of new indexes against existing data.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12499629">CASSANDRA-2244</key>
            <summary>secondary indexes aren&apos;t created on pre-existing or streamed data</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10002" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Normal</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="jbellis">Jonathan Ellis</assignee>
                                    <reporter username="brandon.williams">Brandon Williams</reporter>
                        <labels>
                    </labels>
                <created>Thu, 24 Feb 2011 19:29:19 +0000</created>
                <updated>Tue, 16 Apr 2019 09:33:05 +0000</updated>
                            <resolved>Thu, 3 Mar 2011 17:42:17 +0000</resolved>
                                        <fixVersion>0.7.4</fixVersion>
                                    <component>Feature/2i Index</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                    <workratio workratioPercent="0"/>
                                    <progress percentage="0">
                                    <originalProgress>
                                                    <row percentage="100" backgroundColor="#89afd7"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="0" backgroundColor="#51a825"/>
                                                    <row percentage="100" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="0">
                                    <originalProgress>
                                                    <row percentage="100" backgroundColor="#89afd7"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="0" backgroundColor="#51a825"/>
                                                    <row percentage="100" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                    <timeoriginalestimate seconds="57600">16h</timeoriginalestimate>
                            <timeestimate seconds="57600">16h</timeestimate>
                                        <comments>
                            <comment id="13000154" author="jbellis" created="Mon, 28 Feb 2011 07:31:39 +0000"  >&lt;p&gt;Doesn&apos;t repair use normal Streaming?  That should take care of generating the index CFs.&lt;/p&gt;</comment>
                            <comment id="13001183" author="brandon.williams" created="Tue, 1 Mar 2011 23:33:33 +0000"  >&lt;p&gt;I added some logging, it does do something after streaming:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt; INFO 23:27:32,050 Opening /var/lib/cassandra/data/Keyspace1/Standard1-f-1
 INFO 23:27:34,843 Opening /var/lib/cassandra/data/Keyspace1/Standard1-f-2
 INFO 23:27:35,232 Opening /var/lib/cassandra/data/Keyspace1/Standard1-f-3
 INFO 23:27:35,246 Building index for ColumnFamilyStore(table=&apos;Keyspace1&apos;, columnFamily=&apos;Standard1&apos;) [SSTableReader(path=&apos;/var/lib/cassandra/data/Keyspace1/Standard1-f-1-Data.db&apos;), SSTableReader(path=&apos;/var/lib/cassandra/data/Keyspace1/Standard1-f-2-Data.db&apos;), SSTableReader(path=&apos;/var/lib/cassandra/data/Keyspace1/Standard1-f-3-Data.db&apos;)] [java.nio.HeapByteBuffer[pos=0 lim=2 cap=2]]
 INFO 23:29:53,448 Finished streaming session 19283352579402862 from /10.179.65.102
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;During the ~2.5 minutes between the last 2 lines it appeared to generate the index, however flushing afterwards shows no index was generated:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt; INFO 23:32:06,591 switching in a fresh Memtable for LocationInfo at CommitLogContext(file=&apos;/var/lib/cassandra/commitlog/CommitLog-1299022015229.log&apos;, position=12763)
 INFO 23:32:06,592 Enqueuing flush of Memtable-LocationInfo@1459852990(35 bytes, 1 operations)
 INFO 23:32:06,593 Writing Memtable-LocationInfo@1459852990(35 bytes, 1 operations)
 INFO 23:32:06,623 Completed flushing /var/lib/cassandra/data/system/LocationInfo-f-3-Data.db (89 bytes)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

</comment>
                            <comment id="13002051" author="jbellis" created="Thu, 3 Mar 2011 16:34:00 +0000"  >&lt;p&gt;The &quot;don&apos;t bother flushing dropped CFs&quot; check was unaware that index CFs are never part of the global CF metadata.&lt;/p&gt;

&lt;p&gt;(I think that check is race-prone to begin with, so we should probably drop it and do something more robust, but for now it&apos;s better than nothing &amp;#8211; it will &lt;b&gt;usually&lt;/b&gt; prevent creating new sstables for dropped CFs.)&lt;/p&gt;</comment>
                            <comment id="13002073" author="jbellis" created="Thu, 3 Mar 2011 17:04:00 +0000"  >&lt;p&gt;Gary points out that migration does acquire the flushlock.&lt;/p&gt;</comment>
                            <comment id="13002074" author="jbellis" created="Thu, 3 Mar 2011 17:04:48 +0000"  >&lt;p&gt;patch adds test that catches the problem, and adds fix to CFS.&lt;/p&gt;</comment>
                            <comment id="13002097" author="brandon.williams" created="Thu, 3 Mar 2011 17:42:17 +0000"  >&lt;p&gt;+1, committed&lt;/p&gt;</comment>
                            <comment id="13002103" author="hudson" created="Thu, 3 Mar 2011 17:55:22 +0000"  >&lt;p&gt;Integrated in Cassandra-0.7 #342 (See &lt;a href=&quot;https://hudson.apache.org/hudson/job/Cassandra-0.7/342/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://hudson.apache.org/hudson/job/Cassandra-0.7/342/&lt;/a&gt;)&lt;br/&gt;
    CFS correctly flushes index CFs.&lt;br/&gt;
Patch by jbellis, reviewed by brandonwilliams for &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-2244&quot; title=&quot;secondary indexes aren&amp;#39;t created on pre-existing or streamed data&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-2244&quot;&gt;&lt;del&gt;CASSANDRA-2244&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12472561" name="2244-v2.txt" size="3027" author="jbellis" created="Thu, 3 Mar 2011 17:04:48 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[jbellis]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>20523</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            14 years, 38 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0ga7r:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>93085</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>brandon.williams</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[brandon.williams]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12962"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>