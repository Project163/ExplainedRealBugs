<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 22:52:23 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-9198] Deleting from an empty list produces an error</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-9198</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;While deleting an element from a list that does not contain it is a no-op, deleting it from an empty list causes an error.&lt;br/&gt;
This edge case is a bit inconsistent, because it makes list deletion non idempotent:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;cqlsh:test&amp;gt; create table foo (k &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; primary key, v list&amp;lt;&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;&amp;gt;);
cqlsh:test&amp;gt; insert into foo(k,v) values (1, [1,2]);

cqlsh:test&amp;gt; update foo set v = v - [1] where k = 1;
cqlsh:test&amp;gt; update foo set v = v - [1] where k = 1;

cqlsh:test&amp;gt; update foo set v = v - [2] where k = 1;
cqlsh:test&amp;gt; update foo set v = v - [2] where k = 1;
InvalidRequest: code=2200 [Invalid query] message=&lt;span class=&quot;code-quote&quot;&gt;&quot;Attempted to delete an element from a list which is &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;&quot;&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;With speculative retries coming to the drivers, idempotency becomes more important because it determines which query we might retry or not. So it would be better if deleting from an empty list succeeded.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12821320">CASSANDRA-9198</key>
            <summary>Deleting from an empty list produces an error</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10003" iconUrl="https://issues.apache.org/jira/images/icons/priorities/trivial.svg">Low</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="jjirsa">Jeff Jirsa</assignee>
                                    <reporter username="omichallat">Olivier Michallat</reporter>
                        <labels>
                    </labels>
                <created>Wed, 15 Apr 2015 21:28:40 +0000</created>
                <updated>Tue, 16 Apr 2019 09:31:14 +0000</updated>
                            <resolved>Wed, 22 Apr 2015 08:45:44 +0000</resolved>
                                        <fixVersion>2.1.6</fixVersion>
                                    <component>Legacy/CQL</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="14497728" author="blerer" created="Thu, 16 Apr 2015 08:33:32 +0000"  >&lt;p&gt;Cassandra does not differentiate between an empty list and a list which is null. In Java deleting from an empty list is fine not from a list which is null.&lt;/p&gt;

&lt;p&gt;Making the delete operation a noop operation can be done but from my opinion it is a breaking change so if we do it we should do it in 3.0.  &lt;/p&gt;</comment>
                            <comment id="14498153" author="blerer" created="Thu, 16 Apr 2015 15:26:03 +0000"  >&lt;p&gt;@Sylvain last time we discussed that subject, we agreed that as we complain on invalid index for lists, not complaining when trying to delete from an empty list was not really consistent. On the other hand, it is also true that we do not complain for the same operation on a &lt;tt&gt;map&lt;/tt&gt; or a &lt;tt&gt;set&lt;/tt&gt;. What is your opinion?&lt;/p&gt;</comment>
                            <comment id="14501694" author="jjirsa" created="Sun, 19 Apr 2015 05:16:59 +0000"  >&lt;p&gt;We brushed on this in &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-9077&quot; title=&quot;Deleting an element from a List which is null throws a NPE&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-9077&quot;&gt;&lt;del&gt;CASSANDRA-9077&lt;/del&gt;&lt;/a&gt; &lt;/p&gt;

&lt;p&gt;The fact that the list can become null just by removing elements from it seems non-intuitive to me (not to say it&apos;s wrong, just that I don&apos;t think most developers would expect it) - it seems like it should become empty, not null. &lt;/p&gt;

&lt;p&gt;I would expect `DELETE FROM foo WHERE k=1` to result in a null list, but simply removing an element from a list should result in an empty list. &lt;/p&gt;
</comment>
                            <comment id="14501858" author="brandon.williams" created="Sun, 19 Apr 2015 14:16:43 +0000"  >&lt;p&gt;I tend to agree in that we should support idempotent operations as much as possible, nobody is really going to care about knowing if the the list was null or not when deleting from it.&lt;/p&gt;</comment>
                            <comment id="14503088" author="slebresne" created="Mon, 20 Apr 2015 16:06:59 +0000"  >&lt;blockquote&gt;&lt;p&gt;last time we discussed that subject, we agreed that as we complain on invalid index for lists, not complaining when trying to delete from an empty list was not really consistent. &lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Yes, but I hadn&apos;t though of the idempotency issue at the time, and I do think we should make thing idempotent as much as possible, so +1 for not complaining in that case. And since this case was buggy until CASSANDRA_9077, I suggest we fix that before 2.1.5 is released.&lt;/p&gt;</comment>
                            <comment id="14503146" author="jjirsa" created="Mon, 20 Apr 2015 16:33:49 +0000"  >&lt;p&gt;Attaching patch that was previously option #2 on &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-9077&quot; title=&quot;Deleting an element from a List which is null throws a NPE&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-9077&quot;&gt;&lt;del&gt;CASSANDRA-9077&lt;/del&gt;&lt;/a&gt;. Addresses this without modification (though I&apos;ll also attach an update shortly that ALSO addresses the now-failing unit tests that expected the older behavior)&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;cqlsh&amp;gt; create keyspace IF NOT EXISTS test WITH replication = {&apos;class&apos;: &apos;SimpleStrategy&apos;, &apos;replication_factor&apos;: 1};
cqlsh&amp;gt; USE test;
cqlsh:test&amp;gt; create table foo (k int primary key, v list&amp;lt;int&amp;gt;);
cqlsh:test&amp;gt; insert into foo(k,v) values (1, [1,2]);
cqlsh:test&amp;gt; update foo set v = v - [1] where k = 1;
cqlsh:test&amp;gt; update foo set v = v - [1] where k = 1;
cqlsh:test&amp;gt; update foo set v = v - [2] where k = 1;
cqlsh:test&amp;gt; update foo set v = v - [2] where k = 1;
cqlsh:test&amp;gt; 
cqlsh:test&amp;gt; select * from foo;

 k | v
---+------
 1 | null

(1 rows)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
</comment>
                            <comment id="14503165" author="jjirsa" created="Mon, 20 Apr 2015 16:48:23 +0000"  >&lt;p&gt;Updated patch, allows idempotent deletes and corrects unit tests. &lt;/p&gt;</comment>
                            <comment id="14504573" author="blerer" created="Tue, 21 Apr 2015 08:18:34 +0000"  >&lt;p&gt;My remarks on the patch:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;I still prefer the previous error messages. &lt;tt&gt;&quot;List index 0 out of bound, list has size 0&quot;&lt;/tt&gt; will not makes a lot of sense if the user as never created any list. The fact that C* has no empty list can be confusing. In my opinion, we should be carefull about the error messages and not make people believe that you can have some empty list.&lt;/li&gt;
	&lt;li&gt;It would be nice if you could add some similar unit tests for sets and maps.&lt;/li&gt;
	&lt;li&gt;The standard in C* is to use ternarys operator when you have a a simple &lt;tt&gt;if return else return&lt;/tt&gt; (even if I am not a fan of it). Nested ternary operators should be avoided.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Side remark: It makes full sense that you provide a patch for that issue as you already worked on &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-9077&quot; title=&quot;Deleting an element from a List which is null throws a NPE&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-9077&quot;&gt;&lt;del&gt;CASSANDRA-9077&lt;/del&gt;&lt;/a&gt;. Just make sure, that if the ticket is assigned to somebody else, you checked with the person before that he is fine with you providing a patch (which I am &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/wink.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;). We never know the person might have started working on it or be really interested in fixing the ticket.&lt;/p&gt;</comment>
                            <comment id="14504581" author="blerer" created="Tue, 21 Apr 2015 08:23:19 +0000"  >&lt;p&gt;Could you also make sure that your patch apply to trunk? &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-7304&quot; title=&quot;Ability to distinguish between NULL and UNSET values in Prepared Statements&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-7304&quot;&gt;&lt;del&gt;CASSANDRA-7304&lt;/del&gt;&lt;/a&gt; had some impact in the same area.&lt;/p&gt;</comment>
                            <comment id="14504616" author="slebresne" created="Tue, 21 Apr 2015 08:42:08 +0000"  >&lt;blockquote&gt;&lt;p&gt;Could you also make sure that your patch apply to trunk?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Just so we agree, we should push this to 2.1 (and for the record, if only a patch for 2.1 is provided, I&apos;m fine dealing with merge conflict on trunk so you don&apos;t really have to bother providing patches for both 2.1 and trunk).&lt;/p&gt;</comment>
                            <comment id="14505622" author="jjirsa" created="Tue, 21 Apr 2015 19:58:15 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=blerer&quot; class=&quot;user-hover&quot; rel=&quot;blerer&quot;&gt;blerer&lt;/a&gt; - sincere apologies, I originally meant to just link to the patch from 9077, then figured &quot;why not at least make tests pass&quot; for your convenience. Didn&apos;t mean to step on toes.&lt;/p&gt;

&lt;p&gt;Attaching two diffs, one for trunk and a second for 2.1. &lt;/p&gt;

&lt;p&gt;I adjusted the set/delete logic to give the same messaging as in 9077, and cleaned up the ugly if/else return in favor of a ternary.  &lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;cqlsh&amp;gt; create keyspace IF NOT EXISTS test WITH replication = {&apos;class&apos;: &apos;SimpleStrategy&apos;, &apos;replication_factor&apos;: 1};
cqlsh&amp;gt; USE test;
cqlsh:test&amp;gt; create table foo (k int primary key, v list&amp;lt;int&amp;gt;);
cqlsh:test&amp;gt; insert into foo(k,v) values (1, [1,2]);
cqlsh:test&amp;gt; update foo set v = v - [1] where k = 1;
cqlsh:test&amp;gt; update foo set v = v - [1] where k = 1;
cqlsh:test&amp;gt; update foo set v = v - [2] where k = 1;
cqlsh:test&amp;gt; update foo set v = v - [2] where k = 1;
cqlsh:test&amp;gt; 
cqlsh:test&amp;gt; update foo set v[0] = 2 where k=1;
InvalidRequest: code=2200 [Invalid query] message=&quot;Attempted to set an element on a list which is null&quot;
cqlsh:test&amp;gt; delete v[0] from foo where k=1;
InvalidRequest: code=2200 [Invalid query] message=&quot;Attempted to delete an element from a list which is null&quot;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

</comment>
                            <comment id="14506640" author="blerer" created="Wed, 22 Apr 2015 08:28:33 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jjirsa&quot; class=&quot;user-hover&quot; rel=&quot;jjirsa&quot;&gt;jjirsa&lt;/a&gt; No harm done &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;+1&lt;br/&gt;
Thanks for the patch&lt;/p&gt;</comment>
                            <comment id="14506644" author="blerer" created="Wed, 22 Apr 2015 08:30:27 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=slebresne&quot; class=&quot;user-hover&quot; rel=&quot;slebresne&quot;&gt;slebresne&lt;/a&gt; could you commit?&lt;/p&gt;</comment>
                            <comment id="14506658" author="slebresne" created="Wed, 22 Apr 2015 08:45:44 +0000"  >&lt;p&gt;Committed, thanks&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12726978" name="9198-v2-2.1.txt" size="4649" author="jjirsa" created="Tue, 21 Apr 2015 19:58:32 +0000"/>
                            <attachment id="12726979" name="9198-v2-trunk.txt" size="4673" author="jjirsa" created="Tue, 21 Apr 2015 19:58:32 +0000"/>
                            <attachment id="12726600" name="9198.txt" size="2101" author="jjirsa" created="Mon, 20 Apr 2015 16:48:23 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[jjirsa]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 30 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2db73:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12311421" key="com.atlassian.jira.plugin.system.customfieldtypes:multiversion">
                        <customfieldname>Reproduced In</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="12329381">2.1.4</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>blerer</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[blerer]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12961"><![CDATA[Low]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>