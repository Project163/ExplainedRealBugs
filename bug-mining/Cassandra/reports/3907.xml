<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 22:58:58 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-10572] SinglePartitionNamesCommand::canRemoveRow omits counter cells it shouldn&apos;t</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-10572</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;Like with collections, we can never be sure we&apos;ve exhausted all the sstables when reducing the filter. The sstables can contain legacy local shards that need to be summed up. Unless we look into the content of the cells &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/help_16.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;, or until we get rid of the pre-2.1 values, we must include all the sstables in the read (so long as clusterings overlap).&lt;/p&gt;

&lt;p&gt;This was not an issue with 2.1/2.2 as we&apos;ve forced &lt;tt&gt;collectAllData&lt;/tt&gt; always on that path, but now we don&apos;t, and &lt;tt&gt;SinglePartitionNamesCommand&lt;/tt&gt; should handle the case.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12907158">CASSANDRA-10572</key>
            <summary>SinglePartitionNamesCommand::canRemoveRow omits counter cells it shouldn&apos;t</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10002" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Normal</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="slebresne">Sylvain Lebresne</assignee>
                                    <reporter username="aleksey">Aleksey Yeschenko</reporter>
                        <labels>
                    </labels>
                <created>Thu, 22 Oct 2015 17:51:17 +0000</created>
                <updated>Tue, 16 Apr 2019 09:30:52 +0000</updated>
                            <resolved>Mon, 2 Nov 2015 14:27:07 +0000</resolved>
                                        <fixVersion>3.0.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="14973983" author="slebresne" created="Mon, 26 Oct 2015 10:19:42 +0000"  >&lt;p&gt;I&apos;ve pushed a patch &lt;a href=&quot;https://github.com/pcmanus/cassandra/commits/10572&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;here&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;A very trivial fix for this would be to exclude counters like we exclude collections in &lt;tt&gt;SinglePartitionNamesCommand::canRemoveRow&lt;/tt&gt;. However, the reality is that it&apos;s particularly judicious to use the timestamp-ordered path for either of those (collections or counters), since we&apos;d be guaranteed to read all sstable anyway and so reading sstable sequentially (materializing everything in memory) is not the best strategy. So the best strategy is probably to have counters and collections use the non timestamp ordered path. Doing so however kind of obviate the reason for splitting &lt;tt&gt;SinglePartitionReadCommand&lt;/tt&gt; in 2 subclass (names and slice comands), so the patch remove that. Basically, it pulls the 2 possible path (timestamp-orderer and all-sstables-simultaneously) in &lt;tt&gt;SinglePartitionReadCommand&lt;/tt&gt; and pick the timestamp-ordered one only for names query without either counters or collections. As such, the patch is bigger that one would expect, but that&apos;s mostly because it moves some code around and update the code accordingly.&lt;/p&gt;</comment>
                            <comment id="14982714" author="iamaleksey" created="Fri, 30 Oct 2015 15:41:59 +0000"  >&lt;p&gt;Looks pretty straightforward/mechanical.&lt;/p&gt;

&lt;p&gt;1. &lt;tt&gt;canRemoveRow&lt;/tt&gt; does not need this check anymore:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (column.type.isCollection())
    &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;2. I&apos;m very much not a fan of the names of the two methods (before and now). We still pretty much query the sstables in timestamp order in both cases - if only for the partition tombstone optimisation. We can just short-circuit it for &lt;tt&gt;ClusteringIndexNamesFilter&lt;/tt&gt; and &lt;tt&gt;queryNeitherCountersNorCollections()&lt;/tt&gt; in certain conditions.&lt;/p&gt;

&lt;p&gt;Otherwise +1 so long as tests are passing.&lt;/p&gt;</comment>
                            <comment id="14982727" author="slebresne" created="Fri, 30 Oct 2015 15:46:30 +0000"  >&lt;blockquote&gt;&lt;p&gt;We can just short-circuit it for &lt;tt&gt;ClusteringIndexNamesFilter&lt;/tt&gt; and &lt;tt&gt;queryNeitherCountersNorCollections()&lt;/tt&gt; in certain conditions.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I don&apos;t think I understand what your suggestion is (though I doubt I&apos;ll be a fan of a method named &lt;tt&gt;queryNeitherCountersNorCollections&lt;/tt&gt;).&lt;/p&gt;</comment>
                            <comment id="14982749" author="iamaleksey" created="Fri, 30 Oct 2015 15:54:18 +0000"  >&lt;p&gt;I&apos;ll think about it. But neither is &lt;tt&gt;queryMemtableAndAllSSTables&lt;/tt&gt; correct - as we don&apos;t query them all if we can stop early b/c of a partition tombstone, nor is &lt;tt&gt;queryMemtableAndSSTablesInTimestampOrder&lt;/tt&gt; distinguishing enough, as we query in timestamp order in both cases.&lt;/p&gt;</comment>
                            <comment id="14985281" author="slebresne" created="Mon, 2 Nov 2015 14:27:07 +0000"  >&lt;p&gt;Committed (CI is consistent with the cassandra-3.0 branch modulo a few known flapping test in the mix) since we can always bikeshed later on the naming.&lt;/p&gt;

&lt;p&gt;I did moved the &apos;collectAll&apos; code inside the &lt;tt&gt;queryMemtableAndDiskInternal&lt;/tt&gt; (since that&apos;s the more generic path, the one that would always work) with an initial &lt;tt&gt;if&lt;/tt&gt; that branches off to &lt;tt&gt;queryMemtableAndSSTablesInTimestampOrder&lt;/tt&gt; when appropriate. That remove the &quot;all sstable&quot; complain.  Regarding the &quot;timestamp ordering&quot; naming, I don&apos;t really agree: we don&apos;t really &lt;em&gt;query&lt;/em&gt; in timestamp order in the &apos;collectAll&apos; path, we just iterate over the partition tombstone in timestamp order, but the real query work is done with all sstable simultaneously. So, we can bikeshed later as said earlier, but for what its worth I don&apos;t personally think &quot;timestamp ordered&quot; is a bad characterization.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[slebresne]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 3 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2ne67:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>aleksey</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[aleksey]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12962"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>