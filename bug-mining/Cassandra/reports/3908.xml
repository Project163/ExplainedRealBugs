<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 22:58:58 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-10571] ClusteringIndexNamesFilter::shouldInclude is not implemented, SinglePartitionNamesCommand not discarding the sstables it could</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-10571</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;Now that we use &lt;tt&gt;SinglePartitionNamesCommand&lt;/tt&gt; in more places - where we&apos;d previously use what is now &lt;tt&gt;SinglePartitionSliceCommand&lt;/tt&gt; - not being able to skip sstables with non-overlapping clusterings is actually a performance regression.&lt;/p&gt;

&lt;p&gt;&lt;tt&gt;SinglePartitionNamesCommand::queryMemtableAndDiskInternal&lt;/tt&gt; should prune sstables based on &lt;tt&gt;ClusteringIndexNamesFilter::shouldInclude&lt;/tt&gt; output, and the latter must be replaced with an actual implementation instead of a &lt;tt&gt;TODO&lt;/tt&gt;.&lt;/p&gt;

&lt;p&gt;This is also a potentially a big regression in performance for counter writes (say, with DTCS), since before 3.0, the read-before-write code would use &lt;tt&gt;collectAllData&lt;/tt&gt;, and that &lt;b&gt;was&lt;/b&gt; pruning sstable with non-overlapping clusterings.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12907149">CASSANDRA-10571</key>
            <summary>ClusteringIndexNamesFilter::shouldInclude is not implemented, SinglePartitionNamesCommand not discarding the sstables it could</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10002" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Normal</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="slebresne">Sylvain Lebresne</assignee>
                                    <reporter username="aleksey">Aleksey Yeschenko</reporter>
                        <labels>
                    </labels>
                <created>Thu, 22 Oct 2015 17:38:02 +0000</created>
                <updated>Tue, 16 Apr 2019 09:30:52 +0000</updated>
                            <resolved>Fri, 6 Nov 2015 10:55:36 +0000</resolved>
                                        <fixVersion>3.0.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="14976473" author="slebresne" created="Tue, 27 Oct 2015 14:28:56 +0000"  >&lt;p&gt;I&apos;ll note that the patch from &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-10572&quot; title=&quot;SinglePartitionNamesCommand::canRemoveRow omits counter cells it shouldn&amp;#39;t&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-10572&quot;&gt;&lt;del&gt;CASSANDRA-10572&lt;/del&gt;&lt;/a&gt; moves counters read to the &quot;collect all data&quot; path which does use &lt;tt&gt;shouldInclude&lt;/tt&gt;, making this not a regression for counters anymore. For that reason, I&apos;d personally have a small preference for pushing this to 3.2 (there is enough scary changes going on last minute before 3.0 GA as is). But anyway, a fix for this is &lt;a href=&quot;https://github.com/pcmanus/cassandra/commits/10571&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;here&lt;/a&gt; (the patch is rebased on top of the one from &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-10572&quot; title=&quot;SinglePartitionNamesCommand::canRemoveRow omits counter cells it shouldn&amp;#39;t&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-10572&quot;&gt;&lt;del&gt;CASSANDRA-10572&lt;/del&gt;&lt;/a&gt;).&lt;/p&gt;</comment>
                            <comment id="14982363" author="iamaleksey" created="Fri, 30 Oct 2015 10:59:43 +0000"  >&lt;p&gt;This is not just a regression for counters - this would have a pretty harsh effect on DTCS users on reads, assuming they request specific columns. Would much rather see it go into 3.0.0.&lt;/p&gt;</comment>
                            <comment id="14982379" author="slebresne" created="Fri, 30 Oct 2015 11:14:16 +0000"  >&lt;p&gt;The patch is available, so if it&apos;s reviewed in time, no objections for 3.0.0.&lt;/p&gt;</comment>
                            <comment id="14982423" author="iamaleksey" created="Fri, 30 Oct 2015 11:24:25 +0000"  >&lt;blockquote&gt;&lt;p&gt;The patch is available, so if it&apos;s reviewed in time, no objections for 3.0.0.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Sure. Will review before tomorrow.&lt;/p&gt;</comment>
                            <comment id="14983185" author="iamaleksey" created="Fri, 30 Oct 2015 19:55:11 +0000"  >&lt;p&gt;+1&lt;/p&gt;</comment>
                            <comment id="14985291" author="slebresne" created="Mon, 2 Nov 2015 14:36:11 +0000"  >&lt;p&gt;Committed, thanks.&lt;/p&gt;</comment>
                            <comment id="14986917" author="slebresne" created="Tue, 3 Nov 2015 08:36:13 +0000"  >&lt;p&gt;I&apos;ve reverted the patch as it breaks a lot of dtests. This is my bad for not running them properly before commit so mea culpa. I&apos;ll look it up.&lt;/p&gt;</comment>
                            <comment id="14989320" author="slebresne" created="Wed, 4 Nov 2015 10:51:26 +0000"  >&lt;p&gt;The problem was that we should not exclude sstables if they query static columns as those are not accounted by the sstable min/max clustering values. I&apos;ve pushed an addition patch to &lt;a href=&quot;https://github.com/pcmanus/cassandra/commits/10571&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;my branch&lt;/a&gt; for that and test now looks roughly on par with the cassandra-3.0 branch: &lt;a href=&quot;http://cassci.datastax.com/job/pcmanus-10571-testall/2/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;utest&lt;/a&gt; and &lt;a href=&quot;http://cassci.datastax.com/job/pcmanus-10571-dtest/1/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;dtests&lt;/a&gt;. There is a bit of jitter so I&apos;ve rebased the branch as of this morning and restarted the tests to make sure, but the additional commit is ready to review.&lt;/p&gt;</comment>
                            <comment id="14991880" author="iamaleksey" created="Thu, 5 Nov 2015 16:05:49 +0000"  >&lt;p&gt;+1&lt;/p&gt;</comment>
                            <comment id="14993505" author="slebresne" created="Fri, 6 Nov 2015 10:55:36 +0000"  >&lt;p&gt;It&apos;s hard to get stable dtests run these days but from the different runs I did on this branch, this doesn&apos;t seem to break anything new so committed.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[slebresne]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 2 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2ne47:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>aleksey</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[aleksey]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12962"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>