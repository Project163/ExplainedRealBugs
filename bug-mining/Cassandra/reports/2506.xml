<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 22:41:48 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-6413] Saved KeyCache prints success to log; but no file present</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-6413</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;Cluster has a single keyspace with 3 CFs.  All used to have ROWS_ONLY, two were switched to KEYS_ONLY about 2 days ago.  Row cache continues to save fine, but there is no saved key cache file present on any node in the cluster.&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;6925: INFO [CompactionExecutor:12] 2013-11-27 10:12:02,284 AutoSavingCache.java (line 289) Saved RowCache (50000 items) in 118 ms
6941:DEBUG [CompactionExecutor:14] 2013-11-27 10:17:02,163 AutoSavingCache.java (line 233) Deleting old RowCache files.
6942: INFO [CompactionExecutor:14] 2013-11-27 10:17:02,310 AutoSavingCache.java (line 289) Saved RowCache (50000 items) in 146 ms
8745:DEBUG [CompactionExecutor:6] 2013-11-27 10:37:25,140 AutoSavingCache.java (line 233) Deleting old RowCache files.
8746: INFO [CompactionExecutor:6] 2013-11-27 10:37:25,283 AutoSavingCache.java (line 289) Saved RowCache (50000 items) in 143 ms
8747:DEBUG [CompactionExecutor:6] 2013-11-27 10:37:25,283 AutoSavingCache.java (line 233) Deleting old KeyCache files.
8748: INFO [CompactionExecutor:6] 2013-11-27 10:37:25,625 AutoSavingCache.java (line 289) Saved KeyCache (21181 items) in 342 ms
8749:DEBUG [CompactionExecutor:6] 2013-11-27 10:37:25,625 AutoSavingCache.java (line 233) Deleting old RowCache files.
8750: INFO [CompactionExecutor:6] 2013-11-27 10:37:25,759 AutoSavingCache.java (line 289) Saved RowCache (50000 items) in 134 ms
8751:DEBUG [CompactionExecutor:6] 2013-11-27 10:37:25,759 AutoSavingCache.java (line 233) Deleting old RowCache files.
8752: INFO [CompactionExecutor:6] 2013-11-27 10:37:25,893 AutoSavingCache.java (line 289) Saved RowCache (50000 items) in 133 ms
8753:DEBUG [CompactionExecutor:6] 2013-11-27 10:37:25,893 AutoSavingCache.java (line 233) Deleting old RowCache files.
8754: INFO [CompactionExecutor:6] 2013-11-27 10:37:26,026 AutoSavingCache.java (line 289) Saved RowCache (50000 items) in 133 ms
9915:DEBUG [CompactionExecutor:18] 2013-11-27 10:42:01,851 AutoSavingCache.java (line 233) Deleting old KeyCache files.
9916: INFO [CompactionExecutor:18] 2013-11-27 10:42:02,185 AutoSavingCache.java (line 289) Saved KeyCache (22067 items) in 334 ms
9917:DEBUG [CompactionExecutor:17] 2013-11-27 10:42:02,279 AutoSavingCache.java (line 233) Deleting old RowCache files.
9918: INFO [CompactionExecutor:17] 2013-11-27 10:42:02,411 AutoSavingCache.java (line 289) Saved RowCache (50000 items) in 131 ms
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;$ ll ~/shared/saved_caches/
total 3472
-rw-rw-r-- 1 cassandra cassandra 3551608 Nov 27 10:42 Foo-Bar-RowCache-b.db

&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment>&lt;p&gt;1.2.11&lt;/p&gt;</environment>
        <key id="12681604">CASSANDRA-6413</key>
            <summary>Saved KeyCache prints success to log; but no file present</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10003" iconUrl="https://issues.apache.org/jira/images/icons/priorities/trivial.svg">Low</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="mishail">Mikhail Stepura</assignee>
                                    <reporter username="cburroughs">Chris Burroughs</reporter>
                        <labels>
                    </labels>
                <created>Wed, 27 Nov 2013 15:53:37 +0000</created>
                <updated>Tue, 16 Apr 2019 09:31:59 +0000</updated>
                            <resolved>Thu, 5 Dec 2013 15:44:39 +0000</resolved>
                                        <fixVersion>1.2.13</fixVersion>
                    <fixVersion>2.0.4</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="13834144" author="mishail" created="Wed, 27 Nov 2013 21:05:48 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=cburroughs&quot; class=&quot;user-hover&quot; rel=&quot;cburroughs&quot;&gt;cburroughs&lt;/a&gt; what&apos;s your &lt;tt&gt;key_cache_size_in_mb&lt;/tt&gt; in &lt;em&gt;cassandra.yaml&lt;/em&gt; ?&lt;/p&gt;</comment>
                            <comment id="13834150" author="cburroughs" created="Wed, 27 Nov 2013 21:10:00 +0000"  >&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;key_cache_size_in_mb: 48
key_cache_save_period: 900

# Number of keys from the key cache to save
# Disabled by default, meaning all keys are going to be saved
# key_cache_keys_to_save: 100
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="13834555" author="mishail" created="Thu, 28 Nov 2013 07:15:04 +0000"  >&lt;p&gt;That&apos;s weird. Does the directory contain only that single file? Are there any suspicious messages in the logs?&lt;/p&gt;</comment>
                            <comment id="13836663" author="cburroughs" created="Mon, 2 Dec 2013 16:33:08 +0000"  >&lt;ul&gt;
	&lt;li&gt;Yes, on every node in the cluster `saved_caches_directory` contains only a single file.&lt;/li&gt;
	&lt;li&gt;I don&apos;t see anything else relevant in the logs.  The log clip in the ticket is with AutoSavingCache set to DEBUG logging.&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13838642" author="mishail" created="Wed, 4 Dec 2013 06:01:37 +0000"  >&lt;p&gt;Silly me &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; The bug is so obvious, but only manifests itself if both Key cache AND row cache are enabled&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-style: solid;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeHeader panelHeader&quot; style=&quot;border-bottom-width: 1px;border-bottom-style: solid;&quot;&gt;&lt;b&gt;org.apache.cassandra.cache.AutoSavingCache.java&lt;/b&gt;&lt;/div&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;        &lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; void deleteOldCacheFiles()
        {
            File savedCachesDir = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; File(DatabaseDescriptor.getSavedCachesLocation());

            &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (savedCachesDir.exists() &amp;amp;&amp;amp; savedCachesDir.isDirectory())
            {
                &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; (File file : savedCachesDir.listFiles())
                {
                    &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (file.isFile() &amp;amp;&amp;amp; file.getName().endsWith(cacheType.toString()))
                    {
                        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (!file.delete())
                            logger.warn(&lt;span class=&quot;code-quote&quot;&gt;&quot;Failed to delete {}&quot;&lt;/span&gt;, file.getAbsolutePath());
                    }

                    &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (file.isFile() &amp;amp;&amp;amp; file.getName().endsWith(CURRENT_VERSION + &lt;span class=&quot;code-quote&quot;&gt;&quot;.db&quot;&lt;/span&gt;))
                    {
                        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (!file.delete())
                            logger.warn(&lt;span class=&quot;code-quote&quot;&gt;&quot;Failed to delete {}&quot;&lt;/span&gt;, file.getAbsolutePath());
                    }
                }
            }
        }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;So, each cache deletes FILES FROM ALL CACHES from the &lt;tt&gt;saved_caches&lt;/tt&gt; and then happily writes its files.&lt;br/&gt;
The last save wins, &lt;/p&gt;</comment>
                            <comment id="13838665" author="mishail" created="Wed, 4 Dec 2013 06:42:06 +0000"  >&lt;p&gt;Patch: each cache should delete only its own files&lt;/p&gt;</comment>
                            <comment id="13838670" author="mishail" created="Wed, 4 Dec 2013 06:53:08 +0000"  >&lt;p&gt;Looks like it was introduced in &lt;a href=&quot;https://github.com/apache/cassandra/commit/cfe585c2c420c6e8445eb4c3309b09db8cf134ac&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/cassandra/commit/cfe585c2c420c6e8445eb4c3309b09db8cf134ac&lt;/a&gt; for &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-3762&quot; title=&quot;AutoSaving KeyCache and System load time improvements.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-3762&quot;&gt;&lt;del&gt;CASSANDRA-3762&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13839413" author="jbellis" created="Wed, 4 Dec 2013 22:31:59 +0000"  >&lt;p&gt;Hmm...  Maybe the 3762 line was supposed to be&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (file.isFile() &amp;amp;&amp;amp; !file.getName().endsWith(CURRENT_VERSION + &lt;span class=&quot;code-quote&quot;&gt;&quot;.db&quot;&lt;/span&gt;))
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;to clean out obsolete cache files?&lt;/p&gt;</comment>
                            <comment id="13839479" author="mishail" created="Wed, 4 Dec 2013 23:29:04 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jbellis&quot; class=&quot;user-hover&quot; rel=&quot;jbellis&quot;&gt;jbellis&lt;/a&gt;&lt;br/&gt;
In that case the obsolete files  would be never deleted. Their filenames end with &quot;&amp;lt;cacheType&amp;gt;-CURRENT_VERSION.db&quot;, so they would fall through those two conditions.&lt;/p&gt;</comment>
                            <comment id="13839498" author="jbellis" created="Wed, 4 Dec 2013 23:55:28 +0000"  >&lt;p&gt;v2 attached to clean out both old- and new- format files of the correct type.&lt;/p&gt;</comment>
                            <comment id="13839517" author="mishail" created="Thu, 5 Dec 2013 00:03:53 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jbellis&quot; class=&quot;user-hover&quot; rel=&quot;jbellis&quot;&gt;jbellis&lt;/a&gt;&lt;br/&gt;
Do you think there will be problems with the simple &lt;tt&gt;contains(cacheType.toString())&lt;/tt&gt; approach?&lt;/p&gt;</comment>
                            <comment id="13839840" author="jbellis" created="Thu, 5 Dec 2013 05:43:04 +0000"  >&lt;p&gt;Wouldn&apos;t that match CF or KS names or even other parts of the path?&lt;/p&gt;</comment>
                            <comment id="13839849" author="mishail" created="Thu, 5 Dec 2013 06:03:18 +0000"  >&lt;p&gt;That will match for sure. But what are chances?&lt;br/&gt;
Nevertheless, I&apos;m ok with your patch.&lt;/p&gt;</comment>
                            <comment id="13840106" author="cburroughs" created="Thu, 5 Dec 2013 14:27:15 +0000"  >&lt;p&gt;Jira&apos;s priority guide thingy for minor says &quot;easy workaround is present&quot;.  Is there a way to get both caches to persist before upgrading with the fix?&lt;/p&gt;</comment>
                            <comment id="13840186" author="jbellis" created="Thu, 5 Dec 2013 15:41:19 +0000"  >&lt;p&gt;No.  &quot;Minor&quot; also means &quot;doesn&apos;t seriously affect cluster stability or ability to respond to client requests.&quot;&lt;/p&gt;</comment>
                            <comment id="13840190" author="jbellis" created="Thu, 5 Dec 2013 15:44:39 +0000"  >&lt;p&gt;committed v2&lt;/p&gt;</comment>
                            <comment id="13846264" author="cburroughs" created="Thu, 12 Dec 2013 12:08:58 +0000"  >&lt;p&gt;As a followup note, this bug appears to have prevented any of the system-* KeyCaches from being saved.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12617081" name="6413-v2.txt" size="1879" author="jbellis" created="Wed, 4 Dec 2013 23:55:28 +0000"/>
                            <attachment id="12616946" name="CASSANDRA-1.2-6413.patch" size="1457" author="mishail" created="Wed, 4 Dec 2013 06:42:06 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[mishail]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>360868</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            11 years, 49 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1q7hj:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>361167</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12311421" key="com.atlassian.jira.plugin.system.customfieldtypes:multiversion">
                        <customfieldname>Reproduced In</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="12325272">1.2.12</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>jbellis</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[jbellis]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12961"><![CDATA[Low]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>