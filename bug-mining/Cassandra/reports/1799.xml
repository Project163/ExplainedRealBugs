<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 22:35:19 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-833] fix consistencylevel during bootstrap</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-833</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;As originally designed, bootstrap nodes should &lt;b&gt;always&lt;/b&gt; get &lt;b&gt;all&lt;/b&gt; writes under any consistencylevel, so when bootstrap finishes the operator can run cleanup on the old nodes w/o fear that he might lose data.&lt;/p&gt;

&lt;p&gt;but if a bootstrap operation fails or is aborted, that means all writes will fail until the ex-bootstrapping node is decommissioned.  so starting in &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-722&quot; title=&quot;batch insert failing with TokenMetadata AssertionError&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-722&quot;&gt;&lt;del&gt;CASSANDRA-722&lt;/del&gt;&lt;/a&gt;, we just ignore dead nodes in consistencylevel calculations.&lt;/p&gt;

&lt;p&gt;but this breaks the original design.  &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-822&quot; title=&quot;A natural endpoint should be responsible for hints&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-822&quot;&gt;&lt;del&gt;CASSANDRA-822&lt;/del&gt;&lt;/a&gt; adds a partial fix for this (just adding bootstrap targets into the RF targets and hinting normally), but this is still broken under certain conditions.  The real fix is to consider consistencylevel for two sets of nodes:&lt;/p&gt;

&lt;p&gt;  1. the RF targets as currently existing (no pending ranges)&lt;br/&gt;
  2.  the RF targets as they will exist after all movement ops are done&lt;/p&gt;

&lt;p&gt;If we satisfy CL for both sets then we will always be in good shape.&lt;/p&gt;

&lt;p&gt;I&apos;m not sure if we can easily calculate 2. from the current TokenMetadata, though.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12457318">CASSANDRA-833</key>
            <summary>fix consistencylevel during bootstrap</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10002" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Normal</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="jbellis">Jonathan Ellis</assignee>
                                    <reporter username="jbellis">Jonathan Ellis</reporter>
                        <labels>
                    </labels>
                <created>Wed, 24 Feb 2010 17:44:50 +0000</created>
                <updated>Tue, 16 Apr 2019 09:33:27 +0000</updated>
                            <resolved>Fri, 21 Sep 2012 15:13:10 +0000</resolved>
                                        <fixVersion>1.2.0 beta 2</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="12840438" author="jbellis" created="Wed, 3 Mar 2010 03:09:49 +0000"  >&lt;p&gt;To clarify: the #722 fix breaks the design because a bootstrapping node that goes &quot;down&quot; temporarily but completes bootstrap will not actually have all the writes that happened during bootstrap on it.&lt;/p&gt;</comment>
                            <comment id="12841870" author="jaakko" created="Fri, 5 Mar 2010 14:10:05 +0000"  >&lt;p&gt;This issue is not only related to bootstrapping, since nodes leaving the ring will also cause pending ranges. If a node does not complete leaving operation properly, obsolete pending ranges will be left in metadata.&lt;/p&gt;

&lt;p&gt;(2) above is actually almost exactly how pending ranges is calculated. All current move operations are finished and pending ranges is calculated according to what are the new natural endpoints for the ranges in question.&lt;/p&gt;

&lt;p&gt;This is not directly related to bootstrapping IMHO, but to the fact that node movement increases quorum and due to node movement being uncertain, there is bigger possibility that something goes wrong and quorum nodes cannot be reached.&lt;/p&gt;</comment>
                            <comment id="13028232" author="jbellis" created="Tue, 3 May 2011 13:56:10 +0000"  >&lt;p&gt;Consider the case of CL=1, RF=3 to replicas A, B, C. We begin bootstrapping node D, and write a row K to the range being moved from C to D.&lt;/p&gt;

&lt;p&gt;If the cluster is heavily loaded, it&apos;s possible that we write one copy to C, all the other writes get dropped, and once bootstrap completes we lose the row. Or if we write one copy to D, and cancel bootstrap, we again lose the row.&lt;/p&gt;

&lt;p&gt;As said above, we want to satisfy CL for both the pre- and post-bootstrap nodes (in case bootstrap aborts).  This requires treating the old/new range owner as a unit: both D &lt;b&gt;and&lt;/b&gt; C need to accept the write for it to count towards CL. So rather than considering &lt;/p&gt;
{A, B, C, D}
&lt;p&gt; we should consider &lt;/p&gt;
{A, B, (C, D)}
&lt;p&gt;.&lt;/p&gt;

&lt;p&gt;This is a lot of complexity to introduce. A simplification that preserves correctness is to continue treating nodes independently but require &lt;b&gt;one more node&lt;/b&gt; than normal CL. So CL=1 would actually require 2 nodes; CL=Q would require 3 (for RF=3), and so forth.  (Note that Q(3) + 1 is the same as Q(4), which is what the existing code computes; that is one reason I chose a CL=1 example to start with, since those are &lt;b&gt;not&lt;/b&gt; the same even for the simple case of RF=3.)&lt;/p&gt;

&lt;p&gt;This would mean we may fail a few writes unnecessarily (a write to A or B is actually sufficient to satisfy CL=1, but this scheme would time that out) but never allow a write to succeed that would leave CL unsatisfied post-bootstrap (or if bootstrap is cancelled).&lt;/p&gt;</comment>
                            <comment id="13030041" author="slebresne" created="Fri, 6 May 2011 17:23:52 +0000"  >&lt;p&gt;Attaching patch that implements the &quot;simplification&quot; idea. The case of &lt;/p&gt;
{LOCAL|EACH}
&lt;p&gt;_QUORUM requires some care but I think that by considering DC separately we are fine.&lt;/p&gt;</comment>
                            <comment id="13035058" author="jbellis" created="Tue, 17 May 2011 21:21:36 +0000"  >&lt;p&gt;v2 tweaks getWriteEndpoints to avoid new Collection creation where possible, instead using Iterables.concat.&lt;/p&gt;

&lt;p&gt;otherwise lgtm.&lt;/p&gt;</comment>
                            <comment id="13046017" author="slebresne" created="Wed, 8 Jun 2011 15:37:50 +0000"  >&lt;p&gt;+1&lt;/p&gt;</comment>
                            <comment id="13046022" author="jbellis" created="Wed, 8 Jun 2011 15:46:08 +0000"  >&lt;p&gt;committed&lt;/p&gt;</comment>
                            <comment id="13046315" author="hudson" created="Thu, 9 Jun 2011 02:50:14 +0000"  >&lt;p&gt;Integrated in Cassandra-0.8 #158 (See &lt;a href=&quot;https://builds.apache.org/job/Cassandra-0.8/158/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/Cassandra-0.8/158/&lt;/a&gt;)&lt;br/&gt;
    fix inconsistency window duringbootstrap&lt;br/&gt;
patch by slebresne; reviewed by jbellis for &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-833&quot; title=&quot;fix consistencylevel during bootstrap&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-833&quot;&gt;&lt;del&gt;CASSANDRA-833&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;jbellis : &lt;a href=&quot;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1133443&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1133443&lt;/a&gt;&lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/cassandra/branches/cassandra-0.8/CHANGES.txt&lt;/li&gt;
	&lt;li&gt;/cassandra/branches/cassandra-0.8/src/java/org/apache/cassandra/service/DatacenterSyncWriteResponseHandler.java&lt;/li&gt;
	&lt;li&gt;/cassandra/branches/cassandra-0.8/test/unit/org/apache/cassandra/locator/SimpleStrategyTest.java&lt;/li&gt;
	&lt;li&gt;/cassandra/branches/cassandra-0.8/src/java/org/apache/cassandra/service/StorageProxy.java&lt;/li&gt;
	&lt;li&gt;/cassandra/branches/cassandra-0.8/test/unit/org/apache/cassandra/service/LeaveAndBootstrapTest.java&lt;/li&gt;
	&lt;li&gt;/cassandra/branches/cassandra-0.8/test/unit/org/apache/cassandra/service/MoveTest.java&lt;/li&gt;
	&lt;li&gt;/cassandra/branches/cassandra-0.8/src/java/org/apache/cassandra/locator/AbstractReplicationStrategy.java&lt;/li&gt;
	&lt;li&gt;/cassandra/branches/cassandra-0.8/src/java/org/apache/cassandra/service/AbstractWriteResponseHandler.java&lt;/li&gt;
	&lt;li&gt;/cassandra/branches/cassandra-0.8/test/unit/org/apache/cassandra/service/ConsistencyLevelTest.java&lt;/li&gt;
	&lt;li&gt;/cassandra/branches/cassandra-0.8/src/java/org/apache/cassandra/service/WriteResponseHandler.java&lt;/li&gt;
	&lt;li&gt;/cassandra/branches/cassandra-0.8/src/java/org/apache/cassandra/service/DatacenterWriteResponseHandler.java&lt;/li&gt;
	&lt;li&gt;/cassandra/branches/cassandra-0.8/src/java/org/apache/cassandra/locator/TokenMetadata.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13459780" author="jbellis" created="Thu, 20 Sep 2012 17:40:34 +0000"  >&lt;p&gt;Well, WTF.&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;commit 063c8f6cf7b12e976b0d7067037c52c548c6c0db
Author: Jonathan Ellis &amp;lt;jbellis@apache.org&amp;gt;
Date:   Thu Jun 9 00:16:27 2011 +0000

    revert 1133443
    
    git-svn-id: https://svn.apache.org/repos/asf/cassandra/branches/cassandra-0.8@1133610 13f79535-47bb-0310-9956-ffa450edef68

commit 31f0ee95e927c09183dca77be7739305ba2eeab0
Author: Jonathan Ellis &amp;lt;jbellis@apache.org&amp;gt;
Date:   Wed Jun 8 15:45:54 2011 +0000

    fix inconsistency window duringbootstrap
    patch by slebresne; reviewed by jbellis for CASSANDRA-833
    
    git-svn-id: https://svn.apache.org/repos/asf/cassandra/branches/cassandra-0.8@1133443 13f79535-47bb-0310-9956-ffa450edef68
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I have no memory of this. &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;Maybe it caused a regression?&lt;/p&gt;</comment>
                            <comment id="13460112" author="jbellis" created="Fri, 21 Sep 2012 01:11:20 +0000"  >&lt;p&gt;Pushed rebase to &lt;a href=&quot;https://github.com/jbellis/cassandra/branches/833-3&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/jbellis/cassandra/branches/833-3&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13460114" author="jbellis" created="Fri, 21 Sep 2012 01:21:06 +0000"  >&lt;p&gt;(Not exactly a pure rebase since I split out pendingRangesFor instead of cramming everything into getWriteEndpoints.)&lt;/p&gt;</comment>
                            <comment id="13460355" author="slebresne" created="Fri, 21 Sep 2012 08:39:11 +0000"  >&lt;p&gt;In counterWriteTask, sendToHintedEndpoints should be called with remotes, not targets.&lt;/p&gt;

&lt;p&gt;But other than that it lgtm. I don&apos;t remember either why it was reverted and I don&apos;t remember any specific problem with that. But in any case, you reverted it almost right away, so if that wasn&apos;t accidental the regression was likely easy to spot, so we&apos;ll see soon enough &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;.&lt;/p&gt;</comment>
                            <comment id="13460547" author="jbellis" created="Fri, 21 Sep 2012 15:13:10 +0000"  >&lt;p&gt;committed w/ that fix&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12478450" name="0001-Increase-CL-with-boostrapping-leaving-node.patch" size="37354" author="slebresne" created="Fri, 6 May 2011 17:23:52 +0000"/>
                            <attachment id="12479519" name="833-v2.txt" size="35303" author="jbellis" created="Tue, 17 May 2011 21:21:36 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[jbellis]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>19884</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            13 years, 9 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0g1cv:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>91650</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>slebresne</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[slebresne]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12962"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>