<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 23:17:18 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-16155] ByteBufferAccessor cast exceptions are thrown when trying to query a virtual table</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-16155</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;Start a fresh trunk node, and try to run&lt;/p&gt;

&lt;p&gt;SELECT * FROM system_views.local_read_latency ;&lt;/p&gt;

&lt;p&gt;You&#8217;ll get:&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
ERROR [Native-Transport-Requests-1] 2020-09-30 09:44:45,099 ErrorMessage.java:457 - Unexpected exception during request
 java.lang.ClassCastException: org.apache.cassandra.db.marshal.ByteBufferAccessor cannot be &lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt; to java.lang.&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;
 &#160; &#160; &#160; &#160; at org.apache.cassandra.serializers.AbstractTextSerializer.serialize(AbstractTextSerializer.java:29)
 &#160; &#160; &#160; &#160; at org.apache.cassandra.db.marshal.AbstractType.decompose(AbstractType.java:131) &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;&lt;/p&gt;</description>
                <environment></environment>
        <key id="13330385">CASSANDRA-16155</key>
            <summary>ByteBufferAccessor cast exceptions are thrown when trying to query a virtual table</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10002" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Normal</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="ifesdjeen">Alex Petrov</assignee>
                                    <reporter username="ifesdjeen">Alex Petrov</reporter>
                        <labels>
                    </labels>
                <created>Thu, 1 Oct 2020 14:26:09 +0000</created>
                <updated>Sun, 3 Jan 2021 17:02:37 +0000</updated>
                            <resolved>Mon, 12 Oct 2020 08:20:54 +0000</resolved>
                                        <fixVersion>4.0-beta3</fixVersion>
                    <fixVersion>4.0</fixVersion>
                                    <component>Feature/Virtual Tables</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="17206125" author="ifesdjeen" created="Fri, 2 Oct 2020 11:43:36 +0000"  >&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/apache/cassandra/pull/764&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;patch&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://app.circleci.com/pipelines/github/ifesdjeen&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;ci&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;
</comment>
                            <comment id="17207090" author="maedhroz" created="Sun, 4 Oct 2020 04:40:07 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ifesdjeen&quot; class=&quot;user-hover&quot; rel=&quot;ifesdjeen&quot;&gt;ifesdjeen&lt;/a&gt; As you probably know by now, I mistakenly duplicated this in &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-16178&quot; title=&quot;ByteBufferAccessor throws ClassCastException when trying to query system_views.local_read_latency&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-16178&quot;&gt;&lt;del&gt;CASSANDRA-16178&lt;/del&gt;&lt;/a&gt;. In any case, we made the same exact fix (outside some cosmetic changes). If you&apos;d like to incorporate it, I did add a more isolated test for &lt;tt&gt;SimpleDataSet&lt;/tt&gt; &lt;a href=&quot;https://github.com/apache/cassandra/pull/766/files#diff-3040722d64285d97ebc45109bf21aac1R38&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;here&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;Otherwise, +1&lt;/p&gt;</comment>
                            <comment id="17208021" author="ifesdjeen" created="Mon, 5 Oct 2020 11:38:12 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=maedhroz&quot; class=&quot;user-hover&quot; rel=&quot;maedhroz&quot;&gt;maedhroz&lt;/a&gt; thank you for the review. I&apos;ve incorporated your changes, and added you as a co-author, since indeed our patches, down to tests, are identical. Force-pushed the branch.&lt;/p&gt;</comment>
                            <comment id="17208096" author="clohfink" created="Mon, 5 Oct 2020 14:05:12 +0000"  >&lt;p&gt;+1&lt;/p&gt;</comment>
                            <comment id="17208232" author="dcapwell" created="Mon, 5 Oct 2020 18:10:52 +0000"  >&lt;p&gt;I left this feedback in Caleb&apos;s version of the patch; can we add a test for the vtable that broke?  We didn&apos;t have coverage for that/those table(s) so would be best to add coverage as well.&lt;/p&gt;</comment>
                            <comment id="17210685" author="ifesdjeen" created="Fri, 9 Oct 2020 07:42:11 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=dcapwell&quot; class=&quot;user-hover&quot; rel=&quot;dcapwell&quot;&gt;dcapwell&lt;/a&gt; there is a test &lt;a href=&quot;https://github.com/apache/cassandra/pull/764/files#diff-3c0c566b23d7afa27bac87b84858399eR234-R250&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;here&lt;/a&gt;, which is equivalent to Caleb&apos;s test &lt;a href=&quot;https://github.com/apache/cassandra/pull/766/files#diff-3040722d64285d97ebc45109bf21aac1R38&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;here&lt;/a&gt;. Both tests exercise the same code path, and latter uses a lower-level API.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=maedhroz&quot; class=&quot;user-hover&quot; rel=&quot;maedhroz&quot;&gt;maedhroz&lt;/a&gt; do you have any objections to committing a test that&apos;s similar to the rest of &lt;tt&gt;VirtualTableTest&lt;/tt&gt; tests?&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=dcapwell&quot; class=&quot;user-hover&quot; rel=&quot;dcapwell&quot;&gt;dcapwell&lt;/a&gt; you&apos;ve also mentioned in review comment &quot;for me: the issue was that the method didn&apos;t take it, but takes Object...&quot;, what do you think can be an alternative here? Unfortunately we do not have a more specific type to prevent something similar happening in the future.&lt;/p&gt;</comment>
                            <comment id="17211089" author="maedhroz" created="Fri, 9 Oct 2020 15:31:21 +0000"  >&lt;blockquote&gt;&lt;p&gt;do you have any objections to committing a test that&apos;s similar to the rest of VirtualTableTest tests?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ifesdjeen&quot; class=&quot;user-hover&quot; rel=&quot;ifesdjeen&quot;&gt;ifesdjeen&lt;/a&gt; That&apos;s fine w/ me. (The idea behind my &lt;tt&gt;SimpleDataSetTest&lt;/tt&gt; being so isolated is that it should cover all current and &lt;em&gt;future&lt;/em&gt; usages of that path in &lt;tt&gt;SimpleDataSet&lt;/tt&gt;.)&lt;/p&gt;</comment>
                            <comment id="17211227" author="dcapwell" created="Fri, 9 Oct 2020 17:46:07 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ifesdjeen&quot; class=&quot;user-hover&quot; rel=&quot;ifesdjeen&quot;&gt;ifesdjeen&lt;/a&gt; this is for test table test_virtual_ks.vt3, was hoping we could have a test for the table that actually broke which triggered this.  The comment was more that a public table failed and we didn&apos;t have test coverage to detect it, so would be good to have a basic test that makes sure it mostly works.  I am 100% fine with the test you have, more asking for an additional one.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;David Capwell you&apos;ve also mentioned in review comment &quot;for me: the issue was that the method didn&apos;t take it, but takes Object...&quot;, what do you think can be an alternative here? Unfortunately we do not have a more specific type to prevent something similar happening in the future.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;When it comes to Object... that gets tricky as it traps everything... not sure how we could prevent this from happening with that signature...  The best hack I can think of is a static analyzer tool (custom to us) that checks these things, nothing else is coming to mind.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;David Capwell you&apos;ve also mentioned in review comment &quot;for me:&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Since reviews can go back-and-forth over multiple days, I tend to leave &quot;for me&quot; comments to remind me later of stuff I knew while reviewing as I will likely forget this the next time I need to look at it; these comments can mostly be ignored as they are just review documentation.&lt;/p&gt;</comment>
                            <comment id="17212218" author="ifesdjeen" created="Mon, 12 Oct 2020 08:15:15 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=dcapwell&quot; class=&quot;user-hover&quot; rel=&quot;dcapwell&quot;&gt;dcapwell&lt;/a&gt; thank you for elaborating! There is a test that uses this table in &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-15935&quot; title=&quot;Improve machinery for testing consistency in presence of range movements&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-15935&quot;&gt;&lt;del&gt;CASSANDRA-15935&lt;/del&gt;&lt;/a&gt; and we can add more test coverage for this (and other) virtual tables if needed.&lt;/p&gt;

&lt;p&gt;Committed to trunk as &lt;a href=&quot;https://github.com/apache/cassandra/commit/896baf64159463d9dd72a8829eec8311f8a888da&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;896baf64159463d9dd72a8829eec8311f8a888da&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="17212600" author="dcapwell" created="Mon, 12 Oct 2020 18:50:43 +0000"  >&lt;p&gt;Works for me, thanks =)&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10032">
                    <name>Blocker</name>
                                            <outwardlinks description="blocks">
                                        <issuelink>
            <issuekey id="13316170">CASSANDRA-15935</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                                                <inwardlinks description="is duplicated by">
                                        <issuelink>
            <issuekey id="13330636">CASSANDRA-16178</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[ifesdjeen]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12313825" key="com.atlassian.jira.plugin.system.customfieldtypes:cascadingselect">
                        <customfieldname>Bug Category</customfieldname>
                        <customfieldvalues>
                                                    <customfieldvalue key="12983" cascade-level=""><![CDATA[Availability]]></customfieldvalue>
                                <customfieldvalue key="12991" cascade-level="1"><![CDATA[Response Crash]]></customfieldvalue>
            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12313821" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Complexity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12965"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313822" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Discovered By</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12969"><![CDATA[User Report]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12313922" key="jira.plugin.projectspecificselectfield.jpssf:multicftype">
                        <customfieldname>Impacts</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="13100"><![CDATA[None]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            5 years, 5 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12313921" key="jira.plugin.projectspecificselectfield.jpssf:multicftype">
                        <customfieldname>Platform</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="13076"><![CDATA[All]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0j32o:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[maedhroz]]></customfieldvalue>
        <customfieldvalue><![CDATA[clohfink]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12963"><![CDATA[Critical]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12311420" key="com.atlassian.jira.plugin.system.customfieldtypes:version">
                        <customfieldname>Since Version</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="12348609">4.0-beta2</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313924" key="com.atlassian.jira.plugin.system.customfieldtypes:textfield">
                        <customfieldname>Source Control Link</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>&lt;p&gt;&lt;a href=&quot;https://github.com/apache/cassandra/commit/896baf64159463d9dd72a8829eec8311f8a888da&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/cassandra/commit/896baf64159463d9dd72a8829eec8311f8a888da&lt;/a&gt;&lt;/p&gt;</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313823" key="com.atlassian.jira.plugin.system.customfieldtypes:textarea">
                        <customfieldname>Test and Documentation Plan</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>&lt;p&gt;Tests included&lt;/p&gt;</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>