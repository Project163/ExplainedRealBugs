<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 22:45:39 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-7234] Post-compaction cache preheating can result in FileNotFoundExceptions when tables are dropped</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-7234</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;In CompactionTask.java, after a compaction finishes, we do this:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;        replaceCompactedSSTables(toCompact, sstables);
        &lt;span class=&quot;code-comment&quot;&gt;// TODO: &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; doesn&apos;t belong here, it should be part of the reader to load when the tracker is wired up
&lt;/span&gt;        &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; (SSTableReader sstable : sstables)
            sstable.preheat(cachedKeyMap.get(sstable.descriptor));
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The problem is that if the table was dropped, &lt;tt&gt;replaceCompactedSSTables&lt;/tt&gt; will release its references on the new &lt;tt&gt;sstables&lt;/tt&gt;, resulting in them being closed.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12714284">CASSANDRA-7234</key>
            <summary>Post-compaction cache preheating can result in FileNotFoundExceptions when tables are dropped</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10003" iconUrl="https://issues.apache.org/jira/images/icons/priorities/trivial.svg">Low</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="marcuse">Marcus Eriksson</assignee>
                                    <reporter username="thobbs">Tom Hobbs</reporter>
                        <labels>
                            <label>compaction</label>
                    </labels>
                <created>Wed, 14 May 2014 20:35:32 +0000</created>
                <updated>Tue, 16 Apr 2019 09:31:45 +0000</updated>
                            <resolved>Thu, 12 Jun 2014 01:15:04 +0000</resolved>
                                        <fixVersion>2.0.9</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="14021925" author="krummas" created="Mon, 9 Jun 2014 11:20:55 +0000"  >&lt;p&gt;Attaching patch to acquire reference before populating key cache&lt;/p&gt;

&lt;p&gt;Though, I couldn&apos;t really reproduce this, could you elaborate when this happens? - If we drop a CF, we always interrupt the ongoing compactions.&lt;/p&gt;</comment>
                            <comment id="14027163" author="thobbs" created="Tue, 10 Jun 2014 22:44:42 +0000"  >&lt;blockquote&gt;&lt;p&gt;I couldn&apos;t really reproduce this, could you elaborate when this happens? - If we drop a CF, we always interrupt the ongoing compactions.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;The timing has to be just right.  It only checks to see if the compaction has been interrupted before writing each row.  If the drop happens after the final row is written but before &lt;tt&gt;replaceCompactedSSTables()&lt;/tt&gt; is run (basically, the &lt;tt&gt;finally&lt;/tt&gt; block), you&apos;ll see this problem.  I saw it occasionally while trying to reproduce &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-6525&quot; title=&quot;Cannot select data which using &amp;quot;WHERE&amp;quot;&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-6525&quot;&gt;&lt;del&gt;CASSANDRA-6525&lt;/del&gt;&lt;/a&gt;, where a lot of compactions were backed up when the table was dropped.&lt;/p&gt;

&lt;p&gt;+1 on the patch, though.&lt;/p&gt;</comment>
                            <comment id="14028683" author="krummas" created="Thu, 12 Jun 2014 01:15:04 +0000"  >&lt;p&gt;committed to 2.0, we seem to be good in 2.1 with the SSTableRewriter changes&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12648976" name="0001-reference-sstable-before-populating-keycache.patch" size="1562" author="marcuse" created="Mon, 9 Jun 2014 11:21:15 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[marcuse]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>392597</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            11 years, 23 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1vlyf:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>392780</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>thobbs</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[thobbs]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12961"><![CDATA[Low]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>