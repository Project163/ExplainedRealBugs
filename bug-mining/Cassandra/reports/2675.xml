<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 22:43:32 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-6848] stress (2.1) spams console with java.util.NoSuchElementException when run against nodes recently created</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-6848</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;I don&apos;t get any stack trace on the console, but I get two java.util.NoSuchElementException for each operation stress is doing.&lt;/p&gt;

&lt;p&gt;This seems to occur when stress is being run against a recently created node (such as one from ccm).&lt;/p&gt;

&lt;p&gt;To reproduce: create a ccm cluster, and run stress against it within a few minutes . Run a simple stress command like cassandra-stress write n=10 .&lt;/p&gt;</description>
                <environment></environment>
        <key id="12701120">CASSANDRA-6848</key>
            <summary>stress (2.1) spams console with java.util.NoSuchElementException when run against nodes recently created</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10002" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Normal</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="benedict">Benedict Elliott Smith</assignee>
                                    <reporter username="rhatch">Russ Hatch</reporter>
                        <labels>
                    </labels>
                <created>Wed, 12 Mar 2014 22:28:41 +0000</created>
                <updated>Tue, 16 Apr 2019 09:31:51 +0000</updated>
                            <resolved>Fri, 14 Mar 2014 00:52:52 +0000</resolved>
                                        <fixVersion>2.1 beta2</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="13932561" author="rhatch" created="Wed, 12 Mar 2014 22:34:45 +0000"  >&lt;p&gt;I should also mention that stress does still report statistics to the console, they are just buried in the error output. It would be helpful to know if the errors are impacting the performance stats or if they can safely be ignored.&lt;/p&gt;</comment>
                            <comment id="13932572" author="jbellis" created="Wed, 12 Mar 2014 22:44:03 +0000"  >&lt;p&gt;FTR I&apos;m fine with saying &quot;2.1 stress requires 2.1 server&quot; but it should fail more gracefully than that.&lt;/p&gt;</comment>
                            <comment id="13932586" author="brandon.williams" created="Wed, 12 Mar 2014 22:53:04 +0000"  >&lt;blockquote&gt;&lt;p&gt;I&apos;m fine with saying &quot;2.1 stress requires 2.1 server&quot;&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I&apos;m fine with that too if it comes to it, but when you&apos;re regularly using it against multiple branches with a real cluster, it&apos;s kind of nice to just have one build that works against all of them, which is how it&apos;s been in the past.  So if possible, I&apos;d like to retain that behavior.&lt;/p&gt;</comment>
                            <comment id="13932648" author="benedict" created="Wed, 12 Mar 2014 23:28:30 +0000"  >&lt;p&gt;A quick update: Russ can only reproduce on one cluster, and I cannot reproduce locally, so going to introduce &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-6849&quot; title=&quot;Add verbose logging to cassandra-stress&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-6849&quot;&gt;&lt;del&gt;CASSANDRA-6849&lt;/del&gt;&lt;/a&gt; as it seems the easiest way to track it down, and it&apos;s likely to be helpful in future anyway.&lt;/p&gt;

&lt;p&gt;No need to worry about backwards compatibility. I&apos;ve used it on 2.0 plenty, it definitely &lt;em&gt;can&lt;/em&gt; work. We&apos;ll figure out why it isn&apos;t here.&lt;/p&gt;</comment>
                            <comment id="13932657" author="benedict" created="Wed, 12 Mar 2014 23:37:52 +0000"  >&lt;p&gt;On a hunch, tried &quot;-mode thrift&quot; (i.e. with smart routing disabled) on the vague idea that it might be grabbing the topology/endpoint data before the cluster is ready to deliver it fully (or that maybe 2.0 can&apos;t). It fixes the problem.&lt;/p&gt;

&lt;p&gt;So not sure exactly the cause, but it&apos;s probably not a major issue. If it&apos;s a race on cluster startup, it&apos;s probably not a big deal, but if it&apos;s an inherent limitation with 2.0 we should probably detect that and let the user know. Either way, should fail out more gracefully whatever the case.&lt;/p&gt;</comment>
                            <comment id="13932765" author="rhatch" created="Thu, 13 Mar 2014 01:38:50 +0000"  >&lt;p&gt;on second thought this doesn&apos;t seem to be purely timing as I suggested in the description above. I let my nodes wait for 10 minutes before sending stress commands and still got the flood of NoSuchElementException&apos;s. This is the command that triggered the problem after a 10 minute wait:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;&apos;cassandra-stress counterwrite n=5000000 CL=ONE -key populate=1..10000 -col n=FIXED\(1\) -schema replication\(factor=3\) -rate threads=50&apos;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="13933113" author="benedict" created="Thu, 13 Mar 2014 11:06:44 +0000"  >&lt;p&gt;Can you reproduce this consistently? Does this only occur on the remote cluster, or also when you run locally with ccm?&lt;/p&gt;</comment>
                            <comment id="13933802" author="rhatch" created="Thu, 13 Mar 2014 18:18:16 +0000"  >&lt;p&gt;happens every time on my austin test cluster (stress-2.1 targeting various versions)&lt;/p&gt;

&lt;p&gt;happens more sporadically locally, but once it happens for a given cluster it seems to happen every time.&lt;/p&gt;

&lt;p&gt;I&apos;m getting it to reproduce today with stress from 2.1, and a ccm cluster built from 2.1. Happens using the stress counterwrite command I mentioned two comments above this one.&lt;/p&gt;</comment>
                            <comment id="13933804" author="rhatch" created="Thu, 13 Mar 2014 18:20:52 +0000"  >&lt;p&gt;To add 2 cents to the discussion above, it will be a great help if we can expect stress-2.1 to work against 2.0 clusters so we can make meaningful comparisons between these versions (otherwise it&apos;s going to be apples to oranges).&lt;/p&gt;

&lt;p&gt;But I&apos;m getting this to happen with stress-2.1 targeting a 2.1 cluster as well, so I think version may have nothing to do with it (or maybe two different problems are manifesting as the exceptions output to the console).&lt;/p&gt;</comment>
                            <comment id="13933890" author="rhatch" created="Thu, 13 Mar 2014 18:56:50 +0000"  >&lt;p&gt;I was able to isolate this a little bit more. Looks like if the first stress command I run is the &apos;counterwrite&apos; above, then the cluster is no good for running stress after that (for even just a simple write n=10). Seems like there&apos;s some state being preserved by stress or the cluster since the outcome of a previous command is having an impact on subsequent runs.&lt;/p&gt;

&lt;p&gt;However, if I run a simple write test first (write n=10), then follow with my counterwrite test the problem seems to go away.&lt;/p&gt;</comment>
                            <comment id="13933900" author="benedict" created="Thu, 13 Mar 2014 19:04:11 +0000"  >&lt;p&gt;Weird. Stress retains no state. Can you try running stress from the branch I uploaded for &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-6849&quot; title=&quot;Add verbose logging to cassandra-stress&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-6849&quot;&gt;&lt;del&gt;CASSANDRA-6849&lt;/del&gt;&lt;/a&gt;, and passing &quot;-log level=verbose&quot; ?&lt;/p&gt;</comment>
                            <comment id="13933944" author="rhatch" created="Thu, 13 Mar 2014 19:42:22 +0000"  >&lt;p&gt;here&apos;s the exception printed from your branch with verbose logging:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;java.util.NoSuchElementException
	at com.google.common.collect.AbstractIndexedListIterator.next(AbstractIndexedListIterator.java:82)
	at org.apache.cassandra.stress.util.SmartThriftClient.get(SmartThriftClient.java:117)
	at org.apache.cassandra.stress.util.SmartThriftClient.batch_mutate(SmartThriftClient.java:137)
	at org.apache.cassandra.stress.operations.ThriftCounterAdder$1.run(ThriftCounterAdder.java:77)
	at org.apache.cassandra.stress.Operation.timeWithRetry(Operation.java:251)
	at org.apache.cassandra.stress.operations.ThriftCounterAdder.run(ThriftCounterAdder.java:72)
	at org.apache.cassandra.stress.StressAction$Consumer.run(StressAction.java:304)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="13933965" author="benedict" created="Thu, 13 Mar 2014 20:00:15 +0000"  >&lt;p&gt;&lt;a href=&quot;https://github.com/belliottsmith/cassandra/tree/iss-6848&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;Patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Was a bug when round-robining for smart routing, which is why disabling smart routing works. Not sure why it would &lt;em&gt;ever&lt;/em&gt; work for a RF3 cluster though. Basically, hadn&apos;t been run against RF&amp;gt;1 before I don&apos;t think.&lt;/p&gt;</comment>
                            <comment id="13933971" author="benedict" created="Thu, 13 Mar 2014 20:05:58 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=xedin&quot; class=&quot;user-hover&quot; rel=&quot;xedin&quot;&gt;xedin&lt;/a&gt; this tree includes all of the minor stress modifications made recently. The last two mostly just a few lines, so if you&apos;re reviewing &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-6824&quot; title=&quot;fix help text for stress counterwrite&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-6824&quot;&gt;&lt;del&gt;CASSANDRA-6824&lt;/del&gt;&lt;/a&gt;, might as well just look here.&lt;/p&gt;</comment>
                            <comment id="13934350" author="xedin" created="Fri, 14 Mar 2014 00:28:28 +0000"  >&lt;p&gt;Looks like I&apos;m having a stress review day today, so I took a look at this and &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-6849&quot; title=&quot;Add verbose logging to cassandra-stress&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-6849&quot;&gt;&lt;del&gt;CASSANDRA-6849&lt;/del&gt;&lt;/a&gt; and both look fine so if &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rhatch&quot; class=&quot;user-hover&quot; rel=&quot;rhatch&quot;&gt;rhatch&lt;/a&gt; gives a green light on this and I can commit both - this fix + 6849.&lt;/p&gt;</comment>
                            <comment id="13934354" author="rhatch" created="Fri, 14 Mar 2014 00:32:36 +0000"  >&lt;p&gt;I was able to run my performance tests today with &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=benedict&quot; class=&quot;user-hover&quot; rel=&quot;benedict&quot;&gt;benedict&lt;/a&gt;&apos;s branch iss-6848 and the issue was gone.&lt;/p&gt;</comment>
                            <comment id="13934361" author="benedict" created="Fri, 14 Mar 2014 00:38:51 +0000"  >&lt;p&gt;Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=xedin&quot; class=&quot;user-hover&quot; rel=&quot;xedin&quot;&gt;xedin&lt;/a&gt;!&lt;/p&gt;</comment>
                            <comment id="13934374" author="xedin" created="Fri, 14 Mar 2014 00:52:52 +0000"  >&lt;p&gt;Committed.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[benedict]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>379466</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            11 years, 36 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1tdun:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>379757</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>xedin</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[xedin]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12962"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>