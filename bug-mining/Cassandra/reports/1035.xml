<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 22:22:11 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-2949] Batch mutation of counters in multiple supercolumns throws an exception during replication.</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-2949</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;Steps to reproduce:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;Perform a batch mutation of more than one counter in more than one super-column in the same column-family.&lt;/li&gt;
	&lt;li&gt;The following exception is thrown during replication:&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;MutationStage:63&amp;#93;&lt;/span&gt; 2011-07-26 17:05:12,653 CounterMutationVerbHandler.java (line 52) Applying forwarded CounterMutation(RowMutation(keyspace=&apos;ks1&apos;, key=&apos;4ae71336e44bf9bf&apos;, modifications=[ColumnFamily(cf1 [SuperColumn(302c7375706572636f6c30 &lt;span class=&quot;error&quot;&gt;&amp;#91;302c636f6c30:false:8@1311696312648,&amp;#93;&lt;/span&gt;),SuperColumn(302c7375706572636f6c31 &lt;span class=&quot;error&quot;&gt;&amp;#91;302c636f6c30:false:8@1311696312648,&amp;#93;&lt;/span&gt;),])]), QUORUM)&lt;br/&gt;
DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;MutationStage:63&amp;#93;&lt;/span&gt; 2011-07-26 17:05:12,653 StorageProxy.java (line 432) insert writing local &amp;amp; replicate CounterMutation(RowMutation(keyspace=&apos;ks1&apos;, key=&apos;4ae71336e44bf9bf&apos;, modifications=&lt;span class=&quot;error&quot;&gt;&amp;#91;cf1&amp;#93;&lt;/span&gt;), QUORUM)&lt;br/&gt;
DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;MutationStage:63&amp;#93;&lt;/span&gt; 2011-07-26 17:05:12,654 Table.java (line 398) applying mutation of row 4ae71336e44bf9bf&lt;br/&gt;
ERROR &lt;span class=&quot;error&quot;&gt;&amp;#91;ReplicateOnWriteStage:125&amp;#93;&lt;/span&gt; 2011-07-26 17:05:12,655 AbstractCassandraDaemon.java (line 139) Fatal exception in thread Thread&lt;span class=&quot;error&quot;&gt;&amp;#91;ReplicateOnWriteStage:125,5,main&amp;#93;&lt;/span&gt;&lt;br/&gt;
java.lang.RuntimeException: java.lang.IllegalArgumentException: ColumnFamily ColumnFamily(cf1 [SuperColumn(302c7375706572636f6c31 [302c636f6c30:false:[&lt;/p&gt;
{cad93dc0-b7a0-11e0-0000-123f813dd5df, 3, 3}*]@1311696312648!-9223372036854775808,]),]) already has modifications in this mutation: ColumnFamily(cf1 [SuperColumn(302c7375706572636f6c30 [302c636f6c30:false:[{cad93dc0-b7a0-11e0-0000-123f813dd5df, 3, 3}
&lt;p&gt;*]@1311696312648!-9223372036854775808,]),])&lt;br/&gt;
        at org.apache.cassandra.utils.WrappedRunnable.run(WrappedRunnable.java:34)&lt;br/&gt;
        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1110)&lt;br/&gt;
        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:603)&lt;br/&gt;
        at java.lang.Thread.run(Thread.java:636)&lt;br/&gt;
Caused by: java.lang.IllegalArgumentException: ColumnFamily ColumnFamily(cf1 [SuperColumn(302c7375706572636f6c31 [302c636f6c30:false:[&lt;/p&gt;
{cad93dc0-b7a0-11e0-0000-123f813dd5df, 3, 3}*]@1311696312648!-9223372036854775808,]),]) already has modifications in this mutation: ColumnFamily(cf1 [SuperColumn(302c7375706572636f6c30 [302c636f6c30:false:[{cad93dc0-b7a0-11e0-0000-123f813dd5df, 3, 3}
&lt;p&gt;*]@1311696312648!-9223372036854775808,]),])&lt;br/&gt;
        at org.apache.cassandra.db.RowMutation.add(RowMutation.java:123)&lt;br/&gt;
        at org.apache.cassandra.db.CounterMutation.makeReplicationMutation(CounterMutation.java:120)&lt;br/&gt;
        at org.apache.cassandra.service.StorageProxy$5$1.runMayThrow(StorageProxy.java:455)&lt;br/&gt;
        at org.apache.cassandra.utils.WrappedRunnable.run(WrappedRunnable.java:30)&lt;br/&gt;
        ... 3 more&lt;/p&gt;</description>
                <environment></environment>
        <key id="12515424">CASSANDRA-2949</key>
            <summary>Batch mutation of counters in multiple supercolumns throws an exception during replication.</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10000" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Urgent</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="slebresne">Sylvain Lebresne</assignee>
                                    <reporter username="soverton">Sam Overton</reporter>
                        <labels>
                            <label>batch_mutate</label>
                            <label>counters</label>
                            <label>supercolumns</label>
                    </labels>
                <created>Tue, 26 Jul 2011 16:19:51 +0000</created>
                <updated>Tue, 16 Apr 2019 09:32:54 +0000</updated>
                            <resolved>Mon, 1 Aug 2011 15:13:19 +0000</resolved>
                                        <fixVersion>0.8.3</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                                                                <comments>
                            <comment id="13071197" author="soverton" created="Tue, 26 Jul 2011 16:21:49 +0000"  >&lt;p&gt;Attached patch which fixes this issue by adding an &quot;addAll&quot; method to RowMutation which allows the same CF to be explicitly added to a mutation more than once.&lt;/p&gt;</comment>
                            <comment id="13071644" author="slebresne" created="Wed, 27 Jul 2011 10:39:09 +0000"  >&lt;p&gt;The patch does fix it, but I think there is a better fix. The reason the assertion is triggered is because when we read to replicate and there is super columns, we end up adding one read command for each super column (and thus get back multiple time the same CF, which triggers the assertion). The rational being that we only query the subcolumns that are in the original mutation.&lt;/p&gt;

&lt;p&gt;However, since we deserialize full super columns anyway, it will be more efficient to generate only one read command for all the super columns (reading full super columns) and to filter afterwards the subcolumns we don&apos;t want to bother sending to the other nodes.&lt;/p&gt;

&lt;p&gt;Attaching a &quot;v2&quot; patch that does this. It also ship with a unit test.&lt;/p&gt;</comment>
                            <comment id="13071681" author="soverton" created="Wed, 27 Jul 2011 12:22:20 +0000"  >&lt;p&gt;Confirmed v2 patch fixes the issue and test passes.&lt;/p&gt;

&lt;p&gt;If it&apos;s likely that supercolumns may get indexes (&lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-598&quot; title=&quot;SuperColumns need to be indexed&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-598&quot;&gt;&lt;del&gt;CASSANDRA-598&lt;/del&gt;&lt;/a&gt;) or the serialization format changes to make direct sub-column access possible (&lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-674&quot; title=&quot;New SSTable Format&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-674&quot;&gt;&lt;del&gt;CASSANDRA-674&lt;/del&gt;&lt;/a&gt;) then this should probably be revisited to limit the scope of the read.&lt;/p&gt;</comment>
                            <comment id="13071789" author="slebresne" created="Wed, 27 Jul 2011 15:12:59 +0000"  >&lt;blockquote&gt;&lt;p&gt;If it&apos;s likely that supercolumns may get indexes (&lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-598&quot; title=&quot;SuperColumns need to be indexed&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-598&quot;&gt;&lt;del&gt;CASSANDRA-598&lt;/del&gt;&lt;/a&gt;) or the serialization format changes to make direct sub-column access possible (&lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-674&quot; title=&quot;New SSTable Format&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-674&quot;&gt;&lt;del&gt;CASSANDRA-674&lt;/del&gt;&lt;/a&gt;) then this should probably be revisited to limit the scope of the read.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Regarding super columns, the more likely move will be to replace them internally by columns with composite names, in which case this issue will be moot anyway.&lt;/p&gt;</comment>
                            <comment id="13073570" author="slebresne" created="Mon, 1 Aug 2011 15:13:19 +0000"  >&lt;p&gt;Committed, thanks&lt;/p&gt;</comment>
                            <comment id="13073575" author="hudson" created="Mon, 1 Aug 2011 15:22:36 +0000"  >&lt;p&gt;Integrated in Cassandra-0.8 #248 (See &lt;a href=&quot;https://builds.apache.org/job/Cassandra-0.8/248/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/Cassandra-0.8/248/&lt;/a&gt;)&lt;br/&gt;
    don&apos;t throw exception on batch of counter super columns&lt;br/&gt;
patch by slebresne; reviewed by soverton for &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-2949&quot; title=&quot;Batch mutation of counters in multiple supercolumns throws an exception during replication.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-2949&quot;&gt;&lt;del&gt;CASSANDRA-2949&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;slebresne : &lt;a href=&quot;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1152795&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1152795&lt;/a&gt;&lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/cassandra/branches/cassandra-0.8/src/java/org/apache/cassandra/db/RowMutation.java&lt;/li&gt;
	&lt;li&gt;/cassandra/branches/cassandra-0.8/src/java/org/apache/cassandra/db/SuperColumn.java&lt;/li&gt;
	&lt;li&gt;/cassandra/branches/cassandra-0.8/CHANGES.txt&lt;/li&gt;
	&lt;li&gt;/cassandra/branches/cassandra-0.8/src/java/org/apache/cassandra/db/ColumnFamily.java&lt;/li&gt;
	&lt;li&gt;/cassandra/branches/cassandra-0.8/test/unit/org/apache/cassandra/db/CounterMutationTest.java&lt;/li&gt;
	&lt;li&gt;/cassandra/branches/cassandra-0.8/src/java/org/apache/cassandra/db/CounterMutation.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                    </comments>
                    <attachments>
                            <attachment id="12487861" name="2949.patch" size="1289" author="soverton" created="Tue, 26 Jul 2011 16:21:49 +0000"/>
                            <attachment id="12487959" name="2949_v2.patch" size="10183" author="slebresne" created="Wed, 27 Jul 2011 10:39:09 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[slebresne]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>20906</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            14 years, 17 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0geg7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>93771</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>soverton</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[soverton]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12963"><![CDATA[Critical]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>