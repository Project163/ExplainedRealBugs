<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 23:27:26 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-17698] sstabledump errors when dumping data from index</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-17698</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
cqlsh&amp;gt; CREATE KEYSPACE ks1 WITH replication = {&lt;span class=&quot;code-quote&quot;&gt;&apos;class&apos;&lt;/span&gt;: &lt;span class=&quot;code-quote&quot;&gt;&apos;SimpleStrategy&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;replication_factor&apos;&lt;/span&gt;: 1};
cqlsh&amp;gt;&#160;CREATE TABLE ks1.tb1 ( id text, name text, primary key (id));
cqlsh&amp;gt;&#160;CREATE INDEX IF NOT EXISTS ON ks1.tb1(name);
cqlsh&amp;gt;&#160;INSERT INTO ks1.tb1 (id, name ) VALUES ( &lt;span class=&quot;code-quote&quot;&gt;&apos;1&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;Joe&apos;&lt;/span&gt;);
cqlsh&amp;gt;&#160;exit
./bin/nodetool flush
./tools/bin/sstabledump data/data/ks1/tb1-1c3c5f10ee4711ecab82eda2f44200b3/.tb1_name_idx/nb-1-big-Data.db&#160;
[
&#160; {
&#160; &#160; &lt;span class=&quot;code-quote&quot;&gt;&quot;partition&quot;&lt;/span&gt; : {
&#160; &#160; &#160; &lt;span class=&quot;code-quote&quot;&gt;&quot;key&quot;&lt;/span&gt; : [ &lt;span class=&quot;code-quote&quot;&gt;&quot;Joe&quot;&lt;/span&gt; ],
&#160; &#160; &#160; &lt;span class=&quot;code-quote&quot;&gt;&quot;position&quot;&lt;/span&gt; : 0
&#160; &#160; },
&#160; &#160; &lt;span class=&quot;code-quote&quot;&gt;&quot;rows&quot;&lt;/span&gt; : [
&#160; &#160; &#160; {
&#160; &#160; &#160; &#160; &lt;span class=&quot;code-quote&quot;&gt;&quot;type&quot;&lt;/span&gt; : &lt;span class=&quot;code-quote&quot;&gt;&quot;row&quot;&lt;/span&gt;,
&#160; &#160; &#160; &#160; &lt;span class=&quot;code-quote&quot;&gt;&quot;position&quot;&lt;/span&gt; : 17,
&#160; &#160; &#160; &#160; &lt;span class=&quot;code-quote&quot;&gt;&quot;clustering&quot;&lt;/span&gt; : [ ] } ] } ]Exception in thread &lt;span class=&quot;code-quote&quot;&gt;&quot;main&quot;&lt;/span&gt; java.lang.UnsupportedOperationException
&#160; &#160; &#160; &#160; at org.apache.cassandra.db.marshal.PartitionerDefinedOrder.toJSONString(PartitionerDefinedOrder.java:87)
&#160; &#160; &#160; &#160; at org.apache.cassandra.db.marshal.AbstractType.toJSONString(AbstractType.java:187)
&#160; &#160; &#160; &#160; at org.apache.cassandra.tools.JsonTransformer.serializeClustering(JsonTransformer.java:372)
&#160; &#160; &#160; &#160; at org.apache.cassandra.tools.JsonTransformer.serializeRow(JsonTransformer.java:269)
&#160; &#160; &#160; &#160; at org.apache.cassandra.tools.JsonTransformer.serializePartition(JsonTransformer.java:235)
&#160; &#160; &#160; &#160; at java.util.stream.ForEachOps$ForEachOp$OfRef.accept(ForEachOps.java:184)
&#160; &#160; &#160; &#160; at java.util.stream.ReferencePipeline$2$1.accept(ReferencePipeline.java:175)
&#160; &#160; &#160; &#160; at java.util.Iterator.forEachRemaining(Iterator.java:116)
&#160; &#160; &#160; &#160; at java.util.Spliterators$IteratorSpliterator.forEachRemaining(Spliterators.java:1801)
&#160; &#160; &#160; &#160; at java.util.stream.AbstractPipeline.copyInto(AbstractPipeline.java:482)
&#160; &#160; &#160; &#160; at java.util.stream.AbstractPipeline.wrapAndCopyInto(AbstractPipeline.java:472)
&#160; &#160; &#160; &#160; at java.util.stream.ForEachOps$ForEachOp.evaluateSequential(ForEachOps.java:151)
&#160; &#160; &#160; &#160; at java.util.stream.ForEachOps$ForEachOp$OfRef.evaluateSequential(ForEachOps.java:174)
&#160; &#160; &#160; &#160; at java.util.stream.AbstractPipeline.evaluate(AbstractPipeline.java:234)
&#160; &#160; &#160; &#160; at java.util.stream.ReferencePipeline.forEach(ReferencePipeline.java:418)
&#160; &#160; &#160; &#160; at org.apache.cassandra.tools.JsonTransformer.toJson(JsonTransformer.java:113)
&#160; &#160; &#160; &#160; at org.apache.cassandra.tools.SSTableExport.main(SSTableExport.java:214) &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="13450626">CASSANDRA-17698</key>
            <summary>sstabledump errors when dumping data from index</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10002" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Normal</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="maxwellguo">guo Maxwell</assignee>
                                    <reporter username="smiklosovic">Stefan Miklosovic</reporter>
                        <labels>
                    </labels>
                <created>Fri, 17 Jun 2022 14:14:38 +0000</created>
                <updated>Tue, 12 Sep 2023 13:03:02 +0000</updated>
                            <resolved>Mon, 19 Jun 2023 13:01:29 +0000</resolved>
                                        <fixVersion>5.0-alpha1</fixVersion>
                    <fixVersion>5.0</fixVersion>
                                    <component>Tool/sstable</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>7</watches>
                                                    <progress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                            <timeestimate seconds="0">0h</timeestimate>
                            <timespent seconds="47400">13h 10m</timespent>
                                <comments>
                            <comment id="17567273" author="adelapena" created="Fri, 15 Jul 2022 14:59:38 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=smiklosovic&quot; class=&quot;user-hover&quot; rel=&quot;smiklosovic&quot;&gt;smiklosovic&lt;/a&gt; what version/branch were you using, with what partitioner? I think that for the sstable format it should be 4.0 or greater. I haven&apos;t been able to reproduce this with the provided steps in none of the 4.0/4.1/trunk branches.&lt;/p&gt;</comment>
                            <comment id="17567894" author="smiklosovic" created="Mon, 18 Jul 2022 09:07:33 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=adelapena&quot; class=&quot;user-hover&quot; rel=&quot;adelapena&quot;&gt;adelapena&lt;/a&gt;, for me it is happening on trunk.&lt;/p&gt;

&lt;p&gt;I am starting Cassandra in IDEA, then in the console of IDEA I do&lt;/p&gt;

&lt;p&gt;$ bin/cqlsh + commands as shown in description&lt;br/&gt;
$ bin/nodetool flush&lt;br/&gt;
$ tools/bin/sstabledump path_to_index_sstable in data/data/....&lt;/p&gt;

&lt;p&gt;Partitioner is&#160;Murmur3Partitioner&lt;/p&gt;</comment>
                            <comment id="17567929" author="adelapena" created="Mon, 18 Jul 2022 11:00:08 +0000"  >&lt;p&gt;I still cannot reproduce it with current trunk. Are you seeing this consistently, or only occasionally?&lt;/p&gt;</comment>
                            <comment id="17567942" author="smiklosovic" created="Mon, 18 Jul 2022 11:33:34 +0000"  >&lt;p&gt;Yeah, consistently, I did ant realclean &amp;amp;&amp;amp; ant artifacts and stuff to be sure I am on trunk and I run trunk&apos;s jar and so on. Interesting, I ll think what might be the cause.&lt;/p&gt;

&lt;p&gt;&quot;env | grep CASSANDRA&quot; in that shell I am trying it in is empty.&lt;/p&gt;

&lt;p&gt;$ java -version&lt;br/&gt;
java version &quot;1.8.0_311&quot;&lt;br/&gt;
Java(TM) SE Runtime Environment (build 1.8.0_311-b11)&lt;br/&gt;
Java HotSpot(TM) 64-Bit Server VM (build 25.311-b11, mixed mode)&lt;/p&gt;</comment>
                            <comment id="17568018" author="brandon.williams" created="Mon, 18 Jul 2022 14:09:10 +0000"  >&lt;p&gt;This reproduces on trunk for me too:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
(venv) drift@focal1:~/cassandra$ bin/cqlsh
Connected to Test Cluster at 127.0.0.1:9042
[cqlsh 6.2.0 | Cassandra 4.2-SNAPSHOT | CQL spec 3.4.6 | Native protocol v5]
Use HELP &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; help.
cqlsh&amp;gt; CREATE KEYSPACE ks1 WITH replication = {&lt;span class=&quot;code-quote&quot;&gt;&apos;class&apos;&lt;/span&gt;: &lt;span class=&quot;code-quote&quot;&gt;&apos;SimpleStrategy&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;replication_factor&apos;&lt;/span&gt;: 1};
cqlsh&amp;gt; CREATE TABLE ks1.tb1 ( id text, name text, primary key (id));
cqlsh&amp;gt; CREATE INDEX IF NOT EXISTS ON ks1.tb1(name);
cqlsh&amp;gt; INSERT INTO ks1.tb1 (id, name ) VALUES ( &lt;span class=&quot;code-quote&quot;&gt;&apos;1&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;Joe&apos;&lt;/span&gt;);
cqlsh&amp;gt; 
(venv) drift@focal1:~/cassandra$ bin/nodetool flush
(venv) drift@focal1:~/cassandra$ ./tools/bin/sstabledump data/data/ks1/tb1-ed765fe006a211ed8214bd7cbb129cb6/.tb1_name_idx/nb-1-big-Data.db 
[
  {
    &lt;span class=&quot;code-quote&quot;&gt;&quot;partition&quot;&lt;/span&gt; : {
      &lt;span class=&quot;code-quote&quot;&gt;&quot;key&quot;&lt;/span&gt; : [ &lt;span class=&quot;code-quote&quot;&gt;&quot;Joe&quot;&lt;/span&gt; ],
      &lt;span class=&quot;code-quote&quot;&gt;&quot;position&quot;&lt;/span&gt; : 0
    },
    &lt;span class=&quot;code-quote&quot;&gt;&quot;rows&quot;&lt;/span&gt; : [
      {
        &lt;span class=&quot;code-quote&quot;&gt;&quot;type&quot;&lt;/span&gt; : &lt;span class=&quot;code-quote&quot;&gt;&quot;row&quot;&lt;/span&gt;,
        &lt;span class=&quot;code-quote&quot;&gt;&quot;position&quot;&lt;/span&gt; : 17,
        &lt;span class=&quot;code-quote&quot;&gt;&quot;clustering&quot;&lt;/span&gt; : [ ] } ] } ]Exception in thread &lt;span class=&quot;code-quote&quot;&gt;&quot;main&quot;&lt;/span&gt; java.lang.UnsupportedOperationException
        at org.apache.cassandra.db.marshal.PartitionerDefinedOrder.toJSONString(PartitionerDefinedOrder.java:91)
        at org.apache.cassandra.db.marshal.AbstractType.toJSONString(AbstractType.java:192)
        at org.apache.cassandra.tools.JsonTransformer.serializeClustering(JsonTransformer.java:372)
        at org.apache.cassandra.tools.JsonTransformer.serializeRow(JsonTransformer.java:269)
        at org.apache.cassandra.tools.JsonTransformer.serializePartition(JsonTransformer.java:235)
        at java.util.stream.ForEachOps$ForEachOp$OfRef.accept(ForEachOps.java:183)
        at java.util.stream.ReferencePipeline$2$1.accept(ReferencePipeline.java:175)
        at java.util.Iterator.forEachRemaining(Iterator.java:116)
        at java.util.Spliterators$IteratorSpliterator.forEachRemaining(Spliterators.java:1801)
        at java.util.stream.AbstractPipeline.copyInto(AbstractPipeline.java:482)
        at java.util.stream.AbstractPipeline.wrapAndCopyInto(AbstractPipeline.java:472)
        at java.util.stream.ForEachOps$ForEachOp.evaluateSequential(ForEachOps.java:150)
        at java.util.stream.ForEachOps$ForEachOp$OfRef.evaluateSequential(ForEachOps.java:173)
        at java.util.stream.AbstractPipeline.evaluate(AbstractPipeline.java:234)
        at java.util.stream.ReferencePipeline.forEach(ReferencePipeline.java:485)
        at org.apache.cassandra.tools.JsonTransformer.toJson(JsonTransformer.java:113)
        at org.apache.cassandra.tools.SSTableExport.main(SSTableExport.java:214)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="17575062" author="maxwellguo" created="Thu, 4 Aug 2022 06:48:33 +0000"  >&lt;p&gt;Just have this problem  for me now , vesion is :  trunk and 3.11.4, Assign this issue to me now .&lt;/p&gt;</comment>
                            <comment id="17616763" author="maxwellguo" created="Thu, 13 Oct 2022 03:53:46 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=smiklosovic&quot; class=&quot;user-hover&quot; rel=&quot;smiklosovic&quot;&gt;smiklosovic&lt;/a&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=brandon.williams&quot; class=&quot;user-hover&quot; rel=&quot;brandon.williams&quot;&gt;brandon.williams&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=adelapena&quot; class=&quot;user-hover&quot; rel=&quot;adelapena&quot;&gt;adelapena&lt;/a&gt;, I find the reason of the bug and it is because that the CassandraIndex -&amp;gt; indexCfsMetadata build the index table meta at the first clustering key  with PartitionerDefinedOrder which have not implement toJSONString method , see &lt;a href=&quot;https://github.com/apache/cassandra/blob/trunk/src/java/org/apache/cassandra/index/internal/CassandraIndex.java#L743&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/cassandra/blob/trunk/src/java/org/apache/cassandra/index/internal/CassandraIndex.java#L743&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;I have fixed the bug , and done some test with index sstable dump. Now I want to add some unit test for this like &lt;a href=&quot;https://github.com/apache/cassandra/blob/trunk/test/unit/org/apache/cassandra/tools/SSTableExportSchemaLoadingTest.java&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/cassandra/blob/trunk/test/unit/org/apache/cassandra/tools/SSTableExportSchemaLoadingTest.java&lt;/a&gt;  ,But I just find some exists sstables in test dir , they are here &lt;a href=&quot;https://github.com/apache/cassandra/tree/trunk/test/data/legacy-sstables/nb/legacy_tables&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/cassandra/tree/trunk/test/data/legacy-sstables/nb/legacy_tables&lt;/a&gt;&lt;br/&gt;
But I need to add some sstable for secondary index , My question is : How does this sstables been created ? What I am going to do is just create index sstable locally and upload to github at this commit and then the ut can use them ?&lt;/p&gt;</comment>
                            <comment id="17616891" author="smiklosovic" created="Thu, 13 Oct 2022 09:01:56 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=maxwellguo&quot; class=&quot;user-hover&quot; rel=&quot;maxwellguo&quot;&gt;maxwellguo&lt;/a&gt;,&lt;/p&gt;

&lt;p&gt;thanks for the patch! This is a good question. I would say that we should not add upload / commit sstables into the repository. I think the main reason these legacy tables were uploaded there was that Cassandra can not create them anymore (well, because it is &quot;legacy&quot;). But we still want to parse them.&lt;/p&gt;

&lt;p&gt;Ideally, you should create these sstables in the test and then run the tool against them. So we know that, as Cassandra is being developed, it knows how to export it - sstables would be always the current ones.&lt;/p&gt;

&lt;p&gt;There is a lot of helper methods on org.apache.cassandra.SchemaLoader for creating keyspaces, tables and indexes on them with some predefined schema. Then you would populate that table (hence index) with data.&lt;/p&gt;

&lt;p&gt;You can look into SSTableLoaderTest where in &quot;defineSchema&quot; method the schema is created (definitely just pick what you find necessary). Then you may look into &quot;testLoadingSSTable&quot; method in the same class, at the beginning it writes some rows via CQLSSTableWriter. Do not forget to flush it via Util.flush(cfs); as shown in that method.&lt;/p&gt;

&lt;p&gt;I would put all of this into &quot;SSTableExportSchemaLoadingTest&quot; as a new test method. You may create a dedicated class as well in the same package SSTableExportSchemaLoadingTest is. I can imagine that there will be  lot of variations of indexes and we should be able to test that every index type is dumpable. &lt;/p&gt;

&lt;p&gt;If you look into SchemaLoader.schemaDefinition, there you see it creates basically all keyspaces / indexes / counter caches and so on. We should be able to verify that we can dump all of them via that tool.&lt;/p&gt;
</comment>
                            <comment id="17619618" author="maxwellguo" created="Tue, 18 Oct 2022 14:39:53 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=smiklosovic&quot; class=&quot;user-hover&quot; rel=&quot;smiklosovic&quot;&gt;smiklosovic&lt;/a&gt;I just use CQLTester and create a new class called SecondaryIndexSSTableExportTest and make ddl through createtable and createindex mthod and insert data through execute method. &lt;br/&gt;
For that I think use this I can make a integration test so that the modification of CassandraIndex can also be tested. &lt;/p&gt;

&lt;p&gt;code is : &lt;a href=&quot;https://github.com/apache/cassandra/commit/ab3884a197d398d7c94f6fe580b7d631c00b0c46&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;cassandra-17698 &lt;/a&gt;&lt;br/&gt;
test is &lt;a href=&quot;https://app.circleci.com/pipelines/github/Maxwell-Guo/cassandra&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;ci &lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17619633" author="smiklosovic" created="Tue, 18 Oct 2022 15:00:28 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=maxwellguo&quot; class=&quot;user-hover&quot; rel=&quot;maxwellguo&quot;&gt;maxwellguo&lt;/a&gt; , could you please prepare this PR for the first branch it ever appeared in? You said you hit this issue in 3.11.4. What is the first version this bug is in? Once we fix this in the branch it appeared first, we need to apply it to all newer branches. I do not know how to merge trunk to older branches but I know how to merge older branch to newer ones.&lt;/p&gt;</comment>
                            <comment id="17620422" author="maxwellguo" created="Wed, 19 Oct 2022 15:45:02 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=smiklosovic&quot; class=&quot;user-hover&quot; rel=&quot;smiklosovic&quot;&gt;smiklosovic&lt;/a&gt;Hi, I saw that the first version that occurs the bug is 3.4 but after I try to prepare the PR on cassandra-3.4 , I found that may if we fix the bug on trunk  at the next c* release version is ok ? For the test for this patch can not be created for some of the test tool like ToolRunner is introduce at 4.x ? So if we can just fix this bug for trunk ? &lt;br/&gt;
Besides I have a new question here: for the example :&lt;br/&gt;
1.CREATE TABLE table (id text PRIMARY KEY, birth_year int)&lt;br/&gt;
2.CREATE INDEX on table (birth_year)&lt;br/&gt;
3.INSERT INTO  table (id, birth_year) VALUES (&apos;Tom&apos;, 42)&lt;br/&gt;
4.INSERT INTO table (id, birth_year) VALUES (&apos;Paul&apos;, 24)&lt;br/&gt;
5.INSERT INTO table (id, birth_year) VALUES (&apos;Bob&apos;, 42)&lt;/p&gt;

&lt;p&gt;now IF I doing : SELECT id FROM  table WHERE birth_year = 42&lt;br/&gt;
which result is right ? &lt;br/&gt;
(a) &quot;Tom&quot;, &quot;Bob&quot;&lt;br/&gt;
(b) &quot;Bob&quot;, &quot;Tom&quot;&lt;/p&gt;

&lt;p&gt;We know that the clustering key for index table is consist of data table&apos;s partition key + data table&apos;s clustering key + data cell . &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=brandon.williams&quot; class=&quot;user-hover&quot; rel=&quot;brandon.williams&quot;&gt;brandon.williams&lt;/a&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=smiklosovic&quot; class=&quot;user-hover&quot; rel=&quot;smiklosovic&quot;&gt;smiklosovic&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17620432" author="smiklosovic" created="Wed, 19 Oct 2022 16:04:54 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=maxwellguo&quot; class=&quot;user-hover&quot; rel=&quot;maxwellguo&quot;&gt;maxwellguo&lt;/a&gt;,&lt;/p&gt;

&lt;p&gt;so, in case it was first in 3.4, we fix it for cassandra-3.11 branch up. We support 3.0.x, 3.11.x, 4.0, 4.1 and trunk. 3.4 is after 3.0 and before 3.11 so 3.11 is the branch we should fix that for first. Do you say that this bug is not in 3.0.x then? Thanks for verifying that!&lt;/p&gt;

&lt;p&gt;Both results are right. I do not think the order matters.&lt;/p&gt;

&lt;p&gt;I do not understand your comment about ToolRunner. Can you please repeat that question? &lt;/p&gt;</comment>
                            <comment id="17620516" author="brandon.williams" created="Wed, 19 Oct 2022 19:10:52 +0000"  >&lt;blockquote&gt;&lt;p&gt;We support 3.0.x, 3.11.x, 4.0, 4.1 and trunk. 3.4 is after 3.0 and before 3.11 so 3.11 is the branch we should fix that for first. Do you say that this bug is not in 3.0.x then? &lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;This is correct.&lt;/p&gt;</comment>
                            <comment id="17620688" author="maxwellguo" created="Thu, 20 Oct 2022 02:55:50 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=smiklosovic&quot; class=&quot;user-hover&quot; rel=&quot;smiklosovic&quot;&gt;smiklosovic&lt;/a&gt;, after verifying agagin , the details are :&lt;br/&gt;
For tag : the bug was first introduce in tag : cassandra-3.0.4 and all cassandra 3.0.x have this bug , but for tag 3.1.x to 3.3 the patch is not exist bug introduce the bug agagin in 3.4 till 4.x . I saw that for 3.4 we merge some feature from 3.0 so the bug was introduce.&lt;/p&gt;

&lt;p&gt;For branch : 3.0 the bug not exist but 3.11 to 4.x the bug exist. &lt;/p&gt;

&lt;p&gt;why I ask the question for the result order is that I found some ut is failed. the reason is the order of result for the clustering key type (my patch modify the clustering type from PartitionerDefinedOrder to the real data clustering type , so the result slected is changed ,but I think &lt;br/&gt;
the order should be same with real clustering key type ordered. see &lt;a href=&quot;https://github.com/apache/cassandra/blob/trunk/test/unit/org/apache/cassandra/cql3/validation/entities/SecondaryIndexTest.java#L204&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/cassandra/blob/trunk/test/unit/org/apache/cassandra/cql3/validation/entities/SecondaryIndexTest.java#L204&lt;/a&gt;)&lt;/p&gt;

&lt;p&gt;For ToolRunner what I means is  the ut for tools like sstableexport , there introduce ToolRunner to make the ut code.  and ToolRunner code seems only in trunk and 4.x &#65292;So for 3.x the prepared PR may got no ut for this &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/sad.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; ,So I want to know if we can just fix this in trunk or some 4.x version. &lt;/p&gt;</comment>
                            <comment id="17621128" author="smiklosovic" created="Thu, 20 Oct 2022 14:15:36 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=maxwellguo&quot; class=&quot;user-hover&quot; rel=&quot;maxwellguo&quot;&gt;maxwellguo&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;what I understand is that this is ultimately in 3.0.x as well. We should then fix this in 3.0 and prepare a PR for it. Let&apos;s prepare a PR for branch cassandra-3.0 and we will eventually see how it might be applied to newer branches. I think it is too premature to discuss it in such a detail yet. Lets create a branch for 3.0 and we take it from there. What do you think?&lt;/p&gt;</comment>
                            <comment id="17621437" author="maxwellguo" created="Fri, 21 Oct 2022 01:56:04 +0000"  >&lt;p&gt;OK &lt;/p&gt;</comment>
                            <comment id="17624284" author="maxwellguo" created="Wed, 26 Oct 2022 08:05:06 +0000"  >&lt;p&gt;&lt;a href=&quot;https://github.com/Maxwell-Guo/cassandra/commit/df7743b717608889b27224ff285de8e187ba795d&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;pr for trunk &lt;/a&gt;&lt;br/&gt;
&lt;a href=&quot;https://app.circleci.com/pipelines/github/Maxwell-Guo/cassandra?branch=trunk&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;trunk ci &lt;/a&gt;&lt;br/&gt;
&lt;a href=&quot;https://github.com/Maxwell-Guo/cassandra/commit/90c94730abe30f382c924da7512e3c1282c1f007&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;pr for cassandra-3.0&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=smiklosovic&quot; class=&quot;user-hover&quot; rel=&quot;smiklosovic&quot;&gt;smiklosovic&lt;/a&gt; The pr for trunk I have made a ut test and the test passed , but for pr of casandra-3.0 I do not add some ut for sstable dump for at branch cassandra-3.0 there do not exist some ut tool for tools like sstabledump ,I just make a ut test for my pr of cassandra-3.0 at my local machine because I have not found some way for add test for a new branch (sorry for not use circle ci for a long time). &lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=blambov&quot; class=&quot;user-hover&quot; rel=&quot;blambov&quot;&gt;blambov&lt;/a&gt; hi, can you help to look at this patch too, I saw the class was once modified by you ? for PartitionerDefinedOrder I just add a baseType when secondary index init cfmeta and the baseType was set to be the original data table&apos;s partitionkey type. So I modify the PartitionerDefinedOrder toString method and the TypeParser  so that the metadata can deserialize and serialize the baseType in PartitionerDefinedOrder. &lt;/p&gt;

&lt;p&gt;Thank you all . &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=smiklosovic&quot; class=&quot;user-hover&quot; rel=&quot;smiklosovic&quot;&gt;smiklosovic&lt;/a&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=brandon.williams&quot; class=&quot;user-hover&quot; rel=&quot;brandon.williams&quot;&gt;brandon.williams&lt;/a&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=blambov&quot; class=&quot;user-hover&quot; rel=&quot;blambov&quot;&gt;blambov&lt;/a&gt;&lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/biggrin.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="17624346" author="blambov" created="Wed, 26 Oct 2022 10:19:09 +0000"  >&lt;p&gt;Added some comments on the 3.0 commit. Why do we need a patch for 3.0 if the problem is not present there?&lt;/p&gt;</comment>
                            <comment id="17624351" author="smiklosovic" created="Wed, 26 Oct 2022 10:25:34 +0000"  >&lt;p&gt;I am reading this comment of Maxwell&lt;/p&gt;

&lt;p&gt;For tag : the bug was first introduce in tag : cassandra-3.0.4 and all cassandra 3.0.x have this bug , but for tag 3.1.x to 3.3 the patch is not exist bug introduce the bug agagin in 3.4 till 4.x . I saw that for 3.4 we merge some feature from 3.0 so the bug was introduce.&lt;/p&gt;

&lt;p&gt;For branch : 3.0 the bug not exist but 3.11 to 4.x the bug exist.&lt;/p&gt;

&lt;p&gt;He said in the first sentence 3.0.x has that bug. &lt;/p&gt;</comment>
                            <comment id="17626571" author="maxwellguo" created="Mon, 31 Oct 2022 12:44:00 +0000"  >&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;Heading 1&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;Heading 2&lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;trunk &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/apache/cassandra/commit/655c02e872e61116705b526be2401ea51a736b4f&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;trunk&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;trunk ci &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://app.circleci.com/pipelines/github/Maxwell-Guo/cassandra/313/workflows/f3425952-af44-4c5d-9241-2c5e485988f9&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;ci &lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;3.0&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/apache/cassandra/commit/2be8e841df1b35faeec0b863fe577ae041310b58&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;3.0&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;3.0 ci&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://app.circleci.com/pipelines/github/Maxwell-Guo/cassandra/314/workflows/fc79135b-8a84-4364-8996-53d8afd17e27&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;ci&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;


&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=blambov&quot; class=&quot;user-hover&quot; rel=&quot;blambov&quot;&gt;blambov&lt;/a&gt;make some new code update after reading the comment. thank you for review code for me .&lt;/p&gt;</comment>
                            <comment id="17629768" author="maxwellguo" created="Mon, 7 Nov 2022 11:49:22 +0000"  >&lt;p&gt;update agagin &lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=blambov&quot; class=&quot;user-hover&quot; rel=&quot;blambov&quot;&gt;blambov&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=smiklosovic&quot; class=&quot;user-hover&quot; rel=&quot;smiklosovic&quot;&gt;smiklosovic&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=brandon.williams&quot; class=&quot;user-hover&quot; rel=&quot;brandon.williams&quot;&gt;brandon.williams&lt;/a&gt;can anyone help with this patch ? my patch have some update on 3.0 and trunk &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/biggrin.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="17629874" author="brandon.williams" created="Mon, 7 Nov 2022 15:24:22 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=maxwellguo&quot; class=&quot;user-hover&quot; rel=&quot;maxwellguo&quot;&gt;maxwellguo&lt;/a&gt; if this is a bug in 3.0, then we need fixes for 3.0, 3.11, 4.0, 4.1, and trunk.&lt;/p&gt;</comment>
                            <comment id="17630325" author="blambov" created="Tue, 8 Nov 2022 10:20:22 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=maxwellguo&quot; class=&quot;user-hover&quot; rel=&quot;maxwellguo&quot;&gt;maxwellguo&lt;/a&gt;, could you open a pull requests against the relevant branch in apache/cassandra, so that the comments made can be tracked in a single place? I suggest starting with the 3.0 version, working through the review, and then merging it forward to the other branches to run CI.&lt;/p&gt;</comment>
                            <comment id="17632107" author="maxwellguo" created="Fri, 11 Nov 2022 06:47:27 +0000"  >&lt;p&gt;3.x have some differenece with 4.x and trunk for 3.x do not have the ToolRunner.java class , so some the ut for Tools like SStableExport can not be made. But for trunk and 4.x I add some ut for the SStableExport with secondaryIndex sstable&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/cassandra/pull/1998&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;3.0-pr&lt;/a&gt;&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/cassandra/pull/2002&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;3.11-pr&lt;/a&gt;&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/cassandra/pull/2003&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;4.0-pr&lt;/a&gt;&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/cassandra/pull/2004&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;4.1-pr&lt;/a&gt;&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/cassandra/pull/2005&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;trunk-pr&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;I have also fix this bug for 3.11 /4.0/4.1 and trunk &lt;/p&gt;


&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=blambov&quot; class=&quot;user-hover&quot; rel=&quot;blambov&quot;&gt;blambov&lt;/a&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=brandon.williams&quot; class=&quot;user-hover&quot; rel=&quot;brandon.williams&quot;&gt;brandon.williams&lt;/a&gt; and &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jasonstack&quot; class=&quot;user-hover&quot; rel=&quot;jasonstack&quot;&gt;jasonstack&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17634203" author="maxwellguo" created="Tue, 15 Nov 2022 07:27:31 +0000"  >&lt;p&gt;hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=blambov&quot; class=&quot;user-hover&quot; rel=&quot;blambov&quot;&gt;blambov&lt;/a&gt;, I just update the patch for 3.0 &lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/cassandra/pull/1998/commits&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/cassandra/pull/1998/commits&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;and close the pr for other branch , will be open latter.&lt;/p&gt;</comment>
                            <comment id="17675873" author="blambov" created="Thu, 12 Jan 2023 08:44:30 +0000"  >&lt;p&gt;The patch looks good to me.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=maxwellguo&quot; class=&quot;user-hover&quot; rel=&quot;maxwellguo&quot;&gt;maxwellguo&lt;/a&gt; , could you change the ticket status and add all required data?&lt;/p&gt;</comment>
                            <comment id="17675903" author="maxwellguo" created="Thu, 12 Jan 2023 09:28:58 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=blambov&quot; class=&quot;user-hover&quot; rel=&quot;blambov&quot;&gt;blambov&lt;/a&gt;, Thanks, I change the status to &quot;Need Committer&quot; , if it is right ?&lt;br/&gt;
And some version to fix is also added.&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=smiklosovic&quot; class=&quot;user-hover&quot; rel=&quot;smiklosovic&quot;&gt;smiklosovic&lt;/a&gt;Can you help to to take a look ? Thanks&lt;/p&gt;</comment>
                            <comment id="17676653" author="maxwellguo" created="Fri, 13 Jan 2023 14:40:19 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=blambov&quot; class=&quot;user-hover&quot; rel=&quot;blambov&quot;&gt;blambov&lt;/a&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=smiklosovic&quot; class=&quot;user-hover&quot; rel=&quot;smiklosovic&quot;&gt;smiklosovic&lt;/a&gt;&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/cassandra/compare/trunk...Maxwell-Guo:cassandra:CASSANDRA-17698-3.0&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;3.0&lt;/a&gt; and &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=blambov&quot; class=&quot;user-hover&quot; rel=&quot;blambov&quot;&gt;blambov&lt;/a&gt; +1 &apos;s patch link &lt;a href=&quot;https://github.com/apache/cassandra/pull/1998&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;patch&lt;/a&gt;&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/cassandra/compare/cassandra-3.11...Maxwell-Guo:cassandra:CASSANDRA-17698-3.11&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;3.11&lt;/a&gt;&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/cassandra/compare/cassandra-4.0...Maxwell-Guo:cassandra:CASSANDRA-17698-4.0&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;4.0&lt;/a&gt;&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/cassandra/compare/cassandra-4.1...Maxwell-Guo:cassandra:CASSANDRA-17698-4.1&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;4.1&lt;/a&gt;&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/cassandra/compare/trunk...Maxwell-Guo:cassandra:CASSANDRA-17698-trunk&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;trunk&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;java8 precommit :&lt;br/&gt;
&lt;a href=&quot;https://app.circleci.com/pipelines/github/Maxwell-Guo/cassandra/381/workflows/abc96440-efcb-46f7-ac80-7610af8982a8&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;trunk&lt;/a&gt;&lt;br/&gt;
&lt;a href=&quot;https://app.circleci.com/pipelines/github/Maxwell-Guo/cassandra/382/workflows/014166a5-860e-48f3-a5c0-e7f93810dad8&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;4.1&lt;/a&gt;&lt;br/&gt;
&lt;a href=&quot;https://app.circleci.com/pipelines/github/Maxwell-Guo/cassandra/383/workflows/b954f510-75ce-4830-86f4-0f271e8b1b57&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;4.0&lt;/a&gt;&lt;br/&gt;
&lt;a href=&quot;https://app.circleci.com/pipelines/github/Maxwell-Guo/cassandra/384/workflows/66938b6e-9a1c-4b62-8505-61e98cedc8e6&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;3.11&lt;/a&gt;&lt;br/&gt;
java11 precommit :&lt;br/&gt;
&lt;a href=&quot;https://app.circleci.com/pipelines/github/Maxwell-Guo/cassandra/381/workflows/ac333054-47d6-4b9b-a43f-b80904fb8b89&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;trunk&lt;/a&gt;&lt;br/&gt;
&lt;a href=&quot;https://app.circleci.com/pipelines/github/Maxwell-Guo/cassandra/382/workflows/2b368971-5aaa-4c98-8eb9-6136b235be45&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;4.1&lt;/a&gt;&lt;br/&gt;
&lt;a href=&quot;https://app.circleci.com/pipelines/github/Maxwell-Guo/cassandra/383/workflows/4baaacad-0933-4ffe-9557-9ca6a985609c&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;4.0&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;for my testing resource is limited ,so it may take some time to see the result.&lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/sad.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="17677710" author="smiklosovic" created="Tue, 17 Jan 2023 10:16:54 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=adelapena&quot; class=&quot;user-hover&quot; rel=&quot;adelapena&quot;&gt;adelapena&lt;/a&gt; I am not too strong in indexes this ticket touches. Would you mind to be the second reviewer here? I think it is mostly just a formality.&lt;/p&gt;</comment>
                            <comment id="17677821" author="adelapena" created="Tue, 17 Jan 2023 16:12:37 +0000"  >&lt;p&gt;I&apos;m not that familiarized with that part of the indexes. However, I still can reproduce the issue with patched 3.0 if the table uses a composite partition key:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
cqlsh&amp;gt; CREATE KEYSPACE k WITH replication = {&lt;span class=&quot;code-quote&quot;&gt;&apos;class&apos;&lt;/span&gt;: &lt;span class=&quot;code-quote&quot;&gt;&apos;SimpleStrategy&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;replication_factor&apos;&lt;/span&gt;: 1};
cqlsh&amp;gt; CREATE TABLE k.t ( k1 &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;, k2 &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;, v &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;, primary key ((k1, k2)));
cqlsh&amp;gt; CREATE INDEX IF NOT EXISTS ON k.t(v);
cqlsh&amp;gt; INSERT INTO k.t (k1, k2, v ) VALUES (1, 2, 3);
$ bin/nodetool flush
$ tools/bin/sstabledump data/data/k/t-aa18d300967f11ed8c91c741e12777ed/.t_v_idx/me-1-big-Data.db
[
  {
    &lt;span class=&quot;code-quote&quot;&gt;&quot;partition&quot;&lt;/span&gt; : {
      &lt;span class=&quot;code-quote&quot;&gt;&quot;key&quot;&lt;/span&gt; : [ &lt;span class=&quot;code-quote&quot;&gt;&quot;3&quot;&lt;/span&gt; ],
      &lt;span class=&quot;code-quote&quot;&gt;&quot;position&quot;&lt;/span&gt; : 0
    },
    &lt;span class=&quot;code-quote&quot;&gt;&quot;rows&quot;&lt;/span&gt; : [
      {
        &lt;span class=&quot;code-quote&quot;&gt;&quot;type&quot;&lt;/span&gt; : &lt;span class=&quot;code-quote&quot;&gt;&quot;row&quot;&lt;/span&gt;,
        &lt;span class=&quot;code-quote&quot;&gt;&quot;position&quot;&lt;/span&gt; : 18,
        &lt;span class=&quot;code-quote&quot;&gt;&quot;clustering&quot;&lt;/span&gt; : [ ] } ] } ]Exception in thread &lt;span class=&quot;code-quote&quot;&gt;&quot;main&quot;&lt;/span&gt; java.lang.UnsupportedOperationException
	at org.apache.cassandra.db.marshal.AbstractCompositeType.toJSONString(AbstractCompositeType.java:252)
	at org.apache.cassandra.db.marshal.PartitionerDefinedOrder.toJSONString(PartitionerDefinedOrder.java:92)
	at org.apache.cassandra.tools.JsonTransformer.serializeClustering(JsonTransformer.java:353)
	at org.apache.cassandra.tools.JsonTransformer.serializeRow(JsonTransformer.java:249)
	at org.apache.cassandra.tools.JsonTransformer.serializePartition(JsonTransformer.java:217)
	at java.util.stream.ForEachOps$ForEachOp$OfRef.accept(ForEachOps.java:184)
	at java.util.stream.ReferencePipeline$2$1.accept(ReferencePipeline.java:175)
	at java.util.Iterator.forEachRemaining(Iterator.java:116)
	at java.util.Spliterators$IteratorSpliterator.forEachRemaining(Spliterators.java:1801)
	at java.util.stream.AbstractPipeline.copyInto(AbstractPipeline.java:482)
	at java.util.stream.AbstractPipeline.wrapAndCopyInto(AbstractPipeline.java:472)
	at java.util.stream.ForEachOps$ForEachOp.evaluateSequential(ForEachOps.java:151)
	at java.util.stream.ForEachOps$ForEachOp$OfRef.evaluateSequential(ForEachOps.java:174)
	at java.util.stream.AbstractPipeline.evaluate(AbstractPipeline.java:234)
	at java.util.stream.ReferencePipeline.forEach(ReferencePipeline.java:418)
	at org.apache.cassandra.tools.JsonTransformer.toJson(JsonTransformer.java:104)
	at org.apache.cassandra.tools.SSTableExport.main(SSTableExport.java:253)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;So it seems we are still missing something. If I&apos;m right the patch avoids calling the unimplemented &lt;tt&gt;AbstractCompositeType#toJSONString&lt;/tt&gt;, which only works if the partition key base type is not an actual composite. &lt;br/&gt;
&#160;&lt;/p&gt;</comment>
                            <comment id="17677826" author="maxwellguo" created="Tue, 17 Jan 2023 16:18:07 +0000"  >&lt;p&gt;you are right&#65292;that why my test case lack of the composite type &#65292;but I think that should open another jira which is to implement the tojsonsting for compositetyep&#65288;I found this problem at test step&#65292;but In my mind&#65292;it is more suitable to fix the problem in a new jira&#65292;so I left it unfixed&#65289;.This is just for partitionorder type.&lt;/p&gt;</comment>
                            <comment id="17677827" author="maxwellguo" created="Tue, 17 Jan 2023 16:19:48 +0000"  >&lt;p&gt;And I will open another jira after this one &lt;/p&gt;</comment>
                            <comment id="17677977" author="maxwellguo" created="Tue, 17 Jan 2023 20:39:37 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=adelapena&quot; class=&quot;user-hover&quot; rel=&quot;adelapena&quot;&gt;adelapena&lt;/a&gt; &lt;/p&gt;</comment>
                            <comment id="17678173" author="maxwellguo" created="Wed, 18 Jan 2023 10:00:22 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=adelapena&quot; class=&quot;user-hover&quot; rel=&quot;adelapena&quot;&gt;adelapena&lt;/a&gt;a new version is updated after your comments ,Thanks &lt;/p&gt;</comment>
                            <comment id="17678205" author="adelapena" created="Wed, 18 Jan 2023 11:59:05 +0000"  >&lt;p&gt;Fixing &lt;tt&gt;AbstractCompositeType#toJSONString&lt;/tt&gt; on a separate ticket works for me.&lt;/p&gt;

&lt;p&gt;The fix changes what is written on the sstables without changing their version. It&apos;s done in a way that patched C* instances will be able to read the index sstables produced by unpatched versions. However the opposite doesn&apos;t happen, so an unpatched version won&apos;t be able to read the index sstables produced by a patched version. &lt;/p&gt;

&lt;p&gt;I think that shouldn&apos;t be a problem during rolling upgrades, since index sstables are not streamed between nodes. Also, in case of wanting to downgrade to an unpatched version, users would need to delete those index sstables and reindex. &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=smiklosovic&quot; class=&quot;user-hover&quot; rel=&quot;smiklosovic&quot;&gt;smiklosovic&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=blambov&quot; class=&quot;user-hover&quot; rel=&quot;blambov&quot;&gt;blambov&lt;/a&gt; wdyt?&lt;/p&gt;</comment>
                            <comment id="17678240" author="maxwellguo" created="Wed, 18 Jan 2023 13:55:43 +0000"  >&lt;p&gt;&quot;Fixing AbstractCompositeType#toJSONString on a separate ticket works for me.&quot;&lt;br/&gt;
 &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=adelapena&quot; class=&quot;user-hover&quot; rel=&quot;adelapena&quot;&gt;adelapena&lt;/a&gt;&lt;br/&gt;
see &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-18177&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/CASSANDRA-18177&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17679095" author="blambov" created="Fri, 20 Jan 2023 10:23:23 +0000"  >&lt;blockquote&gt;&lt;p&gt;The fix changes what is written on the sstables without changing their version. It&apos;s done in a way that patched C* instances will be able to read the index sstables produced by unpatched versions. However the opposite doesn&apos;t happen, so an unpatched version won&apos;t be able to read the index sstables produced by a patched version.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Ouch, I missed the fact that we are introducing an incompatibility. It doesn&apos;t sound to me like a change that&apos;s acceptable for a patch release.&lt;/p&gt;

&lt;p&gt;I thought we could work around the problem by taking advantage of some imprecision of the existing code: it accepts specifications of the form &lt;tt&gt;PartitionerDefinedOrder(x=y)&lt;/tt&gt; and ignores &lt;tt&gt;y&lt;/tt&gt;. However, &lt;tt&gt;y&lt;/tt&gt; can only be a single identifier, and the base type will often be complex.&lt;/p&gt;

&lt;p&gt;Should we limit the scope of this patch to 4.2/5.0?&lt;/p&gt;</comment>
                            <comment id="17679145" author="adelapena" created="Fri, 20 Jan 2023 13:25:04 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=blambov&quot; class=&quot;user-hover&quot; rel=&quot;blambov&quot;&gt;blambov&lt;/a&gt; Making it a 4.2/5.0-only fix makes sense to me.&lt;/p&gt;

&lt;p&gt;As for previous branches, I wonder whether it would make sense to make &lt;tt&gt;PartitionerDefinedOrder#toJSONString(ByteBuffer, ProtocolVersion)&lt;/tt&gt; return a special string that doesn&apos;t require deserialization, like the hex representation of the &lt;tt&gt;ByteBuffer&lt;/tt&gt;. That at least would print something without breaking the rest of the json conversion, and it would be possible to somewhat use &lt;tt&gt;sstabledump&lt;/tt&gt; on 2i sstables. The problem is that the returned string could be confused with the real deserialized value of a text key, and it might not play well with &lt;tt&gt;fromJson&lt;/tt&gt; methods.&lt;/p&gt;</comment>
                            <comment id="17679154" author="maxwellguo" created="Fri, 20 Jan 2023 13:56:10 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=adelapena&quot; class=&quot;user-hover&quot; rel=&quot;adelapena&quot;&gt;adelapena&lt;/a&gt; In that way&#65292;should we separate this issue to two&#65311;one for what you said return a special string do not require deserialization &#65292;one is what i have done that is better to fix in 4.2/5.0&lt;/p&gt;</comment>
                            <comment id="17681284" author="adelapena" created="Fri, 27 Jan 2023 11:25:16 +0000"  >&lt;p&gt;Yes, right. The current patch would go to trunk, and the older branches would just return the serialised value in &lt;tt&gt;PartitionerDefinedOrder#toJSONString(ByteBuffer, ProtocolVersion)&lt;/tt&gt; without changing the sstables. &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=blambov&quot; class=&quot;user-hover&quot; rel=&quot;blambov&quot;&gt;blambov&lt;/a&gt; does that make sense to you?&lt;/p&gt;</comment>
                            <comment id="17681309" author="blambov" created="Fri, 27 Jan 2023 12:43:29 +0000"  >&lt;p&gt;Sounds good to me.&lt;/p&gt;</comment>
                            <comment id="17681668" author="maxwellguo" created="Sun, 29 Jan 2023 03:33:50 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=adelapena&quot; class=&quot;user-hover&quot; rel=&quot;adelapena&quot;&gt;adelapena&lt;/a&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=blambov&quot; class=&quot;user-hover&quot; rel=&quot;blambov&quot;&gt;blambov&lt;/a&gt;&lt;br/&gt;
what about just fix this patch (what I will doing some modification latter for trunk), and left the older branches unchanged? &lt;br/&gt;
Because I think no matter what kind of special string  , it may confused with the real deserialized value of a text key as &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=adelapena&quot; class=&quot;user-hover&quot; rel=&quot;adelapena&quot;&gt;adelapena&lt;/a&gt;said. So throw an UnSupport exception may be better.&lt;/p&gt;</comment>
                            <comment id="17681905" author="maxwellguo" created="Mon, 30 Jan 2023 06:42:34 +0000"  >

&lt;p&gt;&lt;a href=&quot;https://github.com/apache/cassandra/pull/2118&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;trunk pr&lt;/a&gt;&lt;br/&gt;
&lt;a href=&quot;https://app.circleci.com/pipelines/github/Maxwell-Guo/cassandra/398/workflows/44d8260f-8f58-454d-8867-cd463dd4eb18&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;java8&lt;/a&gt;&lt;br/&gt;
&lt;a href=&quot;https://app.circleci.com/pipelines/github/Maxwell-Guo/cassandra/398/workflows/787e6e20-7b79-49f0-82cf-2db1243eb6eb&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;java11&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;the code for trunk is almost same with code for 3.0 that &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=blambov&quot; class=&quot;user-hover&quot; rel=&quot;blambov&quot;&gt;blambov&lt;/a&gt;have +1 , besides there are some other uts for secondarindex sstable dump. &lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=blambov&quot; class=&quot;user-hover&quot; rel=&quot;blambov&quot;&gt;blambov&lt;/a&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=adelapena&quot; class=&quot;user-hover&quot; rel=&quot;adelapena&quot;&gt;adelapena&lt;/a&gt; can you help to look at it again ?  and for older branches I just left unchanged as I said yesterday .wdyt ? &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=adelapena&quot; class=&quot;user-hover&quot; rel=&quot;adelapena&quot;&gt;adelapena&lt;/a&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=blambov&quot; class=&quot;user-hover&quot; rel=&quot;blambov&quot;&gt;blambov&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17683354" author="adelapena" created="Thu, 2 Feb 2023 11:19:54 +0000"  >&lt;p&gt;The patch mostly looks good to me. However, it changes the sstables in a way that breaks backward compatibility. Thus, sstables created with the patched version would produce a server startup failure with the unpatched version. I understand that requires &lt;a href=&quot;https://github.com/apache/cassandra/blob/cassandra-4.1.0/src/java/org/apache/cassandra/io/sstable/format/big/BigFormat.java#L124&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;a major sstable version bump&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;Those type of major sstables changes can only be done on major releases. So the current patch should go in 5.0 only. However, I think we don&apos;t have a branch for 5.0. Instead, the current &lt;tt&gt;trunk&lt;/tt&gt; branch in for 4.2. It seems that it will become 5.0 when we have a breaking change that justifies the bump to a major. That bump to 5.0 is meant to be done in &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-17973&quot; title=&quot;Change trunk 4.2 to 5.0&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-17973&quot;&gt;&lt;del&gt;CASSANDRA-17973&lt;/del&gt;&lt;/a&gt;. See &lt;a href=&quot;https://www.mail-archive.com/dev@cassandra.apache.org/msg19516.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;this mail list discussion&lt;/a&gt; for context.&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;what about just fix this patch (what I will doing some modification latter for trunk), and left the older branches unchanged?&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;I think we should try to fix the bug for older branches in a way that doesn&apos;t break sstables backward compatibility. Possibly by just JSON-printing the failing clustering key as raw bytes, &lt;a href=&quot;https://github.com/apache/cassandra/blob/trunk/src/java/org/apache/cassandra/db/marshal/BytesType.java#L70-L73&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;this way&lt;/a&gt;. If we don&apos;t want to do it here we can open a separate ticket and set the fix version of this ticket as 5.0, making this depend on &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-17973&quot; title=&quot;Change trunk 4.2 to 5.0&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-17973&quot;&gt;&lt;del&gt;CASSANDRA-17973&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=blambov&quot; class=&quot;user-hover&quot; rel=&quot;blambov&quot;&gt;blambov&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=smiklosovic&quot; class=&quot;user-hover&quot; rel=&quot;smiklosovic&quot;&gt;smiklosovic&lt;/a&gt; wdyt?&lt;/p&gt;</comment>
                            <comment id="17683392" author="maxwellguo" created="Thu, 2 Feb 2023 12:42:47 +0000"  >&lt;p&gt;I think make this fix as 5.0 and open a separate ticket for what you said  to fix bug for older branch is ok for me. and I think that old branches should be 3.0/3.11/4.0/4.1 and trunk.&lt;/p&gt;</comment>
                            <comment id="17683393" author="maxwellguo" created="Thu, 2 Feb 2023 12:43:15 +0000"  >&lt;p&gt;if so I can open new tickets &lt;/p&gt;</comment>
                            <comment id="17685919" author="maxwellguo" created="Wed, 8 Feb 2023 14:29:25 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=blambov&quot; class=&quot;user-hover&quot; rel=&quot;blambov&quot;&gt;blambov&lt;/a&gt;  &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=adelapena&quot; class=&quot;user-hover&quot; rel=&quot;adelapena&quot;&gt;adelapena&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=smiklosovic&quot; class=&quot;user-hover&quot; rel=&quot;smiklosovic&quot;&gt;smiklosovic&lt;/a&gt; any advice on my replied message above&#65311;If so I will open a new ticket for older branches.&lt;/p&gt;</comment>
                            <comment id="17686754" author="adelapena" created="Thu, 9 Feb 2023 20:13:02 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=maxwellguo&quot; class=&quot;user-hover&quot; rel=&quot;maxwellguo&quot;&gt;maxwellguo&lt;/a&gt; making a separate fix that doesn&apos;t need a sstable version bump still sounds good to me.&lt;/p&gt;

&lt;p&gt;The current patch can be left for 5.0, or the next major that has a sstable version bump for other reasons. I mean, the current patch is better than the workaround, but neither the bug nor the workaround seem bad enough to justify changing the sstable version only because of that.&lt;/p&gt;</comment>
                            <comment id="17686855" author="maxwellguo" created="Fri, 10 Feb 2023 03:20:09 +0000"  >&lt;p&gt;this patch should be applied after the next change version of sstable. maybe CASSANDRA 5.0&lt;/p&gt;</comment>
                            <comment id="17691078" author="benedict" created="Mon, 20 Feb 2023 09:06:41 +0000"  >&lt;p&gt;Could somebody ELI5 why this needs to break backwards compatibility?&lt;/p&gt;</comment>
                            <comment id="17691130" author="benedict" created="Mon, 20 Feb 2023 10:49:56 +0000"  >&lt;p&gt;(Copied from email reply)&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;for old version&#8216;s index data using this version&#8217;s dump code &#65292;I think there&lt;br/&gt;
will not be much difference&#65288;may be only exception message&#8216;s difference&#65289;&#65292;It&lt;br/&gt;
is backwards compactibility I think .But I change the content of&lt;br/&gt;
sstable&#65288;adding a new base type for partitionordertype&#65289;.&#128517;&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Could you explain why this needs to change what is written? It&apos;s not clear to me, nor from skimming the patch. If this does change what is written it &lt;em&gt;must&lt;/em&gt; bump the sstable version, but I&apos;d like to understand what&apos;s changing and why, so we can figure out if this needs to be a minor or major bump.&lt;/p&gt;</comment>
                            <comment id="17691161" author="blambov" created="Mon, 20 Feb 2023 12:55:24 +0000"  >&lt;p&gt;Before the patch, &lt;tt&gt;PartitionerDefinedOrder&lt;/tt&gt; provided no information about the type of data that is contained in the clustering key of the index table. As a result it was not possible to print the value for &lt;tt&gt;sstabledump&lt;/tt&gt;. This patch adds a base type to the definition of the clustering column type, so that it can be properly interpreted. Since this type definition is not readable by older versions of the code, the header of an sstable written after this patch that contains a clustering column of this type (i.e. a legacy secondary index table) will not be readable by older versions, and thus they will not be able to open the sstable.&lt;/p&gt;</comment>
                            <comment id="17691167" author="maxwellguo" created="Mon, 20 Feb 2023 13:03:34 +0000"  >&lt;p&gt;For the original secondary index table just use the original data table&apos;s partition key as the first clusting key , but the data type is PartitionerDefinedOrder , but this case do not implement the toJSONString method(I think that is not really data type can be used for this).&lt;br/&gt;
So at first I have got two way to fix this problem,&lt;br/&gt;
1: add a partitionKeyType in the PartitionerDefinedOrder as this patch described ,but the PartitionerDefinedOrder &apos;s toString result will be store in the meta file of sstable, this way I changed the sstable content;&lt;br/&gt;
2.use the partitionkey real type as the secondary index table&apos;s first clustering key (not PartitionerDefinedOrder), but this will also change the content of secondary index&apos;s table &apos;s sstable file( the old version &apos;s sstable file &apos;s meta store the PartitionerDefinedOrder&apos;s toString , now change to data table&apos;s paritition key toString ) &lt;a href=&quot;https://github.com/apache/cassandra/pull/2118/files#diff-a7e8323c9332e6c0d12b0ef92709fa241342fc505a4bdf144b146e9f22cb9adaR738&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;here&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Both can solve the problem, and both change the content of sstable.For me I have chosen the first one ,as I use PartitionerDefinedOrder as index&apos;s table&apos;s first clusting key, and I just want to implement the toJSONString method , for the old version that do not have a paritionKeyType in &lt;br/&gt;
 PartitionerDefinedOrder the original method path can be executed.&lt;br/&gt;
Besides, I think this is a low risk modification method, for I do not change the original schema of secondary index(the first clustering key type is still PartitionerDefinedOrder).&lt;/p&gt;
</comment>
                            <comment id="17691172" author="benedict" created="Mon, 20 Feb 2023 13:15:16 +0000"  >&lt;p&gt;I see, there is some string parsing from the type info in &lt;tt&gt;SerializationHeader&lt;/tt&gt;.&lt;/p&gt;

&lt;p&gt;Like most of the other recent sstable changes, it seems pretty unnecessary to make a major version bump here, when we could either serialise this additional information to the end of the header, or serialise the type twice (once with extra info).&lt;/p&gt;

&lt;p&gt;And arguably, since this is a bug, we really &lt;em&gt;should&lt;/em&gt; be doing this so it can be fixed in released versions (though it&apos;s a minor bug AFAICT, so probably fine to remain unpatched)&lt;/p&gt;</comment>
                            <comment id="17696646" author="maxwellguo" created="Mon, 6 Mar 2023 01:47:54 +0000"  >&lt;p&gt;I saw &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-17056&quot; title=&quot;CEP-17 &#8211; Pluggable SSTable format (SSTable format API)&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-17056&quot;&gt;&lt;del&gt;CASSANDRA-17056&lt;/del&gt;&lt;/a&gt; change the sstable version to &quot;g&quot;, so It means this patch do not neet to wait for C* 5.0 ? just can be check int after &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-17056&quot; title=&quot;CEP-17 &#8211; Pluggable SSTable format (SSTable format API)&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-17056&quot;&gt;&lt;del&gt;CASSANDRA-17056&lt;/del&gt;&lt;/a&gt; , right ?  &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=blambov&quot; class=&quot;user-hover&quot; rel=&quot;blambov&quot;&gt;blambov&lt;/a&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=adelapena&quot; class=&quot;user-hover&quot; rel=&quot;adelapena&quot;&gt;adelapena&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17697706" author="maxwellguo" created="Wed, 8 Mar 2023 03:05:59 +0000"  >&lt;p&gt;It seems  &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-17973&quot; title=&quot;Change trunk 4.2 to 5.0&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-17973&quot;&gt;&lt;del&gt;CASSANDRA-17973&lt;/del&gt;&lt;/a&gt; have also been closed, so this patch can be checkin now ? &lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=blambov&quot; class=&quot;user-hover&quot; rel=&quot;blambov&quot;&gt;blambov&lt;/a&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=adelapena&quot; class=&quot;user-hover&quot; rel=&quot;adelapena&quot;&gt;adelapena&lt;/a&gt;&lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/biggrin.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="17697928" author="adelapena" created="Wed, 8 Mar 2023 14:27:11 +0000"  >&lt;p&gt;I don&apos;t think that &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-17056&quot; title=&quot;CEP-17 &#8211; Pluggable SSTable format (SSTable format API)&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-17056&quot;&gt;&lt;del&gt;CASSANDRA-17056&lt;/del&gt;&lt;/a&gt; has done a major sstable format bump to &quot;ga&quot;. It seem it&apos;s still &quot;nc&quot;, as it can be seen &lt;a href=&quot;https://github.com/apache/cassandra/blob/b7e1e44a909c3a1d11e9c387db680c74d31b879f/src/java/org/apache/cassandra/io/sstable/format/big/BigFormat.java#L366&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;here&lt;/a&gt;. That hasn&apos;t changed with the bump to 5.0 either.&lt;/p&gt;

&lt;p&gt;Regarding whether we want to make a major sstable format bump on 5.0 for this, I think that the bug is not so serious to be the only reason to do that bump. But we can always ask on the dev mail list and see what others think.&lt;/p&gt;

&lt;p&gt;As for the workaround for older branches, I understand that&apos;s to be done in the separate &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-18254&quot; title=&quot;sstabledump for secondary index sstable error&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-18254&quot;&gt;CASSANDRA-18254&lt;/a&gt;, but I don&apos;t understand why that one is closed as &quot;Won&apos;t Fix&quot;.&lt;/p&gt;</comment>
                            <comment id="17701052" author="maxwellguo" created="Thu, 16 Mar 2023 09:24:20 +0000"  >&lt;p&gt;Sorry for the late reply, I didn&apos;t notice that the file format version didn&apos;t  change yet. I do aggree we should accept the path when the file format come to the next version, as this patch only made a smll change to file content. &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=adelapena&quot; class=&quot;user-hover&quot; rel=&quot;adelapena&quot;&gt;adelapena&lt;/a&gt;&lt;br/&gt;
As for &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-18254&quot; title=&quot;sstabledump for secondary index sstable error&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-18254&quot;&gt;CASSANDRA-18254&lt;/a&gt; I  later think may be &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-17698&quot; title=&quot;sstabledump errors when dumping data from index&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-17698&quot;&gt;&lt;del&gt;CASSANDRA-17698&lt;/del&gt;&lt;/a&gt; is enough&#65292;So I closed it.&lt;/p&gt;</comment>
                            <comment id="17729362" author="adelapena" created="Mon, 5 Jun 2023 15:39:51 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=maxwellguo&quot; class=&quot;user-hover&quot; rel=&quot;maxwellguo&quot;&gt;maxwellguo&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-14227&quot; title=&quot;Extend maximum expiration date&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-14227&quot;&gt;&lt;del&gt;CASSANDRA-14227&lt;/del&gt;&lt;/a&gt; has just added a new&#160;&quot;oa&quot; sstable major version that can get the changes proposed here. And there is also the new trie format introduced by &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-18398&quot; title=&quot;CEP-25: Trie-indexed SSTable format&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-18398&quot;&gt;&lt;del&gt;CASSANDRA-18398&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="17729595" author="maxwellguo" created="Tue, 6 Jun 2023 05:39:04 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=adelapena&quot; class=&quot;user-hover&quot; rel=&quot;adelapena&quot;&gt;adelapena&lt;/a&gt; Thanks&#65292; I will update the last PR for trunk .&lt;/p&gt;</comment>
                            <comment id="17730376" author="maxwellguo" created="Thu, 8 Jun 2023 04:02:08 +0000"  >&lt;p&gt;&lt;a href=&quot;https://github.com/apache/cassandra/pull/2118&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;pr-trunk-update&lt;/a&gt;&lt;br/&gt;
&lt;a href=&quot;https://app.circleci.com/pipelines/github/Maxwell-Guo/cassandra/446/workflows/4570a05e-49e9-438d-8119-6fe96ffeaed9&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;j8-prcommit&lt;/a&gt;&lt;br/&gt;
&lt;a href=&quot;https://app.circleci.com/pipelines/github/Maxwell-Guo/cassandra/446/workflows/ddbf467a-efb2-4de1-bc35-1b9890cb76e8&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;j11-precommit&lt;/a&gt;&lt;br/&gt;
java8 and java11&apos;s uts are all green ,but some dtest is not green . I took a look at the failed cases, most of which are related to insufficient resources.&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=adelapena&quot; class=&quot;user-hover&quot; rel=&quot;adelapena&quot;&gt;adelapena&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17730947" author="adelapena" created="Fri, 9 Jun 2023 12:47:28 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=maxwellguo&quot; class=&quot;user-hover&quot; rel=&quot;maxwellguo&quot;&gt;maxwellguo&lt;/a&gt; the patch for trunk mostly looks good, but it doesn&apos;t check what sstable format version is being used.&lt;/p&gt;

&lt;p&gt;Although there is a new &quot;oa&quot; version, and also the new trie format, the server can still be using an older format. In fact, the sstable format version depends on the recently added&#160;&lt;a href=&quot;https://github.com/apache/cassandra/blob/trunk/conf/cassandra.yaml#L1979-L2004&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;storage_compatibility_mode&lt;/a&gt;. That property defaults to &lt;tt&gt;CASSANDRA_4&lt;/tt&gt; to keep the data readable for Cassandra 4. So the default sstable format version is still &quot;nc&quot; (see &lt;a href=&quot;https://github.com/apache/cassandra/blob/trunk/src/java/org/apache/cassandra/io/sstable/format/big/BigFormat.java#L356&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;here&lt;/a&gt;). The patch changes the meaning of the format, so if it&apos;s used on 5.0 with &quot;na&quot; format and &lt;tt&gt;CASSANDRA_4&lt;/tt&gt; compatibility, the written data won&apos;t be readable for Cassandra 4.&lt;/p&gt;

&lt;p&gt;I think we should simply add a check on &lt;tt&gt;CassandraIndex&lt;/tt&gt; to preserve the old behaviour if &lt;tt&gt;DatabaseDescriptor.getStorageCompatibilityMode().isBefore(5)&lt;/tt&gt;.&lt;/p&gt;

&lt;p&gt;All unit tests are run with &quot;nc&quot;, &quot;oa&quot; and tries. So probably&#160;&lt;tt&gt;SecondaryIndexSSTableExportTest&lt;/tt&gt; should also take into account the used sstable format.&lt;/p&gt;

&lt;p&gt;As for CI, I&apos;ll run it with more resources when the compatibility issue is addressed.&lt;/p&gt;</comment>
                            <comment id="17730962" author="maxwellguo" created="Fri, 9 Jun 2023 13:47:52 +0000"  >&lt;p&gt;OK&#65292;thank you for your reminder. I think this is a very constructive suggestion.I will update this patch latter. &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=adelapena&quot; class=&quot;user-hover&quot; rel=&quot;adelapena&quot;&gt;adelapena&lt;/a&gt; &lt;/p&gt;</comment>
                            <comment id="17732330" author="maxwellguo" created="Wed, 14 Jun 2023 02:54:51 +0000"  >&lt;p&gt;&lt;a href=&quot;https://github.com/apache/cassandra/pull/2118&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;pr-trunk&lt;/a&gt;&lt;br/&gt;
&lt;a href=&quot;https://app.circleci.com/pipelines/github/Maxwell-Guo/cassandra/452/workflows/8c28fa4e-a4b6-49e5-87f1-50bfbea1a223&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;java11&lt;/a&gt;&lt;br/&gt;
&lt;a href=&quot;https://app.circleci.com/pipelines/github/Maxwell-Guo/cassandra/452/workflows/0a5a3e9b-d9a5-49dc-8031-ea89de675712&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;java8&lt;/a&gt;&lt;br/&gt;
java11 &apos;s precommit for unit are almost all green ,but dtest are not , and it seems these red are related to insufficient resources; java11&apos;s ut for system_keyspace_directory is red, but I run locally , it passed.&lt;br/&gt;
java8&apos;s dtest are and utests_compression are red, other uts are green , theses dtest are claused by resources, and I ran utests_compression locally , the failed test passed.&lt;br/&gt;
So I think it need some more resources for CI  after you +1 on the changes &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=adelapena&quot; class=&quot;user-hover&quot; rel=&quot;adelapena&quot;&gt;adelapena&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17732643" author="adelapena" created="Wed, 14 Jun 2023 16:48:06 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=maxwellguo&quot; class=&quot;user-hover&quot; rel=&quot;maxwellguo&quot;&gt;maxwellguo&lt;/a&gt; Thanks for the changes.&lt;/p&gt;

&lt;p&gt;I have added a couple of suggestions on the PR, put them on &lt;a href=&quot;https://github.com/adelapena/cassandra/commit/989058a17ed5475a24766b52dd2dae19116560e7&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;this commit&lt;/a&gt;, and started CI:&lt;/p&gt;
&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;Branch&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;CI&lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/adelapena/cassandra/commits/17698-trunk-review-feedback&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;trunk&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://app.circleci.com/pipelines/github/adelapena/cassandra/2959/workflows/d7bc1213-5a98-48fe-bffc-a20cea35cfef&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;j8&lt;/a&gt; &lt;a href=&quot;https://app.circleci.com/pipelines/github/adelapena/cassandra/2959/workflows/d1f162cf-9ffa-4da0-9ff7-d9a3b5a35477&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;j11&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;


&lt;p&gt;I&apos;m also reopening &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-18254&quot; title=&quot;sstabledump for secondary index sstable error&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-18254&quot;&gt;CASSANDRA-18254&lt;/a&gt;, since we don&apos;t have a fix nor a workaround for 3.0, 3.11, 4.0 and 4.1, nor for 5.0 in compatibility mode.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=blambov&quot; class=&quot;user-hover&quot; rel=&quot;blambov&quot;&gt;blambov&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=smiklosovic&quot; class=&quot;user-hover&quot; rel=&quot;smiklosovic&quot;&gt;smiklosovic&lt;/a&gt; are you ok with the changes?&lt;/p&gt;</comment>
                            <comment id="17732816" author="maxwellguo" created="Thu, 15 Jun 2023 01:51:13 +0000"  >&lt;p&gt;Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=adelapena&quot; class=&quot;user-hover&quot; rel=&quot;adelapena&quot;&gt;adelapena&lt;/a&gt;, the ci looks good ,except for &lt;a href=&quot;https://app.circleci.com/pipelines/github/adelapena/cassandra/2959/workflows/d7bc1213-5a98-48fe-bffc-a20cea35cfef/jobs/50998/parallel-runs/4?filterBy=FAILED&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;j8 dtest-vnode&lt;/a&gt;&lt;br/&gt;
and it seems this failed case have some relation with &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-18361&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;CASSANDRA-18361&lt;/a&gt;&lt;br/&gt;
And I am going to address those suggestions.&lt;/p&gt;</comment>
                            <comment id="17732823" author="maxwellguo" created="Thu, 15 Jun 2023 02:36:06 +0000"  >&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;Branch&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;CI&lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/apache/cassandra/pull/2118/files#&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;pr-trunk&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://app.circleci.com/pipelines/github/Maxwell-Guo/cassandra/456/workflows/466ce173-e875-41c9-9617-7692b328a5d2&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;j8&lt;/a&gt;  &lt;a href=&quot;https://app.circleci.com/pipelines/github/Maxwell-Guo/cassandra/456/workflows/3e09ea27-83e2-43ca-8174-9f0bde48e13e&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;j11&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=blambov&quot; class=&quot;user-hover&quot; rel=&quot;blambov&quot;&gt;blambov&lt;/a&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=smiklosovic&quot; class=&quot;user-hover&quot; rel=&quot;smiklosovic&quot;&gt;smiklosovic&lt;/a&gt;Would you mind to take a look agagin? And as for &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-18254&quot; title=&quot;sstabledump for secondary index sstable error&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-18254&quot;&gt;CASSANDRA-18254&lt;/a&gt; I will try to fix it quickly.&lt;/p&gt;

&lt;p&gt;This issue seems to be coming to an end&lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/wink.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; &lt;/p&gt;</comment>
                            <comment id="17734064" author="maxwellguo" created="Mon, 19 Jun 2023 08:48:29 +0000"  >&lt;p&gt;hello &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=adelapena&quot; class=&quot;user-hover&quot; rel=&quot;adelapena&quot;&gt;adelapena&lt;/a&gt;, it seems &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=blambov&quot; class=&quot;user-hover&quot; rel=&quot;blambov&quot;&gt;blambov&lt;/a&gt; have approved the pr&#65292;can you take a look agagin&#65311;&lt;/p&gt;</comment>
                            <comment id="17734126" author="smiklosovic" created="Mon, 19 Jun 2023 11:08:05 +0000"  >&lt;p&gt;I am removing myself from this ticket, I dont have a lot of time to review this at the moment.&lt;/p&gt;</comment>
                            <comment id="17734174" author="adelapena" created="Mon, 19 Jun 2023 13:01:07 +0000"  >&lt;p&gt;Committed to &lt;tt&gt;trunk&lt;/tt&gt; as &lt;a href=&quot;https://github.com/apache/cassandra/commit/cc3e742c735daddc29d2fb90aac638c641463d39&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;cc3e742c735daddc29d2fb90aac638c641463d39&lt;/a&gt;.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10032">
                    <name>Blocker</name>
                                                                <inwardlinks description="is blocked by">
                                        <issuelink>
            <issuekey id="13487000">CASSANDRA-17973</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                            <issuelinktype id="12310460">
                    <name>Child-Issue</name>
                                                                <inwardlinks description="is a child of">
                                        <issuelink>
            <issuekey id="13524145">CASSANDRA-18254</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[maxwellguo]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12313825" key="com.atlassian.jira.plugin.system.customfieldtypes:cascadingselect">
                        <customfieldname>Bug Category</customfieldname>
                        <customfieldvalues>
                                                    <customfieldvalue key="12982" cascade-level=""><![CDATA[Correctness]]></customfieldvalue>
            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12313821" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Complexity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12965"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313822" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Discovered By</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12977"><![CDATA[Adhoc Test]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12313922" key="jira.plugin.projectspecificselectfield.jpssf:multicftype">
                        <customfieldname>Impacts</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="13100"><![CDATA[None]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            2 years, 21 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12313921" key="jira.plugin.projectspecificselectfield.jpssf:multicftype">
                        <customfieldname>Platform</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="13076"><![CDATA[All]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z13bxc:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[adelapena]]></customfieldvalue>
        <customfieldvalue><![CDATA[blambov]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12962"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12311420" key="com.atlassian.jira.plugin.system.customfieldtypes:version">
                        <customfieldname>Since Version</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="12334792">3.0.4</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313924" key="com.atlassian.jira.plugin.system.customfieldtypes:textfield">
                        <customfieldname>Source Control Link</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>&lt;p&gt;&lt;a href=&quot;https://github.com/apache/cassandra/commit/cc3e742c735daddc29d2fb90aac638c641463d39&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/cassandra/commit/cc3e742c735daddc29d2fb90aac638c641463d39&lt;/a&gt;&lt;/p&gt;</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313823" key="com.atlassian.jira.plugin.system.customfieldtypes:textarea">
                        <customfieldname>Test and Documentation Plan</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>&lt;p&gt;ut &lt;/p&gt;</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>