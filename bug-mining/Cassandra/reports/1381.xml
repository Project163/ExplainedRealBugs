<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 22:28:34 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-3711] Unsustainable Thread Accumulation in ParallelCompactionIterable.Reducer ThreadPoolExecutor</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-3711</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;With multithreaded compaction enabled, it looks like Reducer creates a new thread pool for every compaction.  These pools seem to just sit around - i.e. &quot;executor.shutdown()&quot; never gets called and the Threads live forever waiting for tasks that will never come.  For instance...&lt;/p&gt;


&lt;p&gt;Name: CompactionReducer:1&lt;br/&gt;
State: TIMED_WAITING on java.util.concurrent.SynchronousQueue$TransferStack@72938aea&lt;br/&gt;
Total blocked: 0  Total waited: 1&lt;/p&gt;

&lt;p&gt;Stack trace: &lt;br/&gt;
 sun.misc.Unsafe.park(Native Method)&lt;br/&gt;
java.util.concurrent.locks.LockSupport.parkNanos(LockSupport.java:226)&lt;br/&gt;
java.util.concurrent.SynchronousQueue$TransferStack.awaitFulfill(SynchronousQueue.java:460)&lt;br/&gt;
java.util.concurrent.SynchronousQueue$TransferStack.transfer(SynchronousQueue.java:359)&lt;br/&gt;
java.util.concurrent.SynchronousQueue.poll(SynchronousQueue.java:942)&lt;br/&gt;
java.util.concurrent.ThreadPoolExecutor.getTask(ThreadPoolExecutor.java:1043)&lt;br/&gt;
java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1103)&lt;br/&gt;
java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:603)&lt;br/&gt;
java.lang.Thread.run(Thread.java:722)&lt;/p&gt;</description>
                <environment>&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Linux version 2.6.32-71.29.1.el6.x86_64 (mockbuild@c6b5.bsys.dev.centos.org) (gcc version 4.4.4 20100726 (Red Hat 4.4.4-13) (GCC) ) #1 SMP Mon Jun 27 19:49:27 BST 2011&lt;/li&gt;
	&lt;li&gt;java version &quot;1.7.0_01&quot; / Java(TM) SE Runtime Environment (build 1.7.0_01-b08) / Java HotSpot(TM) 64-Bit Server VM (build 21.1-b02, mixed mode)&lt;/li&gt;
&lt;/ul&gt;
</environment>
        <key id="12537700">CASSANDRA-3711</key>
            <summary>Unsustainable Thread Accumulation in ParallelCompactionIterable.Reducer ThreadPoolExecutor</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10003" iconUrl="https://issues.apache.org/jira/images/icons/priorities/trivial.svg">Low</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="jbellis">Jonathan Ellis</assignee>
                                    <reporter username="maedhroz">Caleb Rackliffe</reporter>
                        <labels>
                            <label>compaction</label>
                            <label>memory_leak</label>
                            <label>threading</label>
                            <label>threads</label>
                    </labels>
                <created>Sun, 8 Jan 2012 23:46:40 +0000</created>
                <updated>Tue, 16 Apr 2019 09:32:43 +0000</updated>
                            <resolved>Tue, 10 Jan 2012 08:29:22 +0000</resolved>
                                        <fixVersion>1.0.7</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                                                                <comments>
                            <comment id="13182362" author="jbellis" created="Mon, 9 Jan 2012 04:12:06 +0000"  >&lt;p&gt;You&apos;re absolutely right.  Patch attached.&lt;/p&gt;</comment>
                            <comment id="13182432" author="maedhroz" created="Mon, 9 Jan 2012 09:50:45 +0000"  >&lt;p&gt;Would it be useful to just create the executor once and reuse it for all compactions, then get rid of it in a shutdown hook or something similar?  I&apos;ve attached a patch, 3711.2.txt, that does roughly that, if you want to take a look.&lt;/p&gt;</comment>
                            <comment id="13182434" author="maedhroz" created="Mon, 9 Jan 2012 09:53:42 +0000"  >&lt;p&gt;I guess I should grant the license, just in case &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/wink.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="13182659" author="jbellis" created="Mon, 9 Jan 2012 17:37:30 +0000"  >&lt;p&gt;That changes the behavior, though, since now you have a single pool of AvailableProcessors across all compactions, rather than one per compaction.  Increasing the thread count proportionate to concurrent compactions setting isn&apos;t a silver bullet either, since you would still have the possibility of a large compaction &quot;starving&quot; out smaller ones, which was the problem that concurrent compactions were introduced to solve.&lt;/p&gt;</comment>
                            <comment id="13182689" author="maedhroz" created="Mon, 9 Jan 2012 18:28:18 +0000"  >&lt;p&gt;Yeah, I think you&apos;re right.  In retrospect, my idea would only have been useful (maybe) if the compactions were CPU-bound, which I guess is not the case.&lt;/p&gt;

&lt;p&gt;I can&apos;t wait for this release, because I can stop doing rolling restarts every few days!&lt;/p&gt;</comment>
                            <comment id="13183142" author="slebresne" created="Tue, 10 Jan 2012 08:29:22 +0000"  >&lt;p&gt;+1 on v1, committed.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12509889" name="3711.2.txt" size="5233" author="maedhroz" created="Mon, 9 Jan 2012 09:53:42 +0000"/>
                            <attachment id="12509875" name="3711.txt" size="1918" author="jbellis" created="Mon, 9 Jan 2012 04:12:06 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[jbellis]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>223206</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            13 years, 46 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0gnb3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>95206</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>slebresne</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[slebresne]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12961"><![CDATA[Low]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>