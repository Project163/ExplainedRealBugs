<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 22:57:56 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-10124] Support for multi-column indexes</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-10124</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;Since &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-6717&quot; title=&quot;Modernize schema tables&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-6717&quot;&gt;&lt;del&gt;CASSANDRA-6717&lt;/del&gt;&lt;/a&gt; decoupled a secondary index from a single column, we can expand support for indexes with multiple target columns and for row-based indexes with truly dynamic targets.  &lt;/p&gt;

&lt;p&gt;Much of the plumbing for this has been done in &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-7771&quot; title=&quot;Allow multiple 2ndary index on the same column&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-7771&quot;&gt;&lt;del&gt;CASSANDRA-7771&lt;/del&gt;&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-6717&quot; title=&quot;Modernize schema tables&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-6717&quot;&gt;&lt;del&gt;CASSANDRA-6717&lt;/del&gt;&lt;/a&gt; &amp;amp; by the API rework in &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-9459&quot; title=&quot;SecondaryIndex API redesign&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-9459&quot;&gt;&lt;del&gt;CASSANDRA-9459&lt;/del&gt;&lt;/a&gt;. What remains is:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;Decide on syntax for DDL statements&lt;/li&gt;
	&lt;li&gt;Decide on WHERE clause syntax for SELECT (there is some discussion on this in the comments of &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-9459&quot; title=&quot;SecondaryIndex API redesign&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-9459&quot;&gt;&lt;del&gt;CASSANDRA-9459&lt;/del&gt;&lt;/a&gt;)&lt;/li&gt;
&lt;/ul&gt;
</description>
                <environment></environment>
        <key id="12857036">CASSANDRA-10124</key>
            <summary>Support for multi-column indexes</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10002" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Normal</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="samt">Sam Tunnicliffe</assignee>
                                    <reporter username="samt">Sam Tunnicliffe</reporter>
                        <labels>
                    </labels>
                <created>Tue, 18 Aug 2015 21:18:54 +0000</created>
                <updated>Wed, 12 Aug 2020 21:18:17 +0000</updated>
                            <resolved>Fri, 18 Sep 2015 10:10:12 +0000</resolved>
                                        <fixVersion>3.0.0 rc1</fixVersion>
                                    <component>Legacy/CQL</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>9</watches>
                                                                                                                <comments>
                            <comment id="14712882" author="beobal" created="Wed, 26 Aug 2015 10:14:15 +0000"  >&lt;p&gt;Some proposals for syntax:&lt;/p&gt;

&lt;h6&gt;&lt;a name=&quot;MulticolumncustomindexDDL&quot;&gt;&lt;/a&gt;Multi column custom index DDL&lt;/h6&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;CREATE CUSTOM INDEX ON test_table(col1, col2, col3) USING &lt;span class=&quot;code-quote&quot;&gt;&apos;com.foo.bar.CustomIndex&apos;&lt;/span&gt;;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt; 
&lt;p&gt;When the targets include non-frozen collections, I think in general we should disallow the use of qualifiers, i.e. keys()/entries(). The main reason for including those when creating non-custom indexes is so C* can select the right index implementation, but for CUSTOM indexes that&apos;s done explicitly. Another argument is a practical one; when we store that info in schema tables it&apos;s always been with assumption of a single target column, so we have never needed to explicitly link the qualifier to a column. Its representation is as a key without a value; in pre-6717 schema in the json string in &lt;tt&gt;system.schema_columns.index_options&lt;/tt&gt;, and in 3.0 in the native map &lt;tt&gt;system_schema.indexes.options&lt;/tt&gt;.&lt;/p&gt;

&lt;h6&gt;&lt;a name=&quot;RowbasedcustomindexDDL&quot;&gt;&lt;/a&gt;Row based custom index DDL&lt;/h6&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;CREATE CUSTOM INDEX ON test_table USING &lt;span class=&quot;code-quote&quot;&gt;&apos;com.foo.bar.CustomIndex&apos;&lt;/span&gt;;
CREATE CUSTOM INDEX ON test_table() USING &lt;span class=&quot;code-quote&quot;&gt;&apos;com.foo.bar.CustomIndex&apos;&lt;/span&gt;;
CREATE CUSTOM ROW INDEX ON test_table USING &lt;span class=&quot;code-quote&quot;&gt;&apos;com.foo.bar.CustomIndex&apos;&lt;/span&gt;;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Personally, I prefer the first option for simplicity.&lt;/p&gt;

&lt;h6&gt;&lt;a name=&quot;Selectsyntax&quot;&gt;&lt;/a&gt;Select syntax&lt;/h6&gt;

&lt;p&gt;There are 2 parts to this, modifying the relations syntax so to extend beyond the usual &lt;tt&gt;&amp;lt;identifier&amp;gt; &amp;lt;operator&amp;gt; &amp;lt;term&amp;gt;&lt;/tt&gt; syntax and adding a means to force (or at least suggest) a specific index be used for a particular query. Both are required for true row based indexes, but I think the latter could also be used with single and multicolumn indexes.&lt;/p&gt;

&lt;p&gt;For providing an explicit instruction to C* that it should bypass the usual index selection mechanisms and force the use of a particular index I propose adding an optional &lt;tt&gt;USING INDEX&lt;/tt&gt; to the &lt;tt&gt;SELECT&lt;/tt&gt; syntax. The change to decouple a query term from a particular column identifier could be as simple as just allowing a standalone string literal in the &lt;tt&gt;WHERE&lt;/tt&gt; clause, or if we want to be more explicit we could introduce a pseudo function in the system keyspace along the lines of &lt;tt&gt;token()&lt;/tt&gt;.&lt;/p&gt;

&lt;p&gt;To take one of the examples from the &lt;a href=&quot;https://github.com/Stratio/cassandra-lucene-index&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;Stratio docs&lt;/a&gt;:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;SELECT * FROM tweets WHERE lucene=&apos;{
    filter : {type:&lt;span class=&quot;code-quote&quot;&gt;&quot;range&quot;&lt;/span&gt;, field:&lt;span class=&quot;code-quote&quot;&gt;&quot;time&quot;&lt;/span&gt;, lower:&lt;span class=&quot;code-quote&quot;&gt;&quot;2014/04/25&quot;&lt;/span&gt;, upper:&lt;span class=&quot;code-quote&quot;&gt;&quot;2014/05/1&quot;&lt;/span&gt;},
    query  : {type:&lt;span class=&quot;code-quote&quot;&gt;&quot;phrase&quot;&lt;/span&gt;, field:&lt;span class=&quot;code-quote&quot;&gt;&quot;body&quot;&lt;/span&gt;, value:&lt;span class=&quot;code-quote&quot;&gt;&quot;big data gives organizations&quot;&lt;/span&gt;, slop:1}
}&apos; 
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The &lt;tt&gt;lucene&lt;/tt&gt; field is a dummy column that has to be added to the table in order to associate the pre-3.0 row-based index with the &lt;tt&gt;tweets&lt;/tt&gt; table. We could rewrite this query as:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;SELECT * FROM tweets 
WHERE expr(&apos;{filter : {type:&lt;span class=&quot;code-quote&quot;&gt;&quot;range&quot;&lt;/span&gt;, field:&lt;span class=&quot;code-quote&quot;&gt;&quot;time&quot;&lt;/span&gt;, lower:&lt;span class=&quot;code-quote&quot;&gt;&quot;2014/04/25&quot;&lt;/span&gt;, upper:&lt;span class=&quot;code-quote&quot;&gt;&quot;2014/05/1&quot;&lt;/span&gt;},
             query  : {type:&lt;span class=&quot;code-quote&quot;&gt;&quot;phrase&quot;&lt;/span&gt;, field:&lt;span class=&quot;code-quote&quot;&gt;&quot;body&quot;&lt;/span&gt;, value:&lt;span class=&quot;code-quote&quot;&gt;&quot;big data gives organizations&quot;&lt;/span&gt;, slop:1}}&apos;) 
USING INDEX lucene;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;In this version &lt;tt&gt;lucene&lt;/tt&gt; is the name of the index, rather than a column and the query string itself is wrapped in the &lt;tt&gt;expr()&lt;/tt&gt; function. &lt;/p&gt;

&lt;p&gt;As mentioned, we could also allow &lt;tt&gt;USING INDEX&lt;/tt&gt; with the usual relation syntax, for example:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;CREATE TABLE ks.t1(k &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;, v1 &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;, v2 &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;, PRIMARY KEY (k));
CREATE INDEX v1_idx ON ks.t1(v1);
CREATE INDEX v2_idx ON ks.t1(v2);
CREATE CUSTOM INDEX v1_v2_idx ON ks.t1(v1, v2) USING &lt;span class=&quot;code-quote&quot;&gt;&apos;com.foo.bar.CustomMultiColumnIndex&apos;&lt;/span&gt;;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;There are couple of things to consider about querying this table using the indexes:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;SELECT * FROM ks.t1 WHERE v1=0 AND v2=0 ALLOW FILTERING;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;ul&gt;
	&lt;li&gt;Even though we have an index which covers both &lt;tt&gt;v1&lt;/tt&gt; and &lt;tt&gt;v2&lt;/tt&gt;, there&apos;s no guarantee that the query will use it, as the either of the regular indexes may be considered more selective under the current scheme (or even equally selective, in which case the choice is undefined).&lt;/li&gt;
	&lt;li&gt;Even if we &lt;b&gt;only&lt;/b&gt; have the custom index we still need to &lt;tt&gt;ALLOW FILTERING&lt;/tt&gt; as the index expressions are only ever considered individually, so if there is &amp;gt; 1 &lt;tt&gt;ALLOW FILTERING&lt;/tt&gt; is always required.&lt;/li&gt;
&lt;/ul&gt;


&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;SELECT * FROM ks.t1 WHERE v1=0 AND v2=0 USING v1_v2_idx;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;We could allow &lt;tt&gt;USING INDEX&lt;/tt&gt; both to force the choice of index and to override the requirement for &lt;tt&gt;ALLOW FILTERING&lt;/tt&gt;. Perhaps the &lt;tt&gt;ALLOW FILTERING&lt;/tt&gt; override could be dependent on all the restrictions being able to besatisfied by the specified index. Anyway, it seems that something akin to Oracle&apos;s &lt;a href=&quot;http://docs.oracle.com/cd/B19306_01/server.102/b14211/hintsref.htm#CHDJDIAH&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;index hinting&lt;/a&gt; might be generally useful for power users and/or during development.&lt;/p&gt;</comment>
                            <comment id="14713610" author="thobbs" created="Wed, 26 Aug 2015 14:59:34 +0000"  >&lt;blockquote&gt;&lt;p&gt;Even if we only have the custom index we still need to ALLOW FILTERING as the index expressions are only ever considered individually, so if there is &amp;gt; 1 ALLOW FILTERING is always required.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;It seems to me that we need an internal way to express conjunctions and to ask an index if it can handle a particular conjunction.  I&apos;m not convinced that &lt;tt&gt;USING INDEX&lt;/tt&gt; should automatically remove the need for &lt;tt&gt;ALLOW FILTERING&lt;/tt&gt;.  For example, if &lt;tt&gt;USING INDEX v1_idx&lt;/tt&gt; were used instead, the query would still require filtering.&lt;/p&gt;</comment>
                            <comment id="14713620" author="beobal" created="Wed, 26 Aug 2015 15:02:46 +0000"  >&lt;blockquote&gt;&lt;p&gt;I&apos;m not convinced that USING INDEX should automatically remove the need for ALLOW FILTERING&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;That&apos;s why I added  &lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;Perhaps the ALLOW FILTERING override could be dependent on all the restrictions being able to besatisfied by the specified index&lt;/p&gt;&lt;/blockquote&gt;</comment>
                            <comment id="14713632" author="thobbs" created="Wed, 26 Aug 2015 15:08:06 +0000"  >&lt;p&gt;Ah, sorry, didn&apos;t read carefully enough.&lt;/p&gt;</comment>
                            <comment id="14718275" author="beobal" created="Fri, 28 Aug 2015 09:34:39 +0000"  >&lt;p&gt;Digging into this, there are actually several strands that can (and probably should) be pulled out into separate issues.&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;Index hinting, that is an extension to &lt;tt&gt;SELECT&lt;/tt&gt; syntax to enable the user to override the internal method of selecting an appropriate index for a given query. (&lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-10214&quot; title=&quot;Enable index selection to be overridden on a per query basis&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-10214&quot;&gt;CASSANDRA-10214&lt;/a&gt;)&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;Supporting custom query expressions in &lt;tt&gt;WHERE&lt;/tt&gt; clause of &lt;tt&gt;SELECT&lt;/tt&gt;. Parsing and validation of those expressions would be delegated to the custom index implementations which support them. Decoupling this from index hinting per se would require some means of indicating the target index for the expression, but that could be done by supplying the index name as the argument to the expression function. (&lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-10217&quot; title=&quot;Support custom query expressions in SELECT&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-10217&quot;&gt;&lt;del&gt;CASSANDRA-10217&lt;/del&gt;&lt;/a&gt;)&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;Internally, once an index has been identified as being the one that should be used for a given query, it should be included as part of the &lt;tt&gt;ReadCommand&lt;/tt&gt; so that it can be retrieved when needed during execution. Currently we don&apos;t do this, meaning that the index selection process implemented in &lt;tt&gt;SIM::getBestIndexFor&lt;/tt&gt; is run multiple times on both the coordinator and each replica when performing a range command. (&lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-10215&quot; title=&quot;Reduce redundant secondary index selection lookups&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-10215&quot;&gt;&lt;del&gt;CASSANDRA-10215&lt;/del&gt;&lt;/a&gt;)&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;Also, during offline discussions on the subject the necessity of having a distinction between &lt;tt&gt;ROW&lt;/tt&gt; and &lt;tt&gt;COLUMN&lt;/tt&gt; based indexes came up a couple of times, so I&apos;ve opened &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-10216&quot; title=&quot;Remove target type from internal index metadata&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-10216&quot;&gt;&lt;del&gt;CASSANDRA-10216&lt;/del&gt;&lt;/a&gt; to possibly remove that.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Having pulled out those separate tickets, leaves this to focus on just the DDL around multi-target custom indexes. &lt;/p&gt;</comment>
                            <comment id="14718326" author="slebresne" created="Fri, 28 Aug 2015 10:25:29 +0000"  >&lt;blockquote&gt;&lt;p&gt;leaves this to focus on just the DDL around multi-target custom indexes.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I&apos;ll note for the record that my suggestion in &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-10216&quot; title=&quot;Remove target type from internal index metadata&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-10216&quot;&gt;&lt;del&gt;CASSANDRA-10216&lt;/del&gt;&lt;/a&gt; kind of handle that question &quot;for free&quot;.&lt;/p&gt;</comment>
                            <comment id="14718335" author="beobal" created="Fri, 28 Aug 2015 10:33:41 +0000"  >&lt;blockquote&gt;&lt;p&gt;I&apos;ll note for the record that my suggestion in &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-10216&quot; title=&quot;Remove target type from internal index metadata&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-10216&quot;&gt;&lt;del&gt;CASSANDRA-10216&lt;/del&gt;&lt;/a&gt; kind of handle that question &quot;for free&quot;.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;in the meantime I&apos;ve pushed a branch which supports this on top of current 3.0  &lt;a href=&quot;https://github.com/beobal/cassandra/tree/10124-3.0&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;here&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14790901" author="beobal" created="Wed, 16 Sep 2015 18:43:00 +0000"  >&lt;p&gt;Now &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-10216&quot; title=&quot;Remove target type from internal index metadata&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-10216&quot;&gt;&lt;del&gt;CASSANDRA-10216&lt;/del&gt;&lt;/a&gt; is committed, I&apos;ve rebased and pushed a proper version of this for review.&lt;/p&gt;

&lt;p&gt;Patches:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;&lt;a href=&quot;https://github.com/beobal/cassandra/tree/10124-3.0&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;3.0 branch&lt;/a&gt;&lt;/li&gt;
	&lt;li&gt;&lt;a href=&quot;https://github.com/beobal/cassandra/tree/10124-trunk&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;trunk branch&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;CI Tests:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/beobal/job/beobal-10124-3.0-testall/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;3.0 testall&lt;/a&gt;&lt;/li&gt;
	&lt;li&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/beobal/job/beobal-10124-trunk-dtest/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;3.0 dtest&lt;/a&gt;&lt;/li&gt;
	&lt;li&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/beobal/job/beobal-10124-trunk-testall/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;trunk testall&lt;/a&gt;&lt;/li&gt;
	&lt;li&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/beobal/job/beobal-10124-trunk-dtest/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;trunk dtest&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="14802988" author="slebresne" created="Thu, 17 Sep 2015 14:33:43 +0000"  >&lt;p&gt;I don&apos;t have much on the substance, the patch lgtm. Maybe one point is that I wonder if appending all the column names to build the default index name (which btw will look weird for no-arg indexes) is the best strategy. I understand it&apos;s a natural extension of our current strategy, but it feels like it could become unwieldy, and we&apos;ll have to find a better strategy anyway when we have functional index for instance. Anyway, not a big deal and I&apos;d be fine going with this but figure I&apos;d at least raise the concern for discussion.&lt;/p&gt;

&lt;p&gt;On the style however, I do want to bring one point and I somewhat apologize because I realize that it partly enter the realm of personal preference, but I feel that you over-abuse the Stream API and I&apos;m not really a fan.  Typically, I don&apos;t see how:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;List&amp;lt;IndexTarget&amp;gt; targets = rawTargets.stream()
                                      .map(rawTarget -&amp;gt; rawTarget.prepare(cfm))
                                      .collect(Collectors.toList());
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;is better than&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;List&amp;lt;IndexTarget&amp;gt; targets = new ArrayList&amp;lt;&amp;gt;(rawTargets.size());
for (IndexTarget.Raw rawTarget : rawTargets)
    targets.add(rawTarget.prepare(cfm));
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;The latter is not significantly more characters, is more efficient (you don&apos;t allocate a lambda and a stream, and you properly size the output collection right away) and, at this point in time, is a lot more java idiomatic. And if you&apos;re really looking for shorter, then guava&apos;s &lt;tt&gt;Lists.transform&lt;/tt&gt; method is kind of better:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;List&amp;lt;IndexTarget&amp;gt; targets = Lists.transform(rawTargets, t -&amp;gt; t.prepare(cfm));
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Or to take a imo more extreme example, I find &lt;tt&gt;CreateIndexStatement.validateTargetsForMultiColumnIndex&lt;/tt&gt; unreadable when we could just do:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Set&amp;lt;ColumnIdentifier&amp;gt; columns = new HashSet&amp;lt;&amp;gt;();
for (IndexTarget target : targets)
{
    if (!columns.add(target.column))
        throw new InvalidRequestException(&quot;Duplicate column &quot; + target.column + &quot; in index target list&quot;);
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Granted, your version give the full list of duplicated columns, but I really don&apos;t think we care.&lt;/p&gt;

&lt;p&gt;Please don&apos;t get me wrong, I&apos;m not saying we should never use the Stream API, and some of the use in that very patch can be justified. But going from my last reviews of you patches, you seem to use it as a default which, well, I&apos;m not a fan.&lt;/p&gt;</comment>
                            <comment id="14804575" author="beobal" created="Thu, 17 Sep 2015 21:44:40 +0000"  >&lt;p&gt;Fair enough, point taken. I&apos;ve removed the overzealous usage of streams you mentioned. The worst example (in &lt;tt&gt;validateTargetsForMultiColumnIndex&lt;/tt&gt;) was motivated by trying to improve the error message but you&apos;re right, it was certainly a bit overboard. I&apos;m not sure I necessarily agree about the other case, but I&apos;m more than happy to make the change.&lt;/p&gt;

&lt;p&gt;As for the default index name, how about we preserve existing behaviour for single target indexes whilst for anything else have the generated names be simply of the form &lt;tt&gt;table_idx&lt;/tt&gt;, with the existing numeric suffix in the case of duplicates? It&apos;s not a perfect solution, but it fits for indexes without explicit targets and we can revisit it if we need to when we come to add functional indexes.&lt;/p&gt;

&lt;p&gt;Updated, rebased and pushed to the same location.&lt;/p&gt;</comment>
                            <comment id="14805149" author="slebresne" created="Fri, 18 Sep 2015 07:44:20 +0000"  >&lt;blockquote&gt;&lt;p&gt;how about we preserve existing behaviour for single target indexes whilst for anything else have the generated names be simply of the form table_idx, with the existing numeric suffix in the case of duplicates?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Yes, that&apos;s more or less what I add in mind so I would be good with that.&lt;/p&gt;</comment>
                            <comment id="14805217" author="slebresne" created="Fri, 18 Sep 2015 08:34:47 +0000"  >&lt;p&gt;And as I see you&apos;ve already pushed the commit for the index default name change, +1.&lt;/p&gt;</comment>
                            <comment id="14805340" author="beobal" created="Fri, 18 Sep 2015 10:10:12 +0000"  >&lt;p&gt;Thanks, committed in &lt;tt&gt;df3972e9496599f26b76d73df9f4e14f6877c0ce&lt;/tt&gt;&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310040">
                    <name>Required</name>
                                            <outwardlinks description="requires">
                                        <issuelink>
            <issuekey id="12734251">CASSANDRA-7771</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12832182">CASSANDRA-9459</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[samt]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12313922" key="jira.plugin.projectspecificselectfield.jpssf:multicftype">
                        <customfieldname>Impacts</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="13101"><![CDATA[Clients]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 9 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2j2on:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>slebresne</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[slebresne]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12962"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>