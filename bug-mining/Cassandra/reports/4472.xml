<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 23:04:56 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-12697] cdc column addition still breaks schema migration tasks</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-12697</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;This is a followup of &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-12236&quot; title=&quot;RTE from new CDC column breaks in flight queries.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-12236&quot;&gt;&lt;del&gt;CASSANDRA-12236&lt;/del&gt;&lt;/a&gt;, which basically didn&apos;t fully fix the problem. Namely, the fix from &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-12236&quot; title=&quot;RTE from new CDC column breaks in flight queries.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-12236&quot;&gt;&lt;del&gt;CASSANDRA-12236&lt;/del&gt;&lt;/a&gt; skipped the &lt;tt&gt;cdc&lt;/tt&gt; column in &lt;tt&gt;SchemaKeyspace.addTableParamsToRowBuilder()&lt;/tt&gt;, but that method isn&apos;t used by schema &quot;migration tasks&quot; (&lt;tt&gt;MigrationRequestVerbHandler&lt;/tt&gt;, which instead directly send the content of the full schema table it reads from disk. So we still end up with a RTE like &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-12236&quot; title=&quot;RTE from new CDC column breaks in flight queries.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-12236&quot;&gt;&lt;del&gt;CASSANDRA-12236&lt;/del&gt;&lt;/a&gt;. &lt;/p&gt;</description>
                <environment></environment>
        <key id="13007102">CASSANDRA-12697</key>
            <summary>cdc column addition still breaks schema migration tasks</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10002" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Normal</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="slebresne">Sylvain Lebresne</assignee>
                                    <reporter username="slebresne">Sylvain Lebresne</reporter>
                        <labels>
                    </labels>
                <created>Fri, 23 Sep 2016 09:24:46 +0000</created>
                <updated>Tue, 14 Oct 2025 12:13:56 +0000</updated>
                            <resolved>Thu, 29 Sep 2016 15:01:34 +0000</resolved>
                                        <fixVersion>3.10</fixVersion>
                                    <component>Legacy/Distributed Metadata</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>6</watches>
                                                                                                                <comments>
                            <comment id="15516000" author="slebresne" created="Fri, 23 Sep 2016 09:53:52 +0000"  >&lt;p&gt;Attaching a patch below to skip the cdc column if cdc is disabled, like we did in &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-12236&quot; title=&quot;RTE from new CDC column breaks in flight queries.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-12236&quot;&gt;&lt;del&gt;CASSANDRA-12236&lt;/del&gt;&lt;/a&gt;, but on the code path used by schema migration requests:&lt;/p&gt;

&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;a href=&quot;https://github.com/pcmanus/cassandra/commits/12697-trunk&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;12697-trunk&lt;/a&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;a href=&quot;http://cassci.datastax.com/job/pcmanus-12697-trunk-testall&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;utests&lt;/a&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;a href=&quot;http://cassci.datastax.com/job/pcmanus-12697-trunk-dtest&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;dtests&lt;/a&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;


&lt;p&gt;I didn&apos;t noticed that during the testing of &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-12236&quot; title=&quot;RTE from new CDC column breaks in flight queries.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-12236&quot;&gt;&lt;del&gt;CASSANDRA-12236&lt;/del&gt;&lt;/a&gt; because I focused on the upgrade from 2.x to 3.x, but schema migration tasks don&apos;t run then because of the messaging protocol version bump. So this really only affect upgrade from any 3.0.x or pre-CDC 3.x to a post-CDC 3.x.&lt;/p&gt;

&lt;p&gt;An open question however is why our upgrade tests haven&apos;t caught this. It &quot;seems&quot; we run upgrades between 3.0 and 3.9/trunk (see &lt;a href=&quot;http://cassci.datastax.com/job/cassandra-3.9_dtest_upgrade/lastBuild/testReport/upgrade_tests.cql_tests/TestCQLNodes3RF3_Upgrade_current_3_0_x_To_indev_3_x/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;here&lt;/a&gt; for instance) but said tests seem to be all passing, which is pretty suspisious to me because I&apos;m able to reproduce the problem with &lt;a href=&quot;https://github.com/pcmanus/cassandra-dtest/commit/f9c6057aa236be8e73c6cf116f98aa71a3bddf10&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;this beyond trivial upgrade test&lt;/a&gt; (which basically only creates a table and that&apos;s it). That test logs the error 4 times (and fails due to that). So I&apos;m wondering if the upgrade test are really running what they pretend they are running (&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=philipthompson&quot; class=&quot;user-hover&quot; rel=&quot;philipthompson&quot;&gt;philipthompson&lt;/a&gt; would you mind having a quick look to check if anything wrong jumps out, our upgrade tests are a big mystery to me).&lt;/p&gt;</comment>
                            <comment id="15516541" author="philipthompson" created="Fri, 23 Sep 2016 14:02:47 +0000"  >&lt;p&gt;It&apos;s the same exception, with the error &lt;tt&gt;Unknown column cdc during deserialization&lt;/tt&gt;? Yeah, I 100% know why that&apos;s happening. When the original ticket for that was first filed, TE was told it was harmless and to ignore it in the tests. Looks like we never stopped ignoring it. Should I go ahead and change the tests to remove the exemption for this error?&lt;/p&gt;</comment>
                            <comment id="15516591" author="JIRAUSER308715" created="Fri, 23 Sep 2016 14:27:23 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=philipthompson&quot; class=&quot;user-hover&quot; rel=&quot;philipthompson&quot;&gt;philipthompson&lt;/a&gt; yes, we should not be ignoring that error, we should have removed it from being ignored as part of &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-12236&quot; title=&quot;RTE from new CDC column breaks in flight queries.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-12236&quot;&gt;&lt;del&gt;CASSANDRA-12236&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15516616" author="JIRAUSER308715" created="Fri, 23 Sep 2016 14:35:05 +0000"  >&lt;p&gt;Did not review the code, but just reading through it wanted to comment to make sure you put this JIRA number into the place holder you left in SchemaKeyspace makeUpdateForSchema on commit.&lt;/p&gt;</comment>
                            <comment id="15516630" author="slebresne" created="Fri, 23 Sep 2016 14:41:27 +0000"  >&lt;blockquote&gt;&lt;p&gt;make sure you put this JIRA number into the place holder you left in SchemaKeyspace makeUpdateForSchema on commit&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Oops, thanks. I&apos;ll just force-push it right now.&lt;/p&gt;</comment>
                            <comment id="15526099" author="iamaleksey" created="Tue, 27 Sep 2016 13:18:16 +0000"  >&lt;p&gt;LGTM&lt;/p&gt;</comment>
                            <comment id="15533012" author="slebresne" created="Thu, 29 Sep 2016 15:01:34 +0000"  >&lt;p&gt;Committed, thanks.&lt;/p&gt;</comment>
                            <comment id="16460947" author="gabor.auth" created="Wed, 2 May 2018 12:21:54 +0000"  >&lt;p&gt;Hi guys,&lt;/p&gt;

&lt;p&gt;I&apos;ve tried to add a new DC to my cluster and I ran into a CDC bug via schema disagreement between the old DCs and the new DC (with version 3.11.0)...&lt;/p&gt;

&lt;p&gt;I&apos;ve diffed the good and the bad system_scheme tables. The only difference is the `cdc` field in three keyspaces (in `tables` and `views`):&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;the value of `cdc` field on the good node is `False`&lt;/li&gt;
	&lt;li&gt;the value of `cdc` field on the bad node is `null`&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;The value of `cdc` field on the other keyspaces is `null`. One or two years ago I&apos;ve tried the CDC feature but switched off... after I updated the schema of the affected keyspaces on the new nodes with &apos;cdc=false&apos; then everything is okay.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                                                <inwardlinks description="is duplicated by">
                                        <issuelink>
            <issuekey id="13008288">CASSANDRA-12726</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[slebresne]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 28 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i33zxr:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>aleksey</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[aleksey]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12962"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>