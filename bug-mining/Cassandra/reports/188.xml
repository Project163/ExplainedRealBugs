<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 22:11:41 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-497] Include bootstrap targets in consistencylevel computations</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-497</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;We want to preserve ConsistencyLevel semantics during bootstrap, and if a CL.quorum/all write is sent to a bootstrap target, it would have to wait for the forwarded write to complete to report in turn that the write is good.&lt;/p&gt;

&lt;p&gt;Leaving write propagation to be done by the write originator means we don&apos;t have this extra layer of latency.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12438347">CASSANDRA-497</key>
            <summary>Include bootstrap targets in consistencylevel computations</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10003" iconUrl="https://issues.apache.org/jira/images/icons/priorities/trivial.svg">Low</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="jbellis">Jonathan Ellis</assignee>
                                    <reporter username="jbellis">Jonathan Ellis</reporter>
                        <labels>
                    </labels>
                <created>Fri, 16 Oct 2009 22:40:42 +0000</created>
                <updated>Tue, 16 Apr 2019 09:33:33 +0000</updated>
                            <resolved>Wed, 21 Oct 2009 14:18:27 +0000</resolved>
                                        <fixVersion>0.5</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                                                                <comments>
                            <comment id="12766755" author="jbellis" created="Fri, 16 Oct 2009 22:43:16 +0000"  >&lt;p&gt;patch:&lt;/p&gt;

&lt;p&gt;make write targets computable independent of replication strategy (i.e., make getReadStorageEndPoints the only method a Strategy needs to implement).  we do this by computing the token/endpoint -&amp;gt; Range[] map from the read endpoints, then using that to determine if a bootstrapping node needs to receive a write (if the token being written falls in any of its ranges).  Also, make the StorageProxy insert methods aware that bootstrap can entail having extra write targets temporarily, and include those in its consistencylevel calculations.&lt;/p&gt;</comment>
                            <comment id="12767958" author="sandeep_tata" created="Tue, 20 Oct 2009 21:55:13 +0000"  >&lt;p&gt;1. Making getReadStorageEndPoints the only method a replicationstrategy needs to implement is a nice move. Looks good.&lt;/p&gt;

&lt;p&gt;2. I see the value in including bootstrapping nodes in the blockFor calculations. Reads are never directed to bootstrapping nodes, so the app should be insulated from having to reason about bootstrap for its consistency guarantees. The current logic doesn&apos;t guarantee that: determineBlockFor will need to be fixed.&lt;/p&gt;

&lt;p&gt;You need to block for (#bootstrapping nodes + #determined as if there were no bootstrapping nodes).&lt;/p&gt;

&lt;p&gt;For instance, if there&apos;s one node that&apos;s being bootstrapped in the range of interest, ConsistencyLevel.ONE should block for &lt;b&gt;2&lt;/b&gt; not &lt;b&gt;1&lt;/b&gt; so that a read is guaranteed to hit at least one copy.&lt;/p&gt;

&lt;p&gt;ALL will work correctly. QUORUM will work correctly for cases where only 1 node is being bootstrapped for this range, &lt;/p&gt;
</comment>
                            <comment id="12767962" author="sandeep_tata" created="Tue, 20 Oct 2009 21:58:33 +0000"  >&lt;p&gt;Had to add Set and HashSet to imports to get it to build .. probably because patch missed a hunk?&lt;/p&gt;</comment>
                            <comment id="12767971" author="jbellis" created="Tue, 20 Oct 2009 22:06:19 +0000"  >&lt;p&gt;Thanks for taking a look!&lt;/p&gt;

&lt;p&gt;&amp;gt; Reads are never directed to bootstrapping nodes, so the app should be insulated from having to reason about bootstrap for its consistency guarantees. The current logic doesn&apos;t guarantee that&lt;/p&gt;

&lt;p&gt;Yes it does, because reads just use getReadStorageEndPoints, which correctly ignores bootstrap-in-progress.  &lt;/p&gt;

&lt;p&gt;determineBlockFor just says &quot;given a set of nodes we&apos;re writing &lt;span class=&quot;error&quot;&gt;&amp;#91;or reading, but actually read just hardcodes N / 2 + 1 right now&amp;#93;&lt;/span&gt; to, how many do we need to form a quorum.&quot;  So you&apos;d control it by giving it the right set of nodes to reason about.&lt;/p&gt;

&lt;p&gt;&amp;gt; Had to add Set and HashSet to imports to get it to build .. probably because patch missed a hunk? &lt;/p&gt;

&lt;p&gt;Sorry about that &amp;#8211; trunk has moved a bunch since that was generated.&lt;/p&gt;</comment>
                            <comment id="12767989" author="sandeep_tata" created="Tue, 20 Oct 2009 22:35:29 +0000"  >&lt;p&gt;&amp;gt; Yes it does, because reads just use getReadStorageEndPoints, which correctly ignores bootstrap-in-progress. &lt;/p&gt;

&lt;p&gt;Which is exactly why it might violate consistency guarantees. Here&apos;s an example:&lt;/p&gt;

&lt;p&gt;Key k lives on A, B, C. Node  N is being bootstrapped for this range.&lt;/p&gt;

&lt;p&gt;write(k, ConsistencyLevel.ONE) : blocks for 1 response, say this was from Node N.&lt;/p&gt;

&lt;p&gt;read(k, ConsistencyLevel.ONE) --&amp;gt; gets data from one replica, say A. Node A might not yet have gotten the previous write (only N did): this violates the consistency semantics.&lt;/p&gt;</comment>
                            <comment id="12767992" author="jbellis" created="Tue, 20 Oct 2009 22:42:26 +0000"  >&lt;p&gt;Ah, I see what you mean now.  You&apos;re right.&lt;/p&gt;

&lt;p&gt;So we need to block on write for quorum(normal) + bootstrap, not quorum(normal + bootstrap)&lt;/p&gt;</comment>
                            <comment id="12767993" author="jbellis" created="Tue, 20 Oct 2009 22:42:46 +0000"  >&lt;p&gt;or rather, blockfor(quorum) + bootstrap&lt;/p&gt;</comment>
                            <comment id="12767996" author="sandeep_tata" created="Tue, 20 Oct 2009 22:54:33 +0000"  >
&lt;p&gt;&amp;gt;or rather, blockfor(quorum) + bootstrap &lt;/p&gt;

&lt;p&gt;Exactly. blockFor(readEndPoints) + bootstrap instead of blockFor(writeEndPoints)&lt;/p&gt;</comment>
                            <comment id="12768254" author="jbellis" created="Wed, 21 Oct 2009 14:18:27 +0000"  >&lt;p&gt;committed w/ above modification&lt;/p&gt;</comment>
                            <comment id="12768665" author="hudson" created="Thu, 22 Oct 2009 12:34:39 +0000"  >&lt;p&gt;Integrated in Cassandra #235 (See &lt;a href=&quot;http://hudson.zones.apache.org/hudson/job/Cassandra/235/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://hudson.zones.apache.org/hudson/job/Cassandra/235/&lt;/a&gt;)&lt;br/&gt;
    Make EndPoint objects immmutable, so hashcode can&apos;t change (making the EndPoint potentially disappear from a map)&lt;br/&gt;
patch by jbellis; reviewed by Sandeep Tata for &lt;br/&gt;
make write targets computable independent of replication strategy (i.e., make getReadStorageEndPoints the only method a Strategy needs to implement).  we do this by computing the token/endpoint -&amp;gt; Range[] map from the read endpoints, then using that to determine if a bootstrapping node needs to receive a write (if the token being written falls in any of its ranges).  Also, make the StorageProxy insert methods aware that bootstrap can entail having extra write targets temporarily, and include those in its consistencylevel calculations.&lt;br/&gt;
patch by jbellis; reviewed by Sandeep Tata for &lt;br/&gt;
rename nodePicker -&amp;gt; replicationStrategy.&lt;br/&gt;
patch by jbellis; reviewed by Sandeep Tata for &lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12422423" name="ASF.LICENSE.NOT.GRANTED--0001-CASSANDRA-497-rename-nodePicker-replicationStrategy.txt" size="4401" author="jbellis" created="Sat, 17 Oct 2009 02:01:07 +0000"/>
                            <attachment id="12422424" name="ASF.LICENSE.NOT.GRANTED--0002-make-write-targets-computable-independent-of-replicati.txt" size="22101" author="jbellis" created="Sat, 17 Oct 2009 02:01:07 +0000"/>
                            <attachment id="12422425" name="ASF.LICENSE.NOT.GRANTED--0003-Make-EndPoint-objects-immmutable-so-hashcode-can-t-ch.txt" size="5554" author="jbellis" created="Sat, 17 Oct 2009 02:01:07 +0000"/>
                            <attachment id="12422731" name="imports.patch" size="606" author="sandeep_tata" created="Tue, 20 Oct 2009 21:58:33 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>4.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[jbellis]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>19722</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            16 years, 5 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0fzan:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>91316</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12961"><![CDATA[Low]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>