<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 22:48:20 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-7891] Select an element inside a UDT throws an index error</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-7891</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;Create the following data model:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;CREATE TYPE address (
street text,
city text,
zip_code int,
phones set&amp;lt;text&amp;gt;
 );
 
CREATE TYPE fullname (
firstname text,
lastname text
);

CREATE TABLE users (
id uuid PRIMARY KEY,
name FROZEN &amp;lt;fullname&amp;gt;,
addresses map&amp;lt;text, FROZEN &amp;lt;address&amp;gt;&amp;gt;
);

INSERT INTO users (id, name) 
VALUES (62c36092-82a1-3a00-93d1-46196ee77204, {firstname: &apos;Marie-Claude&apos;, lastname: &apos;Josset&apos;});
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;When trying to select a sub-field in the name type:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;SELECT name.lastname FROM users WHERE id=62c36092-82a1-3a00-93d1-46196ee77204;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;You get the following error:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;list index out of range
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="12739560">CASSANDRA-7891</key>
            <summary>Select an element inside a UDT throws an index error</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10002" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Normal</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="philipthompson">Philip Thompson</assignee>
                                    <reporter username="pmcfadin">Patrick McFadin</reporter>
                        <labels>
                            <label>qa-resolved</label>
                    </labels>
                <created>Fri, 5 Sep 2014 18:48:54 +0000</created>
                <updated>Tue, 16 Apr 2019 09:31:34 +0000</updated>
                            <resolved>Fri, 19 Sep 2014 21:06:21 +0000</resolved>
                                        <fixVersion>2.1.1</fixVersion>
                    <fixVersion>2.2.0 beta 1</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="14123550" author="brandon.williams" created="Fri, 5 Sep 2014 20:47:48 +0000"  >&lt;p&gt;Wasn&apos;t this against trunk (3.0)?&lt;/p&gt;</comment>
                            <comment id="14123579" author="pmcfadin" created="Fri, 5 Sep 2014 21:08:07 +0000"  >&lt;p&gt;It was trunk. Sorry, the version in cqlsh was 2.1.1. &lt;/p&gt;</comment>
                            <comment id="14140730" author="philipthompson" created="Fri, 19 Sep 2014 15:21:55 +0000"  >&lt;p&gt;I can also reproduce this against 2.1-HEAD.&lt;/p&gt;</comment>
                            <comment id="14140757" author="philipthompson" created="Fri, 19 Sep 2014 15:44:18 +0000"  >&lt;p&gt;The error occurs at&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;parsed = cqlruleset.cql_parse(query_string)[1]&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;inside &lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;def parse_for_table_meta&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;cqlruleset.cql_parse&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt; is in &lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;cassandra/pylib/cqlshlib/cqlhandling.py(115)cql_parse()&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;which calls &lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;self.parse(startsymbol, tokens, init_bindings={&lt;span class=&quot;code-quote&quot;&gt;&apos;*SRC*&apos;&lt;/span&gt;: text})&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;which is in &lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;cassandra/pylib/cqlshlib/pylexotron.py(446)parse()&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;which returns &lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; pattern.match(ctxt, None)&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;which returns at &lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;163         &lt;span class=&quot;code-keyword&quot;&gt;while&lt;/span&gt; True:
    164             new_ctxts = []
    165             &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; c in ctxts:
    166                 new_ctxts.extend(self.arg.match(c, completions))
    167             &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; not new_ctxts:
--&amp;gt; 168                 &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; found
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;at which point:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;found == ctxts == [&amp;lt;ParseContext matched=() remainder=((&lt;span class=&quot;code-quote&quot;&gt;&apos;K_SELECT&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;select&apos;&lt;/span&gt;, (0, 6)), (&lt;span class=&quot;code-quote&quot;&gt;&apos;identifier&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;name&apos;&lt;/span&gt;, (7, 11)), (&lt;span class=&quot;code-quote&quot;&gt;&apos;op&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;.&apos;&lt;/span&gt;, (11, 12)), (&lt;span class=&quot;code-quote&quot;&gt;&apos;identifier&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;lastname&apos;&lt;/span&gt;, (12, 20)), (&lt;span class=&quot;code-quote&quot;&gt;&apos;K_FROM&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;from&apos;&lt;/span&gt;, (21, 25)), (&lt;span class=&quot;code-quote&quot;&gt;&apos;identifier&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;users&apos;&lt;/span&gt;, (26, 31)), (&lt;span class=&quot;code-quote&quot;&gt;&apos;K_WHERE&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;where&apos;&lt;/span&gt;, (32, 37)), (&lt;span class=&quot;code-quote&quot;&gt;&apos;identifier&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;id&apos;&lt;/span&gt;, (38, 40)), (&lt;span class=&quot;code-quote&quot;&gt;&apos;op&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;=&apos;&lt;/span&gt;, (40, 41)), (&lt;span class=&quot;code-quote&quot;&gt;&apos;uuid&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;62c36092-82a1-3a00-93d1-46196ee77204&apos;&lt;/span&gt;, (41, 77)), (&lt;span class=&quot;code-quote&quot;&gt;&apos;endtoken&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;;&apos;&lt;/span&gt;, (77, 78))) prodname=&lt;span class=&quot;code-quote&quot;&gt;&apos;Start&apos;&lt;/span&gt; bindings={&lt;span class=&quot;code-quote&quot;&gt;&apos;*SRC*&apos;&lt;/span&gt;: &lt;span class=&quot;code-quote&quot;&gt;&apos;select name.lastname from users where id=62c36092-82a1-3a00-93d1-46196ee77204;&apos;&lt;/span&gt;}&amp;gt;]
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Because found is being returned all the way up to &lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;parsed = cqlruleset.cql_parse(query_string)[1]&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;and is a list of length 1, there is no index 1 which causes this exception.&lt;/p&gt;</comment>
                            <comment id="14140759" author="philipthompson" created="Fri, 19 Sep 2014 15:45:28 +0000"  >&lt;p&gt;That stack trace is with cassandra-2.1-HEAD as of 1949212f5415dcb6026cef98ae23aa1a11ed3935.&lt;/p&gt;</comment>
                            <comment id="14140874" author="philipthompson" created="Fri, 19 Sep 2014 16:58:08 +0000"  >&lt;p&gt;Okay so the root issue is at &lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;/cassandra/pylib/cqlshlib/pylexotron.py(254)match()
    253         &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; ctxt.remainder:
--&amp;gt; 254             &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; self.arg.lower() == ctxt.remainder[0][1].lower():
    255                 &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; [ctxt.with_match(1)]
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;The code is expecting ctxt.remainder&lt;span class=&quot;error&quot;&gt;&amp;#91;0&amp;#93;&lt;/span&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt; to be &apos;from&apos;, but instead it is &apos;op&apos;, because &apos;name.lastname&apos; is being interpreted as identifier, op, identifier. I assume everything between &apos;SELECT&apos; and &apos;FROM&apos; should have been removed from the remainder when we dealt with the &apos;selectClause&apos; rule.&lt;/p&gt;</comment>
                            <comment id="14140982" author="philipthompson" created="Fri, 19 Sep 2014 17:58:24 +0000"  >&lt;p&gt;Git bisect shows this problem was introduced by &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-6910&quot; title=&quot;Better table structure display in cqlsh&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-6910&quot;&gt;&lt;del&gt;CASSANDRA-6910&lt;/del&gt;&lt;/a&gt;. Upon inspection it looks like that patch only edited bin/cqlsh so it looks like the issue in cqlshlib was there beforehand but wasn&apos;t being called.&lt;/p&gt;</comment>
                            <comment id="14141074" author="philipthompson" created="Fri, 19 Sep 2014 18:48:21 +0000"  >&lt;p&gt;I have a patch but I&apos;m not confident in it. I&apos;ll have it up soon after I run cqlshlib tests for a sanity check.&lt;/p&gt;</comment>
                            <comment id="14141158" author="philipthompson" created="Fri, 19 Sep 2014 19:44:33 +0000"  >&lt;p&gt;This patch had no effect on cqlsh tests in dtests or the cqlshlib tests.&lt;/p&gt;</comment>
                            <comment id="14141181" author="thobbs" created="Fri, 19 Sep 2014 19:56:01 +0000"  >&lt;p&gt;Instead of doing &lt;tt&gt;(&amp;lt;op&amp;gt; &amp;lt;selector&amp;gt;)?&lt;/tt&gt;, I think &lt;tt&gt;(&quot;.&quot; &amp;lt;identifier&amp;gt;)?&lt;/tt&gt; is what we want.  &lt;tt&gt;&amp;lt;op&amp;gt;&lt;/tt&gt; covers arithmetic operators as well as &lt;tt&gt;.&lt;/tt&gt;, and &lt;tt&gt;&amp;lt;selector&amp;gt;&lt;/tt&gt; can include things like function calls.  Can you try that out and make sure everything works?&lt;/p&gt;</comment>
                            <comment id="14141194" author="philipthompson" created="Fri, 19 Sep 2014 20:02:30 +0000"  >&lt;p&gt;Done. Sorry, that is a lot cleaner than how I originally had it. Tests still work after the change and the select works fine through cqlsh.&lt;/p&gt;</comment>
                            <comment id="14141236" author="thobbs" created="Fri, 19 Sep 2014 20:24:59 +0000"  >&lt;p&gt;I missed this on the first review, but the current fix will only work for the first item in the select.  My suggestion would be to undo the current changes, and modify the &lt;tt&gt;&amp;lt;selector&amp;gt;&lt;/tt&gt; definition to include the subfield access syntax.&lt;/p&gt;</comment>
                            <comment id="14141272" author="philipthompson" created="Fri, 19 Sep 2014 20:51:50 +0000"  >&lt;p&gt;Attached a v3. It defines &amp;lt;udtSubfieldSelector&amp;gt; as a new grammar item, and then adds that as an option for &amp;lt;selector&amp;gt;&lt;/p&gt;</comment>
                            <comment id="14141298" author="thobbs" created="Fri, 19 Sep 2014 21:06:21 +0000"  >&lt;p&gt;Commited, thanks!&lt;/p&gt;</comment>
                            <comment id="14146460" author="philipthompson" created="Wed, 24 Sep 2014 16:02:12 +0000"  >&lt;p&gt;I committed a dtest for this at c8c37500f486cab8234523f6876b6aad0e3d9067&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12749364">CASSANDRA-8155</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                            <issuelinktype id="12310050">
                    <name>Regression</name>
                                                                <inwardlinks description="is broken by">
                                        <issuelink>
            <issuekey id="12703084">CASSANDRA-6910</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12670083" name="7891-2.txt" size="732" author="philipthompson" created="Fri, 19 Sep 2014 20:01:26 +0000"/>
                            <attachment id="12670092" name="7891-3.txt" size="663" author="philipthompson" created="Fri, 19 Sep 2014 20:51:50 +0000"/>
                            <attachment id="12670076" name="7891.txt" size="731" author="philipthompson" created="Fri, 19 Sep 2014 19:43:59 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[philipthompson]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            11 years, 8 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1zqlb:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12311421" key="com.atlassian.jira.plugin.system.customfieldtypes:multiversion">
                        <customfieldname>Reproduced In</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="12326774">2.1.1</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>thobbs</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[thobbs]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12962"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12311420" key="com.atlassian.jira.plugin.system.customfieldtypes:version">
                        <customfieldname>Since Version</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="12326774">2.1.1</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12311124" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Tester</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>philipthompson</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>