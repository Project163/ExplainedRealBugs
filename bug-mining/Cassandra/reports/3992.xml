<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 22:59:50 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-10585] SSTablesPerReadHistogram seems wrong when row cache hit happend</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-10585</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;SSTablePerReadHistogram metric now not considers case when row has been read from row cache.&lt;br/&gt;
And so, this metric will have big values even almost all requests processed by row cache (and without touching SSTables, of course).&lt;br/&gt;
So, it seems that correct behavior is to consider that if we read row from row cache then we read zero SSTables by this request.&lt;br/&gt;
The patch at the attachment.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12907500">CASSANDRA-10585</key>
            <summary>SSTablesPerReadHistogram seems wrong when row cache hit happend</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10003" iconUrl="https://issues.apache.org/jira/images/icons/priorities/trivial.svg">Low</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="isburmistrov">Ivan Burmistrov</assignee>
                                    <reporter username="isburmistrov">Ivan Burmistrov</reporter>
                        <labels>
                    </labels>
                <created>Fri, 23 Oct 2015 18:15:03 +0000</created>
                <updated>Wed, 15 Oct 2025 09:49:03 +0000</updated>
                            <resolved>Fri, 4 Dec 2015 18:21:23 +0000</resolved>
                                        <fixVersion>2.1.13</fixVersion>
                    <fixVersion>2.2.5</fixVersion>
                    <fixVersion>3.0.1</fixVersion>
                    <fixVersion>3.1</fixVersion>
                                    <component>Legacy/Observability</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="14994397" author="mambocab" created="Fri, 6 Nov 2015 20:40:23 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=benedict&quot; class=&quot;user-hover&quot; rel=&quot;benedict&quot;&gt;benedict&lt;/a&gt; or &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=Stefania&quot; class=&quot;user-hover&quot; rel=&quot;stefania&quot;&gt;Stefania&lt;/a&gt;, is one of you the right person to have a look at this?&lt;/p&gt;</comment>
                            <comment id="14995962" author="stefania" created="Mon, 9 Nov 2015 02:46:21 +0000"  >&lt;p&gt;I can&apos;t say I&apos;m an expert in this part of the code but it shouldn&apos;t be too hard to work it out. I would check with &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=slebresne&quot; class=&quot;user-hover&quot; rel=&quot;slebresne&quot;&gt;slebresne&lt;/a&gt; first however, since it may no longer be relevant with the new storage engine or he may prefer someone else to look at it.&lt;/p&gt;</comment>
                            <comment id="15003635" author="isburmistrov" created="Fri, 13 Nov 2015 07:00:09 +0000"  >&lt;p&gt;I prepared patches to versions 2.1, 2.2 and 3.0 (and it is not hard to prepare patch for trunk).&lt;/p&gt;

&lt;p&gt;Important comment for 2.2 and 3.0 versions.&lt;br/&gt;
SSTablePerReadHistogram in these versions is EstimatedHistogram now.&lt;br/&gt;
But for this implementation of histogram zero values make almost no effect.  &lt;br/&gt;
It seems not good, because it is important to know if, for example, we read 0.1 SSTables per read at average. &lt;br/&gt;
For example, we want to know does &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-2498&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;CASSANDRA-2498&lt;/a&gt; or &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-5514&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;CASSANDRA-5514&lt;/a&gt; optimization works for some table. &lt;br/&gt;
EstimatedHistogram returns only integer values and make this scenario impossible, while it was possible in versions 2.1 and below.&lt;br/&gt;
So in patches for 2.2 and 3.0 I switched SSTablesPerReadHistogram to ExponentiallyDecayingHistogram implementation.&lt;/p&gt;</comment>
                            <comment id="15008933" author="carlyeks" created="Tue, 17 Nov 2015 16:17:54 +0000"  >&lt;p&gt;While the version for 2.1 is fine, for 2.2 and 3.0, I don&apos;t think we should switch to &lt;tt&gt;ExponentiallyDecayingReservoir&lt;/tt&gt;; the reasoning behind us using &lt;tt&gt;EstimatedHistogram&lt;/tt&gt; is discussed in &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-5657&quot; title=&quot;Upgrade metrics lib and remove deprecated metrics&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-5657&quot;&gt;&lt;del&gt;CASSANDRA-5657&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;I&apos;d like to either come up with a way to either estimate the statistic trying to be calculated here, or extend &lt;tt&gt;EstimatedHistogram&lt;/tt&gt; to properly capture a 0 value. I think we can approximate this by using the &lt;tt&gt;RowCacheHit&lt;/tt&gt;/&lt;tt&gt;RowCacheMiss&lt;/tt&gt; metrics; that would mean &lt;tt&gt;SSTablesPerReadHistogram&lt;/tt&gt; is only captured on &lt;tt&gt;RowCacheMiss&lt;/tt&gt;, so the new metric might be&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;(RowCacheMiss/(RowCacheHit + RowCacheMiss)) * SSTablesPerRead
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Do either of those seem feasible, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=isburmistrov&quot; class=&quot;user-hover&quot; rel=&quot;isburmistrov&quot;&gt;isburmistrov&lt;/a&gt;?&lt;/p&gt;</comment>
                            <comment id="15010712" author="isburmistrov" created="Wed, 18 Nov 2015 10:32:13 +0000"  >&lt;p&gt;I think, extending EstimatedHistogram to properly capture a 0 value is more preferably. Because not only row cache may cause reading 0 SSTables, but  &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-2498&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;CASSANDRA-2498&lt;/a&gt; and &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-5514&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;CASSANDRA-5514&lt;/a&gt; optimizations too: read request can process only Memtable without touching any SSTable if these optimizations work well.&lt;/p&gt;

&lt;p&gt;I will prepare new versions of patches and will attach it for your review soon.&lt;/p&gt;</comment>
                            <comment id="15020444" author="isburmistrov" created="Sat, 21 Nov 2015 12:57:37 +0000"  >&lt;p&gt;I&apos;ve reattached patch for 2.2: I&apos;ve added the ability to consider 0 values in EstimatedHistogram and SSTablesPerReadHistogram uses this ability now.&lt;br/&gt;
If it is OK, I will prepare patches for 3.0 and trunk.&lt;/p&gt;</comment>
                            <comment id="15032361" author="carlyeks" created="Mon, 30 Nov 2015 20:01:42 +0000"  >&lt;p&gt;+1. Doesn&apos;t apply cleanly forward to 3.0, so the 3.0/trunk patches will be required.&lt;/p&gt;</comment>
                            <comment id="15036122" author="isburmistrov" created="Wed, 2 Dec 2015 16:55:40 +0000"  >&lt;p&gt;I&apos;ve attached patch for trunk (and it works for 3.0 too).&lt;/p&gt;</comment>
                            <comment id="15041904" author="jmckenzie" created="Fri, 4 Dec 2015 18:21:23 +0000"  >&lt;p&gt;&lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=cassandra.git;a=commit;h=acdbba7957be3567d6eeb756f098d81ca736d995&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;Committed&lt;/a&gt;, applied respective patches to respective branches, merged up.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12772128" name="SSTablePerReadHistogram_RowCache-cassandra-2_1.patch" size="4505" author="isburmistrov" created="Fri, 13 Nov 2015 06:42:57 +0000"/>
                            <attachment id="12773661" name="SSTablePerReadHistogram_RowCache-cassandra-2_2.patch" size="19127" author="isburmistrov" created="Sat, 21 Nov 2015 12:54:41 +0000"/>
                            <attachment id="12775333" name="SSTablePerReadHistogram_RowCache_trunk.patch" size="20384" author="isburmistrov" created="Wed, 2 Dec 2015 16:54:01 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[isburmistrov]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310250" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10430"><![CDATA[Patch]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 50 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2nga7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>carlyeks</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[carlyeks]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12961"><![CDATA[Low]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>