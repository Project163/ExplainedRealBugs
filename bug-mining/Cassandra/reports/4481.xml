<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 23:05:00 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-12736] Update the bundled python driver on trunk</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-12736</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;Trunk was recently updated to be version 4.0. The bundled python driver that cqlsh uses has a bug where it fails to connect to a C* server with a major version number greater than 3. The driver was fixed upstream, and we should pull in the fix.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=pauloricardomg&quot; class=&quot;user-hover&quot; rel=&quot;pauloricardomg&quot;&gt;pauloricardomg&lt;/a&gt; or &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=stefania&quot; class=&quot;user-hover&quot; rel=&quot;stefania&quot;&gt;stefania&lt;/a&gt;?&lt;/p&gt;</description>
                <environment></environment>
        <key id="13008909">CASSANDRA-12736</key>
            <summary>Update the bundled python driver on trunk</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10002" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Normal</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="stefania">Stefania Alborghetti</assignee>
                                    <reporter username="philipthompson">Philip Thompson</reporter>
                        <labels>
                            <label>cqlsh</label>
                    </labels>
                <created>Fri, 30 Sep 2016 15:27:51 +0000</created>
                <updated>Fri, 15 May 2020 08:05:18 +0000</updated>
                            <resolved>Wed, 5 Oct 2016 04:31:41 +0000</resolved>
                                        <fixVersion>4.0-alpha1</fixVersion>
                    <fixVersion>4.0</fixVersion>
                                    <component>Legacy/Tools</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>6</watches>
                                                                                                                <comments>
                            <comment id="15536465" author="pauloricardomg" created="Fri, 30 Sep 2016 16:56:05 +0000"  >&lt;p&gt;Updated bundled python driver to 3.7.0, commit &lt;a href=&quot;https://github.com/datastax/python-driver/commit/8289de0b3858917e47e479dbc98dd9b4073f577e&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;8289de&lt;/a&gt;. Will mark as patch available after test results below look good:&lt;/p&gt;

&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;trunk&lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;&lt;a href=&quot;https://github.com/apache/cassandra/compare/trunk...pauloricardomg:trunk-12736&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;branch&lt;/a&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/paulomotta/job/pauloricardomg-trunk-12736-testall/lastCompletedBuild/testReport/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;testall&lt;/a&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/paulomotta/job/pauloricardomg-trunk-12736-dtest/lastCompletedBuild/testReport/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;dtest&lt;/a&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;
</comment>
                            <comment id="15541247" author="stefania" created="Mon, 3 Oct 2016 00:55:10 +0000"  >&lt;p&gt;Only 656 dtests completed, the last build on trunk had 863 tests; the cqlsh copy test results seem to be missing. I&apos;ve launched the cqlsh specific tests for the same patch &lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/stef1927/job/stef1927-12736-cqlsh-cqlsh-tests/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;here&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="15541365" author="stefania" created="Mon, 3 Oct 2016 02:30:48 +0000"  >&lt;p&gt;&lt;tt&gt;test_bulk_round_trip_blogposts&lt;/tt&gt; was &lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/stef1927/job/stef1927-12736-cqlsh-cqlsh-tests/1/cython=yes,label=ctool-lab/console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;aborted&lt;/a&gt; for both runs (with and without cython). It can be reproduced locally as well.&lt;/p&gt;


</comment>
                            <comment id="15541383" author="stefania" created="Mon, 3 Oct 2016 02:47:09 +0000"  >&lt;p&gt;I&apos;ve applied the driver commit we need to the 3.5.0 tag and rebundled this &lt;a href=&quot;https://github.com/stef1927/python-driver/commits/cassandra-test-3.5.0&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;branch&lt;/a&gt;. Tests here:&lt;/p&gt;

&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/stef1927/cassandra/commits/12736-cqlsh&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;patch&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/stef1927/job/stef1927-12736-cqlsh-testall/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;testall&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/stef1927/job/stef1927-12736-cqlsh-dtest/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;dtest&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/stef1927/job/stef1927-12736-cqlsh-cqlsh-tests/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;cqlsh&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;

</comment>
                            <comment id="15541387" author="stefania" created="Mon, 3 Oct 2016 02:50:11 +0000"  >&lt;p&gt;I&apos;ve created &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-12740&quot; title=&quot;cqlsh copy tests hang in case of no answer from the server or driver&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-12740&quot;&gt;&lt;del&gt;CASSANDRA-12740&lt;/del&gt;&lt;/a&gt; for this.&lt;/p&gt;</comment>
                            <comment id="15541678" author="stefania" created="Mon, 3 Oct 2016 06:39:53 +0000"  >&lt;p&gt;The test results are clean but I should have applied the commit to &lt;tt&gt;d8d0456&lt;/tt&gt; rather than tag 3.5.0, fixed and relaunched the cqlsh tests.&lt;/p&gt;</comment>
                            <comment id="15542036" author="stefania" created="Mon, 3 Oct 2016 10:00:38 +0000"  >&lt;p&gt;&lt;tt&gt;test_bulk_round_trip_blogposts&lt;/tt&gt; started hanging again, we need to investigate some more.&lt;/p&gt;</comment>
                            <comment id="15543223" author="philipthompson" created="Mon, 3 Oct 2016 19:44:48 +0000"  >&lt;p&gt;Those tests use 5 nodes, I would expect them to hang&lt;/p&gt;</comment>
                            <comment id="15544746" author="stefania" created="Tue, 4 Oct 2016 08:39:48 +0000"  >&lt;p&gt;The reason for the test hanging is that for some inserts no callback is called. &lt;/p&gt;

&lt;p&gt;I still don&apos;t know why commit &lt;tt&gt;d8d0456&lt;/tt&gt; causes this when running against 4.0, whilst it is perfectly fine when running against 3.X, however I have found the reason when using the driver at the latest cassandra_test version and it seems to be fixed locally, once the fix is applied. The problem is &lt;a href=&quot;https://github.com/datastax/python-driver/commit/8850ad3b6114debb7e95d4e1e5f232e03d652b0f&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;this commit&lt;/a&gt;: for a batch statement containing prepared statements, &lt;tt&gt;self.prepared_statement&lt;/tt&gt; is None when we handle a re-prepare answer, cc &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=aholmber&quot; class=&quot;user-hover&quot; rel=&quot;aholmber&quot;&gt;aholmber&lt;/a&gt;. &lt;/p&gt;

&lt;p&gt;I&apos;ve relaunched the tests using this driver branch: &lt;a href=&quot;https://github.com/stef1927/python-driver/tree/12736&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/stef1927/python-driver/tree/12736&lt;/a&gt;.&lt;/p&gt;

&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/stef1927/cassandra/commits/12736-cqlsh&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;patch&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/stef1927/job/stef1927-12736-cqlsh-cqlsh-tests/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;cqlsh tests&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;


&lt;p&gt;I&apos;ve also made cqlsh copy-from more robust to error callbacks not invoked: if the parent process detects no activity in 90 seconds, it will abort. We currently also don&apos;t set any request timeout, we should probably use a very high timeout of 60 seconds. Please note: I&apos;ve &lt;b&gt;temporarily&lt;/b&gt; enabled debug logging in the driver and changed &lt;tt&gt;self.shell.printerr&lt;/tt&gt; with &lt;tt&gt;self.printmsg&lt;/tt&gt; because the test does not print stderr. These should not be committed in the final patch.&lt;/p&gt;

&lt;p&gt;Let&apos;s see if the Jenkins results are fine now.&lt;/p&gt;</comment>
                            <comment id="15544772" author="stefania" created="Tue, 4 Oct 2016 08:48:05 +0000"  >&lt;p&gt;The driver logging at debug level breaks the cqlshlib tests, disabled and relaunched.&lt;/p&gt;</comment>
                            <comment id="15544957" author="stefania" created="Tue, 4 Oct 2016 10:02:35 +0000"  >&lt;p&gt;3 failed tests due to the change from &lt;tt&gt;self.shell.printerr&lt;/tt&gt; to &lt;tt&gt;self.printmsg&lt;/tt&gt;, &lt;tt&gt;test_bulk_round_trip_blogposts&lt;/tt&gt; was fine. I&apos;ve reverted &lt;tt&gt;self.shell.printerr&lt;/tt&gt; and relaunched.&lt;/p&gt;</comment>
                            <comment id="15545534" author="pauloricardomg" created="Tue, 4 Oct 2016 14:46:32 +0000"  >&lt;blockquote&gt;&lt;p&gt;I still don&apos;t know why commit d8d0456 causes this when running against 4.0, whilst it is perfectly fine when running against 3.X, however I have found the reason when using the driver at the latest cassandra_test version and it seems to be fixed locally, once the fix is applied. The problem is this commit: for a batch statement containing prepared statements, self.prepared_statement is None when we handle a re-prepare answer, cc Adam Holmberg. &lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Good catch! &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=aholmber&quot; class=&quot;user-hover&quot; rel=&quot;aholmber&quot;&gt;aholmber&lt;/a&gt; can you please have a look and validate the python driver &lt;a href=&quot;https://github.com/stef1927/python-driver/commit/8180766a85d6f483e403b4fce343f6c1f827de47&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;fix&lt;/a&gt; ? Thanks!&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;I&apos;ve also made cqlsh copy-from more robust to error callbacks not invoked: if the parent process detects no activity in 90 seconds, it will abort. We currently also don&apos;t set any request timeout, we should probably use a very high timeout of 60 seconds. Please note: I&apos;ve temporarily enabled debug logging in the driver and changed self.shell.printerr with self.printmsg because the test does not print stderr. These should not be committed in the final patch.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;This looks good, but I wonder if we should add this in a separate ticket/commit to keep this only for the driver upgrade? Did you manage to test this locally to see if the timeouts are working properly?&lt;/p&gt;

&lt;p&gt;Anyway, test results look good, so +1 after Adam confirm if the driver change is OK. Feel free to either include the new checks in this commit or create another ticket for it.&lt;/p&gt;</comment>
                            <comment id="15545878" author="aholmber" created="Tue, 4 Oct 2016 16:25:24 +0000"  >&lt;p&gt;+1 on prepared change for this integration. We may have to do a little more for more general robustness, so I created a driver ticket:&lt;br/&gt;
&lt;a href=&quot;https://datastax-oss.atlassian.net/browse/PYTHON-651&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;PYTHON-651&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15547389" author="stefania" created="Wed, 5 Oct 2016 02:17:42 +0000"  >&lt;p&gt;Thanks for the review &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=aholmber&quot; class=&quot;user-hover&quot; rel=&quot;aholmber&quot;&gt;aholmber&lt;/a&gt; and &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=pauloricardomg&quot; class=&quot;user-hover&quot; rel=&quot;pauloricardomg&quot;&gt;pauloricardomg&lt;/a&gt;.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;This looks good, but I wonder if we should add this in a separate ticket/commit to keep this only for the driver upgrade? &lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I was thinking of moving the cqlsh changes to &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-12740&quot; title=&quot;cqlsh copy tests hang in case of no answer from the server or driver&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-12740&quot;&gt;&lt;del&gt;CASSANDRA-12740&lt;/del&gt;&lt;/a&gt;, I&apos;ll make you as reviewer if that&apos;s OK. &lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;Did you manage to test this locally to see if the timeouts are working properly?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Yes the timeouts were working locally, but I plan to work out a way to test them in &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-12740&quot; title=&quot;cqlsh copy tests hang in case of no answer from the server or driver&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-12740&quot;&gt;&lt;del&gt;CASSANDRA-12740&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;&amp;#8211;&lt;/p&gt;

&lt;p&gt;I&apos;ve removed all cqlsh changes and left only the new driver in this patch. I&apos;m running one more round of CI, if the tests are still clean I will commit.&lt;/p&gt;</comment>
                            <comment id="15547596" author="stefania" created="Wed, 5 Oct 2016 04:31:41 +0000"  >&lt;p&gt;CI results are still good, committed to trunk as c6338cd4d7d7c6e19742cdf244949ddbd1a20ffe.&lt;/p&gt;</comment>
                            <comment id="15553990" author="stefania" created="Fri, 7 Oct 2016 03:34:23 +0000"  >&lt;p&gt;I created a driver &lt;a href=&quot;https://github.com/datastax/python-driver/pull/668&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;pull request&lt;/a&gt; to merge the temporary fix into &lt;em&gt;cassandra-test&lt;/em&gt; in case we need to bundle a new version before &lt;a href=&quot;https://datastax-oss.atlassian.net/browse/PYTHON-651&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;PYTHON-651&lt;/a&gt; is available.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[stefania]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 6 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i34b3j:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>pauloricardomg</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[pauloricardomg]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12962"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>