<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 22:21:19 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-2647] Cassandra can&apos;t find jamm on startup</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-2647</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;I installed the Debian package (from &lt;a href=&quot;http://www.apache.org/dist/cassandra/debian&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://www.apache.org/dist/cassandra/debian&lt;/a&gt; unstable) of Cassandra 0.8beta2 on Ubuntu 10.04 with the sun jdk over a working copy of 0.7.2. It broke on restart.&lt;br/&gt;
On startup it gives this:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;Error occurred during initialization of VM
agent library failed to init: instrument
Error opening zip file or JAR manifest missing : /lib/jamm-0.2.2.jar
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;/etc/cassandra/cassandra-env.sh contains this:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;# add the jamm javaagent
check_openjdk=$(java -version 2&amp;gt;&amp;amp;1 | awk &lt;span class=&quot;code-quote&quot;&gt;&apos;{&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (NR == 2) {print $1}}&apos;&lt;/span&gt;)
&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; [ &lt;span class=&quot;code-quote&quot;&gt;&quot;$check_openjdk&quot;&lt;/span&gt; != &lt;span class=&quot;code-quote&quot;&gt;&quot;OpenJDK&quot;&lt;/span&gt; ]
then
    JVM_OPTS=&lt;span class=&quot;code-quote&quot;&gt;&quot;$JVM_OPTS -javaagent:$CASSANDRA_HOME/lib/jamm-0.2.2.jar&quot;&lt;/span&gt;
fi
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;By default, CASSANDRA_HOME is not set, so it&apos;s looking in /lib for this jar. It seems CASSANDRA_HOME should be set to /usr/share/cassandra, since that&apos;s where jamm-0.2.2.jar is installed, but that means the path is still wrong.&lt;/p&gt;

&lt;p&gt;I set CASSANDRA_HOME to /usr/share/cassandra and changed the JVM_OPTS line to this:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;    JVM_OPTS=&lt;span class=&quot;code-quote&quot;&gt;&quot;$JVM_OPTS -javaagent:$CASSANDRA_HOME/jamm-0.2.2.jar&quot;&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;and then cassandra started ok.&lt;/p&gt;

&lt;p&gt;Is this a bug or did I miss something?&lt;/p&gt;

&lt;p&gt;I also noticed that this line appears to be the only use of CASSANDRA_HOME.&lt;/p&gt;</description>
                <environment>&lt;p&gt;Ubuntu 10.04 Lucid&lt;/p&gt;</environment>
        <key id="12507147">CASSANDRA-2647</key>
            <summary>Cassandra can&apos;t find jamm on startup</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10003" iconUrl="https://issues.apache.org/jira/images/icons/priorities/trivial.svg">Low</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="urandom">Eric Evans</assignee>
                                    <reporter username="synchrom">Marcus Bointon</reporter>
                        <labels>
                    </labels>
                <created>Fri, 13 May 2011 16:47:46 +0000</created>
                <updated>Tue, 16 Apr 2019 09:32:59 +0000</updated>
                            <resolved>Thu, 19 May 2011 18:21:34 +0000</resolved>
                                        <fixVersion>0.8.0</fixVersion>
                                    <component>Packaging</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                                                                <comments>
                            <comment id="13033246" author="brandon.williams" created="Fri, 13 May 2011 19:51:18 +0000"  >&lt;p&gt;CASSANDRA_HOME should be getting set in cassandra.in.sh which is the first thing sourced by bin/cassandra and /etc/init.d/cassandra&lt;/p&gt;</comment>
                            <comment id="13033287" author="synchrom" created="Fri, 13 May 2011 21:01:35 +0000"  >&lt;p&gt;Thanks for that. I think I&apos;d normally be looking for /etc/defaults/cassandra to set that kind of thing. Also, the supplied cassandra.in.sh does not set CASSANDRA_HOME, not even commented-out. It might be nice to mention that file in a comment in /etc/cassandra/cassandra.yaml&lt;/p&gt;</comment>
                            <comment id="13033342" author="urandom" created="Fri, 13 May 2011 22:15:11 +0000"  >&lt;p&gt;the attached (untested )patch should deal with this (it&apos;s one way of dealing with it anyway).&lt;/p&gt;</comment>
                            <comment id="13033917" author="synchrom" created="Mon, 16 May 2011 08:39:30 +0000"  >&lt;p&gt;Not tested that either, but it looks like it would make cassandra work &apos;out of the box&apos; on Debian/Ubuntu, fixing both my issues. Thanks.&lt;/p&gt;</comment>
                            <comment id="13034125" author="thepaul" created="Mon, 16 May 2011 17:29:51 +0000"  >&lt;p&gt;Tested and verified Eric&apos;s patch, both via initscript and invocation through /usr/sbin/cassandra; the right path to jamm (and all the other lib jars) gets set correctly. +1 for the patch.&lt;/p&gt;

&lt;p&gt;I think ideally the rest of the initscript would also make use of $CASSANDRA_HOME (like when specifying the location of the jars to add to the classpath), but since the deb isn&apos;t expected to support a change to $CASSANDRA_HOME, it&apos;s fine as is.&lt;/p&gt;</comment>
                            <comment id="13034218" author="jtrav" created="Mon, 16 May 2011 19:27:13 +0000"  >&lt;p&gt;Forgive the awfully dumb question - I am a new user trying to get Cassandra running (for the first time) and ran into this issue as well.&lt;/p&gt;

&lt;p&gt;What&apos;s the preferred method for applying this patch to the code base?  Running Natty x86_64 server.&lt;/p&gt;

&lt;p&gt;Thanks in advance.&lt;/p&gt;</comment>
                            <comment id="13034234" author="thepaul" created="Mon, 16 May 2011 19:43:40 +0000"  >&lt;blockquote&gt;&lt;p&gt;What&apos;s the preferred method for applying this patch to the code base? Running Natty x86_64 server.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Joe- I would say your options are:&lt;/p&gt;

&lt;p&gt;1. Apply the patch to a source checkout from the 0.8.0-beta2 tag (using &quot;patch -p1 &amp;lt; patch.txt&quot; from the toplevel directory), then build your own custom .debs (using, maybe, &quot;dpkg-buildpackage -us -uc&quot;).&lt;/p&gt;

&lt;p&gt;2. Just change this line in /etc/cassandra/cassandra-env.sh:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;    JVM_OPTS=&lt;span class=&quot;code-quote&quot;&gt;&quot;$JVM_OPTS -javaagent:$CASSANDRA_HOME/lib/jamm-0.2.2.jar&quot;&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;to&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;    JVM_OPTS=&lt;span class=&quot;code-quote&quot;&gt;&quot;$JVM_OPTS -javaagent:/usr/share/cassandra/jamm-0.2.2.jar&quot;&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;That solves the same problem in a different way. So when you upgrade to an official package with the real fix, you will want to change /etc/cassandra/cassandra-env.sh back to the way it was.&lt;/p&gt;

&lt;p&gt;3. Just wait for 0.8.0 beta3 to be released and use that&lt;/p&gt;</comment>
                            <comment id="13034238" author="jtrav" created="Mon, 16 May 2011 19:46:41 +0000"  >&lt;p&gt;Thanks for the quick response, Paul.  I&apos;ve taken approach #2 for now, and will loop back when I upgrade.  Much appreciated.&lt;/p&gt;</comment>
                            <comment id="13036350" author="jbellis" created="Thu, 19 May 2011 18:21:34 +0000"  >&lt;p&gt;committed&lt;/p&gt;</comment>
                            <comment id="13038508" author="synchrom" created="Tue, 24 May 2011 11:19:34 +0000"  >&lt;p&gt;I just noticed this &lt;a href=&quot;http://wiki.apache.org/cassandra/RunningCassandra&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;on the wiki&lt;/a&gt;:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Startup options should be configured in /etc/default/cassandra (not /usr/share/cassandra/cassandra.in.sh) on Debian systems.&lt;/p&gt;&lt;/blockquote&gt;</comment>
                            <comment id="13038683" author="thepaul" created="Tue, 24 May 2011 17:34:05 +0000"  >&lt;blockquote&gt;&lt;p&gt;Startup options should be configured in /etc/default/cassandra (not /usr/share/cassandra/cassandra.in.sh) on Debian systems.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;That&apos;s correct, dpkg won&apos;t track changes to config files outside of /etc without special treatment. Is something wrong with that?&lt;/p&gt;</comment>
                            <comment id="13038740" author="synchrom" created="Tue, 24 May 2011 19:20:22 +0000"  >&lt;p&gt;It was just that this bug&apos;s current patch does the opposite. I mentioned earlier that I&apos;d expect things like CASSANDRA_HOME to be set in /etc/defaults/cassandra rather than somewhere in /usr.&lt;/p&gt;</comment>
                            <comment id="13038754" author="thepaul" created="Tue, 24 May 2011 19:54:21 +0000"  >&lt;blockquote&gt;&lt;p&gt;It was just that this bug&apos;s current patch does the opposite. I mentioned earlier that I&apos;d expect things like CASSANDRA_HOME to be set in /etc/defaults/cassandra rather than somewhere in /usr.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;CASSANDRA_HOME can be overridden by the user in /etc/cassandra/cassandra-env.sh; it&apos;s sourced after CASSANDRA_HOME is set to a default in both /etc/init.d/cassandra and /usr/sbin/cassandra .&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12479180" name="ASF.LICENSE.NOT.GRANTED--v1-0001-CASSANDRA-2647-move-jars-under-lib-to-satisfy-hard-cod.txt" size="2244" author="urandom" created="Fri, 13 May 2011 22:13:04 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[urandom]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>20750</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            14 years, 27 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0gcm7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>93474</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>thepaul</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[thepaul]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12961"><![CDATA[Low]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>