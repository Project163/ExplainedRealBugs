<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 22:42:43 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-6685] Nodes never bootstrap if schema is empty</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-6685</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;Since 1.2.15, bootstrap never completes if the schema is empty. The bootstrapping node endlessly prints:&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;&lt;tt&gt;INFO 12:37:44,863 JOINING: waiting for schema information to complete&lt;/tt&gt;&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;until you add something to the schema (i.e. create a keyspace).&lt;/p&gt;

&lt;p&gt;The problem looks to be caused by &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-6648&quot; title=&quot;Race condition during node bootstrapping&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-6648&quot;&gt;&lt;del&gt;CASSANDRA-6648&lt;/del&gt;&lt;/a&gt;, where MigrationManager.isReadForBootstrap() was changed to:&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;&lt;tt&gt;return Schema.instance.getVersion() != null &amp;amp;&amp;amp; !Schema.emptyVersion.equals(Schema.instance.getVersion());&lt;/tt&gt;&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;This is wrong since &lt;tt&gt;Schema.emptyVersion.equals(Schema.instance.getVersion())&lt;/tt&gt; is always true if there is no schema.&lt;/p&gt;

&lt;p&gt;We need some different logic for determining when the schema is propagated.&lt;/p&gt;

&lt;p&gt;I haven&apos;t tested, but I expect this issue appears in 2.0.5 too.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12694253">CASSANDRA-6685</key>
            <summary>Nodes never bootstrap if schema is empty</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10002" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Normal</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="brandon.williams">Brandon Williams</assignee>
                                    <reporter username="rlow">Richard Low</reporter>
                        <labels>
                    </labels>
                <created>Mon, 10 Feb 2014 12:46:41 +0000</created>
                <updated>Tue, 16 Apr 2019 09:31:54 +0000</updated>
                            <resolved>Mon, 10 Feb 2014 15:41:01 +0000</resolved>
                                        <fixVersion>1.2.16</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="13896621" author="brandon.williams" created="Mon, 10 Feb 2014 14:54:17 +0000"  >&lt;p&gt;Luckily bootstrapping without schema isn&apos;t a huge problem or very common, but I propose fixing this by reverting the change in question, since that puts everything back the way it was except for moving the MM events, which solved &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-6648&quot; title=&quot;Race condition during node bootstrapping&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-6648&quot;&gt;&lt;del&gt;CASSANDRA-6648&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="13896624" author="rlow" created="Mon, 10 Feb 2014 14:56:07 +0000"  >&lt;p&gt;I tested and this isn&apos;t reproduced in 2.0.5, because the system_traces keyspace is added to the schema, but it appears to be added differently in 1.2.x so doesn&apos;t modify the schema ID.&lt;/p&gt;</comment>
                            <comment id="13896637" author="rlow" created="Mon, 10 Feb 2014 15:04:14 +0000"  >&lt;p&gt;Wasn&apos;t this change made to guard against the case when schema messages get delayed and responses aren&apos;t received before bootstrap begins?&lt;/p&gt;</comment>
                            <comment id="13896648" author="rlow" created="Mon, 10 Feb 2014 15:10:29 +0000"  >&lt;p&gt;Also I think the use case of bootstrapping without a schema is quite common when setting up a new cluster. For more than a few nodes, people won&apos;t list all nodes as a seed and, with this issue, non-seed nodes won&apos;t join until a keyspace is created.&lt;/p&gt;</comment>
                            <comment id="13896657" author="brandon.williams" created="Mon, 10 Feb 2014 15:14:47 +0000"  >&lt;blockquote&gt;&lt;p&gt;Wasn&apos;t this change made to guard against the case when schema messages get delayed and responses aren&apos;t received before bootstrap begins?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;It was an extra guard, which is apparently slightly flawed.  The heart of the problem in 6648 was the event to check if pulling was needed firing too early, and not pulling because the remote node was not known to be part of the ring yet and thus considered a fat client.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;For more than a few nodes, people won&apos;t list all nodes as a seed and, with this issue, non-seed nodes won&apos;t join until a keyspace is created.&lt;/p&gt;&lt;/blockquote&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;auto_bootstrap = false&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt; will not only solve this, but also skip the ring delay sleep and be much faster.&lt;/p&gt;</comment>
                            <comment id="13896685" author="rlow" created="Mon, 10 Feb 2014 15:21:21 +0000"  >&lt;p&gt;OK, +1 on your proposed fix then.&lt;/p&gt;

&lt;p&gt;Agreed auto_bootstrap is a workaround for the new cluster case.&lt;/p&gt;</comment>
                            <comment id="13896696" author="brandon.williams" created="Mon, 10 Feb 2014 15:41:01 +0000"  >&lt;p&gt;Committed.&lt;/p&gt;</comment>
                            <comment id="13898598" author="appodictic" created="Wed, 12 Feb 2014 01:12:43 +0000"  >&lt;p&gt;I am confused as to what was committed. No one mentioned a git hash or included a patch.&lt;/p&gt;</comment>
                            <comment id="13900491" author="rlow" created="Thu, 13 Feb 2014 16:45:42 +0000"  >&lt;p&gt;Here&apos;s the git commit:&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/apache/cassandra/commit/c5627008a2c87ab960da98f4d5b8ca4aca6eebdd&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/cassandra/commit/c5627008a2c87ab960da98f4d5b8ca4aca6eebdd&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13905898" author="rcoli" created="Wed, 19 Feb 2014 19:08:34 +0000"  >&lt;blockquote&gt;&lt;p&gt;Luckily bootstrapping without schema isn&apos;t a huge problem or very common&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;In every cluster I have ever run, my initial setup process goes :&lt;/p&gt;

&lt;p&gt;1) coalesce cluster&lt;br/&gt;
2) load schema&lt;/p&gt;

&lt;p&gt;The above process seems &quot;very common&quot; to me; I am surprised to hear suggestion that anyone ever does anything else. A bug such as this one which would affect most noobs setting up My First Cassandra Cluster also seems &quot;very common&quot; to me, and a &quot;huge problem.&quot; &lt;/p&gt;

&lt;p&gt;In my view, this bug is serious enough to warrant an accelerated 1.2.16 release schedule.&lt;/p&gt;</comment>
                            <comment id="13905915" author="brandon.williams" created="Wed, 19 Feb 2014 19:19:00 +0000"  >&lt;p&gt;Thanks for your input.&lt;/p&gt;</comment>
                            <comment id="13944211" author="rbranson" created="Sat, 22 Mar 2014 19:58:43 +0000"  >&lt;p&gt;Ran into this today trying to test out some new machines. It&apos;s not good that we&apos;ve just been sitting on this for 6 weeks now.&lt;/p&gt;</comment>
                            <comment id="13944223" author="appodictic" created="Sat, 22 Mar 2014 20:36:02 +0000"  >&lt;p&gt;Suggestion: if a machine starts up with no keyspaces it should attempt to create Keyspace1, Standard1....I miss that old keyspace &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; jk. &lt;/p&gt;

&lt;p&gt;I think it would be nice to fix it. New users do not know how to create keyspaces yet, they likely join nodes and then attempt to use nodetool ring to see the topology. I could see someone grinding for a while attempting to determine why nodes are not seeing each other.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[brandon.williams]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>372762</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            11 years, 35 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1s8nb:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>373066</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12311421" key="com.atlassian.jira.plugin.system.customfieldtypes:multiversion">
                        <customfieldname>Reproduced In</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="12326169">1.2.15</customfieldvalue>
    <customfieldvalue id="12325761">2.0.5</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>rlow</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[rlow]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12962"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12311420" key="com.atlassian.jira.plugin.system.customfieldtypes:version">
                        <customfieldname>Since Version</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="12326169">1.2.15</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>