<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 22:55:43 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-9978] Split/Scrub tools no longer remove original sstable</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-9978</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;Looks like &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-7066&quot; title=&quot;Simplify (and unify) cleanup of compaction leftovers&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-7066&quot;&gt;&lt;del&gt;CASSANDRA-7066&lt;/del&gt;&lt;/a&gt; broke the scrub and split tools.  The orig sstable is no longer removed.&lt;/p&gt;

&lt;p&gt;I fixed the sstablesplit dtest so you should see the issue now.  The max sstable size doesn&apos;t match expected because it&apos;s the original &lt;/p&gt;
</description>
                <environment></environment>
        <key id="12851459">CASSANDRA-9978</key>
            <summary>Split/Scrub tools no longer remove original sstable</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10003" iconUrl="https://issues.apache.org/jira/images/icons/priorities/trivial.svg">Low</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="stefania">Stefania Alborghetti</assignee>
                                    <reporter username="tjake">T Jake Luciani</reporter>
                        <labels>
                    </labels>
                <created>Tue, 4 Aug 2015 18:22:00 +0000</created>
                <updated>Tue, 16 Apr 2019 09:31:01 +0000</updated>
                            <resolved>Fri, 7 Aug 2015 08:02:32 +0000</resolved>
                                        <fixVersion>3.0 beta 1</fixVersion>
                                    <component>Legacy/Tools</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="14654997" author="stefania" created="Wed, 5 Aug 2015 08:23:41 +0000"  >&lt;p&gt;The problem with the standalone splitter is that we obsolete the originals too late, after the transaction is committed. We could just swap the split() and obsoleteOriginals() calls but I prefer to modify compaction task and compaction aware writers to receive a &lt;tt&gt;keepOriginals&lt;/tt&gt; boolean in addition to &lt;tt&gt;isOffline&lt;/tt&gt;, with additional constructors where both are false by default. This way we can specify when we need to delete originals even if offline rather than mixing the two together.&lt;/p&gt;

&lt;p&gt;The problem with scrubbing is an NPE caused by the fact that an offline tracker has no cf store.&lt;/p&gt;

&lt;p&gt;Patch available &lt;a href=&quot;https://github.com/stef1927/cassandra/tree/9978-3.0&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;here&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;CI pending:&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/stef1927/job/stef1927-9978-3.0-testall/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://cassci.datastax.com/view/Dev/view/stef1927/job/stef1927-9978-3.0-testall/&lt;/a&gt;&lt;br/&gt;
&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/stef1927/job/stef1927-9978-3.0-dtest/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://cassci.datastax.com/view/Dev/view/stef1927/job/stef1927-9978-3.0-dtest/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=benedict&quot; class=&quot;user-hover&quot; rel=&quot;benedict&quot;&gt;benedict&lt;/a&gt; do you have time to review this one? I plan to observe CI for a bit and submit a patch tomorrow or shortly afterwards.&lt;/p&gt;</comment>
                            <comment id="14655003" author="benedict" created="Wed, 5 Aug 2015 08:27:24 +0000"  >&lt;p&gt;Yep, no problem. Also: SGTM.&lt;/p&gt;
</comment>
                            <comment id="14655011" author="stefania" created="Wed, 5 Aug 2015 08:36:31 +0000"  >&lt;p&gt;Thanks!&lt;/p&gt;</comment>
                            <comment id="14659555" author="stefania" created="Thu, 6 Aug 2015 06:20:35 +0000"  >&lt;p&gt;I&apos;ve noticed some more problems when scrubbing with an offline transaction: we need to release the references of the new sstables or we have LEAK errors. testScrubOutOfOrder should no longer release a reference to the old table (now done by the transaction) and it should wait for deletions before loading the new sstables (same race as in &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-9908&quot; title=&quot;Potential race caused by async cleanup of transaction log files&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-9908&quot;&gt;&lt;del&gt;CASSANDRA-9908&lt;/del&gt;&lt;/a&gt;).&lt;/p&gt;

&lt;p&gt;Further, BigTableWriterTest was also broken by &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-7066&quot; title=&quot;Simplify (and unify) cleanup of compaction leftovers&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-7066&quot;&gt;&lt;del&gt;CASSANDRA-7066&lt;/del&gt;&lt;/a&gt; in that the commit method of SSTableTxnWriter can throw (since LifecycleTransaction can) and so we should declare it in the test. In addition, SSTableTxnWriter should call txn.commit() before writer.commit() since the former may throw. I am going to fix these two things as well here if that&apos;s OK.&lt;/p&gt;

&lt;p&gt;3.0 patch &lt;a href=&quot;https://github.com/stef1927/cassandra/commits/9978-3.0&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;here&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;CI still pending:&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/stef1927/job/stef1927-9978-3.0-testall/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://cassci.datastax.com/view/Dev/view/stef1927/job/stef1927-9978-3.0-testall/&lt;/a&gt;&lt;br/&gt;
&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/stef1927/job/stef1927-9978-3.0-dtest/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://cassci.datastax.com/view/Dev/view/stef1927/job/stef1927-9978-3.0-dtest/&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14659697" author="stefania" created="Thu, 6 Aug 2015 08:54:39 +0000"  >&lt;p&gt;CI looks good, ready for review.&lt;/p&gt;</comment>
                            <comment id="14661471" author="benedict" created="Fri, 7 Aug 2015 08:02:32 +0000"  >&lt;p&gt;LGTM. Thanks! (Committed to 3.0 and trunk)&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[stefania]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 15 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2ibr3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>benedict</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[benedict]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12961"><![CDATA[Low]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>