<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 22:44:06 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-6971] Schedule schema pulls onChange</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-6971</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;The dtest suite is running a test which creates a 3 node cluster, then adds a keyspace and column family. For some reason the 3 nodes are not agreeing on the schema version. The problem is intermittent &amp;#8211; either the nodes all agree on schema quickly, or they seem to stay stuck in limbo.&lt;/p&gt;

&lt;p&gt;The simplest way to reproduce is to run the dtest (simple_increment_test):&lt;br/&gt;
&lt;a href=&quot;https://github.com/riptano/cassandra-dtest/blob/master/counter_tests.py&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/riptano/cassandra-dtest/blob/master/counter_tests.py&lt;/a&gt;&lt;br/&gt;
using nosetests:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;nosetests -vs counter_tests.py:TestCounters.simple_increment_test
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;If the problem is reproduced nose will return this:&lt;br/&gt;
ProgrammingError: Bad Request: Keyspace &apos;ks&apos; does not exist&lt;/p&gt;

&lt;p&gt;I am not yet sure if the bug is reproducible outside of the dtest suite.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12706057">CASSANDRA-6971</key>
            <summary>Schedule schema pulls onChange</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10002" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Normal</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="brandon.williams">Brandon Williams</assignee>
                                    <reporter username="rhatch">Russ Hatch</reporter>
                        <labels>
                    </labels>
                <created>Tue, 1 Apr 2014 23:13:25 +0000</created>
                <updated>Tue, 16 Apr 2019 09:31:49 +0000</updated>
                            <resolved>Tue, 8 Apr 2014 19:35:20 +0000</resolved>
                                        <fixVersion>1.2.17</fixVersion>
                    <fixVersion>2.0.7</fixVersion>
                    <fixVersion>2.1 beta2</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="13957136" author="rhatch" created="Tue, 1 Apr 2014 23:19:23 +0000"  >&lt;p&gt;here&apos;s the schema output for the created keyspace (which all nodes don&apos;t &quot;see&quot;):&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;CREATE KEYSPACE ks WITH replication = {
  &apos;class&apos;: &apos;SimpleStrategy&apos;,
  &apos;replication_factor&apos;: &apos;3&apos;
};

USE ks;

CREATE TABLE cf (
  key text PRIMARY KEY,
  c counter
) WITH
  bloom_filter_fp_chance=0.010000 AND
  caching=&apos;KEYS_ONLY&apos; AND
  comment=&apos;test cf&apos; AND
  dclocal_read_repair_chance=0.000000 AND
  gc_grace_seconds=864000 AND
  read_repair_chance=0.100000 AND
  replicate_on_write=&apos;true&apos; AND
  populate_io_cache_on_flush=&apos;false&apos; AND
  compaction={&apos;class&apos;: &apos;SizeTieredCompactionStrategy&apos;} AND
  compression={&apos;sstable_compression&apos;: &apos;SnappyCompressor&apos;};
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="13957143" author="brandon.williams" created="Tue, 1 Apr 2014 23:29:43 +0000"  >&lt;p&gt;Sounds a lot like &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-6177&quot; title=&quot;remove all sleeps in the dtests&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-6177&quot;&gt;CASSANDRA-6177&lt;/a&gt; to me&lt;/p&gt;</comment>
                            <comment id="13957166" author="rhatch" created="Tue, 1 Apr 2014 23:56:08 +0000"  >&lt;p&gt;Yeah, I dislike adding pauses to dtests and agree with the idea of &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-6177&quot; title=&quot;remove all sleeps in the dtests&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-6177&quot;&gt;CASSANDRA-6177&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;I would prefer to block until schema agreement in this test rather than blindly sleeping. But even with a manual pause of 2 minutes the 3 nodes don&apos;t arrive at agreement. The ks is still not present in some nodes after this lengthy wait, so I don&apos;t think the nodes are going to agree at all.&lt;/p&gt;</comment>
                            <comment id="13957713" author="slebresne" created="Wed, 2 Apr 2014 14:50:37 +0000"  >&lt;p&gt;I think we should consider moving the dtests to use the new python driver, which I believe should give use the check for schema agreement for free. But if nodes can&apos;t get to agree even after 2 minutes, then there is indeed probably something fishy going on.&lt;/p&gt;</comment>
                            <comment id="13957787" author="brandon.williams" created="Wed, 2 Apr 2014 15:22:09 +0000"  >&lt;p&gt;We probably need logs from the 2 minute case.&lt;/p&gt;</comment>
                            <comment id="13957853" author="rhatch" created="Wed, 2 Apr 2014 16:34:22 +0000"  >&lt;p&gt;attaching logs&lt;/p&gt;</comment>
                            <comment id="13960318" author="brandon.williams" created="Fri, 4 Apr 2014 19:27:44 +0000"  >&lt;p&gt;Hmm, so, the ks was created on node1, node2 saw it and applied it, but node3 never noticed any of this and never got it, so we must have a problem with the schema pull code.  That&apos;s about all I can tell at INFO, if you can get DEBUG there may be more.&lt;/p&gt;</comment>
                            <comment id="13960319" author="brandon.williams" created="Fri, 4 Apr 2014 19:28:16 +0000"  >&lt;p&gt;gossipinfo from this state would help rule out a problem there.&lt;/p&gt;</comment>
                            <comment id="13960834" author="rhatch" created="Sat, 5 Apr 2014 00:08:49 +0000"  >&lt;p&gt;Here&apos;s the gossipinfo output. This is several minutes after the test failed. Schema uuid&apos;s still mismatch.&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;rhatch@whatup:/tmp/dtest-VZ3n7v/test/node1$ bin/nodetool -p 7100 gossipinfo
/127.0.0.2
  DC:datacenter1
  HOST_ID:8929d0a0-5a4f-4a6f-85c3-665bb3aaf140
  SCHEMA:19969d6d-daaa-328f-ade0-8640043e37b9
  NET_VERSION:6
  RPC_ADDRESS:127.0.0.2
  RACK:rack1
  LOAD:52150.0
  STATUS:NORMAL,-3074457345618258603
  RELEASE_VERSION:1.2.0-SNAPSHOT
/127.0.0.3
  DC:datacenter1
  SCHEMA:59adb24e-f3cd-3e02-97f0-5b395827453f
  HOST_ID:864a00d4-f661-421e-81c3-90e7b8f90ef1
  NET_VERSION:6
  RPC_ADDRESS:127.0.0.3
  RACK:rack1
  LOAD:14361.0
  STATUS:NORMAL,3074457345618258602
  RELEASE_VERSION:1.2.0-SNAPSHOT
/127.0.0.1
  DC:datacenter1
  HOST_ID:06bbda3d-5265-4134-8248-11e0a2ddf798
  RPC_ADDRESS:127.0.0.1
  NET_VERSION:6
  SCHEMA:19969d6d-daaa-328f-ade0-8640043e37b9
  RACK:rack1
  LOAD:52153.0
  STATUS:NORMAL,-9223372036854775808
  RELEASE_VERSION:1.2.0-SNAPSHOT

rhatch@whatup:/tmp/dtest-VZ3n7v/test/node1$ bin/nodetool -p 7200 gossipinfo
/127.0.0.2
  HOST_ID:8929d0a0-5a4f-4a6f-85c3-665bb3aaf140
  SCHEMA:19969d6d-daaa-328f-ade0-8640043e37b9
  NET_VERSION:6
  LOAD:52150.0
  RPC_ADDRESS:127.0.0.2
  RACK:rack1
  DC:datacenter1
  RELEASE_VERSION:1.2.0-SNAPSHOT
  STATUS:NORMAL,-3074457345618258603
/127.0.0.3
  HOST_ID:864a00d4-f661-421e-81c3-90e7b8f90ef1
  SCHEMA:59adb24e-f3cd-3e02-97f0-5b395827453f
  NET_VERSION:6
  LOAD:14361.0
  RPC_ADDRESS:127.0.0.3
  RACK:rack1
  DC:datacenter1
  RELEASE_VERSION:1.2.0-SNAPSHOT
  STATUS:NORMAL,3074457345618258602
/127.0.0.1
  HOST_ID:06bbda3d-5265-4134-8248-11e0a2ddf798
  SCHEMA:19969d6d-daaa-328f-ade0-8640043e37b9
  NET_VERSION:6
  LOAD:52153.0
  RPC_ADDRESS:127.0.0.1
  RACK:rack1
  DC:datacenter1
  RELEASE_VERSION:1.2.0-SNAPSHOT
  STATUS:NORMAL,-9223372036854775808

rhatch@whatup:/tmp/dtest-VZ3n7v/test/node1$ bin/nodetool -p 7300 gossipinfo
/127.0.0.2
  NET_VERSION:6
  RELEASE_VERSION:1.2.0-SNAPSHOT
  DC:datacenter1
  SCHEMA:19969d6d-daaa-328f-ade0-8640043e37b9
  HOST_ID:8929d0a0-5a4f-4a6f-85c3-665bb3aaf140
  LOAD:52150.0
  STATUS:NORMAL,-3074457345618258603
  RACK:rack1
  RPC_ADDRESS:127.0.0.2
/127.0.0.3
  NET_VERSION:6
  RELEASE_VERSION:1.2.0-SNAPSHOT
  DC:datacenter1
  SCHEMA:59adb24e-f3cd-3e02-97f0-5b395827453f
  HOST_ID:864a00d4-f661-421e-81c3-90e7b8f90ef1
  LOAD:14361.0
  STATUS:NORMAL,3074457345618258602
  RACK:rack1
  RPC_ADDRESS:127.0.0.3
/127.0.0.1
  NET_VERSION:6
  RELEASE_VERSION:1.2.0-SNAPSHOT
  DC:datacenter1
  SCHEMA:19969d6d-daaa-328f-ade0-8640043e37b9
  HOST_ID:06bbda3d-5265-4134-8248-11e0a2ddf798
  LOAD:52153.0
  STATUS:NORMAL,-9223372036854775808
  RACK:rack1
  RPC_ADDRESS:127.0.0.1
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="13960842" author="rhatch" created="Sat, 5 Apr 2014 00:16:37 +0000"  >&lt;p&gt;attaching logs with debug output.&lt;/p&gt;</comment>
                            <comment id="13960844" author="brandon.williams" created="Sat, 5 Apr 2014 00:16:59 +0000"  >&lt;p&gt;Ok, so we know the problem is in the &apos;passive&apos; detection.  That narrows it down, thanks.&lt;/p&gt;</comment>
                            <comment id="13960847" author="brandon.williams" created="Sat, 5 Apr 2014 00:26:00 +0000"  >&lt;p&gt;Can you get debug logs with this extra debugging patch applied?&lt;/p&gt;</comment>
                            <comment id="13960884" author="rhatch" created="Sat, 5 Apr 2014 01:16:38 +0000"  >&lt;p&gt;weird, with the logging patch I didn&apos;t see any output from MigrationManager. I did see this exception though (maybe was occuring before and I just didn&apos;t notice):&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;DEBUG [Thrift:2] 2014-04-04 19:03:59,051 CustomTThreadPoolServer.java (line 209) Thrift transport error occurred during processing of message.
org.apache.thrift.transport.TTransportException
	at org.apache.thrift.transport.TIOStreamTransport.read(TIOStreamTransport.java:132)
	at org.apache.thrift.transport.TTransport.readAll(TTransport.java:84)
	at org.apache.thrift.transport.TFramedTransport.readFrame(TFramedTransport.java:129)
	at org.apache.thrift.transport.TFramedTransport.read(TFramedTransport.java:101)
	at org.apache.thrift.transport.TTransport.readAll(TTransport.java:84)
	at org.apache.thrift.protocol.TBinaryProtocol.readAll(TBinaryProtocol.java:378)
	at org.apache.thrift.protocol.TBinaryProtocol.readI32(TBinaryProtocol.java:297)
	at org.apache.thrift.protocol.TBinaryProtocol.readMessageBegin(TBinaryProtocol.java:204)
	at org.apache.thrift.TBaseProcessor.process(TBaseProcessor.java:22)
	at org.apache.cassandra.thrift.CustomTThreadPoolServer$WorkerProcess.run(CustomTThreadPoolServer.java:199)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1145)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:615)
	at java.lang.Thread.run(Thread.java:744)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="13960892" author="brandon.williams" created="Sat, 5 Apr 2014 01:29:33 +0000"  >&lt;p&gt;That&apos;s unrelated and it&apos;s at debug for a reason, it just means a client dropped the connection on us.&lt;/p&gt;</comment>
                            <comment id="13960909" author="rhatch" created="Sat, 5 Apr 2014 02:01:47 +0000"  >&lt;p&gt;attaching logs with debug patch (from a test run when the problem happened of course).&lt;/p&gt;</comment>
                            <comment id="13960913" author="brandon.williams" created="Sat, 5 Apr 2014 02:11:22 +0000"  >&lt;p&gt;My guess is that passiveAnnounce hasn&apos;t been called in time when the onAlive/onRestart events have been called closely enough, so we need to also check onChange.  Patch to do so, plus the debugging.&lt;/p&gt;</comment>
                            <comment id="13963288" author="rhatch" created="Tue, 8 Apr 2014 18:37:51 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=brandon.williams&quot; class=&quot;user-hover&quot; rel=&quot;brandon.williams&quot;&gt;brandon.williams&lt;/a&gt; Not sure where I went wrong, but I can&apos;t get the patch to apply cleanly to latest cassandra-1.2 branch. It will apply to trunk but I haven&apos;t seen the bug there, and I think the way it applies to trunk would result in dead code since we get a duplicate SCHEMA case:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;                case SCHEMA:
                    SystemKeyspace.updatePeerInfo(endpoint, &quot;schema_version&quot;, value.value);
                    break;
                case HOST_ID:
                    SystemKeyspace.updatePeerInfo(endpoint, &quot;host_id&quot;, value.value);
                    break;
                case SCHEMA:
                    MigrationManager.instance.scheduleSchemaPull(endpoint, epState);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="13963330" author="rhatch" created="Tue, 8 Apr 2014 19:20:48 +0000"  >&lt;p&gt;I ran the test 10 times with the patch (modified a bit) and the problem does not seem to be happening anymore.&lt;/p&gt;</comment>
                            <comment id="13963340" author="brandon.williams" created="Tue, 8 Apr 2014 19:35:20 +0000"  >&lt;p&gt;Committed, thanks!&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                                                <inwardlinks description="is duplicated by">
                                        <issuelink>
            <issuekey id="12713504">CASSANDRA-7205</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12638809" name="6971-debugging.txt" size="2260" author="brandon.williams" created="Sat, 5 Apr 2014 00:25:59 +0000"/>
                            <attachment id="12638826" name="6971.txt" size="2946" author="brandon.williams" created="Sat, 5 Apr 2014 02:11:22 +0000"/>
                            <attachment id="12638822" name="debug1.log" size="16864" author="rhatch" created="Sat, 5 Apr 2014 02:01:47 +0000"/>
                            <attachment id="12638823" name="debug2.log" size="11229" author="rhatch" created="Sat, 5 Apr 2014 02:01:47 +0000"/>
                            <attachment id="12638824" name="debug3.log" size="11355" author="rhatch" created="Sat, 5 Apr 2014 02:01:47 +0000"/>
                            <attachment id="12638806" name="node1.log" size="43511" author="rhatch" created="Sat, 5 Apr 2014 00:16:37 +0000"/>
                            <attachment id="12638287" name="node1.log" size="15797" author="rhatch" created="Wed, 2 Apr 2014 16:34:22 +0000"/>
                            <attachment id="12638807" name="node2.log" size="42185" author="rhatch" created="Sat, 5 Apr 2014 00:16:37 +0000"/>
                            <attachment id="12638288" name="node2.log" size="14391" author="rhatch" created="Wed, 2 Apr 2014 16:34:22 +0000"/>
                            <attachment id="12638808" name="node3.log" size="36772" author="rhatch" created="Sat, 5 Apr 2014 00:16:37 +0000"/>
                            <attachment id="12638289" name="node3.log" size="10457" author="rhatch" created="Wed, 2 Apr 2014 16:34:22 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>11.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[brandon.williams]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>384380</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            11 years, 33 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1u7xz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>384648</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12311421" key="com.atlassian.jira.plugin.system.customfieldtypes:multiversion">
                        <customfieldname>Reproduced In</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="12326707">1.2.17</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>rhatch</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[rhatch]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12962"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>