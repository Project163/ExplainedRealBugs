<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 23:05:44 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-12768] CQL often queries static columns unnecessarily</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-12768</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;While looking at &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-12694&quot; title=&quot;PAXOS Update Corrupted empty row exception&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-12694&quot;&gt;&lt;del&gt;CASSANDRA-12694&lt;/del&gt;&lt;/a&gt; (which isn&apos;t directly related, but some of the results in this ticket are explained by this), I realized that CQL was always querying static columns even in cases where this is unnecessary.&lt;/p&gt;

&lt;p&gt;More precisely, for reasons long described elsewhere, we have to query all the columns for a row (we have optimizations, see &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-10657&quot; title=&quot;Re-enable/improve value skipping&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-10657&quot;&gt;&lt;del&gt;CASSANDRA-10657&lt;/del&gt;&lt;/a&gt;, but they don&apos;t change that general fact) to be able to distinguish between the case where a row doesn&apos;t exist from when it exists but has no values for the columns selected by the query. &lt;b&gt;However&lt;/b&gt;, this really only extend to &quot;regular&quot; columns (static columns play no role in deciding whether a particular row exists or not) but the implementation in 3.x, which is in &lt;tt&gt;ColumnFilter&lt;/tt&gt;, still always query all static columns.&lt;/p&gt;

&lt;p&gt;We shouldn&apos;t do that and it&apos;s arguably a performance regression from 2.x. Which is why I&apos;m tentatively marking this a bug and for the 3.0 line. It&apos;s a tiny bit scary for 3.0 though so really more asking for other opinions and I&apos;d be happy to stick to 3.x.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13011021">CASSANDRA-12768</key>
            <summary>CQL often queries static columns unnecessarily</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10002" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Normal</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="slebresne">Sylvain Lebresne</assignee>
                                    <reporter username="slebresne">Sylvain Lebresne</reporter>
                        <labels>
                    </labels>
                <created>Mon, 10 Oct 2016 12:58:52 +0000</created>
                <updated>Tue, 16 Apr 2019 09:30:17 +0000</updated>
                            <resolved>Fri, 9 Dec 2016 10:37:31 +0000</resolved>
                                        <fixVersion>3.0.11</fixVersion>
                    <fixVersion>3.10</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>7</watches>
                                                                                                                <comments>
                            <comment id="15562447" author="slebresne" created="Mon, 10 Oct 2016 14:29:31 +0000"  >&lt;p&gt;Patch attached below:&lt;/p&gt;
&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;a href=&quot;https://github.com/pcmanus/cassandra/commits/12768-3.0&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;12768-3.0&lt;/a&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;a href=&quot;http://cassci.datastax.com/job/pcmanus-12768-3.0-testall&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;utests&lt;/a&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;a href=&quot;http://cassci.datastax.com/job/pcmanus-12768-3.0-dtest&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;dtests&lt;/a&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;a href=&quot;https://github.com/pcmanus/cassandra/commits/12768-3.X&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;12768-3.X&lt;/a&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;a href=&quot;http://cassci.datastax.com/job/pcmanus-12768-3.X-testall&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;utests&lt;/a&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;a href=&quot;http://cassci.datastax.com/job/pcmanus-12768-3.X-dtest&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;dtests&lt;/a&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;


&lt;p&gt;The 3.X patch is a tad bigger because 1) &lt;tt&gt;ColumnFilter&lt;/tt&gt; has been refactored a bit since 3.0 and 2) I&apos;ve tried to clean up naming a bit more than in 3.0 where I optimized more for less changes.&lt;/p&gt;</comment>
                            <comment id="15683815" author="slebresne" created="Mon, 21 Nov 2016 15:11:17 +0000"  >&lt;p&gt;I rebased the branches (no change), but maybe a gentle ping for review and this kind of block &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-12694&quot; title=&quot;PAXOS Update Corrupted empty row exception&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-12694&quot;&gt;&lt;del&gt;CASSANDRA-12694&lt;/del&gt;&lt;/a&gt; right now (we could do without this, but it&apos;s better with it and it&apos;s easy enough I feel).&lt;/p&gt;</comment>
                            <comment id="15687479" author="thobbs" created="Tue, 22 Nov 2016 18:21:16 +0000"  >&lt;p&gt;Sorry for the slow review, this fell off my radar.&lt;/p&gt;

&lt;p&gt;Overall I think the patches will be fine to apply to both 3.0 and 3.x.  I just have a few questions and comments on the patch:&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;Why doesn&apos;t &lt;tt&gt;returnStaticContentOnPartitionWithNoRows()&lt;/tt&gt; specifically handle secondary index queries specially like the 3.0 patch?  It looks like this was already the case elsewhere in 3.x, but I&apos;d like to confirm the reason.&lt;/li&gt;
	&lt;li&gt;We might as well rename &lt;tt&gt;isFetchAllRegulars&lt;/tt&gt; to &lt;tt&gt;fetchAllRegulars&lt;/tt&gt; in the 3.x patch, since the latter feels more natural.&lt;/li&gt;
	&lt;li&gt;Why doesn&apos;t the 3.0 patch include the change to &lt;tt&gt;ColumnFilter.newTester()&lt;/tt&gt; that you have in 3.x?&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Additionally, it looks like there&apos;s a static column related test error in the &lt;a href=&quot;http://cassci.datastax.com/job/pcmanus-12768-3.0-dtest/lastCompletedBuild/testReport/paging_test/TestPagingData/static_columns_paging_test/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;3.0 dtests&lt;/a&gt;.  Can you look into that?&lt;/p&gt;</comment>
                            <comment id="15724987" author="slebresne" created="Tue, 6 Dec 2016 09:58:57 +0000"  >&lt;blockquote&gt;&lt;p&gt;Why doesn&apos;t the 3.0 patch include the change to &lt;tt&gt;ColumnFilter.newTester()&lt;/tt&gt; that you have in 3.x?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;No reason that I can remember, this seems to be an oversight, so added.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;Why doesn&apos;t &lt;tt&gt;returnStaticContentOnPartitionWithNoRows()&lt;/tt&gt; specifically handle secondary index queries specially like the 3.0 patch? &lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;You know what, I don&apos;t know and that&apos;s not due to this patch. &lt;tt&gt;git&lt;/tt&gt; seems to blame the merge commit done for &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-6377&quot; title=&quot;ALLOW FILTERING should allow seq scan filtering&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-6377&quot;&gt;&lt;del&gt;CASSANDRA-6377&lt;/del&gt;&lt;/a&gt; by &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=blerer&quot; class=&quot;user-hover&quot; rel=&quot;blerer&quot;&gt;blerer&lt;/a&gt; for that removal, so &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=blerer&quot; class=&quot;user-hover&quot; rel=&quot;blerer&quot;&gt;blerer&lt;/a&gt; might be able to say if there is some reason behind it or if it&apos;s a merge error. Should be dealt with someplace else though really.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;t looks like there&apos;s a static column related test error&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Yes, and that was legit, due to missing to update the &lt;tt&gt;ColumnFilter.includesAllColumns&lt;/tt&gt; method properly, so fixed that (3.X was a bit different here and not affected, but I still changing the method to match as that felt more easy to follow).&lt;/p&gt;

&lt;p&gt;I&apos;ve restarted CI, waiting on the results.&lt;/p&gt;</comment>
                            <comment id="15727047" author="thobbs" created="Tue, 6 Dec 2016 23:16:37 +0000"  >&lt;p&gt;The latest commits and test runs look good to me, so +1 on committing those.&lt;/p&gt;

&lt;p&gt;However, I do still want to figure out what&apos;s up with the behavior in &lt;tt&gt;returnStaticContentOnPartitionWithNoRows()&lt;/tt&gt; in 3.x vs 3.0.  &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=blerer&quot; class=&quot;user-hover&quot; rel=&quot;blerer&quot;&gt;blerer&lt;/a&gt; can you open a new ticket for that if needed, and if not, explain why here?&lt;/p&gt;</comment>
                            <comment id="15728444" author="slebresne" created="Wed, 7 Dec 2016 10:53:23 +0000"  >&lt;p&gt;Alright, committed, thanks.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;However, I do still want to figure out what&apos;s up with the behavior in &lt;tt&gt;returnStaticContentOnPartitionWithNoRows()&lt;/tt&gt;&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Agreed. I actually created &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-13013&quot; title=&quot;Potential regression from CASSANDRA-6377&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-13013&quot;&gt;&lt;del&gt;CASSANDRA-13013&lt;/del&gt;&lt;/a&gt; to make we don&apos;t lose track of this. I was wrong btw, it&apos;s definitively not a merge error since the original patch for trunk on &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-6377&quot; title=&quot;ALLOW FILTERING should allow seq scan filtering&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-6377&quot;&gt;&lt;del&gt;CASSANDRA-6377&lt;/del&gt;&lt;/a&gt; had that removal. So there may be a good reason this is not needed anymore I&apos;m missing right now, but we&apos;ll get an answer on that followup ticket.&lt;/p&gt;</comment>
                            <comment id="15732919" author="mshuler" created="Thu, 8 Dec 2016 18:04:25 +0000"  >&lt;p&gt;This commit appears to have not been merged to the cassandra-3.11 branch, where 3.10 will be released from. Please merge.&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;(cassandra-3.11)mshuler@hana:~/git/cassandra$ git log ..cassandra-3.0
commit d9b06e8af41c42244f76058641aeecda53a9bf75 (origin/cassandra-3.0, cassandra-3.0)
Author: Alex Petrov &amp;lt;oleksandr.petrov@gmail.com&amp;gt;
Date:   Wed Dec 7 16:04:51 2016 +0100

    Make distinction between unset row and non-existing partition for LWTs
    
    Patch by Alex Petrov; reviewed by Sylvain Lebresne for CASSANDRA-12964.

commit 3aefe356545bcc2f5c4453e0d9d704bef339a008 (github/cassandra-3.0)
Merge: 95d0b67 0b97c5d
Author: Robert Stupp &amp;lt;snazy@snazy.de&amp;gt;
Date:   Wed Dec 7 13:08:35 2016 +0100

    Merge branch &apos;cassandra-2.2&apos; into cassandra-3.0

commit 0b97c5d1f717be30a04c59c766465d9c62a4e9ee (origin/cassandra-2.2, github/cassandra-2.2, cassandra-2.2)
Author: Robert Stupp &amp;lt;snazy@snazy.de&amp;gt;
Date:   Wed Dec 7 13:06:55 2016 +0100

    testall failure in org.apache.cassandra.cql3.validation.entities.UFTest.testAllNativeTypes
    
    patch by Robert Stupp; reviewed by Alex Petrov for CASSANDRA-12817

commit 95d0b671d1af154eaf1c1e81992c7f3f51469eee
Author: Sylvain Lebresne &amp;lt;sylvain@datastax.com&amp;gt;
Date:   Mon Oct 10 13:36:15 2016 +0200

    CQL often queries static columns unnecessarily
    
    patch by Sylvain Lebresne; reviewed by Tyler Hobbs for CASSANDRA-12768
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="15734945" author="slebresne" created="Fri, 9 Dec 2016 10:37:31 +0000"  >&lt;p&gt;Merged to the misnamed branch.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10001">
                    <name>dependent</name>
                                                                <inwardlinks description="is depended upon by">
                                        <issuelink>
            <issuekey id="13007018">CASSANDRA-12694</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[slebresne]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 49 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i34o3z:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>thobbs</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[thobbs]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12962"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>