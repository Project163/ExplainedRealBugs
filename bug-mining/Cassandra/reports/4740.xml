<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 23:07:23 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-12835] Tracing payload not passed from QueryMessage to tracing session</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-12835</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;Caused by &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-10392&quot; title=&quot;Allow Cassandra to trace to custom tracing implementations&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-10392&quot;&gt;&lt;del&gt;CASSANDRA-10392&lt;/del&gt;&lt;/a&gt;.&lt;br/&gt;
Related to &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-11706&quot; title=&quot;Tracing payload not passed through newSession(..)&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-11706&quot;&gt;&lt;del&gt;CASSANDRA-11706&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;When querying using CQL statements (not prepared) the message type is QueryMessage and the code in &lt;a href=&quot;https://github.com/apache/cassandra/blob/trunk/src/java/org/apache/cassandra/transport/messages/QueryMessage.java#L101&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/cassandra/blob/trunk/src/java/org/apache/cassandra/transport/messages/QueryMessage.java#L101&lt;/a&gt; is as follows:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;            &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (state.traceNextQuery())
            {
                state.createTracingSession();

                ImmutableMap.Builder&amp;lt;&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;, &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;&amp;gt; builder = ImmutableMap.builder();
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;tt&gt;state.createTracingSession();&lt;/tt&gt; should probably be &lt;tt&gt;state.createTracingSession(getCustomPayload());&lt;/tt&gt;. At least that fixes the problem for me.&lt;/p&gt;

&lt;p&gt;This also raises the question whether some other parts of the code should pass the custom payload as well (I&apos;m not the right person to analyze this):&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;$ ag createTracingSession
src/java/org/apache/cassandra/service/QueryState.java
80:    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void createTracingSession()
82:        createTracingSession(Collections.EMPTY_MAP);
85:    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void createTracingSession(Map&amp;lt;&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;,ByteBuffer&amp;gt; customPayload)

src/java/org/apache/cassandra/thrift/CassandraServer.java
2528:            state().getQueryState().createTracingSession();

src/java/org/apache/cassandra/transport/messages/BatchMessage.java
163:                state.createTracingSession();

src/java/org/apache/cassandra/transport/messages/ExecuteMessage.java
114:                state.createTracingSession(getCustomPayload());

src/java/org/apache/cassandra/transport/messages/QueryMessage.java
101:                state.createTracingSession();

src/java/org/apache/cassandra/transport/messages/PrepareMessage.java
74:                state.createTracingSession();
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This is not marked as `minor` as the &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-11706&quot; title=&quot;Tracing payload not passed through newSession(..)&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-11706&quot;&gt;&lt;del&gt;CASSANDRA-11706&lt;/del&gt;&lt;/a&gt; was because this cannot be fixed by the tracing plugin.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13014757">CASSANDRA-12835</key>
            <summary>Tracing payload not passed from QueryMessage to tracing session</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10000" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Urgent</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="mck">Michael Semb Wever</assignee>
                                    <reporter username="hkroger">Hannu Kr&#246;ger</reporter>
                        <labels>
                            <label>tracing</label>
                    </labels>
                <created>Mon, 24 Oct 2016 15:09:29 +0000</created>
                <updated>Fri, 15 May 2020 08:03:45 +0000</updated>
                            <resolved>Sun, 23 Apr 2017 02:45:12 +0000</resolved>
                                        <fixVersion>3.11.0</fixVersion>
                    <fixVersion>4.0-alpha1</fixVersion>
                    <fixVersion>4.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="15606626" author="michaelsembwever" created="Tue, 25 Oct 2016 22:10:47 +0000"  >&lt;p&gt;Patch at &lt;a href=&quot;https://github.com/thelastpickle/cassandra/commit/f98ce3a0141e7254ec555a01b7c9349c121c4567&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/thelastpickle/cassandra/commit/f98ce3a0141e7254ec555a01b7c9349c121c4567&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This covers all the occurrences you mentioned.&lt;br/&gt;
To make the api more obvious I&apos;ve removed the no-parameter method. That is passing in the custom payload is the normal coding approach.&lt;/p&gt;

&lt;p&gt;I&apos;ve found no suitable way to unit test this.&lt;/p&gt;</comment>
                            <comment id="15606975" author="jjirsa" created="Wed, 26 Oct 2016 01:00:11 +0000"  >&lt;blockquote&gt;&lt;p&gt;I&apos;ve found no suitable way to unit test this.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;dtest without prepared statements similar to what you did for &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-10392&quot; title=&quot;Allow Cassandra to trace to custom tracing implementations&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-10392&quot;&gt;&lt;del&gt;CASSANDRA-10392&lt;/del&gt;&lt;/a&gt; ? &lt;/p&gt;</comment>
                            <comment id="15608033" author="michaelsembwever" created="Wed, 26 Oct 2016 09:57:10 +0000"  >&lt;p&gt;Yes, unfortunately.&lt;/p&gt;</comment>
                            <comment id="15623987" author="michaelsembwever" created="Tue, 1 Nov 2016 01:25:00 +0000"  >&lt;p&gt;I&apos;m still struggling to find a way (acceptable) to assert that the custom payload makes it through to the tracing implementation. The default implementation doesn&apos;t capture any custom payload, and to use a custom class (eg from one the test classpath) won&apos;t be overly versatile as dtests execute either off a cassandra git clone or off a specified version&#8230;&lt;/p&gt;

&lt;p&gt;In lei of that, I&apos;ll add some unit tests that add a few assertions, but they won&apos;t catch this specific failure.&lt;/p&gt;</comment>
                            <comment id="15642828" author="michaelsembwever" created="Mon, 7 Nov 2016 02:07:16 +0000"  >&lt;p&gt;&amp;gt; In lei of that, I&apos;ll add some unit tests that add a few assertions, but they won&apos;t catch this specific failure.&lt;/p&gt;

&lt;p&gt;Didn&apos;t have much luck with that either.&lt;/p&gt;

&lt;p&gt;Will attach the patches as they are.&lt;/p&gt;</comment>
                            <comment id="15642855" author="michaelsembwever" created="Mon, 7 Nov 2016 02:20:55 +0000"  >&lt;p&gt;Patches for 3.X and trunk.&lt;/p&gt;</comment>
                            <comment id="15972551" author="michaelsembwever" created="Tue, 18 Apr 2017 11:59:41 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tjake&quot; class=&quot;user-hover&quot; rel=&quot;tjake&quot;&gt;tjake&lt;/a&gt;, patches are updated here:&lt;/p&gt;
&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt; Branch 	&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt; Testall 	&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt; Dtest &lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;a href=&quot;https://github.com/michaelsembwever/cassandra/commit/56770c6c6a0268b9b0a2f8927df41f61e02e38f6&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;3.11&lt;/a&gt; 	&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;a href=&quot;https://circleci.com/gh/michaelsembwever/cassandra/tree/mck%2Fcassandra-3.X-CASSANDRA-12835&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;testall&lt;/a&gt; 	&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;a href=&quot;https://builds.apache.org/view/A-D/view/Cassandra/job/Cassandra-devbranch-dtest/20/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;dtest&lt;/a&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;a href=&quot;https://github.com/michaelsembwever/cassandra/commit/4ab20fdad52c6fe645e996598da225547cce973f&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;trunk&lt;/a&gt; 	&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;a href=&quot;https://circleci.com/gh/michaelsembwever/cassandra/tree/mck%2Ftrunk_CASSANDRA-12835&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;testall&lt;/a&gt; 	&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;a href=&quot;https://builds.apache.org/view/A-D/view/Cassandra/job/Cassandra-devbranch-dtest/19/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;dtest&lt;/a&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;


&lt;p&gt;(dtests are queued and will likely take some time to complete)&lt;/p&gt;</comment>
                            <comment id="15972616" author="tjake" created="Tue, 18 Apr 2017 13:02:26 +0000"  >&lt;p&gt;Changes make sense.&lt;/p&gt;

&lt;p&gt;One nit: I think you&apos;ve included an unused import in the TracingTest: org.apache.commons.lang3.StringUtils&lt;/p&gt;

&lt;p&gt;+1 assuming the tests look good.&lt;/p&gt;</comment>
                            <comment id="15973938" author="michaelsembwever" created="Wed, 19 Apr 2017 02:36:47 +0000"  >&lt;blockquote&gt;&lt;p&gt;One nit: I think you&apos;ve included an unused import in the TracingTest: org.apache.commons.lang3.StringUtils&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;StringUtils is used on line 194.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;+1 assuming the tests look good.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tjake&quot; class=&quot;user-hover&quot; rel=&quot;tjake&quot;&gt;tjake&lt;/a&gt;, Is protocol for you as the reviewer still to push my commit? Or given a commented &quot;+1&quot; by the reviewer am I free to push (updating the commit msg to mark you as reviewer)?&lt;/p&gt;</comment>
                            <comment id="15975754" author="michaelsembwever" created="Wed, 19 Apr 2017 23:46:12 +0000"  >&lt;blockquote&gt;&lt;p&gt;given a commented &quot;+1&quot; by the reviewer am I free to push (updating the commit msg to mark you as reviewer)?&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;looking through the commit log it would appear the answer is yes &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;just waiting for the dtests to finish before pushing.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[mck]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 30 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i35b0v:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>tjake</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[tjake]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12963"><![CDATA[Critical]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>