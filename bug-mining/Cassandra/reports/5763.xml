<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 23:20:59 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-16704] Fix imports; run tests with packaged dependencies</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-16704</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;Tests are currently run with a classpath containing &lt;em&gt;all&lt;/em&gt; downloaded jars. The tests would be more reflective of the behavior of a runtime environment if the test classpath only contained jars that are bundled with the binary release, together with explicit test dependencies. Ideally we&apos;d use the build/lib/ jars for the classpath since that&apos;s what gets packaged, but since these aren&apos;t available at test compile time and should be identical to lib/ anyway, I&apos;ve used the later.&lt;/p&gt;

&lt;p&gt;Doing so exposed a couple of references in src/java to &quot;org.apache.commons.lang&quot;, which is not available at runtime (should be &quot;org.apache.commons.lang*3*&quot;).&lt;/p&gt;

&lt;p&gt;Attached patch modifies the test classpath, fixes various imports in both test/ and src/ classes, and makes some simple substitutions in the tests such as using AbstractMap.SimpleEntry in place of org.apache.commons.collections.keyvalue.AbstractMapEntry.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13381019">CASSANDRA-16704</key>
            <summary>Fix imports; run tests with packaged dependencies</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10002" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Normal</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="polo-language">Angelo Polo</assignee>
                                    <reporter username="polo-language">Angelo Polo</reporter>
                        <labels>
                    </labels>
                <created>Fri, 28 May 2021 16:03:14 +0000</created>
                <updated>Fri, 27 May 2022 19:25:04 +0000</updated>
                            <resolved>Sat, 12 Jun 2021 10:05:39 +0000</resolved>
                                        <fixVersion>4.0.1</fixVersion>
                    <fixVersion>4.1-alpha1</fixVersion>
                    <fixVersion>4.1</fixVersion>
                                    <component>Build</component>
                    <component>Test/burn</component>
                    <component>Test/unit</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="17355174" author="brandon.williams" created="Tue, 1 Jun 2021 15:37:01 +0000"  >&lt;p&gt;&lt;a href=&quot;https://ci-cassandra.apache.org/blue/organizations/jenkins/Cassandra-devbranch/detail/Cassandra-devbranch/828/pipeline&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;&lt;span class=&quot;image-wrap&quot; style=&quot;&quot;&gt;&lt;img src=&quot;https://ci-cassandra.apache.org/job/Cassandra-devbranch/828/badge/icon&quot; style=&quot;border: 0px solid black&quot; /&gt;&lt;/span&gt;&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17355795" author="brandon.williams" created="Wed, 2 Jun 2021 15:16:42 +0000"  >&lt;p&gt;LGTM, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mck&quot; class=&quot;user-hover&quot; rel=&quot;mck&quot;&gt;mck&lt;/a&gt; can you take a look as well?&lt;/p&gt;</comment>
                            <comment id="17356333" author="michaelsembwever" created="Thu, 3 Jun 2021 10:53:16 +0000"  >&lt;p&gt;(To rehash, mostly for my own sake&#8230;)&lt;br/&gt;
The differences between &lt;tt&gt;build/lib/jars/&lt;/tt&gt; and &lt;tt&gt;lib/&lt;/tt&gt; are the following.&lt;/p&gt;

&lt;p&gt;Only &lt;tt&gt;lib/&lt;/tt&gt; contains:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;cassandra-driver-internal-only-3.25.0.zip&lt;/li&gt;
	&lt;li&gt;futures-2.1.6-py2.py3-none-any.zip&lt;/li&gt;
	&lt;li&gt;geomet-0.1.0.zip&lt;/li&gt;
	&lt;li&gt;sigar-bin/&lt;/li&gt;
	&lt;li&gt;six-1.12.0-py2.py3-none-any.zip&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;This is just the additional binary and python dependencies.&lt;/p&gt;

&lt;p&gt;Only &lt;tt&gt;build/lib/jars/&lt;/tt&gt; contains:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;antlr-3.5.2.jar&lt;/li&gt;
	&lt;li&gt;assertj-core-3.15.0.jar&lt;/li&gt;
	&lt;li&gt;byteman-4.0.6.jar&lt;/li&gt;
	&lt;li&gt;byteman-bmunit-4.0.6.jar&lt;/li&gt;
	&lt;li&gt;byteman-install-4.0.6.jar&lt;/li&gt;
	&lt;li&gt;byteman-submit-4.0.6.jar&lt;/li&gt;
	&lt;li&gt;commons-beanutils-1.7.0.jar&lt;/li&gt;
	&lt;li&gt;commons-beanutils-core-1.8.0.jar&lt;/li&gt;
	&lt;li&gt;commons-collections-3.2.1.jar&lt;/li&gt;
	&lt;li&gt;commons-configuration-1.6.jar&lt;/li&gt;
	&lt;li&gt;commons-digester-1.8.jar&lt;/li&gt;
	&lt;li&gt;commons-el-1.0.jar&lt;/li&gt;
	&lt;li&gt;commons-httpclient-3.0.1.jar&lt;/li&gt;
	&lt;li&gt;commons-lang-2.4.jar&lt;/li&gt;
	&lt;li&gt;commons-math-2.1.jar&lt;/li&gt;
	&lt;li&gt;commons-net-1.4.1.jar&lt;/li&gt;
	&lt;li&gt;compile-command-annotations-1.2.0.jar&lt;/li&gt;
	&lt;li&gt;compress-lzf-0.8.4.jar&lt;/li&gt;
	&lt;li&gt;ftplet-api-1.0.0.jar&lt;/li&gt;
	&lt;li&gt;ftpserver-core-1.0.0.jar&lt;/li&gt;
	&lt;li&gt;ftpserver-deprecated-1.0.0-M2.jar&lt;/li&gt;
	&lt;li&gt;hadoop-core-1.0.3.jar&lt;/li&gt;
	&lt;li&gt;hadoop-minicluster-1.0.3.jar&lt;/li&gt;
	&lt;li&gt;hadoop-test-1.0.3.jar&lt;/li&gt;
	&lt;li&gt;hsqldb-1.8.0.10.jar&lt;/li&gt;
	&lt;li&gt;jackson-core-asl-1.0.1.jar&lt;/li&gt;
	&lt;li&gt;jackson-mapper-asl-1.0.1.jar&lt;/li&gt;
	&lt;li&gt;jacocoagent.jar&lt;/li&gt;
	&lt;li&gt;jasper-compiler-5.5.12.jar&lt;/li&gt;
	&lt;li&gt;jasper-runtime-5.5.12.jar&lt;/li&gt;
	&lt;li&gt;jersey-core-1.0.jar&lt;/li&gt;
	&lt;li&gt;jersey-server-1.0.jar&lt;/li&gt;
	&lt;li&gt;jets3t-0.7.1.jar&lt;/li&gt;
	&lt;li&gt;jetty-6.1.26.jar&lt;/li&gt;
	&lt;li&gt;jetty-util-6.1.26.jar&lt;/li&gt;
	&lt;li&gt;jsp-2.1-6.1.14.jar&lt;/li&gt;
	&lt;li&gt;jsp-api-2.1-6.1.14.jar&lt;/li&gt;
	&lt;li&gt;jsr305-2.0.2.jar&lt;/li&gt;
	&lt;li&gt;jsr311-api-1.0.jar&lt;/li&gt;
	&lt;li&gt;kfs-0.3.jar&lt;/li&gt;
	&lt;li&gt;mina-core-2.0.0-M5.jar&lt;/li&gt;
	&lt;li&gt;netty-bom-4.1.58.Final.pom&lt;/li&gt;
	&lt;li&gt;oro-2.0.8.jar&lt;/li&gt;
	&lt;li&gt;servlet-api-2.5-6.1.14.jar&lt;/li&gt;
	&lt;li&gt;xmlenc-0.52.jar&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;This should be only the additional &quot;provided&quot; scope.&lt;/p&gt;

&lt;p&gt;Maybe there are jar files here that should be removed, i.e. should not even be part the provided scope?&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;Tests are currently run with a classpath containing all downloaded jars. &lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;To be accurate &lt;tt&gt;build/lib/jars/&lt;/tt&gt;  is intended to be the &lt;a href=&quot;https://github.com/apache/cassandra/blob/cassandra-4.0-rc1/.build/build-resolver.xml#L174&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;compile+provided scoped&lt;/a&gt; dependency tree, while &lt;tt&gt;lib/&lt;/tt&gt; is only the &lt;a href=&quot;https://github.com/apache/cassandra/blob/cassandra-4.0-rc1/.build/build-resolver.xml#L196&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;compile&lt;/a&gt; scoped dependency tree.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;The tests would be more reflective of the behavior of a runtime environment if the test classpath only contained jars that are bundled with the binary release, together with explicit test dependencies. &lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Tests can run against those optional dependencies that we don&apos;t bundle. I don&apos;t think that is currently the case for any tests, but it can be.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;Ideally we&apos;d use the build/lib/ jars for the classpath since that&apos;s what gets packaged, but since these aren&apos;t available at test compile time and should be identical to lib/ anyway, I&apos;ve used the later.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I&apos;m not quite understanding this statement, if &lt;tt&gt;build/lib/jars/&lt;/tt&gt; doesn&apos;t exist then neither does &lt;tt&gt;lib/&lt;/tt&gt;.&lt;/p&gt;

&lt;p&gt;The &lt;tt&gt;lib/&lt;/tt&gt; contents are put together later in the build cycle (under the &lt;tt&gt;resolver-dist-lib&lt;/tt&gt; target) than the &lt;tt&gt;build/lib/jars/&lt;/tt&gt; contents (which are done under the &lt;tt&gt;resolver-retrieve-build&lt;/tt&gt; target). There is a valid question here as to whether we want tests to now depend upon the &lt;tt&gt;resolver-dist-lib&lt;/tt&gt; target.&lt;/p&gt;</comment>
                            <comment id="17356350" author="polo-language" created="Thu, 3 Jun 2021 11:36:51 +0000"  >&lt;blockquote&gt;&lt;p&gt;Tests can run against those optional dependencies that we don&apos;t bundle. I don&apos;t think that is currently the case for any tests, but it can be.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;My thinking is that such dependencies should then become explicit test dependencies, rather than allowing transitive dependencies (which may disappear or change version when any other dependency is updated) to creep into the tests. Though I don&apos;t know what &apos;provided&apos; means here so hopefully I haven&apos;t misunderstood something.&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;I&apos;m not quite understanding this statement, if build/lib/jars/ doesn&apos;t exist then neither does lib/.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Oops, this was supposed to be build/dist/lib/.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;My patch doesn&apos;t touch the IDE classpaths. Should just be a matter of removing this &lt;a href=&quot;https://github.com/apache/cassandra/blob/3282f5ecf187ecbb56b8d73ab9a9110c010898b0/build.xml#L2005&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;fileset&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="17356373" author="michaelsembwever" created="Thu, 3 Jun 2021 11:44:59 +0000"  >&lt;blockquote&gt;&lt;p&gt;My thinking is that such dependencies should then become explicit test dependencies&#8230;&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;They are in places, see all those marked as &quot;provided&quot; or &quot;optional&quot; &lt;a href=&quot;https://github.com/apache/cassandra/blob/cassandra-4.0-rc1/build.xml#L491-L657&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;here&lt;/a&gt; and &lt;a href=&quot;https://github.com/apache/cassandra/blob/cassandra-4.0-rc1/build.xml#L749-L833&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;here&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;Note, these do also include those dependencies needed solely for the sake of compiling.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;&#8230;rather than allowing transitive dependencies (which may disappear or change version when any other dependency is updated) to creep into the tests.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;The &lt;tt&gt;lib/&lt;/tt&gt; folder also contains transitive dependencies, just of the more restricted scope.&lt;/p&gt;</comment>
                            <comment id="17356571" author="polo-language" created="Thu, 3 Jun 2021 16:41:03 +0000"  >&lt;p&gt;If the &apos;provided&apos; scope is intentionally part of the test dependencies (and not just the &apos;test&apos; scope), then does it make sense to remove the exclusion of &apos;provided&apos; from &lt;a href=&quot;https://github.com/apache/cassandra/blob/3282f5ecf187ecbb56b8d73ab9a9110c010898b0/.build/build-resolver.xml#L178&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;test jars resolution&lt;/a&gt;? Unless there&apos;s some other detail with the transitive dependencies, looks like this is what provided is for: &quot;A dependency with this scope is added to the classpath used for compilation and test, but not the runtime classpath.&quot; (&lt;a href=&quot;http://maven.apache.org/guides/introduction/introduction-to-dependency-mechanism.html#Dependency_Scope&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://maven.apache.org/guides/introduction/introduction-to-dependency-mechanism.html#Dependency_Scope&lt;/a&gt;).&lt;/p&gt;

&lt;p&gt;Then as a bonus, there&apos;s no need to duplicate dependencies across provided and test. For example:&lt;/p&gt;

&lt;p&gt;./build.xml:733: &amp;lt;dependency groupId=&quot;org.jboss.byteman&quot; artifactId=&quot;byteman-install&quot; scope=&quot;test&quot;/&amp;gt;&lt;br/&gt;
 ./build.xml:734: &amp;lt;dependency groupId=&quot;org.jboss.byteman&quot; artifactId=&quot;byteman&quot; scope=&quot;test&quot;/&amp;gt;&lt;br/&gt;
 ./build.xml:735: &amp;lt;dependency groupId=&quot;org.jboss.byteman&quot; artifactId=&quot;byteman-submit&quot; scope=&quot;test&quot;/&amp;gt;&lt;br/&gt;
 ./build.xml:736: &amp;lt;dependency groupId=&quot;org.jboss.byteman&quot; artifactId=&quot;byteman-bmunit&quot; scope=&quot;test&quot;/&amp;gt;&lt;br/&gt;
 ./build.xml:830: &amp;lt;dependency groupId=&quot;org.jboss.byteman&quot; artifactId=&quot;byteman-install&quot; scope=&quot;provided&quot;/&amp;gt;&lt;br/&gt;
 ./build.xml:831: &amp;lt;dependency groupId=&quot;org.jboss.byteman&quot; artifactId=&quot;byteman&quot; scope=&quot;provided&quot;/&amp;gt;&lt;br/&gt;
 ./build.xml:832: &amp;lt;dependency groupId=&quot;org.jboss.byteman&quot; artifactId=&quot;byteman-submit&quot; scope=&quot;provided&quot;/&amp;gt;&lt;br/&gt;
 ./build.xml:833: &amp;lt;dependency groupId=&quot;org.jboss.byteman&quot; artifactId=&quot;byteman-bmunit&quot; scope=&quot;provided&quot;/&amp;gt;&lt;/p&gt;

&lt;p&gt;Though in terms of classpath, we&apos;re effectively back where we started since instead of joining the compile and provided scopes from build/lib/ with the test scope in build/test/lib/ we&apos;d be joining the compile scope in lib/ with the test and provided scopes in build/test/lib/.&lt;/p&gt;

&lt;p&gt;So let me know if you me to remove the modification to build.xml from the patch. At a minimum, I think the two changes to src/ are required for runtime correctness.&lt;/p&gt;</comment>
                            <comment id="17356586" author="michaelsembwever" created="Thu, 3 Jun 2021 17:02:29 +0000"  >&lt;blockquote&gt;&lt;p&gt;Though in terms of classpath, we&apos;re effectively back where we started since instead of joining the compile and provided scopes from build/lib/ with the test scope in build/test/lib/ we&apos;d be joining the compile scope in lib/ with the test and provided scopes in build/test/lib/.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Yeah, we have three separate concerns:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;compiling, requires compile and provided scopes,&lt;/li&gt;
	&lt;li&gt;packaging, requires compile scope,&lt;/li&gt;
	&lt;li&gt;testing, requires compile and test scopes, and sometimes provided/optional scope.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;I&apos;m open to suggestions on how to tackle this, but not sure the current patch to build.xml really puts us in a significantly better situation. The rest of the patch LGTM!&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;there&apos;s no need to duplicate dependencies across provided and test.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Shouldn&apos;t we be able to remove the test scoped duplicated lines then?&lt;/p&gt;</comment>
                            <comment id="17356637" author="polo-language" created="Thu, 3 Jun 2021 18:19:44 +0000"  >&lt;p&gt;I would think so. I can check and create a second patch for those.&lt;/p&gt;

&lt;p&gt;A side comment:&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;Maybe there are jar files here that should be removed, i.e. should not even be part the provided scope?&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Byteman in particular seems to be in &apos;provided&apos; because of the single class src/java/org/apache/cassandra/utils/TestRateLimiter.java, which appears to be only used for testing. Without knowing the details of how byteman works, since this class doesn&apos;t seem to make any reference to other Cassandra classes, the package name would be the only relevant thing here (if even that) and it could be moved to test/. The byteman deps could then all be &apos;test&apos; scoped only. Or is this class in src/ simply because it could be used by test/unit/, test/distributed/, etc., whose trees shouldn&apos;t depend on each other? (That would seem a weak reason to include a class with ordinarily unresolvable imports in the end product, but so long as no one uses it no harm done, and I&apos;m not up to speed on the organization of tests categories anyhow.)&lt;/p&gt;</comment>
                            <comment id="17356666" author="michaelsembwever" created="Thu, 3 Jun 2021 19:14:54 +0000"  >&lt;p&gt;A second patch would be good. And I agree with your analysis of TestRateLimiter.java, something seems off there, though maybe it&apos;s how byteman (mutation_limiter.btm) needs its classpaths setup&#8230;?&lt;/p&gt;</comment>
                            <comment id="17359125" author="polo-language" created="Tue, 8 Jun 2021 08:05:23 +0000"  >&lt;blockquote&gt;&lt;p&gt;They are in places, see all those marked as &quot;provided&quot; or &quot;optional&quot; &lt;a href=&quot;https://github.com/apache/cassandra/blob/cassandra-4.0-rc1/build.xml#L491-L657&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;here&lt;/a&gt; and &lt;a href=&quot;https://github.com/apache/cassandra/blob/cassandra-4.0-rc1/build.xml#L749-L833&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;here&lt;/a&gt;.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Is it intentional that the scope for some entries is repeated across the two pom definitions, while missing for others? Below is for &apos;provided&apos; scope, similar situation for &apos;test&apos; scope. Those shown in blue are declared with scope in only one place, those in green are given a scope in both places:&lt;/p&gt;

&lt;p&gt;parent-pom:&lt;br/&gt;
&lt;font color=&quot;#4c9aff&quot;&gt;&amp;lt;dependency groupId=&quot;com.ning&quot; artifactId=&quot;compress-lzf&quot; version=&quot;0.8.4&quot; scope=&quot;provided&quot;/&amp;gt;&lt;/font&gt;&lt;br/&gt;
&lt;font color=&quot;#57d9a3&quot;&gt;&amp;lt;dependency groupId=&quot;org.apache.hadoop&quot; artifactId=&quot;hadoop-core&quot; version=&quot;1.0.3&quot; scope=&quot;provided&quot;&amp;gt;&lt;/font&gt;&lt;br/&gt;
&lt;font color=&quot;#57d9a3&quot;&gt;&amp;lt;dependency groupId=&quot;org.apache.hadoop&quot; artifactId=&quot;hadoop-minicluster&quot; version=&quot;1.0.3&quot; scope=&quot;provided&quot;&amp;gt;&lt;/font&gt;&lt;br/&gt;
&lt;font color=&quot;#4c9aff&quot;&gt;&amp;lt;dependency groupId=&quot;io.netty&quot; artifactId=&quot;netty-bom&quot; version=&quot;4.1.58.Final&quot; type=&quot;pom&quot; scope=&quot;provided&quot;/&amp;gt;&lt;/font&gt;&lt;br/&gt;
&lt;font color=&quot;#57d9a3&quot;&gt;&amp;lt;dependency groupId=&quot;com.google.code.findbugs&quot; artifactId=&quot;jsr305&quot; version=&quot;2.0.2&quot; scope=&quot;provided&quot;/&amp;gt;&lt;/font&gt;&lt;br/&gt;
&lt;font color=&quot;#57d9a3&quot;&gt;&amp;lt;dependency groupId=&quot;net.ju-n.compile-command-annotations&quot; artifactId=&quot;compile-command-annotations&quot; version=&quot;1.2.0&quot; scope=&quot;provided&quot;/&amp;gt;&lt;/font&gt;&lt;/p&gt;


&lt;p&gt;all-pom:&lt;br/&gt;
&lt;font color=&quot;#4c9aff&quot;&gt;&amp;lt;dependency groupId=&quot;org.antlr&quot; artifactId=&quot;antlr&quot; scope=&quot;provided&quot;/&amp;gt;&lt;/font&gt;&lt;br/&gt;
&lt;font color=&quot;#57d9a3&quot;&gt;&amp;lt;dependency groupId=&quot;org.apache.hadoop&quot; artifactId=&quot;hadoop-core&quot; optional=&quot;true&quot; scope=&quot;provided&quot;/&amp;gt;&lt;/font&gt;&lt;br/&gt;
&lt;font color=&quot;#57d9a3&quot;&gt;&amp;lt;dependency groupId=&quot;org.apache.hadoop&quot; artifactId=&quot;hadoop-minicluster&quot; optional=&quot;true&quot; scope=&quot;provided&quot;/&amp;gt;&lt;/font&gt;&lt;br/&gt;
&lt;font color=&quot;#57d9a3&quot;&gt;&amp;lt;dependency groupId=&quot;com.google.code.findbugs&quot; artifactId=&quot;jsr305&quot; scope=&quot;provided&quot;/&amp;gt;&lt;/font&gt;&lt;br/&gt;
&lt;font color=&quot;#57d9a3&quot;&gt;&amp;lt;dependency groupId=&quot;net.ju-n.compile-command-annotations&quot; artifactId=&quot;compile-command-annotations&quot; scope=&quot;provided&quot;/&amp;gt;&lt;/font&gt;&lt;br/&gt;
&lt;font color=&quot;#4c9aff&quot;&gt;&amp;lt;dependency groupId=&quot;org.assertj&quot; artifactId=&quot;assertj-core&quot; scope=&quot;provided&quot;/&amp;gt;&lt;/font&gt;&lt;br/&gt;
&lt;font color=&quot;#4c9aff&quot;&gt;&amp;lt;dependency groupId=&quot;org.jboss.byteman&quot; artifactId=&quot;byteman-install&quot; scope=&quot;provided&quot;/&amp;gt;&lt;/font&gt;&lt;br/&gt;
&lt;font color=&quot;#4c9aff&quot;&gt;&amp;lt;dependency groupId=&quot;org.jboss.byteman&quot; artifactId=&quot;byteman&quot; scope=&quot;provided&quot;/&amp;gt;&lt;/font&gt;&lt;br/&gt;
&lt;font color=&quot;#4c9aff&quot;&gt;&amp;lt;dependency groupId=&quot;org.jboss.byteman&quot; artifactId=&quot;byteman-submit&quot; scope=&quot;provided&quot;/&amp;gt;&lt;/font&gt;&lt;br/&gt;
&lt;font color=&quot;#4c9aff&quot;&gt;&amp;lt;dependency groupId=&quot;org.jboss.byteman&quot; artifactId=&quot;byteman-bmunit&quot; scope=&quot;provided&quot;/&amp;gt;&lt;/font&gt;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="17359317" author="michaelsembwever" created="Tue, 8 Jun 2021 12:29:44 +0000"  >&lt;blockquote&gt;&lt;p&gt;Is it intentional that the scope for some entries is repeated across the two pom definitions, while missing for others?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Not in general. Definitely jsr305 and compile-command-annotations looks like they can have the duplicated scope removed.  I think the others are just explicit because they are overridden, but yes: duplicated overrides are a bit silly. byteman-* for example could be defined as provided, and then overridden to test in build-deps-pom. I can&apos;t remember how optional interferes with the scope (ref hadoop* deps).&lt;/p&gt;</comment>
                            <comment id="17360242" author="polo-language" created="Wed, 9 Jun 2021 17:31:12 +0000"  >&lt;p&gt;The patch &apos;cleanup-imports.patch&apos; is simply the old patch with the change to build.xml removed.&lt;br/&gt;
The patch &apos;dedup-deps.patch&apos; contains the following changes, exclusively modifying build.xml, from my understanding of our discussion above:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;Removed duplicates of test scope that are already in provided scope.&lt;/li&gt;
	&lt;li&gt;Removed duplicated scope attributes. All scope attributes are now uniformly provided in parent-pom.&lt;/li&gt;
	&lt;li&gt;Added &amp;lt;dependency groupId=&quot;org.apache.ant&quot; artifactId=&quot;ant-junit&quot; version=&quot;1.9.7&quot; scope=&quot;test&quot;/&amp;gt; to parent-pom. Was previously only declared in build-deps-pom.&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="17361837" author="michaelsembwever" created="Fri, 11 Jun 2021 15:08:42 +0000"  >&lt;p&gt;Testing both patches on this &lt;a href=&quot;https://github.com/apache/cassandra/compare/trunk...thelastpickle:mck/4.0/16704&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;branch&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;Between builds on cassandra-4.0.0 and these patches, the &lt;tt&gt;lib/&lt;/tt&gt; and&#160;&lt;tt&gt;build/lib/jars/&lt;/tt&gt; result in identical contents.&lt;/p&gt;

&lt;p&gt;But the &lt;tt&gt;build/test/lib/jars/&lt;/tt&gt; directory contains differences:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&#10095; diff &amp;lt;(ls build/test/lib/jars/) &amp;lt;(ls ../cassandra/build/test/lib/jars/)
11d10
&amp;lt; assertj-core-3.15.0.jar
15,18d13
&amp;lt; byteman-4.0.6.jar
&amp;lt; byteman-bmunit-4.0.6.jar
&amp;lt; byteman-install-4.0.6.jar
&amp;lt; byteman-submit-4.0.6.jar
22d16
&amp;lt; compile-command-annotations-1.2.0.jar &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;;that is those jar files no longer appear under&#160;&lt;tt&gt;build/test/lib/jars/&lt;/tt&gt; which is the intentional of the patch (as they are already &quot;provided&quot; and so under &lt;tt&gt;build/lib/jars/&lt;/tt&gt;).&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;CI:&#160; &lt;a href=&quot;https://ci-cassandra.apache.org/blue/organizations/jenkins/Cassandra-devbranch/detail/Cassandra-devbranch/862/pipeline&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;&lt;span class=&quot;image-wrap&quot; style=&quot;&quot;&gt;&lt;img src=&quot;https://ci-cassandra.apache.org/view/patches/job/Cassandra-devbranch/862/badge/icon&quot; style=&quot;border: 0px solid black&quot; /&gt;&lt;/span&gt;&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17362251" author="michaelsembwever" created="Sat, 12 Jun 2021 07:31:07 +0000"  >&lt;p&gt;+1&lt;/p&gt;</comment>
                            <comment id="17362266" author="michaelsembwever" created="Sat, 12 Jun 2021 10:05:39 +0000"  >&lt;p&gt;Committed as &lt;a href=&quot;https://github.com/apache/cassandra/commit/d93e43ed9b3abad438c4ec9db6ae94d768f52896&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;d93e43ed9b3abad438c4ec9db6ae94d768f52896&lt;/a&gt;.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="13026625" name="cleanup-imports.patch" size="7552" author="polo-language" created="Wed, 9 Jun 2021 17:26:21 +0000"/>
                            <attachment id="13026624" name="dedup-deps.patch" size="10643" author="polo-language" created="Wed, 9 Jun 2021 17:26:21 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[polo-language]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12313825" key="com.atlassian.jira.plugin.system.customfieldtypes:cascadingselect">
                        <customfieldname>Bug Category</customfieldname>
                        <customfieldvalues>
                                                    <customfieldvalue key="12982" cascade-level=""><![CDATA[Correctness]]></customfieldvalue>
            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12313821" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Complexity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12964"><![CDATA[Low Hanging Fruit]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313822" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Discovered By</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12969"><![CDATA[User Report]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12313922" key="jira.plugin.projectspecificselectfield.jpssf:multicftype">
                        <customfieldname>Impacts</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="13100"><![CDATA[None]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            4 years, 22 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12313921" key="jira.plugin.projectspecificselectfield.jpssf:multicftype">
                        <customfieldname>Platform</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="13076"><![CDATA[All]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0rh14:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[mck]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12961"><![CDATA[Low]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12311420" key="com.atlassian.jira.plugin.system.customfieldtypes:version">
                        <customfieldname>Since Version</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="12349532">4.0-rc1</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313924" key="com.atlassian.jira.plugin.system.customfieldtypes:textfield">
                        <customfieldname>Source Control Link</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>&lt;p&gt;&lt;a href=&quot;https://github.com/apache/cassandra/commit/d93e43ed9b3abad438c4ec9db6ae94d768f52896&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/cassandra/commit/d93e43ed9b3abad438c4ec9db6ae94d768f52896&lt;/a&gt;&lt;/p&gt;</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313823" key="com.atlassian.jira.plugin.system.customfieldtypes:textarea">
                        <customfieldname>Test and Documentation Plan</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>&lt;p&gt;run ci&lt;/p&gt;</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>