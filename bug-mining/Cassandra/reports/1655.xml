<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 22:33:34 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-4328] CQL client timeout when inserting data after creating index</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-4328</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;After creating index on table inserts fails.&lt;br/&gt;
steps (from cqlsh -3)&lt;br/&gt;
create table myapp (pidh text, cn text, tn text, s text, m text, ts bigint, PRIMARY KEY (pidh, ts));&lt;br/&gt;
INSERT INTO myapp(pidh, cn, tn, s, m, ts) VALUES (&apos;4274@localhost&apos;,&apos;Test.tests&apos;,&apos;main&apos;,&apos;text&apos;,&apos;bzzzzz&apos;,2231897614162493);&lt;br/&gt;
create index idx_cn on myapp(cn);&lt;/p&gt;

&lt;p&gt;Next insert from cql client time outs without showing error.&lt;br/&gt;
Each insert in systemlog gives ERROR &lt;span class=&quot;error&quot;&gt;&amp;#91;MutationStage:xx&amp;#93;&lt;/span&gt; ....&lt;br/&gt;
from log file:&lt;/p&gt;

&lt;p&gt; INFO &lt;span class=&quot;error&quot;&gt;&amp;#91;MigrationStage:1&amp;#93;&lt;/span&gt; 2012-06-11 12:28:35,715 ColumnFamilyStore.java (line 633) Enqueuing flush of Memtable-schema_columnfamilies@1502301540(1259/1573 serialized/live bytes, 20 ops)&lt;br/&gt;
 INFO &lt;span class=&quot;error&quot;&gt;&amp;#91;FlushWriter:4&amp;#93;&lt;/span&gt; 2012-06-11 12:28:35,716 Memtable.java (line 266) Writing Memtable-schema_columnfamilies@1502301540(1259/1573 serialized/live bytes, 20 ops)&lt;br/&gt;
 INFO &lt;span class=&quot;error&quot;&gt;&amp;#91;FlushWriter:4&amp;#93;&lt;/span&gt; 2012-06-11 12:28:35,868 Memtable.java (line 307) Completed flushing /var/lib/cassandra/data/system/schema_columnfamilies/system-schema_columnfamilies-hd-143-Data.db (1312 bytes) for commitlog position ReplayPosition(segmentId=2232837134267994, position=8651)&lt;br/&gt;
 INFO &lt;span class=&quot;error&quot;&gt;&amp;#91;MigrationStage:1&amp;#93;&lt;/span&gt; 2012-06-11 12:28:35,869 ColumnFamilyStore.java (line 633) Enqueuing flush of Memtable-schema_columns@1756291746(280/350 serialized/live bytes, 5 ops)&lt;br/&gt;
 INFO &lt;span class=&quot;error&quot;&gt;&amp;#91;CompactionExecutor:26&amp;#93;&lt;/span&gt; 2012-06-11 12:28:35,869 CompactionTask.java (line 109) Compacting &lt;span class=&quot;error&quot;&gt;&amp;#91;SSTableReader(path=&amp;#39;/var/lib/cassandra/data/system/schema_columnfamilies/system-schema_columnfamilies-hd-141-Data.db&amp;#39;), SSTableReader(path=&amp;#39;/var/lib/cassandra/data/system/schema_columnfamilies/system-schema_columnfamilies-hd-142-Data.db&amp;#39;), SSTableReader(path=&amp;#39;/var/lib/cassandra/data/system/schema_columnfamilies/system-schema_columnfamilies-hd-140-Data.db&amp;#39;), SSTableReader(path=&amp;#39;/var/lib/cassandra/data/system/schema_columnfamilies/system-schema_columnfamilies-hd-143-Data.db&amp;#39;)&amp;#93;&lt;/span&gt;&lt;br/&gt;
 INFO &lt;span class=&quot;error&quot;&gt;&amp;#91;FlushWriter:4&amp;#93;&lt;/span&gt; 2012-06-11 12:28:35,869 Memtable.java (line 266) Writing Memtable-schema_columns@1756291746(280/350 serialized/live bytes, 5 ops)&lt;br/&gt;
 INFO &lt;span class=&quot;error&quot;&gt;&amp;#91;FlushWriter:4&amp;#93;&lt;/span&gt; 2012-06-11 12:28:36,104 Memtable.java (line 307) Completed flushing /var/lib/cassandra/data/system/schema_columns/system-schema_columns-hd-65-Data.db (325 bytes) for commitlog position ReplayPosition(segmentId=2232837134267994, position=8651)&lt;br/&gt;
 INFO &lt;span class=&quot;error&quot;&gt;&amp;#91;CompactionExecutor:26&amp;#93;&lt;/span&gt; 2012-06-11 12:28:36,130 CompactionTask.java (line 221) Compacted to &lt;span class=&quot;error&quot;&gt;&amp;#91;/var/lib/cassandra/data/system/schema_columnfamilies/system-schema_columnfamilies-hd-144-Data.db,&amp;#93;&lt;/span&gt;.  42,461 to 38,525 (~90% of original) bytes for 3 keys at 0.140767MB/s.  Time: 261ms.&lt;br/&gt;
 INFO &lt;span class=&quot;error&quot;&gt;&amp;#91;MigrationStage:1&amp;#93;&lt;/span&gt; 2012-06-11 12:28:36,140 SecondaryIndexManager.java (line 208) Creating new index : ColumnDefinition&lt;/p&gt;
{name=636e, validator=org.apache.cassandra.db.marshal.UTF8Type, index_type=KEYS, index_name=&apos;idx_cn&apos;, component_index=1}
&lt;p&gt; INFO &lt;span class=&quot;error&quot;&gt;&amp;#91;Creating index: myapp.idx_cn&amp;#93;&lt;/span&gt; 2012-06-11 12:28:36,141 ColumnFamilyStore.java (line 633) Enqueuing flush of Memtable-myapp@207814912(171/213 serialized/live bytes, 4 ops)&lt;br/&gt;
 INFO &lt;span class=&quot;error&quot;&gt;&amp;#91;FlushWriter:4&amp;#93;&lt;/span&gt; 2012-06-11 12:28:36,141 Memtable.java (line 266) Writing Memtable-myapp@207814912(171/213 serialized/live bytes, 4 ops)&lt;br/&gt;
 INFO &lt;span class=&quot;error&quot;&gt;&amp;#91;FlushWriter:4&amp;#93;&lt;/span&gt; 2012-06-11 12:28:36,255 Memtable.java (line 307) Completed flushing /var/lib/cassandra/data/Logging/myapp/Logging-myapp-hd-2-Data.db (170 bytes) for commitlog position ReplayPosition(segmentId=2232837134267994, position=8651)&lt;br/&gt;
 INFO &lt;span class=&quot;error&quot;&gt;&amp;#91;Creating index: myapp.idx_cn&amp;#93;&lt;/span&gt; 2012-06-11 12:28:36,256 SecondaryIndex.java (line 159) Submitting index build of myapp.idx_cn for data in SSTableReader(path=&apos;/var/lib/cassandra/data/Logging/myapp/Logging-myapp-hd-1-Data.db&apos;), SSTableReader(path=&apos;/var/lib/cassandra/data/Logging/myapp/Logging-myapp-hd-2-Data.db&apos;)&lt;br/&gt;
 INFO &lt;span class=&quot;error&quot;&gt;&amp;#91;Creating index: myapp.idx_cn&amp;#93;&lt;/span&gt; 2012-06-11 12:28:36,258 ColumnFamilyStore.java (line 633) Enqueuing flush of Memtable-IndexInfo@409882274(39/48 serialized/live bytes, 1 ops)&lt;br/&gt;
 INFO &lt;span class=&quot;error&quot;&gt;&amp;#91;FlushWriter:4&amp;#93;&lt;/span&gt; 2012-06-11 12:28:36,258 Memtable.java (line 266) Writing Memtable-IndexInfo@409882274(39/48 serialized/live bytes, 1 ops)&lt;br/&gt;
 INFO &lt;span class=&quot;error&quot;&gt;&amp;#91;FlushWriter:4&amp;#93;&lt;/span&gt; 2012-06-11 12:28:36,390 Memtable.java (line 307) Completed flushing /var/lib/cassandra/data/system/IndexInfo/system-IndexInfo-hd-14-Data.db (84 bytes) for commitlog position ReplayPosition(segmentId=2232837134267994, position=8744)&lt;br/&gt;
 INFO &lt;span class=&quot;error&quot;&gt;&amp;#91;Creating index: myapp.idx_cn&amp;#93;&lt;/span&gt; 2012-06-11 12:28:36,390 SecondaryIndex.java (line 200) Index build of myapp.idx_cn complete&lt;br/&gt;
ERROR &lt;span class=&quot;error&quot;&gt;&amp;#91;MutationStage:37&amp;#93;&lt;/span&gt; 2012-06-11 12:28:39,657 AbstractCassandraDaemon.java (line 134) Exception in thread Thread&lt;span class=&quot;error&quot;&gt;&amp;#91;MutationStage:37,5,main&amp;#93;&lt;/span&gt;&lt;br/&gt;
java.lang.RuntimeException: java.lang.IllegalArgumentException&lt;br/&gt;
	at org.apache.cassandra.service.StorageProxy$DroppableRunnable.run(StorageProxy.java:1254)&lt;br/&gt;
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1110)&lt;br/&gt;
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:603)&lt;br/&gt;
	at java.lang.Thread.run(Thread.java:722)&lt;br/&gt;
Caused by: java.lang.IllegalArgumentException&lt;br/&gt;
	at java.nio.Buffer.limit(Buffer.java:267)&lt;br/&gt;
	at org.apache.cassandra.db.marshal.AbstractCompositeType.getBytes(AbstractCompositeType.java:51)&lt;br/&gt;
	at org.apache.cassandra.db.marshal.AbstractCompositeType.getWithShortLength(AbstractCompositeType.java:60)&lt;br/&gt;
	at org.apache.cassandra.db.marshal.AbstractCompositeType.compare(AbstractCompositeType.java:76)&lt;br/&gt;
	at org.apache.cassandra.db.marshal.AbstractCompositeType.compare(AbstractCompositeType.java:31)&lt;br/&gt;
	at java.util.TreeMap.getEntryUsingComparator(TreeMap.java:369)&lt;br/&gt;
	at java.util.TreeMap.getEntry(TreeMap.java:340)&lt;br/&gt;
	at java.util.TreeMap.containsKey(TreeMap.java:227)&lt;br/&gt;
	at java.util.TreeMap$KeySet.contains(TreeMap.java:1045)&lt;br/&gt;
	at org.apache.cassandra.db.Table.apply(Table.java:415)&lt;br/&gt;
	at org.apache.cassandra.db.Table.apply(Table.java:380)&lt;br/&gt;
	at org.apache.cassandra.db.RowMutation.apply(RowMutation.java:294)&lt;br/&gt;
	at org.apache.cassandra.service.StorageProxy$6.runMayThrow(StorageProxy.java:453)&lt;br/&gt;
	at org.apache.cassandra.service.StorageProxy$DroppableRunnable.run(StorageProxy.java:1250)&lt;br/&gt;
	... 3 more&lt;/p&gt;


&lt;p&gt;ERROR &lt;span class=&quot;error&quot;&gt;&amp;#91;MutationStage:39&amp;#93;&lt;/span&gt; 2012-06-11 12:29:39,876 AbstractCassandraDaemon.java (line 134) Exception in thread Thread&lt;span class=&quot;error&quot;&gt;&amp;#91;MutationStage:39,5,main&amp;#93;&lt;/span&gt;&lt;br/&gt;
java.lang.RuntimeException: java.lang.IllegalArgumentException&lt;br/&gt;
	at org.apache.cassandra.service.StorageProxy$DroppableRunnable.run(StorageProxy.java:1254)&lt;br/&gt;
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1110)&lt;br/&gt;
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:603)&lt;br/&gt;
	at java.lang.Thread.run(Thread.java:722)&lt;br/&gt;
Caused by: java.lang.IllegalArgumentException&lt;br/&gt;
	at java.nio.Buffer.limit(Buffer.java:267)&lt;br/&gt;
	at org.apache.cassandra.db.marshal.AbstractCompositeType.getBytes(AbstractCompositeType.java:51)&lt;br/&gt;
	at org.apache.cassandra.db.marshal.AbstractCompositeType.getWithShortLength(AbstractCompositeType.java:60)&lt;br/&gt;
	at org.apache.cassandra.db.marshal.AbstractCompositeType.compare(AbstractCompositeType.java:76)&lt;br/&gt;
	at org.apache.cassandra.db.marshal.AbstractCompositeType.compare(AbstractCompositeType.java:31)&lt;br/&gt;
	at java.util.TreeMap.getEntryUsingComparator(TreeMap.java:369)&lt;br/&gt;
	at java.util.TreeMap.getEntry(TreeMap.java:340)&lt;br/&gt;
	at java.util.TreeMap.containsKey(TreeMap.java:227)&lt;br/&gt;
	at java.util.TreeMap$KeySet.contains(TreeMap.java:1045)&lt;br/&gt;
	at org.apache.cassandra.db.Table.apply(Table.java:415)&lt;br/&gt;
	at org.apache.cassandra.db.Table.apply(Table.java:380)&lt;br/&gt;
	at org.apache.cassandra.db.RowMutation.apply(RowMutation.java:294)&lt;br/&gt;
	at org.apache.cassandra.service.StorageProxy$6.runMayThrow(StorageProxy.java:453)&lt;br/&gt;
	at org.apache.cassandra.service.StorageProxy$DroppableRunnable.run(StorageProxy.java:1250)&lt;br/&gt;
	... 3 more&lt;/p&gt;</description>
                <environment>&lt;p&gt;Linux emka 3.3.4-gentoo #4 SMP Mon May 14 17:03:02 BST 2012 x86_64 Intel(R) Core(TM) i7-3820 CPU @ 3.60GHz GenuineIntel GNU/Linux&lt;/p&gt;</environment>
        <key id="12560155">CASSANDRA-4328</key>
            <summary>CQL client timeout when inserting data after creating index</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10002" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Normal</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="slebresne">Sylvain Lebresne</assignee>
                                    <reporter username="evilezh">Haralds Ulmanis</reporter>
                        <labels>
                    </labels>
                <created>Mon, 11 Jun 2012 11:44:21 +0000</created>
                <updated>Tue, 16 Apr 2019 09:32:32 +0000</updated>
                            <resolved>Tue, 12 Jun 2012 13:07:00 +0000</resolved>
                                        <fixVersion>1.1.2</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="13292783" author="slebresne" created="Mon, 11 Jun 2012 12:41:56 +0000"  >&lt;p&gt;For information secondary indexes are not supported on composite primary keys. We have a ticket for that (&lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-3680&quot; title=&quot;Add Support for Composite Secondary Indexes&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-3680&quot;&gt;&lt;del&gt;CASSANDRA-3680&lt;/del&gt;&lt;/a&gt;) but this won&apos;t be before Cassandra 1.2.&lt;/p&gt;

&lt;p&gt;That being said, there is a clear lack of validation here and we will fix that (in other words, the &apos;create index&apos; should return an meaningful error message).&lt;/p&gt;</comment>
                            <comment id="13293558" author="slebresne" created="Tue, 12 Jun 2012 12:05:21 +0000"  >&lt;p&gt;Attaching patch to reject index creation on table with composite primary keys.&lt;/p&gt;</comment>
                            <comment id="13293566" author="jbellis" created="Tue, 12 Jun 2012 12:24:30 +0000"  >&lt;p&gt;+1&lt;/p&gt;</comment>
                            <comment id="13293595" author="slebresne" created="Tue, 12 Jun 2012 13:07:00 +0000"  >&lt;p&gt;Committed, thanks&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12531814" name="4328.txt" size="1523" author="slebresne" created="Tue, 12 Jun 2012 12:05:21 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[slebresne]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>256064</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            13 years, 24 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0gumn:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>96392</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>jbellis</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[jbellis]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12962"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>