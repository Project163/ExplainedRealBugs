<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 22:33:55 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-4400] Correctly catch exception when Snappy cannot be loaded</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-4400</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;From the mailing list, on C* 1.1.1:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;INFO 14:22:07,600 Global memtable threshold is enabled at 35MB
java.lang.reflect.InvocationTargetException
        at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
        at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:57)
        at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
        at java.lang.reflect.Method.invoke(Method.java:616)
        at org.xerial.snappy.SnappyLoader.loadNativeLibrary(SnappyLoader.java:317)
        at org.xerial.snappy.SnappyLoader.load(SnappyLoader.java:219)
        at org.xerial.snappy.Snappy.&amp;lt;clinit&amp;gt;(Snappy.java:44)
        at org.apache.cassandra.io.compress.SnappyCompressor.create(SnappyCompressor.java:45)
        at org.apache.cassandra.io.compress.SnappyCompressor.isAvailable(SnappyCompressor.java:55)
        at org.apache.cassandra.io.compress.SnappyCompressor.&amp;lt;clinit&amp;gt;(SnappyCompressor.java:37)
        at org.apache.cassandra.config.CFMetaData.&amp;lt;clinit&amp;gt;(CFMetaData.java:76)
        at org.apache.cassandra.config.KSMetaData.systemKeyspace(KSMetaData.java:79)
        at org.apache.cassandra.config.DatabaseDescriptor.loadYaml(DatabaseDescriptor.java:439)
        at org.apache.cassandra.config.DatabaseDescriptor.&amp;lt;clinit&amp;gt;(DatabaseDescriptor.java:118)
        at org.apache.cassandra.service.AbstractCassandraDaemon.setup(AbstractCassandraDaemon.java:126)
        at org.apache.cassandra.service.AbstractCassandraDaemon.activate(AbstractCassandraDaemon.java:353)
        at org.apache.cassandra.thrift.CassandraDaemon.main(CassandraDaemon.java:106)
Caused by: java.lang.UnsatisfiedLinkError: no snappyjava in java.library.path
        at java.lang.ClassLoader.loadLibrary(ClassLoader.java:1681)
        at java.lang.Runtime.loadLibrary0(Runtime.java:840)
        at java.lang.System.loadLibrary(System.java:1047)
        at org.xerial.snappy.SnappyNativeLoader.loadLibrary(SnappyNativeLoader.java:52)
        ... 17 more
ERROR 14:22:09,934 Exception encountered during startup
org.xerial.snappy.SnappyError: [FAILED_TO_LOAD_NATIVE_LIBRARY] null
        at org.xerial.snappy.SnappyLoader.load(SnappyLoader.java:229)
        at org.xerial.snappy.Snappy.&amp;lt;clinit&amp;gt;(Snappy.java:44)
        at org.apache.cassandra.io.compress.SnappyCompressor.create(SnappyCompressor.java:45)
        at org.apache.cassandra.io.compress.SnappyCompressor.isAvailable(SnappyCompressor.java:55)
        at org.apache.cassandra.io.compress.SnappyCompressor.&amp;lt;clinit&amp;gt;(SnappyCompressor.java:37)
        at org.apache.cassandra.config.CFMetaData.&amp;lt;clinit&amp;gt;(CFMetaData.java:76)
        at org.apache.cassandra.config.KSMetaData.systemKeyspace(KSMetaData.java:79)
        at org.apache.cassandra.config.DatabaseDescriptor.loadYaml(DatabaseDescriptor.java:439)
        at org.apache.cassandra.config.DatabaseDescriptor.&amp;lt;clinit&amp;gt;(DatabaseDescriptor.java:118)
        at org.apache.cassandra.service.AbstractCassandraDaemon.setup(AbstractCassandraDaemon.java:126)
        at org.apache.cassandra.service.AbstractCassandraDaemon.activate(AbstractCassandraDaemon.java:353)
        at org.apache.cassandra.thrift.CassandraDaemon.main(CassandraDaemon.java:106)
org.xerial.snappy.SnappyError: [FAILED_TO_LOAD_NATIVE_LIBRARY] null
        at org.xerial.snappy.SnappyLoader.load(SnappyLoader.java:229)
        at org.xerial.snappy.Snappy.&amp;lt;clinit&amp;gt;(Snappy.java:44)
        at org.apache.cassandra.io.compress.SnappyCompressor.create(SnappyCompressor.java:45)
        at org.apache.cassandra.io.compress.SnappyCompressor.isAvailable(SnappyCompressor.java:55)
        at org.apache.cassandra.io.compress.SnappyCompressor.&amp;lt;clinit&amp;gt;(SnappyCompressor.java:37)
        at org.apache.cassandra.config.CFMetaData.&amp;lt;clinit&amp;gt;(CFMetaData.java:76)
        at org.apache.cassandra.config.KSMetaData.systemKeyspace(KSMetaData.java:79)
        at org.apache.cassandra.config.DatabaseDescriptor.loadYaml(DatabaseDescriptor.java:439)
        at org.apache.cassandra.config.DatabaseDescriptor.&amp;lt;clinit&amp;gt;(DatabaseDescriptor.java:118)
        at org.apache.cassandra.service.AbstractCassandraDaemon.setup(AbstractCassandraDaemon.java:126)
        at org.apache.cassandra.service.AbstractCassandraDaemon.activate(AbstractCassandraDaemon.java:353)
        at org.apache.cassandra.thrift.CassandraDaemon.main(CassandraDaemon.java:106)
Exception encountered during startup: [FAILED_TO_LOAD_NATIVE_LIBRARY] null
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="12596570">CASSANDRA-4400</key>
            <summary>Correctly catch exception when Snappy cannot be loaded</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10003" iconUrl="https://issues.apache.org/jira/images/icons/priorities/trivial.svg">Low</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="slebresne">Sylvain Lebresne</assignee>
                                    <reporter username="slebresne">Sylvain Lebresne</reporter>
                        <labels>
                    </labels>
                <created>Mon, 2 Jul 2012 07:08:25 +0000</created>
                <updated>Tue, 16 Apr 2019 09:32:31 +0000</updated>
                            <resolved>Thu, 5 Jul 2012 16:09:34 +0000</resolved>
                                        <fixVersion>1.1.3</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="13404914" author="slebresne" created="Mon, 2 Jul 2012 07:10:50 +0000"  >&lt;p&gt;Patch attached to be a little bit more thorough in which errors we catch.&lt;/p&gt;</comment>
                            <comment id="13405092" author="acobley" created="Mon, 2 Jul 2012 15:01:09 +0000"  >&lt;p&gt;I added your fix to the source of apache-cassandra-1.1.1-src and it does allow a startup if SnappyJava is missing.  The only thing I not is the log from the startup is a bit messy with exceptions thrown, but I&apos;m guessing this acceptable ?&lt;/p&gt;

&lt;p&gt;INFO 15:42:57,873 Global memtable threshold is enabled at 35MB&lt;br/&gt;
java.lang.reflect.InvocationTargetException&lt;br/&gt;
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)&lt;br/&gt;
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)&lt;br/&gt;
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)&lt;br/&gt;
	at java.lang.reflect.Method.invoke(Method.java:597)&lt;br/&gt;
	at org.xerial.snappy.SnappyLoader.loadNativeLibrary(SnappyLoader.java:317)&lt;br/&gt;
	at org.xerial.snappy.SnappyLoader.load(SnappyLoader.java:219)&lt;br/&gt;
	at org.xerial.snappy.Snappy.&amp;lt;clinit&amp;gt;(Snappy.java:44)&lt;br/&gt;
	at org.apache.cassandra.io.compress.SnappyCompressor.create(SnappyCompressor.java:46)&lt;br/&gt;
	at org.apache.cassandra.io.compress.SnappyCompressor.isAvailable(SnappyCompressor.java:56)&lt;br/&gt;
	at org.apache.cassandra.io.compress.SnappyCompressor.&amp;lt;clinit&amp;gt;(SnappyCompressor.java:38)&lt;br/&gt;
	at org.apache.cassandra.config.CFMetaData.&amp;lt;clinit&amp;gt;(CFMetaData.java:76)&lt;br/&gt;
	at org.apache.cassandra.config.KSMetaData.systemKeyspace(KSMetaData.java:79)&lt;br/&gt;
	at org.apache.cassandra.config.DatabaseDescriptor.loadYaml(DatabaseDescriptor.java:439)&lt;br/&gt;
	at org.apache.cassandra.config.DatabaseDescriptor.&amp;lt;clinit&amp;gt;(DatabaseDescriptor.java:118)&lt;br/&gt;
	at org.apache.cassandra.service.AbstractCassandraDaemon.setup(AbstractCassandraDaemon.java:126)&lt;br/&gt;
	at org.apache.cassandra.service.AbstractCassandraDaemon.activate(AbstractCassandraDaemon.java:353)&lt;br/&gt;
	at org.apache.cassandra.thrift.CassandraDaemon.main(CassandraDaemon.java:106)&lt;br/&gt;
Caused by: java.lang.UnsatisfiedLinkError: no snappyjava in java.library.path&lt;br/&gt;
	at java.lang.ClassLoader.loadLibrary(ClassLoader.java:1738)&lt;br/&gt;
	at java.lang.Runtime.loadLibrary0(Runtime.java:823)&lt;br/&gt;
	at java.lang.System.loadLibrary(System.java:1028)&lt;br/&gt;
	at org.xerial.snappy.SnappyNativeLoader.loadLibrary(SnappyNativeLoader.java:52)&lt;br/&gt;
	... 17 more&lt;br/&gt;
 WARN 15:42:59,586 Cannot initialize native Snappy library. Compression on new tables will be disabled.&lt;br/&gt;
 INFO 15:43:00,141 Initializing key cache with capacity of 5 MBs.&lt;/p&gt;</comment>
                            <comment id="13406410" author="slebresne" created="Wed, 4 Jul 2012 10:03:22 +0000"  >&lt;p&gt;Actually, I&apos;d like to get rid of that exception at startup but I&apos;m not sure why that InvocationTargetException is not caught by the &apos;catch (Exception e)&apos; in SnappyCompressor.isAvailable(). Unless it&apos;s printed in the log by the snappy library itself.&lt;/p&gt;</comment>
                            <comment id="13406426" author="acobley" created="Wed, 4 Jul 2012 10:27:53 +0000"  >&lt;p&gt;I think it&apos;s being printed by :&lt;/p&gt;

&lt;p&gt;static {&lt;br/&gt;
        try &lt;/p&gt;
{
            impl = SnappyLoader.load();
        }
&lt;p&gt;        catch (Exception e) &lt;/p&gt;
{
            e.printStackTrace();
        }

&lt;p&gt;in Snappy.java line 47.  I can experiment and confirm &lt;/p&gt;</comment>
                            <comment id="13406475" author="slebresne" created="Wed, 4 Jul 2012 12:26:15 +0000"  >&lt;p&gt;&lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/sad.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;So I guess the current output is the best we can do and we can open a ticket on Snappy-Java to have them remove that.&lt;/p&gt;</comment>
                            <comment id="13406480" author="acobley" created="Wed, 4 Jul 2012 12:33:46 +0000"  >&lt;p&gt;let me confirm thats the problem if thats the case, yes a ticket should be opened.&lt;/p&gt;</comment>
                            <comment id="13406762" author="acobley" created="Wed, 4 Jul 2012 21:25:17 +0000"  >&lt;p&gt;Sylvian,&lt;br/&gt;
I&apos;ve done a little digging into the snappy source code, looks like they are not catching a java.lang.reflect.InvocationTargetException at line 319 of SnappyLoader:&lt;/p&gt;

&lt;p&gt; loadMethod.invoke(null, nativeLib.getAbsolutePath());&lt;/p&gt;

&lt;p&gt;I&apos;ll try and raise a ticket with them.&lt;/p&gt;

&lt;p&gt;Are you happy to commit your changes for 1.1.3?&lt;/p&gt;</comment>
                            <comment id="13407154" author="slebresne" created="Thu, 5 Jul 2012 14:18:54 +0000"  >&lt;p&gt;Yeah so there is not much more we can do in the meantime. @Andy you tested the attached patch succesfully, right? If so I&apos;ll commit that.&lt;/p&gt;</comment>
                            <comment id="13407187" author="acobley" created="Thu, 5 Jul 2012 14:51:51 +0000"  >&lt;p&gt;Yep Sylvian, I&apos;ve tested it and am happy.&lt;/p&gt;</comment>
                            <comment id="13407236" author="slebresne" created="Thu, 5 Jul 2012 16:09:34 +0000"  >&lt;p&gt;Alright, committed, thanks&lt;/p&gt;</comment>
                            <comment id="13428999" author="trajano" created="Mon, 6 Aug 2012 06:53:58 +0000"  >&lt;p&gt;Although it catches it properly, it still throws a large stack trace.  Is it possible to get rid of it?&lt;/p&gt;</comment>
                            <comment id="13429065" author="slebresne" created="Mon, 6 Aug 2012 10:36:18 +0000"  >&lt;p&gt;As explain above, the large stack trace is thrown by the Snappy library itself, so until they fix that there is nothing we can do about it, sorry.&lt;/p&gt;</comment>
                            <comment id="13496303" author="miggi" created="Tue, 13 Nov 2012 16:29:59 +0000"  >&lt;p&gt;Hey Guys,&lt;br/&gt;
Was it fixed in 1.1.6 ? &lt;br/&gt;
See the same trace: &lt;/p&gt;

&lt;p&gt;Caused by: java.lang.UnsatisfiedLinkError: no snappyjava in java.library.path&lt;br/&gt;
	at java.lang.ClassLoader.loadLibrary(ClassLoader.java:1860)&lt;br/&gt;
	at java.lang.Runtime.loadLibrary0(Runtime.java:845)&lt;br/&gt;
	at java.lang.System.loadLibrary(System.java:1084)&lt;br/&gt;
	at org.xerial.snappy.SnappyNativeLoader.loadLibrary(SnappyNativeLoader.java:52)&lt;br/&gt;
	... 17 more&lt;/p&gt;

&lt;p&gt;Cassandra-1.1.6&lt;br/&gt;
OSX 10.8 JDK &quot;1.7.0_07&quot;&lt;br/&gt;
Any Ideas ?&lt;/p&gt;</comment>
                            <comment id="13496310" author="slebresne" created="Tue, 13 Nov 2012 16:39:13 +0000"  >&lt;p&gt;As said above, this is logged by SnappyJava itself so there is nothing we can do about that. But this is only cosmetic, you should disregard the trace itself (it does indicate that you won&apos;t have compression enable but that&apos;s a totally different problem).&lt;/p&gt;</comment>
                            <comment id="13496330" author="yukim" created="Tue, 13 Nov 2012 17:04:47 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=miggi&quot; class=&quot;user-hover&quot; rel=&quot;miggi&quot;&gt;miggi&lt;/a&gt; I  think you are seeing this &lt;a href=&quot;https://github.com/xerial/snappy-java/issues/6&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/xerial/snappy-java/issues/6&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="13527231" author="drew_kutchar" created="Sat, 8 Dec 2012 18:49:49 +0000"  >&lt;p&gt;Is there a reason Cassandra&apos;s not using the pure Java version of Snappy? &lt;a href=&quot;https://github.com/dain/snappy&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/dain/snappy&lt;/a&gt;&lt;br/&gt;
The performance numbers are very similar. &lt;a href=&quot;https://github.com/ning/jvm-compressor-benchmark/wiki&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/ning/jvm-compressor-benchmark/wiki&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13527998" author="slebresne" created="Mon, 10 Dec 2012 15:29:38 +0000"  >&lt;blockquote&gt;&lt;p&gt;Is there a reason Cassandra&apos;s not using the pure Java version of Snappy?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;An very quick look at those benchmarks seems to suggest that the JNI impl is still faster on read, which is what we mainly care about. That being said, it wouldn&apos;t be crazy to fallback to the pure Java version if the JNI one can&apos;t be loaded, provided this is not too complicated to do. At least patches are welcome &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12534183" name="4400.txt" size="1183" author="slebresne" created="Mon, 2 Jul 2012 07:10:50 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[slebresne]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>256128</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            12 years, 50 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0gvgv:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>96528</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>acobley</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[acobley]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12961"><![CDATA[Low]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>