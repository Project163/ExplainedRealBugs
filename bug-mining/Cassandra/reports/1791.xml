<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 22:35:14 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-4669] Empty .cqlsh_history file causes cqlsh to crash on startup.</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-4669</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;Not sure how I got it, but I ended up with an empty .cqlsh_history file.  In that state, when starting cqlsh, you end up with:&lt;/p&gt;

&lt;p&gt;bone@zen:~/dev/boneill42/cassandra-&amp;gt; bin/cqlsh &lt;br/&gt;
Traceback (most recent call last):&lt;br/&gt;
  File &quot;bin/cqlsh&quot;, line 2588, in &amp;lt;module&amp;gt;&lt;br/&gt;
    main(*read_options(sys.argv&lt;span class=&quot;error&quot;&gt;&amp;#91;1:&amp;#93;&lt;/span&gt;, os.environ))&lt;br/&gt;
  File &quot;bin/cqlsh&quot;, line 2543, in main&lt;br/&gt;
    readline.read_history_file(HISTORY)&lt;br/&gt;
IOError: &lt;span class=&quot;error&quot;&gt;&amp;#91;Errno 22&amp;#93;&lt;/span&gt; Invalid argument&lt;/p&gt;

&lt;p&gt;Its a simple fix to check for a non-empty history file.  I&apos;ll attach the patch.&lt;/p&gt;</description>
                <environment>&lt;p&gt;Python 2.7.1 on Mac OSX &lt;/p&gt;</environment>
        <key id="12607713">CASSANDRA-4669</key>
            <summary>Empty .cqlsh_history file causes cqlsh to crash on startup.</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10003" iconUrl="https://issues.apache.org/jira/images/icons/priorities/trivial.svg">Low</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="boneill">Brian ONeill</assignee>
                                    <reporter username="boneill">Brian ONeill</reporter>
                        <labels>
                    </labels>
                <created>Fri, 14 Sep 2012 20:55:29 +0000</created>
                <updated>Tue, 16 Apr 2019 09:32:27 +0000</updated>
                            <resolved>Tue, 18 Sep 2012 01:44:50 +0000</resolved>
                                        <fixVersion>1.1.6</fixVersion>
                                    <component>Legacy/Tools</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="13456132" author="boneill" created="Fri, 14 Sep 2012 20:58:05 +0000"  >&lt;p&gt;Here is the patch.&lt;/p&gt;</comment>
                            <comment id="13456133" author="boneill" created="Fri, 14 Sep 2012 20:58:14 +0000"  >&lt;p&gt;Patch attached.&lt;/p&gt;</comment>
                            <comment id="13456180" author="brandon.williams" created="Fri, 14 Sep 2012 21:47:39 +0000"  >&lt;p&gt;Committed.&lt;/p&gt;</comment>
                            <comment id="13457532" author="iamaleksey" created="Tue, 18 Sep 2012 01:42:16 +0000"  >&lt;p&gt;This patch breaks cqlsh history loading. Also, the original issue isn&apos;t an issue at all - readline handles empty history files perfectly well.&lt;br/&gt;
Reverting the commit should fix the new issue.&lt;/p&gt;</comment>
                            <comment id="13457535" author="brandon.williams" created="Tue, 18 Sep 2012 01:44:50 +0000"  >&lt;p&gt;Reverted.&lt;/p&gt;</comment>
                            <comment id="13457538" author="boneill" created="Tue, 18 Sep 2012 01:59:34 +0000"  >&lt;p&gt;I trust you guys, but you may just want to double check that this isn&apos;t an issue.  I can easily reproduce the problem.  Here is a log.  You can see it working initially.  I truncate the file, and no joy.&lt;/p&gt;

&lt;p&gt;bone@zen:~/dev/boneill42/cassandra-&amp;gt; bin/cqlsh &lt;br/&gt;
Connected to Test Cluster at localhost:9160.&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;cqlsh 2.2.0 | Cassandra 1.1.5 | CQL spec 3.0.0 | Thrift protocol 19.32.0&amp;#93;&lt;/span&gt;&lt;br/&gt;
Use HELP for help.&lt;br/&gt;
cqlsh&amp;gt; quit&lt;br/&gt;
bone@zen:~/dev/boneill42/cassandra-&amp;gt; rm -fr ~/.cqlsh_history &lt;br/&gt;
bone@zen:~/dev/boneill42/cassandra-&amp;gt; touch ~/.cqlsh_history&lt;br/&gt;
bone@zen:~/dev/boneill42/cassandra-&amp;gt; bin/cqlsh &lt;br/&gt;
Traceback (most recent call last):&lt;br/&gt;
  File &quot;bin/cqlsh&quot;, line 2588, in &amp;lt;module&amp;gt;&lt;br/&gt;
    main(*read_options(sys.argv&lt;span class=&quot;error&quot;&gt;&amp;#91;1:&amp;#93;&lt;/span&gt;, os.environ))&lt;br/&gt;
  File &quot;bin/cqlsh&quot;, line 2543, in main&lt;br/&gt;
    readline.read_history_file(HISTORY)&lt;br/&gt;
IOError: &lt;span class=&quot;error&quot;&gt;&amp;#91;Errno 22&amp;#93;&lt;/span&gt; Invalid argument&lt;br/&gt;
bone@zen:~/dev/boneill42/cassandra-&amp;gt; &lt;/p&gt;</comment>
                            <comment id="13457540" author="brandon.williams" created="Tue, 18 Sep 2012 02:03:32 +0000"  >&lt;p&gt;Maybe we should just catch any error from loading the history, issue a warning, and move along.&lt;/p&gt;</comment>
                            <comment id="13457547" author="iamaleksey" created="Tue, 18 Sep 2012 02:13:32 +0000"  >&lt;p&gt;Brian, what are your python/readline versions and OS?&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt; &#10148; bin/cqlsh&lt;br/&gt;
Connected to Test Cluster at localhost:9160.&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;cqlsh 2.2.0 | Cassandra unknown | CQL spec 3.0.0 | Thrift protocol 19.34.0&amp;#93;&lt;/span&gt;&lt;br/&gt;
Use HELP for help.&lt;br/&gt;
cqlsh&amp;gt; quit&lt;br/&gt;
 &#10148; rm -fr ~/.cqlsh_history &lt;br/&gt;
 &#10148; touch ~/.cqlsh_history&lt;br/&gt;
 &#10148; bin/cqlsh &lt;br/&gt;
Connected to Test Cluster at localhost:9160.&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;cqlsh 2.2.0 | Cassandra unknown | CQL spec 3.0.0 | Thrift protocol 19.34.0&amp;#93;&lt;/span&gt;&lt;br/&gt;
Use HELP for help.&lt;br/&gt;
cqlsh&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Also, shell will write empty .cqlsh_history when you open it for the first time and close it without entering any commands. And will open just fine next time.&lt;/p&gt;

&lt;p&gt;Brandon, or do that, yes. Then we can get rid of os.path.exists(HISTORY) check.&lt;/p&gt;</comment>
                            <comment id="13457553" author="boneill" created="Tue, 18 Sep 2012 02:28:52 +0000"  >
&lt;p&gt;Not sure how to tell exact version of readline. (I&apos;m a java head =)&lt;br/&gt;
This is on OSX.  Looks like the version is the one provided by apple in the python install.&lt;/p&gt;

&lt;p&gt;Here is what i&apos;ve got:&lt;br/&gt;
bone@zen:~/dev/boneill42/cassandra-&amp;gt; python&lt;br/&gt;
Python 2.7.1 (r271:86832, Jul 31 2011, 19:30:53) &lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;GCC 4.2.1 (Based on Apple Inc. build 5658) (LLVM build 2335.15.00)&amp;#93;&lt;/span&gt; on darwin&lt;br/&gt;
Type &quot;help&quot;, &quot;copyright&quot;, &quot;credits&quot; or &quot;license&quot; for more information.&lt;br/&gt;
&amp;gt;&amp;gt;&amp;gt; import readline&lt;br/&gt;
&amp;gt;&amp;gt;&amp;gt; readline&lt;br/&gt;
&amp;lt;module &apos;readline&apos; from &apos;/System/Library/Frameworks/Python.framework/Versions/2.7/lib/python2.7/lib-dynload/readline.so&apos;&amp;gt;&lt;/p&gt;

&lt;p&gt;FWW, this can be a really annoying error unless you can read Python.  It doesn&apos;t get far enough to recrete the history file.  So, the problem persists. Your average user would be stuck.  I first reinstalled Cassandra because I thought something was corrupt.  Fortunately, python isn&apos;t compiled. =)&lt;/p&gt;</comment>
                            <comment id="13457559" author="iamaleksey" created="Tue, 18 Sep 2012 02:36:19 +0000"  >&lt;p&gt;Ah, OS X. Maybe it really does fail on OS X. Works on Ubuntu though. Attached a patch that catches IOError when reading/writing from/to history file.&lt;/p&gt;</comment>
                            <comment id="13457560" author="boneill" created="Tue, 18 Sep 2012 02:36:30 +0000"  >&lt;p&gt;Beautiful.  Thanks guys. &lt;/p&gt;</comment>
                            <comment id="13457561" author="brandon.williams" created="Tue, 18 Sep 2012 02:42:50 +0000"  >&lt;p&gt;Committed.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12545516" name="fix-cqlsh-history.patch" size="1706" author="aleksey" created="Tue, 18 Sep 2012 02:31:08 +0000"/>
                            <attachment id="12545209" name="trunk-4669.txt" size="511" author="boneill" created="Fri, 14 Sep 2012 20:58:05 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[boneill]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>256330</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            13 years, 10 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0gyav:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>96987</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>brandon.williams</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[brandon.williams]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12961"><![CDATA[Low]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>