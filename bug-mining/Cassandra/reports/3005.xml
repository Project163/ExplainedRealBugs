<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 22:47:02 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-7665] nodetool scrub fails on system schema with UDTs</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-7665</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;[apache-cassandra-2.1.0-rc4]$ bin/cqlsh
Connected to Test Cluster at 127.0.0.1:9042.
[cqlsh 5.0.1 | Cassandra 2.1.0-rc4 | CQL spec 3.2.0 | Native protocol v3]
Use HELP for help.
cqlsh&amp;gt; CREATE KEYSPACE test WITH replication = {&apos;class&apos;: &apos;SimpleStrategy&apos;, &apos;replication_factor&apos;: 1 };
cqlsh&amp;gt; use test;
cqlsh:test&amp;gt; CREATE TYPE point_t (x double, y double);
cqlsh:test&amp;gt; exit
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;[apache-cassandra-2.1.0-rc4]$bin/nodetool scrub

INFO  12:34:57 Scrubbing SSTableReader(path=&apos;/apache-cassandra-2.1.0-rc4/bin/../data/data/system/schema_columnfamilies-45f5b36024bc3f83a3631034ea4fa697/system-schema_columnfamilies-ka-1-Data.db&apos;) (34135 bytes)
INFO  12:34:57 Scrub of SSTableReader(path=&apos;/apache-cassandra-2.1.0-rc4/bin/../data/data/system/schema_columnfamilies-45f5b36024bc3f83a3631034ea4fa697/system-schema_columnfamilies-ka-1-Data.db&apos;) complete: 2 rows in new sstable and 0 empty (tombstoned) rows dropped
INFO  12:34:57 Scrubbing SSTableReader(path=&apos;/apache-cassandra-2.1.0-rc4/bin/../data/data/system/local-7ad54392bcdd35a684174e047860b377/system-local-ka-5-Data.db&apos;) (12515 bytes)
WARN  12:34:57 Error reading row (stacktrace follows):
org.apache.cassandra.io.sstable.CorruptSSTableException: org.apache.cassandra.serializers.MarshalException: Not enough bytes to read a set
	at org.apache.cassandra.io.sstable.SSTableIdentityIterator.next(SSTableIdentityIterator.java:139) ~[apache-cassandra-2.1.0-rc4.jar:2.1.0-rc4]
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment>&lt;p&gt;2.1.0-rc4&lt;/p&gt;</environment>
        <key id="12731313">CASSANDRA-7665</key>
            <summary>nodetool scrub fails on system schema with UDTs</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10002" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Normal</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="yukim">Yuki Morishita</assignee>
                                    <reporter username="jhalliday">Jonathan Halliday</reporter>
                        <labels>
                    </labels>
                <created>Fri, 1 Aug 2014 12:47:27 +0000</created>
                <updated>Tue, 16 Apr 2019 09:31:38 +0000</updated>
                            <resolved>Fri, 1 Aug 2014 22:22:23 +0000</resolved>
                                        <fixVersion>2.1 rc5</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="14082509" author="krummas" created="Fri, 1 Aug 2014 17:04:23 +0000"  >&lt;p&gt;this seems to affect all lists/sets, attaching unit test to reproduce (note, it passes but exception in logs)&lt;/p&gt;</comment>
                            <comment id="14082870" author="yukim" created="Fri, 1 Aug 2014 20:13:13 +0000"  >&lt;p&gt;It looks to me that the problem is CollectionType always validates value in native protocol format(&lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-7208&quot; title=&quot;CollectionType validate method should have a proper implementation&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-7208&quot;&gt;&lt;del&gt;CASSANDRA-7208&lt;/del&gt;&lt;/a&gt;), while scrub wants to validate on disk format through SSTableIdentityIterator.&lt;br/&gt;
Prior to &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-7208&quot; title=&quot;CollectionType validate method should have a proper implementation&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-7208&quot;&gt;&lt;del&gt;CASSANDRA-7208&lt;/del&gt;&lt;/a&gt;, &lt;del&gt;validation on collection was no-op.&lt;/del&gt;&lt;br/&gt;
edit: Actually. CollectionType&apos;s validate was for validating its content using that value&apos;s type.&lt;br/&gt;
Post &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-7208&quot; title=&quot;CollectionType validate method should have a proper implementation&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-7208&quot;&gt;&lt;del&gt;CASSANDRA-7208&lt;/del&gt;&lt;/a&gt;, it is changed to validate whole collection.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=thobbs&quot; class=&quot;user-hover&quot; rel=&quot;thobbs&quot;&gt;thobbs&lt;/a&gt; Any idea how we can fix this?&lt;/p&gt;</comment>
                            <comment id="14083005" author="yukim" created="Fri, 1 Aug 2014 21:41:28 +0000"  >&lt;p&gt;One posisble solution is to validate individual cell when CollectionType as in attached patch.&lt;/p&gt;</comment>
                            <comment id="14083010" author="thobbs" created="Fri, 1 Aug 2014 21:43:43 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=yukim&quot; class=&quot;user-hover&quot; rel=&quot;yukim&quot;&gt;yukim&lt;/a&gt; I think we need a separate &lt;tt&gt;validateCellValue()&lt;/tt&gt; method on &lt;tt&gt;AbstractType&lt;/tt&gt; and &lt;tt&gt;TypeSerializer&lt;/tt&gt;, which &lt;tt&gt;AbstractCell.validateFields()&lt;/tt&gt; will call.  By default, it can use the normal &lt;tt&gt;validate()&lt;/tt&gt; results, but &lt;tt&gt;CollectionSerializer&lt;/tt&gt; will need to override that.&lt;/p&gt;

&lt;p&gt;I don&apos;t think there are actually any problems with UDTs (or tuples), despite the name of the ticket and the initial description.&lt;/p&gt;</comment>
                            <comment id="14083036" author="yukim" created="Fri, 1 Aug 2014 22:06:44 +0000"  >&lt;p&gt;Updated patch for Tyler&apos;s comment.&lt;/p&gt;</comment>
                            <comment id="14083045" author="thobbs" created="Fri, 1 Aug 2014 22:12:53 +0000"  >&lt;p&gt;+1&lt;/p&gt;</comment>
                            <comment id="14083063" author="yukim" created="Fri, 1 Aug 2014 22:22:23 +0000"  >&lt;p&gt;Committed, thanks!&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12659259" name="0001-add-validateCellValue-to-AbstractType.patch" size="2853" author="yukim" created="Fri, 1 Aug 2014 22:06:44 +0000"/>
                            <attachment id="12659196" name="0001-test.patch" size="3239" author="marcuse" created="Fri, 1 Aug 2014 17:04:23 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[yukim]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>409385</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            11 years, 16 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1yfs7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>409381</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>thobbs</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[thobbs]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12962"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>