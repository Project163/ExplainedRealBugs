<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 22:34:53 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-4497] Update CQL pseudo-maps to real map syntax</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-4497</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;compression_parameters&lt;/li&gt;
	&lt;li&gt;replication_parameters (combine strategy + options like we did compression)&lt;/li&gt;
	&lt;li&gt;anything else?&lt;/li&gt;
&lt;/ul&gt;
</description>
                <environment></environment>
        <key id="12602033">CASSANDRA-4497</key>
            <summary>Update CQL pseudo-maps to real map syntax</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10002" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Normal</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="xedin">Pavel Yaskevich</assignee>
                                    <reporter username="jbellis">Jonathan Ellis</reporter>
                        <labels>
                            <label>cql3</label>
                    </labels>
                <created>Tue, 7 Aug 2012 16:23:56 +0000</created>
                <updated>Tue, 16 Apr 2019 09:32:29 +0000</updated>
                            <resolved>Tue, 4 Sep 2012 17:43:32 +0000</resolved>
                                        <fixVersion>1.2.0 beta 1</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="13430407" author="slebresne" created="Tue, 7 Aug 2012 16:36:05 +0000"  >&lt;p&gt;There&apos;s also compaction (same than replication, we want to merge the class and the options).&lt;/p&gt;

&lt;p&gt;I would also be in favor of using shortish name, something like:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;CREATE KEYSPACE foo WITH replication = { &apos;class&apos; : &apos;SimpleStrategy&apos;, &apos;replication_factor&apos; : 1 }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;(we could even shorten replication_factor to factor I guess, though I&apos;m personally good like that.&lt;/p&gt;

&lt;p&gt;Talking of the replication strategy, I&apos;d be in favor of having some default for the replication strategy as we do when using the cassandra-cli, as this make it easier to do quick tests.&lt;/p&gt;</comment>
                            <comment id="13430512" author="jbellis" created="Tue, 7 Aug 2012 18:35:23 +0000"  >&lt;blockquote&gt;&lt;p&gt;I would also be in favor of using shortish name&lt;/p&gt;&lt;/blockquote&gt;


&lt;p&gt;+1, although we already accept short classnames everywhere &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/help_16.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; we accept long ones, for built-in classes.  Unsure why docs continue to use fully-qualified names.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;I&apos;d be in favor of having some default for the replication strategy as we do when using the cassandra-cli&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I&apos;d like to, but I think the reasoning in &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-2529?focusedCommentId=13022925&amp;amp;page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13022925&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/CASSANDRA-2529?focusedCommentId=13022925&amp;amp;page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13022925&lt;/a&gt; still applies.&lt;/p&gt;</comment>
                            <comment id="13430544" author="slebresne" created="Tue, 7 Aug 2012 19:16:09 +0000"  >&lt;blockquote&gt;&lt;p&gt;although we already accept short classnames everywhere&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Yes, but I was mostly taking about using &apos;replication&apos; instead of &apos;replication_parameters&apos;. That&apos;s a detail of course.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;I&apos;d like to, but I think the reasoning in &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-2529?focusedCommentId=13022925&amp;amp;page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13022925&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/CASSANDRA-2529?focusedCommentId=13022925&amp;amp;page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13022925&lt;/a&gt; still applies&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;That&apos;s true. Maybe we could at least make it so that &quot;replication = &lt;/p&gt;
{ &apos;replication_factor&apos; : 1 }
&lt;p&gt;&quot; infers SimpleStrategy? &lt;/p&gt;</comment>
                            <comment id="13430559" author="jbellis" created="Tue, 7 Aug 2012 19:33:59 +0000"  >&lt;p&gt;At that point, I don&apos;t think the characters saved justify the ambiguity over what&apos;s happening.&lt;/p&gt;</comment>
                            <comment id="13430593" author="slebresne" created="Tue, 7 Aug 2012 20:20:12 +0000"  >&lt;p&gt;I guess it&apos;s not so much about saving keystrokes (though as someone that does a lot a quick, one-shot CQL tests, I wouldn&apos;t mind the shortcut), but the fact that the create keyspace statement is the first statement beginner will see. At that time, it feels like even having the strategy class means you need to either say &quot;ignore that for now&quot; (which is always bad and frustrate people) or have to explain that it&apos;s because there is multiple strategies and yada yada yada. And given we don&apos;t allow &apos;replication_factor&apos; for NTS, I don&apos;t think this adds much ambiguity. Not a huge deal though, but I do feel this minimal create keyspace statement is not minimal enough.&lt;/p&gt;</comment>
                            <comment id="13430596" author="jbellis" created="Tue, 7 Aug 2012 20:31:44 +0000"  >&lt;p&gt;I agree with your problem statement, but I haven&apos;t seen a sufficiently attractive solution yet. &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="13432712" author="slebresne" created="Fri, 10 Aug 2012 12:01:06 +0000"  >&lt;p&gt;Actually, while we&apos;re at using collections in system table, it would be to also&lt;br/&gt;
use collections for the columns_aliases, key_aliases and the index_options for&lt;br/&gt;
in ColumnDefinition. For the column_aliases and key_aliases, it&apos;s indirectly&lt;br/&gt;
visible to user if they query System.schema_columnfamilies, and since that will&lt;br/&gt;
be the new way to do a describe, it&apos;s worth removing the use of json.&lt;/p&gt;</comment>
                            <comment id="13445056" author="xedin" created="Thu, 30 Aug 2012 16:07:55 +0000"  >{replication, compression, compaction}
&lt;p&gt;_parameters are made to be set using &amp;lt;key&amp;gt; = &lt;/p&gt;
{ &amp;lt;k&amp;gt; : &amp;lt;v&amp;gt;, ... }
&lt;p&gt; syntax.&lt;/p&gt;</comment>
                            <comment id="13446178" author="thepaul" created="Fri, 31 Aug 2012 17:55:02 +0000"  >&lt;p&gt;From the patch, it looks like we won&apos;t be supporting the old syntax anymore. This, and the option name changes, is going to make all our docs more complicated, and also non-trivially complicate the smarter clients (in particular, cqlsh, opscenter, etc). Also, it looks like there isn&apos;t any way to change one option and leave the other intact (like &quot;WITH replication&lt;span class=&quot;error&quot;&gt;&amp;#91;&amp;#39;replication_factor&amp;#39;&amp;#93;&lt;/span&gt; = 2&quot;, which it seems like ought to be implied by the use of the map syntax. The whole thing doesn&apos;t seem much cleaner than before. What&apos;s the main motivation?&lt;/p&gt;</comment>
                            <comment id="13446503" author="jbellis" created="Fri, 31 Aug 2012 23:51:57 +0000"  >&lt;p&gt;How is it more complicated to document that replication_parameters is a map like any other, than replication_parameters has its own one-off syntax that only exists for historical reasons?  I don&apos;t buy it.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;Also, it looks like there isn&apos;t any way to change one option and leave the other intact (like &quot;WITH replication&lt;span class=&quot;error&quot;&gt;&amp;#91;&amp;#39;replication_factor&amp;#39;&amp;#93;&lt;/span&gt; = 2&quot;, which it seems like ought to be implied by the use of the map syntax&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Agreed, if we can fix this easily we should.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;What&apos;s the main motivation&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Two motivations:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;reduce the special case weirdnesses exposed to users, as above&lt;/li&gt;
	&lt;li&gt;reduce special case weirdnesses in our internal implementation (which is also exposed to &quot;power users&quot; in the system KS).  so much more pleasant to &quot;select replication_options from schema_keyspaces where keyspace_name = &apos;foo&apos;&quot; and get a Map back.&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13446584" author="thepaul" created="Sat, 1 Sep 2012 03:12:49 +0000"  >&lt;blockquote&gt;&lt;p&gt;How is it more complicated to document that replication_parameters is a map like any other, than replication_parameters has its own one-off syntax that only exists for historical reasons? I don&apos;t buy it.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;It&apos;s not, but it is more complicated when we need to say &quot;if you&apos;re using CQL 3 with Cassandra 1.0 or 1.1, then you need to do this. If you&apos;re using CQL 3 with 1.2 or higher, then you need to do this totally different thing. If you&apos;re using CQL 2, then you do something else.&quot; I know, ideally we would have fully separate documentation sets and fully separate cqlsh versions per major Cassandra version, but people don&apos;t seem to be very good at referring only to the right one.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;reduce the special case weirdnesses exposed to users, as above&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I&apos;m admittedly thick, but which weirdnesses are reduced here?&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;reduce special case weirdnesses in our internal implementation (which is also exposed to &quot;power users&quot; in the system KS). so much more pleasant to &quot;select replication_options from schema_keyspaces where keyspace_name = &apos;foo&apos;&quot; and get a Map back.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I agree with that 100%, but this patch doesn&apos;t do that. It only changes the dedicated syntax for setting keyspace and columnfamily options. I&apos;d much prefer getting real maps inside the system.schema* tables and leaving the cql syntax alone when we can. It has been a real moving target, and swiping out the &quot;first command you do&quot; from under everyone&apos;s feet seems like it might be discouraging.&lt;/p&gt;</comment>
                            <comment id="13446734" author="xedin" created="Sat, 1 Sep 2012 15:16:00 +0000"  >&lt;p&gt;Ok, let make it clear what do me want to be the out come of the ticket: I thought that we want to change CQL3 parameter behavior from pseudo-maps to real maps for commands like &quot;create keyspace/table&quot; and &quot;alter table&quot;? I&apos;m not a fan of keeping old syntax because that could lead to confusing mixing problems where users would use old syntax in one place and new one later in the same statement... If we also want to modify how schema handles maps or namely change json to native maps that would require a separate ticket because of work front which would have to be done. &lt;/p&gt;</comment>
                            <comment id="13447083" author="jbellis" created="Mon, 3 Sep 2012 01:49:33 +0000"  >&lt;blockquote&gt;&lt;p&gt;I&apos;m not a fan of keeping old syntax because that could lead to confusing mixing problems where users would use old syntax in one place and new one later in the same statement&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;+1&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;If we also want to modify how schema handles maps or namely change json to native maps that would require a separate ticket &lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Fine, &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-4603&quot; title=&quot;use Map internally in schema_ tables where appropriate&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-4603&quot;&gt;&lt;del&gt;CASSANDRA-4603&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="13447637" author="xedin" created="Tue, 4 Sep 2012 11:46:08 +0000"  >&lt;p&gt;rebased patch after changes in &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-4597&quot; title=&quot;Impossible to set LeveledCompactionStrategy to a column family.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-4597&quot;&gt;&lt;del&gt;CASSANDRA-4597&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13447789" author="slebresne" created="Tue, 4 Sep 2012 16:26:04 +0000"  >
&lt;p&gt;Since we&apos;re breaking from earlier version of CQL3 anyway (and we&apos;ve been clear that CQL3 has been beta so far), I would be in favor of shortening some options names (some were in Pavel&apos;s patch already but not all) as said previous.&lt;/p&gt;

&lt;p&gt;I&apos;m attaching a v2 based on Pavel&apos;s patch that does that. So that the exact syntax is:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;CREATE KEYSPACE foo WITH replication = { &apos;class&apos; : &apos;SimpleStrategy&apos;,  &apos;replication_factor&apos; : 1 }
CREATE TABLE .... WITH compression = { ... }
                   AND compaction = { &apos;class&apos; : &apos;SizeTieredCompactionStrategy&apos;, &apos;min_threshold&apos; : 2, &apos;max_threshold&apos; : 4 }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;v2 also slightly update the grammar to better reuse code between create and alter table, and it fixes a potential NPE in the grammar convertMap method (due to antlr being a smart-ass). It also throw a ConfiguarionException in the case were compaction options are given but not the &apos;class&apos; itself (since that feels more consistent with the semantic of having a map literal).&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;it looks like there isn&apos;t any way to change one option and leave the other intact (like &quot;WITH replication&lt;span class=&quot;error&quot;&gt;&amp;#91;&amp;#39;replication_factor&amp;#39;&amp;#93;&lt;/span&gt; = 2&quot;&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I agree, but that&apos;s a bit of a pain to add (in particular things like &quot;WITH replication = &lt;/p&gt;
{ &apos;class&apos; : &apos;SimpleStrategy}
&lt;p&gt; AND replication&lt;span class=&quot;error&quot;&gt;&amp;#91;&amp;#39;replication_factor&amp;#39;&amp;#93;&lt;/span&gt; = 2&quot; are a bit annoying to handle) so I would suggest leaving that to later.&lt;/p&gt;</comment>
                            <comment id="13447809" author="xedin" created="Tue, 4 Sep 2012 16:51:23 +0000"  >&lt;p&gt;+1, with nit: I think we would be should make naming consistent and change COMPACTION_OPTIONS to COMPACTION_PARAMETERS.&lt;/p&gt;</comment>
                            <comment id="13447842" author="slebresne" created="Tue, 4 Sep 2012 17:43:32 +0000"  >&lt;p&gt;Committed with nits fixed, thanks&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12543699" name="4497-v2.txt" size="17298" author="slebresne" created="Tue, 4 Sep 2012 16:26:04 +0000"/>
                            <attachment id="12543657" name="CASSANDRA-4497.patch" size="14648" author="xedin" created="Tue, 4 Sep 2012 11:46:08 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[xedin]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>256200</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            13 years, 12 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0gwgv:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>96690</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>slebresne</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[slebresne]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12962"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>