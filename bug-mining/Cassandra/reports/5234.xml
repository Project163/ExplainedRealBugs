<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 23:14:00 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-15385] Ensure that tracing doesn&apos;t break connections in 3.x/4.0 mixed mode by default</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-15385</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description></description>
                <environment></environment>
        <key id="13265319">CASSANDRA-15385</key>
            <summary>Ensure that tracing doesn&apos;t break connections in 3.x/4.0 mixed mode by default</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10002" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Normal</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="aleksey">Aleksey Yeschenko</assignee>
                                    <reporter username="aleksey">Aleksey Yeschenko</reporter>
                        <labels>
                    </labels>
                <created>Wed, 30 Oct 2019 14:51:32 +0000</created>
                <updated>Mon, 21 Dec 2020 08:08:11 +0000</updated>
                            <resolved>Mon, 4 Nov 2019 18:05:09 +0000</resolved>
                                        <fixVersion>3.0.20</fixVersion>
                    <fixVersion>3.11.6</fixVersion>
                                    <component>Observability/Tracing</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="16964009" author="iamaleksey" created="Thu, 31 Oct 2019 13:30:50 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-7544&quot; title=&quot;Allow storage port to be configurable per node&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-7544&quot;&gt;&lt;del&gt;CASSANDRA-7544&lt;/del&gt;&lt;/a&gt; allowed storage port to be configurable per node, and among its changes introduced several new columns to some of the distributed system tables:&lt;/p&gt;

&lt;p&gt;1. &lt;tt&gt;coordinator_port&lt;/tt&gt; and &lt;tt&gt;participants_v2&lt;/tt&gt; to &lt;tt&gt;system_distributed.repair_history&lt;/tt&gt;&lt;br/&gt;
2. &lt;tt&gt;coordinator_port&lt;/tt&gt; to &lt;tt&gt;system_traces.sessions&lt;/tt&gt;&lt;br/&gt;
3. &lt;tt&gt;source_port&lt;/tt&gt; to &lt;tt&gt;system_traces.events&lt;/tt&gt;&lt;/p&gt;

&lt;p&gt;(1) is not a huge deal, since we don&apos;t support repair in mixed mode clusters; (2) and (3), however, are. And while &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-14841&quot; title=&quot;Don&amp;#39;t write to system_distributed.repair_history, system_traces.sessions, system_traces.events in mixed version 3.X/4.0 clusters&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-14841&quot;&gt;&lt;del&gt;CASSANDRA-14841&lt;/del&gt;&lt;/a&gt; modifies tracing logic to not write those new added columns while still in mixed mode, this is still a problem for reads - which in case of tracing will be issued automatically by the drivers.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-14897&quot; title=&quot;In mixed 3.x/4 version clusters write tracing and repair history information without new columns&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-14897&quot;&gt;&lt;del&gt;CASSANDRA-14897&lt;/del&gt;&lt;/a&gt; gives advice to add some of these columns manually (though not tracing) while still on 3.x, but there is a reason why such alters are explicitly forbidden and require a workaround: distributed pseudo-system tables are evolved programmatically, by bumping internal generation timestamp. Mixing manual alters and real-world timestamps and those surrogate timestamps simply prevents us from deterministically evolving those schemas in future versions.&lt;/p&gt;

&lt;p&gt;The patches to be linked pre-add the columns on 3.0/3.11 side automatically, preserving the correct timestamps, so that tracing can go on uninhibited, without crashing the internode connections and losing the enqueued messages in the process.&lt;/p&gt;</comment>
                            <comment id="16964996" author="iamaleksey" created="Fri, 1 Nov 2019 17:21:50 +0000"  >&lt;p&gt;3.0: &lt;a href=&quot;https://github.com/iamaleksey/cassandra/commits/15385-3.0&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;code&lt;/a&gt;, &lt;a href=&quot;https://circleci.com/workflow-run/e202c2ef-6bba-453b-ac05-c8125b643683&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;CI&lt;/a&gt;&lt;br/&gt;
3.11: &lt;a href=&quot;https://github.com/iamaleksey/cassandra/commits/15385-3.11&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;code&lt;/a&gt;, &lt;a href=&quot;https://circleci.com/workflow-run/a0ce5ec1-b3c7-417e-97c9-7387a30d0ab5&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;CI&lt;/a&gt;&lt;br/&gt;
4.0: &lt;a href=&quot;https://github.com/iamaleksey/cassandra/commits/15385-4.0&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;code&lt;/a&gt; (only updates NEWS.txt)&lt;/p&gt;

&lt;p&gt;dtest changes: &lt;a href=&quot;https://github.com/iamaleksey/cassandra-dtest/commits/15385&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;here&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;We do have a dtest that covers the issue - it&apos;s just that at the moment it white-lists these exceptions and ignores them in the logs. The commit to dtest repo forces the test to fail without the suggested changes to C*, but the test passes cleanly with them, without any disconnects, message drops, and errors in the logs. Running the test is a little involved, however, since running upgrade tests is currently broken on Circle. I did run them locally however.&lt;/p&gt;</comment>
                            <comment id="16966607" author="beobal" created="Mon, 4 Nov 2019 12:11:09 +0000"  >&lt;p&gt;+1 Both the C* and dtest changes LGTM &lt;/p&gt;</comment>
                            <comment id="16966880" author="iamaleksey" created="Mon, 4 Nov 2019 18:03:13 +0000"  >&lt;p&gt;Cheers - committed to 3.0 as &lt;a href=&quot;https://github.com/apache/cassandra/commit/9b1f3796a65db46f15f2f2ad8af4180f71e3f53f&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;9b1f3796a65db46f15f2f2ad8af4180f71e3f53f&lt;/a&gt; and merged upwards.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="13271710">CASSANDRA-15441</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[aleksey]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12313825" key="com.atlassian.jira.plugin.system.customfieldtypes:cascadingselect">
                        <customfieldname>Bug Category</customfieldname>
                        <customfieldvalues>
                                                    <customfieldvalue key="12983" cascade-level=""><![CDATA[Availability]]></customfieldvalue>
            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12313821" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Complexity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12965"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313822" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Discovered By</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12975"><![CDATA[Code Inspection]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12313922" key="jira.plugin.projectspecificselectfield.jpssf:multicftype">
                        <customfieldname>Impacts</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="13100"><![CDATA[None]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            6 years, 2 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12313921" key="jira.plugin.projectspecificselectfield.jpssf:multicftype">
                        <customfieldname>Platform</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="13076"><![CDATA[All]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z083ko:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[samt]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12962"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12311420" key="com.atlassian.jira.plugin.system.customfieldtypes:version">
                        <customfieldname>Since Version</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="12346093">4.0-alpha</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12314136" key="com.atlassian.jira.plugin.system.customfieldtypes:version">
                        <customfieldname>Since Version</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="12348281">4.0-alpha1</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313924" key="com.atlassian.jira.plugin.system.customfieldtypes:textfield">
                        <customfieldname>Source Control Link</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>&lt;p&gt;&lt;a href=&quot;https://github.com/apache/cassandra/commit/9b1f3796a65db46f15f2f2ad8af4180f71e3f53f&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;9b1f3796a65db46f15f2f2ad8af4180f71e3f53f&lt;/a&gt;&lt;/p&gt;</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313823" key="com.atlassian.jira.plugin.system.customfieldtypes:textarea">
                        <customfieldname>Test and Documentation Plan</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>&lt;p&gt;Use existing upgrade test that covers it, remove whitelisted error logs.&lt;/p&gt;</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>