<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 22:49:56 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-8463] Constant compaction under LCS</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-8463</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;It appears that tables configured with LCS will completely re-compact themselves over some period of time after upgrading from 2.0 to 2.1 (2.0.11 -&amp;gt; 2.1.2, specifically). It starts out with &amp;lt;10 pending tasks for an hour or so, then starts building up, now with 50-100 tasks pending across the cluster after 12 hours. These nodes are under heavy write load, but were easily able to keep up in 2.0 (they rarely had &amp;gt;5 pending compaction tasks), so I don&apos;t think it&apos;s LCS in 2.1 actually being worse, just perhaps some different LCS behavior that causes the layout of tables from 2.0 to prompt the compactor to reorganize them?&lt;/p&gt;

&lt;p&gt;The nodes flushed ~11MB SSTables under 2.0. They&apos;re currently flushing ~36MB SSTables due to the improved memtable setup in 2.1. Before I upgraded the entire cluster to 2.1, I noticed the problem and tried several variations on the flush size, thinking perhaps the larger tables in L0 were causing some kind of cascading compactions. Even if they&apos;re sized roughly like the 2.0 flushes were, same behavior occurs. I also tried both enabling &amp;amp; disabling STCS in L0 with no real change other than L0 began to back up faster, so I left the STCS in L0 enabled.&lt;/p&gt;

&lt;p&gt;Tables are configured with 32MB sstable_size_in_mb, which was found to be an improvement on the 160MB table size for compaction performance. Maybe this is wrong now? Otherwise, the tables are configured with defaults. Compaction has been unthrottled to help them catch-up. The compaction threads stay very busy, with the cluster-wide CPU at 45% &quot;nice&quot; time. No nodes have completely caught up yet. I&apos;ll update JIRA with status about their progress if anything interesting happens.&lt;/p&gt;

&lt;p&gt;From a node around 12 hours ago, around an hour after the upgrade, with 19 pending compaction tasks:&lt;br/&gt;
SSTables in each level: &lt;span class=&quot;error&quot;&gt;&amp;#91;6/4, 10, 105/100, 268, 0, 0, 0, 0, 0&amp;#93;&lt;/span&gt;&lt;br/&gt;
SSTables in each level: &lt;span class=&quot;error&quot;&gt;&amp;#91;6/4, 10, 106/100, 271, 0, 0, 0, 0, 0&amp;#93;&lt;/span&gt;&lt;br/&gt;
SSTables in each level: &lt;span class=&quot;error&quot;&gt;&amp;#91;1, 16/10, 105/100, 269, 0, 0, 0, 0, 0&amp;#93;&lt;/span&gt;&lt;br/&gt;
SSTables in each level: &lt;span class=&quot;error&quot;&gt;&amp;#91;5/4, 10, 103/100, 272, 0, 0, 0, 0, 0&amp;#93;&lt;/span&gt;&lt;br/&gt;
SSTables in each level: &lt;span class=&quot;error&quot;&gt;&amp;#91;4, 11/10, 105/100, 270, 0, 0, 0, 0, 0&amp;#93;&lt;/span&gt;&lt;br/&gt;
SSTables in each level: &lt;span class=&quot;error&quot;&gt;&amp;#91;1, 12/10, 105/100, 271, 0, 0, 0, 0, 0&amp;#93;&lt;/span&gt;&lt;br/&gt;
SSTables in each level: &lt;span class=&quot;error&quot;&gt;&amp;#91;1, 14/10, 104/100, 267, 0, 0, 0, 0, 0&amp;#93;&lt;/span&gt;&lt;br/&gt;
SSTables in each level: &lt;span class=&quot;error&quot;&gt;&amp;#91;9/4, 10, 103/100, 265, 0, 0, 0, 0, 0&amp;#93;&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;Recently, with 41 pending compaction tasks:&lt;br/&gt;
SSTables in each level: &lt;span class=&quot;error&quot;&gt;&amp;#91;4, 13/10, 106/100, 269, 0, 0, 0, 0, 0&amp;#93;&lt;/span&gt;&lt;br/&gt;
SSTables in each level: &lt;span class=&quot;error&quot;&gt;&amp;#91;4, 12/10, 106/100, 273, 0, 0, 0, 0, 0&amp;#93;&lt;/span&gt;&lt;br/&gt;
SSTables in each level: &lt;span class=&quot;error&quot;&gt;&amp;#91;5/4, 11/10, 106/100, 271, 0, 0, 0, 0, 0&amp;#93;&lt;/span&gt;&lt;br/&gt;
SSTables in each level: &lt;span class=&quot;error&quot;&gt;&amp;#91;4, 12/10, 103/100, 275, 0, 0, 0, 0, 0&amp;#93;&lt;/span&gt;&lt;br/&gt;
SSTables in each level: &lt;span class=&quot;error&quot;&gt;&amp;#91;2, 13/10, 106/100, 273, 0, 0, 0, 0, 0&amp;#93;&lt;/span&gt;&lt;br/&gt;
SSTables in each level: &lt;span class=&quot;error&quot;&gt;&amp;#91;3, 10, 104/100, 275, 0, 0, 0, 0, 0&amp;#93;&lt;/span&gt;&lt;br/&gt;
SSTables in each level: &lt;span class=&quot;error&quot;&gt;&amp;#91;6/4, 11/10, 103/100, 269, 0, 0, 0, 0, 0&amp;#93;&lt;/span&gt;&lt;br/&gt;
SSTables in each level: &lt;span class=&quot;error&quot;&gt;&amp;#91;4, 16/10, 105/100, 264, 0, 0, 0, 0, 0&amp;#93;&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;More information about the use case: writes are roughly uniform across these tables. The data is &quot;sharded&quot; across these 8 tables by key to improve compaction parallelism. Each node receives up to 75,000 writes/sec sustained at peak, and a small number of reads. This is a pre-production cluster that&apos;s being warmed up with new data, so the low volume of reads (~100/sec per node) is just from automatic sampled data checks, otherwise we&apos;d just use STCS &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</description>
                <environment>&lt;p&gt;Hardware is recent 2-socket, 16-core (x2 Hyperthreaded), 144G RAM, solid-state storage.&lt;br/&gt;
Platform is Linux 3.2.51, Oracle JDK 64-bit 1.7.0_65.&lt;br/&gt;
Heap is 32G total, 4G newsize.&lt;br/&gt;
8G/8G on-heap/off-heap memtables, offheap_buffer allocator, 0.5 memtable_cleanup_threshold&lt;br/&gt;
concurrent_compactors: 20&lt;/p&gt;</environment>
        <key id="12761143">CASSANDRA-8463</key>
            <summary>Constant compaction under LCS</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10002" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Normal</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="marcuse">Marcus Eriksson</assignee>
                                    <reporter username="rbranson">Rick Branson</reporter>
                        <labels>
                            <label>lcs</label>
                    </labels>
                <created>Thu, 11 Dec 2014 19:22:16 +0000</created>
                <updated>Tue, 16 Apr 2019 09:31:26 +0000</updated>
                            <resolved>Thu, 18 Dec 2014 06:36:03 +0000</resolved>
                                        <fixVersion>2.1.3</fixVersion>
                                    <component>Local/Compaction</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="14243740" author="krummas" created="Fri, 12 Dec 2014 05:36:22 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rbranson&quot; class=&quot;user-hover&quot; rel=&quot;rbranson&quot;&gt;rbranson&lt;/a&gt; could you attach logs for the upgraded node?&lt;/p&gt;</comment>
                            <comment id="14246383" author="krummas" created="Mon, 15 Dec 2014 07:00:41 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rbranson&quot; class=&quot;user-hover&quot; rel=&quot;rbranson&quot;&gt;rbranson&lt;/a&gt; could you try running with this patch for a while and posting the logs?&lt;/p&gt;

&lt;p&gt;It improves compaction logging (ie, what level we take sstables from and where they end up)&lt;/p&gt;</comment>
                            <comment id="14246905" author="rbranson" created="Mon, 15 Dec 2014 17:52:17 +0000"  >&lt;p&gt;It looks like this is just a regression with 2.1, not just an issue upgrading from 2.0 to 2.1. I emptied a node&apos;s SSTables and after ~12 hours it was back into the backlogged compaction state. I tried pushing the memtable size up very high, to where it was flushing ~100MB SSTables. This allowed the backlog to clear while there was only L0-L2 tables, but as soon as L3 tables appeared, it began to constantly compact again. After examining diffs between the 2.0 and 2.1 code, I also tried setting the tombstone compaction threshold to 1.0 to no avail. I&apos;ll see if I can get you some better logs with that patch, Marcus.&lt;/p&gt;</comment>
                            <comment id="14247061" author="rbranson" created="Mon, 15 Dec 2014 19:11:29 +0000"  >&lt;p&gt;Writes had to be turned off to this cluster to avoid some errors we began to see. I started to see some SSTables appear in L0 w/o any flush activity. Could this be a clue?&lt;/p&gt;</comment>
                            <comment id="14247099" author="krummas" created="Mon, 15 Dec 2014 19:33:44 +0000"  >&lt;p&gt;Yeah, maybe, in 2.1 we check if we would cause overlap before adding an sstable in a higher level, if not, we send it back to L0. In 2.0 we would just add it.&lt;/p&gt;

&lt;p&gt;The logging patch should tell us if that is the case&lt;/p&gt;</comment>
                            <comment id="14247293" author="rbranson" created="Mon, 15 Dec 2014 21:59:55 +0000"  >&lt;p&gt;I applied the logging patch on one node and quickly noticed a suspect compaction. This contains 130 sstables from L3 and only 1 from L2.&lt;/p&gt;

&lt;p&gt;2014-12-15_21:50:10.24752 INFO  21:50:10 Compacting (5750bed0-84a4-11e4-8177-4571ae47521c) &lt;span class=&quot;error&quot;&gt;&amp;#91;SSTableReader(path=/data/cassandra/data/ks1/DataByUserID_005/ks1-DataByUserID_005-ka-35274-Data.db, level=3), SSTableReader(path=/data/cassandra/data/ks1/DataByUserID_005/ks1-DataByUserID_005-ka-35305-Data.db, level=3), SSTableReader(path=/data/cassandra/data/ks1/DataByUserID_005/ks1-DataByUserID_005-ka-35330-Data.db, level=3), SSTableReader(path=/data/cassandra/data/ks1/DataByUserID_005/ks1-DataByUserID_005-ka-35409-Data.db, level=3), SSTableReader(path=/data/cassandra/data/ks1/DataByUserID_005/ks1-DataByUserID_005-ka-35512-Data.db, level=3), SSTableReader(path=/data/cassandra/data/ks1/DataByUserID_005/ks1-DataByUserID_005-ka-35286-Data.db, level=3), SSTableReader(path=/data/cassandra/data/ks1/DataByUserID_005/ks1-DataByUserID_005-ka-35323-Data.db, level=3), SSTableReader(path=/data/cassandra/data/ks1/DataByUserID_005/ks1-DataByUserID_005-ka-35366-Data.db, level=3), SSTableReader(path=/data/cassandra/data/ks1/DataByUserID_005/ks1-DataByUserID_005-ka-35407-Data.db, level=3), SSTableReader(path=/data/cassandra/data/ks1/DataByUserID_005/ks1-DataByUserID_005-ka-35558-Data.db, level=3), SSTableReader(path=/data/cassandra/data/ks1/DataByUserID_005/ks1-DataByUserID_005-ka-35206-Data.db, level=3), SSTableReader(path=/data/cassandra/data/ks1/DataByUserID_005/ks1-DataByUserID_005-ka-35570-Data.db, level=3), SSTableReader(path=/data/cassandra/data/ks1/DataByUserID_005/ks1-DataByUserID_005-ka-35247-Data.db, level=3), SSTableReader(path=/data/cassandra/data/ks1/DataByUserID_005/ks1-DataByUserID_005-ka-35361-Data.db, level=3), SSTableReader(path=/data/cassandra/data/ks1/DataByUserID_005/ks1-DataByUserID_005-ka-35335-Data.db, level=3), SSTableReader(path=/data/cassandra/data/ks1/DataByUserID_005/ks1-DataByUserID_005-ka-35261-Data.db, level=3), SSTableReader(path=/data/cassandra/data/ks1/DataByUserID_005/ks1-DataByUserID_005-ka-35588-Data.db, level=3), SSTableReader(path=/data/cassandra/data/ks1/DataByUserID_005/ks1-DataByUserID_005-ka-35368-Data.db, level=3), SSTableReader(path=/data/cassandra/data/ks1/DataByUserID_005/ks1-DataByUserID_005-ka-35545-Data.db, level=3), SSTableReader(path=/data/cassandra/data/ks1/DataByUserID_005/ks1-DataByUserID_005-ka-35311-Data.db, level=3), SSTableReader(path=/data/cassandra/data/ks1/DataByUserID_005/ks1-DataByUserID_005-ka-35231-Data.db, level=3), SSTableReader(path=/data/cassandra/data/ks1/DataByUserID_005/ks1-DataByUserID_005-ka-35416-Data.db, level=3), SSTableReader(path=/data/cassandra/data/ks1/DataByUserID_005/ks1-DataByUserID_005-ka-35567-Data.db, level=3), SSTableReader(path=/data/cassandra/data/ks1/DataByUserID_005/ks1-DataByUserID_005-ka-35265-Data.db, level=3), SSTableReader(path=/data/cassandra/data/ks1/DataByUserID_005/ks1-DataByUserID_005-ka-35500-Data.db, level=3), SSTableReader(path=/data/cassandra/data/ks1/DataByUserID_005/ks1-DataByUserID_005-ka-35516-Data.db, level=3), SSTableReader(path=/data/cassandra/data/ks1/DataByUserID_005/ks1-DataByUserID_005-ka-35304-Data.db, level=3), SSTableReader(path=/data/cassandra/data/ks1/DataByUserID_005/ks1-DataByUserID_005-ka-35358-Data.db, level=3), SSTableReader(path=/data/cassandra/data/ks1/DataByUserID_005/ks1-DataByUserID_005-ka-35256-Data.db, level=3), SSTableReader(path=/data/cassandra/data/ks1/DataByUserID_005/ks1-DataByUserID_005-ka-35550-Data.db, level=3), SSTableReader(path=/data/cassandra/data/ks1/DataByUserID_005/ks1-DataByUserID_005-ka-35393-Data.db, level=3), SSTableReader(path=/data/cassandra/data/ks1/DataByUserID_005/ks1-DataByUserID_005-ka-35533-Data.db, level=3), SSTableReader(path=/data/cassandra/data/ks1/DataByUserID_005/ks1-DataByUserID_005-ka-35494-Data.db, level=3), SSTableReader(path=/data/cassandra/data/ks1/DataByUserID_005/ks1-DataByUserID_005-ka-35538-Data.db, level=3), SSTableReader(path=/data/cassandra/data/ks1/DataByUserID_005/ks1-DataByUserID_005-ka-35239-Data.db, level=3), SSTableReader(path=/data/cassandra/data/ks1/DataByUserID_005/ks1-DataByUserID_005-ka-35544-Data.db, level=3), SSTableReader(path=/data/cassandra/data/ks1/DataByUserID_005/ks1-DataByUserID_005-ka-35401-Data.db, level=3), SSTableReader(path=/data/cassandra/data/ks1/DataByUserID_005/ks1-DataByUserID_005-ka-35502-Data.db, level=3), SSTableReader(path=/data/cassandra/data/ks1/DataByUserID_005/ks1-DataByUserID_005-ka-35495-Data.db, level=3), SSTableReader(path=/data/cassandra/data/ks1/DataByUserID_005/ks1-DataByUserID_005-ka-35553-Data.db, level=3), SSTableReader(path=/data/cassandra/data/ks1/DataByUserID_005/ks1-DataByUserID_005-ka-35427-Data.db, level=3), SSTableReader(path=/data/cassandra/data/ks1/DataByUserID_005/ks1-DataByUserID_005-ka-35503-Data.db, level=3), SSTableReader(path=/data/cassandra/data/ks1/DataByUserID_005/ks1-DataByUserID_005-ka-35559-Data.db, level=3), SSTableReader(path=/data/cassandra/data/ks1/DataByUserID_005/ks1-DataByUserID_005-ka-35515-Data.db, level=3), SSTableReader(path=/data/cassandra/data/ks1/DataByUserID_005/ks1-DataByUserID_005-ka-35536-Data.db, level=3), SSTableReader(path=/data/cassandra/data/ks1/DataByUserID_005/ks1-DataByUserID_005-ka-35340-Data.db, level=3), SSTableReader(path=/data/cassandra/data/ks1/DataByUserID_005/ks1-DataByUserID_005-ka-35546-Data.db, level=3), SSTableReader(path=/data/cassandra/data/ks1/DataByUserID_005/ks1-DataByUserID_005-ka-35343-Data.db, level=3), SSTableReader(path=/data/cassandra/data/ks1/DataByUserID_005/ks1-DataByUserID_005-ka-35519-Data.db, level=3), SSTableReader(path=/data/cassandra/data/ks1/DataByUserID_005/ks1-DataByUserID_005-ka-35517-Data.db, level=3), SSTableReader(path=/data/cassandra/data/ks1/DataByUserID_005/ks1-DataByUserID_005-ka-35214-Data.db, level=3), SSTableReader(path=/data/cassandra/data/ks1/DataByUserID_005/ks1-DataByUserID_005-ka-35489-Data.db, level=3), SSTableReader(path=/data/cassandra/data/ks1/DataByUserID_005/ks1-DataByUserID_005-ka-35367-Data.db, level=3), SSTableReader(path=/data/cassandra/data/ks1/DataByUserID_005/ks1-DataByUserID_005-ka-35376-Data.db, level=3), SSTableReader(path=/data/cassandra/data/ks1/DataByUserID_005/ks1-DataByUserID_005-ka-35350-Data.db, level=3), SSTableReader(path=/data/cassandra/data/ks1/DataByUserID_005/ks1-DataByUserID_005-ka-35415-Data.db, level=3), SSTableReader(path=/data/cassandra/data/ks1/DataByUserID_005/ks1-DataByUserID_005-ka-35218-Data.db, level=3), SSTableReader(path=/data/cassandra/data/ks1/DataByUserID_005/ks1-DataByUserID_005-ka-35294-Data.db, level=3), SSTableReader(path=/data/cassandra/data/ks1/DataByUserID_005/ks1-DataByUserID_005-ka-35253-Data.db, level=3), SSTableReader(path=/data/cassandra/data/ks1/DataByUserID_005/ks1-DataByUserID_005-ka-35591-Data.db, level=3), SSTableReader(path=/data/cassandra/data/ks1/DataByUserID_005/ks1-DataByUserID_005-ka-35522-Data.db, level=3), SSTableReader(path=/data/cassandra/data/ks1/DataByUserID_005/ks1-DataByUserID_005-ka-35510-Data.db, level=3), SSTableReader(path=/data/cassandra/data/ks1/DataByUserID_005/ks1-DataByUserID_005-ka-35508-Data.db, level=3), SSTableReader(path=/data/cassandra/data/ks1/DataByUserID_005/ks1-DataByUserID_005-ka-35339-Data.db, level=3), SSTableReader(path=/data/cassandra/data/ks1/DataByUserID_005/ks1-DataByUserID_005-ka-35524-Data.db, level=3), SSTableReader(path=/data/cassandra/data/ks1/DataByUserID_005/ks1-DataByUserID_005-ka-35359-Data.db, level=3), SSTableReader(path=/data/cassandra/data/ks1/DataByUserID_005/ks1-DataByUserID_005-ka-35384-Data.db, level=3), SSTableReader(path=/data/cassandra/data/ks1/DataByUserID_005/ks1-DataByUserID_005-ka-35487-Data.db, level=3), SSTableReader(path=/data/cassandra/data/ks1/DataByUserID_005/ks1-DataByUserID_005-ka-35579-Data.db, level=3), SSTableReader(path=/data/cassandra/data/ks1/DataByUserID_005/ks1-DataByUserID_005-ka-35551-Data.db, level=3), SSTableReader(path=/data/cassandra/data/ks1/DataByUserID_005/ks1-DataByUserID_005-ka-35400-Data.db, level=3), SSTableReader(path=/data/cassandra/data/ks1/DataByUserID_005/ks1-DataByUserID_005-ka-35342-Data.db, level=3), SSTableReader(path=/data/cassandra/data/ks1/DataByUserID_005/ks1-DataByUserID_005-ka-35488-Data.db, level=3), SSTableReader(path=/data/cassandra/data/ks1/DataByUserID_005/ks1-DataByUserID_005-ka-35392-Data.db, level=3), SSTableReader(path=/data/cassandra/data/ks1/DataByUserID_005/ks1-DataByUserID_005-ka-35486-Data.db, level=3), SSTableReader(path=/data/cassandra/data/ks1/DataByUserID_005/ks1-DataByUserID_005-ka-35291-Data.db, level=3), SSTableReader(path=/data/cassandra/data/ks1/DataByUserID_005/ks1-DataByUserID_005-ka-35314-Data.db, level=3), SSTableReader(path=/data/cassandra/data/ks1/DataByUserID_005/ks1-DataByUserID_005-ka-35391-Data.db, level=3), SSTableReader(path=/data/cassandra/data/ks1/DataByUserID_005/ks1-DataByUserID_005-ka-35526-Data.db, level=3), SSTableReader(path=/data/cassandra/data/ks1/DataByUserID_005/ks1-DataByUserID_005-ka-35573-Data.db, level=3), SSTableReader(path=/data/cassandra/data/ks1/DataByUserID_005/ks1-DataByUserID_005-ka-35572-Data.db, level=3), SSTableReader(path=/data/cassandra/data/ks1/DataByUserID_005/ks1-DataByUserID_005-ka-35418-Data.db, level=3), SSTableReader(path=/data/cassandra/data/ks1/DataByUserID_005/ks1-DataByUserID_005-ka-35245-Data.db, level=3), SSTableReader(path=/data/cassandra/data/ks1/DataByUserID_005/ks1-DataByUserID_005-ka-35317-Data.db, level=3), SSTableReader(path=/data/cassandra/data/ks1/DataByUserID_005/ks1-DataByUserID_005-ka-35531-Data.db, level=3), SSTableReader(path=/data/cassandra/data/ks1/DataByUserID_005/ks1-DataByUserID_005-ka-35585-Data.db, level=3), SSTableReader(path=/data/cassandra/data/ks1/DataByUserID_005/ks1-DataByUserID_005-ka-35377-Data.db, level=3), SSTableReader(path=/data/cassandra/data/ks1/DataByUserID_005/ks1-DataByUserID_005-ka-35493-Data.db, level=3), SSTableReader(path=/data/cassandra/data/ks1/DataByUserID_005/ks1-DataByUserID_005-ka-35351-Data.db, level=3), SSTableReader(path=/data/cassandra/data/ks1/DataByUserID_005/ks1-DataByUserID_005-ka-35270-Data.db, level=3), SSTableReader(path=/data/cassandra/data/ks1/DataByUserID_005/ks1-DataByUserID_005-ka-35560-Data.db, level=3), SSTableReader(path=/data/cassandra/data/ks1/DataByUserID_005/ks1-DataByUserID_005-ka-35543-Data.db, level=3), SSTableReader(path=/data/cassandra/data/ks1/DataByUserID_005/ks1-DataByUserID_005-ka-35523-Data.db, level=3), SSTableReader(path=/data/cassandra/data/ks1/DataByUserID_005/ks1-DataByUserID_005-ka-35226-Data.db, level=3), SSTableReader(path=/data/cassandra/data/ks1/DataByUserID_005/ks1-DataByUserID_005-ka-35352-Data.db, level=3), SSTableReader(path=/data/cassandra/data/ks1/DataByUserID_005/ks1-DataByUserID_005-ka-35324-Data.db, level=3), SSTableReader(path=/data/cassandra/data/ks1/DataByUserID_005/ks1-DataByUserID_005-ka-35333-Data.db, level=3), SSTableReader(path=/data/cassandra/data/ks1/DataByUserID_005/ks1-DataByUserID_005-ka-35282-Data.db, level=3), SSTableReader(path=/data/cassandra/data/ks1/DataByUserID_005/ks1-DataByUserID_005-ka-35326-Data.db, level=3), SSTableReader(path=/data/cassandra/data/ks1/DataByUserID_005/ks1-DataByUserID_005-ka-35578-Data.db, level=3), SSTableReader(path=/data/cassandra/data/ks1/DataByUserID_005/ks1-DataByUserID_005-ka-35540-Data.db, level=3), SSTableReader(path=/data/cassandra/data/ks1/DataByUserID_005/ks1-DataByUserID_005-ka-35496-Data.db, level=3), SSTableReader(path=/data/cassandra/data/ks1/DataByUserID_005/ks1-DataByUserID_005-ka-35385-Data.db, level=3), SSTableReader(path=/data/cassandra/data/ks1/DataByUserID_005/ks1-DataByUserID_005-ka-35584-Data.db, level=3), SSTableReader(path=/data/cassandra/data/ks1/DataByUserID_005/ks1-DataByUserID_005-ka-35506-Data.db, level=3), SSTableReader(path=/data/cassandra/data/ks1/DataByUserID_005/ks1-DataByUserID_005-ka-35331-Data.db, level=3), SSTableReader(path=/data/cassandra/data/ks1/DataByUserID_005/ks1-DataByUserID_005-ka-35423-Data.db, level=3), SSTableReader(path=/data/cassandra/data/ks1/DataByUserID_005/ks1-DataByUserID_005-ka-35408-Data.db, level=3), SSTableReader(path=/data/cassandra/data/ks1/DataByUserID_005/ks1-DataByUserID_005-ka-35235-Data.db, level=3), SSTableReader(path=/data/cassandra/data/ks1/DataByUserID_005/ks1-DataByUserID_005-ka-35425-Data.db, level=3), SSTableReader(path=/data/cassandra/data/ks1/DataByUserID_005/ks1-DataByUserID_005-ka-35537-Data.db, level=3), SSTableReader(path=/data/cassandra/data/ks1/DataByUserID_005/ks1-DataByUserID_005-ka-35222-Data.db, level=3), SSTableReader(path=/data/cassandra/data/ks1/DataByUserID_005/ks1-DataByUserID_005-ka-35583-Data.db, level=3), SSTableReader(path=/data/cassandra/data/ks1/DataByUserID_005/ks1-DataByUserID_005-ka-35278-Data.db, level=3), SSTableReader(path=/data/cassandra/data/ks1/DataByUserID_005/ks1-DataByUserID_005-ka-35511-Data.db, level=3), SSTableReader(path=/data/cassandra/data/ks1/DataByUserID_005/ks1-DataByUserID_005-ka-35529-Data.db, level=3), SSTableReader(path=/data/cassandra/data/ks1/DataByUserID_005/ks1-DataByUserID_005-ka-35499-Data.db, level=3), SSTableReader(path=/data/cassandra/data/ks1/DataByUserID_005/ks1-DataByUserID_005-ka-35566-Data.db, level=3), SSTableReader(path=/data/cassandra/data/ks1/DataByUserID_005/ks1-DataByUserID_005-ka-35297-Data.db, level=3), SSTableReader(path=/data/cassandra/data/ks1/DataByUserID_005/ks1-DataByUserID_005-ka-35433-Data.db, level=3), SSTableReader(path=/data/cassandra/data/ks1/DataByUserID_005/ks1-DataByUserID_005-ka-35552-Data.db, level=3), SSTableReader(path=/data/cassandra/data/ks1/DataByUserID_005/ks1-DataByUserID_005-ka-35564-Data.db, level=3), SSTableReader(path=/data/cassandra/data/ks1/DataByUserID_005/ks1-DataByUserID_005-ka-35687-Data.db, level=2), SSTableReader(path=/data/cassandra/data/ks1/DataByUserID_005/ks1-DataByUserID_005-ka-35399-Data.db, level=3), SSTableReader(path=/data/cassandra/data/ks1/DataByUserID_005/ks1-DataByUserID_005-ka-35320-Data.db, level=3), SSTableReader(path=/data/cassandra/data/ks1/DataByUserID_005/ks1-DataByUserID_005-ka-35429-Data.db, level=3), SSTableReader(path=/data/cassandra/data/ks1/DataByUserID_005/ks1-DataByUserID_005-ka-35374-Data.db, level=3), SSTableReader(path=/data/cassandra/data/ks1/DataByUserID_005/ks1-DataByUserID_005-ka-35530-Data.db, level=3), SSTableReader(path=/data/cassandra/data/ks1/DataByUserID_005/ks1-DataByUserID_005-ka-35576-Data.db, level=3), SSTableReader(path=/data/cassandra/data/ks1/DataByUserID_005/ks1-DataByUserID_005-ka-35383-Data.db, level=3), SSTableReader(path=/data/cassandra/data/ks1/DataByUserID_005/ks1-DataByUserID_005-ka-35589-Data.db, level=3), &amp;#93;&lt;/span&gt;&lt;/p&gt;</comment>
                            <comment id="14247337" author="rbranson" created="Mon, 15 Dec 2014 22:23:34 +0000"  >&lt;p&gt;This also seems suspect for creating overlap (single-table L1 compaction output placed into L2??):&lt;/p&gt;

&lt;p&gt;2014-12-15_22:17:28.58953 INFO  22:17:28 Compacting (27d85a60-84a8-11e4-8b9d-79ee1dbb2761) &lt;span class=&quot;error&quot;&gt;&amp;#91;SSTableReader(path=/data/cassandra/data/ks1/DataByUserID_001/ks1-DataByUserID_001-ka-42169-Data.db, level=1), &amp;#93;&lt;/span&gt;&lt;br/&gt;
2014-12-15_22:17:57.84703 INFO  22:17:57 Compacted (27d85a60-84a8-11e4-8b9d-79ee1dbb2761) 1 sstables to &lt;span class=&quot;error&quot;&gt;&amp;#91;/data/cassandra/data/ks1/DataByUserID_001/ks1-DataByUserID_001-ka-42835,&amp;#93;&lt;/span&gt; to level=2.  33,581,350 bytes to 33,581,350 (~100% of original) in 29,256ms = 1.094670MB/s.  80,322 total partitions merged to 80,322.  Partition merge counts were &lt;/p&gt;
{1:80322, }</comment>
                            <comment id="14248085" author="krummas" created="Tue, 16 Dec 2014 10:17:14 +0000"  >&lt;p&gt;Seems we don&apos;t set lastCompactedKeys properly, meaning we always start from the sstable with the smallest key when trying to find compaction candidates. This could explain the weird compaction candidate picking above (the leveling becomes very unbalanced)&lt;/p&gt;

&lt;p&gt;Could you try it out &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rbranson&quot; class=&quot;user-hover&quot; rel=&quot;rbranson&quot;&gt;rbranson&lt;/a&gt;?&lt;/p&gt;</comment>
                            <comment id="14248518" author="rbranson" created="Tue, 16 Dec 2014 17:20:39 +0000"  >&lt;p&gt;I applied that patch to one node. What should I be looking for? Is there any persisted state for that data? Shortly after restarting the daemon it did another one of those single table L1 compactions into L2. After finishing that, it immediately compacted that single new L2 file into 452 L3 tables. That pattern is what&apos;s causing the problem.&lt;/p&gt;</comment>
                            <comment id="14249047" author="rbranson" created="Tue, 16 Dec 2014 22:06:52 +0000"  >&lt;p&gt;It did take some time to rebalance the tables within the levels, but nodes are able to clear their compaction log with the patch applied. +1&lt;/p&gt;</comment>
                            <comment id="14249757" author="krummas" created="Wed, 17 Dec 2014 11:50:21 +0000"  >&lt;p&gt;could you review &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=yukim&quot; class=&quot;user-hover&quot; rel=&quot;yukim&quot;&gt;yukim&lt;/a&gt;? (unless you already checked the code as well &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rbranson&quot; class=&quot;user-hover&quot; rel=&quot;rbranson&quot;&gt;rbranson&lt;/a&gt;?)&lt;/p&gt;</comment>
                            <comment id="14251110" author="rbranson" created="Thu, 18 Dec 2014 03:26:30 +0000"  >&lt;p&gt;Code LGTM.&lt;/p&gt;</comment>
                            <comment id="14251288" author="krummas" created="Thu, 18 Dec 2014 06:36:04 +0000"  >&lt;p&gt;Great, thanks!&lt;/p&gt;

&lt;p&gt;Committed&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12687188" name="0001-better-logging.patch" size="4428" author="marcuse" created="Mon, 15 Dec 2014 07:00:41 +0000"/>
                            <attachment id="12687469" name="0001-make-sure-we-set-lastCompactedKey-properly.patch" size="5251" author="marcuse" created="Tue, 16 Dec 2014 10:17:14 +0000"/>
                            <attachment id="12686894" name="log-for-8463.txt" size="485116" author="rbranson" created="Fri, 12 Dec 2014 17:56:16 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[marcuse]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 48 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i23bxz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12311421" key="com.atlassian.jira.plugin.system.customfieldtypes:multiversion">
                        <customfieldname>Reproduced In</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="12328841">2.1.2</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>rbranson</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[rbranson]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12962"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>