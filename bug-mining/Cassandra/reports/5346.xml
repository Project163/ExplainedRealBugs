<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 23:15:28 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-14772] Fix issues in audit / full query log interactions</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-14772</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;There are some problems with the audit + full query log code that need to be resolved before 4.0 is released:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;Fix performance regression in FQL that makes it less usable than it should be.&lt;/li&gt;
	&lt;li&gt;move full query log specific code to a separate package&lt;/li&gt;
	&lt;li&gt;do some audit log class renames (I keep reading &lt;tt&gt;BinLogAuditLogger&lt;/tt&gt; vs &lt;tt&gt;BinAuditLogger&lt;/tt&gt; wrong for example)&lt;/li&gt;
	&lt;li&gt;avoid parsing the CQL queries twice in &lt;tt&gt;QueryMessage&lt;/tt&gt; when audit log is enabled.&lt;/li&gt;
	&lt;li&gt;add a new tool to dump audit logs (ie, let fqltool be full query log specific). fqltool crashes when pointed to them.&lt;/li&gt;
&lt;/ul&gt;
</description>
                <environment></environment>
        <key id="13186565">CASSANDRA-14772</key>
            <summary>Fix issues in audit / full query log interactions</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10002" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Normal</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="marcuse">Marcus Eriksson</assignee>
                                    <reporter username="marcuse">Marcus Eriksson</reporter>
                        <labels>
                    </labels>
                <created>Fri, 21 Sep 2018 08:26:34 +0000</created>
                <updated>Wed, 15 Oct 2025 09:48:59 +0000</updated>
                            <resolved>Thu, 16 Apr 2020 12:21:31 +0000</resolved>
                                        <fixVersion>4.0-beta1</fixVersion>
                    <fixVersion>4.0</fixVersion>
                                    <component>Legacy/CQL</component>
                    <component>Legacy/Tools</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>13</watches>
                                                                                                                <comments>
                            <comment id="16623614" author="eperott" created="Fri, 21 Sep 2018 13:23:35 +0000"  >&lt;blockquote&gt;&lt;p&gt;add a new tool to dump audit logs (ie, let fqltool be full query log specific)&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;ATM fqltool isn&apos;t compatible with BinLog audit logs:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;$ ./tools/bin/fqltool dump ~/.ccm/trunk/node1/audit/
error: null
-- StackTrace --
java.lang.NullPointerException
	at io.netty.buffer.Unpooled.wrappedBuffer(Unpooled.java:155)
	at org.apache.cassandra.fqltool.commands.Dump.lambda$dump$0(Dump.java:96)
	at net.openhft.chronicle.queue.impl.single.SingleChronicleQueueExcerpts$StoreTailer.readDocument(SingleChronicleQueueExcerpts.java:1099)
	at org.apache.cassandra.fqltool.commands.Dump.dump(Dump.java:137)
	at org.apache.cassandra.fqltool.commands.Dump.run(Dump.java:66)
	at org.apache.cassandra.fqltool.FullQueryLogTool.main(FullQueryLogTool.java:65)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Seem to be broken since &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-14675&quot; title=&quot;Log the actual (if server-generated) timestamp and nowInSeconds used by queries in FQL&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-14675&quot;&gt;&lt;del&gt;CASSANDRA-14675&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;Not sure if I should create a separate ticket for this, or if we resolve it within the scope of this ticket.&lt;/p&gt;</comment>
                            <comment id="16623624" author="krummas" created="Fri, 21 Sep 2018 13:34:17 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=eperott&quot; class=&quot;user-hover&quot; rel=&quot;eperott&quot;&gt;eperott&lt;/a&gt; yeah I was planning on fixing it here&lt;/p&gt;</comment>
                            <comment id="16623766" author="iamaleksey" created="Fri, 21 Sep 2018 15:22:07 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=eperott&quot; class=&quot;user-hover&quot; rel=&quot;eperott&quot;&gt;eperott&lt;/a&gt; Yeah. It was very odd to find audit-log print-out code hidden in an if-else branch of a tool called &lt;tt&gt;fqltool dump&lt;/tt&gt;, so I removed it - with an expectation that the missing functionality would be added &lt;b&gt;properly&lt;/b&gt; at some point later. A bit surprised it&apos;s throwing an NPE though - I think it&apos;s supposed to throw an &lt;tt&gt;UnsupportedOperationException&lt;/tt&gt; there, but it looks like Marcus is on it here.&lt;/p&gt;</comment>
                            <comment id="16625857" author="jmckenzie" created="Mon, 24 Sep 2018 14:02:20 +0000"  >&lt;p&gt;I wouldn&apos;t consider a refactor to be a bug-fix. While there&apos;s a small minority of this ticket that&apos;s defect-related, I think committing a refactor post-freeze date for 4.0 is not good hygiene.&lt;/p&gt;

&lt;p&gt;Am I missing something here?&lt;/p&gt;</comment>
                            <comment id="16625865" author="krummas" created="Mon, 24 Sep 2018 14:06:36 +0000"  >&lt;p&gt;the bug part would be that fqltool dump throws npe, but not critical I guess, I&apos;ll mark it 4.0.x&lt;/p&gt;</comment>
                            <comment id="16625885" author="iamaleksey" created="Mon, 24 Sep 2018 14:20:08 +0000"  >&lt;p&gt;It&apos;s a follow-up to a feature introduced in an unreleased version (4.0). There are some issues with it that need to be addressed, including a performance regression in FQL that makes it less usable than it should be.&lt;/p&gt;

&lt;p&gt;So 4.0 is a fitting fixver for at least part of this JIRA, yes. Additionally, the API will be harder to change post-stable 4.0, but arguably it needs to. So again, 4.0 is the correct fixver here.&lt;/p&gt;</comment>
                            <comment id="16625898" author="jmckenzie" created="Mon, 24 Sep 2018 14:31:19 +0000"  >&lt;p&gt;Having not looked at the code, is there value in moving the API&#160;changes and defect fixes to their own ticket targeting 4.0 and doing the other parts 4.0.x (black box refactors, etc)?&lt;/p&gt;

&lt;p&gt;I&apos;m mostly coming at this from a &quot;broken windows theory&quot; angle of us having discipline w/the concept of a code-freeze. Don&apos;t want us to get into the habit of sneaking things in past the date, which then further risks destabilizing the testing period.&lt;/p&gt;</comment>
                            <comment id="16625911" author="JIRAUSER308715" created="Mon, 24 Sep 2018 14:39:53 +0000"  >&lt;p&gt;If this is not a refactor ticket, but a fix problems ticket, then the title and description should state that. I have updated them with my understanding. Feel free to update them further with all the issues to be fixed here that make this ticket needed for 4.0 while we are in a code freeze.&lt;/p&gt;</comment>
                            <comment id="16625918" author="iamaleksey" created="Mon, 24 Sep 2018 14:44:06 +0000"  >&lt;p&gt;This is too narrow of an interpretation of a freeze.&lt;/p&gt;

&lt;p&gt;What can&apos;t and shouldn&apos;t go in is new features (that are not testing related).&lt;/p&gt;

&lt;p&gt;Sometimes you will have issues with code that made it in before the freeze that needs to be addressed, and doing a full-on revert is too drastic a response.&lt;/p&gt;

&lt;p&gt;Sometimes you&apos;ll have small features that are required strictly for testing purposes - think logging extra information in FQL to enable replay testing, or returning extra metadata from the server to enable cluster fuzz testing and validation.&lt;/p&gt;

&lt;p&gt;Certain cleanup and maintenance also easily falls under stabilisation umbrella.&lt;/p&gt;

&lt;p&gt;Again, you have to be reasonable about it and exercise judgement on case-by-case basis.&lt;/p&gt;</comment>
                            <comment id="16626158" author="jmckenzie" created="Mon, 24 Sep 2018 17:35:45 +0000"  >&lt;p&gt;Opinion presented as fact ftw. &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;There are a variety of ways to interpret &quot;freeze&quot;, and we could (and probably should) take that debate/discussion to the ML.&lt;/p&gt;

&lt;p&gt;What I will say here: refactoring code almost always introduces new&#160;defects while fixing old ones; this is a lesson we should all know all too well on this project.&lt;/p&gt;</comment>
                            <comment id="16626226" author="djoshi3" created="Mon, 24 Sep 2018 18:32:09 +0000"  >&lt;blockquote&gt;&lt;p&gt;What I will say here: refactoring code almost always introduces new&#160;defects while fixing old ones; this is a lesson we should all know all too well on this project.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;By that logic, we should not change any code &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/wink.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&#160;Exercising caution and good judgment in refactors is important. I think all the bullets that &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=krummas&quot; class=&quot;user-hover&quot; rel=&quot;krummas&quot;&gt;krummas&lt;/a&gt; listed seem to be reasonable. See specifics below.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;Fix performance regression in FQL that makes it less usable than it should be.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Bug&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;move full query log specific code to a separate package&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Low risk change&lt;br/&gt;
 &#160;&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;do some audit log class renames (I keep reading &lt;tt&gt;BinLogAuditLogger&lt;/tt&gt; vs &lt;tt&gt;BinAuditLogger&lt;/tt&gt; wrong for example)&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Low risk change&lt;br/&gt;
 &#160;&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;avoid parsing the CQL queries twice in &lt;tt&gt;QueryMessage&lt;/tt&gt; when audit log is enabled.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Bug&lt;br/&gt;
 &#160;&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;add a new tool to dump audit logs (ie, let fqltool be full query log specific). fqltool crashes when pointed to them.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;This is avoiding changes to a public API (I consider tools as Public API) in the next release. From a user&apos;s standpoint it&apos;s a good thing to have.&lt;/p&gt;</comment>
                            <comment id="16626283" author="benedict" created="Mon, 24 Sep 2018 19:05:07 +0000"  >&lt;blockquote&gt;&lt;p&gt;Opinion presented as fact ftw.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I&apos;ve looked up &lt;a href=&quot;https://lists.apache.org/thread.html/61f29a67b4570dac87047f64b846c6f83e8bcb39b6b67143c9a485c2@%3Cdev.cassandra.apache.org%3E&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;the original discussion thread&lt;/a&gt;, and the predominant phrasing was &quot;feature freeze&quot; which seems fairly reasonable to interpret &lt;em&gt;factually&lt;/em&gt; as a freeze on features, not simply as an opinion.&lt;/p&gt;</comment>
                            <comment id="16626309" author="jrwest" created="Mon, 24 Sep 2018 19:21:58 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=JoshuaMcKenzie&quot; class=&quot;user-hover&quot; rel=&quot;JoshuaMcKenzie&quot;&gt;JoshuaMcKenzie&lt;/a&gt; I appreciate you ensuring we keep to the freeze. I agree that once we start sneaking things past we open pandora&#8217;s box and make the freeze much less valuable.&#160;My understanding is&#160;that we agreed to address exceptions on a case-by-case basis, which we seem to be doing. We don&#8217;t have a formal process for doing so but a good litmus test imo is will the change&#160;improve the stability (where stability means performance and correctness) of Cassandra 4.0 and at what cost/risk does that improvement come with. I had more written on using that test here but I think folks have already summarized how this change improves stability with low risk &#8212; in particular if the refactors are fully automated by a tested tool like IntelliJ.&lt;/p&gt;</comment>
                            <comment id="16626318" author="jmckenzie" created="Mon, 24 Sep 2018 19:29:20 +0000"  >&lt;blockquote&gt;&lt;p&gt;I&apos;ve looked up&#160;&lt;a href=&quot;https://lists.apache.org/thread.html/61f29a67b4570dac87047f64b846c6f83e8bcb39b6b67143c9a485c2@%3Cdev.cassandra.apache.org%3E&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;the original discussion thread&lt;/a&gt;,&#160;and the predominant phrasing was &quot;feature freeze&quot;&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Ah hah - there&apos;s our disconnect. I&#160;incorrectly recalled us discussing it as a &lt;b&gt;code freeze&lt;/b&gt;, not a &lt;b&gt;feature freeze&lt;/b&gt;.&lt;br/&gt;
 Two very different things. Refactor away to your heart&apos;s content, I won&apos;t&#160;fight it. &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;And fwiw - I&apos;m in no way advocating for us to never refactor code; just take a look at the CommitLogReader during the CDC impl time frame. I&apos;m against refactors post &lt;b&gt;code freeze&lt;/b&gt;, which is irrelevant given the earlier misunderstanding.&lt;/p&gt;

&lt;p&gt;Carry on, sorry for the unnecessary traffic.&lt;/p&gt;</comment>
                            <comment id="16626327" author="benedict" created="Mon, 24 Sep 2018 19:39:56 +0000"  >&lt;p&gt;Also, FWIW, I&apos;m completely in favour of clarifying further for future releases; perhaps having stricter, well defined stages of freeze, culminating in a total code freeze.  If we had this, there probably wouldn&apos;t have been this confusion (and I think there&apos;s been a lot of that)&lt;/p&gt;

&lt;p&gt;This release cycle is a bit of an experiment IMO, and we should definitely iterate on it for next time.  Let&apos;s collect our observations and opinions for how we can improve it, and revisit as a community once we have a complete picture.&lt;/p&gt;</comment>
                            <comment id="16809152" author="eperott" created="Wed, 3 Apr 2019 19:42:44 +0000"  >&lt;p&gt;I&apos;d like to add one improvement to the original list in this ticket.&lt;/p&gt;

&lt;p&gt;Currently the FQL have a record header which indicate &lt;tt&gt;version&lt;/tt&gt; and &lt;tt&gt;type&lt;/tt&gt; of record. The record header for audit logs only a &lt;tt&gt;type&lt;/tt&gt;. Would it make sense to add a &lt;tt&gt;version&lt;/tt&gt; field to the audit&#160;records as well&#160;so&#160;that the format can evolve without breaking the tools.&lt;/p&gt;

&lt;p&gt;This would also make it possible for the &lt;tt&gt;auditlogviewer&lt;/tt&gt; and the &lt;tt&gt;fqltool&lt;/tt&gt; commands to give more descriptive error messages if the wrong tool is used.&lt;/p&gt;</comment>
                            <comment id="16809284" author="vinaykumarcse" created="Wed, 3 Apr 2019 21:26:40 +0000"  >&lt;p&gt;Sounds reasonable to me &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=eperott&quot; class=&quot;user-hover&quot; rel=&quot;eperott&quot;&gt;eperott&lt;/a&gt;,&#160;please open a separate Jira, so that we can discuss more on this idea and&#160;take it forward.&#160;&lt;/p&gt;</comment>
                            <comment id="16809552" author="krummas" created="Thu, 4 Apr 2019 06:31:56 +0000"  >&lt;p&gt;yep, sounds good, but this ticket is just for restructuring the code, not changing the formats, so, as &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=vinaykumarcse&quot; class=&quot;user-hover&quot; rel=&quot;vinaykumarcse&quot;&gt;vinaykumarcse&lt;/a&gt; says, a separate JIRA would be good&lt;/p&gt;</comment>
                            <comment id="16809574" author="eperott" created="Thu, 4 Apr 2019 07:01:17 +0000"  >&lt;p&gt;Created &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-15076&quot; title=&quot;Align record header of FQL and audit binary log&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-15076&quot;&gt;&lt;del&gt;CASSANDRA-15076&lt;/del&gt;&lt;/a&gt; to discuss record header format.&lt;/p&gt;</comment>
                            <comment id="16860692" author="krummas" created="Tue, 11 Jun 2019 08:57:45 +0000"  >&lt;p&gt;Patch &lt;a href=&quot;https://github.com/apache/cassandra/compare/trunk...krummas:marcuse/14772?expand=1&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;here&lt;/a&gt; and tests running &lt;a href=&quot;https://circleci.com/gh/krummas/workflows/cassandra/tree/marcuse%2F14772&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;here&lt;/a&gt;&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;Separates full query logging and audit logging - fql and audit logging now have no dependencies on each other, but both use &lt;tt&gt;BinLog&lt;/tt&gt; to write log events to disk&lt;/li&gt;
	&lt;li&gt;Introduces &lt;tt&gt;QueryEvents&lt;/tt&gt; + &lt;tt&gt;AuthEvents&lt;/tt&gt; where it is possible to register listeners for these events&lt;/li&gt;
	&lt;li&gt;&lt;tt&gt;AuditLogManager&lt;/tt&gt; and &lt;tt&gt;FullQueryLogger&lt;/tt&gt; are now getting log events using these listeners&lt;/li&gt;
	&lt;li&gt;Introduces a small change in the &lt;tt&gt;QueryHandler&lt;/tt&gt; interface - the &lt;tt&gt;process&lt;/tt&gt; method now takes a parsed &lt;tt&gt;CQLStatement&lt;/tt&gt; - this was done to avoid re-parsing the statement when logging and a &lt;tt&gt;parse&lt;/tt&gt; method was added to create this &lt;tt&gt;CQLStatement&lt;/tt&gt;&lt;/li&gt;
	&lt;li&gt;Move the &lt;tt&gt;enableFullQueryLogger&lt;/tt&gt; etc methods from &lt;tt&gt;StorageProxy&lt;/tt&gt; to &lt;tt&gt;StorageService&lt;/tt&gt;&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="16865091" author="eperott" created="Sun, 16 Jun 2019 17:32:53 +0000"  >&lt;p&gt;Had a look at your patch&#160;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=krummas&quot; class=&quot;user-hover&quot; rel=&quot;krummas&quot;&gt;krummas&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;Overall it looks good to me. In particular I like the way things are more decoupled with the &lt;tt&gt;QueryEvents&lt;/tt&gt;/&lt;tt&gt;AuthEvents&lt;/tt&gt;. One thing though, that feels a little bit more complicated than necessary is the enable/disable mechanics in &lt;tt&gt;AuditLogManager&lt;/tt&gt;. There is:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;the &lt;tt&gt;enabled&lt;/tt&gt; flag&lt;/li&gt;
	&lt;li&gt;the &lt;tt&gt;auditLogger&lt;/tt&gt; which can be a &lt;tt&gt;NoOpAuditLogger&lt;/tt&gt; instance or something else&lt;/li&gt;
	&lt;li&gt;and now also the registerAsListener()/unregisterAsListener()&lt;br/&gt;
Since the listener subscription will make sure that we don&apos;t get calls to log() when audit logs are disabled, it should now be possible to drop the &lt;tt&gt;enable&lt;/tt&gt; flag without performance impact. What do you think?&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;A few minor comments:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;&lt;tt&gt;AuditLogManager&lt;/tt&gt; still has a comment referring to FQL.&lt;/li&gt;
	&lt;li&gt;&lt;tt&gt;AuditLogManager.log(AuditLogEntry)&lt;/tt&gt; has a null-check which I believe is unnecessary now. Same in &lt;tt&gt;AuditLogManager.log(AuditLogEntry, Exception)&lt;/tt&gt;.&lt;/li&gt;
	&lt;li&gt;&lt;tt&gt;AuditLogManager.isAutidLogEnabled&lt;/tt&gt; is still referred to in a comment in the class&lt;/li&gt;
	&lt;li&gt;Rename &lt;tt&gt;QueryEventTest&lt;/tt&gt; to {{QueryEventsTest}&lt;/li&gt;
	&lt;li&gt;Start the DTests on CirlceCI&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="16871397" author="krummas" created="Mon, 24 Jun 2019 15:14:20 +0000"  >&lt;p&gt;thanks for having a look &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=eperott&quot; class=&quot;user-hover&quot; rel=&quot;eperott&quot;&gt;eperott&lt;/a&gt;, pushed up fixes to your comments&lt;/p&gt;

&lt;p&gt;and tests have run here: &lt;a href=&quot;https://circleci.com/workflow-run/58e385bb-0298-4136-b58c-3dd83643e774&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://circleci.com/workflow-run/58e385bb-0298-4136-b58c-3dd83643e774&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16873990" author="eperott" created="Thu, 27 Jun 2019 10:27:28 +0000"  >&lt;p&gt;+1&lt;/p&gt;

&lt;p&gt;I&apos;m not able to reproduce the failing dtest locally.&lt;/p&gt;</comment>
                            <comment id="16921337" author="iamaleksey" created="Tue, 3 Sep 2019 11:03:32 +0000"  >&lt;p&gt;Good stuff.&lt;/p&gt;

&lt;p&gt;1. Would prefer if &lt;tt&gt;QueryEvents#startTime()&lt;/tt&gt; weren&#8217;t conditional on listeners size; this, coupled with the &lt;tt&gt;time &amp;gt; 0&lt;/tt&gt; check conflates the two concerns (current timestamp and presence of listereners)&lt;br/&gt;
2. Following up on that, would prefer if the &lt;tt&gt;time &amp;gt; 0&lt;/tt&gt; check was gone from &lt;tt&gt;QueryEvents#notify*&lt;/tt&gt; methods; instead, to prevent potential allocation of a capturing lambda with empty listeners, replace &lt;tt&gt;listeners#forEach()&lt;/tt&gt; calls with for-each loops&lt;br/&gt;
3. Minor, but I don&#8217;t see why &lt;tt&gt;getInstance()&lt;/tt&gt; method exists in &lt;tt&gt;QueryEvents&lt;/tt&gt; and &lt;tt&gt;AuthEvents&lt;/tt&gt;. It has no value and goes against our guidelines (prefer public final fields to getter methods) and precedent (public static &lt;tt&gt;INSTANCE&lt;/tt&gt; singletons)&lt;br/&gt;
4. &lt;tt&gt;AuditLogManager#executeFailure()&lt;/tt&gt; - there are to &lt;tt&gt;toString()&lt;/tt&gt; calls for &lt;tt&gt;setOperation()&lt;/tt&gt;; Seem to not be intentional to me?&lt;br/&gt;
5. &lt;tt&gt;IAuditLogger#path()&lt;/tt&gt; method should be removed; nit: rename &lt;tt&gt;enabled()&lt;/tt&gt; to a proper predicate name like &lt;tt&gt;isEnabled()&lt;/tt&gt;?&lt;/p&gt;</comment>
                            <comment id="16977223" author="krummas" created="Tue, 19 Nov 2019 08:01:53 +0000"  >&lt;p&gt;thanks for the review, pushed 2 new commits fixing the comments&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/apache/cassandra/compare/trunk...krummas:marcuse/14772?expand=1&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;branch&lt;/a&gt;&lt;br/&gt;
&lt;a href=&quot;https://circleci.com/workflow-run/08cfe810-4deb-40e1-98a6-0f72c6f224de&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;tests&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17077375" author="iamaleksey" created="Tue, 7 Apr 2020 16:26:08 +0000"  >&lt;p&gt;LGTM now, +1&lt;/p&gt;</comment>
                            <comment id="17084819" author="krummas" created="Thu, 16 Apr 2020 12:21:31 +0000"  >&lt;p&gt;committed, thanks!&lt;/p&gt;

&lt;p&gt;test runs:&lt;br/&gt;
&lt;a href=&quot;https://circleci.com/gh/krummas/cassandra/3204&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;unit tests&lt;/a&gt;&lt;br/&gt;
&lt;a href=&quot;https://circleci.com/gh/krummas/cassandra/3205&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;jvm dtests&lt;/a&gt;&lt;br/&gt;
&lt;a href=&quot;https://circleci.com/gh/krummas/cassandra/3209&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;jvm upgrade dtests&lt;/a&gt;&lt;br/&gt;
&lt;a href=&quot;https://circleci.com/gh/krummas/cassandra/3206&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;dtests vnodes&lt;/a&gt;&lt;br/&gt;
&lt;a href=&quot;https://circleci.com/gh/krummas/cassandra/3207&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;dtests novnodes&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10001">
                    <name>dependent</name>
                                            <outwardlinks description="depends upon">
                                        <issuelink>
            <issuekey id="13197551">CASSANDRA-14885</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[marcuse]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            5 years, 30 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3ycbz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[aleksey]]></customfieldvalue>
        <customfieldvalue><![CDATA[eperott]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12962"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12311420" key="com.atlassian.jira.plugin.system.customfieldtypes:version">
                        <customfieldname>Since Version</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="12346093">4.0-alpha</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12314136" key="com.atlassian.jira.plugin.system.customfieldtypes:version">
                        <customfieldname>Since Version</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="12348281">4.0-alpha1</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313924" key="com.atlassian.jira.plugin.system.customfieldtypes:textfield">
                        <customfieldname>Source Control Link</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>&lt;p&gt;&lt;a href=&quot;https://github.com/apache/cassandra/commit/5242f7d4306f034f32e26834df06ff7fc85a3c16&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/cassandra/commit/5242f7d4306f034f32e26834df06ff7fc85a3c16&lt;/a&gt;&lt;/p&gt;</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313823" key="com.atlassian.jira.plugin.system.customfieldtypes:textarea">
                        <customfieldname>Test and Documentation Plan</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>&lt;p&gt;unit tests + existing dtests&lt;/p&gt;</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>