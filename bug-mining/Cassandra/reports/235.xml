<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 22:12:04 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-609] Easy to OOM on log replay since memtable limits are ignored</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-609</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description></description>
                <environment></environment>
        <key id="12442690">CASSANDRA-609</key>
            <summary>Easy to OOM on log replay since memtable limits are ignored</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10002" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Normal</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="jbellis">Jonathan Ellis</assignee>
                                    <reporter username="jbellis">Jonathan Ellis</reporter>
                        <labels>
                    </labels>
                <created>Tue, 8 Dec 2009 02:09:59 +0000</created>
                <updated>Tue, 16 Apr 2019 09:33:31 +0000</updated>
                            <resolved>Wed, 9 Dec 2009 04:55:59 +0000</resolved>
                                        <fixVersion>0.5</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                                                                <comments>
                            <comment id="12787264" author="jbellis" created="Tue, 8 Dec 2009 02:32:13 +0000"  >&lt;p&gt;respect memtable thresholds when replaying commit log; use normal write path, but add a writeCommitLog flag so we don&apos;t re-write out another CL entry for the replay&lt;/p&gt;</comment>
                            <comment id="12787562" author="jbellis" created="Tue, 8 Dec 2009 16:28:46 +0000"  >&lt;p&gt;To clarify: under low load, you won&apos;t much exceed a single memtable&apos;s worth of inserts since when a memtable flushes it marks the commitlog header as &quot;start replay from here.&quot;  But under high load, you can have a significant amount of inserts done while flushes are queued up in sort + write executors, and this is where you run into trouble on replay.&lt;/p&gt;</comment>
                            <comment id="12787565" author="junrao" created="Tue, 8 Dec 2009 16:35:37 +0000"  >&lt;p&gt;During recovery, we used to rely on CFS.switchMemtable to call onMemtableFlush(ctx) to discard commit log files. With this patch, onMemtableFlush(ctx) won&apos;t be called during recovery. When will the commit log files be deleted?&lt;/p&gt;</comment>
                            <comment id="12787583" author="jbellis" created="Tue, 8 Dec 2009 17:10:57 +0000"  >&lt;p&gt;I was thinking that the final table.flush is a &quot;normal&quot; flush so that should take care of it.  But thinking about it more we do have a corner case of &quot;the last write in the log happened to exactly hit the threshold and triggered a no-discard flush, so the final flush saw a clean memtable and did nothing.&quot;&lt;/p&gt;

&lt;p&gt;Patch 2 (applies on top of first) addresses this.  (Most of the patch is converting CL to a true singleton so replay has access to the normal context operations w/o ugly hacks.)&lt;/p&gt;</comment>
                            <comment id="12787845" author="junrao" created="Wed, 9 Dec 2009 01:13:38 +0000"  >&lt;p&gt;My bad. I got confused about how log files are deleted during recovery. It turns out that all log files are deleted explicitly in RecoveryManager.doRecovery(). The deletion doesn&apos;t rely on the flushing logic. So even v1 of the patch is fine.&lt;/p&gt;</comment>
                            <comment id="12787854" author="jbellis" created="Wed, 9 Dec 2009 01:36:25 +0000"  >&lt;p&gt;I didn&apos;t know that, either.  I think that&apos;s a bug &amp;#8211; if something goes wrong during recovery we definitely shouldn&apos;t be deleting data that hasn&apos;t been replayed.  I&apos;d feel safer taking that out, what do you think?&lt;/p&gt;</comment>
                            <comment id="12787877" author="junrao" created="Wed, 9 Dec 2009 02:15:05 +0000"  >&lt;p&gt;Currently, CL.discardCompletedSegments() doesn&apos;t really discard log files properly during recovery. The problem is that clHeaders_ is never populated during recovery.&lt;/p&gt;

&lt;p&gt;Deleting log files explicitly during recovery may not be that bad. If anything goes wrong during recovery, we will get either an IOException or a RuntimeException. In either case, log files won&apos;t be deleted.&lt;/p&gt;</comment>
                            <comment id="12787915" author="jbellis" created="Wed, 9 Dec 2009 04:47:28 +0000"  >&lt;p&gt;You&apos;re right, because it assumes that when CL is instantiated it&apos;s starting fresh.  I&apos;ll commit patch 1.&lt;/p&gt;</comment>
                            <comment id="12788070" author="hudson" created="Wed, 9 Dec 2009 12:42:41 +0000"  >&lt;p&gt;Integrated in Cassandra #282 (See &lt;a href=&quot;http://hudson.zones.apache.org/hudson/job/Cassandra/282/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://hudson.zones.apache.org/hudson/job/Cassandra/282/&lt;/a&gt;)&lt;br/&gt;
    respect memtable thresholds when replaying commit log&lt;br/&gt;
patch by jbellis; reviewed by Jun Rao for &lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12427350" name="609-2.patch" size="6058" author="jbellis" created="Tue, 8 Dec 2009 17:10:57 +0000"/>
                            <attachment id="12427281" name="609.patch" size="7536" author="jbellis" created="Tue, 8 Dec 2009 02:32:13 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[jbellis]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>19778</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            15 years, 50 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0fzzj:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>91428</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12962"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>