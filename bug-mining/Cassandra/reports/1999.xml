<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 22:36:56 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-5133] Nodes can&apos;t rejoin after stopping, when using GossipingPropertyFileSnitch</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-5133</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;I can establish a 1.2 ring with GossipingPropertyFileSnitch, but after killing a node and restarting it, the node cannot rejoin.&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;Node 1&amp;#93;&lt;/span&gt; ./bin/cassandra -f&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;Node 2&amp;#93;&lt;/span&gt; ./bin/cassandra -f&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;Node 3&amp;#93;&lt;/span&gt; ./bin/cassandra -f&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;Node 1&amp;#93;&lt;/span&gt; ./bin/nodetool ring&lt;br/&gt;
 ... ok ...&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;Node 1&amp;#93;&lt;/span&gt; ^C&lt;br/&gt;
 ... node shutdown ...&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;Node 1&amp;#93;&lt;/span&gt; ./bin/cassandra -f&lt;br/&gt;
 ... Exception! ...&lt;/p&gt;



&lt;p&gt;ERROR 05:45:39,305 Exception encountered during startup&lt;br/&gt;
java.lang.RuntimeException: Could not retrieve DC for /10.114.18.51 from gossip and PFS compatibility is disabled&lt;br/&gt;
  at org.apache.cassandra.locator.GossipingPropertyFileSnitch.getDatacenter(GossipingPropertyFileSnitch.java:109)&lt;br/&gt;
	at org.apache.cassandra.locator.DynamicEndpointSnitch.getDatacenter(DynamicEndpointSnitch.java:127)&lt;br/&gt;
	at org.apache.cassandra.locator.TokenMetadata$Topology.addEndpoint(TokenMetadata.java:1040)&lt;br/&gt;
	at org.apache.cassandra.locator.TokenMetadata.updateNormalTokens(TokenMetadata.java:185)&lt;br/&gt;
	at org.apache.cassandra.locator.TokenMetadata.updateNormalTokens(TokenMetadata.java:157)&lt;br/&gt;
	at org.apache.cassandra.service.StorageService.initServer(StorageService.java:441)&lt;br/&gt;
	at org.apache.cassandra.service.StorageService.initServer(StorageService.java:397)&lt;br/&gt;
	at org.apache.cassandra.service.CassandraDaemon.setup(CassandraDaemon.java:309)&lt;br/&gt;
	at org.apache.cassandra.service.CassandraDaemon.activate(CassandraDaemon.java:397)&lt;br/&gt;
	at org.apache.cassandra.service.CassandraDaemon.main(CassandraDaemon.java:440)&lt;br/&gt;
java.lang.RuntimeException: Could not retrieve DC for /10.114.18.51 from gossip and PFS compatibility is disabled&lt;br/&gt;
	at org.apache.cassandra.locator.GossipingPropertyFileSnitch.getDatacenter(GossipingPropertyFileSnitch.java:109)&lt;br/&gt;
	at org.apache.cassandra.locator.DynamicEndpointSnitch.getDatacenter(DynamicEndpointSnitch.java:127)&lt;br/&gt;
	at org.apache.cassandra.locator.TokenMetadata$Topology.addEndpoint(TokenMetadata.java:1040)&lt;br/&gt;
	at org.apache.cassandra.locator.TokenMetadata.updateNormalTokens(TokenMetadata.java:185)&lt;br/&gt;
	at org.apache.cassandra.locator.TokenMetadata.updateNormalTokens(TokenMetadata.java:157)&lt;br/&gt;
	at org.apache.cassandra.service.StorageService.initServer(StorageService.java:441)&lt;br/&gt;
	at org.apache.cassandra.service.StorageService.initServer(StorageService.java:397)&lt;br/&gt;
	at org.apache.cassandra.service.CassandraDaemon.setup(CassandraDaemon.java:309)&lt;br/&gt;
	at org.apache.cassandra.service.CassandraDaemon.activate(CassandraDaemon.java:397)&lt;br/&gt;
	at org.apache.cassandra.service.CassandraDaemon.main(CassandraDaemon.java:440)&lt;/p&gt;



&lt;p&gt;Full environment + exceptions + stacktraces: &lt;a href=&quot;https://gist.github.com/1e74ff02c2d4f622ce8f&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gist.github.com/1e74ff02c2d4f622ce8f&lt;/a&gt; &lt;/p&gt;</description>
                <environment>&lt;p&gt;3 ec2 instances (CentOS 6.3; java 1.7.0_05; Cassandra 1.2)&lt;/p&gt;</environment>
        <key id="12626666">CASSANDRA-5133</key>
            <summary>Nodes can&apos;t rejoin after stopping, when using GossipingPropertyFileSnitch</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10002" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Normal</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="brandon.williams">Brandon Williams</assignee>
                                    <reporter username="exabytes18">Matt Jurik</reporter>
                        <labels>
                    </labels>
                <created>Tue, 8 Jan 2013 23:10:50 +0000</created>
                <updated>Tue, 16 Apr 2019 09:32:20 +0000</updated>
                            <resolved>Wed, 16 Jan 2013 18:29:33 +0000</resolved>
                                        <fixVersion>1.2.1</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="13547590" author="tscanausa" created="Wed, 9 Jan 2013 03:23:47 +0000"  >&lt;p&gt;While trying to help Matt I can verify, that GossipPropertySnitch does not seem to work as expected.&lt;/p&gt;

&lt;p&gt;Below is a detailed explanation of what happened to me while working to help Matt,&lt;/p&gt;

&lt;p&gt;3 nodes A, B, C.&lt;/p&gt;

&lt;p&gt;setup:&lt;br/&gt;
Node A -&amp;gt; seeds=&quot;node A ip address&quot;&lt;br/&gt;
Node B -&amp;gt; seeds=&quot;node A ip address&quot;&lt;br/&gt;
Node C -&amp;gt; seeds=&quot;node A ip address&quot; &lt;/p&gt;

&lt;p&gt;1) start node A and let it fully start up. ( first node needs to be a seed of itself to start )&lt;br/&gt;
2) start node B and let it fully join the ring.&lt;br/&gt;
3) start node C and let it fully join the ring.&lt;br/&gt;
4) nodetool ring shows all nodes up&lt;br/&gt;
5) stop node C and update the cassandra-rackdc.protperites file to rack=2&lt;br/&gt;
6) start node C ( fails to start error about cant find DC for node A, maybe GossipPropertySnitch wont let a seed node talk about itself? )&lt;br/&gt;
7) stop node A and update seeds=&quot;node B ip address&quot;, to try and solve question above&lt;br/&gt;
8) start node A ( fails to start cant find DC of node C )&lt;br/&gt;
9) stuck not being able to start node A and C&lt;/p&gt;</comment>
                            <comment id="13547602" author="brandon.williams" created="Wed, 9 Jan 2013 03:43:57 +0000"  >&lt;p&gt;Caused by &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-3881&quot; title=&quot;reduce computational complexity of processing topology changes&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-3881&quot;&gt;&lt;del&gt;CASSANDRA-3881&lt;/del&gt;&lt;/a&gt;, since before then we didn&apos;t need to know the dc/rack for saved endpoints at startup.  A workaround is to disable loading the persisted ring via -Dcassandra.load_ring_state=false&lt;/p&gt;</comment>
                            <comment id="13551521" author="exabytes18" created="Fri, 11 Jan 2013 21:06:08 +0000"  >&lt;p&gt;Is there any risk to specifying cassandra.load_ring_state=false? In what version will this be resolved?&lt;/p&gt;</comment>
                            <comment id="13551523" author="brandon.williams" created="Fri, 11 Jan 2013 21:07:36 +0000"  >&lt;p&gt;The main risk is if it is used as a coordinator when it starts up before it discovers the rest of the ring, it will think it owns all writes, even though it doesn&apos;t.&lt;/p&gt;</comment>
                            <comment id="13554289" author="jbellis" created="Tue, 15 Jan 2013 20:29:49 +0000"  >&lt;p&gt;I don&apos;t think I understand the problem &amp;#8211; why can&apos;t we use rack + dc from system.peers?&lt;/p&gt;</comment>
                            <comment id="13554431" author="brandon.williams" created="Tue, 15 Jan 2013 22:07:12 +0000"  >&lt;p&gt;I totally missed that we were already saving that info.  Patch to have GPFS load it, but only use it outside of compat mode, since with compat mode you&apos;ve made a mistake if PFS can&apos;t load it either.&lt;/p&gt;</comment>
                            <comment id="13554569" author="vijay2win@yahoo.com" created="Wed, 16 Jan 2013 00:35:02 +0000"  >&lt;p&gt;+1&lt;/p&gt;</comment>
                            <comment id="13554578" author="brandon.williams" created="Wed, 16 Jan 2013 00:43:58 +0000"  >&lt;p&gt;Committed.&lt;/p&gt;</comment>
                            <comment id="13554688" author="brandon.williams" created="Wed, 16 Jan 2013 03:01:17 +0000"  >&lt;p&gt;Still some kind of race on initial startup:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;ERROR 02:58:45,376 Exception in thread Thread[WRITE-cassandra-1/10.179.65.102,5,main]
java.lang.RuntimeException: Could not retrieve DC for cassandra-1/10.179.65.102 from gossip and PFS compatibility is disabled
        at org.apache.cassandra.locator.GossipingPropertyFileSnitch.getDatacenter(GossipingPropertyFileSnitch.java:80)
        at org.apache.cassandra.locator.DynamicEndpointSnitch.getDatacenter(DynamicEndpointSnitch.java:127)
        at org.apache.cassandra.net.OutboundTcpConnection.isLocalDC(OutboundTcpConnection.java:73)
        at org.apache.cassandra.net.OutboundTcpConnection.connect(OutboundTcpConnection.java:266)
        at org.apache.cassandra.net.OutboundTcpConnection.run(OutboundTcpConnection.java:138)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="13554691" author="brandon.williams" created="Wed, 16 Jan 2013 03:06:45 +0000"  >&lt;p&gt;The problem in this case is cassandra-1 is the seed and when this node starts up it knows about it via being listed in the yaml as seed, but doesn&apos;t have dc info that OTC wants when connecting.&lt;/p&gt;</comment>
                            <comment id="13554696" author="vijay2win@yahoo.com" created="Wed, 16 Jan 2013 03:11:38 +0000"  >&lt;p&gt;How about, instead of throwing an exception use something like EC2Snitch.DEFAULT_DC? &lt;br/&gt;
I think we can live with this instead of doing the system table lookup too.&lt;/p&gt;</comment>
                            <comment id="13555236" author="brandon.williams" created="Wed, 16 Jan 2013 17:26:44 +0000"  >&lt;p&gt;Patch on top of what&apos;s already committed to go the default rack/dc route.  I think it&apos;s better to keep the system table lookup since that&apos;s going to be correct 99% of the time, where the default only needs to be returned in the corner case of contacting a seed the very first time.&lt;/p&gt;</comment>
                            <comment id="13555301" author="vijay2win@yahoo.com" created="Wed, 16 Jan 2013 18:25:16 +0000"  >&lt;p&gt;+1&lt;/p&gt;</comment>
                            <comment id="13555309" author="brandon.williams" created="Wed, 16 Jan 2013 18:29:33 +0000"  >&lt;p&gt;Committed.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12565147" name="5133-2.txt" size="1859" author="brandon.williams" created="Wed, 16 Jan 2013 17:26:44 +0000"/>
                            <attachment id="12565037" name="5133.txt" size="3711" author="brandon.williams" created="Tue, 15 Jan 2013 23:25:23 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[brandon.williams]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>303273</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            12 years, 44 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1792f:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>250437</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>vijay2win@yahoo.com</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[vijay2win@yahoo.com]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12962"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>