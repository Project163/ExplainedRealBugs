<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 23:15:34 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-15694] Statistics upon streaming of entire SSTables in Netstats is wrong</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-15694</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;There is a bug in the current code (trunk on 6th April 2020) as if we are streaming entire SSTables via&#160;CassandraEntireSSTableStreamWriter and&#160;CassandraOutgoingFile respectively, there is not any update on particular components of a SSTable as it counts only &quot;db&quot; file to be there. That introduces this bug:&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
Mode: NORMAL
Rebuild 2c0b43f0-735d-11ea-9346-fb0ffe238736
    /127.0.0.2 Sending 19 files, 27664559 bytes total. Already sent 133 files, 27664559 bytes total
        /tmp/dtests15682026295742741219/node2/data/distributed_test_keyspace/cf-196b3...
        ....
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Basically, number of files to be sent is lower than files sent.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;The straightforward fix here is to distinguish when we are streaming entire sstables and in that case include all manifest files into computation.&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;This issue depends on &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-15657&quot; title=&quot;Improve zero-copy-streaming containment check by using file sections&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-15657&quot;&gt;&lt;del&gt;CASSANDRA-15657&lt;/del&gt;&lt;/a&gt;&#160;because the resolution whether we stream entirely or not is got from a method which is performance sensitive and computed every time. Once&#160;&lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-15657&quot; title=&quot;Improve zero-copy-streaming containment check by using file sections&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-15657&quot;&gt;&lt;del&gt;CASSANDRA-15657&lt;/del&gt;&lt;/a&gt;&#160; (hence&#160;&lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-14586&quot; title=&quot;Performant range containment check for SSTables&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-14586&quot;&gt;&lt;del&gt;CASSANDRA-14586&lt;/del&gt;&lt;/a&gt;) is done, this ticket can be worked on.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;branch with fix is here:&#160;&lt;a href=&quot;https://github.com/smiklosovic/cassandra/tree/CASSANDRA-15694&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/smiklosovic/cassandra/tree/CASSANDRA-15694&lt;/a&gt;&lt;/p&gt;</description>
                <environment></environment>
        <key id="13296438">CASSANDRA-15694</key>
            <summary>Statistics upon streaming of entire SSTables in Netstats is wrong</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10002" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Normal</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="stefan.miklosovic">Stefan Miklosovic</assignee>
                                    <reporter username="stefan.miklosovic">Stefan Miklosovic</reporter>
                        <labels>
                    </labels>
                <created>Mon, 6 Apr 2020 08:04:20 +0000</created>
                <updated>Wed, 18 Nov 2020 21:12:07 +0000</updated>
                            <resolved>Wed, 22 Apr 2020 21:29:34 +0000</resolved>
                                        <fixVersion>4.0-beta1</fixVersion>
                    <fixVersion>4.0</fixVersion>
                                    <component>Tool/nodetool</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                    <progress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                            <timeestimate seconds="0">0h</timeestimate>
                            <timespent seconds="1200">20m</timespent>
                                <comments>
                            <comment id="17087017" author="jasonstack" created="Sun, 19 Apr 2020 13:48:00 +0000"  >&lt;p&gt;FYI, 15657 is merged..&lt;/p&gt;</comment>
                            <comment id="17087019" author="stefan.miklosovic" created="Sun, 19 Apr 2020 13:56:10 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jasonstack&quot; class=&quot;user-hover&quot; rel=&quot;jasonstack&quot;&gt;jasonstack&lt;/a&gt;&#160;yes I noticed that, thanks. &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=djoshi&quot; class=&quot;user-hover&quot; rel=&quot;djoshi&quot;&gt;djoshi&lt;/a&gt;&#160;could you please review this and merge? I think this is your area of expertise as you have written that whole SSTable streaming ...&#160;&lt;/p&gt;</comment>
                            <comment id="17087482" author="stefan.miklosovic" created="Mon, 20 Apr 2020 08:22:09 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=djoshi&quot; class=&quot;user-hover&quot; rel=&quot;djoshi&quot;&gt;djoshi&lt;/a&gt; PR prepared here, please let me know if there is anything I should do to make this happen.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/apache/cassandra/pull/546&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/cassandra/pull/546&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17089293" author="djoshi3" created="Wed, 22 Apr 2020 05:22:31 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=stefan.miklosovic&quot; class=&quot;user-hover&quot; rel=&quot;stefan.miklosovic&quot;&gt;stefan.miklosovic&lt;/a&gt;, thanks for the bug report and patch. Here&apos;s my feedback:&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;&lt;tt&gt;StreamSession::addTransferStreams&lt;/tt&gt; doesn&apos;t seem to be the right place to compute the number of files inside an &lt;tt&gt;OutgoingStreamMessage&lt;/tt&gt;. It belongs to the &lt;tt&gt;OutgoingStreamMessage&lt;/tt&gt;.&lt;/li&gt;
	&lt;li&gt;While you&apos;re correctly sending the number of files in the stream message on the outbound side, on the receiving side you did not update the number of files that the receiver expects. This causes mismatch and the receiver keeps waiting to receive files specifically &lt;tt&gt;StreamReceiveTask&lt;/tt&gt; hangs.&lt;/li&gt;
	&lt;li&gt;A few existing tests broke as the number of files they expected changed, specifically tests in &lt;tt&gt;StreamTransferTaskTest&lt;/tt&gt;.&lt;/li&gt;
	&lt;li&gt;Minor spacing nits in test file.&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;I ran CircleCI and spotted a few tests failed due to timeouts and thats how I was able to figure out that things didn&apos;t function as expected.&lt;/p&gt;

&lt;p&gt;I have made all suggestions in this &lt;a href=&quot;https://github.com/dineshjoshi/cassandra/tree/CASSANDRA-15694-trunk-review&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;branch&lt;/a&gt;. Please let me know your thoughts. If it looks good, I&apos;ll go ahead and commit it.&lt;/p&gt;</comment>
                            <comment id="17089306" author="stefan.miklosovic" created="Wed, 22 Apr 2020 05:44:48 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=djoshi&quot; class=&quot;user-hover&quot; rel=&quot;djoshi&quot;&gt;djoshi&lt;/a&gt;&#160;good stuff! Yes, I went through your changes and I do not have any objections, looks pretty solid. Please go ahead with the committing.&lt;/p&gt;</comment>
                            <comment id="17089860" author="djoshi3" created="Wed, 22 Apr 2020 17:06:15 +0000"  >&lt;p&gt;Thanks, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=stefan.miklosovic&quot; class=&quot;user-hover&quot; rel=&quot;stefan.miklosovic&quot;&gt;stefan.miklosovic&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="17090046" author="djoshi3" created="Wed, 22 Apr 2020 21:28:22 +0000"  >&lt;p&gt;Here&apos;s the final &lt;a href=&quot;https://circleci.com/workflow-run/92b05cbf-d9e2-46c3-a867-d1b899335273&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;CI run&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="17090047" author="djoshi3" created="Wed, 22 Apr 2020 21:29:34 +0000"  >&lt;p&gt;Committed. Thanks for the patch &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=stefan.miklosovic&quot; class=&quot;user-hover&quot; rel=&quot;stefan.miklosovic&quot;&gt;stefan.miklosovic&lt;/a&gt;!&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10032">
                    <name>Blocker</name>
                                            <outwardlinks description="blocks">
                                        <issuelink>
            <issuekey id="13267140">CASSANDRA-15406</issuekey>
        </issuelink>
                            </outwardlinks>
                                                                <inwardlinks description="is blocked by">
                                        <issuelink>
            <issuekey id="13293322">CASSANDRA-15657</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[stefan.miklosovic]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12313825" key="com.atlassian.jira.plugin.system.customfieldtypes:cascadingselect">
                        <customfieldname>Bug Category</customfieldname>
                        <customfieldvalues>
                                                    <customfieldvalue key="13163" cascade-level=""><![CDATA[Code]]></customfieldvalue>
                                <customfieldvalue key="13164" cascade-level="1"><![CDATA[Bug - Unclear Impact]]></customfieldvalue>
            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12313821" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Complexity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12965"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313822" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Discovered By</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12969"><![CDATA[User Report]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12313922" key="jira.plugin.projectspecificselectfield.jpssf:multicftype">
                        <customfieldname>Impacts</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="13100"><![CDATA[None]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            5 years, 29 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12313921" key="jira.plugin.projectspecificselectfield.jpssf:multicftype">
                        <customfieldname>Platform</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="13076"><![CDATA[All]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0db20:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[djoshi]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12961"><![CDATA[Low]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12311420" key="com.atlassian.jira.plugin.system.customfieldtypes:version">
                        <customfieldname>Since Version</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="12336842">4.0</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313924" key="com.atlassian.jira.plugin.system.customfieldtypes:textfield">
                        <customfieldname>Source Control Link</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>&lt;p&gt;&lt;a href=&quot;https://github.com/apache/cassandra/commit/b1411a43180e0085ae4741f4da567a08b5a28f17&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/cassandra/commit/b1411a43180e0085ae4741f4da567a08b5a28f17&lt;/a&gt;&lt;/p&gt;</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313823" key="com.atlassian.jira.plugin.system.customfieldtypes:textarea">
                        <customfieldname>Test and Documentation Plan</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>&lt;p&gt;Unit, dtests, CircleCI/Jenkins&lt;/p&gt;</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>