<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 22:48:58 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-7446] Batchlog should be streamed to a different node on decom</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-7446</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;Just like we stream hints on decom, we should also stream the contents of the batchlog - even though we do replicate the batch to at least two nodes.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12723500">CASSANDRA-7446</key>
            <summary>Batchlog should be streamed to a different node on decom</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10002" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Normal</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="blambov">Branimir Lambov</assignee>
                                    <reporter username="aleksey">Aleksey Yeschenko</reporter>
                        <labels>
                    </labels>
                <created>Tue, 24 Jun 2014 22:30:49 +0000</created>
                <updated>Tue, 16 Apr 2019 09:31:42 +0000</updated>
                            <resolved>Fri, 17 Oct 2014 00:42:13 +0000</resolved>
                                        <fixVersion>2.0.11</fixVersion>
                    <fixVersion>2.1.1</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="14169558" author="jasobrown" created="Mon, 13 Oct 2014 17:13:52 +0000"  >&lt;p&gt;Hmm, I&apos;m kinda -1 on this, as the coordinator will have no idea who now has those batchlog entries (after they&apos;ve been streamed off), so we&apos;re pretty much guaranteed that the new owner of the batchlog entries will replay them. If anything, maybe the decommissioned node should just ahead and send them.&lt;/p&gt;

&lt;p&gt;This being said, in SS.decomission, we already wait RING_DELAY before performing any unbootstrap() work (and we&apos;ve already gossiped that we&apos;re leaving). And by the time we&apos;ve streamed off the data (and the hints) it&apos;s most likely that any batchlog entries we would have been either deleted or replayed as streaming a non-trivial amount of data will take some amount of time greater than the batchlog replay timeout.&lt;/p&gt;</comment>
                            <comment id="14169565" author="iamaleksey" created="Mon, 13 Oct 2014 17:17:21 +0000"  >&lt;p&gt;You are probably right. I think what I came up is the wrong fix the problem - but the problem itself is real.&lt;/p&gt;

&lt;p&gt;Now I think what we should do is to force batchlog replay on decommission instead (and do it before we stream away the hints).&lt;/p&gt;</comment>
                            <comment id="14169577" author="jasobrown" created="Mon, 13 Oct 2014 17:24:59 +0000"  >&lt;p&gt;Agreed about letting the decommissioning node replay those batchlogs it has, but why not give if it enough time to do it naturally - that is, wait until after the data and hints have streamed? I suspect enough time will have elapsed in the non-trivial case that the batchlogs would have done what they normally do. Forcing the replay as the last (or one of the very last) steps makes sense, and gives the coordinator a few extra moments to get the right thing done.&lt;/p&gt;

&lt;p&gt;However, and because I&apos;m lazy right now, we need to double check that coordinator still sends the batchlog delete command while the decom&apos;ing node is LEAVING (LEFT, of course, is totally different).&lt;/p&gt;</comment>
                            <comment id="14169592" author="iamaleksey" created="Mon, 13 Oct 2014 17:31:36 +0000"  >&lt;p&gt;I prefer to not trust anything that&apos;s based purely on timeouts. Besides, there are edge cases when you can&apos;t guarantee that it&apos;d be replayed within a short time bound. Say, hypothetically, if you have a lot to replay, and each page has a very-long, but non timing out, replays. So I&apos;d do that just to be safe.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;&apos;m lazy right now, we need to double check that coordinator still sends the batchlog delete command while the decom&apos;ing node is LEAVING &lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Why? Even if it doesn&apos;t, it&apos;s no big deal. Worst case scenario - we replay something twice, which is harmless, just (very) slightly wasteful.&lt;/p&gt;</comment>
                            <comment id="14169601" author="jasobrown" created="Mon, 13 Oct 2014 17:36:02 +0000"  >&lt;blockquote&gt;&lt;p&gt;I prefer to not trust anything that&apos;s based purely on timeouts&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I think we&apos;re in agreement here, I&apos;m just arguing to force the batchlogs last &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="14169610" author="iamaleksey" created="Mon, 13 Oct 2014 17:41:00 +0000"  >&lt;p&gt;Sure (:&lt;/p&gt;

&lt;p&gt;That step can go anywhere where it fits best. The only limitation is that it should go before we stream the hints elsewhere - because batchlog replay might write a few hints during replay, and we don&apos;t want to lose them&lt;/p&gt;</comment>
                            <comment id="14169812" author="jasobrown" created="Mon, 13 Oct 2014 19:34:20 +0000"  >&lt;blockquote&gt;&lt;p&gt;batchlog replay might write a few hints &lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Ah, good call. &lt;/p&gt;</comment>
                            <comment id="14170992" author="blambov" created="Tue, 14 Oct 2014 14:25:14 +0000"  >&lt;p&gt;Forcing batch log replay does sound like a better solution, so I went with this. It assumes that batch log replay cannot cause any writes to the data that is being streamed apart from hints. Is this understanding correct?&lt;/p&gt;

&lt;p&gt;Initial implementation can be seen &lt;a href=&quot;https://github.com/blambov/cassandra/commit/acafff3864aee5694c0294f35bc410bb832163c3&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;here&lt;/a&gt;. It is still work in progress, needing a tests or two before it is ready for submission.&lt;/p&gt;</comment>
                            <comment id="14171094" author="iamaleksey" created="Tue, 14 Oct 2014 15:44:07 +0000"  >&lt;blockquote&gt;&lt;p&gt;Is this understanding correct?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Yup. And the commit looks good so far.&lt;/p&gt;</comment>
                            <comment id="14173605" author="blambov" created="Thu, 16 Oct 2014 10:26:37 +0000"  >&lt;p&gt;Uploaded a new version of the patch, rebased on 2.0 and updated to make sure wait time is enough to cover the batchlog timeout. Comparison viewable &lt;a href=&quot;https://github.com/blambov/cassandra/compare/7446-20-batchlog-on-decom&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;here&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;Unfortunately I could not find a sensible way to write a test for batchlog replay on decommissioning; ideas are welcome.&lt;/p&gt;</comment>
                            <comment id="14174542" author="iamaleksey" created="Fri, 17 Oct 2014 00:42:13 +0000"  >&lt;p&gt;Committed, thanks&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12675255" name="7446-2.0.txt" size="9840" author="blambov" created="Thu, 16 Oct 2014 10:26:37 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[blambov]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>401685</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            11 years, 5 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1x52v:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>401757</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>aleksey</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[aleksey]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12962"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>