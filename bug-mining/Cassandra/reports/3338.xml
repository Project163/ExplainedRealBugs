<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 22:50:28 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-8421] Cassandra 2.1.1 &amp; Cassandra 2.1.2 UDT not returning value for LIST type as UDT</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-8421</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;I using List and its data type is UDT.&lt;/p&gt;

&lt;p&gt;UDT:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;CREATE TYPE

fieldmap (

 key text,
 value text
);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;TABLE:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;CREATE TABLE entity (

  entity_id uuid PRIMARY KEY,
  begining &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;,
  domain text,
  domain_type text,
  entity_template_name text,
  field_values list&amp;lt;fieldmap&amp;gt;,
  global_entity_type text,
  revision_time timeuuid,
  status_key &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;,
  status_name text,
  uuid timeuuid
  ) &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;INDEX:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;CREATE INDEX entity_domain_idx_1 ON galaxy_dev.entity (domain);

CREATE INDEX entity_field_values_idx_1 ON galaxy_dev.entity (field_values);

CREATE INDEX entity_global_entity_type_idx_1 ON galaxy_dev.entity (gen_type );
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;QUERY&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;SELECT * FROM entity WHERE status_key &amp;lt; 3 and field_values contains {key: &lt;span class=&quot;code-quote&quot;&gt;&apos;userName&apos;&lt;/span&gt;, value: &lt;span class=&quot;code-quote&quot;&gt;&apos;Sprint5_200002&apos;&lt;/span&gt;} and gen_type = &lt;span class=&quot;code-quote&quot;&gt;&apos;USER&apos;&lt;/span&gt; and domain = &lt;span class=&quot;code-quote&quot;&gt;&apos;S4_1017.abc.com&apos;&lt;/span&gt; allow filtering;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;The above query return value for some row and not for many rows but those rows and data&apos;s are exist.&lt;/p&gt;

&lt;p&gt;Observation:&lt;br/&gt;
If I execute query with other than field_maps, then it returns value. I suspect the problem with LIST with UDT.&lt;/p&gt;

&lt;p&gt;I have single node cassadra DB. Please let me know why this strange behavior from cassandra.&lt;/p&gt;</description>
                <environment>&lt;p&gt;single node cassandra &lt;/p&gt;</environment>
        <key id="12759396">CASSANDRA-8421</key>
            <summary>Cassandra 2.1.1 &amp; Cassandra 2.1.2 UDT not returning value for LIST type as UDT</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10002" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Normal</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="blerer">Benjamin Lerer</assignee>
                                    <reporter username="madheswaran">madheswaran</reporter>
                        <labels>
                    </labels>
                <created>Thu, 4 Dec 2014 09:51:31 +0000</created>
                <updated>Tue, 16 Apr 2019 09:31:26 +0000</updated>
                            <resolved>Tue, 20 Jan 2015 17:41:40 +0000</resolved>
                                        <fixVersion>2.1.3</fixVersion>
                                    <component>Legacy/CQL</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="14234341" author="philipthompson" created="Thu, 4 Dec 2014 16:48:58 +0000"  >&lt;p&gt;Which Cassandra version are you using? Nevermind, I see in the title now.&lt;/p&gt;</comment>
                            <comment id="14234358" author="philipthompson" created="Thu, 4 Dec 2014 16:56:24 +0000"  >&lt;p&gt;With 2.1.1, when creating the table as defined, I see the following error &lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;code=2200 [Invalid query] message=&lt;span class=&quot;code-quote&quot;&gt;&quot;Non-frozen User-Defined types are not supported, please use frozen&amp;lt;&amp;gt;&quot;&lt;/span&gt;&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;. With the current 2.1-HEAD code, I see &lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;code=2200 [Invalid query] message=&lt;span class=&quot;code-quote&quot;&gt;&quot;Non-frozen collections are not allowed inside collections: list&amp;lt;fieldmap&amp;gt;&quot;&lt;/span&gt;&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;.&lt;/p&gt;

&lt;p&gt;So the problem is definitely that you have a UDT in a list. I am confused as to how you are creating the table though. Are you using the queries exactly as specified on C* 2.1.1? What driver or client are you using?&lt;/p&gt;</comment>
                            <comment id="14237054" author="madheswaran" created="Sun, 7 Dec 2014 05:00:53 +0000"  >&lt;p&gt;It is typo error. I used frozen  keyword for UDT .&lt;/p&gt;

&lt;p&gt;CREATE TYPE galaxy_dev.fieldmap (&lt;br/&gt;
    key text,&lt;br/&gt;
    value text&lt;br/&gt;
);&lt;/p&gt;

&lt;p&gt;CREATE TABLE galaxy_dev.entity (&lt;br/&gt;
    entity_id uuid PRIMARY KEY,&lt;br/&gt;
    begining int,&lt;br/&gt;
    domain text,&lt;br/&gt;
    domain_type text,&lt;br/&gt;
    entity_template_name text,&lt;br/&gt;
    field_values list&amp;lt;frozen&amp;lt;fieldmap&amp;gt;&amp;gt;,&lt;br/&gt;
    global_entity_type text,&lt;br/&gt;
    revision_time timeuuid,&lt;br/&gt;
    status_key int,&lt;br/&gt;
    status_name text,&lt;br/&gt;
    uuid timeuuid&lt;br/&gt;
) &lt;/p&gt;

&lt;p&gt;Even I tried with latest release Cassandra 2.1.2 and the issue is reproduced. &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/sad.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;Total Records inserted was 20&lt;br/&gt;
&amp;gt;&amp;gt;cqlsh:galaxy_dev&amp;gt; SELECT count&lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/star_yellow.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; from entity;&lt;/p&gt;

&lt;p&gt; count&lt;br/&gt;
-------&lt;br/&gt;
    20&lt;/p&gt;


&lt;p&gt;&amp;gt;&amp;gt;SELECT * from entity where  status_key = 3 allow filtering ; &lt;br/&gt;
    it returns 17 records&lt;br/&gt;
&amp;gt;&amp;gt;SELECT * from entity where field_values CONTAINS &lt;/p&gt;
{key: &apos;state&apos;, value: &apos;Dubai&apos;}
&lt;p&gt; &lt;br/&gt;
 it returns 19 records&lt;/p&gt;

&lt;p&gt;&amp;gt;&amp;gt; SELECT * from entity where field_values CONTAINS &lt;/p&gt;
{key: &apos;state&apos;, value: &apos;Dubai&apos;}
&lt;p&gt; and status_key = 3 allow filtering;&lt;br/&gt;
returns only 1 record. ( but expected is 17 records ).&lt;/p&gt;

&lt;p&gt;Sample Data which inserted:&lt;br/&gt;
------------------------------------&lt;br/&gt;
&amp;gt;&amp;gt;cqlsh:master_db&amp;gt; SELECT * FROM  entity limit 1;&lt;br/&gt;
 entity_id                            | begining | domain | domain_type | entity_template_name | field_values                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     | global_entity_type | revision_time                        | status_key | status_name | uuid&lt;br/&gt;
-------------------------------------&lt;del&gt;&lt;ins&gt;&lt;/del&gt;--------&lt;del&gt;&lt;/ins&gt;&lt;/del&gt;------&lt;del&gt;&lt;ins&gt;&lt;/del&gt;-----------&lt;del&gt;&lt;/ins&gt;&lt;/del&gt;--------------------&lt;del&gt;&lt;ins&gt;&lt;/del&gt;------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------&lt;del&gt;&lt;/ins&gt;&lt;/del&gt;------------------&lt;del&gt;&lt;ins&gt;&lt;/del&gt;------------------------------------&lt;del&gt;&lt;/ins&gt;&lt;/del&gt;----------&lt;del&gt;&lt;ins&gt;&lt;/del&gt;-----------&lt;del&gt;&lt;/ins&gt;&lt;/del&gt;-----&lt;br/&gt;
 53212bc3-d9a3-4fb0-9a11-b08b63201d2b |        1 |    com |        null |   DefaultOrgTemplate | [&lt;/p&gt;
{key: &apos;country&apos;, value: &apos;UAE&apos;}
&lt;p&gt;, &lt;/p&gt;
{key: &apos;faxNo&apos;, value: &apos;0097148869001&apos;}
&lt;p&gt;, &lt;/p&gt;
{key: &apos;landlineNo&apos;, value: &apos;0097148869000&apos;}
&lt;p&gt;, &lt;/p&gt;
{key: &apos;orgAddress&apos;, value: &apos;Technopark&apos;}
&lt;p&gt;, &lt;/p&gt;
{key: &apos;orgCode&apos;, value: null}
&lt;p&gt;, &lt;/p&gt;
{key: &apos;orgFullName&apos;, value: &apos;pacificcontrols&apos;}
&lt;p&gt;, &lt;/p&gt;
{key: &apos;orgName&apos;, value: &apos;PCS&apos;}
&lt;p&gt;, &lt;/p&gt;
{key: &apos;state&apos;, value: &apos;Dubai&apos;}
&lt;p&gt;, &lt;/p&gt;
{key: &apos;status&apos;, value: null}
&lt;p&gt;, &lt;/p&gt;
{key: &apos;superTenant&apos;, value: null}
&lt;p&gt;, &lt;/p&gt;
{key: &apos;webUrl&apos;, value: &apos;http://www.pacificcontrols.net&apos;}
&lt;p&gt;, &lt;/p&gt;
{key: &apos;domain&apos;, value: &apos;pcs.com&apos;}
&lt;p&gt;, {key: &apos;menu&apos;, value: &apos;[&lt;/p&gt;
{&quot;menuName&quot;:&quot;Manage Entity Template&quot;,&quot;menuDesc&quot;:&quot;Manage Entity Template description&quot;,&quot;categoryName&quot;:&quot;Configuration&quot;}
&lt;p&gt;,&lt;/p&gt;
{&quot;menuName&quot;:&quot;Manage Roles&quot;,&quot;menuDesc&quot;:&quot;Manage Roles description&quot;,&quot;categoryName&quot;:&quot;User Management&quot;}
&lt;p&gt;,&lt;/p&gt;
{&quot;menuName&quot;:&quot;Manage Entities&quot;,&quot;menuDesc&quot;:&quot;Manage Entities description&quot;,&quot;categoryName&quot;:&quot;Configuration&quot;}
&lt;p&gt;,&lt;/p&gt;
{&quot;menuName&quot;:&quot;Manage Hierarchy&quot;,&quot;menuDesc&quot;:&quot;Manage Hierarchy description&quot;,&quot;categoryName&quot;:&quot;Configuration&quot;}
&lt;p&gt;,&lt;/p&gt;
{&quot;menuName&quot;:&quot;Live Tracking&quot;,&quot;menuDesc&quot;:&quot;Live Tracking description&quot;,&quot;categoryName&quot;:&quot;Applications&quot;}
&lt;p&gt;,&lt;/p&gt;
{&quot;menuName&quot;:&quot;Manage Users&quot;,&quot;menuDesc&quot;:&quot;Manage Users description&quot;,&quot;categoryName&quot;:&quot;User Management&quot;}
&lt;p&gt;,&lt;/p&gt;
{&quot;menuName&quot;:&quot;UI Designer&quot;,&quot;menuDesc&quot;:&quot;UI Designer description&quot;,&quot;categoryName&quot;:&quot;Configuration&quot;}
&lt;p&gt;,&lt;/p&gt;
{&quot;menuName&quot;:&quot;Prospect Notifications&quot;,&quot;menuDesc&quot;:&quot;Prospect Notifications description&quot;,&quot;categoryName&quot;:&quot;Administration&quot;}
&lt;p&gt;,&lt;/p&gt;
{&quot;menuName&quot;:&quot;Manage Communication Channel&quot;,&quot;menuDesc&quot;:&quot;Manage Communication Channel description&quot;,&quot;categoryName&quot;:&quot;Configuration&quot;}
&lt;p&gt;]&apos;}, {key: &apos;featureGroups&apos;, value: &apos;[{&quot;name&quot;:&quot;LiveTracking&quot;,&quot;description&quot;:&quot;Live Tracking&quot;,&quot;features&quot;:[{&quot;name&quot;:&quot;Map&quot;,&quot;description&quot;:&quot;Map Description&quot;,&quot;statusFlag&quot;:0,&quot;privileges&quot;:[&lt;/p&gt;
{&quot;name&quot;:&quot;Edit&quot;,&quot;description&quot;:&quot;Edit Privilege&quot;,&quot;statusKey&quot;:0}
&lt;p&gt;,&lt;/p&gt;
{&quot;name&quot;:&quot;View&quot;,&quot;description&quot;:&quot;View Privilege&quot;,&quot;statusKey&quot;:0}
&lt;p&gt;,&lt;/p&gt;
{&quot;name&quot;:&quot;Delete&quot;,&quot;description&quot;:&quot;Delete Privilege&quot;,&quot;statusKey&quot;:0}
&lt;p&gt;,&lt;/p&gt;
{&quot;name&quot;:&quot;Create&quot;,&quot;description&quot;:&quot;Create Privilege&quot;,&quot;statusKey&quot;:0}
&lt;p&gt;]},{&quot;name&quot;:&quot;Grid&quot;,&quot;description&quot;:&quot;Grid Description&quot;,&quot;statusFlag&quot;:0,&quot;privileges&quot;:[&lt;/p&gt;
{&quot;name&quot;:&quot;Edit&quot;,&quot;description&quot;:&quot;Edit Privilege&quot;,&quot;statusKey&quot;:0}
&lt;p&gt;,&lt;/p&gt;
{&quot;name&quot;:&quot;View&quot;,&quot;description&quot;:&quot;View Privilege&quot;,&quot;statusKey&quot;:0}
&lt;p&gt;,&lt;/p&gt;
{&quot;name&quot;:&quot;Delete&quot;,&quot;description&quot;:&quot;Delete Privilege&quot;,&quot;statusKey&quot;:0}
&lt;p&gt;,&lt;/p&gt;
{&quot;name&quot;:&quot;Create&quot;,&quot;description&quot;:&quot;Create Privilege&quot;,&quot;statusKey&quot;:0}
&lt;p&gt;]},{&quot;name&quot;:&quot;Widget&quot;,&quot;description&quot;:&quot;Widget Description&quot;,&quot;statusFlag&quot;:0,&quot;privileges&quot;:[&lt;/p&gt;
{&quot;name&quot;:&quot;Edit&quot;,&quot;description&quot;:&quot;Edit Privilege&quot;,&quot;statusKey&quot;:0}
&lt;p&gt;,&lt;/p&gt;
{&quot;name&quot;:&quot;View&quot;,&quot;description&quot;:&quot;View Privilege&quot;,&quot;statusKey&quot;:0}
&lt;p&gt;,&lt;/p&gt;
{&quot;name&quot;:&quot;Delete&quot;,&quot;description&quot;:&quot;Delete Privilege&quot;,&quot;statusKey&quot;:0}
&lt;p&gt;,&lt;/p&gt;
{&quot;name&quot;:&quot;Create&quot;,&quot;description&quot;:&quot;Create Privilege&quot;,&quot;statusKey&quot;:0}
&lt;p&gt;]}]},{&quot;name&quot;:&quot;HistoryTracking&quot;,&quot;description&quot;:&quot;History Tracking&quot;,&quot;features&quot;:[{&quot;name&quot;:&quot;Map&quot;,&quot;description&quot;:&quot;Map Description&quot;,&quot;statusFlag&quot;:0,&quot;privileges&quot;:[&lt;/p&gt;
{&quot;name&quot;:&quot;Edit&quot;,&quot;description&quot;:&quot;Edit Privilege&quot;,&quot;statusKey&quot;:0}
&lt;p&gt;,&lt;/p&gt;
{&quot;name&quot;:&quot;View&quot;,&quot;description&quot;:&quot;View Privilege&quot;,&quot;statusKey&quot;:0}
&lt;p&gt;,&lt;/p&gt;
{&quot;name&quot;:&quot;Delete&quot;,&quot;description&quot;:&quot;Delete Privilege&quot;,&quot;statusKey&quot;:0}
&lt;p&gt;,&lt;/p&gt;
{&quot;name&quot;:&quot;Create&quot;,&quot;description&quot;:&quot;Create Privilege&quot;,&quot;statusKey&quot;:0}
&lt;p&gt;]},{&quot;name&quot;:&quot;Grid&quot;,&quot;description&quot;:&quot;Grid Description&quot;,&quot;statusFlag&quot;:0,&quot;privileges&quot;:[&lt;/p&gt;
{&quot;name&quot;:&quot;Edit&quot;,&quot;description&quot;:&quot;Edit Privilege&quot;,&quot;statusKey&quot;:0}
&lt;p&gt;,&lt;/p&gt;
{&quot;name&quot;:&quot;View&quot;,&quot;description&quot;:&quot;View Privilege&quot;,&quot;statusKey&quot;:0}
&lt;p&gt;,&lt;/p&gt;
{&quot;name&quot;:&quot;Delete&quot;,&quot;description&quot;:&quot;Delete Privilege&quot;,&quot;statusKey&quot;:0}
&lt;p&gt;,&lt;/p&gt;
{&quot;name&quot;:&quot;Create&quot;,&quot;description&quot;:&quot;Create Privilege&quot;,&quot;statusKey&quot;:0}
&lt;p&gt;]},{&quot;name&quot;:&quot;Widget&quot;,&quot;description&quot;:&quot;Widget Description&quot;,&quot;statusFlag&quot;:0,&quot;privileges&quot;:[&lt;/p&gt;
{&quot;name&quot;:&quot;Edit&quot;,&quot;description&quot;:&quot;Edit Privilege&quot;,&quot;statusKey&quot;:0}
&lt;p&gt;,&lt;/p&gt;
{&quot;name&quot;:&quot;View&quot;,&quot;description&quot;:&quot;View Privilege&quot;,&quot;statusKey&quot;:0}
&lt;p&gt;,&lt;/p&gt;
{&quot;name&quot;:&quot;Delete&quot;,&quot;description&quot;:&quot;Delete Privilege&quot;,&quot;statusKey&quot;:0}
&lt;p&gt;,&lt;/p&gt;
{&quot;name&quot;:&quot;Create&quot;,&quot;description&quot;:&quot;Create Privilege&quot;,&quot;statusKey&quot;:0}
&lt;p&gt;]}]},{&quot;name&quot;:&quot;GeoFencing&quot;,&quot;description&quot;:&quot;Geo Fencing&quot;,&quot;features&quot;:[{&quot;name&quot;:&quot;Map&quot;,&quot;description&quot;:&quot;Map Description&quot;,&quot;statusFlag&quot;:0,&quot;privileges&quot;:[&lt;/p&gt;
{&quot;name&quot;:&quot;Edit&quot;,&quot;description&quot;:&quot;Edit Privilege&quot;,&quot;statusKey&quot;:0}
&lt;p&gt;,&lt;/p&gt;
{&quot;name&quot;:&quot;View&quot;,&quot;description&quot;:&quot;View Privilege&quot;,&quot;statusKey&quot;:0}
&lt;p&gt;,&lt;/p&gt;
{&quot;name&quot;:&quot;Delete&quot;,&quot;description&quot;:&quot;Delete Privilege&quot;,&quot;statusKey&quot;:0}
&lt;p&gt;,&lt;/p&gt;
{&quot;name&quot;:&quot;Create&quot;,&quot;description&quot;:&quot;Create Privilege&quot;,&quot;statusKey&quot;:0}
&lt;p&gt;]},{&quot;name&quot;:&quot;Grid&quot;,&quot;description&quot;:&quot;Grid Description&quot;,&quot;statusFlag&quot;:0,&quot;privileges&quot;:[&lt;/p&gt;
{&quot;name&quot;:&quot;Edit&quot;,&quot;description&quot;:&quot;Edit Privilege&quot;,&quot;statusKey&quot;:0}
&lt;p&gt;,&lt;/p&gt;
{&quot;name&quot;:&quot;View&quot;,&quot;description&quot;:&quot;View Privilege&quot;,&quot;statusKey&quot;:0}
&lt;p&gt;,&lt;/p&gt;
{&quot;name&quot;:&quot;Delete&quot;,&quot;description&quot;:&quot;Delete Privilege&quot;,&quot;statusKey&quot;:0}
&lt;p&gt;,&lt;/p&gt;
{&quot;name&quot;:&quot;Create&quot;,&quot;description&quot;:&quot;Create Privilege&quot;,&quot;statusKey&quot;:0}
&lt;p&gt;]},{&quot;name&quot;:&quot;Widget&quot;,&quot;description&quot;:&quot;Widget Description&quot;,&quot;statusFlag&quot;:0,&quot;privileges&quot;:[&lt;/p&gt;
{&quot;name&quot;:&quot;Edit&quot;,&quot;description&quot;:&quot;Edit Privilege&quot;,&quot;statusKey&quot;:0}
&lt;p&gt;,&lt;/p&gt;
{&quot;name&quot;:&quot;View&quot;,&quot;description&quot;:&quot;View Privilege&quot;,&quot;statusKey&quot;:0}
&lt;p&gt;,&lt;/p&gt;
{&quot;name&quot;:&quot;Delete&quot;,&quot;description&quot;:&quot;Delete Privilege&quot;,&quot;statusKey&quot;:0}
&lt;p&gt;,&lt;/p&gt;
{&quot;name&quot;:&quot;Create&quot;,&quot;description&quot;:&quot;Create Privilege&quot;,&quot;statusKey&quot;:0}
&lt;p&gt;]}]},{&quot;name&quot;:&quot;UserManagement&quot;,&quot;description&quot;:&quot;User Management&quot;,&quot;features&quot;:[{&quot;name&quot;:&quot;ManageUser&quot;,&quot;description&quot;:&quot;Manage User Description&quot;,&quot;statusFlag&quot;:0,&quot;privileges&quot;:[&lt;/p&gt;
{&quot;name&quot;:&quot;Edit&quot;,&quot;description&quot;:&quot;Edit Privilege&quot;,&quot;statusKey&quot;:0}
&lt;p&gt;,&lt;/p&gt;
{&quot;name&quot;:&quot;View&quot;,&quot;description&quot;:&quot;View Privilege&quot;,&quot;statusKey&quot;:0}
&lt;p&gt;,&lt;/p&gt;
{&quot;name&quot;:&quot;Delete&quot;,&quot;description&quot;:&quot;Delete Privilege&quot;,&quot;statusKey&quot;:0}
&lt;p&gt;,&lt;/p&gt;
{&quot;name&quot;:&quot;Create&quot;,&quot;description&quot;:&quot;Create Privilege&quot;,&quot;statusKey&quot;:0}
&lt;p&gt;]},{&quot;name&quot;:&quot;CreateUser&quot;,&quot;description&quot;:&quot;Create User Description&quot;,&quot;statusFlag&quot;:0,&quot;privileges&quot;:[&lt;/p&gt;
{&quot;name&quot;:&quot;Edit&quot;,&quot;description&quot;:&quot;Edit Privilege&quot;,&quot;statusKey&quot;:0}
&lt;p&gt;,&lt;/p&gt;
{&quot;name&quot;:&quot;View&quot;,&quot;description&quot;:&quot;View Privilege&quot;,&quot;statusKey&quot;:0}
&lt;p&gt;,&lt;/p&gt;
{&quot;name&quot;:&quot;Delete&quot;,&quot;description&quot;:&quot;Delete Privilege&quot;,&quot;statusKey&quot;:0}
&lt;p&gt;,&lt;/p&gt;
{&quot;name&quot;:&quot;Create&quot;,&quot;description&quot;:&quot;Create Privilege&quot;,&quot;statusKey&quot;:0}
&lt;p&gt;]}]},{&quot;name&quot;:&quot;RoleManagement&quot;,&quot;description&quot;:&quot;User Management&quot;,&quot;features&quot;:[{&quot;name&quot;:&quot;ManageRole&quot;,&quot;description&quot;:&quot;Manage Role Description&quot;,&quot;statusFlag&quot;:0,&quot;privileges&quot;:[&lt;/p&gt;
{&quot;name&quot;:&quot;Edit&quot;,&quot;description&quot;:&quot;Edit Privilege&quot;,&quot;statusKey&quot;:0}
&lt;p&gt;,&lt;/p&gt;
{&quot;name&quot;:&quot;View&quot;,&quot;description&quot;:&quot;View Privilege&quot;,&quot;statusKey&quot;:0}
&lt;p&gt;,&lt;/p&gt;
{&quot;name&quot;:&quot;Delete&quot;,&quot;description&quot;:&quot;Delete Privilege&quot;,&quot;statusKey&quot;:0}
&lt;p&gt;,&lt;/p&gt;
{&quot;name&quot;:&quot;Create&quot;,&quot;description&quot;:&quot;Create Privilege&quot;,&quot;statusKey&quot;:0}
&lt;p&gt;]},{&quot;name&quot;:&quot;CreateRole&quot;,&quot;description&quot;:&quot;Create Role Description&quot;,&quot;statusFlag&quot;:0,&quot;privileges&quot;:[&lt;/p&gt;
{&quot;name&quot;:&quot;Edit&quot;,&quot;description&quot;:&quot;Edit Privilege&quot;,&quot;statusKey&quot;:0}
&lt;p&gt;,&lt;/p&gt;
{&quot;name&quot;:&quot;View&quot;,&quot;description&quot;:&quot;View Privilege&quot;,&quot;statusKey&quot;:0}
&lt;p&gt;,&lt;/p&gt;
{&quot;name&quot;:&quot;Delete&quot;,&quot;description&quot;:&quot;Delete Privilege&quot;,&quot;statusKey&quot;:0}
&lt;p&gt;,&lt;/p&gt;
{&quot;name&quot;:&quot;Create&quot;,&quot;description&quot;:&quot;Create Privilege&quot;,&quot;statusKey&quot;:0}
&lt;p&gt;]}]}]&apos;}] |       ORGANIZATION | 204bb850-7d4b-11e4-869a-8d9a1002f406 |          3 |     DELETED | null&lt;/p&gt;

&lt;p&gt;(1 rows)&lt;/p&gt;

</comment>
                            <comment id="14237056" author="madheswaran" created="Sun, 7 Dec 2014 05:04:46 +0000"  >&lt;p&gt;This issue is not reproduced in lesser records ( 4 or 5 records) when record count get increased then it behaves abnormally. &lt;/p&gt;</comment>
                            <comment id="14237189" author="philipthompson" created="Sun, 7 Dec 2014 16:11:53 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=madheswaran&quot; class=&quot;user-hover&quot; rel=&quot;madheswaran&quot;&gt;madheswaran&lt;/a&gt; I was able to reproduce your issue on 2.1.2. I have found that if there is an index on field_values, but not on status_key, your problem reproduces exactly as described. If there is an index on both field_values and on status_key, the correct data is returned every time. I am not sure if the index is supposed to be required, so I am reassigning to someone more familiar with secondary indexes.&lt;/p&gt;</comment>
                            <comment id="14237427" author="madheswaran" created="Mon, 8 Dec 2014 04:35:59 +0000"  >&lt;p&gt;Philip Thompson : Index was already created for status_key, field_values and etc. Please find the index details:&lt;br/&gt;
CREATE INDEX entity_begining_idx_1 ON galaxy_dev.entity (begining);&lt;br/&gt;
CREATE INDEX entity_domain_idx_1 ON galaxy_dev.entity (domain);&lt;br/&gt;
CREATE INDEX field ON galaxy_dev.entity (field_values);&lt;br/&gt;
CREATE INDEX entity_global_entity_type_idx_1 ON galaxy_dev.entity (global_entity_type);&lt;br/&gt;
CREATE INDEX entity_revision_time_idx_1 ON galaxy_dev.entity (revision_time);&lt;br/&gt;
CREATE INDEX stat ON galaxy_dev.entity (status_key);&lt;/p&gt;

</comment>
                            <comment id="14237435" author="madheswaran" created="Mon, 8 Dec 2014 04:55:00 +0000"  >&lt;p&gt;Philip Thompson: Exported the stored data into CSV file  and attached here.&lt;/p&gt;</comment>
                            <comment id="14237671" author="slebresne" created="Mon, 8 Dec 2014 09:28:40 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=philipthompson&quot; class=&quot;user-hover&quot; rel=&quot;philipthompson&quot;&gt;philipthompson&lt;/a&gt; Since you&apos;re able to reproduce, could you extract that test into a unit test (using CQLTester)?&lt;/p&gt;</comment>
                            <comment id="14237722" author="madheswaran" created="Mon, 8 Dec 2014 10:18:13 +0000"  >&lt;p&gt;I never used CQLTester?.. Please can you tell me where I can Download CQLTester&lt;/p&gt;</comment>
                            <comment id="14237864" author="philipthompson" created="Mon, 8 Dec 2014 13:38:35 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=slebresne&quot; class=&quot;user-hover&quot; rel=&quot;slebresne&quot;&gt;slebresne&lt;/a&gt;, yes, I will attach today. But I must insist, I really am only able to reproduce this issue when there is not an index on status_key. I will attach unit tests for both scenarios, regardless.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=madheswaran&quot; class=&quot;user-hover&quot; rel=&quot;madheswaran&quot;&gt;madheswaran&lt;/a&gt;, CQLTester is one of the classes inside Apache Cassandra&apos;s unit test framework. It is included alongside the source code in the Apache Cassandra git repository.&lt;/p&gt;</comment>
                            <comment id="14238040" author="philipthompson" created="Mon, 8 Dec 2014 16:38:22 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=slebresne&quot; class=&quot;user-hover&quot; rel=&quot;slebresne&quot;&gt;slebresne&lt;/a&gt;, I have attached four unit tests, only one of which shows the problem. If secondary indexes are on both fields, or are just on status_key, there is no issue.&lt;br/&gt;
If there is only an index on field_values, not on status_key, but no filtering needs done, i.e., all rows fit the criteria, there is no issue.&lt;/p&gt;

&lt;p&gt;The problem occurs when there is only an index on field_values, no on status_key, but not all rows have the correct status_key, in which case not all valid rows are returned.&lt;/p&gt;</comment>
                            <comment id="14239219" author="madheswaran" created="Tue, 9 Dec 2014 10:06:03 +0000"  >&lt;h3&gt;&lt;a name=&quot;AnotherIssueinSearch%3A&quot;&gt;&lt;/a&gt;Another Issue in Search:&lt;/h3&gt;
&lt;p&gt;------------------------------&lt;br/&gt;
First Query searching list value &lt;font color=&quot;red&quot;&gt; {key: &apos;contactNumber&apos;, value: &apos;8888888889007&apos;}  &lt;/font&gt;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-style: solid;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeHeader panelHeader&quot; style=&quot;border-bottom-width: 1px;border-bottom-style: solid;&quot;&gt;&lt;b&gt;First Query&lt;/b&gt;&lt;/div&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;1) SELECT * from entity WHERE status_key &amp;lt; 3 and field_values contains {key: &lt;span class=&quot;code-quote&quot;&gt;&apos;contactNumber&apos;&lt;/span&gt;, value: &lt;span class=&quot;code-quote&quot;&gt;&apos;8888888889007&apos;&lt;/span&gt;} and domain = &lt;span class=&quot;code-quote&quot;&gt;&apos;pcs.com&apos;&lt;/span&gt; allow filtering ;

 entity_id                            | begining | domain  | domain_type | entity_template_name    | field_values                                                                                                                                                                                                                                                                                                                                                                                                                                                       | global_entity_type | revision_time                        | status_key | status_name | uuid
--------------------------------------+----------+---------+-------------+-------------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+--------------------+--------------------------------------+------------+-------------+------
 723d4295-1ad2-4aba-8638-5bdd6b3be8b7 |        1 | pcs.com |        &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; | DefaultPCSTemplate_User | [{key: &lt;span class=&quot;code-quote&quot;&gt;&apos;access&apos;&lt;/span&gt;, value: &lt;span class=&quot;code-quote&quot;&gt;&apos;[{&lt;span class=&quot;code-quote&quot;&gt;&quot;entityId&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;c0e30978-9662-4d6e-9503-7fcfd4d7693c&quot;&lt;/span&gt;},{&lt;span class=&quot;code-quote&quot;&gt;&quot;entityId&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;9af1e1e2-05bd-4929-a2cc-ff9e6526992c&quot;&lt;/span&gt;}]&apos;&lt;/span&gt;}, {key: &lt;span class=&quot;code-quote&quot;&gt;&apos;contactNumber&apos;&lt;/span&gt;, value: &lt;span class=&quot;code-quote&quot;&gt;&apos;8888888889007&apos;&lt;/span&gt;}, {key: &lt;span class=&quot;code-quote&quot;&gt;&apos;firstName&apos;&lt;/span&gt;, value: &lt;span class=&quot;code-quote&quot;&gt;&apos;James&apos;&lt;/span&gt;}, {key: &lt;span class=&quot;code-quote&quot;&gt;&apos;lastName&apos;&lt;/span&gt;, value: &lt;span class=&quot;code-quote&quot;&gt;&apos;Smith&apos;&lt;/span&gt;}, {key: &lt;span class=&quot;code-quote&quot;&gt;&apos;primaryEmail&apos;&lt;/span&gt;, value: &lt;span class=&quot;code-quote&quot;&gt;&apos;james9007@pcs.com&apos;&lt;/span&gt;}, {key: &lt;span class=&quot;code-quote&quot;&gt;&apos;roleName&apos;&lt;/span&gt;, value: &lt;span class=&quot;code-quote&quot;&gt;&apos;admin&apos;&lt;/span&gt;}, {key: &lt;span class=&quot;code-quote&quot;&gt;&apos;userName&apos;&lt;/span&gt;, value: &lt;span class=&quot;code-quote&quot;&gt;&apos;James9007&apos;&lt;/span&gt;}, {key: &lt;span class=&quot;code-quote&quot;&gt;&apos;userType&apos;&lt;/span&gt;, value: &lt;span class=&quot;code-quote&quot;&gt;&apos;some&apos;&lt;/span&gt;}, {key: &lt;span class=&quot;code-quote&quot;&gt;&apos;password&apos;&lt;/span&gt;, value: &lt;span class=&quot;code-quote&quot;&gt;&apos;James9007&apos;&lt;/span&gt;}] |               USER | 5a0dad10-7edf-11e4-8d47-4b86331ee8c7 |          0 |      ACTIVE | &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;
(1 rows)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;


&lt;p&gt;2) Same query but searching another value of list &lt;font color=&quot;red&quot;&gt; {key: &apos;access&apos;, value: &apos;&lt;span class=&quot;error&quot;&gt;&amp;#91;{&quot;entityId&quot;:&quot;c0e30978-9662-4d6e-9503-7fcfd4d7693c&quot;},{&quot;entityId&quot;:&quot;9af1e1e2-05bd-4929-a2cc-ff9e6526992c&quot;}&amp;#93;&lt;/span&gt;&apos;} &lt;/font&gt;   from same &lt;b&gt;ROW&lt;/b&gt; but it is not returning any value.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-style: solid;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeHeader panelHeader&quot; style=&quot;border-bottom-width: 1px;border-bottom-style: solid;&quot;&gt;&lt;b&gt;SecondQuery&lt;/b&gt;&lt;/div&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;SELECT * from entity WHERE status_key &amp;lt; 3 and field_values contains  {key: &lt;span class=&quot;code-quote&quot;&gt;&apos;access&apos;&lt;/span&gt;, value: &lt;span class=&quot;code-quote&quot;&gt;&apos;[{&lt;span class=&quot;code-quote&quot;&gt;&quot;entityId&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;c0e30978-9662-4d6e-9503-7fcfd4d7693c&quot;&lt;/span&gt;},{&lt;span class=&quot;code-quote&quot;&gt;&quot;entityId&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;9af1e1e2-05bd-4929-a2cc-ff9e6526992c&quot;&lt;/span&gt;}]&apos;&lt;/span&gt;} and domain = &lt;span class=&quot;code-quote&quot;&gt;&apos;pcs.com&apos;&lt;/span&gt; allow filtering ;

(0 rows)

&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;



&lt;p&gt;Index Created for both status_key and field_values&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;CREATE INDEX entity_begining_idx_1 ON galaxy_development.entity (begining);
CREATE INDEX entity_domain_idx_1 ON galaxy_development.entity (domain);
CREATE INDEX entity_field_values_idx_1 ON galaxy_development.entity (field_values);
CREATE INDEX entity_global_entity_type_idx_1 ON galaxy_development.entity (global_entity_type);
CREATE INDEX entity_revision_time_idx_1 ON galaxy_development.entity (revision_time);
CREATE INDEX entity_status_key_idx_1 ON galaxy_development.entity (status_key);

&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="14245247" author="madheswaran" created="Sat, 13 Dec 2014 08:08:29 +0000"  >&lt;p&gt;Sylvain Lebresne and Philip Thompson, are you able to reproduce this issue?. Please let me know if you need any more inputs.&lt;/p&gt;</comment>
                            <comment id="14246585" author="slebresne" created="Mon, 15 Dec 2014 11:48:50 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=philipthompson&quot; class=&quot;user-hover&quot; rel=&quot;philipthompson&quot;&gt;philipthompson&lt;/a&gt; the unit test you attached is passing fine on 2.1 and trunk for me. Is it not the case for you?&lt;/p&gt;</comment>
                            <comment id="14246742" author="philipthompson" created="Mon, 15 Dec 2014 15:33:21 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=slebresne&quot; class=&quot;user-hover&quot; rel=&quot;slebresne&quot;&gt;slebresne&lt;/a&gt;, I attached four unit tests in that file. &lt;tt&gt;testOneIndex&lt;/tt&gt; and &lt;tt&gt;testTwoIndices&lt;/tt&gt; are failing on 2.1-head and trunk for me.&lt;/p&gt;</comment>
                            <comment id="14249659" author="slebresne" created="Wed, 17 Dec 2014 09:48:58 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=blerer&quot; class=&quot;user-hover&quot; rel=&quot;blerer&quot;&gt;blerer&lt;/a&gt; Can you check if you have more luck than me at reproducing with the test attached?&lt;/p&gt;</comment>
                            <comment id="14249666" author="madheswaran" created="Wed, 17 Dec 2014 09:58:07 +0000"  >&lt;p&gt;Hi Benjamin,&lt;br/&gt;
Steps to reproduce:&lt;br/&gt;
1) Please create table as I mentioned with Secondary index&apos;s for other fields.&lt;br/&gt;
2) Insert  just 4 records ,  similar to below&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
 723d4295-1ad2-4aba-8638-5bdd6b3be8b7 |        1 | pcs.com |        &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; | DefaultPCSTemplate_User | [{key: &lt;span class=&quot;code-quote&quot;&gt;&apos;access&apos;&lt;/span&gt;, value: &lt;span class=&quot;code-quote&quot;&gt;&apos;[{&lt;span class=&quot;code-quote&quot;&gt;&quot;entityId&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;c0e30978-9662-4d6e-9503-7fcfd4d7693c&quot;&lt;/span&gt;},{&lt;span class=&quot;code-quote&quot;&gt;&quot;entityId&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;9af1e1e2-05bd-4929-a2cc-ff9e6526992c&quot;&lt;/span&gt;}]&apos;&lt;/span&gt;}, {key: &lt;span class=&quot;code-quote&quot;&gt;&apos;contactNumber&apos;&lt;/span&gt;, value: &lt;span class=&quot;code-quote&quot;&gt;&apos;8888888889007&apos;&lt;/span&gt;}, {key: &lt;span class=&quot;code-quote&quot;&gt;&apos;firstName&apos;&lt;/span&gt;, value: &lt;span class=&quot;code-quote&quot;&gt;&apos;James&apos;&lt;/span&gt;}, {key: &lt;span class=&quot;code-quote&quot;&gt;&apos;lastName&apos;&lt;/span&gt;, value: &lt;span class=&quot;code-quote&quot;&gt;&apos;Smith&apos;&lt;/span&gt;}, {key: &lt;span class=&quot;code-quote&quot;&gt;&apos;primaryEmail&apos;&lt;/span&gt;, value: &lt;span class=&quot;code-quote&quot;&gt;&apos;james9007@pcs.com&apos;&lt;/span&gt;}, {key: &lt;span class=&quot;code-quote&quot;&gt;&apos;roleName&apos;&lt;/span&gt;, value: &lt;span class=&quot;code-quote&quot;&gt;&apos;admin&apos;&lt;/span&gt;}, {key: &lt;span class=&quot;code-quote&quot;&gt;&apos;userName&apos;&lt;/span&gt;, value: &lt;span class=&quot;code-quote&quot;&gt;&apos;James9007&apos;&lt;/span&gt;}, {key: &lt;span class=&quot;code-quote&quot;&gt;&apos;userType&apos;&lt;/span&gt;, value: &lt;span class=&quot;code-quote&quot;&gt;&apos;some&apos;&lt;/span&gt;}, {key: &lt;span class=&quot;code-quote&quot;&gt;&apos;password&apos;&lt;/span&gt;, value: &lt;span class=&quot;code-quote&quot;&gt;&apos;James9007&apos;&lt;/span&gt;}] |               USER | 5a0dad10-7edf-11e4-8d47-4b86331ee8c7 |          0 |      ACTIVE | &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;

&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;3) Try search operation ( Select query with condition )&lt;/p&gt;
</comment>
                            <comment id="14253311" author="blerer" created="Fri, 19 Dec 2014 11:42:51 +0000"  >&lt;p&gt;On 2.1-HEAD none of the unit tests are failling for me. &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=philipthompson&quot; class=&quot;user-hover&quot; rel=&quot;philipthompson&quot;&gt;philipthompson&lt;/a&gt; can you still reproduces it?&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=madheswaran&quot; class=&quot;user-hover&quot; rel=&quot;madheswaran&quot;&gt;madheswaran&lt;/a&gt; I am not sure of why we cannot reproduce the problem. I went through your example but I got confused because some part were missing.&lt;/p&gt;

&lt;p&gt;If you could write me down all the queries that you execute (in the order in which you execute them), it will certainly help.&lt;br/&gt;
By queries I mean: create table statement, create index statements, insert statements and the failing select, &lt;/p&gt;
</comment>
                            <comment id="14253476" author="philipthompson" created="Fri, 19 Dec 2014 14:43:24 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=blerer&quot; class=&quot;user-hover&quot; rel=&quot;blerer&quot;&gt;blerer&lt;/a&gt;, with JDK 1.7.0_67 on OSX Mavericks, I am able to consistently reproduce the two failures I mentioned above. I will run the test on other machines to see if I can reproduce there as well, since you and Sylvain both are not able to reproduce.&lt;/p&gt;</comment>
                            <comment id="14253491" author="philipthompson" created="Fri, 19 Dec 2014 15:00:35 +0000"  >&lt;p&gt;The steps in testOneIndex, run through cqlsh, reproduce the problem for me. I am not yet sure why the unit tests are passing for you.&lt;/p&gt;</comment>
                            <comment id="14258684" author="madheswaran" created="Thu, 25 Dec 2014 08:42:29 +0000"  >&lt;p&gt;Any updates Philip or Benjamin.&lt;/p&gt;</comment>
                            <comment id="14269689" author="blerer" created="Thu, 8 Jan 2015 17:18:49 +0000"  >&lt;p&gt;I will look into it next week. Sorry, for the delay.&lt;/p&gt;</comment>
                            <comment id="14278688" author="blerer" created="Thu, 15 Jan 2015 13:57:32 +0000"  >&lt;p&gt;Good news: I can reproduce the problem using cqlsh.&lt;/p&gt;</comment>
                            <comment id="14280339" author="blerer" created="Fri, 16 Jan 2015 15:03:01 +0000"  >&lt;p&gt;It seems that there are 2 issues:&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;When retrieving the partition keys from the index they appear to not be in the correct order. If they have been inserted with a unit tests they are returned in the correct order but not if they have been inserted manually. This could means that the problem has occured during the index compaction.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;This problem is probably responsible for the fact that we had some trouble to reproduce the issue with some unit tests.&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;The second problem is that if a record is filtered out within &lt;tt&gt;CompositesSearcher&lt;/tt&gt; for a collection value index all the following records with the same prefix will be rejected.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;The second part of the problem can be reproduced with the following modified version of the &lt;tt&gt;testOneIndex&lt;/tt&gt; unit test:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;    @Test
    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void testOneIndex() &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; Throwable
    {
        &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; fieldmap = createType(&lt;span class=&quot;code-quote&quot;&gt;&quot;CREATE TYPE %s (key text, value text)&quot;&lt;/span&gt;);
        createTable(&lt;span class=&quot;code-quote&quot;&gt;&quot;CREATE TABLE %s (e &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; PRIMARY KEY, b &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;, f list&amp;lt;frozen&amp;lt;&quot;&lt;/span&gt; + fieldmap + &lt;span class=&quot;code-quote&quot;&gt;&quot;&amp;gt;&amp;gt;, s &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;)&quot;&lt;/span&gt;);
        createIndex(&lt;span class=&quot;code-quote&quot;&gt;&quot;CREATE INDEX ON %s(f)&quot;&lt;/span&gt;);
        &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt;(&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; i = 0; i &amp;lt; 17; i++)
        {
            execute(&lt;span class=&quot;code-quote&quot;&gt;&quot;INSERT INTO %s (e, b, f, s) VALUES (?, ?, [{key: &lt;span class=&quot;code-quote&quot;&gt;&apos;state&apos;&lt;/span&gt;, value: &lt;span class=&quot;code-quote&quot;&gt;&apos;Dubai&apos;&lt;/span&gt;}], ?)&quot;&lt;/span&gt;, i, i+1, 4);
        }
        &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt;(&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; i = 17; i &amp;lt; 20; i++)
        {
            execute(&lt;span class=&quot;code-quote&quot;&gt;&quot;INSERT INTO %s (e, b, f, s) VALUES (?, ?, [{key: &lt;span class=&quot;code-quote&quot;&gt;&apos;state&apos;&lt;/span&gt;, value: &lt;span class=&quot;code-quote&quot;&gt;&apos;Dubai&apos;&lt;/span&gt;}], ?)&quot;&lt;/span&gt;, i, i+1, 3);
        }
        UntypedResultSet resultSet = execute(&lt;span class=&quot;code-quote&quot;&gt;&quot;SELECT * FROM %s WHERE f CONTAINS {key: &lt;span class=&quot;code-quote&quot;&gt;&apos;state&apos;&lt;/span&gt;, value: &lt;span class=&quot;code-quote&quot;&gt;&apos;Dubai&apos;&lt;/span&gt;} AND s=3 allow filtering&quot;&lt;/span&gt;);
        Assert.assertEquals(3, resultSet.size());
    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="14282631" author="blerer" created="Mon, 19 Jan 2015 16:05:45 +0000"  >&lt;p&gt;My mistake, the order difference was due to the fact that I was using different partitioners with the shell and the unit tests.&lt;/p&gt;</comment>
                            <comment id="14282671" author="blerer" created="Mon, 19 Jan 2015 16:33:21 +0000"  >&lt;p&gt;The patch fix the problem in &lt;tt&gt;CompositesSearcher&lt;/tt&gt;.&lt;/p&gt;</comment>
                            <comment id="14282674" author="blerer" created="Mon, 19 Jan 2015 16:34:01 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=thobbs&quot; class=&quot;user-hover&quot; rel=&quot;thobbs&quot;&gt;thobbs&lt;/a&gt; can you review?&lt;/p&gt;</comment>
                            <comment id="14284090" author="thobbs" created="Tue, 20 Jan 2015 17:41:40 +0000"  >&lt;p&gt;+1, committed as 2445d4d09.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                                                <inwardlinks description="is duplicated by">
                                        <issuelink>
            <issuekey id="12775266">CASSANDRA-8810</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12685772" name="8421-unittest.txt" size="4621" author="philipthompson" created="Mon, 8 Dec 2014 16:38:22 +0000"/>
                            <attachment id="12693110" name="CASSANDRA-8421.txt" size="2466" author="blerer" created="Mon, 19 Jan 2015 16:33:21 +0000"/>
                            <attachment id="12685661" name="entity_data.csv" size="129537" author="madheswaran" created="Mon, 8 Dec 2014 04:52:03 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[blerer]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 44 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i231un:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12311421" key="com.atlassian.jira.plugin.system.customfieldtypes:multiversion">
                        <customfieldname>Reproduced In</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="12326774">2.1.1</customfieldvalue>
    <customfieldvalue id="12328841">2.1.2</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>thobbs</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[thobbs]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12962"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>