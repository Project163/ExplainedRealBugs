<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 23:07:50 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-11381] Node running with join_ring=false and authentication can not serve requests</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-11381</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;Starting up a node with &lt;tt&gt;-Dcassandra.join_ring=false&lt;/tt&gt; in a cluster that has authentication configured, eg PasswordAuthenticator, won&apos;t be able to serve requests. This is because &lt;tt&gt;Auth.setup()&lt;/tt&gt; never gets called during the startup.&lt;/p&gt;


&lt;p&gt;Without &lt;tt&gt;Auth.setup()&lt;/tt&gt; having been called in &lt;tt&gt;StorageService&lt;/tt&gt; clients connecting to the node fail with the node throwing&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;java.lang.NullPointerException
        at org.apache.cassandra.auth.PasswordAuthenticator.authenticate(PasswordAuthenticator.java:119)
        at org.apache.cassandra.thrift.CassandraServer.login(CassandraServer.java:1471)
        at org.apache.cassandra.thrift.Cassandra$Processor$login.getResult(Cassandra.java:3505)
        at org.apache.cassandra.thrift.Cassandra$Processor$login.getResult(Cassandra.java:3489)
        at org.apache.thrift.ProcessFunction.process(ProcessFunction.java:39)
        at org.apache.thrift.TBaseProcessor.process(TBaseProcessor.java:39)
        at com.thinkaurelius.thrift.Message.invoke(Message.java:314)
        at com.thinkaurelius.thrift.Message$Invocation.execute(Message.java:90)
        at com.thinkaurelius.thrift.TDisruptorServer$InvocationHandler.onEvent(TDisruptorServer.java:695)
        at com.thinkaurelius.thrift.TDisruptorServer$InvocationHandler.onEvent(TDisruptorServer.java:689)
        at com.lmax.disruptor.WorkProcessor.run(WorkProcessor.java:112)
        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1145)
        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:615)
        at java.lang.Thread.run(Thread.java:745)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The exception thrown from the &lt;a href=&quot;https://github.com/apache/cassandra/blob/cassandra-2.0.16/src/java/org/apache/cassandra/auth/PasswordAuthenticator.java#L119&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;code&lt;/a&gt;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;ResultMessage.Rows rows = authenticateStatement.execute(QueryState.forInternalCalls(), &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; QueryOptions(consistencyForUser(username),
                                                                                     Lists.newArrayList(ByteBufferUtil.bytes(username))));
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="12951429">CASSANDRA-11381</key>
            <summary>Node running with join_ring=false and authentication can not serve requests</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10002" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Normal</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="mck">Michael Semb Wever</assignee>
                                    <reporter username="mck">Michael Semb Wever</reporter>
                        <labels>
                    </labels>
                <created>Fri, 18 Mar 2016 03:19:59 +0000</created>
                <updated>Wed, 15 Oct 2025 09:49:03 +0000</updated>
                            <resolved>Tue, 13 Jun 2017 04:42:31 +0000</resolved>
                                        <fixVersion>2.2.10</fixVersion>
                    <fixVersion>3.0.14</fixVersion>
                    <fixVersion>3.11.0</fixVersion>
                    <fixVersion>4.0-alpha1</fixVersion>
                    <fixVersion>4.0</fixVersion>
                                        <due></due>
                            <votes>1</votes>
                                    <watches>13</watches>
                                                                                                                <comments>
                            <comment id="15201666" author="jmckenzie" created="Fri, 18 Mar 2016 15:46:22 +0000"  >&lt;p&gt;Is this ticket Patch Available?&lt;/p&gt;</comment>
                            <comment id="15202064" author="michaelsembwever" created="Fri, 18 Mar 2016 20:09:36 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=JoshuaMcKenzie&quot; class=&quot;user-hover&quot; rel=&quot;JoshuaMcKenzie&quot;&gt;JoshuaMcKenzie&lt;/a&gt;, I&apos;ve only run unit tests against trunk. And I&apos;m trying to figure out how to write a dtest for this (since unit tests and system property don&apos;t mix (afaik)).&lt;/p&gt;

&lt;p&gt;If you&apos;re happy to proceed without the dtest, say and I&apos;ll &apos;submit patch&apos;. And I do want to double-check that it&apos;s not possible to create auth tables without even the system tables having been created (eg bootstrap &amp;amp; join_ring=false).&lt;/p&gt;</comment>
                            <comment id="15204660" author="jmckenzie" created="Mon, 21 Mar 2016 17:17:38 +0000"  >&lt;blockquote&gt;&lt;p&gt;trying to figure out how to write a dtest for this&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;I say we hold off until you&apos;ve worked out a dtest for it. Just wanted to make sure there wasn&apos;t a patch waiting for it and it slip through the cracks.&lt;/p&gt;</comment>
                            <comment id="15207726" author="michaelsembwever" created="Wed, 23 Mar 2016 01:57:46 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=JoshuaMcKenzie&quot; class=&quot;user-hover&quot; rel=&quot;JoshuaMcKenzie&quot;&gt;JoshuaMcKenzie&lt;/a&gt;, the dtest is attached.&lt;/p&gt;</comment>
                            <comment id="15213410" author="michaelsembwever" created="Sun, 27 Mar 2016 09:58:34 +0000"  >&lt;p&gt;Small update to the dtest. I had been writing dtests in the trunk branch instead of master. More info &lt;a href=&quot;https://github.com/pcmanus/ccm/pull/479&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;here&lt;/a&gt; and &lt;a href=&quot;https://github.com/riptano/cassandra-dtest/pull/892&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;here&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="15249315" author="michaelsembwever" created="Wed, 20 Apr 2016 05:54:19 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=JoshuaMcKenzie&quot; class=&quot;user-hover&quot; rel=&quot;JoshuaMcKenzie&quot;&gt;JoshuaMcKenzie&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jkni&quot; class=&quot;user-hover&quot; rel=&quot;jkni&quot;&gt;jkni&lt;/a&gt;, what&apos;s up?&lt;/p&gt;</comment>
                            <comment id="15249979" author="jkni" created="Wed, 20 Apr 2016 14:22:11 +0000"  >&lt;p&gt;No fault of Josh here, just a bit of a review backlog on my end. Promise I&apos;ll get to this today, sorry for the delay &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mck&quot; class=&quot;user-hover&quot; rel=&quot;mck&quot;&gt;mck&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="15251385" author="jkni" created="Thu, 21 Apr 2016 06:37:55 +0000"  >&lt;p&gt;Thanks for the patches &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mck&quot; class=&quot;user-hover&quot; rel=&quot;mck&quot;&gt;mck&lt;/a&gt; and apologies for the delay again. This is at the top of my queue now, so I can work on getting this in quickly.&lt;/p&gt;

&lt;p&gt;I can confirm that this is a genuine issue - a few thoughts on the patches:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;Is there a reason that we only setup auth in &lt;tt&gt;StorageService.initServer&lt;/tt&gt; if the saved tokens aren&apos;t empty? This doesn&apos;t handle the case when a node starts with join_ring false on its first boot (a coordinator-only node). This can be reproduced with a small variant of your dtest in which we do not start node3 in the initial preparation. Some experimentation on my end suggests this would be fine.&lt;/li&gt;
	&lt;li&gt;On a similar note, is there a reason we can&apos;t just move auth setup slightly earlier in &lt;tt&gt;StorageService.initServer()&lt;/tt&gt;? If we moved it before the check of the join_ring property, we could do without the idempotency parts of the patches. Again, this looks workable in my experimentation.&lt;/li&gt;
	&lt;li&gt;Was there any method by which you arrived at the 300 second timeouts for the cql connection on the dtests? This really drags the test on in failing cases, and I was able to reduce it to 30 seconds without any false negatives.&lt;/li&gt;
	&lt;li&gt;Tests handling the coordinator-only case and using JMX to join the node to the ring would be great. I think a minimal parameterized test could handle these all these permutations.&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="15257906" author="michaelsembwever" created="Tue, 26 Apr 2016 11:11:00 +0000"  >&lt;blockquote&gt;&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Is there a reason that we only setup auth in StorageService.initServer if the saved tokens aren&apos;t empty? This doesn&apos;t handle the case when a node starts with join_ring false on its first boot (a coordinator-only node). This can be reproduced with a small variant of your dtest in which we do not start node3 in the initial preparation. Some experimentation on my end suggests this would be fine.&lt;/li&gt;
&lt;/ul&gt;
&lt;/blockquote&gt;

&lt;p&gt;Good point. Will fix. There&apos;s a similar fault in the trunk patch in regards to &lt;tt&gt;isSurveyMode&lt;/tt&gt;.&lt;/p&gt;

&lt;blockquote&gt;&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;On a similar note, is there a reason we can&apos;t just move auth setup slightly earlier in StorageService.initServer()? If we moved it before the check of the join_ring property, we could do without the idempotency parts of the patches. Again, this looks workable in my experimentation.&lt;/li&gt;
&lt;/ul&gt;
&lt;/blockquote&gt;

&lt;p&gt;That did seem like the cleaner solution. But my understanding on the auth model and setup isn&apos;t solid, so my intention here was to offer the less-risk patch. I still suspect this (less-risk approach) is the smart approach (for a patch from me) against the non-trunk patches.&lt;/p&gt;

&lt;p&gt;I&apos;ll take a look at moving the auth setup to an earlier place in just the trunk patch, ok? It seems to make sense to move the call in &lt;tt&gt;prepareToJoin()&lt;/tt&gt;.&lt;/p&gt;

&lt;blockquote&gt;&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Was there any method by which you arrived at the 300 second timeouts for the cql connection on the dtests? This really drags the test on in failing cases, and I was able to reduce it to 30 seconds without any false negatives.&lt;/li&gt;
&lt;/ul&gt;
&lt;/blockquote&gt;

&lt;p&gt;No. Just playing it safe for my dual-core thinkpad. (I did have to bump it up once).&lt;/p&gt;

&lt;blockquote&gt;&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Tests handling the coordinator-only case and using JMX to join the node to the ring would be great. I think a minimal parameterized test could handle these all these permutations.&lt;/li&gt;
&lt;/ul&gt;
&lt;/blockquote&gt;

&lt;p&gt;I&apos;ll take a look.&lt;/p&gt;</comment>
                            <comment id="15258156" author="jkni" created="Tue, 26 Apr 2016 14:23:04 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mck&quot; class=&quot;user-hover&quot; rel=&quot;mck&quot;&gt;mck&lt;/a&gt;, I definitely understand the inclination toward a lower-risk approach. &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=beobal&quot; class=&quot;user-hover&quot; rel=&quot;beobal&quot;&gt;beobal&lt;/a&gt;, as resident person-who-I-know-knows-how-auth-works, do you have any time to weigh in on whether moving auth setup earlier &lt;tt&gt;StorageService.initServer()&lt;/tt&gt; is a risky proposition for any reason? I&apos;ve done some research and couldn&apos;t find any cause for concern. In particular, this ticket would be simpler to fix if auth was moved before join_ring on 2.1/2.2/3.0.x and before start_gossip on trunk.&lt;/p&gt;</comment>
                            <comment id="15258241" author="beobal" created="Tue, 26 Apr 2016 15:13:44 +0000"  >&lt;p&gt;Auth setup has to wait until the node has joined the ring in order to be able to use the auth tables, as &lt;tt&gt;system_auth&lt;/tt&gt; is distributed. The same applies to the other pseudo-system keyspaces &lt;tt&gt;system_traces&lt;/tt&gt; &amp;amp; &lt;tt&gt;system_distributed&lt;/tt&gt; which is why those are also created in &lt;tt&gt;joinTokenRing&lt;/tt&gt;. &lt;/p&gt;</comment>
                            <comment id="15258251" author="beobal" created="Tue, 26 Apr 2016 15:16:26 +0000"  >&lt;p&gt;On top of that, custom authenticator/authorizer/rolemanager impls may well use their own tables (&amp;amp; possibly other resources), which would obviously be user-defined from a system perspective and so also not accessible before joining.&lt;/p&gt;</comment>
                            <comment id="15258492" author="beobal" created="Tue, 26 Apr 2016 17:18:34 +0000"  >&lt;p&gt;Giving it some further thought, I think that the moving &lt;tt&gt;doAuthSetup&lt;/tt&gt; to before joining is only going to be problematic for the first node in a fresh cluster, and then only if it doesn&apos;t join (at least in 3.0+). Starting a new coordinator-only node in an existing cluster should be fine, and re-starting an existing node without joining should also be ok, as long as the replication of &lt;tt&gt;system_auth&lt;/tt&gt; can cope with it. &lt;/p&gt;</comment>
                            <comment id="15259507" author="jkni" created="Wed, 27 Apr 2016 04:12:12 +0000"  >&lt;p&gt;I&apos;ve tested some scenarios and can confirm that the scenario Sam described above is problematic.&lt;/p&gt;

&lt;p&gt;Another concern I have is potentially performing auth setup before a node is added to its own TokenMetadata in the join_ring false case. It seems to me that this might cause problems with our own implementations and could feasibly cause problems for 3rd party implementations, so I think the original approach of handling auth setup down both branches may be worth pursuing here in the interest of safety.&lt;/p&gt;

&lt;p&gt;On trunk, we have another property &quot;start_gossip&quot; that stops &lt;tt&gt;StorageService.initServer&lt;/tt&gt; even earlier - I don&apos;t think we can support auth at this point, so I don&apos;t care about supporting it in this ticket (my earlier comment hinted at the fact that I was considering whether it was in scope).&lt;/p&gt;</comment>
                            <comment id="15405706" author="michaelsembwever" created="Wed, 3 Aug 2016 10:35:35 +0000"  >&lt;p&gt;Coming back to this issue now.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;I&apos;ve tested some scenarios and can confirm that the scenario Sam described above is problematic.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jkni&quot; class=&quot;user-hover&quot; rel=&quot;jkni&quot;&gt;jkni&lt;/a&gt;, which scenario Sam describes?&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;...so I think the original approach of handling auth setup down both branches may be worth pursuing here in the interest of safety.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;So I&apos;ve uploaded new patches for 2.1 and dtest that  &lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;set up auth also when tokens are empty&lt;/li&gt;
	&lt;li&gt;add a dtest to test ^^&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Working on the other patches.&lt;/p&gt;</comment>
                            <comment id="15405823" author="michaelsembwever" created="Wed, 3 Aug 2016 12:12:25 +0000"  >&lt;p&gt;&#8230;and reduced the timeouts in the dtest to 30 seconds.&lt;/p&gt;

&lt;p&gt;All patches are updated.&lt;/p&gt;</comment>
                            <comment id="15406471" author="jkni" created="Wed, 3 Aug 2016 19:24:55 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mck&quot; class=&quot;user-hover&quot; rel=&quot;mck&quot;&gt;mck&lt;/a&gt; - The scenario I was referring to was moving &lt;tt&gt;doAuthSetup&lt;/tt&gt; to before joining for the first node in a fresh cluster.&lt;/p&gt;

&lt;p&gt;Thanks for keeping this moving. This is near the top of my review queue and I should be able to get to it soon.&lt;/p&gt;</comment>
                            <comment id="15553759" author="michaelsembwever" created="Fri, 7 Oct 2016 01:15:59 +0000"  >&lt;p&gt;ping. is there anything outstanding here?&lt;/p&gt;</comment>
                            <comment id="15643032" author="michaelsembwever" created="Mon, 7 Nov 2016 04:02:32 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jkni&quot; class=&quot;user-hover&quot; rel=&quot;jkni&quot;&gt;jkni&lt;/a&gt; ping&#8230;?  &lt;/p&gt;</comment>
                            <comment id="15645280" author="jkni" created="Mon, 7 Nov 2016 20:10:08 +0000"  >&lt;p&gt;Thanks for pinging me on this - as you suspected, it slipped through the cracks. &lt;/p&gt;

&lt;p&gt;On reviewing the final version of this patch, I found one problem with the 2.2+ patches. The proposed patch technically breaks the documented &lt;tt&gt;IRoleManager&lt;/tt&gt;, &lt;tt&gt;IAuthenticator&lt;/tt&gt;, and &lt;tt&gt;IAuthorizer&lt;/tt&gt; interfaces. With the implementation given, &lt;tt&gt;doAuthSetup&lt;/tt&gt; will be called twice for a node started with &lt;tt&gt;join_ring=False&lt;/tt&gt;, so &lt;tt&gt;setup()&lt;/tt&gt; will be called twice for the role manager, authenticator, and authorizer. In the documentation for these three public interfaces, we state that &lt;tt&gt;setup()&lt;/tt&gt; will only be called once after starting a node. I think we should preserve this documented behavior. While slightly less elegant, I think we should instead track whether we&apos;ve run &lt;tt&gt;doAuthSetup&lt;/tt&gt; and not repeat this call for a node started with &lt;tt&gt;join_ring=False&lt;/tt&gt; that is asked to join. This means the parts of the patch implementing idempotency for the MigrationManager listener registration become unnecessary.&lt;/p&gt;</comment>
                            <comment id="15671505" author="michaelsembwever" created="Wed, 16 Nov 2016 20:22:32 +0000"  >&lt;p&gt;Makes sense, will update patches&#8230;&lt;/p&gt;</comment>
                            <comment id="15674659" author="michaelsembwever" created="Thu, 17 Nov 2016 19:59:34 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jkni&quot; class=&quot;user-hover&quot; rel=&quot;jkni&quot;&gt;jkni&lt;/a&gt;, all patches (but 2.1) have been updated.&lt;/p&gt;</comment>
                            <comment id="15704157" author="jkni" created="Tue, 29 Nov 2016 04:35:31 +0000"  >&lt;p&gt;Thanks - the patches look good and I put them through CI.&lt;/p&gt;

&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;branch&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;testall&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;dtest&lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/jkni/cassandra/tree/CASSANDRA-11381-2.2&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;CASSANDRA-11381-2.2&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/jkni/job/jkni-CASSANDRA-11381-2.2-testall&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;testall&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/jkni/job/jkni-CASSANDRA-11381-2.2-dtest&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;dtest&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/jkni/cassandra/tree/CASSANDRA-11381-3.0&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;CASSANDRA-11381-3.0&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/jkni/job/jkni-CASSANDRA-11381-3.0-testall&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;testall&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/jkni/job/jkni-CASSANDRA-11381-3.0-dtest&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;dtest&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/jkni/cassandra/tree/CASSANDRA-11381-3.X&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;CASSANDRA-11381-3.X&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/jkni/job/jkni-CASSANDRA-11381-3.X-testall&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;testall&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/jkni/job/jkni-CASSANDRA-11381-3.X-dtest&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;dtest&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/jkni/cassandra/tree/CASSANDRA-11381-trunk&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;CASSANDRA-11381-trunk&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/jkni/job/jkni-CASSANDRA-11381-trunk-testall&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;testall&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/jkni/job/jkni-CASSANDRA-11381-trunk-dtest&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;dtest&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;


&lt;p&gt;CI looks good for the most part, and I checked that your added dtest passes on all branches. CI revealed one small problem - when a fresh node is started with join_ring=False that has no tokens for other nodes discovered through gossip and no saved tokens, it hits an AssertionError in &lt;tt&gt;CassandraRoleManager&lt;/tt&gt; setup that is not handled and gets logged as an error by a top level error handler, as seen &lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/jkni/job/jkni-CASSANDRA-11381-2.2-dtest/1/testReport/junit/topology_test/TestTopology/do_not_join_ring_test/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;here&lt;/a&gt;. In this specific test case, this behavior is hit because a single node cluster is started with join_ring=False. Since this prevents setup from being retried within the &lt;tt&gt;CassandraRoleManager&lt;/tt&gt;, it seems to me that it is probably worth checking for an absence of tokens in &lt;tt&gt;CassandraRoleManager.setupDefaultRole&lt;/tt&gt; and throwing a catchable exception/printing a warning so that setup can be retried. What do you think? There may be another alternative I haven&apos;t considered.&lt;/p&gt;</comment>
                            <comment id="15994472" author="michaelsembwever" created="Wed, 3 May 2017 08:31:25 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jkni&quot; class=&quot;user-hover&quot; rel=&quot;jkni&quot;&gt;jkni&lt;/a&gt;, i have finally come back to this&#8230;&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;CI revealed one small problem - when a fresh node is started with join_ring=False that has no tokens for other nodes discovered through gossip and no saved tokens, it hits an AssertionError in CassandraRoleManager setup that is not handled&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;&lt;tt&gt;CassandraRoleManager.setupDefaultRole()&lt;/tt&gt; now throws an &lt;tt&gt;IllegalStateException&lt;/tt&gt; if there are no known tokens in the ring. This permits &lt;tt&gt;CassandraRoleManager.scheduleSetupTask(..)&lt;/tt&gt; to retry.&lt;/p&gt;

&lt;p&gt;The &lt;tt&gt;topology_test.py:TestTopology.do_not_join_ring_test&lt;/tt&gt; dtest looks ok now, locally.&lt;/p&gt;

&lt;p&gt;&lt;br class=&quot;atl-forced-newline&quot; /&gt;&lt;/p&gt;

&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt; branch &lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt; testall &lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt; dtest &lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;a href=&quot;https://github.com/michaelsembwever/cassandra/tree/mck/cassandra-2.2_11381&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;cassandra-2.2_11381&lt;/a&gt;	&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;a href=&quot;https://circleci.com/gh/michaelsembwever/cassandra/tree/mck%2Fcassandra-2.2_11381&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;testall&lt;/a&gt;	&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;a href=&quot;https://builds.apache.org/view/A-D/view/Cassandra/job/Cassandra-devbranch-dtest/40/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;dtest&lt;/a&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;a href=&quot;https://github.com/michaelsembwever/cassandra/tree/mck/cassandra-3.0_11381&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;cassandra-3.0_11381&lt;/a&gt;	&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;a href=&quot;https://circleci.com/gh/michaelsembwever/cassandra/tree/mck%2Fcassandra-3.0_11381&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;testall&lt;/a&gt;	&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;a href=&quot;https://builds.apache.org/view/A-D/view/Cassandra/job/Cassandra-devbranch-dtest/41/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;dtest&lt;/a&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;a href=&quot;https://github.com/michaelsembwever/cassandra/tree/mck/cassandra-3.11_11381&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;cassandra-3.11_11381&lt;/a&gt;	&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;a href=&quot;https://circleci.com/gh/michaelsembwever/cassandra/tree/mck%2Fcassandra-3.11_11381&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;testall&lt;/a&gt;	&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;a href=&quot;https://builds.apache.org/view/A-D/view/Cassandra/job/Cassandra-devbranch-dtest/42/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;dtest&lt;/a&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;a href=&quot;https://github.com/michaelsembwever/cassandra/tree/mck/trunk_11381&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;trunk_11381&lt;/a&gt;	&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;a href=&quot;https://circleci.com/gh/michaelsembwever/cassandra/tree/mck%2Ftrunk_11381&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;testall&lt;/a&gt;	&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;a href=&quot;https://builds.apache.org/view/A-D/view/Cassandra/job/Cassandra-devbranch-dtest/43/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;dtest&lt;/a&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;


&lt;p&gt;(the asf jenkins dtests take a while, and won&apos;t include the new &lt;a href=&quot;https://github.com/michaelsembwever/cassandra-dtest/tree/mck/master_11381&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;dtest&lt;/a&gt;)&lt;/p&gt;</comment>
                            <comment id="16003987" author="michaelsembwever" created="Wed, 10 May 2017 03:43:00 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jkni&quot; class=&quot;user-hover&quot; rel=&quot;jkni&quot;&gt;jkni&lt;/a&gt;, dtests look good. are we ready to commit this?&lt;/p&gt;</comment>
                            <comment id="16026830" author="jkni" created="Fri, 26 May 2017 20:57:27 +0000"  >&lt;p&gt;Thanks - this looks just about good. A few comments:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;The 3.0 branch looks like it is an older version of the patch than the 2.2, 3.11, and trunk patches - it&apos;s missing the atomic guard ensuring we only run the set up one. Is this just an oversight?&lt;/li&gt;
	&lt;li&gt;The new exception looks good, but the condition is too restrictive. We&apos;ll only hit an error when there are no tokens in the ring; the attached patch fails whenever the local node has no tokens, even if there are other tokens in the ring. Changing the condition to something like &lt;tt&gt;StorageService.instance.getTokenMetadata().sortedTokens().isEmpty()&lt;/tt&gt; should suffice.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;It would be great it we could cut down the time the new tests take to run. I have a few suggestions that I&apos;ll post on the dtest PR once this is ready to go.&lt;/p&gt;</comment>
                            <comment id="16036497" author="michaelsembwever" created="Mon, 5 Jun 2017 03:48:39 +0000"  >&lt;blockquote&gt;&lt;p&gt;The 3.0 branch looks like it is an older version of the patch than the 2.2, 3.11, and trunk patches - it&apos;s missing the atomic guard ensuring we only run the set up one. Is this just an oversight?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Yes, thanks for catching that. Has been corrected.&lt;/p&gt;


&lt;blockquote&gt;&lt;p&gt;The new exception looks good, but the condition is too restrictive. &lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;The condition has been changed to use &lt;tt&gt;StorageService.instance.getTokenMetadata().sortedTokens().isEmpty()&lt;/tt&gt;.&lt;/p&gt;

&lt;p&gt;&amp;#8211;&lt;br/&gt;
All four patches updated (and rebased):&lt;/p&gt;

&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt; branch &lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt; testall &lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt; dtest &lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;a href=&quot;https://github.com/michaelsembwever/cassandra/tree/mck/cassandra-2.2_11381&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;cassandra-2.2_11381&lt;/a&gt;	&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;a href=&quot;https://circleci.com/gh/michaelsembwever/cassandra/tree/mck%2Fcassandra-2.2_11381&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;testall&lt;/a&gt;	&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;a href=&quot;https://builds.apache.org/view/A-D/view/Cassandra/job/Cassandra-devbranch-dtest/85&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;dtest&lt;/a&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;a href=&quot;https://github.com/michaelsembwever/cassandra/tree/mck/cassandra-3.0_11381&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;cassandra-3.0_11381&lt;/a&gt;	&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;a href=&quot;https://circleci.com/gh/michaelsembwever/cassandra/tree/mck%2Fcassandra-3.0_11381&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;testall&lt;/a&gt;	&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;a href=&quot;https://builds.apache.org/view/A-D/view/Cassandra/job/Cassandra-devbranch-dtest/84&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;dtest&lt;/a&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;a href=&quot;https://github.com/michaelsembwever/cassandra/tree/mck/cassandra-3.11_11381&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;cassandra-3.11_11381&lt;/a&gt;	&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;a href=&quot;https://circleci.com/gh/michaelsembwever/cassandra/tree/mck%2Fcassandra-3.11_11381&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;testall&lt;/a&gt;	&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;a href=&quot;https://builds.apache.org/view/A-D/view/Cassandra/job/Cassandra-devbranch-dtest/83&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;dtest&lt;/a&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;a href=&quot;https://github.com/michaelsembwever/cassandra/tree/mck/trunk_11381&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;trunk_11381&lt;/a&gt;	&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;a href=&quot;https://circleci.com/gh/michaelsembwever/cassandra/tree/mck%2Ftrunk_11381&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;testall&lt;/a&gt;	&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;a href=&quot;https://builds.apache.org/view/A-D/view/Cassandra/job/Cassandra-devbranch-dtest/82&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;dtest&lt;/a&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;


&lt;p&gt;All dtests are waiting on &lt;del&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/INFRA-14153&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;INFRA-14153&lt;/a&gt;&lt;/del&gt;.&lt;br/&gt;
EDIT: dtests are running now.&lt;/p&gt;</comment>
                            <comment id="16046602" author="jkni" created="Mon, 12 Jun 2017 14:12:27 +0000"  >&lt;p&gt;Great! I also ran dtests on some other machines this weekend and they looked good on all branches (relative to the current state of the branches).&lt;/p&gt;

&lt;p&gt;+1 - one minor nit that can be fixed on commit: new CHANGES.txt entries should go at the top of the list.&lt;/p&gt;</comment>
                            <comment id="16047363" author="michaelsembwever" created="Tue, 13 Jun 2017 03:02:04 +0000"  >&lt;blockquote&gt;&lt;p&gt;one minor nit that can be fixed on commit: new CHANGES.txt entries should go at the top of the list.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I had no idea! &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; One of those tribal habits that one either notices or doesn&apos;t&#8230; thanks for pointing it out.&lt;/p&gt;

&lt;p&gt;Will correct CHANGES.txt, and commit&#8230;&lt;/p&gt;</comment>
                            <comment id="16047430" author="michaelsembwever" created="Tue, 13 Jun 2017 05:15:32 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jkni&quot; class=&quot;user-hover&quot; rel=&quot;jkni&quot;&gt;jkni&lt;/a&gt;, work on the dtest in &lt;a href=&quot;https://github.com/riptano/cassandra-dtest/pull/1479&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/riptano/cassandra-dtest/pull/1479&lt;/a&gt;&lt;br/&gt;
You said you had some ideas about making it faster/more-efficient.&lt;/p&gt;</comment>
                            <comment id="16368733" author="githubbot" created="Mon, 19 Feb 2018 01:16:00 +0000"  >&lt;p&gt;GitHub user michaelsembwever opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/cassandra-dtest/pull/19&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/cassandra-dtest/pull/19&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    New test for &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-11381&quot; title=&quot;Node running with join_ring=false and authentication can not serve requests&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-11381&quot;&gt;&lt;del&gt;CASSANDRA-11381&lt;/del&gt;&lt;/a&gt;: Node running with join_ring=false and authentication can not serve requests&lt;/p&gt;

&lt;p&gt;    Follow up to &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-11381&quot; title=&quot;Node running with join_ring=false and authentication can not serve requests&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-11381&quot;&gt;&lt;del&gt;CASSANDRA-11381&lt;/del&gt;&lt;/a&gt; and &lt;a href=&quot;https://github.com/riptano/cassandra-dtest/pull/1479&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/riptano/cassandra-dtest/pull/1479&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    I think the concerns raised previously &lt;a href=&quot;https://github.com/riptano/cassandra-dtest/pull/1479#issuecomment-315443711&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;here&lt;/a&gt; have been addressed. fyi @jkni , @ptnapoleon &lt;/p&gt;

&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/thelastpickle/cassandra-dtest&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/thelastpickle/cassandra-dtest&lt;/a&gt; mck/master_11381&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/cassandra-dtest/pull/19.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/cassandra-dtest/pull/19.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #19&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit e6daf37605e50964fdc0a141e927b37d715b6820&lt;br/&gt;
Author: mck &amp;lt;mick@...&amp;gt;&lt;br/&gt;
Date:   2017-05-03T08:29:10Z&lt;/p&gt;

&lt;p&gt;    New test for &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-11381&quot; title=&quot;Node running with join_ring=false and authentication can not serve requests&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-11381&quot;&gt;&lt;del&gt;CASSANDRA-11381&lt;/del&gt;&lt;/a&gt;: Node running with join_ring=false and authentication can not serve requests&lt;/p&gt;

&lt;p&gt;    Patch by Mick Semb Wever; Reviewed by XXX for &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-11381&quot; title=&quot;Node running with join_ring=false and authentication can not serve requests&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-11381&quot;&gt;&lt;del&gt;CASSANDRA-11381&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="16368978" author="githubbot" created="Mon, 19 Feb 2018 10:41:27 +0000"  >&lt;p&gt;Github user ptnapoleon commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/cassandra-dtest/pull/19#discussion_r169038355&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/cassandra-dtest/pull/19#discussion_r169038355&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: auth_join_ring_false_test.py &amp;#8212;&lt;br/&gt;
    @@ -0,0 +1,212 @@&lt;br/&gt;
    +import pytest&lt;br/&gt;
    +import logging&lt;br/&gt;
    +&lt;br/&gt;
    +from cassandra import AuthenticationFailed, Unauthorized&lt;br/&gt;
    +from cassandra.cluster import NoHostAvailable&lt;br/&gt;
    +&lt;br/&gt;
    +from dtest import Tester&lt;br/&gt;
    +&lt;br/&gt;
    +&lt;br/&gt;
    +class TestAuth(Tester):&lt;br/&gt;
    +&lt;br/&gt;
    +&lt;br/&gt;
    +    def test_login_existing_node(self):&lt;br/&gt;
    +        &quot;&quot;&quot;&lt;br/&gt;
    +        * Launch a three node cluster&lt;br/&gt;
    +        * Restart the third node in `join_ring=false` mode&lt;br/&gt;
    +        * Connect as the default user/password&lt;br/&gt;
    +        * Verify that default user w/ bad password gives AuthenticationFailed exception&lt;br/&gt;
    +        * Verify that bad user gives AuthenticationFailed exception&lt;br/&gt;
    +        #&quot;&quot;&quot;&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    Seems like there&apos;s a loose # here?&lt;/p&gt;</comment>
                            <comment id="16369529" author="githubbot" created="Mon, 19 Feb 2018 21:16:14 +0000"  >&lt;p&gt;Github user michaelsembwever commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/cassandra-dtest/pull/19#discussion_r169173002&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/cassandra-dtest/pull/19#discussion_r169173002&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: auth_join_ring_false_test.py &amp;#8212;&lt;br/&gt;
    @@ -0,0 +1,212 @@&lt;br/&gt;
    +import pytest&lt;br/&gt;
    +import logging&lt;br/&gt;
    +&lt;br/&gt;
    +from cassandra import AuthenticationFailed, Unauthorized&lt;br/&gt;
    +from cassandra.cluster import NoHostAvailable&lt;br/&gt;
    +&lt;br/&gt;
    +from dtest import Tester&lt;br/&gt;
    +&lt;br/&gt;
    +&lt;br/&gt;
    +class TestAuth(Tester):&lt;br/&gt;
    +&lt;br/&gt;
    +&lt;br/&gt;
    +    def test_login_existing_node(self):&lt;br/&gt;
    +        &quot;&quot;&quot;&lt;br/&gt;
    +        * Launch a three node cluster&lt;br/&gt;
    +        * Restart the third node in `join_ring=false` mode&lt;br/&gt;
    +        * Connect as the default user/password&lt;br/&gt;
    +        * Verify that default user w/ bad password gives AuthenticationFailed exception&lt;br/&gt;
    +        * Verify that bad user gives AuthenticationFailed exception&lt;br/&gt;
    +        #&quot;&quot;&quot;&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    oops. fixed.&lt;/p&gt;</comment>
                            <comment id="16387566" author="githubbot" created="Tue, 6 Mar 2018 10:13:43 +0000"  >&lt;p&gt;Github user michaelsembwever commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/cassandra-dtest/pull/19&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/cassandra-dtest/pull/19&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    @ptnapoleon ping&lt;/p&gt;</comment>
                            <comment id="16388839" author="githubbot" created="Wed, 7 Mar 2018 01:20:40 +0000"  >&lt;p&gt;Github user michaelsembwever commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/cassandra-dtest/pull/19&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/cassandra-dtest/pull/19&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;gt;  I believe pep8 will complain about the lack of a new line at the bottom&lt;/p&gt;

&lt;p&gt;    I did not know about that! Fixed.&lt;/p&gt;

&lt;p&gt;    Will merge.&lt;/p&gt;</comment>
                            <comment id="16388905" author="githubbot" created="Wed, 7 Mar 2018 02:16:12 +0000"  >&lt;p&gt;Github user asfgit closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/cassandra-dtest/pull/19&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/cassandra-dtest/pull/19&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[mck]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 36 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2uv6v:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12311421" key="com.atlassian.jira.plugin.system.customfieldtypes:multiversion">
                        <customfieldname>Reproduced In</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="12332369">2.0.16</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>jkni</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[jkni]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12962"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12311420" key="com.atlassian.jira.plugin.system.customfieldtypes:version">
                        <customfieldname>Since Version</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="12332369">2.0.16</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>