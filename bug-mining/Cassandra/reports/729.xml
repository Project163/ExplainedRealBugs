<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 22:19:25 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-2183] memtable_flush_after_mins setting not working</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-2183</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;We have observed the behavior that memtable_flush_after_mins setting not working occasionally.   After some testing and code digging, we finally figured out what going on.&lt;br/&gt;
The memtable_flush_after_mins won&apos;t work on certain condition with current implementation in Cassandra.&lt;/p&gt;

&lt;p&gt;In org.apache.cassandra.db.Table,  the scheduled flush task is setup by the following code during construction.&lt;/p&gt;

&lt;p&gt;------------------------------------------------------------------------------------------------------------------&lt;br/&gt;
int minCheckMs = Integer.MAX_VALUE;&lt;/p&gt;

&lt;p&gt;for (ColumnFamilyStore cfs : columnFamilyStores.values())  &lt;br/&gt;
{&lt;br/&gt;
    minCheckMs = Math.min(minCheckMs, cfs.getMemtableFlushAfterMins() * 60 * 1000);&lt;br/&gt;
}&lt;/p&gt;

&lt;p&gt;Runnable runnable = new Runnable()&lt;br/&gt;
{&lt;br/&gt;
   public void run()&lt;br/&gt;
   {&lt;br/&gt;
       for (ColumnFamilyStore cfs : columnFamilyStores.values())&lt;/p&gt;
       {
           cfs.forceFlushIfExpired();
       }
&lt;p&gt;   }&lt;br/&gt;
};&lt;br/&gt;
flushTask = StorageService.scheduledTasks.scheduleWithFixedDelay(runnable, minCheckMs, minCheckMs, TimeUnit.MILLISECONDS);&lt;br/&gt;
------------------------------------------------------------------------------------------------------------------------------&lt;/p&gt;

&lt;p&gt;Now for our application, we will create a keyspacewithout without any columnfamily first.  And only add needed columnfamily later depends on request.&lt;/p&gt;

&lt;p&gt;However, when keyspacegot created (without any columnfamily ), the above code will actually schedule a fixed delay flush check task with Integer.MAX_VALUE ms&lt;br/&gt;
since there is no columnfamily yet.&lt;/p&gt;

&lt;p&gt;Later when you add columnfamily to this empty keyspace, the initCf() method in Table.java doesn&apos;t check whether the scheduled flush check task interval need&lt;br/&gt;
to be updated or not.   To fix this, we&apos;d need to restart the Cassandra after columnfamily added into the keyspace. &lt;/p&gt;

&lt;p&gt;I would suggest that add additional logic in initCf() method to recreate a scheduled flush check task if needed.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12498922">CASSANDRA-2183</key>
            <summary>memtable_flush_after_mins setting not working</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10003" iconUrl="https://issues.apache.org/jira/images/icons/priorities/trivial.svg">Low</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="jbellis">Jonathan Ellis</assignee>
                                    <reporter username="chenyy">Ching-cheng</reporter>
                        <labels>
                    </labels>
                <created>Thu, 17 Feb 2011 16:51:30 +0000</created>
                <updated>Tue, 16 Apr 2019 09:33:06 +0000</updated>
                            <resolved>Wed, 23 Feb 2011 04:57:32 +0000</resolved>
                                        <fixVersion>0.7.3</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                    <workratio workratioPercent="0"/>
                                    <progress percentage="0">
                                    <originalProgress>
                                                    <row percentage="100" backgroundColor="#89afd7"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="0" backgroundColor="#51a825"/>
                                                    <row percentage="100" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="0">
                                    <originalProgress>
                                                    <row percentage="100" backgroundColor="#89afd7"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="0" backgroundColor="#51a825"/>
                                                    <row percentage="100" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                    <timeoriginalestimate seconds="3600">1h</timeoriginalestimate>
                            <timeestimate seconds="3600">1h</timeestimate>
                                        <comments>
                            <comment id="12995916" author="jbellis" created="Thu, 17 Feb 2011 16:57:32 +0000"  >&lt;p&gt;The original approach of checking barely more often than we think is necessary is overengineering the problem; even with 1000s of CFs, checking every 10s would have no affect whatsoever on performance.  Patch attached.&lt;/p&gt;</comment>
                            <comment id="12997591" author="scode" created="Mon, 21 Feb 2011 22:25:36 +0000"  >&lt;p&gt;(was asked to review) I agree on the overengineering. Patch looks good to me. The obvious caveat of being limited to 10 second resolution should be utterly irrelevant for the purposes for which the time based flushing is intended.&lt;/p&gt;</comment>
                            <comment id="12998159" author="jbellis" created="Wed, 23 Feb 2011 04:57:32 +0000"  >&lt;p&gt;committed&lt;/p&gt;</comment>
                            <comment id="12998409" author="hudson" created="Wed, 23 Feb 2011 15:18:09 +0000"  >&lt;p&gt;Integrated in Cassandra-0.7 #309 (See &lt;a href=&quot;https://hudson.apache.org/hudson/job/Cassandra-0.7/309/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://hudson.apache.org/hudson/job/Cassandra-0.7/309/&lt;/a&gt;)&lt;/p&gt;
</comment>
                    </comments>
                    <attachments>
                            <attachment id="12471294" name="2183.txt" size="1156" author="jbellis" created="Thu, 17 Feb 2011 16:57:32 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[jbellis]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>20486</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            14 years, 39 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0g9tr:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>93022</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>scode</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[scode]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12961"><![CDATA[Low]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>