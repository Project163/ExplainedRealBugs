<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 22:54:57 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-9560] Changing durable_writes on a keyspace is only applied after restart of node</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-9560</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;When mutations for a column family is about to be applied, the cached instance of the keyspace metadata is read. But the schema mutation for durable_writes hasn&apos;t been applied to this cached instance.&lt;/p&gt;

&lt;p&gt;I&apos;m not too familiar with the codebase but after some debugging (2.1.3), it&apos;s somehow related to:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-style: solid;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeHeader panelHeader&quot; style=&quot;border-bottom-width: 1px;border-bottom-style: solid;&quot;&gt;&lt;b&gt;org.apache.cassandra.db.Mutation.java&lt;/b&gt;&lt;/div&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void apply()
{
   Keyspace ks = Keyspace.open(keyspaceName);
    ks.apply(&lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;, ks.metadata.durableWrites);
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Where a cached instance of the keyspace is opened but it&apos;s metadata hasn&apos;t been updated with the earlier applied durable_writes mutation, since it seems that the cached keyspace instance is lazily build at startup but after that, never updated. I&apos;m also a little bit concerned if other values in the cached keyspace instance suffers from the same issue, e.g. replication_factor... &lt;/p&gt;

&lt;p&gt;I&apos;ve seen the same issue in 2.1.5 and the only way to resolve this issue is to restart the node to let the keyspace instance cache reload from disk.&lt;/p&gt;</description>
                <environment>&lt;p&gt;Single node&lt;/p&gt;</environment>
        <key id="12835857">CASSANDRA-9560</key>
            <summary>Changing durable_writes on a keyspace is only applied after restart of node</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10002" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Normal</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="carlyeks">Carl Yeksigian</assignee>
                                    <reporter username="Fredderf">Fred A</reporter>
                        <labels>
                    </labels>
                <created>Fri, 5 Jun 2015 22:44:37 +0000</created>
                <updated>Tue, 16 Apr 2019 09:31:08 +0000</updated>
                            <resolved>Wed, 1 Jul 2015 19:22:49 +0000</resolved>
                                        <fixVersion>2.0.17</fixVersion>
                    <fixVersion>2.1.8</fixVersion>
                    <fixVersion>2.2.0 rc2</fixVersion>
                                    <component>Legacy/Distributed Metadata</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="14578828" author="philipthompson" created="Tue, 9 Jun 2015 12:39:05 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=Fredderf&quot; class=&quot;user-hover&quot; rel=&quot;Fredderf&quot;&gt;Fredderf&lt;/a&gt;, just an update, we&apos;re working on writing some test cases that reproduce the issue.&lt;/p&gt;</comment>
                            <comment id="14578864" author="fredderf" created="Tue, 9 Jun 2015 13:12:26 +0000"  >&lt;p&gt;Thx, that&apos;s great. &lt;br/&gt;
FYI I used cassandra-cli and thrift to update the keyspace for durable writes. It&apos;s strange because when you describe the keyspace from cassandra-cli it looks like durable_writes are disabled but I&apos;ve got confused when I saw alot of disk i/o on commitlog files despite setting durable_writes to false.&lt;br/&gt;
Would be great with a patch if that&apos;s possible.&lt;/p&gt;</comment>
                            <comment id="14580538" author="mambocab" created="Wed, 10 Jun 2015 13:49:37 +0000"  >&lt;p&gt;We&apos;ve reproduced the behavior &lt;a href=&quot;https://github.com/riptano/cassandra-dtest/commit/ce417ff9f74305260ca1fd75b8f4e2296a865135&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;here&lt;/a&gt; and merged the test into dtest.&lt;/p&gt;</comment>
                            <comment id="14587505" author="fredderf" created="Tue, 16 Jun 2015 05:44:39 +0000"  >&lt;p&gt;Any news about this one?&lt;/p&gt;</comment>
                            <comment id="14597664" author="carlyeks" created="Tue, 23 Jun 2015 13:51:08 +0000"  >&lt;p&gt;We aren&apos;t properly updating the keyspace instance when we alter a keyspace.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/carlyeks/cassandra/tree/ticket/9560/2.1&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;2.1 branch&lt;/a&gt;&lt;br/&gt;
&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/carlyeks/job/carlyeks-ticket-9560-2.1-testall/lastCompletedBuild/testReport/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;2.1 utests&lt;/a&gt;&lt;br/&gt;
&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/carlyeks/job/carlyeks-ticket-9560-2.1-dtest/lastCompletedBuild/testReport/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;2.1 dtests&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/carlyeks/cassandra/tree/ticket/9560/2.2&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;2.2 branch&lt;/a&gt;&lt;br/&gt;
&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/carlyeks/job/carlyeks-ticket-9560-2.2-testall/lastCompletedBuild/testReport/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;2.2 utests&lt;/a&gt;&lt;br/&gt;
&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/carlyeks/job/carlyeks-ticket-9560-2.2-dtest/lastCompletedBuild/testReport/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;2.2 dtests&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14599369" author="fredderf" created="Wed, 24 Jun 2015 13:10:56 +0000"  >&lt;p&gt;Is this patch safe to apply?&lt;/p&gt;</comment>
                            <comment id="14599510" author="carlyeks" created="Wed, 24 Jun 2015 14:46:58 +0000"  >&lt;p&gt;Yes, it should be safe to apply; I&apos;ve tested it locally and it does what&apos;s expected.&lt;/p&gt;</comment>
                            <comment id="14599567" author="iamaleksey" created="Wed, 24 Jun 2015 15:21:09 +0000"  >&lt;p&gt;References to &lt;tt&gt;Keyspace&lt;/tt&gt; are hoisted all over the place (most obviously in &lt;tt&gt;ColumnFamilyStore&lt;/tt&gt;), so unfortunately it&apos;s not possible to just swap the &lt;tt&gt;Keyspace&lt;/tt&gt; instance with an updated one. We must update the reference to &lt;tt&gt;KSMetaData&lt;/tt&gt; in &lt;tt&gt;Keyspace&lt;/tt&gt; in place.&lt;/p&gt;

&lt;p&gt;Also, a patch for 2.0 would be handy - we&apos;ll likely have one more release, and this is a relatively serious issue.&lt;/p&gt;</comment>
                            <comment id="14599587" author="fredderf" created="Wed, 24 Jun 2015 15:33:49 +0000"  >&lt;p&gt;Could this also affect updating the replication factor? It seems like changing replication factor somehow works anyway.&lt;/p&gt;</comment>
                            <comment id="14599597" author="carlyeks" created="Wed, 24 Jun 2015 15:36:52 +0000"  >&lt;p&gt;The replication strategy was stored in the &lt;tt&gt;Keyspace&lt;/tt&gt; object and was being updated properly before. This change will update the &lt;tt&gt;KSMetaData&lt;/tt&gt; stored in &lt;tt&gt;Keyspace&lt;/tt&gt; as well.&lt;/p&gt;</comment>
                            <comment id="14599665" author="carlyeks" created="Wed, 24 Jun 2015 16:18:54 +0000"  >&lt;p&gt;Just pushed a new version to the 2.1/2.2 branches which updates the &lt;tt&gt;Keyspace&lt;/tt&gt;&apos;s metadata in place; here&apos;s the &lt;a href=&quot;https://github.com/carlyeks/cassandra/tree/ticket/9560/2.0&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;2.0 branch&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="14606090" author="fredderf" created="Mon, 29 Jun 2015 18:37:48 +0000"  >&lt;p&gt;Is it possible to apply this patch to 2.1 or will this fix be included in 2.1.8? I guess fix version for this Jira should also be 2.1.x?&lt;/p&gt;</comment>
                            <comment id="14606114" author="carlyeks" created="Mon, 29 Jun 2015 18:47:05 +0000"  >&lt;p&gt;The &lt;a href=&quot;https://github.com/carlyeks/cassandra/tree/ticket/9560/2.1&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;initial 2.1 branch&lt;/a&gt; can be applied to the 2.1 branch if you want to build it yourself. This will hopefully get into a 2.1.8 release since we just had the 2.1.7 release.&lt;/p&gt;</comment>
                            <comment id="14606366" author="fredderf" created="Mon, 29 Jun 2015 20:46:08 +0000"  >&lt;p&gt;Thank you, sounds good. I&apos;m not familiar with Cassandra bug fix procedures but when will the resolution for this Jira become &quot;fixed&quot;? Is that after the reviewer is satisfied with the patch, or? &lt;/p&gt;</comment>
                            <comment id="14606374" author="carlyeks" created="Mon, 29 Jun 2015 20:49:54 +0000"  >&lt;p&gt;After Aleksey has reviewed and is satisfied with the patch, he&apos;ll commit it and this bug will be resolved as fixed. Then it will be set to be included in the next release.&lt;/p&gt;</comment>
                            <comment id="14608587" author="iamaleksey" created="Tue, 30 Jun 2015 16:11:13 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=carlyeks&quot; class=&quot;user-hover&quot; rel=&quot;carlyeks&quot;&gt;carlyeks&lt;/a&gt; Can you please rebase the 3.0 patch on current trunk? Thanks.&lt;/p&gt;</comment>
                            <comment id="14610671" author="carlyeks" created="Wed, 1 Jul 2015 17:28:17 +0000"  >&lt;p&gt;I&apos;ve just posted a rebased trunk patch and cassci is running the trunk tests again now.&lt;/p&gt;</comment>
                            <comment id="14610711" author="carlyeks" created="Wed, 1 Jul 2015 17:49:53 +0000"  >&lt;p&gt;Scratch that, a patch isn&apos;t necessary for trunk; the changes that &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=iamaleksey&quot; class=&quot;user-hover&quot; rel=&quot;iamaleksey&quot;&gt;iamaleksey&lt;/a&gt; made for &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-9677&quot; title=&quot;Refactor KSMetaData&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-9677&quot;&gt;&lt;del&gt;CASSANDRA-9677&lt;/del&gt;&lt;/a&gt; fix this issue in trunk.&lt;/p&gt;</comment>
                            <comment id="14610860" author="iamaleksey" created="Wed, 1 Jul 2015 19:22:03 +0000"  >&lt;p&gt;Thanks. Pushed to 2.0 as &lt;tt&gt;3504a50bb4bd93edeb2941dccd9444d53a85a1ed&lt;/tt&gt;, merged with 2.1, 2.2, and trunk, with two unused methods (from the first iteration) removed:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;&lt;tt&gt;Schema.updateKeyspaceInstance()&lt;/tt&gt;&lt;/li&gt;
	&lt;li&gt;the private &lt;tt&gt;Keyspace&lt;/tt&gt; constructor&lt;/li&gt;
&lt;/ul&gt;
</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[carlyeks]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 20 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2fpgn:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12311421" key="com.atlassian.jira.plugin.system.customfieldtypes:multiversion">
                        <customfieldname>Reproduced In</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="12328951">2.1.3</customfieldvalue>
    <customfieldvalue id="12329874">2.1.5</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>aleksey</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[aleksey]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12962"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12311420" key="com.atlassian.jira.plugin.system.customfieldtypes:version">
                        <customfieldname>Since Version</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="12328951">2.1.3</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12311124" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Tester</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>mambocab</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>