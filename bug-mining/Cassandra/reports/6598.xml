<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 23:31:24 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-18956] Metadata Loss caused by unchecked rename column when upgrading from 2.x to 3.0.29</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-18956</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;After migrating data from 2.1.22 (released 2022-06-17) to 3.0.29 (released 2023-05-05), if user performs a rename operation to rename the primary key to an existing column, it will succeed, and the original column will get lost permanently.&lt;/p&gt;
&lt;h1&gt;&lt;a name=&quot;Reproduce&quot;&gt;&lt;/a&gt;Reproduce&lt;/h1&gt;

&lt;p&gt;Start up single cassandra node 2.1.22&lt;/p&gt;

&lt;p&gt;Start up &lt;b&gt;cassandra-cli&lt;/b&gt;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
bin/cassandra-cli &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Execute the following commands using cassandra-cli interface&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
create keyspace test with strategy_options = {replication_factor:1} and placement_strategy = &lt;span class=&quot;code-quote&quot;&gt;&apos;org.apache.cassandra.locator.SimpleStrategy&apos;&lt;/span&gt;;

use test;

create column family foos&#160;
with column_type = &lt;span class=&quot;code-quote&quot;&gt;&apos;Standard&apos;&lt;/span&gt;&#160;
and comparator = &lt;span class=&quot;code-quote&quot;&gt;&apos;BytesType&apos;&lt;/span&gt;
and key_validation_class = &lt;span class=&quot;code-quote&quot;&gt;&apos;UTF8Type&apos;&lt;/span&gt;&#160;
and column_metadata = [{column_name: &lt;span class=&quot;code-quote&quot;&gt;&apos;2f&apos;&lt;/span&gt;, validation_class: &lt;span class=&quot;code-quote&quot;&gt;&apos;UTF8Type&apos;&lt;/span&gt;}]; &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Stop the daemon&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
bin/nodetool -h ::FFFF:127.0.0.1 stopdaemon &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Upgrade, start up new version, start up cqlsh with &lt;b&gt;bin/cqlsh&lt;/b&gt;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
cqlsh&amp;gt; desc test.foos ;
CREATE TABLE test.foos (
&#160; &#160; key text PRIMARY KEY,
&#160; &#160; &lt;span class=&quot;code-quote&quot;&gt;&quot;2f&quot;&lt;/span&gt; text
) WITH COMPACT STORAGE
&#160; &#160; AND bloom_filter_fp_chance = 0.01
&#160; &#160; AND caching = {&lt;span class=&quot;code-quote&quot;&gt;&apos;keys&apos;&lt;/span&gt;: &lt;span class=&quot;code-quote&quot;&gt;&apos;ALL&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;rows_per_partition&apos;&lt;/span&gt;: &lt;span class=&quot;code-quote&quot;&gt;&apos;NONE&apos;&lt;/span&gt;}
&#160; &#160; AND comment = &apos;&apos;
&#160; &#160; AND compaction = {&lt;span class=&quot;code-quote&quot;&gt;&apos;class&apos;&lt;/span&gt;: &lt;span class=&quot;code-quote&quot;&gt;&apos;org.apache.cassandra.db.compaction.SizeTieredCompactionStrategy&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;max_threshold&apos;&lt;/span&gt;: &lt;span class=&quot;code-quote&quot;&gt;&apos;32&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;min_threshold&apos;&lt;/span&gt;: &lt;span class=&quot;code-quote&quot;&gt;&apos;4&apos;&lt;/span&gt;}
&#160; &#160; AND compression = {&lt;span class=&quot;code-quote&quot;&gt;&apos;chunk_length_in_kb&apos;&lt;/span&gt;: &lt;span class=&quot;code-quote&quot;&gt;&apos;64&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;class&apos;&lt;/span&gt;: &lt;span class=&quot;code-quote&quot;&gt;&apos;org.apache.cassandra.io.compress.LZ4Compressor&apos;&lt;/span&gt;}
&#160; &#160; AND crc_check_chance = 1.0
&#160; &#160; AND dclocal_read_repair_chance = 0.1
&#160; &#160; AND default_time_to_live = 0
&#160; &#160; AND gc_grace_seconds = 864000
&#160; &#160; AND max_index_interval = 2048
&#160; &#160; AND memtable_flush_period_in_ms = 0
&#160; &#160; AND min_index_interval = 128
&#160; &#160; AND read_repair_chance = 0.0
&#160; &#160; AND speculative_retry = &lt;span class=&quot;code-quote&quot;&gt;&apos;NONE&apos;&lt;/span&gt;;

cqlsh&amp;gt; ALTER TABLE test.foos RENAME key TO &lt;span class=&quot;code-quote&quot;&gt;&quot;2f&quot;&lt;/span&gt;;
cqlsh&amp;gt; desc test.foos ;
CREATE TABLE test.foos (
&#160; &#160; &lt;span class=&quot;code-quote&quot;&gt;&quot;2f&quot;&lt;/span&gt; text PRIMARY KEY
) WITH COMPACT STORAGE
&#160; &#160; AND bloom_filter_fp_chance = 0.01
&#160; &#160; AND caching = {&lt;span class=&quot;code-quote&quot;&gt;&apos;keys&apos;&lt;/span&gt;: &lt;span class=&quot;code-quote&quot;&gt;&apos;ALL&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;rows_per_partition&apos;&lt;/span&gt;: &lt;span class=&quot;code-quote&quot;&gt;&apos;NONE&apos;&lt;/span&gt;}
&#160; &#160; AND comment = &apos;&apos;
&#160; &#160; AND compaction = {&lt;span class=&quot;code-quote&quot;&gt;&apos;class&apos;&lt;/span&gt;: &lt;span class=&quot;code-quote&quot;&gt;&apos;org.apache.cassandra.db.compaction.SizeTieredCompactionStrategy&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;max_threshold&apos;&lt;/span&gt;: &lt;span class=&quot;code-quote&quot;&gt;&apos;32&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;min_threshold&apos;&lt;/span&gt;: &lt;span class=&quot;code-quote&quot;&gt;&apos;4&apos;&lt;/span&gt;}
&#160; &#160; AND compression = {&lt;span class=&quot;code-quote&quot;&gt;&apos;chunk_length_in_kb&apos;&lt;/span&gt;: &lt;span class=&quot;code-quote&quot;&gt;&apos;64&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;class&apos;&lt;/span&gt;: &lt;span class=&quot;code-quote&quot;&gt;&apos;org.apache.cassandra.io.compress.LZ4Compressor&apos;&lt;/span&gt;}
&#160; &#160; AND crc_check_chance = 1.0
&#160; &#160; AND dclocal_read_repair_chance = 0.1
&#160; &#160; AND default_time_to_live = 0
&#160; &#160; AND gc_grace_seconds = 864000
&#160; &#160; AND max_index_interval = 2048
&#160; &#160; AND memtable_flush_period_in_ms = 0
&#160; &#160; AND min_index_interval = 128
&#160; &#160; AND read_repair_chance = 0.0
&#160; &#160; AND speculative_retry = &lt;span class=&quot;code-quote&quot;&gt;&apos;NONE&apos;&lt;/span&gt;;

cqlsh&amp;gt; SELECT * FROM test.foos ;
 2f
----

(0 rows) &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;h1&gt;&lt;a name=&quot;RootCause&quot;&gt;&lt;/a&gt;Root Cause&lt;/h1&gt;

&lt;p&gt;The root cause is a missing check for the existing column when the table comparator from the old version is BytesType.&lt;/p&gt;

&lt;p&gt;I have uploaded the data dir, use it to start up 3.0.29 and execute the commands will reproduce this bug.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13555381">CASSANDRA-18956</key>
            <summary>Metadata Loss caused by unchecked rename column when upgrading from 2.x to 3.0.29</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10002" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Normal</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="kehan5800">Ke Han</assignee>
                                    <reporter username="kehan5800">Ke Han</reporter>
                        <labels>
                    </labels>
                <created>Tue, 24 Oct 2023 17:14:43 +0000</created>
                <updated>Thu, 9 Jan 2025 22:59:45 +0000</updated>
                            <resolved>Thu, 9 Jan 2025 22:59:16 +0000</resolved>
                                        <fixVersion>3.0.31</fixVersion>
                                    <component>Legacy/Distributed Metadata</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                    <progress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                            <timeestimate seconds="0">0h</timeestimate>
                            <timespent seconds="10200">2h 50m</timespent>
                                <comments>
                            <comment id="17779193" author="smiklosovic" created="Tue, 24 Oct 2023 17:49:01 +0000"  >&lt;p&gt;1) Why are you renaming a primary key?&lt;/p&gt;

&lt;p&gt;2) Why are you renaming it to a column name which already exists? What do you expect to happen?&lt;/p&gt;</comment>
                            <comment id="17779194" author="smiklosovic" created="Tue, 24 Oct 2023 17:52:59 +0000"  >&lt;p&gt;That being said, I am not sure if there is enough will power to fix relatively rare bug in a version so old.&lt;/p&gt;</comment>
                            <comment id="17779291" author="JIRAUSER289562" created="Wed, 25 Oct 2023 01:37:14 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=smiklosovic&quot; class=&quot;user-hover&quot; rel=&quot;smiklosovic&quot;&gt;smiklosovic&lt;/a&gt; Thanks for the reply!&lt;/p&gt;

&lt;p&gt;(1) The expected situation should be an exception and system should stops this request.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
cqlsh&amp;gt; ALTER TABLE test.foos RENAME key TO &lt;span class=&quot;code-quote&quot;&gt;&quot;2f&quot;&lt;/span&gt;;
InvalidRequest: Error from server: code=2200 [Invalid query] message=&lt;span class=&quot;code-quote&quot;&gt;&quot;Cannot rename column key to 2f in keyspace foos; another column of that name already exist&quot;&lt;/span&gt; &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;(2) &quot;No enough power to fix this bug.&quot; I totally agree. This bug happens rarely, and 3.0 is going to be deprecated soon.&lt;/p&gt;

&lt;p&gt;I have fixed this bug and submitted a PR for fixing. The root cause is: when renaming column FROM =&amp;gt; TO, the system checks whether FROM exists but does not check TO properly. The fix is simple: also add a check for the TO column.&lt;/p&gt;

&lt;p&gt;Do you mind taking a look at my PR? I really appreciate it! The PR is here: &lt;a href=&quot;https://github.com/apache/cassandra/pull/2840&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/cassandra/pull/2840&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17779333" author="JIRAUSER283332" created="Wed, 25 Oct 2023 05:13:00 +0000"  >&lt;p&gt;Does this problem exist in newer branches too?&lt;br/&gt;
\&lt;/p&gt;</comment>
                            <comment id="17779553" author="JIRAUSER289562" created="Wed, 25 Oct 2023 15:22:29 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=miklosovic%40pm.me&quot; class=&quot;user-hover&quot; rel=&quot;miklosovic@pm.me&quot;&gt;miklosovic@pm.me&lt;/a&gt; No. It only exists in 3.0 branch.&lt;/p&gt;

&lt;p&gt;In 3.11 branch, it&apos;s fixed by using ColumnDefinition.Raw.getIdentifier to check both FROM and TO columns. I followed a similar way but using ColumnIdentifier.Raw.prepare to check whether both columns exist for the thrift-model table.&lt;/p&gt;</comment>
                            <comment id="17779736" author="JIRAUSER283332" created="Thu, 26 Oct 2023 04:34:00 +0000"  >&lt;p&gt;Any chance you write a test?&lt;/p&gt;



&lt;p&gt;\&lt;/p&gt;</comment>
                            <comment id="17779739" author="JIRAUSER283332" created="Thu, 26 Oct 2023 04:40:00 +0000"  >&lt;p&gt;something like this&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/apache/cassandra/blob/cassandra-3.0/test/distributed/org/apache/cassandra/distributed/upgrade/MigrateDropColumnsTest.java&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/cassandra/blob/cassandra-3.0/test/distributed/org/apache/cassandra/distributed/upgrade/MigrateDropColumnsTest.java&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;Sent from ProtonMail mobile&lt;/p&gt;



&lt;p&gt;\&lt;/p&gt;</comment>
                            <comment id="17779968" author="JIRAUSER289562" created="Thu, 26 Oct 2023 15:59:14 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=miklosovic%40pm.me&quot; class=&quot;user-hover&quot; rel=&quot;miklosovic@pm.me&quot;&gt;miklosovic@pm.me&lt;/a&gt; Absolutely, let me give it a try.&lt;/p&gt;</comment>
                            <comment id="17780581" author="JIRAUSER289562" created="Sat, 28 Oct 2023 02:26:25 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=miklosovic%40pm.me&quot; class=&quot;user-hover&quot; rel=&quot;miklosovic@pm.me&quot;&gt;miklosovic@pm.me&lt;/a&gt; I have added a unit test in the &lt;a href=&quot;https://github.com/apache/cassandra/pull/2840/commits&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;PR&lt;/a&gt;.&#160;&lt;/p&gt;

&lt;p&gt;I didn&apos;t follow the upgrade test way because (1) cassandra-2.1 branch doesn&apos;t support&#160;&lt;em&gt;ant dtest-jar&lt;/em&gt;, and (2) The thrift model table needs cassandra-cli to create.&lt;/p&gt;

&lt;p&gt;Instead, I managed to create the specific buggy data inside the LegacySchemaMigratorTest. Then I invoked LegacySchemaMigrator.migrate(), and test the rename operation on the legacy table.&lt;/p&gt;</comment>
                            <comment id="17781109" author="smiklosovic" created="Mon, 30 Oct 2023 19:53:05 +0000"  >&lt;p&gt;I have not forgotten. Just give me some time here.&lt;/p&gt;</comment>
                            <comment id="17782500" author="smiklosovic" created="Fri, 3 Nov 2023 10:08:02 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=kehan5800&quot; class=&quot;user-hover&quot; rel=&quot;kehan5800&quot;&gt;kehan5800&lt;/a&gt; what Cassandra are you using? &lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
create keyspace test with strategy_options = {replication_factor:1} and placement_strategy = &lt;span class=&quot;code-quote&quot;&gt;&apos;org.apache.cassandra.locator.SimpleStrategy&apos;&lt;/span&gt;;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This is invalid in Cassandra 2.1.23-SNAPSHOT&lt;/p&gt;

&lt;p&gt;Creation of a table is pretty non-standard too.&lt;/p&gt;

&lt;p&gt;Could you give me a reproducer which is working for vanilla 2.1.22?&lt;/p&gt;</comment>
                            <comment id="17782588" author="JIRAUSER289562" created="Fri, 3 Nov 2023 14:27:57 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=smiklosovic&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;Stefan Miklosovic&lt;/a&gt;, I am using vanilla cassandra-2.1.22. Those commands are&#160;&lt;b&gt;cassandra-cli&lt;/b&gt;&#160;commands, not cqlsh commands.&lt;/p&gt;

&lt;p&gt;In cassandra-2.1.22, start up&#160;&lt;b&gt;cassandra-cli&lt;/b&gt;&#160;interface and execute the create keyspace and table commands. (I have updated the description for more detail)&lt;/p&gt;

&lt;p&gt;After the upgrade, start-up cqlsh for cassandra-3.0.29 for desc and rename commands.&lt;/p&gt;</comment>
                            <comment id="17782623" author="smiklosovic" created="Fri, 3 Nov 2023 15:30:30 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=kehan5800&quot; class=&quot;user-hover&quot; rel=&quot;kehan5800&quot;&gt;kehan5800&lt;/a&gt; I reproduced and the patch fixes it. The problem I have is that when I run that test in IDEA, individual test, testMigrate18956, that one passes. But when I run whole test class, it fails (other two tests in that class pass).&lt;/p&gt;

&lt;p&gt;Same might be seen by&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
ant testsome -Dtest.name=org.apache.cassandra.schema.LegacySchemaMigratorTest
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="17782633" author="JIRAUSER289562" created="Fri, 3 Nov 2023 15:50:27 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=smiklosovic&quot; class=&quot;user-hover&quot; rel=&quot;smiklosovic&quot;&gt;smiklosovic&lt;/a&gt; Thanks for the information! It&apos;s possible some states are messed up when starting the test class. Let me try to fix it.&lt;/p&gt;</comment>
                            <comment id="17782939" author="JIRAUSER289562" created="Sun, 5 Nov 2023 00:35:49 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=smiklosovic&quot; class=&quot;user-hover&quot; rel=&quot;smiklosovic&quot;&gt;smiklosovic&lt;/a&gt; I have fixed the unit test with a separation from the previous tests.&lt;/p&gt;

&lt;p&gt;I tested with the following commands, and both passed.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
ant testsome -Dtest.name=org.apache.cassandra.schema.LegacySchemaMigratorTest
ant testsome -Dtest.name=org.apache.cassandra.schema.LegacySchemaMigratorThriftTest &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="17782949" author="JIRAUSER283332" created="Sun, 5 Nov 2023 06:50:00 +0000"  >&lt;p&gt;You have no separated it correctly. You made one test class dependent on the other.&lt;/p&gt;


&lt;p&gt;Sent from ProtonMail mobile&lt;/p&gt;



&lt;p&gt;\&lt;/p&gt;</comment>
                            <comment id="17783022" author="JIRAUSER289562" created="Sun, 5 Nov 2023 18:01:29 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=miklosovic%40pm.me&quot; class=&quot;user-hover&quot; rel=&quot;miklosovic@pm.me&quot;&gt;miklosovic@pm.me&lt;/a&gt; Thanks for the suggestion! I have updated the test for a clean separation. There&apos;s no dependency between unit tests.&lt;/p&gt;</comment>
                            <comment id="17783053" author="smiklosovic" created="Sun, 5 Nov 2023 22:14:46 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=kehan5800&quot; class=&quot;user-hover&quot; rel=&quot;kehan5800&quot;&gt;kehan5800&lt;/a&gt;, look, I do not want to be picky and do not take me wrong here, the progress you are doing is great, but what you did is &quot;too much&quot;. There is basically too much copy &amp;amp; paste. What I think would be more ideal is to extract functions you copied into your test to a super class which both test would extend and reuse all methods from there. That way we do not repeat ourselves. Just extract what is same in both tests to an abstract class. Do you think this would be possible to do?&lt;/p&gt;

&lt;p&gt;Could you also move bytesTypeComparatorCFMD18956 to the test itself? I do not think it is necessary to have it in SchemaLoader if it is just used one. Move it directly to the test.&lt;/p&gt;</comment>
                            <comment id="17783056" author="JIRAUSER289562" created="Sun, 5 Nov 2023 22:37:28 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=smiklosovic&quot; class=&quot;user-hover&quot; rel=&quot;smiklosovic&quot;&gt;smiklosovic&lt;/a&gt; Definitely. The suggestions you brought up are great! I apologize for not considering that when writing the tests. (I tried to keep the original tests unchanged). I&apos;ll fix it soon. &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="17783058" author="JIRAUSER289562" created="Sun, 5 Nov 2023 23:12:21 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=smiklosovic&quot; class=&quot;user-hover&quot; rel=&quot;smiklosovic&quot;&gt;smiklosovic&lt;/a&gt;, I have fixed it by (1) extracting the common methods to an abstract class and (2) moving bytesTypeComparatorCFMD18956 to the tests. Is there anything else I could improve?&lt;/p&gt;</comment>
                            <comment id="17783060" author="smiklosovic" created="Sun, 5 Nov 2023 23:21:33 +0000"  >&lt;p&gt;commented on the PR&lt;/p&gt;</comment>
                            <comment id="17783179" author="smiklosovic" created="Mon, 6 Nov 2023 10:57:44 +0000"  >&lt;p&gt;I run CircleCI build and this patch introduces a regression&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://app.circleci.com/pipelines/github/instaclustr/cassandra/3435/workflows/1eb1503f-a2cb-4a3a-803c-04e96d8d1dc3/jobs/145733/tests#failed-test-0&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://app.circleci.com/pipelines/github/instaclustr/cassandra/3435/workflows/1eb1503f-a2cb-4a3a-803c-04e96d8d1dc3/jobs/145733/tests#failed-test-0&lt;/a&gt;&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
    @Test(expected = SyntaxException.class)
    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void renameToEmptyTest() &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; Throwable
    {
        createTable(&lt;span class=&quot;code-quote&quot;&gt;&quot;CREATE TABLE %s (k &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;, c1 &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;, v &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;, PRIMARY KEY (k, c1))&quot;&lt;/span&gt;);
        execute(&lt;span class=&quot;code-quote&quot;&gt;&quot;ALTER TABLE %s RENAME c1 TO \&quot;&lt;/span&gt;\&quot;&quot;);
    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;It should throw SyntaxException, but it is not.&lt;/p&gt;</comment>
                            <comment id="17783270" author="JIRAUSER289562" created="Mon, 6 Nov 2023 16:18:20 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=smiklosovic&quot; class=&quot;user-hover&quot; rel=&quot;smiklosovic&quot;&gt;smiklosovic&lt;/a&gt; Regression fixed. Could you run CI build again?&lt;/p&gt;</comment>
                            <comment id="17783273" author="smiklosovic" created="Mon, 6 Nov 2023 16:24:40 +0000"  >&lt;p&gt;&lt;a href=&quot;https://app.circleci.com/pipelines/github/instaclustr/cassandra/3439/workflows/99f3f349-ae1d-4817-bc77-f4821ebc4089&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://app.circleci.com/pipelines/github/instaclustr/cassandra/3439/workflows/99f3f349-ae1d-4817-bc77-f4821ebc4089&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17783296" author="JIRAUSER289562" created="Mon, 6 Nov 2023 17:24:41 +0000"  >&lt;p&gt;During my local testing, I noticed that when running &lt;b&gt;ant test&lt;/b&gt;, it assumes the base class LegacySchemaMigratorBaseTest also contain unit tests since its name ends with &quot;Test&quot;. And it outputs the following exception&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
testsome:
[junit-timeout] Testsuite: org.apache.cassandra.schema.LegacySchemaMigratorBaseTest
[junit-timeout] Testsuite: org.apache.cassandra.schema.LegacySchemaMigratorBaseTest Tests run: 1, Failures: 0, Errors: 1, Skipped: 0, Time elapsed: 0.074 sec
[junit-timeout]&#160;
[junit-timeout] Testcase: initializationError(org.apache.cassandra.schema.LegacySchemaMigratorBaseTest): &#160; &#160;Caused an ERROR
[junit-timeout] No runnable methods
[junit-timeout] java.lang.Exception: No runnable methods
[junit-timeout] &#160; &#160; at java.lang.reflect.Constructor.newInstance(Constructor.java:423)
[junit-timeout]&#160;
[junit-timeout]&#160;
[junit-timeout] Test org.apache.cassandra.schema.LegacySchemaMigratorBaseTest FAILED &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;I have renamed the based test class name to LegacySchemaMigratorBase to avoid it.&#160;&lt;/p&gt;</comment>
                            <comment id="17783322" author="JIRAUSER283332" created="Mon, 6 Nov 2023 18:21:00 +0000"  >&lt;p&gt;hat is fine, I run CI with &quot;Ignored&quot; annotation on top of that abstract class. It has to be like that.&lt;/p&gt;


&lt;p&gt;Sent from ProtonMail mobile&lt;/p&gt;



&lt;p&gt;\&lt;/p&gt;</comment>
                            <comment id="17783395" author="smiklosovic" created="Mon, 6 Nov 2023 22:32:40 +0000"  >&lt;p&gt;CI seems good, I am +1. We need to have another committer for this (there is such a policy for this).&lt;/p&gt;

&lt;p&gt;We are very busy with delivering of 5.0 so this will be reviewed, realistically, after 5.0 is out. Please ping me after 5.0 is out so we take care of this.&lt;/p&gt;

&lt;p&gt;For the reference I was running this branch (1) with this CI (2)&lt;/p&gt;

&lt;p&gt;(1) &lt;a href=&quot;https://github.com/instaclustr/cassandra/commits/CASSANDRA-18956-3.0&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/instaclustr/cassandra/commits/CASSANDRA-18956-3.0&lt;/a&gt;&lt;br/&gt;
(2) &lt;a href=&quot;https://app.circleci.com/pipelines/github/instaclustr/cassandra/3439/workflows/99f3f349-ae1d-4817-bc77-f4821ebc4089&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://app.circleci.com/pipelines/github/instaclustr/cassandra/3439/workflows/99f3f349-ae1d-4817-bc77-f4821ebc4089&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17783403" author="JIRAUSER289562" created="Mon, 6 Nov 2023 23:37:05 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=smiklosovic&quot; class=&quot;user-hover&quot; rel=&quot;smiklosovic&quot;&gt;smiklosovic&lt;/a&gt; Of course. Thanks for the help! &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="17909987" author="JIRAUSER289562" created="Mon, 6 Jan 2025 03:26:23 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=smiklosovic&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;Stefan Miklosovic&lt;/a&gt;, I wanted to follow up regarding the patch that we discussed earlier, not sure whether it&apos;s a good time to merge it.&lt;/p&gt;</comment>
                            <comment id="17911572" author="brandon.williams" created="Thu, 9 Jan 2025 16:02:23 +0000"  >&lt;p&gt;LGTM, +1&lt;/p&gt;</comment>
                            <comment id="17911580" author="smiklosovic" created="Thu, 9 Jan 2025 16:30:31 +0000"  >&lt;p&gt;I will just run it once more and we can get to it.&lt;/p&gt;</comment>
                            <comment id="17911692" author="smiklosovic" created="Thu, 9 Jan 2025 22:33:27 +0000"  >&lt;p&gt;&lt;a href=&quot;https://app.circleci.com/pipelines/github/instaclustr/cassandra/5165/workflows/3a476e93-5ace-4683-906c-a5d9c7d1e935&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://app.circleci.com/pipelines/github/instaclustr/cassandra/5165/workflows/3a476e93-5ace-4683-906c-a5d9c7d1e935&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="13511401">CASSANDRA-18108</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="13063834" name="data.tar.gz" size="127082" author="kehan5800" created="Tue, 24 Oct 2023 17:14:09 +0000"/>
                            <attachment id="13064216" name="signature.asc" size="509" author="miklosovic@pm.me" created="Mon, 6 Nov 2023 18:21:00 +0000"/>
                            <attachment id="13064167" name="signature.asc" size="509" author="miklosovic@pm.me" created="Sun, 5 Nov 2023 06:50:00 +0000"/>
                            <attachment id="13063885" name="signature.asc" size="509" author="miklosovic@pm.me" created="Thu, 26 Oct 2023 04:40:00 +0000"/>
                            <attachment id="13063884" name="signature.asc" size="509" author="miklosovic@pm.me" created="Thu, 26 Oct 2023 04:34:00 +0000"/>
                            <attachment id="13063841" name="signature.asc" size="509" author="miklosovic@pm.me" created="Wed, 25 Oct 2023 05:13:00 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>6.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[kehan5800]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12313825" key="com.atlassian.jira.plugin.system.customfieldtypes:cascadingselect">
                        <customfieldname>Bug Category</customfieldname>
                        <customfieldvalues>
                                                    <customfieldvalue key="12982" cascade-level=""><![CDATA[Correctness]]></customfieldvalue>
                                <customfieldvalue key="13161" cascade-level="1"><![CDATA[Unrecoverable Corruption / Loss]]></customfieldvalue>
            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12313821" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Complexity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12964"><![CDATA[Low Hanging Fruit]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313822" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Discovered By</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12977"><![CDATA[Adhoc Test]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12313922" key="jira.plugin.projectspecificselectfield.jpssf:multicftype">
                        <customfieldname>Impacts</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="13100"><![CDATA[None]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            43 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12313921" key="jira.plugin.projectspecificselectfield.jpssf:multicftype">
                        <customfieldname>Platform</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="13076"><![CDATA[All]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z1l5xk:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[brandon.williams]]></customfieldvalue>
        <customfieldvalue><![CDATA[smiklosovic]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12962"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12311420" key="com.atlassian.jira.plugin.system.customfieldtypes:version">
                        <customfieldname>Since Version</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="12333891">3.0.0</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313924" key="com.atlassian.jira.plugin.system.customfieldtypes:textfield">
                        <customfieldname>Source Control Link</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>&lt;p&gt;&lt;a href=&quot;https://github.com/apache/cassandra/commit/f41c2e29d240a7f0cafe6455722d287edc80b1be&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/cassandra/commit/f41c2e29d240a7f0cafe6455722d287edc80b1be&lt;/a&gt;&lt;/p&gt;</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313823" key="com.atlassian.jira.plugin.system.customfieldtypes:textarea">
                        <customfieldname>Test and Documentation Plan</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>&lt;p&gt;CI&lt;/p&gt;</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>