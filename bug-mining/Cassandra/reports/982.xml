<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 22:21:43 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-2824] assert err on SystemTable.getCurrentLocalNodeId during a cleanup</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-2824</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;when running nodetool cleanup the following happened:&lt;/p&gt;

&lt;p&gt;$ ./bin/nodetool cleanup --host localhost&lt;br/&gt;
Exception in thread &quot;main&quot; java.lang.AssertionError&lt;br/&gt;
at org.apache.cassandra.db.SystemTable.getCurrentLocalNodeId(SystemTable.java:383)&lt;br/&gt;
at org.apache.cassandra.utils.NodeId$LocalNodeIdHistory.&amp;lt;init&amp;gt;(NodeId.java:179)&lt;br/&gt;
at org.apache.cassandra.utils.NodeId.&amp;lt;clinit&amp;gt;(NodeId.java:38)&lt;br/&gt;
at org.apache.cassandra.utils.NodeId$OneShotRenewer.&amp;lt;init&amp;gt;(NodeId.java:159)&lt;br/&gt;
at org.apache.cassandra.service.StorageService.forceTableCleanup(StorageService.java:1317)&lt;br/&gt;
at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)&lt;br/&gt;
at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)&lt;br/&gt;
at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)&lt;br/&gt;
at java.lang.reflect.Method.invoke(Method.java:597)&lt;br/&gt;
at com.sun.jmx.mbeanserver.StandardMBeanIntrospector.invokeM2(StandardMBeanIntrospector.java:93)&lt;br/&gt;
at com.sun.jmx.mbeanserver.StandardMBeanIntrospector.invokeM2(StandardMBeanIntrospector.java:27)&lt;br/&gt;
at com.sun.jmx.mbeanserver.MBeanIntrospector.invokeM(MBeanIntrospector.java:208)&lt;br/&gt;
at com.sun.jmx.mbeanserver.PerInterface.invoke(PerInterface.java:120)&lt;br/&gt;
at com.sun.jmx.mbeanserver.MBeanSupport.invoke(MBeanSupport.java:262)&lt;br/&gt;
at com.sun.jmx.interceptor.DefaultMBeanServerInterceptor.invoke(DefaultMBeanServerInterceptor.java:836)&lt;br/&gt;
at com.sun.jmx.mbeanserver.JmxMBeanServer.invoke(JmxMBeanServer.java:761)&lt;br/&gt;
at javax.management.remote.rmi.RMIConnectionImpl.doOperation(RMIConnectionImpl.java:1427)&lt;br/&gt;
at javax.management.remote.rmi.RMIConnectionImpl.access$200(RMIConnectionImpl.java:72)&lt;br/&gt;
at javax.management.remote.rmi.RMIConnectionImpl$PrivilegedOperation.run(RMIConnectionImpl.java:1265)&lt;br/&gt;
at javax.management.remote.rmi.RMIConnectionImpl.doPrivilegedOperation(RMIConnectionImpl.java:1360)&lt;br/&gt;
at javax.management.remote.rmi.RMIConnectionImpl.invoke(RMIConnectionImpl.java:788)&lt;br/&gt;
at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)&lt;br/&gt;
at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)&lt;br/&gt;
at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)&lt;br/&gt;
at java.lang.reflect.Method.invoke(Method.java:597)&lt;br/&gt;
at sun.rmi.server.UnicastServerRef.dispatch(UnicastServerRef.java:305)&lt;br/&gt;
at sun.rmi.transport.Transport$1.run(Transport.java:159)&lt;br/&gt;
at java.security.AccessController.doPrivileged(Native Method)&lt;br/&gt;
at sun.rmi.transport.Transport.serviceCall(Transport.java:155)&lt;br/&gt;
at sun.rmi.transport.tcp.TCPTransport.handleMessages(TCPTransport.java:535)&lt;br/&gt;
at sun.rmi.transport.tcp.TCPTransport$ConnectionHandler.run0(TCPTransport.java:790)&lt;br/&gt;
at sun.rmi.transport.tcp.TCPTransport$ConnectionHandler.run(TCPTransport.java:649)&lt;br/&gt;
at java.util.concurrent.ThreadPoolExecutor$Worker.runTask(ThreadPoolExecutor.java:886)&lt;br/&gt;
at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:908)&lt;br/&gt;
at java.lang.Thread.run(Thread.java:662) &lt;/p&gt;
</description>
                <environment></environment>
        <key id="12511491">CASSANDRA-2824</key>
            <summary>assert err on SystemTable.getCurrentLocalNodeId during a cleanup</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10003" iconUrl="https://issues.apache.org/jira/images/icons/priorities/trivial.svg">Low</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="slebresne">Sylvain Lebresne</assignee>
                                    <reporter username="cywjackson">Jackson Chung</reporter>
                        <labels>
                    </labels>
                <created>Fri, 24 Jun 2011 16:34:18 +0000</created>
                <updated>Tue, 16 Apr 2019 09:32:56 +0000</updated>
                            <resolved>Tue, 28 Jun 2011 07:59:41 +0000</resolved>
                                        <fixVersion>0.8.2</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                                                                <comments>
                            <comment id="13055576" author="slebresne" created="Mon, 27 Jun 2011 14:30:30 +0000"  >&lt;p&gt;There is possibly a race here that triggers the assert. The code is relying on the fact that system tables have a gc_grace of 0 to assume it cannot get tombstone back, but given that gcbefore is at the precision of a second, and given than that on tie with the tombstone timestamp we do include the tombstone, we could get tombstone back.&lt;/p&gt;

&lt;p&gt;Attaching patch that takes a safer road.&lt;/p&gt;</comment>
                            <comment id="13055590" author="jbellis" created="Mon, 27 Jun 2011 15:03:30 +0000"  >&lt;p&gt;why not just call removeDeleted?&lt;/p&gt;</comment>
                            <comment id="13055678" author="slebresne" created="Mon, 27 Jun 2011 17:39:32 +0000"  >&lt;p&gt;You&apos;re right, I skipped the fact that gcBefore==0 is different from gc_grace==0. Patch v2 attached.&lt;/p&gt;</comment>
                            <comment id="13055712" author="jbellis" created="Mon, 27 Jun 2011 19:31:44 +0000"  >&lt;p&gt;+1 (can you include a link here in the comment when you commit?)&lt;/p&gt;</comment>
                            <comment id="13056374" author="slebresne" created="Tue, 28 Jun 2011 07:59:41 +0000"  >&lt;p&gt;Committed (with link to the issue in comment), thanks&lt;/p&gt;</comment>
                            <comment id="13056384" author="hudson" created="Tue, 28 Jun 2011 08:23:06 +0000"  >&lt;p&gt;Integrated in Cassandra-0.8 #195 (See &lt;a href=&quot;https://builds.apache.org/job/Cassandra-0.8/195/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/Cassandra-0.8/195/&lt;/a&gt;)&lt;br/&gt;
    Avoids race in SystemTable.getCurrentLocalNodeId&lt;br/&gt;
patch by slebresne; reviewed by jbellis for &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-2824&quot; title=&quot;assert err on SystemTable.getCurrentLocalNodeId during a cleanup&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-2824&quot;&gt;&lt;del&gt;CASSANDRA-2824&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;slebresne : &lt;a href=&quot;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1140472&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1140472&lt;/a&gt;&lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/cassandra/branches/cassandra-0.8/CHANGES.txt&lt;/li&gt;
	&lt;li&gt;/cassandra/branches/cassandra-0.8/src/java/org/apache/cassandra/db/SystemTable.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                    </comments>
                    <attachments>
                            <attachment id="12483958" name="2824.patch" size="1189" author="slebresne" created="Mon, 27 Jun 2011 14:30:30 +0000"/>
                            <attachment id="12483980" name="2824_v2.patch" size="1041" author="slebresne" created="Mon, 27 Jun 2011 17:39:32 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[slebresne]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>20851</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            14 years, 22 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0gdon:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>93647</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>jbellis</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[jbellis]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12961"><![CDATA[Low]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>