<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 23:24:43 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-17456] Test Failures: write_failures_test.TestMultiDCWriteFailures.test_oversized_mutation</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-17456</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;&lt;a href=&quot;https://ci-cassandra.apache.org/job/Cassandra-trunk/1002/testReport/dtest-offheap.write_failures_test/TestMultiDCWriteFailures/test_oversized_mutation/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://ci-cassandra.apache.org/job/Cassandra-trunk/1002/testReport/dtest-offheap.write_failures_test/TestMultiDCWriteFailures/test_oversized_mutation/&lt;/a&gt;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
Error Message
AssertionError: &lt;span class=&quot;code-keyword&quot;&gt;assert&lt;/span&gt; 0 == 8  +  where 8 = &amp;lt;bound method JolokiaAgent.read_attribute of &amp;lt;tools.jmxutils.JolokiaAgent object at 0x7f1fca78dac0&amp;gt;&amp;gt;(&lt;span class=&quot;code-quote&quot;&gt;&apos;org.apache.cassandra.metrics:type=Storage,name=TotalHints&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;Count&apos;&lt;/span&gt;)  +    where &amp;lt;bound method JolokiaAgent.read_attribute of &amp;lt;tools.jmxutils.JolokiaAgent object at 0x7f1fca78dac0&amp;gt;&amp;gt; = &amp;lt;tools.jmxutils.JolokiaAgent object at 0x7f1fca78dac0&amp;gt;.read_attribute  +    and   &lt;span class=&quot;code-quote&quot;&gt;&apos;org.apache.cassandra.metrics:type=Storage,name=TotalHints&apos;&lt;/span&gt; = make_mbean(&lt;span class=&quot;code-quote&quot;&gt;&apos;metrics&apos;&lt;/span&gt;, type=&lt;span class=&quot;code-quote&quot;&gt;&apos;Storage&apos;&lt;/span&gt;, name=&lt;span class=&quot;code-quote&quot;&gt;&apos;TotalHints&apos;&lt;/span&gt;)
Stacktrace
self = &amp;lt;write_failures_test.TestMultiDCWriteFailures object at 0x7f1fca9dac40&amp;gt;

    def test_oversized_mutation(self):
        &quot;&quot;&quot;
            Test that multi-DC write failures &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; operation failed rather than a timeout.
            @jira_ticket CASSANDRA-16334.
            &quot;&quot;&quot;
    
        cluster = self.cluster
        cluster.populate([2, 2])
        cluster.set_configuration_options(values={&lt;span class=&quot;code-quote&quot;&gt;&apos;max_mutation_size_in_kb&apos;&lt;/span&gt;: 128})
        cluster.start()
    
        node1 = cluster.nodelist()[0]
        session = self.patient_exclusive_cql_connection(node1)
    
        session.execute(&lt;span class=&quot;code-quote&quot;&gt;&quot;CREATE KEYSPACE k WITH replication = {&lt;span class=&quot;code-quote&quot;&gt;&apos;class&apos;&lt;/span&gt;: &lt;span class=&quot;code-quote&quot;&gt;&apos;NetworkTopologyStrategy&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;dc1&apos;&lt;/span&gt;: 2, &lt;span class=&quot;code-quote&quot;&gt;&apos;dc2&apos;&lt;/span&gt;: 2}&quot;&lt;/span&gt;)
        session.execute(&lt;span class=&quot;code-quote&quot;&gt;&quot;CREATE TABLE k.t (key &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; PRIMARY KEY, val blob)&quot;&lt;/span&gt;)
    
        payload = &lt;span class=&quot;code-quote&quot;&gt;&apos;1&apos;&lt;/span&gt; * 1024 * 256
        query = &lt;span class=&quot;code-quote&quot;&gt;&quot;INSERT INTO k.t (key, val) VALUES (1, textAsBlob(&lt;span class=&quot;code-quote&quot;&gt;&apos;{}&apos;&lt;/span&gt;))&quot;&lt;/span&gt;.format(payload)
    
        assert_write_failure(session, query, ConsistencyLevel.LOCAL_ONE)
        assert_write_failure(session, query, ConsistencyLevel.ONE)
    
        # verify that no hints are created
        with JolokiaAgent(node1) as jmx:
&amp;gt;           &lt;span class=&quot;code-keyword&quot;&gt;assert&lt;/span&gt; 0 == jmx.read_attribute(make_mbean(&lt;span class=&quot;code-quote&quot;&gt;&apos;metrics&apos;&lt;/span&gt;, type=&lt;span class=&quot;code-quote&quot;&gt;&apos;Storage&apos;&lt;/span&gt;, name=&lt;span class=&quot;code-quote&quot;&gt;&apos;TotalHints&apos;&lt;/span&gt;), &lt;span class=&quot;code-quote&quot;&gt;&apos;Count&apos;&lt;/span&gt;)
E           AssertionError: &lt;span class=&quot;code-keyword&quot;&gt;assert&lt;/span&gt; 0 == 8
E            +  where 8 = &amp;lt;bound method JolokiaAgent.read_attribute of &amp;lt;tools.jmxutils.JolokiaAgent object at 0x7f1fca78dac0&amp;gt;&amp;gt;(&lt;span class=&quot;code-quote&quot;&gt;&apos;org.apache.cassandra.metrics:type=Storage,name=TotalHints&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;Count&apos;&lt;/span&gt;)
E            +    where &amp;lt;bound method JolokiaAgent.read_attribute of &amp;lt;tools.jmxutils.JolokiaAgent object at 0x7f1fca78dac0&amp;gt;&amp;gt; = &amp;lt;tools.jmxutils.JolokiaAgent object at 0x7f1fca78dac0&amp;gt;.read_attribute
E            +    and   &lt;span class=&quot;code-quote&quot;&gt;&apos;org.apache.cassandra.metrics:type=Storage,name=TotalHints&apos;&lt;/span&gt; = make_mbean(&lt;span class=&quot;code-quote&quot;&gt;&apos;metrics&apos;&lt;/span&gt;, type=&lt;span class=&quot;code-quote&quot;&gt;&apos;Storage&apos;&lt;/span&gt;, name=&lt;span class=&quot;code-quote&quot;&gt;&apos;TotalHints&apos;&lt;/span&gt;)

write_failures_test.py:277: AssertionError
REST API
CloudBees CI Client Controller 2.319.3.4-rolling



&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="13434620">CASSANDRA-17456</key>
            <summary>Test Failures: write_failures_test.TestMultiDCWriteFailures.test_oversized_mutation</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10002" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Normal</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="Gerrrr">Alex Sorokoumov</assignee>
                                    <reporter username="edimitrova">Ekaterina Dimitrova</reporter>
                        <labels>
                    </labels>
                <created>Fri, 18 Mar 2022 20:07:17 +0000</created>
                <updated>Fri, 10 Oct 2025 08:47:43 +0000</updated>
                            <resolved>Mon, 9 May 2022 09:05:49 +0000</resolved>
                                        <fixVersion>4.1-alpha1</fixVersion>
                    <fixVersion>4.1</fixVersion>
                                    <component>CI</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>6</watches>
                                                    <progress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                            <timeestimate seconds="0">0h</timeestimate>
                            <timespent seconds="4200">1h 10m</timespent>
                                <comments>
                            <comment id="17509062" author="edimitrova" created="Fri, 18 Mar 2022 20:08:46 +0000"  >&lt;p&gt;CC &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=benedict&quot; class=&quot;user-hover&quot; rel=&quot;benedict&quot;&gt;benedict&lt;/a&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="17509191" author="benedict" created="Sat, 19 Mar 2022 09:09:25 +0000"  >&lt;p&gt;FWIW, I think this may be a real bug that has been present for years. It&apos;s not clear what our semantics are with respect to max mutation size - seemingly we should reject them entirely at the client level, but for some reason we do not. We do not seem to declare our behaviour clearly anywhere. However, historically we could not durably record them in the commit log, so we should presumably not be recording them in the hints file either - but we are, and have been for a long time.&lt;/p&gt;

&lt;p&gt;Probably what we should really do is to default to a much larger max mutation size, reject client operations that exceed it entirely, and have the commit log support any size of mutation (by just allocating a dedicated segment). Perhaps we already do, in fact, and that explains this divergence? I&apos;m not sure, I&apos;m out of date.&lt;/p&gt;</comment>
                            <comment id="17509254" author="brandon.williams" created="Sat, 19 Mar 2022 11:38:06 +0000"  >&lt;blockquote&gt;&lt;p&gt;seemingly we should reject them entirely at the client level, but for some reason we do not.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I agree here since the oversized mutations can still affect the heap, which with G1 can cause a Humongous Allocation and wreck it.  This is why I reduced the native frame size in &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-16886&quot; title=&quot;Reduce native_transport_max_frame_size_in_mb&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-16886&quot;&gt;&lt;del&gt;CASSANDRA-16886&lt;/del&gt;&lt;/a&gt;, but this is also why we should try not to record them as much as possible, so I&apos;m not fond of the idea of allowing any size since we&apos;ll surely be allocating at some point.&lt;/p&gt;</comment>
                            <comment id="17510474" author="benedict" created="Tue, 22 Mar 2022 12:51:22 +0000"  >&lt;p&gt;Yes, to be clear I meant only to remove the &lt;em&gt;CommitLog&lt;/em&gt; size restrictions, and move the size restriction to one that is entirely imposed on the client connection. Increasing the default permitted size would be a way to minimise the chance of this change breaking applications when introduced, without modifying the default commit log behaviour. Though I would be fine to simply move to rejecting the oversized mutations at the client connection (and perhaps also internode) without any other changes.&lt;/p&gt;</comment>
                            <comment id="17526464" author="gerrrr" created="Fri, 22 Apr 2022 14:21:20 +0000"  >&lt;p&gt;As Benedict suggested, I moved the mutation size check from CommitLog to the client and internode connections.&lt;/p&gt;

&lt;p&gt;Patches:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;&lt;a href=&quot;https://github.com/apache/cassandra/compare/trunk...Gerrrr:17456-trunk?expand=1&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;17456-trunk&lt;/a&gt;&lt;/li&gt;
	&lt;li&gt;&lt;a href=&quot;https://github.com/apache/cassandra-dtest/pull/186&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;dtest&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;&lt;a href=&quot;https://ci-cassandra.apache.org/job/Cassandra-devbranch/1626/#showFailuresLink&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;Jenkins CI run&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17527628" author="adelapena" created="Mon, 25 Apr 2022 16:40:10 +0000"  >&lt;p&gt;Looks good to me, here is a CircleCI run including some repeated runs of the&#160;new in-JVM dtest on the multiplexer:&lt;/p&gt;
&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;Patch&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;CircleCI&lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/adelapena/cassandra/commit/f2bb81f9d26ca0281990861c9b72ba0809c7723c&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;trunk&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://app.circleci.com/pipelines/github/adelapena/cassandra/1504/workflows/530f2000-55e0-4416-9beb-24cfc198f477&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;j8&lt;/a&gt; &lt;a href=&quot;https://app.circleci.com/pipelines/github/adelapena/cassandra/1504/workflows/cf2da305-3246-4355-8c22-30ccddcc664c&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;j11&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;

&lt;p&gt;I have also left a couple of small suggestions on &lt;a href=&quot;https://github.com/apache/cassandra/pull/1588&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;the PR&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="17528122" author="adelapena" created="Tue, 26 Apr 2022 12:08:46 +0000"  >&lt;p&gt;CI for the last changes:&lt;/p&gt;
&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;Patch&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;CircleCI&lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/adelapena/cassandra/commit/f2bb81f9d26ca0281990861c9b72ba0809c7723c&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;trunk&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://app.circleci.com/pipelines/github/adelapena/cassandra/1506/workflows/bda95759-cf93-4900-bb56-b4be8edb8083&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;j8&lt;/a&gt; &lt;a href=&quot;https://app.circleci.com/pipelines/github/adelapena/cassandra/1506/workflows/c3de011c-7a7e-4514-b377-c52cbf144b24&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;j11&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;
</comment>
                            <comment id="17528861" author="jmckenzie" created="Wed, 27 Apr 2022 15:41:34 +0000"  >&lt;p&gt;+1 here. We should maybe consider adding an entry to NEWS.txt to indicate the change from &lt;tt&gt;RuntimeException&lt;/tt&gt; on &lt;tt&gt;MutationExceededMaxSizeException&lt;/tt&gt; to &lt;tt&gt;InvalidRequestException&lt;/tt&gt;.&lt;br/&gt;
&#160;&lt;br/&gt;
I can&apos;t really imagine there&apos;s a lot of tooling in place out in the world that relies on the exception type being thrown on mutations exceeding max allowable sizes but stranger things have happened.&lt;/p&gt;</comment>
                            <comment id="17528893" author="jmckenzie" created="Wed, 27 Apr 2022 16:57:51 +0000"  >&lt;p&gt;Follow up thought - this moves our check up the stack in terms of where we look for oversized mutations. Maybe we should add back in the size check in the &lt;tt&gt;CommitLog.add&lt;/tt&gt; call as a kind of &quot;last protection&quot; (with a new log message to reflect the unexpected nature of seeing a large mutation there) in case of current unexpected paths or future changes that may introduce large mutations into the system?&lt;/p&gt;</comment>
                            <comment id="17528932" author="benedict" created="Wed, 27 Apr 2022 17:46:33 +0000"  >&lt;p&gt;I haven&apos;t looked at the patch, but worth noting we should not remove the size check on CommitLog without permitting the allocation of a dedicated segment for the record.&lt;/p&gt;</comment>
                            <comment id="17529617" author="jmckenzie" created="Thu, 28 Apr 2022 19:57:32 +0000"  >&lt;p&gt;Note: removing +1, pushing back to patch available. We need to keep oversized mutations out of the CommitLog at the least, and should likely create a follow up ticket to consider allowing allocation of dedicated segments for oversized mutations.&lt;/p&gt;</comment>
                            <comment id="17529899" author="gerrrr" created="Fri, 29 Apr 2022 10:26:44 +0000"  >&lt;p&gt;Looking at the CommitLog code, it will allocate a new segment if the mutation does not fit in the current segment (&lt;a href=&quot;https://github.com/apache/cassandra/blob/7ce140bd1dea311b9f98cdfbcd07dcff9fbd457c/src/java/org/apache/cassandra/db/commitlog/CommitLogSegmentManagerStandard.java#L52-L57&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;link&lt;/a&gt;). This effectively gives us the desired behavior as long as a single mutation fits in a segment or am I missing something?&lt;/p&gt;

&lt;p&gt;I can think of one corner case when a mutation is larger than a segment. I can add an assertion for that, just to be on the safe side.&lt;/p&gt;</comment>
                            <comment id="17530386" author="gerrrr" created="Sat, 30 Apr 2022 12:44:12 +0000"  >&lt;p&gt;I&apos;ve put the size validation back to CommitLog#add and added the NEWS entry.&lt;/p&gt;</comment>
                            <comment id="17530862" author="jmckenzie" created="Mon, 2 May 2022 17:37:57 +0000"  >&lt;blockquote&gt;&lt;p&gt;as long as a single mutation fits in a segment &lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;I think this is the key distinction. If mutations of effectively any size are allowed to get through to &lt;tt&gt;CommitLogSegmentManager&lt;span class=&quot;error&quot;&gt;&amp;#91;type&amp;#93;&lt;/span&gt;.allocate&lt;/tt&gt;, it&apos;ll spin forever saying there&apos;s not enough room in the segment and just keep on hitting &lt;tt&gt;advanceAllocatingFrom&lt;/tt&gt; and creating new segments. Which would be no good. &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;So probably best to protect ourselves from that in the future (which I see from your commit you&apos;ve done).&lt;/p&gt;

&lt;p&gt;Back to +1 from me pending CI. You good with it &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=adelapena&quot; class=&quot;user-hover&quot; rel=&quot;adelapena&quot;&gt;adelapena&lt;/a&gt;?&lt;/p&gt;</comment>
                            <comment id="17531148" author="adelapena" created="Tue, 3 May 2022 11:25:51 +0000"  >&lt;p&gt;Looks good to me, I have just started repeated runs for both &lt;tt&gt;OversizedMutationTest&lt;/tt&gt; and &lt;tt&gt;CommitLogTest&lt;/tt&gt; after rebasing on the new &lt;tt&gt;cassandra-4.1&lt;/tt&gt; branch without conflicts:&lt;/p&gt;

&lt;p&gt;OversizedMutationTest + pre-commit:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;&lt;a href=&quot;https://app.circleci.com/pipelines/github/adelapena/cassandra/1520/workflows/207ac25e-7a88-4220-8d9d-f752df711450&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;j8 &lt;/a&gt;&lt;/li&gt;
	&lt;li&gt;&lt;a href=&quot;https://app.circleci.com/pipelines/github/adelapena/cassandra/1520/workflows/b58bb268-af63-4272-840c-25f028b3e0f5&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;j11&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;CommitLogTest:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;&lt;a href=&quot;https://app.circleci.com/pipelines/github/adelapena/cassandra/1521/workflows/cdb34d69-518b-47ed-8e9d-676695fd8296&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;j8 &lt;/a&gt;&lt;/li&gt;
	&lt;li&gt;&lt;a href=&quot;https://app.circleci.com/pipelines/github/adelapena/cassandra/1521/workflows/7b1c1f9b-ad0c-4579-94e2-e7f4a5586567&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;j11&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="17532703" author="gerrrr" created="Fri, 6 May 2022 08:25:05 +0000"  >&lt;p&gt;CI looks good. I am moving the issue to ready to commit.&lt;/p&gt;</comment>
                            <comment id="17533708" author="gerrrr" created="Mon, 9 May 2022 09:04:40 +0000"  >&lt;p&gt;Committed as &lt;a href=&quot;https://github.com/apache/cassandra/commit/9f3bc657273dfa9e20d233636adf662904f01f34&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;9f3bc657273dfa9e20d233636adf662904f01f34&lt;/a&gt; to 4.1 and &lt;a href=&quot;https://github.com/apache/cassandra/commit/11bdf1bf8038fa7f872fe9161a0568d023e6cfac&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;11bdf1bf8038fa7f872fe9161a0568d023e6cfac&lt;/a&gt; to trunk.&lt;/p&gt;</comment>
                            <comment id="17533914" author="jmckenzie" created="Mon, 9 May 2022 17:07:12 +0000"  >&lt;p&gt;None of the single failures from the ASF CI run below look unaccounted for, and thus are likely not influenced by this patch.&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;CI Results&amp;#93;&lt;/span&gt;&lt;br/&gt;
Branch: 4.1, build number: 9&lt;br/&gt;
butler url: &lt;a href=&quot;https://butler.cassandra.apache.org/#/ci/upstream/compare/Cassandra-4.1/Cassandra-4.1&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://butler.cassandra.apache.org/#/ci/upstream/compare/Cassandra-4.1/Cassandra-4.1&lt;/a&gt;&lt;br/&gt;
jenkins url: &lt;a href=&quot;https://ci-cassandra.apache.org/job/Cassandra-4.1/9/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://ci-cassandra.apache.org/job/Cassandra-4.1/9/&lt;/a&gt;&lt;br/&gt;
JIRA: &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-17456&quot; title=&quot;Test Failures: write_failures_test.TestMultiDCWriteFailures.test_oversized_mutation&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-17456&quot;&gt;&lt;del&gt;CASSANDRA-17456&lt;/del&gt;&lt;/a&gt;&lt;br/&gt;
commit url: &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=cassandra.git;a=commit;h=9f3bc657273dfa9e20d233636adf662904f01f34&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=cassandra.git;a=commit;h=9f3bc657273dfa9e20d233636adf662904f01f34&lt;/a&gt;&lt;br/&gt;
affected paths:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;src/java/org/apache/cassandra/db/commitlog/CommitLog.java&lt;/li&gt;
	&lt;li&gt;test/unit/org/apache/cassandra/db/commitlog/CommitLogTest.java&lt;/li&gt;
	&lt;li&gt;NEWS.txt&lt;/li&gt;
	&lt;li&gt;src/java/org/apache/cassandra/db/MutationVerbHandler.java&lt;/li&gt;
	&lt;li&gt;src/java/org/apache/cassandra/cql3/statements/SingleTableUpdatesCollector.java&lt;/li&gt;
	&lt;li&gt;test/distributed/org/apache/cassandra/distributed/test/OversizedMutationTest.java&lt;/li&gt;
	&lt;li&gt;src/java/org/apache/cassandra/cql3/statements/BatchUpdatesCollector.java&lt;/li&gt;
	&lt;li&gt;src/java/org/apache/cassandra/db/MutationExceededMaxSizeException.java&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Build Result: UNSTABLE&lt;br/&gt;
Passing Tests: 48664&lt;br/&gt;
Failing Tests: 11&lt;/p&gt;
&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;Test&lt;/th&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;Failures&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;JIRA&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;org.apache.cassandra.net.ProxyHandlerConnectionsTest.testExpireSome-cdc&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;1 of 7&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-17301&quot; title=&quot;Test Failure: org.apache.cassandra.net.ProxyHandlerConnectionsTest.suddenDisconnect-cdc&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-17301&quot;&gt;&lt;del&gt;CASSANDRA-17301&lt;/del&gt;&lt;/a&gt;?&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;dtest-upgrade.upgrade_tests.upgrade_through_versions_test.TestProtoV4Upgrade_AllVersions_RandomPartitioner_EndsAt_Trunk_HEAD.test_parallel_upgrade_with_internode_ssl&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;2 of 7&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-17299&quot; title=&quot;Test Failure: dtest-upgrade.upgrade_tests.upgrade_through_versions_test.TestProtoV4Upgrade_AllVersions_RandomPartitioner_EndsAt_Trunk_HEAD.test_parallel_upgrade_with_internode_ssl&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-17299&quot;&gt;&lt;del&gt;CASSANDRA-17299&lt;/del&gt;&lt;/a&gt;?&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;org.apache.cassandra.distributed.test.CASTest.testConflictingWritesWithStaleRingInformation&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;2 of 7&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-17461&quot; title=&quot;Test Failure: org.apache.cassandra.distributed.test.CASTest.testConflictingWritesWithStaleRingInformation&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-17461&quot;&gt;&lt;del&gt;CASSANDRA-17461&lt;/del&gt;&lt;/a&gt;?&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;org.apache.cassandra.cql3.KeywordTest.test&lt;span class=&quot;error&quot;&gt;&amp;#91;keyword KEYS isReserved false&amp;#93;&lt;/span&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;1 of 7&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-17615&quot; title=&quot;Flaky org.apache.cassandra.cql3.KeywordTest&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-17615&quot;&gt;&lt;del&gt;CASSANDRA-17615&lt;/del&gt;&lt;/a&gt;?&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;org.apache.cassandra.distributed.test.CASTest.testSucccessfulWriteDuringRangeMovementFollowedByRead&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;3 of 7&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-17461&quot; title=&quot;Test Failure: org.apache.cassandra.distributed.test.CASTest.testConflictingWritesWithStaleRingInformation&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-17461&quot;&gt;&lt;del&gt;CASSANDRA-17461&lt;/del&gt;&lt;/a&gt;?&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;org.apache.cassandra.db.SinglePartitionSliceCommandTest.testPartitionDeletionRangeDeletionTie&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;3 of 7&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-17463&quot; title=&quot;Test Failure: org.apache.cassandra.db.SinglePartitionSliceCommandTest.testPartitionDeletionRowDeletionTie&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-17463&quot;&gt;&lt;del&gt;CASSANDRA-17463&lt;/del&gt;&lt;/a&gt;?&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;org.apache.cassandra.distributed.test.CASTest.testSuccessfulWriteBeforeRangeMovement&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;1 of 7&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-17461&quot; title=&quot;Test Failure: org.apache.cassandra.distributed.test.CASTest.testConflictingWritesWithStaleRingInformation&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-17461&quot;&gt;&lt;del&gt;CASSANDRA-17461&lt;/del&gt;&lt;/a&gt;?&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;dtest-upgrade.upgrade_tests.upgrade_through_versions_test.TestProtoV3Upgrade_AllVersions_RandomPartitioner_EndsAt_3_11_X_HEAD.test_rolling_upgrade_with_internode_ssl&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;1 of 7&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://issues.apache.org/jira/issues/?jql=project%20%3D%20CASSANDRA%20and%20resolution%20%3D%20unresolved%20and%20summary%20~%20%22*TestProtoV3Upgrade*%22&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;Multiple JIRAs found&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;org.apache.cassandra.db.SinglePartitionSliceCommandTest.testPartitionDeletionRowDeletionTie&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;1 of 7&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-17463&quot; title=&quot;Test Failure: org.apache.cassandra.db.SinglePartitionSliceCommandTest.testPartitionDeletionRowDeletionTie&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-17463&quot;&gt;&lt;del&gt;CASSANDRA-17463&lt;/del&gt;&lt;/a&gt;?&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;org.apache.cassandra.db.SinglePartitionSliceCommandTest.testPartitionDeletionRowDeletionTie-cdc&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;1 of 7&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-17463&quot; title=&quot;Test Failure: org.apache.cassandra.db.SinglePartitionSliceCommandTest.testPartitionDeletionRowDeletionTie&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-17463&quot;&gt;&lt;del&gt;CASSANDRA-17463&lt;/del&gt;&lt;/a&gt;?&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;
</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="13412583">CASSANDRA-17164</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[Gerrrr]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12313825" key="com.atlassian.jira.plugin.system.customfieldtypes:cascadingselect">
                        <customfieldname>Bug Category</customfieldname>
                        <customfieldvalues>
                                                    <customfieldvalue key="12982" cascade-level=""><![CDATA[Correctness]]></customfieldvalue>
                                <customfieldvalue key="12990" cascade-level="1"><![CDATA[Test Failure]]></customfieldvalue>
            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12313821" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Complexity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12965"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313822" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Discovered By</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12970"><![CDATA[Unit Test]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12313922" key="jira.plugin.projectspecificselectfield.jpssf:multicftype">
                        <customfieldname>Impacts</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="13100"><![CDATA[None]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            3 years, 27 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12313921" key="jira.plugin.projectspecificselectfield.jpssf:multicftype">
                        <customfieldname>Platform</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="13076"><![CDATA[All]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z10mhc:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[adelapena]]></customfieldvalue>
        <customfieldvalue><![CDATA[jmckenzie]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12962"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12311420" key="com.atlassian.jira.plugin.system.customfieldtypes:version">
                        <customfieldname>Since Version</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="12350145">4.1</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313924" key="com.atlassian.jira.plugin.system.customfieldtypes:textfield">
                        <customfieldname>Source Control Link</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>&lt;p&gt;Committed as 9f3bc657273dfa9e20d233636adf662904f01f34 to 4.1 and 11bdf1bf8038fa7f872fe9161a0568d023e6cfac to trunk.&lt;/p&gt;</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313823" key="com.atlassian.jira.plugin.system.customfieldtypes:textarea">
                        <customfieldname>Test and Documentation Plan</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>&lt;p&gt;I made the existing dtest applicable to C* versions until 4.0.x and added an in-jvm dtest to cover rejection of oversized mutations on insert.&lt;/p&gt;</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>