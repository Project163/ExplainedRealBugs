<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 23:28:47 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-18963] Test Failure: sstableutil_test.TestSSTableUtil</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-18963</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;Seems flaky &lt;a href=&quot;https://app.circleci.com/pipelines/github/driftx/cassandra/1342/workflows/9554c7b5-dd60-4f08-8db5-c954febc8ad6/jobs/58957/tests&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://app.circleci.com/pipelines/github/driftx/cassandra/1342/workflows/9554c7b5-dd60-4f08-8db5-c954febc8ad6/jobs/58957/tests&lt;/a&gt;&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;&lt;h4&gt;&lt;a name=&quot;testabortedcompaction&quot;&gt;&lt;/a&gt;test_abortedcompaction&lt;/h4&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;sstableutil_test.TestSSTableUtil&#160;&lt;br/&gt;
&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
self = &amp;lt;sstableutil_test.TestSSTableUtil object at 0x7fc099ecea58&amp;gt; def test_abortedcompaction(self): &lt;span class=&quot;code-quote&quot;&gt;&quot;&quot;&quot; @jira_ticket CASSANDRA-7066 @jira_ticket CASSANDRA-11497 Check that we can cleanup temporary files after a compaction is aborted. &quot;&lt;/span&gt;&lt;span class=&quot;code-quote&quot;&gt;&quot;&quot; log_file_name = &lt;span class=&quot;code-quote&quot;&gt;&apos;debug.log&apos;&lt;/span&gt; cluster = self.cluster cluster.populate(1).start() node = cluster.nodelist()[0] numrecords = 250000 self._create_data(node, KeyspaceName, TableName, numrecords) finalfiles, tmpfiles = self._check_files(node, KeyspaceName, TableName) &lt;span class=&quot;code-keyword&quot;&gt;assert&lt;/span&gt; len(finalfiles) &amp;gt; 0, &quot;&lt;/span&gt;Expected to find some &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; files&lt;span class=&quot;code-quote&quot;&gt;&quot; &lt;span class=&quot;code-keyword&quot;&gt;assert&lt;/span&gt; 0 == len(tmpfiles), &quot;&lt;/span&gt;Expected no tmp files&lt;span class=&quot;code-quote&quot;&gt;&quot; t = InterruptCompaction(node, TableName, filename=log_file_name, delay=2) t.start() &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt;: logger.debug(&quot;&lt;/span&gt;Compacting...&lt;span class=&quot;code-quote&quot;&gt;&quot;) node.compact() except ToolError: pass # expected to fail t.join() finalfiles = _normcase_all(self._invoke_sstableutil(KeyspaceName, TableName, type=&lt;span class=&quot;code-quote&quot;&gt;&apos;&lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt;&apos;&lt;/span&gt;)) tmpfiles = _normcase_all(self._invoke_sstableutil(KeyspaceName, TableName, type=&lt;span class=&quot;code-quote&quot;&gt;&apos;tmp&apos;&lt;/span&gt;)) # In most cases we should end up with some temporary files to clean up, but it may happen # that no temporary files are created &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; compaction finishes too early or starts too late # see CASSANDRA-11497 logger.debug(&quot;&lt;/span&gt;Got {} &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; files and {} tmp files after compaction was interrupted&lt;span class=&quot;code-quote&quot;&gt;&quot; .format(len(finalfiles), len(tmpfiles))) self._invoke_sstableutil(KeyspaceName, TableName, cleanup=True) self._check_files(node, KeyspaceName, TableName, finalfiles, []) # restart to make sure not data is lost logger.debug(&quot;&lt;/span&gt;Restarting node...&lt;span class=&quot;code-quote&quot;&gt;&quot;) &amp;gt; node.start(wait_for_binary_proto=True) sstableutil_test.py:97: _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ ../env3.6/lib/python3.6/site-packages/ccmlib/node.py:914: in start self.wait_for_binary_interface(from_mark=self.mark) ../env3.6/lib/python3.6/site-packages/ccmlib/node.py:702: in wait_for_binary_interface self.watch_log_for(&quot;&lt;/span&gt;Starting listening &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; CQL clients&lt;span class=&quot;code-quote&quot;&gt;&quot;, **kwargs) ../env3.6/lib/python3.6/site-packages/ccmlib/node.py:599: in watch_log_for self.raise_node_error_if_cassandra_process_is_terminated() _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ self = &amp;lt;ccmlib.node.Node object at 0x7fc08a583be0&amp;gt; def raise_node_error_if_cassandra_process_is_terminated(self): &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; not self._is_pid_running(): msg = &quot;&lt;/span&gt;C* process with {pid} is terminated&quot;.format(pid=self.pid) common.debug(msg) &amp;gt; raise NodeError(msg) E ccmlib.node.NodeError: C* process with 19530 is terminated ../env3.6/lib/python3.6/site-packages/ccmlib/node.py:683: NodeError&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
failed on teardown with &lt;span class=&quot;code-quote&quot;&gt;&quot;Unexpected error found in node logs (see stdout &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; full details). Errors: [[node1] &lt;span class=&quot;code-quote&quot;&gt;&apos;ERROR [SSTableBatchOpen:1] 2023-10-19 22:25:07,449 DefaultFSErrorHandler.java:129 - Exiting forcefully due to file system exception on startup, disk failure policy &quot;&lt;/span&gt;stop&lt;span class=&quot;code-quote&quot;&gt;&quot;\norg.apache.cassandra.io.sstable.CorruptSSTableException: Corrupted: /tmp/dtest-ahz16wrh/test/node1/data0/system/prepared_statements-18a9c2576a0c3841ba718cd529849fef/nc-4-big\n\tat org.apache.cassandra.io.sstable.format.SSTableReaderLoadingBuilder.build(SSTableReaderLoadingBuilder.java:111)\n\tat org.apache.cassandra.io.sstable.format.SSTableReader.open(SSTableReader.java:397)\n\tat org.apache.cassandra.io.sstable.format.SSTableReader.open(SSTableReader.java:353)\n\tat org.apache.cassandra.io.sstable.format.SSTableReader.lambda$openAll$4(SSTableReader.java:414)\n\tat org.apache.cassandra.concurrent.FutureTask$1.call(FutureTask.java:96)\n\tat org.apache.cassandra.concurrent.FutureTask.call(FutureTask.java:61)\n\tat org.apache.cassandra.concurrent.FutureTask.run(FutureTask.java:71)\n\tat java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1128)\n\tat java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:628)\n\tat io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)\n\tat java.base/java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:829)\nCaused by: java.lang.IllegalArgumentException: &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;\n\tat com.google.common.base.Preconditions.checkArgument(Preconditions.java:129)\n\tat org.apache.cassandra.io.sstable.format.big.BigSSTableReaderLoadingBuilder.openComponents(BigSSTableReaderLoadingBuilder.java:79)\n\tat org.apache.cassandra.io.sstable.format.big.BigSSTableReaderLoadingBuilder.openComponents(BigSSTableReaderLoadingBuilder.java:58)\n\tat org.apache.cassandra.io.sstable.format.SSTableReaderLoadingBuilder.build(SSTableReaderLoadingBuilder.java:92)\n\t... 10 common frames omitted&apos;&lt;/span&gt;, [node1] &lt;span class=&quot;code-quote&quot;&gt;&apos;ERROR [SSTableBatchOpen:4] 2023-10-19 22:25:07,449 DefaultFSErrorHandler.java:129 - Exiting forcefully due to file system exception on startup, disk failure policy &quot;&lt;/span&gt;stop&lt;span class=&quot;code-quote&quot;&gt;&quot;\norg.apache.cassandra.io.sstable.CorruptSSTableException: Corrupted: /tmp/dtest-ahz16wrh/test/node1/data0/system/prepared_statements-18a9c2576a0c3841ba718cd529849fef/nc-5-big\n\tat org.apache.cassandra.io.sstable.format.SSTableReaderLoadingBuilder.build(SSTableReaderLoadingBuilder.java:111)\n\tat org.apache.cassandra.io.sstable.format.SSTableReader.open(SSTableReader.java:397)\n\tat org.apache.cassandra.io.sstable.format.SSTableReader.open(SSTableReader.java:353)\n\tat org.apache.cassandra.io.sstable.format.SSTableReader.lambda$openAll$4(SSTableReader.java:414)\n\tat org.apache.cassandra.concurrent.FutureTask$1.call(FutureTask.java:96)\n\tat org.apache.cassandra.concurrent.FutureTask.call(FutureTask.java:61)\n\tat org.apache.cassandra.concurrent.FutureTask.run(FutureTask.java:71)\n\tat java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1128)\n\tat java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:628)\n\tat io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)\n\tat java.base/java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:829)\nCaused by: java.lang.IllegalArgumentException: &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;\n\tat com.google.common.base.Preconditions.checkArgument(Preconditions.java:129)\n\tat org.apache.cassandra.io.sstable.format.big.BigSSTableReaderLoadingBuilder.openComponents(BigSSTableReaderLoadingBuilder.java:79)\n\tat org.apache.cassandra.io.sstable.format.big.BigSSTableReaderLoadingBuilder.openComponents(BigSSTableReaderLoadingBuilder.java:58)\n\tat org.apache.cassandra.io.sstable.format.SSTableReaderLoadingBuilder.build(SSTableReaderLoadingBuilder.java:92)\n\t... 10 common frames omitted&apos;&lt;/span&gt;, [node1] &lt;span class=&quot;code-quote&quot;&gt;&apos;ERROR [SSTableBatchOpen:4] 2023-10-19 22:25:07,450 SSTableReader.java:419 - Corrupt sstable /tmp/dtest-ahz16wrh/test/node1/data0/system/prepared_statements-18a9c2576a0c3841ba718cd529849fef/nc-5-big=[Index.db, Data.db]; skipping table\norg.apache.cassandra.io.sstable.CorruptSSTableException: Corrupted: /tmp/dtest-ahz16wrh/test/node1/data0/system/prepared_statements-18a9c2576a0c3841ba718cd529849fef/nc-5-big\n\tat org.apache.cassandra.io.sstable.format.SSTableReaderLoadingBuilder.build(SSTableReaderLoadingBuilder.java:111)\n\tat org.apache.cassandra.io.sstable.format.SSTableReader.open(SSTableReader.java:397)\n\tat org.apache.cassandra.io.sstable.format.SSTableReader.open(SSTableReader.java:353)\n\tat org.apache.cassandra.io.sstable.format.SSTableReader.lambda$openAll$4(SSTableReader.java:414)\n\tat org.apache.cassandra.concurrent.FutureTask$1.call(FutureTask.java:96)\n\tat org.apache.cassandra.concurrent.FutureTask.call(FutureTask.java:61)\n\tat org.apache.cassandra.concurrent.FutureTask.run(FutureTask.java:71)\n\tat java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1128)\n\tat java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:628)\n\tat io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)\n\tat java.base/java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:829)\nCaused by: java.lang.IllegalArgumentException: &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;\n\tat com.google.common.base.Preconditions.checkArgument(Preconditions.java:129)\n\tat org.apache.cassandra.io.sstable.format.big.BigSSTableReaderLoadingBuilder.openComponents(BigSSTableReaderLoadingBuilder.java:79)\n\tat org.apache.cassandra.io.sstable.format.big.BigSSTableReaderLoadingBuilder.openComponents(BigSSTableReaderLoadingBuilder.java:58)\n\tat org.apache.cassandra.io.sstable.format.SSTableReaderLoadingBuilder.build(SSTableReaderLoadingBuilder.java:92)\n\t... 10 common frames omitted&apos;&lt;/span&gt;]&quot;&lt;/span&gt; Unexpected error found in node logs (see stdout &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; full details). Errors: [[node1] &lt;span class=&quot;code-quote&quot;&gt;&apos;ERROR [SSTableBatchOpen:1] 2023-10-19 22:25:07,449 DefaultFSErrorHandler.java:129 - Exiting forcefully due to file system exception on startup, disk failure policy &lt;span class=&quot;code-quote&quot;&gt;&quot;stop&quot;&lt;/span&gt;\norg.apache.cassandra.io.sstable.CorruptSSTableException: Corrupted: /tmp/dtest-ahz16wrh/test/node1/data0/system/prepared_statements-18a9c2576a0c3841ba718cd529849fef/nc-4-big\n\tat org.apache.cassandra.io.sstable.format.SSTableReaderLoadingBuilder.build(SSTableReaderLoadingBuilder.java:111)\n\tat org.apache.cassandra.io.sstable.format.SSTableReader.open(SSTableReader.java:397)\n\tat org.apache.cassandra.io.sstable.format.SSTableReader.open(SSTableReader.java:353)\n\tat org.apache.cassandra.io.sstable.format.SSTableReader.lambda$openAll$4(SSTableReader.java:414)\n\tat org.apache.cassandra.concurrent.FutureTask$1.call(FutureTask.java:96)\n\tat org.apache.cassandra.concurrent.FutureTask.call(FutureTask.java:61)\n\tat org.apache.cassandra.concurrent.FutureTask.run(FutureTask.java:71)\n\tat java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1128)\n\tat java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:628)\n\tat io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)\n\tat java.base/java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:829)\nCaused by: java.lang.IllegalArgumentException: &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;\n\tat com.google.common.base.Preconditions.checkArgument(Preconditions.java:129)\n\tat org.apache.cassandra.io.sstable.format.big.BigSSTableReaderLoadingBuilder.openComponents(BigSSTableReaderLoadingBuilder.java:79)\n\tat org.apache.cassandra.io.sstable.format.big.BigSSTableReaderLoadingBuilder.openComponents(BigSSTableReaderLoadingBuilder.java:58)\n\tat org.apache.cassandra.io.sstable.format.SSTableReaderLoadingBuilder.build(SSTableReaderLoadingBuilder.java:92)\n\t... 10 common frames omitted&apos;&lt;/span&gt;, [node1] &lt;span class=&quot;code-quote&quot;&gt;&apos;ERROR [SSTableBatchOpen:4] 2023-10-19 22:25:07,449 DefaultFSErrorHandler.java:129 - Exiting forcefully due to file system exception on startup, disk failure policy &lt;span class=&quot;code-quote&quot;&gt;&quot;stop&quot;&lt;/span&gt;\norg.apache.cassandra.io.sstable.CorruptSSTableException: Corrupted: /tmp/dtest-ahz16wrh/test/node1/data0/system/prepared_statements-18a9c2576a0c3841ba718cd529849fef/nc-5-big\n\tat org.apache.cassandra.io.sstable.format.SSTableReaderLoadingBuilder.build(SSTableReaderLoadingBuilder.java:111)\n\tat org.apache.cassandra.io.sstable.format.SSTableReader.open(SSTableReader.java:397)\n\tat org.apache.cassandra.io.sstable.format.SSTableReader.open(SSTableReader.java:353)\n\tat org.apache.cassandra.io.sstable.format.SSTableReader.lambda$openAll$4(SSTableReader.java:414)\n\tat org.apache.cassandra.concurrent.FutureTask$1.call(FutureTask.java:96)\n\tat org.apache.cassandra.concurrent.FutureTask.call(FutureTask.java:61)\n\tat org.apache.cassandra.concurrent.FutureTask.run(FutureTask.java:71)\n\tat java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1128)\n\tat java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:628)\n\tat io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)\n\tat java.base/java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:829)\nCaused by: java.lang.IllegalArgumentException: &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;\n\tat com.google.common.base.Preconditions.checkArgument(Preconditions.java:129)\n\tat org.apache.cassandra.io.sstable.format.big.BigSSTableReaderLoadingBuilder.openComponents(BigSSTableReaderLoadingBuilder.java:79)\n\tat org.apache.cassandra.io.sstable.format.big.BigSSTableReaderLoadingBuilder.openComponents(BigSSTableReaderLoadingBuilder.java:58)\n\tat org.apache.cassandra.io.sstable.format.SSTableReaderLoadingBuilder.build(SSTableReaderLoadingBuilder.java:92)\n\t... 10 common frames omitted&apos;&lt;/span&gt;, [node1] &lt;span class=&quot;code-quote&quot;&gt;&apos;ERROR [SSTableBatchOpen:4] 2023-10-19 22:25:07,450 SSTableReader.java:419 - Corrupt sstable /tmp/dtest-ahz16wrh/test/node1/data0/system/prepared_statements-18a9c2576a0c3841ba718cd529849fef/nc-5-big=[Index.db, Data.db]; skipping table\norg.apache.cassandra.io.sstable.CorruptSSTableException: Corrupted: /tmp/dtest-ahz16wrh/test/node1/data0/system/prepared_statements-18a9c2576a0c3841ba718cd529849fef/nc-5-big\n\tat org.apache.cassandra.io.sstable.format.SSTableReaderLoadingBuilder.build(SSTableReaderLoadingBuilder.java:111)\n\tat org.apache.cassandra.io.sstable.format.SSTableReader.open(SSTableReader.java:397)\n\tat org.apache.cassandra.io.sstable.format.SSTableReader.open(SSTableReader.java:353)\n\tat org.apache.cassandra.io.sstable.format.SSTableReader.lambda$openAll$4(SSTableReader.java:414)\n\tat org.apache.cassandra.concurrent.FutureTask$1.call(FutureTask.java:96)\n\tat org.apache.cassandra.concurrent.FutureTask.call(FutureTask.java:61)\n\tat org.apache.cassandra.concurrent.FutureTask.run(FutureTask.java:71)\n\tat java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1128)\n\tat java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:628)\n\tat io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)\n\tat java.base/java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:829)\nCaused by: java.lang.IllegalArgumentException: &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;\n\tat com.google.common.base.Preconditions.checkArgument(Preconditions.java:129)\n\tat org.apache.cassandra.io.sstable.format.big.BigSSTableReaderLoadingBuilder.openComponents(BigSSTableReaderLoadingBuilder.java:79)\n\tat org.apache.cassandra.io.sstable.format.big.BigSSTableReaderLoadingBuilder.openComponents(BigSSTableReaderLoadingBuilder.java:58)\n\tat org.apache.cassandra.io.sstable.format.SSTableReaderLoadingBuilder.build(SSTableReaderLoadingBuilder.java:92)\n\t... 10 common frames omitted&apos;&lt;/span&gt;]&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="13555636">CASSANDRA-18963</key>
            <summary>Test Failure: sstableutil_test.TestSSTableUtil</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10002" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Normal</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="jlewandowski">Jacek Lewandowski</assignee>
                                    <reporter username="bereng">Berenguer Blasi</reporter>
                        <labels>
                    </labels>
                <created>Thu, 26 Oct 2023 09:42:06 +0000</created>
                <updated>Fri, 10 Oct 2025 08:47:59 +0000</updated>
                            <resolved>Tue, 28 Nov 2023 17:55:24 +0000</resolved>
                                        <fixVersion>4.0.12</fixVersion>
                    <fixVersion>4.1.4</fixVersion>
                    <fixVersion>5.0-beta1</fixVersion>
                    <fixVersion>5.0</fixVersion>
                    <fixVersion>5.1</fixVersion>
                                    <component>Legacy/Local Write-Read Paths</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="17781568" author="edimitrova" created="Wed, 1 Nov 2023 01:12:16 +0000"  >&lt;p&gt;Trying to identify affected versions. Running the multiplexer here:&lt;/p&gt;

&lt;p&gt;4.1 - &lt;a href=&quot;https://app.circleci.com/pipelines/github/ekaterinadimitrova2/cassandra?branch=18963-4.1&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://app.circleci.com/pipelines/github/ekaterinadimitrova2/cassandra?branch=18963-4.1&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;5.0 - &lt;a href=&quot;https://app.circleci.com/pipelines/github/ekaterinadimitrova2/cassandra?branch=18963-5.0&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://app.circleci.com/pipelines/github/ekaterinadimitrova2/cassandra?branch=18963-5.0&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17781750" author="edimitrova" created="Wed, 1 Nov 2023 14:14:55 +0000"  >&lt;p&gt;The test was less flaky in 4.1, and the error was different:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
failed on teardown with &lt;span class=&quot;code-quote&quot;&gt;&quot;Unexpected error found in node logs (see stdout &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; full details). Errors: [[node1] &lt;span class=&quot;code-quote&quot;&gt;&apos;ERROR [SSTableBatchOpen:1] 2023-11-01 00:49:29,910 JVMStabilityInspector.java:68 - Exception in thread &lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;[SSTableBatchOpen:1,5,SSTableBatchOpen]\njava.lang.AssertionError: Stats component is missing &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; sstable /tmp/dtest-14cqh6up/test/node1/data0/system/prepared_statements-18a9c2576a0c3841ba718cd529849fef/nb-4-big\n\tat org.apache.cassandra.io.sstable.format.SSTableReader.open(SSTableReader.java:470)\n\tat org.apache.cassandra.io.sstable.format.SSTableReader.open(SSTableReader.java:381)\n\tat org.apache.cassandra.io.sstable.format.SSTableReader$2.run(SSTableReader.java:551)\n\tat org.apache.cassandra.concurrent.FutureTask$1.call(FutureTask.java:96)\n\tat org.apache.cassandra.concurrent.FutureTask.call(FutureTask.java:61)\n\tat org.apache.cassandra.concurrent.FutureTask.run(FutureTask.java:71)\n\tat java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1128)\n\tat java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:628)\n\tat io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)\n\tat java.base/java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:829)&apos;&lt;/span&gt;, [node1] &lt;span class=&quot;code-quote&quot;&gt;&apos;ERROR [SSTableBatchOpen:3] 2023-11-01 00:49:29,910 JVMStabilityInspector.java:68 - Exception in thread &lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;[SSTableBatchOpen:3,5,SSTableBatchOpen]\njava.lang.AssertionError: Stats component is missing &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; sstable /tmp/dtest-14cqh6up/test/node1/data0/system/prepared_statements-18a9c2576a0c3841ba718cd529849fef/nb-5-big\n\tat org.apache.cassandra.io.sstable.format.SSTableReader.open(SSTableReader.java:470)\n\tat org.apache.cassandra.io.sstable.format.SSTableReader.open(SSTableReader.java:381)\n\tat org.apache.cassandra.io.sstable.format.SSTableReader$2.run(SSTableReader.java:551)\n\tat org.apache.cassandra.concurrent.FutureTask$1.call(FutureTask.java:96)\n\tat org.apache.cassandra.concurrent.FutureTask.call(FutureTask.java:61)\n\tat org.apache.cassandra.concurrent.FutureTask.run(FutureTask.java:71)\n\tat java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1128)\n\tat java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:628)\n\tat io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)\n\tat java.base/java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:829)&apos;&lt;/span&gt;]&quot;&lt;/span&gt; Unexpected error found in node logs (see stdout &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; full details). Errors: [[node1] &lt;span class=&quot;code-quote&quot;&gt;&apos;ERROR [SSTableBatchOpen:1] 2023-11-01 00:49:29,910 JVMStabilityInspector.java:68 - Exception in thread &lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;[SSTableBatchOpen:1,5,SSTableBatchOpen]\njava.lang.AssertionError: Stats component is missing &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; sstable /tmp/dtest-14cqh6up/test/node1/data0/system/prepared_statements-18a9c2576a0c3841ba718cd529849fef/nb-4-big\n\tat org.apache.cassandra.io.sstable.format.SSTableReader.open(SSTableReader.java:470)\n\tat org.apache.cassandra.io.sstable.format.SSTableReader.open(SSTableReader.java:381)\n\tat org.apache.cassandra.io.sstable.format.SSTableReader$2.run(SSTableReader.java:551)\n\tat org.apache.cassandra.concurrent.FutureTask$1.call(FutureTask.java:96)\n\tat org.apache.cassandra.concurrent.FutureTask.call(FutureTask.java:61)\n\tat org.apache.cassandra.concurrent.FutureTask.run(FutureTask.java:71)\n\tat java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1128)\n\tat java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:628)\n\tat io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)\n\tat java.base/java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:829)&apos;&lt;/span&gt;, [node1] &lt;span class=&quot;code-quote&quot;&gt;&apos;ERROR [SSTableBatchOpen:3] 2023-11-01 00:49:29,910 JVMStabilityInspector.java:68 - Exception in thread &lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;[SSTableBatchOpen:3,5,SSTableBatchOpen]\njava.lang.AssertionError: Stats component is missing &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; sstable /tmp/dtest-14cqh6up/test/node1/data0/system/prepared_statements-18a9c2576a0c3841ba718cd529849fef/nb-5-big\n\tat org.apache.cassandra.io.sstable.format.SSTableReader.open(SSTableReader.java:470)\n\tat org.apache.cassandra.io.sstable.format.SSTableReader.open(SSTableReader.java:381)\n\tat org.apache.cassandra.io.sstable.format.SSTableReader$2.run(SSTableReader.java:551)\n\tat org.apache.cassandra.concurrent.FutureTask$1.call(FutureTask.java:96)\n\tat org.apache.cassandra.concurrent.FutureTask.call(FutureTask.java:61)\n\tat org.apache.cassandra.concurrent.FutureTask.run(FutureTask.java:71)\n\tat java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1128)\n\tat java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:628)\n\tat io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)\n\tat java.base/java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:829)&apos;&lt;/span&gt;]&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;This ticket shows a regression in 5.0. I will open a separate ticket for the 4.1 issue discovered.&#160;&lt;/p&gt;</comment>
                            <comment id="17783681" author="brandon.williams" created="Tue, 7 Nov 2023 16:17:20 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=blerer&quot; class=&quot;user-hover&quot; rel=&quot;blerer&quot;&gt;blerer&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=e.dimitrova&quot; class=&quot;user-hover&quot; rel=&quot;e.dimitrova&quot;&gt;e.dimitrova&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jlewandowski&quot; class=&quot;user-hover&quot; rel=&quot;jlewandowski&quot;&gt;jlewandowski&lt;/a&gt; it looks like &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-18747&quot; title=&quot;Test failure: Fix assertion error AssertionError: Unknown keyspace system_auth\n\tat org.apache.cassandra.db.Keyspace.&amp;lt;init&amp;gt;(Keyspace.java:324)\n\tat org.apache.cassandra.db.Keyspace.lambda$open$0(Keyspace.java:162)&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-18747&quot;&gt;&lt;del&gt;CASSANDRA-18747&lt;/del&gt;&lt;/a&gt; is responsible for both this ticket and &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-18991&quot; title=&quot;Test failure: sstableutil_test.TestSSTableUtil.test_abortedcompaction&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-18991&quot;&gt;&lt;del&gt;CASSANDRA-18991&lt;/del&gt;&lt;/a&gt;.  On 4.1 the &lt;a href=&quot;https://app.circleci.com/pipelines/github/driftx/cassandra/1355/workflows/066deee5-e1a4-434c-91e5-fe8602084e86/jobs/60281&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;initial commit&lt;/a&gt; fails while the one &lt;a href=&quot;https://app.circleci.com/pipelines/github/driftx/cassandra/1357/workflows/97a73b15-8b23-4617-969b-9077284e664d/jobs/60483&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;before passes&lt;/a&gt; (&lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-18991&quot; title=&quot;Test failure: sstableutil_test.TestSSTableUtil.test_abortedcompaction&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-18991&quot;&gt;&lt;del&gt;CASSANDRA-18991&lt;/del&gt;&lt;/a&gt;), and then the &lt;a href=&quot;https://app.circleci.com/pipelines/github/driftx/cassandra/1354/workflows/5dc4d5b4-4f1a-46c8-8208-78715b409068/jobs/60184&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;merge to 5.0 fails&lt;/a&gt; where it previously &lt;a href=&quot;https://app.circleci.com/pipelines/github/driftx/cassandra/1356/workflows/fe99cc03-588a-469c-8ffb-ae62bf73d672/jobs/60386&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;did not&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="17784564" author="edimitrova" created="Thu, 9 Nov 2023 17:44:02 +0000"  >&lt;p&gt;Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=brandon.williams&quot; class=&quot;user-hover&quot; rel=&quot;brandon.williams&quot;&gt;brandon.williams&lt;/a&gt; ! I will close the other ticket then and try to look into this today. I do not have an immediate response to what happened, unfortunately.&lt;/p&gt;</comment>
                            <comment id="17784570" author="brandon.williams" created="Thu, 9 Nov 2023 18:13:15 +0000"  >&lt;p&gt;When I looked there wasn&apos;t anything obvious to me either, but I was actually doublechecking the bisect with the circle links, so I&apos;m pretty certain it&apos;s correct.&lt;/p&gt;</comment>
                            <comment id="17784574" author="edimitrova" created="Thu, 9 Nov 2023 18:25:07 +0000"  >&lt;blockquote&gt;&lt;p&gt;but I was actually doublechecking the bisect with the circle links, so I&apos;m pretty certain it&apos;s correct.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;I might not like what Circle shows us, but I trust it &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/biggrin.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="17784628" author="edimitrova" created="Thu, 9 Nov 2023 23:50:01 +0000"  >&lt;p&gt;I can confirm that the original patch that was suggested in &#160;&lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-18747&quot; title=&quot;Test failure: Fix assertion error AssertionError: Unknown keyspace system_auth\n\tat org.apache.cassandra.db.Keyspace.&amp;lt;init&amp;gt;(Keyspace.java:324)\n\tat org.apache.cassandra.db.Keyspace.lambda$open$0(Keyspace.java:162)&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-18747&quot;&gt;&lt;del&gt;CASSANDRA-18747&lt;/del&gt;&lt;/a&gt; does not trigger the problem - &lt;a href=&quot;https://github.com/ekaterinadimitrova2/cassandra/commit/1dece14f4ea88024663af45fb3cd1a2eab01279d&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/ekaterinadimitrova2/cassandra/commit/1dece14f4ea88024663af45fb3cd1a2eab01279d&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;(not that I expected to, but I wanted to eliminate things) - &lt;a href=&quot;https://app.circleci.com/pipelines/github/ekaterinadimitrova2/cassandra/2561/workflows/115b12a8-38ae-45b4-8111-c233f06ba68e&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://app.circleci.com/pipelines/github/ekaterinadimitrova2/cassandra/2561/workflows/115b12a8-38ae-45b4-8111-c233f06ba68e&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;So, something went wrong with the additional fixes that were applied in the improved version.&lt;/p&gt;

&lt;p&gt;I still do not know what yet, though.&#160;&lt;/p&gt;</comment>
                            <comment id="17785107" author="edimitrova" created="Sat, 11 Nov 2023 02:27:21 +0000"  >&lt;p&gt;I was looking into this side on the side, adding some additional logging, but I did not see anything obvious.&lt;/p&gt;

&lt;p&gt;I will be off until Thursday, and I can try to look into it again when I am back. I am wondering whether we did not uncover another bug with the changes. Maybe it is worth it to talk also to &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jlewandowski&quot; class=&quot;user-hover&quot; rel=&quot;jlewandowski&quot;&gt;jlewandowski&lt;/a&gt; or &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=blerer&quot; class=&quot;user-hover&quot; rel=&quot;blerer&quot;&gt;blerer&lt;/a&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="17785952" author="brandon.williams" created="Tue, 14 Nov 2023 16:20:02 +0000"  >&lt;p&gt;One odd thing here is the table is always prepared_statements that I&apos;ve seen, which the test itself isn&apos;t directly touching (though stress uses prepared mode by default.)  I changed the test to use unprepared mode and it hasn&apos;t failed.&lt;/p&gt;</comment>
                            <comment id="17785984" author="brandon.williams" created="Tue, 14 Nov 2023 17:09:07 +0000"  >&lt;p&gt;It did eventually fail, we also have a problem with compaction_history:&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;  node1: ERROR &lt;span class=&quot;error&quot;&gt;&amp;#91;SSTableBatchOpen:3&amp;#93;&lt;/span&gt; 2023-11-14 11:04:07,460 DefaultFSErrorHandler.java:129 - Exiting forcefully due to file system exception on startup, disk failure policy &quot;stop&quot;&lt;br/&gt;
  org.apache.cassandra.io.sstable.CorruptSSTableException: Corrupted: /tmp/dtest-orisqlb8/test/node1/data0/system/compaction_history-b4dbb7b4dc493fb5b3bfce6e434832ca/nb-4-big-Statistics.db&lt;br/&gt;
        at org.apache.cassandra.io.sstable.format.StatsComponent.load(StatsComponent.java:67)&lt;br/&gt;
        at org.apache.cassandra.io.sstable.format.big.BigSSTableReaderLoadingBuilder.openComponents(BigSSTableReaderLoadingBuilder.java:77)&lt;br/&gt;
        at org.apache.cassandra.io.sstable.format.big.BigSSTableReaderLoadingBuilder.openComponents(BigSSTableReaderLoadingBuilder.java:58)&lt;br/&gt;
        at org.apache.cassandra.io.sstable.format.SSTableReaderLoadingBuilder.build(SSTableReaderLoadingBuilder.java:92)&lt;br/&gt;
        at org.apache.cassandra.io.sstable.format.SSTableReader.open(SSTableReader.java:397)&lt;br/&gt;
        at org.apache.cassandra.io.sstable.format.SSTableReader.open(SSTableReader.java:353)&lt;br/&gt;
        at org.apache.cassandra.io.sstable.format.SSTableReader.lambda$openAll$4(SSTableReader.java:414)&lt;br/&gt;
        at org.apache.cassandra.concurrent.FutureTask$1.call(FutureTask.java:96)&lt;br/&gt;
        at org.apache.cassandra.concurrent.FutureTask.call(FutureTask.java:61)&lt;br/&gt;
        at org.apache.cassandra.concurrent.FutureTask.run(FutureTask.java:71)&lt;br/&gt;
        at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1128)&lt;br/&gt;
        at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:628)&lt;br/&gt;
        at io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)&lt;br/&gt;
        at java.base/java.lang.Thread.run(Thread.java:829)&lt;br/&gt;
  Caused by: java.io.EOFException: null&lt;br/&gt;
        at org.apache.cassandra.io.util.RebufferingInputStream.readByte(RebufferingInputStream.java:180)&lt;br/&gt;
        at org.apache.cassandra.io.util.RebufferingInputStream.readPrimitiveSlowly(RebufferingInputStream.java:142)&lt;br/&gt;
        at org.apache.cassandra.io.util.RebufferingInputStream.readInt(RebufferingInputStream.java:222)&lt;br/&gt;
        at org.apache.cassandra.io.sstable.metadata.MetadataSerializer.deserialize(MetadataSerializer.java:160)&lt;br/&gt;
        at org.apache.cassandra.io.sstable.metadata.MetadataSerializer.deserialize(MetadataSerializer.java:135)&lt;br/&gt;
        at org.apache.cassandra.io.sstable.format.StatsComponent.load(StatsComponent.java:63)&lt;br/&gt;
        ... 13 common frames omitted   &lt;br/&gt;
  node1: ERROR &lt;span class=&quot;error&quot;&gt;&amp;#91;SSTableBatchOpen:4&amp;#93;&lt;/span&gt; 2023-11-14 11:04:07,460 DefaultFSErrorHandler.java:129 - Exiting forcefully due to file system exception on startup, disk failure policy &quot;stop&quot;&lt;br/&gt;
  org.apache.cassandra.io.sstable.CorruptSSTableException: Corrupted: /tmp/dtest-orisqlb8/test/node1/data0/system/compaction_history-b4dbb7b4dc493fb5b3bfce6e434832ca/nb-5-big-Statistics.db&lt;br/&gt;
        at org.apache.cassandra.io.sstable.format.StatsComponent.load(StatsComponent.java:67)&lt;br/&gt;
        at org.apache.cassandra.io.sstable.format.big.BigSSTableReaderLoadingBuilder.openComponents(BigSSTableReaderLoadingBuilder.java:77)&lt;br/&gt;
        at org.apache.cassandra.io.sstable.format.big.BigSSTableReaderLoadingBuilder.openComponents(BigSSTableReaderLoadingBuilder.java:58)&lt;br/&gt;
        at org.apache.cassandra.io.sstable.format.SSTableReaderLoadingBuilder.build(SSTableReaderLoadingBuilder.java:92)&lt;br/&gt;
        at org.apache.cassandra.io.sstable.format.SSTableReader.open(SSTableReader.java:397)&lt;br/&gt;
        at org.apache.cassandra.io.sstable.format.SSTableReader.open(SSTableReader.java:353)&lt;br/&gt;
        at org.apache.cassandra.io.sstable.format.SSTableReader.lambda$openAll$4(SSTableReader.java:414)&lt;br/&gt;
        at org.apache.cassandra.concurrent.FutureTask$1.call(FutureTask.java:96)&lt;br/&gt;
        at org.apache.cassandra.concurrent.FutureTask.call(FutureTask.java:61)&lt;br/&gt;
        at org.apache.cassandra.concurrent.FutureTask.run(FutureTask.java:71)&lt;br/&gt;
        at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1128)&lt;br/&gt;
        at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:628)&lt;br/&gt;
        at io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)&lt;br/&gt;
        at java.base/java.lang.Thread.run(Thread.java:829)&lt;br/&gt;
  Caused by: java.io.EOFException: null&lt;br/&gt;
        at org.apache.cassandra.io.util.RebufferingInputStream.readByte(RebufferingInputStream.java:180)&lt;br/&gt;
        at org.apache.cassandra.io.util.RebufferingInputStream.readPrimitiveSlowly(RebufferingInputStream.java:142)&lt;br/&gt;
        at org.apache.cassandra.io.util.RebufferingInputStream.readInt(RebufferingInputStream.java:222)&lt;br/&gt;
        at org.apache.cassandra.io.sstable.metadata.MetadataSerializer.deserialize(MetadataSerializer.java:160)&lt;br/&gt;
        at org.apache.cassandra.io.sstable.metadata.MetadataSerializer.deserialize(MetadataSerializer.java:135)&lt;br/&gt;
        at org.apache.cassandra.io.sstable.format.StatsComponent.load(StatsComponent.java:63)&lt;br/&gt;
        ... 13 common frames omitted&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Both of these are non-distributed system tables.&lt;/p&gt;</comment>
                            <comment id="17788453" author="jlewandowski" created="Tue, 21 Nov 2023 15:13:26 +0000"  >&lt;p&gt;I&apos;ll try to fix it&lt;/p&gt;</comment>
                            <comment id="17788464" author="jlewandowski" created="Tue, 21 Nov 2023 15:53:40 +0000"  >&lt;p&gt;It looks like that the problem is caused by the fact we try to open an sstable which misses STATS component. We can see that from &quot;moving...&quot; log entries - when the node starts, it moves sstables of the system keyspace from non-first to the first data location - thanks to that fact I noticed that there is no STATS file moved for the problematic table. &lt;/p&gt;

&lt;p&gt;Another observation is that, the table in question was being compacted when the compactions were interrupted and the process was stopped. I&apos;d expect that the incomplete sstable is marked as such in the transaction log file and then it is skipped during scan when the node restarts. I&apos;d like to try that scenario in the isolated test - see the state of the transaction log before the stats component is written, and then, if such transaction log prevents such sstable from loading.&lt;/p&gt;</comment>
                            <comment id="17788537" author="jlewandowski" created="Tue, 21 Nov 2023 20:31:56 +0000"  >&lt;p&gt;I think I can see how it can happen...&lt;/p&gt;

&lt;p&gt;When the sstable writer prepares for committing the transaction, it does the following stuff in &lt;tt&gt;doPrepare&lt;/tt&gt; method:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
        &lt;span class=&quot;code-keyword&quot;&gt;protected&lt;/span&gt; void doPrepare()
        {
            transactionals.get().forEach(Transactional::prepareToCommit);
            &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; StatsComponent(finalizeMetadata()).save(descriptor);
...
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;When entering this method, there is only data and index components in the directory. After the first line, the rest of the components are created - but stats component. There is also a transaction log file which seems to say that the sstable is in-progress of writing. In the problematic scenario, the execution is interrupted between the first and the second line of doPrepare, which means that we do not have stats component but we do have transaction log. &lt;/p&gt;

&lt;p&gt;The problem is, those files are moved to a different directory on startup (as mentioned in the previous comment) and the transaction log identifies sstables by full absolute path, which is not updated on move. That&apos;s way the directory lister does not recognize this sstable as incomplete and tries to load it, which leads to the problem.&lt;/p&gt;

&lt;p&gt;It does not look new to me. It seems like the problem is there probably as long as we use &lt;tt&gt;migrateSystemDataIfNeeded&lt;/tt&gt; which was probably introduced in &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-14793&quot; title=&quot;Improve system table handling when losing a disk when using JBOD&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-14793&quot;&gt;&lt;del&gt;CASSANDRA-14793&lt;/del&gt;&lt;/a&gt;, thus the problem is there for a while.  I don&apos;t think it is a blocker for any release and the workaround is simple - just delete the affected sstables - those data are duplicated in the uncompacted sstables or in the commit log because since the transaction is not finished, those should not be wiped as well. &lt;/p&gt;

&lt;p&gt;For the solution I think we should use directory lister (or at least the same filter) when moving sstables around so that we do not move incomplete ones. /cc &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=blerer&quot; class=&quot;user-hover&quot; rel=&quot;blerer&quot;&gt;blerer&lt;/a&gt;&lt;/p&gt;

</comment>
                            <comment id="17788541" author="brandon.williams" created="Tue, 21 Nov 2023 20:39:30 +0000"  >&lt;blockquote&gt;&lt;p&gt;the workaround is simple - just delete the affected sstables&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;After the node has shut itself down due to corruption, though. If the bisect is correct, this seems like a new problem.&lt;/p&gt;</comment>
                            <comment id="17788551" author="jlewandowski" created="Tue, 21 Nov 2023 20:48:18 +0000"  >&lt;p&gt;No, the node is restarted during the test, second start fails&lt;/p&gt;</comment>
                            <comment id="17788719" author="jlewandowski" created="Wed, 22 Nov 2023 10:31:41 +0000"  >&lt;p&gt;More details:&lt;/p&gt;

&lt;p&gt;Why &lt;tt&gt;prepared_statements&lt;/tt&gt;? According to the ticket mentioned above, the system tables should go to the first data location unless a specific data location for those sstables was specified. However, it turns out that it does not apply to some system tables, in particular those mentioned in &lt;tt&gt;SystemKeyspace.TABLES_SPLIT_ACROSS_MULTIPLE_DISKS&lt;/tt&gt;, namely: batches, paxos, compaction_history, &lt;b&gt;prepared_statements&lt;/b&gt; and repairs. &lt;tt&gt;prepared_statements&lt;/tt&gt; is probably the only one extensively populated during a normal run thus have something to compact. This explains why there were sstables of that table spread across multiple data dirs, and why they were being compacted.&lt;/p&gt;

&lt;p&gt;Now, why those sstables are moved on startup although they should be excluded from the procedure introduced by &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-14793&quot; title=&quot;Improve system table handling when losing a disk when using JBOD&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-14793&quot;&gt;&lt;del&gt;CASSANDRA-14793&lt;/del&gt;&lt;/a&gt;? There seem to be an oversight/mistake in filtering tables which should be moved:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
                        Path[] tableDirectories = keyspaceChildren.filter(Files::isDirectory)
                                                                  .filter(p -&amp;gt; !SystemKeyspace.TABLES_SPLIT_ACROSS_MULTIPLE_DISKS
                                                                                              .contains(p.getFileName()
                                                                                                         .toString()))
                                                                  .toArray(Path[]::&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt;);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The directory name of the table obviously includes the table id so no item from the set matches it. Therefore sstables of all the tables are moved.&lt;/p&gt;

&lt;p&gt;So we should fix two things in this ticket:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;fix the filtering (4.0 and on)&lt;/li&gt;
	&lt;li&gt;fix the way how the files are moved - we should skip sstables which are a part of an incomplete transaction - this will be removed automatically anyway&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="17790401" author="jlewandowski" created="Tue, 28 Nov 2023 07:24:02 +0000"  >&lt;p&gt;For fixing the sstables move, I&apos;ve created &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-19108&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/CASSANDRA-19108&lt;/a&gt;, here we can focus on filtering.&lt;/p&gt;</comment>
                            <comment id="17790552" author="jlewandowski" created="Tue, 28 Nov 2023 12:57:24 +0000"  >&lt;p&gt;&lt;a href=&quot;https://app.circleci.com/pipelines/github/jacek-lewandowski/cassandra/1128/workflows/dec615da-5659-4f7c-b19d-73104f2fb8f0/jobs/51874&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://app.circleci.com/pipelines/github/jacek-lewandowski/cassandra/1128/workflows/dec615da-5659-4f7c-b19d-73104f2fb8f0/jobs/51874&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;^ this is the only questionable test - it failed only on trunk and only once (well, we had 2000 run of this test in total). Also the failure is different to the one raised in this ticket. In the failed test, it fails to run sstableutil, it just returns exit code 1. It is hard to judge which of trunk failures are legit and which are not today. &lt;/p&gt;

&lt;p&gt;After discussing with &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=blerer&quot; class=&quot;user-hover&quot; rel=&quot;blerer&quot;&gt;blerer&lt;/a&gt; we decided to merge it.&lt;/p&gt;
</comment>
                            <comment id="17790766" author="edimitrova" created="Tue, 28 Nov 2023 21:38:34 +0000"  >&lt;p&gt;It seemed like a random failure to me and I did not see any errors in the logs.&#160;&lt;/p&gt;

&lt;p&gt;To confirm things with our current trunk I ran the repeated run on clean trunk - all green, &lt;a href=&quot;https://app.circleci.com/pipelines/github/ekaterinadimitrova2/cassandra/2568/workflows/796c0947-fc33-4915-bd30-5bdd2a5548ca/jobs/47452&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://app.circleci.com/pipelines/github/ekaterinadimitrova2/cassandra/2568/workflows/796c0947-fc33-4915-bd30-5bdd2a5548ca/jobs/47452&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Thank you for your work all!&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                                                <inwardlinks description="is duplicated by">
                                        <issuelink>
            <issuekey id="13556437">CASSANDRA-18991</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                            <issuelinktype id="12310560">
                    <name>Problem/Incident</name>
                                                                <inwardlinks description="is caused by">
                                        <issuelink>
            <issuekey id="13547008">CASSANDRA-18747</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                            <issuelinktype id="12310760">
                    <name>Testing</name>
                                            <outwardlinks description="Testing discovered">
                                        <issuelink>
            <issuekey id="13556437">CASSANDRA-18991</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[jlewandowski]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12313825" key="com.atlassian.jira.plugin.system.customfieldtypes:cascadingselect">
                        <customfieldname>Bug Category</customfieldname>
                        <customfieldvalues>
                                                    <customfieldvalue key="12982" cascade-level=""><![CDATA[Correctness]]></customfieldvalue>
            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12313821" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Complexity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12965"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313822" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Discovered By</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12970"><![CDATA[Unit Test]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12313922" key="jira.plugin.projectspecificselectfield.jpssf:multicftype">
                        <customfieldname>Impacts</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="13100"><![CDATA[None]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            1 year, 50 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12313921" key="jira.plugin.projectspecificselectfield.jpssf:multicftype">
                        <customfieldname>Platform</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="13076"><![CDATA[All]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z1l7i0:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[blerer]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12962"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12311420" key="com.atlassian.jira.plugin.system.customfieldtypes:version">
                        <customfieldname>Since Version</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="12350367">4.0.0</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313924" key="com.atlassian.jira.plugin.system.customfieldtypes:textfield">
                        <customfieldname>Source Control Link</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>&lt;p&gt;&lt;a href=&quot;https://github.com/apache/cassandra/commit/dece96f21dbdbbb3176d6544d72bef3d44571dc6&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/cassandra/commit/dece96f21dbdbbb3176d6544d72bef3d44571dc6&lt;/a&gt;&lt;/p&gt;</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313823" key="com.atlassian.jira.plugin.system.customfieldtypes:textarea">
                        <customfieldname>Test and Documentation Plan</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>&lt;p&gt;run regressions and new test&lt;/p&gt;</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>