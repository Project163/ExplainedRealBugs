<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 22:51:29 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-8839] DatabaseDescriptor throws NPE when rpc_interface is used</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-8839</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;Copy from mail to dev mailinglist. &lt;/p&gt;

&lt;p&gt;When using&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;listen_interface instead of listen_address&lt;/li&gt;
	&lt;li&gt;rpc_interface instead of rpc_address&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;starting 2.1.3 throws an NPE:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;ERROR [main] 2015-02-20 07:50:09,661 DatabaseDescriptor.java:144 - Fatal error during configuration loading
java.lang.NullPointerException: &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;
        at org.apache.cassandra.config.DatabaseDescriptor.applyConfig(DatabaseDescriptor.java:411) ~[apache-cassandra-2.1.3.jar:2.1.3]
        at org.apache.cassandra.config.DatabaseDescriptor.&amp;lt;clinit&amp;gt;(DatabaseDescriptor.java:133) ~[apache-cassandra-2.1.3.jar:2.1.3]
        at org.apache.cassandra.service.CassandraDaemon.setup(CassandraDaemon.java:110) [apache-cassandra-2.1.3.jar:2.1.3]
        at org.apache.cassandra.service.CassandraDaemon.activate(CassandraDaemon.java:465) [apache-cassandra-2.1.3.jar:2.1.3]
        at org.apache.cassandra.service.CassandraDaemon.main(CassandraDaemon.java:554) [apache-cassandra-2.1.3.jar:2.1.3]
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Occurs on debian package as well as in tar.gz distribution. &lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-comment&quot;&gt;/* Local IP, hostname or &lt;span class=&quot;code-keyword&quot;&gt;interface&lt;/span&gt; to bind RPC server to */&lt;/span&gt;
&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt;(conf.rpc_address !=&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;&amp;amp;&amp;amp; conf.rpc_interface !=&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;)
{
    &lt;span class=&quot;code-keyword&quot;&gt;throw&lt;/span&gt; newConfigurationException(&lt;span class=&quot;code-quote&quot;&gt;&quot;Set rpc_address OR rpc_interface, not both&quot;&lt;/span&gt;);
}
&lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt;(conf.rpc_address !=&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;)
{
    &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt;
    {
        rpcAddress = InetAddress.getByName(conf.rpc_address);
    }
    &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt;(UnknownHostException e)
    {
        &lt;span class=&quot;code-keyword&quot;&gt;throw&lt;/span&gt; newConfigurationException(&lt;span class=&quot;code-quote&quot;&gt;&quot;Unknown host in rpc_address &quot;&lt;/span&gt;+ conf.rpc_address);
    }
}
&lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt;(conf.rpc_interface !=&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;)
{
    listenAddress = getNetworkInterfaceAddress(conf.rpc_interface,&lt;span class=&quot;code-quote&quot;&gt;&quot;rpc_interface&quot;&lt;/span&gt;);
}
&lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt;
{
    rpcAddress = FBUtilities.getLocalAddress();
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I think that listenAddress in the second else block is an error. In my case rpc_interface is eth0, so listenAddress gets set, and rpcAddress remains unset. The result is NPE in line 411:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt;(rpcAddress.isAnyLocalAddress())
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;After changing rpc_interface to rpc_address everything works as expected.&lt;/p&gt;
</description>
                <environment>&lt;p&gt;2.1.3&lt;/p&gt;</environment>
        <key id="12776384">CASSANDRA-8839</key>
            <summary>DatabaseDescriptor throws NPE when rpc_interface is used</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10002" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Normal</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="aweisberg">Ariel Weisberg</assignee>
                                    <reporter username="ifjke">Jan Kesten</reporter>
                        <labels>
                    </labels>
                <created>Fri, 20 Feb 2015 08:37:37 +0000</created>
                <updated>Tue, 16 Apr 2019 09:31:20 +0000</updated>
                            <resolved>Tue, 17 Mar 2015 18:34:11 +0000</resolved>
                                        <fixVersion>2.1.5</fixVersion>
                                    <component>Local/Config</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>8</watches>
                                                                                                                <comments>
                            <comment id="14328687" author="molsson" created="Fri, 20 Feb 2015 08:42:09 +0000"  >&lt;p&gt;Caused by:&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-8677&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/CASSANDRA-8677&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14328729" author="ifjke" created="Fri, 20 Feb 2015 09:28:04 +0000"  >&lt;p&gt;I checked out 2.1.2 source seems to be a copy&amp;amp;paste error while applying getNetworkInterfaceAddress from &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-8677&quot; title=&quot;rpc_interface and listen_interface generate NPE on startup when specified interface doesn&amp;#39;t exist&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-8677&quot;&gt;&lt;del&gt;CASSANDRA-8677&lt;/del&gt;&lt;/a&gt; :&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeHeader panelHeader&quot; style=&quot;border-bottom-width: 1px;&quot;&gt;&lt;b&gt;line387&lt;/b&gt;&lt;/div&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;            listenAddress = getNetworkInterfaceAddress(conf.rpc_interface, &lt;span class=&quot;code-quote&quot;&gt;&quot;rpc_interface&quot;&lt;/span&gt;);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeHeader panelHeader&quot; style=&quot;border-bottom-width: 1px;&quot;&gt;&lt;b&gt;line350&lt;/b&gt;&lt;/div&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;            listenAddress = getNetworkInterfaceAddress(conf.listen_interface, &lt;span class=&quot;code-quote&quot;&gt;&quot;listen_interface&quot;&lt;/span&gt;);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="14328733" author="slebresne" created="Fri, 20 Feb 2015 09:30:05 +0000"  >&lt;p&gt;Probably just a copy-paste typo from the original patch that is easily fixed, but it does suggest the original patch hasn&apos;t been properly tested so let&apos;s make sure we add a test for this.&lt;/p&gt;</comment>
                            <comment id="14329042" author="aweisberg" created="Fri, 20 Feb 2015 15:16:18 +0000"  >&lt;p&gt;It&apos;s broken on trunk as well. I&apos;ll add it to DatabaseDescriptorTest.&lt;/p&gt;</comment>
                            <comment id="14358862" author="aweisberg" created="Thu, 12 Mar 2015 15:55:53 +0000"  >&lt;p&gt;I added a test and fixed the bug on 2.1. On OS X and my Linux desktop the interfaces all have ipv4 and ipv6 addresses and the code expects that interfaces will only have one address. I addressed this by modifying the code to accept interfaces with multiple addresses.&lt;/p&gt;

&lt;p&gt;There are two new config options in cassandra.yaml. rpc_interface_prefer_ipv6 and listen_interface_prefer_ipv6 and both default to false. The code for selecting an address will now look at prefer_ipv6 and select the first kind of preferred address listed by the interface. If the preferred kind of address is not available then the first available address is selected.&lt;/p&gt;

&lt;p&gt;Doc for this is going to be necessary, and we need to decide if this behavior for selecting address is the right way to go.&lt;/p&gt;

&lt;p&gt;trunk&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/cassandra/compare/trunk...aweisberg:C-8839&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/cassandra/compare/trunk...aweisberg:C-8839&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;2.1&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/cassandra/compare/cassandra-2.1...aweisberg:C-8839-2.1&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/cassandra/compare/cassandra-2.1...aweisberg:C-8839-2.1&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14361002" author="carlyeks" created="Fri, 13 Mar 2015 19:41:42 +0000"  >&lt;p&gt;The changes to select the interface, as well as the test looks good.&lt;/p&gt;

&lt;p&gt;For the IPv6 changes, I think it would make sense to use the option &lt;tt&gt;-Djava.net.preferIPv4Stack&lt;/tt&gt; instead. I tried that with the unit tests, and they succeeded without having to worry about IPv4 and v6 addresses. There is &lt;a href=&quot;https://github.com/netty/netty/pull/3473&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;an issue&lt;/a&gt; with Netty and that flag, but if we are specifying the address already, we probably won&apos;t hit it.&lt;/p&gt;

&lt;p&gt;Also, when testing the class we get for &lt;tt&gt;InetAddress&lt;/tt&gt;, I think it would be better to use &lt;tt&gt;instanceof&lt;/tt&gt;.&lt;/p&gt;</comment>
                            <comment id="14365447" author="aweisberg" created="Tue, 17 Mar 2015 16:34:13 +0000"  >&lt;p&gt;-Djava.net.preferIPv4Stack is all or nothing and I think we should provide mechanism not policy. When I just tested it matters whether you select IPv4 or IPv6 addresses for an interface and there is no transparent automatic routing of incoming connections between them.&lt;/p&gt;

&lt;p&gt;I just don&apos;t want to end up in a scenario where people go to deploy in networking environments they don&apos;t have complete control over and they can&apos;t make it work without unnecessary platform specific friction. It&apos;s not a lot of code to implement preferring the ipv6 vs ipv4 stack for rpc and listen interface.&lt;/p&gt;

&lt;p&gt;I am still open to not adding the config it&apos;s just not my preference. The change in behavior would then be that when we are provided with an interface we bind to the first addressed provided by the JVM in the enumeration and ignore the others.&lt;/p&gt;</comment>
                            <comment id="14365533" author="carlyeks" created="Tue, 17 Mar 2015 17:04:17 +0000"  >&lt;p&gt;Yeah, it doesn&apos;t work quite the way I thought it would when testing the sockets. Specifying &quot;::&quot; is the only way to get a dual-stack ServerSocket.&lt;/p&gt;

&lt;p&gt;+1 to the latest branches.&lt;/p&gt;</comment>
                            <comment id="14365729" author="snazy" created="Tue, 17 Mar 2015 18:33:57 +0000"  >&lt;p&gt;Committed (attached rebased patches)&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                                                <inwardlinks description="is duplicated by">
                                        <issuelink>
            <issuekey id="12779875">CASSANDRA-8925</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12821918">CASSANDRA-9208</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12705145" name="8839.txt" size="21262" author="snazy" created="Tue, 17 Mar 2015 18:33:57 +0000"/>
                            <attachment id="12705146" name="8893-2.1.txt" size="21749" author="snazy" created="Tue, 17 Mar 2015 18:33:57 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[aweisberg]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 36 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i25uhz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>carlyeks</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[carlyeks]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12962"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>