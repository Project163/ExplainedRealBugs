<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 23:05:11 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-11117] ColUpdateTimeDeltaHistogram histogram overflow</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-11117</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;getting attribute Mean of org.apache.cassandra.metrics:type=ColumnFamily,name=ColUpdateTimeDeltaHistogram threw an exceptionjavax.management.RuntimeMBeanException: java.lang.IllegalStateException: Unable to compute ceiling &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; max when histogram overflowed
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Although the fact that this histogram has 164 buckets already, I wonder if there is something weird with the computation thats causing this to be so large? It appears to be coming from updates to system.local&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;org.apache.cassandra.metrics:type=Table,keyspace=system,scope=local,name=ColUpdateTimeDeltaHistogram
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="12936468">CASSANDRA-11117</key>
            <summary>ColUpdateTimeDeltaHistogram histogram overflow</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10003" iconUrl="https://issues.apache.org/jira/images/icons/priorities/trivial.svg">Low</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="jkni">Joel Knighton</assignee>
                                    <reporter username="cnlwsu">Chris Lohfink</reporter>
                        <labels>
                    </labels>
                <created>Wed, 3 Feb 2016 20:13:01 +0000</created>
                <updated>Wed, 15 Oct 2025 09:49:01 +0000</updated>
                            <resolved>Thu, 13 Oct 2016 13:15:08 +0000</resolved>
                                        <fixVersion>2.2.9</fixVersion>
                    <fixVersion>3.0.10</fixVersion>
                    <fixVersion>3.10</fixVersion>
                    <fixVersion>4.0-alpha1</fixVersion>
                    <fixVersion>4.0</fixVersion>
                                    <component>Legacy/Observability</component>
                        <due></due>
                            <votes>6</votes>
                                    <watches>18</watches>
                                                                                                                <comments>
                            <comment id="15239993" author="philipthompson" created="Wed, 13 Apr 2016 20:53:08 +0000"  >&lt;p&gt;I am reproducing this in some of my tests in 3.0.0&lt;/p&gt;</comment>
                            <comment id="15280185" author="jeffery.griffith" created="Wed, 11 May 2016 14:17:45 +0000"  >&lt;p&gt;the code that updates this is here in ColmnFamilyStore.java:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void apply(DecoratedKey key, ColumnFamily columnFamily, SecondaryIndexManager.Updater indexer, OpOrder.Group opGroup, ReplayPosition replayPosition)
    {
        &lt;span class=&quot;code-object&quot;&gt;long&lt;/span&gt; start = &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.nanoTime();
        Memtable mt = data.getMemtableFor(opGroup, replayPosition);
        &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;long&lt;/span&gt; timeDelta = mt.put(key, columnFamily, indexer, opGroup);
        maybeUpdateRowCache(key);
        metric.samplers.get(Sampler.WRITES).addSample(key.getKey(), key.hashCode(), 1);
        metric.writeLatency.addNano(&lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.nanoTime() - start);
        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt;(timeDelta &amp;lt; &lt;span class=&quot;code-object&quot;&gt;Long&lt;/span&gt;.MAX_VALUE)
            metric.colUpdateTimeDeltaHistogram.update(timeDelta);
    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;That &quot;if (timeDelta &amp;lt; Long.MAX_VALUE)&quot; looks ill-conceived since there are no longs &amp;gt; max long, but i don&apos;t really know what exactly is overflowing in the histogram.&lt;/p&gt;</comment>
                            <comment id="15380061" author="jkni" created="Fri, 15 Jul 2016 20:33:58 +0000"  >&lt;p&gt;The Long.MAX_VALUE in the code snippet you&apos;ve provided checks for a Long.MAX_VALUE sentinel value we pass along when there are no relevant column update deltas in the reconciliation path of the write. This shouldn&apos;t be the problem.&lt;/p&gt;

&lt;p&gt;The problem is when certain cells/liveness infos in the reconciliation path carry very high timestamp values or possibly Long.MIN_VALUE as a timestamp value (in some of the 3.0 cases).&lt;/p&gt;

&lt;p&gt;I can reproduce this in 3.0+; the same methods for reproduction do not work in 2.2. &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=urandom&quot; class=&quot;user-hover&quot; rel=&quot;urandom&quot;&gt;urandom&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jeffery.griffith&quot; class=&quot;user-hover&quot; rel=&quot;jeffery.griffith&quot;&gt;jeffery.griffith&lt;/a&gt;, you reported this issue on 2.2 clusters.&lt;/p&gt;

&lt;p&gt;I see that your cluster was upgraded from an earlier version &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=urandom&quot; class=&quot;user-hover&quot; rel=&quot;urandom&quot;&gt;urandom&lt;/a&gt;. Was yours as well &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jeffery.griffith&quot; class=&quot;user-hover&quot; rel=&quot;jeffery.griffith&quot;&gt;jeffery.griffith&lt;/a&gt;? &lt;/p&gt;

&lt;p&gt;To help write tests for and validate the fix I have in mind, any details either of you can share on&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;table schemas (in particular, are you using static columns? collections? counters? user-defined anything?)&lt;/li&gt;
	&lt;li&gt;access patterns (insert/updates/deletes)&lt;/li&gt;
	&lt;li&gt;ttls/specified timestamps&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;might help me find a reproduction path for 2.2. &lt;/p&gt;

&lt;p&gt;Thanks!&lt;/p&gt;</comment>
                            <comment id="15380172" author="jeffery.griffith" created="Fri, 15 Jul 2016 21:42:07 +0000"  >&lt;p&gt;Yes, same here. Upgraded from 2.1.&lt;/p&gt;</comment>
                            <comment id="15430271" author="clardeur" created="Mon, 22 Aug 2016 08:05:05 +0000"  >&lt;p&gt;Hi we have the same problem with the version 3.0.8, the graphite reporter stop working like &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-12185&quot; title=&quot;Exception during metrics calculation&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-12185&quot;&gt;&lt;del&gt;CASSANDRA-12185&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;ERROR [metrics-graphite-reporter-1-thread-1] 2016-08-22 09:40:42,618 ScheduledReporter.java:119 - RuntimeException thrown from GraphiteReporter#report. Exception was suppressed.
java.lang.IllegalStateException: Unable to compute ceiling for max when histogram overflowed
        at org.apache.cassandra.utils.EstimatedHistogram.rawMean(EstimatedHistogram.java:231) ~[apache-cassandra-3.0.8.jar:3.0.8]
        at org.apache.cassandra.metrics.EstimatedHistogramReservoir$HistogramSnapshot.getMean(EstimatedHistogramReservoir.java:103) ~[apache-cassandra-3.0.8.jar:3.0.8]
        at com.codahale.metrics.graphite.GraphiteReporter.reportHistogram(GraphiteReporter.java:265) ~[metrics-graphite-3.1.2.jar:3.1.2]
        at com.codahale.metrics.graphite.GraphiteReporter.report(GraphiteReporter.java:179) ~[metrics-graphite-3.1.2.jar:3.1.2]
        at com.codahale.metrics.ScheduledReporter.report(ScheduledReporter.java:162) ~[metrics-core-3.1.0.jar:3.1.0]
        at com.codahale.metrics.ScheduledReporter$1.run(ScheduledReporter.java:117) ~[metrics-core-3.1.0.jar:3.1.0]
        at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511) [na:1.8.0_101]
        at java.util.concurrent.FutureTask.runAndReset(FutureTask.java:308) [na:1.8.0_101]
        at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.access$301(ScheduledThreadPoolExecutor.java:180) [na:1.8.0_101]
        at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:294) [na:1.8.0_101]
        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1142) [na:1.8.0_101]
        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:617) [na:1.8.0_101]
        at java.lang.Thread.run(Thread.java:745) [na:1.8.0_101]
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I don&apos;t think that ticket should be flagged as Minor because it&apos;s impacting our production monitoring of the cluster. Since the version 3.x with the incompatibility of OpsCenter, many users switch to another monitoring solution so the graphite reporter is now more critical for the Open Source community than previously.&lt;/p&gt;

&lt;p&gt;If I could help I can give you more details with our cluster settings.&lt;/p&gt;</comment>
                            <comment id="15525530" author="incubos" created="Tue, 27 Sep 2016 08:54:11 +0000"  >&lt;p&gt;I tried to trace the problem using Cassandra 3.7.&lt;br/&gt;
The problematic value overflowing the histogram is added in the following stack trace:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;	at org.apache.cassandra.utils.EstimatedHistogram.add(EstimatedHistogram.java:134) [apache-cassandra-3.7.jar:3.7]
	at org.apache.cassandra.metrics.EstimatedHistogramReservoir.update(EstimatedHistogramReservoir.java:56) [apache-cassandra-3.7.jar:3.7]
	at com.codahale.metrics.Histogram.update(Histogram.java:39) [metrics-core-3.1.0.jar:3.1.0]
	at org.apache.cassandra.metrics.TableMetrics$TableHistogram.update(TableMetrics.java:828) [apache-cassandra-3.7.jar:3.7]
	at org.apache.cassandra.db.ColumnFamilyStore.apply(ColumnFamilyStore.java:1331) [apache-cassandra-3.7.jar:3.7]
	at org.apache.cassandra.db.Keyspace.apply(Keyspace.java:529) [apache-cassandra-3.7.jar:3.7]
	at org.apache.cassandra.db.Keyspace.apply(Keyspace.java:399) [apache-cassandra-3.7.jar:3.7]
	at org.apache.cassandra.db.Mutation.applyFuture(Mutation.java:202) [apache-cassandra-3.7.jar:3.7]
	at org.apache.cassandra.db.Mutation.apply(Mutation.java:214) [apache-cassandra-3.7.jar:3.7]
	at org.apache.cassandra.db.Mutation.apply(Mutation.java:228) [apache-cassandra-3.7.jar:3.7]
	at org.apache.cassandra.service.StorageProxy$8.runMayThrow(StorageProxy.java:1343) ~[apache-cassandra-3.7.jar:3.7]
	at org.apache.cassandra.service.StorageProxy$LocalMutationRunnable.run(StorageProxy.java:2519) ~[apache-cassandra-3.7.jar:3.7]
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511) ~[na:1.8.0_102]
	at org.apache.cassandra.concurrent.AbstractLocalAwareExecutorService$FutureTask.run(AbstractLocalAwareExecutorService.java:164) ~[apache-cassandra-3.7.jar:3.7]
	at org.apache.cassandra.concurrent.AbstractLocalAwareExecutorService$LocalSessionFutureTask.run(AbstractLocalAwareExecutorService.java:136) ~[apache-cassandra-3.7.jar:3.7]
	at org.apache.cassandra.concurrent.SEPWorker.run(SEPWorker.java:105) ~[apache-cassandra-3.7.jar:3.7]
	at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:745) ~[na:1.8.0_102]
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;The problem is caused by using time interval in &lt;tt&gt;ColumnFamilyStore.apply()&lt;/tt&gt; returned by &lt;tt&gt;Memtable.put()&lt;/tt&gt; which is calculated by &lt;tt&gt;Rows.merge()&lt;/tt&gt; method. It seems that in case of an update for a nonexisting row an &lt;b&gt;absolute&lt;/b&gt; time value is returned, not time delta. That leads to very large values being sent to the histogram (as large as &lt;tt&gt;Long.MAX_VALUE / 10&lt;/tt&gt; judging by debugging on real data).&lt;br/&gt;
We decided to patch Cassandra and to ignore the overflowed histogram values temporarily.&lt;/p&gt;</comment>
                            <comment id="15542557" author="jkni" created="Mon, 3 Oct 2016 14:35:09 +0000"  >&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;branch&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;testall&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;dtest&lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/jkni/cassandra/tree/CASSANDRA-11117-2.2&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;CASSANDRA-11117-2.2&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/jkni/job/jkni-CASSANDRA-11117-2.2-testall&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;testall&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/jkni/job/jkni-CASSANDRA-11117-2.2-dtest&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;dtest&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/jkni/cassandra/tree/CASSANDRA-11117-3.0&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;CASSANDRA-11117-3.0&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/jkni/job/jkni-CASSANDRA-11117-3.0-testall&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;testall&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/jkni/job/jkni-CASSANDRA-11117-3.0-dtest&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;dtest&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/jkni/cassandra/tree/CASSANDRA-11117-3.X&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;CASSANDRA-11117-3.X&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/jkni/job/jkni-CASSANDRA-11117-3.X-testall&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;testall&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/jkni/job/jkni-CASSANDRA-11117-3.X-dtest&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;dtest&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/jkni/cassandra/tree/CASSANDRA-11117-trunk&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;CASSANDRA-11117-trunk&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/jkni/job/jkni-CASSANDRA-11117-trunk-testall&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;testall&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/jkni/job/jkni-CASSANDRA-11117-trunk-dtest&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;dtest&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;


&lt;p&gt;I&apos;ve linked patches above. CI for the patches look clean relative to upstream.&lt;/p&gt;

&lt;p&gt;For 2.2, I found write paths in Thrift for accessing counters that reproduced this behavior. In 3.0+, I found instances where UPDATE -&amp;gt; INSERT patterns reproduced this behavior, when an update to a nonexistent row created an empty &lt;tt&gt;LivenessInfo&lt;/tt&gt;. This behavior is also possible to reproduce just by using client-specified timestamps. &lt;/p&gt;

&lt;p&gt;This leads us to a few options to fix this issue; we could look through the read/write path and try special case handling of the first two issues (and any others we would have to discover), but that wouldn&apos;t solve the client-specified timestamp behavior. For that reason, I opted in to simply filtering to values that wouldn&apos;t overflow the histogram. This limits the ColUpdateTimeDelta histogram to reflecting updates under normal conditions that are under about 100 days. The risk of the first approach is introducing additional complexity in the read/write path for a fairly niche metric. The risk of the second approach is that it reduces the amount of the information in the ColUpdateTimeDelta histogram. I do not think this significantly reduces the utility of the metric as proposed in &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-7979&quot; title=&quot;Acceptable time skew for C*&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-7979&quot;&gt;&lt;del&gt;CASSANDRA-7979&lt;/del&gt;&lt;/a&gt;, which is to somehow quantify how frequently columns are updated. A single decaying histogram measurement (as for the second access in the counter and update/insert examples above) has limited value, and samples above 100 days don&apos;t impose a reasonable time skew constraint.&lt;/p&gt;

&lt;p&gt;I&apos;m not necessarily opposed to the first option. If someone does have a strong preference, I think I&apos;ll defer on a patch here to someone more experienced with the read/write path. I&apos;d be happy to review.&lt;/p&gt;</comment>
                            <comment id="15545512" author="jmckenzie" created="Tue, 4 Oct 2016 14:35:20 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=krummas&quot; class=&quot;user-hover&quot; rel=&quot;krummas&quot;&gt;krummas&lt;/a&gt; to review.&lt;/p&gt;</comment>
                            <comment id="15547998" author="krummas" created="Wed, 5 Oct 2016 07:56:13 +0000"  >&lt;p&gt;I like the approach in the patch but should we perhaps do;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (timeDelta &amp;lt; &lt;span class=&quot;code-object&quot;&gt;Long&lt;/span&gt;.MAX_VALUE)
    metric.colUpdateTimeDeltaHistogram.update(&lt;span class=&quot;code-object&quot;&gt;Math&lt;/span&gt;.min(18165375903306L, timeDelta));
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;so that we at least record the fact that we had a big time difference? I would assume operators would be interested in these large deviations (we would probably need to document that we bunch together everything &amp;gt; 18165375903306L)&lt;/p&gt;</comment>
                            <comment id="15548934" author="jkni" created="Wed, 5 Oct 2016 14:43:52 +0000"  >&lt;p&gt;I considered that as well. My main concern was that it masks the difference between the two different behaviors of having a genuinely high timestamp delta and have the appearance of one due to counter behavior/empty LivenessInfo/etc, but the more I think about it, the more I think the approach you describe above is better. In the case where it is a particular storage engine path (as I described above), these wouldn&apos;t be recurring, so they would be quickly lost to histogram decay anyway.&lt;/p&gt;

&lt;p&gt;I&apos;ll update the patch - thanks!&lt;/p&gt;</comment>
                            <comment id="15569506" author="jkni" created="Wed, 12 Oct 2016 18:31:35 +0000"  >&lt;p&gt;I&apos;ve updated the branch above to adopt the approach you described. I also slightly shortened the unit test since the minimum constraint unifies the two cases being tested. New CI runs have completed on the links above and look clean relative to upstream.&lt;/p&gt;

&lt;p&gt;EDIT: I should note that the 2.2 branch and 3.0 branch each need to be applied as their own patch. The 3.0 branch should merge forward cleanly.&lt;/p&gt;</comment>
                            <comment id="15571878" author="krummas" created="Thu, 13 Oct 2016 13:15:08 +0000"  >&lt;p&gt;and committed, thanks&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310361">
                    <name>Blocked</name>
                                                                <inwardlinks description="Blocked">
                                        <issuelink>
            <issuekey id="12962530">CASSANDRA-11658</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                                                <inwardlinks description="is duplicated by">
                                        <issuelink>
            <issuekey id="12933593">CASSANDRA-11063</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="13256241">CASSANDRA-15324</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12962530">CASSANDRA-11658</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="13005019">CASSANDRA-12643</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[jkni]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 5 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2sdnb:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12311421" key="com.atlassian.jira.plugin.system.customfieldtypes:multiversion">
                        <customfieldname>Reproduced In</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="12333891">3.0.0</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>marcuse</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[marcuse]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12961"><![CDATA[Low]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>