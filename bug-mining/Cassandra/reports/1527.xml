<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 22:30:11 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-3985] Ensure a directory is selected for Compaction</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-3985</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;From &lt;a href=&quot;http://www.mail-archive.com/user@cassandra.apache.org/msg20757.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://www.mail-archive.com/user@cassandra.apache.org/msg20757.html&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;CompactionTask.execute() checks if there is a valid compactionFileLocation only if partialCompactionsAcceptable() . upgradesstables results in a CompactionTask with userdefined set, so the valid location check is not performed. &lt;/p&gt;

&lt;p&gt;The result is a NPE, partial stack &lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;$ nodetool -h localhost upgradesstables
Error occured &lt;span class=&quot;code-keyword&quot;&gt;while&lt;/span&gt; upgrading the sstables &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; keyspace MyKeySpace
java.util.concurrent.ExecutionException: java.lang.NullPointerException
        at java.util.concurrent.FutureTask$Sync.innerGet(FutureTask.java:222)
        at java.util.concurrent.FutureTask.get(FutureTask.java:83)
        at org.apache.cassandra.db.compaction.CompactionManager.performAllSSTableOperation(CompactionManager.java:203)
        at org.apache.cassandra.db.compaction.CompactionManager.performSSTableRewrite(CompactionManager.java:219)
        at org.apache.cassandra.db.ColumnFamilyStore.sstablesRewrite(ColumnFamilyStore.java:995)
        at org.apache.cassandra.service.StorageService.upgradeSSTables(StorageService.java:1648)
&amp;lt;snip&amp;gt;
Caused by: java.lang.NullPointerException
        at java.io.File.&amp;lt;init&amp;gt;(File.java:222)
        at org.apache.cassandra.db.ColumnFamilyStore.getTempSSTablePath(ColumnFamilyStore.java:641)
        at org.apache.cassandra.db.ColumnFamilyStore.getTempSSTablePath(ColumnFamilyStore.java:652)
        at org.apache.cassandra.db.ColumnFamilyStore.createCompactionWriter(ColumnFamilyStore.java:1888)
        at org.apache.cassandra.db.compaction.CompactionTask.execute(CompactionTask.java:151)
        at org.apache.cassandra.db.compaction.CompactionManager$4.perform(CompactionManager.java:229)
        at org.apache.cassandra.db.compaction.CompactionManager$2.call(CompactionManager.java:182)
        at java.util.concurrent.FutureTask$Sync.innerRun(FutureTask.java:303)
        at java.util.concurrent.FutureTask.run(FutureTask.java:138)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;(night time here, will fix tomorrow, anyone else feel free to fix it.)&lt;/p&gt;</description>
                <environment></environment>
        <key id="12544758">CASSANDRA-3985</key>
            <summary>Ensure a directory is selected for Compaction</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10003" iconUrl="https://issues.apache.org/jira/images/icons/priorities/trivial.svg">Low</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="jbellis">Jonathan Ellis</assignee>
                                    <reporter username="amorton">Aaron Morton</reporter>
                        <labels>
                    </labels>
                <created>Thu, 1 Mar 2012 10:38:56 +0000</created>
                <updated>Tue, 16 Apr 2019 09:32:38 +0000</updated>
                            <resolved>Thu, 3 May 2012 23:02:50 +0000</resolved>
                                        <fixVersion>1.0.10</fixVersion>
                    <fixVersion>1.1.1</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                                                                <comments>
                            <comment id="13222536" author="amorton" created="Mon, 5 Mar 2012 19:23:14 +0000"  >&lt;p&gt;Modified DatabaseDescriptor.getDataFileLocationForTable() to add ensureFreeSpace.&lt;/p&gt;

&lt;p&gt;Reformatted getDataFileLocationForTable() as it was small. &lt;/p&gt;

&lt;p&gt;Removed unused DatabaseDescriptor.getNextAvailableDataLocation()&lt;/p&gt;
</comment>
                            <comment id="13224484" author="xedin" created="Wed, 7 Mar 2012 16:35:42 +0000"  >&lt;p&gt;Question - what is the reason why we only return &quot;true&quot; from &quot;ensureFreeSpace&quot; if action is not user defined?&lt;/p&gt;

&lt;p&gt;Few styling issues:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;synchronized&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; getDataFileLocationForTable(&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; table, &lt;span class=&quot;code-object&quot;&gt;long&lt;/span&gt; expectedCompactedFileSize,
                                                                  &lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt; ensureFreeSpace )
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;should be changed to &lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;synchronized&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; getDataFileLocationForTable(&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; table, 
                                                              &lt;span class=&quot;code-object&quot;&gt;long&lt;/span&gt; expectedCompactedFileSize,
                                                              &lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt; ensureFreeSpace)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;or all arguments written on the same line.&lt;/p&gt;

&lt;p&gt;Also we don&apos;t use spaces to delimit operands e.g.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; ( &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; i = 0 ; i &amp;lt; dataDirectoryForTable.length ; i++ )
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I can see those styling problems inside of getDataFileLocationForTable(...) method.&lt;/p&gt;</comment>
                            <comment id="13235555" author="xedin" created="Thu, 22 Mar 2012 13:01:26 +0000"  >&lt;p&gt;Figured out answer to my stupid question &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;Committed with code-style cleanup and removed &quot;currentIndex&quot; static variable from DatabaseDescriptor which is unused after getNextAvailableDataLocation() was dropped.&lt;/p&gt;</comment>
                            <comment id="13243834" author="amorton" created="Sun, 1 Apr 2012 20:03:48 +0000"  >&lt;p&gt;Sorry for not getting back.&lt;br/&gt;
Thanks.&lt;/p&gt;</comment>
                            <comment id="13267889" author="jbellis" created="Thu, 3 May 2012 22:30:51 +0000"  >&lt;p&gt;I don&apos;t understand this.  This will still return null for user defined compactions under the same conditions it would have before, with no log message, since ensureFreeSpace == !isUserDefined.&lt;/p&gt;</comment>
                            <comment id="13267892" author="jbellis" created="Thu, 3 May 2012 22:33:26 +0000"  >&lt;p&gt;It seems to me that the real fix we need is to turn the assert in CompactionTask into an if statement so it can&apos;t be turned off.  Patch attached.&lt;/p&gt;</comment>
                            <comment id="13267893" author="jbellis" created="Thu, 3 May 2012 22:35:17 +0000"  >&lt;p&gt;(All the other callers of &lt;tt&gt;getDataFileLocation&lt;/tt&gt; and &lt;tt&gt;getDataFileLocationForTable&lt;/tt&gt; already check for null correctly.)&lt;/p&gt;</comment>
                            <comment id="13267911" author="xedin" created="Thu, 3 May 2012 22:51:08 +0000"  >&lt;p&gt;+1, right now we won&apos;t try to return the directory with the biggest empty space and would abort compaction if there is no sufficient space left.&lt;/p&gt;</comment>
                            <comment id="13267921" author="jbellis" created="Thu, 3 May 2012 23:02:50 +0000"  >&lt;p&gt;committed&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12525520" name="3985-2.txt" size="7764" author="jbellis" created="Thu, 3 May 2012 22:33:25 +0000"/>
                            <attachment id="12517111" name="cassandra-1.0-3985.txt" size="9373" author="amorton" created="Mon, 5 Mar 2012 19:23:13 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[jbellis]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>229944</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            13 years, 29 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0gqmf:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>95743</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>xedin</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[xedin]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12961"><![CDATA[Low]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>