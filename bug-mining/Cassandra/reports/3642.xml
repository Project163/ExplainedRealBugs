<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 22:55:01 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-9656] Strong circular-reference leaks</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-9656</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;As discussed in &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-9423&quot; title=&quot;Improve Leak Detection to cover strong reference leaks&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-9423&quot;&gt;&lt;del&gt;CASSANDRA-9423&lt;/del&gt;&lt;/a&gt;, we are leaking references to the ref-counted object into the Ref.Tidy, so that they remain strongly reachable, significantly limiting the value of the leak detection.&lt;/p&gt;
</description>
                <environment></environment>
        <key id="12840842">CASSANDRA-9656</key>
            <summary>Strong circular-reference leaks</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10000" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Urgent</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="benedict">Benedict Elliott Smith</assignee>
                                    <reporter username="benedict">Benedict Elliott Smith</reporter>
                        <labels>
                    </labels>
                <created>Fri, 26 Jun 2015 13:30:06 +0000</created>
                <updated>Tue, 16 Apr 2019 09:31:06 +0000</updated>
                            <resolved>Thu, 2 Jul 2015 18:21:21 +0000</resolved>
                                        <fixVersion>2.1.8</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="14602875" author="benedict" created="Fri, 26 Jun 2015 13:32:35 +0000"  >&lt;p&gt;Patch available &lt;a href=&quot;https://github.com/belliottsmith/cassandra/tree/9656&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;here&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14610751" author="jbellis" created="Wed, 1 Jul 2015 18:07:28 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=blambov&quot; class=&quot;user-hover&quot; rel=&quot;blambov&quot;&gt;blambov&lt;/a&gt; to review&lt;/p&gt;</comment>
                            <comment id="14611692" author="benedict" created="Thu, 2 Jul 2015 09:20:25 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=blambov&quot; class=&quot;user-hover&quot; rel=&quot;blambov&quot;&gt;blambov&lt;/a&gt; since this affects live releases, could you prioritise this review?&lt;/p&gt;</comment>
                            <comment id="14611708" author="blambov" created="Thu, 2 Jul 2015 09:39:39 +0000"  >&lt;p&gt;I&apos;m on it.&lt;/p&gt;</comment>
                            <comment id="14611712" author="benedict" created="Thu, 2 Jul 2015 09:40:34 +0000"  >&lt;p&gt;Awesome. Thanks&lt;/p&gt;</comment>
                            <comment id="14611830" author="blambov" created="Thu, 2 Jul 2015 11:49:52 +0000"  >&lt;p&gt;The code looks good. As the biggest issue is various runOnClose runnables holding references through their closure, I would add JavaDoc or comment to the relevant methods (cloneWithNewStart, cloneAsShadowed, possibly others) as well as InstanceTidier.runOnClose to warn about it.&lt;/p&gt;

&lt;p&gt;&lt;tt&gt;DataTracker.getCurrentVersion(sstable)&lt;/tt&gt; could be implemented as &lt;tt&gt;view.get().sstablesMap.get(sstable)&lt;/tt&gt;.&lt;/p&gt;</comment>
                            <comment id="14611883" author="benedict" created="Thu, 2 Jul 2015 12:32:02 +0000"  >&lt;p&gt;Thanks. I&apos;ve addressed those nits. Since this code changed quite a bit on 2.2, I&apos;m awaiting CI results for my merges before committing to mainline.&lt;/p&gt;
</comment>
                            <comment id="14612319" author="benedict" created="Thu, 2 Jul 2015 18:21:21 +0000"  >&lt;p&gt;Committed. Thanks!&lt;/p&gt;</comment>
                            <comment id="14614783" author="benedict" created="Mon, 6 Jul 2015 09:38:50 +0000"  >&lt;p&gt;So, it turns out I was clicking on the wrong cassci links, and there were a &lt;em&gt;number&lt;/em&gt; of small problems with this patch, particularly on the 2.1 branch:&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;The new &lt;tt&gt;getCurrentVersion&lt;/tt&gt; implementation in 2.1 was not accounting for shadowed files, nor files that had not been exposed to the DataTracker.&lt;/li&gt;
	&lt;li&gt;The key cache was not being setup for all readers&lt;/li&gt;
	&lt;li&gt;The book-keeping for totalDiskSpaceUsed was incorrect for &lt;em&gt;offline&lt;/em&gt; operations (this is totally benign, but was upsetting our unit tests)&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;I&apos;ve pushed &lt;a href=&quot;https://github.com/belliottsmith/cassandra/tree/9656&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;2.1&lt;/a&gt; and &lt;a href=&quot;https://github.com/belliottsmith/cassandra/tree/9656&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;2.2&lt;/a&gt; fixes for review. &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=blambov&quot; class=&quot;user-hover&quot; rel=&quot;blambov&quot;&gt;blambov&lt;/a&gt; or &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=krummas&quot; class=&quot;user-hover&quot; rel=&quot;krummas&quot;&gt;krummas&lt;/a&gt; could somebody +1 them with some urgency? Thanks&lt;/p&gt;</comment>
                            <comment id="14614837" author="blambov" created="Mon, 6 Jul 2015 10:25:33 +0000"  >&lt;p&gt;The 2.1 version looks good.&lt;/p&gt;

&lt;p&gt;In the 2.2 (Branch 9656-2.2 I presume? Your second link points to the same place.), &lt;tt&gt;testFileRemoval&lt;/tt&gt; no longer does truncation at the end, and the earlier version of &lt;tt&gt;testSSTableSplit&lt;/tt&gt; checks that a truncation is not actually performed in the offline case, while it now skips that call altogether-- if that&apos;s a required change, &lt;a href=&quot;https://github.com/apache/cassandra/compare/trunk...belliottsmith:9656-2.2#diff-02c4b3ac06af7b36bb219956c41616f6R707&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;this comment&lt;/a&gt; should be changed. The rest looks good.&lt;/p&gt;</comment>
                            <comment id="14614852" author="benedict" created="Mon, 6 Jul 2015 10:42:14 +0000"  >&lt;p&gt;Good catch on &lt;tt&gt;testSSTableSplit&lt;/tt&gt;, though this was true in 2.1 also. I&apos;ll commit with that fixed.&lt;/p&gt;

&lt;p&gt;&lt;tt&gt;testFileRemoval&lt;/tt&gt;: can&apos;t see this in the prior version. Are you referring to &lt;tt&gt;testNumberOfFiles_truncate&lt;/tt&gt;? That one was deliberate, since the truncate should be a no-op there, as we already confirm the directory is empty, and validate our internal contents are equivalent to that empty directory.&lt;/p&gt;</comment>
                            <comment id="14614862" author="blambov" created="Mon, 6 Jul 2015 10:55:07 +0000"  >&lt;p&gt;Yes, &lt;tt&gt;testNumberOfFiles_truncate&lt;/tt&gt;, I copied the wrong method name.&lt;/p&gt;

&lt;p&gt;+1&lt;/p&gt;</comment>
                            <comment id="14614892" author="benedict" created="Mon, 6 Jul 2015 11:21:50 +0000"  >&lt;p&gt;Thanks. Committed.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[benedict]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 20 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2gjj3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>blambov</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[blambov]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12963"><![CDATA[Critical]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>