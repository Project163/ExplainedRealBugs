<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 22:11:28 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-459] Commitlog segments don&apos;t get deleted</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-459</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;System table is not created with a periodic flush, so any update there (such as storing token info) can prevent commitlog segments from being deleted.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12436668">CASSANDRA-459</key>
            <summary>Commitlog segments don&apos;t get deleted</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10002" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Normal</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="jbellis">Jonathan Ellis</assignee>
                                    <reporter username="jbellis">Jonathan Ellis</reporter>
                        <labels>
                    </labels>
                <created>Sat, 26 Sep 2009 18:48:26 +0000</created>
                <updated>Tue, 16 Apr 2019 09:33:33 +0000</updated>
                            <resolved>Tue, 29 Sep 2009 03:49:21 +0000</resolved>
                                        <fixVersion>0.4</fixVersion>
                    <fixVersion>0.5</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                                                                <comments>
                            <comment id="12759934" author="jbellis" created="Sat, 26 Sep 2009 18:49:51 +0000"  >&lt;p&gt;01 fixes the bug&lt;br/&gt;
02 adds a bunch of debug logging to commitlog purging so you can see which CFs are blocking the discard&lt;/p&gt;</comment>
                            <comment id="12759956" author="teodor" created="Sat, 26 Sep 2009 21:24:47 +0000"  >&lt;p&gt;I started a test to check that for whole night. &lt;/p&gt;</comment>
                            <comment id="12759961" author="teodor" created="Sat, 26 Sep 2009 22:20:34 +0000"  >&lt;p&gt;I&apos;m very sorry, but patch could not be applied cleanly for cassandra-0.4:&lt;br/&gt;
% cat /spool/home/teodor/tmp/0001-&lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-459&quot; title=&quot;Commitlog segments don&amp;#39;t get deleted&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-459&quot;&gt;&lt;del&gt;CASSANDRA-459&lt;/del&gt;&lt;/a&gt;-flush-system-table-every-five-minutes.txt /spool/home/teodor/tmp/0002-logging.txt  | patch -p1 -C&lt;br/&gt;
....&lt;br/&gt;
Patching file src/java/org/apache/cassandra/db/CommitLog.java using Plan A...&lt;br/&gt;
Hunk #1 succeeded at 97 (offset 1 line).&lt;br/&gt;
Hunk #2 succeeded at 463 (offset -1 lines).&lt;br/&gt;
Hunk #3 succeeded at 514 (offset 1 line).&lt;br/&gt;
Hunk #4 failed at 532.&lt;br/&gt;
1 out of 4 hunks failed--saving rejects to src/java/org/apache/cassandra/db/CommitLog.java.rej&lt;br/&gt;
....&lt;/p&gt;

&lt;p&gt;% cat src/java/org/apache/cassandra/db/CommitLog.java.rej&lt;br/&gt;
***************&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;
	&lt;ul&gt;
		&lt;li&gt;
		&lt;ul&gt;
			&lt;li&gt;516,521 ****&lt;br/&gt;
                  }&lt;br/&gt;
                  else
                  {
                      BufferedRandomAccessFile logWriter = CommitLog.createWriter(oldFile);
                      writeCommitLogHeader(logWriter, oldCommitLogHeader.toByteArray());
                      logWriter.close();
--- 532,539 ----
                  }
&lt;p&gt;                  else&lt;br/&gt;
                  {&lt;br/&gt;
+                     if (logger_.isDebugEnabled())&lt;br/&gt;
+                         logger_.debug(&quot;Not safe to delete commit log &quot; + oldFile + &quot;; dirty is &quot; + oldCommitLogHeader.dirtyString());&lt;br/&gt;
                      BufferedRandomAccessFile logWriter = CommitLog.createWriter(oldFile);&lt;br/&gt;
                      writeCommitLogHeader(logWriter, oldCommitLogHeader.toByteArray());&lt;br/&gt;
                      logWriter.close();&lt;/p&gt;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;It seems to me  that is not a stopper  to test. &lt;/p&gt;</comment>
                            <comment id="12759963" author="jbellis" created="Sat, 26 Sep 2009 22:34:30 +0000"  >&lt;p&gt;Yes, 02 doesn&apos;t need to apply to 0.4&lt;/p&gt;</comment>
                            <comment id="12759989" author="teodor" created="Sun, 27 Sep 2009 05:59:16 +0000"  >&lt;p&gt;Patch doesn&apos;t change anything &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/sad.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;   I use the same test script as for &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-458&quot; title=&quot;Null pointer exception in doIndexing(ColumnIndexer.java:142)&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-458&quot;&gt;&lt;del&gt;CASSANDRA-458&lt;/del&gt;&lt;/a&gt;.&lt;br/&gt;
Immediately after test start:&lt;br/&gt;
% ls -l /spool/cassandra/commitlog /spool/cassandra/data/Keyspace1&lt;br/&gt;
/spool/cassandra/commitlog:&lt;br/&gt;
total 784&lt;br/&gt;
&lt;del&gt;rw-r&lt;/del&gt;&lt;del&gt;r&lt;/del&gt;-  1 teodor  wheel  786432 Sep 27 02:42 CommitLog-1254004919295.log&lt;/p&gt;

&lt;p&gt;/spool/cassandra/data/Keyspace1:&lt;br/&gt;
total 0&lt;/p&gt;

&lt;p&gt;After night&lt;br/&gt;
% ls -l /spool/cassandra/commitlog /spool/cassandra/data/Keyspace1&lt;br/&gt;
/spool/cassandra/commitlog:&lt;br/&gt;
total 3856720&lt;br/&gt;
&lt;del&gt;rw-r&lt;/del&gt;&lt;del&gt;r&lt;/del&gt;-  1 teodor  wheel  134217971 Sep 27 09:52 CommitLog-1254004919295.log&lt;br/&gt;
&lt;del&gt;rw-r&lt;/del&gt;&lt;del&gt;r&lt;/del&gt;-  1 teodor  wheel  134217839 Sep 27 09:52 CommitLog-1254005826443.log&lt;br/&gt;
&lt;del&gt;rw-r&lt;/del&gt;&lt;del&gt;r&lt;/del&gt;-  1 teodor  wheel  134218376 Sep 27 09:52 CommitLog-1254006732843.log&lt;br/&gt;
&lt;del&gt;rw-r&lt;/del&gt;&lt;del&gt;r&lt;/del&gt;-  1 teodor  wheel  134217734 Sep 27 09:52 CommitLog-1254007676088.log&lt;br/&gt;
&lt;del&gt;rw-r&lt;/del&gt;&lt;del&gt;r&lt;/del&gt;-  1 teodor  wheel  134218324 Sep 27 09:52 CommitLog-1254008589671.log&lt;br/&gt;
&lt;del&gt;rw-r&lt;/del&gt;&lt;del&gt;r&lt;/del&gt;-  1 teodor  wheel  134218501 Sep 27 09:52 CommitLog-1254009457777.log&lt;br/&gt;
&lt;del&gt;rw-r&lt;/del&gt;&lt;del&gt;r&lt;/del&gt;-  1 teodor  wheel  134217841 Sep 27 09:52 CommitLog-1254010329142.log&lt;br/&gt;
&lt;del&gt;rw-r&lt;/del&gt;&lt;del&gt;r&lt;/del&gt;-  1 teodor  wheel  134218312 Sep 27 09:52 CommitLog-1254011183824.log&lt;br/&gt;
&lt;del&gt;rw-r&lt;/del&gt;&lt;del&gt;r&lt;/del&gt;-  1 teodor  wheel  134217795 Sep 27 09:52 CommitLog-1254012066380.log&lt;br/&gt;
&lt;del&gt;rw-r&lt;/del&gt;&lt;del&gt;r&lt;/del&gt;-  1 teodor  wheel  134218031 Sep 27 09:52 CommitLog-1254012920007.log&lt;br/&gt;
&lt;del&gt;rw-r&lt;/del&gt;&lt;del&gt;r&lt;/del&gt;-  1 teodor  wheel  134217764 Sep 27 09:52 CommitLog-1254013812856.log&lt;br/&gt;
&lt;del&gt;rw-r&lt;/del&gt;&lt;del&gt;r&lt;/del&gt;-  1 teodor  wheel  134217888 Sep 27 09:52 CommitLog-1254014728895.log&lt;br/&gt;
&lt;del&gt;rw-r&lt;/del&gt;&lt;del&gt;r&lt;/del&gt;-  1 teodor  wheel  134217842 Sep 27 09:52 CommitLog-1254015574082.log&lt;br/&gt;
&lt;del&gt;rw-r&lt;/del&gt;&lt;del&gt;r&lt;/del&gt;-  1 teodor  wheel  134217861 Sep 27 09:52 CommitLog-1254016456859.log&lt;br/&gt;
&lt;del&gt;rw-r&lt;/del&gt;&lt;del&gt;r&lt;/del&gt;-  1 teodor  wheel  134218257 Sep 27 09:52 CommitLog-1254017313996.log&lt;br/&gt;
&lt;del&gt;rw-r&lt;/del&gt;&lt;del&gt;r&lt;/del&gt;-  1 teodor  wheel  134217874 Sep 27 09:52 CommitLog-1254018190196.log&lt;br/&gt;
&lt;del&gt;rw-r&lt;/del&gt;&lt;del&gt;r&lt;/del&gt;-  1 teodor  wheel  134218228 Sep 27 09:52 CommitLog-1254019039153.log&lt;br/&gt;
&lt;del&gt;rw-r&lt;/del&gt;&lt;del&gt;r&lt;/del&gt;-  1 teodor  wheel  134217768 Sep 27 09:52 CommitLog-1254019901588.log&lt;br/&gt;
&lt;del&gt;rw-r&lt;/del&gt;&lt;del&gt;r&lt;/del&gt;-  1 teodor  wheel  134218072 Sep 27 09:52 CommitLog-1254020850481.log&lt;br/&gt;
&lt;del&gt;rw-r&lt;/del&gt;&lt;del&gt;r&lt;/del&gt;-  1 teodor  wheel  134218463 Sep 27 09:52 CommitLog-1254021705210.log&lt;br/&gt;
&lt;del&gt;rw-r&lt;/del&gt;&lt;del&gt;r&lt;/del&gt;-  1 teodor  wheel  134217787 Sep 27 09:52 CommitLog-1254022584617.log&lt;br/&gt;
&lt;del&gt;rw-r&lt;/del&gt;&lt;del&gt;r&lt;/del&gt;-  1 teodor  wheel  134217817 Sep 27 09:52 CommitLog-1254023445022.log&lt;br/&gt;
&lt;del&gt;rw-r&lt;/del&gt;&lt;del&gt;r&lt;/del&gt;-  1 teodor  wheel  134218548 Sep 27 09:52 CommitLog-1254024325493.log&lt;br/&gt;
&lt;del&gt;rw-r&lt;/del&gt;&lt;del&gt;r&lt;/del&gt;-  1 teodor  wheel  134217870 Sep 27 09:52 CommitLog-1254025178129.log&lt;br/&gt;
&lt;del&gt;rw-r&lt;/del&gt;&lt;del&gt;r&lt;/del&gt;-  1 teodor  wheel  134217763 Sep 27 09:52 CommitLog-1254026031303.log&lt;br/&gt;
&lt;del&gt;rw-r&lt;/del&gt;&lt;del&gt;r&lt;/del&gt;-  1 teodor  wheel  134217782 Sep 27 09:52 CommitLog-1254026990171.log&lt;br/&gt;
&lt;del&gt;rw-r&lt;/del&gt;&lt;del&gt;r&lt;/del&gt;-  1 teodor  wheel  134217781 Sep 27 09:52 CommitLog-1254027844609.log&lt;br/&gt;
&lt;del&gt;rw-r&lt;/del&gt;&lt;del&gt;r&lt;/del&gt;-  1 teodor  wheel  134217742 Sep 27 09:52 CommitLog-1254028740042.log&lt;br/&gt;
&lt;del&gt;rw-r&lt;/del&gt;&lt;del&gt;r&lt;/del&gt;-  1 teodor  wheel  134217810 Sep 27 09:52 CommitLog-1254029593664.log&lt;br/&gt;
&lt;del&gt;rw-r&lt;/del&gt;&lt;del&gt;r&lt;/del&gt;-  1 teodor  wheel   54067200 Sep 27 09:53 CommitLog-1254030447553.log&lt;/p&gt;

&lt;p&gt;/spool/cassandra/data/Keyspace1:&lt;br/&gt;
total 785468&lt;br/&gt;
&lt;del&gt;rw-r&lt;/del&gt;&lt;del&gt;r&lt;/del&gt;-  1 teodor  wheel  215470950 Sep 27 08:48 Standard1-372-Data.db&lt;br/&gt;
&lt;del&gt;rw-r&lt;/del&gt;&lt;del&gt;r&lt;/del&gt;-  1 teodor  wheel    3833605 Sep 27 08:48 Standard1-372-Filter.db&lt;br/&gt;
&lt;del&gt;rw-r&lt;/del&gt;&lt;del&gt;r&lt;/del&gt;-  1 teodor  wheel   88353365 Sep 27 08:48 Standard1-372-Index.db&lt;br/&gt;
&lt;del&gt;rw-r&lt;/del&gt;&lt;del&gt;r&lt;/del&gt;-  1 teodor  wheel  204226037 Sep 27 09:18 Standard1-408-Data.db&lt;br/&gt;
&lt;del&gt;rw-r&lt;/del&gt;&lt;del&gt;r&lt;/del&gt;-  1 teodor  wheel     812005 Sep 27 09:18 Standard1-408-Filter.db&lt;br/&gt;
&lt;del&gt;rw-r&lt;/del&gt;&lt;del&gt;r&lt;/del&gt;-  1 teodor  wheel   32812386 Sep 27 09:18 Standard1-408-Index.db&lt;br/&gt;
&lt;del&gt;rw-r&lt;/del&gt;&lt;del&gt;r&lt;/del&gt;-  1 teodor  wheel   10467605 Sep 27 09:51 Standard1-444-Data.db&lt;br/&gt;
&lt;del&gt;rw-r&lt;/del&gt;&lt;del&gt;r&lt;/del&gt;-  1 teodor  wheel      30349 Sep 27 09:51 Standard1-444-Filter.db&lt;br/&gt;
&lt;del&gt;rw-r&lt;/del&gt;&lt;del&gt;r&lt;/del&gt;-  1 teodor  wheel    1442137 Sep 27 09:51 Standard1-444-Index.db&lt;br/&gt;
&lt;del&gt;rw-r&lt;/del&gt;&lt;del&gt;r&lt;/del&gt;-  1 teodor  wheel  201238111 Sep 27 09:53 Standard1-445-Data.db&lt;br/&gt;
&lt;del&gt;rw-r&lt;/del&gt;&lt;del&gt;r&lt;/del&gt;-  1 teodor  wheel     795205 Sep 27 09:53 Standard1-445-Filter.db&lt;br/&gt;
&lt;del&gt;rw-r&lt;/del&gt;&lt;del&gt;r&lt;/del&gt;-  1 teodor  wheel   32237630 Sep 27 09:53 Standard1-445-Index.db&lt;br/&gt;
&lt;del&gt;rw-r&lt;/del&gt;&lt;del&gt;r&lt;/del&gt;-  1 teodor  wheel   10458480 Sep 27 09:52 Standard1-446-Data.db&lt;br/&gt;
&lt;del&gt;rw-r&lt;/del&gt;&lt;del&gt;r&lt;/del&gt;-  1 teodor  wheel      30261 Sep 27 09:52 Standard1-446-Filter.db&lt;br/&gt;
&lt;del&gt;rw-r&lt;/del&gt;&lt;del&gt;r&lt;/del&gt;-  1 teodor  wheel    1438054 Sep 27 09:52 Standard1-446-Index.db&lt;/p&gt;

&lt;p&gt;The single problem in logs is:&lt;br/&gt;
 WARN &lt;span class=&quot;error&quot;&gt;&amp;#91;MINOR-COMPACTION-POOL:1&amp;#93;&lt;/span&gt; 2009-09-27 09:41:59,422 ColumnFamilyStore.java (line 1034) Nothing to compact (all files empty or corrupt)&lt;br/&gt;
 WARN &lt;span class=&quot;error&quot;&gt;&amp;#91;MINOR-COMPACTION-POOL:1&amp;#93;&lt;/span&gt; 2009-09-27 03:41:59,303 ColumnFamilyStore.java (line 1034) Nothing to compact (all files empty or corrupt)&lt;br/&gt;
 WARN &lt;span class=&quot;error&quot;&gt;&amp;#91;MINOR-COMPACTION-POOL:1&amp;#93;&lt;/span&gt; 2009-09-27 04:41:59,234 ColumnFamilyStore.java (line 1034) Nothing to compact (all files empty or corrupt)&lt;br/&gt;
 WARN &lt;span class=&quot;error&quot;&gt;&amp;#91;MINOR-COMPACTION-POOL:1&amp;#93;&lt;/span&gt; 2009-09-27 05:41:59,355 ColumnFamilyStore.java (line 1034) Nothing to compact (all files empty or corrupt)&lt;br/&gt;
 WARN &lt;span class=&quot;error&quot;&gt;&amp;#91;MINOR-COMPACTION-POOL:1&amp;#93;&lt;/span&gt; 2009-09-27 06:41:59,386 ColumnFamilyStore.java (line 1034) Nothing to compact (all files empty or corrupt)&lt;br/&gt;
 WARN &lt;span class=&quot;error&quot;&gt;&amp;#91;MINOR-COMPACTION-POOL:1&amp;#93;&lt;/span&gt; 2009-09-27 07:41:59,392 ColumnFamilyStore.java (line 1034) Nothing to compact (all files empty or corrupt)&lt;br/&gt;
 WARN &lt;span class=&quot;error&quot;&gt;&amp;#91;MINOR-COMPACTION-POOL:1&amp;#93;&lt;/span&gt; 2009-09-27 08:48:58,819 ColumnFamilyStore.java (line 1034) Nothing to compact (all files empty or corrupt)&lt;/p&gt;

&lt;p&gt;Log fragment of one of that warnings:&lt;br/&gt;
 INFO &lt;span class=&quot;error&quot;&gt;&amp;#91;MINOR-COMPACTION-POOL:1&amp;#93;&lt;/span&gt; 2009-09-27 09:41:53,827 ColumnFamilyStore.java (line 1155) Compacted to /spool/cassandra/data/Keyspace1/Standard1-434-Data.db.  0/67462071 bytes for 111274/107527 keys read/written.  Time: 31884ms.&lt;br/&gt;
 INFO &lt;span class=&quot;error&quot;&gt;&amp;#91;PERIODIC-FLUSHER-POOL:1&amp;#93;&lt;/span&gt; 2009-09-27 09:41:59,033 ColumnFamilyStore.java (line 367) Standard1 has reached its threshold; switching in a fresh Memtable&lt;br/&gt;
 INFO &lt;span class=&quot;error&quot;&gt;&amp;#91;PERIODIC-FLUSHER-POOL:1&amp;#93;&lt;/span&gt; 2009-09-27 09:41:59,033 ColumnFamilyStore.java (line 1178) Enqueuing flush of Memtable(Standard1)@8993320&lt;br/&gt;
 INFO &lt;span class=&quot;error&quot;&gt;&amp;#91;MEMTABLE-FLUSHER-POOL:1&amp;#93;&lt;/span&gt; 2009-09-27 09:41:59,033 Memtable.java (line 186) Flushing Memtable(Standard1)@8993320&lt;br/&gt;
 INFO &lt;span class=&quot;error&quot;&gt;&amp;#91;MINOR-COMPACTION-POOL:1&amp;#93;&lt;/span&gt; 2009-09-27 09:41:59,422 ColumnFamilyStore.java (line 1013) Compacting []&lt;br/&gt;
 WARN &lt;span class=&quot;error&quot;&gt;&amp;#91;MINOR-COMPACTION-POOL:1&amp;#93;&lt;/span&gt; 2009-09-27 09:41:59,422 ColumnFamilyStore.java (line 1034) Nothing to compact (all files empty or corrupt)&lt;br/&gt;
 INFO &lt;span class=&quot;error&quot;&gt;&amp;#91;MEMTABLE-FLUSHER-POOL:1&amp;#93;&lt;/span&gt; 2009-09-27 09:42:06,148 Memtable.java (line 220) Completed flushing Memtable(Standard1)@8993320&lt;/p&gt;
</comment>
                            <comment id="12760024" author="jbellis" created="Sun, 27 Sep 2009 13:04:05 +0000"  >&lt;p&gt;Are you on the latest 0.4 branch before applying the patch?  It needs both r819004 and this one to work.&lt;/p&gt;</comment>
                            <comment id="12760045" author="teodor" created="Sun, 27 Sep 2009 15:59:32 +0000"  >&lt;p&gt;Yes, sure.&lt;br/&gt;
Another run (r819316 + 0001 patch), just for rechek:&lt;br/&gt;
% ls -l /spool/cassandra/commitlog /spool/cassandra/data/Keyspace1 /spool/cassandra/data/system&lt;br/&gt;
/spool/cassandra/commitlog:&lt;br/&gt;
total 44144&lt;br/&gt;
&lt;del&gt;rw-r&lt;/del&gt;&lt;del&gt;r&lt;/del&gt;-  1 teodor  wheel  45154304 Sep 27 18:32 CommitLog-1254061669607.log&lt;/p&gt;

&lt;p&gt;/spool/cassandra/data/Keyspace1:&lt;br/&gt;
total 35130&lt;br/&gt;
&lt;del&gt;rw-r&lt;/del&gt;&lt;del&gt;r&lt;/del&gt;-  1 teodor  wheel  10475393 Sep 27 18:29 Standard1-1-Data.db&lt;br/&gt;
&lt;del&gt;rw-r&lt;/del&gt;&lt;del&gt;r&lt;/del&gt;-  1 teodor  wheel     30365 Sep 27 18:29 Standard1-1-Filter.db&lt;br/&gt;
&lt;del&gt;rw-r&lt;/del&gt;&lt;del&gt;r&lt;/del&gt;-  1 teodor  wheel   1443066 Sep 27 18:29 Standard1-1-Index.db&lt;br/&gt;
&lt;del&gt;rw-r&lt;/del&gt;&lt;del&gt;r&lt;/del&gt;-  1 teodor  wheel  10472280 Sep 27 18:30 Standard1-2-Data.db&lt;br/&gt;
&lt;del&gt;rw-r&lt;/del&gt;&lt;del&gt;r&lt;/del&gt;-  1 teodor  wheel     30189 Sep 27 18:30 Standard1-2-Filter.db&lt;br/&gt;
&lt;del&gt;rw-r&lt;/del&gt;&lt;del&gt;r&lt;/del&gt;-  1 teodor  wheel   1434966 Sep 27 18:30 Standard1-2-Index.db&lt;br/&gt;
&lt;del&gt;rw-r&lt;/del&gt;&lt;del&gt;r&lt;/del&gt;-  1 teodor  wheel  10455997 Sep 27 18:32 Standard1-3-Data.db&lt;br/&gt;
&lt;del&gt;rw-r&lt;/del&gt;&lt;del&gt;r&lt;/del&gt;-  1 teodor  wheel     30293 Sep 27 18:32 Standard1-3-Filter.db&lt;br/&gt;
&lt;del&gt;rw-r&lt;/del&gt;&lt;del&gt;r&lt;/del&gt;-  1 teodor  wheel   1439401 Sep 27 18:32 Standard1-3-Index.db&lt;/p&gt;

&lt;p&gt;/spool/cassandra/data/system:&lt;br/&gt;
total 6&lt;br/&gt;
&lt;del&gt;rw-r&lt;/del&gt;&lt;del&gt;r&lt;/del&gt;-  1 teodor  wheel  255 Sep 27 18:32 LocationInfo-1-Data.db&lt;br/&gt;
&lt;del&gt;rw-r&lt;/del&gt;&lt;del&gt;r&lt;/del&gt;-  1 teodor  wheel   85 Sep 27 18:32 LocationInfo-1-Filter.db&lt;br/&gt;
&lt;del&gt;rw-r&lt;/del&gt;&lt;del&gt;r&lt;/del&gt;-  1 teodor  wheel   50 Sep 27 18:32 LocationInfo-1-Index.db&lt;/p&gt;

&lt;p&gt;After  hour and a half:&lt;br/&gt;
% ls -l /spool/cassandra/commitlog /spool/cassandra/data/Keyspace1 /spool/cassandra/data/system&lt;br/&gt;
/spool/cassandra/commitlog:&lt;br/&gt;
total 813840&lt;br/&gt;
&lt;del&gt;rw-r&lt;/del&gt;&lt;del&gt;r&lt;/del&gt;-  1 teodor  wheel  134217982 Sep 27 19:57 CommitLog-1254061669607.log&lt;br/&gt;
&lt;del&gt;rw-r&lt;/del&gt;&lt;del&gt;r&lt;/del&gt;-  1 teodor  wheel  134217875 Sep 27 19:57 CommitLog-1254062560798.log&lt;br/&gt;
&lt;del&gt;rw-r&lt;/del&gt;&lt;del&gt;r&lt;/del&gt;-  1 teodor  wheel  134217761 Sep 27 19:57 CommitLog-1254063429524.log&lt;br/&gt;
&lt;del&gt;rw-r&lt;/del&gt;&lt;del&gt;r&lt;/del&gt;-  1 teodor  wheel  134217809 Sep 27 19:57 CommitLog-1254064318004.log&lt;br/&gt;
&lt;del&gt;rw-r&lt;/del&gt;&lt;del&gt;r&lt;/del&gt;-  1 teodor  wheel  134217785 Sep 27 19:57 CommitLog-1254065174349.log&lt;br/&gt;
&lt;del&gt;rw-r&lt;/del&gt;&lt;del&gt;r&lt;/del&gt;-  1 teodor  wheel  134217849 Sep 27 19:57 CommitLog-1254066038411.log&lt;br/&gt;
&lt;del&gt;rw-r&lt;/del&gt;&lt;del&gt;r&lt;/del&gt;-  1 teodor  wheel   27459584 Sep 27 19:58 CommitLog-1254066927001.log&lt;/p&gt;

&lt;p&gt;/spool/cassandra/data/Keyspace1:&lt;br/&gt;
total 612880&lt;br/&gt;
&lt;del&gt;rw-r&lt;/del&gt;&lt;del&gt;r&lt;/del&gt;-  1 teodor  wheel  203500680 Sep 27 19:07 Standard1-38-Data.db&lt;br/&gt;
&lt;del&gt;rw-r&lt;/del&gt;&lt;del&gt;r&lt;/del&gt;-  1 teodor  wheel     806965 Sep 27 19:07 Standard1-38-Filter.db&lt;br/&gt;
&lt;del&gt;rw-r&lt;/del&gt;&lt;del&gt;r&lt;/del&gt;-  1 teodor  wheel   32636516 Sep 27 19:07 Standard1-38-Index.db&lt;br/&gt;
&lt;del&gt;rw-r&lt;/del&gt;&lt;del&gt;r&lt;/del&gt;-  1 teodor  wheel  202494151 Sep 27 19:42 Standard1-75-Data.db&lt;br/&gt;
&lt;del&gt;rw-r&lt;/del&gt;&lt;del&gt;r&lt;/del&gt;-  1 teodor  wheel     801685 Sep 27 19:42 Standard1-75-Filter.db&lt;br/&gt;
&lt;del&gt;rw-r&lt;/del&gt;&lt;del&gt;r&lt;/del&gt;-  1 teodor  wheel   32441650 Sep 27 19:42 Standard1-75-Index.db&lt;br/&gt;
&lt;del&gt;rw-r&lt;/del&gt;&lt;del&gt;r&lt;/del&gt;-  1 teodor  wheel   67331570 Sep 27 19:49 Standard1-83-Data.db&lt;br/&gt;
&lt;del&gt;rw-r&lt;/del&gt;&lt;del&gt;r&lt;/del&gt;-  1 teodor  wheel     209845 Sep 27 19:49 Standard1-83-Filter.db&lt;br/&gt;
&lt;del&gt;rw-r&lt;/del&gt;&lt;del&gt;r&lt;/del&gt;-  1 teodor  wheel    9598920 Sep 27 19:49 Standard1-83-Index.db&lt;br/&gt;
&lt;del&gt;rw-r&lt;/del&gt;&lt;del&gt;r&lt;/del&gt;-  1 teodor  wheel   67375520 Sep 27 19:57 Standard1-92-Data.db&lt;br/&gt;
&lt;del&gt;rw-r&lt;/del&gt;&lt;del&gt;r&lt;/del&gt;-  1 teodor  wheel     209605 Sep 27 19:57 Standard1-92-Filter.db&lt;br/&gt;
&lt;del&gt;rw-r&lt;/del&gt;&lt;del&gt;r&lt;/del&gt;-  1 teodor  wheel    9579322 Sep 27 19:57 Standard1-92-Index.db&lt;/p&gt;

&lt;p&gt;/spool/cassandra/data/system:&lt;br/&gt;
total 6&lt;br/&gt;
&lt;del&gt;rw-r&lt;/del&gt;&lt;del&gt;r&lt;/del&gt;-  1 teodor  wheel  255 Sep 27 18:32 LocationInfo-1-Data.db&lt;br/&gt;
&lt;del&gt;rw-r&lt;/del&gt;&lt;del&gt;r&lt;/del&gt;-  1 teodor  wheel   85 Sep 27 18:32 LocationInfo-1-Filter.db&lt;br/&gt;
&lt;del&gt;rw-r&lt;/del&gt;&lt;del&gt;r&lt;/del&gt;-  1 teodor  wheel   50 Sep 27 18:32 LocationInfo-1-Index.db&lt;/p&gt;</comment>
                            <comment id="12760046" author="jbellis" created="Sun, 27 Sep 2009 16:03:40 +0000"  >&lt;p&gt;Could you try trunk + 0001 ?&lt;/p&gt;</comment>
                            <comment id="12760065" author="teodor" created="Sun, 27 Sep 2009 17:28:43 +0000"  >&lt;p&gt;Sure, results:&lt;/p&gt;

&lt;p&gt;% ls -l /spool/cassandra/commitlog /spool/cassandra/data/Keyspace1 /spool/cassandra/data/system&lt;br/&gt;
/spool/cassandra/commitlog:&lt;br/&gt;
total 89344&lt;br/&gt;
&lt;del&gt;rw-r&lt;/del&gt;&lt;del&gt;r&lt;/del&gt;-  1 teodor  wheel  91422720 Sep 27 20:36 CommitLog-1254068803560.log&lt;/p&gt;

&lt;p&gt;/spool/cassandra/data/Keyspace1:&lt;br/&gt;
total 78400&lt;br/&gt;
&lt;del&gt;rw-r&lt;/del&gt;&lt;del&gt;r&lt;/del&gt;-  1 teodor  wheel  70339417 Sep 27 20:36 Standard1-9-Data.db&lt;br/&gt;
&lt;del&gt;rw-r&lt;/del&gt;&lt;del&gt;r&lt;/del&gt;-  1 teodor  wheel    210085 Sep 27 20:36 Standard1-9-Filter.db&lt;br/&gt;
&lt;del&gt;rw-r&lt;/del&gt;&lt;del&gt;r&lt;/del&gt;-  1 teodor  wheel   9601776 Sep 27 20:36 Standard1-9-Index.db&lt;/p&gt;

&lt;p&gt;/spool/cassandra/data/system:&lt;br/&gt;
total 6&lt;br/&gt;
&lt;del&gt;rw-r&lt;/del&gt;&lt;del&gt;r&lt;/del&gt;-  1 teodor  wheel  255 Sep 27 20:31 LocationInfo-1-Data.db&lt;br/&gt;
&lt;del&gt;rw-r&lt;/del&gt;&lt;del&gt;r&lt;/del&gt;-  1 teodor  wheel   85 Sep 27 20:31 LocationInfo-1-Filter.db&lt;br/&gt;
&lt;del&gt;rw-r&lt;/del&gt;&lt;del&gt;r&lt;/del&gt;-  1 teodor  wheel   50 Sep 27 20:31 LocationInfo-1-Index.db&lt;/p&gt;

&lt;p&gt;After hour:&lt;br/&gt;
% ls -l /spool/cassandra/commitlog /spool/cassandra/data/Keyspace1 /spool/cassandra/data/system&lt;br/&gt;
/spool/cassandra/commitlog:&lt;br/&gt;
total 564560&lt;br/&gt;
&lt;del&gt;rw-r&lt;/del&gt;&lt;del&gt;r&lt;/del&gt;-  1 teodor  wheel  134218167 Sep 27 21:27 CommitLog-1254068803560.log&lt;br/&gt;
&lt;del&gt;rw-r&lt;/del&gt;&lt;del&gt;r&lt;/del&gt;-  1 teodor  wheel  134218321 Sep 27 21:27 CommitLog-1254069672194.log&lt;br/&gt;
&lt;del&gt;rw-r&lt;/del&gt;&lt;del&gt;r&lt;/del&gt;-  1 teodor  wheel  134218547 Sep 27 21:27 CommitLog-1254070532837.log&lt;br/&gt;
&lt;del&gt;rw-r&lt;/del&gt;&lt;del&gt;r&lt;/del&gt;-  1 teodor  wheel  134217848 Sep 27 21:27 CommitLog-1254071417379.log&lt;br/&gt;
&lt;del&gt;rw-r&lt;/del&gt;&lt;del&gt;r&lt;/del&gt;-  1 teodor  wheel   40793246 Sep 27 21:28 CommitLog-1254072254525.log&lt;/p&gt;

&lt;p&gt;/spool/cassandra/data/Keyspace1:&lt;br/&gt;
total 487238&lt;br/&gt;
&lt;del&gt;rw-r&lt;/del&gt;&lt;del&gt;r&lt;/del&gt;-  1 teodor  wheel  245938744 Sep 27 21:05 Standard1-37-Data.db&lt;br/&gt;
&lt;del&gt;rw-r&lt;/del&gt;&lt;del&gt;r&lt;/del&gt;-  1 teodor  wheel     807205 Sep 27 21:05 Standard1-37-Filter.db&lt;br/&gt;
&lt;del&gt;rw-r&lt;/del&gt;&lt;del&gt;r&lt;/del&gt;-  1 teodor  wheel   32638599 Sep 27 21:05 Standard1-37-Index.db&lt;br/&gt;
&lt;del&gt;rw-r&lt;/del&gt;&lt;del&gt;r&lt;/del&gt;-  1 teodor  wheel   70395458 Sep 27 21:13 Standard1-46-Data.db&lt;br/&gt;
&lt;del&gt;rw-r&lt;/del&gt;&lt;del&gt;r&lt;/del&gt;-  1 teodor  wheel     210325 Sep 27 21:13 Standard1-46-Filter.db&lt;br/&gt;
&lt;del&gt;rw-r&lt;/del&gt;&lt;del&gt;r&lt;/del&gt;-  1 teodor  wheel    9612077 Sep 27 21:13 Standard1-46-Index.db&lt;br/&gt;
&lt;del&gt;rw-r&lt;/del&gt;&lt;del&gt;r&lt;/del&gt;-  1 teodor  wheel   41011329 Sep 27 21:18 Standard1-51-Data.db&lt;br/&gt;
&lt;del&gt;rw-r&lt;/del&gt;&lt;del&gt;r&lt;/del&gt;-  1 teodor  wheel     122245 Sep 27 21:18 Standard1-51-Filter.db&lt;br/&gt;
&lt;del&gt;rw-r&lt;/del&gt;&lt;del&gt;r&lt;/del&gt;-  1 teodor  wheel    5619283 Sep 27 21:18 Standard1-51-Index.db&lt;br/&gt;
&lt;del&gt;rw-r&lt;/del&gt;&lt;del&gt;r&lt;/del&gt;-  1 teodor  wheel   70296583 Sep 27 21:27 Standard1-60-Data.db&lt;br/&gt;
&lt;del&gt;rw-r&lt;/del&gt;&lt;del&gt;r&lt;/del&gt;-  1 teodor  wheel     210085 Sep 27 21:27 Standard1-60-Filter.db&lt;br/&gt;
&lt;del&gt;rw-r&lt;/del&gt;&lt;del&gt;r&lt;/del&gt;-  1 teodor  wheel    9592964 Sep 27 21:27 Standard1-60-Index.db&lt;br/&gt;
&lt;del&gt;rw-r&lt;/del&gt;&lt;del&gt;r&lt;/del&gt;-  1 teodor  wheel   10444198 Sep 27 21:27 Standard1-61-Data.db&lt;br/&gt;
&lt;del&gt;rw-r&lt;/del&gt;&lt;del&gt;r&lt;/del&gt;-  1 teodor  wheel      30253 Sep 27 21:27 Standard1-61-Filter.db&lt;br/&gt;
&lt;del&gt;rw-r&lt;/del&gt;&lt;del&gt;r&lt;/del&gt;-  1 teodor  wheel    1437846 Sep 27 21:27 Standard1-61-Index.db&lt;/p&gt;

&lt;p&gt;/spool/cassandra/data/system:&lt;br/&gt;
total 6&lt;br/&gt;
&lt;del&gt;rw-r&lt;/del&gt;&lt;del&gt;r&lt;/del&gt;-  1 teodor  wheel  255 Sep 27 20:31 LocationInfo-1-Data.db&lt;br/&gt;
&lt;del&gt;rw-r&lt;/del&gt;&lt;del&gt;r&lt;/del&gt;-  1 teodor  wheel   85 Sep 27 20:31 LocationInfo-1-Filter.db&lt;br/&gt;
&lt;del&gt;rw-r&lt;/del&gt;&lt;del&gt;r&lt;/del&gt;-  1 teodor  wheel   50 Sep 27 20:31 LocationInfo-1-Index.db&lt;/p&gt;

</comment>
                            <comment id="12760371" author="jbellis" created="Mon, 28 Sep 2009 20:22:40 +0000"  >&lt;p&gt;New patches attached.&lt;/p&gt;

&lt;p&gt;What was happening is that when a ColumnFamily got marked dirty in the commitlog, all subsequent commitlog segments would also have that CF marked dirty, even after it was flushed.  When flush happened it could clear out old segments, but if the CF never had any more updates (like the LocationInfo CF in the system keyspace) then log segments would pile up.&lt;/p&gt;

&lt;p&gt;This makes log segments only treat a CF as dirty if it actually has data written to it for that CF.&lt;/p&gt;</comment>
                            <comment id="12760417" author="junrao" created="Mon, 28 Sep 2009 22:24:34 +0000"  >&lt;p&gt;Patch looks good to me. +1&lt;/p&gt;</comment>
                            <comment id="12760489" author="jbellis" created="Tue, 29 Sep 2009 03:49:21 +0000"  >&lt;p&gt;committed w/ one more bug fix (r819823) to 0.4 and trunk&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12420727" name="ASF.LICENSE.NOT.GRANTED--0001-logging.txt" size="7271" author="jbellis" created="Mon, 28 Sep 2009 20:19:28 +0000"/>
                            <attachment id="12420728" name="ASF.LICENSE.NOT.GRANTED--0002-CASSANDRA-459-flush-locationinfo-every-minute-and-hint.txt" size="1363" author="jbellis" created="Mon, 28 Sep 2009 20:19:28 +0000"/>
                            <attachment id="12420729" name="ASF.LICENSE.NOT.GRANTED--0003-cleanup-don-t-preserve-dirty-bits-from-older-replay-s.txt" size="8135" author="jbellis" created="Mon, 28 Sep 2009 20:19:28 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[jbellis]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>19698</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            16 years, 9 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0fz2f:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>91279</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12962"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>