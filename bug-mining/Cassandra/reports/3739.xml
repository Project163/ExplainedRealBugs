<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 22:56:04 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-9241] ByteBuffer.array() without ByteBuffer.arrayOffset() + ByteBuffer.position() is a bug</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-9241</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;I found one instance of this on OHCProvider so it make sense to review all usages since there aren&apos;t that many.&lt;/p&gt;

&lt;p&gt;Some suspect things:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/cassandra/blob/trunk/src/java/org/apache/cassandra/utils/FastByteOperations.java#L197&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/cassandra/blob/trunk/src/java/org/apache/cassandra/utils/FastByteOperations.java#L197&lt;/a&gt;&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/cassandra/blob/trunk/src/java/org/apache/cassandra/db/ColumnFamilyStore.java#L1877&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/cassandra/blob/trunk/src/java/org/apache/cassandra/db/ColumnFamilyStore.java#L1877&lt;/a&gt;&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/cassandra/blob/trunk/src/java/org/apache/cassandra/gms/TokenSerializer.java#L40&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/cassandra/blob/trunk/src/java/org/apache/cassandra/gms/TokenSerializer.java#L40&lt;/a&gt;&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/cassandra/blob/trunk/src/java/org/apache/cassandra/io/compress/CompressedRandomAccessReader.java#L178&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/cassandra/blob/trunk/src/java/org/apache/cassandra/io/compress/CompressedRandomAccessReader.java#L178&lt;/a&gt;&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/cassandra/blob/trunk/tools/stress/src/org/apache/cassandra/stress/operations/predefined/CqlOperation.java#L104&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/cassandra/blob/trunk/tools/stress/src/org/apache/cassandra/stress/operations/predefined/CqlOperation.java#L104&lt;/a&gt;&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/cassandra/blob/trunk/tools/stress/src/org/apache/cassandra/stress/operations/predefined/CqlOperation.java#L543&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/cassandra/blob/trunk/tools/stress/src/org/apache/cassandra/stress/operations/predefined/CqlOperation.java#L543&lt;/a&gt;&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/cassandra/blob/trunk/tools/stress/src/org/apache/cassandra/stress/operations/predefined/CqlOperation.java#L563&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/cassandra/blob/trunk/tools/stress/src/org/apache/cassandra/stress/operations/predefined/CqlOperation.java#L563&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;I made this list off of 8099 so I might have missed some instances on trunk. FastByteOperations makes me cross eyed so it is worth a second pass to make sure offsets in byte buffers are handled correctly.&lt;/p&gt;

&lt;p&gt;Generally I like to use the full incantation even when I have done things like allocate the buffer on the stack locally for copy pasta/refactoring reasons and to make clear to new users how the API is supposed to work.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12823906">CASSANDRA-9241</key>
            <summary>ByteBuffer.array() without ByteBuffer.arrayOffset() + ByteBuffer.position() is a bug</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10003" iconUrl="https://issues.apache.org/jira/images/icons/priorities/trivial.svg">Low</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="aweisberg">Ariel Weisberg</assignee>
                                    <reporter username="aweisberg">Ariel Weisberg</reporter>
                        <labels>
                    </labels>
                <created>Fri, 24 Apr 2015 21:48:01 +0000</created>
                <updated>Tue, 16 Apr 2019 09:31:13 +0000</updated>
                            <resolved>Thu, 13 Aug 2015 15:37:10 +0000</resolved>
                                        <fixVersion>3.2</fixVersion>
                                    <component>Legacy/Testing</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="14680604" author="aweisberg" created="Mon, 10 Aug 2015 19:18:49 +0000"  >&lt;p&gt;Some changes and assertions in places that are assuming no array offset.&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/cassandra/compare/trunk...aweisberg:CASSANDRA-9241?expand=1&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/cassandra/compare/trunk...aweisberg:CASSANDRA-9241?expand=1&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;I didn&apos;t find anything wrong when I reviewed.&lt;/p&gt;

&lt;p&gt;I rebase just now so tests are running but before the rebase they looked good&lt;br/&gt;
&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/aweisberg/job/aweisberg-CASSANDRA-9241-testall/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://cassci.datastax.com/view/Dev/view/aweisberg/job/aweisberg-CASSANDRA-9241-testall/&lt;/a&gt;&lt;br/&gt;
&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/aweisberg/job/aweisberg-CASSANDRA-9241-dtest/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://cassci.datastax.com/view/Dev/view/aweisberg/job/aweisberg-CASSANDRA-9241-dtest/&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14692540" author="jbellis" created="Tue, 11 Aug 2015 23:49:10 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=Stefania&quot; class=&quot;user-hover&quot; rel=&quot;stefania&quot;&gt;Stefania&lt;/a&gt; to review&lt;/p&gt;</comment>
                            <comment id="14692724" author="stefania" created="Wed, 12 Aug 2015 01:26:23 +0000"  >&lt;ul&gt;
	&lt;li&gt;I pushed a couple of tiny nits &lt;a href=&quot;https://github.com/stef1927/cassandra/commit/e5b0916d78b6ab02a8d2593f61ae1fd752d9504a&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;here&lt;/a&gt;. I could not create a pull request, aweisberg/cassandra did not appear in the choice of base forks.&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;In &lt;tt&gt;DataOutputBuffer.getData()&lt;/tt&gt; should we not also assert that the buffer has an array?&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;In the &lt;tt&gt;TypeSerializer&lt;/tt&gt; documentation why do we need &lt;em&gt;Does not modify the position or limit of the buffer even temporarily&lt;/em&gt;? I mean if we are using the BB then we do modify its position implicitly?&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;The latest CI builds failed, so I restarted them just now. &lt;/p&gt;</comment>
                            <comment id="14693716" author="aweisberg" created="Wed, 12 Aug 2015 15:54:46 +0000"  >&lt;p&gt;Calling buffer.hasArray() isn&apos;t necessary because ByteBuffer is already going to throw if you call array() when there is none. Calling arrayOffset() in the assert will also throw.&lt;/p&gt;

&lt;p&gt;One of the pitfalls of ByteBuffers is thread safety. If multiple threads use the relative get()/set() methods they race to modify the position. The work around is to duplicate buffers before using APIs that modify the position and limit which is error prone and creates garbage. So it is useful to know that something preserves the position and limit and does not manipulate it even temporarily. It also indicates that implementers of the API shouldn&apos;t introduce an implementation that modifies the position and limit.&lt;/p&gt;

&lt;p&gt;The CI builds failed again. I cherry-picked your nits and rebased to latest trunk. Will try again.&lt;/p&gt;</comment>
                            <comment id="14694032" author="aweisberg" created="Wed, 12 Aug 2015 19:16:28 +0000"  >&lt;p&gt;Tests completed.&lt;br/&gt;
&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/aweisberg/job/aweisberg-CASSANDRA-9241-dtest/8/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://cassci.datastax.com/view/Dev/view/aweisberg/job/aweisberg-CASSANDRA-9241-dtest/8/&lt;/a&gt;&lt;br/&gt;
&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/aweisberg/job/aweisberg-CASSANDRA-9241-testall/6/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://cassci.datastax.com/view/Dev/view/aweisberg/job/aweisberg-CASSANDRA-9241-testall/6/&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14694431" author="stefania" created="Wed, 12 Aug 2015 23:57:36 +0000"  >&lt;p&gt;Tests look good, overall +1 to commit.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;So it is useful to know that something preserves the position and limit and does not manipulate it even temporarily. It also indicates that implementers of the API shouldn&apos;t introduce an implementation that modifies the position and limit.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I see, I didn&apos;t realize our type serializes are careful to not call the racing get() and put() BB methods.&lt;/p&gt;</comment>
                            <comment id="14694474" author="aweisberg" created="Thu, 13 Aug 2015 00:40:58 +0000"  >&lt;blockquote&gt;&lt;p&gt;I see, I didn&apos;t realize our type serializes are careful to not call the racing get() and put() BB methods.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Well... I looked at all the implementations and they were. So I added the comment to make it official. I think it is desirable that they don&apos;t change the position or limit because we use them against ByteBuffers that we would like to not have to duplicate. I didn&apos;t check all the usages, but I wouldn&apos;t be surprised if there are some that make that assumption, but even if there aren&apos;t it&apos;s the kind of thing that sneaks in sooner or later.&lt;/p&gt;</comment>
                            <comment id="14695374" author="jbellis" created="Thu, 13 Aug 2015 15:37:10 +0000"  >&lt;p&gt;committed (to trunk only)&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[aweisberg]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 14 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2dqrz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>stefania</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[stefania]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12961"><![CDATA[Low]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>