<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 22:40:25 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-5852] json2sstable breaks on data exported from sstable2json.</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-5852</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;Attached is a JSON formatted sstable generated by sstable2json.&lt;/p&gt;

&lt;p&gt;This file cannot be loaded back into Cassandra via json2sstable; it outputs this error:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;Counting keys to &lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt;, please wait... (NOTE: to skip &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; use -n &amp;lt;num_keys&amp;gt;)
Importing 16 keys...
java.lang.NumberFormatException: Non-hex characters in value6
	at org.apache.cassandra.utils.Hex.hexToBytes(Hex.java:60)
	at org.apache.cassandra.utils.ByteBufferUtil.hexToBytes(ByteBufferUtil.java:503)
	at org.apache.cassandra.tools.SSTableImport.stringAsType(SSTableImport.java:578)
	at org.apache.cassandra.tools.SSTableImport.access$000(SSTableImport.java:59)
	at org.apache.cassandra.tools.SSTableImport$JsonColumn.&amp;lt;init&amp;gt;(SSTableImport.java:154)
	at org.apache.cassandra.tools.SSTableImport.addColumnsToCF(SSTableImport.java:231)
	at org.apache.cassandra.tools.SSTableImport.addToStandardCF(SSTableImport.java:214)
	at org.apache.cassandra.tools.SSTableImport.importSorted(SSTableImport.java:432)
	at org.apache.cassandra.tools.SSTableImport.importJson(SSTableImport.java:319)
	at org.apache.cassandra.tools.SSTableImport.main(SSTableImport.java:543)
ERROR: Non-hex characters in value6
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Steps to reproduce:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;$ ccm create -v git:trunk test-json-&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt;
Fetching Cassandra updates...
Current cluster is now: test-json-&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt;
$ ccm populate -n 1
$ ccm start
$ ccm node1 cqlsh
Connected to test-json-&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; at 127.0.0.1:9160.
[cqlsh 4.0.0 | Cassandra 2.0.0-rc1-SNAPSHOT | CQL spec 3.1.0 | Thrift protocol 19.37.0]
Use HELP &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; help.
cqlsh&amp;gt; CREATE KEYSPACE test WITH replication = {&lt;span class=&quot;code-quote&quot;&gt;&apos;class&apos;&lt;/span&gt;: &lt;span class=&quot;code-quote&quot;&gt;&apos;SimpleStrategy&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;replication_factor&apos;&lt;/span&gt;: 1};
cqlsh&amp;gt; CREATE TABLE test.test (key varchar PRIMARY KEY, value varchar);
cqlsh&amp;gt; INSERT INTO test.test (key, value) VALUES (&lt;span class=&quot;code-quote&quot;&gt;&apos;ryan&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;ryan&apos;&lt;/span&gt;);
cqlsh&amp;gt; 
$ ccm node1 flush
$ ccm stop
$ ~/.ccm/test-json-&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt;/node1/bin/json2sstable -s -K test -c test ~/Downloads/import_error/r.json ~/.ccm/test-json-&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt;/node1/data/test/test/test-test-ja-1-Data.db 
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="12662160">CASSANDRA-5852</key>
            <summary>json2sstable breaks on data exported from sstable2json.</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10003" iconUrl="https://issues.apache.org/jira/images/icons/priorities/trivial.svg">Low</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="lyubent">Lyuben Todorov</assignee>
                                    <reporter username="enigmacurry">Ryan McGuire</reporter>
                        <labels>
                    </labels>
                <created>Tue, 6 Aug 2013 16:58:54 +0000</created>
                <updated>Tue, 16 Apr 2019 09:32:08 +0000</updated>
                            <resolved>Thu, 19 Sep 2013 10:00:26 +0000</resolved>
                                        <fixVersion>1.2.10</fixVersion>
                    <fixVersion>2.0.1</fixVersion>
                                    <component>Legacy/Tools</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="13755712" author="lyubent" created="Sun, 1 Sep 2013 12:58:41 +0000"  >&lt;p&gt;There are two problems here.&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;First the json has an empty column that causes empty values to be added to the sstable &lt;a href=&quot;https://gist.github.com/lyubent/6404249&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;gist&lt;/a&gt;&lt;/li&gt;
	&lt;li&gt;Second, the key is stored as hex which is correct, but the values are stored as strings, should we change this in sstable2json (when we export the data) or should the import tool (json2sstable) just allow an option to import from string values and hex values?&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13755715" author="jbellis" created="Sun, 1 Sep 2013 13:05:35 +0000"  >&lt;p&gt;sstable2json should convert values to be human-readable.  Blob type should be hex but others should not.&lt;/p&gt;</comment>
                            <comment id="13770032" author="lyubent" created="Tue, 17 Sep 2013 21:52:20 +0000"  >&lt;p&gt;Changed the lookup for comparator to use CFMetaData#getColumnDefinition when it isn&apos;t null, otherwise the function falls back to the previously used CFMetaData#getValueValidator. Updated AbstractCompositeType#fromString to interpret empty cell names &quot;&quot; as cql3 row markers.&lt;/p&gt;</comment>
                            <comment id="13770087" author="jbellis" created="Tue, 17 Sep 2013 22:30:31 +0000"  >&lt;p&gt;I assume this is a problem in 1.2 as well?  If so we should commit there too.&lt;/p&gt;</comment>
                            <comment id="13770643" author="lyubent" created="Wed, 18 Sep 2013 10:45:42 +0000"  >&lt;p&gt;+1 Added patch for C* 1.2 &lt;/p&gt;</comment>
                            <comment id="13770679" author="slebresne" created="Wed, 18 Sep 2013 11:37:56 +0000"  >&lt;p&gt;Looking closer at this, I don&apos;t think we can change AbstractCompositeType.fromString() like that. The problem is that ACT.getString() will return an empty string in 2 different cases: if its argument is one component, but an empty one, and if it&apos;s argument is empty. Which means ACT.fromString() is basically stuck at picking one interpretation over the other and it currently picks &quot;completely empty&quot; currently.&lt;/p&gt;

&lt;p&gt;Now, the problem is that there is cases where we do want ACT.fromString(&quot;&quot;) to return an empty byte buffer and that&apos;s when you do a select query with CQL2. In that case, an empty byte buffer is ok (basically empty cell name are not ok, but empty is allowed as the bound of slices) and probably almost always what you want.&lt;/p&gt;

&lt;p&gt;In sstable2json, that&apos;s the contrary, you&apos;d want fromString(&quot;&quot;) to always return a one empty component buffer, because a stored on disk cell name cannot be empty.&lt;/p&gt;

&lt;p&gt;So anyway, just changing ACT.fromString(&quot;&quot;) will break CQL2 and I&apos;d rather avoid that. One possible fix would be to change getString() so it generates something different than &quot;&quot; when given a one empty component name and make fromString understand that. But maybe it&apos;s just not worth the trouble and we should just special case then handling of &quot;&quot; in SSTableImport directly, before passing it to ACT.fromString.&lt;/p&gt;

&lt;p&gt;Other than that, on the patch itself, the corret way to get the type for the value would be to use: meta.getValueValidator(meta.getColumnDefinitionFromColumnName(...))&lt;/p&gt;</comment>
                            <comment id="13770794" author="lyubent" created="Wed, 18 Sep 2013 14:10:05 +0000"  >&lt;p&gt;I agree with special casing being simpler. Switched to using CFMetaData#getValueValidator#getColumnDefinitionFromColumnName for retrieving column types and tweaked CFMetaData#getColumnDefinitionFromColumnName to avoid an &lt;a href=&quot;https://gist.github.com/lyubent/6609670&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;ArrayIndexOutOfBoundsException ex&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13770923" author="slebresne" created="Wed, 18 Sep 2013 16:15:20 +0000"  >&lt;p&gt;You&apos;re right that getColumnDefinitionFromColumnName doesn&apos;t always work, but in fact to be more reliable it shouldn&apos;t assume anything on the number of components after split. So I&apos;d changed it to something like:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;ByteBuffer[] components = composite.split(columnName);
for (ColumnDefinition def : column_metadata.values())
{
    ByteBuffer toCompare;
    if (def.componentIndex == null)
    {
        toCompare = columnName;
    }
    else
    {
        if (def.componentIndex &amp;gt;= components.length)
            break;

        toCompare = components[def.componentIndex];
    }
    if (def.name.equals(toCompare))
        return def;
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Other nits:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;the patch adds a println, not sure that was the intent.&lt;/li&gt;
	&lt;li&gt;getValueValidator actually knows how to handle null, so we don&apos;t need to check the result of getColumnDefinitionFromColumnName first.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;As a side note, it&apos;s ok to only provide a 1.2 patch (unless the patch for 2.0 has important differences that are related to the ticket, which is not the case here), I&apos;ll fix the 2.0 specificities during merge.&lt;/p&gt;</comment>
                            <comment id="13770937" author="lyubent" created="Wed, 18 Sep 2013 16:34:06 +0000"  >&lt;p&gt;Added 5852_cassandra-1.2_v3.patch&lt;/p&gt;</comment>
                            <comment id="13771756" author="slebresne" created="Thu, 19 Sep 2013 10:00:26 +0000"  >&lt;p&gt;+1, committed, thanks.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10032">
                    <name>Blocker</name>
                                            <outwardlinks description="blocks">
                                        <issuelink>
            <issuekey id="12662163">CASSANDRA-5853</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12603805" name="5852_cassandra-1.2.patch" size="1932" author="lyubent" created="Wed, 18 Sep 2013 10:27:08 +0000"/>
                            <attachment id="12603842" name="5852_cassandra-1.2_v2.patch" size="2753" author="lyubent" created="Wed, 18 Sep 2013 15:09:00 +0000"/>
                            <attachment id="12603858" name="5852_cassandra-1.2_v3.patch" size="2607" author="lyubent" created="Wed, 18 Sep 2013 16:34:06 +0000"/>
                            <attachment id="12603806" name="5852_cassandra-2.0.patch" size="1928" author="lyubent" created="Wed, 18 Sep 2013 10:45:06 +0000"/>
                            <attachment id="12603830" name="5852_cassandra-2.0_v2.patch" size="2752" author="lyubent" created="Wed, 18 Sep 2013 14:10:05 +0000"/>
                            <attachment id="12596369" name="r.json" size="1563" author="enigmacurry" created="Tue, 6 Aug 2013 16:59:19 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>6.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[lyubent]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>342164</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            12 years, 9 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1n0d3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>342469</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12311421" key="com.atlassian.jira.plugin.system.customfieldtypes:multiversion">
                        <customfieldname>Reproduced In</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="12324159">2.1 rc3</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>slebresne</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[slebresne]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12961"><![CDATA[Low]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>