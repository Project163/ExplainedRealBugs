<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 22:33:58 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-4195] error in log when upgrading multi-node cluster to 1.1</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-4195</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;I upgraded a cluster from 1.0.9 to 1.1.0. The following message shows up in the logs for all but the first node.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;ERROR [GossipStage:1] 2012-04-30 07:37:06,986 AbstractCassandraDaemon.java (line 139) Fatal exception in thread &lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;[GossipStage:1,5,main]
java.lang.UnsupportedOperationException: Not a time-based UUID                  
    at java.util.UUID.timestamp(UUID.java:331)                                  
    at org.apache.cassandra.service.MigrationManager.updateHighestKnown(MigrationManager.java:121)
    at org.apache.cassandra.service.MigrationManager.rectify(MigrationManager.java:99)
    at org.apache.cassandra.service.MigrationManager.onAlive(MigrationManager.java:83)
    at org.apache.cassandra.gms.Gossiper.markAlive(Gossiper.java:806)           
    at org.apache.cassandra.gms.Gossiper.handleMajorStateChange(Gossiper.java:849)
    at org.apache.cassandra.gms.Gossiper.applyStateLocally(Gossiper.java:908)   
    at org.apache.cassandra.gms.GossipDigestAck2VerbHandler.doVerb(GossipDigestAck2VerbHandler.java:62)
    at org.apache.cassandra.net.MessageDeliveryTask.run(MessageDeliveryTask.java:59)
    at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1110)
    at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:603)
    at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:679)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;this dtest demonstrates the issue. It was added to the cassandra-dtest repository as upgrade_to_11_test:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;from dtest &lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; Tester, debug 
from tools &lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; * 
 
&lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;TestUpgradeTo1_1(Tester): 
 
    def upgrade_test(self): 
        self.num_rows = 0 
        cluster = self.cluster 
 
        # Forcing cluster version on purpose 
        cluster.set_cassandra_dir(cassandra_version=&lt;span class=&quot;code-quote&quot;&gt;&apos;1.0.9&apos;&lt;/span&gt;) 
 
        cluster.populate(3).start() 
        time.sleep(1) 
 
        &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; node in cluster.nodelist():     
            node.flush() 
            time.sleep(.5) 
            node.stop(wait_other_notice=True) 
            node.set_cassandra_dir(cassandra_version=&lt;span class=&quot;code-quote&quot;&gt;&apos;1.1.0&apos;&lt;/span&gt;) 
            node.start(wait_other_notice=True) 
            time.sleep(.5)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment>&lt;p&gt;ccm, dtest. Ubuntu&lt;/p&gt;</environment>
        <key id="12553369">CASSANDRA-4195</key>
            <summary>error in log when upgrading multi-node cluster to 1.1</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10002" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Normal</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="xedin">Pavel Yaskevich</assignee>
                                    <reporter username="tpatterson">Tyler Patterson</reporter>
                        <labels>
                    </labels>
                <created>Mon, 30 Apr 2012 14:17:05 +0000</created>
                <updated>Tue, 16 Apr 2019 09:32:34 +0000</updated>
                            <resolved>Wed, 11 Jul 2012 22:00:53 +0000</resolved>
                                        <fixVersion>1.0.11</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                                                                <comments>
                            <comment id="13264954" author="jbellis" created="Mon, 30 Apr 2012 14:34:02 +0000"  >&lt;p&gt;I thought we added logic to not send incompatible migration messages to 1.0.x nodes?&lt;/p&gt;</comment>
                            <comment id="13265538" author="xedin" created="Tue, 1 May 2012 00:12:28 +0000"  >&lt;p&gt;Yes, we don&apos;t send it and the problem is not about it - here we see the same problem I was talking about at &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-3804&quot; title=&quot;upgrade problems from 1.0 to trunk&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-3804&quot;&gt;&lt;del&gt;CASSANDRA-3804&lt;/del&gt;&lt;/a&gt; - as we no longer use time-based UUID to represent schema version, the &quot;old&quot; nodes (version &amp;lt; 1.1) would fail to join into the ring because they would be stuck on the &quot;highest&quot; version resolution as they assume that all nodes have time-based UUID for version which is no longer the case. We should make a strict regulation about mixed version C* ring otherwise things would continue to break in the different ways, probably to forbid the older node to join if it detects nodes with version &amp;gt;= 1.1, because we can&apos;t rely just skip schema agreement checks on startup or on ring changes...&lt;/p&gt;</comment>
                            <comment id="13265619" author="jbellis" created="Tue, 1 May 2012 03:06:02 +0000"  >&lt;blockquote&gt;&lt;p&gt;probably to forbid the older node to join if it detects nodes with version &amp;gt;= 1.1, because we can&apos;t rely just skip schema agreement checks on startup or on ring changes&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Doesn&apos;t that kill node-at-a-time upgrading dead in the water?&lt;/p&gt;</comment>
                            <comment id="13265739" author="xedin" created="Tue, 1 May 2012 10:48:26 +0000"  >&lt;p&gt;It would, but on the other hand one can&apos;t upgrade node-at-a-time to 1.1 because of incompatible schema changes... We of course can report something like &quot;Nodes with C* version &amp;gt;= 1.1 detected, please upgrade!&quot; instead of failing in MM.rectify(...) but if we continue to operate on that node we can&apos;t guarantee stability anyway... &lt;/p&gt;</comment>
                            <comment id="13409607" author="jbellis" created="Mon, 9 Jul 2012 16:23:33 +0000"  >&lt;p&gt;We &lt;b&gt;need&lt;/b&gt; to support read/write ops in a mixed cluster.  We don&apos;t need to support schema changes.&lt;/p&gt;</comment>
                            <comment id="13409613" author="xedin" created="Mon, 9 Jul 2012 16:31:06 +0000"  >&lt;blockquote&gt;&lt;p&gt;We need to support read/write ops in a mixed cluster. We don&apos;t need to support schema changes.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;See my first comment, old nodes wouldn&apos;t be able to join the ring because they can&apos;t resolve the schema version correctly and as we can&apos;t know what is the difference between old/new schemas they wouldn&apos;t be able to properly handle read/write workloads. We can probably add special mechanism to the 1.0 that would ask for schema in Avro format if it detects that schema version is not a TimeUUID, load it and try to operate but that would require from uses to update their nodes to the latest 1.0 version before they can do upgrade to 1.1.&lt;/p&gt;</comment>
                            <comment id="13409618" author="jbellis" created="Mon, 9 Jul 2012 16:35:27 +0000"  >&lt;p&gt;Ugh, how did we miss this in testing?&lt;/p&gt;

&lt;p&gt;How I think it should work:&lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;if node can&apos;t parse schema version, it should join ring w/ whatever schema it currently has&lt;/li&gt;
	&lt;li&gt;nodes should make best-effort to fulfil requests w/ current schema instead of blocking for schema reconciliation&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;That way as long as users don&apos;t try to modify schema during the upgrade they will be fine.&lt;/p&gt;

&lt;p&gt;I think #2 works as desired, which leaves #1 as a fairly easy update to make in 1.0.11.&lt;/p&gt;</comment>
                            <comment id="13409629" author="xedin" created="Mon, 9 Jul 2012 16:49:29 +0000"  >&lt;p&gt;Ok, I can do #1 and it would get ring into disagreement until upgrade to 1.1 is finished with is a good thing in our case because users won&apos;t be able to mutate it. I was warning about from the time we have decided to change the way version is handled... &lt;/p&gt;</comment>
                            <comment id="13409819" author="xedin" created="Mon, 9 Jul 2012 20:33:26 +0000"  >&lt;p&gt;patch against cassandra-1.0 to make it skip trying to migrate the schema if it detects that it&apos;s running in mixed node cluster and verbose warning.&lt;/p&gt;</comment>
                            <comment id="13409899" author="brandon.williams" created="Mon, 9 Jul 2012 21:59:20 +0000"  >&lt;p&gt;Worked for me.&lt;/p&gt;</comment>
                            <comment id="13412030" author="jbellis" created="Wed, 11 Jul 2012 21:39:30 +0000"  >&lt;p&gt;+1&lt;/p&gt;</comment>
                            <comment id="13412050" author="xedin" created="Wed, 11 Jul 2012 22:00:53 +0000"  >&lt;p&gt;Committed.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12535737" name="CASSANDRA-4195.patch" size="2931" author="xedin" created="Mon, 9 Jul 2012 20:33:26 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[xedin]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>237523</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            13 years, 19 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0gt3r:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>96145</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>jbellis</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[jbellis]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12962"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>