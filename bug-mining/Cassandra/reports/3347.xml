<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 22:50:33 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-8616] sstable tools may result in commit log segments be written</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-8616</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;There was a report of sstable2json causing commitlog segments to be written out when run.  I haven&apos;t attempted to reproduce this yet, so that&apos;s all I know for now.  Since sstable2json loads the conf and schema, I&apos;m thinking that it may inadvertently be triggering the commitlog code.&lt;/p&gt;

&lt;p&gt;sstablescrub, sstableverify, and other sstable tools have the same issue.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12767307">CASSANDRA-8616</key>
            <summary>sstable tools may result in commit log segments be written</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10002" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Normal</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="yukim">Yuki Morishita</assignee>
                                    <reporter username="thobbs">Tom Hobbs</reporter>
                        <labels>
                    </labels>
                <created>Tue, 13 Jan 2015 23:27:35 +0000</created>
                <updated>Wed, 15 Oct 2025 09:49:00 +0000</updated>
                            <resolved>Wed, 14 Dec 2016 00:46:59 +0000</resolved>
                                        <fixVersion>2.2.9</fixVersion>
                    <fixVersion>3.0.11</fixVersion>
                    <fixVersion>3.10</fixVersion>
                                    <component>Legacy/Tools</component>
                        <due></due>
                            <votes>1</votes>
                                    <watches>19</watches>
                                                                                                                <comments>
                            <comment id="14276189" author="thobbs" created="Tue, 13 Jan 2015 23:31:37 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=philipthompson&quot; class=&quot;user-hover&quot; rel=&quot;philipthompson&quot;&gt;philipthompson&lt;/a&gt; can you try to reproduce this? It may be helpful to run stress for a while, then shut down the node, then run sstable2json on one of the stress tables.&lt;/p&gt;</comment>
                            <comment id="14276270" author="rhatch" created="Wed, 14 Jan 2015 00:32:26 +0000"  >&lt;p&gt;This indeed seems to be the case with 2.0.10, and it&apos;s even happening if you invoke sstable2json incorrectly.&lt;/p&gt;

&lt;p&gt;To repro I ran cassandra-stress, and killed the cassandra process while stress was still running. Then I ran sstable2json (with a bad sstable filename, and with a valid one) and new commitlog files are created.&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;root@ce986ee973c1:/cassandra# ls -ltr /var/lib/cassandra/commitlog | wc -l
11
root@ce986ee973c1:/cassandra# bin/sstable2json thisfiledoesntexist.db &amp;gt; /dev/null
Exception in thread &quot;main&quot; java.util.NoSuchElementException
        at java.util.StringTokenizer.nextToken(StringTokenizer.java:349)
        at org.apache.cassandra.io.sstable.Descriptor.fromFilename(Descriptor.java:235)
        at org.apache.cassandra.io.sstable.Descriptor.fromFilename(Descriptor.java:204)
        at org.apache.cassandra.tools.SSTableExport.main(SSTableExport.java:452)
^C
root@ce986ee973c1:/cassandra# ls -ltr /var/lib/cassandra/commitlog | wc -l
12
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="14276283" author="rhatch" created="Wed, 14 Jan 2015 00:44:15 +0000"  >&lt;p&gt;Same goes for 2.1&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;root@e69321a30198:/cassandra# ls -ltr data/commitlog/                       
total 262144
-rw-r--r-- 1 root root 33554432 Jan 14 00:37 CommitLog-4-1421195804516.log
-rw-r--r-- 1 root root 33554432 Jan 14 00:38 CommitLog-4-1421195804525.log
-rw-r--r-- 1 root root 33554432 Jan 14 00:38 CommitLog-4-1421195804530.log
-rw-r--r-- 1 root root 33554432 Jan 14 00:38 CommitLog-4-1421195804529.log
-rw-r--r-- 1 root root 33554432 Jan 14 00:38 CommitLog-4-1421195804528.log
-rw-r--r-- 1 root root 33554432 Jan 14 00:38 CommitLog-4-1421195804531.log
-rw-r--r-- 1 root root 33554432 Jan 14 00:38 CommitLog-4-1421195804526.log
-rw-r--r-- 1 root root 33554432 Jan 14 00:38 CommitLog-4-1421195804527.log
root@e69321a30198:/cassandra# ls -ltr data/commitlog/ | wc -l
9
root@e69321a30198:/cassandra# tools/bin/sstable2json data/data/keyspace1/standard1-85148e309b8511e4b94691de6f1c3a1d/keyspace1-standard1-ka-1-Data.db &amp;gt; /dev/null
root@e69321a30198:/cassandra# ls -ltr data/commitlog/
total 262148
-rw-r--r-- 1 root root 33554432 Jan 14 00:37 CommitLog-4-1421195804516.log
-rw-r--r-- 1 root root 33554432 Jan 14 00:38 CommitLog-4-1421195804525.log
-rw-r--r-- 1 root root 33554432 Jan 14 00:38 CommitLog-4-1421195804530.log
-rw-r--r-- 1 root root 33554432 Jan 14 00:38 CommitLog-4-1421195804529.log
-rw-r--r-- 1 root root 33554432 Jan 14 00:38 CommitLog-4-1421195804528.log
-rw-r--r-- 1 root root 33554432 Jan 14 00:38 CommitLog-4-1421195804531.log
-rw-r--r-- 1 root root 33554432 Jan 14 00:38 CommitLog-4-1421195804526.log
-rw-r--r-- 1 root root 33554432 Jan 14 00:38 CommitLog-4-1421195804527.log
-rw-r--r-- 1 root root 33554432 Jan 14 00:42 CommitLog-4-1421196133229.log
root@e69321a30198:/cassandra# ls -ltr data/commitlog/ | wc -l
10
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="14277241" author="thobbs" created="Wed, 14 Jan 2015 17:13:37 +0000"  >&lt;p&gt;Thanks, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rhatch&quot; class=&quot;user-hover&quot; rel=&quot;rhatch&quot;&gt;rhatch&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=yukim&quot; class=&quot;user-hover&quot; rel=&quot;yukim&quot;&gt;yukim&lt;/a&gt; do you want to take this one?&lt;/p&gt;</comment>
                            <comment id="14277319" author="yukim" created="Wed, 14 Jan 2015 17:52:40 +0000"  >&lt;p&gt;yup&lt;/p&gt;</comment>
                            <comment id="14284934" author="yukim" created="Wed, 21 Jan 2015 00:52:16 +0000"  >&lt;p&gt;This is due to the fact that loading schema writes (updates) schema version whenever it happens.&lt;br/&gt;
(I believe the behavior hasn&apos;t changed for a while, so issue here has been around way before 2.0.10.)&lt;br/&gt;
Also judging from the code, standalone scrub/upgradesstbale/sstablesplit behave the same.&lt;/p&gt;

&lt;p&gt;Quick work around is to add the way to load schema without updating schema version.&lt;/p&gt;</comment>
                            <comment id="14286501" author="thobbs" created="Wed, 21 Jan 2015 23:10:13 +0000"  >&lt;p&gt;+1&lt;/p&gt;</comment>
                            <comment id="14289387" author="yukim" created="Fri, 23 Jan 2015 15:28:38 +0000"  >&lt;p&gt;Committed, thanks!&lt;/p&gt;</comment>
                            <comment id="14290194" author="rhatch" created="Fri, 23 Jan 2015 23:19:47 +0000"  >&lt;p&gt;Seems to be working fine in 2.0 latest, but latest 2.1 (c468c8b436) is still writing commitlog files when sstable2json is called.&lt;/p&gt;

&lt;p&gt;Similar to before, this happens whether the db file argument is valid or not, and each time 1 new commitlog file is written.&lt;/p&gt;</comment>
                            <comment id="14290380" author="yukim" created="Sat, 24 Jan 2015 02:21:20 +0000"  >&lt;p&gt;You are right.&lt;br/&gt;
In 2.1 and trunk, accessing schema creates new Memtable instance for schema_keyspace, and &lt;a href=&quot;https://github.com/apache/cassandra/blob/cassandra-2.1.2/src/java/org/apache/cassandra/db/Memtable.java#L66&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;Memtable touches CommitLog singleton&lt;/a&gt; which &lt;a href=&quot;https://github.com/apache/cassandra/blob/cassandra-2.1.2/src/java/org/apache/cassandra/db/commitlog/CommitLog.java#L70&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;creates one commit log file when it is initialized&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;Looks like more work is needed to be done...&lt;/p&gt;</comment>
                            <comment id="14305850" author="wadey" created="Wed, 4 Feb 2015 20:00:56 +0000"  >&lt;p&gt;I am seeing what appears to be the same issue in 1.2.16. Using sstable2json is trying to open the commitlog files for writing:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;$ sstable2json &amp;lt;sstable-Data.db&amp;gt;
Exception in thread &quot;COMMIT-LOG-ALLOCATOR&quot; FSWriteError in /var/lib/cassandra/commitlog/CommitLog-2-1423079861481.log                                                               ]
	at org.apache.cassandra.db.commitlog.CommitLogSegment.&amp;lt;init&amp;gt;(CommitLogSegment.java:132)
	at org.apache.cassandra.db.commitlog.CommitLogSegment.freshSegment(CommitLogSegment.java:81)
	at org.apache.cassandra.db.commitlog.CommitLogAllocator.createFreshSegment(CommitLogAllocator.java:251)
	at org.apache.cassandra.db.commitlog.CommitLogAllocator.access$500(CommitLogAllocator.java:49)
	at org.apache.cassandra.db.commitlog.CommitLogAllocator$1.runMayThrow(CommitLogAllocator.java:105)
	at org.apache.cassandra.utils.WrappedRunnable.run(WrappedRunnable.java:28)
	at java.lang.Thread.run(Thread.java:695)
Caused by: java.io.FileNotFoundException: /var/lib/cassandra/commitlog/CommitLog-2-1423079861481.log (Permission denied)
	at java.io.RandomAccessFile.open(Native Method)
	at java.io.RandomAccessFile.&amp;lt;init&amp;gt;(RandomAccessFile.java:216)
	at org.apache.cassandra.db.commitlog.CommitLogSegment.&amp;lt;init&amp;gt;(CommitLogSegment.java:116)
	... 6 more
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="14624191" author="jbellis" created="Mon, 13 Jul 2015 04:39:51 +0000"  >&lt;p&gt;Something to keep in mind for our next gen sstable2json &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=slebresne&quot; class=&quot;user-hover&quot; rel=&quot;slebresne&quot;&gt;slebresne&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14624274" author="slebresne" created="Mon, 13 Jul 2015 06:48:43 +0000"  >&lt;p&gt;Agreed. The goal mid-term is to get something &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-9587&quot; title=&quot;Serialize table schema as a sstable component&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-9587&quot;&gt;CASSANDRA-9587&lt;/a&gt; so such tool really act as external tools, i.e. they don&apos;t silently load a lot of the same stuff than the server so this kind of thing cannot happen.&lt;/p&gt;</comment>
                            <comment id="14943782" author="jbellis" created="Mon, 5 Oct 2015 18:16:10 +0000"  >&lt;p&gt;Bumping to critical since this can prevent startup when sstable2json creates a new segment as root. &lt;/p&gt;</comment>
                            <comment id="15139794" author="rcoli" created="Tue, 9 Feb 2016 21:24:52 +0000"  >&lt;p&gt;+1 to critical priority, I encountered this in production and, even worse than preventing startup, it started the node up in a mode where it was listening to clients but was unable to speak to other nodes.&lt;/p&gt;</comment>
                            <comment id="15142958" author="slebresne" created="Thu, 11 Feb 2016 16:17:15 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=yukim&quot; class=&quot;user-hover&quot; rel=&quot;yukim&quot;&gt;yukim&lt;/a&gt; Since you did the first part of this issue, mind looking at the followup?&lt;/p&gt;</comment>
                            <comment id="15143867" author="yukim" created="Fri, 12 Feb 2016 01:39:49 +0000"  >&lt;p&gt;I wrote dirty workaround patch: &lt;a href=&quot;https://github.com/yukim/cassandra/tree/8616-2.1&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/yukim/cassandra/tree/8616-2.1&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Basically added flag to disable CommitLogAllocator so directories/files are not created.&lt;br/&gt;
We cannot use Config.setClientMode for that because it causes another problems(basically, we cannot use ColumnFaimlyStore in client mode).&lt;/p&gt;

&lt;p&gt;At first, I wrote offline schema loader that constructs schema from schema_* SSTables. But, offline tools just use ColumnFamilyStore everywhere, I needed to rewrite everything. So I end up above hack.&lt;br/&gt;
I can save it for later, probably at the time &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-7464&quot; title=&quot;Replace sstable2json&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-7464&quot;&gt;&lt;del&gt;CASSANDRA-7464&lt;/del&gt;&lt;/a&gt; is in.&lt;/p&gt;

&lt;p&gt;If the change looks good, I will work for other branches.&lt;/p&gt;</comment>
                            <comment id="15144454" author="slebresne" created="Fri, 12 Feb 2016 11:12:26 +0000"  >&lt;p&gt;We definitively want to clean how offline use internal code as it&apos;s a mess right now but for now I agree a quick and dirty (and importantly simple) fix is good enough. It would be nice to write a regression dtest for this though before committing.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=thobbs&quot; class=&quot;user-hover&quot; rel=&quot;thobbs&quot;&gt;thobbs&lt;/a&gt; are you good finishing review on this since you&apos;re still marked reviewer?&lt;/p&gt;</comment>
                            <comment id="15145503" author="thobbs" created="Fri, 12 Feb 2016 23:03:06 +0000"  >&lt;blockquote&gt;&lt;p&gt;Tyler Hobbs are you good finishing review on this since you&apos;re still marked reviewer?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Sure, I&apos;ll review.&lt;/p&gt;</comment>
                            <comment id="15145613" author="thobbs" created="Sat, 13 Feb 2016 00:27:21 +0000"  >&lt;p&gt;The fix looks good to me as a temporary solution.  However, I think you missed a few tools that also need the fix:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;&lt;tt&gt;SSTableLevelResetter&lt;/tt&gt;&lt;/li&gt;
	&lt;li&gt;&lt;tt&gt;SSTableExpiredBlockers&lt;/tt&gt;&lt;/li&gt;
	&lt;li&gt;&lt;tt&gt;BulkLoader&lt;/tt&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;And in later versions, we also need to fix:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;&lt;tt&gt;SSTableRepairedAtSetter&lt;/tt&gt;&lt;/li&gt;
	&lt;li&gt;&lt;tt&gt;StandaloneVerifier&lt;/tt&gt;&lt;/li&gt;
	&lt;li&gt;&lt;tt&gt;StandaloneSSTableUtil&lt;/tt&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;As Sylvain mentions, it would be good to add regression dtests for these.&lt;/p&gt;</comment>
                            <comment id="15154523" author="yukim" created="Fri, 19 Feb 2016 17:24:26 +0000"  >&lt;p&gt;Bad news. My approach didn&apos;t work.&lt;/p&gt;

&lt;p&gt;There is one point that tries to access commit log: offline tools like sstablescrub tries to delete data from system.sstable_activity after scrubbing SSTable. This causes access to commit log and since we are trying to disable, the tool hangs at &lt;a href=&quot;https://github.com/apache/cassandra/blob/cassandra-2.1.13/src/java/org/apache/cassandra/db/commitlog/CommitLogSegmentManager.java#L271&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;here&lt;/a&gt;.&lt;br/&gt;
Previously I stated that many offline tools cannot run with &lt;tt&gt;Client.setClientMode(true)&lt;/tt&gt;, so reading from SSTableReader tracks sstable activity even we are ofline.&lt;/p&gt;

&lt;p&gt;Probably we should consider rewriting tools so that they never use ColumnFamilyStore.&lt;/p&gt;</comment>
                            <comment id="15154585" author="thobbs" created="Fri, 19 Feb 2016 18:17:30 +0000"  >&lt;blockquote&gt;&lt;p&gt;Probably we should consider rewriting tools so that they never use ColumnFamilyStore.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;That is sounding like a better option to me, too.  Without doing that, I worry that we will miss edge cases that touch the commitlog in the future.&lt;/p&gt;</comment>
                            <comment id="15156706" author="slebresne" created="Mon, 22 Feb 2016 09:55:24 +0000"  >&lt;blockquote&gt;&lt;p&gt;That is sounding like a better option to me, too.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Right, but I&apos;ll also note that some people seems to have run into this with pretty nasty consequences. So I&apos;m all for a clean solution here, but unless &quot;rewriting tools so that they never use ColumnFamilyStore&quot; is a lot more trivial than it sounds to me, we might need a quick-n-dirty fix that is suitable for 2.1 here. And what I mean by that is that we might want to add some &quot;offline&quot; mode (different from &quot;client mode&quot; since you say we can&apos;t use that) that skips what shouldn&apos;t be done by offline tools (like deleting data from &lt;tt&gt;system.sstable_activity&lt;/tt&gt;, which sounds to me like something we probably can just skip when doing an offline scrub).&lt;/p&gt;</comment>
                            <comment id="15219012" author="yukim" created="Wed, 30 Mar 2016 22:55:10 +0000"  >&lt;p&gt;Progress update: There are several places other than &lt;tt&gt;system.sstable_activity&lt;/tt&gt; that offline tools access(vary by version). Trying to patch everything, otherwise tools can hang (dtest is catching these).&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;In cassandra-2.2, offline tools (sstablesplit and posssibly other few) can update &lt;tt&gt;system.compaction_in_progress&lt;/tt&gt; and &lt;tt&gt;system.compaction_history&lt;/tt&gt;.&lt;/li&gt;
	&lt;li&gt;In cassandra-3.0+, sstablescrub against secondary index sstables can update &lt;tt&gt;system.IndexInfo&lt;/tt&gt;.&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="15425784" author="snazy" created="Thu, 18 Aug 2016 01:46:17 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=yukim&quot; class=&quot;user-hover&quot; rel=&quot;yukim&quot;&gt;yukim&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-9054&quot; title=&quot;Let DatabaseDescriptor not implicitly startup services&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-9054&quot;&gt;&lt;del&gt;CASSANDRA-9054&lt;/del&gt;&lt;/a&gt; is now committed. Can you check whether this is still an issue?&lt;/p&gt;</comment>
                            <comment id="15429059" author="yukim" created="Fri, 19 Aug 2016 23:44:00 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=snazy&quot; class=&quot;user-hover&quot; rel=&quot;snazy&quot;&gt;snazy&lt;/a&gt; the problem comes from opening schema in the tools. They need to access schema by opening &lt;tt&gt;system_schema&lt;/tt&gt; keyspace that creates commit log. I tried to patch commit log part, but various &quot;online&quot; features described above came up after that. &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-9587&quot; title=&quot;Serialize table schema as a sstable component&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-9587&quot;&gt;CASSANDRA-9587&lt;/a&gt; can be useful here.&lt;/p&gt;</comment>
                            <comment id="15485375" author="yukim" created="Mon, 12 Sep 2016 21:44:20 +0000"  >&lt;p&gt;I took another approach in the new patches.&lt;br/&gt;
Since the source of accessing commit log is &lt;tt&gt;Memtable&lt;/tt&gt;, I changed &lt;tt&gt;Tracker&lt;/tt&gt; to have &lt;tt&gt;Memtable&lt;/tt&gt; optional when only on online. (This change may also be useful for future offline tools change.)&lt;/p&gt;

&lt;p&gt;There are several places that try to update system tables (sstable_activity, secondary index, compaction) so I manually had to disabled them by checking &lt;tt&gt;DatabaseDescriptor.isDaemonInitialized&lt;/tt&gt; (in trunk, added similar method to 2.2 and 3.0), or offline tool can hang.&lt;/p&gt;

&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;branch&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;testall&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;dtest&lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/yukim/cassandra/tree/8616-2.2&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;8616-2.2&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/yukim/job/yukim-8616-2.2-testall/lastCompletedBuild/testReport/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;testall&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/yukim/job/yukim-8616-2.2-dtest/lastCompletedBuild/testReport/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;dtest&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/yukim/cassandra/tree/8616-3.0&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;8616-3.0&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/yukim/job/yukim-8616-3.0-testall/lastCompletedBuild/testReport/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;testall&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/yukim/job/yukim-8616-3.0-dtest/lastCompletedBuild/testReport/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;dtest&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/yukim/cassandra/tree/8616-trunk&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;8616-trunk&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/yukim/job/yukim-8616-trunk-testall/lastCompletedBuild/testReport/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;testall&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/yukim/job/yukim-8616-trunk-dtest/lastCompletedBuild/testReport/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;dtest&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;


&lt;p&gt;(test is still running for some)&lt;/p&gt;</comment>
                            <comment id="15487814" author="yukim" created="Tue, 13 Sep 2016 17:19:49 +0000"  >&lt;p&gt;Unit test failures in trunk revealed that I need to patch where we query Memtable and SSTables since current code assumes there is at least one iterator there. Will update the patch.&lt;/p&gt;</comment>
                            <comment id="15489208" author="yukim" created="Wed, 14 Sep 2016 03:04:30 +0000"  >&lt;p&gt;Patch updated and tests are running.&lt;/p&gt;</comment>
                            <comment id="15493908" author="thobbs" created="Thu, 15 Sep 2016 16:52:37 +0000"  >&lt;p&gt;The patches seem fine to me, but there are some problems in the tests.  It seems like the 2.2 testall failures around SSTableRewriter could be related to this, since they don&apos;t show up in normal 2.2 test failures.  The 3.0 and 3.3 dtests are erroring out when trying to copy test results at the end, but if I remember correctly, this can be caused by some tests not terminating, so we should investigate that.  The trunk RemoveTest failure in testall could also be related to this patch.&lt;/p&gt;</comment>
                            <comment id="15562384" author="yukim" created="Mon, 10 Oct 2016 13:55:52 +0000"  >&lt;p&gt;There were indeed a problem that causes dtest failure in previous patches.&lt;br/&gt;
Updated and rebased all the branches:&lt;/p&gt;

&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;branch&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;testall&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;dtest&lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/yukim/cassandra/tree/8616-2.2&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;8616-2.2&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/yukim/job/yukim-8616-2.2-testall/lastCompletedBuild/testReport/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;testall&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/yukim/job/yukim-8616-2.2-dtest/lastCompletedBuild/testReport/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;dtest&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/yukim/cassandra/tree/8616-3.0&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;8616-3.0&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/yukim/job/yukim-8616-3.0-testall/lastCompletedBuild/testReport/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;testall&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/yukim/job/yukim-8616-3.0-dtest/lastCompletedBuild/testReport/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;dtest&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/yukim/cassandra/tree/8616-3.X&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;8616-3.X&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/yukim/job/yukim-8616-3.X-testall/lastCompletedBuild/testReport/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;testall&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/yukim/job/yukim-8616-3.X-dtest/lastCompletedBuild/testReport/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;dtest&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/yukim/cassandra/tree/8616-trunk&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;8616-trunk&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/yukim/job/yukim-8616-trunk-testall/lastCompletedBuild/testReport/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;testall&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/yukim/job/yukim-8616-trunk-dtest/lastCompletedBuild/testReport/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;dtest&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;
</comment>
                            <comment id="15706047" author="thobbs" created="Tue, 29 Nov 2016 18:05:06 +0000"  >&lt;p&gt;I totally forgot about this, sorry about that.  The test results do look much better now.  If you can rebase again and do one final test run, I&apos;m +1 on committing this if the test results still look good.&lt;/p&gt;</comment>
                            <comment id="15729525" author="jmckenzie" created="Wed, 7 Dec 2016 18:38:00 +0000"  >&lt;p&gt;ping &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=yukim&quot; class=&quot;user-hover&quot; rel=&quot;yukim&quot;&gt;yukim&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15729625" author="yukim" created="Wed, 7 Dec 2016 19:03:49 +0000"  >&lt;p&gt;Rebase pushed, running tests now.&lt;/p&gt;</comment>
                            <comment id="15733715" author="thobbs" created="Thu, 8 Dec 2016 23:28:10 +0000"  >&lt;p&gt;I&apos;ve restarted the 3.0 tests, because they didn&apos;t run for some reason.  It looks like the only potential problems are in the trunk dtests, where &lt;tt&gt;offline_tools_test.TestOfflineTools.sstableupgrade_test&lt;/tt&gt; and &lt;tt&gt;upgrade_internal_auth_test.TestAuthUpgrade.test_upgrade_legacy_table&lt;/tt&gt; are failing.&lt;/p&gt;</comment>
                            <comment id="15733769" author="yukim" created="Thu, 8 Dec 2016 23:55:39 +0000"  >&lt;p&gt;Right, I already pushed the fix and running tests again. Will update once they are done.&lt;/p&gt;</comment>
                            <comment id="15734202" author="yukim" created="Fri, 9 Dec 2016 03:57:52 +0000"  >&lt;p&gt;Tests completed now.&lt;/p&gt;</comment>
                            <comment id="15745642" author="thobbs" created="Tue, 13 Dec 2016 17:08:32 +0000"  >&lt;p&gt;+1&lt;/p&gt;</comment>
                            <comment id="15746783" author="yukim" created="Wed, 14 Dec 2016 00:47:00 +0000"  >&lt;p&gt;Thanks, committed as &lt;tt&gt;66f1aaf88d3cde5c52b13d71d3326da5eda16fb1&lt;/tt&gt;.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310010">
                    <name>Incorporates</name>
                                            <outwardlinks description="incorporates">
                                        <issuelink>
            <issuekey id="12999776">CASSANDRA-12534</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12786274">CASSANDRA-9054</issuekey>
        </issuelink>
                            </outwardlinks>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="13079898">CASSANDRA-13605</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12693455" name="8161-2.0.txt" size="4771" author="yukim" created="Wed, 21 Jan 2015 00:52:16 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[yukim]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 48 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i24c7r:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12311421" key="com.atlassian.jira.plugin.system.customfieldtypes:multiversion">
                        <customfieldname>Reproduced In</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="12327164">2.0.10</customfieldvalue>
    <customfieldvalue id="12328951">2.1.3</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>thobbs</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[thobbs]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12962"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311124" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Tester</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>rhatch</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>