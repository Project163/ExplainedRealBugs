<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 22:43:01 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-6742] Make it safe to concurrently access ABSC after its construction</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-6742</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;This is a physical four node cluster. Configuration is attached.&lt;/p&gt;

&lt;p&gt;Create a keyspace and table from the first node: &lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;CREATE KEYSPACE &lt;span class=&quot;code-quote&quot;&gt;&quot;Keyspace1&quot;&lt;/span&gt; WITH replication = {
  &lt;span class=&quot;code-quote&quot;&gt;&apos;class&apos;&lt;/span&gt;: &lt;span class=&quot;code-quote&quot;&gt;&apos;SimpleStrategy&apos;&lt;/span&gt;,
  &lt;span class=&quot;code-quote&quot;&gt;&apos;replication_factor&apos;&lt;/span&gt;: &lt;span class=&quot;code-quote&quot;&gt;&apos;1&apos;&lt;/span&gt;
};

USE &lt;span class=&quot;code-quote&quot;&gt;&quot;Keyspace1&quot;&lt;/span&gt;;

CREATE TABLE &lt;span class=&quot;code-quote&quot;&gt;&quot;Counter1&quot;&lt;/span&gt; (
  key blob,
  column1 ascii,
  value counter,
  PRIMARY KEY (key, column1)
) WITH COMPACT STORAGE AND
  bloom_filter_fp_chance=0.010000 AND
  caching=&lt;span class=&quot;code-quote&quot;&gt;&apos;KEYS_ONLY&apos;&lt;/span&gt; AND
  comment=&apos;&apos; AND
  dclocal_read_repair_chance=0.000000 AND
  gc_grace_seconds=864000 AND
  index_interval=128 AND
  read_repair_chance=0.100000 AND
  replicate_on_write=&lt;span class=&quot;code-quote&quot;&gt;&apos;&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&apos;&lt;/span&gt; AND
  populate_io_cache_on_flush=&lt;span class=&quot;code-quote&quot;&gt;&apos;&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;&apos;&lt;/span&gt; AND
  default_time_to_live=0 AND
  speculative_retry=&lt;span class=&quot;code-quote&quot;&gt;&apos;NONE&apos;&lt;/span&gt; AND
  memtable_flush_period_in_ms=0 AND
  compaction={&lt;span class=&quot;code-quote&quot;&gt;&apos;class&apos;&lt;/span&gt;: &lt;span class=&quot;code-quote&quot;&gt;&apos;SizeTieredCompactionStrategy&apos;&lt;/span&gt;} AND
  compression={};
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;And the find the following in the logs:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;INFO  [Thrift:1] 2014-02-19 14:04:35,828 MigrationManager.java:210 - Create &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; ColumnFamily: org.apache.cassandra.config.CFMetaData@d824292[cfId=d1bc0c30-99b1-11e3-a5f9-c187ff8103e2,ksName=Keyspace1,cfName=Counter1,cfType=Standard,comparator=org.apache.cassandra.db.marshal.AsciiType,comment=,readRepairChance=0.1,dclocalReadRepairChance=0.0,gcGraceSeconds=864000,defaultValidator=org.apache.cassandra.db.marshal.CounterColumnType,keyValidator=org.apache.cassandra.db.marshal.BytesType,minCompactionThreshold=4,maxCompactionThreshold=32,columnMetadata={java.nio.HeapByteBuffer[pos=0 lim=3 cap=3]=ColumnDefinition{name=key, type=org.apache.cassandra.db.marshal.BytesType, kind=PARTITION_KEY, componentIndex=&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;, indexName=&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;, indexType=&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;}, java.nio.HeapByteBuffer[pos=0 lim=5 cap=5]=ColumnDefinition{name=value, type=org.apache.cassandra.db.marshal.CounterColumnType, kind=COMPACT_VALUE, componentIndex=&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;, indexName=&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;, indexType=&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;}, java.nio.HeapByteBuffer[pos=0 lim=7 cap=7]=ColumnDefinition{name=column1, type=org.apache.cassandra.db.marshal.AsciiType, kind=CLUSTERING_COLUMN, componentIndex=&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;, indexName=&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;, indexType=&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;}},compactionStrategyClass=&lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;org.apache.cassandra.db.compaction.SizeTieredCompactionStrategy,compactionStrategyOptions={},compressionParameters={},bloomFilterFpChance=0.01,memtableFlushPeriod=0,caching=KEYS_ONLY,defaultTimeToLive=0,minIndexInterval=128,maxIndexInterval=2048,speculativeRetry=NONE,populateIoCacheOnFlush=&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;,droppedColumns={},triggers={},rowsPerPartitionToCache=100]
ERROR [WRITE-/172.16.1.211] 2014-02-19 14:04:35,838 OutboundTcpConnection.java:256 - error writing to /172.16.1.211
java.lang.ArrayIndexOutOfBoundsException: -1
        at org.apache.cassandra.db.ArrayBackedSortedColumns.internalAppendOrReconcile(ArrayBackedSortedColumns.java:231) ~[main/:na]
        at org.apache.cassandra.db.ArrayBackedSortedColumns.sortCells(ArrayBackedSortedColumns.java:143) ~[main/:na]
        at org.apache.cassandra.db.ArrayBackedSortedColumns.maybeSortCells(ArrayBackedSortedColumns.java:103) ~[main/:na]
        at org.apache.cassandra.db.ArrayBackedSortedColumns.getColumnCount(ArrayBackedSortedColumns.java:313) ~[main/:na]
        at org.apache.cassandra.db.ColumnFamilySerializer.contentSerializedSize(ColumnFamilySerializer.java:117) ~[main/:na]
        at org.apache.cassandra.db.ColumnFamilySerializer.serializedSize(ColumnFamilySerializer.java:132) ~[main/:na]
        at org.apache.cassandra.db.Mutation$MutationSerializer.serializedSize(Mutation.java:337) ~[main/:na]
        at org.apache.cassandra.service.MigrationManager$MigrationsSerializer.serializedSize(MigrationManager.java:397) ~[main/:na]
        at org.apache.cassandra.service.MigrationManager$MigrationsSerializer.serializedSize(MigrationManager.java:371) ~[main/:na]
        at org.apache.cassandra.net.MessageOut.serialize(MessageOut.java:116) ~[main/:na]
        at org.apache.cassandra.net.OutboundTcpConnection.writeInternal(OutboundTcpConnection.java:273) [main/:na]
        at org.apache.cassandra.net.OutboundTcpConnection.writeConnected(OutboundTcpConnection.java:225) [main/:na]
        at org.apache.cassandra.net.OutboundTcpConnection.run(OutboundTcpConnection.java:163) [main/:na]
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Among a few other similar errors. See the attached log. There were no errors in the log of the node it was trying to contact.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12696088">CASSANDRA-6742</key>
            <summary>Make it safe to concurrently access ABSC after its construction</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10000" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Urgent</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="aleksey">Aleksey Yeschenko</assignee>
                                    <reporter username="enigmacurry">Ryan McGuire</reporter>
                        <labels>
                    </labels>
                <created>Wed, 19 Feb 2014 22:13:14 +0000</created>
                <updated>Tue, 16 Apr 2019 09:31:53 +0000</updated>
                            <resolved>Thu, 20 Feb 2014 18:37:00 +0000</resolved>
                                        <fixVersion>2.1 beta2</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="13906212" author="enigmacurry" created="Wed, 19 Feb 2014 22:31:12 +0000"  >&lt;p&gt;I don&apos;t always get the same error. Attached is bdplab0.alternate.log which shows a NPE instead.&lt;/p&gt;</comment>
                            <comment id="13906270" author="iamaleksey" created="Wed, 19 Feb 2014 23:28:17 +0000"  >&lt;p&gt;Fixed in d5c3d2fa56e63c9ae5cd6d6a0cab06b5eb2b6b9f.&lt;/p&gt;</comment>
                            <comment id="13907143" author="iamaleksey" created="Thu, 20 Feb 2014 16:28:40 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=benedict&quot; class=&quot;user-hover&quot; rel=&quot;benedict&quot;&gt;benedict&lt;/a&gt; Moving &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-6662&quot; title=&quot;Sort/reconcile cells in ArrayBackedSortedColumns only when an accessor is called&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-6662&quot;&gt;&lt;del&gt;CASSANDRA-6662&lt;/del&gt;&lt;/a&gt; discussion here. Attaching a cleaned up/rewritten version of the suggested patch, with&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;changed Factory interface that accepts initialCapacity now, making it more generic than &apos;unitFactory&apos;. Should use it from now on when we know the final size.&lt;/li&gt;
	&lt;li&gt;altered sort() to not shadow &lt;b&gt;size&lt;/b&gt;, and appendOrReconcile() to not mutate the passed variable as well (and got rid of rightStart/rightEnd vars)&lt;/li&gt;
	&lt;li&gt;moved fast add all path into a separate method, and got rid of all the redundant &lt;b&gt;this&lt;/b&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Actually, I think we can do better than this, avoiding volatile altogether. Will attach a v3 soon.&lt;/p&gt;</comment>
                            <comment id="13907145" author="iamaleksey" created="Thu, 20 Feb 2014 16:29:34 +0000"  >&lt;p&gt;Reopening, b/c while the issue is fixed, we can do better.&lt;/p&gt;</comment>
                            <comment id="13907152" author="benedict" created="Thu, 20 Feb 2014 16:35:28 +0000"  >&lt;p&gt;LGTM so far, though I might have appendOrReconcile encapsulate applying -1 when necessary, to keep the merge consistent in sortCells().&lt;/p&gt;</comment>
                            <comment id="13907191" author="iamaleksey" created="Thu, 20 Feb 2014 17:11:05 +0000"  >&lt;p&gt;We add in sorted order a lot, especially on reads, thus if making size volatile is an issue, so is making unsortedSize volatile.&lt;/p&gt;

&lt;p&gt;So v3 introduces a separate boolean volatile isSorted flag that gets updated only when we break the sorting order or sort the cells (in other words, almost never), and reverts all the complexity added by the recent revisions.&lt;/p&gt;</comment>
                            <comment id="13907208" author="benedict" created="Thu, 20 Feb 2014 17:27:01 +0000"  >&lt;p&gt;Like it.&lt;/p&gt;

&lt;p&gt;Only question is fastAddAll: you&apos;ve limited it to only support array backed, but we sometimes build directly from BTree, and the second path works for any source CF type (skipping N comparisons, since we know there will be no reconcile necessary if building from a CF)&lt;/p&gt;</comment>
                            <comment id="13907291" author="iamaleksey" created="Thu, 20 Feb 2014 18:37:00 +0000"  >&lt;p&gt;Committed, thanks.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                                                <inwardlinks description="is duplicated by">
                                        <issuelink>
            <issuekey id="12696701">CASSANDRA-6754</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12630089" name="6742-v2.txt" size="12213" author="aleksey" created="Thu, 20 Feb 2014 16:32:03 +0000"/>
                            <attachment id="12630087" name="6742-v2.txt" size="12212" author="aleksey" created="Thu, 20 Feb 2014 16:29:06 +0000"/>
                            <attachment id="12630092" name="6742-v3.txt" size="12888" author="aleksey" created="Thu, 20 Feb 2014 17:11:05 +0000"/>
                            <attachment id="12629911" name="bdplab0.alternate.log" size="10390" author="enigmacurry" created="Wed, 19 Feb 2014 22:31:12 +0000"/>
                            <attachment id="12629906" name="bdplab0.log" size="43566" author="enigmacurry" created="Wed, 19 Feb 2014 22:15:30 +0000"/>
                            <attachment id="12629905" name="bdplab0_cassandra.yaml" size="2782" author="enigmacurry" created="Wed, 19 Feb 2014 22:13:48 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>6.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[aleksey]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>374565</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            11 years, 39 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1sjpz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>374865</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12311421" key="com.atlassian.jira.plugin.system.customfieldtypes:multiversion">
                        <customfieldname>Reproduced In</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="12326275">2.1 beta1</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>benedict</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[benedict]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12963"><![CDATA[Critical]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>