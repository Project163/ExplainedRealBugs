<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 22:20:06 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-2381] orphaned data files may be created during migration race</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-2381</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;We try to prevent creating orphans by locking Table.flusherLock in maybeSwitchMemtable and the Migration process, but since the actual writing is done asynchronously in Memtable.writeSortedContents there is a race window, where we acquire lock in maybeSwitch, we&apos;re not dropped so we queue the flush and release the lock, Migration does the drop, then Memtable writes itself out.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12502323">CASSANDRA-2381</key>
            <summary>orphaned data files may be created during migration race</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10003" iconUrl="https://issues.apache.org/jira/images/icons/priorities/trivial.svg">Low</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="jbellis">Jonathan Ellis</assignee>
                                    <reporter username="jbellis">Jonathan Ellis</reporter>
                        <labels>
                    </labels>
                <created>Thu, 24 Mar 2011 20:55:56 +0000</created>
                <updated>Tue, 16 Apr 2019 09:33:03 +0000</updated>
                            <resolved>Mon, 28 Mar 2011 19:07:03 +0000</resolved>
                                        <fixVersion>0.7.5</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                                                                <comments>
                            <comment id="13010917" author="jbellis" created="Thu, 24 Mar 2011 20:59:29 +0000"  >&lt;p&gt;Patch against 0.8:&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;moves Table.flusherLock to Memtable.flushLock; acquire during memtable writing&lt;/li&gt;
	&lt;li&gt;replaces flushLock use in Table.maybeSwitchMemtables with a synchronized block&lt;/li&gt;
	&lt;li&gt;removes beforeApplyModel; snapshotting is moved into applyModel for drops and removed entirely for updates&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13012045" author="gdusbabek" created="Mon, 28 Mar 2011 13:21:41 +0000"  >&lt;p&gt;Is it necessary to make the MT lock static?  I do not think there would be a problem with concurrently flushing two memtables of different column families (the CL serialization is still preserved by the synchronization in CFS).&lt;/p&gt;</comment>
                            <comment id="13012068" author="jbellis" created="Mon, 28 Mar 2011 14:10:02 +0000"  >&lt;p&gt;You&apos;re right. v2 attached and rebased. Had to make lock/unlock responsibility of individual Migration classes since lock is no longer global.&lt;/p&gt;</comment>
                            <comment id="13012092" author="gdusbabek" created="Mon, 28 Mar 2011 14:54:06 +0000"  >&lt;p&gt;I&apos;m seeing unit test failures in CliTest and DefsTest with v2 applied (never ran them on v1).&lt;/p&gt;</comment>
                            <comment id="13012117" author="jbellis" created="Mon, 28 Mar 2011 16:01:38 +0000"  >&lt;p&gt;v3 grabs CF reference before removing it from CFMetadata map.  tests pass.&lt;/p&gt;</comment>
                            <comment id="13012154" author="gdusbabek" created="Mon, 28 Mar 2011 17:49:12 +0000"  >&lt;p&gt;+1.&lt;/p&gt;</comment>
                            <comment id="13012178" author="jbellis" created="Mon, 28 Mar 2011 19:07:03 +0000"  >&lt;p&gt;committed&lt;/p&gt;</comment>
                            <comment id="13012201" author="hudson" created="Mon, 28 Mar 2011 20:16:26 +0000"  >&lt;p&gt;Integrated in Cassandra-0.7 #411 (See &lt;a href=&quot;https://hudson.apache.org/hudson/job/Cassandra-0.7/411/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://hudson.apache.org/hudson/job/Cassandra-0.7/411/&lt;/a&gt;)&lt;br/&gt;
    r/m unnecessary isDropped check from maybeSwitchMemtable (the one in Memtable.writeSortedContents it the important one)&lt;br/&gt;
patch by jbellis for &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-2381&quot; title=&quot;orphaned data files may be created during migration race&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-2381&quot;&gt;&lt;del&gt;CASSANDRA-2381&lt;/del&gt;&lt;/a&gt;&lt;br/&gt;
add actual dropped check to Memtable.flush for &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-2381&quot; title=&quot;orphaned data files may be created during migration race&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-2381&quot;&gt;&lt;del&gt;CASSANDRA-2381&lt;/del&gt;&lt;/a&gt;&lt;br/&gt;
patch by jbellis&lt;br/&gt;
fix migration race vs flush&lt;br/&gt;
patch by jbellis; reviewed by gdusbabek for &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-2381&quot; title=&quot;orphaned data files may be created during migration race&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-2381&quot;&gt;&lt;del&gt;CASSANDRA-2381&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12474557" name="2381-0.8.txt" size="11013" author="jbellis" created="Thu, 24 Mar 2011 20:59:29 +0000"/>
                            <attachment id="12474782" name="2381-v3.txt" size="13222" author="jbellis" created="Mon, 28 Mar 2011 16:01:38 +0000"/>
                            <attachment id="12474778" name="2831-v2.txt" size="13265" author="jbellis" created="Mon, 28 Mar 2011 14:10:02 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[jbellis]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>20593</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            14 years, 35 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0gb1z:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>93221</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>gdusbabek</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[gdusbabek]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12961"><![CDATA[Low]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>