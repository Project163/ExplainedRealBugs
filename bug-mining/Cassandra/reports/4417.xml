<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 23:04:22 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-12223] SASI Indexes querying incorrectly return 0 rows</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-12223</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;I just started working with the SASI index on Cassandra 3.7.0 and I encountered a problem which as I suspected was a bug. I had hardly tracked down the situation in which the bug showed up, here is what I found:&lt;/p&gt;

&lt;p&gt;When querying with a SASI index, &lt;b&gt;it may incorrectly return 0 rows&lt;/b&gt;, and changing a little conditions, it works again, like the following CQL code:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-style: solid;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeHeader panelHeader&quot; style=&quot;border-bottom-width: 1px;border-bottom-style: solid;&quot;&gt;&lt;b&gt;CQL&lt;/b&gt;&lt;/div&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;    CREATE TABLE IF NOT EXISTS roles (
        name text,
        a &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;,
        b &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;,
        PRIMARY KEY ((name, a), b)
    ) WITH CLUSTERING ORDER BY (b DESC);
    
    insert into roles (name,a,b) values (&lt;span class=&quot;code-quote&quot;&gt;&apos;Joe&apos;&lt;/span&gt;,1,1);
    insert into roles (name,a,b) values (&lt;span class=&quot;code-quote&quot;&gt;&apos;Joe&apos;&lt;/span&gt;,2,2);
    insert into roles (name,a,b) values (&lt;span class=&quot;code-quote&quot;&gt;&apos;Joe&apos;&lt;/span&gt;,3,3);
    insert into roles (name,a,b) values (&lt;span class=&quot;code-quote&quot;&gt;&apos;Joe&apos;&lt;/span&gt;,4,4);

    CREATE TABLE IF NOT EXISTS roles2 (
        name text,
        a &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;,
        b &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;,
        PRIMARY KEY ((name, a), b)
    ) WITH CLUSTERING ORDER BY (b ASC);
    
    insert into roles2 (name,a,b) values (&lt;span class=&quot;code-quote&quot;&gt;&apos;Joe&apos;&lt;/span&gt;,1,1);
    insert into roles2 (name,a,b) values (&lt;span class=&quot;code-quote&quot;&gt;&apos;Joe&apos;&lt;/span&gt;,2,2);
    insert into roles2 (name,a,b) values (&lt;span class=&quot;code-quote&quot;&gt;&apos;Joe&apos;&lt;/span&gt;,3,3);
    insert into roles2 (name,a,b) values (&lt;span class=&quot;code-quote&quot;&gt;&apos;Joe&apos;&lt;/span&gt;,4,4);

    CREATE CUSTOM INDEX ON roles (b) USING &lt;span class=&quot;code-quote&quot;&gt;&apos;org.apache.cassandra.index.sasi.SASIIndex&apos;&lt;/span&gt; 
    WITH OPTIONS = { &lt;span class=&quot;code-quote&quot;&gt;&apos;mode&apos;&lt;/span&gt;: &lt;span class=&quot;code-quote&quot;&gt;&apos;SPARSE&apos;&lt;/span&gt; };
    CREATE CUSTOM INDEX ON roles2 (b) USING &lt;span class=&quot;code-quote&quot;&gt;&apos;org.apache.cassandra.index.sasi.SASIIndex&apos;&lt;/span&gt; 
    WITH OPTIONS = { &lt;span class=&quot;code-quote&quot;&gt;&apos;mode&apos;&lt;/span&gt;: &lt;span class=&quot;code-quote&quot;&gt;&apos;SPARSE&apos;&lt;/span&gt; };
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Noticing that I only change table &lt;b&gt;roles2&lt;/b&gt; from table &lt;b&gt;roles&lt;/b&gt;&apos;s &apos;&lt;b&gt;CLUSTERING ORDER BY (b DESC)&lt;/b&gt;&apos; into &apos;&lt;b&gt;CLUSTERING ORDER BY (b ASC)&lt;/b&gt;&apos;.&lt;/p&gt;

&lt;p&gt;When querying with statement &lt;ins&gt;select * from roles2 where b&amp;lt;3&lt;/ins&gt;, the rusult is two rows:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-style: solid;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeHeader panelHeader&quot; style=&quot;border-bottom-width: 1px;border-bottom-style: solid;&quot;&gt;&lt;b&gt;CQL&lt;/b&gt;&lt;/div&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;     name | a | b
    ------+---+---
      Joe | 1 | 1
      Joe | 2 | 2

    (2 rows)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;However, if querying with &lt;ins&gt;select * from roles where b&amp;lt;3&lt;/ins&gt;, it returned no rows at all:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-style: solid;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeHeader panelHeader&quot; style=&quot;border-bottom-width: 1px;border-bottom-style: solid;&quot;&gt;&lt;b&gt;CQL&lt;/b&gt;&lt;/div&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;     name | a | b
    ------+---+---

    (0 rows)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;This is not the only situation where the bug would show up, one time I created a SASI index with specific name like &apos;end_idx&apos; on column &apos;end&apos;, the bug showed up, when I didn&apos;t specify the index name, it gone.&lt;/p&gt;</description>
                <environment>&lt;p&gt;Windows, DataStax Distribution&lt;/p&gt;</environment>
        <key id="12990330">CASSANDRA-12223</key>
            <summary>SASI Indexes querying incorrectly return 0 rows</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10002" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Normal</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="ifesdjeen">Alex Petrov</assignee>
                                    <reporter username="qewryt132465">Qiu Zhida</reporter>
                        <labels>
                    </labels>
                <created>Mon, 18 Jul 2016 10:20:11 +0000</created>
                <updated>Tue, 16 Apr 2019 09:30:26 +0000</updated>
                            <resolved>Wed, 17 Aug 2016 21:41:39 +0000</resolved>
                                        <fixVersion>3.10</fixVersion>
                                    <component>Feature/SASI</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="15409484" author="ifesdjeen" created="Fri, 5 Aug 2016 14:04:09 +0000"  >&lt;p&gt;This bug is related to the fact that reversed column is never checked. Fix is quite trivial.&lt;/p&gt;

&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/ifesdjeen/cassandra/tree/12223-trunk&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;trunk&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://cassci.datastax.com/job/ifesdjeen-12223-trunk-dtest/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;dtest&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://cassci.datastax.com/job/ifesdjeen-12223-trunk-testall/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;testall&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;
</comment>
                            <comment id="15413082" author="ifesdjeen" created="Tue, 9 Aug 2016 07:13:54 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=xedin&quot; class=&quot;user-hover&quot; rel=&quot;xedin&quot;&gt;xedin&lt;/a&gt; would you be interested in reviewing this one as well? Was also fixed while debugging #11990.&lt;/p&gt;</comment>
                            <comment id="15413142" author="xedin" created="Tue, 9 Aug 2016 07:48:48 +0000"  >&lt;p&gt;Sure, I&apos;m always happy to help.&lt;/p&gt;</comment>
                            <comment id="15425438" author="xedin" created="Wed, 17 Aug 2016 21:41:39 +0000"  >&lt;p&gt;Committed. Thanks, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ifesdjeen&quot; class=&quot;user-hover&quot; rel=&quot;ifesdjeen&quot;&gt;ifesdjeen&lt;/a&gt;!&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[ifesdjeen]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 13 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i314jj:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>xedin</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[xedin]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12962"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>