<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 22:41:36 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-6370] Updating cql created table through cassandra-cli transform it into a compact storage table</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-6370</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;To reproduce :&lt;/p&gt;

&lt;p&gt;echo &quot;CREATE TABLE test (aid int, period text, event text, viewer text, PRIMARY KEY (aid, period, event, viewer) );&quot; | cqlsh -kmykeyspace;&lt;/p&gt;

&lt;p&gt;echo &quot;describe table test;&quot; | cqlsh -kmykeyspace;&lt;/p&gt;

&lt;p&gt;Output &amp;gt;&lt;br/&gt;
CREATE TABLE test (&lt;br/&gt;
  aid int,&lt;br/&gt;
  period text,&lt;br/&gt;
  event text,&lt;br/&gt;
  viewer text,&lt;br/&gt;
  PRIMARY KEY (aid, period, event, viewer)&lt;br/&gt;
) WITH&lt;br/&gt;
  bloom_filter_fp_chance=0.010000 AND&lt;br/&gt;
  caching=&apos;KEYS_ONLY&apos; AND&lt;br/&gt;
  comment=&apos;&apos; AND&lt;br/&gt;
  dclocal_read_repair_chance=0.000000 AND&lt;br/&gt;
  gc_grace_seconds=864000 AND&lt;br/&gt;
  read_repair_chance=0.100000 AND&lt;br/&gt;
  replicate_on_write=&apos;true&apos; AND&lt;br/&gt;
  populate_io_cache_on_flush=&apos;false&apos; AND&lt;br/&gt;
  compaction=&lt;/p&gt;
{&apos;class&apos;: &apos;SizeTieredCompactionStrategy&apos;}
&lt;p&gt; AND&lt;br/&gt;
  compression=&lt;/p&gt;
{&apos;sstable_compression&apos;: &apos;SnappyCompressor&apos;}
&lt;p&gt;;&lt;/p&gt;

&lt;p&gt;Then do :&lt;/p&gt;

&lt;p&gt;echo &quot;update column family test with dclocal_read_repair_chance = 0.1;&quot; | cassandra-cli -kmykeyspace&lt;/p&gt;

&lt;p&gt;And finally again : echo &quot;describe table test;&quot; | cqlsh -kmykeyspace;&lt;/p&gt;

&lt;p&gt;Output &amp;gt;&lt;/p&gt;

&lt;p&gt;CREATE TABLE test (&lt;br/&gt;
  aid int,&lt;br/&gt;
  column1 text,&lt;br/&gt;
  column2 text,&lt;br/&gt;
  column3 text,&lt;br/&gt;
  column4 text,&lt;br/&gt;
  value blob,&lt;br/&gt;
  PRIMARY KEY (aid, column1, column2, column3, column4)&lt;br/&gt;
) WITH COMPACT STORAGE AND&lt;br/&gt;
  bloom_filter_fp_chance=0.010000 AND&lt;br/&gt;
  caching=&apos;KEYS_ONLY&apos; AND&lt;br/&gt;
  comment=&apos;&apos; AND&lt;br/&gt;
  dclocal_read_repair_chance=0.100000 AND&lt;br/&gt;
  gc_grace_seconds=864000 AND&lt;br/&gt;
  read_repair_chance=0.100000 AND&lt;br/&gt;
  replicate_on_write=&apos;true&apos; AND&lt;br/&gt;
  populate_io_cache_on_flush=&apos;false&apos; AND&lt;br/&gt;
  compaction=&lt;/p&gt;
{&apos;class&apos;: &apos;SizeTieredCompactionStrategy&apos;}
&lt;p&gt; AND&lt;br/&gt;
  compression=&lt;/p&gt;
{&apos;sstable_compression&apos;: &apos;SnappyCompressor&apos;}
&lt;p&gt;;&lt;/p&gt;

&lt;p&gt;This is quite annoying in production. If it is happening to you: &lt;br/&gt;
UPDATE system.schema_columnfamilies SET column_aliases = &apos;&lt;span class=&quot;error&quot;&gt;&amp;#91;&amp;quot;period&amp;quot;,&amp;quot;event&amp;quot;,&amp;quot;viewer&amp;quot;&amp;#93;&lt;/span&gt;&apos; WHERE keyspace_name=&apos;mykeyspace&apos; AND columnfamily_name=&apos;test&apos;; should help restoring the table. (Thanks Sylvain for this information.)&lt;/p&gt;</description>
                <environment></environment>
        <key id="12679734">CASSANDRA-6370</key>
            <summary>Updating cql created table through cassandra-cli transform it into a compact storage table</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10000" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Urgent</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="slebresne">Sylvain Lebresne</assignee>
                                    <reporter username="arodrime">Alain RODRIGUEZ</reporter>
                        <labels>
                    </labels>
                <created>Mon, 18 Nov 2013 14:23:00 +0000</created>
                <updated>Tue, 16 Apr 2019 09:31:59 +0000</updated>
                            <resolved>Mon, 18 Nov 2013 16:46:33 +0000</resolved>
                                        <fixVersion>1.2.12</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="13825356" author="jbellis" created="Mon, 18 Nov 2013 14:41:39 +0000"  >&lt;p&gt;Why do you think cli does not list cql-created tables?&lt;/p&gt;</comment>
                            <comment id="13825390" author="slebresne" created="Mon, 18 Nov 2013 15:13:32 +0000"  >&lt;p&gt;I&apos;m going to reopen because while I agree that you should absolutely stick to cqlsh when dealing with CQL3 tables, I think it doesn&apos;t cost us much to either make sure it&apos;s not too easy to shoot yourself in the foot or at least disallow modifications of CQL3 table from thrift if that screw them up (especially since it&apos;s pretty damn hard to get back on your feet afterwards unless you&apos;re very familiar with the schema code).&lt;/p&gt;</comment>
                            <comment id="13825392" author="devdazed" created="Mon, 18 Nov 2013 15:15:53 +0000"  >&lt;p&gt;I tend to agree. If there is any unexpected behavior that could arise then it should be prevented from happening, a big warning like &quot;THIS WILL ALTER YOUR TABLE WITH COMPACT STORAGE ... Continue Y/N?&quot;, so the user is aware of what is happening.  Simply saying &quot;it&apos;s hidden when you list it&quot; is not a solution IMO.&lt;/p&gt;</comment>
                            <comment id="13825405" author="arodrime" created="Mon, 18 Nov 2013 15:37:42 +0000"  >&lt;p&gt;I didn&apos;t try to list any table here.&lt;/p&gt;

&lt;p&gt;I heard was thrift / cql were abstractions of the same data and that we could continuing to use both. I thought cassandra-cli was also compatible with cql tables. Even more, I had no error or warning while running my cassandra-cli command.&lt;/p&gt;

&lt;p&gt;In my point of view (which was wrong at this time, I agree now) this was a &quot;normal&quot; usage of cassandra that resulted into a bug in my productions servers. My error is now fixed as you can read at the end of the description. My point here is to help the Cassandra team to make Cassandra more robust to avoid more issues of this kind.&lt;/p&gt;

&lt;p&gt;Do whatever you want with this report, but there is no need of bashing me, this wasn&apos;t trivial, and the fact you hide the cql-created tables doesn&apos;t help in any way since I didn&apos;t list them. &lt;/p&gt;

&lt;p&gt;This happen to me for being an early Cassandra adopter who use to change the schema using cassandra-cli.&lt;/p&gt;</comment>
                            <comment id="13825406" author="slebresne" created="Mon, 18 Nov 2013 15:42:06 +0000"  >&lt;p&gt;Let&apos;s keep it simple, attaching a patch that just refuse modifications to CQL3 tables from thrift. We don&apos;t allow to create them or list them so there&apos;s no good reason to allow modifying them and that way we make sure to avoid subtle screw-ups. And if you really want to shoot yourself in the foot by messing up with the underlying schema layout, that&apos;s what the System tables are for.&lt;/p&gt;</comment>
                            <comment id="13825412" author="jbellis" created="Mon, 18 Nov 2013 15:53:13 +0000"  >&lt;p&gt;+1&lt;/p&gt;</comment>
                            <comment id="13825448" author="iamaleksey" created="Mon, 18 Nov 2013 16:32:38 +0000"  >&lt;p&gt;Edit: d-oh.&lt;/p&gt;</comment>
                            <comment id="13825463" author="slebresne" created="Mon, 18 Nov 2013 16:46:33 +0000"  >&lt;p&gt;Committed, thanks&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12614406" name="6370.txt" size="1182" author="slebresne" created="Mon, 18 Nov 2013 15:42:06 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[slebresne]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>359092</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            12 years, 1 week, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1pwhj:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>359382</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12311421" key="com.atlassian.jira.plugin.system.customfieldtypes:multiversion">
                        <customfieldname>Reproduced In</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="12325022">1.2.11</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>jbellis</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[jbellis]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12963"><![CDATA[Critical]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12311420" key="com.atlassian.jira.plugin.system.customfieldtypes:version">
                        <customfieldname>Since Version</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="12323924">1.2.2</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>