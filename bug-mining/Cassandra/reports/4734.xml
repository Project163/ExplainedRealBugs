<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 23:07:20 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-13407] test failure at RemoveTest.testBadHostId</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-13407</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;Example trace:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;java.lang.NullPointerException
	at org.apache.cassandra.gms.Gossiper.getHostId(Gossiper.java:881)
	at org.apache.cassandra.gms.Gossiper.getHostId(Gossiper.java:876)
	at org.apache.cassandra.service.StorageService.handleStateNormal(StorageService.java:2201)
	at org.apache.cassandra.service.StorageService.onChange(StorageService.java:1855)
	at org.apache.cassandra.Util.createInitialRing(Util.java:216)
	at org.apache.cassandra.service.RemoveTest.setup(RemoveTest.java:89)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt; 

&lt;p&gt;&lt;a href=&quot;https://cassci.datastax.com/job/trunk_testall/1491/testReport/org.apache.cassandra.service/RemoveTest/testBadHostId/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;failure example&lt;/a&gt;&lt;br/&gt;
&lt;a href=&quot;https://cassci.datastax.com/job/trunk_testall/lastCompletedBuild/testReport/org.apache.cassandra.service/RemoveTest/testBadHostId/history/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;history&lt;/a&gt;&lt;/p&gt;</description>
                <environment></environment>
        <key id="13061357">CASSANDRA-13407</key>
            <summary>test failure at RemoveTest.testBadHostId</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10002" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Normal</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="ifesdjeen">Alex Petrov</assignee>
                                    <reporter username="ifesdjeen">Alex Petrov</reporter>
                        <labels>
                    </labels>
                <created>Tue, 4 Apr 2017 07:27:40 +0000</created>
                <updated>Tue, 16 Apr 2019 09:30:06 +0000</updated>
                            <resolved>Thu, 20 Apr 2017 09:54:17 +0000</resolved>
                                                            <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="15958915" author="ifesdjeen" created="Thu, 6 Apr 2017 13:21:10 +0000"  >&lt;p&gt;It seems that the problem was in the fact that we are staring &lt;tt&gt;Gossiper&lt;/tt&gt;:&lt;/p&gt;

&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/apache/cassandra/compare/trunk...ifesdjeen:13407-trunk&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;patch&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://cassci.datastax.com/view/Dev/view/ifesdjeen/job/ifesdjeen-13407-trunk-testall/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;utest&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;


&lt;p&gt;(utests were running ~25 times without this failure occuring, multiplexing a single test didn&apos;t help reproducing it with a patch either).&lt;/p&gt;</comment>
                            <comment id="15959301" author="jkni" created="Thu, 6 Apr 2017 17:01:05 +0000"  >&lt;p&gt;For posterity, this is the race possible when the Gossiper is started, as far as I can tell.&lt;/p&gt;

&lt;p&gt;In setup, we initialize a fake ring using Util.createInitialRing. This will intialize the nodes in an unsafe manner and then inject the token states. If a status check runs before the tokens state is set, the previously decommissioned node will look like a fat client, since it won&apos;t have tokens and will not have a DEAD_STATE. Since we aren&apos;t gossiping, we won&apos;t have heard from it in greater than fatClientTimeout, so we&apos;ll remove it. If this races with the ss.onChange in createInitialRing, we can remove the endpointstate while processing it, which will cause a NPE as above.&lt;/p&gt;

&lt;p&gt;We also need to remove SchemaLoader.loadSchema() as you did in the patch - this is because it starts the Gossiper as well. This is fine; we don&apos;t appear to need it.&lt;/p&gt;

&lt;p&gt;The patch looks good - the race exists in theory on 2.1/2.2, but it appears to only manifest on 3.0+. I don&apos;t think it is worth committing to 2.1 for that reason - let&apos;s do 2.2+ forward and run the test at least once on each branch before committing.&lt;/p&gt;
</comment>
                            <comment id="15960470" author="ifesdjeen" created="Fri, 7 Apr 2017 08:23:19 +0000"  >&lt;p&gt;Looks like I was able to gather a bit more information on the issue. To confirm what you&apos;re saying. It is possible to reproduce locally by tweaking timeouts (particularly making the gossip interval shorter, to emulate the slow VM). &lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;INFO  [GossipTasks:1] 2017-04-03 23:05:53,433 Gossiper.java:810 - FatClient /127.0.0.4 has been silent &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; 1000ms, removing from gossip
DEBUG [GossipTasks:1] 2017-04-03 23:05:53,436 Gossiper.java:432 - removing endpoint /127.0.0.4
DEBUG [GossipTasks:1] 2017-04-03 23:05:53,436 Gossiper.java:407 - evicting /127.0.0.4 from gossip
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;After that we can get an NPE either in &lt;tt&gt;Gossiper#getHostId&lt;/tt&gt; or &lt;tt&gt;StorageService#isStatus&lt;/tt&gt;. &lt;/p&gt;

&lt;p&gt;The patch for 2.0 and 3.0 is slightly different, as if we do not initialise schema, we&apos;ll get the following error: &lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;    [junit] junit.framework.AssertionFailedError: []
    [junit]     at org.apache.cassandra.db.lifecycle.Tracker.getMemtableFor(Tracker.java:312)
    [junit]     at org.apache.cassandra.db.ColumnFamilyStore.apply(ColumnFamilyStore.java:1185)
    [junit]     at org.apache.cassandra.db.Keyspace.applyInternal(Keyspace.java:573)
    [junit]     at org.apache.cassandra.db.Keyspace.apply(Keyspace.java:421)
    [junit]     at org.apache.cassandra.db.Mutation.apply(Mutation.java:210)
    [junit]     at org.apache.cassandra.db.Mutation.apply(Mutation.java:215)
    [junit]     at org.apache.cassandra.db.Mutation.apply(Mutation.java:224)
    [junit]     at org.apache.cassandra.cql3.statements.ModificationStatement.executeInternalWithoutCondition(ModificationStatement.java:566)
    [junit]     at org.apache.cassandra.cql3.statements.ModificationStatement.executeInternal(ModificationStatement.java:556)
    [junit]     at org.apache.cassandra.cql3.QueryProcessor.executeInternal(QueryProcessor.java:295)
    [junit]     at org.apache.cassandra.db.SystemKeyspace.updatePeerInfo(SystemKeyspace.java:712)
    [junit]     at org.apache.cassandra.service.StorageService.updatePeerInfo(StorageService.java:1801)
    [junit]     at org.apache.cassandra.service.StorageService.handleStateNormal(StorageService.java:2014)
    [junit]     at org.apache.cassandra.service.StorageService.onChange(StorageService.java:1669)
    [junit]     at org.apache.cassandra.Util.createInitialRing(Util.java:213)
    [junit]     at org.apache.cassandra.service.RemoveTest.setup(RemoveTest.java:77)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/apache/cassandra/compare/2.2...ifesdjeen:13407-2.2&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;2.2&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/ifesdjeen/job/ifesdjeen-13407-2.2-testall/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;testall&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/apache/cassandra/compare/3.0...ifesdjeen:13407-3.0&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;3.0&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/ifesdjeen/job/ifesdjeen-13407-3.0-testall/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;testall&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/apache/cassandra/compare/3.11...ifesdjeen:13407-3.11&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;3.11&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/ifesdjeen/job/ifesdjeen-13407-3.11-testall/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;testall&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/apache/cassandra/compare/trunk...ifesdjeen:13407-trunk&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;trunk&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/ifesdjeen/job/ifesdjeen-13407-trunk-testall/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;testall&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;
</comment>
                            <comment id="15963226" author="jkni" created="Mon, 10 Apr 2017 17:27:27 +0000"  >&lt;p&gt;Patches look good - good catch on 2.2/3.0 difference.&lt;/p&gt;

&lt;p&gt;+1.&lt;/p&gt;</comment>
                            <comment id="15976401" author="ifesdjeen" created="Thu, 20 Apr 2017 09:53:45 +0000"  >&lt;p&gt;Committed to 2.2 as &lt;a href=&quot;https://github.com/apache/cassandra/commit/31590f5da10de8bbcf36d19617ced02b37be2a57&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;31590f5da10de8bbcf36d19617ced02b37be2a57&lt;/a&gt; and merged up to &lt;a href=&quot;https://github.com/apache/cassandra/commit/b063b38f33474cd0687167599a3a8cec7ed82631&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;3.0&lt;/a&gt;, &lt;a href=&quot;https://github.com/apache/cassandra/commit/638df6f971b806460113031524e14b21ae3e20f8&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;3.11&lt;/a&gt; and &lt;a href=&quot;https://github.com/apache/cassandra/commit/90e50789680c8d386a57884a0d58ee62e5f4e73d&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;trunk&lt;/a&gt;.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                                                <inwardlinks description="is duplicated by">
                                        <issuelink>
            <issuekey id="13014235">CASSANDRA-12821</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[ifesdjeen]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 30 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3d67j:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>jkni</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[jkni]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12962"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>