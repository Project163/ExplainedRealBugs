<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 23:11:41 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-11960] Hints are not seekable</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-11960</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;Got the following error message on trunk. No idea how to reproduce. But the only thing the (not overridden) seek method does is throwing this exception.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;ERROR [HintsDispatcher:2] 2016-06-05 18:51:09,397 CassandraDaemon.java:222 - Exception in thread &lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;[HintsDispatcher:2,1,main]
java.lang.UnsupportedOperationException: Hints are not seekable.
	at org.apache.cassandra.hints.HintsReader.seek(HintsReader.java:114) ~[main/:na]
	at org.apache.cassandra.hints.HintsDispatcher.seek(HintsDispatcher.java:79) ~[main/:na]
	at org.apache.cassandra.hints.HintsDispatchExecutor$DispatchHintsTask.deliver(HintsDispatchExecutor.java:257) ~[main/:na]
	at org.apache.cassandra.hints.HintsDispatchExecutor$DispatchHintsTask.dispatch(HintsDispatchExecutor.java:242) ~[main/:na]
	at org.apache.cassandra.hints.HintsDispatchExecutor$DispatchHintsTask.dispatch(HintsDispatchExecutor.java:220) ~[main/:na]
	at org.apache.cassandra.hints.HintsDispatchExecutor$DispatchHintsTask.run(HintsDispatchExecutor.java:199) ~[main/:na]
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511) ~[na:1.8.0_91]
	at java.util.concurrent.FutureTask.run(FutureTask.java:266) ~[na:1.8.0_91]
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1142) ~[na:1.8.0_91]
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:617) [na:1.8.0_91]
	at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:745) [na:1.8.0_91]
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="12975828">CASSANDRA-11960</key>
            <summary>Hints are not seekable</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10002" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Normal</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="spod">Stefan Podkowinski</assignee>
                                    <reporter username="snazy">Robert Stupp</reporter>
                        <labels>
                    </labels>
                <created>Sun, 5 Jun 2016 19:00:08 +0000</created>
                <updated>Tue, 16 Apr 2019 09:30:30 +0000</updated>
                            <resolved>Mon, 8 Aug 2016 12:58:01 +0000</resolved>
                                        <fixVersion>3.10</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="15318414" author="spodxx@gmail.com" created="Tue, 7 Jun 2016 12:52:03 +0000"  >&lt;p&gt;This looks like this was caused by &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-5863&quot; title=&quot;In process (uncompressed) page cache&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-5863&quot;&gt;&lt;del&gt;CASSANDRA-5863&lt;/del&gt;&lt;/a&gt;, where the &lt;tt&gt;RandomAccessReader&lt;/tt&gt; based input has been replaced with &lt;tt&gt;RebufferingInputStream&lt;/tt&gt;. &lt;/p&gt;

&lt;p&gt;The way I understand how hint dispatching is currently implemented is that we deliver hints from a file by sending individual &lt;tt&gt;HintsReader.Page&lt;/tt&gt; s until finished. In cases of any error while transmitting a page, &lt;tt&gt;HintsStore.markDispatchOffset&lt;/tt&gt; will be used to remember from where to resume delivering hints by using a long offset. Since the byte offset based seek isn&apos;t supported anymore due to mentioned changes, the exception is thrown.&lt;/p&gt;</comment>
                            <comment id="15333995" author="spodxx@gmail.com" created="Thu, 16 Jun 2016 15:30:01 +0000"  >&lt;p&gt;I&apos;ve now created a patch that would move away from file offset based retries and instead replays the whole page. As describe above, the &lt;tt&gt;RebufferingInputStream&lt;/tt&gt; data input doesn&apos;t provide a way to seek an offset. Although this should be possible to implement, I think these changes should be considered more carefully, as they have to be done in the common io.utils code. Maybe we should open a different ticket for that?&lt;/p&gt;

&lt;p&gt;Although replaying a complete page isn&apos;t optimal, as we&apos;ll deliver duplicate hints, we don&apos;t guarantee at-most-once semantics for hints anyway. This is not so great for non-idempotent operations, such as list appends (counters are not hinted), but the current implementation is clearly broken so we have to do something about it. But I&apos;m open to ideas how to further optimize this.&lt;/p&gt;
</comment>
                            <comment id="15339665" author="blambov" created="Mon, 20 Jun 2016 15:06:01 +0000"  >&lt;p&gt;Is it possible to save both the file offset (from &lt;tt&gt;getSourcePosition&lt;/tt&gt;) as well as the buffer offset? This would let us resume from exactly where we stopped, wouldn&apos;t it?&lt;/p&gt;

&lt;p&gt;I believe the reason I removed the seeking was because I saw it can&apos;t work correctly for compressed files (as we store uncompressed offset but don&apos;t have a way to map it to compressed chunk and offset), and after that I wasn&apos;t very thorough in checking that it&apos;s not actually used.&lt;/p&gt;</comment>
                            <comment id="15344161" author="spodxx@gmail.com" created="Wed, 22 Jun 2016 11:45:54 +0000"  >&lt;p&gt;I just noticed that &lt;tt&gt;HintsReader.PagesIterator&lt;/tt&gt; will create pages based on the current position in the data input. My approach assumed that we could just skip pages from the iterator to resume dispatching hints from the last send page. But this won&apos;t work as long as you are not actually consuming the pages and you&apos;ll always get the first hint as long as you don&apos;t move the input ahead. So I&apos;m wondering if the whole approach really makes sense or if we need to bite the bullet and make the reader seekable, if thats possible.&lt;/p&gt;</comment>
                            <comment id="15351862" author="kishkaru" created="Mon, 27 Jun 2016 21:31:20 +0000"  >&lt;p&gt;I just reproduced this in C* 3.6 during a run of the Ruby driver duration test. I had 3 occurrences and the stacktrace is the same.&lt;/p&gt;</comment>
                            <comment id="15399102" author="blambov" created="Fri, 29 Jul 2016 10:29:41 +0000"  >&lt;p&gt;I pushed an update to your branch &lt;a href=&quot;https://github.com/blambov/cassandra/tree/spodkowinski/WIP-11960&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;here&lt;/a&gt; which replaces the single &lt;tt&gt;long&lt;/tt&gt; position we stored with a mark object that includes compressed and uncompressed positions and can be used to seek quickly and accurately. This should be able to solve the problem for all hint file variations (plain, compressed, encrypted); we must test all of them though.&lt;/p&gt;

&lt;p&gt;I tried to go back to the old code in &lt;tt&gt;HintsDispatcher&lt;/tt&gt; but had to turn off &lt;tt&gt;RETRY&lt;/tt&gt; to make the tests work. I must admit I haven&apos;t yet looked closely at all the changes you made and don&apos;t understand why this should be necessary.&lt;/p&gt;</comment>
                            <comment id="15407626" author="spodxx@gmail.com" created="Thu, 4 Aug 2016 12:03:04 +0000"  >&lt;p&gt;Thanks for your changes on the DataInput implementations, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=barnie&quot; class=&quot;user-hover&quot; rel=&quot;barnie&quot;&gt;barnie&lt;/a&gt;! LGTM.&lt;br/&gt;
I&apos;ve now rebased and cleaned up my &lt;a href=&quot;https://github.com/spodkowinski/cassandra/commits/WIP-11960&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;WIP&lt;/a&gt; branch and added the two commits of yours. I&apos;ve also changed the base &lt;tt&gt;AlteredHints&lt;/tt&gt; class for &lt;tt&gt;HintsCompressionTest&lt;/tt&gt; and &lt;tt&gt;HintsEncryptionTest&lt;/tt&gt; to also compare hints after explicitly seeking to individual pages, which seems like the easiest way to me to test the added seek implementation. I had to add two fixes to make this work, as the crc position had to be reset as well on seek and I also had to revert the isEOF changes. Now both hint tests pass on my machine.&lt;/p&gt;
</comment>
                            <comment id="15407657" author="blambov" created="Thu, 4 Aug 2016 12:29:47 +0000"  >&lt;p&gt;The code looks good to me too.&lt;/p&gt;

&lt;p&gt;Could you squash, rebase on the latest code and run the unit and dtests?&lt;/p&gt;</comment>
                            <comment id="15407710" author="spodxx@gmail.com" created="Thu, 4 Aug 2016 13:05:07 +0000"  >&lt;p&gt;Squashed patch has been added to ticket as &lt;tt&gt;11960-trunk.patch&lt;/tt&gt;.&lt;/p&gt;

&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;trunk&lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/spodkowinski/cassandra/tree/CASSANDRA-11960-trunk&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;branch&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/spodkowinski/job/spodkowinski-CASSANDRA-11960-trunk-dtest/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;dtest&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/spodkowinski/job/spodkowinski-CASSANDRA-11960-trunk-testall/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;testall&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;
</comment>
                            <comment id="15409978" author="spodxx@gmail.com" created="Fri, 5 Aug 2016 19:58:29 +0000"  >&lt;p&gt;I had to do some minor fixes to make the tests pass, see &lt;a href=&quot;https://github.com/spodkowinski/cassandra/commits/WIP-11960&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;WIP&lt;/a&gt; branch. Results look fine now and you can find the latest patch attached if you want to continue review, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=blambov&quot; class=&quot;user-hover&quot; rel=&quot;blambov&quot;&gt;blambov&lt;/a&gt;. &lt;/p&gt;</comment>
                            <comment id="15411432" author="blambov" created="Mon, 8 Aug 2016 07:26:01 +0000"  >&lt;p&gt;LGTM&lt;/p&gt;</comment>
                            <comment id="15411770" author="iamaleksey" created="Mon, 8 Aug 2016 12:57:40 +0000"  >&lt;p&gt;Committed as &lt;a href=&quot;https://github.com/apache/cassandra/commit/cee22ad54d7c28aaf0868dd45aeb9b5b708b0e78&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;cee22ad54d7c28aaf0868dd45aeb9b5b708b0e78&lt;/a&gt; to trunk, thanks.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310060">
                    <name>Container</name>
                                            <outwardlinks description="contains">
                                        <issuelink>
            <issuekey id="12983818">CASSANDRA-12095</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                            <issuelinktype id="12310050">
                    <name>Regression</name>
                                                                <inwardlinks description="is broken by">
                                        <issuelink>
            <issuekey id="12662653">CASSANDRA-5863</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                            <issuelinktype id="10001">
                    <name>dependent</name>
                                            <outwardlinks description="depends upon">
                                        <issuelink>
            <issuekey id="12979835">CASSANDRA-12016</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12822315" name="11960-trunk.patch" size="45145" author="spod" created="Fri, 5 Aug 2016 15:27:23 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[spod]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 15 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2z04n:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>blambov</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[blambov]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12962"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>