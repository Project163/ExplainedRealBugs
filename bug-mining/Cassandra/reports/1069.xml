<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 22:22:27 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-3057] secondary index on a column that has a value of size &gt; 64k will fail on flush</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-3057</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;exception seen on flush when an indexed column contain size &amp;gt; 64k:&lt;/p&gt;

&lt;p&gt;granted that having a value &amp;gt; 64k possibly mean something that shouldn&apos;t be indexed as it most likely would have a high cardinality, but i think there would still be some valid use case for it.&lt;/p&gt;

&lt;p&gt;test case:&lt;br/&gt;
simply run the stress test with &lt;br/&gt;
-n 1 -u 0 -c 2  -y Standard  -o INSERT  -S 65536 -x KEYS&lt;/p&gt;

&lt;p&gt;then call a flush&lt;/p&gt;

&lt;p&gt;exception:&lt;br/&gt;
 INFO &lt;span class=&quot;error&quot;&gt;&amp;#91;FlushWriter:8&amp;#93;&lt;/span&gt; 2011-08-18 21:49:33,214 Memtable.java (line 218) Writing Memtable-Standard1.Idx1@1652462853(16/20 serialized/live bytes, 1 ops)&lt;br/&gt;
Standard1@980087547(196659/245823 serialized/live bytes, 3 ops)&lt;br/&gt;
ERROR &lt;span class=&quot;error&quot;&gt;&amp;#91;FlushWriter:8&amp;#93;&lt;/span&gt; 2011-08-18 21:49:33,230 AbstractCassandraDaemon.java (line 133) Fatal exception in thread Thread&lt;span class=&quot;error&quot;&gt;&amp;#91;FlushWriter:8,5,RMI Runtime&amp;#93;&lt;/span&gt;&lt;br/&gt;
java.lang.AssertionError: 65536&lt;br/&gt;
        at org.apache.cassandra.utils.ByteBufferUtil.writeWithShortLength(ByteBufferUtil.java:330)&lt;br/&gt;
        at org.apache.cassandra.io.sstable.SSTableWriter.append(SSTableWriter.java:164)&lt;br/&gt;
        at org.apache.cassandra.db.Memtable.writeSortedContents(Memtable.java:245)&lt;br/&gt;
        at org.apache.cassandra.db.Memtable.access$400(Memtable.java:49)&lt;br/&gt;
        at org.apache.cassandra.db.Memtable$3.runMayThrow(Memtable.java:270)&lt;br/&gt;
        at org.apache.cassandra.utils.WrappedRunnable.run(WrappedRunnable.java:30)&lt;br/&gt;
        at java.util.concurrent.ThreadPoolExecutor$Worker.runTask(ThreadPoolExecutor.java:886)&lt;br/&gt;
        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:908)&lt;br/&gt;
        at java.lang.Thread.run(Thread.java:662)&lt;/p&gt;
</description>
                <environment></environment>
        <key id="12519349">CASSANDRA-3057</key>
            <summary>secondary index on a column that has a value of size &gt; 64k will fail on flush</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10003" iconUrl="https://issues.apache.org/jira/images/icons/priorities/trivial.svg">Low</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="xedin">Pavel Yaskevich</assignee>
                                    <reporter username="cywjackson">Jackson Chung</reporter>
                        <labels>
                    </labels>
                <created>Thu, 18 Aug 2011 22:02:13 +0000</created>
                <updated>Tue, 16 Apr 2019 09:32:53 +0000</updated>
                            <resolved>Fri, 19 Aug 2011 01:54:41 +0000</resolved>
                                        <fixVersion>0.8.5</fixVersion>
                                    <component>Feature/2i Index</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                                                                <comments>
                            <comment id="13087333" author="jbellis" created="Thu, 18 Aug 2011 22:05:04 +0000"  >&lt;p&gt;Let&apos;s add a ThriftValidation check that values inserted into an indexed column are less than the &quot;short&quot; length.&lt;/p&gt;</comment>
                            <comment id="13087340" author="mdennis" created="Thu, 18 Aug 2011 22:12:12 +0000"  >&lt;p&gt;+1 on validation approach (rejecting indexed values &amp;gt; max column name size) + useful error message &quot;can&apos;t index column value of size A for index B in CF C of KS D&quot; instead of &quot;assertion spew&quot;&lt;/p&gt;

&lt;p&gt;for durability of previous conversations: the problem is the value in a column ends up as the name in a the index column family.  So, if you try to index a value that is greater than the max column name size it is not handled well.&lt;/p&gt;</comment>
                            <comment id="13087342" author="jbellis" created="Thu, 18 Aug 2011 22:15:30 +0000"  >&lt;p&gt;(technically, the value becomes a row key, which happens to have the same size limit as column names.)&lt;/p&gt;</comment>
                            <comment id="13087439" author="jbellis" created="Fri, 19 Aug 2011 00:53:40 +0000"  >&lt;p&gt;We&apos;re already looping through ColumnDefinitions for getValueValidator, let&apos;s extract a getColumnDefinition from that so we only do the search once.&lt;/p&gt;</comment>
                            <comment id="13087444" author="xedin" created="Fri, 19 Aug 2011 01:03:42 +0000"  >&lt;p&gt;Sorry, I missed metadata.getColumnDefinition(ByteBuffer) method that is why I did a loop, fixed now.&lt;/p&gt;</comment>
                            <comment id="13087447" author="jbellis" created="Fri, 19 Aug 2011 01:17:45 +0000"  >&lt;p&gt;v3 attached to only do the definition lookup once.&lt;/p&gt;</comment>
                            <comment id="13087450" author="xedin" created="Fri, 19 Aug 2011 01:24:46 +0000"  >&lt;p&gt;Misunderstood what you meant... +1&lt;/p&gt;</comment>
                            <comment id="13087455" author="jbellis" created="Fri, 19 Aug 2011 01:54:41 +0000"  >&lt;p&gt;committed&lt;/p&gt;</comment>
                            <comment id="13087462" author="hudson" created="Fri, 19 Aug 2011 02:25:19 +0000"  >&lt;p&gt;Integrated in Cassandra-0.8 #285 (See &lt;a href=&quot;https://builds.apache.org/job/Cassandra-0.8/285/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/Cassandra-0.8/285/&lt;/a&gt;)&lt;br/&gt;
    return an InvalidRequestException if an indexed column is assigned a value larger than 64K&lt;br/&gt;
patch by pyaskevich and jbellis for &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-3057&quot; title=&quot;secondary index on a column that has a value of size &amp;gt; 64k will fail on flush&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-3057&quot;&gt;&lt;del&gt;CASSANDRA-3057&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;jbellis : &lt;a href=&quot;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1159473&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1159473&lt;/a&gt;&lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/cassandra/branches/cassandra-0.8/test/unit/org/apache/cassandra/thrift/ThriftValidationTest.java&lt;/li&gt;
	&lt;li&gt;/cassandra/branches/cassandra-0.8/CHANGES.txt&lt;/li&gt;
	&lt;li&gt;/cassandra/branches/cassandra-0.8/src/java/org/apache/cassandra/thrift/ThriftValidation.java&lt;/li&gt;
	&lt;li&gt;/cassandra/branches/cassandra-0.8/src/java/org/apache/cassandra/config/CFMetaData.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                    </comments>
                    <attachments>
                            <attachment id="12490904" name="3057-v3.txt" size="5810" author="jbellis" created="Fri, 19 Aug 2011 01:17:45 +0000"/>
                            <attachment id="12490903" name="CASSANDRA-3057-v2.patch" size="4400" author="xedin" created="Fri, 19 Aug 2011 01:03:42 +0000"/>
                            <attachment id="12490889" name="CASSANDRA-3057.patch" size="4496" author="xedin" created="Thu, 18 Aug 2011 23:07:07 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[xedin]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>20953</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            14 years, 14 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0gf6n:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>93890</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>jbellis</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[jbellis]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12961"><![CDATA[Low]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>