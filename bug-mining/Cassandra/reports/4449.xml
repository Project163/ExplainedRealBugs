<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 23:04:43 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-12418] sstabledump JSON fails after row tombstone</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-12418</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;sstabledump fails in JSON generation on an sstable containing a row deletion, using Cassandra 3.10-SNAPSHOT accf7a4724e244d6f1ba921cb11d2554dbb54a76 from 2016-07-26.&lt;/p&gt;

&lt;p&gt;There are two exceptions displayed:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;Fatal error parsing partition: aye org.codehaus.jackson.JsonGenerationException: Can not start an object, expecting field name&lt;/li&gt;
	&lt;li&gt;org.codehaus.jackson.JsonGenerationException: Current context not an ARRAY but OBJECT&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Steps to reproduce:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;cqlsh&amp;gt; create KEYSPACE foo WITH replication = {&lt;span class=&quot;code-quote&quot;&gt;&apos;class&apos;&lt;/span&gt;: &lt;span class=&quot;code-quote&quot;&gt;&apos;SimpleStrategy&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;replication_factor&apos;&lt;/span&gt;: 1};
cqlsh&amp;gt; create TABLE foo.bar (id text, str text, primary key (id));
cqlsh&amp;gt; insert into foo.bar (id, str) values (&lt;span class=&quot;code-quote&quot;&gt;&apos;aye&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;alpha&apos;&lt;/span&gt;);
cqlsh&amp;gt; insert into foo.bar (id, str) values (&lt;span class=&quot;code-quote&quot;&gt;&apos;bee&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;beta&apos;&lt;/span&gt;);
cqlsh&amp;gt; delete from foo.bar where id = &lt;span class=&quot;code-quote&quot;&gt;&apos;bee&apos;&lt;/span&gt;;
cqlsh&amp;gt; insert into foo.bar (id, str) values (&lt;span class=&quot;code-quote&quot;&gt;&apos;bee&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;beth&apos;&lt;/span&gt;);
cqlsh&amp;gt; select * from foo.bar;

 id  | str
-----+-------
 bee |  beth
 aye | alpha

(2 rows)
cqlsh&amp;gt; 
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Now find the sstable:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;$ cassandra/bin/nodetool flush
$ cassandra/bin/sstableutil foo bar
[..]
Listing files...
[..]
/home/kw217/cassandra/data/data/foo/bar-407c56f05e1a11e6835def64bf5c656e/mb-1-big-Data.db
[..]
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Now check with sstabledump &amp;#45;d. This works just fine.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;$ cassandra/tools/bin/sstabledump -d /home/kw217/cassandra/data/data/foo/bar-407c56f05e1a11e6835def64bf5c656e/mb-1-big-Data.db
[bee]@0 deletedAt=1470737827008101, localDeletion=1470737827
[bee]@0 Row[info=[ts=1470737832405510] ]:  | [str=beth ts=1470737832405510]
[aye]@31 Row[info=[ts=1470737784401778] ]:  | [str=alpha ts=1470737784401778]
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Now run sstabledump. This should work as well, but it fails as follows:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;$ cassandra/tools/bin/sstabledump /home/kw217/cassandra/data/data/foo/bar-407c56f05e1a11e6835def64bf5c656e/mb-1-big-Data.db
ERROR 10:26:07 Fatal error parsing partition: aye
org.codehaus.jackson.JsonGenerationException: Can not start an object, expecting field name
	at org.codehaus.jackson.impl.JsonGeneratorBase._reportError(JsonGeneratorBase.java:480) ~[jackson-core-asl-1.9.2.jar:1.9.2]
	at org.codehaus.jackson.impl.WriterBasedGenerator._verifyValueWrite(WriterBasedGenerator.java:836) ~[jackson-core-asl-1.9.2.jar:1.9.2]
	at org.codehaus.jackson.impl.WriterBasedGenerator.writeStartObject(WriterBasedGenerator.java:273) ~[jackson-core-asl-1.9.2.jar:1.9.2]
	at org.apache.cassandra.tools.JsonTransformer.serializePartition(JsonTransformer.java:181) ~[main/:na]
	at java.util.stream.ForEachOps$ForEachOp$OfRef.accept(ForEachOps.java:184) ~[na:1.8.0_77]
	at java.util.stream.ReferencePipeline$2$1.accept(ReferencePipeline.java:175) ~[na:1.8.0_77]
	at java.util.Iterator.forEachRemaining(Iterator.java:116) ~[na:1.8.0_77]
	at java.util.Spliterators$IteratorSpliterator.forEachRemaining(Spliterators.java:1801) ~[na:1.8.0_77]
	at java.util.stream.AbstractPipeline.copyInto(AbstractPipeline.java:481) ~[na:1.8.0_77]
	at java.util.stream.AbstractPipeline.wrapAndCopyInto(AbstractPipeline.java:471) ~[na:1.8.0_77]
	at java.util.stream.ForEachOps$ForEachOp.evaluateSequential(ForEachOps.java:151) ~[na:1.8.0_77]
	at java.util.stream.ForEachOps$ForEachOp$OfRef.evaluateSequential(ForEachOps.java:174) ~[na:1.8.0_77]
	at java.util.stream.AbstractPipeline.evaluate(AbstractPipeline.java:234) ~[na:1.8.0_77]
	at java.util.stream.ReferencePipeline.forEach(ReferencePipeline.java:418) ~[na:1.8.0_77]
	at org.apache.cassandra.tools.JsonTransformer.toJson(JsonTransformer.java:99) ~[main/:na]
	at org.apache.cassandra.tools.SSTableExport.main(SSTableExport.java:237) ~[main/:na]
[
  {
    &lt;span class=&quot;code-quote&quot;&gt;&quot;partition&quot;&lt;/span&gt; : {
      &lt;span class=&quot;code-quote&quot;&gt;&quot;key&quot;&lt;/span&gt; : [ &lt;span class=&quot;code-quote&quot;&gt;&quot;bee&quot;&lt;/span&gt; ],
      &lt;span class=&quot;code-quote&quot;&gt;&quot;position&quot;&lt;/span&gt; : 0,
      &lt;span class=&quot;code-quote&quot;&gt;&quot;deletion_info&quot;&lt;/span&gt; : { &lt;span class=&quot;code-quote&quot;&gt;&quot;marked_deleted&quot;&lt;/span&gt; : &lt;span class=&quot;code-quote&quot;&gt;&quot;2016-08-09T10:17:07.008101Z&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;local_delete_time&quot;&lt;/span&gt; : &lt;span class=&quot;code-quote&quot;&gt;&quot;2016-08-09T10:17:07Z&quot;&lt;/span&gt; }
    }
  }
]org.codehaus.jackson.JsonGenerationException: Current context not an ARRAY but OBJECT
	at org.codehaus.jackson.impl.JsonGeneratorBase._reportError(JsonGeneratorBase.java:480)
	at org.codehaus.jackson.impl.WriterBasedGenerator.writeEndArray(WriterBasedGenerator.java:257)
	at org.apache.cassandra.tools.JsonTransformer.toJson(JsonTransformer.java:100)
	at org.apache.cassandra.tools.SSTableExport.main(SSTableExport.java:237)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;If possible, please can this be fixed in the 3.0.x stream as well as trunk?&lt;/p&gt;
</description>
                <environment></environment>
        <key id="12995908">CASSANDRA-12418</key>
            <summary>sstabledump JSON fails after row tombstone</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10002" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Normal</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="dbrosius">David Brosius</assignee>
                                    <reporter username="kw217">Keith Wansbrough</reporter>
                        <labels>
                    </labels>
                <created>Tue, 9 Aug 2016 10:32:48 +0000</created>
                <updated>Tue, 16 Apr 2019 09:30:23 +0000</updated>
                            <resolved>Sun, 4 Sep 2016 05:10:05 +0000</resolved>
                                        <fixVersion>3.0.9</fixVersion>
                    <fixVersion>3.11.1</fixVersion>
                                    <component>Legacy/Tools</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="15432610" author="kw217" created="Tue, 23 Aug 2016 10:53:41 +0000"  >&lt;p&gt;It looks to me like JsonTransformer#serializePartition needs to call json.writeEndObject() after serializeDeletion() around line 191. Before this point there are two json.writeStartObject() calls, but after it in this branch there is only one json.writeEndObject() (on line 221), whereas if there is no partition-level deletion there are two (on lines 195 and 221).&lt;/p&gt;</comment>
                            <comment id="15462280" author="dbrosius" created="Sun, 4 Sep 2016 05:10:05 +0000"  >&lt;p&gt;LGTM&lt;/p&gt;

&lt;p&gt;committed to cassandra-3.0 as fa14804543e9ed2cc781d9f8511ab7a5c22f8dd7&lt;/p&gt;</comment>
                            <comment id="15476734" author="kw217" created="Fri, 9 Sep 2016 10:22:50 +0000"  >&lt;p&gt;Thanks!&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[dbrosius]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 10 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i322yf:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12962"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>