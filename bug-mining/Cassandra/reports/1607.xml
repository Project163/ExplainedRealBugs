<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 22:32:34 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-4230] Deleting a CF always produces an error and that CF remains in an unknown state</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-4230</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;From the CLI perspective:&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;default@Disco&amp;#93;&lt;/span&gt; drop column family client; &lt;br/&gt;
null&lt;br/&gt;
org.apache.thrift.transport.TTransportException&lt;br/&gt;
	at org.apache.thrift.transport.TIOStreamTransport.read(TIOStreamTransport.java:132)&lt;br/&gt;
	at org.apache.thrift.transport.TTransport.readAll(TTransport.java:84)&lt;br/&gt;
	at org.apache.thrift.transport.TFramedTransport.readFrame(TFramedTransport.java:129)&lt;br/&gt;
	at org.apache.thrift.transport.TFramedTransport.read(TFramedTransport.java:101)&lt;br/&gt;
	at org.apache.thrift.transport.TTransport.readAll(TTransport.java:84)&lt;br/&gt;
	at org.apache.thrift.protocol.TBinaryProtocol.readAll(TBinaryProtocol.java:378)&lt;br/&gt;
	at org.apache.thrift.protocol.TBinaryProtocol.readI32(TBinaryProtocol.java:297)&lt;br/&gt;
	at org.apache.thrift.protocol.TBinaryProtocol.readMessageBegin(TBinaryProtocol.java:204)&lt;br/&gt;
	at org.apache.thrift.TServiceClient.receiveBase(TServiceClient.java:69)&lt;br/&gt;
	at org.apache.cassandra.thrift.Cassandra$Client.recv_system_drop_column_family(Cassandra.java:1222)&lt;br/&gt;
	at org.apache.cassandra.thrift.Cassandra$Client.system_drop_column_family(Cassandra.java:1209)&lt;br/&gt;
	at org.apache.cassandra.cli.CliClient.executeDelColumnFamily(CliClient.java:1301)&lt;br/&gt;
	at org.apache.cassandra.cli.CliClient.executeCLIStatement(CliClient.java:234)&lt;br/&gt;
	at org.apache.cassandra.cli.CliMain.processStatementInteractive(CliMain.java:219)&lt;br/&gt;
	at org.apache.cassandra.cli.CliMain.main(CliMain.java:346)&lt;/p&gt;

&lt;p&gt;Log:&lt;/p&gt;

&lt;p&gt; INFO &lt;span class=&quot;error&quot;&gt;&amp;#91;MigrationStage:1&amp;#93;&lt;/span&gt; 2012-05-09 11:25:35,686 ColumnFamilyStore.java (line 634) Enqueuing flush of Memtable-schema_columnfamilies@225225949(978/1222 serialized/live bytes, 21 ops)&lt;br/&gt;
 INFO &lt;span class=&quot;error&quot;&gt;&amp;#91;FlushWriter:3&amp;#93;&lt;/span&gt; 2012-05-09 11:25:35,687 Memtable.java (line 266) Writing Memtable-schema_columnfamilies@225225949(978/1222 serialized/live bytes, 21 ops)&lt;br/&gt;
 INFO &lt;span class=&quot;error&quot;&gt;&amp;#91;FlushWriter:3&amp;#93;&lt;/span&gt; 2012-05-09 11:25:35,748 Memtable.java (line 307) Completed flushing /var/lib/cassandra/data/system/schema_columnfamilies/system-schema_columnfamilies-hc-34-Data.db (1041 bytes)&lt;br/&gt;
 INFO &lt;span class=&quot;error&quot;&gt;&amp;#91;MigrationStage:1&amp;#93;&lt;/span&gt; 2012-05-09 11:25:35,749 ColumnFamilyStore.java (line 634) Enqueuing flush of Memtable-schema_columns@213209572(586/732 serialized/live bytes, 12 ops)&lt;br/&gt;
 INFO &lt;span class=&quot;error&quot;&gt;&amp;#91;FlushWriter:3&amp;#93;&lt;/span&gt; 2012-05-09 11:25:35,750 Memtable.java (line 266) Writing Memtable-schema_columns@213209572(586/732 serialized/live bytes, 12 ops)&lt;br/&gt;
 INFO &lt;span class=&quot;error&quot;&gt;&amp;#91;FlushWriter:3&amp;#93;&lt;/span&gt; 2012-05-09 11:25:35,812 Memtable.java (line 307) Completed flushing /var/lib/cassandra/data/system/schema_columns/system-schema_columns-hc-28-Data.db (649 bytes)&lt;br/&gt;
 INFO &lt;span class=&quot;error&quot;&gt;&amp;#91;CompactionExecutor:20&amp;#93;&lt;/span&gt; 2012-05-09 11:25:35,814 CompactionTask.java (line 114) Compacting [SSTableReader(path=&apos;/var/lib/cassandra/data/system/schema_columns/system-schema_columns-hc-27-Data.db&apos;), SSTableReader&lt;br/&gt;
(path=&apos;/var/lib/cassandra/data/system/schema_columns/system-schema_columns-hc-25-Data.db&apos;), SSTableReader(path=&apos;/var/lib/cassandra/data/system/schema_columns/system-schema_columns-hc-26-Data.db&apos;), SSTableReader(path&lt;br/&gt;
=&apos;/var/lib/cassandra/data/system/schema_columns/system-schema_columns-hc-28-Data.db&apos;)]&lt;br/&gt;
 INFO &lt;span class=&quot;error&quot;&gt;&amp;#91;MigrationStage:1&amp;#93;&lt;/span&gt; 2012-05-09 11:25:35,918 ColumnFamilyStore.java (line 634) Enqueuing flush of Memtable-Client@864320066(372/465 serialized/live bytes, 6 ops)&lt;br/&gt;
 INFO &lt;span class=&quot;error&quot;&gt;&amp;#91;FlushWriter:3&amp;#93;&lt;/span&gt; 2012-05-09 11:25:35,919 Memtable.java (line 266) Writing Memtable-Client@864320066(372/465 serialized/live bytes, 6 ops)&lt;br/&gt;
 INFO &lt;span class=&quot;error&quot;&gt;&amp;#91;CompactionExecutor:20&amp;#93;&lt;/span&gt; 2012-05-09 11:25:35,945 CompactionTask.java (line 225) Compacted to &lt;span class=&quot;error&quot;&gt;&amp;#91;/var/lib/cassandra/data/system/schema_columns/system-schema_columns-hc-29-Data.db,&amp;#93;&lt;/span&gt;.  22,486 to 20,621 (~91% of orig&lt;br/&gt;
inal) bytes for 2 keys at 0.150120MB/s.  Time: 131ms.&lt;br/&gt;
 INFO &lt;span class=&quot;error&quot;&gt;&amp;#91;FlushWriter:3&amp;#93;&lt;/span&gt; 2012-05-09 11:25:36,013 Memtable.java (line 307) Completed flushing /var/lib/cassandra/data/Disco/Client/Disco-Client-hc-5-Data.db (407 bytes)&lt;br/&gt;
ERROR &lt;span class=&quot;error&quot;&gt;&amp;#91;MigrationStage:1&amp;#93;&lt;/span&gt; 2012-05-09 11:25:36,043 CLibrary.java (line 158) Unable to create hard link&lt;br/&gt;
com.sun.jna.LastErrorException: errno was 17&lt;br/&gt;
        at org.apache.cassandra.utils.CLibrary.link(Native Method)&lt;br/&gt;
        at org.apache.cassandra.utils.CLibrary.createHardLink(CLibrary.java:150)&lt;br/&gt;
        at org.apache.cassandra.db.Directories.snapshotLeveledManifest(Directories.java:343)&lt;br/&gt;
        at org.apache.cassandra.db.ColumnFamilyStore.snapshotWithoutFlush(ColumnFamilyStore.java:1450)&lt;br/&gt;
        at org.apache.cassandra.db.ColumnFamilyStore.snapshot(ColumnFamilyStore.java:1483)&lt;br/&gt;
        at org.apache.cassandra.db.DefsTable.dropColumnFamily(DefsTable.java:512)&lt;br/&gt;
        at org.apache.cassandra.db.DefsTable.mergeColumnFamilies(DefsTable.java:403)&lt;br/&gt;
        at org.apache.cassandra.db.DefsTable.mergeSchema(DefsTable.java:270)&lt;br/&gt;
        at org.apache.cassandra.service.MigrationManager$1.call(MigrationManager.java:214)&lt;br/&gt;
        at java.util.concurrent.FutureTask$Sync.innerRun(FutureTask.java:303)&lt;br/&gt;
        at java.util.concurrent.FutureTask.run(FutureTask.java:138)&lt;br/&gt;
        at java.util.concurrent.ThreadPoolExecutor$Worker.runTask(ThreadPoolExecutor.java:886)&lt;br/&gt;
        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:908)&lt;br/&gt;
        at java.lang.Thread.run(Thread.java:662)&lt;/p&gt;

&lt;p&gt;ERROR &lt;span class=&quot;error&quot;&gt;&amp;#91;Thrift:3&amp;#93;&lt;/span&gt; 2012-05-09 11:25:36,048 CustomTThreadPoolServer.java (line 204) Error occurred during processing of message.&lt;br/&gt;
java.lang.RuntimeException: java.util.concurrent.ExecutionException: java.io.IOError: java.io.IOException: Unable to create hard link from /var/lib/cassandra/data/Disco/Client/Client.json to /var/lib/cassandra/data/Disco/Client/snapshots/1336559135918-Client/Client.json (errno 17)&lt;br/&gt;
        at org.apache.cassandra.utils.FBUtilities.waitOnFuture(FBUtilities.java:372)&lt;br/&gt;
        at org.apache.cassandra.service.MigrationManager.announce(MigrationManager.java:191)&lt;br/&gt;
        at org.apache.cassandra.service.MigrationManager.announceColumnFamilyDrop(MigrationManager.java:182)&lt;br/&gt;
        at org.apache.cassandra.thrift.CassandraServer.system_drop_column_family(CassandraServer.java:948)&lt;br/&gt;
        at org.apache.cassandra.thrift.Cassandra$Processor$system_drop_column_family.getResult(Cassandra.java:3348)&lt;br/&gt;
        at org.apache.cassandra.thrift.Cassandra$Processor$system_drop_column_family.getResult(Cassandra.java:3336)&lt;br/&gt;
        at org.apache.thrift.ProcessFunction.process(ProcessFunction.java:32)&lt;br/&gt;
        at org.apache.thrift.TBaseProcessor.process(TBaseProcessor.java:34)&lt;br/&gt;
        at org.apache.cassandra.thrift.CustomTThreadPoolServer$WorkerProcess.run(CustomTThreadPoolServer.java:186)&lt;br/&gt;
        at java.util.concurrent.ThreadPoolExecutor$Worker.runTask(ThreadPoolExecutor.java:886)&lt;br/&gt;
        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:908)&lt;br/&gt;
        at java.lang.Thread.run(Thread.java:662)&lt;br/&gt;
Caused by: java.util.concurrent.ExecutionException: java.io.IOError: java.io.IOException: Unable to create hard link from /var/lib/cassandra/data/Disco/Client/Client.json to /var/lib/cassandra/data/Disco/Client/snapshots/1336559135918-Client/Client.json (errno 17)&lt;br/&gt;
        at java.util.concurrent.FutureTask$Sync.innerGet(FutureTask.java:222)&lt;br/&gt;
        at java.util.concurrent.FutureTask.get(FutureTask.java:83)&lt;br/&gt;
        at org.apache.cassandra.utils.FBUtilities.waitOnFuture(FBUtilities.java:368)&lt;br/&gt;
        ... 11 more&lt;br/&gt;
Caused by: java.io.IOError: java.io.IOException: Unable to create hard link from /var/lib/cassandra/data/Disco/Client/Client.json to /var/lib/cassandra/data/Disco/Client/snapshots/1336559135918-Client/Client.json (errno 17)&lt;br/&gt;
        at org.apache.cassandra.db.ColumnFamilyStore.snapshotWithoutFlush(ColumnFamilyStore.java:1454)&lt;br/&gt;
        at org.apache.cassandra.db.ColumnFamilyStore.snapshot(ColumnFamilyStore.java:1483)&lt;br/&gt;
        at org.apache.cassandra.db.DefsTable.dropColumnFamily(DefsTable.java:512)&lt;br/&gt;
        at org.apache.cassandra.db.DefsTable.mergeColumnFamilies(DefsTable.java:403)&lt;br/&gt;
        at org.apache.cassandra.db.DefsTable.mergeSchema(DefsTable.java:270)&lt;br/&gt;
        at org.apache.cassandra.service.MigrationManager$1.call(MigrationManager.java:214)&lt;br/&gt;
        at java.util.concurrent.FutureTask$Sync.innerRun(FutureTask.java:303)&lt;br/&gt;
        at java.util.concurrent.FutureTask.run(FutureTask.java:138)&lt;br/&gt;
        ... 3 more&lt;br/&gt;
Caused by: java.io.IOException: Unable to create hard link from /var/lib/cassandra/data/Disco/Client/Client.json to /var/lib/cassandra/data/Disco/Client/snapshots/1336559135918-Client/Client.json (errno 17)&lt;br/&gt;
        at org.apache.cassandra.utils.CLibrary.createHardLink(CLibrary.java:163)&lt;br/&gt;
        at org.apache.cassandra.db.Directories.snapshotLeveledManifest(Directories.java:343)&lt;br/&gt;
        at org.apache.cassandra.db.ColumnFamilyStore.snapshotWithoutFlush(ColumnFamilyStore.java:1450)&lt;br/&gt;
        ... 10 more&lt;br/&gt;
ERROR &lt;span class=&quot;error&quot;&gt;&amp;#91;MigrationStage:1&amp;#93;&lt;/span&gt; 2012-05-09 11:25:36,051 AbstractCassandraDaemon.java (line 134) Exception in thread Thread&lt;span class=&quot;error&quot;&gt;&amp;#91;MigrationStage:1,5,main&amp;#93;&lt;/span&gt;&lt;br/&gt;
java.io.IOError: java.io.IOException: Unable to create hard link from /var/lib/cassandra/data/Disco/Client/Client.json to /var/lib/cassandra/data/Disco/Client/snapshots/1336559135918-Client/Client.json (errno 17)&lt;br/&gt;
        at org.apache.cassandra.db.ColumnFamilyStore.snapshotWithoutFlush(ColumnFamilyStore.java:1454)&lt;br/&gt;
        at org.apache.cassandra.db.ColumnFamilyStore.snapshot(ColumnFamilyStore.java:1483)&lt;br/&gt;
        at org.apache.cassandra.db.DefsTable.dropColumnFamily(DefsTable.java:512)&lt;br/&gt;
        at org.apache.cassandra.db.DefsTable.mergeColumnFamilies(DefsTable.java:403)&lt;br/&gt;
        at org.apache.cassandra.db.DefsTable.mergeSchema(DefsTable.java:270)&lt;br/&gt;
        at org.apache.cassandra.service.MigrationManager$1.call(MigrationManager.java:214)&lt;br/&gt;
        at java.util.concurrent.FutureTask$Sync.innerRun(FutureTask.java:303)&lt;br/&gt;
        at java.util.concurrent.FutureTask.run(FutureTask.java:138)&lt;/p&gt;

&lt;p&gt;        at java.util.concurrent.ThreadPoolExecutor$Worker.runTask(ThreadPoolExecutor.java:886)&lt;br/&gt;
        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:908)&lt;br/&gt;
        at java.lang.Thread.run(Thread.java:662)&lt;br/&gt;
Caused by: java.io.IOException: Unable to create hard link from /var/lib/cassandra/data/Disco/Client/Client.json to /var/lib/cassandra/data/Disco/Client/snapshots/1336559135918-Client/Client.json (errno 17)&lt;br/&gt;
        at org.apache.cassandra.utils.CLibrary.createHardLink(CLibrary.java:163)&lt;br/&gt;
        at org.apache.cassandra.db.Directories.snapshotLeveledManifest(Directories.java:343)&lt;br/&gt;
        at org.apache.cassandra.db.ColumnFamilyStore.snapshotWithoutFlush(ColumnFamilyStore.java:1450)&lt;br/&gt;
        ... 10 more&lt;br/&gt;
 INFO &lt;span class=&quot;error&quot;&gt;&amp;#91;CompactionExecutor:22&amp;#93;&lt;/span&gt; 2012-05-09 11:25:36,052 CompactionTask.java (line 114) Compacting &lt;span class=&quot;error&quot;&gt;&amp;#91;SSTableReader(path=&amp;#39;/var/lib/cassandra/data/Disco/Client/Disco-Client-hc-5-Data.db&amp;#39;), SSTableReader(path=&amp;#39;/var/lib/cassandra/data/Disco/Client/Disco-Client-hc-4-Data.db&amp;#39;)&amp;#93;&lt;/span&gt;&lt;br/&gt;
 INFO &lt;span class=&quot;error&quot;&gt;&amp;#91;CompactionExecutor:22&amp;#93;&lt;/span&gt; 2012-05-09 11:25:36,187 CompactionTask.java (line 225) Compacted to &lt;span class=&quot;error&quot;&gt;&amp;#91;/var/lib/cassandra/data/Disco/Client/Disco-Client-hc-6-Data.db,&amp;#93;&lt;/span&gt;.  728 to 458 (~62% of original) bytes for 8 keys at 0.003235MB/s.  Time: 135ms.&lt;/p&gt;

&lt;p&gt;Schema:&lt;/p&gt;

&lt;p&gt;CREATE COLUMN FAMILY Client WITH&lt;br/&gt;
       key_validation_class = UUIDType AND&lt;br/&gt;
       comparator = UTF8Type AND&lt;br/&gt;
       column_metadata = [ &lt;/p&gt;
{ column_name: key, validation_class: BytesType }
                           { column_name: name, validation_class: UTF8Type }
                           { column_name: userid, validation_class: UUIDType, index_type: KEYS }
&lt;p&gt;                         ] AND&lt;br/&gt;
       compression_options = &lt;/p&gt;
{ sstable_compression:SnappyCompressor, chunk_length_kb:64 }
&lt;p&gt; AND&lt;br/&gt;
       compaction_strategy = LeveledCompactionStrategy AND&lt;br/&gt;
       compaction_strategy_options = &lt;/p&gt;
{ sstable_size_in_mb: 10 }
&lt;p&gt; AND&lt;br/&gt;
       gc_grace = 432000;&lt;/p&gt;

&lt;p&gt;State of data dir after deletion attempt:&lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;ls -lah /var/lib/cassandra/data/Disco/Client/&lt;br/&gt;
total 76K&lt;br/&gt;
drwxr-xr-x  3 cassandra cassandra 4.0K May  9 11:25 .&lt;br/&gt;
drwxr-xr-x 17 cassandra cassandra 4.0K May  3 12:34 ..&lt;br/&gt;
&lt;del&gt;rw-r&lt;/del&gt;&lt;del&gt;r&lt;/del&gt;-  2 cassandra cassandra  420 May  9 11:25 Client-old.json&lt;br/&gt;
&lt;del&gt;rw-r&lt;/del&gt;&lt;del&gt;r&lt;/del&gt;-  1 cassandra cassandra  418 May  7 18:04 Client.Client_userid_idx-old.json&lt;br/&gt;
&lt;del&gt;rw-r&lt;/del&gt;&lt;del&gt;r&lt;/del&gt;-  1 cassandra cassandra  418 May  7 18:04 Client.Client_userid_idx.json&lt;br/&gt;
&lt;del&gt;rw-r&lt;/del&gt;&lt;del&gt;r&lt;/del&gt;-  1 cassandra cassandra  418 May  9 11:25 Client.json&lt;br/&gt;
&lt;del&gt;rw-r&lt;/del&gt;&lt;del&gt;r&lt;/del&gt;-  1 cassandra cassandra   46 May  9 11:25 Disco-Client-hc-6-CompressionInfo.db&lt;br/&gt;
&lt;del&gt;rw-r&lt;/del&gt;&lt;del&gt;r&lt;/del&gt;-  1 cassandra cassandra  458 May  9 11:25 Disco-Client-hc-6-Data.db&lt;br/&gt;
&lt;del&gt;rw-r&lt;/del&gt;&lt;del&gt;r&lt;/del&gt;-  1 cassandra cassandra  976 May  9 11:25 Disco-Client-hc-6-Filter.db&lt;br/&gt;
&lt;del&gt;rw-r&lt;/del&gt;&lt;del&gt;r&lt;/del&gt;-  1 cassandra cassandra  208 May  9 11:25 Disco-Client-hc-6-Index.db&lt;br/&gt;
&lt;del&gt;rw-r&lt;/del&gt;&lt;del&gt;r&lt;/del&gt;-  1 cassandra cassandra 4.3K May  9 11:25 Disco-Client-hc-6-Statistics.db&lt;br/&gt;
&lt;del&gt;rw-r&lt;/del&gt;&lt;del&gt;r&lt;/del&gt;-  4 cassandra cassandra   46 May  7 18:04 Disco-Client.Client_userid_idx-hc-2-CompressionInfo.db&lt;br/&gt;
&lt;del&gt;rw-r&lt;/del&gt;&lt;del&gt;r&lt;/del&gt;-  4 cassandra cassandra   92 May  7 18:04 Disco-Client.Client_userid_idx-hc-2-Data.db&lt;br/&gt;
&lt;del&gt;rw-r&lt;/del&gt;&lt;del&gt;r&lt;/del&gt;-  4 cassandra cassandra  496 May  7 18:04 Disco-Client.Client_userid_idx-hc-2-Filter.db&lt;br/&gt;
&lt;del&gt;rw-r&lt;/del&gt;&lt;del&gt;r&lt;/del&gt;-  4 cassandra cassandra   26 May  7 18:04 Disco-Client.Client_userid_idx-hc-2-Index.db&lt;br/&gt;
&lt;del&gt;rw-r&lt;/del&gt;&lt;del&gt;r&lt;/del&gt;-  4 cassandra cassandra 4.3K May  7 18:04 Disco-Client.Client_userid_idx-hc-2-Statistics.db&lt;br/&gt;
drwxr-xr-x  6 cassandra cassandra 4.0K May  9 11:25 snapshots&lt;/li&gt;
&lt;/ol&gt;
</description>
                <environment>&lt;p&gt;Debian Linux Squeeze with the cassandra debian package from Apache.&lt;/p&gt;</environment>
        <key id="12554460">CASSANDRA-4230</key>
            <summary>Deleting a CF always produces an error and that CF remains in an unknown state</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10002" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Normal</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="xedin">Pavel Yaskevich</assignee>
                                    <reporter username="edevil">Andr&#233; Cruz</reporter>
                        <labels>
                    </labels>
                <created>Wed, 9 May 2012 10:28:59 +0000</created>
                <updated>Wed, 15 Oct 2025 09:48:56 +0000</updated>
                            <resolved>Tue, 15 May 2012 17:10:30 +0000</resolved>
                                        <fixVersion>1.1.1</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="13271518" author="jbellis" created="Wed, 9 May 2012 16:10:11 +0000"  >&lt;p&gt;probably related to &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-4219&quot; title=&quot;Problem with creating keyspace after drop&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-4219&quot;&gt;&lt;del&gt;CASSANDRA-4219&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13271534" author="xedin" created="Wed, 9 May 2012 16:17:54 +0000"  >&lt;p&gt;From the exception message I see that it&apos;s related to the JNA hardlinks while it does a snapshot:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;ERROR [MigrationStage:1] 2012-05-09 11:25:36,043 CLibrary.java (line 158) Unable to create hard link
com.sun.jna.LastErrorException: errno was 17
...
Caused by: java.util.concurrent.ExecutionException: java.io.IOError: java.io.IOException: Unable to create hard link from /var/lib/cassandra/data/Disco/Client/Client.json to /var/lib/cassandra/data/Disco/Client/snapshots/1336559135918-Client/Client.json (errno 17)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;and errno of 17 means &quot;File exists&quot; so this is something with snapshot or the system rather then migrations.&lt;/p&gt;</comment>
                            <comment id="13271548" author="brandon.williams" created="Wed, 9 May 2012 16:29:12 +0000"  >&lt;p&gt;Since snapshot dirs include a timestamp, perhaps we should just move along if it already exists.&lt;/p&gt;</comment>
                            <comment id="13271558" author="xedin" created="Wed, 9 May 2012 16:32:55 +0000"  >&lt;p&gt;Yeah, we probably should do just that.&lt;/p&gt;</comment>
                            <comment id="13271570" author="jbellis" created="Wed, 9 May 2012 16:43:35 +0000"  >&lt;p&gt;But why would it attempt the same snapshot twice?  Sounds like there&apos;s a real bug here.&lt;/p&gt;</comment>
                            <comment id="13271589" author="brandon.williams" created="Wed, 9 May 2012 16:57:55 +0000"  >&lt;p&gt;snapshot on compaction is one way it can happen.&lt;/p&gt;</comment>
                            <comment id="13271596" author="xedin" created="Wed, 9 May 2012 17:02:54 +0000"  >&lt;p&gt;Yeah, it&apos;s only called in snapshotWithoutFlush so if you try to drop CF in the middle of compaction snapshoting files it would be the only way to lead to such behavior. I think what we need to do here is to stop compaction and run drop after that...&lt;/p&gt;</comment>
                            <comment id="13271648" author="jbellis" created="Wed, 9 May 2012 18:12:00 +0000"  >&lt;blockquote&gt;&lt;p&gt;snapshot on compaction is one way it can happen.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I suppose there&apos;s a really small chance of that happening if you happen to time it just right, but that wouldn&apos;t explain it being easily reproducible (since the compaction and drop snapshots generate their snapshot name independently).&lt;/p&gt;

&lt;p&gt;Also, snapshot-on-compaction is off by default, I doubt Andr&#233; has it enabled.  Andr&#233;, can you confirm?&lt;/p&gt;</comment>
                            <comment id="13271682" author="edevil" created="Wed, 9 May 2012 18:41:05 +0000"  >&lt;p&gt;I suppose you mean this:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;$ cat /etc/cassandra/cassandra.yaml |grep snapshot |grep compac
# Whether or not to take a snapshot before each compaction.  Be
snapshot_before_compaction: false
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I did not enable it.&lt;/p&gt;</comment>
                            <comment id="13274270" author="xedin" created="Sun, 13 May 2012 14:14:32 +0000"  >&lt;p&gt;I have figured out that this problem is caused only when LeveledCompaction is used for Secondary Index, it seems like when index&apos;s leveled manifest is snapshoted it uses the wrong name.&lt;/p&gt;</comment>
                            <comment id="13274389" author="jbellis" created="Sun, 13 May 2012 22:53:19 +0000"  >&lt;p&gt;Do we need this in 1.0 too?&lt;/p&gt;</comment>
                            <comment id="13274391" author="xedin" created="Sun, 13 May 2012 23:00:28 +0000"  >&lt;p&gt;No, this bug came together with directory-per-CF which was added into 1.1.&lt;/p&gt;</comment>
                            <comment id="13274735" author="jbellis" created="Mon, 14 May 2012 16:45:46 +0000"  >&lt;p&gt;simpler v2 attached&lt;/p&gt;</comment>
                            <comment id="13274748" author="xedin" created="Mon, 14 May 2012 17:05:13 +0000"  >&lt;p&gt;Heh, I overlooked that possibility, +1.&lt;/p&gt;</comment>
                            <comment id="13274751" author="xedin" created="Mon, 14 May 2012 17:07:09 +0000"  >&lt;p&gt;Andre, can you please test and confirm that everything works as expected before we commit it?&lt;/p&gt;</comment>
                            <comment id="13275981" author="edevil" created="Tue, 15 May 2012 17:08:01 +0000"  >&lt;p&gt;It works, thanks!&lt;/p&gt;</comment>
                            <comment id="13275987" author="jbellis" created="Tue, 15 May 2012 17:10:30 +0000"  >&lt;p&gt;committed&lt;/p&gt;</comment>
                            <comment id="14358812" author="cvertiz" created="Thu, 12 Mar 2015 15:17:47 +0000"  >&lt;p&gt;Note: Issue reproduced on cassandra 2.0.12 (datastax for windows)&lt;br/&gt;
Log: refer to cassandraDEBUG.log attached file.&lt;/p&gt;</comment>
                            <comment id="14359005" author="jmckenzie" created="Thu, 12 Mar 2015 17:21:05 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=cvertiz&quot; class=&quot;user-hover&quot; rel=&quot;cvertiz&quot;&gt;cvertiz&lt;/a&gt;: doesn&apos;t necessarily look like the same issue to me. Your attached logs don&apos;t show any errors symlinking for snapshots during compaction though they do contain the same thrift error message:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;DEBUG [Thrift:13] 2015-03-12 09:52:49,291 CustomTThreadPoolServer.java (line 214) Thrift transport error occurred during processing of message.
 org.apache.thrift.transport.TTransportException
	at org.apache.thrift.transport.TIOStreamTransport.read(TIOStreamTransport.java:132)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;What behavior produced the errors you&apos;re seeing?&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12526778" name="4230-v2.txt" size="837" author="jbellis" created="Mon, 14 May 2012 16:45:46 +0000"/>
                            <attachment id="12526679" name="CASSANDRA-4230.patch" size="3345" author="xedin" created="Sun, 13 May 2012 14:47:05 +0000"/>
                            <attachment id="12704165" name="cassandraDEBUG.log" size="630392" author="cvertiz" created="Thu, 12 Mar 2015 15:18:29 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[xedin]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>238702</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 36 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0gti7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>96210</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>jbellis</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[jbellis]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12962"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>