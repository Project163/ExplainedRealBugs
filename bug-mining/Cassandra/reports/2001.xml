<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 22:36:56 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-4936] Less than operator when comparing timeuuids behaves as less than equal.</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-4936</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;If we define the following column family using CQL3:&lt;/p&gt;

&lt;p&gt;CREATE TABLE useractivity (&lt;br/&gt;
  user_id int,&lt;br/&gt;
  activity_id &apos;TimeUUIDType&apos;,&lt;br/&gt;
  data text,&lt;br/&gt;
  PRIMARY KEY (user_id, activity_id)&lt;br/&gt;
);&lt;/p&gt;

&lt;p&gt;Add some values to it.&lt;/p&gt;

&lt;p&gt;And then query it like:&lt;/p&gt;

&lt;p&gt;SELECT * FROM useractivity WHERE user_id = &apos;3&apos; AND activity_id &amp;lt; &apos;2012-11-07 18:18:22-0800&apos; ORDER BY activity_id DESC LIMIT 1;&lt;/p&gt;

&lt;p&gt;the record with timeuuid &apos;2012-11-07 18:18:22-0800&apos; returns in the results.&lt;/p&gt;

&lt;p&gt;According to the documentation, on CQL3 the &apos;&amp;lt;&apos; and &apos;&amp;gt;&apos; operators are strict, meaning not inclusive, so this seems to be a bug.&lt;/p&gt;</description>
                <environment>&lt;p&gt;Linux CentOS.&lt;/p&gt;

&lt;p&gt;Linux localhost.localdomain 2.6.18-308.16.1.el5 #1 SMP Tue Oct 2 22:01:37 EDT 2012 i686 i686 i386 GNU/Linux&lt;/p&gt;</environment>
        <key id="12615408">CASSANDRA-4936</key>
            <summary>Less than operator when comparing timeuuids behaves as less than equal.</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10002" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Normal</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="slebresne">Sylvain Lebresne</assignee>
                                    <reporter username="cesar.nataren">Cesar Lopez-Nataren</reporter>
                        <labels>
                    </labels>
                <created>Fri, 9 Nov 2012 01:13:54 +0000</created>
                <updated>Tue, 16 Apr 2019 09:32:23 +0000</updated>
                            <resolved>Fri, 18 Jan 2013 13:02:54 +0000</resolved>
                                        <fixVersion>1.2.1</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="13493672" author="jbellis" created="Fri, 9 Nov 2012 01:58:28 +0000"  >&lt;p&gt;Are you sure the UUIDs do not differ in their non-time-based component?  See &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-4284&quot; title=&quot;Improve timeuuid &amp;lt;-&amp;gt; date relationship&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-4284&quot;&gt;&lt;del&gt;CASSANDRA-4284&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="13493788" author="slebresne" created="Fri, 9 Nov 2012 07:12:05 +0000"  >&lt;p&gt;This reminds me, I think that at the minimum we should provide a cqlsh option to display timeuuid as UUID rather than date. Otherwise it&apos;s painful to even check that the actual UUID differs. Though tbh I&apos;m still not sure using dates by default is the best idea given this is a lossy representation and I&apos;m afraid will confuse more people not used to type 1 UUID than anything else. Unless of course we adopt of the the format discussed in &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-4284&quot; title=&quot;Improve timeuuid &amp;lt;-&amp;gt; date relationship&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-4284&quot;&gt;&lt;del&gt;CASSANDRA-4284&lt;/del&gt;&lt;/a&gt; (alternatively, we could just display the date &lt;b&gt;and&lt;/b&gt; the uuid in parenthesis, though it&apos;ll be verbose). &lt;/p&gt;</comment>
                            <comment id="13494229" author="cesar.nataren" created="Fri, 9 Nov 2012 19:23:14 +0000"  >&lt;p&gt;Jonathan: What&apos;s the easiest way to find that out?&lt;/p&gt;</comment>
                            <comment id="13494449" author="thobbs" created="Sat, 10 Nov 2012 00:06:06 +0000"  >&lt;blockquote&gt;&lt;p&gt;Are you sure the UUIDs do not differ in their non-time-based component?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;(Note: I suggested that Cesar open this ticket.)  It almost certainly is a problem with the non-time-based component.  However, the intention of the user is pretty clear for this query: select anything where the timestamp component is less than the provided one.&lt;/p&gt;

&lt;p&gt;I&apos;ve been handling this specially in pycassa for quite a while.  If the comparator is TimeUUID, and a datetime/timestamp is passed as a slice end, it will create a TimeUUID with special non-timestamp components.  For example, since slice ends are inclusive in the thrift api, when creating the TimeUUID for the slice &apos;finish&apos;, the highest possible TimeUUID with the given timestamp will be used.&lt;/p&gt;

&lt;p&gt;We could do something similar with CQL, it would just require passing along information about whether to create the highest or lowest TimeUUID representation for a given datestamp based on the comparison operator that&apos;s used.&lt;/p&gt;

&lt;p&gt;If details about what non-timestamp components pycassa uses would be useful, let me know.&lt;/p&gt;</comment>
                            <comment id="13550990" author="slebresne" created="Fri, 11 Jan 2013 08:53:01 +0000"  >&lt;p&gt;I really think the bug here is that TimeUUIDType.fromString() accepts a date as input. But a date is &lt;b&gt;not&lt;/b&gt; a valid representation of a timeuuid, and the fromString method does &lt;b&gt;arbitrarily&lt;/b&gt; pick some 0&apos;s for parts of the resulting UUID.&lt;/p&gt;

&lt;p&gt;In other words, the SELECT query above should be invalid.&lt;/p&gt;

&lt;p&gt;Now don&apos;t get me wrong, selecting timeuuid based on dates is useful but that is a slightly different problem. So what I think we should do is:&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;refuse dates as valid timeuuid values because they just are not.&lt;/li&gt;
	&lt;li&gt;add convenience methods to translate dates to precise timeuuid. For querying we would have &apos;startOf()&apos; and &apos;endOf()&apos; (where &apos;startOf(&amp;lt;date&amp;gt; )&apos; (resp. &apos;endOf(&amp;lt;date&amp;gt; )&apos;) would return the &lt;b&gt;smallest&lt;/b&gt; (resp. &lt;b&gt;biggest&lt;/b&gt;) possible timeuuid at time &amp;lt;date&amp;gt; ). And for insertion we could optionally add &apos;random(&amp;lt;date&amp;gt; )&apos; that would return a random timeuuid at time &apos;&amp;lt;date&amp;gt;&apos; (we could even accept &apos;now&apos; as syntactic sugar for &apos;random(now)&apos; if we feel like it).&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;That would also mean that cqlsh should stop this non-sense of displaying timeuuid like date. Again, I understand the intention of making it more readable but this will confuse generations of CQL3 users. I do am in favor of finding a non confusing way to make it readable for users. In fact one solution could be to handle that on the CQL side and to allow &apos;SELECT dateOf(x ) FROM ...&apos; that would return a date string from timeuuid x (but now it&apos;s clear, you&apos;ve explicitly asked for a lossy representation of x).&lt;/p&gt;

&lt;p&gt;I note that this suggestion pretty much fixes the problem discussed in &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-4284&quot; title=&quot;Improve timeuuid &amp;lt;-&amp;gt; date relationship&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-4284&quot;&gt;&lt;del&gt;CASSANDRA-4284&lt;/del&gt;&lt;/a&gt; too.&lt;/p&gt;

&lt;p&gt;I note that Tyler&apos;s solution of basically automatically generating the startOf() and endOf() method under the cover based on whether we&apos;ve use an inclusive of exclusive operation may appear seductive but I don&apos;t think we should do that because:&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;if you do that, what about SELECT ... WHERE activity_id = &apos;2012-11-07 18:18:22-0800&apos;. You still have no solution for that and by doing magic under the carpet for &amp;lt; and &amp;gt;, you&apos;ve in fact blurred what = really does.&lt;/li&gt;
	&lt;li&gt;&quot;it would just require passing along information about whether to create the highest or lowest TimeUUID representation for a given datestamp based on the comparison operator that&apos;s used&quot; &amp;lt;- while this seem simple on principle, this will yield very &lt;b&gt;very&lt;/b&gt; ugly special cases internally. This is &lt;b&gt;not&lt;/b&gt; 2 lines of code.&lt;/li&gt;
	&lt;li&gt;more generally, this doesn&apos;t solve the fact that date &lt;b&gt;are not&lt;/b&gt; valid representation of timeuuid. For example, I still think the first point mentioned in &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-4284&quot; title=&quot;Improve timeuuid &amp;lt;-&amp;gt; date relationship&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-4284&quot;&gt;&lt;del&gt;CASSANDRA-4284&lt;/del&gt;&lt;/a&gt; is a bug in its own right.&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;Allowing dates as valid representation of timeuuid is a bug, let&apos;s fix it.&lt;/p&gt;</comment>
                            <comment id="13551118" author="slebresne" created="Fri, 11 Jan 2013 13:29:28 +0000"  >&lt;p&gt;Attaching a patch that implements what my previous comment describes.&lt;/p&gt;

&lt;p&gt;A few precisions:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;the patch allows &lt;tt&gt;startOf(&apos;2012-11-07 18:18:22-0800&apos;)&lt;/tt&gt; or even &lt;tt&gt;startOf(12432343423)&lt;/tt&gt; but not &lt;tt&gt;startOf(? )&lt;/tt&gt;. It&apos;s just that it&apos;s simpler to not support prepared marker for now. We can add it later, but I&apos;d rather leave it for later. It&apos;s not excessively useful anyway since any good library will provide an equivalent to the &lt;tt&gt;startOf()&lt;/tt&gt; method anyway (and so you can use that client side for prepared statements).&lt;/li&gt;
	&lt;li&gt;the patch change the fact that dates are accepted as valid TimeUUID representation because, as arged previously, this is bogus. However, CQL2 has done that bogus thing to, and I&apos;m not sure it&apos;s worth fixing there as there might be people relying on that buggy behavior. So the patch maintain the buggy behavior fro CQL2.&lt;/li&gt;
	&lt;li&gt;I talks about adding a &apos;random(date)&apos; method for insertions sake in my previous comment, but thinking about that a bit more, I&apos;m not sure it&apos;s a good idea. Namely, the only way to generate a version 1 UUID according to the spec is based on the current time. Generating one from a timestamp is kind of not safe. Now I admit that if you use the timestamp but randomize all other bits, you probably end up with something having virtually no chance of collision, but still, I&apos;m slightly reluctant to do that in Cassandra. I&apos;d rather let people do that client side (and provide a UUID string) if they really want to. So instead the patch only provides a &lt;tt&gt;now()&lt;/tt&gt; method that generate a new unique timeuuid based on the current time.&lt;/li&gt;
	&lt;li&gt;The patch also adds the conversion for select statement I mention in my previous comment. In fact it adds 2 methods &lt;tt&gt;dateOf()&lt;/tt&gt; and &lt;tt&gt;unixTimestampOf()&lt;/tt&gt;. This part is kind of optional and I can rip it out if there is objections (I meant to separate in 2 patches but scewed up and got lazy). That being said, I kind of like it and with that I think we can just have cqlsh stop printing timeUUID as dates (which the patch doesn&apos;t include however).&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Let&apos;s not shy away from the fact that this patch kinds of break backward compatibility. I say &quot;kinds of&quot; because as I&apos;ve said, I really think allowing date litterals as timeuuid values is a bug so I really think this patch is a bug fix. And if we get that in 1.2.1, I really don&apos;t think they&apos;ll be any arm done. I also note that there isn&apos;t any way to fix this issue that don&apos;t &quot;break backward compatibility&quot;. So I&apos;m really sorry I didn&apos;t got that fix up before 1.2.0, but I still really think we should do it nonetheless.&lt;/p&gt;</comment>
                            <comment id="13551342" author="thobbs" created="Fri, 11 Jan 2013 18:19:05 +0000"  >&lt;p&gt;I agree with all of your points.  The one thing I might change are the function names &lt;tt&gt;startOf()&lt;/tt&gt; and &lt;tt&gt;endOf()&lt;/tt&gt;.  Since these functions are dealing with dates and times, I think the names suggest they might be altering the time component.  Perhaps &lt;tt&gt;minTimeUUID()&lt;/tt&gt; and &lt;tt&gt;maxTimeUUID()&lt;/tt&gt;?&lt;/p&gt;

&lt;p&gt;Regarding backwards compatibility: are we carefully tracking changes to CQL by version and documenting them somewhere?  These kinds of changes need to be easily discoverable, even if they are only considered bugfixes.&lt;/p&gt;</comment>
                            <comment id="13552532" author="slebresne" created="Mon, 14 Jan 2013 09:43:37 +0000"  >&lt;blockquote&gt;&lt;p&gt;Perhaps minTimeUUID() and maxTimeUUID()?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Agreed, that&apos;s probably less confusing. That&apos;s trivial to change though, I&apos;ll change before committing if it comes to that.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;are we carefully tracking changes to CQL by version and documenting them somewhere?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Not yet, but I do intend to do it now that CQL3 is final. It&apos;ll probably be listed in &lt;a href=&quot;http://cassandra.apache.org/doc/cql3/CQL.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://cassandra.apache.org/doc/cql3/CQL.html&lt;/a&gt;. Though if that patch is committed, I&apos;ll also mention it clearly in the NEWS file.&lt;/p&gt;</comment>
                            <comment id="13554846" author="jbellis" created="Wed, 16 Jan 2013 08:27:12 +0000"  >&lt;p&gt;Tyler, can you review the patch?&lt;/p&gt;</comment>
                            <comment id="13555182" author="thobbs" created="Wed, 16 Jan 2013 16:33:23 +0000"  >&lt;p&gt;Yes, I can review it.&lt;/p&gt;</comment>
                            <comment id="13556688" author="thobbs" created="Thu, 17 Jan 2013 22:45:38 +0000"  >&lt;p&gt;+1 on the patch&lt;/p&gt;

&lt;p&gt;I&apos;d like to include the &lt;tt&gt;dateOf()&lt;/tt&gt; and &lt;tt&gt;unixTimestampOf()&lt;/tt&gt; functions; do you want update cqlsh here to not automatically convert timeUUIDs to a date format?&lt;/p&gt;</comment>
                            <comment id="13557197" author="slebresne" created="Fri, 18 Jan 2013 13:02:55 +0000"  >&lt;p&gt;Alright, committed, thanks&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;I&apos;d like to include the dateOf() and unixTimestampOf() functions&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I&apos;ve left them in the commit. I&apos;ve also renamed startOf/endOf to minTimeUUID/maxTimeUUID as suggested above.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;do you want update cqlsh here to not automatically convert timeUUIDs to a date format?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;As that was simple, I did that too with the commit. Though if someone more knowledgeable of cqlsh wants to have a look at the commit and make sure I didn&apos;t forget something, that&apos;d be appreciated.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12564408" name="4936.txt" size="24573" author="slebresne" created="Fri, 11 Jan 2013 13:30:57 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[slebresne]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>256686</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            12 years, 44 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0iqen:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>107372</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>thobbs</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[thobbs]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12962"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>