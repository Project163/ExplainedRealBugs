<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 23:03:50 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-11850] cannot use cql since upgrading python to 2.7.11+</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-11850</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;OS: Debian GNU/Linux stretch/sid &lt;br/&gt;
Kernel: 4.5.0-2-amd64 #1 SMP Debian 4.5.4-1 (2016-05-16) x86_64 GNU/Linux&lt;br/&gt;
Python version: 2.7.11+ (default, May  9 2016, 15:54:33)&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;GCC 5.3.1 20160429&amp;#93;&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;cqlsh --version: cqlsh 5.0.1&lt;br/&gt;
cassandra -v: 3.5 (also occurs with 3.0.6)&lt;/p&gt;

&lt;p&gt;Issue:&lt;br/&gt;
when running cqlsh, it returns the following error:&lt;/p&gt;

&lt;p&gt;cqlsh -u dbarpt_usr01&lt;br/&gt;
Password: *****&lt;/p&gt;

&lt;p&gt;Connection error: (&apos;Unable to connect to any servers&apos;, &lt;/p&gt;
{&apos;odbasandbox1&apos;: TypeError(&apos;ref() does not take keyword arguments&apos;,)}
&lt;p&gt;)&lt;/p&gt;

&lt;p&gt;I cleared PYTHONPATH:&lt;/p&gt;

&lt;p&gt;python -c &quot;import json; print dir(json); print json._&lt;em&gt;version&lt;/em&gt;_&quot;&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;&amp;#39;JSONDecoder&amp;#39;, &amp;#39;JSONEncoder&amp;#39;, &amp;#39;__all__&amp;#39;, &amp;#39;__author__&amp;#39;, &amp;#39;__builtins__&amp;#39;, &amp;#39;__doc__&amp;#39;, &amp;#39;__file__&amp;#39;, &amp;#39;__name__&amp;#39;, &amp;#39;__package__&amp;#39;, &amp;#39;__path__&amp;#39;, &amp;#39;__version__&amp;#39;, &amp;#39;_default_decoder&amp;#39;, &amp;#39;_default_encoder&amp;#39;, &amp;#39;decoder&amp;#39;, &amp;#39;dump&amp;#39;, &amp;#39;dumps&amp;#39;, &amp;#39;encoder&amp;#39;, &amp;#39;load&amp;#39;, &amp;#39;loads&amp;#39;, &amp;#39;scanner&amp;#39;&amp;#93;&lt;/span&gt;&lt;br/&gt;
2.0.9&lt;/p&gt;

&lt;p&gt;Java based clients can connect to Cassandra with no issue. Just CQLSH and Python clients cannot.&lt;/p&gt;

&lt;p&gt;nodetool status also works.&lt;/p&gt;

&lt;p&gt;Thank you for your help.&lt;/p&gt;

</description>
                <environment>&lt;p&gt;Development&lt;/p&gt;</environment>
        <key id="12971376">CASSANDRA-11850</key>
            <summary>cannot use cql since upgrading python to 2.7.11+</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10002" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Normal</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="stefania">Stefania Alborghetti</assignee>
                                    <reporter username="uskratos">Andrew Madison</reporter>
                        <labels>
                            <label>cqlsh</label>
                    </labels>
                <created>Fri, 20 May 2016 02:03:27 +0000</created>
                <updated>Tue, 16 Apr 2019 09:30:32 +0000</updated>
                            <resolved>Mon, 25 Jul 2016 00:53:34 +0000</resolved>
                                        <fixVersion>2.1.16</fixVersion>
                    <fixVersion>2.2.8</fixVersion>
                    <fixVersion>3.0.9</fixVersion>
                    <fixVersion>3.8</fixVersion>
                                    <component>Legacy/Tools</component>
                        <due></due>
                            <votes>2</votes>
                                    <watches>20</watches>
                                                                                                                <comments>
                            <comment id="15293591" author="iamaleksey" created="Fri, 20 May 2016 15:54:55 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=aholmber&quot; class=&quot;user-hover&quot; rel=&quot;aholmber&quot;&gt;aholmber&lt;/a&gt; Are there any known issues with Python driver on 2.7.11+?&lt;/p&gt;</comment>
                            <comment id="15293737" author="aholmber" created="Fri, 20 May 2016 17:10:15 +0000"  >&lt;p&gt;No issues with released version of Python. This is a known change with dev versions:&lt;br/&gt;
&lt;a href=&quot;https://github.com/datastax/python-driver/pull/585&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/datastax/python-driver/pull/585&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15298953" author="aholmber" created="Tue, 24 May 2016 21:31:14 +0000"  >&lt;p&gt;FYI this is resolved in driver 3.4.0, which was released today.&lt;/p&gt;</comment>
                            <comment id="15299014" author="uskratos" created="Tue, 24 May 2016 22:00:21 +0000"  >&lt;p&gt;Thank you Adam. I downloaded version 3.4.0 from &lt;a href=&quot;https://github.com/datastax/python-driver/tree/3.4.0&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/datastax/python-driver/tree/3.4.0&lt;/a&gt; and unfortunately the error still occurs.&lt;/p&gt;

&lt;p&gt;cassandra.cluster.NoHostAvailable: (&apos;Unable to connect to any servers&apos;, &lt;/p&gt;
{&apos;10.248.33.96&apos;: TypeError(&apos;ref() does not take keyword arguments&apos;,), &apos;10.2.51.2&apos;: TypeError(&apos;ref() does not take keyword arguments&apos;,)}
&lt;p&gt;)&lt;/p&gt;</comment>
                            <comment id="15299390" author="stefania" created="Wed, 25 May 2016 03:24:49 +0000"  >&lt;p&gt;cqlsh ships with an embedded python driver and that will only be updated in a future Cassandra release (watch this ticket for the exact fix version). &lt;/p&gt;

&lt;p&gt;If you have an up-to-date driver installed, you can disable the embedded driver by setting the environment variable CQLSH_NO_BUNDLED to any non empty string, for example &lt;b&gt;&lt;tt&gt;export CQLSH_NO_BUNDLED=true&lt;/tt&gt;&lt;/b&gt;. &lt;/p&gt;</comment>
                            <comment id="15299399" author="stefania" created="Wed, 25 May 2016 03:35:50 +0000"  >&lt;p&gt;I&apos;ve updated the bundled driver and started the cqlsh tests for 3.0:&lt;/p&gt;

&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;3.0&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;3.7&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;trunk&lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/stef1927/cassandra/commits/11850-cqlsh-3.0&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;patch&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/stef1927/cassandra/commits/11850-cqlsh-3.7&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;patch&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/stef1927/cassandra/commits/11850-cqlsh&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;patch&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/stef1927/job/stef1927-11850-cqlsh-3.0-cqlsh-tests/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;dtest&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/stef1927/job/stef1927-11850-cqlsh-3.7-cqlsh-tests/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;dtest&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/stef1927/job/stef1927-11850-cqlsh-cqlsh-tests/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;dtest&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;


&lt;p&gt;If the 3.0 tests are fine I will also run the 3.7 and trunk tests.&lt;/p&gt;

&lt;p&gt;I&apos;m also going to update my python version to 2.7.11 to make sure cqlsh now runs.&lt;/p&gt;</comment>
                            <comment id="15299540" author="stefania" created="Wed, 25 May 2016 06:30:23 +0000"  >&lt;p&gt;Unfortunately I cannot reproduce the issue with 2.7.11 built from source. We need to either get the source code from the Python master branch or assume that the problem is fixed since I&apos;d rather not mess up the Debian packages on my laptop. Alternatively, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=uskratos&quot; class=&quot;user-hover&quot; rel=&quot;uskratos&quot;&gt;uskratos&lt;/a&gt; would you be able to confirm if the problem is fixed when running cqlsh with CQLSH_NO_BUNDLED set and the latest driver version?&lt;/p&gt;

&lt;p&gt;There are 5 &lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/stef1927/job/stef1927-11850-cqlsh-3.0-cqlsh-tests/lastCompletedBuild/testReport/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;failing tests&lt;/a&gt;, they will need fixing before proceeding. They seem caused by Unicode errors. I&apos;ll try and resume as soon as I can.&lt;/p&gt;</comment>
                            <comment id="15300198" author="uskratos" created="Wed, 25 May 2016 15:12:40 +0000"  >&lt;p&gt;Thank you Stefania. I deployed the 3.7 patch and set CQLSH_NO_BUNDLED to TRUE. That fixed the problem and was able to connect from cqlsh&lt;/p&gt;

&lt;p&gt;export CQLSH_NO_BUNDLED=TRUE&lt;br/&gt;
$ cqlsh -u cassandra&lt;br/&gt;
Password:&lt;br/&gt;
Connected to DBA Cassandra Cluster at odbasandbox1:9042.&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;cqlsh 5.0.1 | Cassandra 3.0.6 | CQL spec 3.4.0 | Native protocol v4&amp;#93;&lt;/span&gt;&lt;/p&gt;
</comment>
                            <comment id="15301209" author="stefania" created="Thu, 26 May 2016 00:33:34 +0000"  >&lt;p&gt;Thank you for confirming that the patch works &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=uskratos&quot; class=&quot;user-hover&quot; rel=&quot;uskratos&quot;&gt;uskratos&lt;/a&gt;, that&apos;s really great to know!&lt;/p&gt;

&lt;p&gt;You don&apos;t need to set &lt;tt&gt;CQLSH_NO_BUNDLED&lt;/tt&gt; if you are running the 3.7 patch, because the patch already bundles the 3.4.0 driver. You only need to set &lt;tt&gt;CQLSH_NO_BUNDLED&lt;/tt&gt; if you want to keep on running an unpatched cqlsh that uses the 3.4.0 driver installed on your machine, rather than the older bundled driver.&lt;/p&gt;</comment>
                            <comment id="15358740" author="bric3" created="Fri, 1 Jul 2016 10:04:17 +0000"  >&lt;p&gt;For reference the issue mentionned here is also present on version 2.x of cassandra. I just upgraded my python environment to 2.7.12 for other reasons. And &lt;tt&gt;cqlsh&lt;/tt&gt; fails to connect with the same error :&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;$ cqlsh
Connection error: (&lt;span class=&quot;code-quote&quot;&gt;&apos;Unable to connect to any servers&apos;&lt;/span&gt;, {&lt;span class=&quot;code-quote&quot;&gt;&apos;127.0.0.1&apos;&lt;/span&gt;: TypeError(&lt;span class=&quot;code-quote&quot;&gt;&apos;ref() does not take keyword arguments&apos;&lt;/span&gt;,)})
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;$ uname -a
Darwin ulysse 15.5.0 Darwin Kernel Version 15.5.0: Tue Apr 19 18:36:36 PDT 2016; root:xnu-3248.50.21~8/RELEASE_X86_64 x86_64
$ python --version
Python 2.7.12
$ cassandra -v
2.1.13
$ cqlsh --version
cqlsh 5.0.1
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="15360324" author="nicerobot" created="Sat, 2 Jul 2016 20:46:11 +0000"  >&lt;p&gt;Just to clarify, it is due to (in my DSE 4.8.6):&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-style: solid;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeHeader panelHeader&quot; style=&quot;border-bottom-width: 1px;border-bottom-style: solid;&quot;&gt;&lt;b&gt;DSE/resources/cassandra/lib/cassandra-driver-internal-only-2.7.2.zip/cassandra-driver-2.7.2/cassandra/cluster.py:2147&lt;/b&gt;&lt;/div&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;        self_weakref = weakref.ref(self, callback=partial(_clear_watcher, weakref.proxy(connection)))
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Specifically, &lt;tt&gt;callback=&lt;/tt&gt; is what is producing that error.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://hg.python.org/cpython/raw-file/v2.7.12/Misc/NEWS&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://hg.python.org/cpython/raw-file/v2.7.12/Misc/NEWS&lt;/a&gt;&lt;/p&gt;

&lt;blockquote&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Issue #17765: weakref.ref() no longer silently ignores keyword arguments.&lt;br/&gt;
  Patch by Georg Brandl.&lt;/li&gt;
&lt;/ul&gt;
&lt;/blockquote&gt;


</comment>
                            <comment id="15360829" author="stefania" created="Mon, 4 Jul 2016 04:59:05 +0000"  >&lt;p&gt;I&apos;ve reproduced the problem with python 2.7.12 and cassandra 2.1+. I&apos;ve also verified that the latest python driver, 3.5.0, fixes the problem for 2.2+ whilst for 2.1 I&apos;ve created a pull request &lt;a href=&quot;https://github.com/datastax/python-driver/pull/606&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;here&lt;/a&gt; to add the fix to the driver 2.7.2 branch.&lt;/p&gt;

&lt;p&gt;I&apos;ve launched the cqlsh tests with the updated driver:&lt;/p&gt;

&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;2.1&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;2.2&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;3.0&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;3.9&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;trunk&lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/stef1927/cassandra/commits/11850-cqlsh-2.1&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;patch&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/stef1927/cassandra/commits/11850-cqlsh-2.2&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;patch&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/stef1927/cassandra/commits/11850-cqlsh-3.0&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;patch&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/stef1927/cassandra/commits/11850-cqlsh-3.9&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;patch&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/stef1927/cassandra/commits/11850-cqlsh&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;patch&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/stef1927/job/stef1927-11850-cqlsh-2.1-cqlsh-tests/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;dtest&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/stef1927/job/stef1927-11850-cqlsh-2.2-cqlsh-tests/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;dtest&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/stef1927/job/stef1927-11850-cqlsh-3.0-cqlsh-tests/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;dtest&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/stef1927/job/stef1927-11850-cqlsh-3.9-cqlsh-tests/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;dtest&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/stef1927/job/stef1927-11850-cqlsh-cqlsh-tests/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;dtest&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;


&lt;p&gt;I&apos;m hoping that the Unicode problems I previously observed with the driver version 3.4 are now resolved. If so we can commit, otherwise I&apos;ll bump the urgency of this ticket given that that problem now occurs with a released python version.&lt;/p&gt;</comment>
                            <comment id="15361976" author="stefania" created="Tue, 5 Jul 2016 04:14:31 +0000"  >&lt;p&gt;2.1 tests are fine but in 2.2+ we have some behavioral changes in the driver that cause problems, mostly related to utf-8 encoding and &lt;a href=&quot;https://datastax-oss.atlassian.net/browse/PYTHON-458&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;PYTHON-458&lt;/a&gt; / &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-10686&quot; title=&quot;cqlsh schema refresh on timeout dtest is flaky&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-10686&quot;&gt;&lt;del&gt;CASSANDRA-10686&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;Some fixes went into the patches linked above, whilst the fixes in the dtest code are &lt;a href=&quot;https://github.com/stef1927/cassandra-dtest/tree/11850&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;here&lt;/a&gt;. I&apos;ve relaunched the tests.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=pauloricardomg&quot; class=&quot;user-hover&quot; rel=&quot;pauloricardomg&quot;&gt;pauloricardomg&lt;/a&gt;, given that PYTHON-458 is now available, are we still expecting an operation timeout and schema mismatch warning in &lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/stef1927/job/stef1927-11850-cqlsh-2.2-cqlsh-tests/lastCompletedBuild/cython=no/testReport/cqlsh_tests.cqlsh_tests/TestCqlsh/test_refresh_schema_on_timeout_error/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;&lt;tt&gt;test_refresh_schema_on_timeout_error&lt;/tt&gt;&lt;/a&gt;? I added the following in cqlsh &lt;a href=&quot;https://github.com/stef1927/cassandra/commit/ba02cd1b96e329b533141cf78c43eb960e5d4d61#diff-1cce67f7d76864f07aaf4d986d6fc051R1256&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;&lt;tt&gt;perform_simple_stement&lt;/tt&gt;&lt;/a&gt; but &lt;tt&gt;future.is_schema_agreed&lt;/tt&gt; is always true (I think the driver refreshes the metadata before returning the statement result):&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;future&lt;/span&gt; = self.session.execute_async(statement, trace=self.tracing_enabled)
result = &lt;span class=&quot;code-keyword&quot;&gt;future&lt;/span&gt;.result()

&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; not &lt;span class=&quot;code-keyword&quot;&gt;future&lt;/span&gt;.is_schema_agreed:
    self.refresh_schema_metadata_best_effort()
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="15362255" author="stefania" created="Tue, 5 Jul 2016 09:13:31 +0000"  >&lt;p&gt;Fixed one more &lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/stef1927/job/stef1927-11850-cqlsh-3.0-cqlsh-tests/3/cython=yes/testReport/cqlsh_tests.cqlsh_copy_tests/CqlshCopyTest/test_bulk_round_trip_blogposts_with_max_connections/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;failure&lt;/a&gt;, caused by the fact that, after calling &lt;a href=&quot;https://github.com/stef1927/cassandra/blob/11850-cqlsh-2.2/bin/cqlsh.py#L933&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;&lt;tt&gt;shell.get_ring&lt;/tt&gt;&lt;/a&gt;, the replicas are no longer marked as up (&lt;tt&gt;is_up&lt;/tt&gt; is false), is this expected &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=aholmber&quot; class=&quot;user-hover&quot; rel=&quot;aholmber&quot;&gt;aholmber&lt;/a&gt;? I fixed it &lt;a href=&quot;https://github.com/stef1927/cassandra/commit/cab351fc32cec89f6b5cb4dc6d70f262252e3e3e#diff-27e394435c04a60c58ec9d5c34397341R668&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;like this&lt;/a&gt;, can we do better?&lt;/p&gt;

&lt;p&gt;I&apos;ve also implemented &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-11979&quot; title=&quot;cqlsh copyutil should get host metadata by connected address&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-11979&quot;&gt;&lt;del&gt;CASSANDRA-11979&lt;/del&gt;&lt;/a&gt; &lt;a href=&quot;https://github.com/stef1927/cassandra/commit/cab351fc32cec89f6b5cb4dc6d70f262252e3e3e#diff-27e394435c04a60c58ec9d5c34397341R208&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;here&lt;/a&gt; whilst I was looking for the culprit of the failure above.&lt;/p&gt;

&lt;p&gt;There are plenty more failures on 3.9 and trunk, they seem to happen also with the old driver version but I will take a look anyway.&lt;/p&gt;</comment>
                            <comment id="15362311" author="stefania" created="Tue, 5 Jul 2016 10:04:51 +0000"  >&lt;p&gt;Failures on 3.9 / trunk were caused by CDC changes or connection errors. The CDC changes are fixed. The connection errors also happen on unpatched branches and I believe they are being investigated separately (Netty problems).&lt;/p&gt;</comment>
                            <comment id="15362546" author="aholmber" created="Tue, 5 Jul 2016 14:21:15 +0000"  >&lt;p&gt;+1 on that fix. The driver previously optimistically marked hosts up even if they were not connected by the load balancing policy and known to be up. &lt;tt&gt;is not False&lt;/tt&gt; is the right way to do this. Sorry I didn&apos;t think to mention that.&lt;/p&gt;</comment>
                            <comment id="15363544" author="stefania" created="Wed, 6 Jul 2016 00:34:16 +0000"  >&lt;p&gt;No problem, thanks for confirming! &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="15363662" author="stefania" created="Wed, 6 Jul 2016 02:44:08 +0000"  >&lt;p&gt;Test results are good now, provided the Netty upgrade is rolled back from 3.9 / trunk (&lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-12072&quot; title=&quot;dtest failure in auth_test.TestAuthRoles.udf_permissions_in_selection_test&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-12072&quot;&gt;&lt;del&gt;CASSANDRA-12072&lt;/del&gt;&lt;/a&gt;).&lt;/p&gt;

&lt;p&gt;We just need the confirmation of &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=pauloricardomg&quot; class=&quot;user-hover&quot; rel=&quot;pauloricardomg&quot;&gt;pauloricardomg&lt;/a&gt; re. &lt;tt&gt;test_refresh_schema_on_timeout_error&lt;/tt&gt; and a reviewer, cc. &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=JoshuaMcKenzie&quot; class=&quot;user-hover&quot; rel=&quot;JoshuaMcKenzie&quot;&gt;JoshuaMcKenzie&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="15367306" author="stefania" created="Fri, 8 Jul 2016 06:50:16 +0000"  >&lt;p&gt;The reason why &lt;tt&gt;future.is_schema_agreed&lt;/tt&gt; is always true is probably caused by the issue described in this &lt;a href=&quot;https://github.com/datastax/python-driver/pull/615&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;pull reqeust&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="15378744" author="stefania" created="Fri, 15 Jul 2016 01:57:10 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=pauloricardomg&quot; class=&quot;user-hover&quot; rel=&quot;pauloricardomg&quot;&gt;pauloricardomg&lt;/a&gt;, welcome back! Here is a recap to help you catch up more quickly:&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;The 2.1 patch is just a driver upgrade to a custom version that only fixes the problem with python 2.7.12 (which is trivial in itself)&lt;/li&gt;
	&lt;li&gt;The 2.2 patch merges cleanly to 3.0 and there is a trivial conflict to 3.9. copyutil.py also contains the fix for &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-11979&quot; title=&quot;cqlsh copyutil should get host metadata by connected address&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-11979&quot;&gt;&lt;del&gt;CASSANDRA-11979&lt;/del&gt;&lt;/a&gt;.&lt;/li&gt;
	&lt;li&gt;The 3.9 patch contains an additional commit for CDC changes&lt;/li&gt;
	&lt;li&gt;The 3.9 patch merges cleanly to trunk&lt;/li&gt;
	&lt;li&gt;There are also dtest changes &lt;a href=&quot;https://github.com/stef1927/cassandra-dtest/tree/11850&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;here&lt;/a&gt;, of which the most notable changes are for CDC in 3.9+ and in cqlsh_tests.py &lt;tt&gt;test_refresh_schema_on_timeout_error&lt;/tt&gt;, where I removed not only the operation timed out exception but also the warning on schema mismatch, since it is not true that DOWN nodes will report a schema mismatch, see &lt;tt&gt;&lt;em&gt;get_schema_mismatches&lt;/tt&gt; in _cassandra/cluster.py&lt;/em&gt;. In view of this we should perhaps also change the warning message in cqlsh &lt;tt&gt;refresh_schema_metadata_best_effort&lt;/tt&gt; and close &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-11999&quot; title=&quot;dtest failure in cqlsh_tests.cqlsh_tests.TestCqlsh.test_refresh_schema_on_timeout_error&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-11999&quot;&gt;&lt;del&gt;CASSANDRA-11999&lt;/del&gt;&lt;/a&gt; once this is committed.&lt;/li&gt;
&lt;/ul&gt;


&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;2.1&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;2.2&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;3.0&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;3.9&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;trunk&lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/stef1927/cassandra/commits/11850-cqlsh-2.1&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;patch&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/stef1927/cassandra/commits/11850-cqlsh-2.2&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;patch&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/stef1927/cassandra/commits/11850-cqlsh-3.0&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;patch&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/stef1927/cassandra/commits/11850-cqlsh-3.9&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;patch&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/stef1927/cassandra/commits/11850-cqlsh&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;patch&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/stef1927/job/stef1927-11850-cqlsh-2.1-cqlsh-tests/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;dtest&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/stef1927/job/stef1927-11850-cqlsh-2.2-cqlsh-tests/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;dtest&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/stef1927/job/stef1927-11850-cqlsh-3.0-cqlsh-tests/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;dtest&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/stef1927/job/stef1927-11850-cqlsh-3.9-cqlsh-tests/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;dtest&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/stef1927/job/stef1927-11850-cqlsh-cqlsh-tests/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;dtest&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;
</comment>
                            <comment id="15379347" author="2012ecs41@smvdu.ac.in" created="Fri, 15 Jul 2016 13:10:53 +0000"  >&lt;p&gt;I am getting the same error.&lt;br/&gt;
have this been fixed?&lt;/p&gt;</comment>
                            <comment id="15379370" author="stefania" created="Fri, 15 Jul 2016 13:25:30 +0000"  >&lt;p&gt;Not yet. When this is fixed the resolution of this ticket becomes &quot;Resolved&quot; and the status becomes &quot;Fixed&quot;. You find the corresponding release versions to download in the fix versions. Meanwhile, you can either downgrade Python to 2.7.11 OR install an up-to-date Cassandra Python driver and disable the cqlsh embedded driver by setting the CQLSH_NO_BUNDLED environment variable to TRUE before launching clqsh, see comments above for more details.&lt;/p&gt;</comment>
                            <comment id="15380613" author="2012ecs41@smvdu.ac.in" created="Sat, 16 Jul 2016 08:11:22 +0000"  >&lt;p&gt;Thank you, it resolved the issue for now.&lt;/p&gt;</comment>
                            <comment id="15383466" author="stefania" created="Tue, 19 Jul 2016 01:55:03 +0000"  >&lt;p&gt;I&apos;ve rebased the 3.9 and trunk branches again, I noticed a (most likely) unrelated &lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/stef1927/job/stef1927-11850-cqlsh-3.9-cqlsh-tests/lastCompletedBuild/cython=yes/testReport/cqlshlib.test.test_cqlsh_completion/TestCqlshCompletion/test_complete_in_delete/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;failure&lt;/a&gt; yesterday on 3.9. It basically failed to read the prompt even if we can see it in the debug messages. I could not reproduce it locally (run it 30 times in a loop), so I&apos;ve added an additional debug message to the 3.9+ branches in case this failure happens again. &lt;/p&gt;</comment>
                            <comment id="15385017" author="pauloricardomg" created="Tue, 19 Jul 2016 22:54:53 +0000"  >&lt;p&gt;Thanks for the patch and detailed explanation! Overall it looks good, see follow-up:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;The 2.1 patch looks, can you just update to use the 2.7.2 zip now that &lt;a href=&quot;https://github.com/datastax/python-driver/pull/606&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;#606&lt;/a&gt; got in?&lt;/li&gt;
	&lt;li&gt;Similarly, can you regenerate the 2.2+ cassandra-driver libs after &lt;a href=&quot;https://github.com/datastax/python-driver/pull/617&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;#617&lt;/a&gt; was merged?&lt;/li&gt;
	&lt;li&gt;I didn&apos;t get &lt;a href=&quot;https://github.com/apache/cassandra/compare/trunk...stef1927:11850-cqlsh-2.2#diff-27e394435c04a60c58ec9d5c34397341R739&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;this change&lt;/a&gt;, is this related to this patch? won&apos;t &lt;tt&gt;prev_worker_no=-1&lt;/tt&gt; and thus &lt;tt&gt;i=0&lt;/tt&gt; always?&lt;/li&gt;
	&lt;li&gt;+1 to dtest and cdc-related changes (afaic)&lt;/li&gt;
	&lt;li&gt;The original intent of &lt;tt&gt;test_refresh_schema_on_timeout_error&lt;/tt&gt; on &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-9689&quot; title=&quot;keyspace does not show in describe list, if create query times out&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-9689&quot;&gt;&lt;del&gt;CASSANDRA-9689&lt;/del&gt;&lt;/a&gt; was to make sure a newly created keyspace/table will show up if there is a down node during the &lt;tt&gt;DDL&lt;/tt&gt; statement, but since down nodes no longer causes schema mismatches after &lt;a href=&quot;https://datastax-oss.atlassian.net/browse/PYTHON-531&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;PYTHON-531&lt;/a&gt; the schema mismatch assertions are no longer necessary (even though we still need to keep the &lt;tt&gt;--request-timeout&lt;/tt&gt; option on 2.1 dtest to avoid flakiness - see &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-10686&quot; title=&quot;cqlsh schema refresh on timeout dtest is flaky&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-10686&quot;&gt;&lt;del&gt;CASSANDRA-10686&lt;/del&gt;&lt;/a&gt;), so I renamed the test to &lt;tt&gt;test_update_schema_with_down_node&lt;/tt&gt;. Here is the &lt;a href=&quot;https://github.com/pauloricardomg/cassandra-dtest/tree/11850&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;dtest branch&lt;/a&gt; with these changes.&lt;/li&gt;
	&lt;li&gt;I also added a &lt;a href=&quot;https://github.com/pauloricardomg/cassandra/commit/02c3c25f92e395e09c66ba36010abb8e38f23d0b&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;new commit&lt;/a&gt; with the following changes:
	&lt;ul&gt;
		&lt;li&gt;Refactor &lt;tt&gt;perform_simple_statement&lt;/tt&gt; to always &lt;a href=&quot;https://github.com/pauloricardomg/cassandra/commit/02c3c25f92e395e09c66ba36010abb8e38f23d0b#diff-1cce67f7d76864f07aaf4d986d6fc051R1272&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;try to reload the schema&lt;/a&gt; if there&apos;s a mismatch in order to cover both &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-9689&quot; title=&quot;keyspace does not show in describe list, if create query times out&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-9689&quot;&gt;&lt;del&gt;CASSANDRA-9689&lt;/del&gt;&lt;/a&gt; and &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-10686&quot; title=&quot;cqlsh schema refresh on timeout dtest is flaky&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-10686&quot;&gt;&lt;del&gt;CASSANDRA-10686&lt;/del&gt;&lt;/a&gt;.&lt;/li&gt;
		&lt;li&gt;&lt;a href=&quot;https://github.com/pauloricardomg/cassandra/commit/02c3c25f92e395e09c66ba36010abb8e38f23d0b#diff-1cce67f7d76864f07aaf4d986d6fc051L724&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;Remove&lt;/a&gt; the schema mismatch check on startup, since this is no longer necessary after &lt;a href=&quot;https://github.com/datastax/python-driver/pull/349&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;PYTHON-303&lt;/a&gt;.&lt;/li&gt;
		&lt;li&gt;Update the schema mismatch warning &lt;a href=&quot;https://github.com/pauloricardomg/cassandra/commit/02c3c25f92e395e09c66ba36010abb8e38f23d0b#diff-1cce67f7d76864f07aaf4d986d6fc051R1276&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;message&lt;/a&gt;&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
	&lt;li&gt;It would be nice to add a dtest to verify that the schema mismatch warning is being print on a proper schema mismatch but I didn&apos;t find a simple way to induce a schema mismatch without adding a special test flag on C* which is not an ideal solution. I tested manually by disabling the &lt;tt&gt;schema_version&lt;/tt&gt; update on the &lt;tt&gt;system.peers&lt;/tt&gt; table, and the warning is being printed correctly. We could probably achieve that easily with byteman but since that is not yet integrated with dtests let&apos;s maybe leave it for another ticket.&lt;/li&gt;
	&lt;li&gt;Submitted multiplexer 100x runs for &lt;a href=&quot;https://cassci.datastax.com/view/Parameterized/job/parameterized_dtest_multiplexer/176/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;2.1&lt;/a&gt; and &lt;a href=&quot;https://cassci.datastax.com/view/Parameterized/job/parameterized_dtest_multiplexer/173/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;trunk&lt;/a&gt; so we can remove the &lt;tt&gt;@known_failure&lt;/tt&gt; annotations and close &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-11999&quot; title=&quot;dtest failure in cqlsh_tests.cqlsh_tests.TestCqlsh.test_refresh_schema_on_timeout_error&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-11999&quot;&gt;&lt;del&gt;CASSANDRA-11999&lt;/del&gt;&lt;/a&gt; and &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-10884&quot; title=&quot;test_refresh_schema_on_timeout_error dtest flapping on CassCI&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-10884&quot;&gt;&lt;del&gt;CASSANDRA-10884&lt;/del&gt;&lt;/a&gt;.&lt;/li&gt;
	&lt;li&gt;It would be nice if you could maybe extract &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-11979&quot; title=&quot;cqlsh copyutil should get host metadata by connected address&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-11979&quot;&gt;&lt;del&gt;CASSANDRA-11979&lt;/del&gt;&lt;/a&gt; to a separate commit to improve traceability?&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Submitted tests with updates below:&lt;/p&gt;
&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;2.1&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;2.2&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;3.0&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;3.9&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;trunk&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;dtest&lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/apache/cassandra/compare/cassandra-2.1...pauloricardomg:11850-cqlsh-2.1&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;branch&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/apache/cassandra/compare/cassandra-2.2...pauloricardomg:11850-cqlsh-2.2&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;branch&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/apache/cassandra/compare/cassandra-3.0...pauloricardomg:11850-cqlsh-3.0&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;branch&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/apache/cassandra/compare/cassandra-3.9...pauloricardomg:11850-cqlsh-3.9&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;branch&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/apache/cassandra/compare/trunk...pauloricardomg:11850-cqlsh&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;branch&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/riptano/cassandra-dtest/compare/master...pauloricardomg:11850&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;branch&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/paulomotta/job/pauloricardomg-11850-cqlsh-2.1-dtest/lastCompletedBuild/testReport/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;dtest&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/paulomotta/job/pauloricardomg-11850-cqlsh-2.2-dtest/lastCompletedBuild/testReport/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;dtest&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/paulomotta/job/pauloricardomg-11850-cqlsh-3.0-dtest/lastCompletedBuild/testReport/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;dtest&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/paulomotta/job/pauloricardomg-11850-cqlsh-3.9-dtest/lastCompletedBuild/testReport/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;dtest&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/paulomotta/job/pauloricardomg-11850-cqlsh-dtest/lastCompletedBuild/testReport/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;dtest&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;
</comment>
                            <comment id="15387093" author="stefania" created="Thu, 21 Jul 2016 03:40:53 +0000"  >&lt;p&gt;Thanks for the review.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;The 2.1 patch looks, can you just update to use the 2.7.2 zip now that #606 got in?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Done.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;Similarly, can you regenerate the 2.2+ cassandra-driver libs after #617 was merged?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Done.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;I didn&apos;t get this change, is this related to this patch? won&apos;t prev_worker_no=-1 and thus i=0 always?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Sorry I should have mentioned this. During debugging I noticed that failed attempts were always sent to child process no. 0. This change ensures that failed attempts are sent to the child process following the one that failed. The worker no. is updated in the for loop and set to the worker the range is sent to. So if we process the range twice, we should send it to the next worker no.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;+1 to dtest and cdc-related changes (afaic)&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Thanks, they should be straightforward.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;The original intent of test_refresh_schema_on_timeout_error on &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-9689&quot; title=&quot;keyspace does not show in describe list, if create query times out&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-9689&quot;&gt;&lt;del&gt;CASSANDRA-9689&lt;/del&gt;&lt;/a&gt; was to make sure a newly created keyspace/table will show up if there is a down node during the DDL statement, but since down nodes no longer causes schema mismatches after PYTHON-531 the schema mismatch assertions are no longer necessary (even though we still need to keep the --request-timeout option on 2.1 dtest to avoid flakiness - see &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-10686&quot; title=&quot;cqlsh schema refresh on timeout dtest is flaky&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-10686&quot;&gt;&lt;del&gt;CASSANDRA-10686&lt;/del&gt;&lt;/a&gt;), so I renamed the test to test_update_schema_with_down_node. Here is the dtest branch with these changes.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;OK, thanks for the explanation.&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;I also added a new commit with the following changes:&lt;br/&gt;
        Refactor perform_simple_statement to always try to reload the schema if there&apos;s a mismatch in order to cover both &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-9689&quot; title=&quot;keyspace does not show in describe list, if create query times out&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-9689&quot;&gt;&lt;del&gt;CASSANDRA-9689&lt;/del&gt;&lt;/a&gt; and &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-10686&quot; title=&quot;cqlsh schema refresh on timeout dtest is flaky&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-10686&quot;&gt;&lt;del&gt;CASSANDRA-10686&lt;/del&gt;&lt;/a&gt;.&lt;br/&gt;
        Remove the schema mismatch check on startup, since this is no longer necessary after PYTHON-303.&lt;br/&gt;
        Update the schema mismatch warning message&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Your changes LGTM, I&apos;ve incorporated them into my branches.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;It would be nice to add a dtest to verify that the schema mismatch warning is being print on a proper schema mismatch but I didn&apos;t find a simple way to induce a schema mismatch without adding a special test flag on C* which is not an ideal solution. I tested manually by disabling the schema_version update on the system.peers table, and the warning is being printed correctly. We could probably achieve that easily with byteman but since that is not yet integrated with dtests let&apos;s maybe leave it for another ticket.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Thanks for the manual tests. Perhaps we can open a ticket to create a test once byteman is integrated with dtests?&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;Submitted multiplexer 100x runs for 2.1 and trunk so we can remove the @known_failure annotations and close &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-11999&quot; title=&quot;dtest failure in cqlsh_tests.cqlsh_tests.TestCqlsh.test_refresh_schema_on_timeout_error&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-11999&quot;&gt;&lt;del&gt;CASSANDRA-11999&lt;/del&gt;&lt;/a&gt; and &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-10884&quot; title=&quot;test_refresh_schema_on_timeout_error dtest flapping on CassCI&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-10884&quot;&gt;&lt;del&gt;CASSANDRA-10884&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;OK, I think you&apos;ve already removed the known failures in you commit. I will close those tickets when we commit this.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;It would be nice if you could maybe extract &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-11979&quot; title=&quot;cqlsh copyutil should get host metadata by connected address&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-11979&quot;&gt;&lt;del&gt;CASSANDRA-11979&lt;/del&gt;&lt;/a&gt; to a separate commit to improve traceability?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I&apos;ve extracted the change and put it on a separate branch. Details are on &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-11979&quot; title=&quot;cqlsh copyutil should get host metadata by connected address&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-11979&quot;&gt;&lt;del&gt;CASSANDRA-11979&lt;/del&gt;&lt;/a&gt;, I&apos;ve put you as reviewer.&lt;/p&gt;

&lt;p&gt;&amp;#8211;&lt;/p&gt;

&lt;p&gt;Here are the up-to-date branches and latest tests results:&lt;/p&gt;

&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;2.1&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;2.2&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;3.0&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;3.9&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;trunk&lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/stef1927/cassandra/commits/11850-cqlsh-2.1&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;patch&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/stef1927/cassandra/commits/11850-cqlsh-2.2&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;patch&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/stef1927/cassandra/commits/11850-cqlsh-3.0&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;patch&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/stef1927/cassandra/commits/11850-cqlsh-3.9&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;patch&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/stef1927/cassandra/commits/11850-cqlsh&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;patch&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/stef1927/job/stef1927-11850-cqlsh-2.1-cqlsh-tests/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;dtest&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/stef1927/job/stef1927-11850-cqlsh-2.2-cqlsh-tests/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;dtest&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/stef1927/job/stef1927-11850-cqlsh-3.0-cqlsh-tests/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;dtest&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/stef1927/job/stef1927-11850-cqlsh-3.9-cqlsh-tests/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;dtest&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/stef1927/job/stef1927-11850-cqlsh-cqlsh-tests/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;dtest&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;
</comment>
                            <comment id="15388684" author="stefania" created="Fri, 22 Jul 2016 00:36:00 +0000"  >&lt;p&gt;I&apos;ve created the dtest pull request &lt;a href=&quot;https://github.com/riptano/cassandra-dtest/pull/1120&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;here&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="15388849" author="pauloricardomg" created="Fri, 22 Jul 2016 03:57:24 +0000"  >&lt;blockquote&gt;&lt;p&gt;During debugging I noticed that failed attempts were always sent to child process no. 0. This change ensures that failed attempts are sent to the child process following the one that failed.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;ah OK, now it makes sense, thanks for the explanation!&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;Thanks for the manual tests. Perhaps we can open a ticket to create a test once byteman is integrated with dtests?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Sure, I created &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-12272&quot; title=&quot;Add byteman dtest for cqlsh schema mismatch handling&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-12272&quot;&gt;CASSANDRA-12272&lt;/a&gt; for this matter and assigned to &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=cassandra-te&quot; class=&quot;user-hover&quot; rel=&quot;cassandra-te&quot;&gt;cassandra-te&lt;/a&gt; so it&apos;s not forgotten (hope it&apos;s OK &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=philipthompson&quot; class=&quot;user-hover&quot; rel=&quot;philipthompson&quot;&gt;philipthompson&lt;/a&gt; &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;)&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;OK, I think you&apos;ve already removed the known failures in you commit. I will close those tickets when we commit this.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;The multiplexer 3 x 100 run looks good for &lt;a href=&quot;https://cassci.datastax.com/view/Parameterized/job/parameterized_dtest_multiplexer/173/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;trunk&lt;/a&gt;, but on &lt;a href=&quot;https://cassci.datastax.com/view/Parameterized/job/parameterized_dtest_multiplexer/177/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;2.1&lt;/a&gt; there are a few test runs failing with &lt;tt&gt;21 Jul 2016 09:39:25 [node1] Missing: [&apos;127.0.0.2 is now [dead|DOWN]&apos;]:&lt;/tt&gt;, but it seems to be some environmental problem unrelated to this particular test so I guess we&apos;re safe to remove the flaky annotations and close &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-11999&quot; title=&quot;dtest failure in cqlsh_tests.cqlsh_tests.TestCqlsh.test_refresh_schema_on_timeout_error&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-11999&quot;&gt;&lt;del&gt;CASSANDRA-11999&lt;/del&gt;&lt;/a&gt;/&lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-10884&quot; title=&quot;test_refresh_schema_on_timeout_error dtest flapping on CassCI&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-10884&quot;&gt;&lt;del&gt;CASSANDRA-10884&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;Can you please include the excerpt below on your dtest PR to hopefully increase resilience to this?&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;diff --git a/cqlsh_tests/cqlsh_tests.py b/cqlsh_tests/cqlsh_tests.py
index 721d81f..c9f03c8 100644
--- a/cqlsh_tests/cqlsh_tests.py
+++ b/cqlsh_tests/cqlsh_tests.py
@@ -1468,7 +1468,7 @@ Tracing session:&quot;&quot;&quot;)
         @jira_ticket CASSANDRA-9689
         &quot;&quot;&quot;
         self.cluster.populate(3)
-        self.cluster.start(wait_for_binary_proto=True)
+        self.cluster.start(wait_for_binary_proto=True, wait_other_notice=True)
 
         node1, node2, node3 = self.cluster.nodelist()
         node2.stop(wait_other_notice=True)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;blockquote&gt;&lt;p&gt;I&apos;ve extracted the change and put it on a separate branch. Details are on &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-11979&quot; title=&quot;cqlsh copyutil should get host metadata by connected address&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-11979&quot;&gt;&lt;del&gt;CASSANDRA-11979&lt;/del&gt;&lt;/a&gt;, I&apos;ve put you as reviewer.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Sounds good, will follow-up there.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;Here are the up-to-date branches and latest tests results:&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Final patch and test results look good. The only final nit is that I&apos;m still a bit unsure if this meets the critical requirement to go on 2.1 though, WDYT &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=Stefania&quot; class=&quot;user-hover&quot; rel=&quot;stefania&quot;&gt;Stefania&lt;/a&gt;? In particular I&apos;m not sure at which point we stop supporting python upgrades. &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=thobbs&quot; class=&quot;user-hover&quot; rel=&quot;thobbs&quot;&gt;thobbs&lt;/a&gt; Would you have any suggestion on this?&lt;/p&gt;</comment>
                            <comment id="15389761" author="thobbs" created="Fri, 22 Jul 2016 16:19:36 +0000"  >&lt;blockquote&gt;&lt;p&gt;The only final nit is that I&apos;m still a bit unsure if this meets the critical requirement to go on 2.1 though, WDYT Stefania? In particular I&apos;m not sure at which point we stop supporting python upgrades. Tyler Hobbs Would you have any suggestion on this?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I just hit this problem yesterday after upgrading to the latest Ubuntu.  The workarounds are not simple &amp;#8211; you have to upgrade the bundled python driver, and if you try to upgrade it to the latest python driver release, you need to also modify cqlsh to remove references to &lt;tt&gt;PagedResult&lt;/tt&gt;.  Given that this completely breaks cqlsh in 2.1 on a common Linux distro and the workaround sucks, I would argue that this is just critical enough to be included in 2.1.&lt;/p&gt;</comment>
                            <comment id="15390091" author="pauloricardomg" created="Fri, 22 Jul 2016 19:40:53 +0000"  >&lt;p&gt;Thanks for the input Tyler, I agree this is critical enough to go on 2.1. Marking as ready to commit.&lt;/p&gt;

&lt;p&gt;ps: Stefania, can you just include the excerpt above in the dtest PR? Thanks!&lt;/p&gt;</comment>
                            <comment id="15391222" author="stefania" created="Mon, 25 Jul 2016 00:52:43 +0000"  >&lt;p&gt;Thanks Paulo and Tyler. Committed to 2.1 as 3d3359eb95eebff48c4966e3e23f7efb4af0f535 and merged upwards. PR updated and merged.&lt;/p&gt;</comment>
                            <comment id="15490146" author="zouzias" created="Wed, 14 Sep 2016 11:05:42 +0000"  >&lt;p&gt;I run into this problem yesterday.&lt;/p&gt;

&lt;p&gt;As of today, Cassandra versions 2.1.16, 2.2.8, 3.0.9, 3.8 (which solve this issue) are not released. A workaround is to downgrade python 2.7 to version 2.7.10 (tested for Cassandra 2.2.7)&lt;/p&gt;</comment>
                            <comment id="15491939" author="stefania" created="Thu, 15 Sep 2016 00:51:40 +0000"  >&lt;p&gt;You are correct, none of the versions with this fix have been released yet. The easiest workaround is, as you said, to downgrade Python. I&apos;m pretty sure 2.7.11 should also be fine, since I was only able to reproduce this problem with 2.7.12.&lt;/p&gt;

&lt;p&gt;Installing version 3.5.0 or later of the Cassandra python driver is also an option, but there were some other minor issues that this patch fixed. Therefore, it is recommended to downgrade Python, if at all possible. If this is not possible, the driver can be installed by following these &lt;a href=&quot;http://datastax.github.io/python-driver/installation.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;instructions&lt;/a&gt;. Further, cqlsh will only override its internal driver with a version installed elsewhere by setting the environment variable &lt;tt&gt;CQLSH_NO_BUNDLED&lt;/tt&gt; to &lt;tt&gt;TRUE&lt;/tt&gt;.&lt;/p&gt;</comment>
                            <comment id="15692142" author="0nst" created="Thu, 24 Nov 2016 04:17:19 +0000"  >&lt;p&gt;As of today 24th Nov 2016 the problem still exists with:&lt;/p&gt;

&lt;p&gt;Python 2.7.12&lt;br/&gt;
Cassandra 3.6&lt;br/&gt;
Ubuntu 16.04.1 LTS&lt;/p&gt;

&lt;p&gt;Temporary fix is:&lt;/p&gt;

&lt;p&gt;apt-get install python-pip&lt;br/&gt;
pip install cassandra-driver&lt;br/&gt;
export CQLSH_NO_BUNDLED=TRUE&lt;/p&gt;</comment>
                            <comment id="15692164" author="stefania" created="Thu, 24 Nov 2016 04:33:05 +0000"  >&lt;p&gt;The earliest release of the 3.X series with this fix is 3.8. The current release of the 3.X family is 3.9, which is available for download.&lt;/p&gt;</comment>
                            <comment id="15694645" author="0nst" created="Fri, 25 Nov 2016 02:33:59 +0000"  >&lt;p&gt;Thanks for the info, indeed an upgrade to 3.9 fixed it. I had assumed that &lt;a href=&quot;http://cassandra.apache.org/download/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://cassandra.apache.org/download/&lt;/a&gt; was the most updated version:&lt;/p&gt;

&lt;p&gt;echo &quot;deb &lt;a href=&quot;http://www.apache.org/dist/cassandra/debian&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://www.apache.org/dist/cassandra/debian&lt;/a&gt; 36x main&quot; | sudo tee -a /etc/apt/sources.list.d/cassandra.sources.list&lt;/p&gt;

&lt;p&gt;Should be replaced with &lt;/p&gt;

&lt;p&gt;echo &quot;deb &lt;a href=&quot;http://www.apache.org/dist/cassandra/debian&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://www.apache.org/dist/cassandra/debian&lt;/a&gt; 39x main&quot; | sudo tee -a /etc/apt/sources.list.d/cassandra.sources.list&lt;/p&gt;

&lt;p&gt;I&apos;m looking forward to having a good play with Cassandra. &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="15694738" author="stefania" created="Fri, 25 Nov 2016 03:41:57 +0000"  >&lt;p&gt;Sure, have fun with Cassandra. &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;I think the &lt;tt&gt;36x&lt;/tt&gt; is meant as an example on the documentation download page because it says &lt;em&gt;for example for version 3.6&lt;/em&gt;, just before giving the sample command. I don&apos;t think we update the documentation for each release, but just in case I am cc-ing &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mshuler&quot; class=&quot;user-hover&quot; rel=&quot;mshuler&quot;&gt;mshuler&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="15703006" author="mshuler" created="Mon, 28 Nov 2016 20:16:16 +0000"  >&lt;p&gt;Thanks - this is just an example, which does not get automatically updated. I just committed an update to the site for the latest debian repo &lt;tt&gt;39x&lt;/tt&gt; for the example.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10032">
                    <name>Blocker</name>
                                            <outwardlinks description="blocks">
                                        <issuelink>
            <issuekey id="12954731">CASSANDRA-11465</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                            <outwardlinks description="duplicates">
                                        <issuelink>
            <issuekey id="12922490">CASSANDRA-10884</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12978198">CASSANDRA-11999</issuekey>
        </issuelink>
                            </outwardlinks>
                                                                <inwardlinks description="is duplicated by">
                                        <issuelink>
            <issuekey id="12995416">CASSANDRA-12402</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                            <issuelinktype id="12310010">
                    <name>Incorporates</name>
                                            <outwardlinks description="incorporates">
                                        <issuelink>
            <issuekey id="12981081">CASSANDRA-12041</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12976900">CASSANDRA-11979</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[stefania]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 51 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2y91z:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>pauloricardomg</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[pauloricardomg]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12962"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>