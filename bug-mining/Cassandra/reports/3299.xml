<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 22:50:02 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-7910] wildcard prepared statements are incorrect after a column is added to the table</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-7910</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;1. Prepare a statement with a wildcard in the select clause.&lt;br/&gt;
2. Alter the table - add a column&lt;br/&gt;
3. execute the prepared statement&lt;/p&gt;

&lt;p&gt;Expected result - get all the columns including the new column&lt;br/&gt;
Actual result - get the columns except the new column&lt;br/&gt;
Attached a test using cassandra-unit&lt;/p&gt;</description>
                <environment></environment>
        <key id="12740711">CASSANDRA-7910</key>
            <summary>wildcard prepared statements are incorrect after a column is added to the table</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10003" iconUrl="https://issues.apache.org/jira/images/icons/priorities/trivial.svg">Low</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="thobbs">Tom Hobbs</assignee>
                                    <reporter username="odpeer">Oded Peer</reporter>
                        <labels>
                    </labels>
                <created>Thu, 11 Sep 2014 08:10:58 +0000</created>
                <updated>Wed, 6 Nov 2019 21:57:55 +0000</updated>
                            <resolved>Fri, 2 Jan 2015 18:01:46 +0000</resolved>
                                        <fixVersion>2.1.3</fixVersion>
                                        <due></due>
                            <votes>2</votes>
                                    <watches>12</watches>
                                                                                                                <comments>
                            <comment id="14131265" author="brandon.williams" created="Fri, 12 Sep 2014 08:25:41 +0000"  >&lt;p&gt;Version, please&lt;/p&gt;</comment>
                            <comment id="14131617" author="yukim" created="Fri, 12 Sep 2014 14:45:22 +0000"  >&lt;p&gt;I think this relates to &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-7566&quot; title=&quot;DROP TABLE should also drop prepared statements associated to&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-7566&quot;&gt;&lt;del&gt;CASSANDRA-7566&lt;/del&gt;&lt;/a&gt;. Maybe the best thing to do is to just drop prepared when there is any schema change.&lt;/p&gt;</comment>
                            <comment id="14131734" author="iamaleksey" created="Fri, 12 Sep 2014 16:47:05 +0000"  >&lt;p&gt;Cannot just sneakily change the number of columns returned, because of Skip_metadata flag in native proto v3, for one.&lt;/p&gt;

&lt;p&gt;Agree with Yuki here. This would be the right thing to do (maybe not on &lt;b&gt;any&lt;/b&gt; table change - we don&apos;t care about options stuff being changed).&lt;/p&gt;</comment>
                            <comment id="14131740" author="iamaleksey" created="Fri, 12 Sep 2014 16:51:24 +0000"  >&lt;p&gt;And not because of this issue in particular - I don&apos;t think that this, here, itself is a big deal. I&apos;d say it&apos;s the expected behavior.&lt;/p&gt;

&lt;p&gt;But when you drop a column, for example, we should drop the statements from the cache, or else.&lt;/p&gt;</comment>
                            <comment id="14262485" author="thobbs" created="Wed, 31 Dec 2014 23:13:58 +0000"  >&lt;p&gt;The attached patches invalidate any prepared statements that deal with the affected table whenever columns are added, dropped, or altered.  The 2.1 patch also backports a minor refactor of IMigrationListener from trunk.&lt;/p&gt;

&lt;p&gt;I&apos;ve pushed a &lt;a href=&quot;https://github.com/thobbs/cassandra-dtest/tree/CASSANDRA-7910&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;dtest branch&lt;/a&gt; as well.&lt;/p&gt;</comment>
                            <comment id="14262560" author="iamaleksey" created="Thu, 1 Jan 2015 14:27:41 +0000"  >&lt;p&gt;LGTM, +1&lt;/p&gt;</comment>
                            <comment id="14263090" author="thobbs" created="Fri, 2 Jan 2015 18:01:46 +0000"  >&lt;p&gt;Thanks, committed as 9f613ab42c7 and pushed the dtest changes.&lt;/p&gt;</comment>
                            <comment id="14505485" author="itayadler" created="Tue, 21 Apr 2015 18:42:36 +0000"  >&lt;p&gt;Is this also fixed for 2.0.14?&lt;/p&gt;</comment>
                            <comment id="14506627" author="slebresne" created="Wed, 22 Apr 2015 08:15:40 +0000"  >&lt;p&gt;No, it&apos;s not fixed on the 2.0 branch. We decided it was easy enough to workaround to not take any risk there.&lt;/p&gt;</comment>
                            <comment id="14705694" author="kay-johansen" created="Thu, 20 Aug 2015 20:23:21 +0000"  >&lt;p&gt;What is the workaround?&lt;/p&gt;</comment>
                            <comment id="14706404" author="slebresne" created="Fri, 21 Aug 2015 08:34:34 +0000"  >&lt;blockquote&gt;&lt;p&gt;What is the workaround?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Don&apos;t use a wildcard, list the columns your care about in the statement. I think it&apos;s good practice anyway. &lt;/p&gt;</comment>
                            <comment id="14706845" author="kay-johansen" created="Fri, 21 Aug 2015 15:12:22 +0000"  >&lt;p&gt;Makes sense, thank you&lt;/p&gt;</comment>
                            <comment id="14715196" author="zznate" created="Wed, 26 Aug 2015 17:29:56 +0000"  >&lt;p&gt;Pretty sure this issue in conjunction with the changes introduced in &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-9532&quot; title=&quot;Provide access to select statement&amp;#39;s real column definitions&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-9532&quot;&gt;&lt;del&gt;CASSANDRA-9532&lt;/del&gt;&lt;/a&gt; is triggering the following error after an &lt;tt&gt;2.0.13&lt;/tt&gt; to &lt;tt&gt;2.0.16&lt;/tt&gt; upgrade on one node of a six node cluster:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;ERROR [Native-Transport-Requests:11] 2015-07-29 18:00:50,344 Message.java (line 403) Unexpected exception during request; channel = [id: 0x599799a6, /[redacted]:38306 =&amp;gt; /[redacted]:9042]
java.lang.AssertionError
at org.apache.cassandra.cql3.ResultSet.addRow(ResultSet.java:63)
at org.apache.cassandra.cql3.statements.Selection$ResultSetBuilder.build(Selection.java:330)
at org.apache.cassandra.cql3.statements.SelectStatement.process(SelectStatement.java:1189)
at org.apache.cassandra.cql3.statements.SelectStatement.processResults(SelectStatement.java:309)
at org.apache.cassandra.cql3.statements.SelectStatement.execute(SelectStatement.java:281)
at org.apache.cassandra.cql3.statements.SelectStatement.execute(SelectStatement.java:241)
at org.apache.cassandra.cql3.statements.SelectStatement.execute(SelectStatement.java:68)
at org.apache.cassandra.cql3.QueryProcessor.processStatement(QueryProcessor.java:158)
at org.apache.cassandra.cql3.QueryProcessor.process(QueryProcessor.java:175)
at org.apache.cassandra.transport.messages.QueryMessage.execute(QueryMessage.java:119)
at org.apache.cassandra.transport.Message$Dispatcher.messageReceived(Message.java:321)
at org.jboss.netty.channel.SimpleChannelUpstreamHandler.handleUpstream(SimpleChannelUpstreamHandler.java:70)
at org.jboss.netty.channel.DefaultChannelPipeline.sendUpstream(DefaultChannelPipeline.java:564)
at org.jboss.netty.channel.DefaultChannelPipeline$DefaultChannelHandlerContext.sendUpstream(DefaultChannelPipeline.java:791)
at org.jboss.netty.handler.execution.ChannelUpstreamEventRunnable.doRun(ChannelUpstreamEventRunnable.java:43)
at org.jboss.netty.handler.execution.ChannelEventRunnable.run(ChannelEventRunnable.java:67)
at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1145)
at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:615)
at java.lang.Thread.run(Thread.java:745)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Note that we passed the statement parsing phase and made it all the way down into an assertion error on the number of returned columns vs. what metadata feels should be there. The rest of the cluster was moved up &lt;tt&gt;2.0.15&lt;/tt&gt; (after some bisecting brought up the scope of &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-9532&quot; title=&quot;Provide access to select statement&amp;#39;s real column definitions&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-9532&quot;&gt;&lt;del&gt;CASSANDRA-9532&lt;/del&gt;&lt;/a&gt;) and has been running w/o issue. The one node is still running at &lt;tt&gt;2.0.16&lt;/tt&gt; with transports off so we can gather some debugging information with a custom build we just put up (for which we&apos;ll enable binary for a bit to capture samples).&lt;/p&gt;

&lt;p&gt;Given the impedance mismatch between these two issues and versions, I&apos;m putting this up here for posterity more than looking for a re-open. I&apos;ll update if we nail down a specific case that can easily produce the error and provide a work-around (most likely not using &lt;tt&gt;SELECT *...&lt;/tt&gt; as previously mentioned). If we can destill something into a patch, we&apos;ll create a new issue and put it there. &lt;/p&gt;</comment>
                            <comment id="15026795" author="omichallat" created="Wed, 25 Nov 2015 13:51:08 +0000"  >&lt;p&gt;There&apos;s still an issue if multiple clients are connected to the same host. The first client to execute the query after the cache was invalidated will receive an UNPREPARED response, re-prepare, and update its local metadata. But other clients might miss it entirely (the MD5 hasn&apos;t changed), and they will keep using their old metadata.&lt;/p&gt;</comment>
                            <comment id="15026957" author="thobbs" created="Wed, 25 Nov 2015 15:48:25 +0000"  >&lt;p&gt;Hmm, that&apos;s a good point.  Perhaps we should include a hash of the result set metadata (in some way) in the prepared statement ID?&lt;/p&gt;</comment>
                            <comment id="15028357" author="slebresne" created="Thu, 26 Nov 2015 08:24:02 +0000"  >&lt;p&gt;That&apos;s an idea worth discussing but please open a separate ticket for this or this&apos;ll fall through the cracks.&lt;/p&gt;</comment>
                            <comment id="15031585" author="omichallat" created="Mon, 30 Nov 2015 09:51:05 +0000"  >&lt;p&gt;Created &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-10786&quot; title=&quot;Include hash of result set metadata in prepared statement id&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-10786&quot;&gt;&lt;del&gt;CASSANDRA-10786&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                                                <inwardlinks description="is duplicated by">
                                        <issuelink>
            <issuekey id="12756946">CASSANDRA-8353</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12727960">CASSANDRA-7566</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                            <issuelinktype id="12310051">
                    <name>Supercedes</name>
                                                                <inwardlinks description="is superceded by">
                                        <issuelink>
            <issuekey id="12916909">CASSANDRA-10786</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12689729" name="7910-2.1.txt" size="16236" author="thobbs" created="Wed, 31 Dec 2014 23:13:58 +0000"/>
                            <attachment id="12689730" name="7910-trunk.txt" size="6058" author="thobbs" created="Wed, 31 Dec 2014 23:13:58 +0000"/>
                            <attachment id="12667964" name="PreparedStatementAfterAddColumnTest.java" size="1468" author="odpeer" created="Thu, 11 Sep 2014 08:10:58 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[thobbs]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12313922" key="jira.plugin.projectspecificselectfield.jpssf:multicftype">
                        <customfieldname>Impacts</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="13101"><![CDATA[Clients]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 51 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1zwzr:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>aleksey</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[aleksey]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12961"><![CDATA[Low]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>