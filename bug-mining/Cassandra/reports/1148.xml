<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 22:23:11 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-3227] cassandra-cli use micro second timestamp, but CQL use milli second</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-3227</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;cassandra-cli set micro second timestamp by FBUtilities.timestampMicros. But CQL insert or update operation set milli second timestamp by AbstractModification.getTimestamp.&lt;/p&gt;

&lt;p&gt;If you register data by cassandra-cli, you can&apos;t update data by CQL. Because CQL timestamp is judged as past time.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12523482">CASSANDRA-3227</key>
            <summary>cassandra-cli use micro second timestamp, but CQL use milli second</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10002" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Normal</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="jbellis">Jonathan Ellis</assignee>
                                    <reporter username="sabro">Sabro Boucher</reporter>
                        <labels>
                            <label>cql</label>
                    </labels>
                <created>Sun, 18 Sep 2011 15:55:13 +0000</created>
                <updated>Tue, 16 Apr 2019 09:32:50 +0000</updated>
                            <resolved>Thu, 22 Sep 2011 03:56:13 +0000</resolved>
                                        <fixVersion>1.0.0</fixVersion>
                                    <component>Legacy/CQL</component>
                        <due></due>
                            <votes>1</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="13107590" author="jbellis" created="Mon, 19 Sep 2011 02:18:32 +0000"  >&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;+    - CQL inserts/updates now generate microsecond resolution timestamps
+      by default, instead of millisecond.
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Adds ClientState.getTimestamp to go the extra mile:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;+    /**
+     * This clock guarantees that updates from a given client will be ordered in the sequence seen,
+     * even if multiple updates happen in the same millisecond.  This can be useful when a client
+     * wants to perform multiple updates to a single column.
+     */
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="13107701" author="slebresne" created="Mon, 19 Sep 2011 08:45:10 +0000"  >&lt;p&gt;I think this breaks rolling upgrade for anyone using CQL, since during the time where this is a mix a node pre and post this patch, columns will get either micro or milli seconds timestamps depending on the coordinator. &lt;/p&gt;</comment>
                            <comment id="13107830" author="jbellis" created="Mon, 19 Sep 2011 13:56:57 +0000"  >&lt;p&gt;I&apos;m happy to note this in NEWS.  If this is a problem for your workload, you can do a non-rolling restart.&lt;/p&gt;</comment>
                            <comment id="13107897" author="slebresne" created="Mon, 19 Sep 2011 15:25:14 +0000"  >&lt;p&gt;Works for me but more because &quot;we either do it now or never and leaving it to milliseconds would really sucks&quot; than out of sheer enthusiasm towards the idea.&lt;/p&gt;

&lt;p&gt;As for the patch, I&apos;m not too sure about this clientState.getTimestamp(). A clientState is a potentially a long leaving object, it lasts as long as the connection to a given client last. Since the patch only initialize to the current time but then update by +1 on every call disregarding of the actual time, it seems the timestamp will get completely desynchronized quickly. Or am I misunderstanding this ?&lt;/p&gt;</comment>
                            <comment id="13107912" author="jbellis" created="Mon, 19 Sep 2011 15:35:10 +0000"  >&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;+    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;long&lt;/span&gt; getTimestamp()
+    {
+        &lt;span class=&quot;code-object&quot;&gt;long&lt;/span&gt; current = &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.currentTimeMillis() * 1000;
+        clock = clock &amp;gt;= current ? clock + 1 : current;
+        &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; clock;
+    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I may be missing something obvious, but my intention was to only use the +1 path if it needs to to avoid a conflict.  (And as soon as wall-clock time exceeds the +1 path, it switches back.)&lt;/p&gt;</comment>
                            <comment id="13107922" author="slebresne" created="Mon, 19 Sep 2011 15:47:58 +0000"  >&lt;blockquote&gt;&lt;p&gt;I may be missing something obvious,&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Nah, but I probably need to see a doctor for that dyslexia.&lt;/p&gt;

&lt;p&gt;+1 with the upgrade warning in NEWS&lt;/p&gt;</comment>
                            <comment id="13112150" author="sabro" created="Wed, 21 Sep 2011 21:40:56 +0000"  >&lt;p&gt;Thank you. The patch fixed the problem.&lt;br/&gt;
&quot;aa-bb&quot; is registered in unpatched cassandra.&lt;br/&gt;
&quot;cc-dd&quot; is registered in patched cassandra.&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;[default@QuestWorld] list Globalization;
Using default limit of 100
-------------------
RowKey: 537570706f72746564
=&amp;gt; (column=aa-bb, value=cc, timestamp=1316640431837)
=&amp;gt; (column=cc-dd, value=ee, timestamp=1316640612801000)
=&amp;gt; (column=en-UK, value=en, timestamp=1316356279874416)
=&amp;gt; (column=en-US, value=en, timestamp=1312220986047000)
=&amp;gt; (column=fr-FR, value=fl, timestamp=1316356768334)
=&amp;gt; (column=ja-JP, value=ja, timestamp=1312220978873000)
=&amp;gt; (column=ko-kr, value=no, timestamp=1316356622692000)
=&amp;gt; (column=mm-nn, value=ss, timestamp=1316640580750399)
=&amp;gt; (column=yy-zz, value=xx, timestamp=1316640399778399)
-------------------
RowKey: ffffffffed
=&amp;gt; (column=it-CH, value=it, timestamp=1316356541245000)

2 Rows Returned.
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="13112307" author="jbellis" created="Thu, 22 Sep 2011 03:56:13 +0000"  >&lt;p&gt;(committed)&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12495008" name="3227.txt" size="7017" author="jbellis" created="Mon, 19 Sep 2011 02:18:32 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[jbellis]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>4008</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            14 years, 9 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0ghcv:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>94242</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>sabro</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[sabro]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12962"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>