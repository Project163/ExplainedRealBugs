<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 23:13:17 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-15045] Fix index summary redistribution compaction cancellation issues</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-15045</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;We can&apos;t cancel ongoing index summary redistributions currently due to &lt;tt&gt;CompactionInfo&lt;/tt&gt; returning null for &lt;tt&gt;getTableMetadata/getCFMetaData&lt;/tt&gt; &lt;a href=&quot;https://github.com/apache/cassandra/blob/67d613204fa4fb9584f11ec9886a0e7a0d622e92/src/java/org/apache/cassandra/db/compaction/CompactionManager.java#L1814&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;here&lt;/a&gt; for index summary redistributions&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-14935&quot; title=&quot;PendingAntiCompaction should be more judicious in the compactions it cancels&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-14935&quot;&gt;&lt;del&gt;CASSANDRA-14935&lt;/del&gt;&lt;/a&gt; also introduced a bug where we track the wrong sstables for index summary redistributions&lt;/p&gt;</description>
                <environment></environment>
        <key id="13220146">CASSANDRA-15045</key>
            <summary>Fix index summary redistribution compaction cancellation issues</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10002" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Normal</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="marcuse">Marcus Eriksson</assignee>
                                    <reporter username="marcuse">Marcus Eriksson</reporter>
                        <labels>
                    </labels>
                <created>Thu, 7 Mar 2019 10:12:39 +0000</created>
                <updated>Fri, 15 May 2020 08:00:13 +0000</updated>
                            <resolved>Tue, 26 Mar 2019 10:11:24 +0000</resolved>
                                        <fixVersion>2.2.15</fixVersion>
                    <fixVersion>3.0.19</fixVersion>
                    <fixVersion>3.11.5</fixVersion>
                    <fixVersion>4.0-alpha1</fixVersion>
                    <fixVersion>4.0</fixVersion>
                                    <component>Local/Compaction</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="16786590" author="krummas" created="Thu, 7 Mar 2019 10:17:52 +0000"  >&lt;p&gt;Attaching patch to just check if the method returns null, if so, cancel&lt;/p&gt;

&lt;p&gt;trunk branch also contains a fix for the sstable tracking and a small refactoring of &lt;tt&gt;IndexSummaryRedistribution&lt;/tt&gt; to make it a bit clearer which sstables are actually being redistributed.&lt;/p&gt;

&lt;p&gt;2.2: &lt;a href=&quot;https://github.com/krummas/cassandra/commits/marcuse/indexsummary&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/krummas/cassandra/commits/marcuse/indexsummary&lt;/a&gt;&lt;br/&gt;
3.0: &lt;a href=&quot;https://github.com/krummas/cassandra/commits/marcuse/indexsummary-3.0&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/krummas/cassandra/commits/marcuse/indexsummary-3.0&lt;/a&gt;&lt;br/&gt;
3.11: &lt;a href=&quot;https://github.com/krummas/cassandra/commits/marcuse/indexsummary-3.11&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/krummas/cassandra/commits/marcuse/indexsummary-3.11&lt;/a&gt;&lt;br/&gt;
trunk: &lt;a href=&quot;https://github.com/krummas/cassandra/commits/marcuse/indexsummary-trunk&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/krummas/cassandra/commits/marcuse/indexsummary-trunk&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;tests:&lt;br/&gt;
&lt;a href=&quot;https://circleci.com/gh/krummas/workflows/cassandra/tree/marcuse%2Findexsummary&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://circleci.com/gh/krummas/workflows/cassandra/tree/marcuse%2Findexsummary&lt;/a&gt;&lt;br/&gt;
&lt;a href=&quot;https://circleci.com/gh/krummas/workflows/cassandra/tree/marcuse%2Findexsummary-3.0&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://circleci.com/gh/krummas/workflows/cassandra/tree/marcuse%2Findexsummary-3.0&lt;/a&gt;&lt;br/&gt;
&lt;a href=&quot;https://circleci.com/gh/krummas/workflows/cassandra/tree/marcuse%2Findexsummary-3.11&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://circleci.com/gh/krummas/workflows/cassandra/tree/marcuse%2Findexsummary-3.11&lt;/a&gt;&lt;br/&gt;
&lt;a href=&quot;https://circleci.com/gh/krummas/workflows/cassandra/tree/marcuse%2Findexsummary-trunk&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://circleci.com/gh/krummas/workflows/cassandra/tree/marcuse%2Findexsummary-trunk&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16795386" author="jrwest" created="Mon, 18 Mar 2019 20:58:01 +0000"  >&lt;p&gt;+1 with a few minor comments below.&#160;&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;The change to check for global compactions makes sense. As usual, I want to double check its ok to change the semantics in each of the versions the change is proposed in. Are their any cases where it should be an option whether or not global compactions are cancelled? My initial inclination is no but wanted to bring it up explicitly regardless.&#160;&lt;/li&gt;
	&lt;li&gt;Minor nit: IndexSummaryManager#L225, the variable name &#8220;compactingAndNonCompacting&#8221; isn&#8217;t very descriptive after the changes&lt;/li&gt;
	&lt;li&gt;Good catch re: the exception handling in redistributeSummaries() finally block&lt;/li&gt;
	&lt;li&gt;The refactor to use the pre-calculated size in IndexSummaryRedistribution is much cleaner, thanks&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="16797021" author="krummas" created="Wed, 20 Mar 2019 10:30:05 +0000"  >&lt;p&gt;Pushed a new commit to the trunk branch to rename the variable&lt;/p&gt;

&lt;p&gt;Also pushed the &lt;tt&gt;closeAll&lt;/tt&gt; change to all branches and made sure we don&apos;t error-log &lt;tt&gt;CompactionInterruptedException&lt;/tt&gt;&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;As usual, I want to double check its ok to change the semantics in each of the versions the change is proposed in. Are their any cases where it should be an option whether or not global compactions are cancelled? My initial inclination is no but wanted to bring it up explicitly regardless. &lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;It has been possible to cancel index summary redistributions before as well - but only explicitly (like &lt;tt&gt;nodetool stop INDEX_SUMMARY&lt;/tt&gt;) but not automatically when starting anticompaction or truncating for example, so I think it should be safe. My biggest worry was that since explicit stops like above are much more rare than the automatic ones we would find some other issue (like transaction not getting closed properly)&lt;/p&gt;</comment>
                            <comment id="16797703" author="jrwest" created="Thu, 21 Mar 2019 00:40:52 +0000"  >&lt;p&gt;+1&lt;/p&gt;</comment>
                            <comment id="16801507" author="krummas" created="Tue, 26 Mar 2019 09:24:14 +0000"  >&lt;p&gt;With &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-15067&quot; title=&quot;MV tests need to wait for builds to start&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-15067&quot;&gt;&lt;del&gt;CASSANDRA-15067&lt;/del&gt;&lt;/a&gt; the tests look OK&lt;/p&gt;

&lt;p&gt;Also remembered that 2.2 needs to build using java7, so rewrote the unit test to not use &lt;tt&gt;Consumer&lt;/tt&gt;&lt;/p&gt;

&lt;p&gt;Committed as &lt;tt&gt;1d615a5ca151b7dbf24a9367f1379247cb90a5b0&lt;/tt&gt; to 2.2 and merged up, thanks!&lt;/p&gt;</comment>
                            <comment id="16802972" author="jrwest" created="Wed, 27 Mar 2019 16:01:16 +0000"  >&lt;p&gt;Good catch on the Java 7 needs in 2.2. Thanks!&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[marcuse]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12313825" key="com.atlassian.jira.plugin.system.customfieldtypes:cascadingselect">
                        <customfieldname>Bug Category</customfieldname>
                        <customfieldvalues>
                                                    <customfieldvalue key="12984" cascade-level=""><![CDATA[Degradation]]></customfieldvalue>
                                <customfieldvalue key="12998" cascade-level="1"><![CDATA[Other Exception]]></customfieldvalue>
            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12313821" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Complexity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12966"><![CDATA[Challenging]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313822" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Discovered By</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12977"><![CDATA[Adhoc Test]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            6 years, 33 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z00g28:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[jwest]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12962"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12311420" key="com.atlassian.jira.plugin.system.customfieldtypes:version">
                        <customfieldname>Since Version</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="12324945">2.2.0 beta 1</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12313823" key="com.atlassian.jira.plugin.system.customfieldtypes:textarea">
                        <customfieldname>Test and Documentation Plan</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>&lt;p&gt;reopened for jira test&lt;/p&gt;</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>