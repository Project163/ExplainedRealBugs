<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 22:55:07 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-9733] InsertUpdateIfCondition.testConditionalDelete is failing on trunk</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-9733</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt; &lt;tt&gt;InsertUpdateIfCondition.testConditionalDelete&lt;/tt&gt; is failing on trunk. &lt;/p&gt;

&lt;p&gt;It looks that it got unnoticed because cassci was not running the test due to the fact that the class name does not contains &lt;tt&gt;Test&lt;/tt&gt;. &lt;/p&gt;</description>
                <environment></environment>
        <key id="12842834">CASSANDRA-9733</key>
            <summary>InsertUpdateIfCondition.testConditionalDelete is failing on trunk</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10002" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Normal</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="stefania">Stefania Alborghetti</assignee>
                                    <reporter username="blerer">Benjamin Lerer</reporter>
                        <labels>
                    </labels>
                <created>Mon, 6 Jul 2015 08:52:15 +0000</created>
                <updated>Tue, 16 Apr 2019 09:31:05 +0000</updated>
                            <resolved>Thu, 9 Jul 2015 07:06:21 +0000</resolved>
                                        <fixVersion>3.0 alpha 1</fixVersion>
                                    <component>Legacy/Local Write-Read Paths</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="14614736" author="stefania" created="Mon, 6 Jul 2015 09:11:43 +0000"  >&lt;p&gt;It fails on an INSERT with a TTL, may be related to the failing TTL dtests, &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-9721&quot; title=&quot;Most TTL dtests fail&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-9721&quot;&gt;&lt;del&gt;CASSANDRA-9721&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="14618171" author="stefania" created="Wed, 8 Jul 2015 07:56:33 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=slebresne&quot; class=&quot;user-hover&quot; rel=&quot;slebresne&quot;&gt;slebresne&lt;/a&gt;, as far as I can see the problem with this ticket and &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-9721&quot; title=&quot;Most TTL dtests fail&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-9721&quot;&gt;&lt;del&gt;CASSANDRA-9721&lt;/del&gt;&lt;/a&gt; is that we don&apos;t filter out partitions that have only cell tombstones. For example:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;execute(&lt;span class=&quot;code-quote&quot;&gt;&quot;INSERT INTO %s (k, v1) VALUES (2, 2) USING TTL 1&quot;&lt;/span&gt;);
&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.sleep(1001);
execute(&lt;span class=&quot;code-quote&quot;&gt;&quot;SELECT * FROM %s WHERE k=2&quot;&lt;/span&gt;);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This code returns &lt;tt&gt;[2, null]&lt;/tt&gt; but the existing tests are expecting no rows returned. Is this a change in behavior or something you are already aware and was planning on doing? If not, excluding rows without live data in &lt;tt&gt;SelectStatement.processPartition()&lt;/tt&gt; fixes all ttl dtests except for two (which have NPEs), whilst for the cas operations I&apos;m guessing we should change the &lt;tt&gt;RowCondition.appliesTo&lt;/tt&gt; implementations to treat  a row without live data as not existing. Is this correct and are there other places that might have the same problem (e.g. Thrift)?&lt;/p&gt;</comment>
                            <comment id="14618223" author="slebresne" created="Wed, 8 Jul 2015 08:35:21 +0000"  >&lt;p&gt;A row is considered live if either it has some live cells &lt;em&gt;or&lt;/em&gt; it has a live &quot;primaryKeyLivenessInfo&quot;. The latest bit is because a row can be live even if only its primary key columns are set, and in that case it will have no (live) cells. To put it another way with an example, if your example was:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;execute(&quot;INSERT INTO %s (k) VALUES (2)&quot;);
execute(&quot;UPDATE %s USING TTL 1 SET v1 = 2 WHERE k = 2&quot;);
Thread.sleep(1001);
execute(&quot;SELECT * FROM %s WHERE k=2&quot;);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;then we would expect this to return &lt;tt&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;2, null&amp;#93;&lt;/span&gt;&lt;/tt&gt; even though the row would internally only have cell tombstones.&lt;/p&gt;

&lt;p&gt;Further, &lt;tt&gt;SelectStatement.processPartition&lt;/tt&gt; gets a &lt;tt&gt;RowIterator&lt;/tt&gt; (by opposition to an &lt;tt&gt;UnfilteredRowIterator&lt;/tt&gt;) and that means that anything deleted is already filtered out and it shouldn&apos;t have to bother with filtering anything (same applies to &lt;tt&gt;RowCondition&lt;/tt&gt;). So the real problem is that in your example, the &quot;primaryKeyLivenessInfo&quot; of the row, which should be deleted since the whole row is TTLed, is not. Or more precisely, it is deleted but it hasn&apos;t been filtered out properly when we transform the &lt;tt&gt;UnfilteredRowIterator&lt;/tt&gt; (contains deleted stuffs) into a &lt;tt&gt;RowIterator&lt;/tt&gt; (should only contain live stuffs) so the code wrongly assumes it to be live.&lt;/p&gt;

&lt;p&gt;Attaching the simple patch to fix that.&lt;/p&gt;</comment>
                            <comment id="14618279" author="stefania" created="Wed, 8 Jul 2015 09:27:41 +0000"  >&lt;p&gt;Thank you for the explanation and for the patch! &lt;/p&gt;

&lt;p&gt;It fixes all the problems in the utests and dtests except for one NPE, for which I added a tentative fix in the complete patch attached. For this reason I marked &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-9721&quot; title=&quot;Most TTL dtests fail&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-9721&quot;&gt;&lt;del&gt;CASSANDRA-9721&lt;/del&gt;&lt;/a&gt; as a duplicate of this ticket.&lt;/p&gt;

&lt;p&gt;There is also another patch to be applied to 2.1 and 2.2, where we simply need to rename the unit test class to make sure the test runs on Jenkins.&lt;/p&gt;

&lt;p&gt;Would you mind reviewing the NPE fix and committing these patches when CI is done?&lt;/p&gt;

&lt;p&gt;CI should eventually be available at these locations:&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/stef1927/job/stef1927-9733-testall/lastCompletedBuild/testReport/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://cassci.datastax.com/view/Dev/view/stef1927/job/stef1927-9733-testall/lastCompletedBuild/testReport/&lt;/a&gt;&lt;br/&gt;
&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/stef1927/job/stef1927-9733-dtest/lastCompletedBuild/testReport/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://cassci.datastax.com/view/Dev/view/stef1927/job/stef1927-9733-dtest/lastCompletedBuild/testReport/&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14618289" author="slebresne" created="Wed, 8 Jul 2015 09:33:10 +0000"  >&lt;p&gt;Full patch looks good. I&apos;ll wait on CI and commit.&lt;/p&gt;</comment>
                            <comment id="14619294" author="slebresne" created="Wed, 8 Jul 2015 20:25:17 +0000"  >&lt;p&gt;Didn&apos;t see anything on the tests that seemed new from this patch so committed. Thanks.&lt;/p&gt;</comment>
                            <comment id="14619667" author="stefania" created="Thu, 9 Jul 2015 00:48:45 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=slebresne&quot; class=&quot;user-hover&quot; rel=&quot;slebresne&quot;&gt;slebresne&lt;/a&gt; TTL tests are still failing on trunk and I only see the renaming of the class in the git log, not the actual fix. &lt;/p&gt;</comment>
                            <comment id="14620013" author="slebresne" created="Thu, 9 Jul 2015 07:06:11 +0000"  >&lt;p&gt;So apparently git doesn&apos;t detect when you&apos;ve forgotten to push and do it automatically for you. Who would have known?! Anyway, pushed now.&lt;/p&gt;</comment>
                            <comment id="14620046" author="stefania" created="Thu, 9 Jul 2015 07:31:22 +0000"  >&lt;p&gt;Looks good now, thanks. Time to write a smarter source control management system!! &lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                            <outwardlinks description="duplicates">
                                        <issuelink>
            <issuekey id="12842435">CASSANDRA-9721</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12744168" name="9733.patch" size="917" author="slebresne" created="Wed, 8 Jul 2015 08:35:21 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[stefania]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 19 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2gvmf:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>slebresne</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[slebresne]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12962"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>