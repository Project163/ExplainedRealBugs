<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 22:21:53 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-2129] removetoken after removetoken rf error fails to work</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-2129</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;2 node cluster, a keyspace existed with rf=2.  Tried removetoken and got:&lt;/p&gt;

&lt;p&gt;mbulman@ripcord-maverick1:/usr/src/cassandra/tags/cassandra-0.7.0$ bin/nodetool -h localhost removetoken 159559397954378837828954138596956659794&lt;br/&gt;
Exception in thread &quot;main&quot; java.lang.IllegalStateException: replication factor (2) exceeds number of endpoints (1)&lt;/p&gt;

&lt;p&gt;Deleted the keyspace, and tried again:&lt;/p&gt;

&lt;p&gt;mbulman@ripcord-maverick1:/usr/src/cassandra/tags/cassandra-0.7.0$ bin/nodetool -h localhost removetoken 159559397954378837828954138596956659794&lt;br/&gt;
Exception in thread &quot;main&quot; java.lang.UnsupportedOperationException: This node is already processing a removal. Wait for it to complete.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12497902">CASSANDRA-2129</key>
            <summary>removetoken after removetoken rf error fails to work</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10003" iconUrl="https://issues.apache.org/jira/images/icons/priorities/trivial.svg">Low</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="brandon.williams">Brandon Williams</assignee>
                                    <reporter username="mbulman">Mike Bulman</reporter>
                        <labels>
                    </labels>
                <created>Mon, 7 Feb 2011 20:56:18 +0000</created>
                <updated>Tue, 16 Apr 2019 09:33:07 +0000</updated>
                            <resolved>Thu, 14 Jul 2011 21:26:41 +0000</resolved>
                                        <fixVersion>0.8.2</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                    <workratio workratioPercent="0"/>
                                    <progress percentage="0">
                                    <originalProgress>
                                                    <row percentage="100" backgroundColor="#89afd7"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="0" backgroundColor="#51a825"/>
                                                    <row percentage="100" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="0">
                                    <originalProgress>
                                                    <row percentage="100" backgroundColor="#89afd7"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="0" backgroundColor="#51a825"/>
                                                    <row percentage="100" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                    <timeoriginalestimate seconds="14400">4h</timeoriginalestimate>
                            <timeestimate seconds="14400">4h</timeestimate>
                                        <comments>
                            <comment id="12991638" author="jbellis" created="Mon, 7 Feb 2011 21:55:05 +0000"  >&lt;p&gt;Does removetoken force clear up the second problem?&lt;/p&gt;

&lt;p&gt;We should allow reducing the nodes in the cluster below the RF count, just as we allow creating a keyspace with RF greater than the node count.  (In both cases, writes will be rejected until more nodes are added or RF is reduced.)&lt;/p&gt;</comment>
                            <comment id="12992029" author="mbulman" created="Tue, 8 Feb 2011 16:26:39 +0000"  >&lt;p&gt;No.  force and status both report no token removals in process.&lt;/p&gt;

&lt;p&gt;tags/cassandra-0.7.0# bin/nodetool -h localhost removetoken status                                 &lt;br/&gt;
RemovalStatus: No token removals in process.&lt;/p&gt;

&lt;p&gt;Restarting the node that was processing the removal clears up the confusion/issue.&lt;/p&gt;</comment>
                            <comment id="13007648" author="brandon.williams" created="Wed, 16 Mar 2011 19:33:05 +0000"  >&lt;p&gt;Patch to allow removing the token, and throw UE instead of an internal error when trying to insert and the number of endpoints is less than the RF.&lt;/p&gt;</comment>
                            <comment id="13007778" author="jbellis" created="Thu, 17 Mar 2011 02:14:21 +0000"  >&lt;p&gt;SP.mutate should be throwing UAE already (assureSufficientLiveNodes).  Why isn&apos;t that working?&lt;/p&gt;</comment>
                            <comment id="13008105" author="brandon.williams" created="Thu, 17 Mar 2011 20:13:36 +0000"  >&lt;p&gt;Because it calls rs.getNaturalEndpoints first, which throws ISE and SP.mutate only catches IOException.  I&apos;m a little uneasy with catching both IOE and ISE, or modifying the RS to throw IOE, but I&apos;m not sure what the best solution is.  The patch as-is still has ISE problems, at least on describe_keyspace.&lt;/p&gt;</comment>
                            <comment id="13008290" author="jbellis" created="Fri, 18 Mar 2011 02:39:04 +0000"  >&lt;p&gt;what purpose does leaving the ISE in serve, at this point?  should we just remove it?&lt;/p&gt;</comment>
                            <comment id="13016431" author="nickmbailey" created="Wed, 6 Apr 2011 16:59:41 +0000"  >&lt;p&gt;Note: a similar error occurs when trying to do describe_ring on a cluster where rf &amp;lt; N.&lt;/p&gt;</comment>
                            <comment id="13027148" author="jbellis" created="Fri, 29 Apr 2011 19:14:33 +0000"  >&lt;p&gt;Possibly the same bug was reported on the user list: &lt;a href=&quot;http://permalink.gmane.org/gmane.comp.db.cassandra.user/15803&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://permalink.gmane.org/gmane.comp.db.cassandra.user/15803&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13040417" author="brandon.williams" created="Fri, 27 May 2011 20:28:55 +0000"  >&lt;p&gt;Removing ISE almost got us all the way there, but there was a subtle bug in WRH.determineBlockFor being relative to the amount of endpoints, instead of the RF.  v2 removes ISE and addresses this problem.&lt;/p&gt;</comment>
                            <comment id="13065542" author="xedin" created="Thu, 14 Jul 2011 21:20:07 +0000"  >&lt;p&gt;+1&lt;/p&gt;</comment>
                            <comment id="13065546" author="brandon.williams" created="Thu, 14 Jul 2011 21:26:41 +0000"  >&lt;p&gt;Committed&lt;/p&gt;</comment>
                            <comment id="13065565" author="hudson" created="Thu, 14 Jul 2011 22:14:00 +0000"  >&lt;p&gt;Integrated in Cassandra-0.8 #215 (See &lt;a href=&quot;https://builds.apache.org/job/Cassandra-0.8/215/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/Cassandra-0.8/215/&lt;/a&gt;)&lt;br/&gt;
    Allow RF to exceed the number of nodes (but disallow writes)&lt;br/&gt;
Patch by brandonwilliams, reviewed by Pavel Yaskevich for &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-2129&quot; title=&quot;removetoken after removetoken rf error fails to work&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-2129&quot;&gt;&lt;del&gt;CASSANDRA-2129&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;brandonwilliams : &lt;a href=&quot;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1146900&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1146900&lt;/a&gt;&lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/cassandra/branches/cassandra-0.8/src/java/org/apache/cassandra/locator/OldNetworkTopologyStrategy.java&lt;/li&gt;
	&lt;li&gt;/cassandra/branches/cassandra-0.8/src/java/org/apache/cassandra/locator/SimpleStrategy.java&lt;/li&gt;
	&lt;li&gt;/cassandra/branches/cassandra-0.8/src/java/org/apache/cassandra/locator/NetworkTopologyStrategy.java&lt;/li&gt;
	&lt;li&gt;/cassandra/branches/cassandra-0.8/src/java/org/apache/cassandra/locator/AbstractReplicationStrategy.java&lt;/li&gt;
	&lt;li&gt;/cassandra/branches/cassandra-0.8/src/java/org/apache/cassandra/service/WriteResponseHandler.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                    </comments>
                    <attachments>
                            <attachment id="12480689" name="2129-v2.txt" size="6466" author="brandon.williams" created="Fri, 27 May 2011 20:28:55 +0000"/>
                            <attachment id="12473835" name="2129.txt" size="3749" author="brandon.williams" created="Wed, 16 Mar 2011 19:33:05 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[brandon.williams]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>20457</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            14 years, 19 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0g9hj:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>92967</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>xedin</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[xedin]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12961"><![CDATA[Low]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>