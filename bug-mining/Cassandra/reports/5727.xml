<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 23:20:25 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-16643] ALTER TABLE: mixing counter and non-counter columns in one table </title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-16643</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;&lt;tt&gt;CREATE TABLE&lt;/tt&gt; does not allow mixing counter and non-counter columns in the same table. However, this can be done with &lt;tt&gt;ALTER TABLE&lt;/tt&gt;:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;&lt;tt&gt;ALTER TABLE&lt;/tt&gt; can add non-counter columns to a table with counter columns;&lt;/li&gt;
	&lt;li&gt;&lt;tt&gt;ALTER TABLE&lt;/tt&gt; can add counter columns to a table with non-counter columns.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Tested in cassandra-4.0-rc1 (also in cassandra-4.0-beta2):&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-sql&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;CREATE&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;TABLE&lt;/span&gt; test1 (
  id UUID,
  my_counter COUNTER,
  &lt;span class=&quot;code-keyword&quot;&gt;PRIMARY&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;KEY&lt;/span&gt; ((id))
);

&lt;span class=&quot;code-keyword&quot;&gt;ALTER&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;TABLE&lt;/span&gt; test1 &lt;span class=&quot;code-keyword&quot;&gt;ADD&lt;/span&gt; my_text &lt;span class=&quot;code-keyword&quot;&gt;TEXT&lt;/span&gt;;

&lt;span class=&quot;code-keyword&quot;&gt;UPDATE&lt;/span&gt; test1 
&lt;span class=&quot;code-keyword&quot;&gt;SET&lt;/span&gt; my_counter = my_counter + 10,
    my_text = &lt;span class=&quot;code-quote&quot;&gt;&apos;Test 1&apos;&lt;/span&gt; 
&lt;span class=&quot;code-keyword&quot;&gt;WHERE&lt;/span&gt; id = 5069cc15-4300-4595-ae77-381c3af5dc5e;

&lt;span class=&quot;code-keyword&quot;&gt;SELECT&lt;/span&gt; * &lt;span class=&quot;code-keyword&quot;&gt;FROM&lt;/span&gt; test1;

 id                                   | my_counter | my_text
&lt;span class=&quot;code-comment&quot;&gt;--------------------------------------+------------+---------
&lt;/span&gt; 5069cc15-4300-4595-ae77-381c3af5dc5e |         10 |  Test 1
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-sql&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;CREATE&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;TABLE&lt;/span&gt; test2 (
  id UUID,
  my_text &lt;span class=&quot;code-keyword&quot;&gt;TEXT&lt;/span&gt;,
  &lt;span class=&quot;code-keyword&quot;&gt;PRIMARY&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;KEY&lt;/span&gt; ((id))
);

&lt;span class=&quot;code-keyword&quot;&gt;ALTER&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;TABLE&lt;/span&gt; test2 &lt;span class=&quot;code-keyword&quot;&gt;ADD&lt;/span&gt; my_counter COUNTER;

&lt;span class=&quot;code-keyword&quot;&gt;UPDATE&lt;/span&gt; test2 
&lt;span class=&quot;code-keyword&quot;&gt;SET&lt;/span&gt; my_counter = my_counter + 20,
    my_text = &lt;span class=&quot;code-quote&quot;&gt;&apos;Test 2&apos;&lt;/span&gt; 
&lt;span class=&quot;code-keyword&quot;&gt;WHERE&lt;/span&gt; id = 5069cc15-4300-4595-ae77-381c3af5dc5e;

&lt;span class=&quot;code-keyword&quot;&gt;SELECT&lt;/span&gt; * &lt;span class=&quot;code-keyword&quot;&gt;FROM&lt;/span&gt; test2;

 id                                   | my_counter | my_text
&lt;span class=&quot;code-comment&quot;&gt;--------------------------------------+------------+---------
&lt;/span&gt; 5069cc15-4300-4595-ae77-381c3af5dc5e |         20 |  Test 2
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-sql&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;CREATE&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;TABLE&lt;/span&gt; test3 (
  id UUID,
  my_counter COUNTER,
  my_text &lt;span class=&quot;code-keyword&quot;&gt;TEXT&lt;/span&gt;,
  &lt;span class=&quot;code-keyword&quot;&gt;PRIMARY&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;KEY&lt;/span&gt; ((id))
);

InvalidRequest: Error &lt;span class=&quot;code-keyword&quot;&gt;from&lt;/span&gt; server: code=2200 [Invalid query] message=&lt;span class=&quot;code-quote&quot;&gt;&quot;Cannot mix counter &lt;span class=&quot;code-keyword&quot;&gt;and&lt;/span&gt; non counter &lt;span class=&quot;code-keyword&quot;&gt;columns&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;in&lt;/span&gt; the same &lt;span class=&quot;code-keyword&quot;&gt;table&lt;/span&gt;&quot;&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="13375915">CASSANDRA-16643</key>
            <summary>ALTER TABLE: mixing counter and non-counter columns in one table </summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10002" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Normal</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="aholmber">Adam Holmberg</assignee>
                                    <reporter username="ArtemChebotko">Artem Chebotko</reporter>
                        <labels>
                    </labels>
                <created>Thu, 29 Apr 2021 21:48:16 +0000</created>
                <updated>Fri, 10 Oct 2025 08:47:52 +0000</updated>
                            <resolved>Thu, 6 May 2021 12:52:39 +0000</resolved>
                                        <fixVersion>4.0-rc2</fixVersion>
                    <fixVersion>4.0</fixVersion>
                                    <component>CQL/Semantics</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>6</watches>
                                                                                                                <comments>
                            <comment id="17339875" author="aholmber" created="Wed, 5 May 2021 20:05:32 +0000"  >&lt;p&gt;It seems some validation was omitted during some refactoring for 4.0. Proposed patch adds metadata validation to AlterTableStatement, and a small unit test.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/aholmberg/cassandra/pull/59&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;patch&lt;/a&gt;&lt;br/&gt;
&lt;a href=&quot;https://app.circleci.com/pipelines/github/aholmberg/cassandra?branch=CASSANDRA-16643&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;ci&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17339883" author="aholmber" created="Wed, 5 May 2021 20:34:47 +0000"  >&lt;p&gt;I&apos;m passing this along with python dtests blown up by something else. CI shows java unit and dtests in good shape.&lt;/p&gt;</comment>
                            <comment id="17339886" author="edimitrova" created="Wed, 5 May 2021 20:38:05 +0000"  >&lt;p&gt;I also have all python dtests and cqlsh tests failing. Not sure whether it is related to the latest patch 5 hours ago. I will test it now&lt;/p&gt;</comment>
                            <comment id="17339897" author="edimitrova" created="Wed, 5 May 2021 21:11:42 +0000"  >&lt;p&gt;Seems it is just Circle CI issue, I am pushing CI run to Jenkins while we fix the Circle issue:&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://jenkins-cm4.apache.org/job/Cassandra-devbranch/732/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://jenkins-cm4.apache.org/job/Cassandra-devbranch/732/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="17339903" author="aholmber" created="Wed, 5 May 2021 21:22:14 +0000"  >&lt;p&gt;Thanks, but looks like that one failed on github clone.&lt;/p&gt;</comment>
                            <comment id="17339909" author="edimitrova" created="Wed, 5 May 2021 21:47:49 +0000"  >&lt;p&gt;Thanks for the heads up. Seems like there was issue with my token maybe.&lt;/p&gt;

&lt;p&gt;I just submitted it again &lt;a href=&quot;https://jenkins-cm4.apache.org/job/Cassandra-devbranch/733/console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;here&lt;/a&gt;&#160;and it seems that now it worked&lt;/p&gt;</comment>
                            <comment id="17340123" author="blerer" created="Thu, 6 May 2021 09:52:56 +0000"  >&lt;p&gt;The patch looks good to me. &lt;/p&gt;</comment>
                            <comment id="17340166" author="edimitrova" created="Thu, 6 May 2021 11:54:39 +0000"  >&lt;p&gt;+1 from me too. All dtests failed but I believe this is related to the work in progress around the new branching. There is issue with the manifest file which I believe will be handled in&#160;&lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-16642&quot; title=&quot;Create release branch cassandra-4.0&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-16642&quot;&gt;&lt;del&gt;CASSANDRA-16642&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;Shall we backport the new test to 3.11?&#160;&lt;/p&gt;</comment>
                            <comment id="17340174" author="blerer" created="Thu, 6 May 2021 12:07:44 +0000"  >&lt;blockquote&gt;&lt;p&gt;Shall we backport the new test to 3.11? &lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I think we can skip that part. The risk of having a regression on that area of the code in 3.0 and 3.11, is pretty low.&lt;/p&gt;

&lt;p&gt;I will commit.&lt;/p&gt;</comment>
                            <comment id="17340189" author="blerer" created="Thu, 6 May 2021 12:52:39 +0000"  >&lt;p&gt;Committed into cassandra-4.0 at a867abf0304439182a7225a751145e4d1d4b07c7 and merged into trunk&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[aholmber]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12313825" key="com.atlassian.jira.plugin.system.customfieldtypes:cascadingselect">
                        <customfieldname>Bug Category</customfieldname>
                        <customfieldvalues>
                                                    <customfieldvalue key="12982" cascade-level=""><![CDATA[Correctness]]></customfieldvalue>
            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12313821" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Complexity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12965"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313822" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Discovered By</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12969"><![CDATA[User Report]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12313922" key="jira.plugin.projectspecificselectfield.jpssf:multicftype">
                        <customfieldname>Impacts</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="13100"><![CDATA[None]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            4 years, 27 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12313921" key="jira.plugin.projectspecificselectfield.jpssf:multicftype">
                        <customfieldname>Platform</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="13076"><![CDATA[All]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0qll4:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[blerer]]></customfieldvalue>
        <customfieldvalue><![CDATA[e.dimitrova]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12962"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12311420" key="com.atlassian.jira.plugin.system.customfieldtypes:version">
                        <customfieldname>Since Version</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="12348281">4.0-alpha1</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313924" key="com.atlassian.jira.plugin.system.customfieldtypes:textfield">
                        <customfieldname>Source Control Link</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>&lt;p&gt;&lt;a href=&quot;https://github.com/apache/cassandra/commit/a867abf0304439182a7225a751145e4d1d4b07c7&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/cassandra/commit/a867abf0304439182a7225a751145e4d1d4b07c7&lt;/a&gt;&lt;/p&gt;</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313823" key="com.atlassian.jira.plugin.system.customfieldtypes:textarea">
                        <customfieldname>Test and Documentation Plan</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>&lt;p&gt;new unit test added&lt;/p&gt;</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>