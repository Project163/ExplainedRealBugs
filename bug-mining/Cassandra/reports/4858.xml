<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 23:08:38 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-8523] Writes should be sent to a replacement node which has a new IP while it is streaming in data</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-8523</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;In our operations, we make heavy use of replace_address (or replace_address_first_boot) in order to replace broken nodes. We now realize that writes are not sent to the replacement nodes while they are in hibernate state and streaming in data. This runs counter to what our expectations were, especially since we know that writes ARE sent to nodes when they are bootstrapped into the ring.&lt;/p&gt;

&lt;p&gt;It seems like cassandra should arrange to send writes to a node that is in the process of replacing another node, just like it does for a nodes that are bootstraping. I hesitate to phrase this as &quot;we should send writes to a node in hibernate&quot; because the concept of hibernate may be useful in other contexts, as per &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-8336&quot; title=&quot;Add shutdown gossip state to prevent timeouts during rolling restarts&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-8336&quot;&gt;&lt;del&gt;CASSANDRA-8336&lt;/del&gt;&lt;/a&gt;. Maybe a new state is needed here?&lt;/p&gt;

&lt;p&gt;Among other things, the fact that we don&apos;t get writes during this period makes subsequent repairs more expensive, proportional to the number of writes that we miss (and depending on the amount of data that needs to be streamed during replacement and the time it may take to rebuild secondary indexes, we could miss many many hours worth of writes). It also leaves us more exposed to consistency violations.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12762978">CASSANDRA-8523</key>
            <summary>Writes should be sent to a replacement node which has a new IP while it is streaming in data</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10002" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Normal</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="pauloricardomg">Paulo Motta</assignee>
                                    <reporter username="rfwagner@gmail.com">Richard Wagner</reporter>
                        <labels>
                    </labels>
                <created>Fri, 19 Dec 2014 19:59:53 +0000</created>
                <updated>Wed, 15 Oct 2025 09:48:58 +0000</updated>
                            <resolved>Wed, 31 Aug 2016 19:32:06 +0000</resolved>
                                        <fixVersion>2.2.8</fixVersion>
                    <fixVersion>3.0.9</fixVersion>
                    <fixVersion>3.10</fixVersion>
                                        <due></due>
                            <votes>1</votes>
                                    <watches>23</watches>
                                                                                                                <comments>
                            <comment id="14271457" author="philipthompson" created="Fri, 9 Jan 2015 16:13:50 +0000"  >&lt;p&gt;I&apos;ve checked with &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=brandon.williams&quot; class=&quot;user-hover&quot; rel=&quot;brandon.williams&quot;&gt;brandon.williams&lt;/a&gt;, and this is intended behavior, so I&apos;m marking this as an Improvement, not a bug. Do note that the replacement node will receive all writes while it was streaming that were captured as hints, so if the stream takes less than the hint window, you should not see too much discrepancy.&lt;/p&gt;</comment>
                            <comment id="14271464" author="brandon.williams" created="Fri, 9 Jan 2015 16:16:59 +0000"  >&lt;p&gt;I completely agree this is an improvement, but it&apos;s going to be pretty tricky, especially since we can&apos;t use the FD to determine if the node has died, at least not in its current form since that would mark the node as UP.&lt;/p&gt;</comment>
                            <comment id="14275862" author="jbellis" created="Tue, 13 Jan 2015 20:18:49 +0000"  >&lt;p&gt;Marking related to &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-8494&quot; title=&quot;incremental bootstrap&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-8494&quot;&gt;&lt;del&gt;CASSANDRA-8494&lt;/del&gt;&lt;/a&gt;, but may want to resolve as duplicate.&lt;/p&gt;</comment>
                            <comment id="15225161" author="brandon.williams" created="Mon, 4 Apr 2016 22:04:50 +0000"  >&lt;p&gt;I&apos;m out of ideas here.  Signalling that we want to send writes to the replacing node is easy enough, but knowing when to stop if it fails is tricky, since we can&apos;t use the FD and it&apos;s a singleton so we can&apos;t just grab a new instance. &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jkni&quot; class=&quot;user-hover&quot; rel=&quot;jkni&quot;&gt;jkni&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=Stefania&quot; class=&quot;user-hover&quot; rel=&quot;stefania&quot;&gt;Stefania&lt;/a&gt; do you have any ideas?&lt;/p&gt;</comment>
                            <comment id="15225470" author="stefania" created="Tue, 5 Apr 2016 01:20:30 +0000"  >&lt;p&gt;I would consider a new, non dead, state for replacing a node rather than using hibernate. This should allow us to use the Failure Detector right?&lt;/p&gt;

&lt;p&gt;Alternatively, would a new Gossip property that indicates a &quot;shadow&quot; of an existing node be easier to implement? Could this property be made to expire unless it gets renewed by the shadow node? &lt;/p&gt;</comment>
                            <comment id="15225475" author="brandon.williams" created="Tue, 5 Apr 2016 01:26:23 +0000"  >&lt;blockquote&gt;&lt;p&gt;I would consider a new, non dead, state for replacing a node rather than using hibernate. This should allow us to use the Failure Detector right?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;It looks like this would work now, because the gossiper is the only thing that registers with the FD.  In the past this wasn&apos;t always true, though.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;Alternatively, would a new Gossip property that indicates a &quot;shadow&quot; of an existing node be easier to implement?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Hmm, can you can explain further?&lt;/p&gt;</comment>
                            <comment id="15225483" author="stefania" created="Tue, 5 Apr 2016 01:33:08 +0000"  >&lt;blockquote&gt;&lt;p&gt;Hmm, can you can explain further?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Well, it would be a bit convoluted so a new Gossip state would probably be cleaner if we can add it. But the idea is to link a host to one or more hosts that act as &apos;shadows&apos;, that is they receive copies of all writes or hints but are not queried for reads. &lt;/p&gt;</comment>
                            <comment id="15228317" author="pauloricardomg" created="Wed, 6 Apr 2016 14:19:33 +0000"  >&lt;p&gt;There are two scenarios we should consider when replacing a node:&lt;br/&gt;
1) The replacing node has the same IP as the previous node&lt;br/&gt;
2) The replacing node has a different IP as the previous node&lt;/p&gt;

&lt;p&gt;On &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-9244&quot; title=&quot;replace_address is not topology-aware&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-9244&quot;&gt;CASSANDRA-9244&lt;/a&gt; I have gotten pretty far in an &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-9244?focusedCommentId=15211202&amp;amp;page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-15211202&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;implementation&lt;/a&gt; that adds a new non-dead gossip state &lt;tt&gt;BOOT_REPLACE&lt;/tt&gt; and considers the replacing endpoint as a bootstrapping pending endpoint, solving case 2 transparently.&lt;/p&gt;

&lt;p&gt;Case 1 is trickier because when the replacing node enters gossip with a non-dead state, other nodes will think the previous node is back up and send reads to him (since he is a natural endpoint).&lt;/p&gt;

&lt;p&gt;A simple way to solve this is to special-case the read path and ignore nodes in &quot;NON-NORMAL&quot; state when sending reads to natural endpoints. While this will probably solve the problem, there are quite a few different paths we need to hack to make sure this is enforced correctly (paxos, read, hints, etc), so I&apos;m not totally comfortable with that.&lt;/p&gt;

&lt;p&gt;A more transparent but a bit costlier approach to solve case 1 would be to change the &lt;tt&gt;TokenMetadata&lt;/tt&gt; to keep nodes as &lt;tt&gt;(InetAddress, UUID)&lt;/tt&gt; pairs, and create a new interface to the &lt;tt&gt;FailureDetector&lt;/tt&gt; keyed by &lt;tt&gt;UUID&lt;/tt&gt;. This way we could keep &lt;tt&gt;(IP=127.0.0.1,UUID=1)&lt;/tt&gt; in &lt;tt&gt;TokenMetadata&lt;/tt&gt; as a natural endpoint, and add a replacement node &lt;tt&gt;(IP=127.0.0.1,UUID=2)&lt;/tt&gt; as a pending endpoint. So, during reads, &lt;tt&gt;FD.isAlive(UUID=1)&lt;/tt&gt; would return false, and natural reads would not be sent to &lt;tt&gt;(IP=127.0.0.1,UUID=1)&lt;/tt&gt;, while pending writes would be sent to &lt;tt&gt;(IP=127.0.0.1,UUID=2)&lt;/tt&gt; because &lt;tt&gt;FD.isAlive(UUID=2)&lt;/tt&gt; would return true.&lt;/p&gt;

&lt;p&gt;I&apos;d be happy to continue working on this, so feedback on any of the above or alternative approaches would be greatly appreciated.&lt;/p&gt;</comment>
                            <comment id="15228474" author="jkni" created="Wed, 6 Apr 2016 15:34:40 +0000"  >&lt;p&gt;I don&apos;t have a good idea for a low-hanging solution here - I think the cleanest is the combination of a new gossip state for replacing nodes + enhancement of the failure detector/token metadata. Since that&apos;s a bigger change, let&apos;s also make sure that it doesn&apos;t conflict with plans for strongly consistent membership. I&apos;d really rather not couple gossip status to the internals of the read/write paths.&lt;/p&gt;

&lt;p&gt;I also agree that we should make sure that we kill two birds with one stone and handle this and &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-9244&quot; title=&quot;replace_address is not topology-aware&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-9244&quot;&gt;CASSANDRA-9244&lt;/a&gt; at the same time.&lt;/p&gt;

&lt;p&gt;Let me know if I can help in design and/or review.&lt;/p&gt;</comment>
                            <comment id="15243834" author="jasobrown" created="Fri, 15 Apr 2016 23:21:04 +0000"  >&lt;p&gt;I agree with &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jkni&quot; class=&quot;user-hover&quot; rel=&quot;jkni&quot;&gt;jkni&lt;/a&gt; - a new gossip state and updating FD/TMD is the best way to go. I&apos;ll follow up on #9244 to get better grasp of what&apos;s going on there, as well.&lt;/p&gt;

&lt;p&gt;wrt strongly consistent membership, that effort focuses primarily on correct and linearizable changes to the cluster state machine, and not any behaviors that should be triggered due to those changes when they arrive at cluster nodes. So, I don&apos;t &lt;b&gt;think&lt;/b&gt; we&apos;d run into problems between these two efforts, but good to keep the same players involved &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="15277068" author="brandon.williams" created="Mon, 9 May 2016 21:22:54 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=pauloricardomg&quot; class=&quot;user-hover&quot; rel=&quot;pauloricardomg&quot;&gt;pauloricardomg&lt;/a&gt; assigning to you, please do continue working on this.&lt;/p&gt;</comment>
                            <comment id="15304281" author="pauloricardomg" created="Fri, 27 May 2016 16:29:21 +0000"  >&lt;p&gt;Initial route I will take is to create a new dead state for replace, that adds the node as replacing endpoint to TokenMetadata. When a replacement endpoint is added to TokenMetadata, if there&apos;s an existing down node with the same IP, then we remove it from natural endpoints so the replacement node no longer receive reads when it becomes alive in the FD and include the replacement node as pending joining endpoint so writes are forwarded to it. After pending ranges for replace are calculated the final step is to set the node as alive in the FD and change the dead state logic to not mark &quot;alive&quot; dead state nodes as DOWN automatically (we will probably rename this nomenclature to a better name, like invisible or whatever), so the FD will work as usual and remove the replacing endpoint from TokenMetadata (and restore it as a natural endpoint) if it becomes down. The current streaming logic will probably be unaffected by this, and the node will change its state to NORMAL after stream is finished completing the replace procedure.&lt;/p&gt;

&lt;p&gt;The only downside I can think of this approach is that we will lose hints during a failed replace, but this is not a big deal as hints are an optimization, and replace will probably take longer than max_hint_window anyway.&lt;/p&gt;

&lt;p&gt;I will start going this route, feel free to give any feedback or let me know if I&apos;m missing something on this high level flow.&lt;/p&gt;</comment>
                            <comment id="15311526" author="rlow" created="Thu, 2 Jun 2016 01:04:53 +0000"  >&lt;p&gt;Without understanding the FD details, this sounds good. Losing hints isn&apos;t an issue, as you say.&lt;/p&gt;</comment>
                            <comment id="15312567" author="pauloricardomg" created="Thu, 2 Jun 2016 16:19:10 +0000"  >&lt;p&gt;Solving this when the replacing node has a different ip address is quite simple:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;Add a new non-dead gossip state for replace BOOT_REPLACE&lt;/li&gt;
	&lt;li&gt;When receiving BOOT_REPLACE, other node adds the replacing node as bootstrapping AND replacing endpoint&lt;/li&gt;
	&lt;li&gt;Pending ranges are calculated, and writes are sent to the replacing node during replace&lt;/li&gt;
	&lt;li&gt;When replacing node changes state to NORMAL, the old node is removed and the new node becomes a natural endpoint on &lt;tt&gt;TokenMetadata&lt;/tt&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;I have a WIP patch with this approach &lt;a href=&quot;https://github.com/pauloricardomg/cassandra/commit/a4be7f7a0f298b1d52821f67ff2e927a1d1f1c5e&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;here&lt;/a&gt; that is functional. The tricky part is when the replacing node has the same IP as the old node, because if this node ever joins gossip with a non-dead state, &lt;tt&gt;FailureDetector.isAlive(InetAddress)&lt;/tt&gt; return true and reads are sent to the replacing node, since the original node is a natural endpoint.&lt;/p&gt;

&lt;p&gt;My initial idea of removing the old node as a natural endpoint from &lt;tt&gt;TokenMetadata&lt;/tt&gt; obviously does not work because this changes range assignments making reads go the following node in the ring, which has no data for that range. I also considered replacing the node IP in TokenMetadata with a special marker, but this will also not play along well with snitches and topologies.&lt;/p&gt;

&lt;p&gt;A clean fix to this is to enhance the node representation on &lt;tt&gt;TokenMetadata&lt;/tt&gt;, which is currently a plain &lt;tt&gt;InetAddresss&lt;/tt&gt;, to include the information if an endpoint is available for reads (&lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-11559&quot; title=&quot;Enhance node representation&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-11559&quot;&gt;&lt;del&gt;CASSANDRA-11559&lt;/del&gt;&lt;/a&gt;), but this cannot be done before cassandra 4.0 because it will change &lt;tt&gt;TokenMetadata&lt;/tt&gt; and &lt;tt&gt;AbstractReplicationStrategy&lt;/tt&gt; public interfaces and other related classes, so it&apos;s a major refactoring in the codebase. One step further is to change the &lt;tt&gt;FailureDetector&lt;/tt&gt; interface to query nodes by &lt;tt&gt;UUIDs&lt;/tt&gt; instead of &lt;tt&gt;InetAddress&lt;/tt&gt;, so a replacing endpoint will not be confused with the original node since they will have different ids.&lt;/p&gt;

&lt;p&gt;One workaround before that would be to send a read to a normal endpoint if both &lt;tt&gt;FailureDetector.isAlive(endpoint)&lt;/tt&gt; is true and the endpoint is on &lt;tt&gt;NORMAL&lt;/tt&gt; state, so we avoid sending reads to a replacing endpoint with the same IP address. A big downside is that this check should also be peformed for other operations such as bootstrap, repairs, hints, batches, etc. I experimented with that route &lt;a href=&quot;https://github.com/pauloricardomg/cassandra/commit/a439edcbd8d4186ea2e3301681b7cc0b5012a265&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;in this commit&lt;/a&gt; by creating a method &lt;tt&gt;StorageService.isAvailable(InetAddress endpoint, boolean isPending) = {FailureDetector.instance.isAlive(endpoint) &amp;amp;&amp;amp; (isPendingEndpoint || Gossiper.instance.isNormalStatus(endpoint))&lt;/tt&gt;} that should be used instead of &lt;tt&gt;FailureDetector.isAlive(endpoint)&lt;/tt&gt;, but I&apos;m not very comfortable with this approach for the following reasons:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;It&apos;s pretty fragile, because that check must be used instead of &lt;tt&gt;FailureDetector.isAlive()&lt;/tt&gt; in every place throughout the code&lt;/li&gt;
	&lt;li&gt;Other developers/drivers/tools wil also need to use the same approach or a similar logic&lt;/li&gt;
	&lt;li&gt;We will need to modify the write path to segregate writes between natural and pending endpoints (see an example on &lt;a href=&quot;https://github.com/pauloricardomg/cassandra/commit/a439edcbd8d4186ea2e3301681b7cc0b5012a265#diff-71f06c193f5b5e270cf8ac695164f43aR498&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;doPaxosCommit&lt;/a&gt;)&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;So unless someone comes up with a magic idea, I think we&apos;re left with two options to fix this before &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-11559&quot; title=&quot;Enhance node representation&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-11559&quot;&gt;&lt;del&gt;CASSANDRA-11559&lt;/del&gt;&lt;/a&gt;:&lt;br/&gt;
1. Go ahead with &lt;tt&gt;StorageService.isAvailable&lt;/tt&gt; approach even with its downsides and fragility&lt;br/&gt;
2. Fix this only for replacing endpoints with a different IP address, falling back to the previous behavior when the replacing node has the same IP as the old node, which should already fix this in most cloud deployments, where replacement nodes usually have different IPs&lt;/p&gt;

&lt;p&gt;I&apos;m leaning more towards 2 since it&apos;s much simpler/safer and work on a proper general solution for 4.0 after &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-11559&quot; title=&quot;Enhance node representation&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-11559&quot;&gt;&lt;del&gt;CASSANDRA-11559&lt;/del&gt;&lt;/a&gt;. WDYT?&lt;/p&gt;</comment>
                            <comment id="15313417" author="pauloricardomg" created="Fri, 3 Jun 2016 00:49:56 +0000"  >&lt;p&gt;I had a closer look at &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-11559&quot; title=&quot;Enhance node representation&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-11559&quot;&gt;&lt;del&gt;CASSANDRA-11559&lt;/del&gt;&lt;/a&gt; and it should be possible to support that on trunk/3.x series without breaking compatibility, thus making this viable before 4.0 in a robust way. I will provide an initial patch for that soon.&lt;/p&gt;

&lt;p&gt;We now need to decide whether we want to have a partial/fragile solution to this ticket before the ideal fix on 3.x leveraging #11559.&lt;/p&gt;</comment>
                            <comment id="15337288" author="pauloricardomg" created="Sat, 18 Jun 2016 00:21:28 +0000"  >&lt;p&gt;Due to the limitations of forwarding writes to replacement nodes with the same IP, I propose initially adding this support only to replacement nodes with a different IP, since it&apos;s much simpler and we can do it in a backward-compatible way so it can probably go on 2.2+.&lt;/p&gt;

&lt;p&gt;After &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-11559&quot; title=&quot;Enhance node representation&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-11559&quot;&gt;&lt;del&gt;CASSANDRA-11559&lt;/del&gt;&lt;/a&gt;, we can extend this support to nodes with the same IP quite easily by setting an inactive flag on nodes being replaced and ignore these nodes on read.&lt;/p&gt;

&lt;p&gt;The central idea is:&lt;/p&gt;
&lt;blockquote&gt;
&lt;ul&gt;
	&lt;li&gt;Add a new non-dead gossip state for replace BOOT_REPLACE&lt;/li&gt;
	&lt;li&gt;When receiving BOOT_REPLACE, other node adds the replacing node as bootstrapping endpoint&lt;/li&gt;
	&lt;li&gt;Pending ranges are calculated, and writes are sent to the replacing node during replace&lt;/li&gt;
	&lt;li&gt;When replacing node changes state to NORMAL, the old node is removed and the new node becomes a natural endpoint on TokenMetadata&lt;/li&gt;
&lt;/ul&gt;
&lt;/blockquote&gt;

&lt;p&gt;Since it&apos;s no longer necessary to forward hints to the replacement node when &lt;tt&gt;replace_address != broadcast_address&lt;/tt&gt;, the replacement node does not need to inherit the same ID of the original node.&lt;/p&gt;

&lt;p&gt;The replacing process remains unchanged when the replacement node has the same IP as the original node. If that&apos;s the case, I added a warn message so users know they need to run repair if the node is down for longer than &lt;tt&gt;max_hint_window_in_ms&lt;/tt&gt;:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Writes will not be redirected to this node while it is performing replace because it has the same address as the node to be replaced ({}). 
If that node has been down for longer than max_hint_window_in_ms, repair must be run after the replacement process in order to make this node consistent.
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I adapted current dtests to test replace_address for both the old and the new path, and when &lt;tt&gt;replace_address != broadcast_address&lt;/tt&gt; make sure writes are being redirected to the replacement node.&lt;/p&gt;

&lt;p&gt;Initial patch and tests below (will provide 2.2+ patches after initial review):&lt;/p&gt;
&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;2.2&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;dtest&lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/apache/cassandra/compare/cassandra-2.2...pauloricardomg:2.2-8523&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;branch&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/riptano/cassandra-dtest/compare/master...pauloricardomg:8523&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;branch&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/paulomotta/job/pauloricardomg-2.2-8523-testall/lastCompletedBuild/testReport/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;testall&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/paulomotta/job/pauloricardomg-2.2-8523-dtest/lastCompletedBuild/testReport/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;dtest&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;
</comment>
                            <comment id="15337290" author="rlow" created="Sat, 18 Jun 2016 00:23:09 +0000"  >&lt;p&gt;Thanks! I&apos;m happy to review.&lt;/p&gt;</comment>
                            <comment id="15337301" author="brandon.williams" created="Sat, 18 Jun 2016 00:26:09 +0000"  >&lt;blockquote&gt;&lt;p&gt;Since it&apos;s no longer necessary to forward hints to the replacement node when replace_address != broadcast_address, the replacement node does not need to inherit the same ID of the original node.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I don&apos;t think that&apos;s necessarily true, if a node dies at point A, and then the replacement is issued at point N, the hints between points B and M are still missed if the host id is not the same.&lt;/p&gt;</comment>
                            <comment id="15337328" author="rlow" created="Sat, 18 Jun 2016 00:32:08 +0000"  >&lt;p&gt;It&apos;s not those writes that matter - the replacement will get those writes from the other nodes during streaming. The hints that you might care about are writes dropped during the replacement on the replacing node. But those should be extremely rare, and a price well worth paying for getting the vast majority of the writes vs none today.&lt;/p&gt;</comment>
                            <comment id="15340200" author="jmckenzie" created="Mon, 20 Jun 2016 19:08:24 +0000"  >&lt;p&gt;Missed that comment above - &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rlow&quot; class=&quot;user-hover&quot; rel=&quot;rlow&quot;&gt;rlow&lt;/a&gt; to review. Thanks!&lt;/p&gt;</comment>
                            <comment id="15340771" author="pauloricardomg" created="Tue, 21 Jun 2016 00:29:50 +0000"  >&lt;blockquote&gt;&lt;p&gt;The hints that you might care about are writes dropped during the replacement on the replacing node. &lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Even these should not be a problem, because they are also forwarded to the replacement node, and if they fail they are hinted to replacement node ID.&lt;/p&gt;

&lt;p&gt;I rebased and resubmitted dtests and fixed minor typo on the original patch. I also realized it&apos;s not necessary to change original node state to &lt;tt&gt;REMOVED_TOKEN&lt;/tt&gt; because it&apos;s already removed from gossip when the replacement node changes its state to &lt;tt&gt;NORMAL&lt;/tt&gt;, so I removed that step.&lt;/p&gt;

&lt;p&gt;Also added new dtests to test replace in a mixed-version environment to verify backward compatibility and to check for the warning message when replacing a node with the same address.&lt;/p&gt;</comment>
                            <comment id="15398667" author="rlow" created="Fri, 29 Jul 2016 03:50:15 +0000"  >&lt;p&gt;+1 patch looks good. Really like the dtests.&lt;/p&gt;</comment>
                            <comment id="15399941" author="pauloricardomg" created="Fri, 29 Jul 2016 20:17:27 +0000"  >&lt;p&gt;Thanks for taking a look! Created &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-12344&quot; title=&quot;Forward writes to replacement node with same address during replace&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-12344&quot;&gt;CASSANDRA-12344&lt;/a&gt; to follow-up with support for this when the replacement node has the same address as the original node.&lt;/p&gt;

&lt;p&gt;Rebased patch and dtests as well as merged up to 3.0+. All patches and CI results available below:&lt;/p&gt;

&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;2.2&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;3.0&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;3.9&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;trunk&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;dtest&lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/apache/cassandra/compare/cassandra-2.2...pauloricardomg:2.2-8523&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;branch&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/apache/cassandra/compare/cassandra-3.0...pauloricardomg:3.0-8523&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;branch&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/apache/cassandra/compare/cassandra-3.9...pauloricardomg:3.9-8523&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;branch&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/apache/cassandra/compare/trunk...pauloricardomg:trunk-8523&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;branch&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/riptano/cassandra-dtest/compare/master...pauloricardomg:8523&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;branch&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/paulomotta/job/pauloricardomg-2.2-8523-testall/lastCompletedBuild/testReport/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;testall&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/paulomotta/job/pauloricardomg-3.0-8523-testall/lastCompletedBuild/testReport/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;testall&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/paulomotta/job/pauloricardomg-3.9-8523-testall/lastCompletedBuild/testReport/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;testall&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/paulomotta/job/pauloricardomg-trunk-8523-testall/lastCompletedBuild/testReport/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;testall&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/paulomotta/job/pauloricardomg-2.2-8523-dtest/lastCompletedBuild/testReport/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;dtest&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/paulomotta/job/pauloricardomg-3.0-8523-dtest/lastCompletedBuild/testReport/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;dtest&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/paulomotta/job/pauloricardomg-3.9-8523-dtest/lastCompletedBuild/testReport/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;dtest&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/paulomotta/job/pauloricardomg-trunk-8523-dtest/lastCompletedBuild/testReport/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;dtest&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;


&lt;p&gt;There were some minor merge conflicts on 3.0, and a slightly larger conflict on 3.9 due to &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-10134&quot; title=&quot;Always require replace_address to replace existing address&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-10134&quot;&gt;&lt;del&gt;CASSANDRA-10134&lt;/del&gt;&lt;/a&gt;, so I did some refactoring in the 3.9+ version to move most of the logic to &lt;tt&gt;prepareForReplacement&lt;/tt&gt;. Can you take another look &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rlow&quot; class=&quot;user-hover&quot; rel=&quot;rlow&quot;&gt;rlow&lt;/a&gt;?&lt;/p&gt;

&lt;p&gt;Dtest PR created &lt;a href=&quot;https://github.com/riptano/cassandra-dtest/pull/1155&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;here&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;While this is marked an improvement and would theoretically only go to trunk, this limitation is pretty counter-intuitive and probably hurts many users in the wild, and since the changeset is relatively small and self-contained, I think it could be interpreted as a bugfix and perhaps go on 2.2+ or maybe 3.0+. WDYT &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=brandon.williams&quot; class=&quot;user-hover&quot; rel=&quot;brandon.williams&quot;&gt;brandon.williams&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jkni&quot; class=&quot;user-hover&quot; rel=&quot;jkni&quot;&gt;jkni&lt;/a&gt; ?&lt;/p&gt;</comment>
                            <comment id="15399949" author="rlow" created="Fri, 29 Jul 2016 20:27:04 +0000"  >&lt;p&gt;I&apos;ll review the 3.9 version. I&apos;m very much in favour of putting this in 2.2 and 3.0 as this hurts us badly and no doubt others suffer too.&lt;/p&gt;</comment>
                            <comment id="15416328" author="rlow" created="Thu, 11 Aug 2016 01:20:57 +0000"  >&lt;p&gt;+1 on the 3.9 version too.&lt;/p&gt;</comment>
                            <comment id="15427310" author="pauloricardomg" created="Thu, 18 Aug 2016 22:45:38 +0000"  >&lt;p&gt;Thanks! This will be ready to commit after &lt;a href=&quot;https://github.com/riptano/cassandra-dtest/pull/1155&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;PR&lt;/a&gt; is reviewed and merged. I rebased with the updated dtests and submitted a new CI run:&lt;/p&gt;

&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;2.2&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;3.0&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;trunk&lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/apache/cassandra/compare/cassandra-2.2...pauloricardomg:2.2-8523&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;branch&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/apache/cassandra/compare/cassandra-3.0...pauloricardomg:3.0-8523&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;branch&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/apache/cassandra/compare/trunk...pauloricardomg:trunk-8523&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;branch&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/paulomotta/job/pauloricardomg-2.2-8523-testall/lastCompletedBuild/testReport/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;testall&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/paulomotta/job/pauloricardomg-3.0-8523-testall/lastCompletedBuild/testReport/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;testall&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/paulomotta/job/pauloricardomg-trunk-8523-testall/lastCompletedBuild/testReport/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;testall&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/paulomotta/job/pauloricardomg-2.2-8523-dtest/lastCompletedBuild/testReport/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;dtest&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/paulomotta/job/pauloricardomg-3.0-8523-dtest/lastCompletedBuild/testReport/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;dtest&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/paulomotta/job/pauloricardomg-trunk-8523-dtest/lastCompletedBuild/testReport/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;dtest&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;
</comment>
                            <comment id="15427335" author="rlow" created="Thu, 18 Aug 2016 23:07:28 +0000"  >&lt;p&gt;Are you waiting for me to review the dtest PR?&lt;/p&gt;</comment>
                            <comment id="15427337" author="pauloricardomg" created="Thu, 18 Aug 2016 23:09:25 +0000"  >&lt;p&gt;No, someone from the cassandra-dtest is reviewing, but since this will break existing tests it can only be commited after that is merged.&lt;/p&gt;</comment>
                            <comment id="15449587" author="kohlisankalp" created="Tue, 30 Aug 2016 17:23:28 +0000"  >&lt;p&gt;Any updates about the Dtests&lt;/p&gt;</comment>
                            <comment id="15449594" author="philipthompson" created="Tue, 30 Aug 2016 17:26:21 +0000"  >&lt;p&gt;I don&apos;t think the tests are waiting on anything at this point, but &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=pauloricardomg&quot; class=&quot;user-hover&quot; rel=&quot;pauloricardomg&quot;&gt;pauloricardomg&lt;/a&gt; can confirm&lt;/p&gt;</comment>
                            <comment id="15449605" author="pauloricardomg" created="Tue, 30 Aug 2016 17:28:54 +0000"  >&lt;p&gt;Waiting final +1 and then will mark as ready to commit.&lt;/p&gt;</comment>
                            <comment id="15449749" author="kohlisankalp" created="Tue, 30 Aug 2016 18:27:56 +0000"  >&lt;p&gt;waiting final +1 from whom?&lt;/p&gt;</comment>
                            <comment id="15449771" author="pauloricardomg" created="Tue, 30 Aug 2016 18:37:12 +0000"  >&lt;p&gt;from &lt;a href=&quot;https://github.com/riptano/cassandra-dtest/pull/1155&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;PR#1155&lt;/a&gt;, it&apos;s done. &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="15453146" author="iamaleksey" created="Wed, 31 Aug 2016 19:31:28 +0000"  >&lt;p&gt;Committed as &lt;a href=&quot;https://github.com/apache/cassandra/commit/b39d984f7bd682c7638415d65dcc4ac9bcb74e5f&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;b39d984f7bd682c7638415d65dcc4ac9bcb74e5f&lt;/a&gt; to 2.2, merged with 3.0 and trunk. Thanks.&lt;/p&gt;</comment>
                            <comment id="16146592" author="githubbot" created="Wed, 30 Aug 2017 04:38:13 +0000"  >&lt;p&gt;GitHub user kgreav opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/cassandra/pull/145&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/cassandra/pull/145&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Describe replacement cases based on &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-8523&quot; title=&quot;Writes should be sent to a replacement node which has a new IP while it is streaming in data&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-8523&quot;&gt;&lt;del&gt;CASSANDRA-8523&lt;/del&gt;&lt;/a&gt; and &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-12344&quot; title=&quot;Forward writes to replacement node with same address during replace&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-12344&quot;&gt;CASSANDRA-12344&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Just updating the docs to cover cases where replacing with a same IP node and different IP node.&lt;/p&gt;

&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/kgreav/cassandra&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/kgreav/cassandra&lt;/a&gt; replace_fix&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/cassandra/pull/145.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/cassandra/pull/145.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #145&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit e9228182d7f6916eab0dd64afcc57fedb103f25c&lt;br/&gt;
Author: kurt &amp;lt;kurt@instaclustr.com&amp;gt;&lt;br/&gt;
Date:   2017-08-29T03:36:12Z&lt;/p&gt;

&lt;p&gt;    Describe replacement cases based on &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-8523&quot; title=&quot;Writes should be sent to a replacement node which has a new IP while it is streaming in data&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-8523&quot;&gt;&lt;del&gt;CASSANDRA-8523&lt;/del&gt;&lt;/a&gt; and &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-12344&quot; title=&quot;Forward writes to replacement node with same address during replace&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-12344&quot;&gt;CASSANDRA-12344&lt;/a&gt;&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="16146625" author="githubbot" created="Wed, 30 Aug 2017 05:19:22 +0000"  >&lt;p&gt;Github user asfgit closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/cassandra/pull/145&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/cassandra/pull/145&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12824032">CASSANDRA-9244</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="13022043">CASSANDRA-12935</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="13340359">CASSANDRA-16271</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12993622">CASSANDRA-12344</issuekey>
        </issuelink>
                            </outwardlinks>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12762083">CASSANDRA-8494</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[pauloricardomg]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 11 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i23n73:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12311421" key="com.atlassian.jira.plugin.system.customfieldtypes:multiversion">
                        <customfieldname>Reproduced In</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="12326830">2.0.9</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>rlow</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[rlow]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12962"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>