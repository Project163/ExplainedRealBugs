<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 22:35:56 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-4679] Fix binary protocol NEW_NODE event</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-4679</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;As discussed on &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-4480&quot; title=&quot;Binary protocol: adds events push&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-4480&quot;&gt;&lt;del&gt;CASSANDRA-4480&lt;/del&gt;&lt;/a&gt;, the NEW_NODE/REMOVED_NODE of the binary protocol are not correctly fired (NEW_NODE is fired on node UP basically). This ticket is to fix that.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12608065">CASSANDRA-4679</key>
            <summary>Fix binary protocol NEW_NODE event</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10003" iconUrl="https://issues.apache.org/jira/images/icons/priorities/trivial.svg">Low</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="slebresne">Sylvain Lebresne</assignee>
                                    <reporter username="slebresne">Sylvain Lebresne</reporter>
                        <labels>
                    </labels>
                <created>Tue, 18 Sep 2012 14:01:41 +0000</created>
                <updated>Tue, 16 Apr 2019 09:32:27 +0000</updated>
                            <resolved>Mon, 5 Nov 2012 16:36:48 +0000</resolved>
                                        <fixVersion>1.2.0 beta 2</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                                                                <comments>
                            <comment id="13457850" author="slebresne" created="Tue, 18 Sep 2012 14:19:10 +0000"  >&lt;p&gt;Attaching patch that adds a new listener interface for &quot;higher level&quot; events than the gossip ones.&lt;/p&gt;</comment>
                            <comment id="13466720" author="slebresne" created="Mon, 1 Oct 2012 10:15:20 +0000"  >&lt;p&gt;I&apos;ve rebased the patch and added a short paragraph to the protocol doc to explain that UP events are usually sent a few milliseconds before the binary protocol server is fully up (since gossip is started before the protocol server).&lt;/p&gt;</comment>
                            <comment id="13466802" author="jbellis" created="Mon, 1 Oct 2012 13:54:44 +0000"  >&lt;p&gt;We can always change that ordering.  Maybe we should.&lt;/p&gt;</comment>
                            <comment id="13466824" author="slebresne" created="Mon, 1 Oct 2012 14:15:17 +0000"  >&lt;p&gt;I suppose we can, yes. Though I suspect there may be races so that some queries (I&apos;m thinking schema altering ones though honestly I haven&apos;t checked) might trigger assertion errors or related if gossip isn&apos;t started. Probably worth checking though. Maybe in a separate ticket however since it&apos;s not directly related (clients will have a to handle the case where after a NEW_NODE the node cannot be joined anyway).&lt;/p&gt;</comment>
                            <comment id="13482338" author="slebresne" created="Tue, 23 Oct 2012 14:03:20 +0000"  >&lt;p&gt;I&apos;ve rebased the patch and attaching a second patch to start the binary protocol server before gossip. This seems to be working as expected but the fact that bootstrap is broken on trunk (due to &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-4764&quot; title=&quot;Clean out STREAM_STAGE vestiges&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-4764&quot;&gt;&lt;del&gt;CASSANDRA-4764&lt;/del&gt;&lt;/a&gt;) makes it a bit harder to test correctly.&lt;/p&gt;</comment>
                            <comment id="13484858" author="slebresne" created="Fri, 26 Oct 2012 11:24:45 +0000"  >&lt;p&gt;I&apos;ve also updated the first patch to send a TOPOLOGY_CHANGE event when a node has moved since that was missing and trivial to add.&lt;/p&gt;</comment>
                            <comment id="13486132" author="yukim" created="Mon, 29 Oct 2012 16:43:11 +0000"  >&lt;p&gt;Patch looks good, though AntiEntropyServiceStandardTest/AntiEntropyServiceCounterTest is failing after applying this patch.&lt;/p&gt;</comment>
                            <comment id="13486172" author="slebresne" created="Mon, 29 Oct 2012 17:24:02 +0000"  >&lt;p&gt;Interesting. This is due to the hardcoded call to StorageServer.initServer() in AntiEntropyServiceTestAbstract. But I have absolutely no clue what we have that call. In fact, removing that call (patch 3 attached) fixes the test. I&apos;m not totally sure why the test was working previously, maybe the 2 patch of this ticket just changed the timing of the server initialization triggering that issue?&lt;/p&gt;</comment>
                            <comment id="13486354" author="yukim" created="Mon, 29 Oct 2012 21:04:20 +0000"  >&lt;p&gt;I found the difference between patched and trunk.&lt;br/&gt;
Your initServer tries to &quot;join ring&quot; even after server is initialized, whilst in trunk it is guarded by &quot;initialized&quot; check.&lt;br/&gt;
I think it is better to check if initialized before calling matbeJoinRing in your patch.&lt;/p&gt;</comment>
                            <comment id="13486709" author="slebresne" created="Tue, 30 Oct 2012 07:26:13 +0000"  >&lt;p&gt;Ok, you&apos;re right and I&apos;ve updated the first patch to add back the same &apos;is initialized&apos; check. I leave the third patch though since that hardcoded call is still useless (but the test pass even if we don&apos;t remove it).&lt;/p&gt;</comment>
                            <comment id="13486905" author="yukim" created="Tue, 30 Oct 2012 14:28:25 +0000"  >&lt;p&gt;+1 for all patches.&lt;/p&gt;</comment>
                            <comment id="13486929" author="slebresne" created="Tue, 30 Oct 2012 15:13:08 +0000"  >&lt;p&gt;Committed, thanks&lt;/p&gt;</comment>
                            <comment id="13490699" author="brandon.williams" created="Mon, 5 Nov 2012 16:03:38 +0000"  >&lt;p&gt;Reopening because (at least sometimes) this allows thrift to start before MS and gossip, which is wrong, but also other things seem to be breaking like bootstrap.&lt;/p&gt;</comment>
                            <comment id="13490708" author="slebresne" created="Mon, 5 Nov 2012 16:14:47 +0000"  >&lt;p&gt;As much as I&apos;m happy to revert the part about starting the thrift/binary protocol server first, I&apos;d prefer some precision about &quot;breaks all kind of things&quot;. That is, does that break things only if people query the thrift interface before MS and gossip are up (which would make sense, but in real life doesn&apos;t seem like very likely to happen (which doesn&apos;t mean we shouldn&apos;t fix it btw)), or does it break things in other cases?&lt;/p&gt;</comment>
                            <comment id="13490710" author="brandon.williams" created="Mon, 5 Nov 2012 16:16:14 +0000"  >&lt;p&gt;Sorry, edited my comment to clarify while you were posting yours &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="13490719" author="slebresne" created="Mon, 5 Nov 2012 16:36:48 +0000"  >&lt;p&gt;Alright, I&apos;ve reverted the &apos;start thrift before gossip part of this patch&apos;. That has never been the most important part anyway. This should fix any regression at least as far as this ticket is concerned.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12551313" name="0001-4679.txt" size="13042" author="slebresne" created="Tue, 30 Oct 2012 07:24:15 +0000"/>
                            <attachment id="12551314" name="0002-Start-RPC-binary-protocol-before-gossip.txt" size="4358" author="slebresne" created="Tue, 30 Oct 2012 07:24:15 +0000"/>
                            <attachment id="12551212" name="0003-Remove-hardcoded-initServer-from-AntiEntropyServiceTes.txt" size="1105" author="slebresne" created="Mon, 29 Oct 2012 17:24:02 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[slebresne]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>239456</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            13 years, 3 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i00hgn:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>762</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>yukim</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[yukim]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12961"><![CDATA[Low]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>