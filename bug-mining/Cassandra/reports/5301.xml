<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 23:14:56 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-15273] cassandra does not start with new systemd version</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-15273</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;After update systemd with&#160; fixed vulnerability &lt;a href=&quot;https://access.redhat.com/security/cve/cve-2018-16888&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://access.redhat.com/security/cve/cve-2018-16888&lt;/a&gt;, the cassandra service does not start correctly.&lt;/p&gt;

&lt;p&gt;Environment: RHEL 7,&#160;systemd-219-67.el7_7.1,&#160;cassandra-3.11.4-1 (&lt;a href=&quot;https://www.apache.org/dist/cassandra/redhat/311x/cassandra-3.11.4-1.noarch.rpm&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://www.apache.org/dist/cassandra/redhat/311x/cassandra-3.11.4-1.noarch.rpm&lt;/a&gt;)&lt;/p&gt;

&lt;p&gt;---------------------------------------------------------------&lt;/p&gt;

&lt;p&gt;systemctl status cassandra&lt;br/&gt;
&#9679; cassandra.service - LSB: distributed storage system for structured data&lt;br/&gt;
 Loaded: loaded (/etc/rc.d/init.d/cassandra; bad; vendor preset: disabled)&lt;br/&gt;
 Active: failed (Result: resources) since Fri 2019-08-09 17:20:26 MSK; 1s ago&lt;br/&gt;
 Docs: man:systemd-sysv-generator(8)&lt;br/&gt;
 Process: 2414 ExecStop=/etc/rc.d/init.d/cassandra stop (code=exited, status=0/SUCCESS)&lt;br/&gt;
 Process: 2463 ExecStart=/etc/rc.d/init.d/cassandra start (code=exited, status=0/SUCCESS)&lt;br/&gt;
 Main PID: 1884 (code=exited, status=143)&lt;/p&gt;

&lt;p&gt;Aug 09 17:20:23 desktop43.example.com systemd&lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt;: Unit cassandra.service entered failed state.&lt;br/&gt;
Aug 09 17:20:23 desktop43.example.com systemd&lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt;: cassandra.service failed.&lt;br/&gt;
Aug 09 17:20:23 desktop43.example.com systemd&lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt;: Starting LSB: distributed storage system for structured data...&lt;br/&gt;
Aug 09 17:20:23 desktop43.example.com su&lt;span class=&quot;error&quot;&gt;&amp;#91;2473&amp;#93;&lt;/span&gt;: (to cassandra) root on none&lt;br/&gt;
Aug 09 17:20:26 desktop43.example.com cassandra&lt;span class=&quot;error&quot;&gt;&amp;#91;2463&amp;#93;&lt;/span&gt;: Starting Cassandra: OK&lt;br/&gt;
Aug 09 17:20:26 desktop43.example.com systemd&lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt;: New main PID 2545 does not belong to service, and PID file is not owned by root. Refusing.&lt;br/&gt;
Aug 09 17:20:26 desktop43.example.com systemd&lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt;: New main PID 2545 does not belong to service, and PID file is not owned by root. Refusing.&lt;br/&gt;
Aug 09 17:20:26 desktop43.example.com systemd&lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt;: Failed to start LSB: distributed storage system for structured data.&lt;br/&gt;
Aug 09 17:20:26 desktop43.example.com systemd&lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt;: Unit cassandra.service entered failed state.&lt;br/&gt;
Aug 09 17:20:26 desktop43.example.com systemd&lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt;: cassandra.service failed.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13250196">CASSANDRA-15273</key>
            <summary>cassandra does not start with new systemd version</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10000" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Urgent</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="mck">Michael Semb Wever</assignee>
                                    <reporter username="Aleksandr Yatskin">Aleksandr Yatskin</reporter>
                        <labels>
                    </labels>
                <created>Mon, 12 Aug 2019 07:04:51 +0000</created>
                <updated>Fri, 15 May 2020 08:54:27 +0000</updated>
                            <resolved>Tue, 3 Mar 2020 21:55:46 +0000</resolved>
                                        <fixVersion>2.2.17</fixVersion>
                    <fixVersion>3.0.21</fixVersion>
                    <fixVersion>3.11.7</fixVersion>
                    <fixVersion>4.0-alpha4</fixVersion>
                    <fixVersion>4.0</fixVersion>
                                    <component>Packaging</component>
                        <due></due>
                            <votes>10</votes>
                                    <watches>22</watches>
                                                                                                                <comments>
                            <comment id="16905753" author="maxwellguo" created="Tue, 13 Aug 2019 02:40:07 +0000"  >&lt;p&gt;I think you should attach some logs then we can get more information for this question. the older version of cassandra should also be attached .&lt;/p&gt;</comment>
                            <comment id="16905863" author="aleksandr yatskin" created="Tue, 13 Aug 2019 06:22:06 +0000"  >&lt;p&gt;The cassandra starts, but the systemd cannot control it. The cause is that when the cassandra starts, the old initialization SysV script is used, in which it is obviously impossible to specify the user and group to start the service.&lt;/p&gt;

&lt;p&gt;It&apos;s about user/group options for systemd:&lt;br/&gt;
 -----------------&lt;br/&gt;
 &lt;em&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;Service&amp;#93;&lt;/span&gt;&lt;/em&gt;&lt;br/&gt;
 &lt;em&gt;User=cassandra&lt;/em&gt;&lt;br/&gt;
 &lt;em&gt;Group=cassandra&lt;/em&gt;&lt;br/&gt;
 -----------------&lt;/p&gt;

&lt;p&gt;But since the process pid is created with the permissions of the cassandra user, and the user and group are not specified in the initialization script, the systemd consider that it uses the root to start the service (by default) and does not allow creating the pid with cassandra user permissions.&lt;br/&gt;
 ------------------&lt;br/&gt;
 &lt;em&gt;systemd&lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt;: New main PID 2545 does not belong to service, and PID file is not owned by root. Refusing.&lt;/em&gt;&lt;br/&gt;
 ------------------&lt;/p&gt;

&lt;p&gt;More details in CVE-2018-16888 (&lt;a href=&quot;https://access.redhat.com/security/cve/cve-2018-16888&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://access.redhat.com/security/cve/cve-2018-16888&lt;/a&gt;)&lt;br/&gt;
 ------------------&lt;br/&gt;
 &lt;em&gt;It was discovered systemd does not correctly check the content of PIDFile files before using it to kill processes. When a service is run from an unprivileged user (e.g. User field set in the service file), a local attacker who is able to write to the PIDFile of the mentioned service may use this flaw to trick systemd into killing other services and/or privileged processes.&lt;/em&gt;&lt;br/&gt;
 ------------------&lt;/p&gt;</comment>
                            <comment id="16911990" author="jonasbartho" created="Wed, 21 Aug 2019 07:11:37 +0000"  >&lt;p&gt;We are experiencing the same! We are on&#160; cassandra-version 3.11.1-1.&lt;/p&gt;

&lt;p&gt;What is the status on this?&lt;/p&gt;</comment>
                            <comment id="16938501" author="jonasbarthol" created="Thu, 26 Sep 2019 11:12:13 +0000"  >&lt;p&gt;Hi,&lt;/p&gt;

&lt;p&gt;Is there any update on this? This is still a big issue.&lt;/p&gt;

&lt;p&gt;We cannot patch our systems due to this bug. :/&lt;/p&gt;</comment>
                            <comment id="16938502" author="jonasbarthol" created="Thu, 26 Sep 2019 11:15:37 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jolynch&quot; class=&quot;user-hover&quot; rel=&quot;jolynch&quot;&gt;jolynch&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jasobrown&quot; class=&quot;user-hover&quot; rel=&quot;jasobrown&quot;&gt;jasobrown&lt;/a&gt;, can any of you guys assist with this issue? &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="16952819" author="musinsky" created="Wed, 16 Oct 2019 13:22:40 +0000"  >&lt;p&gt;For anyone who wants a quick and dirty patch to the SysV init script, this should work.&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt; --- /etc/rc.d/init.d/cassandra	2017-06-19 20:09:05.000000000 +0000
+++ cassandra	2019-10-16 13:19:48.527564181 +0000
@@ -69,7 +69,8 @@
         echo -n &quot;Starting Cassandra: &quot;
         [ -d `dirname &quot;$pid_file&quot;` ] || \
             install -m 755 -o $CASSANDRA_OWNR -g $CASSANDRA_OWNR -d `dirname $pid_file`
-        su $CASSANDRA_OWNR -c &quot;$CASSANDRA_PROG -p $pid_file&quot; &amp;gt; $log_file 2&amp;gt;&amp;amp;1
+        runuser -u $CASSANDRA_OWNR -- $CASSANDRA_PROG -p $pid_file &amp;gt; $log_file 2&amp;gt;&amp;amp;1 
+        chown root.root $pid_file
         retval=$?
         [ $retval -eq 0 ] &amp;amp;&amp;amp; touch $lock_file
         echo &quot;OK&quot;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
</comment>
                            <comment id="16952907" author="mcnamara-dale" created="Wed, 16 Oct 2019 15:00:35 +0000"  >&lt;p&gt;Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=musinsky&quot; class=&quot;user-hover&quot; rel=&quot;musinsky&quot;&gt;musinsky&lt;/a&gt;, that fixed it for me!&lt;/p&gt;</comment>
                            <comment id="16969329" author="demsey" created="Thu, 7 Nov 2019 15:08:04 +0000"  >&lt;h5&gt;&lt;a name=&quot;Shouldn%27tcassandraregisterservicesinthesystemdlikeotherstandardservices%3F&quot;&gt;&lt;/a&gt;Shouldn&apos;t cassandra register services in the systemd like other standard services?&lt;/h5&gt;

&lt;p&gt;For example in RHEL 7:&lt;br/&gt;
&lt;tt&gt;/usr/lib/systemd/system/sshd.service&lt;/tt&gt;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-bash&quot;&gt;
[Unit]
Description=OpenSSH server daemon
Documentation=man:sshd(8) man:sshd_config(5)
After=network.target sshd-keygen.service
Wants=sshd-keygen.service

[Service]
Type=notify
EnvironmentFile=/etc/sysconfig/sshd
ExecStart=/usr/sbin/sshd -D &lt;span class=&quot;code-object&quot;&gt;$OPTIONS&lt;/span&gt;
ExecReload=/bin/kill -HUP &lt;span class=&quot;code-object&quot;&gt;$MAINPID&lt;/span&gt;
KillMode=process
Restart=on-failure
RestartSec=42s

[Install]
WantedBy=multi-user.target
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&lt;tt&gt;Of course /etc/init.d/cassandra is then superfluous &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/tt&gt;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;As example it is&#160;&lt;tt&gt;/usr/lib/systemd/system/cassandra.service&lt;/tt&gt; from OpenSUSE 15.1&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-bash&quot;&gt;
[Unit]
Description=Cassandra
After=network.target

[Service]
Environment=CASSANDRA_HOME=/usr/share/cassandra CASSANDRA_CONF=/etc/cassandra/conf CASSANDRA_INCLUDE=/usr/share/cassandra/cassandra.&lt;span class=&quot;code-object&quot;&gt;in&lt;/span&gt;.sh
EnvironmentFile=/etc/sysconfig/cassandra
User=cassandra
ExecStart=/usr/sbin/cassandra -f
ExecStopPost=/usr/bin/sleep 5 ; /usr/bin/rm -f /var/lock/subsys/cassandra
StandardOutput=journal
StandardError=journal
LimitNOFILE=100000
LimitMEMLOCK=infinity
LimitNPROC=32768
LimitAS=infinity
SuccessExitStatus=143
TimeoutStopSec=60
Restart=on-failure

[Install]
WantedBy=multi-user.target
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="16980248" author="fcampuzano" created="Fri, 22 Nov 2019 15:37:01 +0000"  >&lt;p&gt;Hi Guys, I have the same problem, in Centos7 and Redhat7 with CASSANDRA. could you help me to execute the scrip I tried but it did not work, where I must run it, first I must create a file with the scrip and then execute it so it would be the procedure .. thanks.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;root@localhost ~&amp;#93;&lt;/span&gt;# service cassandra start&lt;br/&gt;
Starting cassandra (via systemctl): Job for cassandra.service failed because a configured resource limit was exceeded. See &quot;systemctl status cassandra.service&quot; and &quot;journalctl -xe&quot; for details.&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;FAILED&amp;#93;&lt;/span&gt;&lt;/p&gt;


&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;root@localhost ~&amp;#93;&lt;/span&gt;# systemctl status cassandra.service&lt;br/&gt;
&#9679; cassandra.service - LSB: distributed storage system for structured data&lt;br/&gt;
 Loaded: loaded (/etc/rc.d/init.d/cassandra; bad; vendor preset: disabled)&lt;br/&gt;
 Active: failed (Result: resources) since Fri 2019-11-22 10:19:29 -05; 8s ago&lt;br/&gt;
 Docs: man:systemd-sysv-generator(8)&lt;br/&gt;
 Process: 10565 ExecStart=/etc/rc.d/init.d/cassandra start (code=exited, status=0/SUCCESS)&lt;/p&gt;

&lt;p&gt;Nov 22 10:19:29 localhost.localdomain systemd&lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt;: Starting LSB: distributed storage system for structured data...&lt;br/&gt;
Nov 22 10:19:29 localhost.localdomain su&lt;span class=&quot;error&quot;&gt;&amp;#91;10575&amp;#93;&lt;/span&gt;: (to cassandra) root on none&lt;br/&gt;
Nov 22 10:19:29 localhost.localdomain systemd&lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt;: New main PID 10649 does not belong to service, and PID file is not owned by root. Refusing.&lt;br/&gt;
Nov 22 10:19:29 localhost.localdomain cassandra&lt;span class=&quot;error&quot;&gt;&amp;#91;10565&amp;#93;&lt;/span&gt;: Starting Cassandra: OK&lt;br/&gt;
Nov 22 10:19:29 localhost.localdomain systemd&lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt;: New main PID 10649 does not belong to service, and PID file is not owned by root. Refusing.&lt;br/&gt;
Nov 22 10:19:29 localhost.localdomain systemd&lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt;: Failed to start LSB: distributed storage system for structured data.&lt;br/&gt;
Nov 22 10:19:29 localhost.localdomain systemd&lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt;: Unit cassandra.service entered failed state.&lt;br/&gt;
Nov 22 10:19:29 localhost.localdomain systemd&lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt;: cassandra.service failed.&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;root@localhost ~&amp;#93;&lt;/span&gt;#&lt;/p&gt;</comment>
                            <comment id="16981976" author="pioto" created="Mon, 25 Nov 2019 23:21:55 +0000"  >&lt;p&gt;The fix from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=musinsky&quot; class=&quot;user-hover&quot; rel=&quot;musinsky&quot;&gt;musinsky&lt;/a&gt; doesn&apos;t seem to have helped for me. I&apos;m now seeing:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Nov 25 18:19:31 test.example.com systemd[1]: Starting LSB: distributed storage system for structured data...
-- Subject: Unit cassandra.service has begun start-up
-- Defined-By: systemd
-- Support: http://lists.freedesktop.org/mailman/listinfo/systemd-devel
--
-- Unit cassandra.service has begun starting up.
Nov 25 18:19:31 test.example.com runuser[7211]: pam_unix(runuser:session): session opened for user cassandra by (uid=0)
Nov 25 18:19:32 test.example.com cassandra[7201]: Starting Cassandra: OK
Nov 25 18:19:32 test.example.com systemd[1]: New main PID 7289 does not exist or is a zombie.
Nov 25 18:19:32 test.example.com systemd[1]: Failed to start LSB: distributed storage system for structured data.
-- Subject: Unit cassandra.service has failed
-- Defined-By: systemd
-- Support: http://lists.freedesktop.org/mailman/listinfo/systemd-devel
--
-- Unit cassandra.service has failed.
--
-- The result is failed.
Nov 25 18:19:32 test.example.com systemd[1]: Unit cassandra.service entered failed state.
Nov 25 18:19:32 test.example.com systemd[1]: cassandra.service failed.
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="16981981" author="pioto" created="Mon, 25 Nov 2019 23:34:36 +0000"  >&lt;p&gt;Nevermind, seems I had a different issue, my JAVA_HOME globally had changed to point to JDK 11.&lt;/p&gt;

&lt;p&gt;Adding &lt;tt&gt;JAVA_HOME=/usr/lib/jvm/java-1.8.0-openjdk&lt;/tt&gt; to &lt;tt&gt;/etc/default/cassandra&lt;/tt&gt;, along with the changes suggested by &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=musinsky&quot; class=&quot;user-hover&quot; rel=&quot;musinsky&quot;&gt;musinsky&lt;/a&gt;, were sufficient to get Cassandra running again.&lt;/p&gt;

&lt;p&gt;Thanks!&lt;/p&gt;</comment>
                            <comment id="16982987" author="acerna" created="Tue, 26 Nov 2019 22:55:27 +0000"  >&lt;p&gt;Hello, the solution for the start of the service was good, but I had to modify the command for RHEL 7.7 but when I execute the stop, the message status=1/FAILURE appears and that I also changed the command syntax.&lt;/p&gt;

&lt;p&gt;I have changed the command in the script this way:&lt;/p&gt;

&lt;p&gt;runuser $ CASSANDRA_OWNR -c &quot;kill` cat $ pid_file` &quot;&lt;/p&gt;

&lt;p&gt;I have tried to make changes in the scritp but it has not worked, I just have to change the value from 1 to 0 in this part:&lt;/p&gt;

&lt;p&gt;if &lt;span class=&quot;error&quot;&gt;&amp;#91;$ retval -eq 3&amp;#93;&lt;/span&gt;; then&lt;br/&gt;
I miss &quot;OK&quot;&lt;br/&gt;
else&lt;br/&gt;
echo &quot;ERROR: could not stop $ NAME&quot;&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;exit 1&lt;br/&gt;
exit 0&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;If you already have the solution please let her know, I remain attentive to your comments.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="17033660" author="jalbersdorfer" created="Mon, 10 Feb 2020 15:03:07 +0000"  >&lt;p&gt;As a followup to &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=musinsky&quot; class=&quot;user-hover&quot; rel=&quot;musinsky&quot;&gt;musinsky&lt;/a&gt; and as an Answer for &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=acerna&quot; class=&quot;user-hover&quot; rel=&quot;acerna&quot;&gt;acerna&lt;/a&gt;, I fixed both &lt;tt&gt;start&lt;/tt&gt; and &lt;tt&gt;stop&lt;/tt&gt; as following:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;--- /etc/rc.d/init.d/cassandra.old       2020-02-10 15:23:38.852120933 +0100
+++ /etc/rc.d/init.d/cassandra.new       2020-02-10 15:23:10.610076622 +0100
@@ -71,7 +71,9 @@
        chown -R cassandra:cassandra &quot;$(dirname &quot;$log_file&quot;)&quot;
         [ -d `dirname &quot;$pid_file&quot;` ] || \
             install -m 755 -o $CASSANDRA_OWNR -g $CASSANDRA_OWNR -d `dirname $pid_file`
-        su $CASSANDRA_OWNR -c &quot;$CASSANDRA_PROG -p $pid_file&quot; &amp;gt; $log_file 2&amp;gt;&amp;amp;1
+        # su $CASSANDRA_OWNR -c &quot;$CASSANDRA_PROG -p $pid_file&quot; &amp;gt; $log_file 2&amp;gt;&amp;amp;1
+        runuser -u $CASSANDRA_OWNR -- $CASSANDRA_PROG -p $pid_file &amp;gt; $log_file 2&amp;gt;&amp;amp;1
+        chown root.root $pid_file
         retval=$?
         [ $retval -eq 0 ] &amp;amp;&amp;amp; touch $lock_file
         echo &quot;OK&quot;
@@ -79,7 +81,8 @@
     stop)
         # Cassandra shutdown
         echo -n &quot;Shutdown Cassandra: &quot;
-        su $CASSANDRA_OWNR -c &quot;kill `cat $pid_file`&quot;
+        # su $CASSANDRA_OWNR -c &quot;kill `cat $pid_file`&quot;
+        runuser -u $CASSANDRA_OWNR -- kill `cat $pid_file`
         retval=$?
         [ $retval -eq 0 ] &amp;amp;&amp;amp; rm -f $lock_file
         for t in `seq 40`; do
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="17035033" author="zznate" created="Wed, 12 Feb 2020 04:19:45 +0000"  >&lt;p&gt;If someone wants to distill this into a patch, we would be interested! cc/ &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mshuler&quot; class=&quot;user-hover&quot; rel=&quot;mshuler&quot;&gt;mshuler&lt;/a&gt; and &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mck2&quot; class=&quot;user-hover&quot; rel=&quot;mck2&quot;&gt;mck2&lt;/a&gt; sense they are wrestling some build stuff right now.&lt;/p&gt;</comment>
                            <comment id="17040336" author="pioto" created="Wed, 19 Feb 2020 18:56:16 +0000"  >&lt;p&gt;I&apos;ve attached a patch against the &lt;tt&gt;cassandra-3.11&lt;/tt&gt; branch which should work.&lt;/p&gt;
</comment>
                            <comment id="17044049" author="swapnil.dubey" created="Tue, 25 Feb 2020 01:55:35 +0000"  >&lt;p&gt;Thank you &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=pioto&quot; class=&quot;user-hover&quot; rel=&quot;pioto&quot;&gt;pioto&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;I followed the Code mentioned in&#160;&lt;span class=&quot;nobr&quot;&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12993922/12993922_0001-Fix-Red-Hat-init-script-on-newer-systemd-versions.patch&quot; title=&quot;0001-Fix-Red-Hat-init-script-on-newer-systemd-versions.patch attached to CASSANDRA-15273&quot;&gt;0001-Fix-Red-Hat-init-script-on-newer-systemd-versions.patch&lt;sup&gt;&lt;img class=&quot;rendericon&quot; src=&quot;https://issues.apache.org/jira/images/icons/link_attachment_7.gif&quot; height=&quot;7&quot; width=&quot;7&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/sup&gt;&lt;/a&gt;&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;&lt;sup&gt;Then run the command &quot;systemctl daemon-reload&quot; and it worked.&lt;/sup&gt;&lt;/p&gt;

&lt;p&gt;Regards,&lt;/p&gt;

&lt;p&gt;Swapnil&lt;/p&gt;</comment>
                            <comment id="17050339" author="michaelsembwever" created="Tue, 3 Mar 2020 16:04:14 +0000"  >&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;branch&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;circleci&lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/apache/cassandra/compare/cassandra-2.2...thelastpickle:mck/cassandra-2.2_15273&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;cassandra_2.2_15273&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://circleci.com/gh/thelastpickle/workflows/cassandra/tree/mck%2Fcassandra-2.2_15273&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;circleci&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/apache/cassandra/compare/cassandra-3.0...thelastpickle:mck/cassandra-3.0_15273&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;cassandra_3.0_15273&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://circleci.com/gh/thelastpickle/workflows/cassandra/tree/mck%2Fcassandra-3.0_15273&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;circleci&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/apache/cassandra/compare/cassandra-3.11...thelastpickle:mck/cassandra-3.11_15273&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;cassandra_3.11_15273&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://circleci.com/gh/thelastpickle/workflows/cassandra/tree/mck%2Fcassandra-3.11_15273&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;circleci&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/apache/cassandra/compare/trunk...thelastpickle:mck/trunk_15273&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;trunk_15273&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://circleci.com/gh/thelastpickle/workflows/cassandra/tree/mck%2Ftrunk_15273&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;circleci&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;


&lt;p&gt;To test this, rather than following the instructions in &lt;a href=&quot;https://github.com/apache/cassandra/tree/trunk/redhat&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/cassandra/tree/trunk/redhat&lt;/a&gt; , I&apos;ve taken the following approach:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
docker image rm -f  `docker images -f label=org.cassandra.buildenv=centos -q`
docker build --build-arg CASSANDRA_GIT_URL=${CASSANDRA_GIT_URL} -f docker/centos7-image.docker docker/
mkdir /tmp/cassandra-rpms
docker run --rm -v /tmp/cassandra-rpms:/dist `docker images -f label=org.cassandra.buildenv=centos -q` /home/build/build-rpms.sh ${CASSANDRA_GIT_BRANCH}

docker run -v /tmp/cassandra-rpms:/dist -it centos /bin/sh
yum install java-1.8.0-openjdk
rpm -ivh /dist/cassandra-4.0~alpha4-20200303git90a391e.noarch.rpm
rm /etc/security/limits.d/cassandra.conf # &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; should be fixed
/etc/init.d/cassandra start
tail -F /&lt;span class=&quot;code-keyword&quot;&gt;var&lt;/span&gt;/log/cassandra/system.log
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This is the same approach as we used when cutting and staging releases, ref &lt;a href=&quot;https://github.com/thelastpickle/cassandra-builds/blob/mck/14970_sha512-checksums/cassandra-release/prepare_release.sh#L299-L302&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/thelastpickle/cassandra-builds/blob/mck/14970_sha512-checksums/cassandra-release/prepare_release.sh#L299-L302&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Note, we are short of packaging experience in the community and really do need extra contributors on this front. Replacing the old initialisation SysV script with a service script (&lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-13148&quot; title=&quot;Systemd support for RPM&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-13148&quot;&gt;CASSANDRA-13148&lt;/a&gt;), and testing the building of packages in the CI pipeline, as well as others like &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-13433&quot; title=&quot;RPM distribution improvements and known issues&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-13433&quot;&gt;CASSANDRA-13433&lt;/a&gt; , are obvious subsequent steps that are needed. &lt;/p&gt;</comment>
                            <comment id="17050598" author="michaelsembwever" created="Tue, 3 Mar 2020 21:55:46 +0000"  >&lt;p&gt;Committed as 9105dcd99e61537e8d177b41b7d38c5569412230&lt;/p&gt;</comment>
                            <comment id="17055721" author="kwizart" created="Tue, 10 Mar 2020 09:08:35 +0000"  >&lt;p&gt;It would be appropriate to introduce systemd support for 4.0 instead &lt;br/&gt;
See also:&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-13148&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/CASSANDRA-13148&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/apache/cassandra/pull/398&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/cassandra/pull/398&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="13037383">CASSANDRA-13148</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12993922" name="0001-Fix-Red-Hat-init-script-on-newer-systemd-versions.patch" size="1597" author="pioto" created="Wed, 19 Feb 2020 18:56:04 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[pioto]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12313825" key="com.atlassian.jira.plugin.system.customfieldtypes:cascadingselect">
                        <customfieldname>Bug Category</customfieldname>
                        <customfieldvalues>
                                                    <customfieldvalue key="13163" cascade-level=""><![CDATA[Code]]></customfieldvalue>
            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12313821" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Complexity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12964"><![CDATA[Low Hanging Fruit]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313822" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Discovered By</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12969"><![CDATA[User Report]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12313922" key="jira.plugin.projectspecificselectfield.jpssf:multicftype">
                        <customfieldname>Impacts</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="13100"><![CDATA[None]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            5 years, 36 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12313921" key="jira.plugin.projectspecificselectfield.jpssf:multicftype">
                        <customfieldname>Platform</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="13082"><![CDATA[Linux]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z05k54:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[mck]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12962"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12311420" key="com.atlassian.jira.plugin.system.customfieldtypes:version">
                        <customfieldname>Since Version</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="12314820">0.8 beta 1</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313924" key="com.atlassian.jira.plugin.system.customfieldtypes:textfield">
                        <customfieldname>Source Control Link</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>&lt;p&gt;&lt;a href=&quot;https://github.com/apache/cassandra/commit/9105dcd99e61537e8d177b41b7d38c5569412230&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/cassandra/commit/9105dcd99e61537e8d177b41b7d38c5569412230&lt;/a&gt;&lt;/p&gt;</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313823" key="com.atlassian.jira.plugin.system.customfieldtypes:textarea">
                        <customfieldname>Test and Documentation Plan</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>&lt;p&gt;This will involve testing on an RPM + systemd system.&lt;/p&gt;</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>