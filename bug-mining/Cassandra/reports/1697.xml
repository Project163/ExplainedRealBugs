<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 22:33:58 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-4380] CQLSH: describe command doesn&apos;t output valid CQL command.</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-4380</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;cqlsh:test&amp;gt; describe columnfamily stats;

CREATE TABLE stats (
  gid blob PRIMARY KEY
) WITH
  comment=&apos;&apos; AND
  comparator=&apos;CompositeType(org.apache.cassandra.db.marshal.Int32Type,org.apache.cassandra.db.marshal.BytesType,org.apache.cassandra.db.marshal.UTF8Type)&apos; AND
  read_repair_chance=0.100000 AND
  gc_grace_seconds=864000 AND
  default_validation=blob AND
  min_compaction_threshold=4 AND
  max_compaction_threshold=32 AND
  replicate_on_write=&apos;true&apos; AND
  compaction_strategy_class=&apos;SizeTieredCompactionStrategy&apos; AND
  compression_parameters:sstable_compression=&apos;SnappyCompressor&apos;;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I can create a cf in cql3 and then use describe cf to get the above output. However trying to run that create statement says that all of the following are invalid options:&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;default_validation&lt;/li&gt;
	&lt;li&gt;min_compaction_threshold&lt;/li&gt;
	&lt;li&gt;max_compaction_threshold&lt;/li&gt;
	&lt;li&gt;comparator&lt;/li&gt;
&lt;/ul&gt;
</description>
                <environment></environment>
        <key id="12595967">CASSANDRA-4380</key>
            <summary>CQLSH: describe command doesn&apos;t output valid CQL command.</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10002" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Normal</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="thepaul">paul cannon</assignee>
                                    <reporter username="nickmbailey">Nick Bailey</reporter>
                        <labels>
                            <label>cqlsh</label>
                    </labels>
                <created>Tue, 26 Jun 2012 19:20:55 +0000</created>
                <updated>Tue, 16 Apr 2019 09:32:31 +0000</updated>
                            <resolved>Wed, 11 Jul 2012 14:44:46 +0000</resolved>
                                        <fixVersion>1.1.3</fixVersion>
                                        <due></due>
                            <votes>1</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="13402044" author="slebresne" created="Wed, 27 Jun 2012 08:00:45 +0000"  >&lt;p&gt;I&apos;ll not that at lest for CQL3, as explained in &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-4377&quot; title=&quot;CQL3 column value validation bug&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-4377&quot;&gt;&lt;del&gt;CASSANDRA-4377&lt;/del&gt;&lt;/a&gt;, it will be much easier to fix on trunk than on 1.1 because of &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-4018&quot; title=&quot;Add column metadata to system columnfamilies&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-4018&quot;&gt;&lt;del&gt;CASSANDRA-4018&lt;/del&gt;&lt;/a&gt;. As far as my personal opinion is involved, I would be fine in saying that cqlsh describe command is broken with CQL3 until C* 1.2 (since CQL3 is beta until then anyway).&lt;/p&gt;</comment>
                            <comment id="13402261" author="nickmbailey" created="Wed, 27 Jun 2012 14:42:27 +0000"  >&lt;p&gt;My issue was more with the fact that it seems impossible to set any of those four properties on a cf via cql. &lt;/p&gt;</comment>
                            <comment id="13404052" author="thepaul" created="Fri, 29 Jun 2012 17:35:35 +0000"  >&lt;p&gt;This was actually intended behavior- since it&apos;s possible to create tables in cql2 which can&apos;t be duplicated in cql3, I wanted to still note the possibly-relevant options on certain tables even if the syntax wasn&apos;t valid cql3.&lt;/p&gt;

&lt;p&gt;I&apos;ve since changed my mind, however, since it is confusing and makes it harder to do automated tests on DESCRIBE output, so I&apos;ve already made this change in a personal branch. I&apos;ll put that up here.&lt;/p&gt;</comment>
                            <comment id="13409938" author="thepaul" created="Mon, 9 Jul 2012 23:14:53 +0000"  >&lt;p&gt;Nick, can you try with the bin/cqlsh from my 4380 branch, here:&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/thepaul/cassandra/tree/4380&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/thepaul/cassandra/tree/4380&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This should fix the cases where cql2-style DESCRIBE was used sometimes, even when the connection was cql3, but looking closer at your case, it might not actually fix that.&lt;/p&gt;</comment>
                            <comment id="13410476" author="nickmbailey" created="Tue, 10 Jul 2012 16:16:28 +0000"  >&lt;p&gt;Seems to work fine for me.&lt;/p&gt;</comment>
                            <comment id="13411586" author="brandon.williams" created="Wed, 11 Jul 2012 14:44:46 +0000"  >&lt;p&gt;Committed.&lt;/p&gt;</comment>
                            <comment id="13452012" author="mdione" created="Mon, 10 Sep 2012 14:30:22 +0000"  >&lt;p&gt;what about the rest of the output? if I run &#171;cqlsh --cqlversion=3&#187;, I expect that the output is CQLv3, but for a particular CF that was created with a CQLv2 command, I get:&lt;/p&gt;

&lt;p&gt;CREATE TABLE logs (&lt;br/&gt;
  day timestamp PRIMARY KEY&lt;br/&gt;
) WITH&lt;br/&gt;
  comment=&apos;&apos; AND&lt;br/&gt;
  comparator=text AND&lt;br/&gt;
  read_repair_chance=0.100000 AND&lt;br/&gt;
  gc_grace_seconds=864000 AND&lt;br/&gt;
  default_validation=text AND&lt;br/&gt;
  min_compaction_threshold=4 AND&lt;br/&gt;
  max_compaction_threshold=32 AND&lt;br/&gt;
  replicate_on_write=&apos;true&apos; AND&lt;br/&gt;
  compaction_strategy_class=&apos;SizeTieredCompactionStrategy&apos; AND&lt;br/&gt;
  compression_parameters:sstable_compression=&apos;SnappyCompressor&apos;;&lt;/p&gt;

&lt;p&gt;which is only valid in CQLv2; with CQLv3 I get this message:&lt;/p&gt;

&lt;p&gt;&amp;lt;stdin&amp;gt;:17:Bad Request: No definition found that is not part of the PRIMARY KEY&lt;/p&gt;</comment>
                            <comment id="13452102" author="thepaul" created="Mon, 10 Sep 2012 16:01:35 +0000"  >&lt;p&gt;Marcos- there isn&apos;t any way to recreate some CQL 2 tables in CQL 3. CQL 3 can model the same data, but the structure of the table needs to be different. Cqlsh does the best that it can here, but if you want a better guarantee of valid reconstruction of CQL 2 tables, use cqlsh in CQL 2 mode.&lt;/p&gt;</comment>
                            <comment id="13452120" author="jbellis" created="Mon, 10 Sep 2012 16:31:29 +0000"  >&lt;p&gt;Doesn&apos;t COMPACT STORAGE provide the ability to model thrift/cql2-style tables?&lt;/p&gt;</comment>
                            <comment id="13452131" author="thepaul" created="Mon, 10 Sep 2012 16:46:19 +0000"  >&lt;blockquote&gt;&lt;p&gt;Doesn&apos;t COMPACT STORAGE provide the ability to model thrift/cql2-style tables?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;It does for some. It probably would in this case. It doesn&apos;t for the cases where there are multiple columns with metadata in addition to undefined/wide-row columns.&lt;/p&gt;

&lt;p&gt;Maybe that&apos;s not a case worth worrying about, though. We could open a new ticket for recreating thrift/cql2-style tables in CQL 3 mode with COMPACT STORAGE and some made-up default column names like &quot;colname&quot; and &quot;value&quot; or something.&lt;/p&gt;</comment>
                            <comment id="13452147" author="slebresne" created="Mon, 10 Sep 2012 17:07:05 +0000"  >&lt;blockquote&gt;&lt;p&gt;It doesn&apos;t for the cases where there are multiple columns with metadata in addition to undefined/wide-row columns&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;That&apos;s true on 1.1 but I&apos;ll note that for 1.2, provided you use the system.schema_columnfamilies table, it should (almost) always be possible to create a valid CQL3 definition from an existing CF (potentially, and almost always in the case of CF created from thrift/CQL2, with COMPACT STORAGE). The only thing that comes in mind that makes me say &quot;almost&quot; is the case where people have created on the thrift side a column_metadata on a CompositeType. In that last case we can create a CQL3 query to recreate the CF, but not the column_metadata. I think it&apos;s safe to say that we can ignore that.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;some made-up default column names&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;The Cassandra already does that (so that you can always access thrift CF from CQL3), see CFDefinition.java. It could be worth using the same made-up names here.&lt;/p&gt;</comment>
                            <comment id="13452284" author="thepaul" created="Mon, 10 Sep 2012 18:34:48 +0000"  >&lt;blockquote&gt;&lt;p&gt;for 1.2, provided you use the system.schema_columnfamilies table, it should (almost) always be possible to create a valid CQL3 definition from an existing CF&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Could you elaborate on how that should be done? Say I made the following in CQL2:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;CREATE TABLE foo (t text PRIMARY KEY, f float, x uuid) WITH default_validation=timestamp;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;If that can be recreated in CQL 3, then I&apos;ve missed a development somewhere.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;The Cassandra already does that (so that you can always access thrift CF from CQL3), see CFDefinition.java. It could be worth using the same made-up names here.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;That&apos;s good to know. We should probably make that new ticket then.&lt;/p&gt;</comment>
                            <comment id="13452294" author="slebresne" created="Mon, 10 Sep 2012 18:45:28 +0000"  >&lt;blockquote&gt;&lt;p&gt;If that can be recreated in CQL 3, then I&apos;ve missed a development somewhere&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Good point, I think too much in term of CQL3 now I guess, forgot about those. I suppose we could generate a valid CQL3 definition that is &quot;compatible&quot; with that (the same thing without the default_validation_validation part), but it&apos;s unclear it&apos;s a better idea.&lt;/p&gt;</comment>
                            <comment id="13458777" author="dyrby76" created="Wed, 19 Sep 2012 15:58:12 +0000"  >&lt;p&gt;Using CQL3, how are you now expected to create a column family like:&lt;/p&gt;

&lt;p&gt;CREATE TABLE UserProducts&lt;br/&gt;
(&lt;br/&gt;
  userId uuid PRIMARY KEY&lt;br/&gt;
);&lt;/p&gt;

&lt;p&gt;Where I would then dynamically add the product ids in the column name for each product, and leaving the column value null for each. The type of the product id is uuid.&lt;/p&gt;

&lt;p&gt;When I try to create this column family I am told: No definition found that is not part of the PRIMARY KEY&lt;/p&gt;

&lt;p&gt;Any help is greatly appreciated.&lt;/p&gt;

&lt;p&gt;It works with CQL2, so is it a bug that CQL3 cannot? &lt;/p&gt;





</comment>
                            <comment id="13458814" author="jbellis" created="Wed, 19 Sep 2012 16:28:35 +0000"  >&lt;p&gt;CREATE TABLE UserProducts (&lt;br/&gt;
  user_id uuid,&lt;br/&gt;
  product_id uuid,&lt;br/&gt;
  PRIMARY KEY (user_id, product_id)&lt;br/&gt;
);&lt;/p&gt;

&lt;p&gt;More details at &lt;a href=&quot;http://www.datastax.com/dev/blog/schema-in-cassandra-1-1&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://www.datastax.com/dev/blog/schema-in-cassandra-1-1&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;Let&apos;s take any further discussion on usage to the mailing list.  Thanks!&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[thepaul]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>256110</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            13 years, 9 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0gv8f:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>96490</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>brandon.williams</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[brandon.williams]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12962"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>