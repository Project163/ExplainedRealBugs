<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 23:18:32 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-15810] Default StringTableSize parameter causes GC slowdown</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-15810</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;While looking at tail latency on a Cassandra cluster, it came up that the default StringTableSize in Cassandra is set to a million:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
# Larger interned string table, &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; gossip&apos;s benefit (CASSANDRA-6410)
-XX:StringTableSize=1000003&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;This was done for &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-6410&quot; title=&quot;gossip memory usage improvement&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-6410&quot;&gt;&lt;del&gt;CASSANDRA-6410&lt;/del&gt;&lt;/a&gt; by &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jbellis&quot; class=&quot;user-hover&quot; rel=&quot;jbellis&quot;&gt;jbellis&lt;/a&gt; in &apos;13, to optimize heap usage on a test case, running with 500 nodes and num_tokens=512.&lt;/p&gt;

&lt;p&gt;Until Java 13, this string table is implemented as native code, and has to be traversed entirely during the GC initial marking phase, which is a STW event.&lt;/p&gt;

&lt;p&gt;Some testing on my end shows that the pause time of a GC cycle can be reduced by approximately 10 milliseconds if we lower the string table size back to the Java 8 default of 60013 entries.&lt;/p&gt;

&lt;p&gt;Thus, I would recommend this patch (3.11 branch, similar patch for 4.0):&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
diff --git a/conf/jvm.options b/conf/jvm.options
index 01bb1685b3..c184d18c5d 100644
--- a/conf/jvm.options
+++ b/conf/jvm.options
@@ -107,9 +107,6 @@
 # Per-thread stack size.
 -Xss256k

-# Larger interned string table, &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; gossip&apos;s benefit (CASSANDRA-6410)
--XX:StringTableSize=1000003
-
 # Make sure all memory is faulted and zeroed on startup.
 # This helps prevent soft faults in containers and makes
 # transparent hugepage allocation more effective.
 &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;It does need some testing on more extreme clusters than I have access to, but I ran some Cassandra nodes with &lt;tt&gt;-XX:+PrintStringTableStatistics&lt;/tt&gt; which suggested that the Java default will suffice here.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13304706">CASSANDRA-15810</key>
            <summary>Default StringTableSize parameter causes GC slowdown</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10002" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Normal</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="blerer">Benjamin Lerer</assignee>
                                    <reporter username="tvdw">Tom van der Woerdt</reporter>
                        <labels>
                            <label>gc</label>
                            <label>performance</label>
                    </labels>
                <created>Wed, 13 May 2020 15:45:14 +0000</created>
                <updated>Wed, 16 Mar 2022 15:16:23 +0000</updated>
                            <resolved>Thu, 17 Dec 2020 17:11:48 +0000</resolved>
                                        <fixVersion>4.0-beta4</fixVersion>
                    <fixVersion>4.0</fixVersion>
                                    <component>Local/Config</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>6</watches>
                                                    <progress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                            <timeestimate seconds="0">0h</timeestimate>
                            <timespent seconds="1200">20m</timespent>
                                <comments>
                            <comment id="17176835" author="snazy" created="Thu, 13 Aug 2020 08:26:25 +0000"  >&lt;p&gt;ISTM that it&apos;s better to remove the only usage of &lt;tt&gt;String.intern()&lt;/tt&gt; in &lt;tt&gt;org.apache.cassandra.gms.VersionedValue#VersionedValue(java.lang.String)&lt;/tt&gt; and the &lt;tt&gt;-XX:StringTableSize&lt;/tt&gt; JVM argument entirely. &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=benedict&quot; class=&quot;user-hover&quot; rel=&quot;benedict&quot;&gt;benedict&lt;/a&gt; WDYT?&lt;/p&gt;

&lt;p&gt;There&apos;s &lt;a href=&quot;https://shipilev.net/jvm/anatomy-quarks/10-string-intern/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;evidence&lt;/a&gt; that String-interning can cause GC and performance issues.&lt;/p&gt;</comment>
                            <comment id="17176850" author="benedict" created="Thu, 13 Aug 2020 08:54:51 +0000"  >&lt;p&gt;+1; I saw this recently and was unconvinced by the usage, but didn&apos;t try to explore removing it. &#160;If this is the only source of interning, I&apos;d be strongly in favour of removing. &#160;If we &lt;em&gt;really&lt;/em&gt;&#160;need to &quot;intern&quot; here, we can use something like a &lt;tt&gt;WeakHashMap&lt;/tt&gt;, and perhaps intern the specific &lt;tt&gt;ApplicationState&lt;/tt&gt;&#160;we think will benefit, but I&apos;m uncertain if it&apos;s needed at all. &#160;Perhaps we should do some back-of-envelope calculations for how much heap will be used in a huge cluster without &quot;interning&quot; vs with.&lt;/p&gt;</comment>
                            <comment id="17176876" author="snazy" created="Thu, 13 Aug 2020 09:31:44 +0000"  >&lt;p&gt;Yea - I think, the biggest &quot;consumer&quot; is probably the list of tokens, which is also quite unique per node. So no savings for that one.&lt;br/&gt;
Potential saving might happen for &quot;release-version&quot;, &quot;dc&quot;, &quot;rack&quot; and current &quot;schema-version&quot; - not particularly long strings so I doubt that it&apos;s actually  worth the &lt;tt&gt;String.intern()&lt;/tt&gt; as the total savings are rather low. The other values of &lt;tt&gt;VersionedValue&lt;/tt&gt; are unique per peer and put unnecessary pressure on the string-intern-map.&lt;/p&gt;

&lt;p&gt;Other usages of &lt;tt&gt;String.intern()&lt;/tt&gt; in the whole production code (i.e. including JDK and libraries) are (intentionally) not on a hot-path.&lt;/p&gt;

&lt;p&gt;This change feels IMO safe for 4.0 and also safe to be backported to 3.11 + 3.0.&lt;/p&gt;</comment>
                            <comment id="17177017" author="brandon.williams" created="Thu, 13 Aug 2020 13:36:16 +0000"  >&lt;blockquote&gt;&lt;p&gt;This change feels IMO safe for 4.0 and also safe to be backported to 3.11 + 3.0.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I personally feel it&apos;s a bit much to do in a point release in stable versions.  If there&apos;s any chance of regression, I don&apos;t want to burn new users on those versions, but if experts want to do this, it&apos;s just JVM options they can change themselves.&lt;/p&gt;</comment>
                            <comment id="17249621" author="tvdw" created="Tue, 15 Dec 2020 10:43:22 +0000"  >&lt;p&gt;Added a Fix Version here; if a main selling point for 4.0 is lower tail latency then this makes that impact even more pronounced.&lt;/p&gt;</comment>
                            <comment id="17250980" author="blerer" created="Thu, 17 Dec 2020 10:35:54 +0000"  >&lt;p&gt;I pushed a &lt;a href=&quot;https://github.com/apache/cassandra/pull/857&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;PR&lt;/a&gt; for 4.0. Ci results &lt;a href=&quot;https://app.circleci.com/pipelines/github/blerer/cassandra/84/workflows/05e5708a-0378-4b67-bd3b-427487a866a0&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;j8&lt;/a&gt;, &lt;a href=&quot;https://app.circleci.com/pipelines/github/blerer/cassandra/84/workflows/5fe0c950-9886-4df1-9246-711a5a542ae2&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;j11&lt;/a&gt;. &lt;/p&gt;</comment>
                            <comment id="17250981" author="blerer" created="Thu, 17 Dec 2020 10:36:32 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=brandon.williams&quot; class=&quot;user-hover&quot; rel=&quot;brandon.williams&quot;&gt;brandon.williams&lt;/a&gt; do you have the time to review this patch?&lt;/p&gt;</comment>
                            <comment id="17251142" author="brandon.williams" created="Thu, 17 Dec 2020 15:01:17 +0000"  >&lt;p&gt;+1&lt;/p&gt;</comment>
                            <comment id="17251217" author="blerer" created="Thu, 17 Dec 2020 17:11:48 +0000"  >&lt;p&gt;Committed into trunk at 0d56f70ae7def5b8ff9e3aef14cfa7dff01a71ac&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[blerer]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12313826" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Change Category</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="13003"><![CDATA[Performance]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313821" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Complexity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12964"><![CDATA[Low Hanging Fruit]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12313922" key="jira.plugin.projectspecificselectfield.jpssf:multicftype">
                        <customfieldname>Impacts</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="13100"><![CDATA[None]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            4 years, 47 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12313921" key="jira.plugin.projectspecificselectfield.jpssf:multicftype">
                        <customfieldname>Platform</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="13076"><![CDATA[All]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0ep60:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[brandon.williams]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12311420" key="com.atlassian.jira.plugin.system.customfieldtypes:version">
                        <customfieldname>Since Version</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="12325644">2.0.4</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313924" key="com.atlassian.jira.plugin.system.customfieldtypes:textfield">
                        <customfieldname>Source Control Link</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>&lt;p&gt;&lt;a href=&quot;https://github.com/apache/cassandra/commit/0d56f70ae7def5b8ff9e3aef14cfa7dff01a71ac&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/cassandra/commit/0d56f70ae7def5b8ff9e3aef14cfa7dff01a71ac&lt;/a&gt;&lt;/p&gt;</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313823" key="com.atlassian.jira.plugin.system.customfieldtypes:textarea">
                        <customfieldname>Test and Documentation Plan</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>&lt;p&gt;No additional test needed&lt;/p&gt;</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>