<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 22:58:01 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-10380] SELECT count within a partition does not respect LIMIT</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-10380</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;cassandra@cqlsh&amp;gt; create KEYSPACE test WITH replication = {&lt;span class=&quot;code-quote&quot;&gt;&apos;class&apos;&lt;/span&gt;: &lt;span class=&quot;code-quote&quot;&gt;&apos;SimpleStrategy&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;replication_factor&apos;&lt;/span&gt;: &lt;span class=&quot;code-quote&quot;&gt;&apos;1&apos;&lt;/span&gt;};
cassandra@cqlsh&amp;gt; use test;
cassandra@cqlsh:test&amp;gt; create table t (k &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;, c &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;, v &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;, primary key (k, c));
cassandra@cqlsh:test&amp;gt; INSERT INTO t (k, c, v) VALUES (0, 0, 0);
cassandra@cqlsh:test&amp;gt; INSERT INTO t (k, c, v) VALUES (0, 1, 0);
cassandra@cqlsh:test&amp;gt; INSERT INTO t (k, c, v) VALUES (0, 2, 0);
cassandra@cqlsh:test&amp;gt; select * from t where k = 0;

 k | c | v
---+---+---
 0 | 0 | 0
 0 | 1 | 0
 0 | 2 | 0

(3 rows)
cassandra@cqlsh:test&amp;gt; select count(*) from t where k = 0 limit 2;

 count
-------
     3

(1 rows)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Expected: count should return 2, according to limit.&lt;br/&gt;
Actual: count of all rows in partition&lt;/p&gt;

&lt;p&gt;This manifests in 3.0, does not appear in 2.2&lt;/p&gt;</description>
                <environment></environment>
        <key id="12895193">CASSANDRA-10380</key>
            <summary>SELECT count within a partition does not respect LIMIT</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10003" iconUrl="https://issues.apache.org/jira/images/icons/priorities/trivial.svg">Low</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="blerer">Benjamin Lerer</assignee>
                                    <reporter username="aholmber">Adam Holmberg</reporter>
                        <labels>
                    </labels>
                <created>Mon, 21 Sep 2015 17:53:51 +0000</created>
                <updated>Tue, 16 Apr 2019 09:30:55 +0000</updated>
                            <resolved>Tue, 22 Sep 2015 18:58:00 +0000</resolved>
                                                        <component>Legacy/CQL</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="14901561" author="philipthompson" created="Mon, 21 Sep 2015 22:42:34 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=blerer&quot; class=&quot;user-hover&quot; rel=&quot;blerer&quot;&gt;blerer&lt;/a&gt; can confirm, but I think this is working as intended.&lt;/p&gt;</comment>
                            <comment id="14902655" author="blerer" created="Tue, 22 Sep 2015 13:50:15 +0000"  >&lt;p&gt;It is a valid issue. The &lt;tt&gt;LIMIT&lt;/tt&gt; should be taken into account.&lt;/p&gt;</comment>
                            <comment id="14902850" author="philipthompson" created="Tue, 22 Sep 2015 15:57:54 +0000"  >&lt;p&gt;I thought this behavior was changed in &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-7981&quot; title=&quot;Refactor SelectStatement&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-7981&quot;&gt;&lt;del&gt;CASSANDRA-7981&lt;/del&gt;&lt;/a&gt;. I must be misremembering.&lt;/p&gt;</comment>
                            <comment id="14902897" author="blerer" created="Tue, 22 Sep 2015 16:22:12 +0000"  >&lt;p&gt;I might be wrong but I do not think so. &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-7981&quot; title=&quot;Refactor SelectStatement&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-7981&quot;&gt;&lt;del&gt;CASSANDRA-7981&lt;/del&gt;&lt;/a&gt; is in 2.2.&lt;/p&gt;</comment>
                            <comment id="14902969" author="blerer" created="Tue, 22 Sep 2015 16:56:18 +0000"  >&lt;p&gt;I add a look at the code. My understanding is that &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=slebresne&quot; class=&quot;user-hover&quot; rel=&quot;slebresne&quot;&gt;slebresne&lt;/a&gt; changed this behaviour in &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-8099&quot; title=&quot;Refactor and modernize the storage engine&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-8099&quot;&gt;&lt;del&gt;CASSANDRA-8099&lt;/del&gt;&lt;/a&gt; and put some comment about it in the code.&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;If we aggregate, the limit really apply to the number of rows returned to the user, not to what is queried, and&lt;br/&gt;
since in practice we currently only aggregate at top level (we have no GROUP BY support yet), we&apos;ll only ever&lt;br/&gt;
return 1 result and can therefore basically ignore the user LIMIT in this case.&lt;/p&gt;&lt;/blockquote&gt; 

&lt;p&gt;Database like MySQL do it the same way.&lt;/p&gt;

&lt;p&gt;This means that the behaviour is good in 3.0 but not in 2.2.&lt;/p&gt;</comment>
                            <comment id="14903000" author="philipthompson" created="Tue, 22 Sep 2015 17:08:24 +0000"  >&lt;p&gt;Okay, so then technically we should just close this ticket? &lt;br/&gt;
The 2.2 behavior is what we expect in 2.2, because we fixed this in 8099. And the 3.0 behavior is also expected.&lt;/p&gt;

&lt;p&gt; So we should either make this a ticket to document the change, unless we want to backport it to older versions? But this has been the behavior since long before 2.2, so I think just having this be a documented change of behavior in 3.0 is acceptable.&lt;/p&gt;</comment>
                            <comment id="14903065" author="blerer" created="Tue, 22 Sep 2015 17:45:37 +0000"  >&lt;p&gt;The patch add an entry to the &lt;tt&gt;NEWS.txt&lt;/tt&gt; and some unit test to caught changes in behaviour.&lt;/p&gt;</comment>
                            <comment id="14903122" author="slebresne" created="Tue, 22 Sep 2015 18:06:57 +0000"  >&lt;p&gt;I honestly though we had already done this change in 2.2, but if we hadn&apos;t, 3.0 is as good as any other place to do it so +1 and the news and unit test changes.&lt;/p&gt;</comment>
                            <comment id="14903224" author="blerer" created="Tue, 22 Sep 2015 18:58:00 +0000"  >&lt;p&gt;commit: 96eb58a0fb6ac6dd4ba438120b2cd2725e815e95&lt;/p&gt;</comment>
                            <comment id="15235544" author="incubos" created="Mon, 11 Apr 2016 17:28:41 +0000"  >&lt;p&gt;I managed to reproduce the bug using Cassandra 2.2.5.&lt;br/&gt;
The table schema is:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-sql&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;CREATE&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;TABLE&lt;/span&gt; my_table (
    u &lt;span class=&quot;code-keyword&quot;&gt;text&lt;/span&gt;,
    t timeuuid,
    &lt;span class=&quot;code-keyword&quot;&gt;PRIMARY&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;KEY&lt;/span&gt; (u, t)
) &lt;span class=&quot;code-keyword&quot;&gt;WITH&lt;/span&gt; CLUSTERING &lt;span class=&quot;code-keyword&quot;&gt;ORDER&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;BY&lt;/span&gt; (t &lt;span class=&quot;code-keyword&quot;&gt;DESC&lt;/span&gt;)
    &lt;span class=&quot;code-keyword&quot;&gt;AND&lt;/span&gt; bloom_filter_fp_chance = 0.01
    &lt;span class=&quot;code-keyword&quot;&gt;AND&lt;/span&gt; caching = &lt;span class=&quot;code-quote&quot;&gt;&apos;{&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;keys&lt;/span&gt;&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;ALL&lt;/span&gt;&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;rows_per_partition&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;NONE&lt;/span&gt;&quot;&lt;/span&gt;}&apos;&lt;/span&gt;
    &lt;span class=&quot;code-keyword&quot;&gt;AND&lt;/span&gt; comment = &apos;&apos;
    &lt;span class=&quot;code-keyword&quot;&gt;AND&lt;/span&gt; compaction = {&lt;span class=&quot;code-quote&quot;&gt;&apos;min_threshold&apos;&lt;/span&gt;: &lt;span class=&quot;code-quote&quot;&gt;&apos;2&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;class&apos;&lt;/span&gt;: &lt;span class=&quot;code-quote&quot;&gt;&apos;org.apache.cassandra.db.compaction.DateTieredCompactionStrategy&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;base_time_seconds&apos;&lt;/span&gt;: &lt;span class=&quot;code-quote&quot;&gt;&apos;1&apos;&lt;/span&gt;}
    &lt;span class=&quot;code-keyword&quot;&gt;AND&lt;/span&gt; compression = {&lt;span class=&quot;code-quote&quot;&gt;&apos;sstable_compression&apos;&lt;/span&gt;: &lt;span class=&quot;code-quote&quot;&gt;&apos;org.apache.cassandra.io.&lt;span class=&quot;code-keyword&quot;&gt;compress&lt;/span&gt;.LZ4Compressor&apos;&lt;/span&gt;}
    &lt;span class=&quot;code-keyword&quot;&gt;AND&lt;/span&gt; dclocal_read_repair_chance = 0.0
    &lt;span class=&quot;code-keyword&quot;&gt;AND&lt;/span&gt; default_time_to_live = 10
    &lt;span class=&quot;code-keyword&quot;&gt;AND&lt;/span&gt; gc_grace_seconds = 0
    &lt;span class=&quot;code-keyword&quot;&gt;AND&lt;/span&gt; max_index_interval = 2048
    &lt;span class=&quot;code-keyword&quot;&gt;AND&lt;/span&gt; memtable_flush_period_in_ms = 0
    &lt;span class=&quot;code-keyword&quot;&gt;AND&lt;/span&gt; min_index_interval = 128
    &lt;span class=&quot;code-keyword&quot;&gt;AND&lt;/span&gt; read_repair_chance = 0.0
    &lt;span class=&quot;code-keyword&quot;&gt;AND&lt;/span&gt; speculative_retry = &lt;span class=&quot;code-quote&quot;&gt;&apos;99.0PERCENTILE&apos;&lt;/span&gt;;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;A query with wrong result:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-sql&quot;&gt;&amp;gt; &lt;span class=&quot;code-keyword&quot;&gt;select&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;count&lt;/span&gt;(*) &lt;span class=&quot;code-keyword&quot;&gt;from&lt;/span&gt; my_table &lt;span class=&quot;code-keyword&quot;&gt;where&lt;/span&gt; u = &lt;span class=&quot;code-quote&quot;&gt;&apos;&lt;span class=&quot;code-keyword&quot;&gt;user&lt;/span&gt;-0&apos;&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;limit&lt;/span&gt; 1;

 &lt;span class=&quot;code-keyword&quot;&gt;count&lt;/span&gt;
&lt;span class=&quot;code-comment&quot;&gt;-------
&lt;/span&gt;     8

(1 &lt;span class=&quot;code-keyword&quot;&gt;rows&lt;/span&gt;)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12761688" name="10380.txt" size="2379" author="blerer" created="Tue, 22 Sep 2015 17:45:37 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[blerer]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 32 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2lcvz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12311421" key="com.atlassian.jira.plugin.system.customfieldtypes:multiversion">
                        <customfieldname>Reproduced In</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="12332541">3.0.x</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>slebresne</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[slebresne]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12961"><![CDATA[Low]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>