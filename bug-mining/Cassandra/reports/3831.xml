<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 22:57:58 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-10362] Potential bugs in MV</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-10362</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;While reviewing &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-9664&quot; title=&quot;Allow MV&amp;#39;s select statements to be more complex&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-9664&quot;&gt;&lt;del&gt;CASSANDRA-9664&lt;/del&gt;&lt;/a&gt;, I notice a few points in &lt;tt&gt;View.java&lt;/tt&gt; that potentially look wrong to me. As those aren&apos;t introduced by &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-9664&quot; title=&quot;Allow MV&amp;#39;s select statements to be more complex&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-9664&quot;&gt;&lt;del&gt;CASSANDRA-9664&lt;/del&gt;&lt;/a&gt;, I&apos;m opening this ticket separatly. The points in question are:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;In &lt;tt&gt;updateAffectsView&lt;/tt&gt;, I don&apos;t think the &lt;tt&gt;row.hasComplexDeletion()&lt;/tt&gt; check is correct: if an update only deletes a given collection and that collection isn&apos;t in the view at all, then I don&apos;t think we should care about it. Besides, &lt;tt&gt;hasComplexDeletion&lt;/tt&gt; is not all that efficient and if there is a complex deletion, the following loop on the row will catch it (but only if the column is interesting). So I think that check should just be removed.&lt;/li&gt;
	&lt;li&gt;Also in &lt;tt&gt;updateAffectsView&lt;/tt&gt;, I&apos;m surprised we don&apos;t check &lt;tt&gt;row.partition.primaryKeyLivenessInfo().isEmpty()&lt;/tt&gt;: if we only insert values for the primary key columns, this should still always impact the view.&lt;/li&gt;
	&lt;li&gt;In &lt;tt&gt;createForDeletionInfo&lt;/tt&gt;, it seems we assume that a live &lt;tt&gt;DeletionInfo&lt;/tt&gt; has either ranges or a partition level deletion, but it can have both and it seems we&apos;ll only consider the ranges if that&apos;s the case, which is incorrect.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;It&apos;s possible there is a reasoning I&apos;m missing behind how some or all of those point are currently work, and if so I apologize, but I think in that case said reasoning at least needs to be added as a comment. And if they do are problems, it would be nice to add tests for all these cases.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12873239">CASSANDRA-10362</key>
            <summary>Potential bugs in MV</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10002" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Normal</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="carlyeks">Carl Yeksigian</assignee>
                                    <reporter username="slebresne">Sylvain Lebresne</reporter>
                        <labels>
                    </labels>
                <created>Thu, 17 Sep 2015 09:29:42 +0000</created>
                <updated>Tue, 16 Apr 2019 09:30:55 +0000</updated>
                            <resolved>Fri, 18 Sep 2015 10:15:46 +0000</resolved>
                                        <fixVersion>3.0.0 rc1</fixVersion>
                                    <component>Feature/Materialized Views</component>
                    <component>Legacy/Coordination</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                                                                <comments>
                            <comment id="14803171" author="carlyeks" created="Thu, 17 Sep 2015 16:26:32 +0000"  >&lt;ol&gt;
	&lt;li&gt;Yeah, looks like that&apos;s an extra step that should be skipped&lt;/li&gt;
	&lt;li&gt;Pushed a fix, and a test to make sure it doesn&apos;t slip by again&lt;/li&gt;
	&lt;li&gt;I see that now &amp;#8211; looks like we should check for partition deletion first, since the &lt;tt&gt;fullPartitionRead&lt;/tt&gt; will be a superset of the query we build for the range tombstones&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;Added tests for #2 and #3 - #1 was forcing extra work, but a test wouldn&apos;t catch that, I don&apos;t think.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/carlyeks/cassandra/tree/ticket/10362/3.0&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;branch&lt;/a&gt;&lt;br/&gt;
cassci:&lt;br/&gt;
&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/carlyeks/job/carlyeks-ticket-10362-3.0-testall/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;3.0 utest&lt;/a&gt; &lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/carlyeks/job/carlyeks-ticket-10362-3.0-dtest/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;3.0 dtest&lt;/a&gt; &lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/carlyeks/job/carlyeks-ticket-10362-trunk-testall/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;trunk utest&lt;/a&gt; &lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/carlyeks/job/carlyeks-ticket-10362-trunk-dtest/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;trunk dtest&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14805346" author="slebresne" created="Fri, 18 Sep 2015 10:15:46 +0000"  >&lt;p&gt;+1, committed, thanks.&lt;/p&gt;

&lt;p&gt;I&apos;ll note that the linked CI branch had a few failures but they were for test that clearly don&apos;t even run the code changed by this ticket so I&apos;m calling bullshit. The only failure that &quot;could&quot; be possibly be related is the materialized_view dtest, but that is failing on the cassandra-3.0 branch too (and the error message makes it clear it&apos;s not related to this anyway).&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[carlyeks]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 9 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2kalr:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>slebresne</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[slebresne]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12962"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>