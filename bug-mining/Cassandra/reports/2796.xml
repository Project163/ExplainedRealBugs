<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 22:44:43 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-6959] Reusing Keyspace and CF names raises assertion errors</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-6959</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;The &lt;a href=&quot;https://github.com/riptano/cassandra-dtest/commit/36960090d219ab8dbc7f108faa91c3ea5cea2bec&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;dtest I introduced&lt;/a&gt; to test &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-6924&quot; title=&quot;Data Inserted Immediately After Secondary Index Creation is not Indexed&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-6924&quot;&gt;&lt;del&gt;CASSANDRA-6924&lt;/del&gt;&lt;/a&gt; introduces some log errors which I think may be related to  &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-5202&quot; title=&quot;CFs should have globally and temporally unique CF IDs to prevent &amp;quot;reusing&amp;quot; data from earlier incarnation of same CF name&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-5202&quot;&gt;&lt;del&gt;CASSANDRA-5202&lt;/del&gt;&lt;/a&gt;. &lt;/p&gt;

&lt;p&gt;On 2.1 :&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;ERROR [MigrationStage:1] 2014-03-31 14:36:43,463 CommitLogSegmentManager.java:306 - Failed waiting &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; a forced recycle of in-use commit log segments
java.lang.AssertionError: &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;
        at org.apache.cassandra.db.commitlog.CommitLogSegmentManager.forceRecycleAll(CommitLogSegmentManager.java:301) ~[main/:na]
        at org.apache.cassandra.db.commitlog.CommitLog.forceRecycleAllSegments(CommitLog.java:160) [main/:na]
        at org.apache.cassandra.db.DefsTables.dropColumnFamily(DefsTables.java:497) [main/:na]
        at org.apache.cassandra.db.DefsTables.mergeColumnFamilies(DefsTables.java:296) [main/:na]
        at org.apache.cassandra.db.DefsTables.mergeSchema(DefsTables.java:181) [main/:na]
        at org.apache.cassandra.db.DefinitionsUpdateVerbHandler$1.runMayThrow(DefinitionsUpdateVerbHandler.java:49) [main/:na]
        at org.apache.cassandra.utils.WrappedRunnable.run(WrappedRunnable.java:28) [main/:na]
        at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:471) [na:1.7.0_51]
        at java.util.concurrent.FutureTask.run(FutureTask.java:262) [na:1.7.0_51]
        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1145) [na:1.7.0_51]
        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:615) [na:1.7.0_51]
        at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:744) [na:1.7.0_51]
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;On 2.0: &lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;ERROR [ReadStage:3] 2014-03-31 13:28:11,014 CassandraDaemon.java (line 198) Exception in thread &lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;[ReadStage:3,5,main]
java.lang.AssertionError
        at org.apache.cassandra.db.filter.ExtendedFilter$WithClauses.getExtraFilter(ExtendedFilter.java:258)
        at org.apache.cassandra.db.ColumnFamilyStore.filter(ColumnFamilyStore.java:1744)
        at org.apache.cassandra.db.ColumnFamilyStore.getRangeSlice(ColumnFamilyStore.java:1699)
        at org.apache.cassandra.db.PagedRangeCommand.executeLocally(PagedRangeCommand.java:119)
        at org.apache.cassandra.service.RangeSliceVerbHandler.doVerb(RangeSliceVerbHandler.java:39)
        at org.apache.cassandra.net.MessageDeliveryTask.run(MessageDeliveryTask.java:60)
        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1145)
        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:615)
        at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:744)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;To reproduce, you many need to comment out the assertion in that test, as it is not 100% reproducible on the first try.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12705751">CASSANDRA-6959</key>
            <summary>Reusing Keyspace and CF names raises assertion errors</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10002" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Normal</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="benedict">Benedict Elliott Smith</assignee>
                                    <reporter username="enigmacurry">Ryan McGuire</reporter>
                        <labels>
                    </labels>
                <created>Mon, 31 Mar 2014 18:44:01 +0000</created>
                <updated>Tue, 16 Apr 2019 09:31:49 +0000</updated>
                            <resolved>Thu, 8 May 2014 15:52:58 +0000</resolved>
                                        <fixVersion>2.1 rc1</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="13956338" author="slebresne" created="Tue, 1 Apr 2014 10:10:27 +0000"  >&lt;p&gt;I haven&apos;t looked at the CommitLog assertion (I&apos;ll let somewhat more up to date on the last commit log changes look at it), but regarding the 2nd one, the one in ExtendedFilter, that&apos;s because the test tries to use a 2ndary index before it&apos;s creation has been propagated to all nodes. More precisely, the &lt;tt&gt;select count&lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/star_yellow.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; from ks.cf WHERE col1=&apos;asdf&apos;&lt;/tt&gt; of the test reaches the coordinator node1, which has seen the index creation and so the query is considered valid, but when the underlying RangeCommand reaches the 2nd node, that one doesn&apos;t yet know about the index and so fallback to a sequential scan, but we don&apos;t currently support that kind of sequential scan with filters hence the exception (and truly, that was not what the user asked about anyway). If you add a small sleep after the index creation, that exception goes away in particular. The current status quo (&lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-5886&quot; title=&quot;Provide a propagation guarantee for DDL queries execution&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-5886&quot;&gt;&lt;del&gt;CASSANDRA-5886&lt;/del&gt;&lt;/a&gt;) is that it&apos;s the client job to check for schema agreement if need be and not query a table/index that is not fully propagated, and in that sense, it is the test that should be fixed. Note that I&apos;m not against trying to have a clearer error message but I&apos;m not really sure there&apos;s a much better place for this, so I did added a somewhat more explicit message to the assertionError which hopefully is good enough. &lt;/p&gt;</comment>
                            <comment id="13956353" author="benedict" created="Tue, 1 Apr 2014 10:26:20 +0000"  >&lt;p&gt;The problem with CL is almost certainly that it is attempting to flush all of the keyspaces/CFs that are dirty, but they don&apos;t all exist, so when it finishes the flushes there are still segments marked dirty so aren&apos;t recycled/retired. On drop of a keyspace/CF we need to mark the CL clean for all CFs dropped&lt;/p&gt;</comment>
                            <comment id="13960374" author="brandon.williams" created="Fri, 4 Apr 2014 20:29:58 +0000"  >&lt;p&gt;Let&apos;s just get the CL part for 2.1 fixed then.&lt;/p&gt;</comment>
                            <comment id="13961749" author="benedict" created="Mon, 7 Apr 2014 09:46:21 +0000"  >&lt;p&gt;Running dtest with the attached patch causes the 2.0 error message on 2.1.&lt;/p&gt;</comment>
                            <comment id="13976761" author="jbellis" created="Tue, 22 Apr 2014 13:34:27 +0000"  >&lt;p&gt;committed&lt;/p&gt;</comment>
                            <comment id="13984966" author="thobbs" created="Tue, 29 Apr 2014 23:43:37 +0000"  >&lt;p&gt;I&apos;m still seeing the CommitLogSegmentManager AssertionError in 2.1:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;ERROR 23:37:12 Failed waiting for a forced recycle of in-use commit log segments
java.lang.AssertionError: null
	at org.apache.cassandra.db.commitlog.CommitLogSegmentManager.forceRecycleAll(CommitLogSegmentManager.java:301) ~[main/:na]
	at org.apache.cassandra.db.commitlog.CommitLog.forceRecycleAllSegments(CommitLog.java:160) [main/:na]
	at org.apache.cassandra.db.DefsTables.dropColumnFamily(DefsTables.java:499) [main/:na]
	at org.apache.cassandra.db.DefsTables.mergeColumnFamilies(DefsTables.java:296) [main/:na]
	at org.apache.cassandra.db.DefsTables.mergeSchema(DefsTables.java:181) [main/:na]
	at org.apache.cassandra.service.MigrationManager$2.runMayThrow(MigrationManager.java:316) [main/:na]
	at org.apache.cassandra.utils.WrappedRunnable.run(WrappedRunnable.java:28) [main/:na]
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:471) [na:1.7.0_40]
	at java.util.concurrent.FutureTask.run(FutureTask.java:262) [na:1.7.0_40]
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1145) [na:1.7.0_40]
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:615) [na:1.7.0_40]
	at java.lang.Thread.run(Thread.java:724) [na:1.7.0_40]
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;To reproduce, run the following pycassa integration test against a 2.1 node:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;python setup.py nosetests -w tests/test_autopacking.py
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="13985988" author="benedict" created="Wed, 30 Apr 2014 19:53:51 +0000"  >&lt;p&gt;I get:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;usage: setup.py [global_opts] cmd1 [cmd1_opts] [cmd2 [cmd2_opts] ...]
   or: setup.py --help [cmd1 cmd2 ...]
   or: setup.py --help-commands
   or: setup.py cmd --help

error: invalid command &apos;nosetests&apos;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="13986005" author="brandon.williams" created="Wed, 30 Apr 2014 20:10:32 +0000"  >&lt;p&gt;You need to install the nose module for python.&lt;/p&gt;</comment>
                            <comment id="13986008" author="benedict" created="Wed, 30 Apr 2014 20:13:18 +0000"  >&lt;p&gt;I can run dtests just fine (using simple &quot;nosetests&quot;...) I am a python packaging n00b, though, so maybe that is irrelevant, or the syntax means there&apos;s something subtly different about the nosetest setup?&lt;/p&gt;</comment>
                            <comment id="13986030" author="thobbs" created="Wed, 30 Apr 2014 20:30:05 +0000"  >&lt;blockquote&gt;&lt;p&gt;I can run dtests just fine (using simple &quot;nosetests&quot;...) I am a python packaging n00b, though, so maybe that is irrelevant, or the syntax means there&apos;s something subtly different about the nosetest setup?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Oh, you should able to just use &quot;nosetests&quot; here, sorry.  The setup.py version will make a fresh build of the package and use it (instead of potentially using a system-installed version), so I&apos;m in the habit of using that, but it&apos;s not needed here.&lt;/p&gt;</comment>
                            <comment id="13986071" author="benedict" created="Wed, 30 Apr 2014 20:55:28 +0000"  >&lt;p&gt;It dies before I get there:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;21:36:05.851 [Thrift:1] ERROR o.a.c.thrift.CustomTThreadPoolServer - Error occurred during processing of message.
java.lang.IndexOutOfBoundsException: Index: 0, Size: 0
	at java.util.ArrayList.rangeCheck(ArrayList.java:635) ~[na:1.7.0_45]
	at java.util.ArrayList.set(ArrayList.java:426) ~[na:1.7.0_45]
	at org.apache.cassandra.config.CFMetaData.rebuild(CFMetaData.java:2037) ~[cassandra/:na]
	at org.apache.cassandra.config.CFMetaData.fromThriftForUpdate(CFMetaData.java:1036) ~[cassandra/:na]
	at org.apache.cassandra.thrift.CassandraServer.system_update_column_family(CassandraServer.java:1668) ~[cassandra/:na]
	at org.apache.cassandra.thrift.Cassandra$Processor$system_update_column_family.getResult(Cassandra.java:4430) ~[cassandra/:na]
	at org.apache.cassandra.thrift.Cassandra$Processor$system_update_column_family.getResult(Cassandra.java:4414) ~[cassandra/:na]
	at org.apache.thrift.ProcessFunction.process(ProcessFunction.java:39) ~[libthrift-0.9.1.jar:0.9.1]
	at org.apache.thrift.TBaseProcessor.process(TBaseProcessor.java:39) ~[libthrift-0.9.1.jar:0.9.1]
	at org.apache.cassandra.thrift.CustomTThreadPoolServer$WorkerProcess.run(CustomTThreadPoolServer.java:201) ~[cassandra/:na]
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1145) [na:1.7.0_45]
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:615) [na:1.7.0_45]
	at java.lang.Thread.run(Thread.java:744) [na:1.7.0_45]
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;It looks sufficiently like it may be pycassa test related that I haven&apos;t investigated further.&lt;/p&gt;</comment>
                            <comment id="13986098" author="thobbs" created="Wed, 30 Apr 2014 21:14:24 +0000"  >&lt;p&gt;Hmm, I can reproduce that, but it wasn&apos;t happening yesterday, so a recent change must has broken something.&lt;/p&gt;</comment>
                            <comment id="13986117" author="thobbs" created="Wed, 30 Apr 2014 21:36:08 +0000"  >&lt;p&gt;git bisect points to 2269adba6c28e24f60883700f657d36fff7b9d3f (&lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-6831&quot; title=&quot;Updates to COMPACT STORAGE tables via cli drop CQL information&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-6831&quot;&gt;&lt;del&gt;CASSANDRA-6831&lt;/del&gt;&lt;/a&gt;).&lt;/p&gt;</comment>
                            <comment id="13991070" author="benedict" created="Tue, 6 May 2014 20:12:17 +0000"  >&lt;p&gt;Was using &amp;lt; instead of &amp;lt;= for marking the CLS clean, so in some cases it wasn&apos;t getting recycled. Attached trivial patch.&lt;/p&gt;</comment>
                            <comment id="13992864" author="jbellis" created="Thu, 8 May 2014 15:52:59 +0000"  >&lt;p&gt;committed&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12643623" name="6959.txt" size="1159" author="benedict" created="Tue, 6 May 2014 20:12:17 +0000"/>
                            <attachment id="12638956" name="6959.txt" size="1678" author="benedict" created="Mon, 7 Apr 2014 09:46:21 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[benedict]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>384075</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            11 years, 28 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1u62f:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>384343</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12311421" key="com.atlassian.jira.plugin.system.customfieldtypes:multiversion">
                        <customfieldname>Reproduced In</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="12326275">2.1 beta1</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>jbellis</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[jbellis]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12962"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>