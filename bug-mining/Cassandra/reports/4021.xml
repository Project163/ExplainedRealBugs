<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 23:00:12 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-10854] cqlsh COPY FROM csv having line with more than one consecutive  &apos;,&apos; delimiter  is throwing &apos;list index out of range&apos;</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-10854</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;cqlsh COPY FROM csv having line with more than one consecutive  &apos;,&apos; delimiter  is throwing &apos;list index out of range&apos;&lt;/p&gt;

&lt;p&gt;Steps to re-produce:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;CREATE TABLE tracks_by_album (
  album_title TEXT,
  album_year INT,
  performer TEXT STATIC,
  album_genre TEXT STATIC,
  track_number INT,
  track_title TEXT,
  PRIMARY KEY ((album_title, album_year), track_number)
);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Create a file: tracks_by_album.csv having following 2 lines :&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;album,year,performer,genre,number,title
a,2015,b c d,e f g,,
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;cqlsh&amp;gt; COPY music.tracks_by_album
     (album_title, album_year, performer, album_genre, track_number, track_title)
FROM &lt;span class=&quot;code-quote&quot;&gt;&apos;~/tracks_by_album.csv&apos;&lt;/span&gt;
WITH HEADER = &lt;span class=&quot;code-quote&quot;&gt;&apos;&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&apos;&lt;/span&gt;;

Error :
Starting copy of music.tracks_by_album with columns [&lt;span class=&quot;code-quote&quot;&gt;&apos;album_title&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;album_year&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;performer&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;album_genre&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;track_number&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;track_title&apos;&lt;/span&gt;].

list index out of range
Aborting &lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; at record #1. Previously inserted records are still present, and some records after that may be present as well.
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment>&lt;p&gt;cqlsh 5.0.1 | Cassandra 2.1.11.969 | DSE 4.8.3 | CQL spec 3.2.1 &lt;/p&gt;</environment>
        <key id="12921447">CASSANDRA-10854</key>
            <summary>cqlsh COPY FROM csv having line with more than one consecutive  &apos;,&apos; delimiter  is throwing &apos;list index out of range&apos;</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10003" iconUrl="https://issues.apache.org/jira/images/icons/priorities/trivial.svg">Low</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="stefania">Stefania Alborghetti</assignee>
                                    <reporter username="puspendu.banerjee@gmail.com">Puspendu Banerjee</reporter>
                        <labels>
                    </labels>
                <created>Sun, 13 Dec 2015 05:10:46 +0000</created>
                <updated>Wed, 15 Oct 2025 09:49:01 +0000</updated>
                            <resolved>Wed, 23 Dec 2015 18:25:34 +0000</resolved>
                                        <fixVersion>2.1.13</fixVersion>
                    <fixVersion>2.2.5</fixVersion>
                    <fixVersion>3.0.3</fixVersion>
                    <fixVersion>3.2</fixVersion>
                                    <component>Legacy/Tools</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="15066996" author="mambocab" created="Mon, 21 Dec 2015 19:53:07 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=Stefania&quot; class=&quot;user-hover&quot; rel=&quot;stefania&quot;&gt;Stefania&lt;/a&gt; I believe you may be the person to have a look at this. Importing this file on &lt;tt&gt;casandra-2.2&lt;/tt&gt; &lt;tt&gt;HEAD&lt;/tt&gt; prints a different bad error message:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;cqlsh&amp;gt; COPY music.tracks_by_album (album_title, album_year, performer, album_genre, track_number, track_title) FROM &lt;span class=&quot;code-quote&quot;&gt;&apos;./tracks_by_album.csv&apos;&lt;/span&gt; WITH HEADER = &lt;span class=&quot;code-quote&quot;&gt;&apos;&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&apos;&lt;/span&gt;;

Starting copy of music.tracks_by_album with columns [&lt;span class=&quot;code-quote&quot;&gt;&apos;album_title&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;album_year&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;performer&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;album_genre&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;track_number&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;track_title&apos;&lt;/span&gt;].
Failed to &lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; 1 rows: TypeError - exceptions.Exception does not take keyword arguments -  given up after 1 attempts
Failed to process 1 batches
Processed: 0 rows; Rate:       0 rows/s; Avg. rage:       0 rows/s
0 rows imported in 0.124 seconds.
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=puspendu.banerjee%40gmail.com&quot; class=&quot;user-hover&quot; rel=&quot;puspendu.banerjee@gmail.com&quot;&gt;puspendu.banerjee@gmail.com&lt;/a&gt; I believe the CSV you shared is not supposed to be accepted by &lt;tt&gt;COPY FROM&lt;/tt&gt;, but there&apos;s definitely room to improve the error message.&lt;/p&gt;</comment>
                            <comment id="15067846" author="stefania" created="Tue, 22 Dec 2015 09:29:52 +0000"  >&lt;p&gt;There&apos;s a slight problem with the new code of &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-9302&quot; title=&quot;Optimize cqlsh COPY FROM, part 3&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-9302&quot;&gt;&lt;del&gt;CASSANDRA-9302&lt;/del&gt;&lt;/a&gt;, once that&apos;s fixed here is the error message:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;COPY tracks_by_album (album_title, album_year, performer, album_genre, track_number, track_title) FROM &lt;span class=&quot;code-quote&quot;&gt;&apos;10854.csv&apos;&lt;/span&gt; WITH HEADER = &lt;span class=&quot;code-quote&quot;&gt;&apos;&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&apos;&lt;/span&gt;;
[...]
Failed to &lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; 1 rows: ValueError - Cannot insert &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; value &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; primary key column &lt;span class=&quot;code-quote&quot;&gt;&apos;track_number&apos;&lt;/span&gt;. If you want to insert empty strings, consider using the WITH NULL=&amp;lt;marker&amp;gt; option &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; COPY. -  given up after 1 attempts
[...]
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;However, because track_number is an integer, in this case we cannot import a null string even with a null marker:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;COPY tracks_by_album (album_title, album_year, performer, album_genre, track_number, track_title) FROM &lt;span class=&quot;code-quote&quot;&gt;&apos;10854.csv&apos;&lt;/span&gt; WITH HEADER = &lt;span class=&quot;code-quote&quot;&gt;&apos;&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&apos;&lt;/span&gt; AND NULL = &lt;span class=&quot;code-quote&quot;&gt;&apos;xxx&apos;&lt;/span&gt;;
[...]
Failed to &lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; 1 rows: ValueError - invalid literal &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;() with base 10: &apos;&apos; -  given up after 1 attempts
[...]
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;So the csv is incorrect.&lt;/p&gt;

&lt;p&gt;As for the error messages, here is the &lt;a href=&quot;https://github.com/stef1927/cassandra/commits/10854-2.1&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;2.1 patch&lt;/a&gt; and the &lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/stef1927/job/stef1927-10854-2.1-dtest/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;dtest results&lt;/a&gt; of this &lt;a href=&quot;https://github.com/stef1927/cassandra-dtest/commits/10854&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;modified branch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;The patch applies to 2.2 and is fairly trivial so I did not run CI on 2.2+.&lt;/p&gt;
</comment>
                            <comment id="15067851" author="stefania" created="Tue, 22 Dec 2015 09:34:27 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=pauloricardomg&quot; class=&quot;user-hover&quot; rel=&quot;pauloricardomg&quot;&gt;pauloricardomg&lt;/a&gt; would you mind reviewing this since it is fairly trivial and on the &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-9303&quot; title=&quot;Match cassandra-loader options in COPY FROM&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-9303&quot;&gt;&lt;del&gt;CASSANDRA-9303&lt;/del&gt;&lt;/a&gt; branch we will need a slightly bigger change in order to propagate the error messages.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mambocab&quot; class=&quot;user-hover&quot; rel=&quot;mambocab&quot;&gt;mambocab&lt;/a&gt; perhaps you want to review the dtest changes? I did not create the pull request just yet since the tests do not have the &lt;tt&gt;@require&lt;/tt&gt; annotation.&lt;/p&gt;</comment>
                            <comment id="15069617" author="pauloricardomg" created="Wed, 23 Dec 2015 13:25:27 +0000"  >&lt;p&gt;With the current approach if you try to insert an empty &lt;tt&gt;int&lt;/tt&gt; value, the message will vary:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;&lt;tt&gt;Failed to import 4 rows: ValueError - invalid literal for int() with base 10: &apos;&apos; -  given up after 1 attempts&lt;/tt&gt; will be print if &lt;tt&gt;WITH NULL&lt;/tt&gt; is set.&lt;/li&gt;
	&lt;li&gt;&lt;tt&gt;Failed to import 4 rows: ValueError - Cannot insert null value for primary key column &apos;bla&apos;. If you want to insert empty strings, consider using the WITH NULL=&amp;lt;marker&amp;gt; option for COPY. -  given up after 1 attempts&lt;/tt&gt; will be print if &lt;tt&gt;WITH NULL&lt;/tt&gt; is not set.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;So it would be nice to unify those. And I think we can also get rid of the  &lt;tt&gt;If you want to insert empty strings, consider using the WITH NULL=&amp;lt;marker&amp;gt; option for COPY&lt;/tt&gt; message, since even if it&apos;s a text, we cannot have nulls in the primary keys so this might confuse users.&lt;/p&gt;

&lt;p&gt;I&apos;d vote for just having the message &lt;tt&gt;Failed to import 1 rows: ValueError - Cannot insert null value for primary key column &apos;bla2&apos;&lt;/tt&gt;, regardless of type and if nullval is set.&lt;/p&gt;</comment>
                            <comment id="15069637" author="stefania" created="Wed, 23 Dec 2015 13:51:29 +0000"  >&lt;p&gt;We need to keep the current approach in case users want to insert an empty string in one of the primary key components, for example a clustering key. It works as follows:&lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;if the value is not equal to the NULL option value then we parse it and in this case we get &lt;tt&gt;invalid literal for int()&lt;/tt&gt; because the key is an integer but for a text key it would have been a valid value&lt;/li&gt;
	&lt;li&gt;If the value is equal to the NULL option value (by default an empty string) then we insert &lt;tt&gt;None&lt;/tt&gt; for any column except for primary keys in which case we complain with &lt;tt&gt;Cannot insert null value for primary key column ...&lt;/tt&gt;.&lt;/li&gt;
	&lt;li&gt;The reason the default NULL option is an empty string is because the csv parser returns an empty string for missing values.&lt;/li&gt;
&lt;/ol&gt;
</comment>
                            <comment id="15069642" author="pauloricardomg" created="Wed, 23 Dec 2015 13:56:00 +0000"  >&lt;p&gt;Sounds good. Thanks for the clarification and sorry for the confusion!&lt;/p&gt;

&lt;p&gt;Marking as &quot;Ready to commit&quot;. Thanks!&lt;/p&gt;</comment>
                            <comment id="15069889" author="stefania" created="Wed, 23 Dec 2015 17:14:27 +0000"  >&lt;p&gt;Thanks Paulo, I&apos;ve created the dtest pull request &lt;a href=&quot;https://github.com/riptano/cassandra-dtest/pull/721&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;here&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="15070005" author="jmckenzie" created="Wed, 23 Dec 2015 18:25:34 +0000"  >&lt;p&gt;&lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=cassandra.git;a=commit;h=3ccffc94b8a6127f6a452a3fb93306ad3bbc8c97&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;Committed&lt;/a&gt; and merged up.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[stefania]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 47 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2ptjr:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>pauloricardomg</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[pauloricardomg]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12961"><![CDATA[Low]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12311420" key="com.atlassian.jira.plugin.system.customfieldtypes:version">
                        <customfieldname>Since Version</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="12333770">2.1.11</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>