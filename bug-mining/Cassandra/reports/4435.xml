<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 23:04:34 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-12279] nodetool repair hangs on non-existant table</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-12279</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;If nodetool repair is called with a table that does not exist, ist hangs infinitely without any error message or logs.&lt;/p&gt;

&lt;p&gt;E.g.&lt;/p&gt;

&lt;p&gt;nodetool repair foo bar&lt;/p&gt;

&lt;p&gt;Keyspace foo exists but table bar does not&lt;/p&gt;</description>
                <environment>&lt;p&gt;Linux Ubuntu, Openjdk&lt;/p&gt;</environment>
        <key id="12991928">CASSANDRA-12279</key>
            <summary>nodetool repair hangs on non-existant table</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10003" iconUrl="https://issues.apache.org/jira/images/icons/priorities/trivial.svg">Low</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="myamaguchi1016">Masataka Yamaguchi</assignee>
                                    <reporter username="brstgt">Benjamin Roth</reporter>
                        <labels>
                            <label>lhf</label>
                    </labels>
                <created>Fri, 22 Jul 2016 19:31:46 +0000</created>
                <updated>Tue, 16 Apr 2019 09:30:25 +0000</updated>
                            <resolved>Tue, 30 Aug 2016 15:41:38 +0000</resolved>
                                        <fixVersion>2.2.8</fixVersion>
                    <fixVersion>3.0.9</fixVersion>
                    <fixVersion>3.10</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="15427676" author="myamaguchi1016" created="Fri, 19 Aug 2016 06:10:04 +0000"  >&lt;p&gt;This happens because the method &#8220;parseOptinalTables&#8221; in src/java/org/apache/cassandra/tools/NodeTool.java does not confirm that the given keyspace has the given table.&lt;br/&gt;
The method &#8220;parseOptinalTables&#8221; is also used in some nodetool commands such as src/java/org/apache/cassandra/tools/nodetool/Cleanup.java, src/java/org/apache/cassandra/tools/nodetool/Compact.java and so on, and Java error happens when those commands are used with no-existent table name given, while they do not hang. &lt;/p&gt;

&lt;p&gt;I have reimplemented parseOptionalTables so that it confirms that the given keyspace has the given table, and I will send the patch.&lt;br/&gt;
Please review it.&lt;/p&gt;</comment>
                            <comment id="15428505" author="pauloricardomg" created="Fri, 19 Aug 2016 17:35:40 +0000"  >&lt;p&gt;Thanks for the patch &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=myamaguchi1016&quot; class=&quot;user-hover&quot; rel=&quot;myamaguchi1016&quot;&gt;myamaguchi1016&lt;/a&gt;! The patch looks good, but it doesn&apos;t apply to 2.2 and this bug also affects 2.2. Can you also provide a patch based on the cassandra-2.2 branch (and check if the trunk patch will apply to cassandra-3.0)? You can go ahead and change the nomenclature from columnfamily to table where applicable in the 2.2 patch.&lt;/p&gt;

&lt;p&gt;I created a dtest to reproduce this and submitted a &lt;a href=&quot;https://github.com/riptano/cassandra-dtest/pull/1258&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;pull request&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;Also, if you could generate your patch with git format-patch that would be preferable. Thanks.&lt;/p&gt;</comment>
                            <comment id="15430081" author="myamaguchi1016" created="Mon, 22 Aug 2016 05:41:29 +0000"  >&lt;p&gt;Thank you for reviewing and creating a dtest!&lt;br/&gt;
Sorry for my mistake. I created patches for 2.2, 3.0 and trunk with git format-patch.&lt;br/&gt;
I attached them and please review it.&lt;/p&gt;</comment>
                            <comment id="15433111" author="pauloricardomg" created="Tue, 23 Aug 2016 16:10:08 +0000"  >&lt;p&gt;Thanks, new patches look good. I prepared them for commit in the branches below and submitted CI runs:&lt;/p&gt;

&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;2.2&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;3.0&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;trunk&lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/apache/cassandra/compare/cassandra-2.2...pauloricardomg:2.2-12279&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;branch&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/apache/cassandra/compare/cassandra-3.0...pauloricardomg:3.0-12279&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;branch&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/apache/cassandra/compare/trunk...pauloricardomg:trunk-12279&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;branch&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/paulomotta/job/pauloricardomg-2.2-12279-testall/lastCompletedBuild/testReport/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;testall&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/paulomotta/job/pauloricardomg-3.0-12279-testall/lastCompletedBuild/testReport/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;testall&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/paulomotta/job/pauloricardomg-trunk-12279-testall/lastCompletedBuild/testReport/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;testall&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/paulomotta/job/pauloricardomg-2.2-12279-dtest/lastCompletedBuild/testReport/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;dtest&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/paulomotta/job/pauloricardomg-3.0-12279-dtest/lastCompletedBuild/testReport/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;dtest&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/paulomotta/job/pauloricardomg-trunk-12279-dtest/lastCompletedBuild/testReport/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;dtest&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;


&lt;p&gt;Will mark as ready to commit after CI results look good. Thanks!&lt;/p&gt;</comment>
                            <comment id="15433756" author="pauloricardomg" created="Tue, 23 Aug 2016 22:24:58 +0000"  >&lt;p&gt;It seems &lt;a href=&quot;https://github.com/riptano/cassandra-dtest/blob/master/scrub_test.py#L180&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;scrub_test.TestScrubIndexes&lt;/a&gt; is &lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/paulomotta/job/pauloricardomg-2.2-12279-dtest/lastCompletedBuild/testReport/scrub_test/TestScrubIndexes/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;failing&lt;/a&gt; because &lt;tt&gt;parseOptionalTables&lt;/tt&gt; does not include indexes. &lt;/p&gt;

&lt;p&gt;One way to fix this is to modify &lt;tt&gt;parseOptionalTables&lt;/tt&gt; to support indexes,but  there are some operations that allow index (such as scrub), and some other that don&apos;t allow like repair, so you need to account for that when doing the check. Another option is to perform the validation only for repair on &lt;tt&gt;StorageService.forceRepairAsync&lt;/tt&gt; (see &lt;tt&gt;StorageService.getValidColumnFamilies&lt;/tt&gt;). The best option, but a bit more involved is to fix the root cause of the issue on &lt;tt&gt;RepairRunnable&lt;/tt&gt;, which is to catch any &lt;tt&gt;RuntimeException&lt;/tt&gt; that happens in the initial phase (setup tracing, &lt;tt&gt;getValidColumnFamilies&lt;/tt&gt;, etc) and send a notification to &lt;tt&gt;RepairRunner&lt;/tt&gt; via &lt;tt&gt;fireErrorAndComplete&lt;/tt&gt;.&lt;/p&gt;</comment>
                            <comment id="15434501" author="myamaguchi1016" created="Wed, 24 Aug 2016 08:42:14 +0000"  >&lt;p&gt;Thank you for reviewing and testing.&lt;br/&gt;
I rewrote the patch for nodetool repair.&lt;br/&gt;
I added a new try-catch in RepairRunnable to catch the exception that happens when given keyspace does not have at least one given table in getValidColumnFamilies.&lt;/p&gt;

&lt;p&gt;I attached three files. First one is the patch for trunk, second one is the patch for 2.2 and 3.0 and third one is new output example.&lt;br/&gt;
Please review it if you have time.&lt;/p&gt;</comment>
                            <comment id="15447320" author="pauloricardomg" created="Mon, 29 Aug 2016 22:54:08 +0000"  >&lt;p&gt;Thanks, this looks good. I prepared branches for commit and submitted CI runs:&lt;/p&gt;

&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;2.2&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;3.0&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;trunk&lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/apache/cassandra/compare/cassandra-2.2...pauloricardomg:2.2-12279&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;branch&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/apache/cassandra/compare/cassandra-3.0...pauloricardomg:3.0-12279&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;branch&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/apache/cassandra/compare/trunk...pauloricardomg:trunk-12279&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;branch&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/paulomotta/job/pauloricardomg-2.2-12279-testall/lastCompletedBuild/testReport/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;testall&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/paulomotta/job/pauloricardomg-3.0-12279-testall/lastCompletedBuild/testReport/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;testall&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/paulomotta/job/pauloricardomg-trunk-12279-testall/lastCompletedBuild/testReport/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;testall&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/paulomotta/job/pauloricardomg-2.2-12279-dtest/lastCompletedBuild/testReport/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;dtest&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/paulomotta/job/pauloricardomg-3.0-12279-dtest/lastCompletedBuild/testReport/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;dtest&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/paulomotta/job/pauloricardomg-trunk-12279-dtest/lastCompletedBuild/testReport/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;dtest&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;


&lt;p&gt;Will mark as ready to commit after CI results look good. Thanks!&lt;/p&gt;</comment>
                            <comment id="15449343" author="iamaleksey" created="Tue, 30 Aug 2016 15:40:48 +0000"  >&lt;p&gt;Committed to 2.2 as &lt;a href=&quot;https://github.com/apache/cassandra/commit/acd46ab7c4e185e474026a0bfecdd2c5e77bf46d&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;acd46ab7c4e185e474026a0bfecdd2c5e77bf46d&lt;/a&gt; and merged into 3.0 and trunk, skipping 3.9. Thanks.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310050">
                    <name>Regression</name>
                                            <outwardlinks description="breaks">
                                        <issuelink>
            <issuekey id="13034761">CASSANDRA-13121</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12824769" name="0001-CASSANDRA-12279-2.2.patch" size="10724" author="myamaguchi1016" created="Mon, 22 Aug 2016 05:41:29 +0000"/>
                            <attachment id="12825224" name="0001-CASSANDRA-12279-2.2and3.0-v2.patch" size="2882" author="myamaguchi1016" created="Wed, 24 Aug 2016 08:42:14 +0000"/>
                            <attachment id="12824770" name="0001-CASSANDRA-12279-3.0.patch" size="11630" author="myamaguchi1016" created="Mon, 22 Aug 2016 05:41:29 +0000"/>
                            <attachment id="12825225" name="0001-CASSANDRA-12279-trunk-v2.patch" size="2209" author="myamaguchi1016" created="Wed, 24 Aug 2016 08:42:14 +0000"/>
                            <attachment id="12824771" name="0001-CASSANDRA-12279-trunk.patch" size="13118" author="myamaguchi1016" created="Mon, 22 Aug 2016 05:41:29 +0000"/>
                            <attachment id="12824502" name="CASSANDRA-12279-trunk.patch" size="11528" author="myamaguchi1016" created="Fri, 19 Aug 2016 06:10:04 +0000"/>
                            <attachment id="12825226" name="new_result_example-v2.txt" size="1305" author="myamaguchi1016" created="Wed, 24 Aug 2016 08:42:14 +0000"/>
                            <attachment id="12824503" name="new_result_example.txt" size="1191" author="myamaguchi1016" created="Fri, 19 Aug 2016 06:10:04 +0000"/>
                            <attachment id="12824504" name="org_result_example.txt" size="1347" author="myamaguchi1016" created="Fri, 19 Aug 2016 06:10:04 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[myamaguchi1016]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 12 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i31ee7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12311421" key="com.atlassian.jira.plugin.system.customfieldtypes:multiversion">
                        <customfieldname>Reproduced In</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="12336056">3.0.8</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>pauloricardomg</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[pauloricardomg]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12961"><![CDATA[Low]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>