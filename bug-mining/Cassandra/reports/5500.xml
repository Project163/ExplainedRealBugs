<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 23:17:14 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-16049] org.apache.cassandra.distributed.test.ReadRepairTest#movingTokenReadRepairTest passes because the message drop filters are not dropping the messages</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-16049</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;The test tries to block messages from node 4 to 3 but used verb ordinal rather than id; this causes the verbs to sent to node 3 and allow all replies to happen.&lt;/p&gt;

&lt;p&gt;If you fix the test to use id (and actually filter), then the test fails&lt;/p&gt;

&lt;p&gt;Patch to show the issue&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
diff --git a/test/distributed/org/apache/cassandra/distributed/test/ReadRepairTest.java b/test/distributed/org/apache/cassandra/distributed/test/ReadRepairTest.java
index f0c82b85e1..55d2e8f303 100644
--- a/test/distributed/org/apache/cassandra/distributed/test/ReadRepairTest.java
+++ b/test/distributed/org/apache/cassandra/distributed/test/ReadRepairTest.java
@@ -30,14 +30,14 @@ &lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.apache.cassandra.dht.Token;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.apache.cassandra.distributed.Cluster;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.apache.cassandra.distributed.api.ConsistencyLevel;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.apache.cassandra.distributed.api.ICluster;
-&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.apache.cassandra.distributed.shared.NetworkTopology;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.apache.cassandra.locator.InetAddressAndPort;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.apache.cassandra.service.PendingRangeCalculatorService;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.apache.cassandra.service.StorageService;

+&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; org.apache.cassandra.distributed.shared.AssertUtils.assertRows;
+&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; org.apache.cassandra.distributed.shared.AssertUtils.row;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; org.apache.cassandra.net.Verb.READ_REPAIR_REQ;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; org.apache.cassandra.net.Verb.READ_REQ;
-&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; org.apache.cassandra.distributed.shared.AssertUtils.*;

&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;ReadRepairTest &lt;span class=&quot;code-keyword&quot;&gt;extends&lt;/span&gt; TestBaseImpl
{
@@ -115,8 +115,8 @@ &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;ReadRepairTest &lt;span class=&quot;code-keyword&quot;&gt;extends&lt;/span&gt; TestBaseImpl

            &lt;span class=&quot;code-comment&quot;&gt;// prevent #4 from reading or writing to #3, so our QUORUM must contain #2 and #4
&lt;/span&gt;            &lt;span class=&quot;code-comment&quot;&gt;// since #1 is taking over the range, &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; means any read-repair must make it to #1 as well
&lt;/span&gt;-            cluster.filters().verbs(READ_REQ.ordinal()).from(4).to(3).drop();
-            cluster.filters().verbs(READ_REPAIR_REQ.ordinal()).from(4).to(3).drop();
+            cluster.filters().verbs(READ_REQ.id).from(4).to(3).drop();
+            cluster.filters().verbs(READ_REPAIR_REQ.id).from(4).to(3).drop();
            assertRows(cluster.coordinator(4).execute(&lt;span class=&quot;code-quote&quot;&gt;&quot;SELECT * FROM &quot;&lt;/span&gt; + KEYSPACE + &lt;span class=&quot;code-quote&quot;&gt;&quot;.tbl WHERE pk = ?&quot;&lt;/span&gt;,
                                                      ConsistencyLevel.ALL, i),
                       row(i, 1, 1));
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Exception&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
org.apache.cassandra.exceptions.ReadTimeoutException: Operation timed out - received only 2 responses.

	at org.apache.cassandra.service.reads.ReadCallback.awaitResults(ReadCallback.java:120)
	at org.apache.cassandra.service.reads.AbstractReadExecutor.awaitResponses(AbstractReadExecutor.java:373)
	at org.apache.cassandra.service.StorageProxy.fetchRows(StorageProxy.java:1823)
	at org.apache.cassandra.service.StorageProxy.readRegular(StorageProxy.java:1713)
	at org.apache.cassandra.service.StorageProxy.read(StorageProxy.java:1630)
	at org.apache.cassandra.db.SinglePartitionReadCommand$Group.execute(SinglePartitionReadCommand.java:1123)
	at org.apache.cassandra.cql3.statements.SelectStatement.execute(SelectStatement.java:294)
	at org.apache.cassandra.cql3.statements.SelectStatement.execute(SelectStatement.java:246)
	at org.apache.cassandra.cql3.statements.SelectStatement.execute(SelectStatement.java:88)
	at org.apache.cassandra.distributed.impl.Coordinator.executeInternal(Coordinator.java:100)
	at org.apache.cassandra.distributed.impl.Coordinator.lambda$executeWithResult$0(Coordinator.java:62)
	at java.util.concurrent.FutureTask.run(FutureTask.java:266)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)
	at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:748)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="13322634">CASSANDRA-16049</key>
            <summary>org.apache.cassandra.distributed.test.ReadRepairTest#movingTokenReadRepairTest passes because the message drop filters are not dropping the messages</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10002" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Normal</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="samt">Sam Tunnicliffe</assignee>
                                    <reporter username="dcapwell">David Capwell</reporter>
                        <labels>
                    </labels>
                <created>Fri, 14 Aug 2020 00:23:42 +0000</created>
                <updated>Fri, 10 Oct 2025 08:47:40 +0000</updated>
                            <resolved>Fri, 2 Oct 2020 08:36:02 +0000</resolved>
                                        <fixVersion>4.0-beta3</fixVersion>
                    <fixVersion>4.0</fixVersion>
                                    <component>Consistency/Repair</component>
                    <component>Test/dtest/java</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="17177396" author="dcapwell" created="Fri, 14 Aug 2020 00:30:24 +0000"  >&lt;p&gt;The test runs a 4 node cluster, blocks traffic from node 4 -&amp;gt; 3, and marks node 2 as leaving the cluster.  The test validates that a CL.ALL read on node 4 will pass and update node 1 with correct data.&lt;/p&gt;

&lt;p&gt;At CL.ALL nodes 2, 3, and 4 are involved with the read and the test timeout because node 3 doesn&apos;t reply.  The test documentation says that node 1 is supposed to take on node 2&apos;s range, so the test assumes node 1 will be used in the query (it is not).&lt;/p&gt;

&lt;p&gt;I am not sure if this is a test failure or a correctness issue.  The test clearly documents that the query is supposed to hit node 1 since node 2 is leaving but it doesn&apos;t; so is this a correctness issue with reading?&lt;/p&gt;</comment>
                            <comment id="17195707" author="edimitrova" created="Mon, 14 Sep 2020 19:35:16 +0000"  >&lt;p&gt;Hey &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=dcapwell&quot; class=&quot;user-hover&quot; rel=&quot;dcapwell&quot;&gt;dcapwell&lt;/a&gt;, do you plan on working on this one?&#160;&lt;/p&gt;</comment>
                            <comment id="17195736" author="dcapwell" created="Mon, 14 Sep 2020 21:15:34 +0000"  >&lt;p&gt;don&apos;t have time right now but does look like an issue with membership changes, might be best to look into it now that &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-14801&quot; title=&quot;calculatePendingRanges no longer safe for multiple adjacent range movements&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-14801&quot;&gt;&lt;del&gt;CASSANDRA-14801&lt;/del&gt;&lt;/a&gt; is committed as that feels related.&lt;/p&gt;

&lt;p&gt;cc &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=samt&quot; class=&quot;user-hover&quot; rel=&quot;samt&quot;&gt;samt&lt;/a&gt;&lt;br/&gt;
cc &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=adelapena&quot; class=&quot;user-hover&quot; rel=&quot;adelapena&quot;&gt;adelapena&lt;/a&gt; as he is working on &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-15977&quot; title=&quot;4.0 Quality: Read Repair Test Audit&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-15977&quot;&gt;&lt;del&gt;CASSANDRA-15977&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17196119" author="beobal" created="Tue, 15 Sep 2020 12:52:26 +0000"  >&lt;p&gt;The issue is that the query which is intended to trigger the read repair is done at &lt;tt&gt;CL.ALL&lt;/tt&gt;. Since one of the replicas is unresponsive, this query simply times out. This looks to have just been an oversight in the original patch and changing to read at&#160;&lt;tt&gt;CL.QUORUM&lt;/tt&gt; fixes it.&lt;/p&gt;


&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;Branch&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;JDK8&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;JDK11&lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/beobal/cassandra/tree/16049-trunk&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;16049-trunk&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://app.circleci.com/pipelines/github/beobal/cassandra/92/workflows/431fc8ac-07d8-4f8e-a812-a5ecb896bacd/jobs/1888&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;utests&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://app.circleci.com/pipelines/github/beobal/cassandra/92/workflows/9e34b845-c2e4-4ccb-870d-b62ec6a54316/jobs/1891&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;utests&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;
</comment>
                            <comment id="17197356" author="edimitrova" created="Thu, 17 Sep 2020 03:52:31 +0000"  >&lt;p&gt;+1 from me. Thank you both &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=dcapwell&quot; class=&quot;user-hover&quot; rel=&quot;dcapwell&quot;&gt;dcapwell&lt;/a&gt;&#160;and &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=samt&quot; class=&quot;user-hover&quot; rel=&quot;samt&quot;&gt;samt&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17206035" author="beobal" created="Fri, 2 Oct 2020 08:36:02 +0000"  >&lt;p&gt;Thanks, committed to trunk in &lt;tt&gt;f866753b058fae2d73089710acd5628b7cff70c7&lt;/tt&gt;, apologies for the delay.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[samt]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12313825" key="com.atlassian.jira.plugin.system.customfieldtypes:cascadingselect">
                        <customfieldname>Bug Category</customfieldname>
                        <customfieldvalues>
                                                    <customfieldvalue key="12982" cascade-level=""><![CDATA[Correctness]]></customfieldvalue>
                                <customfieldvalue key="12990" cascade-level="1"><![CDATA[Test Failure]]></customfieldvalue>
            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12313821" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Complexity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12965"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313822" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Discovered By</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12975"><![CDATA[Code Inspection]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12313922" key="jira.plugin.projectspecificselectfield.jpssf:multicftype">
                        <customfieldname>Impacts</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="13100"><![CDATA[None]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            5 years, 6 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12313921" key="jira.plugin.projectspecificselectfield.jpssf:multicftype">
                        <customfieldname>Platform</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="13076"><![CDATA[All]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0hrbc:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[e.dimitrova]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12962"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12311420" key="com.atlassian.jira.plugin.system.customfieldtypes:version">
                        <customfieldname>Since Version</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="12348281">4.0-alpha1</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313924" key="com.atlassian.jira.plugin.system.customfieldtypes:textfield">
                        <customfieldname>Source Control Link</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>&lt;p&gt;&lt;a href=&quot;https://github.com/apache/cassandra/commit/f866753b058fae2d73089710acd5628b7cff70c7&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/cassandra/commit/f866753b058fae2d73089710acd5628b7cff70c7&lt;/a&gt;&lt;/p&gt;</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313823" key="com.atlassian.jira.plugin.system.customfieldtypes:textarea">
                        <customfieldname>Test and Documentation Plan</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>&lt;p&gt;Test-only fix, clean run of unit tests should be sufficient.&lt;/p&gt;</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>