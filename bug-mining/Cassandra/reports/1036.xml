<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 22:22:12 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-2825] Auto bootstrapping the 4th node in a 4 node cluster doesn&apos;t work, when no token explicitly assigned in config.</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-2825</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;This was done in sequence.  A, B, C, and D.  Node A with token 0 explicitly set in config.  The rest with auto_bootstrap: true and no token explicitly assigned.  B and C work as expected. D ends up stealing C&apos;s token.  &lt;/p&gt;

&lt;p&gt;from system.log on C:&lt;/p&gt;

&lt;p&gt;INFO &lt;span class=&quot;error&quot;&gt;&amp;#91;GossipStage:1&amp;#93;&lt;/span&gt; 2011-06-24 16:40:41,947 Gossiper.java (line 638) Node /10.171.47.226 is now part of the cluster&lt;br/&gt;
INFO &lt;span class=&quot;error&quot;&gt;&amp;#91;GossipStage:1&amp;#93;&lt;/span&gt; 2011-06-24 16:40:41,947 Gossiper.java (line 606) InetAddress /10.171.47.226 is now UP&lt;br/&gt;
INFO &lt;span class=&quot;error&quot;&gt;&amp;#91;GossipStage:1&amp;#93;&lt;/span&gt; 2011-06-24 16:42:09,432 StorageService.java (line 769) Nodes /10.171.47.226 and /10.171.55.77 have the same token 61078635599166706937511052402724559481.  /10.171.47.226 is the new owner&lt;br/&gt;
WARN &lt;span class=&quot;error&quot;&gt;&amp;#91;GossipStage:1&amp;#93;&lt;/span&gt; 2011-06-24 16:42:09,432 TokenMetadata.java (line 120) Token 61078635599166706937511052402724559481 changing ownership from /10.171.55.77 to /10.171.47.226&lt;/p&gt;

</description>
                <environment></environment>
        <key id="12511498">CASSANDRA-2825</key>
            <summary>Auto bootstrapping the 4th node in a 4 node cluster doesn&apos;t work, when no token explicitly assigned in config.</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10002" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Normal</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="brandon.williams">Brandon Williams</assignee>
                                    <reporter username="mallen">Michael Allen</reporter>
                        <labels>
                    </labels>
                <created>Fri, 24 Jun 2011 18:41:49 +0000</created>
                <updated>Tue, 16 Apr 2019 09:32:56 +0000</updated>
                            <resolved>Mon, 1 Aug 2011 17:55:04 +0000</resolved>
                                        <fixVersion>0.8.3</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                                                                <comments>
                            <comment id="13057960" author="brandon.williams" created="Thu, 30 Jun 2011 17:59:00 +0000"  >&lt;p&gt;I&apos;m unable to reproduce.  What I don&apos;t understand is how token 61078635599166706937511052402724559481 can be involved if the first node started at 0.  My ring ends up looking like:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Address         DC          Rack        Status State   Load            Owns    Token                                       
                                                                               148820376661671484777635343879628161952     
10.179.65.102   datacenter1 rack1       Up     Normal  315.59 MB       12.53%  0                                           
10.179.64.227   datacenter1 rack1       Up     Normal  157.76 MB       49.97%  85015475407349018891169115382886066923      
10.179.111.137  datacenter1 rack1       Up     Normal  78.99 MB        25.01%  127563185643974719468523634380546988377     
10.179.110.154  datacenter1 rack1       Up     Normal  39.55 MB        12.49%  148820376661671484777635343879628161952 
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="13066285" author="brandon.williams" created="Fri, 15 Jul 2011 23:09:14 +0000"  >&lt;p&gt;Can you show the ring at each step when you repro?&lt;/p&gt;</comment>
                            <comment id="13067348" author="mallen" created="Mon, 18 Jul 2011 22:03:27 +0000"  >&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;
Address         DC          Rack        Status State   Load            Owns    Token                                       
10.171.46.195   datacenter1 rack1       Up     Normal  8.91 KB         100.00% 0   


Address         DC          Rack        Status State   Load            Owns    Token                                       
                                                                               85070591730234615865843651857942052864      
10.171.46.195   datacenter1 rack1       Up     Normal  8.91 KB         50.00%  0                                           
10.170.121.70   datacenter1 rack1       Up     Normal  4.55 KB         50.00%  85070591730234615865843651857942052864 

Address         DC          Rack        Status State   Load            Owns    Token                                       
                                                                               85070591730234615865843651857942052864      
10.171.46.195   datacenter1 rack1       Up     Normal  8.91 KB         50.00%  0                                           
10.171.34.247   datacenter1 rack1       Up     Normal  4.55 KB         35.90%  61078635599166706937511052402724559481      
10.170.121.70   datacenter1 rack1       Up     Normal  13.4 KB         14.10%  85070591730234615865843651857942052864 


AddressDC          Rack        Status State   Load            Owns    Token                                       
                                                                               85070591730234615865843651857942052864      
10.171.46.195   datacenter1 rack1       Up     Normal  8.91 KB         50.00%  0                                           
10.171.23.65    datacenter1 rack1       Up     Normal  13.47 KB        35.90%  61078635599166706937511052402724559481      
10.170.121.70   datacenter1 rack1       Up     Normal  13.4 KB         14.10%  85070591730234615865843651857942052864

&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="13068039" author="brandon.williams" created="Tue, 19 Jul 2011 22:45:05 +0000"  >&lt;p&gt;The difference here is that when I tried to repro, I started with data in the cluster.  Since I never ran cleanup, token 0&apos;s range was always being split.  But if you start without any data, for some reason it decides to split 85070591730234615865843651857942052864 twice.  It&apos;s not clear why this is happening, since 0&apos;s load was still greater at the time, but at least one problem is that we do not assert that the token isn&apos;t in use when we determine it.&lt;/p&gt;</comment>
                            <comment id="13068054" author="brandon.williams" created="Tue, 19 Jul 2011 23:11:37 +0000"  >&lt;p&gt;Though 85070591730234615865843651857942052864 shows a load of 4.55KB when it is added, 90s later when another node checks it will have 13.4K because it will have updated.  The reason it has more load than the source at this point is because it flushed LocationInfo three times, where the source only flushed it twice.  That should be rare in practice, since typically if a cluster has no data you just start it up without bootstrapping, but still we should protect against handing out tokens that already are in use.&lt;/p&gt;</comment>
                            <comment id="13068116" author="brandon.williams" created="Wed, 20 Jul 2011 01:17:47 +0000"  >&lt;p&gt;Patch to exclude the system ks from key sampling when choosing a token, and assert that the token is not our own.&lt;/p&gt;

&lt;p&gt;What was happening is that when 0&apos;s range was split, it didn&apos;t have more than 3 keys, so it used the midpoint.  When 85070591730234615865843651857942052864 split, it did have enough keys (in the system ks) and it sampled 61078635599166706937511052402724559481.  After this, 61078635599166706937511052402724559481 had the highest load and when it sampled it also arrived at 61078635599166706937511052402724559481 since it was using the system ks.&lt;/p&gt;

&lt;p&gt;This patches forces using the midpoint method when there is no data other than the system ks, which is the right thing to do since the system ks data is never moved.&lt;/p&gt;</comment>
                            <comment id="13068122" author="jbellis" created="Wed, 20 Jul 2011 01:52:56 +0000"  >&lt;p&gt;can we generalize that to &quot;check that it&apos;s not any known endpoint&quot; and make it a &quot;real&quot; (non assert) check?&lt;/p&gt;</comment>
                            <comment id="13068502" author="brandon.williams" created="Wed, 20 Jul 2011 17:29:22 +0000"  >&lt;p&gt;v2 detects any token conflicts and throws a proper exception when they occur.&lt;/p&gt;</comment>
                            <comment id="13068504" author="jbellis" created="Wed, 20 Jul 2011 17:41:35 +0000"  >&lt;p&gt;let&apos;s compare w/ Table.SYSTEM_TABLE, otherwise +1&lt;/p&gt;</comment>
                            <comment id="13068512" author="brandon.williams" created="Wed, 20 Jul 2011 17:53:14 +0000"  >&lt;p&gt;Committed w/change to Table.SYSTEM_TABLE comparison.&lt;/p&gt;</comment>
                            <comment id="13068531" author="hudson" created="Wed, 20 Jul 2011 18:18:14 +0000"  >&lt;p&gt;Integrated in Cassandra-0.8 #228 (See &lt;a href=&quot;https://builds.apache.org/job/Cassandra-0.8/228/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/Cassandra-0.8/228/&lt;/a&gt;)&lt;br/&gt;
    Don&apos;t sample the system table keys when choosing a bootstrap token.&lt;br/&gt;
Patch by brandonwilliams, reviewed by jbellis for &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-2825&quot; title=&quot;Auto bootstrapping the 4th node in a 4 node cluster doesn&amp;#39;t work, when no token explicitly assigned in config.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-2825&quot;&gt;&lt;del&gt;CASSANDRA-2825&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;brandonwilliams : &lt;a href=&quot;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1148866&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1148866&lt;/a&gt;&lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/cassandra/branches/cassandra-0.8/src/java/org/apache/cassandra/service/StorageService.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13068884" author="slebresne" created="Thu, 21 Jul 2011 10:04:59 +0000"  >&lt;p&gt;Reopening because the patch broke BootStrapperTest (it somehow hangs forever until junit timeout)&lt;/p&gt;</comment>
                            <comment id="13068974" author="brandon.williams" created="Thu, 21 Jul 2011 13:21:24 +0000"  >&lt;p&gt;Impressive, I have no idea how this is breaking testTokenRoundtrip():&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;    public void testTokenRoundtrip() throws Exception
    {  
        StorageService.instance.initServer();
        // fetch a bootstrap token from the local node
        assert BootStrapper.getBootstrapTokenFrom(FBUtilities.getLocalAddress()) != null;
    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The log just shows a bunch of attempts to connect to the seed (127.0.0.2) which hasn&apos;t started yet.&lt;/p&gt;</comment>
                            <comment id="13069017" author="slebresne" created="Thu, 21 Jul 2011 15:15:25 +0000"  >&lt;p&gt;I&apos;ve reverted the patch too so we can do a release of 0.8.2 without having to wait on the unit test fix.&lt;/p&gt;</comment>
                            <comment id="13072954" author="brandon.williams" created="Fri, 29 Jul 2011 18:16:08 +0000"  >&lt;p&gt;v3 adds a check that tokenMetadata_.getEndpoint(token) is not null when checking for existing membership.  This fixes the test.&lt;/p&gt;</comment>
                            <comment id="13073630" author="brandon.williams" created="Mon, 1 Aug 2011 17:55:04 +0000"  >&lt;p&gt;Committed v3.&lt;/p&gt;</comment>
                            <comment id="13073642" author="hudson" created="Mon, 1 Aug 2011 18:16:19 +0000"  >&lt;p&gt;Integrated in Cassandra-0.8 #249 (See &lt;a href=&quot;https://builds.apache.org/job/Cassandra-0.8/249/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/Cassandra-0.8/249/&lt;/a&gt;)&lt;br/&gt;
    Don&apos;t sample the system table keys when choosing a bootstrap token.&lt;br/&gt;
Patch by brandonwilliams, reviewed by jbellis for &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-2825&quot; title=&quot;Auto bootstrapping the 4th node in a 4 node cluster doesn&amp;#39;t work, when no token explicitly assigned in config.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-2825&quot;&gt;&lt;del&gt;CASSANDRA-2825&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;brandonwilliams : &lt;a href=&quot;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1152876&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1152876&lt;/a&gt;&lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/cassandra/branches/cassandra-0.8/src/java/org/apache/cassandra/service/StorageService.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                    </comments>
                    <attachments>
                            <attachment id="12487188" name="2825-v2.txt" size="1883" author="brandon.williams" created="Wed, 20 Jul 2011 17:29:22 +0000"/>
                            <attachment id="12488234" name="2825-v3.txt" size="1938" author="brandon.williams" created="Fri, 29 Jul 2011 18:16:08 +0000"/>
                            <attachment id="12487095" name="2825.txt" size="1715" author="brandon.williams" created="Wed, 20 Jul 2011 01:17:47 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[brandon.williams]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>20852</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            14 years, 17 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0gdov:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>93648</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12962"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>