<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 23:17:40 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-16217] Minimal 4.0 COMPACT STORAGE backport</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-16217</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;There are several behavioural changes related to compact storage, and these differences are larger than most of us have anticipated: we first thought there&#8217;ll be that &#8220;appearing column&#8221;, but there&#8217;s implicit nulls in clusterings thing, and row vs column deletion.&lt;/p&gt;

&lt;p&gt;Some of the recent issues on the subject are: &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-16048&quot; title=&quot;Safely Ignore Compact Storage Tables Where Users Have Defined Clustering and Value Columns&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-16048&quot;&gt;&lt;del&gt;CASSANDRA-16048&lt;/del&gt;&lt;/a&gt;, which allows to ignore these differences. The other one was trying to improve user experience of anyone still using compact storage: &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-15811&quot; title=&quot;Improve DROP COMPACT STORAGE&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-15811&quot;&gt;&lt;del&gt;CASSANDRA-15811&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;Easily reproducible differernces are:&lt;/p&gt;

&lt;p&gt;(1) hidden columns show up, which breaks SELECT * queries&lt;br/&gt;
 (2) DELETE v and UPDATE v WITH TTL would result into row removals in non-dense compact tables (&lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-16069&quot; title=&quot;Loss of functionality around null clustering when dropping compact storage&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-16069&quot;&gt;CASSANDRA-16069&lt;/a&gt;)&lt;br/&gt;
 (3) INSERT allows skipping clusterings, which are filled with nulls by default.&lt;/p&gt;

&lt;p&gt;Some of these are tricky to support, as 15811 has shown. Anyone on OSS side who might want to upgrade to 4.0 while still using compact storage might be affected by being forced into one of these behaviours.&lt;/p&gt;

&lt;p&gt;Possible solutions are to document these behaviours, or to bring back a minimal set of COMPACT STORAGE to keep supporting these.&lt;/p&gt;

&lt;p&gt;It looks like it is possible to leave some of the functionality related to DENSE flag and allow it to be present in 4.0, but only for these three (and potential related, however not direrclty visible) cases.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=e.dimitrova&quot; class=&quot;user-hover&quot; rel=&quot;e.dimitrova&quot;&gt;e.dimitrova&lt;/a&gt; since you were working on removal on compact storage, wanted to reassure that this is not a revert of your patch. On contrary: your patch was instrumental in identifying the right places.&lt;/p&gt;

&lt;p&gt;cc &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=slebresne&quot; class=&quot;user-hover&quot; rel=&quot;slebresne&quot;&gt;slebresne&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=aleksey&quot; class=&quot;user-hover&quot; rel=&quot;aleksey&quot;&gt;aleksey&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=benedict&quot; class=&quot;user-hover&quot; rel=&quot;benedict&quot;&gt;benedict&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=marcuse&quot; class=&quot;user-hover&quot; rel=&quot;marcuse&quot;&gt;marcuse&lt;/a&gt;&lt;/p&gt;

&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/apache/cassandra/pull/785&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;patch&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://app.circleci.com/pipelines/github/ifesdjeen/cassandra?branch=13994-followup&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;ci&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;
</description>
                <environment></environment>
        <key id="13336338">CASSANDRA-16217</key>
            <summary>Minimal 4.0 COMPACT STORAGE backport</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10002" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Normal</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="ifesdjeen">Alex Petrov</assignee>
                                    <reporter username="ifesdjeen">Alex Petrov</reporter>
                        <labels>
                    </labels>
                <created>Tue, 20 Oct 2020 16:54:03 +0000</created>
                <updated>Fri, 10 Oct 2025 08:47:59 +0000</updated>
                            <resolved>Tue, 8 Dec 2020 07:25:21 +0000</resolved>
                                        <fixVersion>4.0-beta4</fixVersion>
                    <fixVersion>4.0</fixVersion>
                                    <component>Legacy/CQL</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                    <progress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                            <timeestimate seconds="0">0h</timeestimate>
                            <timespent seconds="2400">40m</timespent>
                                <comments>
                            <comment id="17218304" author="edimitrova" created="Wed, 21 Oct 2020 14:02:49 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ifesdjeen&quot; class=&quot;user-hover&quot; rel=&quot;ifesdjeen&quot;&gt;ifesdjeen&lt;/a&gt;,&#160;&lt;/p&gt;

&lt;p&gt;Thanks for pinging.&lt;/p&gt;

&lt;p&gt;&lt;cite&gt;Possible solutions are to document these behaviours, or to bring back a minimal set of COMPACT STORAGE to keep supporting these.&lt;/cite&gt;&lt;/p&gt;

&lt;p&gt;I am +1 on adding the minimal support and not having breaking changes. &lt;/p&gt;</comment>
                            <comment id="17224690" author="krummas" created="Mon, 2 Nov 2020 14:36:08 +0000"  >&lt;p&gt;this looks good in general, first pass of review;&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;we need to forward-port &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-13917&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/CASSANDRA-13917&lt;/a&gt; to 4.0&lt;/li&gt;
	&lt;li&gt;In &lt;tt&gt;Selection.java&lt;/tt&gt;, this was changed in 13994:
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt; containsStaticColumns()
     {
-        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (table.isStaticCompactTable() || !table.hasStaticColumns())
+        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (!table.hasStaticColumns())
             &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;;
...
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;note that I don&apos;t see how we can actually hit this (especially with 13917 backported), just wanted to make sure you left this out on purpose&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;&lt;tt&gt;RowFilter#deserialize&lt;/tt&gt;:
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
-                &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (!metadata.isCompactTable() &amp;amp;&amp;amp; column == &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;)
+                &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (column == &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;&lt;/li&gt;
	&lt;li&gt;&lt;tt&gt;ViewUpdateGenerator#updateAction&lt;/tt&gt; missing:
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (baseMetadata.isCompactTable())
         {
             Clustering clustering = mergedBaseRow.clustering();
             &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; (&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; i = 0; i &amp;lt; clustering.size(); i++)
             {
                 &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (clustering.get(i) == &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;)
                     &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; UpdateAction.NONE;
             }
         }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;&lt;/li&gt;
	&lt;li&gt;&lt;tt&gt;TableMetadata#fixupCompactTable&lt;/tt&gt; needs
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (hasCounters)
            flags.add(TableMetadata.Flag.COUNTER);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;&lt;/li&gt;
	&lt;li&gt;we should probably re-add all the (relevant) tests removed in &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-10857&quot; title=&quot;Allow dropping COMPACT STORAGE flag from tables in 3.X&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-10857&quot;&gt;&lt;del&gt;CASSANDRA-10857&lt;/del&gt;&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

</comment>
                            <comment id="17226716" author="ifesdjeen" created="Thu, 5 Nov 2020 13:17:50 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=marcuse&quot; class=&quot;user-hover&quot; rel=&quot;marcuse&quot;&gt;marcuse&lt;/a&gt; thank you for a review.&lt;/p&gt;

&lt;p&gt;I think it&apos;s a great idea to backport &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-10857&quot; title=&quot;Allow dropping COMPACT STORAGE flag from tables in 3.X&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-10857&quot;&gt;&lt;del&gt;CASSANDRA-10857&lt;/del&gt;&lt;/a&gt; tests, did find several edge-cases with CQL generation. I&apos;ve also made changes similar to &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-13917&quot; title=&quot;COMPACT STORAGE queries on dense static tables accept hidden column1 and value columns&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-13917&quot;&gt;&lt;del&gt;CASSANDRA-13917&lt;/del&gt;&lt;/a&gt;, although it turned out we can implement them a bit simpler in 4.0.&lt;/p&gt;

&lt;p&gt;I&apos;ve triggered another test run just now after fixing the last failure, so this should be ready for another round.&lt;/p&gt;</comment>
                            <comment id="17229136" author="krummas" created="Tue, 10 Nov 2020 11:16:42 +0000"  >&lt;p&gt;+1, two very minor comments in the PR, feel free to ignore or fix on commit&lt;/p&gt;</comment>
                            <comment id="17230546" author="ifesdjeen" created="Thu, 12 Nov 2020 11:39:57 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=marcuse&quot; class=&quot;user-hover&quot; rel=&quot;marcuse&quot;&gt;marcuse&lt;/a&gt; thank you for review! Fixed indentation on commit, and will open a separate ticket for handling v3 in 4.0.&lt;/p&gt;

&lt;p&gt;Committed to trunk with &lt;a href=&quot;https://github.com/apache/cassandra/commit/8ffec0f02cf73c3d3a8c01aa2d856647a5620a21&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;8ffec0f02cf73c3d3a8c01aa2d856647a5620a21&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17231040" author="dcapwell" created="Thu, 12 Nov 2020 23:36:51 +0000"  >&lt;p&gt;This seems to have broken the upgrade tests, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ifesdjeen&quot; class=&quot;user-hover&quot; rel=&quot;ifesdjeen&quot;&gt;ifesdjeen&lt;/a&gt; can you take a look?&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://app.circleci.com/pipelines/github/dcapwell/cassandra/790/workflows/2cee6597-8801-41fb-af14-09943cba006c&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://app.circleci.com/pipelines/github/dcapwell/cassandra/790/workflows/2cee6597-8801-41fb-af14-09943cba006c&lt;/a&gt;&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
testclasslist:
     [echo] &lt;span class=&quot;code-object&quot;&gt;Number&lt;/span&gt; of test runners: 1
[junit-timeout] Picked up _JAVA_OPTIONS: -Djava.net.preferIPv4Stack=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;
[junit-timeout] Testsuite: org.apache.cassandra.distributed.upgrade.CompactStorage3to4UpgradeTest
[junit-timeout] Testsuite: org.apache.cassandra.distributed.upgrade.CompactStorage3to4UpgradeTest Tests run: 4, Failures: 3, Errors: 0, Skipped: 0, Time elapsed: 36.632 sec
[junit-timeout]
[junit-timeout] Testcase: ignoreDenseCompoundTablesWithValueColumn(org.apache.cassandra.distributed.upgrade.CompactStorage3to4UpgradeTest):     FAILED
[junit-timeout] missing compound flag
[junit-timeout] junit.framework.AssertionFailedError: missing compound flag
[junit-timeout]         at org.apache.cassandra.distributed.upgrade.CompactStorage3to4UpgradeTest.lambda$ignoreDenseCompoundTablesWithValueColumn$1(CompactStorage3to4UpgradeTest.java:97)
[junit-timeout]         at org.apache.cassandra.distributed.upgrade.UpgradeTestBase$TestCase.run(UpgradeTestBase.java:180)
[junit-timeout]         at org.apache.cassandra.distributed.upgrade.CompactStorage3to4UpgradeTest.ignoreDenseCompoundTablesWithValueColumn(CompactStorage3to4UpgradeTest.java:100)
[junit-timeout]
[junit-timeout]
[junit-timeout] Testcase: failOnCompactClusteredTablesWithValueOutColumn(org.apache.cassandra.distributed.upgrade.CompactStorage3to4UpgradeTest):       FAILED
[junit-timeout] should never run because we don&apos;t expect the node to start
[junit-timeout] junit.framework.AssertionFailedError: should never run because we don&apos;t expect the node to start
[junit-timeout]         at org.apache.cassandra.distributed.upgrade.CompactStorage3to4UpgradeTest.lambda$failOnCompactClusteredTablesWithValueOutColumn$3(CompactStorage3to4UpgradeTest.java:112)
[junit-timeout]         at org.apache.cassandra.distributed.upgrade.UpgradeTestBase$TestCase.run(UpgradeTestBase.java:180)
[junit-timeout]         at org.apache.cassandra.distributed.upgrade.CompactStorage3to4UpgradeTest.failOnCompactClusteredTablesWithValueOutColumn(CompactStorage3to4UpgradeTest.java:113)
[junit-timeout]
[junit-timeout]
[junit-timeout] Testcase: failOnCompactTablesWithNoClustering(org.apache.cassandra.distributed.upgrade.CompactStorage3to4UpgradeTest):  FAILED
[junit-timeout] should never run because we don&apos;t expect the node to start
[junit-timeout] junit.framework.AssertionFailedError: should never run because we don&apos;t expect the node to start
[junit-timeout]         at org.apache.cassandra.distributed.upgrade.CompactStorage3to4UpgradeTest.lambda$failOnCompactTablesWithNoClustering$5(CompactStorage3to4UpgradeTest.java:130)
[junit-timeout]         at org.apache.cassandra.distributed.upgrade.UpgradeTestBase$TestCase.run(UpgradeTestBase.java:180)
[junit-timeout]         at org.apache.cassandra.distributed.upgrade.CompactStorage3to4UpgradeTest.failOnCompactTablesWithNoClustering(CompactStorage3to4UpgradeTest.java:131)
[junit-timeout]
[junit-timeout]
[junit-timeout] Test org.apache.cassandra.distributed.upgrade.CompactStorage3to4UpgradeTest FAILED

BUILD FAILED
/Users/davidcapwell/src/github/apache/cassandra-trunk/build.xml:2035: The following error occurred &lt;span class=&quot;code-keyword&quot;&gt;while&lt;/span&gt; executing &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; line:
/Users/davidcapwell/src/github/apache/cassandra-trunk/build.xml:1916: Some test(s) failed.

Total time: 41 seconds
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="17233871" author="edimitrova" created="Tue, 17 Nov 2020 19:21:40 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ifesdjeen&quot; class=&quot;user-hover&quot; rel=&quot;ifesdjeen&quot;&gt;ifesdjeen&lt;/a&gt;&#160; Also, I think we can remove this from NEWS.txt:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;Cassandra 4.0 removed support for COMPACT STORAGE tables. All Compact Tables have to be migrated using &apos;ALTER ... DROP COMPACT STORAGE&apos; statement in 3.0/3.11. Cassandra starting 4.0 will not start if flags indicate that the table is non-CQL. Syntax for creating compact tables is also deprecated&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Should I open a new follow up ticket for test fixes, harry tests, and documentation to be updated? Or even a few of them?&lt;/p&gt;</comment>
                            <comment id="17235518" author="ifesdjeen" created="Thu, 19 Nov 2020 14:39:08 +0000"  >&lt;p&gt;I aplogise for taking long to respond. This test shouold be removed since there&apos;s no auto-drop of compact storage, one has to do this explicitly.&lt;/p&gt;

&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/apache/cassandra/pull/827&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;patch&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://app.circleci.com/pipelines/github/ifesdjeen/cassandra?branch=CASSANDRA-16217-followup&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;CI&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;


&lt;p&gt;I&apos;ve also updated a news entry.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=marcuse&quot; class=&quot;user-hover&quot; rel=&quot;marcuse&quot;&gt;marcuse&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=e.dimitrova&quot; class=&quot;user-hover&quot; rel=&quot;e.dimitrova&quot;&gt;e.dimitrova&lt;/a&gt; could you take a short look? The change is rahter mechanical.&lt;/p&gt;</comment>
                            <comment id="17235528" author="krummas" created="Thu, 19 Nov 2020 14:54:01 +0000"  >&lt;p&gt;+1 assuming clean ci&lt;/p&gt;</comment>
                            <comment id="17235534" author="edimitrova" created="Thu, 19 Nov 2020 15:01:30 +0000"  >&lt;p&gt;Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ifesdjeen&quot; class=&quot;user-hover&quot; rel=&quot;ifesdjeen&quot;&gt;ifesdjeen&lt;/a&gt;, it looks good to me. I managed to run locally the compact storage upgrade DTests some time ago, I will rerun them later to check their current state.&lt;/p&gt;</comment>
                            <comment id="17235674" author="dcapwell" created="Thu, 19 Nov 2020 19:09:38 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=maedhroz&quot; class=&quot;user-hover&quot; rel=&quot;maedhroz&quot;&gt;maedhroz&lt;/a&gt; and/or &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=adelapena&quot; class=&quot;user-hover&quot; rel=&quot;adelapena&quot;&gt;adelapena&lt;/a&gt; mind reviewing?  Since you two worked on creating that test, would be best if you chime in saying its correct to delete the test.&lt;/p&gt;</comment>
                            <comment id="17235679" author="maedhroz" created="Thu, 19 Nov 2020 19:12:48 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ifesdjeen&quot; class=&quot;user-hover&quot; rel=&quot;ifesdjeen&quot;&gt;ifesdjeen&lt;/a&gt; Should we be removing &lt;tt&gt;testNullClusteringValues&lt;/tt&gt;. It never relied on the auto-drop functionality, correct? (It&apos;s also the only test that verified the fix from &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-16241&quot; title=&quot;ArrayClustering does not properly handle null clustering key elements left over from tables created WITH COMPACT STORAGE&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-16241&quot;&gt;&lt;del&gt;CASSANDRA-16241&lt;/del&gt;&lt;/a&gt;.)&lt;/p&gt;</comment>
                            <comment id="17236209" author="edimitrova" created="Fri, 20 Nov 2020 14:55:12 +0000"  >&lt;p&gt;I just took a quick look at the dests as promised:&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/ekaterinadimitrova2/cassandra-dtest/blob/master/upgrade_tests/upgrade_compact_storage.py#L56&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/ekaterinadimitrova2/cassandra-dtest/blob/master/upgrade_tests/upgrade_compact_storage.py#L56&lt;/a&gt;&#160;---&amp;gt; this one should be reworked to actually test 4.0 with the compact storage&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/apache/cassandra-dtest/blob/trunk/upgrade_tests/upgrade_compact_storage.py#L116&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/cassandra-dtest/blob/trunk/upgrade_tests/upgrade_compact_storage.py#L116&lt;/a&gt;&#160;---&amp;gt; this one maybe could be removed&lt;/p&gt;

&lt;p&gt;Also, this one -&#160;&lt;a href=&quot;https://github.com/apache/cassandra-dtest/blob/trunk/upgrade_tests/upgrade_compact_storage.py#L182&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/cassandra-dtest/blob/trunk/upgrade_tests/upgrade_compact_storage.py#L182&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17236223" author="ifesdjeen" created="Fri, 20 Nov 2020 15:15:44 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=maedhroz&quot; class=&quot;user-hover&quot; rel=&quot;maedhroz&quot;&gt;maedhroz&lt;/a&gt; of course, you&apos;re right. Brought back &lt;tt&gt;testNullClusteringValues&lt;/tt&gt;. Thank you for bringing this up. Could you take another look?&lt;/p&gt;
</comment>
                            <comment id="17236232" author="ifesdjeen" created="Fri, 20 Nov 2020 15:31:58 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=e.dimitrova&quot; class=&quot;user-hover&quot; rel=&quot;e.dimitrova&quot;&gt;e.dimitrova&lt;/a&gt; since we have added upgrade dtests &lt;a href=&quot;https://github.com/apache/cassandra/commit/8ffec0f02cf73c3d3a8c01aa2d856647a5620a21#diff-80d21b6bed7c174f700bd5d003122180c67b6615a2bc9c64aa9077ad9dc7cd8aR31&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;here&lt;/a&gt; as in-jvm dtests, I do not think it&apos;s necessary to update python tests. Patch to remove ones you have pointed out: &lt;a href=&quot;https://github.com/apache/cassandra-dtest/pull/104&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/cassandra-dtest/pull/104&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17236366" author="dcapwell" created="Fri, 20 Nov 2020 18:36:54 +0000"  >&lt;p&gt;There have been conversations about migrating from python to jvm dtest and the main point is we shouldn&apos;t delete python dtests.  python dtests cover vnode case as well but jvm does not, so if we delete python dtests in favor of jvm dtest we actually loose coverage.  I added a marker saying a test was ported to jvm-dtest, this will skip novnode case but still run in vnode case.&lt;/p&gt;</comment>
                            <comment id="17236369" author="ifesdjeen" created="Fri, 20 Nov 2020 18:40:15 +0000"  >&lt;p&gt;Just to make sure: above patch only removes tests that aren&#8217;t applicable (in other words, ones that are testing that 4.0 won&#8217;t start). We will not delete any tests that test actual functionality.&lt;/p&gt;</comment>
                            <comment id="17236373" author="dcapwell" created="Fri, 20 Nov 2020 18:46:33 +0000"  >&lt;p&gt;thanks for clarifying.&lt;/p&gt;</comment>
                            <comment id="17236758" author="maedhroz" created="Sat, 21 Nov 2020 18:12:09 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ifesdjeen&quot; class=&quot;user-hover&quot; rel=&quot;ifesdjeen&quot;&gt;ifesdjeen&lt;/a&gt; Sorry, was out sick yesterday. I had a look at the &lt;a href=&quot;https://github.com/apache/cassandra/pull/827&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;follow-up patch&lt;/a&gt;, and LGTM. Thanks!&lt;/p&gt;</comment>
                            <comment id="17240903" author="edimitrova" created="Mon, 30 Nov 2020 17:21:14 +0000"  >&lt;p&gt;As far as I can see from the thread, all concerns were already addressed? Is this ready for commit or I am missing something? &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="17241145" author="dcapwell" created="Mon, 30 Nov 2020 23:57:25 +0000"  >&lt;p&gt;As long as the author&apos;s of the tests modified (Caleb in this case) are ok then I am ok.&lt;/p&gt;</comment>
                            <comment id="17241335" author="ifesdjeen" created="Tue, 1 Dec 2020 08:13:31 +0000"  >&lt;p&gt;Follow-up is committed as &lt;a href=&quot;https://github.com/apache/cassandra/commit/caeecf6456b87886a79f47a2954788e6c856697c&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;caeecf6456b87886a79f47a2954788e6c856697c&lt;/a&gt; and &lt;a href=&quot;https://github.com/apache/cassandra/commit/79ea1e373614c21fd1aa294fb52d693767b91819&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;79ea1e373614c21fd1aa294fb52d693767b91819&lt;/a&gt;. &lt;/p&gt;

&lt;p&gt;I was waiting for to merge &lt;a href=&quot;https://github.com/apache/cassandra-dtest/pull/104&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/cassandra-dtest/pull/104&lt;/a&gt; to close this ticket, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=e.dimitrova&quot; class=&quot;user-hover&quot; rel=&quot;e.dimitrova&quot;&gt;e.dimitrova&lt;/a&gt; would you be able to take a look at it?&lt;/p&gt;</comment>
                            <comment id="17241783" author="edimitrova" created="Tue, 1 Dec 2020 18:49:20 +0000"  >&lt;p&gt;Hey &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ifesdjeen&quot; class=&quot;user-hover&quot; rel=&quot;ifesdjeen&quot;&gt;ifesdjeen&lt;/a&gt;, I am sorry, I am not a committer but removing those three tests makes sense as they were testing inability to start after upgrade to 4.0 without removing the COMPACT STORAGE and the downgrade after unsuccessful upgrade.&#160;&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="13336991">CASSANDRA-16226</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="13346668">CASSANDRA-16361</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="13436886">CASSANDRA-17507</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[ifesdjeen]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12313825" key="com.atlassian.jira.plugin.system.customfieldtypes:cascadingselect">
                        <customfieldname>Bug Category</customfieldname>
                        <customfieldvalues>
                                                    <customfieldvalue key="12982" cascade-level=""><![CDATA[Correctness]]></customfieldvalue>
                                <customfieldvalue key="12988" cascade-level="1"><![CDATA[API / Semantic Implementation]]></customfieldvalue>
            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12313821" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Complexity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12965"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313822" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Discovered By</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12969"><![CDATA[User Report]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12313922" key="jira.plugin.projectspecificselectfield.jpssf:multicftype">
                        <customfieldname>Impacts</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="13100"><![CDATA[None]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            4 years, 50 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12313921" key="jira.plugin.projectspecificselectfield.jpssf:multicftype">
                        <customfieldname>Platform</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="13076"><![CDATA[All]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0juu8:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[ifesdjeen]]></customfieldvalue>
        <customfieldvalue><![CDATA[marcuse]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12963"><![CDATA[Critical]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12311420" key="com.atlassian.jira.plugin.system.customfieldtypes:version">
                        <customfieldname>Since Version</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="12348285">4.0-beta1</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313924" key="com.atlassian.jira.plugin.system.customfieldtypes:textfield">
                        <customfieldname>Source Control Link</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>&lt;p&gt;&lt;a href=&quot;https://github.com/apache/cassandra/commit/8ffec0f02cf73c3d3a8c01aa2d856647a5620a21&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/cassandra/commit/8ffec0f02cf73c3d3a8c01aa2d856647a5620a21&lt;/a&gt;&lt;/p&gt;</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313823" key="com.atlassian.jira.plugin.system.customfieldtypes:textarea">
                        <customfieldname>Test and Documentation Plan</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>&lt;p&gt;Tests included; will be additionally tested wit Harry&lt;/p&gt;</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>