<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 22:43:03 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-6753] Cassandra2.1~beta1 Stall at Boot</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-6753</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;I was trying out the new release for several perf. improvements that I am very interested in. After upgrading my cassandra from 2.0.5 to the beta version, cassandra is stalled while init the column families.&lt;/p&gt;

&lt;p&gt;I might misconfigure something, but it seems it is suck in a loop. I added a couple debug statements, but, on second thought, I think I should just leave it to the experts...&lt;/p&gt;

&lt;p&gt;It&apos;s looping in the following over and over:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeHeader panelHeader&quot; style=&quot;border-bottom-width: 1px;&quot;&gt;&lt;b&gt;src/java/org/apache/cassandra/utils/memory/Pool.java#needsCleaning&lt;/b&gt;&lt;/div&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;0 &amp;gt;= -858993472 &amp;amp;&amp;amp; &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt; &amp;amp;&amp;amp; &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeHeader panelHeader&quot; style=&quot;border-bottom-width: 1px;&quot;&gt;&lt;b&gt;Log&lt;/b&gt;&lt;/div&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;INFO  [HeapSlabPoolCleaner] 2014-02-21 22:28:40,073 Keyspace.java:77 - java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.getStackTrace(Unknown Source),
org.apache.cassandra.db.Keyspace$1.apply(Keyspace.java:77),
org.apache.cassandra.db.Keyspace$1.apply(Keyspace.java:74),
com.google.common.collect.Iterators$8.transform(Iterators.java:794),
com.google.common.collect.TransformedIterator.next(TransformedIterator.java:48),
org.apache.cassandra.db.ColumnFamilyStore.all(ColumnFamilyStore.java:2278),
org.apache.cassandra.db.ColumnFamilyStore$FlushLargestColumnFamily.run(ColumnFamilyStore.java:1043),
org.apache.cassandra.utils.memory.PoolCleanerThread.run(PoolCleanerThread.java:70)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;They may be totally unrelated or a normal behavior. Let me know if there is any other info I should provide.&lt;/p&gt;</description>
                <environment>&lt;p&gt;Distributor ID:	Ubuntu&lt;br/&gt;
Description:	Ubuntu 12.04.3 LTS&lt;br/&gt;
Release:	12.04&lt;br/&gt;
Codename:	precise&lt;/p&gt;

&lt;p&gt;AWS: i2.xlarge&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;INFO  22:34:40 JVM vendor/version: Java HotSpot(TM) 64-Bit Server VM/1.7.0
INFO  22:34:40 Heap size: 12777553920/12777553920
INFO  22:34:40 Code Cache Non-heap memory: init = 2555904(2496K) used = 621632(607K) committed = 2555904(2496K) max = 50331648(49152K)
INFO  22:34:40 Par Eden Space Heap memory: init = 859045888(838912K) used = 137447616(134226K) committed = 859045888(838912K) max = 859045888(838912K)
INFO  22:34:40 Par Survivor Space Heap memory: init = 107347968(104832K) used = 0(0K) committed = 107347968(104832K) max = 107347968(104832K)
INFO  22:34:40 CMS Old Gen Heap memory: init = 11811160064(11534336K) used = 1433816(1400K) committed = 11811160064(11534336K) max = 11811160064(11534336K)
INFO  22:34:40 CMS Perm Gen Non-heap memory: init = 21757952(21248K) used = 18654512(18217K) committed = 21757952(21248K) max = 85983232(83968K)
INFO  22:34:40 Classpath: /usr/share/cassandra/lib/airline-0.6.jar:/usr/share/cassandra/lib/antlr-3.2.jar:/usr/share/cassandra/lib/commons-cli-1.1.jar:/usr/share/cassandra/lib/commons-codec-1.2.jar:/usr/share/cassandra/lib/commons-lang3-3.1.jar:/usr/share/cassandra/lib/commons-math3-3.2.jar:/usr/share/cassandra/lib/compress-lzf-0.8.4.jar:/usr/share/cassandra/lib/concurrentlinkedhashmap-lru-1.4.jar:/usr/share/cassandra/lib/disruptor-3.0.1.jar:/usr/share/cassandra/lib/guava-16.0.jar:/usr/share/cassandra/lib/high-scale-lib-1.1.2.jar:/usr/share/cassandra/lib/jackson-core-asl-1.9.2.jar:/usr/share/cassandra/lib/jackson-mapper-asl-1.9.2.jar:/usr/share/cassandra/lib/jamm-0.2.6.jar:/usr/share/cassandra/lib/javax.inject.jar:/usr/share/cassandra/lib/jbcrypt-0.3m.jar:/usr/share/cassandra/lib/jline-1.0.jar:/usr/share/cassandra/lib/jna-4.0.0.jar:/usr/share/cassandra/lib/json-simple-1.1.jar:/usr/share/cassandra/lib/libthrift-0.9.1.jar:/usr/share/cassandra/lib/logback-classic-1.0.13.jar:/usr/share/cassandra/lib/logback-core-1.0.13.jar:/usr/share/cassandra/lib/lz4-1.2.0.jar:/usr/share/cassandra/lib/metrics-core-2.2.0.jar:/usr/share/cassandra/lib/netty-3.6.6.Final.jar:/usr/share/cassandra/lib/reporter-config-2.1.0.jar:/usr/share/cassandra/lib/slf4j-api-1.7.2.jar:/usr/share/cassandra/lib/snakeyaml-1.11.jar:/usr/share/cassandra/lib/snappy-java-1.0.5.jar:/usr/share/cassandra/lib/stream-2.5.2.jar:/usr/share/cassandra/lib/thrift-server-0.3.3.jar:/usr/share/cassandra/CustomAgent.jar:/usr/share/cassandra/apache-cassandra-2.1.0~beta1.jar:/usr/share/cassandra/apache-cassandra-thrift-2.1.0~beta1.jar:/usr/share/cassandra/apache-cassandra.jar:/usr/share/cassandra/jna.jar:/usr/share/cassandra/mx4j-tools.jar:/usr/share/cassandra/stress.jar:/usr/share/java/jna.jar:/etc/cassandra:/usr/share/java/commons-daemon.jar:/usr/share/cassandra/lib/jamm-0.2.6.jar:/usr/share/cassandra/CustomAgent.jar:/usr/local/jcollectd/jcollectd.jar
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeHeader panelHeader&quot; style=&quot;border-bottom-width: 1px;&quot;&gt;&lt;b&gt;Node configuration&lt;/b&gt;&lt;/div&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;[authenticator=AllowAllAuthenticator; authorizer=AllowAllAuthorizer; auto_snapshot=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;; batchlog_replay_throttle_in_kb=1024; cas_contention_timeout_in_ms=1000; client_encryption_options=&amp;lt;REDACTED&amp;gt;; cluster_name=sketchy_staging_test; column_index_size_in_kb=64; commitlog_directory=/mnt/cassandra/commitlog; commitlog_segment_size_in_mb=32; commitlog_sync=periodic; commitlog_sync_period_in_ms=10000; compaction_preheat_key_cache=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;; compaction_throughput_mb_per_sec=64; concurrent_counter_writes=32; concurrent_reads=128; concurrent_writes=128; counter_cache_save_period=7200; counter_cache_size_in_mb=&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;; counter_write_request_timeout_in_ms=5000; cross_node_timeout=&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;; data_file_directories=[/mnt/cassandra/data]; disk_failure_policy=stop; dynamic_snitch_badness_threshold=0.1; dynamic_snitch_reset_interval_in_ms=600000; dynamic_snitch_update_interval_in_ms=100; endpoint_snitch=SimpleSnitch; flush_directory=/mnt/cassandra/flush; hinted_handoff_enabled=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;; hinted_handoff_throttle_in_kb=1024; in_memory_compaction_limit_in_mb=64; incremental_backups=&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;; index_summary_capacity_in_mb=&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;; index_summary_resize_interval_in_minutes=60; inter_dc_tcp_nodelay=&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;; internode_compression=all; key_cache_save_period=14400; key_cache_size_in_mb=1024; listen_address=10.9.163.158; max_hint_window_in_ms=14400000; max_hints_delivery_threads=2; memtable_cleanup_threshold=0.4; memtable_total_space_in_mb=2048; native_transport_port=9042; num_tokens=256; partitioner=org.apache.cassandra.dht.Murmur3Partitioner; permissions_validity_in_ms=2000; preheat_kernel_page_cache=&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;; range_request_timeout_in_ms=10000; read_request_timeout_in_ms=5000; request_scheduler=org.apache.cassandra.scheduler.NoScheduler; request_timeout_in_ms=10000; row_cache_save_period=14400; row_cache_size_in_mb=1024; rpc_address=0.0.0.0; rpc_keepalive=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;; rpc_port=9160; rpc_server_type=sync; saved_caches_directory=/mnt/cassandra/cache; seed_provider=[{class_name=org.apache.cassandra.locator.SimpleSeedProvider, parameters=[{seeds=10.71.141.38,10.218.142.35}]}]; server_encryption_options=&amp;lt;REDACTED&amp;gt;; snapshot_before_compaction=&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;; ssl_storage_port=7001; start_native_transport=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;; start_rpc=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;; storage_port=7000; thrift_framed_transport_size_in_mb=15; tombstone_failure_threshold=100000; tombstone_warn_threshold=1000; trickle_fsync=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;; trickle_fsync_interval_in_kb=10240; truncate_request_timeout_in_ms=60000; write_request_timeout_in_ms=2000]
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
</environment>
        <key id="12696660">CASSANDRA-6753</key>
            <summary>Cassandra2.1~beta1 Stall at Boot</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10002" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Normal</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="benedict">Benedict Elliott Smith</assignee>
                                    <reporter username="davychia">David Chia</reporter>
                        <labels>
                    </labels>
                <created>Fri, 21 Feb 2014 22:48:40 +0000</created>
                <updated>Tue, 16 Apr 2019 09:31:53 +0000</updated>
                            <resolved>Sat, 22 Feb 2014 14:24:46 +0000</resolved>
                                        <fixVersion>2.1 beta2</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="13909024" author="benedict" created="Sat, 22 Feb 2014 00:12:56 +0000"  >&lt;p&gt;Some obvious questions:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Do you see any other errors?&lt;/li&gt;
	&lt;li&gt;The 0 and -858993472 correspond to the used() and nextClean part of that method, respectively, correct? What about the limit and the cleanThreshold? What do they say?&lt;/li&gt;
	&lt;li&gt;This is consistent, every time you start?&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;This is definitely not normal, and is almost certainly a bug, but it shouldn&apos;t ever stop Cassandra from starting. So, I wonder if there is a strange interaction going on with some other problem, which may be easier to track down if we can figure out if there is another such problem.&lt;/p&gt;

&lt;p&gt;Could you attach the output from jstacking the process?&lt;/p&gt;

&lt;p&gt;The easiest possibility to explain this is that somehow the memtable_cleanup_threshold is negative. We don&apos;t actually check this on startup, which is an oversight. The fact that the value for nextClean is exactly &amp;#45;0.4 * 2Gb has me suspicious - with an 8Gb heap, we would default to a 2Gb limit, and default cleanup_threshold is 0.4. Is it possible you accidentally added a &apos;&amp;#45;&apos; prefix to the line in the config file? Unlikely, I know, but it would explain it instantly &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;
</comment>
                            <comment id="13909094" author="davychia" created="Sat, 22 Feb 2014 01:13:16 +0000"  >&lt;p&gt;aha! good call!&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeHeader panelHeader&quot; style=&quot;border-bottom-width: 1px;&quot;&gt;&lt;b&gt;src/java/org/apache/cassandra/utils/memory/Pool.java#needsCleaning&lt;/b&gt;&lt;/div&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;used(0) &amp;gt;= nextClean(-858993472) &amp;amp;&amp;amp; updateNextClean(&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;) &amp;amp;&amp;amp; cleanerThread(&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;) -- limit(-2147483648), cleanThreshold(0.400000)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;It seems to be working after:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeHeader panelHeader&quot; style=&quot;border-bottom-width: 1px;&quot;&gt;&lt;b&gt;src/java/org/apache/cassandra/config/DatabaseDescriptor.java:1385&lt;/b&gt;&lt;/div&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;(&lt;span class=&quot;code-object&quot;&gt;long&lt;/span&gt;) conf.memtable_total_space_in_mb &amp;lt;&amp;lt; 20
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;And failed with an exception (doh!)... but it is unrelated to this ticket.&lt;/p&gt;</comment>
                            <comment id="13909327" author="benedict" created="Sat, 22 Feb 2014 10:38:07 +0000"  >&lt;p&gt;Uploaded a simple patch to both correct the overflow and prevent provision of bad cleanup thresholds&lt;/p&gt;</comment>
                            <comment id="13909393" author="jbellis" created="Sat, 22 Feb 2014 14:24:47 +0000"  >&lt;p&gt;committed&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12630476" name="patch.txt" size="1895" author="benedict" created="Sat, 22 Feb 2014 10:38:07 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[benedict]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>375136</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            11 years, 39 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1sn87:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>375433</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12311421" key="com.atlassian.jira.plugin.system.customfieldtypes:multiversion">
                        <customfieldname>Reproduced In</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="12326275">2.1 beta1</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12962"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>