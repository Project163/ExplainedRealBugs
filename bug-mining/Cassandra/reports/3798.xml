<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 22:57:37 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-10220] Memtables do not handle column changes for their PartitionColumns</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-10220</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;There are a couple of inherited issues around the &lt;tt&gt;PartitionColumns&lt;/tt&gt; in &lt;tt&gt;AbstractBTreePartition&lt;/tt&gt;. Firstly, we do not always return these columns, but sometimes the metadata columns. Secondly, the columns cannot be updated with new columns, and the metadata columns will not show dropped columns. This should most likely be moved into the &lt;tt&gt;Holder&lt;/tt&gt;, and updated along with any other updates.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12859909">CASSANDRA-10220</key>
            <summary>Memtables do not handle column changes for their PartitionColumns</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10002" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Normal</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="slebresne">Sylvain Lebresne</assignee>
                                    <reporter username="benedict">Benedict Elliott Smith</reporter>
                        <labels>
                    </labels>
                <created>Fri, 28 Aug 2015 13:01:53 +0000</created>
                <updated>Tue, 16 Apr 2019 09:30:58 +0000</updated>
                            <resolved>Fri, 4 Sep 2015 13:49:45 +0000</resolved>
                                        <fixVersion>3.0.0 rc1</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                                                                <comments>
                            <comment id="14723516" author="jbellis" created="Mon, 31 Aug 2015 15:01:47 +0000"  >&lt;p&gt;Is this a correctness issue or just technical debt?&lt;/p&gt;</comment>
                            <comment id="14723520" author="benedict" created="Mon, 31 Aug 2015 15:03:45 +0000"  >&lt;p&gt;Correctness&lt;/p&gt;</comment>
                            <comment id="14729232" author="slebresne" created="Thu, 3 Sep 2015 15:19:07 +0000"  >&lt;p&gt;I&apos;m pretty certain &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-10169&quot; title=&quot;Test regression for consistency_test.TestAccuracy&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-10169&quot;&gt;&lt;del&gt;CASSANDRA-10169&lt;/del&gt;&lt;/a&gt; is a manifestation of this, and I&apos;m keen on getting that fix for beta2 so &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=benedict&quot; class=&quot;user-hover&quot; rel=&quot;benedict&quot;&gt;benedict&lt;/a&gt;, unless you&apos;ve already started working on this already, mind if I mark this a duplicate of &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-10169&quot; title=&quot;Test regression for consistency_test.TestAccuracy&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-10169&quot;&gt;&lt;del&gt;CASSANDRA-10169&lt;/del&gt;&lt;/a&gt; (or the other way around, whatever) and give it a quick shot?&lt;/p&gt;</comment>
                            <comment id="14729261" author="benedict" created="Thu, 3 Sep 2015 15:30:13 +0000"  >&lt;p&gt;I have a patch up &lt;a href=&quot;https://github.com/belliottsmith/cassandra/tree/10220&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;here&lt;/a&gt; but I haven&apos;t looked at it in a couple of days, nor checked cassci closely and compared with trunk. &lt;/p&gt;

&lt;p&gt;There is some delicacy with the fact that the &lt;tt&gt;holder()&lt;/tt&gt; requires &lt;tt&gt;build&lt;/tt&gt; to be called by the &lt;tt&gt;PartitionUpdate&lt;/tt&gt; before being returned, which breaks many users of it. For &lt;tt&gt;PartitionUpdate&lt;/tt&gt; I felt this might be easy to circumvent by just always returning &lt;tt&gt;metadata.partitionColumns()&lt;/tt&gt; but I haven&apos;t had time to properly think through the implications (but the patch I have up does this).&lt;/p&gt;

&lt;p&gt;You&apos;re more than welcome to adopt it, my version or not; if not, I&apos;ll take a look at finishing it up tomorrow.&lt;/p&gt;</comment>
                            <comment id="14729271" author="slebresne" created="Thu, 3 Sep 2015 15:35:01 +0000"  >&lt;p&gt;Ok, I can try to take your version and rebase/finish it.&lt;/p&gt;</comment>
                            <comment id="14730632" author="slebresne" created="Fri, 4 Sep 2015 10:41:03 +0000"  >&lt;p&gt;For info, I&apos;ve pushed a rebased version with 2 additional commits &lt;a href=&quot;https://github.com/pcmanus/cassandra/commits/10220&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;here&lt;/a&gt;. It does the following changes to the original branch:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;when calling &lt;tt&gt;AbstractBTreePartition.unfilteredIterator(ColumnFilter selection, ...)&lt;/tt&gt;, the resulting iterator &lt;tt&gt;columns()&lt;/tt&gt; was not returning the original partition columns, even though it was guaranteed to only contain columns from &lt;tt&gt;selection&lt;/tt&gt; and hence calls would expect the iterator &lt;tt&gt;columns()&lt;/tt&gt; method to return either &lt;tt&gt;selection.fetchedColumns()&lt;/tt&gt; or a subset of it, which wasn&apos;t the case. I&apos;ll note that I don&apos;t know if this was really manifesting as a bug, but I still think it&apos;s worth changing. Also, as I mention in the commit, the ideal would be to take the intersection of the the filter and the partition columns, but while that would be more precise, I don&apos;t think we rely enough on such precision that it&apos;s worth making that computation.&lt;/li&gt;
	&lt;li&gt;In &lt;tt&gt;AtomicBtreePartitions.addAllWithSizeDelta()&lt;/tt&gt;, the columns from the update were not merged with the existing ones, which I suspect was an oversight.&lt;/li&gt;
	&lt;li&gt;For &lt;tt&gt;PartitionUpdate&lt;/tt&gt;, the code actually passes the columns in the ctor (and we even validate any added row does only has columns from this set), so I think the right thing to do is just to return that and that&apos;s what the last commit does.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;I&apos;ll note that I appear to have been wrong about &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-10169&quot; title=&quot;Test regression for consistency_test.TestAccuracy&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-10169&quot;&gt;&lt;del&gt;CASSANDRA-10169&lt;/del&gt;&lt;/a&gt;, this doesn&apos;t seem to fix it. So I&apos;ll wait on CI to run on this branch before calling this &quot;ready for review&quot; and I&apos;ll continue looking at &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-10169&quot; title=&quot;Test regression for consistency_test.TestAccuracy&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-10169&quot;&gt;&lt;del&gt;CASSANDRA-10169&lt;/del&gt;&lt;/a&gt; in the meantime.&lt;/p&gt;</comment>
                            <comment id="14730653" author="benedict" created="Fri, 4 Sep 2015 11:04:25 +0000"  >&lt;p&gt;LGTM, so +1 assuming CI passes.&lt;/p&gt;</comment>
                            <comment id="14730844" author="slebresne" created="Fri, 4 Sep 2015 13:49:45 +0000"  >&lt;p&gt;Alright, cassci seems to be happy (there was one timeout during the unit test, but that test passed multiple time locally, though is a somewhat long test (for a unit test) so pretty sure this was just cassci being slow. ).&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12912276">CASSANDRA-10690</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[slebresne]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 11 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2jhyf:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>benedict</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[benedict]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12962"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>