<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 22:45:47 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-7318] Unable to truncate column family on node which has been decommissioned and re-bootstrapped</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-7318</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;After decommissioning a node, then re-bootstrapping it, it&apos;s not possible to truncate column families until cassandra is restarted.&lt;/p&gt;

&lt;p&gt;Steps to reproduce:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Start with a two node deployment (nodes A and B)&lt;/li&gt;
	&lt;li&gt;Run nodetool decommission on node B&lt;/li&gt;
	&lt;li&gt;Stop cassandra on node B&lt;/li&gt;
	&lt;li&gt;Delete the contents of the cassandra data and commitlog directories&lt;/li&gt;
	&lt;li&gt;Start cassandra on node B with node A as the seed&lt;/li&gt;
	&lt;li&gt;Run cqlsh on node B and try to truncate a column family&lt;/li&gt;
	&lt;li&gt;cqlsh displays: &quot;Unable to complete request: one or more nodes were unavailable.&quot;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;According to the logs node B seems to think that itself is down.  The follow logs appear when the server is started and there are no further logs to indicate the B is now UP (A=10.225.45.150, B=10.225.45.151):&lt;/p&gt;

&lt;p&gt; INFO &lt;span class=&quot;error&quot;&gt;&amp;#91;main&amp;#93;&lt;/span&gt; 2014-05-29 10:40:11,090 MessagingService.java (line 461) Starting Messaging Service on port 7000&lt;br/&gt;
 INFO &lt;span class=&quot;error&quot;&gt;&amp;#91;HANDSHAKE-/10.225.45.150&amp;#93;&lt;/span&gt; 2014-05-29 10:40:11,106 OutboundTcpConnection.java (line 386) Handshaking version with /10.225.45.150&lt;br/&gt;
 INFO &lt;span class=&quot;error&quot;&gt;&amp;#91;GossipStage:1&amp;#93;&lt;/span&gt; 2014-05-29 10:40:11,182 Gossiper.java (line 903) Node /10.225.45.150 is now part of the cluster&lt;br/&gt;
 INFO &lt;span class=&quot;error&quot;&gt;&amp;#91;GossipStage:1&amp;#93;&lt;/span&gt; 2014-05-29 10:40:11,185 Gossiper.java (line 883) InetAddress /10.225.45.151 is now DOWN&lt;br/&gt;
 INFO &lt;span class=&quot;error&quot;&gt;&amp;#91;RequestResponseStage:1&amp;#93;&lt;/span&gt; 2014-05-29 10:40:11,215 Gossiper.java (line 869) InetAddress /10.225.45.150 is now UP&lt;/p&gt;

&lt;p&gt;This problem isn&apos;t hit if cassandra is restarted on node A while node B is stopped.  The problem goes away if node B is restarted.&lt;/p&gt;</description>
                <environment>&lt;p&gt;Seen running cassandra 2.0.7 running on Red Hat Linux&lt;/p&gt;</environment>
        <key id="12717253">CASSANDRA-7318</key>
            <summary>Unable to truncate column family on node which has been decommissioned and re-bootstrapped</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10003" iconUrl="https://issues.apache.org/jira/images/icons/priorities/trivial.svg">Low</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="brandon.williams">Brandon Williams</assignee>
                                    <reporter username="thomaswhiteway">Thomas Whiteway</reporter>
                        <labels>
                            <label>qa-resolved</label>
                    </labels>
                <created>Thu, 29 May 2014 10:48:33 +0000</created>
                <updated>Tue, 16 Apr 2019 09:31:44 +0000</updated>
                            <resolved>Wed, 18 Jun 2014 19:10:21 +0000</resolved>
                                        <fixVersion>1.2.17</fixVersion>
                    <fixVersion>2.0.9</fixVersion>
                    <fixVersion>2.1 rc2</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="14017186" author="jbellis" created="Tue, 3 Jun 2014 21:40:07 +0000"  >&lt;p&gt;Can you reproduce, Michael?&lt;/p&gt;</comment>
                            <comment id="14033073" author="kishkaru" created="Mon, 16 Jun 2014 22:01:25 +0000"  >&lt;p&gt;Reproduced on 2.0.7 running on Ubuntu.&lt;br/&gt;
Also confirmed that: &lt;br/&gt;
1) If Cassandra is restarted on A while B is stopped, and then B is brought back online and bootstrapped, problem isn&apos;t seen.&lt;br/&gt;
2) If Cassandra is restarted on B after being bootstrapped, problem isn&apos;t seen.&lt;/p&gt;</comment>
                            <comment id="14033133" author="brandon.williams" created="Mon, 16 Jun 2014 22:46:14 +0000"  >&lt;p&gt;Can you test on 2.0 head and get the output from gossipinfo with the gen/timestamp info from &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-7333&quot; title=&quot;gossipinfo should include the generation&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-7333&quot;&gt;&lt;del&gt;CASSANDRA-7333&lt;/del&gt;&lt;/a&gt;?&lt;/p&gt;</comment>
                            <comment id="14033161" author="kishkaru" created="Mon, 16 Jun 2014 23:16:00 +0000"  >&lt;p&gt;Reproduced on 2.0 head (2.0.8-SNAPSHOT)&lt;br/&gt;
Output from gossipinfo:&lt;/p&gt;

&lt;p&gt;/10.240.78.13&lt;br/&gt;
  generation:1402959702&lt;br/&gt;
  heartbeat:2212&lt;br/&gt;
  LOAD:62059.0&lt;br/&gt;
  STATUS:NORMAL,-9223372036854775808&lt;br/&gt;
  SCHEMA:302e036e-8cfc-3d91-b9c1-16f226e2f19b&lt;br/&gt;
  RACK:rack1&lt;br/&gt;
  SEVERITY:0.0&lt;br/&gt;
  HOST_ID:f60de575-4300-484f-85e0-801d8c5d7945&lt;br/&gt;
  NET_VERSION:7&lt;br/&gt;
  RPC_ADDRESS:0.0.0.0&lt;br/&gt;
  DC:datacenter1&lt;br/&gt;
  RELEASE_VERSION:2.0.8-SNAPSHOT&lt;br/&gt;
/10.240.169.242&lt;br/&gt;
  generation:1402960280&lt;br/&gt;
  heartbeat:456&lt;br/&gt;
  LOAD:97239.0&lt;br/&gt;
  STATUS:NORMAL,0&lt;br/&gt;
  SCHEMA:302e036e-8cfc-3d91-b9c1-16f226e2f19b&lt;br/&gt;
  RACK:rack1&lt;br/&gt;
  SEVERITY:0.0&lt;br/&gt;
  HOST_ID:93467f7f-3ae3-444d-a40a-0807a9e8eff9&lt;br/&gt;
  NET_VERSION:7&lt;br/&gt;
  RPC_ADDRESS:0.0.0.0&lt;br/&gt;
  DC:datacenter1&lt;/p&gt;</comment>
                            <comment id="14033184" author="brandon.williams" created="Mon, 16 Jun 2014 23:35:21 +0000"  >&lt;p&gt;Which one is the problem node, and does the heartbeat increase?&lt;/p&gt;</comment>
                            <comment id="14033201" author="kishkaru" created="Mon, 16 Jun 2014 23:53:19 +0000"  >&lt;p&gt;Node &quot;B&quot; in this case, is /10.240.169.242/. Heartbeat does increase.&lt;/p&gt;</comment>
                            <comment id="14034517" author="brandon.williams" created="Tue, 17 Jun 2014 22:37:15 +0000"  >&lt;p&gt;The problem here is that there is a dead state for our ip in gossip from the decommission.  Normally, this isn&apos;t a problem since our generation would be newer and knock that state out, except during bootstrap we do a shadow round to check for an existing endpoint, then fail to clean unreachable endpoints which is what truncate is checking.  I suspect there would be a similar problem with replace_address on the same ip.&lt;/p&gt;

&lt;p&gt;Patch to also clear unreachableEndpoints and liveEndpoints so that the gossiper is more pristine when it really start.s&lt;/p&gt;</comment>
                            <comment id="14036150" author="thobbs" created="Wed, 18 Jun 2014 18:52:32 +0000"  >&lt;p&gt;+1&lt;/p&gt;</comment>
                            <comment id="14036191" author="brandon.williams" created="Wed, 18 Jun 2014 19:10:21 +0000"  >&lt;p&gt;Committed.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12650911" name="7318.txt" size="582" author="brandon.williams" created="Tue, 17 Jun 2014 22:37:14 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[brandon.williams]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>395457</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            11 years, 22 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1w347:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>395585</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12311421" key="com.atlassian.jira.plugin.system.customfieldtypes:multiversion">
                        <customfieldname>Reproduced In</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="12326707">1.2.17</customfieldvalue>
    <customfieldvalue id="12326472">2.0.7</customfieldvalue>
    <customfieldvalue id="12327111">2.1 rc2</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>thobbs</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[thobbs]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12961"><![CDATA[Low]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311124" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Tester</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>kishkaru</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>