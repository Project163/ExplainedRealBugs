<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 22:40:12 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-5910] Most CQL3 functions should handle null gracefully</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-5910</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;Currently, we don&apos;t allow null parameters for functions. So&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;UPDATE test SET d=dateOf(null) WHERE k=0
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;is basically an invalid query. Unfortunately, there&apos;s at least one case where we don&apos;t validate correctly, namely if we do:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;SELECT k, dateOf(t) FROM test
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;In that case, if for any of the row &lt;tt&gt;t&lt;/tt&gt; is null, we end up with a server side NPE. But more importantly, throwing an InvalidException in that case would be pretty inconvenient and actually somewhat wrong since the query is not invalid in itself. So, at least in that latter case, we want &lt;tt&gt;dateOf(t) == null&lt;/tt&gt; when &lt;tt&gt;t == null&lt;/tt&gt;. And if we do that, I suggest making it always the case (i.e. make the first query valid but assigning &lt;tt&gt;null&lt;/tt&gt; to &lt;tt&gt;d&lt;/tt&gt;).&lt;/p&gt;</description>
                <environment></environment>
        <key id="12664835">CASSANDRA-5910</key>
            <summary>Most CQL3 functions should handle null gracefully</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10003" iconUrl="https://issues.apache.org/jira/images/icons/priorities/trivial.svg">Low</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="slebresne">Sylvain Lebresne</assignee>
                                    <reporter username="slebresne">Sylvain Lebresne</reporter>
                        <labels>
                    </labels>
                <created>Wed, 21 Aug 2013 13:21:14 +0000</created>
                <updated>Tue, 16 Apr 2019 09:32:07 +0000</updated>
                            <resolved>Wed, 11 Sep 2013 06:32:30 +0000</resolved>
                                        <fixVersion>1.2.10</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="13746036" author="slebresne" created="Wed, 21 Aug 2013 13:29:24 +0000"  >&lt;p&gt;Attaching simple patch for this. I&apos;ll note that because of multi-parameters functions (and because a future function may not want to return null when passed null as argument), I think it should be each function job to handle null the way it makes the most sense. That being said, outside of token() that refuse null competely, the patch makes all our currently existing function return null on null.&lt;/p&gt;</comment>
                            <comment id="13746044" author="jbellis" created="Wed, 21 Aug 2013 13:46:51 +0000"  >&lt;p&gt;I don&apos;t think turning RTE into IRE is correct &amp;#8211; if it passes validation, it should execute, and if it doesn&apos;t, it&apos;s a bug and not an invalid request.&lt;/p&gt;

&lt;p&gt;Where does this leave varcharasblob?  (Wish we&apos;d gone with textasblob, FTR.)&lt;/p&gt;</comment>
                            <comment id="13746085" author="slebresne" created="Wed, 21 Aug 2013 14:43:08 +0000"  >&lt;blockquote&gt;&lt;p&gt;I don&apos;t think turning RTE into IRE is correct&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I don&apos;t really disagree and those catch all could probably be removed. The motivation was that if the execution of a function triggers an unexpected exception, then we send it back to the user instead of &quot;crashing&quot; server side, but as long as we don&apos;t have user custom function, an unexpected exception in a function is a bug so it&apos;s probably fine to throw server side. And I agree IRE is a bad exception anyway, we just don&apos;t have anything better so far.&lt;/p&gt;

&lt;p&gt;But the bigger problem is that we have functions (in the selection of a SELECT) that take their input at execution time. So I don&apos;t fully agree with &quot;if it passes validation, it should execute, and if it doesn&apos;t, it&apos;s a bug&quot; as that would mean we limit ourselves to functions that can never error out but that&apos;s going to be pretty limiting. We already have the token() method for which it&apos;s very unclear how to deal with null. We could return null on a null parameter, but if we have a composite partition key (in which case token() is a multi-parameter function), what to do when only one argument is null and not the other? Of course we could still return null in that case, but it feels wrong to silent what is essentially an error. Or to take another example, what do we do about division by 0 if we add a division function tomorrow?&lt;/p&gt;

&lt;p&gt;My hunch is that we need a new ExecutionException, though unfortunately it&apos;s not that easy to add new exceptions (rather, there is backward compatibility concerns).&lt;/p&gt;

&lt;p&gt;To be clear, we can probably find a simple hack for now, making token() return null as soon as any of its parameter is null is, while not perfect, probably good enough for now. But it&apos;s probably worth having a longer term plan.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;Where does this leave varcharasblob?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;varcharasblob (and all the asBlob functions for that matter) execute method just return it&apos;s argument without any processing (it&apos;s really just a way to make the CQL type system happy, since internally everything is already bytes anyway), so if said argument is null, it will return null.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;Wish we&apos;d gone with textasblob&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;We have it too, we have both. We have one XasBlob and one blobAsX for every CQL3 type. The only reason varchar is a special case in ByteConversionFcts is that the makeToBlobFunction method wouldn&apos;t generate it.&lt;/p&gt;</comment>
                            <comment id="13750618" author="jbellis" created="Mon, 26 Aug 2013 22:05:15 +0000"  >&lt;p&gt;So how about we drop the RTE-&amp;gt;IRE conversion for now and we can look at adding an ExecutionException around when we add more problematic functions/operators and/or UDF?&lt;/p&gt;</comment>
                            <comment id="13763022" author="slebresne" created="Tue, 10 Sep 2013 13:10:12 +0000"  >&lt;p&gt;Sounds good to me. Attaching v2 that just makes all existing function handle null correctly (token() will return null as soon as any one of its argument is null). We can see later for what we do when returning null doesn&apos;t fly anymore.&lt;/p&gt;</comment>
                            <comment id="13763139" author="iamaleksey" created="Tue, 10 Sep 2013 15:49:05 +0000"  >&lt;p&gt;+1&lt;/p&gt;</comment>
                            <comment id="13764049" author="slebresne" created="Wed, 11 Sep 2013 06:32:30 +0000"  >&lt;p&gt;Committed, thanks&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12602331" name="5910-v2.txt" size="3563" author="slebresne" created="Tue, 10 Sep 2013 13:10:12 +0000"/>
                            <attachment id="12599187" name="5910.txt" size="5406" author="slebresne" created="Wed, 21 Aug 2013 13:23:54 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[slebresne]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>344778</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            12 years, 10 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1ngfj:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>345078</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>aleksey</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[aleksey]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12961"><![CDATA[Low]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>