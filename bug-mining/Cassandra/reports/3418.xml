<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 22:51:23 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-8786] NullPointerException in ColumnDefinition.hasIndexOption</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-8786</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;We have a Cassandra cluster that we&apos;ve been using through many upgrades, and thus most of our column families have originally been created by Thrift. We are on Cassandra 2.1.2 now.&lt;br/&gt;
We&apos;ve now ported most of our code to use CQL, and our code occasionally tries to recreate tables with &quot;IF NOT EXISTS&quot; to work properly on development / testing environments.&lt;br/&gt;
When we issue the CQL statement &quot;CREATE INDEX IF NOT EXISTS index ON &quot;tableName&quot; (accountId)&quot; (this index does exist on that table already), we get a &lt;tt&gt;DriverInternalError: An unexpected error occurred server side on cass_host/xx.xxx.xxx.xxx:9042: java.lang.NullPointerException&lt;/tt&gt;&lt;/p&gt;

&lt;p&gt;The error on the server is:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt; java.lang.NullPointerException: null
        at org.apache.cassandra.config.ColumnDefinition.hasIndexOption(ColumnDefinition.java:489) ~[apache-cassandra-2.1.2.jar:2.1.2]
        at org.apache.cassandra.cql3.statements.CreateIndexStatement.validate(CreateIndexStatement.java:87) ~[apache-cassandra-2.1.2.jar:2.1.2]
        at org.apache.cassandra.cql3.QueryProcessor.processStatement(QueryProcessor.java:224) ~[apache-cassandra-2.1.2.jar:2.1.2]
        at org.apache.cassandra.cql3.QueryProcessor.process(QueryProcessor.java:248) ~[apache-cassandra-2.1.2.jar:2.1.2]
        at org.apache.cassandra.transport.messages.QueryMessage.execute(QueryMessage.java:119) ~[apache-cassandra-2.1.2.jar:2.1.2]
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;This happens every time we run this CQL statement. We&apos;ve tried to reproduce it in a test cassandra cluster by creating the table according to the exact &quot;DESCRIBE TABLE&quot; specification, but then this NullPointerException doesn&apos;t happon upon the CREATE INDEX one. So it seems that the tables on our production cluster (that were originally created through thrift) are still subtly different schema-wise then a freshly created table according to the same creation statement.&lt;/p&gt;
</description>
                <environment>&lt;p&gt;Cassandra 2.1.2&lt;/p&gt;</environment>
        <key id="12774241">CASSANDRA-8786</key>
            <summary>NullPointerException in ColumnDefinition.hasIndexOption</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10002" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Normal</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="aleksey">Aleksey Yeschenko</assignee>
                                    <reporter username="mathijs">Mathijs Vogelzang</reporter>
                        <labels>
                    </labels>
                <created>Wed, 11 Feb 2015 15:51:14 +0000</created>
                <updated>Tue, 16 Apr 2019 09:31:21 +0000</updated>
                            <resolved>Tue, 10 Mar 2015 21:03:26 +0000</resolved>
                                        <fixVersion>2.1.5</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="14318402" author="philipthompson" created="Thu, 12 Feb 2015 15:30:24 +0000"  >&lt;p&gt;What version were the tables created with? When failing to reproduce, are you trying to create the tables via cassandra-cli or cqlsh?&lt;/p&gt;</comment>
                            <comment id="14318416" author="mathijs" created="Thu, 12 Feb 2015 15:48:16 +0000"  >&lt;p&gt;The tables were probably originally created on version 1.x&lt;br/&gt;
We&apos;ve only tried with cqlsh.&lt;br/&gt;
I&apos;ve just done a &quot;DESCRIBE&quot; in cassandra-cli on our production table and the new one and the most suspicious difference is that on the production (non-working) table, one column name is listed like this:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;(...)
  Column Name: account_id
          Validation Class: org.apache.cassandra.db.marshal.LongType
          Index Name: idx_accid
          Index Type: KEYS
  Column Name:  next_column_name
(...)&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;and on the newly created development table (the one without problems) it is&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;(...)
 Column Name: account_id
          Validation Class: org.apache.cassandra.db.marshal.LongType
          Index Name: idx_accid
          Index Type: KEYS
          Index Options: {}
  Column Name:  next_column_name
(...)&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;(Other minor differences are speculative retry NONE vs 99.0PERCENTILE, Read repair chance 0 vs 1 and Bloom filter FP chance default vs. 0.01, but the &quot;Index Options&quot; seems closer to where the problem probably lies to me)&lt;/p&gt;</comment>
                            <comment id="14318424" author="philipthompson" created="Thu, 12 Feb 2015 15:53:10 +0000"  >&lt;p&gt;Seems like an upgrade issue on tables created via thrift then.&lt;/p&gt;</comment>
                            <comment id="14328603" author="iamaleksey" created="Fri, 20 Feb 2015 06:10:23 +0000"  >&lt;p&gt;Indexes on maps broke it, kind of.&lt;/p&gt;

&lt;p&gt;Should check isMap first before fetching cd.hasIndexOption(SecondaryIndex.INDEX_KEYS_OPTION_NAME)&lt;/p&gt;

&lt;p&gt;Attaching a trivial patch that makes ColumnDefinition#hasIndexOption() less fragile instead.&lt;/p&gt;</comment>
                            <comment id="14329203" author="thobbs" created="Fri, 20 Feb 2015 17:20:33 +0000"  >&lt;p&gt;How difficult would it be to write a dtest or unit test for this?&lt;/p&gt;</comment>
                            <comment id="14329213" author="philipthompson" created="Fri, 20 Feb 2015 17:25:30 +0000"  >&lt;p&gt;I&apos;ll defer to &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=iamaleksey&quot; class=&quot;user-hover&quot; rel=&quot;iamaleksey&quot;&gt;iamaleksey&lt;/a&gt; here. I wasn&apos;t able to reproduce.&lt;/p&gt;</comment>
                            <comment id="14329480" author="iamaleksey" created="Fri, 20 Feb 2015 20:12:27 +0000"  >&lt;p&gt;Non-trivial to create a meaningful one, most definitely not worth the effort to add a test for just this particular case.&lt;/p&gt;

&lt;p&gt;That said, having a new set of upgrade tests focused on schema manipulations after each upgrade would probably be a good idea.&lt;/p&gt;</comment>
                            <comment id="14329491" author="thobbs" created="Fri, 20 Feb 2015 20:20:39 +0000"  >&lt;p&gt;Yeah, I&apos;m not too concerned with testing this particular case, but testing lots of cases similar to this.  Can you help &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=philipthompson&quot; class=&quot;user-hover&quot; rel=&quot;philipthompson&quot;&gt;philipthompson&lt;/a&gt; reproduce and we can start another ticket for working on the test cases?&lt;/p&gt;</comment>
                            <comment id="14329495" author="iamaleksey" created="Fri, 20 Feb 2015 20:22:06 +0000"  >&lt;p&gt;Absolutely.&lt;/p&gt;</comment>
                            <comment id="14355451" author="thobbs" created="Tue, 10 Mar 2015 18:47:23 +0000"  >&lt;p&gt;Okay, I&apos;ve created &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-8941&quot; title=&quot;Test Coverage for CASSANDRA-8786&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-8941&quot;&gt;CASSANDRA-8941&lt;/a&gt; for the tests.&lt;/p&gt;

&lt;p&gt;+1 on the patch.&lt;/p&gt;</comment>
                            <comment id="14355708" author="iamaleksey" created="Tue, 10 Mar 2015 21:03:26 +0000"  >&lt;p&gt;Committed, thanks.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310010">
                    <name>Incorporates</name>
                                            <outwardlinks description="incorporates">
                                        <issuelink>
            <issuekey id="12780943">CASSANDRA-8941</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12699818" name="8786.txt" size="565" author="aleksey" created="Fri, 20 Feb 2015 06:07:25 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[aleksey]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 37 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i25hlj:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12311421" key="com.atlassian.jira.plugin.system.customfieldtypes:multiversion">
                        <customfieldname>Reproduced In</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="12328841">2.1.2</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>thobbs</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[thobbs]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12962"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>