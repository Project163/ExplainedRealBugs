<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 22:20:29 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-2371] Removed/Dead Node keeps reappearing</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-2371</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;The removetoken option does not seem to work. The original node 10.240.50.63 comes back into the ring, even after the EC2 instance is no longer in existence. Originally I tried to add a new node 10.214.103.224 with the same token, but there were some complications with that. I have pasted below all the INFO log entries found with greping the system log files.&lt;/p&gt;

&lt;p&gt;Seems to be a similar issue seen with &lt;a href=&quot;http://cassandra-user-incubator-apache-org.3065146.n2.nabble.com/Ghost-node-showing-up-in-the-ring-td6198180.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://cassandra-user-incubator-apache-org.3065146.n2.nabble.com/Ghost-node-showing-up-in-the-ring-td6198180.html&lt;/a&gt; &lt;/p&gt;

&lt;p&gt;INFO &lt;span class=&quot;error&quot;&gt;&amp;#91;GossipStage:1&amp;#93;&lt;/span&gt; 2011-03-16 00:54:31,590 StorageService.java (line 745) Nodes /10.214.103.224 and /10.240.50.63 have the same token 95704415696513900000000000000000000000.  /10.214.103.224 is the new owner&lt;br/&gt;
 INFO &lt;span class=&quot;error&quot;&gt;&amp;#91;GossipStage:1&amp;#93;&lt;/span&gt; 2011-03-16 17:26:51,083 StorageService.java (line 865) Removing token 95704415696513900000000000000000000000 for /10.214.103.224&lt;br/&gt;
 INFO &lt;span class=&quot;error&quot;&gt;&amp;#91;GossipStage:1&amp;#93;&lt;/span&gt; 2011-03-19 17:27:24,767 StorageService.java (line 865) Removing token 95704415696513900000000000000000000000 for /10.214.103.224&lt;br/&gt;
 INFO &lt;span class=&quot;error&quot;&gt;&amp;#91;GossipStage:1&amp;#93;&lt;/span&gt; 2011-03-19 17:29:30,191 StorageService.java (line 865) Removing token 95704415696513900000000000000000000000 for /10.214.103.224&lt;br/&gt;
 INFO &lt;span class=&quot;error&quot;&gt;&amp;#91;GossipStage:1&amp;#93;&lt;/span&gt; 2011-03-19 17:31:35,609 StorageService.java (line 865) Removing token 95704415696513900000000000000000000000 for /10.214.103.224&lt;br/&gt;
 INFO &lt;span class=&quot;error&quot;&gt;&amp;#91;GossipStage:1&amp;#93;&lt;/span&gt; 2011-03-19 17:33:39,440 StorageService.java (line 865) Removing token 95704415696513900000000000000000000000 for /10.214.103.224&lt;br/&gt;
 INFO &lt;span class=&quot;error&quot;&gt;&amp;#91;GossipStage:1&amp;#93;&lt;/span&gt; 2011-03-23 17:22:55,520 StorageService.java (line 865) Removing token 95704415696513900000000000000000000000 for /10.240.50.63&lt;/p&gt;


&lt;p&gt; INFO &lt;span class=&quot;error&quot;&gt;&amp;#91;GossipStage:1&amp;#93;&lt;/span&gt; 2011-03-10 03:52:37,299 Gossiper.java (line 608) Node /10.240.50.63 is now part of the cluster&lt;br/&gt;
 INFO &lt;span class=&quot;error&quot;&gt;&amp;#91;GossipStage:1&amp;#93;&lt;/span&gt; 2011-03-10 03:52:37,545 Gossiper.java (line 600) InetAddress /10.240.50.63 is now UP&lt;br/&gt;
 INFO &lt;span class=&quot;error&quot;&gt;&amp;#91;HintedHandoff:1&amp;#93;&lt;/span&gt; 2011-03-10 03:53:36,168 HintedHandOffManager.java (line 304) Started hinted handoff for endpoint /10.240.50.63&lt;br/&gt;
 INFO &lt;span class=&quot;error&quot;&gt;&amp;#91;HintedHandoff:1&amp;#93;&lt;/span&gt; 2011-03-10 03:53:36,169 HintedHandOffManager.java (line 360) Finished hinted handoff of 0 rows to endpoint /10.240.50.63&lt;br/&gt;
 INFO &lt;span class=&quot;error&quot;&gt;&amp;#91;GossipStage:1&amp;#93;&lt;/span&gt; 2011-03-15 23:23:43,770 Gossiper.java (line 623) Node /10.240.50.63 has restarted, now UP again&lt;br/&gt;
 INFO &lt;span class=&quot;error&quot;&gt;&amp;#91;GossipStage:1&amp;#93;&lt;/span&gt; 2011-03-15 23:23:43,771 StorageService.java (line 726) Node /10.240.50.63 state jump to normal&lt;br/&gt;
 INFO &lt;span class=&quot;error&quot;&gt;&amp;#91;HintedHandoff:1&amp;#93;&lt;/span&gt; 2011-03-15 23:28:48,957 HintedHandOffManager.java (line 304) Started hinted handoff for endpoint /10.240.50.63&lt;br/&gt;
 INFO &lt;span class=&quot;error&quot;&gt;&amp;#91;HintedHandoff:1&amp;#93;&lt;/span&gt; 2011-03-15 23:28:48,958 HintedHandOffManager.java (line 360) Finished hinted handoff of 0 rows to endpoint /10.240.50.63&lt;br/&gt;
 INFO &lt;span class=&quot;error&quot;&gt;&amp;#91;ScheduledTasks:1&amp;#93;&lt;/span&gt; 2011-03-15 23:37:25,071 Gossiper.java (line 226) InetAddress /10.240.50.63 is now dead.&lt;br/&gt;
 INFO &lt;span class=&quot;error&quot;&gt;&amp;#91;GossipStage:1&amp;#93;&lt;/span&gt; 2011-03-16 00:54:31,590 StorageService.java (line 745) Nodes /10.214.103.224 and /10.240.50.63 have the same token 95704415696513900000000000000000000000.  /10.214.103.224 is the new owner&lt;br/&gt;
 WARN &lt;span class=&quot;error&quot;&gt;&amp;#91;GossipStage:1&amp;#93;&lt;/span&gt; 2011-03-16 00:54:31,590 TokenMetadata.java (line 115) Token 95704415696513900000000000000000000000 changing ownership from /10.240.50.63 to /10.214.103.224&lt;br/&gt;
 INFO &lt;span class=&quot;error&quot;&gt;&amp;#91;GossipStage:1&amp;#93;&lt;/span&gt; 2011-03-18 23:37:09,158 Gossiper.java (line 610) Node /10.240.50.63 is now part of the cluster&lt;br/&gt;
 INFO &lt;span class=&quot;error&quot;&gt;&amp;#91;GossipStage:1&amp;#93;&lt;/span&gt; 2011-03-21 23:37:10,421 Gossiper.java (line 610) Node /10.240.50.63 is now part of the cluster&lt;br/&gt;
 INFO &lt;span class=&quot;error&quot;&gt;&amp;#91;GossipStage:1&amp;#93;&lt;/span&gt; 2011-03-21 23:37:10,421 StorageService.java (line 726) Node /10.240.50.63 state jump to normal&lt;br/&gt;
 INFO &lt;span class=&quot;error&quot;&gt;&amp;#91;GossipStage:1&amp;#93;&lt;/span&gt; 2011-03-23 17:22:55,520 StorageService.java (line 865) Removing token 95704415696513900000000000000000000000 for /10.240.50.63&lt;br/&gt;
 INFO &lt;span class=&quot;error&quot;&gt;&amp;#91;ScheduledTasks:1&amp;#93;&lt;/span&gt; 2011-03-23 17:22:55,521 HintedHandOffManager.java (line 210) Deleting any stored hints for 10.240.50.63&lt;/p&gt;</description>
                <environment>&lt;p&gt;Large Amazon EC2 instances. Ubuntu 10.04.2 &lt;/p&gt;</environment>
        <key id="12502232">CASSANDRA-2371</key>
            <summary>Removed/Dead Node keeps reappearing</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10003" iconUrl="https://issues.apache.org/jira/images/icons/priorities/trivial.svg">Low</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="brandon.williams">Brandon Williams</assignee>
                                    <reporter username="acctech">techlabs</reporter>
                        <labels>
                    </labels>
                <created>Wed, 23 Mar 2011 22:03:42 +0000</created>
                <updated>Tue, 16 Apr 2019 09:33:03 +0000</updated>
                            <resolved>Mon, 18 Apr 2011 18:59:23 +0000</resolved>
                                        <fixVersion>0.7.5</fixVersion>
                                    <component>Legacy/Tools</component>
                        <due></due>
                            <votes>2</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="13010502" author="brandon.williams" created="Wed, 23 Mar 2011 22:43:23 +0000"  >&lt;p&gt;My guess is what is happening is that after aVeryLongTime when the state is evicted, another gossip round occurs and the state is repopulated.  Patch to re-quarantine on eviction to avoid this.&lt;/p&gt;</comment>
                            <comment id="13010519" author="acctech" created="Wed, 23 Mar 2011 23:30:13 +0000"  >&lt;p&gt;This looks like it&apos;s changing the source code. Can we deploy this on a live cluster? &lt;/p&gt;</comment>
                            <comment id="13014389" author="jbellis" created="Fri, 1 Apr 2011 04:09:28 +0000"  >&lt;p&gt;Did you get a chance to try a patched build?&lt;/p&gt;</comment>
                            <comment id="13014736" author="acctech" created="Fri, 1 Apr 2011 16:48:20 +0000"  >&lt;p&gt;Actually the issue was resolved when we did a restart of the cluster, and ran the nodetool removetoken command when only a portion of the nodes had started up. The main reason I didn&apos;t apply the patch yet, is merely because I need to learn how to patch the code and integrate the new build first... Thank you!&lt;/p&gt;</comment>
                            <comment id="13016627" author="brandon.williams" created="Thu, 7 Apr 2011 00:05:22 +0000"  >&lt;p&gt;There is a second problem here.  We don&apos;t populate the gossiper&apos;s application state to LEFT for removetoken, only for decommission.  The problem with adding it, however, is that SS.handleStateLeft gets called every gossip round and runs through the hint removal process.  One option may be to check if the node is locally persisted and if not, just ignore the message since we never knew about it anyway.  Another is to just not remove hints when we see the LEFT state, because they&apos;ll expire anyway and large unaccessed rows aren&apos;t a problem, so this seems like a throwback from the &amp;lt;=0.6 days.&lt;/p&gt;</comment>
                            <comment id="13018057" author="jeromatron" created="Sun, 10 Apr 2011 09:03:30 +0000"  >&lt;p&gt;I applied the patch and within a few days even with no restarting of any of the Cassandra nodes, the removed token came back. Just FYI.&lt;/p&gt;</comment>
                            <comment id="13018412" author="jbellis" created="Mon, 11 Apr 2011 16:11:27 +0000"  >&lt;blockquote&gt;&lt;p&gt;The problem with adding it, however, is that SS.handleStateLeft gets called every gossip round and runs through the hint removal process&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;But it only runs hint removal once per node, right?  Or is &quot;onChange&quot; not an accurate method name?&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;One option may be to check if the node is locally persisted and if not, just ignore the message since we never knew about it anyway.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Locally persisted... with a token in SystemTable?  Ignore the ... hint message?&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;Another is to just not remove hints when we see the LEFT state&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;We should issue a delete to the hints row, but we should not force a major compaction. The rule of thumb is, avoiding inflicting a performance hit on the cluster trumps immediate disk space cleanup.&lt;/p&gt;</comment>
                            <comment id="13020080" author="brandon.williams" created="Thu, 14 Apr 2011 22:55:44 +0000"  >&lt;p&gt;It looks like the bad news here is that gossip makes many assumptions about a node being alive when it hears about it, and has no provisions for keeping removed node state.  This is bad, but highly exacerbated by keeping the removed node state for 3 days instead of 30s.  I think the best solution right now is to revert &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-2115&quot; title=&quot;Keep endpoint state until aVeryLongTime&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-2115&quot;&gt;&lt;del&gt;CASSANDRA-2115&lt;/del&gt;&lt;/a&gt; until we can overhaul gossip to handle this.  The bug will still exist as it always has, but the window to trigger it is far shorter.&lt;/p&gt;</comment>
                            <comment id="13020136" author="jbellis" created="Fri, 15 Apr 2011 00:50:16 +0000"  >&lt;p&gt;Sounds reasonable.&lt;/p&gt;</comment>
                            <comment id="13021179" author="brandon.williams" created="Mon, 18 Apr 2011 18:59:23 +0000"  >&lt;p&gt;Reverted &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-2115&quot; title=&quot;Keep endpoint state until aVeryLongTime&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-2115&quot;&gt;&lt;del&gt;CASSANDRA-2115&lt;/del&gt;&lt;/a&gt; and created &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-2496&quot; title=&quot;Gossip should handle &amp;#39;dead&amp;#39; states&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-2496&quot;&gt;&lt;del&gt;CASSANDRA-2496&lt;/del&gt;&lt;/a&gt; to fix this correctly.&lt;/p&gt;</comment>
                            <comment id="13021204" author="hudson" created="Mon, 18 Apr 2011 19:43:59 +0000"  >&lt;p&gt;Integrated in Cassandra-0.7 #440 (See &lt;a href=&quot;https://hudson.apache.org/hudson/job/Cassandra-0.7/440/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://hudson.apache.org/hudson/job/Cassandra-0.7/440/&lt;/a&gt;)&lt;br/&gt;
    Revert &quot;Keep endpoint state until aVeryLongTime when not a fat client&quot;&lt;/p&gt;

&lt;p&gt;This reverts commit db9164ffd96ebc7752fc5789c90c7211ba323ad2.&lt;/p&gt;

&lt;p&gt;For &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-2371&quot; title=&quot;Removed/Dead Node keeps reappearing&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-2371&quot;&gt;&lt;del&gt;CASSANDRA-2371&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12474449" name="2371.txt" size="712" author="brandon.williams" created="Wed, 23 Mar 2011 22:43:23 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[brandon.williams]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>20586</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            14 years, 32 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0gazr:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>93211</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12961"><![CDATA[Low]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>