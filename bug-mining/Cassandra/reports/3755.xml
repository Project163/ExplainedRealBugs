<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 22:56:36 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-9111] SSTables originated from the same incremental repair session have different repairedAt timestamps</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-9111</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-7168&quot; title=&quot;Add repair aware consistency levels&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-7168&quot;&gt;CASSANDRA-7168&lt;/a&gt; optimizes QUORUM reads by skipping incrementally repaired SSTables on other replicas that were repaired on or before the maximum repairedAt timestamp of the coordinating replica&apos;s SSTables for the query partition.&lt;/p&gt;

&lt;p&gt;One assumption of that optimization is that SSTables originated from the same repair session in different nodes will have the same repairedAt timestamp, since the objective is to skip reading SSTables originated in the same repair session (or before).&lt;/p&gt;

&lt;p&gt;However, currently, each node timestamps independently SSTables originated from the same repair session, so they almost never have the same timestamp.&lt;/p&gt;

&lt;p&gt;Steps to reproduce the problem:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;ccm create test
ccm populate -n 3
ccm start
ccm node1 cqlsh;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-sql&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;CREATE&lt;/span&gt; KEYSPACE foo &lt;span class=&quot;code-keyword&quot;&gt;WITH&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;replication&lt;/span&gt; = {&lt;span class=&quot;code-quote&quot;&gt;&apos;class&apos;&lt;/span&gt;: &lt;span class=&quot;code-quote&quot;&gt;&apos;SimpleStrategy&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;replication_factor&apos;&lt;/span&gt;: 3};
&lt;span class=&quot;code-keyword&quot;&gt;CREATE&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;TABLE&lt;/span&gt; foo.bar ( &lt;span class=&quot;code-keyword&quot;&gt;key&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;int&lt;/span&gt;, col &lt;span class=&quot;code-keyword&quot;&gt;int&lt;/span&gt;, &lt;span class=&quot;code-keyword&quot;&gt;PRIMARY&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;KEY&lt;/span&gt; (&lt;span class=&quot;code-keyword&quot;&gt;key&lt;/span&gt;) ) ;
&lt;span class=&quot;code-keyword&quot;&gt;INSERT&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;INTO&lt;/span&gt; foo.bar (&lt;span class=&quot;code-keyword&quot;&gt;key&lt;/span&gt;, col) &lt;span class=&quot;code-keyword&quot;&gt;VALUES&lt;/span&gt; (1, 1);
&lt;span class=&quot;code-keyword&quot;&gt;exit&lt;/span&gt;;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;ccm node1 flush;
ccm node2 flush;
ccm node3 flush;

nodetool -h 127.0.0.1 -p 7100 repair -par -inc foo bar

[2015-04-02 21:56:07,726] Starting repair command #1, repairing 3 ranges &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; keyspace foo (parallelism=PARALLEL, full=&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;)
[2015-04-02 21:56:07,816] Repair session 3655b670-d99c-11e4-b250-9107aba35569 &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; range (3074457345618258602,-9223372036854775808] finished
[2015-04-02 21:56:07,816] Repair session 365a4a50-d99c-11e4-b250-9107aba35569 &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; range (-9223372036854775808,-3074457345618258603] finished
[2015-04-02 21:56:07,818] Repair session 365bf800-d99c-11e4-b250-9107aba35569 &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; range (-3074457345618258603,3074457345618258602] finished
[2015-04-02 21:56:07,995] Repair command #1 finished

sstablemetadata ~/.ccm/test/node1/data/foo/bar-377b5540d99d11e49cc09107aba35569/foo-bar-ka-1-Statistics.db ~/.ccm/test/node2/data/foo/bar-377b5540d99d11e49cc09107aba35569/foo-bar-ka-1-Statistics.db ~/.ccm/test/node3/data/foo/bar-377b5540d99d11e49cc09107aba35569/foo-bar-ka-1-Statistics.db | grep Repaired

Repaired at: 1428023050318
Repaired at: 1428023050322
Repaired at: 1428023050340
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="12787871">CASSANDRA-9111</key>
            <summary>SSTables originated from the same incremental repair session have different repairedAt timestamps</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10002" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Normal</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="prmg">prmg</reporter>
                        <labels>
                    </labels>
                <created>Fri, 3 Apr 2015 01:35:47 +0000</created>
                <updated>Tue, 16 Apr 2019 09:31:15 +0000</updated>
                            <resolved>Thu, 20 Aug 2015 00:04:27 +0000</resolved>
                                        <fixVersion>3.0 beta 1</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>6</watches>
                                                                                                                <comments>
                            <comment id="14393910" author="prmg" created="Fri, 3 Apr 2015 01:45:15 +0000"  >&lt;p&gt;The proposed solution involves passing the initiator timestamp in the repair&apos;s PrepareMessage. This timestamp is then used to create the ParentRepairSession with the initiator timestamp in all replicas. Finally, the ParentRepairSession&apos;s repairedAt field is used to populate the repairedAt field on the SSTable metadata after anticompation.&lt;/p&gt;

&lt;p&gt;After performing the test described in the ticket description after this patch, the SSTables originated from the same incremental repair session now share the same timestamp:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;sstablemetadata ~/.ccm/test/node1/data/foo/bar-104e25c0d99c11e4b2509107aba35569/foo-bar-ka-1-Statistics.db ~/.ccm/test/node2/data/foo/bar-104e25c0d99c11e4b2509107aba35569/foo-bar-ka-1-Statistics.db ~/.ccm/test/node3/data/foo/bar-104e25c0d99c11e4b2509107aba35569/foo-bar-ka-1-Statistics.db | grep Repaired

Repaired at: 1428022567736
Repaired at: 1428022567736
Repaired at: 1428022567736
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="14394394" author="philipthompson" created="Fri, 3 Apr 2015 13:12:41 +0000"  >&lt;p&gt;Thanks for the patch! The file you contributed seems to have some odd characters in it, did you create it via the steps described here: &lt;a href=&quot;http://wiki.apache.org/cassandra/HowToContribute&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://wiki.apache.org/cassandra/HowToContribute&lt;/a&gt; ?&lt;/p&gt;</comment>
                            <comment id="14486173" author="philipthompson" created="Wed, 8 Apr 2015 22:09:48 +0000"  >&lt;p&gt;Thanks, looks good now. Yuki will review.&lt;/p&gt;</comment>
                            <comment id="14486174" author="prmg" created="Wed, 8 Apr 2015 22:10:02 +0000"  >&lt;p&gt;oops, sorry about that. for some reason I used git diff --color to generate the patch (that&apos;s why the strange characters). now created and attached a proper patch with git format-patch. &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="14486186" author="prmg" created="Wed, 8 Apr 2015 22:17:03 +0000"  >&lt;p&gt;just noticed I forgot to add the new timestamp field when computing the message size on PrepareMessage.serializedSize. Attached a v1 version of the patch with a fix.&lt;/p&gt;</comment>
                            <comment id="14533228" author="yukim" created="Thu, 7 May 2015 19:15:48 +0000"  >&lt;p&gt;Sorry for late reply.&lt;br/&gt;
Can you create the patch for trunk to be released in 3.x?&lt;br/&gt;
Since if we changed message format, repair can be hang if version is different in the cluster.&lt;/p&gt;</comment>
                            <comment id="14660702" author="yukim" created="Thu, 6 Aug 2015 19:56:40 +0000"  >&lt;p&gt;Applied prmg&apos;s patch to 3.0 and pushed to &lt;a href=&quot;https://github.com/yukim/cassandra/tree/9111-3.0&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/yukim/cassandra/tree/9111-3.0&lt;/a&gt;.&lt;br/&gt;
If tests run well, I will commit to be released in 3.0.&lt;/p&gt;</comment>
                            <comment id="14704020" author="yukim" created="Thu, 20 Aug 2015 00:04:27 +0000"  >&lt;p&gt;Tests &lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/yukim/job/yukim-9111-3.0-testall/lastCompletedBuild/testReport/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://cassci.datastax.com/view/Dev/view/yukim/job/yukim-9111-3.0-testall/lastCompletedBuild/testReport/&lt;/a&gt; and &lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/yukim/job/yukim-9111-3.0-dtest/lastCompletedBuild/testReport/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://cassci.datastax.com/view/Dev/view/yukim/job/yukim-9111-3.0-dtest/lastCompletedBuild/testReport/&lt;/a&gt; does not show regression by the patch.&lt;br/&gt;
Committed to 3.0 and trunk.&lt;br/&gt;
Thanks!&lt;/p&gt;</comment>
                            <comment id="14709193" author="slebresne" created="Mon, 24 Aug 2015 12:43:27 +0000"  >&lt;p&gt;According to &lt;a href=&quot;http://cassci.datastax.com/job/cassandra-3.0_dtest/lastBuild/testReport/incremental_repair_test/TestIncRepair/sstable_repairedset_test/history/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;the CI history&lt;/a&gt;, this &lt;em&gt;did&lt;/em&gt; create a regression for the dtests &lt;tt&gt;incremental_repair_test.TestIncRepair.sstable_repairedset_test&lt;/tt&gt;.&lt;/p&gt;

&lt;p&gt;As a side note, the &quot;fix version&quot; on this ticket is definitively wrong.&lt;/p&gt;</comment>
                            <comment id="14709224" author="yukim" created="Mon, 24 Aug 2015 13:00:41 +0000"  >&lt;p&gt;&lt;tt&gt;sstablerepairedset&lt;/tt&gt; is broken right now and that&apos;s causing the test to fail I think.&lt;br/&gt;
I created &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-10132&quot; title=&quot;sstablerepairedset throws exception while loading metadata&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-10132&quot;&gt;&lt;del&gt;CASSANDRA-10132&lt;/del&gt;&lt;/a&gt; and posted patch there.&lt;/p&gt;</comment>
                            <comment id="14709236" author="slebresne" created="Mon, 24 Aug 2015 13:06:06 +0000"  >&lt;p&gt;Let&apos;s continue the discussion on &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-10132&quot; title=&quot;sstablerepairedset throws exception while loading metadata&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-10132&quot;&gt;&lt;del&gt;CASSANDRA-10132&lt;/del&gt;&lt;/a&gt; then.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310040">
                    <name>Required</name>
                                                                <inwardlinks description="is required by">
                                        <issuelink>
            <issuekey id="12712472">CASSANDRA-7168</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12724037" name="CASSANDRA-9111-v0.txt" size="8383" author="prmg" created="Wed, 8 Apr 2015 22:08:39 +0000"/>
                            <attachment id="12724041" name="CASSANDRA-9111-v1.txt" size="9399" author="prmg" created="Wed, 8 Apr 2015 22:17:03 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 13 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i27qh3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12311421" key="com.atlassian.jira.plugin.system.customfieldtypes:multiversion">
                        <customfieldname>Reproduced In</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="12329381">2.1.4</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>yukim</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[yukim]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12962"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12311420" key="com.atlassian.jira.plugin.system.customfieldtypes:version">
                        <customfieldname>Since Version</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="12326275">2.1 beta1</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>