<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 23:16:27 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-15685] flaky testWithMismatchingPending - org.apache.cassandra.distributed.test.PreviewRepairTest</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-15685</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;Observed in: &lt;br/&gt;
&lt;a href=&quot;https://app.circleci.com/pipelines/github/newkek/cassandra/34/workflows/1c6b157d-13c3-48a9-85fb-9fe8c153256b/jobs/191/tests&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://app.circleci.com/pipelines/github/newkek/cassandra/34/workflows/1c6b157d-13c3-48a9-85fb-9fe8c153256b/jobs/191/tests&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Failure:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;testWithMismatchingPending - org.apache.cassandra.distributed.test.PreviewRepairTest
junit.framework.AssertionFailedError
	at org.apache.cassandra.distributed.test.PreviewRepairTest.testWithMismatchingPending(PreviewRepairTest.java:97)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;a href=&quot;https://circleci.com/gh/dcapwell/cassandra/tree/bug%2FCASSANDRA-15685&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;Circle CI&lt;/a&gt;&lt;/p&gt;</description>
                <environment></environment>
        <key id="13295880">CASSANDRA-15685</key>
            <summary>flaky testWithMismatchingPending - org.apache.cassandra.distributed.test.PreviewRepairTest</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10002" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Normal</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="edimitrova">Ekaterina Dimitrova</assignee>
                                    <reporter username="newkek">Kevin Gallardo</reporter>
                        <labels>
                            <label>pull-request-available</label>
                    </labels>
                <created>Thu, 2 Apr 2020 19:08:05 +0000</created>
                <updated>Fri, 10 Oct 2025 08:47:57 +0000</updated>
                            <resolved>Thu, 9 Jul 2020 14:38:03 +0000</resolved>
                                        <fixVersion>4.0-beta1</fixVersion>
                    <fixVersion>4.0</fixVersion>
                                    <component>Test/dtest/java</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>8</watches>
                                                    <progress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                            <timeestimate seconds="0">0h</timeestimate>
                            <timespent seconds="1200">20m</timespent>
                                <comments>
                            <comment id="17074046" author="dcapwell" created="Thu, 2 Apr 2020 19:44:37 +0000"  >&lt;p&gt;Walking the workflow I see its this branch &lt;a href=&quot;https://github.com/newkek/cassandra/commits/cci-test2&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/newkek/cassandra/commits/cci-test2&lt;/a&gt;. which is based off &lt;a href=&quot;https://github.com/newkek/cassandra/commit/b9c7a90e8a928cb22cd2b7c4ecd9f8dbc711e10e&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/newkek/cassandra/commit/b9c7a90e8a928cb22cd2b7c4ecd9f8dbc711e10e&lt;/a&gt;.  This issue should be fixed with&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
commit dfc279a22a5563ac7a832a586914d5410426e9b7
Author: David Capwell &amp;lt;dcapwell@gmail.com&amp;gt;
Date:   Sat Mar 21 20:57:50 2020 -0700

    Fix flaky test o.a.c.d.test.*RepairCoordinatorFastTest

    patch by David Capwell; reviewed by Ekaterina Dimitrova and Benjamin Lerer
    &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; CASSANDRA-15650
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;That commit has its own issues (being fixed in &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-15684&quot; title=&quot;CASSANDRA-15650 was merged after dtest refactor and modified classes no longer in the project&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-15684&quot;&gt;&lt;del&gt;CASSANDRA-15684&lt;/del&gt;&lt;/a&gt; and &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-15683&quot; title=&quot;Fix NPE in SimpleReadWriteTest after test framework behavior change&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-15683&quot;&gt;&lt;del&gt;CASSANDRA-15683&lt;/del&gt;&lt;/a&gt;), but should have fixed this test. The root cause that was that nodetool repair command had a bug where it doesn&apos;t handle the case error notification was not seen but complete was (notifications are lossy).  If you update to latest do you still see this test as flakey?&lt;/p&gt;</comment>
                            <comment id="17074077" author="newkek" created="Thu, 2 Apr 2020 20:39:45 +0000"  >&lt;p&gt;Hey &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=dcapwell&quot; class=&quot;user-hover&quot; rel=&quot;dcapwell&quot;&gt;dcapwell&lt;/a&gt; afaict I have only seen this test failing on this run, I have not seen it fail on other more recent builds happening after &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-15650&quot; title=&quot;Fix flaky test org.apache.cassandra.distributed.test.*RepairCoordinatorFastTest&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-15650&quot;&gt;&lt;del&gt;CASSANDRA-15650&lt;/del&gt;&lt;/a&gt; indeed. Opened this ticket since I couldn&apos;t find a report of this failure. I&apos;m ok closing it if it&apos;s been fixed in &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-15650&quot; title=&quot;Fix flaky test org.apache.cassandra.distributed.test.*RepairCoordinatorFastTest&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-15650&quot;&gt;&lt;del&gt;CASSANDRA-15650&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17074156" author="dcapwell" created="Fri, 3 Apr 2020 00:08:42 +0000"  >&lt;p&gt;Let&apos;s close but if you see it after upgrade then should reopen&lt;/p&gt;</comment>
                            <comment id="17074648" author="newkek" created="Fri, 3 Apr 2020 15:16:43 +0000"  >&lt;p&gt;Agreed&lt;/p&gt;</comment>
                            <comment id="17077367" author="dcapwell" created="Tue, 7 Apr 2020 16:20:21 +0000"  >&lt;p&gt;Happened again on trunk.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
junit.framework.AssertionFailedError
	at org.apache.cassandra.distributed.test.PreviewRepairTest.testWithMismatchingPending(PreviewRepairTest.java:97)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="17077372" author="dcapwell" created="Tue, 7 Apr 2020 16:25:23 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=newkek&quot; class=&quot;user-hover&quot; rel=&quot;newkek&quot;&gt;newkek&lt;/a&gt; I was wrong, I had forgotten that test doesn&apos;t use the nodetool api and instead relies on notifications.  Notifications are lossy so its possible to not see the error notification but see the complete.  I fixed this issue with the *RepairCoordinator*Test but that fix was in nodetool, so this test is still impacted.&lt;/p&gt;</comment>
                            <comment id="17077666" author="dcapwell" created="Tue, 7 Apr 2020 23:38:03 +0000"  >&lt;p&gt;I sent a patch switching from notification to nodetool.  I plan to run this in a loop tonight with lower resources.&lt;/p&gt;

&lt;p&gt;One thing that this doesn&apos;t fix is that, if the NOTIFICATION notification gets dropped then this will still be flakey.  Unless we move the message to the success message (I am a fan of this), then not sure how to solve.&lt;/p&gt;</comment>
                            <comment id="17077669" author="dcapwell" created="Tue, 7 Apr 2020 23:41:54 +0000"  >&lt;p&gt;because node tool doesn&apos;t expose the output, I am tempted to remain using notifications, but poll at the end to get the final result.&lt;/p&gt;</comment>
                            <comment id="17083698" author="dcapwell" created="Tue, 14 Apr 2020 23:44:14 +0000"  >&lt;p&gt;moved out of PA since I don&apos;t think the patch I sent solves this completely.  The main issue is we need a notification which is lossy, so we need to move this to the completion message and poll for that in the tests (aka can&apos;t use nodetool).&lt;/p&gt;</comment>
                            <comment id="17089924" author="dcapwell" created="Wed, 22 Apr 2020 18:29:59 +0000"  >&lt;p&gt;I am jumping between a few things so neglecting this right now.  I &quot;feel&quot; like we need to make the completion message contain the notification message so we can recover from a missed message; with that the test can always wait for complete then poll one last time for the status; that should make it no longer flakey.  This can&apos;t be done via nodetool, so the current logic is better off.&lt;/p&gt;</comment>
                            <comment id="17100759" author="edimitrova" created="Wed, 6 May 2020 12:33:17 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=dcapwell&quot; class=&quot;user-hover&quot; rel=&quot;dcapwell&quot;&gt;dcapwell&lt;/a&gt;,&lt;br/&gt;
Still working on this one? Let me know if you need a hand&lt;/p&gt;</comment>
                            <comment id="17101922" author="dcapwell" created="Thu, 7 May 2020 18:00:01 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=e.dimitrova&quot; class=&quot;user-hover&quot; rel=&quot;e.dimitrova&quot;&gt;e.dimitrova&lt;/a&gt; I stopped working on it as I lost my time =(.  If you want, feel free to pick it up! =D&lt;/p&gt;

&lt;p&gt;The current state is that the test requires knowing the result of the previous repair which only happens as a JMX notification, which is lossy; if the notification is lost, the test fails.&lt;/p&gt;

&lt;p&gt;I was planning to append the result to the completion message as we can get that via polling, for this reason the test could not use the nodetool API but would need to poll directly (which it does today).  I also had a patch a bit back to fix nodetool to detect failures in case of JMX loosing the error message, this polling would need to do similar (so should probably be a common function).&lt;/p&gt;

&lt;p&gt;Now, the change to the completion message is better IMO since it also fixes this for operators (if the notification is lost you don&apos;t know if there was a conflict), since polling will also see the latest message and will report it correctly. &lt;/p&gt;

&lt;p&gt;For now I will unassigned myself.&lt;/p&gt;</comment>
                            <comment id="17105497" author="edimitrova" created="Tue, 12 May 2020 14:41:23 +0000"  >&lt;p&gt;Managed to reproduce the failure after 189 runs on Mac, limiting the cores to 2. (Thanks for the hints &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=dcapwell&quot; class=&quot;user-hover&quot; rel=&quot;dcapwell&quot;&gt;dcapwell&lt;/a&gt;)&lt;/p&gt;

&lt;p&gt;Attached the full log for completeness.&lt;/p&gt;
</comment>
                            <comment id="17107535" author="edimitrova" created="Thu, 14 May 2020 18:13:33 +0000"  >&lt;p&gt;Test fixed &lt;a href=&quot;https://github.com/ekaterinadimitrova2/cassandra/tree/CASSANDRA-15685&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;here &lt;/a&gt;&lt;br/&gt;
I ran successfully the whole class 500 times (as the fixed repair function is used by all test methods), log attached&lt;br/&gt;
Cassandra-wise the issue was already fixed in &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-15650&quot; title=&quot;Fix flaky test org.apache.cassandra.distributed.test.*RepairCoordinatorFastTest&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-15650&quot;&gt;&lt;del&gt;CASSANDRA-15650&lt;/del&gt;&lt;/a&gt;. The issue was in this test the StorageService#repair function is directly called so the additional polling from the RepairRunner was not happening for this test.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=dcapwell&quot; class=&quot;user-hover&quot; rel=&quot;dcapwell&quot;&gt;dcapwell&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=blerer&quot; class=&quot;user-hover&quot; rel=&quot;blerer&quot;&gt;blerer&lt;/a&gt;, may I ask you for a review, please?&lt;/p&gt;</comment>
                            <comment id="17107592" author="dcapwell" created="Thu, 14 May 2020 19:20:23 +0000"  >&lt;ul&gt;
	&lt;li&gt;&lt;a href=&quot;https://github.com/apache/cassandra/compare/trunk...ekaterinadimitrova2:CASSANDRA-15685#diff-584fc321d5855ec6340e5477d8e7e469R373&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/cassandra/compare/trunk...ekaterinadimitrova2:CASSANDRA-15685#diff-584fc321d5855ec6340e5477d8e7e469R373&lt;/a&gt;. if you make it this far it means await was already signaled, so this should be a noop&lt;/li&gt;
	&lt;li&gt;&lt;a href=&quot;https://github.com/apache/cassandra/compare/trunk...ekaterinadimitrova2:CASSANDRA-15685#diff-584fc321d5855ec6340e5477d8e7e469R376&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/cassandra/compare/trunk...ekaterinadimitrova2:CASSANDRA-15685#diff-584fc321d5855ec6340e5477d8e7e469R376&lt;/a&gt; this fixes the failed case, but what about the preview repair notification getting lost?&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;The test has two issues&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;not see the error, so believe the job was success; you handle this case&lt;/li&gt;
	&lt;li&gt;not see the notification, so unable to update wasInconsistent; currently not handled.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;To handle the second case, you would need to update the completion message then check for that in the test.  This is desirable since nodetool has the same issue, so moving it to complete would mean we always log it.&lt;/p&gt;</comment>
                            <comment id="17107626" author="edimitrova" created="Thu, 14 May 2020 20:12:58 +0000"  >&lt;p&gt;Ok, as we talked, for completion in case of regression it is good to cover also the case of lost NOTIFICATION to ensure we never got issues in the future with the last assert in this test. &lt;br/&gt;
Moving back to in progress to add that too, thanks&lt;/p&gt;

&lt;p&gt;Is there a ticket for the lossy notifications in general?&lt;/p&gt;</comment>
                            <comment id="17108460" author="dcapwell" created="Fri, 15 May 2020 16:59:23 +0000"  >&lt;p&gt;For others, Ekaterina and I chatted offline.&lt;/p&gt;

&lt;p&gt;The preview repair tests assert that previews did not report inconsistencies, but since it uses a AtomicBoolean to handle concurrent cases, and the default is false, it can lead to a false negative; if we don&apos;t see the notification then we wouldn&apos;t flip the boolean from false to true.  Every test asserts false, so it is not failing right now, but it also won&apos;t detect regressions.&lt;/p&gt;

&lt;p&gt;The issue is also true in the nodetool case as it may not see the notification so isn&apos;t aware of the results.&lt;/p&gt;

&lt;p&gt;Thanks Ekaterina for all the hard work! =D&lt;/p&gt;</comment>
                            <comment id="17109647" author="edimitrova" created="Sun, 17 May 2020 21:09:08 +0000"  >&lt;p&gt;After a couple of hundred more runs of this test (my gut feeling told me that I miss something), it was confirmed that the lossy notifications are not the primary issue with this test.&lt;br/&gt;
In some cases even if we catch the notifications for success/error and the flags &quot;success&quot; and &quot;wasConsistent&quot; are properly set, still the PreviewRepair shows that the Incremental Repair is still running.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
[junit-timeout] java.lang.RuntimeException: Repair session 82ff3420-9737-11ea-b32d-7fa12d874715 &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; range [(-1,9223372036854775805], (9223372036854775805,-1]] failed with error An incremental repair with session id 82eff1e0-9737-11ea-b32d-7fa12d874715 finished during &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; preview repair runtime
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Turns out getting the notification doesn&apos;t always mean that the rest of the nodes are already informed about the completion. I can easily increase the time before preview repair starts.&lt;br/&gt;
But we were considering with &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=dcapwell&quot; class=&quot;user-hover&quot; rel=&quot;dcapwell&quot;&gt;dcapwell&lt;/a&gt; to open a ticket as there might be other parts of the code or tools relying only on the notifications for completion. Worth to be checked.&lt;br/&gt;
Also, I am gonna check tomorrow in detail how we can improve this test not to rely on timing but probably some metadata. &lt;/p&gt;</comment>
                            <comment id="17120294" author="jmckenzie" created="Sat, 30 May 2020 16:16:50 +0000"  >&lt;p&gt;Any updates on this &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=e.dimitrova&quot; class=&quot;user-hover&quot; rel=&quot;e.dimitrova&quot;&gt;e.dimitrova&lt;/a&gt; ?&lt;/p&gt;</comment>
                            <comment id="17121396" author="dcapwell" created="Mon, 1 Jun 2020 23:21:53 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=bdeggleston&quot; class=&quot;user-hover&quot; rel=&quot;bdeggleston&quot;&gt;bdeggleston&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=marcuse&quot; class=&quot;user-hover&quot; rel=&quot;marcuse&quot;&gt;marcuse&lt;/a&gt; could we get your thoughts on this?  preview repair isn&apos;t allowed to be run concurrently with IR, but IR completes before the message is handled on the participant; the below is impacted by this race condition.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
nodetool repair foo bar
# does not look to be running concurrently with the above IR, since it was notified of success
# but the commit message may not have been seen yet which cause &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; to be concurrent with the above
nodetool repair foo bar --validate
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;See here &lt;a href=&quot;https://github.com/apache/cassandra/blob/ec1808a34f9aa5ae0b956c1527828566f4ba2be5/src/java/org/apache/cassandra/repair/consistent/CoordinatorSession.java#L234-L244&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/cassandra/blob/ec1808a34f9aa5ae0b956c1527828566f4ba2be5/src/java/org/apache/cassandra/repair/consistent/CoordinatorSession.java#L234-L244&lt;/a&gt;.  We send the message but don&apos;t make sure its ack on.&lt;/p&gt;</comment>
                            <comment id="17125301" author="jmckenzie" created="Wed, 3 Jun 2020 20:40:23 +0000"  >&lt;p&gt;What do we think about moving fixver to 4.0-beta on this?&lt;/p&gt;</comment>
                            <comment id="17126807" author="edimitrova" created="Fri, 5 Jun 2020 14:19:28 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jmckenzie&quot; class=&quot;user-hover&quot; rel=&quot;jmckenzie&quot;&gt;jmckenzie&lt;/a&gt;, personally, I think we can move it to 4.0-beta. My reasoning is that we might not be able to run preview repair(the participant is still not aware of the IR being completed already)  and have to start it again later but there is no data loss or something. &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=dcapwell&quot; class=&quot;user-hover&quot; rel=&quot;dcapwell&quot;&gt;dcapwell&lt;/a&gt; are you ok with this reasoning? &lt;/p&gt;</comment>
                            <comment id="17138020" author="dcapwell" created="Wed, 17 Jun 2020 01:51:28 +0000"  >&lt;p&gt;sorry for the delay.&lt;/p&gt;

&lt;p&gt;I am fine with the test getting fixed without changing IR, though this adds an unexpected edge case for users; though it is expected to be rare in production.&lt;/p&gt;</comment>
                            <comment id="17138038" author="edimitrova" created="Wed, 17 Jun 2020 02:30:33 +0000"  >&lt;p&gt;We might fix the IR but it is not a blocker now as there is no defect and it is rare case. It will be taken care in beta, it is not a blocker. That is what I meant&lt;/p&gt;</comment>
                            <comment id="17152379" author="edimitrova" created="Tue, 7 Jul 2020 00:07:08 +0000"  >&lt;p&gt;Back to this work. &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=blerer&quot; class=&quot;user-hover&quot; rel=&quot;blerer&quot;&gt;blerer&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=bdeggleston&quot; class=&quot;user-hover&quot; rel=&quot;bdeggleston&quot;&gt;bdeggleston&lt;/a&gt;,&#160;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=marcuse&quot; class=&quot;user-hover&quot; rel=&quot;marcuse&quot;&gt;marcuse&lt;/a&gt;,&#160;may I ask for your expert advice?&#160;Is fixing the test enough here or &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-15685?focusedCommentId=17121396&amp;amp;page=com.atlassian.jira.plugin.system.issuetabpanels%3Acomment-tabpanel#comment-17121396&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;this behavior &lt;/a&gt;  &#160;should also be considered? Thank you in advance &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="17152542" author="krummas" created="Tue, 7 Jul 2020 07:47:40 +0000"  >&lt;p&gt;lets fix the test and open a new jira for any other improvements?&lt;/p&gt;</comment>
                            <comment id="17153154" author="edimitrova" created="Wed, 8 Jul 2020 00:45:15 +0000"  >&lt;p&gt;Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=marcuse&quot; class=&quot;user-hover&quot; rel=&quot;marcuse&quot;&gt;marcuse&lt;/a&gt;, &#160;I raised&#160;&lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-15930&quot; title=&quot;Follow up CASSANDRA-15685 - IR does not wait for ack on commit and notifies caller of success, which can lead to user submitting preview which could conflict&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-15930&quot;&gt;CASSANDRA-15930&lt;/a&gt;&#160;for handling of the mentioned edge case.&#160;&lt;/p&gt;</comment>
                            <comment id="17154093" author="edimitrova" created="Wed, 8 Jul 2020 23:39:39 +0000"  >&lt;p&gt;Considering &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-15930&quot; title=&quot;Follow up CASSANDRA-15685 - IR does not wait for ack on commit and notifies caller of success, which can lead to user submitting preview which could conflict&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-15930&quot;&gt;CASSANDRA-15930&lt;/a&gt; I added only sleep of 3 seconds before running repair preview in this test which should be enough to fix the issue.&#160;&lt;/p&gt;

&lt;p&gt;I ran it 300 times locally with the 2 cores successfully.&#160;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/ekaterinadimitrova2/cassandra/commit/8aa799a38247475ce96a5421625ff4a7a88b44d9&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;Patch &lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=marcuse&quot; class=&quot;user-hover&quot; rel=&quot;marcuse&quot;&gt;marcuse&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=dcapwell&quot; class=&quot;user-hover&quot; rel=&quot;dcapwell&quot;&gt;dcapwell&lt;/a&gt;, anyone of you wants to do a quick review? Thanks in advance!&lt;/p&gt;</comment>
                            <comment id="17154099" author="dcapwell" created="Wed, 8 Jul 2020 23:58:16 +0000"  >&lt;p&gt;your code shows 1 second, are you targeting 1 or 3 seconds?&lt;/p&gt;

&lt;p&gt;I would prefer exec into each process to check the status but I can live with sleeps for now...&lt;/p&gt;</comment>
                            <comment id="17154101" author="edimitrova" created="Thu, 9 Jul 2020 00:19:41 +0000"  >&lt;p&gt;My bad, it is 1. Patch with 1s, tested with 1s. &lt;br/&gt;
Thanks!&lt;/p&gt;</comment>
                            <comment id="17154591" author="edimitrova" created="Thu, 9 Jul 2020 14:01:55 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=brandon.williams&quot; class=&quot;user-hover&quot; rel=&quot;brandon.williams&quot;&gt;brandon.williams&lt;/a&gt;&#160;do you mind to commit if you don&apos;t see any issue, please? The edge case will be fully handled in &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-15930&quot; title=&quot;Follow up CASSANDRA-15685 - IR does not wait for ack on commit and notifies caller of success, which can lead to user submitting preview which could conflict&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-15930&quot;&gt;CASSANDRA-15930&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17154633" author="brandon.williams" created="Thu, 9 Jul 2020 14:38:03 +0000"  >&lt;p&gt;Committed (with CHANGES entry removed since we don&apos;t list test fixes there)&lt;/p&gt;</comment>
                            <comment id="17154726" author="dcapwell" created="Thu, 9 Jul 2020 16:41:30 +0000"  >&lt;p&gt;I wasn&apos;t clear so being clear; +1&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="13286060">CASSANDRA-15580</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="13002741" name="log-CASSANDRA-15685.txt" size="430261" author="e.dimitrova" created="Tue, 12 May 2020 14:40:07 +0000"/>
                            <attachment id="13002968" name="output" size="1363528" author="e.dimitrova" created="Thu, 14 May 2020 17:49:06 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[edimitrova]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12313825" key="com.atlassian.jira.plugin.system.customfieldtypes:cascadingselect">
                        <customfieldname>Bug Category</customfieldname>
                        <customfieldvalues>
                                                    <customfieldvalue key="12982" cascade-level=""><![CDATA[Correctness]]></customfieldvalue>
            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12313821" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Complexity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12964"><![CDATA[Low Hanging Fruit]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313822" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Discovered By</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12970"><![CDATA[Unit Test]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12313922" key="jira.plugin.projectspecificselectfield.jpssf:multicftype">
                        <customfieldname>Impacts</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="13100"><![CDATA[None]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            5 years, 18 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12313921" key="jira.plugin.projectspecificselectfield.jpssf:multicftype">
                        <customfieldname>Platform</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="13076"><![CDATA[All]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0d85c:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[brandon.williams]]></customfieldvalue>
        <customfieldvalue><![CDATA[dcapwell]]></customfieldvalue>
        <customfieldvalue><![CDATA[e.dimitrova]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12961"><![CDATA[Low]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12311420" key="com.atlassian.jira.plugin.system.customfieldtypes:version">
                        <customfieldname>Since Version</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="12348281">4.0-alpha1</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313924" key="com.atlassian.jira.plugin.system.customfieldtypes:textfield">
                        <customfieldname>Source Control Link</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>&lt;p&gt;&lt;a href=&quot;https://github.com/apache/cassandra/commit/7d4c2da7427392f506deaf832f2c66fc6a358688&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/cassandra/commit/7d4c2da7427392f506deaf832f2c66fc6a358688&lt;/a&gt;&lt;/p&gt;</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313823" key="com.atlassian.jira.plugin.system.customfieldtypes:textarea">
                        <customfieldname>Test and Documentation Plan</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>&lt;p&gt;Failure observed - Circle CI / locally many runs with only 2 cores.&lt;br/&gt;
Test fixed &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-15685&quot; title=&quot;flaky testWithMismatchingPending - org.apache.cassandra.distributed.test.PreviewRepairTest&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-15685&quot;&gt;-here -&lt;/a&gt; &lt;/p&gt;</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>