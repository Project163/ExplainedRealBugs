<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 23:30:21 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-19617] Paxos may re-distribute stale commits that predate a collectable tombstone</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-19617</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;Note: this bug only affects {{paxos_state_purging: &lt;/p&gt;
{gc_grace, repaired}
&lt;p&gt;}}, i.e. those introduced alongside Paxos v2.&lt;/p&gt;

&lt;p&gt;There are two problems:&lt;br/&gt;
1) Purging is applied only on compaction, not on load, which can lead to very old commits being resurfaced in certain circumstances&lt;br/&gt;
2) PaxosPrepare does not filter commits based on paxos repair low bound&lt;/p&gt;

&lt;p&gt;This permits surprising situations to arise, where some replicas purge a stale commit &lt;em&gt;and all newer commits&lt;/em&gt;, but due to compaction peculiarities some other replica may purge only the newer commits, leaving a stale commit in some compaction &quot;purgatory&quot;[1] to be returned to reads indefinitely. &lt;/p&gt;

&lt;p&gt;So long as there are no newer commits, the paxos coordinator will see this commit is not universally known and redistribute it - no matter how old it is. This can permit an insert to be reapplied after GC grace has elapsed and the tombstone has been collected.&lt;/p&gt;

&lt;p&gt;For proposals this is not a problem, as we correctly filter proposals based on the last paxos repair time. This also does not affect clusters with the legacy (and default) paxos state purging using TTL. Problem (1) only applies also to the new &lt;tt&gt;gc_grace&lt;/tt&gt; compatibility mode for purging.&lt;/p&gt;

&lt;p&gt;[1] Compaction purgatory can arise for instance because paxos purging allows whole sstables to be erased quite effectively, and if this is able to ordinarily prevent sstables being promoted to L1, then if for some abnormal reason sstables reach L1 (e.g. repairs being disabled for some time), those that collect may remain uncompacted for an extended period without purging being applied.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13578094">CASSANDRA-19617</key>
            <summary>Paxos may re-distribute stale commits that predate a collectable tombstone</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10002" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Normal</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="benedict">Benedict Elliott Smith</assignee>
                                    <reporter username="benedict">Benedict Elliott Smith</reporter>
                        <labels>
                    </labels>
                <created>Fri, 3 May 2024 17:13:46 +0000</created>
                <updated>Tue, 14 Oct 2025 12:13:58 +0000</updated>
                            <resolved>Tue, 11 Jun 2024 13:37:15 +0000</resolved>
                                        <fixVersion>4.1.6</fixVersion>
                    <fixVersion>5.0-rc1</fixVersion>
                    <fixVersion>5.0</fixVersion>
                    <fixVersion>5.1-alpha1</fixVersion>
                                    <component>Consistency/Coordination</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>10</watches>
                                                    <progress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                            <timeestimate seconds="0">0h</timeestimate>
                            <timespent seconds="2400">40m</timespent>
                                <comments>
                            <comment id="17843287" author="cscotta" created="Fri, 3 May 2024 17:23:11 +0000"  >&lt;p&gt;Affects: 4.1.x, 5.0.x, trunk.&lt;/p&gt;</comment>
                            <comment id="17843295" author="JIRAUSER308715" created="Fri, 3 May 2024 17:53:59 +0000"  >&lt;p&gt;I agree this is not good. It has also existed as a problem across many 4.1.x releases and is not a regression introduced recently. &#160;Given that do we actually want to make this as Critical and block all 4.1 and 5.0 releasing until it is fixed?&lt;/p&gt;</comment>
                            <comment id="17843300" author="benedict" created="Fri, 3 May 2024 18:06:50 +0000"  >&lt;p&gt;Fortunately the fix is rather easy, it was only the diagnosis that was &quot;byzantine&quot;. Linked here is a patch with a dtest demonstrating the issue and fixes for both 1 and 2:&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/apache/cassandra/pull/3289&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/cassandra/pull/3289&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;I agree that critical is the correct designation for this bug as it is a potentially severe impact, though I don&apos;t know how many users are in practice using these configurations - maybe close to none? We did not widely advertise them, though they are in principle much better configurations. &lt;/p&gt;

&lt;p&gt;I don&apos;t therefore have a strong opinion about release impact, but we would not need a significant lengthy delay to include the fixes in any new releases.&lt;/p&gt;</comment>
                            <comment id="17843305" author="JIRAUSER308715" created="Fri, 3 May 2024 18:35:52 +0000"  >&lt;p&gt;If we already have a patch available great, no need to argue severity. It was indeed the &#8220;byzantine&#8221; complexity that was scaring me &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;.&lt;/p&gt;</comment>
                            <comment id="17847118" author="JIRAUSER308715" created="Fri, 17 May 2024 00:14:10 +0000"  >&lt;p&gt;Where are we at with this? &#160;It is the final ticket blocking releases at the moment.&lt;/p&gt;</comment>
                            <comment id="17847202" author="benedict" created="Fri, 17 May 2024 08:17:56 +0000"  >&lt;p&gt;Apologies - there&apos;s been some delay as we consider how to address migration between gc_grace and repaired purging. But if we&apos;re blocking on this now, I think we should merge and do that in follow up - agreed &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=bdeggleston&quot; class=&quot;user-hover&quot; rel=&quot;bdeggleston&quot;&gt;bdeggleston&lt;/a&gt;?&lt;/p&gt;</comment>
                            <comment id="17847379" author="bdeggleston" created="Fri, 17 May 2024 17:21:41 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=benedict&quot; class=&quot;user-hover&quot; rel=&quot;benedict&quot;&gt;benedict&lt;/a&gt; agreed, we can handle that later&lt;/p&gt;</comment>
                            <comment id="17848776" author="edimitrova" created="Wed, 22 May 2024 23:55:44 +0000"  >&lt;p&gt;Sounds great, looking forward seeing this work committed. Thanks for all your work!&lt;/p&gt;</comment>
                            <comment id="17852851" author="bdeggleston" created="Thu, 6 Jun 2024 16:26:48 +0000"  >&lt;p&gt;+1&lt;/p&gt;</comment>
                            <comment id="17853730" author="blerer" created="Mon, 10 Jun 2024 16:30:46 +0000"  >&lt;p&gt;CI results for &lt;a href=&quot;https://app.circleci.com/pipelines/github/blerer/cassandra/434/workflows/8202e56a-c7be-417c-95b0-86cd7c7ce2df&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;cassandra-5.0&lt;/a&gt; and &lt;a href=&quot;https://app.circleci.com/pipelines/github/blerer/cassandra/433/workflows/54aaadb2-0a24-471c-b76f-1a79e8b8b53d&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;trunk&lt;/a&gt;. Failures are known. &lt;/p&gt;</comment>
                            <comment id="17853735" author="blerer" created="Mon, 10 Jun 2024 16:45:37 +0000"  >&lt;p&gt;I just realized after pushing to 5.0 and trunk that the problem also affected 4.1. Sorry, will fix it there too.&lt;/p&gt;</comment>
                            <comment id="17854050" author="blerer" created="Tue, 11 Jun 2024 13:23:21 +0000"  >&lt;p&gt;CI for &lt;a href=&quot;https://app.circleci.com/pipelines/github/blerer/cassandra/436/workflows/8691c4ef-c961-46f2-8ae7-9331c33e60ee&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;4.1&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17854052" author="blerer" created="Tue, 11 Jun 2024 13:37:15 +0000"  >&lt;p&gt;The patch for 5.0 was committed into cassandra-5.0 at 8c165b4cc029928d7b485fffae17e0904ce7a49c and merged into trunk.&lt;/p&gt;

&lt;p&gt;The patch for 4.1 which was originally missing has been committed into cassandra-4.1 at 53b06453b7dea147ef6369765e0b7ac7fb0990fd and merged into 5.0 with -s ours&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[benedict]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12313825" key="com.atlassian.jira.plugin.system.customfieldtypes:cascadingselect">
                        <customfieldname>Bug Category</customfieldname>
                        <customfieldvalues>
                                                    <customfieldvalue key="12982" cascade-level=""><![CDATA[Correctness]]></customfieldvalue>
                                <customfieldvalue key="12986" cascade-level="1"><![CDATA[Recoverable Corruption / Loss]]></customfieldvalue>
            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12313821" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Complexity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12967"><![CDATA[Byzantine]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313822" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Discovered By</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="13860"><![CDATA[Diff Testing]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12313922" key="jira.plugin.projectspecificselectfield.jpssf:multicftype">
                        <customfieldname>Impacts</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="13100"><![CDATA[None]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            1 year, 22 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12313921" key="jira.plugin.projectspecificselectfield.jpssf:multicftype">
                        <customfieldname>Platform</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="13076"><![CDATA[All]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z1p0r4:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[bdeggleston]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12963"><![CDATA[Critical]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12311420" key="com.atlassian.jira.plugin.system.customfieldtypes:version">
                        <customfieldname>Since Version</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="12352689">4.1.0</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313924" key="com.atlassian.jira.plugin.system.customfieldtypes:textfield">
                        <customfieldname>Source Control Link</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>&lt;p&gt;&lt;a href=&quot;https://github.com/apache/cassandra/commit/53b06453b7dea147ef6369765e0b7ac7fb0990fd&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/cassandra/commit/53b06453b7dea147ef6369765e0b7ac7fb0990fd&lt;/a&gt;&lt;/p&gt;</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313823" key="com.atlassian.jira.plugin.system.customfieldtypes:textarea">
                        <customfieldname>Test and Documentation Plan</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>&lt;p&gt;Patch includes tests&lt;/p&gt;</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>