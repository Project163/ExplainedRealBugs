<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 22:39:14 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-5573] Querying with an empty (impossible) range returns incorrect results</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-5573</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;SELECT * FROM cf WHERE token(key) &amp;gt; 2000 AND token(key) &amp;lt;= 2000 LIMIT 1000 ALLOW FILTERING;&lt;/p&gt;

&lt;p&gt;This should return nothing, but instead appears to freak and return arbitrary token values.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12647879">CASSANDRA-5573</key>
            <summary>Querying with an empty (impossible) range returns incorrect results</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10002" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Normal</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="slebresne">Sylvain Lebresne</assignee>
                                    <reporter username="mikeschrag">Mike Schrag</reporter>
                        <labels>
                    </labels>
                <created>Thu, 16 May 2013 02:50:59 +0000</created>
                <updated>Tue, 16 Apr 2019 09:32:12 +0000</updated>
                            <resolved>Fri, 12 Jul 2013 15:17:50 +0000</resolved>
                                        <fixVersion>1.2.7</fixVersion>
                    <fixVersion>2.0 beta 2</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="13659909" author="alexliu68" created="Thu, 16 May 2013 20:08:17 +0000"  >&lt;ul&gt;
	&lt;li&gt;The semantics of start keys and tokens are slightly different.&lt;/li&gt;
	&lt;li&gt;Keys are start-inclusive; tokens are start-exclusive.  Token&lt;/li&gt;
	&lt;li&gt;ranges may also wrap &amp;#8211; that is, the end token may be less&lt;/li&gt;
	&lt;li&gt;than the start one.  Thus, a range from keyX to keyX is a&lt;/li&gt;
	&lt;li&gt;one-element range, but a range from tokenY to tokenY is the&lt;/li&gt;
	&lt;li&gt;full ring.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;So that query covers the whole ring. I think it&apos;s a bug in the hadoop code. I will fix it in &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-4421&quot; title=&quot;Support cql3 table definitions in Hadoop InputFormat&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-4421&quot;&gt;&lt;del&gt;CASSANDRA-4421&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13660387" author="slebresne" created="Fri, 17 May 2013 06:17:23 +0000"  >&lt;p&gt;Hum, that&apos;s not an hadoop query, that&apos;s a CQL3, so this is a valid issue.&lt;/p&gt;</comment>
                            <comment id="13660409" author="slebresne" created="Fri, 17 May 2013 06:53:19 +0000"  >&lt;p&gt;Let me maybe justify a bit more why I believe it&apos;s a valid issue.&lt;/p&gt;

&lt;p&gt;It is true that in thrift, get_range_slide can take a range of tokens and this range is allowed to wrap, so the start token can be &amp;gt;= to the end token.&lt;br/&gt;
However, in CQL, the where clause expresses a condition that each returned record needs to fulfill to be returned. This is different. And it is impossible to have a key for which the token is both &amp;gt; 2000 and &amp;lt;= 2000, so such request must return nothing (or return an error thought that would be less convenient in practice).&lt;/p&gt;

&lt;p&gt;Now, a related question could be, how do I return in CQL3 all the records whose tokens is in the wrapping (2000, 2000] token range? Well, you can&apos;t with just one request currently, you have to unwrap the range manually (and thus potentially do 2 queries since we don&apos;t have OR conditions). Is that a problem? I don&apos;t think so. If you have a not trivial amount of data, iterating over it all is going to take way more than one query anyway and if you care about performance, you&apos;d better use hadoop for such things. Besides, if you do really want to iterate over the whole ring, just iterate from the min token to the max one and you don&apos;t even have to bother about wrapping.&lt;/p&gt;</comment>
                            <comment id="13703311" author="slebresne" created="Tue, 9 Jul 2013 14:18:35 +0000"  >&lt;p&gt;Attaching patch for this.&lt;/p&gt;

&lt;p&gt;Now, it turns out that the current behavior of CQL when given unsatisfiable conditions is to throw an exception, so it would be somewhat to do it in that case too. However, the attached takes the other direction, of always returning an empty result set in that case because:&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;the current behavior is not consistent anyway. If you do one of:
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;SELECT v FROM test WHERE k=0 AND v &amp;gt; 1 AND v &amp;lt;= 1
SELECT v FROM test WHERE k=0 AND v &amp;gt; 1 AND v &amp;lt; 2
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;(where &lt;tt&gt;v&lt;/tt&gt; is a clustering column), then you get an exception, but if you do&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;SELECT v FROM test WHERE k=0 AND v &amp;gt;= 2 AND v &amp;lt; 1
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;then you actually get an empty result set.&lt;/p&gt;&lt;/li&gt;
	&lt;li&gt;I think returning an empty result set is really more user friendly (and I&apos;ve meant to change that for a while). As far as I know this is also how every SQL DB works.&lt;/li&gt;
&lt;/ol&gt;
</comment>
                            <comment id="13706927" author="iamaleksey" created="Fri, 12 Jul 2013 13:17:43 +0000"  >&lt;p&gt;LGTM, +1&lt;/p&gt;

&lt;p&gt;nanonits:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;you can kill both ColumnSlice.validate() overloads (only used by QP.validateSLiceFilter) altogether if you ditch QueryProcessor.validateSliceFilter() (unused).&lt;/li&gt;
	&lt;li&gt;SelectStatement.getKeyBounds() comment &apos;it will happilly return the whole&apos; has a typo in &apos;happilly&apos;.&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13707003" author="slebresne" created="Fri, 12 Jul 2013 15:17:50 +0000"  >&lt;p&gt;Committed with nits addressed. Thanks.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12591437" name="5573.txt" size="12280" author="slebresne" created="Tue, 9 Jul 2013 14:18:35 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[slebresne]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>328235</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            12 years, 19 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1kms7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>328579</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>aleksey</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[aleksey]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12962"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>