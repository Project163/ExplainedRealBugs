<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 22:10:49 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-286] slice offset breaks read repair</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-286</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;code&amp;#93;&lt;/span&gt;&lt;br/&gt;
        int liveColumns = 0;&lt;br/&gt;
        int limit = offset + count;&lt;/p&gt;

&lt;p&gt;        for (IColumn column : reducedColumns)&lt;/p&gt;
        {
            if (liveColumns &amp;gt;= limit)
                break;
            if (!finish.isEmpty()
                &amp;amp;&amp;amp; ((isAscending &amp;amp;&amp;amp; column.name().compareTo(finish) &amp;gt; 0))
                    || (!isAscending &amp;amp;&amp;amp; column.name().compareTo(finish) &amp;lt; 0))
                break;
            if (!column.isMarkedForDelete())
                liveColumns++;

            if (liveColumns &amp;gt; offset)
                returnCF.addColumn(column);
        }
&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;code&amp;#93;&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;The problem is that for offset to return the correct &quot;live&quot; columns, it has to ignore tombstones it scans before the first live one post-offset.&lt;/p&gt;

&lt;p&gt;This means that instead of being corrected within a few ms of a read, a node can continue returning deleted data indefinitely (until the next anti-entropy pass).&lt;/p&gt;

&lt;p&gt;Coupled with offset&apos;s inherent inefficiency (see &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-261&quot; title=&quot;get_slice needs offset + limit&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-261&quot;&gt;&lt;del&gt;CASSANDRA-261&lt;/del&gt;&lt;/a&gt;) I think this means we should take it out and leave offset to be computed client-side (which, for datasets under which it was reasonable server-side, will still be reasonable).&lt;/p&gt;</description>
                <environment></environment>
        <key id="12429945">CASSANDRA-286</key>
            <summary>slice offset breaks read repair</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10002" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Normal</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="jbellis">Jonathan Ellis</assignee>
                                    <reporter username="jbellis">Jonathan Ellis</reporter>
                        <labels>
                    </labels>
                <created>Thu, 9 Jul 2009 14:26:06 +0000</created>
                <updated>Tue, 16 Apr 2019 09:33:36 +0000</updated>
                            <resolved>Thu, 16 Jul 2009 00:39:50 +0000</resolved>
                                        <fixVersion>0.4</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                                                                <comments>
                            <comment id="12729295" author="junrao" created="Thu, 9 Jul 2009 15:30:34 +0000"  >&lt;p&gt;This is a problem with any APIs relying on offset, instead of value. All columns before the offset affect the outcome. So, if there is any incorrect column (whether it&apos;s missing deletes or missing inserts) before the offset doesn&apos;t get fixed immediately, the outcome will be incorrect.&lt;/p&gt;

&lt;p&gt;One potential fix is to include all columns before offset in the repair logic, but not in thrift return. This won&apos;t affect performance much since we already have to scan those columns. This may complicates the overall logic a bit though.&lt;/p&gt;
</comment>
                            <comment id="12729306" author="jbellis" created="Thu, 9 Jul 2009 16:04:03 +0000"  >&lt;p&gt;Yes, that&apos;s the brute force fix, but it means that in the case of mass deletes in a given CF we could very possibly OOM collecting all the tombstones for a large offset.&lt;/p&gt;

&lt;p&gt;Again, my rule of thumb is: features that allow the user to do something that slow things down are ok; features that allow the user to crash the server, are not. &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="12729336" author="sandeep_tata" created="Thu, 9 Jul 2009 17:17:16 +0000"  >&lt;p&gt;I agree ... offset makes it hard to understand the cost of a get_slice. While it is very convenient for pagination, dropping it from the API is probably the right choice.&lt;/p&gt;</comment>
                            <comment id="12731715" author="jbellis" created="Wed, 15 Jul 2009 22:08:25 +0000"  >&lt;p&gt;patch 2 fixes the bug with tombstone handling in get_key_range that Evan noticed in &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-139&quot; title=&quot;thrift API should use lists instead of colon-delimited strings to specify column path&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-139&quot;&gt;&lt;del&gt;CASSANDRA-139&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="12731728" author="eweaver" created="Wed, 15 Jul 2009 22:55:52 +0000"  >&lt;p&gt;Twitter collective is in favor of killing offset.&lt;/p&gt;</comment>
                            <comment id="12731729" author="jbellis" created="Wed, 15 Jul 2009 22:58:57 +0000"  >&lt;p&gt;does that mean you&apos;re +1 on the patch, or the idea? &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="12731731" author="eweaver" created="Wed, 15 Jul 2009 23:02:58 +0000"  >&lt;p&gt;I meant idea. But now I also mean patch.&lt;/p&gt;

&lt;p&gt;Fixes my bugs. Code looks fine; ship it!&lt;/p&gt;</comment>
                            <comment id="12731757" author="jbellis" created="Thu, 16 Jul 2009 00:39:50 +0000"  >&lt;p&gt;committed&lt;/p&gt;</comment>
                            <comment id="12731932" author="hudson" created="Thu, 16 Jul 2009 13:20:21 +0000"  >&lt;p&gt;Integrated in Cassandra #139 (See &lt;a href=&quot;http://hudson.zones.apache.org/hudson/job/Cassandra/139/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://hudson.zones.apache.org/hudson/job/Cassandra/139/&lt;/a&gt;)&lt;br/&gt;
    fix not including tombstone-only keys in keyRange.&lt;br/&gt;
patch by jbellis; reviewed by Evan Weaver for &lt;br/&gt;
r/m offset from slice api; we could live with being inefficient but not with breaking read repair.&lt;br/&gt;
patch by jbellis; reviewed by Evan Weaver for &lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12413602" name="ASF.LICENSE.NOT.GRANTED--0001-CASSANDRA-286-r-m-offset-from-slice-api-we-could-live.txt" size="59745" author="jbellis" created="Wed, 15 Jul 2009 22:07:55 +0000"/>
                            <attachment id="12413603" name="ASF.LICENSE.NOT.GRANTED--0002-fix-not-including-tombstone-only-keys-in-keyRange.txt" size="9953" author="jbellis" created="Wed, 15 Jul 2009 22:07:55 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[jbellis]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>19621</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            16 years, 19 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0fy07:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>91107</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12962"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>