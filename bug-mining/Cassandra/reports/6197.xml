<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 23:26:50 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-18125] Improve memtable allocator accounting when updating AtomicBTreePartition</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-18125</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;On two nodes (on a 5 nodes cluster) on the cluster I&apos;m running, I got the following exception. It occurred at 3,5 minutes interval.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
MemtableReclaimMemory:2625 org.apache.cassandra.service.CassandraDaemon uncaughtException - Exception in thread &lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;[MemtableReclaimMemory:2625,5,main]java.lang.AssertionError: &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;
	at org.apache.cassandra.utils.memory.MemtablePool$SubPool.released(MemtablePool.java:193)
	at org.apache.cassandra.utils.memory.MemtableAllocator$SubAllocator.releaseAll(MemtableAllocator.java:151)
	at org.apache.cassandra.utils.memory.MemtableAllocator$SubAllocator.setDiscarded(MemtableAllocator.java:142)
	at org.apache.cassandra.utils.memory.MemtableAllocator.setDiscarded(MemtableAllocator.java:93)
	at org.apache.cassandra.utils.memory.SlabAllocator.setDiscarded(SlabAllocator.java:120)
	at org.apache.cassandra.db.Memtable.setDiscarded(Memtable.java:201)
	at org.apache.cassandra.db.ColumnFamilyStore$Flush$1.runMayThrow(ColumnFamilyStore.java:1216)
	at org.apache.cassandra.utils.WrappedRunnable.run(WrappedRunnable.java:28)
	at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1128)
	at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:628)
	at io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)
	at java.base/java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:829)

&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt; 

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
$ nodetool info
ID                     : 
Gossip active          : &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;
Native Transport active: &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;
Load                   : 204.67 GiB
Generation No          : 1670343179
Uptime (seconds)       : 1110514
Heap Memory (MB)       : 7218.07 / 24576.00
Off Heap Memory (MB)   : 784.06
Data Center            : par
Rack                   : e1
Exceptions             : 1
Key Cache              : entries 802712, size 100 MiB, capacity 100 MiB, 774541004 hits, 914207516 requests, 0.847 recent hit rate, 14400 save period in seconds
Row Cache              : entries 0, size 0 bytes, capacity 0 bytes, 0 hits, 0 requests, NaN recent hit rate, 0 save period in seconds
Counter Cache          : entries 0, size 0 bytes, capacity 50 MiB, 0 hits, 0 requests, NaN recent hit rate, 7200 save period in seconds
Percent Repaired       : 2.3272298419424144E-5%
Token                  : (invoke with -T/--tokens to see all 8 tokens)

$ java -version
openjdk version &lt;span class=&quot;code-quote&quot;&gt;&quot;11.0.16&quot;&lt;/span&gt; 2022-07-19 LTS
OpenJDK &lt;span class=&quot;code-object&quot;&gt;Runtime&lt;/span&gt; Environment (Red_Hat-11.0.16.0.8-1.el7_9) (build 11.0.16+8-LTS)
OpenJDK 64-Bit Server VM (Red_Hat-11.0.16.0.8-1.el7_9) (build 11.0.16+8-LTS, mixed mode, sharing)
$ nodetool version
ReleaseVersion: 4.0.6
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="13514734">CASSANDRA-18125</key>
            <summary>Improve memtable allocator accounting when updating AtomicBTreePartition</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10002" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Normal</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="benedict">Benedict Elliott Smith</assignee>
                                    <reporter username="nicolas.henneaux">Nicolas Henneaux</reporter>
                        <labels>
                    </labels>
                <created>Mon, 19 Dec 2022 12:46:14 +0000</created>
                <updated>Tue, 12 Sep 2023 19:18:52 +0000</updated>
                            <resolved>Tue, 7 Mar 2023 17:58:13 +0000</resolved>
                                        <fixVersion>4.0.9</fixVersion>
                    <fixVersion>4.1.1</fixVersion>
                    <fixVersion>5.0-alpha1</fixVersion>
                    <fixVersion>5.0</fixVersion>
                                    <component>Local/Memtable</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>12</watches>
                                                                                                                <comments>
                            <comment id="17649432" author="maedhroz" created="Mon, 19 Dec 2022 18:24:15 +0000"  >&lt;p&gt;Thanks for the report!&lt;/p&gt;

&lt;p&gt;Is there any chance you could provide a little more information around the following?&lt;/p&gt;

&lt;p&gt;1.) Are secondary indexes in use?&lt;br/&gt;
2.) Is this an overwrite-heavy write workload?&lt;br/&gt;
3.) Are off-heap memtables in use?&lt;/p&gt;</comment>
                            <comment id="17649433" author="benedict" created="Mon, 19 Dec 2022 18:33:28 +0000"  >&lt;p&gt;In general further details would be great, including any involved schema, and any log messages around memtable flushes that occur either side of the error.&lt;/p&gt;</comment>
                            <comment id="17649441" author="nicolas.henneaux" created="Mon, 19 Dec 2022 18:58:17 +0000"  >&lt;p&gt;Thanks for your feedback, of course I can provide more details.&lt;/p&gt;

&lt;p&gt;1. There is no secondary index in use.&lt;br/&gt;
2. Not sure what is really heavy but I don&apos;t believe it is heavy, each node has ~200GB of data with ttl of 10 days for most of the data (~20GB written by day). About overwrite, I guess you mean updating some cells, yes we usually insert then update a row within a short time frame (~10min).&lt;br/&gt;
3. I don&apos;t think off-heap is used. If disabled by default, that&apos;s not something I enabled&lt;/p&gt;

&lt;p&gt;A compaction was running it seems. I got a lot of &lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;TWCS skipping check for fully expired SSTables&lt;/li&gt;
	&lt;li&gt;TWCS expired check sufficiently far in the past, checking for fully expired SSTables&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Here is an extract of the logs around ~1min&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
Dec 19, 2022 @ 13:07:51.334COMMIT-LOG-ALLOCATOR org.apache.cassandra.db.ColumnFamilyStore logFlush - Enqueuing flush of T4: 35.156KiB (0%) on-heap, 0.000KiB (0%) off-heap
Dec 19, 2022 @ 13:07:51.334COMMIT-LOG-ALLOCATOR org.apache.cassandra.db.ColumnFamilyStore logFlush - Enqueuing flush of T3: 852.600KiB (0%) on-heap, 0.000KiB (0%) off-heap
Dec 19, 2022 @ 13:07:51.334COMMIT-LOG-ALLOCATOR org.apache.cassandra.db.ColumnFamilyStore logFlush - Enqueuing flush of T2: 41.210KiB (0%) on-heap, 0.000KiB (0%) off-heap
Dec 19, 2022 @ 13:07:51.334COMMIT-LOG-ALLOCATOR org.apache.cassandra.db.ColumnFamilyStore logFlush - Enqueuing flush of T1: 364.268KiB (0%) on-heap, 0.000KiB (0%) off-heap
Dec 19, 2022 @ 13:07:15.561NonPeriodicTasks:1 org.apache.cassandra.io.sstable.SSTable delete - Deleting sstable: /data/cassandra/data/system_distributed/repair_history-759fffad624b318180eefa9a52d1f627/nb-26-big
Dec 19, 2022 @ 13:07:15.560CompactionExecutor:6104 org.apache.cassandra.db.compaction.CompactionTask runMayThrow - Compacted (ad77aef0-7f95-11ed-bab7-e7d7c3e60f28) 2 sstables to [/data/cassandra/data/system_distributed/repair_history-759fffad624b318180eefa9a52d1f627/nb-29-big,] to level=0.  5.429KiB to 5.426KiB (~99% of original) in 9ms.  Read Throughput = 593.925KiB/s, Write Throughput = 593.604KiB/s, Row Throughput = ~118/s.  59 total partitions merged to 58.  Partition merge counts were {1:57, 2:1, }
Dec 19, 2022 @ 13:07:15.560NonPeriodicTasks:1 org.apache.cassandra.io.sstable.SSTable delete - Deleting sstable: /data/cassandra/data/system_distributed/repair_history-759fffad624b318180eefa9a52d1f627/nb-27-big
Dec 19, 2022 @ 13:07:15.551MemtableReclaimMemory:2628 org.apache.cassandra.service.CassandraDaemon uncaughtException - Exception in thread &lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;[MemtableReclaimMemory:2628,5,main]java.lang.AssertionError: &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;
	at org.apache.cassandra.utils.memory.MemtablePool$SubPool.released(MemtablePool.java:193)
	at org.apache.cassandra.utils.memory.MemtableAllocator$SubAllocator.releaseAll(MemtableAllocator.java:151)
	at org.apache.cassandra.utils.memory.MemtableAllocator$SubAllocator.setDiscarded(MemtableAllocator.java:142)
	at org.apache.cassandra.utils.memory.MemtableAllocator.setDiscarded(MemtableAllocator.java:93)
	at org.apache.cassandra.utils.memory.SlabAllocator.setDiscarded(SlabAllocator.java:120)
	at org.apache.cassandra.db.Memtable.setDiscarded(Memtable.java:201)
	at org.apache.cassandra.db.ColumnFamilyStore$Flush$1.runMayThrow(ColumnFamilyStore.java:1216)
	at org.apache.cassandra.utils.WrappedRunnable.run(WrappedRunnable.java:28)
	at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1128)
	at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:628)
	at io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)
	at java.base/java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:829)
Dec 19, 2022 @ 13:07:15.551MemtablePostFlush:2626 org.apache.cassandra.db.commitlog.AbstractCommitLogSegmentManager archiveAndDiscard - Segment CommitLogSegment(/data/cassandra/commitlog/CommitLog-7-1670343439312.log) is no longer active and will be deleted now
Dec 19, 2022 @ 13:07:15.551MemtablePostFlush:2626 org.apache.cassandra.db.commitlog.CommitLog discardCompletedSegments - Commit log segment CommitLogSegment(/data/cassandra/commitlog/CommitLog-7-1670343439312.log) is unused
Dec 19, 2022 @ 13:07:15.551CompactionExecutor:6104 org.apache.cassandra.db.compaction.TimeWindowCompactionStrategy newestBucket - bucket size 2 &amp;gt;= 2 and not in current bucket, compacting what&lt;span class=&quot;code-quote&quot;&gt;&apos;s here: [BigTableReader(path=&apos;&lt;/span&gt;/data/cassandra/data/system_distributed/repair_history-759fffad624b318180eefa9a52d1f627/nb-27-big-Data.db&lt;span class=&quot;code-quote&quot;&gt;&apos;), BigTableReader(path=&apos;&lt;/span&gt;/data/cassandra/data/system_distributed/repair_history-759fffad624b318180eefa9a52d1f627/nb-26-big-Data.db&apos;)]
Dec 19, 2022 @ 13:07:15.551CompactionExecutor:6104 org.apache.cassandra.db.compaction.CompactionTask runMayThrow - Compacting (ad77aef0-7f95-11ed-bab7-e7d7c3e60f28) [/data/cassandra/data/system_distributed/repair_history-759fffad624b318180eefa9a52d1f627/nb-27-big-Data.db:level=0, /data/cassandra/data/system_distributed/repair_history-759fffad624b318180eefa9a52d1f627/nb-26-big-Data.db:level=0, ]
Dec 19, 2022 @ 13:07:15.550MemtableFlushWriter:3385 org.apache.cassandra.db.ColumnFamilyStore flushMemtable - Flushed to [BigTableReader(path=&lt;span class=&quot;code-quote&quot;&gt;&apos;/data/cassandra/data/system_distributed/parent_repair_history-deabd734b99d3b9c92e5fd92eb5abf14/nb-31-big-Data.db&apos;&lt;/span&gt;)] (1 sstables, 7.193KiB), biggest 7.193KiB, smallest 7.193KiB
Dec 19, 2022 @ 13:07:15.550MemtableFlushWriter:3384 org.apache.cassandra.db.ColumnFamilyStore flushMemtable - Flushed to [BigTableReader(path=&lt;span class=&quot;code-quote&quot;&gt;&apos;/data/cassandra/data/system_distributed/repair_history-759fffad624b318180eefa9a52d1f627/nb-28-big-Data.db&apos;&lt;/span&gt;)] (1 sstables, 6.510KiB), biggest 6.510KiB, smallest 6.510KiB
Dec 19, 2022 @ 13:07:15.546PerDiskMemtableFlushWriter_0:3385 org.apache.cassandra.db.Memtable writeSortedContents - Completed flushing /data/cassandra/data/system_distributed/parent_repair_history-deabd734b99d3b9c92e5fd92eb5abf14/nb-31-big-Data.db (4.170KiB) &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; commitlog position CommitLogPosition(segmentId=1670343439574, position=3282)
Dec 19, 2022 @ 13:07:15.545PerDiskMemtableFlushWriter_0:3384 org.apache.cassandra.db.Memtable writeSortedContents - Completed flushing /data/cassandra/data/system_distributed/repair_history-759fffad624b318180eefa9a52d1f627/nb-28-big-Data.db (1.785KiB) &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; commitlog position CommitLogPosition(segmentId=1670343439574, position=1779)
Dec 19, 2022 @ 13:07:15.545PerDiskMemtableFlushWriter_0:3384 org.apache.cassandra.db.Memtable writeSortedContents - Writing Memtable-repair_history@685478737(-8.285KiB serialized bytes, 246 ops, -0%/0% of on/off-heap limit), flushed range = (min(-9223372036854775808), max(9223372036854775807)]Dec 19, 2022 @ 13:07:15.545PerDiskMemtableFlushWriter_0:3385 org.apache.cassandra.db.Memtable writeSortedContents - Writing Memtable-parent_repair_history@860004687(5.211KiB serialized bytes, 2 ops, 0%/0% of on/off-heap limit), flushed range = (min(-9223372036854775808), max(9223372036854775807)]Dec 19, 2022 @ 13:07:15.543COMMIT-LOG-ALLOCATOR org.apache.cassandra.db.ColumnFamilyStore logFlush - Enqueuing flush of parent_repair_history: 14.763KiB (0%) on-heap, 0.000KiB (0%) off-heap
Dec 19, 2022 @ 13:07:15.542COMMIT-LOG-ALLOCATOR org.apache.cassandra.db.ColumnFamilyStore logFlush - Enqueuing flush of repair_history: -8.000KiB (-0%) on-heap, 0.000KiB (0%) off-heap
Dec 19, 2022 @ 13:06:22.905ReadStage-1 org.apache.cassandra.utils.memory.BufferPool log - Maximum memory usage reached (512.000MiB), cannot allocate chunk of 8.000MiB
Dec 19, 2022 @ 13:05:36.979NonPeriodicTasks:1 org.apache.cassandra.io.sstable.SSTable delete - Deleting sstable: /data/cassandra/data/X/Y-48b97b403c1011eab0e9f58b98b870bd/nb-2963-big
Dec 19, 2022 @ 13:05:36.979CompactionExecutor:6105 org.apache.cassandra.db.compaction.CompactionTask runMayThrow - Compacted (72b6a320-7f95-11ed-bab7-e7d7c3e60f28) 1 sstables to [] to level=0.  0.000KiB to 0.000KiB (~0% of original) in 1ms.  Read Throughput = 0.000KiB/s, Write Throughput = 0.000KiB/s, Row Throughput = ~0/s.  0 total partitions merged to 0.  Partition merge counts were {}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="17649445" author="benedict" created="Mon, 19 Dec 2022 19:12:55 +0000"  >&lt;p&gt;Thanks. To be clear, I&apos;m looking for the schema of the table involved in the problematic memtable flush. It looks like quite a few flushes might be candidates, but if there are a lot of these log messages it might be possible to pinpoint a specific Memtable (or else we could perhaps patch to include the table in the error message).&lt;/p&gt;

&lt;p&gt;The likeliest explanation is that there is some non-determinism in the Memtable accounting, so we want to pinpoint the potential places this might be occurring, and so the more information we can use to narrow down the candidate code locations the better.&lt;/p&gt;</comment>
                            <comment id="17649451" author="nicolas.henneaux" created="Mon, 19 Dec 2022 19:21:36 +0000"  >&lt;p&gt;I cannot share the schema. There are 110 tables with 76 keyspaces. One table contains ~75% of the data mainly from a data payload in a &lt;tt&gt;text&lt;/tt&gt; cell.&lt;/p&gt;</comment>
                            <comment id="17675883" author="JIRAUSER297793" created="Thu, 12 Jan 2023 09:09:49 +0000"  >&lt;p&gt;Recently we ran into this as well, immediately preceding the exception there was the warn log:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
Unable to lock JVM memory (ENOMEM). This can result in part of the JVM being swapped out, especially with mmapped I/O enabled. Increase RLIMIT_MEMLOCK. &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;(Cassandra 4.0.7 / OpenJDK 11.0.17)&lt;/p&gt;</comment>
                            <comment id="17676336" author="benedict" created="Thu, 12 Jan 2023 21:05:14 +0000"  >&lt;p&gt;Are you able to (privately) share detailed logs and schema information, so we can perhaps ascertain some information about the workload that might have triggered this problem?&lt;/p&gt;

&lt;p&gt;The exception you mention is very unlikely to be related, though it does suggest this is all happening on startup?&lt;/p&gt;</comment>
                            <comment id="17676520" author="JIRAUSER297793" created="Fri, 13 Jan 2023 08:46:21 +0000"  >&lt;p&gt;In our case 4 out of 5 Cassandra crashed one after another within a 2 hour windows after a couple of months of uptime.&lt;/p&gt;

&lt;p&gt;We have ~40 keyspaces with most of the data in Akka Persistence Cassandra Schema: &lt;a href=&quot;https://doc.akka.io/docs/akka-persistence-cassandra/current/journal.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://doc.akka.io/docs/akka-persistence-cassandra/current/journal.html&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17676565" author="benedict" created="Fri, 13 Jan 2023 10:33:34 +0000"  >&lt;p&gt;The ENOMEM log message only occurs at startup, so if your timeline is correct this error occurred after your processes first crashed, not before.&lt;/p&gt;

&lt;p&gt;Debugging problems like this requires very detailed information, including full logs and the ability to map table names to specific schema, as well as information about what queries were being run against the processes. Most of the data being in one schema is not very helpful information, unfortunately.&lt;/p&gt;</comment>
                            <comment id="17677019" author="benedict" created="Sun, 15 Jan 2023 12:09:53 +0000"  >&lt;p&gt;Looks like we may have a reproduction anyway: &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-18159&quot; title=&quot;Test Failure: repair_tests.repair_test.TestRepair.test_*dc_repair&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-18159&quot;&gt;CASSANDRA-18159&lt;/a&gt; looks plausibly the same issue.&lt;/p&gt;</comment>
                            <comment id="17690518" author="benedict" created="Fri, 17 Feb 2023 18:00:59 +0000"  >&lt;p&gt;Ok, so the simulator has given us a nice reproduction, and has permitted us to easily trace this back to &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-15511&quot; title=&quot;Utilising BTree Improvements&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-15511&quot;&gt;&lt;del&gt;CASSANDRA-15511&lt;/del&gt;&lt;/a&gt;. Specifically, we apply the same &lt;tt&gt;retain&lt;/tt&gt; calculation erroneously to &lt;em&gt;not yet inserted&lt;/em&gt; data, thereby corrupting the memtable memory usage accounting.&lt;/p&gt;

&lt;p&gt;Simple fix &lt;a href=&quot;https://github.com/apache/cassandra/pull/2169&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;here&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17690519" author="benedict" created="Fri, 17 Feb 2023 18:02:01 +0000"  >&lt;p&gt;/cc &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=blerer&quot; class=&quot;user-hover&quot; rel=&quot;blerer&quot;&gt;blerer&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17691099" author="blerer" created="Mon, 20 Feb 2023 09:30:08 +0000"  >&lt;p&gt;Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=benedict&quot; class=&quot;user-hover&quot; rel=&quot;benedict&quot;&gt;benedict&lt;/a&gt;, I will look at it today.&lt;/p&gt;</comment>
                            <comment id="17692025" author="blerer" created="Wed, 22 Feb 2023 08:39:01 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=benedict&quot; class=&quot;user-hover&quot; rel=&quot;benedict&quot;&gt;benedict&lt;/a&gt; Do you have some tests that reproduce the problem that can be added to the patch?&lt;/p&gt;</comment>
                            <comment id="17692037" author="benedict" created="Wed, 22 Feb 2023 09:00:48 +0000"  >&lt;p&gt;Jon Meredith is rustling some up&lt;/p&gt;</comment>
                            <comment id="17692326" author="jonmeredith" created="Wed, 22 Feb 2023 19:20:12 +0000"  >&lt;p&gt;I&apos;ve pushed up a couple of different reproducers here&lt;/p&gt;

&lt;p&gt;org.apache.cassandra.db.partitions.AtomicBTreePartitionMemtableAccountingTest is probably the way to go in &lt;a href=&quot;https://github.com/jonmeredith/cassandra/commit/f7452772c70b8c75da096ca1ee4375f113560f69&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/jonmeredith/cassandra/commit/f7452772c70b8c75da096ca1ee4375f113560f69&lt;/a&gt; &lt;/p&gt;

&lt;p&gt;At the moment the test fails with Bendict&apos;s fix applied as the recreated partition size is not identical. I&apos;m not sure if it&apos;s possible to pick a different cloner that will always clone the input to a dedicated buffer to make the test repeatable. I&apos;d like to extend the test with something generative so that we cover a wider range of types, partition deletion, range tombstone and complex column deletion.&lt;/p&gt;

&lt;p&gt;My previous attempt triggers the assertion, but doesn&apos;t fail the test as the flush exception is not propagated back to the test runner.&lt;br/&gt;
&lt;a href=&quot;https://github.com/jonmeredith/cassandra/commit/41e1193767ba3a0a42ab2d2b2bbac2f32f22d3de&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/jonmeredith/cassandra/commit/41e1193767ba3a0a42ab2d2b2bbac2f32f22d3de&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Tests probably need a bit of cleaning up before they should be included in a patch, but wanted to share what I had so far.&lt;/p&gt;</comment>
                            <comment id="17693386" author="jonmeredith" created="Sat, 25 Feb 2023 00:33:58 +0000"  >&lt;p&gt;I&apos;ve finished a more comprehensive test and pushed a branch including Benedicts fix.  The open question is whether it is reasonable to try and account accurately account for how much onHeap ownership there is. Benedict came up with a handy way to calculate it, but it currently fails to account for static rows.  The good news is that with the fix I&apos;m unable to trigger the assertion when releasing the allocator.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/jonmeredith/cassandra/tree/c18125-repro-trunk&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/jonmeredith/cassandra/tree/c18125-repro-trunk&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17694220" author="jonmeredith" created="Mon, 27 Feb 2023 23:34:06 +0000"  >&lt;p&gt;So Benedict has fixed the issues with the code/test as I shared it, but unfortunately there was a copy/paste bug in the test that meant complex column deletion was not being set on the partition update. Back to failing.&lt;/p&gt;

&lt;p&gt;I&apos;ve pushed recent changes, which resolve these non-test issues&lt;/p&gt;

&lt;p&gt;1) our cloning behaviour is broken for complex columns, we don&#8217;t clone empty byte buffers with cell paths&lt;br/&gt;
2) we aren&#8217;t counting additional allocations for btree backing arrays when we update one leaf with the contents of another leaf&lt;br/&gt;
3) if we merge two cells, we copy the contents whether or not they are already in the memtable&lt;br/&gt;
4) when copying back on heap from memtable during read, if we are off heap, we do it at least three times&lt;/p&gt;</comment>
                            <comment id="17694640" author="jonmeredith" created="Tue, 28 Feb 2023 16:35:56 +0000"  >&lt;p&gt;Pushed up another round of fixes, tests now pass. I&apos;m planning on looking the code over and doing some comparisons of heap usage before/after the changes.&lt;/p&gt;</comment>
                            <comment id="17694754" author="smiklosovic" created="Tue, 28 Feb 2023 21:53:25 +0000"  >&lt;p&gt;Great progress, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jonmeredith&quot; class=&quot;user-hover&quot; rel=&quot;jonmeredith&quot;&gt;jonmeredith&lt;/a&gt; . I am watching this closely. I wanted to cut 4.1.1 recently and this one is basically the one which was suggested that it would be a bummer if it was not in.&#160;&lt;/p&gt;</comment>
                            <comment id="17695391" author="jonmeredith" created="Thu, 2 Mar 2023 00:39:20 +0000"  >&lt;p&gt;Cleaned everything up and squashed for a clean review base as it didn&apos;t seem like anybody else had started. There are minor differences between each branch, but fortunately the accounting is the same between the branches.&lt;/p&gt;

&lt;p&gt;4.0: &lt;a href=&quot;https://github.com/apache/cassandra/pull/2186&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;PR&lt;/a&gt; &lt;a href=&quot;https://github.com/jonmeredith/cassandra/tree/c18125-repro-4.0&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;branch&lt;/a&gt;&lt;br/&gt;
4.1: &lt;a href=&quot;https://github.com/apache/cassandra/pull/2187&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;PR&lt;/a&gt; &lt;a href=&quot;https://github.com/jonmeredith/cassandra/tree/c18125-repro-4.1&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;branch&lt;/a&gt;&lt;br/&gt;
trunk: &lt;a href=&quot;https://github.com/apache/cassandra/pull/2188&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;PR&lt;/a&gt; &lt;a href=&quot;https://github.com/jonmeredith/cassandra/tree/c18125-repro-trunk&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;branch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;I temporarily modified the test to output allocation info for the exhaustive test and compared the two sets of output. Numbers seem very comparable - the new logic reports a little lower but as you&apos;d hope never negative like before. &lt;/p&gt;</comment>
                            <comment id="17695423" author="jonmeredith" created="Thu, 2 Mar 2023 03:16:46 +0000"  >&lt;p&gt;CI Results (pending):&lt;/p&gt;
&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;Branch&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;Source&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;Circle CI&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;Jenkins&lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;cassandra-4.0&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/jonmeredith/cassandra/tree/commit_remote_branch/CASSANDRA-18125-cassandra-4.0-EB9273A6-9018-45C1-8C26-127906CD33BE&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;branch&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://app.circleci.com/pipelines/github/jonmeredith/cassandra?branch=commit_remote_branch%2FCASSANDRA-18125-cassandra-4.0-EB9273A6-9018-45C1-8C26-127906CD33BE&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;build&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://ci-cassandra.apache.org/job/Cassandra-devbranch/2311/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;build&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;cassandra-4.1&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/jonmeredith/cassandra/tree/commit_remote_branch/CASSANDRA-18125-cassandra-4.1-EB9273A6-9018-45C1-8C26-127906CD33BE&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;branch&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://app.circleci.com/pipelines/github/jonmeredith/cassandra?branch=commit_remote_branch%2FCASSANDRA-18125-cassandra-4.1-EB9273A6-9018-45C1-8C26-127906CD33BE&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;build&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://ci-cassandra.apache.org/job/Cassandra-devbranch/2312/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;build&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;trunk&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/jonmeredith/cassandra/tree/commit_remote_branch/CASSANDRA-18125-trunk-EB9273A6-9018-45C1-8C26-127906CD33BE&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;branch&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://app.circleci.com/pipelines/github/jonmeredith/cassandra?branch=commit_remote_branch%2FCASSANDRA-18125-trunk-EB9273A6-9018-45C1-8C26-127906CD33BE&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;build&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://ci-cassandra.apache.org/job/Cassandra-devbranch/2313/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;build&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;
</comment>
                            <comment id="17695902" author="jonmeredith" created="Thu, 2 Mar 2023 21:29:02 +0000"  >&lt;p&gt;Analysis of failures - nothing that looks related to the changes. A little suspicious of MemtableSizeTest.testSize&lt;span class=&quot;error&quot;&gt;&amp;#91;skiplist_sharded&amp;#93;&lt;/span&gt;, but it is already flaky.&lt;/p&gt;

&lt;p&gt;Jenkins failures&lt;/p&gt;

&lt;p&gt;&lt;ins&gt;&lt;b&gt;4.0&lt;/b&gt;&lt;/ins&gt;&lt;/p&gt;

&lt;p&gt;Test Result (6 failures / +6)&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;dtest-novnode.repair_tests.incremental_repair_test.TestIncRepair.test_multiple_full_repairs_lcs&lt;br/&gt;
900s timeout&lt;/li&gt;
	&lt;li&gt;org.apache.cassandra.distributed.upgrade.DropCompactStorageTest.testDropCompactStorage&lt;br/&gt;
org.apache.cassandra.exceptions.UnavailableException: Cannot achieve consistency level ALL&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-17674&quot; title=&quot;Test failure: org.apache.cassandra.distributed.upgrade.DropCompactStorageTest.testDropCompactStorage&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-17674&quot;&gt;CASSANDRA-17674&lt;/a&gt; logged against it, but seems like different failure&lt;br/&gt;
passed locally, seems unrelated.&lt;/li&gt;
	&lt;li&gt;org.apache.cassandra.streaming.LongStreamingTest.terminated successfully&lt;br/&gt;
junit timeout - perhaps too long a streaming test&lt;br/&gt;
passes locally - 2mins&lt;/li&gt;
	&lt;li&gt;org.apache.cassandra.utils.LongBloomFilterTest.testConstrained&lt;br/&gt;
junit timeout&lt;br/&gt;
passes locally - 1m23sec&lt;/li&gt;
	&lt;li&gt;org.apache.cassandra.repair.RepairJobTest.testNoTreesRetainedAfterDifference-cdc&lt;br/&gt;
j11 module system error - looks like trying to measure something inside JFR class.&lt;br/&gt;
Unable to make field private final jdk.management.jfr.StreamManager jdk.management.jfr.FlightRecorderMXBeanImpl.streamHandler accessible: module jdk.management.jfr does not &quot;opens jdk.management.jfr&quot; to unnamed module @28975c28&lt;/li&gt;
	&lt;li&gt;org.apache.cassandra.db.partition.PartitionImplementationTest.testRowsWithStatic&lt;br/&gt;
junit timeout&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;&lt;ins&gt;&lt;b&gt;4.1&lt;/b&gt;&lt;/ins&gt;&lt;/p&gt;

&lt;p&gt;Test Result (3 failures / -3)&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;dtest-novnode.transient_replication_test.TestTransientReplicationRepairStreamEntireSSTable.test_transient_incremental_repair&lt;br/&gt;
missing Incoming stream entireSSTable=...from log&lt;/li&gt;
	&lt;li&gt;org.apache.cassandra.tools.TopPartitionsTest.testServiceTopPartitionsSingleTable&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-17798&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/CASSANDRA-17798&lt;/a&gt;&lt;br/&gt;
junit.framework.AssertionFailedError: If this failed you probably have to raise the beginLocalSampling duration expected:&amp;lt;1&amp;gt; but was:&amp;lt;0&amp;gt;&lt;br/&gt;
at org.apache.cassandra.tools.TopPartitionsTest.testServiceTopPartitionsSingleTable(TopPartitionsTest.java:83)&lt;br/&gt;
at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)&lt;br/&gt;
at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)&lt;br/&gt;
at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;&lt;ins&gt;&lt;b&gt;trunk&lt;/b&gt;&lt;/ins&gt;&lt;/p&gt;

&lt;p&gt;unable to clean tmp on the arm build&lt;/p&gt;

&lt;p&gt;CircleCI failures&lt;/p&gt;

&lt;p&gt;&lt;ins&gt;&lt;b&gt;4.0&lt;/b&gt;&lt;/ins&gt;&lt;/p&gt;

&lt;p&gt;j8 upgrade - org.apache.cassandra.distributed.upgrade.DropCompactStorageTest - test shutdown timeout&lt;/p&gt;

&lt;p&gt;&lt;ins&gt;&lt;b&gt;4.1&lt;/b&gt;&lt;/ins&gt;&lt;/p&gt;

&lt;p&gt;j8 org.apache.cassandra.index.sasi.SASICQLTest - testPagingWithClustering-system_keyspace_directory - passes locally, no JIRA, nothing in Butler&lt;/p&gt;

&lt;p&gt;j11 org.apache.cassandra.cql3.MemtableSizeTest.testSize&lt;span class=&quot;error&quot;&gt;&amp;#91;skiplist_sharded&amp;#93;&lt;/span&gt; - flaky test with built in retry. Locally fails intermittently on j11 due to java module system exports when trying to measure deep sizes of objects inside the java.desktop module - perhaps related to IDEA java agent or something like that.&lt;/p&gt;

&lt;p&gt;&lt;ins&gt;&lt;b&gt;trunk&lt;/b&gt;&lt;/ins&gt;&lt;/p&gt;

&lt;p&gt;j8 org.apache.cassandra.db.compaction.CompactionStrategyManagerBoundaryReloadTest&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-18144&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/CASSANDRA-18144&lt;/a&gt; - review in progress&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;one shard did not run upgrade tests &lt;a href=&quot;https://app.circleci.com/pipelines/github/jonmeredith/cassandra/746/workflows/5e928d77-0717-4ae0-ad1d-7883871c7f8e/jobs/5122&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://app.circleci.com/pipelines/github/jonmeredith/cassandra/746/workflows/5e928d77-0717-4ae0-ad1d-7883871c7f8e/jobs/5122&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;j11 org.apache.cassandra.db.compaction.CompactionStrategyManagerBoundaryReloadTest also failed&lt;br/&gt;
same issue as above.&lt;/p&gt;</comment>
                            <comment id="17697428" author="blerer" created="Tue, 7 Mar 2023 13:15:08 +0000"  >&lt;p&gt;The patches looks good to me. Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jonmeredith&quot; class=&quot;user-hover&quot; rel=&quot;jonmeredith&quot;&gt;jonmeredith&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=benedict&quot; class=&quot;user-hover&quot; rel=&quot;benedict&quot;&gt;benedict&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="17707383" author="adelapena" created="Fri, 31 Mar 2023 18:06:40 +0000"  >&lt;p&gt;This seems to have made &lt;tt&gt;o.a.c.cql3.validation.operations.AlterTest#testDropListAndAddListWithSameName&lt;/tt&gt; flaky, as reported in &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-18360&quot; title=&quot;Test Failure: o.a.c.cql3.validation.operations.AlterTest#testDropListAndAddListWithSameName&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-18360&quot;&gt;CASSANDRA-18360&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://app.circleci.com/pipelines/github/adelapena/cassandra/2758/workflows/f9c1b471-3804-4b9b-acf8-2a1201591088&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;This run&lt;/a&gt; for the commit immediately before &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-18125&quot; title=&quot;Improve memtable allocator accounting when updating AtomicBTreePartition&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-18125&quot;&gt;&lt;del&gt;CASSANDRA-18125&lt;/del&gt;&lt;/a&gt; succeeds.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://app.circleci.com/pipelines/github/adelapena/cassandra/2757/workflows/ebbe5032-fc89-41c1-9603-f4336f20cdc3&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;This other run&lt;/a&gt; for the 4.1-trunk merge commit of &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-18125&quot; title=&quot;Improve memtable allocator accounting when updating AtomicBTreePartition&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-18125&quot;&gt;&lt;del&gt;CASSANDRA-18125&lt;/del&gt;&lt;/a&gt; fails reproducing the current issue.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://app.circleci.com/pipelines/github/adelapena/cassandra/2745/workflows/6eb7b890-40de-4ffe-b1f7-16b26ed19b42&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;This run&lt;/a&gt; for the current 4.1 branch successes, suggesting that probably the failure only affects trunk. I haven&apos;t tested 4.0 yet.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310660">
                    <name>Completes</name>
                                            <outwardlinks description="fixes">
                                        <issuelink>
            <issuekey id="13524054">CASSANDRA-18253</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                            <issuelinktype id="12310560">
                    <name>Problem/Incident</name>
                                            <outwardlinks description="causes">
                                        <issuelink>
            <issuekey id="13529960">CASSANDRA-18360</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="13519651">CASSANDRA-18159</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="13524975">CASSANDRA-18266</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="13524054">CASSANDRA-18253</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[benedict]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12313825" key="com.atlassian.jira.plugin.system.customfieldtypes:cascadingselect">
                        <customfieldname>Bug Category</customfieldname>
                        <customfieldvalues>
                                                    <customfieldvalue key="12982" cascade-level=""><![CDATA[Correctness]]></customfieldvalue>
                                <customfieldvalue key="12986" cascade-level="1"><![CDATA[Recoverable Corruption / Loss]]></customfieldvalue>
            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12313821" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Complexity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12966"><![CDATA[Challenging]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313822" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Discovered By</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12969"><![CDATA[User Report]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12313922" key="jira.plugin.projectspecificselectfield.jpssf:multicftype">
                        <customfieldname>Impacts</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="13100"><![CDATA[None]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            2 years, 32 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12313921" key="jira.plugin.projectspecificselectfield.jpssf:multicftype">
                        <customfieldname>Platform</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="13076"><![CDATA[All]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z1e8i0:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[blerer]]></customfieldvalue>
        <customfieldvalue><![CDATA[jmeredithco]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12962"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12311420" key="com.atlassian.jira.plugin.system.customfieldtypes:version">
                        <customfieldname>Since Version</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="12351655">4.0.5</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313924" key="com.atlassian.jira.plugin.system.customfieldtypes:textfield">
                        <customfieldname>Source Control Link</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>&lt;p&gt;&lt;a href=&quot;https://github.com/apache/cassandra/commit/40f9ca60f103783aa481bc9a91b92fd55b4ea625&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/cassandra/commit/40f9ca60f103783aa481bc9a91b92fd55b4ea625&lt;/a&gt;&lt;/p&gt;</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313823" key="com.atlassian.jira.plugin.system.customfieldtypes:textarea">
                        <customfieldname>Test and Documentation Plan</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>&lt;p&gt;Test included that reproduces issue and checks fixed.&lt;/p&gt;</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>