<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 23:03:17 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-11920] bloom_filter_fp_chance needs to be validated up front</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-11920</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;Hi,&lt;/p&gt;

&lt;p&gt;I was doing some bench-marking on bloom_filter_fp_chance values. Everything worked fine for values .01(default for STCS), .001, .0001. But when I set bloom_filter_fp_chance = .00001 i observed following behaviour:&lt;/p&gt;

&lt;p&gt;1). Reads and writes looked normal from cqlsh.&lt;br/&gt;
2). SSttables are never created.&lt;br/&gt;
3). It just creates two files (*-Data.db and *-index.db) of size 0kb.&lt;br/&gt;
4). nodetool flush does not work and produce following exception:&lt;/p&gt;

&lt;p&gt;java.lang.UnsupportedOperationException: Unable to satisfy 1.0E-5 with 20 buckets per element&lt;br/&gt;
        at org.apache.cassandra.utils.BloomCalculations.computeBloomSpec(BloomCalculations.java:150) .....&lt;/p&gt;


&lt;p&gt;I checked BloomCalculations class and following lines are responsible for this exception:&lt;/p&gt;

&lt;p&gt;if (maxFalsePosProb &amp;lt; probs&lt;span class=&quot;error&quot;&gt;&amp;#91;maxBucketsPerElement&amp;#93;&lt;/span&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;maxK&amp;#93;&lt;/span&gt;) &lt;/p&gt;
{
      throw new UnsupportedOperationException(String.format(&quot;Unable to satisfy %s with %s buckets per element&quot;,
                                                 maxFalsePosProb, maxBucketsPerElement));
  }


&lt;p&gt;From  the code it looks like a hard coaded validation (unless we can change the nuber of buckets).&lt;br/&gt;
So, if this validation is hard coaded then why it is even allowed to set such value of bloom_fileter_fp_chance, that can prevent ssTable generation?&lt;/p&gt;

&lt;p&gt;Please correct this issue.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12973919">CASSANDRA-11920</key>
            <summary>bloom_filter_fp_chance needs to be validated up front</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10003" iconUrl="https://issues.apache.org/jira/images/icons/priorities/trivial.svg">Low</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="arindamg">Arindam Gupta</assignee>
                                    <reporter username="adarsh0007@gmail.com">ADARSH KUMAR</reporter>
                        <labels>
                            <label>lhf</label>
                    </labels>
                <created>Mon, 30 May 2016 09:04:04 +0000</created>
                <updated>Tue, 16 Apr 2019 09:30:31 +0000</updated>
                            <resolved>Tue, 21 Jun 2016 16:17:20 +0000</resolved>
                                        <fixVersion>2.2.7</fixVersion>
                    <fixVersion>3.0.8</fixVersion>
                    <fixVersion>3.8</fixVersion>
                                    <component>Legacy/Local Write-Read Paths</component>
                    <component>Local/Startup and Shutdown</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="15308150" author="thobbs" created="Tue, 31 May 2016 17:15:35 +0000"  >&lt;p&gt;To clarify, what we really need to do here is check the &lt;tt&gt;bloom_filter_fp_chance&lt;/tt&gt; against our minimum supported value (found in &lt;tt&gt;BloomCalculations&lt;/tt&gt;) as part of the schema change validation, and reject the query if it&apos;s too low.&lt;/p&gt;</comment>
                            <comment id="15322471" author="arindamg" created="Thu, 9 Jun 2016 13:12:14 +0000"  >&lt;p&gt;I am looking into this issue, I am very new to C* as this is the first issue I am looking into, so my codebase knowledge is very limited. Following Tyler&apos;s comment I feel validation should go into TableParams validate() method, but BloomCalculations class is having default access modifier, so not accessible from TableParams, is there any other place where bloom_filter_fp_chance minimum supported value is kept?&lt;/p&gt;</comment>
                            <comment id="15329879" author="thobbs" created="Tue, 14 Jun 2016 16:53:08 +0000"  >&lt;blockquote&gt;&lt;p&gt;I feel validation should go into TableParams validate() method&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Yes, that&apos;s the correct place for this.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;BloomCalculations class is having default access modifier, so not accessible from TableParams&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Feel free to make classes, methods, or fields public as needed to support this.&lt;/p&gt;</comment>
                            <comment id="15335833" author="arindamg" created="Fri, 17 Jun 2016 10:29:05 +0000"  >&lt;p&gt;Attached a patch with the fix. I have not added any unit test as could not find corresponding unit test files for these classes, however tested it with cqlsh. Please review.&lt;/p&gt;</comment>
                            <comment id="15336970" author="thobbs" created="Fri, 17 Jun 2016 21:13:10 +0000"  >&lt;p&gt;Thanks for the patch!&lt;/p&gt;

&lt;p&gt;I&apos;ve created a new unit test to exercise this.  I also backported the patch to 2.2, since that&apos;s affected as well.&lt;/p&gt;

&lt;p&gt;Here are the patches and pending CI test runs:&lt;/p&gt;
&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;branch&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;testall&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;dtest&lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/thobbs/cassandra/tree/CASSANDRA-11920-2.2&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;CASSANDRA-11920-2.2&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/thobbs/job/thobbs-CASSANDRA-11920-2.2-testall&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;testall&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/thobbs/job/thobbs-CASSANDRA-11920-2.2-dtest&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;dtest&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/thobbs/cassandra/tree/CASSANDRA-11920-3.0&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;CASSANDRA-11920-3.0&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/thobbs/job/thobbs-CASSANDRA-11920-3.0-testall&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;testall&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/thobbs/job/thobbs-CASSANDRA-11920-3.0-dtest&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;dtest&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/thobbs/cassandra/tree/CASSANDRA-11920-trunk&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;CASSANDRA-11920-trunk&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/thobbs/job/thobbs-CASSANDRA-11920-trunk-testall&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;testall&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/thobbs/job/thobbs-CASSANDRA-11920-trunk-dtest&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;dtest&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;


&lt;p&gt;If the tests look good, I&apos;ll commit this.&lt;/p&gt;</comment>
                            <comment id="15339015" author="arindamg" created="Mon, 20 Jun 2016 05:27:52 +0000"  >&lt;p&gt;Thanks Tyler Hobbs for your help. Please let me know if any further actions required from my side. &lt;br/&gt;
One additional question : Do we need to change documentation also reflecting this change?&lt;/p&gt;</comment>
                            <comment id="15342077" author="thobbs" created="Tue, 21 Jun 2016 16:17:20 +0000"  >&lt;p&gt;The tests look good, so +1, committed as &lt;tt&gt;9e85e85bf259cc7839226a7c93475505d262946a&lt;/tt&gt; to 2.2 and merged up to 3.0 and trunk.&lt;/p&gt;

&lt;p&gt;I don&apos;t think any documentation change is required here.  There has always been a minimum supported bloom filter FP ratio, we just failed to enforce at the right point.&lt;/p&gt;

&lt;p&gt;Thanks again for the patch!&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12811339" name="11920-3.0.txt" size="2906" author="arindamg" created="Fri, 17 Jun 2016 10:26:43 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[arindamg]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 22 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2yoq7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12311421" key="com.atlassian.jira.plugin.system.customfieldtypes:multiversion">
                        <customfieldname>Reproduced In</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="12334361">3.0.3</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>thobbs</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[thobbs]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12961"><![CDATA[Low]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311124" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Tester</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>adarsh0007@gmail.com</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>