<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 23:20:33 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-16654] Junit RepeatableRunner flaky tests helper</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-16654</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;Some flakies only fail when the full suite is ran. If it&apos;s a quick test you can do thousands of runs if a few seconds. Looping at the sh level is not an option as every loop takes a few seconds.&lt;/p&gt;

&lt;p&gt;As I have found this very useful I am proposing committing it&lt;/p&gt;</description>
                <environment></environment>
        <key id="13376758">CASSANDRA-16654</key>
            <summary>Junit RepeatableRunner flaky tests helper</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10002" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Normal</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="bereng">Berenguer Blasi</assignee>
                                    <reporter username="bereng">Berenguer Blasi</reporter>
                        <labels>
                    </labels>
                <created>Wed, 5 May 2021 09:06:45 +0000</created>
                <updated>Fri, 10 Oct 2025 08:47:46 +0000</updated>
                            <resolved>Tue, 18 May 2021 04:47:32 +0000</resolved>
                                        <fixVersion>3.0.25</fixVersion>
                    <fixVersion>3.11.11</fixVersion>
                    <fixVersion>4.0-rc2</fixVersion>
                    <fixVersion>4.0</fixVersion>
                    <fixVersion>4.1-alpha1</fixVersion>
                    <fixVersion>4.1</fixVersion>
                                    <component>Test/unit</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="17343343" author="adelapena" created="Wed, 12 May 2021 16:21:27 +0000"  >&lt;p&gt;I think this is a nice addition to our tool belt, thanks. It will be useful at least until we have JUnit 5&apos;s &lt;a href=&quot;https://junit.org/junit5/docs/5.0.1/api/org/junit/jupiter/api/RepeatedTest.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;@RepeatedTest&lt;/a&gt; available, someday.&lt;/p&gt;

&lt;p&gt;Maybe we could add a few implementations for our most common runners, as proposed &lt;a href=&quot;https://github.com/adelapena/cassandra/commit/65cd829bc73e1a9232e11c0bcfbeaccee2536c53&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;here&lt;/a&gt;, so we can use annotations such as &lt;tt&gt;@RunWith(RepeatableRunner.Parameterized.class)&lt;/tt&gt;, &lt;tt&gt;@RunWith(RepeatableRunner.BMUnitRunner.class)&lt;/tt&gt;, etc., wdyt?&lt;/p&gt;

&lt;p&gt;I would add a note in the documentation about how many tests alter singletons and so they don&apos;t work with the repeatable runner.&lt;/p&gt;

&lt;p&gt;We could put the number of repetitions in a &lt;tt&gt;RepeatableRunner&lt;/tt&gt; constant for better visibility, and maybe also add the possibility of reading the value from a JVM property, as it&apos;s done &lt;a href=&quot;https://github.com/adelapena/cassandra/blob/65cd829bc73e1a9232e11c0bcfbeaccee2536c53/test/unit/org/apache/cassandra/RepeatableRunner.java#L35&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;here&lt;/a&gt;. The later is probably not so useful since we are nevertheless forced to temporary modify the code when setting the runner.&lt;/p&gt;</comment>
                            <comment id="17343757" author="bereng" created="Thu, 13 May 2021 07:37:18 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=adelapena&quot; class=&quot;user-hover&quot; rel=&quot;adelapena&quot;&gt;adelapena&lt;/a&gt; your proposal sounds great. I modified it a bit to have a param for the runner for the number of repetitions. Sounds most convenient imo wdyt?. Please check the &lt;a href=&quot;https://github.com/apache/cassandra/pull/1006&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;4.0 PR&lt;/a&gt; not the trunk one for the final version. &lt;tt&gt;DirectoriesTest&lt;/tt&gt; modifications are not part of the PR, I left it there just for your convenience to test it.&lt;/p&gt;</comment>
                            <comment id="17343831" author="adelapena" created="Thu, 13 May 2021 12:04:23 +0000"  >&lt;p&gt;I really like the idea of using an annotation for the runner parameters. I spent some time trying to figure out how to extend&#160;&lt;tt&gt;RunWith&lt;/tt&gt; without any success, but the additional annotation approach is simple and effective. Indeed, we could get rid of the inner subclasses for wrapped runners and just add the wrapped runner to the annotation, so we can use something like:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
@RunWith(RepeatableRunner.class)
@RepeatableRunnerConfiguration(iterations = 5, runner = Parameterized.class)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Or:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
@RunWith(RepeatableRunner.class)
@RepeatableRunnerConfiguration(iterations = 5, runner = BMUnitRunner.class)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Differently from the subclasses approach, this should work with any kind of runner. I gave it a go &lt;a href=&quot;https://github.com/adelapena/cassandra/commit/b222faab156e119bfa82b6b8d7e909c22d8be12c&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;here&lt;/a&gt; (some examples included), wdyt?&#160;&lt;/p&gt;</comment>
                            <comment id="17343835" author="adelapena" created="Thu, 13 May 2021 12:10:53 +0000"  >&lt;p&gt;Also, I wonder if we should mention the existence of this runner in the &lt;a href=&quot;https://github.com/apache/cassandra/blob/trunk/doc/source/development/testing.rst#unit-testing&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;documentation for testing&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="17343840" author="bereng" created="Thu, 13 May 2021 12:25:08 +0000"  >&lt;p&gt;Ha! I was thinking along the same lines but for some reason it didn&apos;t occur to me as you did it which is super-nice imo. This is great as it is completely Runner agnostic and non-invasive. Also I think junit5 repeats at the method level not a &lt;em&gt;class&lt;/em&gt; level.&lt;/p&gt;

&lt;p&gt;What we have is good but I want to linger here a bit more and see if I can somehow avoid having to decorate a class with Runners. Like call a Runner programmatically and pass the test class as a param...&lt;/p&gt;</comment>
                            <comment id="17343928" author="adelapena" created="Thu, 13 May 2021 15:16:41 +0000"  >&lt;blockquote&gt;&lt;p&gt;What we have is good but I want to linger here a bit more and see if I can somehow avoid having to decorate a class with Runners. Like call a Runner programmatically and pass the test class as a param...&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Being able to run repeatedly without modifying the test would certainly be great, looking forward to something that can do that.&lt;/p&gt;</comment>
                            <comment id="17344461" author="bereng" created="Fri, 14 May 2021 08:31:44 +0000"  >&lt;p&gt;There&apos;s no easy way to make ant take a runner as a parameter. You have to create a plugin etc etc. Alternatives are also quite involved. If I have not lost track of the things I think what we have is the most reasonable option.&lt;/p&gt;

&lt;p&gt;Edit: Added doc notes.&lt;/p&gt;</comment>
                            <comment id="17344515" author="adelapena" created="Fri, 14 May 2021 10:26:40 +0000"  >&lt;blockquote&gt;&lt;p&gt;There&apos;s no easy way to make ant take a runner as a parameter. You have to create a plugin etc etc. Alternatives are also quite involved. If I have not lost track of the things I think what we have is the most reasonable option.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Agree, I played a bit with &lt;tt&gt;JUnitTask&lt;/tt&gt;/&lt;tt&gt;JStackJUnitTask&lt;/tt&gt; while working on the CircleCI multiplexer and it seems probably more involved than we need right now. I think it&apos;s better if we commit this as it is, so it starts to help us with 4.0 immediately. We can always come back later to add the repetitions as an Ant parameter.&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;Edit: Added doc notes.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;The new section about flaky tests is nice, thanks. I&apos;ve left a couple of very minor suggestions in the PR that can be addressed during commit.&lt;/p&gt;

&lt;p&gt;I think we are ready to commit. IMO it would be nice if we added the runner also to 3.0 and 3.11, it should be a straightforward merge.&lt;/p&gt;

&lt;p&gt;Also, just a reminder to remove the usages of &lt;tt&gt;RepeatableRunner&lt;/tt&gt; that we have added as examples (&lt;tt&gt;DirectoriesTest&lt;/tt&gt;, &lt;tt&gt;ColumnFilterTest&lt;/tt&gt;, &lt;tt&gt;AssureSufficientLiveNodesTest&lt;/tt&gt; and &lt;tt&gt;SpeculativeRetryParseTest&lt;/tt&gt;)&lt;/p&gt;</comment>
                            <comment id="17345954" author="bereng" created="Mon, 17 May 2021 08:12:50 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=adelapena&quot; class=&quot;user-hover&quot; rel=&quot;adelapena&quot;&gt;adelapena&lt;/a&gt; all cleaned, PRs for all versions pushed &amp;amp; CI attached. I&apos;ll wait for your final +1 before committing just to be on the safe side now we have all PRs up.&lt;/p&gt;</comment>
                            <comment id="17346067" author="adelapena" created="Mon, 17 May 2021 10:50:46 +0000"  >&lt;p&gt;Looks good to me, +1, I think this runner will be very helpful &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="17346147" author="edimitrova" created="Mon, 17 May 2021 13:07:26 +0000"  >&lt;p&gt;Hey, I just sneaked into this ticket quickly and it seems great tool for someone new who can use it locally. I suggest you mentioned it on the mailing list, same as the other multiplexer from last week so people don&apos;t miss it as it will be very helpful! Thank you!&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310460">
                    <name>Child-Issue</name>
                                                                <inwardlinks description="is a child of">
                                        <issuelink>
            <issuekey id="13374176">CASSANDRA-16625</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="13374616">CASSANDRA-16627</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[adelapena]]></customfieldvalue>
        <customfieldvalue><![CDATA[bereng]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12313825" key="com.atlassian.jira.plugin.system.customfieldtypes:cascadingselect">
                        <customfieldname>Bug Category</customfieldname>
                        <customfieldvalues>
                                                    <customfieldvalue key="13163" cascade-level=""><![CDATA[Code]]></customfieldvalue>
            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12313821" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Complexity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12965"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313822" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Discovered By</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12970"><![CDATA[Unit Test]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12313922" key="jira.plugin.projectspecificselectfield.jpssf:multicftype">
                        <customfieldname>Impacts</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="13100"><![CDATA[None]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            4 years, 26 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12313921" key="jira.plugin.projectspecificselectfield.jpssf:multicftype">
                        <customfieldname>Platform</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="13076"><![CDATA[All]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0qqrs:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[adelapena]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12962"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12311420" key="com.atlassian.jira.plugin.system.customfieldtypes:version">
                        <customfieldname>Since Version</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="12333891">3.0.0</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313924" key="com.atlassian.jira.plugin.system.customfieldtypes:textfield">
                        <customfieldname>Source Control Link</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>&lt;p&gt;&lt;a href=&quot;https://github.com/apache/cassandra/commit/fdabda1da849efdb2f0066a341b9cc24de7fd05c&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/cassandra/commit/fdabda1da849efdb2f0066a341b9cc24de7fd05c&lt;/a&gt;&lt;/p&gt;</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313823" key="com.atlassian.jira.plugin.system.customfieldtypes:textarea">
                        <customfieldname>Test and Documentation Plan</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>&lt;p&gt;If can be tested by trying to run &lt;tt&gt;DirectoriesTest&lt;/tt&gt; a few times i.e.&lt;/p&gt;</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>