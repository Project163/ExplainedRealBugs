<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 22:51:11 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-8067] NullPointerException in KeyCacheSerializer</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-8067</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;Hi,&lt;/p&gt;

&lt;p&gt;I have this stack trace in the logs of Cassandra server (v2.1)&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;ERROR [CompactionExecutor:14] 2014-10-06 23:32:02,098 CassandraDaemon.java:166 - Exception in thread &lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;[CompactionExecutor:14,1,main]
java.lang.NullPointerException: &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;
        at org.apache.cassandra.service.CacheService$KeyCacheSerializer.serialize(CacheService.java:475) ~[apache-cassandra-2.1.0.jar:2.1.0]
        at org.apache.cassandra.service.CacheService$KeyCacheSerializer.serialize(CacheService.java:463) ~[apache-cassandra-2.1.0.jar:2.1.0]
        at org.apache.cassandra.cache.AutoSavingCache$Writer.saveCache(AutoSavingCache.java:225) ~[apache-cassandra-2.1.0.jar:2.1.0]
        at org.apache.cassandra.db.compaction.CompactionManager$11.run(CompactionManager.java:1061) ~[apache-cassandra-2.1.0.jar:2.1.0]
        at java.util.concurrent.Executors$RunnableAdapter.call(Unknown Source) ~[na:1.7.0]
        at java.util.concurrent.FutureTask$Sync.innerRun(Unknown Source) ~[na:1.7.0]
        at java.util.concurrent.FutureTask.run(Unknown Source) ~[na:1.7.0]
        at java.util.concurrent.ThreadPoolExecutor.runWorker(Unknown Source) [na:1.7.0]
        at java.util.concurrent.ThreadPoolExecutor$Worker.run(Unknown Source) [na:1.7.0]
        at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(Unknown Source) [na:1.7.0]
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;It may not be critical because this error occured in the AutoSavingCache. However the line 475 is about the CFMetaData so it may hide bigger issue...&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt; 474             CFMetaData cfm = Schema.instance.getCFMetaData(key.desc.ksname, key.desc.cfname);
 475             cfm.comparator.rowIndexEntrySerializer().serialize(entry, out);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Regards,&lt;br/&gt;
Eric&lt;/p&gt;</description>
                <environment></environment>
        <key id="12746343">CASSANDRA-8067</key>
            <summary>NullPointerException in KeyCacheSerializer</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10002" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Normal</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="aleksey">Aleksey Yeschenko</assignee>
                                    <reporter username="leleueri">Eric Leleu</reporter>
                        <labels>
                    </labels>
                <created>Tue, 7 Oct 2014 08:02:42 +0000</created>
                <updated>Tue, 16 Apr 2019 09:31:32 +0000</updated>
                            <resolved>Tue, 3 Mar 2015 22:11:13 +0000</resolved>
                                        <fixVersion>2.1.5</fixVersion>
                                        <due></due>
                            <votes>7</votes>
                                    <watches>15</watches>
                                                                                                                <comments>
                            <comment id="14182958" author="yukim" created="Fri, 24 Oct 2014 15:49:15 +0000"  >&lt;p&gt;This should be fixed in 2.1.1. (&lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-7784&quot; title=&quot;DROP table leaves the counter and row cache in a temporarily inconsistent state that, if saved during, will cause an exception to be thrown&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-7784&quot;&gt;&lt;del&gt;CASSANDRA-7784&lt;/del&gt;&lt;/a&gt;)&lt;/p&gt;</comment>
                            <comment id="14201811" author="anguenot" created="Fri, 7 Nov 2014 08:58:02 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=yukim&quot; class=&quot;user-hover&quot; rel=&quot;yukim&quot;&gt;yukim&lt;/a&gt; our production cluster been freshly migrated from 2.0.11 to 2.1.1 yesterday. Everything is running well except for this error which is happening on every cluster node after migration:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;ERROR [CompactionExecutor:1] 2014-11-07 07:54:24,599 CassandraDaemon.java:153 - Exception in thread &lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;[CompactionExecutor:1,1,main]
java.lang.NullPointerException: &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;
        at org.apache.cassandra.service.CacheService$KeyCacheSerializer.serialize(CacheService.java:475) ~[apache-cassandra-2.1.1.jar:2.1.1]
        at org.apache.cassandra.service.CacheService$KeyCacheSerializer.serialize(CacheService.java:463) ~[apache-cassandra-2.1.1.jar:2.1.1]
        at org.apache.cassandra.cache.AutoSavingCache$Writer.saveCache(AutoSavingCache.java:236) ~[apache-cassandra-2.1.1.jar:2.1.1]
        at org.apache.cassandra.db.compaction.CompactionManager$11.run(CompactionManager.java:1089) ~[apache-cassandra-2.1.1.jar:2.1.1]
        at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:471) ~[na:1.7.0_72]
        at java.util.concurrent.FutureTask.run(FutureTask.java:262) ~[na:1.7.0_72]
        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1145) ~[na:1.7.0_72]
        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:615) [na:1.7.0_72]
        at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:745) [na:1.7.0_72]
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Let me know if I can provide more info.&lt;/p&gt;</comment>
                            <comment id="14202226" author="yukim" created="Fri, 7 Nov 2014 16:32:35 +0000"  >&lt;p&gt;Okay, thanks for reporting.&lt;/p&gt;

&lt;p&gt;I thought CacheService.java:475 indicates that saving key cache for table that does not exist any more, and &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-7784&quot; title=&quot;DROP table leaves the counter and row cache in a temporarily inconsistent state that, if saved during, will cause an exception to be thrown&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-7784&quot;&gt;&lt;del&gt;CASSANDRA-7784&lt;/del&gt;&lt;/a&gt; added schema existance check before serializing cache. Thus I marked this as duplicate.&lt;/p&gt;

&lt;p&gt;Do you still see the error constantly? Or just after the migration?&lt;/p&gt;</comment>
                            <comment id="14204517" author="anguenot" created="Mon, 10 Nov 2014 09:00:17 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=yukim&quot; class=&quot;user-hover&quot; rel=&quot;yukim&quot;&gt;yukim&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;yes after 2 days I can still see the error happening at least once a day on each node.&lt;/p&gt;

&lt;p&gt;Now, that the 2.1.1 cluster has been running it&apos;s been 2 days and having only this error which is not breaking our application, I am now upgrading the sstables which I purposely delayed to make sure that the cluster was stable. I will report again after sstables on all nodes are migrated to let you know if whether or not this issue is persisting.&lt;/p&gt;</comment>
                            <comment id="14206159" author="andie78" created="Tue, 11 Nov 2014 08:43:22 +0000"  >&lt;p&gt;I still have the same issue running since a few weeks w/ 2.1.1 and I already upgraded the sstables on that node. There are a lot in my system.log. In 2.0.10 there was not such an issue. I still have most nodes running on 2.0.10. I&apos;m curious for Yuki&apos;s report, if upgrading the whole cluster fixes the problem. You can see my system.log at &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-8192&quot; title=&quot;Better error logging on corrupt compressed SSTables: currently AssertionError in Memory.java&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-8192&quot;&gt;&lt;del&gt;CASSANDRA-8192&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="14217774" author="andie78" created="Wed, 19 Nov 2014 11:32:27 +0000"  >&lt;p&gt;Today I got that failure during nodetool upgradesstables after upgrading from 2.0.10 to 2.1.2 w/ finalizer-patch &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-6283&quot; title=&quot;Windows 7 data files kept open / can&amp;#39;t be deleted after compaction.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-6283&quot;&gt;&lt;del&gt;CASSANDRA-6283&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;ERROR [CompactionExecutor:65] 2014-11-19 09:56:02,453 CassandraDaemon.java:153 - Exception in thread Thread[CompactionExecutor:65,1,main]
java.lang.NullPointerException: null
	at org.apache.cassandra.service.CacheService$KeyCacheSerializer.serialize(CacheService.java:475) ~[apache-cassandra-2.1.2-SNAPSHOT.jar:2.1.2-SNAPSHOT]
	at org.apache.cassandra.service.CacheService$KeyCacheSerializer.serialize(CacheService.java:463) ~[apache-cassandra-2.1.2-SNAPSHOT.jar:2.1.2-SNAPSHOT]
	at org.apache.cassandra.cache.AutoSavingCache$Writer.saveCache(AutoSavingCache.java:274) ~[apache-cassandra-2.1.2-SNAPSHOT.jar:2.1.2-SNAPSHOT]
	at org.apache.cassandra.db.compaction.CompactionManager$11.run(CompactionManager.java:1088) ~[apache-cassandra-2.1.2-SNAPSHOT.jar:2.1.2-SNAPSHOT]
	at java.util.concurrent.Executors$RunnableAdapter.call(Unknown Source) ~[na:1.7.0_55]
	at java.util.concurrent.FutureTask.run(Unknown Source) ~[na:1.7.0_55]
	at java.util.concurrent.ThreadPoolExecutor.runWorker(Unknown Source) [na:1.7.0_55]
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(Unknown Source) [na:1.7.0_55]
	at java.lang.Thread.run(Unknown Source) [na:1.7.0_55]
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="14217829" author="yukim" created="Wed, 19 Nov 2014 12:31:59 +0000"  >&lt;p&gt;reopening for investigation&lt;/p&gt;</comment>
                            <comment id="14223464" author="anguenot" created="Mon, 24 Nov 2014 20:29:27 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mokemokechicken&quot; class=&quot;user-hover&quot; rel=&quot;mokemokechicken&quot;&gt;mokemokechicken&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=Andie78&quot; class=&quot;user-hover&quot; rel=&quot;Andie78&quot;&gt;Andie78&lt;/a&gt; error definitely still occurring in a cluster where all nodes are running 2.1.2: error happening against every node of the cluster on regular basis. The same cluster running 2.0.11 did not have that particular issue before migration.&lt;/p&gt;</comment>
                            <comment id="14253159" author="rfurmanski" created="Fri, 19 Dec 2014 09:02:38 +0000"  >&lt;p&gt;I have exact the same issue in v. 2.1.2 on all nodes in my cluster:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;ERROR [CompactionExecutor:1528] 2014-12-19 05:38:47,155 CassandraDaemon.java:153 - Exception in thread Thread[CompactionExecutor:1528,1,main]
java.lang.NullPointerException: null
        at org.apache.cassandra.service.CacheService$KeyCacheSerializer.serialize(CacheService.java:475) ~[apache-cassandra-2.1.2.jar:2.1.2]
        at org.apache.cassandra.service.CacheService$KeyCacheSerializer.serialize(CacheService.java:463) ~[apache-cassandra-2.1.2.jar:2.1.2]
        at org.apache.cassandra.cache.AutoSavingCache$Writer.saveCache(AutoSavingCache.java:274) ~[apache-cassandra-2.1.2.jar:2.1.2]
        at org.apache.cassandra.db.compaction.CompactionManager$11.run(CompactionManager.java:1088) ~[apache-cassandra-2.1.2.jar:2.1.2]
        at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:471) ~[na:1.7.0_72]
        at java.util.concurrent.FutureTask.run(FutureTask.java:262) ~[na:1.7.0_72]
        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1145) ~[na:1.7.0_72]
        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:615) [na:1.7.0_72]
        at java.lang.Thread.run(Thread.java:745) [na:1.7.0_72]
INFO  [CompactionExecutor:1529] 2014-12-19 05:38:47,313 AutoSavingCache.java:302 - Saved CounterCache (6149 items) in 130 ms
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="14275514" author="benedict" created="Tue, 13 Jan 2015 16:42:46 +0000"  >&lt;p&gt;This looks like an issue with serializing data for a dropped table. We should also be looking up the cfMetadata with our UUID, else we can have some weirdness with a serialization crossing a drop/recreate boundary, which would be especially problematic with different schema.&lt;/p&gt;</comment>
                            <comment id="14301040" author="rfurmanski" created="Mon, 2 Feb 2015 09:19:24 +0000"  >&lt;p&gt;It happened once again during repair session:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;INFO  [CompactionExecutor:243] 2015-02-02 06:30:00,845 CompactionTask.java:251 - Compacted 2 sstables to [].  319 bytes to 0 (~0% of original) in 1ms = 0.000000MB/s.  2 total partitions merged to 0.  Partition merge counts were {2:1, }
ERROR [CompactionExecutor:244] 2015-02-02 06:39:52,980 CassandraDaemon.java:153 - Exception in thread Thread[CompactionExecutor:244,1,main]
java.lang.NullPointerException: null
	at org.apache.cassandra.service.CacheService$KeyCacheSerializer.serialize(CacheService.java:475) ~[apache-cassandra-2.1.2.jar:2.1.2]
	at org.apache.cassandra.service.CacheService$KeyCacheSerializer.serialize(CacheService.java:463) ~[apache-cassandra-2.1.2.jar:2.1.2]
	at org.apache.cassandra.cache.AutoSavingCache$Writer.saveCache(AutoSavingCache.java:274) ~[apache-cassandra-2.1.2.jar:2.1.2]
	at org.apache.cassandra.db.compaction.CompactionManager$11.run(CompactionManager.java:1088) ~[apache-cassandra-2.1.2.jar:2.1.2]
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:471) ~[na:1.7.0_72]
	at java.util.concurrent.FutureTask.run(FutureTask.java:262) ~[na:1.7.0_72]
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1145) ~[na:1.7.0_72]
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:615) [na:1.7.0_72]
	at java.lang.Thread.run(Thread.java:745) [na:1.7.0_72]
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Please take a look especially at this weird log message before exception: &quot;Compacted 2 sstables to []&quot;.&lt;/p&gt;</comment>
                            <comment id="14323162" author="DAddYE" created="Mon, 16 Feb 2015 19:28:30 +0000"  >&lt;p&gt;This is the error I get as well, hundreds of times on each node:&lt;/p&gt;

&lt;p&gt;~~~&lt;br/&gt;
ERROR &lt;span class=&quot;error&quot;&gt;&amp;#91;CompactionExecutor:2257&amp;#93;&lt;/span&gt; 2015-02-11 06:41:37,649 CassandraDaemon.java &lt;span class=&quot;error&quot;&gt;&amp;#91;line 153&amp;#93;&lt;/span&gt; Exception in thread Thread&lt;span class=&quot;error&quot;&gt;&amp;#91;CompactionExecutor:2257,1,main&amp;#93;&lt;/span&gt;&lt;br/&gt;
java.lang.NullPointerException: null&lt;br/&gt;
ERROR &lt;span class=&quot;error&quot;&gt;&amp;#91;CompactionExecutor:2257&amp;#93;&lt;/span&gt; 2015-02-11 07:11:11,555 CassandraDaemon.java &lt;span class=&quot;error&quot;&gt;&amp;#91;line 153&amp;#93;&lt;/span&gt; Exception in thread Thread&lt;span class=&quot;error&quot;&gt;&amp;#91;CompactionExecutor:2257,1,main&amp;#93;&lt;/span&gt;&lt;br/&gt;
java.lang.NullPointerException: null&lt;br/&gt;
ERROR &lt;span class=&quot;error&quot;&gt;&amp;#91;CompactionExecutor:2338&amp;#93;&lt;/span&gt; 2015-02-11 10:41:38,631 CassandraDaemon.java &lt;span class=&quot;error&quot;&gt;&amp;#91;line 153&amp;#93;&lt;/span&gt; Exception in thread Thread&lt;span class=&quot;error&quot;&gt;&amp;#91;CompactionExecutor:2338,1,main&amp;#93;&lt;/span&gt;&lt;br/&gt;
java.lang.NullPointerException: null&lt;br/&gt;
ERROR &lt;span class=&quot;error&quot;&gt;&amp;#91;CompactionExecutor:2353&amp;#93;&lt;/span&gt; 2015-02-11 14:41:38,629 CassandraDaemon.java &lt;span class=&quot;error&quot;&gt;&amp;#91;line 153&amp;#93;&lt;/span&gt; Exception in thread Thread&lt;span class=&quot;error&quot;&gt;&amp;#91;CompactionExecutor:2353,1,main&amp;#93;&lt;/span&gt;&lt;br/&gt;
java.lang.NullPointerException: null&lt;br/&gt;
ERROR &lt;span class=&quot;error&quot;&gt;&amp;#91;CompactionExecutor:2313&amp;#93;&lt;/span&gt; 2015-02-12 04:57:17,884 CassandraDaemon.java &lt;span class=&quot;error&quot;&gt;&amp;#91;line 153&amp;#93;&lt;/span&gt; Exception in thread Thread&lt;span class=&quot;error&quot;&gt;&amp;#91;CompactionExecutor:2313,1,main&amp;#93;&lt;/span&gt;&lt;br/&gt;
java.lang.NullPointerException: null&lt;br/&gt;
ERROR &lt;span class=&quot;error&quot;&gt;&amp;#91;CompactionExecutor:2313&amp;#93;&lt;/span&gt; 2015-02-12 04:57:29,277 CassandraDaemon.java &lt;span class=&quot;error&quot;&gt;&amp;#91;line 153&amp;#93;&lt;/span&gt; Exception in thread Thread&lt;span class=&quot;error&quot;&gt;&amp;#91;CompactionExecutor:2313,1,main&amp;#93;&lt;/span&gt;&lt;br/&gt;
java.lang.NullPointerException: null&lt;br/&gt;
ERROR &lt;span class=&quot;error&quot;&gt;&amp;#91;CompactionExecutor:2313&amp;#93;&lt;/span&gt; 2015-02-12 05:23:36,772 CassandraDaemon.java &lt;span class=&quot;error&quot;&gt;&amp;#91;line 153&amp;#93;&lt;/span&gt; Exception in thread Thread&lt;span class=&quot;error&quot;&gt;&amp;#91;CompactionExecutor:2313,1,main&amp;#93;&lt;/span&gt;&lt;br/&gt;
java.lang.NullPointerException: null&lt;br/&gt;
ERROR &lt;span class=&quot;error&quot;&gt;&amp;#91;CompactionExecutor:2295&amp;#93;&lt;/span&gt; 2015-02-12 11:23:56,165 CassandraDaemon.java &lt;span class=&quot;error&quot;&gt;&amp;#91;line 153&amp;#93;&lt;/span&gt; Exception in thread Thread&lt;span class=&quot;error&quot;&gt;&amp;#91;CompactionExecutor:2295,1,main&amp;#93;&lt;/span&gt;&lt;br/&gt;
java.lang.NullPointerException: null&lt;br/&gt;
ERROR &lt;span class=&quot;error&quot;&gt;&amp;#91;CompactionExecutor:2380&amp;#93;&lt;/span&gt; 2015-02-12 12:57:29,437 CassandraDaemon.java &lt;span class=&quot;error&quot;&gt;&amp;#91;line 153&amp;#93;&lt;/span&gt; Exception in thread Thread&lt;span class=&quot;error&quot;&gt;&amp;#91;CompactionExecutor:2380,1,main&amp;#93;&lt;/span&gt;&lt;br/&gt;
java.lang.NullPointerException: null&lt;br/&gt;
ERROR &lt;span class=&quot;error&quot;&gt;&amp;#91;CompactionExecutor:2362&amp;#93;&lt;/span&gt; 2015-02-12 19:27:15,902 CassandraDaemon.java &lt;span class=&quot;error&quot;&gt;&amp;#91;line 153&amp;#93;&lt;/span&gt; Exception in thread Thread&lt;span class=&quot;error&quot;&gt;&amp;#91;CompactionExecutor:2362,1,main&amp;#93;&lt;/span&gt;&lt;br/&gt;
java.lang.NullPointerException: null&lt;br/&gt;
ERROR &lt;span class=&quot;error&quot;&gt;&amp;#91;CompactionExecutor:2317&amp;#93;&lt;/span&gt; 2015-02-12 21:35:06,668 CassandraDaemon.java &lt;span class=&quot;error&quot;&gt;&amp;#91;line 153&amp;#93;&lt;/span&gt; Exception in thread Thread&lt;span class=&quot;error&quot;&gt;&amp;#91;CompactionExecutor:2317,1,main&amp;#93;&lt;/span&gt;&lt;br/&gt;
java.lang.NullPointerException: null&lt;br/&gt;
ERROR &lt;span class=&quot;error&quot;&gt;&amp;#91;CompactionExecutor:2332&amp;#93;&lt;/span&gt; 2015-02-13 02:28:00,758 CassandraDaemon.java &lt;span class=&quot;error&quot;&gt;&amp;#91;line 153&amp;#93;&lt;/span&gt; Exception in thread Thread&lt;span class=&quot;error&quot;&gt;&amp;#91;CompactionExecutor:2332,1,main&amp;#93;&lt;/span&gt;&lt;br/&gt;
java.lang.NullPointerException: null&lt;br/&gt;
ERROR &lt;span class=&quot;error&quot;&gt;&amp;#91;CompactionExecutor:2381&amp;#93;&lt;/span&gt; 2015-02-13 12:33:33,254 CassandraDaemon.java &lt;span class=&quot;error&quot;&gt;&amp;#91;line 153&amp;#93;&lt;/span&gt; Exception in thread Thread&lt;span class=&quot;error&quot;&gt;&amp;#91;CompactionExecutor:2381,1,main&amp;#93;&lt;/span&gt;&lt;br/&gt;
java.lang.NullPointerException: null&lt;br/&gt;
ERROR &lt;span class=&quot;error&quot;&gt;&amp;#91;CompactionExecutor:2392&amp;#93;&lt;/span&gt; 2015-02-13 16:40:06,309 CassandraDaemon.java &lt;span class=&quot;error&quot;&gt;&amp;#91;line 153&amp;#93;&lt;/span&gt; Exception in thread Thread&lt;span class=&quot;error&quot;&gt;&amp;#91;CompactionExecutor:2392,1,main&amp;#93;&lt;/span&gt;&lt;br/&gt;
java.lang.NullPointerException: null&lt;br/&gt;
ERROR &lt;span class=&quot;error&quot;&gt;&amp;#91;CompactionExecutor:2307&amp;#93;&lt;/span&gt; 2015-02-13 20:26:42,196 CassandraDaemon.java &lt;span class=&quot;error&quot;&gt;&amp;#91;line 153&amp;#93;&lt;/span&gt; Exception in thread Thread&lt;span class=&quot;error&quot;&gt;&amp;#91;CompactionExecutor:2307,1,main&amp;#93;&lt;/span&gt;&lt;br/&gt;
java.lang.NullPointerException: null&lt;br/&gt;
ERROR &lt;span class=&quot;error&quot;&gt;&amp;#91;CompactionExecutor:2386&amp;#93;&lt;/span&gt; 2015-02-14 02:52:56,053 CassandraDaemon.java &lt;span class=&quot;error&quot;&gt;&amp;#91;line 153&amp;#93;&lt;/span&gt; Exception in thread Thread&lt;span class=&quot;error&quot;&gt;&amp;#91;CompactionExecutor:2386,1,main&amp;#93;&lt;/span&gt;&lt;br/&gt;
java.lang.NullPointerException: null&lt;br/&gt;
ERROR &lt;span class=&quot;error&quot;&gt;&amp;#91;CompactionExecutor:2386&amp;#93;&lt;/span&gt; 2015-02-14 04:16:04,030 CassandraDaemon.java &lt;span class=&quot;error&quot;&gt;&amp;#91;line 153&amp;#93;&lt;/span&gt; Exception in thread Thread&lt;span class=&quot;error&quot;&gt;&amp;#91;CompactionExecutor:2386,1,main&amp;#93;&lt;/span&gt;&lt;br/&gt;
java.lang.NullPointerException: null&lt;br/&gt;
ERROR &lt;span class=&quot;error&quot;&gt;&amp;#91;CompactionExecutor:2401&amp;#93;&lt;/span&gt; 2015-02-14 23:30:30,397 CassandraDaemon.java &lt;span class=&quot;error&quot;&gt;&amp;#91;line 153&amp;#93;&lt;/span&gt; Exception in thread Thread&lt;span class=&quot;error&quot;&gt;&amp;#91;CompactionExecutor:2401,1,main&amp;#93;&lt;/span&gt;&lt;br/&gt;
java.lang.NullPointerException: null&lt;br/&gt;
ERROR &lt;span class=&quot;error&quot;&gt;&amp;#91;CompactionExecutor:2401&amp;#93;&lt;/span&gt; 2015-02-14 23:35:20,166 CassandraDaemon.java &lt;span class=&quot;error&quot;&gt;&amp;#91;line 153&amp;#93;&lt;/span&gt; Exception in thread Thread&lt;span class=&quot;error&quot;&gt;&amp;#91;CompactionExecutor:2401,1,main&amp;#93;&lt;/span&gt;&lt;br/&gt;
java.lang.NullPointerException: null&lt;br/&gt;
ERROR &lt;span class=&quot;error&quot;&gt;&amp;#91;CompactionExecutor:2401&amp;#93;&lt;/span&gt; 2015-02-14 23:35:20,341 CassandraDaemon.java &lt;span class=&quot;error&quot;&gt;&amp;#91;line 153&amp;#93;&lt;/span&gt; Exception in thread Thread&lt;span class=&quot;error&quot;&gt;&amp;#91;CompactionExecutor:2401,1,main&amp;#93;&lt;/span&gt;&lt;br/&gt;
java.lang.NullPointerException: null&lt;br/&gt;
ERROR &lt;span class=&quot;error&quot;&gt;&amp;#91;CompactionExecutor:2401&amp;#93;&lt;/span&gt; 2015-02-14 23:35:20,496 CassandraDaemon.java &lt;span class=&quot;error&quot;&gt;&amp;#91;line 153&amp;#93;&lt;/span&gt; Exception in thread Thread&lt;span class=&quot;error&quot;&gt;&amp;#91;CompactionExecutor:2401,1,main&amp;#93;&lt;/span&gt;&lt;br/&gt;
java.lang.NullPointerException: null&lt;br/&gt;
ERROR &lt;span class=&quot;error&quot;&gt;&amp;#91;CompactionExecutor:2401&amp;#93;&lt;/span&gt; 2015-02-15 00:42:54,965 CassandraDaemon.java &lt;span class=&quot;error&quot;&gt;&amp;#91;line 153&amp;#93;&lt;/span&gt; Exception in thread Thread&lt;span class=&quot;error&quot;&gt;&amp;#91;CompactionExecutor:2401,1,main&amp;#93;&lt;/span&gt;&lt;br/&gt;
java.lang.NullPointerException: null&lt;br/&gt;
~~~&lt;/p&gt;

&lt;p&gt;Any fix around that?&lt;/p&gt;

&lt;p&gt;As far I can see seems that I can&apos;t compact my sstables, I don&apos;t have a huge table but seems is always stuck between 1 or 2% during compaction.&lt;/p&gt;</comment>
                            <comment id="14323163" author="DAddYE" created="Mon, 16 Feb 2015 19:28:31 +0000"  >&lt;p&gt;This is the error I get as well, hundreds of times on each node:&lt;/p&gt;

&lt;p&gt;~~~&lt;br/&gt;
ERROR &lt;span class=&quot;error&quot;&gt;&amp;#91;CompactionExecutor:2257&amp;#93;&lt;/span&gt; 2015-02-11 06:41:37,649 CassandraDaemon.java &lt;span class=&quot;error&quot;&gt;&amp;#91;line 153&amp;#93;&lt;/span&gt; Exception in thread Thread&lt;span class=&quot;error&quot;&gt;&amp;#91;CompactionExecutor:2257,1,main&amp;#93;&lt;/span&gt;&lt;br/&gt;
java.lang.NullPointerException: null&lt;br/&gt;
ERROR &lt;span class=&quot;error&quot;&gt;&amp;#91;CompactionExecutor:2257&amp;#93;&lt;/span&gt; 2015-02-11 07:11:11,555 CassandraDaemon.java &lt;span class=&quot;error&quot;&gt;&amp;#91;line 153&amp;#93;&lt;/span&gt; Exception in thread Thread&lt;span class=&quot;error&quot;&gt;&amp;#91;CompactionExecutor:2257,1,main&amp;#93;&lt;/span&gt;&lt;br/&gt;
java.lang.NullPointerException: null&lt;br/&gt;
ERROR &lt;span class=&quot;error&quot;&gt;&amp;#91;CompactionExecutor:2338&amp;#93;&lt;/span&gt; 2015-02-11 10:41:38,631 CassandraDaemon.java &lt;span class=&quot;error&quot;&gt;&amp;#91;line 153&amp;#93;&lt;/span&gt; Exception in thread Thread&lt;span class=&quot;error&quot;&gt;&amp;#91;CompactionExecutor:2338,1,main&amp;#93;&lt;/span&gt;&lt;br/&gt;
java.lang.NullPointerException: null&lt;br/&gt;
ERROR &lt;span class=&quot;error&quot;&gt;&amp;#91;CompactionExecutor:2353&amp;#93;&lt;/span&gt; 2015-02-11 14:41:38,629 CassandraDaemon.java &lt;span class=&quot;error&quot;&gt;&amp;#91;line 153&amp;#93;&lt;/span&gt; Exception in thread Thread&lt;span class=&quot;error&quot;&gt;&amp;#91;CompactionExecutor:2353,1,main&amp;#93;&lt;/span&gt;&lt;br/&gt;
java.lang.NullPointerException: null&lt;br/&gt;
ERROR &lt;span class=&quot;error&quot;&gt;&amp;#91;CompactionExecutor:2313&amp;#93;&lt;/span&gt; 2015-02-12 04:57:17,884 CassandraDaemon.java &lt;span class=&quot;error&quot;&gt;&amp;#91;line 153&amp;#93;&lt;/span&gt; Exception in thread Thread&lt;span class=&quot;error&quot;&gt;&amp;#91;CompactionExecutor:2313,1,main&amp;#93;&lt;/span&gt;&lt;br/&gt;
java.lang.NullPointerException: null&lt;br/&gt;
ERROR &lt;span class=&quot;error&quot;&gt;&amp;#91;CompactionExecutor:2313&amp;#93;&lt;/span&gt; 2015-02-12 04:57:29,277 CassandraDaemon.java &lt;span class=&quot;error&quot;&gt;&amp;#91;line 153&amp;#93;&lt;/span&gt; Exception in thread Thread&lt;span class=&quot;error&quot;&gt;&amp;#91;CompactionExecutor:2313,1,main&amp;#93;&lt;/span&gt;&lt;br/&gt;
java.lang.NullPointerException: null&lt;br/&gt;
ERROR &lt;span class=&quot;error&quot;&gt;&amp;#91;CompactionExecutor:2313&amp;#93;&lt;/span&gt; 2015-02-12 05:23:36,772 CassandraDaemon.java &lt;span class=&quot;error&quot;&gt;&amp;#91;line 153&amp;#93;&lt;/span&gt; Exception in thread Thread&lt;span class=&quot;error&quot;&gt;&amp;#91;CompactionExecutor:2313,1,main&amp;#93;&lt;/span&gt;&lt;br/&gt;
java.lang.NullPointerException: null&lt;br/&gt;
ERROR &lt;span class=&quot;error&quot;&gt;&amp;#91;CompactionExecutor:2295&amp;#93;&lt;/span&gt; 2015-02-12 11:23:56,165 CassandraDaemon.java &lt;span class=&quot;error&quot;&gt;&amp;#91;line 153&amp;#93;&lt;/span&gt; Exception in thread Thread&lt;span class=&quot;error&quot;&gt;&amp;#91;CompactionExecutor:2295,1,main&amp;#93;&lt;/span&gt;&lt;br/&gt;
java.lang.NullPointerException: null&lt;br/&gt;
ERROR &lt;span class=&quot;error&quot;&gt;&amp;#91;CompactionExecutor:2380&amp;#93;&lt;/span&gt; 2015-02-12 12:57:29,437 CassandraDaemon.java &lt;span class=&quot;error&quot;&gt;&amp;#91;line 153&amp;#93;&lt;/span&gt; Exception in thread Thread&lt;span class=&quot;error&quot;&gt;&amp;#91;CompactionExecutor:2380,1,main&amp;#93;&lt;/span&gt;&lt;br/&gt;
java.lang.NullPointerException: null&lt;br/&gt;
ERROR &lt;span class=&quot;error&quot;&gt;&amp;#91;CompactionExecutor:2362&amp;#93;&lt;/span&gt; 2015-02-12 19:27:15,902 CassandraDaemon.java &lt;span class=&quot;error&quot;&gt;&amp;#91;line 153&amp;#93;&lt;/span&gt; Exception in thread Thread&lt;span class=&quot;error&quot;&gt;&amp;#91;CompactionExecutor:2362,1,main&amp;#93;&lt;/span&gt;&lt;br/&gt;
java.lang.NullPointerException: null&lt;br/&gt;
ERROR &lt;span class=&quot;error&quot;&gt;&amp;#91;CompactionExecutor:2317&amp;#93;&lt;/span&gt; 2015-02-12 21:35:06,668 CassandraDaemon.java &lt;span class=&quot;error&quot;&gt;&amp;#91;line 153&amp;#93;&lt;/span&gt; Exception in thread Thread&lt;span class=&quot;error&quot;&gt;&amp;#91;CompactionExecutor:2317,1,main&amp;#93;&lt;/span&gt;&lt;br/&gt;
java.lang.NullPointerException: null&lt;br/&gt;
ERROR &lt;span class=&quot;error&quot;&gt;&amp;#91;CompactionExecutor:2332&amp;#93;&lt;/span&gt; 2015-02-13 02:28:00,758 CassandraDaemon.java &lt;span class=&quot;error&quot;&gt;&amp;#91;line 153&amp;#93;&lt;/span&gt; Exception in thread Thread&lt;span class=&quot;error&quot;&gt;&amp;#91;CompactionExecutor:2332,1,main&amp;#93;&lt;/span&gt;&lt;br/&gt;
java.lang.NullPointerException: null&lt;br/&gt;
ERROR &lt;span class=&quot;error&quot;&gt;&amp;#91;CompactionExecutor:2381&amp;#93;&lt;/span&gt; 2015-02-13 12:33:33,254 CassandraDaemon.java &lt;span class=&quot;error&quot;&gt;&amp;#91;line 153&amp;#93;&lt;/span&gt; Exception in thread Thread&lt;span class=&quot;error&quot;&gt;&amp;#91;CompactionExecutor:2381,1,main&amp;#93;&lt;/span&gt;&lt;br/&gt;
java.lang.NullPointerException: null&lt;br/&gt;
ERROR &lt;span class=&quot;error&quot;&gt;&amp;#91;CompactionExecutor:2392&amp;#93;&lt;/span&gt; 2015-02-13 16:40:06,309 CassandraDaemon.java &lt;span class=&quot;error&quot;&gt;&amp;#91;line 153&amp;#93;&lt;/span&gt; Exception in thread Thread&lt;span class=&quot;error&quot;&gt;&amp;#91;CompactionExecutor:2392,1,main&amp;#93;&lt;/span&gt;&lt;br/&gt;
java.lang.NullPointerException: null&lt;br/&gt;
ERROR &lt;span class=&quot;error&quot;&gt;&amp;#91;CompactionExecutor:2307&amp;#93;&lt;/span&gt; 2015-02-13 20:26:42,196 CassandraDaemon.java &lt;span class=&quot;error&quot;&gt;&amp;#91;line 153&amp;#93;&lt;/span&gt; Exception in thread Thread&lt;span class=&quot;error&quot;&gt;&amp;#91;CompactionExecutor:2307,1,main&amp;#93;&lt;/span&gt;&lt;br/&gt;
java.lang.NullPointerException: null&lt;br/&gt;
ERROR &lt;span class=&quot;error&quot;&gt;&amp;#91;CompactionExecutor:2386&amp;#93;&lt;/span&gt; 2015-02-14 02:52:56,053 CassandraDaemon.java &lt;span class=&quot;error&quot;&gt;&amp;#91;line 153&amp;#93;&lt;/span&gt; Exception in thread Thread&lt;span class=&quot;error&quot;&gt;&amp;#91;CompactionExecutor:2386,1,main&amp;#93;&lt;/span&gt;&lt;br/&gt;
java.lang.NullPointerException: null&lt;br/&gt;
ERROR &lt;span class=&quot;error&quot;&gt;&amp;#91;CompactionExecutor:2386&amp;#93;&lt;/span&gt; 2015-02-14 04:16:04,030 CassandraDaemon.java &lt;span class=&quot;error&quot;&gt;&amp;#91;line 153&amp;#93;&lt;/span&gt; Exception in thread Thread&lt;span class=&quot;error&quot;&gt;&amp;#91;CompactionExecutor:2386,1,main&amp;#93;&lt;/span&gt;&lt;br/&gt;
java.lang.NullPointerException: null&lt;br/&gt;
ERROR &lt;span class=&quot;error&quot;&gt;&amp;#91;CompactionExecutor:2401&amp;#93;&lt;/span&gt; 2015-02-14 23:30:30,397 CassandraDaemon.java &lt;span class=&quot;error&quot;&gt;&amp;#91;line 153&amp;#93;&lt;/span&gt; Exception in thread Thread&lt;span class=&quot;error&quot;&gt;&amp;#91;CompactionExecutor:2401,1,main&amp;#93;&lt;/span&gt;&lt;br/&gt;
java.lang.NullPointerException: null&lt;br/&gt;
ERROR &lt;span class=&quot;error&quot;&gt;&amp;#91;CompactionExecutor:2401&amp;#93;&lt;/span&gt; 2015-02-14 23:35:20,166 CassandraDaemon.java &lt;span class=&quot;error&quot;&gt;&amp;#91;line 153&amp;#93;&lt;/span&gt; Exception in thread Thread&lt;span class=&quot;error&quot;&gt;&amp;#91;CompactionExecutor:2401,1,main&amp;#93;&lt;/span&gt;&lt;br/&gt;
java.lang.NullPointerException: null&lt;br/&gt;
ERROR &lt;span class=&quot;error&quot;&gt;&amp;#91;CompactionExecutor:2401&amp;#93;&lt;/span&gt; 2015-02-14 23:35:20,341 CassandraDaemon.java &lt;span class=&quot;error&quot;&gt;&amp;#91;line 153&amp;#93;&lt;/span&gt; Exception in thread Thread&lt;span class=&quot;error&quot;&gt;&amp;#91;CompactionExecutor:2401,1,main&amp;#93;&lt;/span&gt;&lt;br/&gt;
java.lang.NullPointerException: null&lt;br/&gt;
ERROR &lt;span class=&quot;error&quot;&gt;&amp;#91;CompactionExecutor:2401&amp;#93;&lt;/span&gt; 2015-02-14 23:35:20,496 CassandraDaemon.java &lt;span class=&quot;error&quot;&gt;&amp;#91;line 153&amp;#93;&lt;/span&gt; Exception in thread Thread&lt;span class=&quot;error&quot;&gt;&amp;#91;CompactionExecutor:2401,1,main&amp;#93;&lt;/span&gt;&lt;br/&gt;
java.lang.NullPointerException: null&lt;br/&gt;
ERROR &lt;span class=&quot;error&quot;&gt;&amp;#91;CompactionExecutor:2401&amp;#93;&lt;/span&gt; 2015-02-15 00:42:54,965 CassandraDaemon.java &lt;span class=&quot;error&quot;&gt;&amp;#91;line 153&amp;#93;&lt;/span&gt; Exception in thread Thread&lt;span class=&quot;error&quot;&gt;&amp;#91;CompactionExecutor:2401,1,main&amp;#93;&lt;/span&gt;&lt;br/&gt;
java.lang.NullPointerException: null&lt;br/&gt;
~~~&lt;/p&gt;

&lt;p&gt;Any fix around that?&lt;/p&gt;

&lt;p&gt;As far I can see seems that I can&apos;t compact my sstables, I don&apos;t have a huge table but seems is always stuck between 1 or 2% during compaction.&lt;/p&gt;</comment>
                            <comment id="14325890" author="mlowicki" created="Wed, 18 Feb 2015 14:15:55 +0000"  >&lt;p&gt;I&apos;m getting the same error - &lt;a href=&quot;https://cpaste.org/pysq5smf0&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://cpaste.org/pysq5smf0&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="14327721" author="hbcheng" created="Thu, 19 Feb 2015 16:52:23 +0000"  >&lt;p&gt;We are seeing this issue as well. These logs are from a 2.1.3 node during compaction while joining a mixed 2.1.3/2.1.2 cluster.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;ERROR [CompactionExecutor:30] 2015-02-19 08:24:47,058 CassandraDaemon.java:167 - Exception in thread &lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;[CompactionExecutor:30,1,main]
java.lang.NullPointerException: &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;
        at org.apache.cassandra.service.CacheService$KeyCacheSerializer.serialize(CacheService.java:475) ~[apache-cassandra-2.1.3.jar:2.1.3]
        at org.apache.cassandra.service.CacheService$KeyCacheSerializer.serialize(CacheService.java:463) ~[apache-cassandra-2.1.3.jar:2.1.3]
        at org.apache.cassandra.cache.AutoSavingCache$Writer.saveCache(AutoSavingCache.java:274) ~[apache-cassandra-2.1.3.jar:2.1.3]
        at org.apache.cassandra.db.compaction.CompactionManager$11.run(CompactionManager.java:1152) ~[apache-cassandra-2.1.3.jar:2.1.3]
        at java.util.concurrent.Executors$RunnableAdapter.call(Unknown Source) ~[na:1.7.0_55]
        at java.util.concurrent.FutureTask.run(Unknown Source) ~[na:1.7.0_55]
        at java.util.concurrent.ThreadPoolExecutor.runWorker(Unknown Source) [na:1.7.0_55]
        at java.util.concurrent.ThreadPoolExecutor$Worker.run(Unknown Source) [na:1.7.0_55]
        at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(Unknown Source) [na:1.7.0_55]
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Also (maybe) worth noting, unlike Rafal&apos;s example the sstable merge message immediately before the error does not have any immediate red flags&lt;/p&gt;</comment>
                            <comment id="14328311" author="daddye" created="Thu, 19 Feb 2015 23:26:41 +0000"  >&lt;p&gt;Does this influence for you guys the compaction progress? My nodes once they trigger this error seems to be stuck at 1/2% without going forward.&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;image-wrap&quot; style=&quot;&quot;&gt;&lt;img src=&quot;http://fs.daddye.it/Cswq+&quot; style=&quot;border: 0px solid black&quot; /&gt;&lt;/span&gt;&lt;/p&gt;</comment>
                            <comment id="14328342" author="hbcheng" created="Thu, 19 Feb 2015 23:44:33 +0000"  >&lt;p&gt;Davide, when we see this error it usually corresponds to compaction stalling, although the specific percentage seems to differ from case to case.&lt;/p&gt;</comment>
                            <comment id="14328500" author="hbcheng" created="Fri, 20 Feb 2015 03:15:47 +0000"  >&lt;p&gt;I&apos;ve increased the logging verbosity and captured the event again, there&apos;s only a single log message from the thread in question before the NullPointerException.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;DEBUG [CompactionExecutor:56] 2015-02-20 02:55:13,257 AutoSavingCache.java:230 
- Deleting old KeyCache files.
&amp;lt;snip&amp;gt;
ERROR [CompactionExecutor:56] 2015-02-20 02:55:14,314 CassandraDaemon.java:167 
- Exception in thread &lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;[CompactionExecutor:56,1,main]
java.lang.NullPointerException: &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;
        at org.apache.cassandra.service.CacheService$KeyCacheSerializer.seriali
ze(CacheService.java:475) ~[apache-cassandra-2.1.3.jar:2.1.3]
        at org.apache.cassandra.service.CacheService$KeyCacheSerializer.seriali
ze(CacheService.java:463) ~[apache-cassandra-2.1.3.jar:2.1.3]
        at org.apache.cassandra.cache.AutoSavingCache$Writer.saveCache(AutoSavi
ngCache.java:274) ~[apache-cassandra-2.1.3.jar:2.1.3]
        at org.apache.cassandra.db.compaction.CompactionManager$11.run(Compacti
onManager.java:1152) ~[apache-cassandra-2.1.3.jar:2.1.3]
        at java.util.concurrent.Executors$RunnableAdapter.call(Unknown Source) 
~[na:1.7.0_55]
        at java.util.concurrent.FutureTask.run(Unknown Source) ~[na:1.7.0_55]
        at java.util.concurrent.ThreadPoolExecutor.runWorker(Unknown Source) [n
a:1.7.0_55]
        at java.util.concurrent.ThreadPoolExecutor$Worker.run(Unknown Source) [
na:1.7.0_55]
        at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(Unknown Source) [na:1.7.0_55]
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;If there&apos;s any log in particular that would be useful for debugging, please let me know. I&apos;ve stashed away the offending log file.&lt;/p&gt;</comment>
                            <comment id="14328540" author="iamaleksey" created="Fri, 20 Feb 2015 04:17:36 +0000"  >&lt;p&gt;Attaching a simple patch that deals with the raciness in KeyCacheSerializer , plus looks up the CFMetaData by the id vs ks/cf names, per Benedict&apos;s suggestion.&lt;/p&gt;</comment>
                            <comment id="14330405" author="DAddYE" created="Sat, 21 Feb 2015 19:46:39 +0000"  >&lt;p&gt;Thanks a lot. When is planned the 2.1.4 to be released? &lt;/p&gt;</comment>
                            <comment id="14345198" author="benedict" created="Tue, 3 Mar 2015 15:19:45 +0000"  >&lt;p&gt;+1, although I think this code could do with being refactored, as there&apos;s a bit of a poor isolation of concerns - the caller and callee of CacheSerializer methods repeat much of the same work.&lt;/p&gt;</comment>
                            <comment id="14345621" author="iamaleksey" created="Tue, 3 Mar 2015 19:55:10 +0000"  >&lt;p&gt;Agreed, but hesitant to do that in 2.1.x. I&apos;ll open a separate 3.0 ticket for just that.&lt;/p&gt;</comment>
                            <comment id="14345629" author="benedict" created="Tue, 3 Mar 2015 19:57:07 +0000"  >&lt;blockquote&gt;&lt;p&gt;but hesitant to do that in 2.1.x&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Agreed&lt;/p&gt;</comment>
                            <comment id="14345860" author="iamaleksey" created="Tue, 3 Mar 2015 22:11:13 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=benedict&quot; class=&quot;user-hover&quot; rel=&quot;benedict&quot;&gt;benedict&lt;/a&gt; Committed.&lt;/p&gt;

&lt;p&gt;Speaking of refactoring - I see how it could be improved, but, on second thought, I can&apos;t find any particular duplication there (aside from checking for cf id existence, and maybe cache entry existence). Did you have anything particular in mind? If so, can you open the refactoring ticket? Thanks.&lt;/p&gt;</comment>
                            <comment id="14346035" author="benedict" created="Wed, 4 Mar 2015 00:00:11 +0000"  >&lt;p&gt;Eh, it&apos;s not a burning desire to make better, so I&apos;ll leave it thanks. More than enough to do. A brief handwavy outline is that the current abstraction adds complexity by not really separating concerns; the duplication is not a problem of the cost of the work but of the cognitive burden (which is essentially why this happened in the first place). But since it&apos;s not a significant pain point, it&apos;s not worth agonising over either. &lt;/p&gt;</comment>
                            <comment id="14350095" author="fredrikl74" created="Fri, 6 Mar 2015 08:21:47 +0000"  >&lt;p&gt;Would it be safe to patch a 2.1.3 cluster with the attatched (8067.txt) patch?&lt;/p&gt;</comment>
                            <comment id="14350098" author="iamaleksey" created="Fri, 6 Mar 2015 08:24:05 +0000"  >&lt;p&gt;Yes.&lt;/p&gt;</comment>
                            <comment id="14359080" author="daddye" created="Thu, 12 Mar 2015 17:56:13 +0000"  >&lt;p&gt;Is there a way to fix the issue without the patch? When the 2.1.4 is planned to be released? &lt;/p&gt;</comment>
                            <comment id="14359721" author="iamaleksey" created="Fri, 13 Mar 2015 01:05:10 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=DAddYE&quot; class=&quot;user-hover&quot; rel=&quot;DAddYE&quot;&gt;DAddYE&lt;/a&gt; In a week or two.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                            <outwardlinks description="duplicates">
                                        <issuelink>
            <issuekey id="12734569">CASSANDRA-7784</issuekey>
        </issuelink>
                            </outwardlinks>
                                                                <inwardlinks description="is duplicated by">
                                        <issuelink>
            <issuekey id="12767122">CASSANDRA-8605</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12792976">CASSANDRA-9122</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12822428">CASSANDRA-9216</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12699810" name="8067.txt" size="1066" author="aleksey" created="Fri, 20 Feb 2015 04:15:56 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[aleksey]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 36 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i20vfj:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>benedict</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[benedict]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12962"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12311420" key="com.atlassian.jira.plugin.system.customfieldtypes:version">
                        <customfieldname>Since Version</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="12327256">2.1.0</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>