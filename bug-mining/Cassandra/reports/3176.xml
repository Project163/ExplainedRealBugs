<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 22:48:48 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-7256] Error when dropping keyspace.</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-7256</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;created a 3 node datacenter  called existing.&lt;/p&gt;

&lt;p&gt;ran cassandra-stress:&lt;/p&gt;

&lt;p&gt;&lt;tt&gt;cassandra-stress -R NetworkTopologyStrategy -O existing:2 -d existing0 -n 2000000 -k&lt;/tt&gt;&lt;/p&gt;

&lt;p&gt;Added a 2nd datacenter called new with 3 nodes started it with &lt;tt&gt;auto_bootstrap: false&lt;/tt&gt;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;alter keyspace &lt;span class=&quot;code-quote&quot;&gt;&quot;Keyspace1&quot;&lt;/span&gt; with replication = {&lt;span class=&quot;code-quote&quot;&gt;&apos;class&apos;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&apos;NetworkTopologyStrategy&apos;&lt;/span&gt;,&lt;span class=&quot;code-quote&quot;&gt;&apos;existing&apos;&lt;/span&gt;:2,&lt;span class=&quot;code-quote&quot;&gt;&apos;&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt;&apos;&lt;/span&gt;:2};
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;I then discovered that cassandra-stress --operation=read failed with LOCAL_QUORUM if a node was down in the local datacenter - this occured in both, but should not have, so decided to try again.&lt;/p&gt;

&lt;p&gt;I shut down the new datacenter and removed all 3 nodes.  I then tried to drop the Keyspace1 keyspace.  cqlsh disconnected, and the log shows the error below.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;ERROR [MigrationStage:1] 2014-05-16 23:57:03,085 CassandraDaemon.java (line 198) Exception in thread &lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;[MigrationStage:1,5,main]
java.lang.IllegalStateException: One row required, 0 found
at org.apache.cassandra.cql3.UntypedResultSet.one(UntypedResultSet.java:53)
at org.apache.cassandra.config.KSMetaData.fromSchema(KSMetaData.java:263)
at org.apache.cassandra.db.DefsTables.mergeKeyspaces(DefsTables.java:227)
at org.apache.cassandra.db.DefsTables.mergeSchema(DefsTables.java:182)
at org.apache.cassandra.service.MigrationManager$2.runMayThrow(MigrationManager.java:303)
at org.apache.cassandra.utils.WrappedRunnable.run(WrappedRunnable.java:28)
at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:471)
at java.util.concurrent.FutureTask.run(FutureTask.java:262)
at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1145)
at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:615)
at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:744)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment>&lt;p&gt;ubuntu 3 nodes (had 3 more in 2nd datacenter but removed it)&lt;/p&gt;</environment>
        <key id="12714922">CASSANDRA-7256</key>
            <summary>Error when dropping keyspace.</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10002" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Normal</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="aleksey">Aleksey Yeschenko</assignee>
                                    <reporter username="slowenthal">Steven Lowenthal</reporter>
                        <labels>
                            <label>schema</label>
                    </labels>
                <created>Sat, 17 May 2014 01:20:21 +0000</created>
                <updated>Tue, 16 Apr 2019 09:31:45 +0000</updated>
                            <resolved>Fri, 10 Oct 2014 17:30:05 +0000</resolved>
                                        <fixVersion>2.0.11</fixVersion>
                    <fixVersion>2.1.1</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>6</watches>
                                                                                                                <comments>
                            <comment id="14009059" author="iamaleksey" created="Mon, 26 May 2014 20:04:51 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=slowenthal&quot; class=&quot;user-hover&quot; rel=&quot;slowenthal&quot;&gt;slowenthal&lt;/a&gt; what version of Cassandra was that?&lt;/p&gt;</comment>
                            <comment id="14107640" author="mstump" created="Fri, 22 Aug 2014 22:51:18 +0000"  >&lt;p&gt;Reproduced at customer site with Cassandra 2.0.7/DSE 4.0.3.&lt;/p&gt;</comment>
                            <comment id="14158578" author="jeremyschlatter" created="Fri, 3 Oct 2014 21:57:13 +0000"  >&lt;p&gt;I just encountered this issue with Cassandra 2.0.9. I have a 1-node cluster running in a virtual machine on my laptop. I am writing a unit test that creates and drops a keyspace on every test. At some point while running it I got:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;java.lang.RuntimeException: java.util.concurrent.ExecutionException: java.lang.IllegalStateException: One row required, 0 found`
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;while trying to drop the keyspace. The keyspace seems to still exist &amp;#8211; I can see it with &quot;desc keyspaces&quot; and &quot;desc keyspace &amp;lt;keyspace name&amp;gt;&quot; in cqlsh. But I am unable to drop it. Running &quot;drop keyspace &amp;lt;keyspace name&amp;gt;&quot; in cqlsh yields:&lt;/p&gt;

&lt;div class=&quot;panel&quot; style=&quot;background-color: #F5F5F5;border-width: 1px;&quot;&gt;&lt;div class=&quot;panelContent&quot; style=&quot;background-color: #F5F5F5;&quot;&gt;
&lt;p&gt;cqlsh&amp;gt; drop keyspace my_test_suite;&lt;br/&gt;
&lt;font color=&quot;red&quot;&gt;&lt;b&gt;TSocket read 0 bytes&lt;/b&gt;&lt;/font&gt;&lt;/p&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;In case it&apos;s helpful, here are some other version numbers, as printed by cqlsh:&lt;br/&gt;
cqlsh 4.1.1 | Cassandra 2.0.9 | CQL spec 3.1.1 | Thrift protocol 19.39.0&lt;/p&gt;</comment>
                            <comment id="14159182" author="iamaleksey" created="Sat, 4 Oct 2014 15:59:04 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jeremyschlatter&quot; class=&quot;user-hover&quot; rel=&quot;jeremyschlatter&quot;&gt;jeremyschlatter&lt;/a&gt; Are you still able to reproduce it? If so, is there any way you could upload the schema sstables somewhere? Thanks.&lt;/p&gt;</comment>
                            <comment id="14159727" author="iamaleksey" created="Sun, 5 Oct 2014 22:18:47 +0000"  >&lt;p&gt;So the issue here is that the current schema keyspace merge code doesn&apos;t correctly handle the two following scenarios:&lt;br/&gt;
1. Concurrent DROP KEYSPACE requests to two different nodes&lt;br/&gt;
2. A node missing a recreated CREATE KEYSPACE followed by a DROP KEYSPACE.&lt;/p&gt;

&lt;p&gt;The diff in that case will between the timestamps of the two top level deletions of the ColumnFamily objects. The current code doesn&apos;t handle it, and assumed a recreated keyspace instead.&lt;/p&gt;

&lt;p&gt;Columnfamily merge code would also be affected, except  KSMetaData.deserializeColumnFamilies(newRow) simply returns an empty collection in that case, and we are okay.&lt;/p&gt;

&lt;p&gt;I&apos;ve attached two patches - a minimal one, and a proper one, which is a complete rewrite of keyspace and columnfamilies schema merging logic.&lt;/p&gt;

&lt;p&gt;Being 2.0-targeted, I&apos;d prefer as little change is possible, &lt;b&gt;however&lt;/b&gt; I&apos;m actually more confident in the rewritten version, since the original one is not just wrong, but also unnecessarily complex, and does a bunch of unnecessary work. That, and the &apos;complete&apos; version will go into at least 2.1.1 and 3.0 - because types and functions merge logic also follow the non-obvious pattern.&lt;/p&gt;

&lt;p&gt;As for what to put into 2.0 - minimal or complete version, I&apos;m leaving that to &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jbellis&quot; class=&quot;user-hover&quot; rel=&quot;jbellis&quot;&gt;jbellis&lt;/a&gt; to decide - I&apos;m internally divided. Sorry (:&lt;/p&gt;</comment>
                            <comment id="14165071" author="jbellis" created="Thu, 9 Oct 2014 12:20:19 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=xedin&quot; class=&quot;user-hover&quot; rel=&quot;xedin&quot;&gt;xedin&lt;/a&gt; can you review the complete patch?  If you like it, perhaps it makes the most sense to standardize 2.0 and 2.1 on the same code.&lt;/p&gt;</comment>
                            <comment id="14166046" author="xedin" created="Fri, 10 Oct 2014 00:22:32 +0000"  >&lt;p&gt;complete patch looks good to me, +1.&lt;/p&gt;</comment>
                            <comment id="14167157" author="iamaleksey" created="Fri, 10 Oct 2014 17:30:05 +0000"  >&lt;p&gt;Committed the complete version, thanks (:&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                                                <inwardlinks description="is duplicated by">
                                        <issuelink>
            <issuekey id="12736435">CASSANDRA-7823</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12673032" name="7256-complete.txt" size="12888" author="aleksey" created="Sun, 5 Oct 2014 22:07:33 +0000"/>
                            <attachment id="12673031" name="7256-minimal.txt" size="1457" author="aleksey" created="Sun, 5 Oct 2014 22:07:13 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[aleksey]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>393235</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            11 years, 6 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1vppz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>393397</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>jbellis</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[jbellis]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12962"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>