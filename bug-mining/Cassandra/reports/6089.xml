<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 23:25:33 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-17314] Test Failure: org.apache.cassandra.db.ScrubTest.testScrubCorruptedCounterRow</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-17314</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;Failed 10 times in the last 14 runs. Flakiness: 61%, Stability: 28%&lt;/p&gt;

&lt;p&gt;Error Message&lt;br/&gt;
Timeout occurred. Please note the time in the report does not reflect the time until the timeout.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
Stacktrace
junit.framework.AssertionFailedError: Timeout occurred. Please note the time in the report does not reflect the time until the timeout.
	at java.util.Vector.forEach(Vector.java:1277)
	at java.util.Vector.forEach(Vector.java:1277)
	at java.util.Vector.forEach(Vector.java:1277)
	at jdk.nashorn.internal.scripts.Script$3$\^eval\_.:program(&amp;lt;eval&amp;gt;:13)
	at jdk.nashorn.internal.runtime.ScriptFunctionData.invoke(ScriptFunctionData.java:637)
	at jdk.nashorn.internal.runtime.ScriptFunction.invoke(ScriptFunction.java:494)
	at jdk.nashorn.internal.runtime.ScriptRuntime.apply(ScriptRuntime.java:393)
	at jdk.nashorn.api.scripting.NashornScriptEngine.evalImpl(NashornScriptEngine.java:449)
	at jdk.nashorn.api.scripting.NashornScriptEngine.evalImpl(NashornScriptEngine.java:406)
	at jdk.nashorn.api.scripting.NashornScriptEngine.evalImpl(NashornScriptEngine.java:402)
	at jdk.nashorn.api.scripting.NashornScriptEngine.eval(NashornScriptEngine.java:155)
	at javax.script.AbstractScriptEngine.eval(AbstractScriptEngine.java:264)
	at java.util.Vector.forEach(Vector.java:1277)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="13425233">CASSANDRA-17314</key>
            <summary>Test Failure: org.apache.cassandra.db.ScrubTest.testScrubCorruptedCounterRow</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10002" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Normal</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="curlylrt">Runtian Liu</assignee>
                                    <reporter username="jmckenzie">Josh McKenzie</reporter>
                        <labels>
                    </labels>
                <created>Thu, 27 Jan 2022 17:58:45 +0000</created>
                <updated>Sat, 22 Oct 2022 11:30:24 +0000</updated>
                            <resolved>Mon, 8 Aug 2022 13:04:43 +0000</resolved>
                                        <fixVersion>3.0.28</fixVersion>
                                    <component>Test/unit</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                    <progress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                            <timeestimate seconds="0">0h</timeestimate>
                            <timespent seconds="600">10m</timespent>
                                <comments>
                            <comment id="17538926" author="adelapena" created="Wed, 18 May 2022 15:51:46 +0000"  >&lt;p&gt;An additional hit on CircleCI: &lt;a href=&quot;https://app.circleci.com/pipelines/github/adelapena/cassandra/1569/workflows/30de5a88-d34c-42a0-a419-c52015ff5c3b/jobs/16742&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://app.circleci.com/pipelines/github/adelapena/cassandra/1569/workflows/30de5a88-d34c-42a0-a419-c52015ff5c3b/jobs/16742&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17559900" author="JIRAUSER291682" created="Tue, 28 Jun 2022 18:07:50 +0000"  >&lt;p&gt;This timeout issue happens since 3.0.17. This can be reproduced by: &lt;b&gt;ant test-compression -Dtest.name=ScrubTest&lt;/b&gt;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;Using&#160;&lt;em&gt;git bisect&lt;/em&gt;&#160;found that this &lt;a href=&quot;https://github.com/apache/cassandra/commit/34a1d5da58fb8edcad39633084541bb4162f5ede&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;commit&lt;/a&gt; is the first bad commit for this test.&lt;/p&gt;</comment>
                            <comment id="17559983" author="JIRAUSER291682" created="Tue, 28 Jun 2022 22:56:50 +0000"  >&lt;p&gt;I have a patch for fixing this issue for 3.0&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/apache/cassandra/pull/1707&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/cassandra/pull/1707&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;I can&apos;t find the submit patch button. &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=chovatia.jaydeep%40gmail.com&quot; class=&quot;user-hover&quot; rel=&quot;chovatia.jaydeep@gmail.com&quot;&gt;chovatia.jaydeep@gmail.com&lt;/a&gt; could you please help?&lt;/p&gt;</comment>
                            <comment id="17560243" author="adelapena" created="Wed, 29 Jun 2022 12:32:44 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=curlylrt&quot; class=&quot;user-hover&quot; rel=&quot;curlylrt&quot;&gt;curlylrt&lt;/a&gt; I&apos;ve set this as patch available and assigned it to you, if that&apos;s ok.&lt;/p&gt;</comment>
                            <comment id="17560343" author="brandon.williams" created="Wed, 29 Jun 2022 16:06:25 +0000"  >&lt;p&gt;&lt;a href=&quot;https://app.circleci.com/pipelines/github/driftx/cassandra/540/workflows/0dc612e5-8b18-4e53-9cef-947c50f0bdcb&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;Here&lt;/a&gt; is a CI run with the test &lt;a href=&quot;https://app.circleci.com/pipelines/github/driftx/cassandra/540/workflows/0dc612e5-8b18-4e53-9cef-947c50f0bdcb/jobs/6499&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;repeated&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="17560353" author="JIRAUSER291682" created="Wed, 29 Jun 2022 16:21:36 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=brandon.williams&quot; class=&quot;user-hover&quot; rel=&quot;brandon.williams&quot;&gt;brandon.williams&lt;/a&gt; , can you please try to run the utest-compression tests? This fix should fix the compression version of org.apache.cassandra.db.ScrubTest.testScrubCorruptedCounterRow&lt;/p&gt;

&lt;p&gt;Thank you!&lt;/p&gt;</comment>
                            <comment id="17560379" author="brandon.williams" created="Wed, 29 Jun 2022 16:57:23 +0000"  >&lt;p&gt;&lt;a href=&quot;https://ci-cassandra.apache.org/blue/organizations/jenkins/Cassandra-devbranch/detail/Cassandra-devbranch/1816/pipeline&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;&lt;span class=&quot;image-wrap&quot; style=&quot;&quot;&gt;&lt;img src=&quot;https://ci-cassandra.apache.org/job/Cassandra-devbranch/1816/badge/icon&quot; style=&quot;border: 0px solid black&quot; /&gt;&lt;/span&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Unfortunately we can&apos;t yet multiplex a test in Jenkins.&lt;/p&gt;</comment>
                            <comment id="17561022" author="adelapena" created="Thu, 30 Jun 2022 12:30:48 +0000"  >&lt;p&gt;Here are some repeated runs of &lt;tt&gt;ScrubTest&lt;/tt&gt; on CircleCI using compression: &lt;a href=&quot;https://app.circleci.com/pipelines/github/adelapena/cassandra/1794/workflows/9d4ebf18-5f3d-40ea-8016-b0834dcd2b6e&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://app.circleci.com/pipelines/github/adelapena/cassandra/1794/workflows/9d4ebf18-5f3d-40ea-8016-b0834dcd2b6e&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;They have been generated with:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
.circleci/generate.sh -m \
  -e REPEATED_UTEST_TARGET=test-compression \
  -e REPEATED_UTEST_COUNT=1000 \
  -e REPEATED_UTEST_CLASS=ScrubTest
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;They have all succeeded.&lt;/p&gt;</comment>
                            <comment id="17567991" author="adelapena" created="Mon, 18 Jul 2022 13:11:37 +0000"  >&lt;p&gt;I&apos;m not very familiarized with the topic but it looks good to me. The failure is easy to reproduce on 3.0, even locally with:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
ant test-compression -Dtest.name=&lt;span class=&quot;code-quote&quot;&gt;&quot;ScrubTest&quot;&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&lt;a href=&quot;https://app.circleci.com/pipelines/github/adelapena/cassandra/1794/workflows/9d4ebf18-5f3d-40ea-8016-b0834dcd2b6e&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;The CI run above&lt;/a&gt; using the&#160;proposed patch looks good. The only failures in that run are those already reported by &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-17701&quot; title=&quot;Failing test: TestRepair.test_failure_during_validation &quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-17701&quot;&gt;&lt;del&gt;CASSANDRA-17701&lt;/del&gt;&lt;/a&gt; and &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-17702&quot; title=&quot;Fix flaky dtest - repair_tests.repair_test.TestRepair.test_dead_sync_initiator&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-17702&quot;&gt;CASSANDRA-17702&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://app.circleci.com/pipelines/github/adelapena/cassandra/1934/workflows/24f7e389-7de4-42ee-9f0d-84e558b71e08&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;Repeated runs for 3.11&lt;/a&gt; seem to confirm that the problem doesn&apos;t affect that branch.&lt;/p&gt;</comment>
                            <comment id="17569720" author="JIRAUSER291682" created="Thu, 21 Jul 2022 23:34:58 +0000"  >&lt;p&gt;I think this is only broken in 3.0. The fix is mostly borrowed from 3.11/4.0 code. The bug in 3.0 is that when throwing error &lt;a href=&quot;https://github.com/apache/cassandra/pull/1707/files#diff-34814e77850d8cdcae4e28d7edb14ae7a3052c2e28101ca7c347687fc427670aR122&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;here&lt;/a&gt;, the checksum is not reset. We need to reset checksum every time we try to compare. 3.11 and 4.0 has the function to calculate the checksum. Also, we need to clear the buffer to make sure the reader doesn&apos;t see stale data. 4.0 has similar code &lt;a href=&quot;https://github.com/apache/cassandra/blob/trunk/src/java/org/apache/cassandra/io/util/CompressedChunkReader.java#L165&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;here&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="17570920" author="adelapena" created="Mon, 25 Jul 2022 14:07:54 +0000"  >&lt;p&gt;I agree, this only affects 3.0. I&apos;m +1 to the changes, now we need the review of a second committer.&lt;/p&gt;</comment>
                            <comment id="17576690" author="bereng" created="Mon, 8 Aug 2022 10:25:06 +0000"  >&lt;p&gt;+1&lt;/p&gt;</comment>
                            <comment id="17576763" author="adelapena" created="Mon, 8 Aug 2022 13:04:06 +0000"  >&lt;p&gt;Thanks, committed to 3.0 as&#160;&lt;a href=&quot;https://github.com/apache/cassandra/commit/299bfaed350e502541190dd1886942dfbcc3371d&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;299bfaed350e502541190dd1886942dfbcc3371d&lt;/a&gt;.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                            <outwardlinks description="duplicates">
                                        <issuelink>
            <issuekey id="13369802">CASSANDRA-16562</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[curlylrt]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12313825" key="com.atlassian.jira.plugin.system.customfieldtypes:cascadingselect">
                        <customfieldname>Bug Category</customfieldname>
                        <customfieldvalues>
                                                    <customfieldvalue key="12982" cascade-level=""><![CDATA[Correctness]]></customfieldvalue>
                                <customfieldvalue key="12990" cascade-level="1"><![CDATA[Test Failure]]></customfieldvalue>
            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12313821" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Complexity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12965"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313822" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Discovered By</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12970"><![CDATA[Unit Test]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12313922" key="jira.plugin.projectspecificselectfield.jpssf:multicftype">
                        <customfieldname>Impacts</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="13100"><![CDATA[None]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            3 years, 14 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12313921" key="jira.plugin.projectspecificselectfield.jpssf:multicftype">
                        <customfieldname>Platform</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="13076"><![CDATA[All]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0z0w8:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[adelapena]]></customfieldvalue>
        <customfieldvalue><![CDATA[bereng]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12962"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12311420" key="com.atlassian.jira.plugin.system.customfieldtypes:version">
                        <customfieldname>Since Version</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="12332361">3.0 alpha 1</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313924" key="com.atlassian.jira.plugin.system.customfieldtypes:textfield">
                        <customfieldname>Source Control Link</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>&lt;p&gt;&lt;a href=&quot;https://github.com/apache/cassandra/commit/299bfaed350e502541190dd1886942dfbcc3371d&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/cassandra/commit/299bfaed350e502541190dd1886942dfbcc3371d&lt;/a&gt;&lt;/p&gt;</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313823" key="com.atlassian.jira.plugin.system.customfieldtypes:textarea">
                        <customfieldname>Test and Documentation Plan</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>&lt;p&gt;&lt;a href=&quot;https://github.com/apache/cassandra/pull/1707&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/cassandra/pull/1707&lt;/a&gt;&lt;/p&gt;</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>