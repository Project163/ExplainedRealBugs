<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 22:45:23 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-7267] Embedded sets in user defined data-types are not updating</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-7267</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;Hi,&lt;/p&gt;

&lt;p&gt;i just played around with Cassandra 2.1.0 beta2 and i might have found an issue with embedded Sets in User Defined Data Types.&lt;/p&gt;

&lt;p&gt;Here is how i can reproduce it:&lt;br/&gt;
1.) Create a keyspace &quot;test&quot;&lt;br/&gt;
2.) Create a table like this:&lt;br/&gt;
&lt;tt&gt;create table songs (title varchar PRIMARY KEY, band varchar, tags Set&amp;lt;varchar&amp;gt;);&lt;/tt&gt;&lt;/p&gt;

&lt;p&gt;3.) Create a udt like this:&lt;br/&gt;
&lt;tt&gt;create type band_info_type (founded timestamp, members Set&amp;lt;varchar&amp;gt;, description text);&lt;/tt&gt;&lt;/p&gt;

&lt;p&gt;4.) Try to insert data:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;insert into songs (title, band, band_info, tags) values (&lt;span class=&quot;code-quote&quot;&gt;&apos;The trooper&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;Iron Maiden&apos;&lt;/span&gt;, {founded:188694000, members: {&lt;span class=&quot;code-quote&quot;&gt;&apos;Bruce Dickinson&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;Dave Murray&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;Adrian Smith&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;Janick Gers&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;Steve Harris&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;Nicko McBrain&apos;&lt;/span&gt;}, description: &lt;span class=&quot;code-quote&quot;&gt;&apos;Pure evil metal&apos;&lt;/span&gt;}, {&lt;span class=&quot;code-quote&quot;&gt;&apos;metal&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;england&apos;&lt;/span&gt;});
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;5.) Select the data:&lt;br/&gt;
&lt;tt&gt;select * from songs;&lt;/tt&gt;&lt;br/&gt;
Returns this:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;The trooper | Iron Maiden | {founded: &lt;span class=&quot;code-quote&quot;&gt;&apos;1970-01-03 05:24:54+0100&apos;&lt;/span&gt;, members: {}, description: &lt;span class=&quot;code-quote&quot;&gt;&apos;Pure evil metal&apos;&lt;/span&gt;} | {&lt;span class=&quot;code-quote&quot;&gt;&apos;england&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;metal&apos;&lt;/span&gt;}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;The embedded data-set seems to empty. I also tried updating a row which also does not seem to work.&lt;/p&gt;

&lt;p&gt;Regards,&lt;br/&gt;
Thomas&lt;/p&gt;</description>
                <environment></environment>
        <key id="12715264">CASSANDRA-7267</key>
            <summary>Embedded sets in user defined data-types are not updating</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10002" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Normal</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="mishail">Mikhail Stepura</assignee>
                                    <reporter username="Alien2150">Thomas Zimmer</reporter>
                        <labels>
                    </labels>
                <created>Mon, 19 May 2014 19:10:51 +0000</created>
                <updated>Tue, 16 Apr 2019 09:31:44 +0000</updated>
                            <resolved>Wed, 28 May 2014 22:15:34 +0000</resolved>
                                        <fixVersion>2.1 rc1</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="14005682" author="mishail" created="Thu, 22 May 2014 07:13:53 +0000"  >&lt;p&gt;It looks like a cqlsh bug&lt;/p&gt;</comment>
                            <comment id="14005686" author="mishail" created="Thu, 22 May 2014 07:17:16 +0000"  >&lt;p&gt;The server returns non-empty &lt;tt&gt;members&lt;/tt&gt;, but cqlsh fails to decode that for some reason&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&amp;gt;&amp;gt;&amp;gt; from cassandra.cluster &lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; Cluster
&amp;gt;&amp;gt;&amp;gt; cluster = Cluster()
&amp;gt;&amp;gt;&amp;gt; session = cluster.connect(&lt;span class=&quot;code-quote&quot;&gt;&apos;test&apos;&lt;/span&gt;)
&amp;gt;&amp;gt;&amp;gt; r = session.execute(&lt;span class=&quot;code-quote&quot;&gt;&quot;select * from songs&quot;&lt;/span&gt;)
&amp;gt;&amp;gt;&amp;gt; print r
[Row(title=u&lt;span class=&quot;code-quote&quot;&gt;&apos;The trooper&apos;&lt;/span&gt;, band=u&lt;span class=&quot;code-quote&quot;&gt;&apos;Iron Maiden&apos;&lt;/span&gt;, band_info=&lt;span class=&quot;code-quote&quot;&gt;&apos;\x00\x00\x00\x08\x00\x00\x00\x00\x0b?=\xf0\x00\x00\x00f\x00\x00\x00\x06\x00\x00\x00\x0cAdrian Smith\x00\x00\x00\x0fBruce Dickinson\x00\x00\x00\x0bDave Murray\x00\x00\x00\x0bJanick Gers\x00\x00\x00\rNicko McBrain\x00\x00\x00\x0cSteve Harris\x00\x00\x00\x0fPure evil metal&apos;&lt;/span&gt;, tags=sortedset([u&lt;span class=&quot;code-quote&quot;&gt;&apos;england&apos;&lt;/span&gt;, u&lt;span class=&quot;code-quote&quot;&gt;&apos;metal&apos;&lt;/span&gt;]))]
&amp;gt;&amp;gt;&amp;gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="14005687" author="mishail" created="Thu, 22 May 2014 07:19:59 +0000"  >&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&amp;gt;&amp;gt;&amp;gt; r = session.execute(&lt;span class=&quot;code-quote&quot;&gt;&quot;select band_info from songs&quot;&lt;/span&gt;)
&amp;gt;&amp;gt;&amp;gt; print r
[Row(band_info=&lt;span class=&quot;code-quote&quot;&gt;&apos;\x00\x00\x00\x08\x00\x00\x00\x00\x0b?=\xf0\x00\x00\x00f\x00\x00\x00\x06\x00\x00\x00\x0cAdrian Smith\x00\x00\x00\x0fBruce Dickinson\x00\x00\x00\x0bDave Murray\x00\x00\x00\x0bJanick Gers\x00\x00\x00\rNicko McBrain\x00\x00\x00\x0cSteve Harris\x00\x00\x00\x0fPure evil metal&apos;&lt;/span&gt;)]


&amp;gt;&amp;gt;&amp;gt; r = session.execute(&lt;span class=&quot;code-quote&quot;&gt;&quot;select band_info.members from songs&quot;&lt;/span&gt;)
&amp;gt;&amp;gt;&amp;gt; print r
[Row(band_info_members=sortedset())]
&amp;gt;&amp;gt;&amp;gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="14005698" author="mishail" created="Thu, 22 May 2014 07:45:37 +0000"  >&lt;p&gt;Here is the thing. There are 2 sets in the result, one is embedded in an user type (&lt;tt&gt;members&lt;/tt&gt;) and one is &apos;standalone&apos; (&lt;tt&gt;tags&lt;/tt&gt;). The problem is that the server sends the length of a &apos;standalone&apos; set as a 2byte short value and the length for the &apos;embedded&apos; one as a 4byte integer.&lt;/p&gt;

&lt;p&gt;The python-driver (1.1.2 in this case) always expects 2 bytes, so it fails to decode the embedded set&lt;/p&gt;

&lt;p&gt;/cc &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=thobbs&quot; class=&quot;user-hover&quot; rel=&quot;thobbs&quot;&gt;thobbs&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=slebresne&quot; class=&quot;user-hover&quot; rel=&quot;slebresne&quot;&gt;slebresne&lt;/a&gt; &lt;/p&gt;</comment>
                            <comment id="14005702" author="slebresne" created="Thu, 22 May 2014 07:53:50 +0000"  >&lt;p&gt;Yes, this is expected post-&lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-6855&quot; title=&quot;Native protocol V3&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-6855&quot;&gt;&lt;del&gt;CASSANDRA-6855&lt;/del&gt;&lt;/a&gt; and that means cqlsh/the python driver will need to be updated to use the 4 bytes encoding format inside user types.&lt;/p&gt;</comment>
                            <comment id="14007716" author="mishail" created="Fri, 23 May 2014 21:18:45 +0000"  >&lt;p&gt;Waiting for &lt;a href=&quot;https://github.com/datastax/python-driver/pull/126&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/datastax/python-driver/pull/126&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14008775" author="jbellis" created="Mon, 26 May 2014 11:43:19 +0000"  >&lt;p&gt;/cc &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=thobbs&quot; class=&quot;user-hover&quot; rel=&quot;thobbs&quot;&gt;thobbs&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14009107" author="mishail" created="Mon, 26 May 2014 22:12:03 +0000"  >&lt;p&gt;as &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=thobbs&quot; class=&quot;user-hover&quot; rel=&quot;thobbs&quot;&gt;thobbs&lt;/a&gt; correctly noticed, those proposed changes will not work for cases when a collection size &amp;gt; 65535, so they can&apos;t be accepted into the driver.&lt;br/&gt;
But probably we can use them as an interim solution to monkey patch the driver from CQLSH, until the driver is fixed.&lt;/p&gt;</comment>
                            <comment id="14009355" author="slebresne" created="Tue, 27 May 2014 07:07:02 +0000"  >&lt;blockquote&gt;&lt;p&gt;But probably we can use them as an interim solution to monkey patch the driver from CQLSH, until the driver is fixed.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I&apos;d be fine with that personally.&lt;/p&gt;</comment>
                            <comment id="14010699" author="mishail" created="Wed, 28 May 2014 03:07:59 +0000"  >&lt;p&gt;Patch to work around the problem &lt;/p&gt;</comment>
                            <comment id="14011655" author="thobbs" created="Wed, 28 May 2014 21:48:53 +0000"  >&lt;p&gt;+1&lt;/p&gt;

&lt;p&gt;(I&apos;ve started working on proper v3/2.1 support for the driver here: &lt;a href=&quot;https://github.com/datastax/python-driver/tree/2.1-support&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/datastax/python-driver/tree/2.1-support&lt;/a&gt;.  I&apos;ll open a ticket to upgrade the bundled version once that&apos;s complete and stable.)&lt;/p&gt;</comment>
                            <comment id="14011698" author="mishail" created="Wed, 28 May 2014 22:15:34 +0000"  >&lt;p&gt;Committed&lt;/p&gt;</comment>
                            <comment id="14027060" author="alien2150" created="Tue, 10 Jun 2014 21:26:39 +0000"  >&lt;p&gt;Working fine with 2.1.0-rc1. Thanks &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310050">
                    <name>Regression</name>
                                                                <inwardlinks description="is broken by">
                                        <issuelink>
            <issuekey id="12701462">CASSANDRA-6855</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12647039" name="CASSANDRA-2.1-7267.patch" size="6971" author="mishail" created="Wed, 28 May 2014 03:07:59 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[mishail]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>393550</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            11 years, 24 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1vrnr:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>393712</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>thobbs</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[thobbs]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12962"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12311420" key="com.atlassian.jira.plugin.system.customfieldtypes:version">
                        <customfieldname>Since Version</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="12326276">2.1 beta2</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>