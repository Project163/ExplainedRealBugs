<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 22:41:40 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-6385] FD phi estimator initial conditions</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-6385</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;phi estimates are calculated for newly discovered nodes from an un-filled (new, uninitialized) deque.&lt;/p&gt;

&lt;p&gt;The inter-arrival time (elapsed time between gossip heartbeats) is stored in the o.a.c.gms.ArrivalWindow.arrivalIntervale deque for each received heartbeat, up to the maximum window size of 1000 samples.&lt;/p&gt;

&lt;p&gt;In the o.a.c.gms.FailureDetector.interpret() method, phi is calculated for the node which uses a statistical measure called variance.  Like mean, variance on a population (a set of numbers or measurements) is not statistically relevant unless the population set size is 30 or greater. &lt;/p&gt;

&lt;p&gt;When a new node is discovered, the calculated variance is higher than normal, and causes phi to be higher than normal, resulting in a false positive failure detection.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12680322">CASSANDRA-6385</key>
            <summary>FD phi estimator initial conditions</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10003" iconUrl="https://issues.apache.org/jira/images/icons/priorities/trivial.svg">Low</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="jbellis">Jonathan Ellis</assignee>
                                    <reporter username="qconner">Quentin Conner</reporter>
                        <labels>
                    </labels>
                <created>Wed, 20 Nov 2013 16:51:05 +0000</created>
                <updated>Tue, 16 Apr 2019 09:31:59 +0000</updated>
                            <resolved>Thu, 21 Nov 2013 02:58:20 +0000</resolved>
                                        <fixVersion>1.2.13</fixVersion>
                    <fixVersion>2.0.3</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                                                                <comments>
                            <comment id="13827836" author="qconner" created="Wed, 20 Nov 2013 16:52:24 +0000"  >&lt;p&gt;breaking out FD phi initial condition to related issue&lt;/p&gt;</comment>
                            <comment id="13827868" author="qconner" created="Wed, 20 Nov 2013 17:21:53 +0000"  >&lt;p&gt;initial condition patch that paints a rosy picture until 30 rounds of gossip have completed and a statistically valid sample set has accumulated.&lt;/p&gt;</comment>
                            <comment id="13827901" author="jbellis" created="Wed, 20 Nov 2013 17:49:21 +0000"  >&lt;p&gt;Thinking about it more, I&apos;m not comfortable with saying that a dead node will &lt;b&gt;never&lt;/b&gt; be detected if it dies before it hits the cutoff.  v2 changes it to sqrt(phi) until it hits 30.&lt;/p&gt;

&lt;p&gt;We could probably do something more sophisticated that narrows the fudge factor as we approach our threshold of confidence.&lt;/p&gt;

&lt;p&gt;(Both of these break ArrivalWindowTest, btw.)&lt;/p&gt;</comment>
                            <comment id="13827977" author="jbellis" created="Wed, 20 Nov 2013 18:59:07 +0000"  >&lt;p&gt;Thinking about it more, I think the main problem is using too low of an initial value to seed the Window.  Interval / 2 is always smaller then the actual mean will be, and it will be increasingly too small as the cluster size grows.&lt;/p&gt;

&lt;p&gt;Picking a nice large value there gives us the &quot;large fudge to start that &quot;decays&quot; (by being averaged with real values) as we get more data&quot; behavior that we want.&lt;/p&gt;

&lt;p&gt;v3 attached.&lt;/p&gt;</comment>
                            <comment id="13828002" author="brandon.williams" created="Wed, 20 Nov 2013 19:15:08 +0000"  >&lt;p&gt;I like v3&apos;s logic much better, however on startup you can trip the assert (infinitely, if you kill a node very quickly after a round a gossip):&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;ERROR 19:10:48,249 Exception in thread Thread[GossipTasks:1,5,main]
java.lang.AssertionError
        at org.apache.cassandra.gms.ArrivalWindow.phi(FailureDetector.java:331)
        at org.apache.cassandra.gms.FailureDetector.interpret(FailureDetector.java:220)
        at org.apache.cassandra.gms.Gossiper.doStatusCheck(Gossiper.java:612)
        at org.apache.cassandra.gms.Gossiper.access$700(Gossiper.java:57)
        at org.apache.cassandra.gms.Gossiper$GossipTask.run(Gossiper.java:163)
        at org.apache.cassandra.concurrent.DebuggableScheduledThreadPoolExecutor$UncomplainingRunnable.run(DebuggableScheduledThreadPoolExecutor.java:75)
        at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:471)
        at java.util.concurrent.FutureTask$Sync.innerRunAndReset(FutureTask.java:351)
        at java.util.concurrent.FutureTask.runAndReset(FutureTask.java:178)
        at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.access$301(ScheduledThreadPoolExecutor.java:178)
        at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:293)
        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1145)
        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:615)
        at java.lang.Thread.run(Thread.java:722)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="13828012" author="jbellis" created="Wed, 20 Nov 2013 19:24:14 +0000"  >&lt;p&gt;What am I missing?  We got rid of clear, and I added code so we don&apos;t put the AW into the Map until it has at least one data point.&lt;/p&gt;</comment>
                            <comment id="13828023" author="brandon.williams" created="Wed, 20 Nov 2013 19:33:00 +0000"  >&lt;blockquote&gt;&lt;p&gt;We got rid of clear&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Well, not in v3 &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="13828035" author="jbellis" created="Wed, 20 Nov 2013 19:46:00 +0000"  >&lt;p&gt;Time to pull &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="13828058" author="brandon.williams" created="Wed, 20 Nov 2013 20:09:53 +0000"  >&lt;p&gt;Well crap, I pulled and still get it. :/&lt;/p&gt;</comment>
                            <comment id="13828066" author="brandon.williams" created="Wed, 20 Nov 2013 20:19:03 +0000"  >&lt;p&gt;I think the clue lies here:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;DEBUG 20:16:42,475 Ignoring interval time of 30000.0
 INFO 20:16:42,475 Node /10.179.65.102 is now part of the cluster
DEBUG 20:16:42,482 removing expire time for endpoint : /10.179.65.102
 INFO 20:16:42,482 InetAddress /10.179.65.102 is now UP
ERROR 20:16:43,377 Exception in thread Thread[GossipTasks:1,5,main]
java.lang.AssertionError
        at org.apache.cassandra.gms.ArrivalWindow.phi(FailureDetector.java:319)
        at org.apache.cassandra.gms.FailureDetector.interpret(FailureDetector.java:213)
        at org.apache.cassandra.gms.Gossiper.doStatusCheck(Gossiper.java:612)
        at org.apache.cassandra.gms.Gossiper.access$700(Gossiper.java:57)
        at org.apache.cassandra.gms.Gossiper$GossipTask.run(Gossiper.java:163)
        at org.apache.cassandra.concurrent.DebuggableScheduledThreadPoolExecutor$UncomplainingRunnable.run(DebuggableScheduledThreadPoolExecutor.java:75)
        at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:471)
        at java.util.concurrent.FutureTask$Sync.innerRunAndReset(FutureTask.java:351)
        at java.util.concurrent.FutureTask.runAndReset(FutureTask.java:178)
        at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.access$301(ScheduledThreadPoolExecutor.java:178)
        at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:293)
        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1145)
        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:615)
        at java.lang.Thread.run(Thread.java:722)
 INFO 20:16:43,377 Handshaking version with cassandra-1/10.179.65.102
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Which I guess we need a backdoor method to inject, because I was going to go with 10s on &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-4375&quot; title=&quot;FD incorrectly using RPC timeout to ignore gossip heartbeats&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-4375&quot;&gt;&lt;del&gt;CASSANDRA-4375&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="13828199" author="jbellis" created="Wed, 20 Nov 2013 22:11:02 +0000"  >&lt;p&gt;v4&lt;/p&gt;</comment>
                            <comment id="13828246" author="brandon.williams" created="Wed, 20 Nov 2013 22:54:20 +0000"  >&lt;p&gt;+1&lt;/p&gt;</comment>
                            <comment id="13828436" author="jbellis" created="Thu, 21 Nov 2013 02:58:20 +0000"  >&lt;p&gt;committed&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10032">
                    <name>Blocker</name>
                                            <outwardlinks description="blocks">
                                        <issuelink>
            <issuekey id="12671666">CASSANDRA-6127</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12614933" name="6385-v2.txt" size="2813" author="jbellis" created="Wed, 20 Nov 2013 17:49:21 +0000"/>
                            <attachment id="12614949" name="6385-v3.txt" size="4180" author="jbellis" created="Wed, 20 Nov 2013 18:59:07 +0000"/>
                            <attachment id="12614921" name="6385.txt" size="530" author="qconner" created="Wed, 20 Nov 2013 17:21:53 +0000"/>
                            <attachment id="12615010" name="6835-v4.txt" size="4773" author="jbellis" created="Wed, 20 Nov 2013 22:11:02 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>4.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[jbellis]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>359587</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            12 years, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1pzmf:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>359886</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12311421" key="com.atlassian.jira.plugin.system.customfieldtypes:multiversion">
                        <customfieldname>Reproduced In</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="12324803">1.2.9</customfieldvalue>
    <customfieldvalue id="12325022">1.2.11</customfieldvalue>
    <customfieldvalue id="12325023">2.0.2</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>brandon.williams</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[brandon.williams]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12961"><![CDATA[Low]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>