<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 22:45:41 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-6397] removenode outputs confusing non-error</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-6397</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;&lt;b&gt;&lt;tt&gt;nodetool removenode force&lt;/tt&gt;&lt;/b&gt; outputs a slightly confusing error message when there is nothing for it to do.&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;Start a cluster, then kill one of the nodes.&lt;/li&gt;
	&lt;li&gt;run &lt;b&gt;&lt;tt&gt;nodetool removenode&lt;/tt&gt;&lt;/b&gt; on the node you killed.&lt;/li&gt;
	&lt;li&gt;Simultaneously, in another shell, run &lt;b&gt;&lt;tt&gt;nodetool removenode force&lt;/tt&gt;&lt;/b&gt;, see that it outputs a simple message regarding it&apos;s status.&lt;/li&gt;
	&lt;li&gt;Run &lt;b&gt;&lt;tt&gt;nodetool removenode force&lt;/tt&gt;&lt;/b&gt; again after the firsrt removenode command finishes, you&apos;ll see this message and traceback:&lt;/li&gt;
&lt;/ul&gt;


&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;$ ~/.ccm/test/node1/bin/nodetool -p 7100 removenode force
RemovalStatus: No token removals in process.
Exception in thread &lt;span class=&quot;code-quote&quot;&gt;&quot;main&quot;&lt;/span&gt; java.lang.UnsupportedOperationException: No tokens to force removal on, call &lt;span class=&quot;code-quote&quot;&gt;&apos;removetoken&apos;&lt;/span&gt; first
	at org.apache.cassandra.service.StorageService.forceRemoveCompletion(StorageService.java:3140)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:57)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:601)
	at com.sun.jmx.mbeanserver.StandardMBeanIntrospector.invokeM2(StandardMBeanIntrospector.java:111)
	at com.sun.jmx.mbeanserver.StandardMBeanIntrospector.invokeM2(StandardMBeanIntrospector.java:45)
	at com.sun.jmx.mbeanserver.MBeanIntrospector.invokeM(MBeanIntrospector.java:235)
	at com.sun.jmx.mbeanserver.PerInterface.invoke(PerInterface.java:138)
	at com.sun.jmx.mbeanserver.MBeanSupport.invoke(MBeanSupport.java:250)
	at com.sun.jmx.interceptor.DefaultMBeanServerInterceptor.invoke(DefaultMBeanServerInterceptor.java:819)
	at com.sun.jmx.mbeanserver.JmxMBeanServer.invoke(JmxMBeanServer.java:791)
	at javax.management.remote.rmi.RMIConnectionImpl.doOperation(RMIConnectionImpl.java:1486)
	at javax.management.remote.rmi.RMIConnectionImpl.access$300(RMIConnectionImpl.java:96)
	at javax.management.remote.rmi.RMIConnectionImpl$PrivilegedOperation.run(RMIConnectionImpl.java:1327)
	at javax.management.remote.rmi.RMIConnectionImpl.doPrivilegedOperation(RMIConnectionImpl.java:1419)
	at javax.management.remote.rmi.RMIConnectionImpl.invoke(RMIConnectionImpl.java:847)
	at sun.reflect.GeneratedMethodAccessor10.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:601)
	at sun.rmi.server.UnicastServerRef.dispatch(UnicastServerRef.java:322)
	at sun.rmi.transport.Transport$1.run(Transport.java:177)
	at sun.rmi.transport.Transport$1.run(Transport.java:174)
	at java.security.AccessController.doPrivileged(Native Method)
	at sun.rmi.transport.Transport.serviceCall(Transport.java:173)
	at sun.rmi.transport.tcp.TCPTransport.handleMessages(TCPTransport.java:553)
	at sun.rmi.transport.tcp.TCPTransport$ConnectionHandler.run0(TCPTransport.java:808)
	at sun.rmi.transport.tcp.TCPTransport$ConnectionHandler.run(TCPTransport.java:667)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1145)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:615)
	at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:722)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Two issues I see with this traceback:&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;&quot;No tokens to force removal on&quot; is telling me the same thing that the message before it tells me: &quot;RemovalStatus: No token removals in process.&quot;, So the entire traceback is redundant.&lt;/li&gt;
	&lt;li&gt;&quot;call &apos;removetoken&apos; first&quot; - removetoken has been deprecated according to the message output by removenode, so there is inconsistency in directions to the user.&lt;/li&gt;
&lt;/ul&gt;
</description>
                <environment></environment>
        <key id="12680789">CASSANDRA-6397</key>
            <summary>removenode outputs confusing non-error</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10003" iconUrl="https://issues.apache.org/jira/images/icons/priorities/trivial.svg">Low</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="kirktrue">Kirk True</assignee>
                                    <reporter username="enigmacurry">Ryan McGuire</reporter>
                        <labels>
                            <label>lhf</label>
                    </labels>
                <created>Fri, 22 Nov 2013 17:58:44 +0000</created>
                <updated>Tue, 16 Apr 2019 09:31:59 +0000</updated>
                            <resolved>Thu, 12 Jun 2014 22:34:58 +0000</resolved>
                                        <fixVersion>2.0.9</fixVersion>
                    <fixVersion>2.1 rc2</fixVersion>
                                    <component>Legacy/Tools</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="13830249" author="brandon.williams" created="Fri, 22 Nov 2013 19:25:50 +0000"  >&lt;p&gt;Changed all removetoken references to removenode in da5ff080550.  The rest should be fairly easy in nodetool.&lt;/p&gt;</comment>
                            <comment id="13978469" author="kirktrue" created="Wed, 23 Apr 2014 17:06:38 +0000"  >&lt;p&gt;Sorry, I&apos;m a little confused by the steps to reproduce. The first step says to &quot;kill one of the nodes&quot; but the second step uses nodetool on that same node. When I attempt step 2:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;$ ~/.ccm/CASSANDRA-6397/node1/bin/nodetool -p 7100 removenode
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I get this:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;nodetool: Failed to connect to &apos;127.0.0.1:7100&apos; - ConnectException: &apos;Connection refused&apos;.
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Is there a missing step or something I&apos;m missing?&lt;/p&gt;

&lt;p&gt;Thanks.&lt;/p&gt;</comment>
                            <comment id="13978486" author="brandon.williams" created="Wed, 23 Apr 2014 17:19:50 +0000"  >&lt;p&gt;You have some kind of JMX problem.&lt;/p&gt;</comment>
                            <comment id="13978492" author="kirktrue" created="Wed, 23 Apr 2014 17:23:49 +0000"  >&lt;p&gt;I killed the node using &lt;tt&gt;kill -9 &amp;lt;PID of node1&amp;gt;&lt;/tt&gt;. Thus the JVM and its JMX hooks aren&apos;t around anymore. Previous to the kill I was able to access the node via JMX OK.&lt;/p&gt;</comment>
                            <comment id="13978508" author="brandon.williams" created="Wed, 23 Apr 2014 17:34:36 +0000"  >&lt;p&gt;It doesn&apos;t mean run nodetool &lt;b&gt;against&lt;/b&gt; the same node, it means &apos;remove the node you just killed&apos;&lt;/p&gt;</comment>
                            <comment id="13999820" author="jbellis" created="Fri, 16 May 2014 14:16:28 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=brandon.williams&quot; class=&quot;user-hover&quot; rel=&quot;brandon.williams&quot;&gt;brandon.williams&lt;/a&gt; to review&lt;/p&gt;</comment>
                            <comment id="13999841" author="jbellis" created="Fri, 16 May 2014 14:35:45 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=brandon.williams&quot; class=&quot;user-hover&quot; rel=&quot;brandon.williams&quot;&gt;brandon.williams&lt;/a&gt; to review&lt;/p&gt;</comment>
                            <comment id="13999984" author="brandon.williams" created="Fri, 16 May 2014 16:58:29 +0000"  >&lt;p&gt;Why switch to a boolean that we never check?&lt;/p&gt;</comment>
                            <comment id="14003629" author="kirktrue" created="Tue, 20 May 2014 16:58:05 +0000"  >&lt;p&gt;Yes, I agree that&apos;s ugly.&lt;/p&gt;

&lt;p&gt;My concern is that this change turns an error case (forcing when nothing is being removed) into a non-error case. Do users of either nodetool or JMX rely on getting an error? Do they need to know that their request was a no-op when they ask to force a removenode?&lt;/p&gt;

&lt;p&gt;If so, they can check the boolean, kind of like File.delete(). But if you want, I can just remove the boolean FYI flag altogether.&lt;/p&gt;</comment>
                            <comment id="14003640" author="brandon.williams" created="Tue, 20 May 2014 17:05:30 +0000"  >&lt;p&gt;I think we&apos;re conflating a couple issues here.  I think Ryan&apos;s point is there shouldn&apos;t be a stacktrace printed, but if there is a problem we should report that and exit with a non-zero code.  Programmatically though, the boolean is completely unused as the patch stands, so we don&apos;t need that unless it&apos;s to enable solving the first problem.&lt;/p&gt;</comment>
                            <comment id="14007354" author="kirktrue" created="Fri, 23 May 2014 16:51:03 +0000"  >&lt;p&gt;Removed boolean return value.&lt;/p&gt;</comment>
                            <comment id="14029941" author="brandon.williams" created="Thu, 12 Jun 2014 22:34:58 +0000"  >&lt;p&gt;I don&apos;t think any has been relying on catching an exception here, and if they have they&apos;ve been doing it wrong.  If anyone needs this they can open a new one.  Committed.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12644530" name="trunk-6397.txt" size="2847" author="kirktrue" created="Tue, 13 May 2014 01:07:18 +0000"/>
                            <attachment id="12646542" name="trunk-6397.v2.txt" size="644" author="kirktrue" created="Fri, 23 May 2014 16:50:47 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[kirktrue]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>360054</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            11 years, 23 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1q2hb:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>360353</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12311421" key="com.atlassian.jira.plugin.system.customfieldtypes:multiversion">
                        <customfieldname>Reproduced In</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="12325272">1.2.12</customfieldvalue>
    <customfieldvalue id="12325322">2.0.3</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>brandon.williams</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[brandon.williams]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12961"><![CDATA[Low]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>