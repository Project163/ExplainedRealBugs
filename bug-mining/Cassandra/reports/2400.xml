<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 22:40:50 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-6149] OOM in Cassandra 2.0.1</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-6149</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;I have a program to stress test Cassandra. What it does is remove/insert rows with a small set of row keys as fast as possible. Two CFs are involved. When I test against C* 1.2.3 with default configurations, it ran for 24 hours and C* doesn&apos;t having any issue. However after I upgraded to C* 2.0.1, C* crashes on OOM within 1-2 minutes. I can consistently reproduce this.&lt;/p&gt;

&lt;p&gt;I built C* from the source and found out the last good changeset is cfa097cdd5e28d7fe8204248e246a1fae226d2c0. As soon as I include the next changeset 1e0d9513b748fae4ec0737283da71c65e9272102, C* starts to crash. What&apos;s interesting is although it seems the change was reverted by fc1a7206fe15882fd64e7ba8eb68ba9dc320275f. C* built from fc1a7206fe15882fd64e7ba8eb68ba9dc320275f has the same problem - OOM within minutes.&lt;/p&gt;

&lt;p&gt;I didn&apos;t test against the official 2.0.0. But the C* built from 03045ca22b11b0e5fc85c4fabd83ce6121b5709b seems OK. I assume that&apos;s what 2.0.0 is.&lt;/p&gt;

&lt;p&gt;I use default configurations in all cases. I didn&apos;t tune anything.&lt;/p&gt;</description>
                <environment>&lt;p&gt;Windows 7 64 bit. Java 64-bit 1.7.0_25. Cassandra 2.0.1&lt;/p&gt;</environment>
        <key id="12672509">CASSANDRA-6149</key>
            <summary>OOM in Cassandra 2.0.1</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10002" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Normal</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="jbellis">Jonathan Ellis</assignee>
                                    <reporter username="depend">Kai Wang</reporter>
                        <labels>
                    </labels>
                <created>Sun, 6 Oct 2013 04:30:50 +0000</created>
                <updated>Tue, 16 Apr 2019 09:32:03 +0000</updated>
                            <resolved>Mon, 7 Oct 2013 19:21:03 +0000</resolved>
                                        <fixVersion>2.0.2</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="13787509" author="jbellis" created="Sun, 6 Oct 2013 06:24:13 +0000"  >&lt;p&gt;It doesn&apos;t entirely shock me that 1e0d9513b748fae4ec0737283da71c65e9272102 could cause problems (&lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-5661&quot; title=&quot;Discard pooled readers for cold data&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-5661&quot;&gt;&lt;del&gt;CASSANDRA-5661&lt;/del&gt;&lt;/a&gt;).&lt;/p&gt;

&lt;p&gt;What does the heap dump show is using all the memory?  &lt;a href=&quot;http://www.eclipse.org/mat/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://www.eclipse.org/mat/&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13787587" author="depend" created="Sun, 6 Oct 2013 12:48:11 +0000"  >&lt;p&gt;MAT shows &quot;One instance of &quot;com.google.common.cache.LocalCache&quot; loaded by &quot;sun.misc.Launcher$AppClassLoader @ 0xd03530b0&quot; occupies 942,959,256 (91.01%) bytes.&quot;&lt;/p&gt;

&lt;p&gt;Another thing I notice is this OOM accompanoes with a LOT of &quot;Unable to delete ... (it will be removed on server restart; we&apos;ll also retry after GC)&quot; errors. I understand it might be OK on Windows. But the amount of such errors I see with 1e0d9513b748fae4ec0737283da71c65e9272102 seem unusual. In fact I don&apos;t see a single such error   prior to 1e0d9513b748fae4ec0737283da71c65e9272102.&lt;/p&gt;</comment>
                            <comment id="13787653" author="jbellis" created="Sun, 6 Oct 2013 15:52:42 +0000"  >&lt;p&gt;I think we have a bug in cache size estimation, but I&apos;m not sure how that turns into more-memory-used-than-1-2 which simply caches all readers.&lt;/p&gt;

&lt;p&gt;Attached is a patch to add some debug logging.  Can you test after enabling debug on org.apache.cassandra.service.FileCacheService?&lt;/p&gt;</comment>
                            <comment id="13787701" author="depend" created="Sun, 6 Oct 2013 17:43:33 +0000"  >&lt;p&gt;I got a bunch of &quot;less than&quot; estimation. Here is the part right before OOM:&lt;/p&gt;

&lt;p&gt;...&lt;br/&gt;
DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;ReadStage:32&amp;#93;&lt;/span&gt; 2013-10-06 13:33:36,610 FileCacheService.java (line 137) Estimated memory usage 327680 is less than threshold 258998272; caching reader for D:\var\lib\cassandra\data\Keyspace1\MetaData\Keyspace1-MetaData-jb-1-Data.db&lt;br/&gt;
DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;ReadStage:22&amp;#93;&lt;/span&gt; 2013-10-06 13:33:36,614 FileCacheService.java (line 127) Estimated memory usage is 327680 compared to actual usage 464191488&lt;br/&gt;
DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;ReadStage:22&amp;#93;&lt;/span&gt; 2013-10-06 13:33:36,614 FileCacheService.java (line 137) Estimated memory usage 327680 is less than threshold 258998272; caching reader for D:\var\lib\cassandra\data\Keyspace1\MetaData\Keyspace1-MetaData-jb-1-Data.db&lt;br/&gt;
 INFO &lt;span class=&quot;error&quot;&gt;&amp;#91;ScheduledTasks:1&amp;#93;&lt;/span&gt; 2013-10-06 13:33:36,913 GCInspector.java (line 116) GC for ConcurrentMarkSweep: 962 ms for 4 collections, 1036218016 used; max is 1037959168&lt;br/&gt;
DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;ReadStage:24&amp;#93;&lt;/span&gt; 2013-10-06 13:33:36,916 FileCacheService.java (line 127) Estimated memory usage is 327680 compared to actual usage 464257024&lt;br/&gt;
DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;ReadStage:24&amp;#93;&lt;/span&gt; 2013-10-06 13:33:36,916 FileCacheService.java (line 137) Estimated memory usage 327680 is less than threshold 258998272; caching reader for D:\var\lib\cassandra\data\Keyspace1\Keyword\Keyspace1-Keyword-jb-1-Data.db&lt;br/&gt;
DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;ReadStage:25&amp;#93;&lt;/span&gt; 2013-10-06 13:33:36,918 FileCacheService.java (line 127) Estimated memory usage is 327680 compared to actual usage 464322560&lt;br/&gt;
DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;ReadStage:25&amp;#93;&lt;/span&gt; 2013-10-06 13:33:36,919 FileCacheService.java (line 137) Estimated memory usage 327680 is less than threshold 258998272; caching reader for D:\var\lib\cassandra\data\Keyspace1\MetaData\Keyspace1-MetaData-jb-1-Data.db&lt;br/&gt;
DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;ReadStage:19&amp;#93;&lt;/span&gt; 2013-10-06 13:33:36,920 FileCacheService.java (line 127) Estimated memory usage is 327680 compared to actual usage 464388096&lt;br/&gt;
DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;ReadStage:19&amp;#93;&lt;/span&gt; 2013-10-06 13:33:36,920 FileCacheService.java (line 137) Estimated memory usage 327680 is less than threshold 258998272; caching reader for D:\var\lib\cassandra\data\Keyspace1\MetaData\Keyspace1-MetaData-jb-1-Data.db&lt;br/&gt;
DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;ReadStage:10&amp;#93;&lt;/span&gt; 2013-10-06 13:33:36,939 FileCacheService.java (line 127) Estimated memory usage is 327680 compared to actual usage 464453632&lt;br/&gt;
DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;ReadStage:10&amp;#93;&lt;/span&gt; 2013-10-06 13:33:36,940 FileCacheService.java (line 137) Estimated memory usage 327680 is less than threshold 258998272; caching reader for D:\var\lib\cassandra\data\Keyspace1\MetaData\Keyspace1-MetaData-jb-1-Data.db&lt;br/&gt;
DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;ReadStage:10&amp;#93;&lt;/span&gt; 2013-10-06 13:33:36,941 FileCacheService.java (line 127) Estimated memory usage is 327680 compared to actual usage 464519168&lt;br/&gt;
DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;ReadStage:10&amp;#93;&lt;/span&gt; 2013-10-06 13:33:36,941 FileCacheService.java (line 137) Estimated memory usage 327680 is less than threshold 258998272; caching reader for D:\var\lib\cassandra\data\Keyspace1\MetaData\Keyspace1-MetaData-jb-1-Data.db&lt;br/&gt;
DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;ReadStage:30&amp;#93;&lt;/span&gt; 2013-10-06 13:33:37,171 FileCacheService.java (line 127) Estimated memory usage is 327680 compared to actual usage 464584704&lt;br/&gt;
DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;ReadStage:30&amp;#93;&lt;/span&gt; 2013-10-06 13:33:37,171 FileCacheService.java (line 137) Estimated memory usage 327680 is less than threshold 258998272; caching reader for D:\var\lib\cassandra\data\Keyspace1\MetaData\Keyspace1-MetaData-jb-1-Data.db&lt;br/&gt;
DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;ReadStage:7&amp;#93;&lt;/span&gt; 2013-10-06 13:33:37,171 FileCacheService.java (line 127) Estimated memory usage is 327680 compared to actual usage 464584704&lt;br/&gt;
DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;ReadStage:8&amp;#93;&lt;/span&gt; 2013-10-06 13:33:37,171 FileCacheService.java (line 127) Estimated memory usage is 327680 compared to actual usage 464584704&lt;br/&gt;
DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;ReadStage:8&amp;#93;&lt;/span&gt; 2013-10-06 13:33:37,171 FileCacheService.java (line 137) Estimated memory usage 327680 is less than threshold 258998272; caching reader for D:\var\lib\cassandra\data\Keyspace1\MetaData\Keyspace1-MetaData-jb-1-Data.db&lt;br/&gt;
DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;ReadStage:11&amp;#93;&lt;/span&gt; 2013-10-06 13:33:37,171 FileCacheService.java (line 127) Estimated memory usage is 327680 compared to actual usage 464584704&lt;br/&gt;
DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;ReadStage:11&amp;#93;&lt;/span&gt; 2013-10-06 13:33:37,171 FileCacheService.java (line 137) Estimated memory usage 327680 is less than threshold 258998272; caching reader for D:\var\lib\cassandra\data\Keyspace1\MetaData\Keyspace1-MetaData-jb-1-Data.db&lt;br/&gt;
DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;ReadStage:7&amp;#93;&lt;/span&gt; 2013-10-06 13:33:37,171 FileCacheService.java (line 137) Estimated memory usage 327680 is less than threshold 258998272; caching reader for D:\var\lib\cassandra\data\Keyspace1\MetaData\Keyspace1-MetaData-jb-1-Data.db&lt;br/&gt;
DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;ReadStage:17&amp;#93;&lt;/span&gt; 2013-10-06 13:33:39,618 FileCacheService.java (line 127) Estimated memory usage is 327680 compared to actual usage 464846848&lt;br/&gt;
DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;ReadStage:17&amp;#93;&lt;/span&gt; 2013-10-06 13:33:39,848 FileCacheService.java (line 137) Estimated memory usage 327680 is less than threshold 258998272; caching reader for D:\var\lib\cassandra\data\Keyspace1\MetaData\Keyspace1-MetaData-jb-1-Data.db&lt;br/&gt;
ERROR &lt;span class=&quot;error&quot;&gt;&amp;#91;ReadStage:23&amp;#93;&lt;/span&gt; 2013-10-06 13:33:39,848 CassandraDaemon.java (line 185) Exception in thread Thread&lt;span class=&quot;error&quot;&gt;&amp;#91;ReadStage:23,5,main&amp;#93;&lt;/span&gt;&lt;br/&gt;
java.lang.OutOfMemoryError: Java heap space&lt;br/&gt;
...&lt;/p&gt;

&lt;p&gt;It does look like an estimation error.&lt;/p&gt;</comment>
                            <comment id="13787711" author="jbellis" created="Sun, 6 Oct 2013 17:58:25 +0000"  >&lt;p&gt;How many requests/hits are in FileCacheMetrics?  (Use JConsole to look at o.a.c.metrics.FCM)&lt;/p&gt;</comment>
                            <comment id="13787728" author="jbellis" created="Sun, 6 Oct 2013 18:47:21 +0000"  >&lt;p&gt;While the size bug is the proximate cause of the OOM, it looks like it&apos;s never actually re-using the cached entries because it&apos;s comparing non-absolute with absolute paths.  Attached patch fixes both.&lt;/p&gt;</comment>
                            <comment id="13787828" author="depend" created="Sun, 6 Oct 2013 23:41:32 +0000"  >&lt;p&gt;fix is confirmed. Thank you.&lt;/p&gt;</comment>
                            <comment id="13788422" author="xedin" created="Mon, 7 Oct 2013 18:39:45 +0000"  >&lt;p&gt;+1&lt;/p&gt;</comment>
                            <comment id="13788470" author="jbellis" created="Mon, 7 Oct 2013 19:21:03 +0000"  >&lt;p&gt;committed&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12607082" name="6149-debug.txt" size="2253" author="jbellis" created="Sun, 6 Oct 2013 15:52:42 +0000"/>
                            <attachment id="12607096" name="6149.txt" size="8798" author="jbellis" created="Sun, 6 Oct 2013 18:47:41 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[jbellis]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>352136</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            12 years, 7 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1opnz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>352424</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12311421" key="com.atlassian.jira.plugin.system.customfieldtypes:multiversion">
                        <customfieldname>Reproduced In</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="12324542">2.0.1</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>xedin</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[xedin]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12962"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12311420" key="com.atlassian.jira.plugin.system.customfieldtypes:version">
                        <customfieldname>Since Version</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="12324542">2.0.1</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>