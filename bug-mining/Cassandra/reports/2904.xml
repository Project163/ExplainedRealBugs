<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 22:46:00 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-7373] Commit logs no longer deleting and MemtablePostFlusher pending growing</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-7373</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;We have this issue where once in a while, we get into a situation where the MemtablePostFlusher is not executing and the space used by the commit logs on disks keeps on increasing and increasing.&lt;/p&gt;

&lt;p&gt;We can observe the problem by invoking nodetool tpstats:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;Pool Name                    Active   Pending      Completed   Blocked  All time blocked
ReadStage                         6         6       46650213         0                 0
RequestResponseStage              0         0      130547421         0                 0
MutationStage                     2         2      116813206         0                 0
ReadRepairStage                   0         0        2322201         0                 0
ReplicateOnWriteStage             0         0              0         0                 0
GossipStage                       0         0         120780         0                 0
AntiEntropyStage                  0         0              0         0                 0
MigrationStage                    0         0              0         0                 0
MemoryMeter                       0         0            456         0                 0
MemtablePostFlusher               1       447           6344         0                 0
FlushWriter                       0         0           6132         0                62
MiscStage                         0         0              0         0                 0
PendingRangeCalculator            0         0              6         0                 0
commitlog_archiver                0         0              0         0                 0
InternalResponseStage             0         0              0         0                 0
HintedHandoff                     2         2              4         0                 0

Message type           Dropped
RANGE_SLICE                  0
READ_REPAIR                  0
BINARY                       0
READ                         0
MUTATION                     0
_TRACE                       0
REQUEST_RESPONSE             0
COUNTER_MUTATION             0
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Here is a potential error in the logs that can explain this:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;ERROR [FlushWriter:2693] 2014-06-09 22:05:38,452 CassandraDaemon.java (line 191) Exception in thread &lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;[FlushWriter:2693,5,main]
java.lang.NegativeArraySizeException
	at org.apache.cassandra.io.util.FastByteArrayOutputStream.expand(FastByteArrayOutputStream.java:104)
	at org.apache.cassandra.io.util.FastByteArrayOutputStream.write(FastByteArrayOutputStream.java:220)
	at java.io.DataOutputStream.write(DataOutputStream.java:107)
	at org.apache.cassandra.io.util.DataOutputBuffer.write(DataOutputBuffer.java:60)
	at org.apache.cassandra.utils.ByteBufferUtil.write(ByteBufferUtil.java:328)
	at org.apache.cassandra.utils.ByteBufferUtil.writeWithLength(ByteBufferUtil.java:315)
	at org.apache.cassandra.db.ColumnSerializer.serialize(ColumnSerializer.java:55)
	at org.apache.cassandra.db.ColumnSerializer.serialize(ColumnSerializer.java:30)
	at org.apache.cassandra.db.OnDiskAtom$Serializer.serializeForSSTable(OnDiskAtom.java:62)
	at org.apache.cassandra.db.ColumnIndex$Builder.add(ColumnIndex.java:181)
	at org.apache.cassandra.db.ColumnIndex$Builder.build(ColumnIndex.java:133)
	at org.apache.cassandra.io.sstable.SSTableWriter.append(SSTableWriter.java:185)
	at org.apache.cassandra.db.Memtable$FlushRunnable.writeSortedContents(Memtable.java:430)
	at org.apache.cassandra.db.Memtable$FlushRunnable.runWith(Memtable.java:385)
	at org.apache.cassandra.io.util.DiskAwareRunnable.runMayThrow(DiskAwareRunnable.java:48)

&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment>&lt;p&gt;RHEL 6.5&lt;br/&gt;
Cassandra 1.12.16&lt;br/&gt;
Replication factor of 3&lt;/p&gt;</environment>
        <key id="12720228">CASSANDRA-7373</key>
            <summary>Commit logs no longer deleting and MemtablePostFlusher pending growing</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10002" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Normal</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="mishail">Mikhail Stepura</assignee>
                                    <reporter username="frichard">Francois Richard</reporter>
                        <labels>
                    </labels>
                <created>Mon, 9 Jun 2014 22:52:26 +0000</created>
                <updated>Tue, 16 Apr 2019 09:31:43 +0000</updated>
                            <resolved>Fri, 20 Jun 2014 03:17:17 +0000</resolved>
                                        <fixVersion>1.2.17</fixVersion>
                    <fixVersion>2.0.9</fixVersion>
                    <fixVersion>2.1 rc2</fixVersion>
                                        <due></due>
                            <votes>1</votes>
                                    <watches>7</watches>
                                                                                                                <comments>
                            <comment id="14028187" author="jeffery.griffith" created="Wed, 11 Jun 2014 18:37:40 +0000"  >&lt;p&gt;Adding a bit more detail to this... A warning comes on the COMMIT-LOG-WRITER thread saying it is skipping the append for a large row. There is also a lot of GCing and Gossip thinks two nodes are down.&lt;/p&gt;

&lt;p&gt; INFO &lt;span class=&quot;error&quot;&gt;&amp;#91;FlushWriter:3571&amp;#93;&lt;/span&gt; 2014-06-11 10:19:59,696 Memtable.java (line 436) Completed flushing /home/y/var/cassandra/data/SyncCore/CommEvents/SyncCore-CommEvents-ic-84518-Data.db (3647831 bytes) for commitlog position ReplayPosition(segmentId=1402438439770, position=61789)&lt;br/&gt;
 INFO &lt;span class=&quot;error&quot;&gt;&amp;#91;FlushWriter:3566&amp;#93;&lt;/span&gt; 2014-06-11 10:19:59,727 Memtable.java (line 436) Completed flushing /home/y/var/cassandra/data/SyncCore/RecentComms/SyncCore-RecentComms-ic-83750-Data.db (5619016 bytes) for commitlog position ReplayPosition(segmentId=1402438439770, position=61789)&lt;br/&gt;
 INFO &lt;span class=&quot;error&quot;&gt;&amp;#91;GossipStage:1&amp;#93;&lt;/span&gt; 2014-06-11 10:20:07,302 Gossiper.java (line 823) InetAddress /10.198.26.179 is now DOWN&lt;br/&gt;
 INFO &lt;span class=&quot;error&quot;&gt;&amp;#91;OptionalTasks:1&amp;#93;&lt;/span&gt; 2014-06-11 10:20:09,754 ColumnFamilyStore.java (line 633) Enqueuing flush of Memtable-SingleEndpointNetworks@1949516166(19390313/37748736 serialized/live bytes, 37981 ops)&lt;br/&gt;
 INFO &lt;span class=&quot;error&quot;&gt;&amp;#91;FlushWriter:3568&amp;#93;&lt;/span&gt; 2014-06-11 10:20:09,755 Memtable.java (line 398) Writing Memtable-SingleEndpointNetworks@1949516166(19390313/37748736 serialized/live bytes, 37981 ops)&lt;br/&gt;
 INFO &lt;span class=&quot;error&quot;&gt;&amp;#91;OptionalTasks:1&amp;#93;&lt;/span&gt; 2014-06-11 10:20:09,755 ColumnFamilyStore.java (line 633) Enqueuing flush of Memtable-EmailNetworkDeltas@1578090988(14498572/14502911 serialized/live bytes, 4587 ops)&lt;br/&gt;
 INFO &lt;span class=&quot;error&quot;&gt;&amp;#91;FlushWriter:3567&amp;#93;&lt;/span&gt; 2014-06-11 10:20:09,756 Memtable.java (line 398) Writing Memtable-EmailNetworkDeltas@1578090988(14498572/14502911 serialized/live bytes, 4587 ops)&lt;br/&gt;
 INFO &lt;span class=&quot;error&quot;&gt;&amp;#91;FlushWriter:3567&amp;#93;&lt;/span&gt; 2014-06-11 10:20:09,789 Memtable.java (line 436) Completed flushing /home/y/var/cassandra/data/SyncCore/EmailNetworkDeltas/SyncCore-EmailNetworkDeltas-ic-90590-Data.db (95318 bytes) for commitlog position ReplayPosition(segmentId=1402438439771, position=43352)&lt;br/&gt;
 INFO &lt;span class=&quot;error&quot;&gt;&amp;#91;FlushWriter:3568&amp;#93;&lt;/span&gt; 2014-06-11 10:20:09,985 Memtable.java (line 436) Completed flushing /home/y/var/cassandra/data/SyncCore/SingleEndpointNetworks/SyncCore-SingleEndpointNetworks-ic-88034-Data.db (9499480 bytes) for commitlog position ReplayPosition(segmentId=1402438439771, position=43352)&lt;br/&gt;
 INFO &lt;span class=&quot;error&quot;&gt;&amp;#91;OptionalTasks:1&amp;#93;&lt;/span&gt; 2014-06-11 10:20:32,805 MeteredFlusher.java (line 64) flushing high-traffic column family CFS(Keyspace=&apos;SyncCore&apos;, ColumnFamily=&apos;EndpointPrefixIndexMinimized&apos;) (estimated 650749167 bytes)&lt;br/&gt;
 INFO &lt;span class=&quot;error&quot;&gt;&amp;#91;OptionalTasks:1&amp;#93;&lt;/span&gt; 2014-06-11 10:20:32,806 ColumnFamilyStore.java (line 633) Enqueuing flush of Memtable-EndpointPrefixIndexMinimized@1634472324(74779192/650749167 serialized/live bytes, 3059166 ops)&lt;br/&gt;
 INFO &lt;span class=&quot;error&quot;&gt;&amp;#91;FlushWriter:3573&amp;#93;&lt;/span&gt; 2014-06-11 10:20:32,807 Memtable.java (line 398) Writing Memtable-EndpointPrefixIndexMinimized@1634472324(74779192/650749167 serialized/live bytes, 3059166 ops)&lt;br/&gt;
 INFO &lt;span class=&quot;error&quot;&gt;&amp;#91;FlushWriter:3573&amp;#93;&lt;/span&gt; 2014-06-11 10:20:36,459 Memtable.java (line 436) Completed flushing /home/y/var/cassandra/data/SyncCore/EndpointPrefixIndexMinimized/SyncCore-EndpointPrefixIndexMinimized-ic-127891-Data.db (34290509 bytes) for commitlog position ReplayPosition(segmentId=1402438439773, position=7326447)&lt;br/&gt;
 WARN &lt;span class=&quot;error&quot;&gt;&amp;#91;COMMIT-LOG-WRITER&amp;#93;&lt;/span&gt; 2014-06-11 10:20:52,605 CommitLog.java (line 349) Skipping commitlog append of extremely large mutation (1886300377 bytes)&lt;br/&gt;
 INFO &lt;span class=&quot;error&quot;&gt;&amp;#91;OptionalTasks:1&amp;#93;&lt;/span&gt; 2014-06-11 10:20:52,902 MeteredFlusher.java (line 64) flushing high-traffic column family CFS(Keyspace=&apos;SyncCore&apos;, ColumnFamily=&apos;EmailNetworkDeltas&apos;) (estimated 1886275564 bytes)&lt;br/&gt;
 INFO &lt;span class=&quot;error&quot;&gt;&amp;#91;OptionalTasks:1&amp;#93;&lt;/span&gt; 2014-06-11 10:20:53,452 ColumnFamilyStore.java (line 633) Enqueuing flush of Memtable-EmailNetworkDeltas@745275182(1886662001/1887226753 serialized/live bytes, 474 ops)&lt;br/&gt;
 INFO &lt;span class=&quot;error&quot;&gt;&amp;#91;FlushWriter:3577&amp;#93;&lt;/span&gt; 2014-06-11 10:20:53,452 Memtable.java (line 398) Writing Memtable-EmailNetworkDeltas@745275182(1886662001/1887226753 serialized/live bytes, 474 ops)&lt;br/&gt;
ERROR &lt;span class=&quot;error&quot;&gt;&amp;#91;FlushWriter:3577&amp;#93;&lt;/span&gt; 2014-06-11 10:20:53,463 CassandraDaemon.java (line 191) Exception in thread Thread&lt;span class=&quot;error&quot;&gt;&amp;#91;FlushWriter:3577,5,main&amp;#93;&lt;/span&gt;&lt;br/&gt;
java.lang.NegativeArraySizeException&lt;br/&gt;
        at org.apache.cassandra.io.util.FastByteArrayOutputStream.expand(FastByteArrayOutputStream.java:104)&lt;br/&gt;
        at org.apache.cassandra.io.util.FastByteArrayOutputStream.write(FastByteArrayOutputStream.java:220)&lt;br/&gt;
        at java.io.DataOutputStream.write(DataOutputStream.java:107)&lt;br/&gt;
        at org.apache.cassandra.io.util.DataOutputBuffer.write(DataOutputBuffer.java:60)&lt;br/&gt;
        at org.apache.cassandra.utils.ByteBufferUtil.write(ByteBufferUtil.java:328)&lt;br/&gt;
        at org.apache.cassandra.utils.ByteBufferUtil.writeWithLength(ByteBufferUtil.java:315)&lt;br/&gt;
        at org.apache.cassandra.db.ColumnSerializer.serialize(ColumnSerializer.java:55)&lt;br/&gt;
        at org.apache.cassandra.db.ColumnSerializer.serialize(ColumnSerializer.java:30)&lt;br/&gt;
        at org.apache.cassandra.db.OnDiskAtom$Serializer.serializeForSSTable(OnDiskAtom.java:62)&lt;br/&gt;
        at org.apache.cassandra.db.ColumnIndex$Builder.add(ColumnIndex.java:181)&lt;br/&gt;
        at org.apache.cassandra.db.ColumnIndex$Builder.build(ColumnIndex.java:133)&lt;br/&gt;
        at org.apache.cassandra.io.sstable.SSTableWriter.append(SSTableWriter.java:185)&lt;br/&gt;
        at org.apache.cassandra.db.Memtable$FlushRunnable.writeSortedContents(Memtable.java:430)&lt;br/&gt;
        at org.apache.cassandra.db.Memtable$FlushRunnable.runWith(Memtable.java:385)&lt;br/&gt;
        at org.apache.cassandra.io.util.DiskAwareRunnable.runMayThrow(DiskAwareRunnable.java:48)&lt;br/&gt;
        at org.apache.cassandra.utils.WrappedRunnable.run(WrappedRunnable.java:28)&lt;br/&gt;
        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1145)&lt;br/&gt;
        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:615)&lt;br/&gt;
        at java.lang.Thread.run(Thread.java:745)&lt;br/&gt;
 INFO &lt;span class=&quot;error&quot;&gt;&amp;#91;GossipStage:1&amp;#93;&lt;/span&gt; 2014-06-11 10:20:56,829 Gossiper.java (line 823) InetAddress /10.198.26.171 is now DOWN&lt;br/&gt;
 INFO &lt;span class=&quot;error&quot;&gt;&amp;#91;OptionalTasks:1&amp;#93;&lt;/span&gt; 2014-06-11 10:21:09,289 ColumnFamilyStore.java (line 633) Enqueuing flush of Memtable-ListPrefixIndex@1419303241(498848/1765043 serialized/live bytes, 1130 ops)&lt;br/&gt;
 INFO &lt;span class=&quot;error&quot;&gt;&amp;#91;FlushWriter:3579&amp;#93;&lt;/span&gt; 2014-06-11 10:21:09,290 Memtable.java (line 398) Writing Memtable-ListPrefixIndex@1419303241(498848/1765043 serialized/live bytes, 1130 ops)&lt;/p&gt;</comment>
                            <comment id="14028198" author="jeffery.griffith" created="Wed, 11 Jun 2014 18:46:01 +0000"  >&lt;p&gt;The NegativeArraySizeException seems to come from here. Seems like the 1.8G size was getting doubled resulting an an integer overflow:&lt;/p&gt;

&lt;p&gt;    private void expand(int i) {&lt;br/&gt;
        /* Can the buffer handle @i more bytes, if not expand it */&lt;br/&gt;
        if (count + i &amp;lt;= buf.length) &lt;/p&gt;
{
            return;
        }

&lt;p&gt;        byte[] newbuf = new byte&lt;span class=&quot;error&quot;&gt;&amp;#91;(count + i) * 2&amp;#93;&lt;/span&gt;;&lt;br/&gt;
        System.arraycopy(buf, 0, newbuf, 0, count);&lt;br/&gt;
        buf = newbuf;&lt;br/&gt;
    }&lt;/p&gt;</comment>
                            <comment id="14028207" author="jeffery.griffith" created="Wed, 11 Jun 2014 18:50:01 +0000"  >&lt;p&gt;That NegativeArraySizeException seems to bubble up to the UncaughtExceptionHandler so we are wondering if the commit log handling is simply stopping because of this.&lt;/p&gt;</comment>
                            <comment id="14028356" author="mishail" created="Wed, 11 Jun 2014 20:37:40 +0000"  >&lt;p&gt;&lt;tt&gt;FlushRunnable.runWith&lt;/tt&gt; doesn&apos;t count down its latch if an exception happens, so the task in MemtablePostFlusher will wait forever&lt;/p&gt;</comment>
                            <comment id="14028391" author="jeffery.griffith" created="Wed, 11 Jun 2014 21:00:18 +0000"  >&lt;p&gt;Thanks Mikhail. If my explanation for the exception above makes sense, it would seem the only mystery is how the &quot;high-traffic&quot; cf got to be over half of MAX-INT. In the logs below, is this amount about some crazy-large or corrupted single mutation or about all values in memory for this column family?&lt;/p&gt;

&lt;p&gt; WARN &lt;span class=&quot;error&quot;&gt;&amp;#91;COMMIT-LOG-WRITER&amp;#93;&lt;/span&gt; 2014-06-11 20:25:29,505 CommitLog.java (line 349) Skipping commitlog append of extremely large mutation (1833599403 bytes)&lt;br/&gt;
 INFO &lt;span class=&quot;error&quot;&gt;&amp;#91;OptionalTasks:1&amp;#93;&lt;/span&gt; 2014-06-11 20:25:29,832 MeteredFlusher.java (line 64) flushing high-traffic column family CFS(Keyspace=&apos;SyncCore&apos;, ColumnFamily=&apos;EmailNetworkDeltas&apos;) (estimated 1836720026 bytes)&lt;br/&gt;
 INFO &lt;span class=&quot;error&quot;&gt;&amp;#91;OptionalTasks:1&amp;#93;&lt;/span&gt; 2014-06-11 20:25:30,325 ColumnFamilyStore.java (line 633) Enqueuing flush of Memtable-EmailNetworkDeltas@79278257(1837683252/1864225045 serialized/live bytes, 1098 ops)&lt;br/&gt;
 INFO &lt;span class=&quot;error&quot;&gt;&amp;#91;FlushWriter:1520&amp;#93;&lt;/span&gt; 2014-06-11 20:25:30,326 Memtable.java (line 398) Writing Memtable-EmailNetworkDeltas@79278257(1837683252/1864225045 serialized/live bytes, 1098 ops)&lt;br/&gt;
ERROR &lt;span class=&quot;error&quot;&gt;&amp;#91;FlushWriter:1520&amp;#93;&lt;/span&gt; 2014-06-11 20:25:30,344 CassandraDaemon.java (line 191) Exception in thread Thread&lt;span class=&quot;error&quot;&gt;&amp;#91;FlushWriter:1520,5,main&amp;#93;&lt;/span&gt;&lt;br/&gt;
java.lang.NegativeArraySizeException&lt;br/&gt;
        at org.apache.cassandra.io.util.FastByteArrayOutputStream.expand(FastByteArrayOutputStream.java:104)&lt;/p&gt;</comment>
                            <comment id="14028406" author="mishail" created="Wed, 11 Jun 2014 21:15:44 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jeffery.griffith&quot; class=&quot;user-hover&quot; rel=&quot;jeffery.griffith&quot;&gt;jeffery.griffith&lt;/a&gt; you have a pretty big row in that column family, and &lt;tt&gt;FastByteArrayOutputStream.expand&lt;/tt&gt; doesn&apos;t validate if it can be safely expanded.&lt;/p&gt;

&lt;p&gt;So, to summarize&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;Unsafe &lt;tt&gt;FastByteArrayOutputStream.expand&lt;/tt&gt; leads to an exception&lt;/li&gt;
	&lt;li&gt;&lt;tt&gt;FlushRunnable.runWith&lt;/tt&gt; fails to count down a latch, blocking tasks in MemtablePostFlusher&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="14028528" author="mishail" created="Wed, 11 Jun 2014 22:48:06 +0000"  >&lt;p&gt;I&apos;m attaching two patches for 1.2 to address those two issues.&lt;br/&gt;
Though I&apos;m not fully convinced that  2nd issue (with unsafe &quot;expand&quot; for very large buffers) is worth fixing &lt;/p&gt;</comment>
                            <comment id="14028590" author="jeffery.griffith" created="Wed, 11 Jun 2014 23:36:49 +0000"  >&lt;p&gt;Excellent, thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mishail&quot; class=&quot;user-hover&quot; rel=&quot;mishail&quot;&gt;mishail&lt;/a&gt;. We&apos;ll try too root out the large row which we were in the process of doing anyway. &lt;/p&gt;</comment>
                            <comment id="14028652" author="thobbs" created="Thu, 12 Jun 2014 00:31:54 +0000"  >&lt;p&gt;The first patch is a dupe of &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-7275&quot; title=&quot;Errors in FlushRunnable may leave threads hung&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-7275&quot;&gt;&lt;del&gt;CASSANDRA-7275&lt;/del&gt;&lt;/a&gt;, so feel free to either move the patch there or resolve it as a duplicate.&lt;/p&gt;</comment>
                            <comment id="14029417" author="jbellis" created="Thu, 12 Jun 2014 17:07:32 +0000"  >&lt;p&gt;v2 of the second patch dispenses with protecting &lt;span class=&quot;error&quot;&gt;&amp;#91;private&amp;#93;&lt;/span&gt; extend method in favor of checking both of its callers.&lt;/p&gt;</comment>
                            <comment id="14029511" author="mishail" created="Thu, 12 Jun 2014 17:58:38 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jbellis&quot; class=&quot;user-hover&quot; rel=&quot;jbellis&quot;&gt;jbellis&lt;/a&gt; how does v2 addres the case when &lt;tt&gt;this.count + len &amp;gt; 0&lt;/tt&gt; (i.e. the buffer can still hold the data) , but &lt;tt&gt;extend&lt;/tt&gt; will fail because of overflow in &lt;tt&gt;(this.count + len) * 2 &amp;lt; 0&lt;/tt&gt; ? Or we are not going to handle that?&lt;/p&gt;</comment>
                            <comment id="14029740" author="jbellis" created="Thu, 12 Jun 2014 20:19:48 +0000"  >&lt;p&gt;You&apos;re right.  Is it even worth checking count then, since it&apos;s going to be strictly &amp;lt;= the extend doubling?&lt;/p&gt;</comment>
                            <comment id="14030855" author="jeffery.griffith" created="Fri, 13 Jun 2014 17:08:34 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mishail&quot; class=&quot;user-hover&quot; rel=&quot;mishail&quot;&gt;mishail&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jbellis&quot; class=&quot;user-hover&quot; rel=&quot;jbellis&quot;&gt;jbellis&lt;/a&gt;  Is there already a separate bug for the second patch where the extend fails or should I create one?    Or perhaps this one (7373) serves the purpose and 7275 fixes the CDL problem?&lt;/p&gt;</comment>
                            <comment id="14030932" author="mishail" created="Fri, 13 Jun 2014 18:10:33 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jeffery.griffith&quot; class=&quot;user-hover&quot; rel=&quot;jeffery.griffith&quot;&gt;jeffery.griffith&lt;/a&gt; we&apos;ll address the &quot;extend&quot; problem in this one.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jbellis&quot; class=&quot;user-hover&quot; rel=&quot;jbellis&quot;&gt;jbellis&lt;/a&gt; which check do you mean? Are we OK with &lt;span class=&quot;nobr&quot;&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12649928/12649928_0002-Handle-possible-integer-overflow.patch&quot; title=&quot;0002-Handle-possible-integer-overflow.patch attached to CASSANDRA-7373&quot;&gt;0002-Handle-possible-integer-overflow.patch&lt;sup&gt;&lt;img class=&quot;rendericon&quot; src=&quot;https://issues.apache.org/jira/images/icons/link_attachment_7.gif&quot; height=&quot;7&quot; width=&quot;7&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/sup&gt;&lt;/a&gt;&lt;/span&gt; ?&lt;/p&gt;</comment>
                            <comment id="14031606" author="jbellis" created="Sat, 14 Jun 2014 15:47:01 +0000"  >&lt;p&gt;I mean the 0002 check in write().&lt;/p&gt;</comment>
                            <comment id="14036958" author="mishail" created="Thu, 19 Jun 2014 04:52:00 +0000"  >&lt;p&gt;With &lt;tt&gt;this.count + len &amp;lt; 0&lt;/tt&gt;, meaning we can&apos;t accept &lt;tt&gt;len&lt;/tt&gt; bytes,  we should not even try to extend. I believe it is worth checking&lt;/p&gt;
</comment>
                            <comment id="14037434" author="jbellis" created="Thu, 19 Jun 2014 15:35:39 +0000"  >&lt;p&gt;+1&lt;/p&gt;</comment>
                            <comment id="14038318" author="mishail" created="Fri, 20 Jun 2014 03:17:17 +0000"  >&lt;p&gt;Committed 0002 &lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12715643">CASSANDRA-7275</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12649927" name="0001-Move-latch.countDown-into-finally-block.patch" size="1423" author="mishail" created="Wed, 11 Jun 2014 22:48:06 +0000"/>
                            <attachment id="12649928" name="0002-Handle-possible-integer-overflow.patch" size="1635" author="mishail" created="Wed, 11 Jun 2014 22:48:06 +0000"/>
                            <attachment id="12650081" name="7373-v2.txt" size="1720" author="jbellis" created="Thu, 12 Jun 2014 17:07:31 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[mishail]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>398427</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            11 years, 22 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1wlen:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>398553</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>jbellis</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[jbellis]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12962"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>