<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 22:46:58 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-7593] Min/max column name collection broken with range tombstones</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-7593</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;I&apos;m seeing two different errors cropping up in the dtest which upgrades a cluster through several versions.&lt;/p&gt;

&lt;p&gt;This is the more common error:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;ERROR [GossipStage:10] 2014-07-22 13:14:30,028 CassandraDaemon.java:168 - Exception in thread Thread[GossipStage:10,5,main]
java.lang.AssertionError: null
        at org.apache.cassandra.db.filter.SliceQueryFilter.shouldInclude(SliceQueryFilter.java:347) ~[main/:na]
        at org.apache.cassandra.db.filter.QueryFilter.shouldInclude(QueryFilter.java:249) ~[main/:na]
        at org.apache.cassandra.db.CollationController.collectAllData(CollationController.java:249) ~[main/:na]
        at org.apache.cassandra.db.CollationController.getTopLevelColumns(CollationController.java:60) ~[main/:na]
        at org.apache.cassandra.db.ColumnFamilyStore.getTopLevelColumns(ColumnFamilyStore.java:1873) ~[main/:na]
        at org.apache.cassandra.db.ColumnFamilyStore.getColumnFamily(ColumnFamilyStore.java:1681) ~[main/:na]
        at org.apache.cassandra.db.Keyspace.getRow(Keyspace.java:345) ~[main/:na]
        at org.apache.cassandra.db.SliceFromReadCommand.getRow(SliceFromReadCommand.java:59) ~[main/:na]
        at org.apache.cassandra.cql3.statements.SelectStatement.readLocally(SelectStatement.java:293) ~[main/:na]
        at org.apache.cassandra.cql3.statements.SelectStatement.executeInternal(SelectStatement.java:302) ~[main/:na]
        at org.apache.cassandra.cql3.statements.SelectStatement.executeInternal(SelectStatement.java:60) ~[main/:na]
        at org.apache.cassandra.cql3.QueryProcessor.executeInternal(QueryProcessor.java:263) ~[main/:na]
        at org.apache.cassandra.db.SystemKeyspace.getPreferredIP(SystemKeyspace.java:514) ~[main/:na]
        at org.apache.cassandra.net.OutboundTcpConnectionPool.&amp;lt;init&amp;gt;(OutboundTcpConnectionPool.java:51) ~[main/:na]
        at org.apache.cassandra.net.MessagingService.getConnectionPool(MessagingService.java:522) ~[main/:na]
        at org.apache.cassandra.net.MessagingService.getConnection(MessagingService.java:536) ~[main/:na]
        at org.apache.cassandra.net.MessagingService.sendOneWay(MessagingService.java:689) ~[main/:na]
        at org.apache.cassandra.net.MessagingService.sendReply(MessagingService.java:663) ~[main/:na]
        at org.apache.cassandra.service.EchoVerbHandler.doVerb(EchoVerbHandler.java:40) ~[main/:na]
        at org.apache.cassandra.net.MessageDeliveryTask.run(MessageDeliveryTask.java:62) ~[main/:na]
        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1145) ~[na:1.7.0_60]
        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:615) ~[na:1.7.0_60]
        at java.lang.Thread.run(Thread.java:745) ~[na:1.7.0_60]
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The same test sometimes fails with this exception instead:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;ERROR [CompactionExecutor:4] 2014-07-22 16:18:21,008 CassandraDaemon.java:168 - Exception in thread Thread[CompactionExecutor:4,1,RMI Runtime]
java.util.concurrent.RejectedExecutionException: Task java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask@7059d3e9 rejected from org.apache.cassandra.concurrent.DebuggableScheduledThreadPoolExecutor@108f1504[Terminated, pool size = 0, active threads = 0, queued tasks = 0, completed tasks = 95]
        at java.util.concurrent.ThreadPoolExecutor$AbortPolicy.rejectedExecution(ThreadPoolExecutor.java:2048) ~[na:1.7.0_60]
        at java.util.concurrent.ThreadPoolExecutor.reject(ThreadPoolExecutor.java:821) ~[na:1.7.0_60]
        at java.util.concurrent.ScheduledThreadPoolExecutor.delayedExecute(ScheduledThreadPoolExecutor.java:325) ~[na:1.7.0_60]
        at java.util.concurrent.ScheduledThreadPoolExecutor.schedule(ScheduledThreadPoolExecutor.java:530) ~[na:1.7.0_60]
        at java.util.concurrent.ScheduledThreadPoolExecutor.execute(ScheduledThreadPoolExecutor.java:619) ~[na:1.7.0_60]
        at org.apache.cassandra.io.sstable.SSTableReader.scheduleTidy(SSTableReader.java:628) ~[main/:na]
        at org.apache.cassandra.io.sstable.SSTableReader.tidy(SSTableReader.java:609) ~[main/:na]
        at org.apache.cassandra.io.sstable.SSTableReader.releaseReference(SSTableReader.java:1596) ~[main/:na]
        at org.apache.cassandra.db.DataTracker.replaceReaders(DataTracker.java:354) ~[main/:na]
        at org.apache.cassandra.io.sstable.SSTableRewriter.abort(SSTableRewriter.java:200) ~[main/:na]
        at org.apache.cassandra.db.compaction.CompactionTask.runWith(CompactionTask.java:192) ~[main/:na]
        at org.apache.cassandra.io.util.DiskAwareRunnable.runMayThrow(DiskAwareRunnable.java:48) ~[main/:na]
        at org.apache.cassandra.utils.WrappedRunnable.run(WrappedRunnable.java:28) ~[main/:na]
        at org.apache.cassandra.db.compaction.CompactionTask.executeInternal(CompactionTask.java:74) ~[main/:na]
        at org.apache.cassandra.db.compaction.AbstractCompactionTask.execute(AbstractCompactionTask.java:59) ~[main/:na]
        at org.apache.cassandra.db.compaction.CompactionManager$BackgroundCompactionTask.run(CompactionManager.java:236) ~[main/:na]
        at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:471) ~[na:1.7.0_60]
        at java.util.concurrent.FutureTask.run(FutureTask.java:262) ~[na:1.7.0_60]
        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1145) ~[na:1.7.0_60]
        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:615) [na:1.7.0_60]
        at java.lang.Thread.run(Thread.java:745) [na:1.7.0_60]
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment>&lt;p&gt;java 1.7&lt;/p&gt;</environment>
        <key id="12729013">CASSANDRA-7593</key>
            <summary>Min/max column name collection broken with range tombstones</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10000" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Urgent</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="thobbs">Tom Hobbs</assignee>
                                    <reporter username="rhatch">Russ Hatch</reporter>
                        <labels>
                            <label>qa-resolved</label>
                    </labels>
                <created>Tue, 22 Jul 2014 22:58:20 +0000</created>
                <updated>Tue, 16 Apr 2019 09:31:39 +0000</updated>
                            <resolved>Fri, 1 Aug 2014 15:38:49 +0000</resolved>
                                        <fixVersion>2.1 rc5</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>9</watches>
                                                                                                                <comments>
                            <comment id="14071083" author="rhatch" created="Tue, 22 Jul 2014 23:01:29 +0000"  >&lt;p&gt;Initially thought this related to RandomPartitioner but it&apos;s happening with the default partitioner as well.&lt;/p&gt;</comment>
                            <comment id="14071415" author="krummas" created="Wed, 23 Jul 2014 06:31:10 +0000"  >&lt;p&gt;The code around the first AE has not changed in 2.1, so I guess the problem is when we collect the max/min col names, either during compaction or flushing&lt;/p&gt;
</comment>
                            <comment id="14071497" author="benedict" created="Wed, 23 Jul 2014 08:29:04 +0000"  >&lt;p&gt;There&apos;s a race condition on reloading statsMetaData, but I doubt it would change the value here (though we should potentially check it doesn&apos;t cause any other issues). &lt;/p&gt;

&lt;p&gt;It&apos;s &lt;b&gt;possible&lt;/b&gt; that a table only contains range tombstones, and that the tombstones are not evenly defined (i.e. the min of the range has a different number of components to the max). This is also certainly a bug, but I&apos;m not convinced it&apos;s the cause. We could do with expanding the text of the assertion to give us some extra debug info&lt;/p&gt;</comment>
                            <comment id="14071977" author="krummas" created="Wed, 23 Jul 2014 17:08:49 +0000"  >&lt;p&gt;This happens for system.peers when upgrading sstables to the 2.1 version&lt;/p&gt;

&lt;p&gt;Reason is that in 2.0 the range tombstone was a plain ByteBuffer, which, if empty, was kept as an empty BB. In 2.1 this empty BB is converted to a composite that has size=0 that we don&apos;t keep when compacting.&lt;/p&gt;

&lt;p&gt;We probably need to change the way we handle RangeTombstones when collecting min/max col names in 2.1&lt;/p&gt;</comment>
                            <comment id="14074163" author="krummas" created="Fri, 25 Jul 2014 07:35:30 +0000"  >&lt;p&gt;Think I&apos;m getting to the bottom of this now&lt;/p&gt;

&lt;p&gt;Seems it is a matter of how we store/deserialize RangeTombstones in 2.0 vs 2.1;&lt;/p&gt;

&lt;p&gt;If I, in 2.0 store a RT like this, by itself in an sstable;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;update p set tokens=&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; where peer = &lt;span class=&quot;code-quote&quot;&gt;&apos;127.0.0.4&apos;&lt;/span&gt; ;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;schema is:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;CREATE TABLE aa.p (
    peer inet PRIMARY KEY,
    data_center text,
    host_id uuid,
    preferred_ip inet,
    rack text,
    release_version text,
    rpc_address inet,
    schema_version uuid,
    tokens set&amp;lt;text&amp;gt;
)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;And then deserialize that, I get no EOC for RT.min, but i get EOC.END in RT.max&lt;/p&gt;

&lt;p&gt;If i store the same tombstone in 2.1, i get EOC.START for RT.min and EOC.END for RT.max&lt;/p&gt;

&lt;p&gt;This shows itself when we deserialize the 2.0-RT in 2.1 since we get a CompoundSparseCellName for RT.min and a BoundedComposite for RT.max and that breaks the collection of min/max column names since the CSCN is &quot;empty&quot; and no columns will be collected.&lt;/p&gt;

&lt;p&gt;Could we assume EOC.START for RT.min in 2.1 when deserializing old sstables?&lt;/p&gt;

&lt;p&gt;There is also a small bug when upgrading from 1.2 to 2.0, but it seems safe, in 1.2 we store a row marker with the RT, in 2.0 we don&apos;t, so the row marker looks like a standard row which is included in the min/max collection (as a min column name). But this is afaict not dangerous since we will only include more sstable than we needed to&lt;/p&gt;</comment>
                            <comment id="14074181" author="benedict" created="Fri, 25 Jul 2014 07:56:31 +0000"  >&lt;p&gt;There&apos;s still something fishy going on, though, since the BoundedComposite should also be empty (it should have a size of 0, just with an EOC component). That doesn&apos;t change the fact that this bug could present itself in situations where it legitimately does have a different clustering size to size, so needs its own fix. I would say the correct answer may be to have a BoundedCellName, which implements CellName, so that the collection check knows to not treat it as a general composite but to grab its clustering size.&lt;/p&gt;

&lt;p&gt;Presumably independently there is also a reason that we&apos;ve changed the behaviour from 2.0 -&amp;gt; 2.1, which might imply another bug if we don&apos;t translate the data as well. But it looks to me like we could potentially have this situation arise without an upgrade from legitimate user-provided data as well.&lt;/p&gt;

&lt;p&gt;It also looks to me like we caught this by chance, and our &apos;upgrade through versions&apos; tests should include a wider variety of table types with a variety of data contents&lt;/p&gt;</comment>
                            <comment id="14076068" author="krummas" created="Mon, 28 Jul 2014 10:39:36 +0000"  >&lt;p&gt;no, they should not be empty&lt;/p&gt;

&lt;p&gt;We are inserting a RangeTombstone with start=&apos;token&apos; and end=&apos;token&apos; (ie, delete the set for this row).&lt;/p&gt;

&lt;p&gt;In 2.0 we only make the end have an EOC (&lt;a href=&quot;https://github.com/apache/cassandra/blob/cassandra-2.0/src/java/org/apache/cassandra/cql3/Sets.java#L234&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/cassandra/blob/cassandra-2.0/src/java/org/apache/cassandra/cql3/Sets.java#L234&lt;/a&gt;) while in 2.1 both do: &lt;a href=&quot;https://github.com/apache/cassandra/blob/cassandra-2.1/src/java/org/apache/cassandra/cql3/Sets.java#L252&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/cassandra/blob/cassandra-2.1/src/java/org/apache/cassandra/cql3/Sets.java#L252&lt;/a&gt; + &lt;a href=&quot;https://github.com/apache/cassandra/blob/cassandra-2.1/src/java/org/apache/cassandra/db/composites/AbstractComposite.java#L69&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/cassandra/blob/cassandra-2.1/src/java/org/apache/cassandra/db/composites/AbstractComposite.java#L69&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14076411" author="jbellis" created="Mon, 28 Jul 2014 17:15:38 +0000"  >&lt;blockquote&gt;&lt;p&gt;Could we assume EOC.START for RT.min in 2.1 when deserializing old sstables?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;That sounds like the right fix to me.&lt;/p&gt;</comment>
                            <comment id="14076472" author="benedict" created="Mon, 28 Jul 2014 17:56:26 +0000"  >&lt;p&gt;This fix doesn&apos;t address the situation where we legitimately get an sstable with only range tombstones where the lowerbound has fewer components to the upper bounds (let&apos;s say we have a flood of DELETE from T where pk=K and a &amp;gt; X and (a,b) &amp;lt; (Y, Z))&lt;/p&gt;

&lt;p&gt;Also, whilst we &lt;em&gt;may&lt;/em&gt; separately want to insert an EOC.START (since we now populate it, so presumably it should be populated, though it would be good to understand why this is now the case to document here for posterity), according to the commenting in the grabbing of min/max column names, we only care about clustering columns, so with or without the extra EOC we should not be fetching the whole of this BoundedComposite into min/max - we should only be fetching up to the number of clustering columns (0). Or we should be fetching the column name (and potentially any further components for sets/maps/etc.) from CellName as well.&lt;/p&gt;</comment>
                            <comment id="14077643" author="krummas" created="Tue, 29 Jul 2014 12:02:41 +0000"  >&lt;p&gt;this issue affects more than the min/max col name collection:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;oss/cassandra [cassandra-2.0&#9679;] &#187; bin/cqlsh 
Connected to Test Cluster at localhost:9160.
[cqlsh 4.1.1 | Cassandra 2.0.9-SNAPSHOT | CQL spec 3.1.1 | Thrift protocol 19.39.0]
Use HELP &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; help.
cqlsh&amp;gt; CREATE KEYSPACE aa WITH replication = {&lt;span class=&quot;code-quote&quot;&gt;&apos;class&apos;&lt;/span&gt;: &lt;span class=&quot;code-quote&quot;&gt;&apos;SimpleStrategy&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;replication_factor&apos;&lt;/span&gt;:1};
cqlsh&amp;gt; use aa;
cqlsh:aa&amp;gt; CREATE TABLE t (k &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; PRIMARY KEY,something text, a set&amp;lt;varchar&amp;gt;, b set&amp;lt;varchar&amp;gt;);
cqlsh:aa&amp;gt; INSERT INTO t (k, something, a, b) VALUES (1, &lt;span class=&quot;code-quote&quot;&gt;&apos;bluh&apos;&lt;/span&gt;, {&lt;span class=&quot;code-quote&quot;&gt;&apos;a&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;aa&apos;&lt;/span&gt;}, {&lt;span class=&quot;code-quote&quot;&gt;&apos;b&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;bb&apos;&lt;/span&gt;});
cqlsh:aa&amp;gt; INSERT INTO t (k, something, a, b) VALUES (2, &lt;span class=&quot;code-quote&quot;&gt;&apos;bluh&apos;&lt;/span&gt;, {&lt;span class=&quot;code-quote&quot;&gt;&apos;a&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;aa&apos;&lt;/span&gt;}, {&lt;span class=&quot;code-quote&quot;&gt;&apos;b&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;bb&apos;&lt;/span&gt;});
oss/cassandra [cassandra-2.0&#9679;] &#187; bin/nodetool flush
oss/cassandra [cassandra-2.0&#9679;] &#187; bin/cqlsh
Connected to Test Cluster at localhost:9160.
[cqlsh 4.1.1 | Cassandra 2.0.9-SNAPSHOT | CQL spec 3.1.1 | Thrift protocol 19.39.0]
Use HELP &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; help.
cqlsh&amp;gt; USE aa;
cqlsh:aa&amp;gt; UPDATE t SET a=NULL WHERE k=1;
oss/cassandra [cassandra-2.0&#9679;] &#187; bin/nodetool flush
oss/cassandra [cassandra-2.0&#9679;] &#187; bin/cqlsh
Connected to Test Cluster at localhost:9160.
[cqlsh 4.1.1 | Cassandra 2.0.9-SNAPSHOT | CQL spec 3.1.1 | Thrift protocol 19.39.0]
Use HELP &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; help.
cqlsh&amp;gt; USE aa;
cqlsh:aa&amp;gt; SELECT * FROM t;

 k | a           | b           | something
---+-------------+-------------+-----------
 1 |        &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; | {&lt;span class=&quot;code-quote&quot;&gt;&apos;b&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;bb&apos;&lt;/span&gt;} |      bluh
 2 | {&lt;span class=&quot;code-quote&quot;&gt;&apos;a&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;aa&apos;&lt;/span&gt;} | {&lt;span class=&quot;code-quote&quot;&gt;&apos;b&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;bb&apos;&lt;/span&gt;} |      bluh

(2 rows)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;and upgrade the node to 2.1:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;oss/cassandra [cassandra-2.1&#9679;] &#187; bin/cqlsh
Connected to Test Cluster at 127.0.0.1:9042.
[cqlsh 5.0.1 | Cassandra 2.1.0-rc4-SNAPSHOT | CQL spec 3.2.0 | Native protocol v3]
Use HELP &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; help.
cqlsh&amp;gt; USE aa;
cqlsh:aa&amp;gt; SELECT * FROM t;

 k | a           | b           | something
---+-------------+-------------+-----------
 1 |        &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; | {&lt;span class=&quot;code-quote&quot;&gt;&apos;b&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;bb&apos;&lt;/span&gt;} |      bluh
 2 | {&lt;span class=&quot;code-quote&quot;&gt;&apos;a&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;aa&apos;&lt;/span&gt;} | {&lt;span class=&quot;code-quote&quot;&gt;&apos;b&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;bb&apos;&lt;/span&gt;} |      bluh

(2 rows)
cqlsh:aa&amp;gt; 
oss/cassandra [cassandra-2.1&#9679;] &#187; bin/nodetool upgradesstables aa t
oss/cassandra [cassandra-2.1&#9679;] &#187; bin/cqlsh
Connected to Test Cluster at 127.0.0.1:9042.
[cqlsh 5.0.1 | Cassandra 2.1.0-rc4-SNAPSHOT | CQL spec 3.2.0 | Native protocol v3]
Use HELP &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; help.
cqlsh&amp;gt; USE aa;
cqlsh:aa&amp;gt; SELECT * FROM t;

 k | a           | b           | something
---+-------------+-------------+-----------
 1 |        &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; | {&lt;span class=&quot;code-quote&quot;&gt;&apos;b&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;bb&apos;&lt;/span&gt;} |      bluh
 2 | {&lt;span class=&quot;code-quote&quot;&gt;&apos;a&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;aa&apos;&lt;/span&gt;} | {&lt;span class=&quot;code-quote&quot;&gt;&apos;b&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;bb&apos;&lt;/span&gt;} |      bluh

(2 rows)
cqlsh:aa&amp;gt; 
oss/cassandra [cassandra-2.1&#9679;] &#187; bin/nodetool compact aa t
oss/cassandra [cassandra-2.1&#9679;] &#187; bin/cqlsh
Connected to Test Cluster at 127.0.0.1:9042.
[cqlsh 5.0.1 | Cassandra 2.1.0-rc4-SNAPSHOT | CQL spec 3.2.0 | Native protocol v3]
Use HELP &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; help.
cqlsh&amp;gt; USE aa;
cqlsh:aa&amp;gt; SELECT * FROM t;

 k | a           | b           | something
---+-------------+-------------+-----------
 1 | {&lt;span class=&quot;code-quote&quot;&gt;&apos;a&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;aa&apos;&lt;/span&gt;} | {&lt;span class=&quot;code-quote&quot;&gt;&apos;b&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;bb&apos;&lt;/span&gt;} |      bluh
 2 | {&lt;span class=&quot;code-quote&quot;&gt;&apos;a&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;aa&apos;&lt;/span&gt;} | {&lt;span class=&quot;code-quote&quot;&gt;&apos;b&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;bb&apos;&lt;/span&gt;} |      bluh

(2 rows)

&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="14077981" author="slebresne" created="Tue, 29 Jul 2014 17:05:37 +0000"  >&lt;blockquote&gt;&lt;p&gt;In 2.0 we only make the end have an EOC (...) while in 2.1 both do&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;That&apos;s correct but that shouldn&apos;t be a problem. That is, whether or not the RT min has an EOC or not shouldn&apos;t really matter (as far as anything CQL is concerned at least). Why does the storage engine code breaks when the min RT has no EOC in 2.1 is the right question.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;This shows itself when we deserialize the 2.0-RT in 2.1 since we get a CompoundSparseCellName for RT.min and a BoundedComposite for RT.max and that breaks the collection of min/max column names since the CSCN is &quot;empty&quot; and no columns will be collected.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Not sure I follow. What parts breaks exactly? Wy having a CSCN instead of a BoundComposite would matter for the collection of min/max column names?&lt;/p&gt;</comment>
                            <comment id="14077989" author="thobbs" created="Tue, 29 Jul 2014 17:10:01 +0000"  >&lt;p&gt;Assuming EOC.START on RT mins does seem like the correct fix, but I would like to understand why having a normal CompoundSparseCellName (instead of a BoundedComposite) for the RT min doesn&apos;t work.  &lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;that breaks the collection of min/max column names since the CSCN is &quot;empty&quot; and no columns will be collected.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Can you point out exactly where this happens?&lt;/p&gt;

&lt;p&gt;You also mentioned:&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;the clusteringSize() is 0 for min which means we don&apos;t collect it. They both contain &apos;tokens&apos; which is correct, problem is that when we deserialize the RT from the sstable it seems we think the column is one of the &apos;ordinary&apos; columns in the table, and, they should have clusteringSize=0&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Can you also clarify where/how it thinks this is an ordinary column?&lt;/p&gt;</comment>
                            <comment id="14077990" author="thobbs" created="Tue, 29 Jul 2014 17:10:59 +0000"  >&lt;blockquote&gt;&lt;p&gt;This fix doesn&apos;t address the situation where we legitimately get an sstable with only range tombstones where the lowerbound has fewer components to the upper bounds (let&apos;s say we have a flood of DELETE from T where pk=K and a &amp;gt; X and (a,b) &amp;lt; (Y, Z))&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;We don&apos;t allow deletions of that form right now, but I agree that it would be nice to future-proof a bit here if we can do so safely.&lt;/p&gt;</comment>
                            <comment id="14078016" author="slebresne" created="Tue, 29 Jul 2014 17:20:48 +0000"  >&lt;blockquote&gt;&lt;p&gt;we get a CompoundSparseCellName for RT.min and a BoundedComposite for RT.max and that breaks the collection of min/max column names&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I see now, that&apos;s because ColumnNameHelper.minComponents special case CellNames to only use the clusteringSize but for BoundedComposite, which are not CellName, it will use the full size. &lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;in the grabbing of min/max column names, we only care about clustering columns, so with or without the extra EOC we should not be fetching the whole of this BoundedComposite into min/max - we should only be fetching up to the number of clustering columns&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I agree. And a simple way to do this would be to promote the &lt;tt&gt;clusteringSize()&lt;/tt&gt; method to the class Composite having it return the same than &lt;tt&gt;size()&lt;/tt&gt; for non-cellname composites (but BoundedComposite would forward to it&apos;s &quot;wrapped&quot; composite properly). We&apos;d then use that in ColumnNameHelper.{min/max}Components instead of the &lt;tt&gt;instanceof CellName&lt;/tt&gt;.&lt;/p&gt;</comment>
                            <comment id="14078043" author="slebresne" created="Tue, 29 Jul 2014 17:34:40 +0000"  >&lt;blockquote&gt;&lt;p&gt;Assuming EOC.START on RT mins does seem like the correct fix&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I definitively disagree btw. I see no reason to do that (outside of the fact that it happens to fix this very particular issue). No assumptions are made that a RT should have an EOC for any of its bounds and creating one just feels wrong.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;This fix doesn&apos;t address the situation where we legitimately get an sstable with only range tombstones where the lowerbound has fewer components to the upper bounds (let&apos;s say we have a flood of DELETE from T where pk=K and a &amp;gt; X and (a,b) &amp;lt; (Y, Z))&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Yes, and imo the assumption made by min/max column collection that there is the same number of component in minColumns and maxColumns in the metadata (the one that breaks here) is wrong in the first place and we should remove it (make the code work without that assumption). That said, since we don&apos;t currently support the syntax above, for 2.1.0, we can probably stick to make the fix suggested above (i.e. make sure we always use the clustering size only in &lt;tt&gt;ColumnNameHelper.minComponents&lt;/tt&gt;) as that&apos;s pretty simple. Removing the assumption that both bound of a RT cannot have the same size will have to be done before &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-6237&quot; title=&quot;Allow range deletions in CQL&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-6237&quot;&gt;&lt;del&gt;CASSANDRA-6237&lt;/del&gt;&lt;/a&gt; however.&lt;/p&gt;</comment>
                            <comment id="14078050" author="krummas" created="Tue, 29 Jul 2014 17:38:02 +0000"  >&lt;p&gt;hmm, so the reappearing data issue i posted above might be unrelated, i&apos;ll dig more into that tomorrow&lt;/p&gt;</comment>
                            <comment id="14079951" author="thobbs" created="Wed, 30 Jul 2014 20:50:11 +0000"  >&lt;p&gt;7593.txt moves &lt;tt&gt;clusteringSize()&lt;/tt&gt; to Composite.  I opened &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-7651&quot; title=&quot;Tolerate min/max column names of different lengths for slice intersections&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-7651&quot;&gt;&lt;del&gt;CASSANDRA-7651&lt;/del&gt;&lt;/a&gt; to handle min/max columns of different lengths.&lt;/p&gt;</comment>
                            <comment id="14080817" author="krummas" created="Thu, 31 Jul 2014 12:56:03 +0000"  >&lt;p&gt;Still not working, we get clusteringSize() = 1 for rt.max and clusteringSize() = 0 for min&lt;/p&gt;

&lt;p&gt;when deserializing the RT we get to CSCNT.WithCollection.makeWith():&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;    &lt;span class=&quot;code-keyword&quot;&gt;protected&lt;/span&gt; Composite makeWith(ByteBuffer[] components, &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; size, Composite.EOC eoc, &lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt; isStatic)
    {
        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (size &amp;lt; clusteringSize + 1 || eoc != Composite.EOC.NONE)
            &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; CompoundComposite(components, size, isStatic).withEOC(eoc);

        &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; CompoundSparseCellName(components, clusteringSize, idFor(components[clusteringSize]), isStatic);
    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;so, if we have an EOC we wrap a CompoundComposite with size (which is 1 in this case), and if we don&apos;t, we create a CSCN with clusteringSize (which is 0)&lt;/p&gt;

&lt;p&gt;Attaching a patch that keeps clusteringSize in the compound composite, but have to say that I don&apos;t know enough about this to say if it breaks everything else. It applies on top of the other patch.&lt;/p&gt;

&lt;p&gt;a way to repro:&lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;start cassandra2.0&lt;/li&gt;
	&lt;li&gt;CREATE TABLE t (k int PRIMARY KEY,something text, a set&amp;lt;varchar&amp;gt;, b set&amp;lt;varchar&amp;gt;);&lt;/li&gt;
	&lt;li&gt;update t set b = null where k = 1;&lt;/li&gt;
	&lt;li&gt;flush&lt;/li&gt;
	&lt;li&gt;upgrade to 2.1&lt;/li&gt;
	&lt;li&gt;upgradesstables&lt;/li&gt;
	&lt;li&gt;check min&amp;amp;max column names (i hacked SSTableMetadataViewer to dump the contents)&lt;/li&gt;
&lt;/ol&gt;

</comment>
                            <comment id="14080825" author="benedict" created="Thu, 31 Jul 2014 13:07:03 +0000"  >&lt;p&gt;Might be better to just expose this in CSCNT, since we have access to it when doing this.&lt;/p&gt;</comment>
                            <comment id="14080971" author="iamaleksey" created="Thu, 31 Jul 2014 15:05:19 +0000"  >&lt;blockquote&gt;&lt;p&gt;We don&apos;t allow deletions of that form right now, but I agree that it would be nice to future-proof a bit here if we can do so safely.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Except I think we do, via Thrift (because stupid &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-5435&quot; title=&quot;Support range tombstones from thrift&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-5435&quot;&gt;&lt;del&gt;CASSANDRA-5435&lt;/del&gt;&lt;/a&gt;).&lt;/p&gt;</comment>
                            <comment id="14081121" author="thobbs" created="Thu, 31 Jul 2014 17:05:05 +0000"  >&lt;p&gt;Let&apos;s take a step back.&lt;/p&gt;

&lt;p&gt;Moving &lt;tt&gt;clusteringSize()&lt;/tt&gt; up to Composite creates problems for CompoundComposite, as Marcus demonstrated, because the CompoundComposite isn&apos;t capable of knowing its own clustering size.  We would need to patch all of the places where we create CompoundComposites (which Marcus started) in order to avoid a lot of subtle bugs in the future.&lt;/p&gt;

&lt;p&gt;Instead of moving &lt;tt&gt;clusteringSize()&lt;/tt&gt; up to the Composite class, can&apos;t we utilize the &lt;tt&gt;comparator&lt;/tt&gt; in &lt;tt&gt;ColumnNameHelper.min/maxComponents()&lt;/tt&gt;?  For example, what we have now is:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; List&amp;lt;ByteBuffer&amp;gt; minComponents(List&amp;lt;ByteBuffer&amp;gt; minSeen, Composite candidate, CellNameType comparator)
    {
        &lt;span class=&quot;code-comment&quot;&gt;// For a cell name, no reason to look more than the clustering prefix
&lt;/span&gt;        &lt;span class=&quot;code-comment&quot;&gt;// (and comparing the collection element would actually crash)
&lt;/span&gt;        &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; size = candidate &lt;span class=&quot;code-keyword&quot;&gt;instanceof&lt;/span&gt; CellName ? ((CellName)candidate).clusteringSize() : candidate.size();

        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (minSeen.isEmpty())
            &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; getComponents(candidate, size);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Instead, we can do:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;        &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; size = min(comparator.clusteringPrefixSize(), candidate.size());

        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (minSeen.isEmpty())
            &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; getComponents(candidate, size);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;We would definitely need to do &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-7651&quot; title=&quot;Tolerate min/max column names of different lengths for slice intersections&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-7651&quot;&gt;&lt;del&gt;CASSANDRA-7651&lt;/del&gt;&lt;/a&gt; along with this (especially due to &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-5435&quot; title=&quot;Support range tombstones from thrift&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-5435&quot;&gt;&lt;del&gt;CASSANDRA-5435&lt;/del&gt;&lt;/a&gt;), but it seems like the least risky, most correct fix to me.&lt;/p&gt;</comment>
                            <comment id="14081135" author="benedict" created="Thu, 31 Jul 2014 17:09:13 +0000"  >&lt;p&gt;Yes, this is what I meant when I said expose it in CSCNT; didn&apos;t spot it was already exposed &lt;/p&gt;</comment>
                            <comment id="14081251" author="thobbs" created="Thu, 31 Jul 2014 18:39:01 +0000"  >&lt;p&gt;Okay, 7593-v2.txt takes that approach.  I followed Marcus&apos;s repro steps and verified that the min/max columns were empty.&lt;/p&gt;</comment>
                            <comment id="14081818" author="rhatch" created="Fri, 1 Aug 2014 02:06:17 +0000"  >&lt;p&gt;I&apos;m still running tests, but this exception is cropping up:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt; INFO [GossipStage:1] 2014-07-31 18:29:57,613 StorageService.java (line 1511) Node /127.0.0.1 state jump to normal
 INFO [HANDSHAKE-/127.0.0.1] 2014-07-31 18:29:58,163 OutboundTcpConnection.java (line 386) Handshaking version with /127.0.0.1
ERROR [Thrift:4] 2014-07-31 18:29:58,175 CassandraDaemon.java (line 199) Exception in thread Thread[Thrift:4,5,main]
java.lang.NoSuchMethodError: org.apache.cassandra.concurrent.TracingAwareExecutorService.maybeExecuteImmediately(Ljava/lang/Runnable;)V
        at org.apache.cassandra.service.AbstractReadExecutor.makeDataRequests(AbstractReadExecutor.java:96)
        at org.apache.cassandra.service.AbstractReadExecutor$NeverSpeculatingReadExecutor.executeAsync(AbstractReadExecutor.java:215)
        at org.apache.cassandra.service.StorageProxy.fetchRows(StorageProxy.java:1216)
        at org.apache.cassandra.service.StorageProxy.read(StorageProxy.java:1157)
        at org.apache.cassandra.cql3.statements.SelectStatement.execute(SelectStatement.java:253)
        at org.apache.cassandra.cql3.statements.SelectStatement.execute(SelectStatement.java:223)
        at org.apache.cassandra.cql3.statements.SelectStatement.execute(SelectStatement.java:61)
        at org.apache.cassandra.cql3.QueryProcessor.processStatement(QueryProcessor.java:158)
        at org.apache.cassandra.cql3.QueryProcessor.process(QueryProcessor.java:175)
        at org.apache.cassandra.thrift.CassandraServer.execute_cql3_query(CassandraServer.java:1958)
        at org.apache.cassandra.thrift.Cassandra$Processor$execute_cql3_query.getResult(Cassandra.java:4486)
        at org.apache.cassandra.thrift.Cassandra$Processor$execute_cql3_query.getResult(Cassandra.java:4470)
        at org.apache.thrift.ProcessFunction.process(ProcessFunction.java:39)
        at org.apache.thrift.TBaseProcessor.process(TBaseProcessor.java:39)
        at org.apache.cassandra.thrift.CustomTThreadPoolServer$WorkerProcess.run(CustomTThreadPoolServer.java:201)
        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1145)
        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:615)
        at java.lang.Thread.run(Thread.java:745)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="14082097" author="krummas" created="Fri, 1 Aug 2014 09:15:31 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rhatch&quot; class=&quot;user-hover&quot; rel=&quot;rhatch&quot;&gt;rhatch&lt;/a&gt; I don&apos;t think that is related to this (NoSuchMethodError is likely an environment issue)&lt;/p&gt;

&lt;p&gt;+1 on the patch&lt;/p&gt;</comment>
                            <comment id="14082263" author="jbellis" created="Fri, 1 Aug 2014 14:08:26 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rhatch&quot; class=&quot;user-hover&quot; rel=&quot;rhatch&quot;&gt;rhatch&lt;/a&gt; let&apos;s open a separate ticket for that.&lt;/p&gt;</comment>
                            <comment id="14082356" author="thobbs" created="Fri, 1 Aug 2014 15:38:49 +0000"  >&lt;p&gt;Thanks! Committed.&lt;/p&gt;</comment>
                            <comment id="14082647" author="rhatch" created="Fri, 1 Aug 2014 18:08:15 +0000"  >&lt;p&gt;Wrapped up my testing of the patch, looks good from here.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12658916" name="0001-keep-clusteringSize-in-CompoundComposite.patch" size="2391" author="marcuse" created="Thu, 31 Jul 2014 12:56:25 +0000"/>
                            <attachment id="12658981" name="7593-v2.txt" size="1281" author="thobbs" created="Thu, 31 Jul 2014 18:39:01 +0000"/>
                            <attachment id="12658733" name="7593.txt" size="3482" author="thobbs" created="Wed, 30 Jul 2014 20:50:11 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[thobbs]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>407087</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            11 years, 16 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1y1v3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>407103</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12311421" key="com.atlassian.jira.plugin.system.customfieldtypes:multiversion">
                        <customfieldname>Reproduced In</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="12327458">2.1 rc4</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>marcuse</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[marcuse]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12963"><![CDATA[Critical]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311124" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Tester</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>rhatch</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>