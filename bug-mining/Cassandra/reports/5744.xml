<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 23:20:42 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-15669] LeveledCompactionStrategy compact last level throw an ArrayIndexOutOfBoundsException</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-15669</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;Cassandra will throw an&#160;ArrayIndexOutOfBoundsException when compact last level.&lt;/p&gt;

&lt;p&gt;My test is as follows&#65306;&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;Create a table with&#160;LeveledCompactionStrategy and its params are &apos;enabled&apos;: &apos;true&apos;, &apos;fanout_size&apos;: &apos;2&apos;, &apos;max_threshold&apos;: &apos;32&apos;, &apos;min_threshold&apos;: &apos;4&apos;, &apos;sstable_size_in_mb&apos;: &apos;2&apos;&#65288;fanout_size and sstable_size_in_mb are too small just to make it easier to reproduce the problem&#65289;;&lt;/li&gt;
	&lt;li&gt;Insert data into the table by stress;&lt;/li&gt;
	&lt;li&gt;Cassandra throw an&#160;ArrayIndexOutOfBoundsException when compact level9 sstables(this level score bigger than 1.001)&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;ERROR &lt;span class=&quot;error&quot;&gt;&amp;#91;CompactionExecutor:4&amp;#93;&lt;/span&gt; 2020-03-28 08:59:00,990 CassandraDaemon.java:442 - Exception in thread Thread&lt;span class=&quot;error&quot;&gt;&amp;#91;CompactionExecutor:4,1,main&amp;#93;&lt;/span&gt;&lt;br/&gt;
 java.lang.ArrayIndexOutOfBoundsException: 9&lt;br/&gt;
 at org.apache.cassandra.db.compaction.LeveledManifest.getLevel(LeveledManifest.java:814)&lt;br/&gt;
 at org.apache.cassandra.db.compaction.LeveledManifest.getCandidatesFor(LeveledManifest.java:746)&lt;br/&gt;
 at org.apache.cassandra.db.compaction.LeveledManifest.getCompactionCandidates(LeveledManifest.java:398)&lt;br/&gt;
 at org.apache.cassandra.db.compaction.LeveledCompactionStrategy.getNextBackgroundTask(LeveledCompactionStrategy.java:131)&lt;br/&gt;
 at org.apache.cassandra.db.compaction.CompactionStrategyHolder.lambda$getBackgroundTaskSuppliers$0(CompactionStrategyHolder.java:109)&lt;br/&gt;
 at org.apache.cassandra.db.compaction.AbstractStrategyHolder$TaskSupplier.getTask(AbstractStrategyHolder.java:66)&lt;br/&gt;
 at org.apache.cassandra.db.compaction.CompactionStrategyManager.getNextBackgroundTask(CompactionStrategyManager.java:214)&lt;br/&gt;
 at org.apache.cassandra.db.compaction.CompactionManager$BackgroundCompactionCandidate.run(CompactionManager.java:289)&lt;br/&gt;
 at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)&lt;br/&gt;
 at java.util.concurrent.FutureTask.run$$$capture(FutureTask.java:266)&lt;br/&gt;
 at java.util.concurrent.FutureTask.run(FutureTask.java)&lt;br/&gt;
 at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)&lt;br/&gt;
 at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)&lt;br/&gt;
 at io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)&lt;br/&gt;
 at java.lang.Thread.run(Thread.java:748)&lt;/p&gt;

&lt;p&gt;I tested it on cassandra version 3.11.3 &amp;amp;&#160;4.0-alpha3. The exception all happened.&lt;/p&gt;

&lt;p&gt;once it triggers,&#160;level1- leveln compaction no longer works, level0 is still valid&lt;br/&gt;
&#160;&lt;/p&gt;</description>
                <environment></environment>
        <key id="13294473">CASSANDRA-15669</key>
            <summary>LeveledCompactionStrategy compact last level throw an ArrayIndexOutOfBoundsException</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10002" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Normal</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="azotcsit">Aleksei Zotov</assignee>
                                    <reporter username="sunhaihong">sunhaihong</reporter>
                        <labels>
                    </labels>
                <created>Fri, 27 Mar 2020 13:58:55 +0000</created>
                <updated>Sat, 12 Jun 2021 10:17:06 +0000</updated>
                            <resolved>Mon, 31 May 2021 18:24:28 +0000</resolved>
                                        <fixVersion>3.11.11</fixVersion>
                    <fixVersion>4.0-rc2</fixVersion>
                    <fixVersion>4.0</fixVersion>
                                    <component>Local/Compaction/LCS</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>6</watches>
                                                    <progress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                            <timeestimate seconds="0">0h</timeestimate>
                            <timespent seconds="7800">2h 10m</timespent>
                                <comments>
                            <comment id="17324337" author="azotcsit" created="Sat, 17 Apr 2021 18:45:36 +0000"  >&lt;p&gt;I have checked this issue. I feel I have a kind of clear understanding of what is going on.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=sunhaihong&quot; class=&quot;user-hover&quot; rel=&quot;sunhaihong&quot;&gt;sunhaihong&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Just a point of my curiosity - what values for &lt;tt&gt;sstable_size_in_mb&lt;/tt&gt; and &lt;tt&gt;fanout_size&lt;/tt&gt; params do you use in prod and how much data do you have? I&apos;m just wondering how you were able to face this issue.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=marcuse&quot; class=&quot;user-hover&quot; rel=&quot;marcuse&quot;&gt;marcuse&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Looks like you are the best person to discuss this issue (as I can see, you actively participated in LCS development).&lt;/p&gt;

&lt;p&gt;First of all, I was able to reproduce this issue. I explored the code and probably I found a couple of minor issues.&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;&lt;b&gt;Wrong estimates calculation&lt;/b&gt;&lt;br/&gt;
 There is the following comment in the code:
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-comment&quot;&gt;// allocate enough generations &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; a PB of data, with a 1-MB sstable size.  (Note that &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; maxSSTableSize is
&lt;/span&gt;&lt;span class=&quot;code-comment&quot;&gt;// updated, we will still have sstables of the older, potentially smaller size.  So don&apos;t make &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;
&lt;/span&gt;&lt;span class=&quot;code-comment&quot;&gt;// dependent on maxSSTableSize.)
&lt;/span&gt;&lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; MAX_LEVEL_COUNT = (&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;) &lt;span class=&quot;code-object&quot;&gt;Math&lt;/span&gt;.log10(1000 * 1000 * 1000);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;It states about a PB of data for 1-MB sstable size configuration, but it does not seem to be correct. It would be correct if 10 levels were supported. However, 9 levels are currently supported. Here are my calculations (1-MB sstable size and 10 fanout size):&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
L0:    4 * 1 MB = 4 MB
L1: 10^1 * 1 MB = 10 MB
L2: 10^2 * 1 MB = 100 MB
L3: 10^3 * 1 MB = 1000 MB
L4: 10^4 * 1 MB = 10000 MB      = 9.76 GB
L5: 10^5 * 1 MB = 100000 MB     = 97.65 GB
L6: 10^6 * 1 MB = 1000000 MB    = 976.56 GB
L7: 10^7 * 1 MB = 10000000 MB   = 9765.62 GB   = 9.53 TB
L8: 10^8 * 1 MB = 100000000 MB  = 97656.25 GB  = 95.36 TB
L9: 10^9 * 1 MB = 1000000000 MB = 976562.50 GB = 953.67 TB  &amp;lt;-- &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; level is not supported &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Here is the place where it is clearly shown that 9 levels (including L0) are supported at the moment:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-comment&quot;&gt;// note that since l0 is broken out, levels[0] represents L1:
&lt;/span&gt;&lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; TreeSet&amp;lt;SSTableReader&amp;gt; [] levels = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; TreeSet[MAX_LEVEL_COUNT - 1];
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Either the comment needs to be fixed or the number of levels needs to be increased. I believe fixing the comment would be easier and amount of data still would be enough for a regular C* setup.&lt;/p&gt;&lt;/li&gt;
	&lt;li&gt;&lt;b&gt;There is no proper handling of a situation when there is more data than supported&lt;/b&gt;&lt;br/&gt;
 The issue happens when compaction for L8 is going to be started. Here is the flow:&#160;&lt;tt&gt;getCompactionCandidates&lt;/tt&gt;&#160;--&amp;gt; &lt;tt&gt;getCandidatesFor&amp;#40;i&amp;#41;&lt;/tt&gt; --&amp;gt; &lt;tt&gt;generations.get(level + 1)&lt;/tt&gt;. So while checking the compaction candidates for L8, it tries to see what&apos;s going on L9 level and immediately fails. And that&apos;s fair because we target to support a certain amount of data only. &lt;br/&gt;
 Currently the above flow is triggered when &lt;tt&gt;score &amp;gt; 1.001&lt;/tt&gt; (there is more data than it should be on a level). In fact, we should not even try to check candidates for compaction on the highest level, we should just fail fast since it is an impossible situation for a properly configured C* cluster. I think a clear error should be thrown when there is an attempt to handle more data than expected on the highest level, smth like:
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (score &amp;gt; 1.001)
{
    &lt;span class=&quot;code-comment&quot;&gt;// the highest level should not ever exceed its maximum size
&lt;/span&gt;    &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (i == generations.levelCount() - 1)
&lt;span class=&quot;code-keyword&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; RuntimeException(&lt;span class=&quot;code-quote&quot;&gt;&quot;Highest level (L&quot;&lt;/span&gt; + i + &lt;span class=&quot;code-quote&quot;&gt;&quot;) should not exceed its maximum size (&quot;&lt;/span&gt; + maxBytesForLevel + &lt;span class=&quot;code-quote&quot;&gt;&quot;), but it has &quot;&lt;/span&gt; + bytesForLevel + &lt;span class=&quot;code-quote&quot;&gt;&quot; bytes&quot;&lt;/span&gt;);

    &lt;span class=&quot;code-comment&quot;&gt;// before proceeding with a higher level, let&apos;s see &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; L0 is far enough behind to warrant STCS
&lt;/span&gt;    &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (l0Compaction != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;)
        &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; l0Compaction;
    ...
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;&lt;/p&gt;&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;I&apos;d be glad to hear you feedback on the points above. If you find the suggestions reasonable, I&apos;d like to come up with a patch (I have a draft, but before polishing it I&apos;d like to validate my understanding). Probably I&apos;d also update the documentation to clearly state number of levels supported and the ways to estimate data size.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="17324468" author="azotcsit" created="Sun, 18 Apr 2021 10:00:30 +0000"  >&lt;p&gt;Finally, it turned out that writing a test was quite fast and easy, so I raised a PR (&lt;a href=&quot;https://github.com/apache/cassandra/pull/971&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/cassandra/pull/971&lt;/a&gt;) to illustrate my findings better. Please, review and let me know your thoughts.&lt;/p&gt;</comment>
                            <comment id="17325504" author="sunhaihong" created="Tue, 20 Apr 2021 06:23:25 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=azotcsit&quot; class=&quot;user-hover&quot; rel=&quot;azotcsit&quot;&gt;azotcsit&lt;/a&gt;&#65292;Thank you for your reply.&#160;&lt;/p&gt;

&lt;p&gt;My problem is the second situation that you described ---- 2.&#160;&lt;b&gt;There is no proper handling of a situation when there is more data than supported.&lt;/b&gt;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="17337616" author="yifanc" created="Fri, 30 Apr 2021 20:51:51 +0000"  >&lt;p&gt;The patch LGTM.&#160;&lt;/p&gt;

&lt;p&gt;Rebased and started the test at&#160;&lt;a href=&quot;https://app.circleci.com/pipelines/github/yifan-c/cassandra?branch=commit_remote_branch%2FCASSANDRA-15669-trunk-E4784D85-846B-4A8A-A286-C471B44CC10E&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://app.circleci.com/pipelines/github/yifan-c/cassandra?branch=commit_remote_branch%2FCASSANDRA-15669-trunk-E4784D85-846B-4A8A-A286-C471B44CC10E&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&amp;#8211; EDIT &amp;#8211;&lt;/p&gt;

&lt;p&gt;The CI result looks good.&lt;/p&gt;</comment>
                            <comment id="17339393" author="azotcsit" created="Wed, 5 May 2021 04:20:17 +0000"  >&lt;p&gt;Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=yifanc&quot; class=&quot;user-hover&quot; rel=&quot;yifanc&quot;&gt;yifanc&lt;/a&gt;! Please, let me know if I need to make any other changes like squashing or updating &lt;tt&gt;CHANGES.txt&lt;/tt&gt;.&lt;/p&gt;</comment>
                            <comment id="17352648" author="azotcsit" created="Thu, 27 May 2021 17:25:21 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=blerer&quot; class=&quot;user-hover&quot; rel=&quot;blerer&quot;&gt;blerer&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=marcuse&quot; class=&quot;user-hover&quot; rel=&quot;marcuse&quot;&gt;marcuse&lt;/a&gt;&#160;could you please take a look to the PR and let me know whether it is good to merge or any other changes are required.&lt;/p&gt;</comment>
                            <comment id="17352990" author="krummas" created="Fri, 28 May 2021 06:36:56 +0000"  >&lt;p&gt;sorry for the delay&lt;/p&gt;

&lt;p&gt;+1 on the patch, I&apos;ll get it committed today&lt;/p&gt;</comment>
                            <comment id="17353467" author="yifanc" created="Fri, 28 May 2021 17:16:34 +0000"  >&lt;p&gt;I am working on committing. &lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=azotcsit&quot; class=&quot;user-hover&quot; rel=&quot;azotcsit&quot;&gt;azotcsit&lt;/a&gt;, can you also provide a patch for the 3.11 branch? We merge from bottom up. So in this case, it is from 3.11 to trunk. But my preference is to have patches for each branch, which works better with my committing script &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/biggrin.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="17354107" author="azotcsit" created="Sun, 30 May 2021 19:48:31 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=yifanc&quot; class=&quot;user-hover&quot; rel=&quot;yifanc&quot;&gt;yifanc&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=marcuse&quot; class=&quot;user-hover&quot; rel=&quot;marcuse&quot;&gt;marcuse&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;I&apos;m attaching patches for 3.11, 4.0 and trunk branches. In order to make the unit test working in 3.11 branch, I&apos;ve had to onboard these changes:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;&lt;a href=&quot;https://github.com/apache/cassandra/commit/546331037ee8218208b61a26ecbc12ab8dd7eace#diff-d2993d01b021fb5e2ed23171c0bf5f1abb2f13d1d9ef67d089bb2cf8108ff64c&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/cassandra/commit/546331037ee8218208b61a26ecbc12ab8dd7eace#diff-d2993d01b021fb5e2ed23171c0bf5f1abb2f13d1d9ef67d089bb2cf8108ff64c&lt;/a&gt;&lt;/li&gt;
	&lt;li&gt;&lt;a href=&quot;https://github.com/apache/cassandra/commit/54d297a192ca452dab5640f33fd6c22fd31e2f9c#diff-d2993d01b021fb5e2ed23171c0bf5f1abb2f13d1d9ef67d089bb2cf8108ff64c&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/cassandra/commit/54d297a192ca452dab5640f33fd6c22fd31e2f9c#diff-d2993d01b021fb5e2ed23171c0bf5f1abb2f13d1d9ef67d089bb2cf8108ff64c&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;I run the&#160;&lt;tt&gt;LeveledCompactionStrategyTest&lt;/tt&gt; on every&#160;branch and it worked fine for me locally. Please, let me know if you encounter any issues with that test on CI.&lt;/p&gt;

&lt;p&gt;PS:&lt;br/&gt;
 Initially I misread the comment and tried to prepare a patch for 3.0 version &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/biggrin.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&#160;It turned out that it is pretty to hard to migrate the unit test to that branch because &lt;em&gt;fanout&lt;/em&gt;&#160;parameter is not yet configurable. Consequently it requires to generate a bunch of sstables (to reach &lt;em&gt;max level size&lt;/em&gt; for L8) which make the test&#160;long and clumsy. It took some time to realize that it is better to go without having that test in 3.0. And finally I found out that the patch for 3.0 is not required.&lt;/p&gt;</comment>
                            <comment id="17354230" author="yifanc" created="Mon, 31 May 2021 06:05:33 +0000"  >&lt;p&gt;Starting commit&lt;/p&gt;

&lt;p&gt;CI Results:&lt;/p&gt;
&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;Branch&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;Source&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;Circle CI&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;Jenkins&lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;cassandra-3.11&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/yifan-c/cassandra/tree/commit_remote_branch/CASSANDRA-15669-cassandra-3.11-8248B4BC-5657-41EF-83A0-13827185AB7E&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;branch&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://app.circleci.com/pipelines/github/yifan-c/cassandra?branch=commit_remote_branch%2FCASSANDRA-15669-cassandra-3.11-8248B4BC-5657-41EF-83A0-13827185AB7E&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;build&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://ci-cassandra.apache.org/blue/organizations/jenkins/Cassandra-devbranch/detail/Cassandra-devbranch/821/pipeline&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;build&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;cassandra-4.0&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/yifan-c/cassandra/tree/commit_remote_branch/CASSANDRA-15669-cassandra-4.0-8248B4BC-5657-41EF-83A0-13827185AB7E&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;branch&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://app.circleci.com/pipelines/github/yifan-c/cassandra?branch=commit_remote_branch%2FCASSANDRA-15669-cassandra-4.0-8248B4BC-5657-41EF-83A0-13827185AB7E&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;build&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://ci-cassandra.apache.org/blue/organizations/jenkins/Cassandra-devbranch/detail/Cassandra-devbranch/818/pipeline&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;build&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;trunk&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/yifan-c/cassandra/tree/commit_remote_branch/CASSANDRA-15669-trunk-8248B4BC-5657-41EF-83A0-13827185AB7E&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;branch&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://app.circleci.com/pipelines/github/yifan-c/cassandra?branch=commit_remote_branch%2FCASSANDRA-15669-trunk-8248B4BC-5657-41EF-83A0-13827185AB7E&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;build&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://ci-cassandra.apache.org/blue/organizations/jenkins/Cassandra-devbranch/detail/Cassandra-devbranch/820/pipeline&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;build&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;


&lt;p&gt;&amp;#8211; edit 05/31 &amp;#8211;&lt;/p&gt;

&lt;p&gt;Results look green.&#160;&lt;/p&gt;

&lt;p&gt;3.11 CI results looks good. Failures do not look related.&#160;&lt;/p&gt;

&lt;p&gt;4.0 and trunk CI results mostly are good, except the test failure (&quot;Got unexpected overlap in level X&quot;) from &lt;tt&gt;stressTestCompactionStrategyManager &#8211; org.apache.cassandra.db.compaction.LongLeveledCompactionStrategyCQLTest&lt;/tt&gt; that looks suspicious. There is a ticket for it already,&#160;&lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-16637&quot; title=&quot;LongLeveledCompactionStrategyCQLTest.stressTestCompactionStrategyManager fails&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-16637&quot;&gt;CASSANDRA-16637&lt;/a&gt;. So it should not be caused by this patch.&#160;&lt;/p&gt;</comment>
                            <comment id="17354615" author="yifanc" created="Mon, 31 May 2021 18:24:28 +0000"  >&lt;p&gt;Committed to 3.11 as &lt;a href=&quot;https://github.com/apache/cassandra/commit/803a23b2f1b24701c22e7fadaf98c2c9a9491d35&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;803a23&lt;/a&gt; and merged up to trunk&lt;/p&gt;</comment>
                            <comment id="17354616" author="azotcsit" created="Mon, 31 May 2021 18:29:08 +0000"  >&lt;p&gt;Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=yifanc&quot; class=&quot;user-hover&quot; rel=&quot;yifanc&quot;&gt;yifanc&lt;/a&gt;!&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="13026149" name="15669-3.11.txt" size="12287" author="azotcsit" created="Sun, 30 May 2021 19:48:08 +0000"/>
                            <attachment id="13026150" name="15669-4.0.txt" size="8003" author="azotcsit" created="Sun, 30 May 2021 19:48:08 +0000"/>
                            <attachment id="13026151" name="15669-trunk.txt" size="8003" author="azotcsit" created="Sun, 30 May 2021 19:48:08 +0000"/>
                            <attachment id="12998004" name="cfs_compaction_info.png" size="22436" author="sunhaihong" created="Fri, 27 Mar 2020 13:50:14 +0000"/>
                            <attachment id="12998003" name="error_info.png" size="37832" author="sunhaihong" created="Fri, 27 Mar 2020 13:50:17 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>5.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[azotcsit]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12313825" key="com.atlassian.jira.plugin.system.customfieldtypes:cascadingselect">
                        <customfieldname>Bug Category</customfieldname>
                        <customfieldvalues>
                                                    <customfieldvalue key="12983" cascade-level=""><![CDATA[Availability]]></customfieldvalue>
            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12313821" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Complexity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12965"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313822" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Discovered By</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12969"><![CDATA[User Report]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12313922" key="jira.plugin.projectspecificselectfield.jpssf:multicftype">
                        <customfieldname>Impacts</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="13100"><![CDATA[None]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            4 years, 24 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12313921" key="jira.plugin.projectspecificselectfield.jpssf:multicftype">
                        <customfieldname>Platform</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="13076"><![CDATA[All]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0czhc:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[marcuse]]></customfieldvalue>
        <customfieldvalue><![CDATA[yifanc]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12962"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12311420" key="com.atlassian.jira.plugin.system.customfieldtypes:version">
                        <customfieldname>Since Version</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="12339157">3.11.0</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313924" key="com.atlassian.jira.plugin.system.customfieldtypes:textfield">
                        <customfieldname>Source Control Link</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>&lt;p&gt;&lt;a href=&quot;https://github.com/apache/cassandra/commit/803a23b2f1b24701c22e7fadaf98c2c9a9491d35&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/cassandra/commit/803a23b2f1b24701c22e7fadaf98c2c9a9491d35&lt;/a&gt;&lt;/p&gt;</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313823" key="com.atlassian.jira.plugin.system.customfieldtypes:textarea">
                        <customfieldname>Test and Documentation Plan</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>&lt;p&gt;test added&lt;/p&gt;</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>