<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 23:17:12 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-15854] Truncation should fail any ongoing repairs</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-15854</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;Truncation may race with ongoing repairs, making it possible to clear data on one node but then stream data its truncation would have deleted from another node. We should abort any ongoing preview repairs if we get a truncation request.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13309394">CASSANDRA-15854</key>
            <summary>Truncation should fail any ongoing repairs</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10002" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Normal</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="marcuse">Marcus Eriksson</assignee>
                                    <reporter username="marcuse">Marcus Eriksson</reporter>
                        <labels>
                    </labels>
                <created>Thu, 4 Jun 2020 08:55:01 +0000</created>
                <updated>Sun, 3 Jan 2021 17:03:51 +0000</updated>
                            <resolved>Fri, 25 Sep 2020 07:13:35 +0000</resolved>
                                        <fixVersion>4.0-beta3</fixVersion>
                    <fixVersion>4.0</fixVersion>
                                    <component>Consistency/Repair</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="17127945" author="ottermad" created="Mon, 8 Jun 2020 07:09:28 +0000"  >&lt;p&gt;I am curious about how this might work (I&apos;m new to the codebase) and I was wondering how can you check for ongoing preview repairs? (The closest thing I could find is the&#160;PendingTasks compaction metric). Is there a better way?&lt;/p&gt;</comment>
                            <comment id="17130300" author="krummas" created="Wed, 10 Jun 2020 07:00:34 +0000"  >&lt;p&gt;I&apos;ll post the patch soon, but we keep track of &lt;tt&gt;ParentRepairSession&lt;/tt&gt; in &lt;tt&gt;ActiveRepairService&lt;/tt&gt;&lt;/p&gt;</comment>
                            <comment id="17133082" author="krummas" created="Thu, 11 Jun 2020 09:18:03 +0000"  >&lt;p&gt;&lt;a href=&quot;https://github.com/krummas/cassandra/commits/marcuse/15854&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;patch&lt;/a&gt; (on top of &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-15851&quot; title=&quot;Add bytebuddy support for in-jvm dtests&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-15851&quot;&gt;&lt;del&gt;CASSANDRA-15851&lt;/del&gt;&lt;/a&gt; to get byte buddy support)&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://circleci.com/gh/krummas/cassandra/3400&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;utests&lt;/a&gt;&lt;br/&gt;
&lt;a href=&quot;https://circleci.com/gh/krummas/cassandra/3399&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;in-jvm dtests&lt;/a&gt;&lt;br/&gt;
&lt;a href=&quot;https://circleci.com/gh/krummas/cassandra/3403&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;dtests vnodes&lt;/a&gt;&lt;br/&gt;
&lt;a href=&quot;https://circleci.com/gh/krummas/cassandra/3402&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;dtests novnodes&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17142440" author="maedhroz" created="Mon, 22 Jun 2020 21:53:54 +0000"  >&lt;p&gt;I&apos;m not able to reproduce the failure in &lt;tt&gt;StreamingInboundHandlerTest&lt;/tt&gt; in a few local runs, but it also doesn&apos;t seem to have a flaky test Jira. Will have to investigate further...&lt;/p&gt;</comment>
                            <comment id="17142442" author="maedhroz" created="Mon, 22 Jun 2020 22:05:26 +0000"  >&lt;p&gt;The dtest failure in &lt;tt&gt;TestRepair&lt;/tt&gt; looks like &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-15861&quot; title=&quot;Mutating sstable component may race with entire-sstable-streaming(ZCS) causing checksum validation failure&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-15861&quot;&gt;&lt;del&gt;CASSANDRA-15861&lt;/del&gt;&lt;/a&gt;, but &lt;tt&gt;test_cleanup&lt;/tt&gt; in &lt;tt&gt;bootstrap_test.TestBootstrap&lt;/tt&gt; doesn&apos;t look like it&apos;s been reported yet.&lt;/p&gt;</comment>
                            <comment id="17142455" author="maedhroz" created="Mon, 22 Jun 2020 22:28:48 +0000"  >&lt;p&gt;This isn&apos;t related directly to the patch, but there are a couple places (&lt;tt&gt;CassandraValidationIterator&lt;/tt&gt; and &lt;tt&gt;RepairMessageVerbHandler&lt;/tt&gt;) where we believe &lt;tt&gt;ActiveRepairService#getParentRepairSession()&lt;/tt&gt; can return &lt;tt&gt;null&lt;/tt&gt;. It seems pretty clear, though, that we&apos;ll always throw a &lt;tt&gt;RuntimeException&lt;/tt&gt; before we allow that to happen.&lt;/p&gt;</comment>
                            <comment id="17142499" author="maedhroz" created="Tue, 23 Jun 2020 00:13:08 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=marcuse&quot; class=&quot;user-hover&quot; rel=&quot;marcuse&quot;&gt;marcuse&lt;/a&gt; I&apos;ve left the comments from my first pass of review &lt;a href=&quot;https://github.com/krummas/cassandra/commit/0da4b6ca0180efae9cbf22bf5eee77d2aa3b936e&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;inline&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="17177782" author="krummas" created="Fri, 14 Aug 2020 13:48:15 +0000"  >&lt;p&gt;Sorry for the delay &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=maedhroz&quot; class=&quot;user-hover&quot; rel=&quot;maedhroz&quot;&gt;maedhroz&lt;/a&gt; - I&apos;ve pushed a few commits addressing your comments - and the test was horrible, I&apos;ve pushed a simpler version which makes it clearer what is going on&lt;/p&gt;</comment>
                            <comment id="17178070" author="maedhroz" created="Fri, 14 Aug 2020 21:20:05 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=marcuse&quot; class=&quot;user-hover&quot; rel=&quot;marcuse&quot;&gt;marcuse&lt;/a&gt; Thanks!&lt;/p&gt;

&lt;p&gt;Left a few more very &lt;a href=&quot;https://github.com/krummas/cassandra/commit/0f81a451bba4e2d40babe6fdacfb9565abe42775&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;minor nits&lt;/a&gt;, but otherwise LGTM &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/wink.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="17181708" author="krummas" created="Fri, 21 Aug 2020 08:19:24 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=maedhroz&quot; class=&quot;user-hover&quot; rel=&quot;maedhroz&quot;&gt;maedhroz&lt;/a&gt; pushed the nit fixes&lt;/p&gt;</comment>
                            <comment id="17181944" author="maedhroz" created="Fri, 21 Aug 2020 15:22:56 +0000"  >&lt;p&gt;+1&lt;/p&gt;</comment>
                            <comment id="17190923" author="dcapwell" created="Fri, 4 Sep 2020 21:40:47 +0000"  >&lt;p&gt;Left my comments on &lt;a href=&quot;https://github.com/krummas/cassandra/commit/614b8da34660cc86305a26d33c47883cb5f603e7&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/krummas/cassandra/commit/614b8da34660cc86305a26d33c47883cb5f603e7&lt;/a&gt;; my main comments are on the test.&lt;/p&gt;</comment>
                            <comment id="17201069" author="dcapwell" created="Wed, 23 Sep 2020 20:18:39 +0000"  >&lt;p&gt;Been running the tests in a loop to make sure not flaky, found this failure&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
testclasslist:
     [echo] &lt;span class=&quot;code-object&quot;&gt;Number&lt;/span&gt; of test runners: 1
[junit-timeout] Picked up _JAVA_OPTIONS: -Djava.net.preferIPv4Stack=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;
[junit-timeout] Testsuite: org.apache.cassandra.distributed.test.IncRepairTruncationTest
[junit-timeout] Testsuite: org.apache.cassandra.distributed.test.IncRepairTruncationTest Tests run: 1, Failures: 1, Errors: 0, Skipped: 0, Time elapsed: 108.5 sec
[junit-timeout]
[junit-timeout] Testcase: testTruncateDuringIncRepair(org.apache.cassandra.distributed.test.IncRepairTruncationTest):   FAILED
[junit-timeout] &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;
[junit-timeout] junit.framework.AssertionFailedError
[junit-timeout]         at org.apache.cassandra.distributed.test.IncRepairTruncationTest.testTruncateDuringIncRepair(IncRepairTruncationTest.java:100)
[junit-timeout]
[junit-timeout]
[junit-timeout] Test org.apache.cassandra.distributed.test.IncRepairTruncationTest FAILED
[junitreport] Processing /Users/davidcapwell/src/github/apache/team/marcus-cassandra/build/test/TESTS-TestSuites.xml to /&lt;span class=&quot;code-keyword&quot;&gt;var&lt;/span&gt;/folders/cm/08cddl2s25j7fq3jdb76gh4r0000gn/T/null1038731269
[junitreport] Loading stylesheet jar:file:/usr/local/Cellar/ant/1.10.7/libexec/lib/ant-junit.jar!/org/apache/tools/ant/taskdefs/optional/junit/xsl/junit-frames.xsl
[junitreport] Transform time: 5425ms
[junitreport] Deleting: /&lt;span class=&quot;code-keyword&quot;&gt;var&lt;/span&gt;/folders/cm/08cddl2s25j7fq3jdb76gh4r0000gn/T/null1038731269

BUILD FAILED
/Users/davidcapwell/src/github/apache/team/marcus-cassandra/build.xml:2004: The following error occurred &lt;span class=&quot;code-keyword&quot;&gt;while&lt;/span&gt; executing &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; line:
/Users/davidcapwell/src/github/apache/team/marcus-cassandra/build.xml:1894: Some test(s) failed.
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Seems an inconsistency was found; this was on the branch without changes.&lt;/p&gt;

&lt;p&gt;This failed after the 13th run with lower resources (2 physical cores; 4 hyper-threaded).&lt;/p&gt;</comment>
                            <comment id="17201439" author="krummas" created="Thu, 24 Sep 2020 10:38:19 +0000"  >&lt;p&gt;Rewrote the test again, ran it in a loop 80 times with lower resources, no failures&lt;/p&gt;

&lt;p&gt;Noticed that we stream even if the repair fails right before we get the validation response, that might have been what caused your failure.&lt;/p&gt;

&lt;p&gt;cci run: &lt;a href=&quot;https://app.circleci.com/pipelines/github/krummas/cassandra/541/workflows/8d3cbf9c-6556-45d9-b993-e258b3211323&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://app.circleci.com/pipelines/github/krummas/cassandra/541/workflows/8d3cbf9c-6556-45d9-b993-e258b3211323&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;seems &lt;tt&gt;IncrementalRepairCoordinatorTimeoutTest&lt;/tt&gt; failed, looks unrelated and passes locally&lt;/p&gt;</comment>
                            <comment id="17201623" author="dcapwell" created="Thu, 24 Sep 2020 16:17:59 +0000"  >&lt;p&gt;thanks, ill file a jira and take that exception&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
Error message &lt;span class=&quot;code-quote&quot;&gt;&apos;Got negative replies from endpoints [/127.0.0.2:7012]&apos;&lt;/span&gt; does not contain any of [Did not get replies from all endpoints.]
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;the test validates the repair fails but getting wrong message periodically it seems, so needs to be root caused and fixed.&lt;/p&gt;</comment>
                            <comment id="17201626" author="dcapwell" created="Thu, 24 Sep 2020 16:21:24 +0000"  >&lt;p&gt;tests LGTM +1&lt;/p&gt;</comment>
                            <comment id="17201961" author="krummas" created="Fri, 25 Sep 2020 07:13:35 +0000"  >&lt;p&gt;committed with a small change - moved the parent repair session check to &lt;tt&gt;RepairJob#executeTask&lt;/tt&gt;, test run &lt;a href=&quot;https://app.circleci.com/pipelines/github/krummas/cassandra/543/workflows/555d874f-8c47-41b0-bf95-80aeb9a75188&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;here&lt;/a&gt; (dtest failure is tracked in &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-16094&quot; title=&quot;Avoid marking shutting down nodes as up after receiving gossip shutdown message&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-16094&quot;&gt;&lt;del&gt;CASSANDRA-16094&lt;/del&gt;&lt;/a&gt;, looks unrelated to this), thanks&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10032">
                    <name>Blocker</name>
                                                                <inwardlinks description="is blocked by">
                                        <issuelink>
            <issuekey id="13309380">CASSANDRA-15851</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[marcuse]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12313825" key="com.atlassian.jira.plugin.system.customfieldtypes:cascadingselect">
                        <customfieldname>Bug Category</customfieldname>
                        <customfieldvalues>
                                                    <customfieldvalue key="12982" cascade-level=""><![CDATA[Correctness]]></customfieldvalue>
                                <customfieldvalue key="12987" cascade-level="1"><![CDATA[Transient Incorrect Response]]></customfieldvalue>
            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12313821" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Complexity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12964"><![CDATA[Low Hanging Fruit]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313822" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Discovered By</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12975"><![CDATA[Code Inspection]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12313922" key="jira.plugin.projectspecificselectfield.jpssf:multicftype">
                        <customfieldname>Impacts</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="13100"><![CDATA[None]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            5 years, 7 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12313921" key="jira.plugin.projectspecificselectfield.jpssf:multicftype">
                        <customfieldname>Platform</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="13076"><![CDATA[All]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0fi0w:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[maedhroz]]></customfieldvalue>
        <customfieldvalue><![CDATA[dcapwell]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12961"><![CDATA[Low]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12311420" key="com.atlassian.jira.plugin.system.customfieldtypes:version">
                        <customfieldname>Since Version</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="12348281">4.0-alpha1</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313924" key="com.atlassian.jira.plugin.system.customfieldtypes:textfield">
                        <customfieldname>Source Control Link</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>&lt;p&gt;&lt;a href=&quot;https://github.com/apache/cassandra/commit/d4eba9faa1b57fed205813a639fe53bbbdc06ef1&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/cassandra/commit/d4eba9faa1b57fed205813a639fe53bbbdc06ef1&lt;/a&gt;&lt;/p&gt;</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313823" key="com.atlassian.jira.plugin.system.customfieldtypes:textarea">
                        <customfieldname>Test and Documentation Plan</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>&lt;p&gt;new jvm dtest, cci runs&lt;/p&gt;</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>