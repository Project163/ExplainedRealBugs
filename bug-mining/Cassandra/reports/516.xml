<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 22:17:10 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-1617] BufferUnderflowException occurs in RowMutationVerbHandler</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-1617</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;There might be a bug in hinted handoff?&lt;/p&gt;

&lt;p&gt;I have a cluster of 8, replication factor of 3, doing reads/writes with QUORUM.&lt;br/&gt;
I have a single thread doing reads/writes of about 2kb across all nodes, running about 200hps.&lt;br/&gt;
When I shut down one node, within a few seconds I start seeing some very big recent write latencies, 4-5 seconds.&lt;br/&gt;
I looked at the system.log on the node with the adjacent token to the node that I shut down, and see a bad looking BufferUnderflowException:&lt;/p&gt;

&lt;p&gt;INFO &lt;span class=&quot;error&quot;&gt;&amp;#91;WRITE-kv2-app02.dev.real.com/172.27.109.32&amp;#93;&lt;/span&gt; 2010-10-12 12:13:36,712 &lt;br/&gt;
OutboundTcpConnection.java (line 115) error writing to &lt;br/&gt;
kv2-app02.dev.real.com/172.27.109.32&lt;br/&gt;
 INFO &lt;span class=&quot;error&quot;&gt;&amp;#91;WRITE-kv2-app02.dev.real.com/172.27.109.32&amp;#93;&lt;/span&gt; 2010-10-12 12:13:50,336 &lt;br/&gt;
OutboundTcpConnection.java (line 115) error writing to &lt;br/&gt;
kv2-app02.dev.real.com/172.27.109.32&lt;br/&gt;
 INFO &lt;span class=&quot;error&quot;&gt;&amp;#91;Timer-0&amp;#93;&lt;/span&gt; 2010-10-12 12:14:22,792 Gossiper.java (line 196) InetAddress &lt;br/&gt;
/172.27.109.32 is now dead.&lt;br/&gt;
ERROR &lt;span class=&quot;error&quot;&gt;&amp;#91;MUTATION_STAGE:1315&amp;#93;&lt;/span&gt; 2010-10-12 12:14:24,917 &lt;br/&gt;
DebuggableThreadPoolExecutor.java (line 103) Error in ThreadPoolExecutor&lt;br/&gt;
java.nio.BufferUnderflowException&lt;br/&gt;
        at java.nio.HeapByteBuffer.get(HeapByteBuffer.java:127)&lt;br/&gt;
        at java.nio.ByteBuffer.get(ByteBuffer.java:675)&lt;br/&gt;
        at &lt;br/&gt;
org.apache.cassandra.db.RowMutationVerbHandler.doVerb(RowMutationVerbHandler.java:62)&lt;br/&gt;
        at &lt;br/&gt;
org.apache.cassandra.net.MessageDeliveryTask.run(MessageDeliveryTask.java:50)&lt;br/&gt;
        at &lt;br/&gt;
java.util.concurrent.ThreadPoolExecutor$Worker.runTask(ThreadPoolExecutor.java:886)&lt;br/&gt;
        at &lt;br/&gt;
java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:908)&lt;br/&gt;
        at java.lang.Thread.run(Thread.java:619)&lt;br/&gt;
ERROR &lt;span class=&quot;error&quot;&gt;&amp;#91;MUTATION_STAGE:1315&amp;#93;&lt;/span&gt; 2010-10-12 12:14:24,918 &lt;br/&gt;
AbstractCassandraDaemon.java (line 88) Fatal exception in thread &lt;br/&gt;
Thread&lt;span class=&quot;error&quot;&gt;&amp;#91;MUTATION_STAGE:1315,5,main&amp;#93;&lt;/span&gt;&lt;br/&gt;
java.nio.BufferUnderflowException&lt;br/&gt;
        at java.nio.HeapByteBuffer.get(HeapByteBuffer.java:127)&lt;br/&gt;
        at java.nio.ByteBuffer.get(ByteBuffer.java:675)&lt;br/&gt;
        at &lt;br/&gt;
org.apache.cassandra.db.RowMutationVerbHandler.doVerb(RowMutationVerbHandler.java:62)&lt;br/&gt;
        at &lt;br/&gt;
org.apache.cassandra.net.MessageDeliveryTask.run(MessageDeliveryTask.java:50)&lt;br/&gt;
        at &lt;br/&gt;
java.util.concurrent.ThreadPoolExecutor$Worker.runTask(ThreadPoolExecutor.java:886)&lt;br/&gt;
        at &lt;br/&gt;
java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:908)&lt;br/&gt;
        at java.lang.Thread.run(Thread.java:619)&lt;br/&gt;
ERROR &lt;span class=&quot;error&quot;&gt;&amp;#91;MUTATION_STAGE:1605&amp;#93;&lt;/span&gt; 2010-10-12 12:14:28,919 &lt;br/&gt;
DebuggableThreadPoolExecutor.java (line 103) Error in ThreadPoolExecutor&lt;br/&gt;
java.nio.BufferUnderflowException&lt;br/&gt;
        at java.nio.HeapByteBuffer.get(HeapByteBuffer.java:127)&lt;br/&gt;
        at java.nio.ByteBuffer.get(ByteBuffer.java:675)&lt;br/&gt;
        at &lt;br/&gt;
org.apache.cassandra.db.RowMutationVerbHandler.doVerb(RowMutationVerbHandler.java:62)&lt;br/&gt;
        at &lt;br/&gt;
org.apache.cassandra.net.MessageDeliveryTask.run(MessageDeliveryTask.java:50)&lt;br/&gt;
        at &lt;br/&gt;
java.util.concurrent.ThreadPoolExecutor$Worker.runTask(ThreadPoolExecutor.java:886)&lt;br/&gt;
        at &lt;br/&gt;
java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:908)&lt;br/&gt;
        at java.lang.Thread.run(Thread.java:619)&lt;br/&gt;
....&lt;br/&gt;
....&lt;/p&gt;

&lt;p&gt;I restarted the previously stopped node, and the system recovers, but with a &lt;br/&gt;
few more underlflow exceptions:&lt;/p&gt;

&lt;p&gt; INFO &lt;span class=&quot;error&quot;&gt;&amp;#91;GOSSIP_STAGE:1&amp;#93;&lt;/span&gt; 2010-10-12 12:15:44,537 Gossiper.java (line 594) Node &lt;br/&gt;
/172.27.109.32 has restarted, now UP again&lt;br/&gt;
 INFO &lt;span class=&quot;error&quot;&gt;&amp;#91;HINTED-HANDOFF-POOL:1&amp;#93;&lt;/span&gt; 2010-10-12 12:15:44,537 HintedHandOffManager.java &lt;br/&gt;
(line 196) Started hinted handoff for endpoint /172.27.109.32&lt;br/&gt;
 INFO &lt;span class=&quot;error&quot;&gt;&amp;#91;GOSSIP_STAGE:1&amp;#93;&lt;/span&gt; 2010-10-12 12:15:44,537 StorageService.java (line 643) &lt;br/&gt;
Node /172.27.109.32 state jump to normal&lt;br/&gt;
 INFO &lt;span class=&quot;error&quot;&gt;&amp;#91;HINTED-HANDOFF-POOL:1&amp;#93;&lt;/span&gt; 2010-10-12 12:15:44,538 HintedHandOffManager.java &lt;br/&gt;
(line 252) Finished hinted handoff of 0 rows to endpoint /172.27.109.32&lt;br/&gt;
 INFO &lt;span class=&quot;error&quot;&gt;&amp;#91;GOSSIP_STAGE:1&amp;#93;&lt;/span&gt; 2010-10-12 12:15:44,538 StorageService.java (line 650) &lt;br/&gt;
Will not change my token ownership to /172.27.109.32&lt;br/&gt;
ERROR &lt;span class=&quot;error&quot;&gt;&amp;#91;MUTATION_STAGE:1635&amp;#93;&lt;/span&gt; 2010-10-12 12:15:45,083 &lt;br/&gt;
DebuggableThreadPoolExecutor.java (line 103) Error in ThreadPoolExecutor&lt;br/&gt;
java.nio.BufferUnderflowException&lt;br/&gt;
        at java.nio.HeapByteBuffer.get(HeapByteBuffer.java:127)&lt;br/&gt;
        at java.nio.ByteBuffer.get(ByteBuffer.java:675)&lt;br/&gt;
        at &lt;br/&gt;
org.apache.cassandra.db.RowMutationVerbHandler.doVerb(RowMutationVerbHandler.java:62)&lt;br/&gt;
        at &lt;br/&gt;
org.apache.cassandra.net.MessageDeliveryTask.run(MessageDeliveryTask.java:50)&lt;br/&gt;
        at &lt;br/&gt;
java.util.concurrent.ThreadPoolExecutor$Worker.runTask(ThreadPoolExecutor.java:886)&lt;br/&gt;
        at &lt;br/&gt;
java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:908)&lt;br/&gt;
        at java.lang.Thread.run(Thread.java:619)&lt;/p&gt;</description>
                <environment>&lt;p&gt;Centos 5.4, jdk 1.6.0_20-b02, 16 core xeon, 8 node cluster&lt;/p&gt;</environment>
        <key id="12477257">CASSANDRA-1617</key>
            <summary>BufferUnderflowException occurs in RowMutationVerbHandler</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10002" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Normal</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="brandon.williams">Brandon Williams</assignee>
                                    <reporter username="moores">Michael Moores</reporter>
                        <labels>
                    </labels>
                <created>Wed, 13 Oct 2010 17:01:13 +0000</created>
                <updated>Tue, 16 Apr 2019 09:33:15 +0000</updated>
                            <resolved>Wed, 20 Oct 2010 19:18:31 +0000</resolved>
                                        <fixVersion>0.7 beta 3</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                                                                <comments>
                            <comment id="12921114" author="jbellis" created="Thu, 14 Oct 2010 20:42:50 +0000"  >&lt;p&gt;did you upgrade this cluster from 0.6?&lt;/p&gt;</comment>
                            <comment id="12921134" author="moores" created="Thu, 14 Oct 2010 21:20:00 +0000"  >&lt;p&gt;Yea we stopped using 0.6 a while back.  All data was created from scratch with 0.7-beta2.&lt;/p&gt;</comment>
                            <comment id="12921530" author="franklovecchio" created="Fri, 15 Oct 2010 20:25:28 +0000"  >&lt;p&gt;We have the nightly build as of yesterday of 0.7 beta 2, and now get the error below when trying to insert a record:  (CLI sytax is something like set CF &lt;span class=&quot;error&quot;&gt;&amp;#91;&amp;#39;something&amp;#39;&amp;#93;&lt;/span&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;&amp;#39;something1&amp;#39;&amp;#93;&lt;/span&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;&amp;#39;something2&amp;#39;&amp;#93;&lt;/span&gt; = &apos;value&apos; )&lt;/p&gt;

&lt;p&gt;ERROR &lt;span class=&quot;error&quot;&gt;&amp;#91;MutationStage:2278&amp;#93;&lt;/span&gt; 2010-10-15 20:09:39,523 DebuggableThreadPoolExecutor.java (line 103) Error in ThreadPoolExecutor&lt;br/&gt;
java.nio.BufferUnderflowException&lt;br/&gt;
    at java.nio.HeapByteBuffer.get(HeapByteBuffer.java:145)&lt;br/&gt;
    at java.nio.ByteBuffer.get(ByteBuffer.java:692)&lt;br/&gt;
    at org.apache.cassandra.db.RowMutationVerbHandler.doVerb(RowMutationVerbHandler.java:62)&lt;br/&gt;
    at org.apache.cassandra.net.MessageDeliveryTask.run(MessageDeliveryTask.java:50)&lt;br/&gt;
    at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1110)&lt;br/&gt;
    at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:603)&lt;br/&gt;
    at java.lang.Thread.run(Thread.java:636)&lt;br/&gt;
ERROR &lt;span class=&quot;error&quot;&gt;&amp;#91;MutationStage:2278&amp;#93;&lt;/span&gt; 2010-10-15 20:09:39,524 AbstractCassandraDaemon.java (line 88) Fatal exception in thread Thread&lt;span class=&quot;error&quot;&gt;&amp;#91;MutationStage:2278,5,main&amp;#93;&lt;/span&gt;&lt;br/&gt;
java.nio.BufferUnderflowException&lt;br/&gt;
    at java.nio.HeapByteBuffer.get(HeapByteBuffer.java:145)&lt;br/&gt;
    at java.nio.ByteBuffer.get(ByteBuffer.java:692)&lt;br/&gt;
    at org.apache.cassandra.db.RowMutationVerbHandler.doVerb(RowMutationVerbHandler.java:62)&lt;br/&gt;
    at org.apache.cassandra.net.MessageDeliveryTask.run(MessageDeliveryTask.java:50)&lt;br/&gt;
    at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1110)&lt;br/&gt;
    at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:603)&lt;br/&gt;
    at java.lang.Thread.run(Thread.java:636)&lt;/p&gt;</comment>
                            <comment id="12922356" author="brandon.williams" created="Mon, 18 Oct 2010 23:35:37 +0000"  >&lt;p&gt;In &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-1439&quot; title=&quot;OPP makes HH unhappy&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-1439&quot;&gt;&lt;del&gt;CASSANDRA-1439&lt;/del&gt;&lt;/a&gt;, we changed the hint destinations from fixed-length encoding to variable-length encoding (by converting UTF-8, to make OPP happy.)  We neglected to frame the message, however.  Patch adds framing and fixes a debug message that is broken.&lt;/p&gt;</comment>
                            <comment id="12922839" author="jbellis" created="Wed, 20 Oct 2010 03:35:09 +0000"  >&lt;p&gt;use FBUtilities.read/writeShortByteArray?&lt;/p&gt;</comment>
                            <comment id="12923044" author="brandon.williams" created="Wed, 20 Oct 2010 16:49:43 +0000"  >&lt;p&gt;Updated.&lt;/p&gt;</comment>
                            <comment id="12923064" author="jbellis" created="Wed, 20 Oct 2010 17:48:58 +0000"  >&lt;p&gt;writeshortbytearray applied to oldhint will create a new length &quot;frame,&quot; i think you just want to use out.writeFully(old) or something like that&lt;/p&gt;</comment>
                            <comment id="12923094" author="brandon.williams" created="Wed, 20 Oct 2010 18:55:27 +0000"  >&lt;p&gt;Good catch.  Updated to fix that, and name the oldHint variable more aptly so it&apos;s clearer why this is done.&lt;/p&gt;</comment>
                            <comment id="12923106" author="jbellis" created="Wed, 20 Oct 2010 19:13:49 +0000"  >&lt;p&gt;+1&lt;/p&gt;</comment>
                            <comment id="12923108" author="brandon.williams" created="Wed, 20 Oct 2010 19:18:31 +0000"  >&lt;p&gt;Committed.&lt;/p&gt;</comment>
                            <comment id="12923468" author="hudson" created="Thu, 21 Oct 2010 14:55:50 +0000"  >&lt;p&gt;Integrated in Cassandra #572 (See &lt;a href=&quot;https://hudson.apache.org/hudson/job/Cassandra/572/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://hudson.apache.org/hudson/job/Cassandra/572/&lt;/a&gt;)&lt;br/&gt;
    Add framing to hint destinations.  Patch by brandonwilliams, reviewed by jbellis for &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-1617&quot; title=&quot;BufferUnderflowException occurs in RowMutationVerbHandler&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-1617&quot;&gt;&lt;del&gt;CASSANDRA-1617&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12457691" name="1617.txt" size="3282" author="brandon.williams" created="Wed, 20 Oct 2010 18:55:27 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[brandon.williams]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>20219</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            15 years, 5 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0g6bz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>92456</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12962"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>