<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 22:41:51 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-6309] Pig CqlStorage generates  ERROR 1108: Duplicate schema alias</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-6309</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;In Pig after loading a simple CQL3 table from Cassandra 2.0.1, and dumping contents, I receive:&lt;br/&gt;
Caused by: org.apache.pig.impl.plan.PlanValidationException: ERROR 1108: Duplicate schema alias: author in &quot;cm&quot;&lt;/p&gt;

&lt;p&gt; cm = load &apos;cql://thunder_test/cassandra_messages&apos; USING CqlStorage;&lt;br/&gt;
 dump cm&lt;br/&gt;
ERROR org.apache.pig.tools.grunt.Grunt - org.apache.pig.impl.logicalLayer.FrontendException: ERROR 1066: Unable to open iterator for alias cm&lt;br/&gt;
...&lt;br/&gt;
Caused by: org.apache.pig.impl.plan.PlanValidationException: ERROR 1108: Duplicate schema alias: author in &quot;cm&quot;&lt;br/&gt;
        at org.apache.pig.newplan.logical.visitor.SchemaAliasVisitor.validate(SchemaAliasVisitor.java:75)&lt;/p&gt;


&lt;p&gt;running &apos;describe cm&apos; gives:&lt;br/&gt;
cm: &lt;/p&gt;
{message_id: chararray,author: chararray,author: chararray,body: chararray,message_id: chararray}

&lt;p&gt;The original table schema in Cassandra is:&lt;br/&gt;
CREATE TABLE cassandra_messages (&lt;br/&gt;
  message_id text,&lt;br/&gt;
  author text,&lt;br/&gt;
  body text,&lt;br/&gt;
  PRIMARY KEY (message_id, author)&lt;br/&gt;
) WITH&lt;br/&gt;
  bloom_filter_fp_chance=0.010000 AND&lt;br/&gt;
  caching=&apos;KEYS_ONLY&apos; AND&lt;br/&gt;
  comment=&apos;null&apos; AND&lt;br/&gt;
  dclocal_read_repair_chance=0.000000 AND&lt;br/&gt;
  gc_grace_seconds=864000 AND&lt;br/&gt;
  index_interval=128 AND&lt;br/&gt;
  read_repair_chance=0.100000 AND&lt;br/&gt;
  replicate_on_write=&apos;true&apos; AND&lt;br/&gt;
  populate_io_cache_on_flush=&apos;false&apos; AND&lt;br/&gt;
  default_time_to_live=0 AND&lt;br/&gt;
  speculative_retry=&apos;NONE&apos; AND&lt;br/&gt;
  memtable_flush_period_in_ms=0 AND&lt;br/&gt;
  compaction=&lt;/p&gt;
{&apos;class&apos;: &apos;SizeTieredCompactionStrategy&apos;}
&lt;p&gt; AND&lt;br/&gt;
  compression=&lt;/p&gt;
{&apos;sstable_compression&apos;: &apos;LZ4Compressor&apos;}
&lt;p&gt;;&lt;/p&gt;

&lt;p&gt;it appears that the code in CqlStorage.getColumnMetadata at ~line 478 takes the &quot;keys&quot; columns (in my case, message_id and author) and appends the columns from getColumnMeta (which has all three columns). Thus the keys columns are duplicated.&lt;/p&gt;
</description>
                <environment></environment>
        <key id="12677888">CASSANDRA-6309</key>
            <summary>Pig CqlStorage generates  ERROR 1108: Duplicate schema alias</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10002" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Normal</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="alexliu68">Alex Liu</assignee>
                                    <reporter username="thunderstumpges">Thunder Stumpges</reporter>
                        <labels>
                    </labels>
                <created>Wed, 6 Nov 2013 23:15:39 +0000</created>
                <updated>Tue, 16 Apr 2019 09:32:01 +0000</updated>
                            <resolved>Fri, 13 Dec 2013 17:42:47 +0000</resolved>
                                        <fixVersion>1.2.13</fixVersion>
                    <fixVersion>2.0.4</fixVersion>
                                        <due></due>
                            <votes>1</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="13815460" author="thunderstumpges" created="Wed, 6 Nov 2013 23:52:19 +0000"  >&lt;p&gt;just as a note, I&apos;m using code from the tip of the cassandra-2.0 branch. I&apos;m a little confused because the code which combines the list from &quot;getKeysMeta&quot; with that of &quot;getColumnMeta&quot; has been around a while. There was some refactoring of getKeysMeta recently, but not sure how that could have changed things. &lt;/p&gt;

&lt;p&gt;I have a naive patch which simply loops the columns in getColumnMeta and only adds them to &quot;keys&quot; collection if they don&apos;t already exist. Can add that as a patch if y&apos;all think that&apos;s an appropriate way to solve this thing.&lt;/p&gt;
</comment>
                            <comment id="13815473" author="alexliu68" created="Thu, 7 Nov 2013 00:04:25 +0000"  >&lt;p&gt;It works in 1.2 branch. It looks like some changes to table metadata implementation causes the issue.&lt;/p&gt;</comment>
                            <comment id="13816333" author="alexliu68" created="Thu, 7 Nov 2013 19:40:48 +0000"  >&lt;p&gt;The partition and cluster keys are added to system.schema_columns table, so to do a quick fix, we just ignore those columns as for now. When all other system_schema_* changes are done in the later release, we will make the final changes accordingly.&lt;/p&gt;</comment>
                            <comment id="13816388" author="alexliu68" created="Thu, 7 Nov 2013 20:26:58 +0000"  >&lt;p&gt;Some thrift column families tests are broken too&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;    [junit] Testcase: testCassandraStorageFullCopy(org.apache.cassandra.pig.ThriftColumnFamilyTest):	Caused an ERROR
    [junit] &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;
    [junit] NotFoundException()
    [junit] 	at org.apache.cassandra.thrift.Cassandra$get_result$get_resultStandardScheme.read(Cassandra.java:10059)
    [junit] 	at org.apache.cassandra.thrift.Cassandra$get_result$get_resultStandardScheme.read(Cassandra.java:1)
    [junit] 	at org.apache.cassandra.thrift.Cassandra$get_result.read(Cassandra.java:9942)
    [junit] 	at org.apache.thrift.TServiceClient.receiveBase(TServiceClient.java:78)
    [junit] 	at org.apache.cassandra.thrift.Cassandra$Client.recv_get(Cassandra.java:615)
    [junit] 	at org.apache.cassandra.thrift.Cassandra$Client.get(Cassandra.java:600)
    [junit] 	at org.apache.cassandra.pig.ThriftColumnFamilyTest.getColumnValue(ThriftColumnFamilyTest.java:808)
    [junit] 	at org.apache.cassandra.pig.ThriftColumnFamilyTest.testCassandraStorageFullCopy(ThriftColumnFamilyTest.java:392)
    [junit] 
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="13816467" author="alexliu68" created="Thu, 7 Nov 2013 21:50:35 +0000"  >&lt;p&gt;This turns out to be written path needs &quot;LOCAL_ONE&quot; be supported by Simple Strategy&lt;/p&gt;</comment>
                            <comment id="13816498" author="alexliu68" created="Thu, 7 Nov 2013 22:08:22 +0000"  >&lt;p&gt;If we can&apos;t get the patch for LOCAL_ONE write path in this ticket, I can post it to &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-6238&quot; title=&quot;LOCAL_ONE doesn&amp;#39;t work for SimpleStrategy&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-6238&quot;&gt;&lt;del&gt;CASSANDRA-6238&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13816813" author="thunderstumpges" created="Thu, 7 Nov 2013 23:48:31 +0000"  >&lt;p&gt;Thanks for the quick turn-around Alex! I appreciate it. The patch looks good to me. better than what I hacked together locally. And the patch for LOCAL_ONE I haven&apos;t run into because we&apos;re running 2.0.1 on our servers still, so I had to override my consistency for reads and writes to ONE anyway.&lt;/p&gt;

&lt;p&gt;thanks again!&lt;br/&gt;
Thunder&lt;/p&gt;</comment>
                            <comment id="13830285" author="brandon.williams" created="Fri, 22 Nov 2013 20:35:55 +0000"  >&lt;p&gt;Patch fixes the duplicate schema problem, but the thrift test fails.&lt;/p&gt;</comment>
                            <comment id="13830365" author="alexliu68" created="Fri, 22 Nov 2013 22:24:28 +0000"  >&lt;p&gt;V2 patch is attached, which fix the unit tests.&lt;/p&gt;</comment>
                            <comment id="13830372" author="brandon.williams" created="Fri, 22 Nov 2013 22:37:16 +0000"  >&lt;p&gt;v2 removes all the license headers from the new tests, can you rebase it?&lt;/p&gt;</comment>
                            <comment id="13830419" author="alexliu68" created="Fri, 22 Nov 2013 23:31:40 +0000"  >&lt;p&gt;&lt;a href=&quot;https://github.com/apache/cassandra/blob/cassandra-2.0/test/unit/org/apache/cassandra/pig/ThriftColumnFamilyDataTypeTest.java#L20&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/cassandra/blob/cassandra-2.0/test/unit/org/apache/cassandra/pig/ThriftColumnFamilyDataTypeTest.java#L20&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/apache/cassandra/blob/cassandra-2.0/test/unit/org/apache/cassandra/pig/CqlTableDataTypeTest.java#L20&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/cassandra/blob/cassandra-2.0/test/unit/org/apache/cassandra/pig/CqlTableDataTypeTest.java#L20&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;The patch removes the duplicate license header.&lt;/p&gt;</comment>
                            <comment id="13840586" author="alexliu68" created="Thu, 5 Dec 2013 21:20:56 +0000"  >&lt;p&gt;V3 patch is based on the latest 2.0 branch&lt;/p&gt;</comment>
                            <comment id="13840621" author="alexliu68" created="Thu, 5 Dec 2013 21:59:44 +0000"  >&lt;p&gt;6309-fix-pig-test-compiling.txt fixes the build issue for pig test&lt;/p&gt;
</comment>
                            <comment id="13840739" author="alexliu68" created="Fri, 6 Dec 2013 00:29:18 +0000"  >&lt;p&gt;Trunk bumped Pig version to 0.11.0, the pig unit tests fail&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;    [junit] ------------- ---------------- ---------------
    [junit] Testcase: testCqlStorageListType(org.apache.cassandra.pig.CqlTableDataTypeTest):	Caused an ERROR
    [junit] Unable to open iterator &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; alias list_rows
    [junit] org.apache.pig.impl.logicalLayer.FrontendException: ERROR 1066: Unable to open iterator &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; alias list_rows
    [junit] 	at org.apache.pig.PigServer.openIterator(PigServer.java:836)
    [junit] 	at org.apache.cassandra.pig.CqlTableDataTypeTest.testCqlStorageListType(CqlTableDataTypeTest.java:332)
    [junit] Caused by: org.apache.pig.PigException: ERROR 1002: Unable to store alias list_rows
    [junit] 	at org.apache.pig.PigServer.storeEx(PigServer.java:935)
    [junit] 	at org.apache.pig.PigServer.store(PigServer.java:898)
    [junit] 	at org.apache.pig.PigServer.openIterator(PigServer.java:811)
    [junit] Caused by: org.apache.pig.backend.hadoop.executionengine.mapReduceLayer.JobCreationException: ERROR 2017: Internal error creating job configuration.
    [junit] 	at org.apache.pig.backend.hadoop.executionengine.mapReduceLayer.JobControlCompiler.getJob(JobControlCompiler.java:848)
    [junit] 	at org.apache.pig.backend.hadoop.executionengine.mapReduceLayer.JobControlCompiler.compile(JobControlCompiler.java:294)
    [junit] 	at org.apache.pig.backend.hadoop.executionengine.mapReduceLayer.MapReduceLauncher.launchPig(MapReduceLauncher.java:177)
    [junit] 	at org.apache.pig.PigServer.launchPlan(PigServer.java:1264)
    [junit] 	at org.apache.pig.PigServer.executeCompiledLogicalPlan(PigServer.java:1249)
    [junit] 	at org.apache.pig.PigServer.storeEx(PigServer.java:931)
    [junit] Caused by: java.io.IOException: Serialization error: org.apache.log4j.Level
    [junit] 	at org.apache.pig.impl.util.ObjectSerializer.serialize(ObjectSerializer.java:47)
    [junit] 	at org.apache.pig.backend.hadoop.executionengine.mapReduceLayer.JobControlCompiler.getJob(JobControlCompiler.java:526)
    [junit] Caused by: java.io.NotSerializableException: org.apache.log4j.Level
    [junit] 	at java.io.ObjectOutputStream.writeObject0(ObjectOutputStream.java:1180)
    [junit] 	at java.io.ObjectOutputStream.defaultWriteFields(ObjectOutputStream.java:1528)
    [junit] 	at java.io.ObjectOutputStream.writeSerialData(ObjectOutputStream.java:1493)
    [junit] 	at java.io.ObjectOutputStream.writeOrdinaryObject(ObjectOutputStream.java:1416)
    [junit] 	at java.io.ObjectOutputStream.writeObject0(ObjectOutputStream.java:1174)
    [junit] 	at java.io.ObjectOutputStream.writeObject(ObjectOutputStream.java:346)
    [junit] 	at org.apache.pig.impl.util.ObjectSerializer.serialize(ObjectSerializer.java:43)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="13844824" author="alexliu68" created="Tue, 10 Dec 2013 23:38:48 +0000"  >&lt;p&gt;It looks like logback replacing log4j causes the issue. I updated Pig to 0.11.1 on cassandra-2.0 branch and the pig unit tests passed.&lt;/p&gt;</comment>
                            <comment id="13845048" author="alexliu68" created="Wed, 11 Dec 2013 03:55:02 +0000"  >&lt;p&gt;6309-trunk-branch.txt is on tunk, which changes the build.xml to only add runtime log4j lib to pig-test, other tests stay with logback.&lt;/p&gt;</comment>
                            <comment id="13847703" author="brandon.williams" created="Fri, 13 Dec 2013 17:42:47 +0000"  >&lt;p&gt;Committed.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12612718" name="6309-2.0.txt" size="4145" author="alexliu68" created="Thu, 7 Nov 2013 22:07:05 +0000"/>
                            <attachment id="12617246" name="6309-fix-pig-test-compiling.txt" size="324" author="alexliu68" created="Thu, 5 Dec 2013 21:58:14 +0000"/>
                            <attachment id="12618187" name="6309-trunk-branch.txt" size="34619" author="alexliu68" created="Wed, 11 Dec 2013 05:27:26 +0000"/>
                            <attachment id="12615395" name="6309-v2-2.0-branch.txt" size="18139" author="alexliu68" created="Fri, 22 Nov 2013 22:20:32 +0000"/>
                            <attachment id="12617243" name="6309-v3.txt" size="19597" author="alexliu68" created="Thu, 5 Dec 2013 21:20:56 +0000"/>
                            <attachment id="12615396" name="LOCAL_ONE-write-for-all-strategies-v2.txt" size="572" author="alexliu68" created="Fri, 22 Nov 2013 22:20:32 +0000"/>
                            <attachment id="12612719" name="LOCAL_ONE-write-for-all-strategies.txt" size="717" author="alexliu68" created="Thu, 7 Nov 2013 22:07:05 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>7.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[alexliu68]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>357263</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            11 years, 49 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1pl7j:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>357553</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>brandon.williams</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[brandon.williams]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12962"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>