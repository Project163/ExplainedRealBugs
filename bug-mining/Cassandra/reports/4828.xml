<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 23:08:21 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-13067] Integer overflows with file system size reported by Amazon Elastic File System (EFS)</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-13067</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;When not explicitly configured Cassandra uses &lt;a href=&quot;https://docs.oracle.com/javase/7/docs/api/java/nio/file/FileStore.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;&lt;tt&gt;nio.FileStore.getTotalSpace&lt;/tt&gt;&lt;/a&gt; to determine the total amount of available space in order to &lt;a href=&quot;https://github.com/apache/cassandra/blob/cassandra-3.9/src/java/org/apache/cassandra/config/DatabaseDescriptor.java#L553&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;calculate the preferred commit log size&lt;/a&gt;. &lt;a href=&quot;https://aws.amazon.com/efs/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;Amazon EFS&lt;/a&gt; instances report a filesystem size of 8 EiB when empty. &lt;a href=&quot;https://bugs.openjdk.java.net/browse/JDK-8162520&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;&lt;tt&gt;getTotalSpace&lt;/tt&gt; causes an integer overflow (JDK-8162520)&lt;/a&gt; and returns a negative number, resulting in a negative preferred size and causing the checked integer to throw.&lt;/p&gt;

&lt;p&gt;Overriding &lt;tt&gt;commitlog_total_space_in_mb&lt;/tt&gt; is not sufficient as &lt;a href=&quot;https://github.com/apache/cassandra/blob/cassandra-3.9/src/java/org/apache/cassandra/db/Directories.java#L550&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;&lt;tt&gt;DataDirectory.getAvailableSpace&lt;/tt&gt;&lt;/a&gt; makes use of &lt;tt&gt;nio.FileStore.getUsableSpace&lt;/tt&gt;.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-6441&quot; title=&quot;Incorrect File System Size Reported with Amazon Elastic File System (EFS)&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AMQ-6441&quot;&gt;&lt;del&gt;AMQ-6441&lt;/del&gt;&lt;/a&gt; is a comparable issue in ActiveMQ.&lt;/p&gt;</description>
                <environment>&lt;p&gt;Cassandra in OpenShift running on Amazon EC2 instance with EFS mounted for data&lt;/p&gt;</environment>
        <key id="13029798">CASSANDRA-13067</key>
            <summary>Integer overflows with file system size reported by Amazon Elastic File System (EFS)</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10002" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Normal</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="blerer">Benjamin Lerer</assignee>
                                    <reporter username="hansmi">Michael Hanselmann</reporter>
                        <labels>
                    </labels>
                <created>Wed, 21 Dec 2016 15:53:10 +0000</created>
                <updated>Fri, 15 May 2020 07:59:32 +0000</updated>
                            <resolved>Tue, 8 Aug 2017 15:18:03 +0000</resolved>
                                        <fixVersion>2.2.11</fixVersion>
                    <fixVersion>3.0.15</fixVersion>
                    <fixVersion>3.11.1</fixVersion>
                    <fixVersion>4.0-alpha1</fixVersion>
                    <fixVersion>4.0</fixVersion>
                                    <component>Legacy/Core</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>7</watches>
                                                                                                                <comments>
                            <comment id="15860191" author="mwringe" created="Thu, 9 Feb 2017 20:54:17 +0000"  >&lt;p&gt;This also affects the 3.0 branch: &lt;a href=&quot;https://github.com/apache/cassandra/blob/cassandra-3.0/src/java/org/apache/cassandra/config/DatabaseDescriptor.java#L538&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/cassandra/blob/cassandra-3.0/src/java/org/apache/cassandra/config/DatabaseDescriptor.java#L538&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Is anyone looking into this?&lt;/p&gt;</comment>
                            <comment id="15860230" author="jjirsa" created="Thu, 9 Feb 2017 21:29:29 +0000"  >&lt;p&gt;Not assigned - nobody&apos;s currently looking at it. Patches are welcome, though.&lt;/p&gt;</comment>
                            <comment id="15876557" author="mwringe" created="Tue, 21 Feb 2017 19:34:44 +0000"  >&lt;p&gt;Patch to handle the situation where the filesystem is too large and Java returns negative file sizes.&lt;/p&gt;</comment>
                            <comment id="15876560" author="mwringe" created="Tue, 21 Feb 2017 19:35:37 +0000"  >&lt;p&gt;I attached a patch to this issue which resolves this issue for me. What is the best way to contribute to the Cassandra project? Just attach the patch to the bugzilla? mailing list? PRs for your mirrored github account?&lt;/p&gt;
</comment>
                            <comment id="15876632" author="jjirsa" created="Tue, 21 Feb 2017 20:22:01 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mwringe&quot; class=&quot;user-hover&quot; rel=&quot;mwringe&quot;&gt;mwringe&lt;/a&gt; - attaching a patch works, the actual process is JIRA only (can&apos;t merge from GH to ASF repo, so the actual workflow is jira -&amp;gt; asf via manual committer merging).  &lt;a href=&quot;http://cassandra.apache.org/doc/latest/development/patches.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://cassandra.apache.org/doc/latest/development/patches.html&lt;/a&gt; describes the process for contributors. If your patch merges cleanly for relevant affected branches, then simply uploading one patch as you&apos;ve done is sufficient.&lt;/p&gt;

</comment>
                            <comment id="15945996" author="mwringe" created="Tue, 28 Mar 2017 21:28:20 +0000"  >&lt;p&gt;I see that I am assigned to this issue, but I don&apos;t know what I can do to get this patch accepted. Any starters on what I need to be doing here?&lt;/p&gt;</comment>
                            <comment id="15946007" author="jjirsa" created="Tue, 28 Mar 2017 21:35:50 +0000"  >&lt;p&gt;I&apos;ve assigned it to you, since you wrote the patch. Ultimately we need to review it  and run it through unit and distributed tests - I suspect the delay is that few reviewers/committers have an account with EFS handy to test. &lt;/p&gt;</comment>
                            <comment id="16034648" author="blerer" created="Fri, 2 Jun 2017 13:06:50 +0000"  >&lt;p&gt;I had a look at the patch and I wonder if it will not be more bulletproof to decorate the &lt;tt&gt;FileStore&lt;/tt&gt; returned by &lt;tt&gt;guessFileStore&lt;/tt&gt;. The decorator could make sure that the values returned by &lt;tt&gt;getTotalSpace&lt;/tt&gt;, &lt;tt&gt;getUnallocatedSpace&lt;/tt&gt; and &lt;tt&gt;getUsableSpace&lt;/tt&gt; are valid one.&lt;br/&gt;
The advantage will be that if somebody need to add another method that use &lt;tt&gt;guessFileStore&lt;/tt&gt; it will not re-introduce the problem.&lt;br/&gt;
I would put that decorator in &lt;tt&gt;org.apache.cassandra.io.util&lt;/tt&gt; so that it can be reused somewhere else in the code if needed.&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mwringe&quot; class=&quot;user-hover&quot; rel=&quot;mwringe&quot;&gt;mwringe&lt;/a&gt; what do you think?&lt;/p&gt;</comment>
                            <comment id="16037017" author="mwringe" created="Mon, 5 Jun 2017 14:15:12 +0000"  >&lt;p&gt;That seems like an acceptable solution to me. I am fine with whatever allows us to get this patch committed upstream so that we don&apos;t have to continue to carry it ourselves.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=blerer&quot; class=&quot;user-hover&quot; rel=&quot;blerer&quot;&gt;blerer&lt;/a&gt; is this something you can take care of yourself? or are you expecting an updated patch from me?&lt;/p&gt;</comment>
                            <comment id="16038304" author="blerer" created="Tue, 6 Jun 2017 07:31:36 +0000"  >&lt;blockquote&gt;&lt;p&gt;is this something you can take care of yourself? or are you expecting an updated patch from me?&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;As the ticket is assign to you, I was waiting for you. If you do not have time, I can also take over. It is up to you. &lt;/p&gt;</comment>
                            <comment id="16038890" author="mwringe" created="Tue, 6 Jun 2017 13:31:29 +0000"  >&lt;p&gt;If you could take over that would be a huge help. Thanks&lt;/p&gt;</comment>
                            <comment id="16061192" author="blerer" created="Fri, 23 Jun 2017 16:36:45 +0000"  >&lt;p&gt;I pushed some new patches for &lt;a href=&quot;https://github.com/apache/cassandra/compare/trunk...blerer:13067-2.2&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;2.2&lt;/a&gt;,  &lt;a href=&quot;https://github.com/apache/cassandra/compare/trunk...blerer:13067-3.0&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;3.0&lt;/a&gt; and &lt;a href=&quot;https://github.com/apache/cassandra/compare/trunk...blerer:13067-3.11&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;3.11&lt;/a&gt;. I ran the tests for &lt;tt&gt;2.2&lt;/tt&gt;, &lt;tt&gt;3.0&lt;/tt&gt;, &lt;tt&gt;3.11&lt;/tt&gt; and &lt;tt&gt;trunk&lt;/tt&gt; on our internal CI. There are no unit tests failures and the DTests failures are unrelated to the changes.&lt;/p&gt;

&lt;p&gt;The patch handle the &lt;a href=&quot;https://bugs.openjdk.java.net/browse/JDK-8162520&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;JDK-8162520&lt;/a&gt; and &lt;a href=&quot;https://bugs.openjdk.java.net/browse/JDK-8179320&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;JDK-8179320&lt;/a&gt; problems by providing safe methods within &lt;tt&gt;FileUtils&lt;/tt&gt; to create a safe &lt;tt&gt;FileStore&lt;/tt&gt; or retrieve the &lt;tt&gt;totalSpace&lt;/tt&gt;, &lt;tt&gt;freeSpace&lt;/tt&gt; or &lt;tt&gt;usableSpace&lt;/tt&gt;.&lt;br/&gt;
If one value overflow, &lt;tt&gt;Long.MAX_VALUE&lt;/tt&gt; will be returned instead of the negative value.&lt;br/&gt;
I considered returning a &lt;tt&gt;BigInteger&lt;/tt&gt; but finally decided to keep the changes  as small as possible.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ifesdjeen&quot; class=&quot;user-hover&quot; rel=&quot;ifesdjeen&quot;&gt;ifesdjeen&lt;/a&gt; could you review?&lt;/p&gt;</comment>
                            <comment id="16118013" author="ifesdjeen" created="Tue, 8 Aug 2017 08:00:50 +0000"  >&lt;p&gt;Thank you for the patch and sorry it took me so long.&lt;/p&gt;

&lt;p&gt;+1, LGTM. Tests look good as well.&lt;/p&gt;</comment>
                            <comment id="16118457" author="blerer" created="Tue, 8 Aug 2017 15:18:04 +0000"  >&lt;p&gt;Committed into 2.2 at 270f690ff6047cc3e797a3f34b7efa26e7232183 and merged into 3.0, 3.11 and trunk&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="13007166">AMQ-6441</issuekey>
        </issuelink>
                            </outwardlinks>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="13097643">CASSANDRA-13808</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12853795" name="0001-Handle-exabyte-sized-filesystems.patch" size="3610" author="mwringe" created="Tue, 21 Feb 2017 19:34:44 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[blerer]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 15 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i37vtr:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12311421" key="com.atlassian.jira.plugin.system.customfieldtypes:multiversion">
                        <customfieldname>Reproduced In</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="12335581">2.2.7</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>ifesdjeen</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[ifesdjeen]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12962"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>