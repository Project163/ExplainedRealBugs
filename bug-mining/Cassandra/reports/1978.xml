<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 22:36:46 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-5127] unsafeAssassinateEndpoint throws NullPointerException and fails to remove node from gossip</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-5127</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;unsafeAssassinateEndpoint() throws NullPointerException and the node still seems to be in gossip. &lt;/p&gt;

&lt;p&gt;gossip info for node in question:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;/10.8.30.15
  HOST_ID:d84a5632-d6d5-4b06-8e1b-ae39ab185ca1
  RPC_ADDRESS:0.0.0.0
  RACK:RAC1
  DC:DC1
  REMOVAL_COORDINATOR:REMOVER,b63fe173-5d13-4905-a59f-a78790f4f980
  RELEASE_VERSION:1.2.0
  NET_VERSION:6
  LOAD:2.64185473948E11
  STATUS:removed,d84a5632-d6d5-4b06-8e1b-ae39ab185ca1,1357874470406
  SCHEMA:5cd8420d-ce3c-3625-8293-67558a24816b
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;ERROR 19:26:20,078 Exception in thread &lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;[GossipStage:1,5,main]
java.lang.NullPointerException
	at org.apache.cassandra.service.StorageService.getApplicationStateValue(StorageService.java:1192)
	at org.apache.cassandra.service.StorageService.getTokensFor(StorageService.java:1200)
	at org.apache.cassandra.service.StorageService.handleStateLeft(StorageService.java:1452)
	at org.apache.cassandra.service.StorageService.onChange(StorageService.java:1163)
	at org.apache.cassandra.service.StorageService.onJoin(StorageService.java:1895)
	at org.apache.cassandra.gms.Gossiper.handleMajorStateChange(Gossiper.java:805)
	at org.apache.cassandra.gms.Gossiper.applyStateLocally(Gossiper.java:856)
	at org.apache.cassandra.gms.GossipDigestAckVerbHandler.doVerb(GossipDigestAckVerbHandler.java:57)
	at org.apache.cassandra.net.MessageDeliveryTask.run(MessageDeliveryTask.java:56)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1110)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:603)
	at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:722)

&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment>&lt;p&gt;Ubuntu 12.04&lt;/p&gt;</environment>
        <key id="12626481">CASSANDRA-5127</key>
            <summary>unsafeAssassinateEndpoint throws NullPointerException and fails to remove node from gossip</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10002" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Normal</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="brandon.williams">Brandon Williams</assignee>
                                    <reporter username="mkjellman">Michael Kjellman</reporter>
                        <labels>
                    </labels>
                <created>Tue, 8 Jan 2013 03:28:24 +0000</created>
                <updated>Tue, 16 Apr 2019 09:32:20 +0000</updated>
                            <resolved>Tue, 8 Jan 2013 19:26:56 +0000</resolved>
                                        <fixVersion>1.2.1</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="13546644" author="brandon.williams" created="Tue, 8 Jan 2013 06:16:31 +0000"  >&lt;p&gt;This is because there is no TOKENS state for a non-vnode host in 1.2.  Mostly saying this for myself so I don&apos;t forget what to do tomorrow.&lt;/p&gt;</comment>
                            <comment id="13546948" author="brandon.williams" created="Tue, 8 Jan 2013 15:37:55 +0000"  >&lt;p&gt;Hmm, to clarify, the stacktrace you&apos;re posting is from a node receiving the assassinate attempt? Because that stack doesn&apos;t point at uAE itself.&lt;/p&gt;</comment>
                            <comment id="13546949" author="mkjellman" created="Tue, 8 Jan 2013 15:41:02 +0000"  >&lt;p&gt;node i&apos;m trying to assassinate is down. Stacktrace is from the node I executed uAE on.&lt;/p&gt;</comment>
                            <comment id="13546952" author="mkjellman" created="Tue, 8 Jan 2013 15:44:14 +0000"  >&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt; WARN [RMI TCP Connection(3166)-10.8.240.170] 2013-01-08 07:42:02,143 Gossiper.java (line 419) Assassinating /10.8.30.15 via gossip
 INFO [RMI TCP Connection(3166)-10.8.240.170] 2013-01-08 07:42:02,144 Gossiper.java (line 434) Sleeping &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; 30000ms to ensure /10.8.30.15 does not change
 INFO [RMI TCP Connection(3166)-10.8.240.170] 2013-01-08 07:42:32,416 Gossiper.java (line 767) InetAddress /10.8.30.15 is now dead.
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;so that looks okay.&lt;/p&gt;

&lt;p&gt;jconsole threw &quot;Problem invoking unsafeAssassinateEndpoint: java.lang.NullPointerException&quot;&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;/10.8.30.15
  DC:DC1
  SCHEMA:5cd8420d-ce3c-3625-8293-67558a24816b
  RELEASE_VERSION:1.2.0
  REMOVAL_COORDINATOR:REMOVER,b63fe173-5d13-4905-a59f-a78790f4f980
  LOAD:2.64185473948E11
  STATUS:LEFT,1357918952416,21210815907080254728491917739023519863
  RPC_ADDRESS:0.0.0.0
  NET_VERSION:6
  HOST_ID:d84a5632-d6d5-4b06-8e1b-ae39ab185ca1
  RACK:RAC1
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;


&lt;p&gt;node is still in gossipinfo though..&lt;/p&gt;

&lt;p&gt;I assumed that stack trace which happened at the same time correlated to the npe.&lt;/p&gt;</comment>
                            <comment id="13546955" author="mkjellman" created="Tue, 8 Jan 2013 15:48:06 +0000"  >&lt;p&gt;logs from another node in the cluster (aka didn&apos;t execute the jmx call and is not the downed node.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt; INFO [GossipStage:1] 2013-01-08 07:42:33,258 Gossiper.java (line 767) InetAddress /10.8.30.15 is now dead.
ERROR [GossipStage:1] 2013-01-08 07:42:33,267 CassandraDaemon.java (line 133) Exception in thread &lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;[GossipStage:1,5,main]
java.lang.NullPointerException
        at org.apache.cassandra.service.StorageService.getApplicationStateValue(StorageService.java:1192)
        at org.apache.cassandra.service.StorageService.getTokensFor(StorageService.java:1200)
        at org.apache.cassandra.service.StorageService.handleStateLeft(StorageService.java:1452)
        at org.apache.cassandra.service.StorageService.onChange(StorageService.java:1163)
        at org.apache.cassandra.service.StorageService.onJoin(StorageService.java:1895)
        at org.apache.cassandra.gms.Gossiper.handleMajorStateChange(Gossiper.java:805)
        at org.apache.cassandra.gms.Gossiper.applyStateLocally(Gossiper.java:856)
        at org.apache.cassandra.gms.GossipDigestAckVerbHandler.doVerb(GossipDigestAckVerbHandler.java:57)
        at org.apache.cassandra.net.MessageDeliveryTask.run(MessageDeliveryTask.java:56)
        at java.util.concurrent.ThreadPoolExecutor$Worker.runTask(ThreadPoolExecutor.java:886)
        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:908)
        at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:662)
ERROR [GossipStage:2] 2013-01-08 07:42:35,274 CassandraDaemon.java (line 133) Exception in thread &lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;[GossipStage:2,5,main]
java.lang.NullPointerException
        at org.apache.cassandra.service.StorageService.getApplicationStateValue(StorageService.java:1192)
        at org.apache.cassandra.service.StorageService.getTokensFor(StorageService.java:1200)
        at org.apache.cassandra.service.StorageService.handleStateLeft(StorageService.java:1452)
        at org.apache.cassandra.service.StorageService.onChange(StorageService.java:1163)
        at org.apache.cassandra.gms.Gossiper.doNotifications(Gossiper.java:917)
        at org.apache.cassandra.gms.Gossiper.applyNewStates(Gossiper.java:908)
        at org.apache.cassandra.gms.Gossiper.applyStateLocally(Gossiper.java:866)
        at org.apache.cassandra.gms.GossipDigestAckVerbHandler.doVerb(GossipDigestAckVerbHandler.java:57)
        at org.apache.cassandra.net.MessageDeliveryTask.run(MessageDeliveryTask.java:56)
        at java.util.concurrent.ThreadPoolExecutor$Worker.runTask(ThreadPoolExecutor.java:886)
        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:908)
        at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:662)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="13546959" author="brandon.williams" created="Tue, 8 Jan 2013 15:53:17 +0000"  >&lt;p&gt;There are a few cases where we assume that if a host has a HOST_ID, then it must use vnodes, but that is not the case.  Patch attached to refactor these cases into a usesVnodes method which checks for both HOST_ID and TOKENS.&lt;/p&gt;</comment>
                            <comment id="13547052" author="slebresne" created="Tue, 8 Jan 2013 17:52:59 +0000"  >&lt;p&gt;Agreed on the analysis, but I&apos;d rather hide this directly in getTokenFor (i.e. replace the &apos;&lt;tt&gt;if vnodes then getTokensFor else TokenFactory.fromString(pieces&lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt;)&lt;/tt&gt;&apos; by &apos;&lt;tt&gt;getTokenFor(endpoing, pieces&lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt;)&lt;/tt&gt;&apos; and handle the backward compatibility inside getTokenFor.&lt;/p&gt;

&lt;p&gt;In particular, and though that&apos;s a nit, I&apos;m not of fan of have a usesVnodes method because if I&apos;m not mistaken any upgraded would have this method return true even if only one token is used, right? If so, I&apos;m afraid the method would be misleading. &lt;/p&gt;</comment>
                            <comment id="13547094" author="brandon.williams" created="Tue, 8 Jan 2013 18:33:54 +0000"  >&lt;p&gt;v2 consolidates everything into getTokensFor.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;I&apos;m not of fan of have a usesVnodes method because if I&apos;m not mistaken any upgraded would have this method return true even if only one token is used&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Not quite, to have the TOKENS app state you must be on vnodes.  If there&apos;s only one token it&apos;s handled the old, ugly way by splitting the STATUS state.&lt;/p&gt;</comment>
                            <comment id="13547140" author="slebresne" created="Tue, 8 Jan 2013 19:21:06 +0000"  >&lt;p&gt;+1 on v2, though I still don&apos;t like the usesVnodes method name (basically I don&apos;t want anyone starting to use it for anything else than what getTokenFor is doing, which for me qualify as &apos;it shouldn&apos;t exist&apos;) but that&apos;s a nit.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;If there&apos;s only one token it&apos;s handled the old, ugly way by splitting the STATUS state.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I would suggest handling the one token case by feeding both the STATUS state &lt;b&gt;and&lt;/b&gt; the new TOKENS state so that in some future version we can just remove the STATUS old ugly way, but that&apos;s work for another ticket in any case.&lt;/p&gt;</comment>
                            <comment id="13547152" author="brandon.williams" created="Tue, 8 Jan 2013 19:26:56 +0000"  >&lt;p&gt;Committed&lt;/p&gt;</comment>
                            <comment id="13547377" author="mkjellman" created="Tue, 8 Jan 2013 23:04:01 +0000"  >&lt;p&gt;+1, confirmed that the patch resolves the issue&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12563790" name="5127-v2.txt" size="4681" author="brandon.williams" created="Tue, 8 Jan 2013 18:32:17 +0000"/>
                            <attachment id="12563766" name="5127.txt" size="3017" author="brandon.williams" created="Tue, 8 Jan 2013 15:53:17 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[brandon.williams]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>303088</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            12 years, 45 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i177uv:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>250241</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>slebresne</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[slebresne]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12962"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>