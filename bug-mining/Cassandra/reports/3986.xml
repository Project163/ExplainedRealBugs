<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 22:59:45 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-10690] Remove unclear indexes() method from 2ndary index API</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-10690</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;The new secondary index API does not notify indexes of single-row or slice deletions unless specific columns are deleted.  I believe the problem is that in &lt;tt&gt;SecondaryIndexManager.newUpdateTransaction()&lt;/tt&gt;, we skip indexes unless &lt;tt&gt;index.indexes(update.columns())&lt;/tt&gt;.  When no columns are specified in the the deletion, &lt;tt&gt;update.columns()&lt;/tt&gt; is empty, which causes all indexes to be skipped.&lt;/p&gt;

&lt;p&gt;I think the correct fix is to do something like this in the &lt;tt&gt;ModificationStatement&lt;/tt&gt; constructor:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (type == StatementType.DELETE &amp;amp;&amp;amp; modifiedColumns.isEmpty())
    modifiedColumns = cfm.partitionColumns();
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;However, I&apos;m not sure if that may have unintended side-effects.  What do you think, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=slebresne&quot; class=&quot;user-hover&quot; rel=&quot;slebresne&quot;&gt;slebresne&lt;/a&gt;?&lt;/p&gt;</description>
                <environment></environment>
        <key id="12912276">CASSANDRA-10690</key>
            <summary>Remove unclear indexes() method from 2ndary index API</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10002" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Normal</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="slebresne">Sylvain Lebresne</assignee>
                                    <reporter username="thobbs">Tom Hobbs</reporter>
                        <labels>
                    </labels>
                <created>Wed, 11 Nov 2015 19:54:15 +0000</created>
                <updated>Tue, 14 Oct 2025 12:13:58 +0000</updated>
                            <resolved>Thu, 3 Dec 2015 14:04:18 +0000</resolved>
                                        <fixVersion>3.0.1</fixVersion>
                    <fixVersion>3.1</fixVersion>
                                    <component>Legacy/Local Write-Read Paths</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>7</watches>
                                                                                                                <comments>
                            <comment id="15001001" author="thobbs" created="Wed, 11 Nov 2015 20:11:32 +0000"  >&lt;p&gt;By the way, this doesn&apos;t visibly affect the built-in secondary indexes due to stale entry handling.  However, it will negatively affect performance for indexes on regularly-deleted columns.  Additionally, this may break custom secondary indexes entirely.&lt;/p&gt;</comment>
                            <comment id="15001067" author="thobbs" created="Wed, 11 Nov 2015 20:52:03 +0000"  >&lt;p&gt;It looks like this bug was introduced by &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-10220&quot; title=&quot;Memtables do not handle column changes for their PartitionColumns&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-10220&quot;&gt;&lt;del&gt;CASSANDRA-10220&lt;/del&gt;&lt;/a&gt; (commit &lt;tt&gt;c3bc85641bc3297d151cdd983666544dd240f941&lt;/tt&gt;).&lt;/p&gt;</comment>
                            <comment id="15009012" author="slebresne" created="Tue, 17 Nov 2015 16:57:37 +0000"  >&lt;p&gt;I don&apos;t think there is a bug (but some cleanup is probably in order).&lt;/p&gt;

&lt;p&gt;If your index cares about range or row deletions, then it&apos;s &lt;tt&gt;indexes(PartitionColumns)&lt;/tt&gt; implementation should always return &lt;tt&gt;true&lt;/tt&gt;.  That&apos;s what our built-in primary-key-column indexes do in particular.&lt;/p&gt;

&lt;p&gt;I can definitively agree that the naming of that &lt;tt&gt;indexes(PartitionColumns)&lt;/tt&gt; method is confusing. What it really does is say whether the index is interested by an update having the &lt;tt&gt;PartitionColumns&lt;/tt&gt; passed in argument. But, because &lt;tt&gt;PartitionColumns&lt;/tt&gt; only tells you about whether regular and static columns are explicitely set, this isn&apos;t really related to the index actually indexing one of those column or not and the name is confusing.&lt;/p&gt;

&lt;p&gt;In fact, I think that whole method intent is a bit hard to grasps: it&apos;s given a list of columns, but it&apos;s not really representative of the whole update (even if it&apos;s empty, you can still have insert of row where only the PK columns are set, and all kind of deletions). As such, most implementation will probably want to always return true and the fact we can optimize this for built-in index is a bit of a subtle detail. For that reason, I&apos;m actually not able to come up with a name that is meaningful, and that suggest to me that we should get rid of it. The behavior of avoiding the creation of a an &lt;tt&gt;Indexer&lt;/tt&gt; object is still useful, but I propose to make that part of &lt;tt&gt;indexerFor&lt;/tt&gt; by passing it the updated columns and allowing a &lt;tt&gt;null&lt;/tt&gt; return. Mainly, I think that makes is easier for custom indexes to mess that up. The patch for that is &lt;a href=&quot;https://github.com/pcmanus/cassandra/commits/10690&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;here&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="15009895" author="thobbs" created="Wed, 18 Nov 2015 00:12:11 +0000"  >&lt;p&gt;Overall, I think your patch is an improvement to the clarity of the API, and your explanation makes sense.  However, since the &lt;tt&gt;Index&lt;/tt&gt; interface is a somewhat public API, I don&apos;t think we should make breaking changes to it in 3.0.1 or 3.1, especially since there technically isn&apos;t a bug.  Instead, we should deprecate the &lt;tt&gt;indexes()&lt;/tt&gt; method and make the change in 3.2.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=beobal&quot; class=&quot;user-hover&quot; rel=&quot;beobal&quot;&gt;beobal&lt;/a&gt; may also want to weigh in on this.&lt;/p&gt;</comment>
                            <comment id="15010462" author="slebresne" created="Wed, 18 Nov 2015 08:27:02 +0000"  >&lt;blockquote&gt;&lt;p&gt;the Index interface is a somewhat public API&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Meant to, but forgot to mention that. I&apos;m not too fussed about breaking that API right now cause it&apos;s brand new, 3.0 is so very new and adapting your custom index code to the change is trivial. But yes, it&apos;s a breaking change strictly speaking and I&apos;m totally fine only doing that in 3.2 if we prefer. &lt;/p&gt;</comment>
                            <comment id="15010476" author="beobal" created="Wed, 18 Nov 2015 08:31:39 +0000"  >&lt;p&gt;I&apos;m +1 with &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=thobbs&quot; class=&quot;user-hover&quot; rel=&quot;thobbs&quot;&gt;thobbs&lt;/a&gt;. It&apos;s an improvement to the API, but it sets a bad precedent if we make breaking changes to the interface in a bugfix version. Even though in this particular case the odds of it actually impacting anybody likely to be minimal.&lt;/p&gt;</comment>
                            <comment id="15011109" author="iamaleksey" created="Wed, 18 Nov 2015 14:44:07 +0000"  >&lt;p&gt;Can we do it in 3.2 in a breaking manner? We essentially promised with tick-tock that you&apos;d be able to upgrade from any 3.x to any 3.y, where x &amp;gt; y, and this goes against that.&lt;/p&gt;</comment>
                            <comment id="15011184" author="slebresne" created="Wed, 18 Nov 2015 15:23:18 +0000"  >&lt;p&gt;I&apos;ll give my very personal opinion for what it&apos;s worth: the 2ndary API has been entirely rewritten for 3.0 with a fair emphasis on custom indexes and, to the best of my knowledge, no realistic implementation using it has yet been finished. So I think it&apos;s silly to call that API anything else that a beta and we&apos;ll be lucky if this is the only &quot;problem&quot; found by people actually trying to use it in real life.&lt;/p&gt;

&lt;p&gt;So, &lt;em&gt;in theory&lt;/em&gt;, I agree that if we want to provide meaningful backward compatibility, then no (breaking) change should be done before 4.0. But in practice, I don&apos;t think promising compatibility on that API for a relatively long period of time when no-one has used/tried it yet is really a service to our users. So that I&apos;d personally prefer not trying to provide backward compatibility just yet and wait until it&apos;s been actually used to promise more than that (of course, we can still avoid doing change there for no good reason). Which is why I&apos;d be equally fine pushing in 3.1 than 3.2 really.&lt;/p&gt;

&lt;p&gt;But with that said, I don&apos;t really care all that much and if that opinion doesn&apos;t resonate and we prefer letting things as is and not changing anything until 4.0, so be it.&lt;/p&gt;</comment>
                            <comment id="15011203" author="iamaleksey" created="Wed, 18 Nov 2015 15:30:52 +0000"  >&lt;p&gt;Pragmatically, in this one particular case, yes. We&apos;ve done it multiple times before on my memory (.1 of 2.0 and/or 2.1, maybe even later in the game) where going by the rules we shouldn&apos;t have.&lt;/p&gt;

&lt;p&gt;Which is to say that I&apos;m fine with committing to 3.0.1/3.1 if we are putting this in 3.x at all (the sooner the change is visible, the better).&lt;/p&gt;

&lt;p&gt;But later (starting with 3.3? 3.5?) - once we stabilise, we should absolutely not break the rule.&lt;/p&gt;

&lt;p&gt;FWIW, we have &lt;b&gt;some&lt;/b&gt; freedom now with default interface method in Java 8, so that&apos;s something.&lt;/p&gt;
</comment>
                            <comment id="15011267" author="JIRAUSER308715" created="Wed, 18 Nov 2015 16:05:26 +0000"  >&lt;blockquote&gt;&lt;p&gt;&apos;ll give my very personal opinion for what it&apos;s worth: the 2ndary API has been entirely rewritten for 3.0 with a fair emphasis on custom indexes and, to the best of my knowledge, no realistic implementation using it has yet been finished. So I think it&apos;s silly to call that API anything else that a beta and we&apos;ll be lucky if this is the only &quot;problem&quot; found by people actually trying to use it in real life.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Agreed.  I think we should get this interface right now, and not leave something ambiguous in 3.0.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;But later (starting with 3.3? 3.5?) - once we stabilise, we should absolutely not break the rule.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Also agreed.  If we want to do this we need to do it now.&lt;/p&gt;</comment>
                            <comment id="15018254" author="beobal" created="Fri, 20 Nov 2015 16:30:02 +0000"  >&lt;p&gt;+1 on the patch, with 2 minuscule nits:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;Typo in the javadoc of &lt;tt&gt;Index::indexerFor&lt;/tt&gt; - s/partiticular/particular&lt;/li&gt;
	&lt;li&gt;I would also amend slightly the new comment in &lt;tt&gt;CassandraIndex::indexerFor&lt;/tt&gt; to make it clear that stale entries are actually removed from the index on read as well as during compaction.&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="15037816" author="slebresne" created="Thu, 3 Dec 2015 14:04:18 +0000"  >&lt;p&gt;Committed, thanks.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;I would also amend slightly the new comment in CassandraIndex::indexerFor to make it clear that stale entries are actually removed from the index on read as well as during compaction&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;That&apos;s what the 2nd part of the comment was explaining and I wasn&apos;t entirely sure how to clarify further, but feel free to ninja a change if some different phrasing sound clearer to you.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12859909">CASSANDRA-10220</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[slebresne]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 50 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2o9lb:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>samt</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[samt]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12962"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12311420" key="com.atlassian.jira.plugin.system.customfieldtypes:version">
                        <customfieldname>Since Version</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="12332955">3.0.0 rc1</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>