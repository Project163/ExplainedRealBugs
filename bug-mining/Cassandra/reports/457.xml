<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 22:16:44 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-1480] CFMetaData.convertToThrift makes subcomparator_type empty string instead of null</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-1480</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;As a result of &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-891&quot; title=&quot;Add ValidateWith to CF definitions&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-891&quot;&gt;&lt;del&gt;CASSANDRA-891&lt;/del&gt;&lt;/a&gt; adding a CFMetaData.convertToThrift method, the values such as subcomparator_type are defaulted to empty string instead of null.  That makes it so, for example, in ColumnFamilyRecordReader, in its RowIterator, the check for only null is insufficient.  It also needs to check for a blank value.&lt;/p&gt;

&lt;p&gt;After a discussion about it in IRC, Jonathan said it was probably easier to just change the creation to give a null value instead of empty string.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12473524">CASSANDRA-1480</key>
            <summary>CFMetaData.convertToThrift makes subcomparator_type empty string instead of null</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10002" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Normal</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="jhermes">Jon Hermes</assignee>
                                    <reporter username="jeromatron">Jeremy Hanna</reporter>
                        <labels>
                    </labels>
                <created>Wed, 8 Sep 2010 03:27:01 +0000</created>
                <updated>Tue, 16 Apr 2019 09:33:17 +0000</updated>
                            <resolved>Mon, 13 Sep 2010 19:22:51 +0000</resolved>
                                        <fixVersion>0.7 beta 2</fixVersion>
                                    <component>Legacy/CQL</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                                                                <comments>
                            <comment id="12908847" author="jhermes" created="Mon, 13 Sep 2010 16:19:16 +0000"  >&lt;p&gt;(This code is only touched in describe keyspace(s) in the API.)&lt;br/&gt;
Attaching a debugger shows the subcomparator_type of the result of the call to be null (as expected) until it gets sent, at which point the result is then converted to the empty string.&lt;br/&gt;
I&apos;m not sure when this behaviour changed, but it appears to be systemic and not a simple error.&lt;/p&gt;

&lt;p&gt;It would be less time to change the code to accept the empty string (which may come up naturally anyway) than it would be to continue debugging thrift.&lt;/p&gt;</comment>
                            <comment id="12908851" author="jeromatron" created="Mon, 13 Sep 2010 16:24:32 +0000"  >&lt;p&gt;I kind of wondered if it would be complicated like that based on how thrift handled it.  It&apos;s a one line change to fix it in ColumnFamilyRecordReader.  I didn&apos;t know if it would affect anything else similarly.  Hopefully system/unit tests catch a lot of that.  We could do some simple searches in the code for null checks I suppose - and in those cases, if they&apos;re strings, do a o.a.commons.lang.StringUtils.isNotBlank instead.  Not sure if it&apos;s worth it though since that could have other side effects.&lt;/p&gt;</comment>
                            <comment id="12908855" author="jhermes" created="Mon, 13 Sep 2010 16:41:10 +0000"  >&lt;p&gt;To pose a related question: assume the user sets the subcomparator_type (or the comparator or the validator or the default_validator) to the empty string. All perfectly legal, as the empty string is a valid string.&lt;br/&gt;
What should they expect to see? Right now it&apos;s a stack trace.&lt;/p&gt;</comment>
                            <comment id="12908875" author="jbellis" created="Mon, 13 Sep 2010 17:41:08 +0000"  >&lt;p&gt;This is not a bug; subcomparator_type has a default of &quot;&quot;, so if you leave it null (i.e., unspecified), it gets changed to its default.&lt;/p&gt;

&lt;p&gt;Removing the default should restore the old behavior.&lt;/p&gt;

&lt;p&gt;Defaults on reconciler and comment should also be removed.&lt;/p&gt;</comment>
                            <comment id="12908880" author="jhermes" created="Mon, 13 Sep 2010 17:52:01 +0000"  >&lt;p&gt;Massive palm to the face.&lt;br/&gt;
Testing now.&lt;/p&gt;</comment>
                            <comment id="12908924" author="jhermes" created="Mon, 13 Sep 2010 18:56:32 +0000"  >&lt;p&gt;convertToCFMetaData had to be changed as well, it was expecting subcomparator to default to empty string. I don&apos;t think this was a recent change; instead it looks more like we changed our assumption about the default.&lt;/p&gt;

&lt;p&gt;In any event, subcomp, reconciler, and comment all default to null now and all tests/methods are working correctly.&lt;/p&gt;</comment>
                            <comment id="12908942" author="jeromatron" created="Mon, 13 Sep 2010 19:14:34 +0000"  >&lt;p&gt;Ran the word count again with the 1480.txt patch.  It no longer gets the exception and completes properly now.&lt;/p&gt;</comment>
                            <comment id="12908952" author="jbellis" created="Mon, 13 Sep 2010 19:22:51 +0000"  >&lt;p&gt;committed&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12459051">CASSANDRA-891</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12472389">CASSANDRA-1425</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12454470" name="1480.txt" size="2181" author="jhermes" created="Mon, 13 Sep 2010 18:56:32 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[jhermes]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>20160</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            15 years, 11 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0g5bj:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>92292</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>jeromatron</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[jeromatron]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12962"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>