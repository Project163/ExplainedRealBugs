<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 23:12:11 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-14762] Transient node receives full data requests in dtests</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-14762</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;I saw this running them on my laptop with rapid write protection disabled. Attached is a patch for disabling rapid write protection in the transient dtests.&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;.Exception in thread Thread-19:
Traceback (most recent call last):
  File &quot;/usr/local/Cellar/python/3.6.4_4/Frameworks/Python.framework/Versions/3.6/lib/python3.6/threading.py&quot;, line 916, in _bootstrap_inner
    self.run()
  File &quot;/Users/aweisberg/repos/cassandra-dtest/venv/src/ccm/ccmlib/cluster.py&quot;, line 180, in run
    self.scan_and_report()
  File &quot;/Users/aweisberg/repos/cassandra-dtest/venv/src/ccm/ccmlib/cluster.py&quot;, line 173, in scan_and_report
    on_error_call(errordata)
  File &quot;/Users/aweisberg/repos/cassandra-dtest/dtest_setup.py&quot;, line 137, in _log_error_handler
    pytest.fail(&quot;Error details: \n{message}&quot;.format(message=message))
  File &quot;/Users/aweisberg/repos/cassandra-dtest/venv/lib/python3.6/site-packages/_pytest/outcomes.py&quot;, line 96, in fail
    raise Failed(msg=msg, pytrace=pytrace)
Failed: Error details:
Errors seen in logs for: node3
node3: ERROR [ReadStage-1] 2018-09-18 12:28:48,344 AbstractLocalAwareExecutorService.java:167 - Uncaught exception on thread Thread[ReadStage-1,5,main]
org.apache.cassandra.exceptions.InvalidRequestException: Attempted to serve transient data request from full node in org.apache.cassandra.db.ReadCommandVerbHandler@3c55e0ff
	at org.apache.cassandra.db.ReadCommandVerbHandler.validateTransientStatus(ReadCommandVerbHandler.java:104)
	at org.apache.cassandra.db.ReadCommandVerbHandler.doVerb(ReadCommandVerbHandler.java:53)
	at org.apache.cassandra.net.MessageDeliveryTask.process(MessageDeliveryTask.java:92)
	at org.apache.cassandra.net.MessageDeliveryTask.run(MessageDeliveryTask.java:54)
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)
	at org.apache.cassandra.concurrent.AbstractLocalAwareExecutorService$FutureTask.run(AbstractLocalAwareExecutorService.java:162)
	at org.apache.cassandra.concurrent.AbstractLocalAwareExecutorService$LocalSessionFutureTask.run(AbstractLocalAwareExecutorService.java:134)
	at org.apache.cassandra.concurrent.SEPWorker.run(SEPWorker.java:110)
	at io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)
	at java.lang.Thread.run(Thread.java:748)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="13185857">CASSANDRA-14762</key>
            <summary>Transient node receives full data requests in dtests</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10002" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Normal</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="benedict">Benedict Elliott Smith</assignee>
                                    <reporter username="aweisberg">Ariel Weisberg</reporter>
                        <labels>
                    </labels>
                <created>Tue, 18 Sep 2018 17:42:36 +0000</created>
                <updated>Fri, 15 May 2020 08:01:43 +0000</updated>
                            <resolved>Wed, 3 Oct 2018 13:29:00 +0000</resolved>
                                        <fixVersion>4.0-alpha1</fixVersion>
                    <fixVersion>4.0</fixVersion>
                                    <component>Feature/Transient Replication</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="16622238" author="benedict" created="Thu, 20 Sep 2018 15:48:04 +0000"  >&lt;p&gt;This error message has its parameters the wrong way around; it should read&lt;/p&gt;

&lt;p&gt;&quot;Attempted to serve full data request from transient node&quot;&lt;/p&gt;

&lt;p&gt;Which is obviously much worse&lt;/p&gt;</comment>
                            <comment id="16622242" author="benedict" created="Thu, 20 Sep 2018 15:53:15 +0000"  >&lt;p&gt;I&apos;m not sure why rapid write protection should affect this?&lt;/p&gt;</comment>
                            <comment id="16622305" author="aweisberg" created="Thu, 20 Sep 2018 16:29:56 +0000"  >&lt;p&gt;It probably didn&apos;t I just didn&apos;t find out if it reproduced without it.&lt;/p&gt;</comment>
                            <comment id="16622435" author="benedict" created="Thu, 20 Sep 2018 18:02:17 +0000"  >&lt;p&gt;I&apos;m pretty sure the issue here is that, in SRP and AbstractReadRepair, we&apos;re not correctly setting the transient flags.  I&apos;ve got a patch queued in CI that should correct it.&lt;/p&gt;</comment>
                            <comment id="16622816" author="benedict" created="Thu, 20 Sep 2018 22:37:10 +0000"  >&lt;p&gt;&lt;a href=&quot;https://github.com/belliottsmith/cassandra/tree/14762&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;4.0&lt;/a&gt; &lt;a href=&quot;https://circleci.com/workflow-run/c389a15a-c2f4-4ad7-8ea1-921266d18bf5&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;CI&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16628006" author="aweisberg" created="Tue, 25 Sep 2018 22:31:34 +0000"  >&lt;p&gt;&lt;a href=&quot;https://github.com/belliottsmith/cassandra/commit/0f8a736316feded871231e2ad571d53182d33ee2#diff-0920d7430e98bf3c6a3c4cb88056f8f5R293&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;Is this just a clarification?&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Maybe &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=bdeggleston&quot; class=&quot;user-hover&quot; rel=&quot;bdeggleston&quot;&gt;bdeggleston&lt;/a&gt; should do a quick review as well since it is a small change. I just want to sanity check that we should be reading from transient replicas in both these cases.&lt;/p&gt;

&lt;p&gt;It seems to me we use read repair to assemble the read after digest mismatch between full replicas and that is why we it might send messages to transient replicas? That is what it seems like to me. A minor out of scope improvement would be to use the existing response and not repeat the read?&lt;/p&gt;

&lt;p&gt;It seems to me also that we would read from transients as part of short read protection (they are just another member of the group), and they aren&apos;t special so we should issue them the query.&lt;/p&gt;</comment>
                            <comment id="16628397" author="benedict" created="Wed, 26 Sep 2018 08:16:51 +0000"  >&lt;p&gt;Thanks for the review.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;Is this just a clarification?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Yes; it is a no-effect change.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;It seems to me we use read repair to assemble the read after digest mismatch between full replicas and that is why we it might send messages to transient replicas? That is what it seems like to me.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Even though we don&apos;t send repair mutations after read-repair from transient replicas, on digest mismatch we still perform reads to other replicas - including those that we may not have contacted initially, which might include new transient nodes.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;A minor out of scope improvement would be to use the existing response and not repeat the read?&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Agreed, see &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-14733&quot; title=&quot;AbstractReadRepair sends unnecessary data read(s)&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-14733&quot;&gt;CASSANDRA-14733&lt;/a&gt;.  I considered doing that optimisation for this ticket, but given the above fact that we might issue new transient reads it seemed to unnecessarily complicate fixing this bug.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;It seems to me also that we would read from transients as part of short read protection (they are just another member of the group), and they aren&apos;t special so we should issue them the query.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Is this simply you reasoning out the rationale for issuing the requests, or have you spotted an issue with the patch that means we are not doing so?&lt;/p&gt;

&lt;p&gt;It does look to me like we should be perhaps switching to &lt;tt&gt;acceptsTransient&lt;/tt&gt; for the local query also, and validating transient status in &lt;tt&gt;LocalReadRunnable&lt;/tt&gt; - but, for now, we don&apos;t do this.  Perhaps we could fix this also in this patch, or otherwise file a follow up.&lt;/p&gt;</comment>
                            <comment id="16628901" author="aweisberg" created="Wed, 26 Sep 2018 14:59:43 +0000"  >&lt;blockquote&gt;&lt;p&gt;Is this simply you reasoning out the rationale for issuing the requests, or have you spotted an issue with the patch that means we are not doing so?&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Sorry it&apos;s just socratic code review. I don&apos;t see any problems.&lt;/p&gt;

&lt;p&gt;+1&lt;/p&gt;

&lt;p&gt;Checking locally is nice, but I&apos;m not sure it is as valuable just because the race is much smaller since it&apos;s not O(gossip) it&apos;s O(time to switch threads). &lt;/p&gt;

&lt;p&gt;If you want to do it here or in another ticket it&apos;s still good to have.&lt;/p&gt;</comment>
                            <comment id="16629102" author="benedict" created="Wed, 26 Sep 2018 16:45:15 +0000"  >&lt;blockquote&gt;&lt;p&gt;I&apos;m not sure it is as valuable just because the race is much smaller since it&apos;s not O(gossip) it&apos;s O(time to switch threads).&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I was thinking of programmer error more than the race condition, but I agree it&apos;s much less impactful.  I might rustle it up anyway, while we&apos;re here.&lt;/p&gt;</comment>
                            <comment id="16636947" author="benedict" created="Wed, 3 Oct 2018 13:28:53 +0000"  >&lt;p&gt;I&apos;ve committed as-is, to &lt;a href=&quot;https://github.com/apache/cassandra/commit/467068d1e9d84e6cca1f9dd5a4eff5f80d027c2e&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;467068d1e9d84e6cca1f9dd5a4eff5f80d027c2e&lt;/a&gt;.  &lt;/p&gt;

&lt;p&gt;dtests are now very flaky on CircleCI, but all of the failures in the latest run have shown up in trunk runs for me on CircleCI.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310010">
                    <name>Incorporates</name>
                                                                <inwardlinks description="is part of">
                                        <issuelink>
            <issuekey id="13183397">CASSANDRA-14697</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[benedict]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 6 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3y7zb:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>aweisberg</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[aweisberg]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12962"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>