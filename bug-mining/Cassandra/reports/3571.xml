<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 22:54:04 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-9419] CqlRecordWriter does not adequately determine if driver failed to connect due to interrupt</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-9419</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;Until &lt;a href=&quot;https://datastax-oss.atlassian.net/browse/JAVA-769&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://datastax-oss.atlassian.net/browse/JAVA-769&lt;/a&gt; is implemented, I have had to implement a workaround.&lt;/p&gt;

&lt;p&gt;Java&apos;s thread interrupt status flag can be cleared for any number of reasons. After discussion, I&apos;ve changed to parsing the driver&apos;s DriverException to tell if we are safe to retry the failed connection.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12830817">CASSANDRA-9419</key>
            <summary>CqlRecordWriter does not adequately determine if driver failed to connect due to interrupt</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10002" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Normal</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="philipthompson">Philip Thompson</assignee>
                                    <reporter username="philipthompson">Philip Thompson</reporter>
                        <labels>
                    </labels>
                <created>Mon, 18 May 2015 20:35:44 +0000</created>
                <updated>Tue, 16 Apr 2019 09:31:10 +0000</updated>
                            <resolved>Wed, 20 May 2015 10:32:00 +0000</resolved>
                                        <fixVersion>2.2.0 rc1</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="14549183" author="philipthompson" created="Mon, 18 May 2015 20:41:47 +0000"  >&lt;p&gt;Though the previous method did seem to be working reliably in testing, changes to trunk since have caused intermittent failures where the interrupt flag is cleared, and we don&apos;t retry connections.&lt;/p&gt;</comment>
                            <comment id="14549208" author="philipthompson" created="Mon, 18 May 2015 20:54:03 +0000"  >&lt;p&gt;This fixes current pig test failures revealed by 160e7f294591b1505059b6adcdc7bea2f9591991&lt;/p&gt;</comment>
                            <comment id="14549409" author="philipthompson" created="Mon, 18 May 2015 22:42:15 +0000"  >&lt;p&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/ptnapoleon/job/ptnapoleon-cassandra-9419-testall/lastCompletedBuild/testReport/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://cassci.datastax.com/view/Dev/view/ptnapoleon/job/ptnapoleon-cassandra-9419-testall/lastCompletedBuild/testReport/&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14550493" author="beobal" created="Tue, 19 May 2015 14:15:02 +0000"  >&lt;p&gt;I&apos;m still seeing failures locally, where the log output looks like this (with some of the WARNs elided):&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;[junit] Testsuite: org.apache.cassandra.pig.CqlTableTest
    [junit] Tests run: 5, Failures: 1, Errors: 0, Skipped: 0, Time elapsed: 47.007 sec
    [junit] 
    [junit] ------------- Standard Output ---------------
    ...
    [junit] WARN  13:27:58 job_local_0003
    [junit] java.io.IOException: com.datastax.driver.core.exceptions.NoHostAvailableException: All host(s) tried for query failed (tried: localhost/127.0.0.1:9042 (com.datastax.driver.core.exceptions.DriverException: Connection thread interrupted))
    [junit]     at org.apache.cassandra.hadoop.cql3.CqlRecordWriter$RangeClient.run(CqlRecordWriter.java:329) ~[main/:na]
    [junit] Caused by: com.datastax.driver.core.exceptions.NoHostAvailableException: All host(s) tried for query failed (tried: localhost/127.0.0.1:9042 (com.datastax.driver.core.exceptions.DriverException: Connection thread interrupted))
    [junit]     at com.datastax.driver.core.ControlConnection.reconnectInternal(ControlConnection.java:223) ~[cassandra-driver-core-2.1.5-shaded.jar:na]
    [junit]     at com.datastax.driver.core.ControlConnection.connect(ControlConnection.java:78) ~[cassandra-driver-core-2.1.5-shaded.jar:na]
    [junit]     at com.datastax.driver.core.Cluster$Manager.init(Cluster.java:1230) ~[cassandra-driver-core-2.1.5-shaded.jar:na]
    [junit]     at com.datastax.driver.core.Cluster.init(Cluster.java:157) ~[cassandra-driver-core-2.1.5-shaded.jar:na]
    [junit]     at com.datastax.driver.core.Cluster.connect(Cluster.java:245) ~[cassandra-driver-core-2.1.5-shaded.jar:na]
    [junit]     at org.apache.cassandra.hadoop.cql3.CqlRecordWriter$RangeClient.run(CqlRecordWriter.java:320) ~[main/:na]
    [junit] WARN  13:27:58 job_local_0003
    [junit] java.io.IOException: com.datastax.driver.core.exceptions.NoHostAvailableException: All host(s) tried for query failed (tried: localhost/127.0.0.1:9042 (com.datastax.driver.core.exceptions.DriverException: Connection thread interrupted))
    [junit]     at org.apache.cassandra.hadoop.cql3.CqlRecordWriter$RangeClient.run(CqlRecordWriter.java:329) ~[main/:na]
    [junit] Caused by: com.datastax.driver.core.exceptions.NoHostAvailableException: All host(s) tried for query failed (tried: localhost/127.0.0.1:9042 (com.datastax.driver.core.exceptions.DriverException: Connection thread interrupted))
    [junit]     at com.datastax.driver.core.ControlConnection.reconnectInternal(ControlConnection.java:223) ~[cassandra-driver-core-2.1.5-shaded.jar:na]
    [junit]     at com.datastax.driver.core.ControlConnection.connect(ControlConnection.java:78) ~[cassandra-driver-core-2.1.5-shaded.jar:na]
    [junit]     at com.datastax.driver.core.Cluster$Manager.init(Cluster.java:1230) ~[cassandra-driver-core-2.1.5-shaded.jar:na]
    [junit]     at com.datastax.driver.core.Cluster.init(Cluster.java:157) ~[cassandra-driver-core-2.1.5-shaded.jar:na]
    [junit]     at com.datastax.driver.core.Cluster.connect(Cluster.java:245) ~[cassandra-driver-core-2.1.5-shaded.jar:na]
    [junit]     at org.apache.cassandra.hadoop.cql3.CqlRecordWriter$RangeClient.run(CqlRecordWriter.java:320) ~[main/:na]
    [junit] WARN  13:27:58 Ooops! Some job has failed! Specify -stop_on_failure if you want Pig to stop immediately on failure.
    [junit] WARN  13:27:58 Ooops! Some job has failed! Specify -stop_on_failure if you want Pig to stop immediately on failure.
    [junit] ERROR 13:27:58 1 map reduce job(s) failed!
    [junit] ERROR 13:27:58 1 map reduce job(s) failed!
    [junit] WARN  13:27:59 Use GenericOptionsParser for parsing the arguments. Applications should implement Tool for the same.
    [junit] WARN  13:27:59 Use GenericOptionsParser for parsing the arguments. Applications should implement Tool for the same.
    [junit] WARN  13:27:59 No job jar file set.  User classes may not be found. See JobConf(Class) or JobConf#setJar(String).
    [junit] WARN  13:27:59 No job jar file set.  User classes may not be found. See JobConf(Class) or JobConf#setJar(String).
    [junit] WARN  13:28:02 Failed to get RunningJob for job job_local_0004
    [junit] WARN  13:28:02 Failed to get RunningJob for job job_local_0004
    [junit] WARN  13:28:02 SchemaTupleBackend has already been initialized
    [junit] WARN  13:28:02 SchemaTupleBackend has already been initialized
    [junit] WARN  13:28:03 Use GenericOptionsParser for parsing the arguments. Applications should implement Tool for the same.
    [junit] WARN  13:28:03 Use GenericOptionsParser for parsing the arguments. Applications should implement Tool for the same.
    [junit] WARN  13:28:03 No job jar file set.  User classes may not be found. See JobConf(Class) or JobConf#setJar(String).
    [junit] WARN  13:28:03 No job jar file set.  User classes may not be found. See JobConf(Class) or JobConf#setJar(String).
    [junit] WARN  13:28:03 Output path is null in cleanup
    [junit] WARN  13:28:03 Output path is null in cleanup
    [junit] WARN  13:28:03 job_local_0005
    [junit] java.io.IOException: java.lang.RuntimeException: failed to prepare cql query update cql3ks.collectiontable set n = ? WHERE &quot;m&quot; = ?
    [junit]     at org.apache.cassandra.hadoop.cql3.CqlRecordWriter$RangeClient.run(CqlRecordWriter.java:368) ~[main/:na]
    [junit] Caused by: java.lang.RuntimeException: failed to prepare cql query update cql3ks.collectiontable set n = ? WHERE &quot;m&quot; = ?
    [junit]     at org.apache.cassandra.hadoop.cql3.CqlRecordWriter$RangeClient.preparedStatement(CqlRecordWriter.java:392) ~[main/:na]
    [junit]     at org.apache.cassandra.hadoop.cql3.CqlRecordWriter$RangeClient.run(CqlRecordWriter.java:346) ~[main/:na]
    [junit] Caused by: com.datastax.driver.core.exceptions.NoHostAvailableException: All host(s) tried for query failed (no host was tried)
    [junit]     at com.datastax.driver.core.exceptions.NoHostAvailableException.copy(NoHostAvailableException.java:84) ~[cassandra-driver-core-2.1.5-shaded.jar:na]
    [junit]     at com.datastax.driver.core.DefaultResultSetFuture.extractCauseFromExecutionException(DefaultResultSetFuture.java:289) ~[cassandra-driver-core-2.1.5-shaded.jar:na]
    [junit]     at com.datastax.driver.core.AbstractSession.prepare(AbstractSession.java:79) ~[cassandra-driver-core-2.1.5-shaded.jar:na]
    [junit]     at org.apache.cassandra.hadoop.cql3.CqlRecordWriter$RangeClient.preparedStatement(CqlRecordWriter.java:388) ~[main/:na]
    [junit]     ... 1 common frames omitted
    [junit] Caused by: com.datastax.driver.core.exceptions.NoHostAvailableException: All host(s) tried for query failed (no host was tried)
    [junit]     at com.datastax.driver.core.RequestHandler.sendRequest(RequestHandler.java:107) ~[cassandra-driver-core-2.1.5-shaded.jar:na]
    [junit]     at com.datastax.driver.core.SessionManager.execute(SessionManager.java:538) ~[cassandra-driver-core-2.1.5-shaded.jar:na]
    [junit]     at com.datastax.driver.core.SessionManager.prepareAsync(SessionManager.java:124) ~[cassandra-driver-core-2.1.5-shaded.jar:na]
    [junit]     at com.datastax.driver.core.AbstractSession.prepare(AbstractSession.java:77) ~[cassandra-driver-core-2.1.5-shaded.jar:na]
    [junit]     ... 2 common frames omitted
    [junit] WARN  13:28:03 job_local_0005
    [junit] java.io.IOException: java.lang.RuntimeException: failed to prepare cql query update cql3ks.collectiontable set n = ? WHERE &quot;m&quot; = ?
    [junit]     at org.apache.cassandra.hadoop.cql3.CqlRecordWriter$RangeClient.run(CqlRecordWriter.java:368) ~[main/:na]
    [junit] Caused by: java.lang.RuntimeException: failed to prepare cql query update cql3ks.collectiontable set n = ? WHERE &quot;m&quot; = ?
    [junit]     at org.apache.cassandra.hadoop.cql3.CqlRecordWriter$RangeClient.preparedStatement(CqlRecordWriter.java:392) ~[main/:na]
    [junit]     at org.apache.cassandra.hadoop.cql3.CqlRecordWriter$RangeClient.run(CqlRecordWriter.java:346) ~[main/:na]
    [junit] Caused by: com.datastax.driver.core.exceptions.NoHostAvailableException: All host(s) tried for query failed (no host was tried)
    [junit]     at com.datastax.driver.core.exceptions.NoHostAvailableException.copy(NoHostAvailableException.java:84) ~[cassandra-driver-core-2.1.5-shaded.jar:na]
    [junit]     at com.datastax.driver.core.DefaultResultSetFuture.extractCauseFromExecutionException(DefaultResultSetFuture.java:289) ~[cassandra-driver-core-2.1.5-shaded.jar:na]
    [junit]     at com.datastax.driver.core.AbstractSession.prepare(AbstractSession.java:79) ~[cassandra-driver-core-2.1.5-shaded.jar:na]
    [junit]     at org.apache.cassandra.hadoop.cql3.CqlRecordWriter$RangeClient.preparedStatement(CqlRecordWriter.java:388) ~[main/:na]
    [junit]     ... 1 common frames omitted
    [junit] Caused by: com.datastax.driver.core.exceptions.NoHostAvailableException: All host(s) tried for query failed (no host was tried)
    [junit]     at com.datastax.driver.core.RequestHandler.sendRequest(RequestHandler.java:107) ~[cassandra-driver-core-2.1.5-shaded.jar:na]
    [junit]     at com.datastax.driver.core.SessionManager.execute(SessionManager.java:538) ~[cassandra-driver-core-2.1.5-shaded.jar:na]
    [junit]     at com.datastax.driver.core.SessionManager.prepareAsync(SessionManager.java:124) ~[cassandra-driver-core-2.1.5-shaded.jar:na]
    [junit]     at com.datastax.driver.core.AbstractSession.prepare(AbstractSession.java:77) ~[cassandra-driver-core-2.1.5-shaded.jar:na]
    [junit]     ... 2 common frames omitted
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I think you want to add a &lt;tt&gt;continue&lt;/tt&gt; at the end of the catch block where the connection is opened. Otherwise when the connection attempt fails, unless we meet the conditions to &lt;tt&gt;break:outer&lt;/tt&gt;, it goes on to try and prepare the statement, which results in a &lt;tt&gt;RuntimeException&lt;/tt&gt;.&lt;/p&gt;
</comment>
                            <comment id="14551066" author="philipthompson" created="Tue, 19 May 2015 19:26:30 +0000"  >&lt;p&gt;Added your suggested change. Results are here: &lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/ptnapoleon/job/ptnapoleon-cassandra-9419-testall/lastCompletedBuild/testReport/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://cassci.datastax.com/view/Dev/view/ptnapoleon/job/ptnapoleon-cassandra-9419-testall/lastCompletedBuild/testReport/&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14551067" author="philipthompson" created="Tue, 19 May 2015 19:27:05 +0000"  >&lt;p&gt;New Patch is at &lt;a href=&quot;https://github.com/apache/cassandra/compare/cassandra-2.2...ptnapoleon:cassandra-9419&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/cassandra/compare/cassandra-2.2...ptnapoleon:cassandra-9419&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14552088" author="beobal" created="Wed, 20 May 2015 10:10:09 +0000"  >&lt;p&gt;LGTM, thanks. Committed in &lt;tt&gt;f970de55746dd074843d8cfd5385b12acda56ee9&lt;/tt&gt;&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10032">
                    <name>Blocker</name>
                                            <outwardlinks description="blocks">
                                        <issuelink>
            <issuekey id="12767163">CASSANDRA-8609</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12831458">CASSANDRA-9442</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12733619" name="9419.txt" size="1777" author="philipthompson" created="Mon, 18 May 2015 20:37:07 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[philipthompson]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 26 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2ew6f:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>samt</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[samt]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12962"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12311420" key="com.atlassian.jira.plugin.system.customfieldtypes:version">
                        <customfieldname>Since Version</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="12324945">2.2.0 beta 1</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>