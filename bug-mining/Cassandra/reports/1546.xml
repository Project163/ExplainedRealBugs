<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 22:30:52 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-4099] IncomingTCPConnection recognizes from by doing socket.getInetAddress() instead of BroadCastAddress</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-4099</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;change &quot;this.from = socket.getInetAddress()&quot; to understand the broad cast IP, but the problem is we dont know until the first packet is received, this ticket is to work around the problem until it reads the first packet.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12548549">CASSANDRA-4099</key>
            <summary>IncomingTCPConnection recognizes from by doing socket.getInetAddress() instead of BroadCastAddress</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10003" iconUrl="https://issues.apache.org/jira/images/icons/priorities/trivial.svg">Low</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="vijay2win@yahoo.com">Vijay</assignee>
                                    <reporter username="vijay2win@yahoo.com">Vijay</reporter>
                        <labels>
                    </labels>
                <created>Wed, 28 Mar 2012 20:54:50 +0000</created>
                <updated>Tue, 16 Apr 2019 09:32:36 +0000</updated>
                            <resolved>Wed, 6 Jun 2012 02:23:36 +0000</resolved>
                                        <fixVersion>1.0.9</fixVersion>
                    <fixVersion>1.1.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                                                                <comments>
                            <comment id="13240811" author="brandon.williams" created="Wed, 28 Mar 2012 23:00:42 +0000"  >&lt;p&gt;This doesn&apos;t look like a perfect solution since all nodes will have to stream to all other nodes in order to learn the correct version, and thus be able to use newer-version features.  I&apos;m not sure there&apos;s currently a way around this, though.  I created &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-4101&quot; title=&quot;Gossip should propagate MessagingService.version&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-4101&quot;&gt;&lt;del&gt;CASSANDRA-4101&lt;/del&gt;&lt;/a&gt; to get us started there, but I&apos;ll look more closely here tomorrow.&lt;/p&gt;</comment>
                            <comment id="13240813" author="vijay2win@yahoo.com" created="Wed, 28 Mar 2012 23:06:09 +0000"  >&lt;p&gt;Thanks Brandon, &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-4101&quot; title=&quot;Gossip should propagate MessagingService.version&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-4101&quot;&gt;&lt;del&gt;CASSANDRA-4101&lt;/del&gt;&lt;/a&gt; looks like a better solution but not only does the Streaming sets the version Gossip or any connunication does set it, the following does it&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt; 
            from = msg.getFrom(); &lt;span class=&quot;code-comment&quot;&gt;// why? see =&amp;gt; CASSANDRA-4099
&lt;/span&gt;            &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (version &amp;gt; MessagingService.current_version)
            {
                &lt;span class=&quot;code-comment&quot;&gt;// save the endpoint so gossip will reconnect to it
&lt;/span&gt;                Gossiper.instance.addSavedEndpoint(from);
                logger.info(&lt;span class=&quot;code-quote&quot;&gt;&quot;Received &quot;&lt;/span&gt; + (isStream ? &lt;span class=&quot;code-quote&quot;&gt;&quot;streaming &quot;&lt;/span&gt; : &lt;span class=&quot;code-quote&quot;&gt;&quot;&quot;) + &quot;&lt;/span&gt;connection from newer protocol version. Ignoring&quot;);
            }
            &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (msg != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;)
            {
                Gossiper.instance.setVersion(from, version);
                logger.debug(&lt;span class=&quot;code-quote&quot;&gt;&quot;set version &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; {} to {}&quot;&lt;/span&gt;, from, version);
            }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt; </comment>
                            <comment id="13240815" author="brandon.williams" created="Wed, 28 Mar 2012 23:11:54 +0000"  >&lt;p&gt;Won&apos;t &apos;from&apos; still always be wrong in your configuration unless streaming occurs?&lt;/p&gt;</comment>
                            <comment id="13240819" author="vijay2win@yahoo.com" created="Wed, 28 Mar 2012 23:16:25 +0000"  >&lt;p&gt;Nope there is 2 places where we set the from one is during the stream just before we start. the second place is when it is not a stream and when we recive the first message so we should be ok and should never be null.&lt;/p&gt;

&lt;p&gt;1)&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;                    &lt;span class=&quot;code-comment&quot;&gt;// why? see =&amp;gt; CASSANDRA-4099
&lt;/span&gt;                    from = streamHeader.broadcastAddress;
                    stream(streamHeader, input);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;2)&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
Message msg = receiveMessage(input, version);
            from = msg.getFrom(); &lt;span class=&quot;code-comment&quot;&gt;// why? see =&amp;gt; CASSANDRA-4099&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Hope it makes sense.&lt;/p&gt;</comment>
                            <comment id="13240822" author="brandon.williams" created="Wed, 28 Mar 2012 23:22:44 +0000"  >&lt;p&gt;I think I see, in your situation the version is correct for everything except streaming, hence 1)?  It seems like the problem here is it will still accept streams from a lesser version, which is always version-specific.&lt;/p&gt;</comment>
                            <comment id="13240826" author="vijay2win@yahoo.com" created="Wed, 28 Mar 2012 23:28:36 +0000"  >&lt;p&gt;I think we can remove&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;                &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (version &amp;lt;= MessagingService.current_version)
                {
                    &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; size = input.readInt();
                    &lt;span class=&quot;code-object&quot;&gt;byte&lt;/span&gt;[] headerBytes = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;byte&lt;/span&gt;[size];
                    input.readFully(headerBytes);
                    StreamHeader streamHeader = StreamHeader.serializer().deserialize(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; DataInputStream(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; FastByteArrayInputStream(headerBytes)), version);
                    &lt;span class=&quot;code-comment&quot;&gt;// why? see =&amp;gt; CASSANDRA-4099
&lt;/span&gt;                    from = streamHeader.broadcastAddress;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Because the version will be already set by the Gossip hopefully &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; but I still dont understand why we streaming needs to be version specific though.&lt;/p&gt;</comment>
                            <comment id="13240836" author="vijay2win@yahoo.com" created="Wed, 28 Mar 2012 23:48:06 +0000"  >&lt;p&gt;IRC Brandon explained the changes in flowcontrol which will not allow us to stream data from other versions, v2 removes those changes from v1&lt;/p&gt;</comment>
                            <comment id="13241258" author="brandon.williams" created="Thu, 29 Mar 2012 14:22:40 +0000"  >&lt;p&gt;I&apos;m confused, how does &apos;from&apos; differ from &apos;msg.getFrom&apos; in this patch?  It seems like a no-op.&lt;/p&gt;</comment>
                            <comment id="13241305" author="vijay2win@yahoo.com" created="Thu, 29 Mar 2012 15:25:10 +0000"  >&lt;p&gt;getFrom gets the IP from the message header and the message header is set by the caller, which uses FB.BCA and the receiving machine sets it. Plz look at  Message.getInternalReply for example. Thanks!&lt;/p&gt;</comment>
                            <comment id="13241351" author="brandon.williams" created="Thu, 29 Mar 2012 16:13:08 +0000"  >&lt;p&gt;I see, it&apos;s injecting another getFrom call.  +1 (though this version only applies to trunk)&lt;/p&gt;</comment>
                            <comment id="13241440" author="jbellis" created="Thu, 29 Mar 2012 17:56:14 +0000"  >&lt;p&gt;I still don&apos;t get it.&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;+            from = msg.getFrom(); // why? see =&amp;gt; CASSANDRA-4099
-                Gossiper.instance.setVersion(msg.getFrom(), version);
+                Gossiper.instance.setVersion(from, version);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;How is the first getFrom, not the same as the one we&apos;ve de-inlined?&lt;/p&gt;</comment>
                            <comment id="13241474" author="brandon.williams" created="Thu, 29 Mar 2012 18:19:57 +0000"  >&lt;p&gt;It overrides where from is set in the constructor:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.from = socket.getInetAddress();
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="13241480" author="jbellis" created="Thu, 29 Mar 2012 18:22:45 +0000"  >&lt;p&gt;I see.&lt;/p&gt;

&lt;p&gt;Looking at the usages of ITC.from, it looks like we can drop that constructor initialization entirely...&lt;/p&gt;</comment>
                            <comment id="13241484" author="brandon.williams" created="Thu, 29 Mar 2012 18:27:54 +0000"  >&lt;p&gt;I agree, we should get out of the habit of examining sockets directly due to broadcast_address.&lt;/p&gt;</comment>
                            <comment id="13241496" author="vijay2win@yahoo.com" created="Thu, 29 Mar 2012 18:39:22 +0000"  >&lt;p&gt;Attached version incorporate&apos;s the comments... Note that the streaming a file will not remove or add the version, which i think is a better option IMHO. Plz let me know if you think otherwise. Thanks!&lt;/p&gt;</comment>
                            <comment id="13241505" author="jbellis" created="Thu, 29 Mar 2012 18:50:37 +0000"  >&lt;p&gt;&lt;ins&gt;1 on v3 for 1.0&lt;/ins&gt;&lt;/p&gt;

&lt;p&gt;I&apos;m fine w/ continuing to ignore version on streaming for now&lt;/p&gt;</comment>
                            <comment id="13241939" author="vijay2win@yahoo.com" created="Thu, 29 Mar 2012 23:51:54 +0000"  >&lt;p&gt;Committed to 1.0 and trunk (as &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-4101&quot; title=&quot;Gossip should propagate MessagingService.version&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-4101&quot;&gt;&lt;del&gt;CASSANDRA-4101&lt;/del&gt;&lt;/a&gt; is closed).&lt;/p&gt;</comment>
                            <comment id="13241991" author="vijay2win@yahoo.com" created="Fri, 30 Mar 2012 01:19:31 +0000"  >&lt;p&gt;Looks like there is a case we will run into NPE when the other node which is sending a higher version we ignore it but the problem the msg object is not available.&lt;/p&gt;</comment>
                            <comment id="13241996" author="vijay2win@yahoo.com" created="Fri, 30 Mar 2012 01:26:47 +0000"  >&lt;p&gt;v4 is on top of the v3 and it fixes the NPE&lt;/p&gt;</comment>
                            <comment id="13242498" author="brandon.williams" created="Fri, 30 Mar 2012 16:20:03 +0000"  >&lt;p&gt;+1&lt;/p&gt;</comment>
                            <comment id="13242647" author="vijay2win@yahoo.com" created="Fri, 30 Mar 2012 18:51:00 +0000"  >&lt;p&gt;Committed back Thanks!&lt;/p&gt;</comment>
                            <comment id="13289814" author="jbellis" created="Tue, 5 Jun 2012 22:50:36 +0000"  >&lt;p&gt;I think this is still broken.  if A forwards a message from B to C, then &lt;tt&gt;Gossiper.instance.setVersion(from, version)&lt;/tt&gt; C will mark B&apos;s version (B == from) to the version that A sent.  But A sends its own version, not B&apos;s.  (Which is correct for the purpose of message forwarding, since A re-serializes instead of passing what B sent verbatim.)&lt;/p&gt;

&lt;p&gt;I don&apos;t think we can accommodate both message forwarding, and broadcast address != socket address, without a protocol change to include a &quot;here is my reply-to broadcast_address&quot; piece of information when the connection is first established, distinct from Message.from.&lt;/p&gt;</comment>
                            <comment id="13289854" author="vijay2win@yahoo.com" created="Tue, 5 Jun 2012 23:37:46 +0000"  >&lt;p&gt;Hi Jonathan, IMO the right fix for it with a similar approach as in the ticket &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-4101&quot; title=&quot;Gossip should propagate MessagingService.version&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-4101&quot;&gt;&lt;del&gt;CASSANDRA-4101&lt;/del&gt;&lt;/a&gt; (we can also remove the ConcurrentMap.get() to compare the versions), Agree?&lt;/p&gt;</comment>
                            <comment id="13289867" author="brandon.williams" created="Tue, 5 Jun 2012 23:45:00 +0000"  >&lt;p&gt;I agree that something like &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-4101&quot; title=&quot;Gossip should propagate MessagingService.version&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-4101&quot;&gt;&lt;del&gt;CASSANDRA-4101&lt;/del&gt;&lt;/a&gt; is the right way to do this&lt;/p&gt;</comment>
                            <comment id="13289906" author="jbellis" created="Wed, 6 Jun 2012 02:23:36 +0000"  >&lt;p&gt;I kind of think we&apos;ve reached the limits of what we can do by band-aiding this.  Opened &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-4311&quot; title=&quot;clean up messagingservice protocol limitations&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-4311&quot;&gt;&lt;del&gt;CASSANDRA-4311&lt;/del&gt;&lt;/a&gt; for a deeper fix.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12520343" name="0001-CASSANDRA-4099-v2.patch" size="1764" author="vijay2win@yahoo.com" created="Wed, 28 Mar 2012 23:48:06 +0000"/>
                            <attachment id="12520479" name="0001-CASSANDRA-4099-v3.patch" size="1959" author="vijay2win@yahoo.com" created="Thu, 29 Mar 2012 18:39:22 +0000"/>
                            <attachment id="12520546" name="0001-CASSANDRA-4099-v4.patch" size="3276" author="vijay2win@yahoo.com" created="Fri, 30 Mar 2012 01:33:42 +0000"/>
                            <attachment id="12520332" name="0001-CASSANDRA-4099.patch" size="2785" author="vijay2win@yahoo.com" created="Wed, 28 Mar 2012 21:59:10 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>4.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[vijay2win@yahoo.com]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>233646</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            13 years, 24 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0gryn:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>95960</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>brandon.williams</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[brandon.williams]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12961"><![CDATA[Low]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>