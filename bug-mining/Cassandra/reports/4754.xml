<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 23:07:35 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-13218] Duration validation error is unclear in case of overflow.</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-13218</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;If a user try to insert a &lt;tt&gt;duration&lt;/tt&gt; with a number of months or days that cannot fit in an &lt;tt&gt;int&lt;/tt&gt; (for example: &lt;tt&gt;9223372036854775807mo1d&lt;/tt&gt;), the error message is confusing.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13042965">CASSANDRA-13218</key>
            <summary>Duration validation error is unclear in case of overflow.</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10002" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Normal</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="blerer">Benjamin Lerer</assignee>
                                    <reporter username="blerer">Benjamin Lerer</reporter>
                        <labels>
                    </labels>
                <created>Tue, 14 Feb 2017 14:41:50 +0000</created>
                <updated>Fri, 15 May 2020 07:59:34 +0000</updated>
                            <resolved>Thu, 11 May 2017 08:44:06 +0000</resolved>
                                        <fixVersion>3.11.0</fixVersion>
                    <fixVersion>4.0-alpha1</fixVersion>
                    <fixVersion>4.0</fixVersion>
                                    <component>Legacy/CQL</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="15866074" author="stamhankar999" created="Tue, 14 Feb 2017 16:32:59 +0000"  >&lt;p&gt;Where is it specified that these are supposed to be int&apos;s? I was under the impression that since we&apos;re transmitting zigzag-encoded vint values and that format supports a 64-bit range, these attributes are intended to have signed 64-bit range. Is there a particular reason to restrict it?&lt;/p&gt;</comment>
                            <comment id="15867759" author="blerer" created="Wed, 15 Feb 2017 12:44:22 +0000"  >&lt;p&gt;The encoding format support effectively a 64-bit range but &lt;tt&gt;months&lt;/tt&gt; and &lt;tt&gt;days&lt;/tt&gt; are stored as &lt;tt&gt;int&lt;/tt&gt; to limit the memory usage and because larger numbers do not really make sense.&lt;br/&gt;
The duration format is not intended to store things like the age of the Earth as you do not need a nanoseconds precision for those type of information.&lt;br/&gt;
A &lt;tt&gt;days&lt;/tt&gt; value of 2^32 (roughly 5,883,516 year) is far more than the age of mankind.&lt;/p&gt;

&lt;p&gt;Now, I fully agree that it should have been documented properly and that the validation message should be more expicit about the problem. &lt;/p&gt;</comment>
                            <comment id="15868130" author="stamhankar999" created="Wed, 15 Feb 2017 16:31:27 +0000"  >&lt;p&gt;Ok, sounds reasonable. Thanks.&lt;/p&gt;</comment>
                            <comment id="15983870" author="stamhankar999" created="Wed, 26 Apr 2017 00:07:26 +0000"  >&lt;p&gt;Found a few other bad side effects of the current behavior:&lt;/p&gt;

&lt;p&gt;1. The validated (truncated) values are not actually re-encoded to vint&apos;s and stored; the user-provided bytes are stored. This is bad because it introduces an inconsistency of behavior &amp;#8211; a client can insert/select 64-bit values for months and days, but when C* exports the data as json (for example), the Duration.deserialize method will produce an object with truncated values.&lt;br/&gt;
2. Validation doesn&apos;t check for truncation error and reject the insert.&lt;br/&gt;
3. I think validation will succeed for this illegal set of values provided by a driver: (-9223372036854775807, 1, 1) because the months attribute will be coerced to 1 (since the highest 4 bytes will be dropped).&lt;/p&gt;

&lt;p&gt;&lt;b&gt;Proposal 1&lt;/b&gt;: accept and handle 64-bit values for months and days consistently. I don&apos;t know how often these values are used in C*, but an extra 8 bytes doesn&apos;t sound like it&apos;s worth the hassle of treating months and days differently than nanos. It makes C* code a little more complex; it makes driver code a little more complex (for drivers that are type-aware at least).&lt;br/&gt;
&lt;b&gt;Proposal 2&lt;/b&gt;: beef up the validation logic to reject values that would overflow/underflow during long-&amp;gt;int truncation. Write a tool that users can use to identify illegal rows they inserted because of the holes in the validation logic and give users an opportunity to clean up such bad data.&lt;/p&gt;

&lt;p&gt;Admittedly, the chances that users have inserted illegal duration&apos;s is relatively small, particularly since this new type hasn&apos;t been around very long. But it seems much simpler to make those values legal, so I&apos;d lean towards my first proposal.&lt;/p&gt;</comment>
                            <comment id="16004679" author="blerer" created="Wed, 10 May 2017 13:30:41 +0000"  >&lt;p&gt;Unfortunately, there are other factors that force us to use 32-bit values for months and days. Java utilities like &lt;tt&gt;Calendar&lt;/tt&gt; accept only &lt;tt&gt;int&lt;/tt&gt; for months or days value and we already use &lt;tt&gt;Calendar&lt;/tt&gt; for data arithmetics. Due to that the solution is simply to reject to values at write time.&lt;/p&gt;

&lt;p&gt;I pushed a patch for that &lt;a href=&quot;https://github.com/apache/cassandra/compare/trunk...blerer:13128-3.11&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;here&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;I think that the chances that users have inserted illegal durations is rather null. &lt;br/&gt;
The 2 reasons for that are that:&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;duration is not really usefull in itself and was mainly added for simplifying the life of user querying timeseries data&lt;/li&gt;
	&lt;li&gt;the invalid values are greater than the age of mankind and by consequence have not much sense in the real life&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=adelapena&quot; class=&quot;user-hover&quot; rel=&quot;adelapena&quot;&gt;adelapena&lt;/a&gt; could you review? &lt;/p&gt;</comment>
                            <comment id="16004796" author="adelapena" created="Wed, 10 May 2017 14:41:48 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=blerer&quot; class=&quot;user-hover&quot; rel=&quot;blerer&quot;&gt;blerer&lt;/a&gt; sure, can you set me as reviewer?&lt;/p&gt;</comment>
                            <comment id="16004960" author="adelapena" created="Wed, 10 May 2017 16:28:07 +0000"  >&lt;p&gt;Indeed, a 32-bit integer seems more than enough for months. I either can&apos;t figure out any use case involving time intervals over 5,883,516 years and a precision higher than millennia.&lt;/p&gt;

&lt;p&gt;The patch looks good to me, +1.&lt;/p&gt;

&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;&lt;a href=&quot;https://github.com/apache/cassandra/compare/cassandra-3.11...blerer:13128-3.11.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;3.11&lt;/a&gt;&lt;/th&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/blerer/job/adelapena-13128-3.11-testall/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;utests&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;
</comment>
                            <comment id="16006103" author="blerer" created="Thu, 11 May 2017 08:43:31 +0000"  >&lt;p&gt;Thanks for the review.&lt;/p&gt;</comment>
                            <comment id="16006104" author="blerer" created="Thu, 11 May 2017 08:44:06 +0000"  >&lt;p&gt;Committed into 3.11 at 8693357109a6e59117a641e109c3865501e3eee6 and merged into trunk.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[blerer]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 27 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3a2a7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>adelapena</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[adelapena]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12962"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>