<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 22:22:29 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-2708] memory leak in CompactionManager&apos;s estimatedCompactions</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-2708</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;CompactionManager&apos;s estimatedCompactions map seems to hold all or most ColumnFamilyStores in the system as keys.  Keys are never removed from estimatedCompactions.&lt;/p&gt;

&lt;p&gt;I have a project that embeds Cassandra as a storage backend.  Some of my integration tests create and drop a single keyspace and pair of column families a hundred or 150 times in one JVM.  These tests always OOM&apos;d.  Loading some near-death heapdumps in mat suggested CompactionManager&apos;s estimatedCompactions held over 80% of total heap via its ColumnFamilyStore keys.  estimatedCompactions had the only inbound reference to these CFSs, and the CFSs themselves had invalid = true.&lt;/p&gt;

&lt;p&gt;As a workaround, I changed estimatedCompactions to a WeakReference-keyed map (using Guava MapMaker).  My integration tests no longer OOM.&lt;/p&gt;

&lt;p&gt;I&apos;m generally unfamiliar with Cassandra&apos;s guts.  I don&apos;t know whether weak referencing the keys of estimatedCompactions is correct (or ideal).  But, that did seem to confirm my guess that retained references to dead CFSs in estimatedCompactions were swamping my heap after lots of Keyspace+ColumnFamily drops.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12508349">CASSANDRA-2708</key>
            <summary>memory leak in CompactionManager&apos;s estimatedCompactions</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10003" iconUrl="https://issues.apache.org/jira/images/icons/priorities/trivial.svg">Low</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="dalaro">Dan LaRocque</assignee>
                                    <reporter username="dalaro">Dan LaRocque</reporter>
                        <labels>
                    </labels>
                <created>Wed, 25 May 2011 20:51:53 +0000</created>
                <updated>Tue, 16 Apr 2019 09:32:58 +0000</updated>
                            <resolved>Mon, 22 Aug 2011 21:49:21 +0000</resolved>
                                        <fixVersion>0.7.9</fixVersion>
                    <fixVersion>0.8.5</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                                                                <comments>
                            <comment id="13039329" author="dalaro" created="Wed, 25 May 2011 20:57:31 +0000"  >&lt;p&gt;Attaching 3-line patch against cassandra-0.7 r1127675&lt;/p&gt;</comment>
                            <comment id="13089009" author="jbellis" created="Mon, 22 Aug 2011 21:09:09 +0000"  >&lt;p&gt;Sorry Dan, I missed this when you first submitted it.  Committed for 0.7.9.  Thanks for the help!&lt;/p&gt;</comment>
                            <comment id="13089027" author="hudson" created="Mon, 22 Aug 2011 21:28:17 +0000"  >&lt;p&gt;Integrated in Cassandra-0.7 #540 (See &lt;a href=&quot;https://builds.apache.org/job/Cassandra-0.7/540/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/Cassandra-0.7/540/&lt;/a&gt;)&lt;br/&gt;
    avoid retaining references to dropped CFS objects in CompactionManager.estimatedCompactions&lt;br/&gt;
patch by Dan LaRocque; reviewed by jbellis for &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-2708&quot; title=&quot;memory leak in CompactionManager&amp;#39;s estimatedCompactions&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-2708&quot;&gt;&lt;del&gt;CASSANDRA-2708&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;jbellis : &lt;a href=&quot;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1160436&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1160436&lt;/a&gt;&lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/cassandra/branches/cassandra-0.7/CHANGES.txt&lt;/li&gt;
	&lt;li&gt;/cassandra/branches/cassandra-0.7/src/java/org/apache/cassandra/db/CompactionManager.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                    </comments>
                    <attachments>
                            <attachment id="12480452" name="cassandra-0.7-2708.txt" size="958" author="dalaro" created="Wed, 25 May 2011 20:57:31 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[dalaro]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>20781</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            14 years, 14 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0gcz3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>93532</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>jbellis</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[jbellis]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12961"><![CDATA[Low]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>