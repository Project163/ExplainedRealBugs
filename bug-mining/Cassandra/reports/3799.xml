<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 22:57:38 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-9689] keyspace does not show in describe list, if create query times out</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-9689</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;Here is the snapshot of the overall issue :&lt;/p&gt;

&lt;p&gt;whiterabbit@whiterabbit:~/cassandra/bin$ ccm create &apos;demo2&apos; -v binary:2.1.7 -n 3 -s -d &lt;br/&gt;
Current cluster is now: demo2&lt;br/&gt;
whiterabbit@whiterabbit:~/cassandra/bin$ ccm list&lt;br/&gt;
  demo_1node&lt;br/&gt;
 *demo2&lt;br/&gt;
whiterabbit@whiterabbit:~/cassandra/bin$ ccm status&lt;br/&gt;
Cluster: &apos;demo2&apos;&lt;br/&gt;
----------------&lt;br/&gt;
node1: UP&lt;br/&gt;
node3: UP&lt;br/&gt;
node2: UP&lt;br/&gt;
whiterabbit@whiterabbit:~/cassandra/bin$ ccm node2 nodetool version&lt;/p&gt;

&lt;p&gt;ReleaseVersion: 2.1.7&lt;/p&gt;

&lt;p&gt;whiterabbit@whiterabbit:~/cassandra/bin$ ccm node2 stop&lt;br/&gt;
whiterabbit@whiterabbit:~/cassandra/bin$ ccm status&lt;br/&gt;
Cluster: &apos;demo2&apos;&lt;br/&gt;
----------------&lt;br/&gt;
node1: UP&lt;br/&gt;
node3: UP&lt;br/&gt;
node2: DOWN&lt;br/&gt;
whiterabbit@whiterabbit:~/cassandra/bin$ ccm node1 cqlsh&lt;br/&gt;
Connected to demo2 at 127.0.0.1:9042.&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;cqlsh 5.0.1 | Cassandra 2.1.7 | CQL spec 3.2.0 | Native protocol v3&amp;#93;&lt;/span&gt;&lt;br/&gt;
Use HELP for help.&lt;br/&gt;
cqlsh&amp;gt; describe keyspaces;&lt;/p&gt;

&lt;p&gt;system_traces  system&lt;/p&gt;

&lt;p&gt;cqlsh&amp;gt; create keyspace training with replication=&lt;/p&gt;
{&apos;class&apos;:&apos;SimpleStrategy&apos;,&apos;replication_factor&apos;:1}
&lt;p&gt;;&lt;br/&gt;
OperationTimedOut: errors={}, last_host=127.0.0.1&lt;br/&gt;
cqlsh&amp;gt; create keyspace training with replication=&lt;/p&gt;
{&apos;class&apos;:&apos;SimpleStrategy&apos;,&apos;replication_factor&apos;:1}
&lt;p&gt;;&lt;br/&gt;
AlreadyExists: Keyspace &apos;training&apos; already exists&lt;br/&gt;
cqlsh&amp;gt; describe keyspaces;&lt;/p&gt;

&lt;p&gt;system_traces  system&lt;/p&gt;

&lt;p&gt;cqlsh&amp;gt; &lt;/p&gt;</description>
                <environment></environment>
        <key id="12841761">CASSANDRA-9689</key>
            <summary>keyspace does not show in describe list, if create query times out</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10002" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Normal</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="pauloricardomg">Paulo Motta</assignee>
                                    <reporter username="RoopeshMajeti">Roopesh</reporter>
                        <labels>
                            <label>cqlsh</label>
                    </labels>
                <created>Tue, 30 Jun 2015 18:15:30 +0000</created>
                <updated>Tue, 16 Apr 2019 09:31:06 +0000</updated>
                            <resolved>Fri, 4 Sep 2015 19:42:53 +0000</resolved>
                                        <fixVersion>2.1.10</fixVersion>
                    <fixVersion>2.2.2</fixVersion>
                    <fixVersion>3.0.0 rc1</fixVersion>
                                    <component>Legacy/Tools</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>6</watches>
                                                                                                                <comments>
                            <comment id="14608794" author="philipthompson" created="Tue, 30 Jun 2015 18:19:11 +0000"  >&lt;p&gt;Can you include the output of &lt;tt&gt;nodetool describecluster&lt;/tt&gt; after the failed keyspace creation? If you exit your cqlsh session and create a new one, does &apos;training&apos; show up in &lt;tt&gt;describe keyspaces&lt;/tt&gt;?&lt;/p&gt;</comment>
                            <comment id="14608800" author="roopeshmajeti" created="Tue, 30 Jun 2015 18:24:28 +0000"  >&lt;p&gt;HI Philip, &lt;/p&gt;

&lt;p&gt;Here it goes :&lt;/p&gt;

&lt;p&gt;cqlsh&amp;gt; quit&lt;br/&gt;
whiterabbit@whiterabbit:~/cassandra/bin$ ccm node1 nodetool describecluster&lt;/p&gt;

&lt;p&gt;Cluster Information:&lt;br/&gt;
	Name: demo2&lt;br/&gt;
	Snitch: org.apache.cassandra.locator.DynamicEndpointSnitch&lt;br/&gt;
	Partitioner: org.apache.cassandra.dht.Murmur3Partitioner&lt;br/&gt;
	Schema versions:&lt;br/&gt;
		5271b8e1-025c-301f-937b-89f79ecc4832: &lt;span class=&quot;error&quot;&gt;&amp;#91;127.0.0.1, 127.0.0.3&amp;#93;&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;		UNREACHABLE: &lt;span class=&quot;error&quot;&gt;&amp;#91;127.0.0.2&amp;#93;&lt;/span&gt;&lt;/p&gt;


&lt;p&gt;whiterabbit@whiterabbit:~/cassandra/bin$ ccm node1 cqlsh&lt;br/&gt;
Connected to demo2 at 127.0.0.1:9042.&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;cqlsh 5.0.1 | Cassandra 2.1.7 | CQL spec 3.2.0 | Native protocol v3&amp;#93;&lt;/span&gt;&lt;br/&gt;
Use HELP for help.&lt;br/&gt;
cqlsh&amp;gt; describe keyspaces;&lt;/p&gt;

&lt;p&gt;system_traces  training  system&lt;/p&gt;

&lt;p&gt;cqlsh&amp;gt; &lt;/p&gt;


&lt;p&gt;Here i could see the &quot;training&quot; keyspacce showing up now. So, what is the issue that it showed the failure message earlier ? Can you help me with that.&lt;/p&gt;</comment>
                            <comment id="14608819" author="philipthompson" created="Tue, 30 Jun 2015 18:32:10 +0000"  >&lt;p&gt;I strongly suspect it is just a problem with cqlsh. I&apos;m familiar with similar bugs.&lt;/p&gt;

&lt;p&gt;Can you attach the system.log from your nodes, just to check there were no errors when creating the keyspace? If none, I&apos;ll mark this as a cqlsh bug, and assign appropriately.&lt;/p&gt;</comment>
                            <comment id="14608856" author="roopeshmajeti" created="Tue, 30 Jun 2015 18:50:17 +0000"  >&lt;p&gt;Does not look like :&lt;/p&gt;

&lt;p&gt;INFO  &lt;span class=&quot;error&quot;&gt;&amp;#91;SharedPool-Worker-1&amp;#93;&lt;/span&gt; 2015-06-30 23:26:49,896 MigrationManager.java:230 - Create new Keyspace: KSMetaData{name=training, strategyClass=SimpleStrategy, strategyOptions=&lt;/p&gt;
{replication_factor=1}
&lt;p&gt;, cfMetaData={}, durableWrites=true, userTypes=org.apache.cassandra.config.UTMetaData@7a9603ac}&lt;br/&gt;
INFO  &lt;span class=&quot;error&quot;&gt;&amp;#91;MigrationStage:1&amp;#93;&lt;/span&gt; 2015-06-30 23:26:49,916 ColumnFamilyStore.java:906 - Enqueuing flush of schema_keyspaces: 483 (0%) on-heap, 0 (0%) off-heap&lt;br/&gt;
INFO  &lt;span class=&quot;error&quot;&gt;&amp;#91;MemtableFlushWriter:3&amp;#93;&lt;/span&gt; 2015-06-30 23:26:49,963 Memtable.java:346 - Writing Memtable-schema_keyspaces@304343476(146 serialized bytes, 3 ops, 0%/0% of on/off-heap limit)&lt;br/&gt;
INFO  &lt;span class=&quot;error&quot;&gt;&amp;#91;MemtableFlushWriter:3&amp;#93;&lt;/span&gt; 2015-06-30 23:26:50,149 Memtable.java:385 - Completed flushing /home/whiterabbit/.ccm/demo2/node1/data/system/schema_keyspaces-b0f2235744583cdb9631c43e59ce3676/system-schema_keyspaces-ka-4-Data.db (161 bytes) for commitlog position ReplayPosition(segmentId=1435686886719, position=123784)&lt;br/&gt;
INFO  &lt;span class=&quot;error&quot;&gt;&amp;#91;CompactionExecutor:3&amp;#93;&lt;/span&gt; 2015-06-30 23:26:50,167 CompactionTask.java:140 - Compacting &lt;span class=&quot;error&quot;&gt;&amp;#91;SSTableReader(path=&amp;#39;/home/whiterabbit/.ccm/demo2/node1/data/system/schema_keyspaces-b0f2235744583cdb9631c43e59ce3676/system-schema_keyspaces-ka-4-Data.db&amp;#39;), SSTableReader(path=&amp;#39;/home/whiterabbit/.ccm/demo2/node1/data/system/schema_keyspaces-b0f2235744583cdb9631c43e59ce3676/system-schema_keyspaces-ka-1-Data.db&amp;#39;), SSTableReader(path=&amp;#39;/home/whiterabbit/.ccm/demo2/node1/data/system/schema_keyspaces-b0f2235744583cdb9631c43e59ce3676/system-schema_keyspaces-ka-2-Data.db&amp;#39;), SSTableReader(path=&amp;#39;/home/whiterabbit/.ccm/demo2/node1/data/system/schema_keyspaces-b0f2235744583cdb9631c43e59ce3676/system-schema_keyspaces-ka-3-Data.db&amp;#39;)&amp;#93;&lt;/span&gt;&lt;br/&gt;
INFO  &lt;span class=&quot;error&quot;&gt;&amp;#91;CompactionExecutor:3&amp;#93;&lt;/span&gt; 2015-06-30 23:26:50,361 CompactionTask.java:270 - Compacted 4 sstables to &lt;span class=&quot;error&quot;&gt;&amp;#91;/home/whiterabbit/.ccm/demo2/node1/data/system/schema_keyspaces-b0f2235744583cdb9631c43e59ce3676/system-schema_keyspaces-ka-5,&amp;#93;&lt;/span&gt;.  698 bytes to 257 (~36% of original) in 99ms = 0.002476MB/s.  5 total partitions merged to 3.  Partition merge counts were &lt;/p&gt;
{1:2, 3:1, }
</comment>
                            <comment id="14608858" author="roopeshmajeti" created="Tue, 30 Jun 2015 18:50:47 +0000"  >&lt;p&gt;The above is from node1 where i faced the error in cqlsh prompt.&lt;/p&gt;</comment>
                            <comment id="14608991" author="thobbs" created="Tue, 30 Jun 2015 20:17:48 +0000"  >&lt;p&gt;I imagine this is caused by the python driver not refreshing the schema metadata while there is a schema disagreement.  On startup cqlsh forces the driver to ignore schema disagreements to ensure that some schema metadata is populated, even if it&apos;s not perfectly correct.  However, we don&apos;t do the same thing for later schema disagreements.&lt;/p&gt;

&lt;p&gt;I think the best solution is for cqlsh to refresh schema metadata regardless of schema disagreement, but it should probably also print a warning about the schema disagreement.  The warning could mention that down nodes may cause the disagreement.&lt;/p&gt;</comment>
                            <comment id="14724314" author="pauloricardomg" created="Mon, 31 Aug 2015 22:46:59 +0000"  >&lt;p&gt;Attached 2.1 and 2.2+ patches..&lt;/p&gt;

&lt;p&gt;Based on Tyler&apos;s suggestion the solution checks if there&apos;s a schema mismatch after a &lt;tt&gt;OperationTimedOut&lt;/tt&gt; exception and in positive case, the schema metadata is reloaded with &lt;tt&gt;cluster.refresh_schema_metadata(max_schema_agreement_wait=0)&lt;/tt&gt;, which was implemented on &lt;a href=&quot;https://datastax-oss.atlassian.net/browse/PYTHON-205&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;PYTHON-205&lt;/a&gt; and effectively bypasses schema agreement during metadata refresh. This guarantees that the subsequent operation will (which can be a &lt;tt&gt;describe keyspaces&lt;/tt&gt; or &lt;tt&gt;describe tables&lt;/tt&gt;) will have the most recent schema version. It&apos;s also printed a warning about the schema disagreement.&lt;/p&gt;

&lt;p&gt;I also replaced the workaround for &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-8512&quot; title=&quot;cqlsh unusable after encountering schema mismatch&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-8512&quot;&gt;&lt;del&gt;CASSANDRA-8512&lt;/del&gt;&lt;/a&gt; (created before &lt;a href=&quot;https://datastax-oss.atlassian.net/browse/PYTHON-205&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;PYTHON-205&lt;/a&gt; was implemented)  by using the new python driver`s method &lt;tt&gt;cluster.refresh_schema_metadata(max_schema_agreement_wait=0)&lt;/tt&gt;.&lt;/p&gt;

&lt;p&gt;I created a &lt;a href=&quot;https://github.com/riptano/cassandra-dtest/pull/522&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;cassandra dtest PR&lt;/a&gt; with a simple test to validate the scenario of this ticket and the new metadata refresh behavior.&lt;/p&gt;

&lt;p&gt;Tests:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/paulomotta/job/pauloricardomg-9689-2.1-dtest/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;2.1 dtests&lt;/a&gt;&lt;/li&gt;
	&lt;li&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/paulomotta/job/pauloricardomg-9689-2.1-testall/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;2.1 testall&lt;/a&gt;&lt;/li&gt;
	&lt;li&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/paulomotta/job/pauloricardomg-9689-2.2-dtest/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;2.2 dtests&lt;/a&gt;&lt;/li&gt;
	&lt;li&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/paulomotta/job/pauloricardomg-9689-2.2-testall/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;2.2 testall&lt;/a&gt;&lt;/li&gt;
	&lt;li&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/paulomotta/job/pauloricardomg-9689-3.0-dtest/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;3.0 dtests&lt;/a&gt;&lt;/li&gt;
	&lt;li&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/paulomotta/job/pauloricardomg-9689-3.0-testall/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;3.0 testall&lt;/a&gt;&lt;/li&gt;
	&lt;li&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/paulomotta/job/pauloricardomg-9689-trunk-dtest/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;trunk dtests&lt;/a&gt;&lt;/li&gt;
	&lt;li&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/paulomotta/job/pauloricardomg-9689-trunk-testall/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;trunk testall&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Would you mind reviewing &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=blerer&quot; class=&quot;user-hover&quot; rel=&quot;blerer&quot;&gt;blerer&lt;/a&gt;?&lt;/p&gt;</comment>
                            <comment id="14731285" author="blerer" created="Fri, 4 Sep 2015 19:23:04 +0000"  >&lt;p&gt;+1&lt;/p&gt;</comment>
                            <comment id="14731316" author="blerer" created="Fri, 4 Sep 2015 19:42:53 +0000"  >&lt;p&gt;commit: acdbdc28c4fc449219422a84b10df779e740baef&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12762616">CASSANDRA-8512</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12911958">CASSANDRA-10686</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[pauloricardomg]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 11 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2gp6n:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12311421" key="com.atlassian.jira.plugin.system.customfieldtypes:multiversion">
                        <customfieldname>Reproduced In</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="12332753">2.1.7</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>blerer</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[blerer]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12962"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>