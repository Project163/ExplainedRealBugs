<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 22:45:13 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-7120] Bad paging state returned for prepared statements for last page</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-7120</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;When executing a paged query with a prepared statement, a non-null paging state is sometimes being returned for the final page, causing an endless paging loop.&lt;/p&gt;

&lt;p&gt;Specifically, this is the schema being used:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;    CREATE KEYSPACE test3rf WITH replication = {&apos;class&apos;: &apos;SimpleStrategy&apos;, &apos;replication_factor&apos;: &apos;3&apos;}&apos;;
    USE test3rf;
    CREATE TABLE test3rf.test (
                k int PRIMARY KEY,
                v int
    )
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The inserts are like so:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;INSERT INTO test3rf.test (k, v) VALUES (?, 0)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;With values from &lt;span class=&quot;error&quot;&gt;&amp;#91;0, 99&amp;#93;&lt;/span&gt; used for k.&lt;/p&gt;

&lt;p&gt;The query is &lt;tt&gt;SELECT * FROM test3rf.test&lt;/tt&gt; with a fetch size of 3.&lt;/p&gt;

&lt;p&gt;The final page returns the row with k=3, and the paging state is &lt;tt&gt;0004000000420004000176007fffffa2&lt;/tt&gt;.  This matches the paging state from three pages earlier.  When executing this with a non-prepared statement, no paging state is returned for this page.&lt;/p&gt;

&lt;p&gt;This problem doesn&apos;t happen with the 2.0 branch.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12711527">CASSANDRA-7120</key>
            <summary>Bad paging state returned for prepared statements for last page</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10002" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Normal</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="slebresne">Sylvain Lebresne</assignee>
                                    <reporter username="thobbs">Tom Hobbs</reporter>
                        <labels>
                    </labels>
                <created>Wed, 30 Apr 2014 17:34:06 +0000</created>
                <updated>Tue, 16 Apr 2019 09:31:47 +0000</updated>
                            <resolved>Fri, 23 May 2014 07:35:13 +0000</resolved>
                                        <fixVersion>2.1 rc1</fixVersion>
                                    <component>Legacy/CQL</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="13995839" author="rhatch" created="Tue, 13 May 2014 00:06:21 +0000"  >&lt;p&gt;If there&apos;s a way to repro this 100% of the time, I&apos;d like to add it to the jython paging tests (&lt;a href=&quot;https://github.com/riptano/cassandra-dtest-jython&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/riptano/cassandra-dtest-jython&lt;/a&gt;).&lt;/p&gt;</comment>
                            <comment id="13996768" author="thobbs" created="Tue, 13 May 2014 18:50:29 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rhatch&quot; class=&quot;user-hover&quot; rel=&quot;rhatch&quot;&gt;rhatch&lt;/a&gt; yes, this reproduces 100% of the time.  You could make a version of the &lt;tt&gt;test_paging()&lt;/tt&gt; method here: &lt;a href=&quot;https://github.com/datastax/python-driver/blob/master/tests/integration/standard/test_query_paging.py#L48&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/datastax/python-driver/blob/master/tests/integration/standard/test_query_paging.py#L48&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14005173" author="thobbs" created="Wed, 21 May 2014 20:17:31 +0000"  >&lt;p&gt;The problem was that a single ResultSet.Metadata instance was being reused for every execution of a prepared statement.  If the paging state was not explicitly updated, the state from the previous execution was used.&lt;/p&gt;

&lt;p&gt;The attached patch (and &lt;a href=&quot;https://github.com/thobbs/cassandra/tree/CASSANDRA-7120&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;branch&lt;/a&gt;) fixes that and adds a related assertion.&lt;/p&gt;</comment>
                            <comment id="14005790" author="slebresne" created="Thu, 22 May 2014 09:41:47 +0000"  >&lt;p&gt;I don&apos;t think just copying the Metadata.names as the patch does works because it loses the Metadata.columnCount which can be different from the names size (due to &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-4911&quot; title=&quot;Lift limitation that order by columns must be selected for IN queries&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-4911&quot;&gt;&lt;del&gt;CASSANDRA-4911&lt;/del&gt;&lt;/a&gt; and more precisely following call to Metadata#addNonSerializedColumn). We could add some clone() method that preserve this, though I&apos;d have a minor preference for saving the reallocation of a Metadata object when no paging is involved (that&apos;s the common case and the one we should optimize for). So attaching an aternative patch that makes the paging state final and creates a new Metadata object when we need to attach a paging state.&lt;/p&gt;</comment>
                            <comment id="14006128" author="thobbs" created="Thu, 22 May 2014 17:02:38 +0000"  >&lt;p&gt;+1&lt;/p&gt;</comment>
                            <comment id="14006949" author="slebresne" created="Fri, 23 May 2014 07:35:13 +0000"  >&lt;p&gt;Committed, thanks&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12777967">CASSANDRA-8871</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12646262" name="7120-alternative.txt" size="8001" author="slebresne" created="Thu, 22 May 2014 09:41:47 +0000"/>
                            <attachment id="12646092" name="7120.txt" size="3328" author="thobbs" created="Wed, 21 May 2014 20:17:31 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[slebresne]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>389848</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            11 years, 26 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1v5fz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>390089</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12311421" key="com.atlassian.jira.plugin.system.customfieldtypes:multiversion">
                        <customfieldname>Reproduced In</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="12326275">2.1 beta1</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>thobbs</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[thobbs]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12962"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>