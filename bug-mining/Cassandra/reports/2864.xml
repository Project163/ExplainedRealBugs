<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 22:45:29 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-7330] Infinite loop in StreamReader.read during exception condition while running repair</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-7330</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;InputStream.skip is returning -1 during exception conditions which leads the following logic to infinite loop:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeHeader panelHeader&quot; style=&quot;border-bottom-width: 1px;&quot;&gt;&lt;b&gt;loop&lt;/b&gt;&lt;/div&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;protected&lt;/span&gt; void drain(InputStream dis, &lt;span class=&quot;code-object&quot;&gt;long&lt;/span&gt; bytesRead) &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; IOException
{
    &lt;span class=&quot;code-object&quot;&gt;long&lt;/span&gt; toSkip = totalSize() - bytesRead;
    toSkip = toSkip - dis.skip(toSkip);
    &lt;span class=&quot;code-keyword&quot;&gt;while&lt;/span&gt; (toSkip &amp;gt; 0)
        toSkip = toSkip - dis.skip(toSkip);
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment>&lt;p&gt;2.0.8+&lt;/p&gt;</environment>
        <key id="12717652">CASSANDRA-7330</key>
            <summary>Infinite loop in StreamReader.read during exception condition while running repair</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10003" iconUrl="https://issues.apache.org/jira/images/icons/priorities/trivial.svg">Low</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="jmckenzie">Josh McKenzie</assignee>
                                    <reporter username="jmckenzie">Josh McKenzie</reporter>
                        <labels>
                            <label>Core</label>
                    </labels>
                <created>Fri, 30 May 2014 21:02:45 +0000</created>
                <updated>Wed, 15 Oct 2025 09:49:03 +0000</updated>
                            <resolved>Tue, 3 Jun 2014 06:15:39 +0000</resolved>
                                        <fixVersion>2.0.9</fixVersion>
                                    <component>Legacy/Streaming and Messaging</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="14015059" author="jmckenzie" created="Sun, 1 Jun 2014 18:38:19 +0000"  >&lt;p&gt;Attaching a v1 that checks for -1 on drain and breaks if caught.&lt;/p&gt;

&lt;p&gt;Generates the following exception which I&apos;ll want to track down - putting this v1 here for reference on &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-3569&quot; title=&quot;Failure detector downs should not break streams&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-3569&quot;&gt;&lt;del&gt;CASSANDRA-3569&lt;/del&gt;&lt;/a&gt; as it&apos;s a dependency for testing.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeHeader panelHeader&quot; style=&quot;border-bottom-width: 1px;&quot;&gt;&lt;b&gt;exception&lt;/b&gt;&lt;/div&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;ERROR 18:32:15 Exception in thread &lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;[NonPeriodicTasks:1,5,main]
java.lang.AssertionError: &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;
        at org.apache.cassandra.io.util.Memory.free(Memory.java:299) ~[main/:na]
        at org.apache.cassandra.utils.obs.OffHeapBitSet.close(OffHeapBitSet.java:143) ~[main/:na]
        at org.apache.cassandra.utils.BloomFilter.close(BloomFilter.java:116) ~[main/:na]
        at org.apache.cassandra.io.sstable.SSTableWriter.abort(SSTableWriter.java:338) ~[main/:na]
        at org.apache.cassandra.io.sstable.SSTableWriter.abort(SSTableWriter.java:326) ~[main/:na]
        at org.apache.cassandra.streaming.StreamReceiveTask$1.run(StreamReceiveTask.java:133) ~[main/:na]
        at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:471) ~[na:1.7.0_55]
        at java.util.concurrent.FutureTask.run(FutureTask.java:262) ~[na:1.7.0_55]
        at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.access$201(ScheduledThreadPoolExecutor.java:178) ~[na:1.7.0_55]
        at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:292) ~[na:1.7.0_55]
        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1145) ~[na:1.7.0_55]
        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:615) [na:1.7.0_55]
        at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:745) [na:1.7.0_55]
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="14015218" author="krummas" created="Mon, 2 Jun 2014 07:07:28 +0000"  >&lt;p&gt;patch looks good to me, but lets wait with committing until we have the AE figured out&lt;/p&gt;</comment>
                            <comment id="14015989" author="jmckenzie" created="Mon, 2 Jun 2014 22:38:40 +0000"  >&lt;p&gt;After rebasing &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-3569&quot; title=&quot;Failure detector downs should not break streams&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-3569&quot;&gt;&lt;del&gt;CASSANDRA-3569&lt;/del&gt;&lt;/a&gt; to trunk and applying this patch I was unable to reproduce the assertion; it looks like &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-7262&quot; title=&quot;During streaming: java.lang.AssertionError: Reference counter -1&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-7262&quot;&gt;&lt;del&gt;CASSANDRA-7262&lt;/del&gt;&lt;/a&gt; cleared this problem up.  Prior to StreamSession.closeSession() being idempotent, multiple calls to StreamReceiveTask.abort() were being processed leading to duplicate frees and the assertion in Memory.java.&lt;/p&gt;</comment>
                            <comment id="14016256" author="krummas" created="Tue, 3 Jun 2014 06:15:39 +0000"  >&lt;p&gt;committed&lt;/p&gt;</comment>
                            <comment id="14053093" author="dv1983" created="Sun, 6 Jul 2014 11:11:03 +0000"  >&lt;p&gt;Gents, I had a bad situation in some cassandra (2.0.7) nodes, when they were eaten all CPU during streaming (during joining node or repairing procedure).&lt;br/&gt;
The result is - a huge cpu loading of nodes, slow responses, mistakes in OpsCenter, slow service...&lt;br/&gt;
I didn&apos;t find anything useful in logs, any weird WARNs or ERRORs. Cassandra behavour is similar to infinite loop, node manual restarting solves the situation. That&apos;s why I decided to write here.&lt;/p&gt;

&lt;p&gt;Can be my situation is the same with yours or it is a different sitatuon?&lt;/p&gt;

&lt;p&gt;P.S.: I&apos;ll monitor similar problems with Cassandra 2.0.9, of course.&lt;/p&gt;</comment>
                            <comment id="14053661" author="jmckenzie" created="Mon, 7 Jul 2014 13:48:29 +0000"  >&lt;p&gt;Without more information it&apos;s going to be impossible to tell.  If it were this specific situation you&apos;d see the failed assertion as the node transitioned into a bad state w/regards to the ref count on that sstable and then started spinning.&lt;/p&gt;

&lt;p&gt;In the future, if you can get a sampling of a few jstacks from the process and/or connect via JMX to see what threads are eating CPU, that would help us narrow down what could be going wrong.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12647825" name="7330_v1.txt" size="989" author="joshuamckenzie" created="Sun, 1 Jun 2014 18:38:19 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[jmckenzie]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>395856</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            11 years, 20 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1w5if:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>395973</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>marcuse</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[marcuse]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12961"><![CDATA[Low]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>