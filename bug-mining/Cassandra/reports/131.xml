<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 22:11:14 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-370] Commit log replay issues</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-370</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;I&apos;ve been having a bunch of trouble replaying commit logs. I&apos;ve seen various exceptions, including:&lt;/p&gt;

&lt;p&gt;java.lang.NegativeArraySizeException&lt;br/&gt;
        at org.apache.cassandra.db.CommitLog.recover(CommitLog.java:273)&lt;br/&gt;
        at org.apache.cassandra.db.RecoveryManager.doRecovery(RecoveryManager.java:63)&lt;br/&gt;
        at org.apache.cassandra.service.CassandraDaemon.setup(CassandraDaemon.java:95)&lt;br/&gt;
        at org.apache.cassandra.service.CassandraDaemon.main(CassandraDaemon.java:156)&lt;br/&gt;
Exception encountered during startup.&lt;br/&gt;
java.lang.NegativeArraySizeException&lt;br/&gt;
        at org.apache.cassandra.db.CommitLog.recover(CommitLog.java:273)&lt;br/&gt;
        at org.apache.cassandra.db.RecoveryManager.doRecovery(RecoveryManager.java:63)&lt;br/&gt;
        at org.apache.cassandra.service.CassandraDaemon.setup(CassandraDaemon.java:95)&lt;br/&gt;
        at org.apache.cassandra.service.CassandraDaemon.main(CassandraDaemon.java:156)&lt;/p&gt;

&lt;p&gt;I also got this:&lt;/p&gt;

&lt;p&gt;java.lang.RuntimeException: Unable to load comparator class &apos;org.apache.cassandra.db.marshal.UTF8Typ&apos;.  probably this means you have obsolete sstables lying around&lt;br/&gt;
        at org.apache.cassandra.db.ColumnFamily$ColumnFamilySerializer.readComparator(ColumnFamily.java:525)&lt;br/&gt;
        at org.apache.cassandra.db.ColumnFamily$ColumnFamilySerializer.deserializeEmpty(ColumnFamily.java:535)&lt;br/&gt;
        at org.apache.cassandra.db.ColumnFamily$ColumnFamilySerializer.deserialize(ColumnFamily.java:500)&lt;br/&gt;
        at org.apache.cassandra.db.RowSerializer.deserialize(Row.java:225)&lt;br/&gt;
        at org.apache.cassandra.db.CommitLog.recover(CommitLog.java:284)&lt;br/&gt;
        at org.apache.cassandra.db.RecoveryManager.doRecovery(RecoveryManager.java:63)&lt;br/&gt;
        at org.apache.cassandra.service.CassandraDaemon.setup(CassandraDaemon.java:95)&lt;br/&gt;
        at org.apache.cassandra.service.CassandraDaemon.main(CassandraDaemon.java:156)&lt;br/&gt;
Caused by: java.lang.ClassNotFoundException: org/apache/cassandra/db/marshal/UTF8Typ&lt;br/&gt;
        at java.lang.Class.forName0(Native Method)&lt;br/&gt;
        at java.lang.Class.forName(Class.java:169)&lt;br/&gt;
        at org.apache.cassandra.db.ColumnFamily$ColumnFamilySerializer.readComparator(ColumnFamily.java:521)&lt;br/&gt;
        ... 7 more&lt;/p&gt;

&lt;p&gt;and this:&lt;/p&gt;

&lt;p&gt;java.io.EOFException&lt;br/&gt;
        at java.io.DataInputStream.readUnsignedShort(DataInputStream.java:323)&lt;br/&gt;
        at java.io.DataInputStream.readUTF(DataInputStream.java:572)&lt;br/&gt;
        at java.io.DataInputStream.readUTF(DataInputStream.java:547)&lt;br/&gt;
        at org.apache.cassandra.db.RowSerializer.deserialize(Row.java:218)&lt;br/&gt;
        at org.apache.cassandra.db.CommitLog.recover(CommitLog.java:284)&lt;br/&gt;
        at org.apache.cassandra.db.RecoveryManager.doRecovery(RecoveryManager.java:63)&lt;br/&gt;
        at org.apache.cassandra.service.CassandraDaemon.setup(CassandraDaemon.java:95)&lt;br/&gt;
        at org.apache.cassandra.service.CassandraDaemon.main(CassandraDaemon.java:156)&lt;br/&gt;
Exception encountered during startup.&lt;/p&gt;

&lt;p&gt;Not sure if any of them are related.&lt;/p&gt;</description>
                <environment>&lt;p&gt;OS X 10.5.7&lt;/p&gt;</environment>
        <key id="12433347">CASSANDRA-370</key>
            <summary>Commit log replay issues</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10000" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Urgent</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="jbellis">Jonathan Ellis</assignee>
                                    <reporter username="jamesgolick">James Golick</reporter>
                        <labels>
                    </labels>
                <created>Tue, 18 Aug 2009 16:41:24 +0000</created>
                <updated>Tue, 16 Apr 2019 09:33:35 +0000</updated>
                            <resolved>Mon, 24 Aug 2009 22:03:54 +0000</resolved>
                                        <fixVersion>0.4</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                                                                <comments>
                            <comment id="12744615" author="jbellis" created="Tue, 18 Aug 2009 17:43:59 +0000"  >&lt;p&gt;02&lt;br/&gt;
    read(bytes) doesn&apos;t automatically throw EOFException if it reads less than asked for, so we need to check for that maniually&lt;/p&gt;

&lt;p&gt;01&lt;br/&gt;
    avoid opening multiple writers for the current file; the buffered nature of the global&lt;br/&gt;
    logWriter_ could cause problems&lt;/p&gt;

&lt;p&gt;james, in all likelihood the problem fixed by 02 is what you were running into, and that patch should fix replaying your old commitlog as-is (magic! &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="12747045" author="sammy.yu" created="Mon, 24 Aug 2009 20:12:00 +0000"  >&lt;p&gt;+1 on both 0001 and 0002 patches&lt;/p&gt;</comment>
                            <comment id="12747055" author="jbellis" created="Mon, 24 Aug 2009 20:33:01 +0000"  >&lt;p&gt;committed&lt;/p&gt;</comment>
                            <comment id="12747082" author="jbellis" created="Mon, 24 Aug 2009 21:14:11 +0000"  >&lt;p&gt;patch 01 causes issues.  reverted.  (02 is still applied.)&lt;/p&gt;</comment>
                            <comment id="12747086" author="jbellis" created="Mon, 24 Aug 2009 21:30:57 +0000"  >&lt;p&gt;fixed &amp;#8211; wasn&apos;t seeking back to current-end-of-CL in the header update code, so it would start clobbering the hell out of itself as soon as that code path ran.&lt;/p&gt;</comment>
                            <comment id="12747099" author="sammy.yu" created="Mon, 24 Aug 2009 21:57:28 +0000"  >&lt;p&gt;01-fixed.diff +1   Tested it for real this time.  Unit test passes and our production system no longer exhibits this bad behavior.&lt;/p&gt;

</comment>
                            <comment id="12747102" author="jbellis" created="Mon, 24 Aug 2009 22:03:54 +0000"  >&lt;p&gt;committed&lt;/p&gt;</comment>
                            <comment id="12747434" author="hudson" created="Tue, 25 Aug 2009 14:21:27 +0000"  >&lt;p&gt;Integrated in Cassandra #177 (See &lt;a href=&quot;http://hudson.zones.apache.org/hudson/job/Cassandra/177/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://hudson.zones.apache.org/hudson/job/Cassandra/177/&lt;/a&gt;)&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;fixed version&amp;#93;&lt;/span&gt; avoid opening multiple writers for the current file; the buffered nature of the global logWriter_ could cause problems&lt;br/&gt;
patch by jbellis; reviewed for  by Sammy Yu&lt;br/&gt;
Revert &quot; avoid opening multiple writers for the current file; the buffered nature of the global logWriter_ could cause problems&quot;&lt;br/&gt;
read(bytes) doesn&apos;t automatically throw EOFException if it reads less than asked for, so we need to check for that.&lt;br/&gt;
patch by jbellis; reviewed by Sammy Yu for &lt;br/&gt;
 avoid opening multiple writers for the current file; the buffered nature of the global logWriter_ could cause problems&lt;br/&gt;
patch by jbellis; reviewed by Sammy Yu for &lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12417530" name="01-fixed.diff" size="1955" author="jbellis" created="Mon, 24 Aug 2009 21:30:57 +0000"/>
                            <attachment id="12416896" name="ASF.LICENSE.NOT.GRANTED--0001-CASSANDRA-370-avoid-opening-multiple-writers-for-the-c.txt" size="3240" author="jbellis" created="Tue, 18 Aug 2009 17:41:22 +0000"/>
                            <attachment id="12416897" name="ASF.LICENSE.NOT.GRANTED--0002-read-bytes-doesn-t-automatically-throw-EOFException-i.txt" size="1234" author="jbellis" created="Tue, 18 Aug 2009 17:41:22 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[jbellis]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>19655</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            16 years, 14 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0fyiv:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>91191</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12963"><![CDATA[Critical]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>