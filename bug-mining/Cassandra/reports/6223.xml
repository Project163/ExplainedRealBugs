<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 23:27:05 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-17913] Nested selection of reversed collections fails</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-17913</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;The following test fails caused by the fact we make reversed a type that wraps the underline type&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
@Test
    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void testMapsReversed() &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; Throwable
    {
        createTable(&lt;span class=&quot;code-quote&quot;&gt;&quot;CREATE TABLE %s (&quot;&lt;/span&gt; +
                    &lt;span class=&quot;code-quote&quot;&gt;&quot;   k &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;, &quot;&lt;/span&gt; +
                    &lt;span class=&quot;code-quote&quot;&gt;&quot;   c frozen&amp;lt;map&amp;lt;text, &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;&amp;gt;&amp;gt;, &quot;&lt;/span&gt; +
                    &lt;span class=&quot;code-quote&quot;&gt;&quot;   v &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;, &quot;&lt;/span&gt; +
                    &lt;span class=&quot;code-quote&quot;&gt;&quot;   PRIMARY KEY(k, c)&quot;&lt;/span&gt; +
                    &lt;span class=&quot;code-quote&quot;&gt;&quot;) WITH CLUSTERING ORDER BY (c DESC)&quot;&lt;/span&gt;);

        execute(&lt;span class=&quot;code-quote&quot;&gt;&quot;SELECT c[&lt;span class=&quot;code-quote&quot;&gt;&apos;testing&apos;&lt;/span&gt;] FROM %s&quot;&lt;/span&gt;);
    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;With the error&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
org.apache.cassandra.exceptions.InvalidRequestException: Invalid element selection: c is of type frozen&amp;lt;map&amp;lt;text, &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;&amp;gt;&amp;gt; is not a collection
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;When you look in a debugger you see that the real type is ReversedType(MapType(&#8230;)), so the current checks fail.&lt;/p&gt;

&lt;p&gt;&lt;ins&gt;Additional information for newcomers&lt;/ins&gt;:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;The problem impact element selection as well as range selection that where introduced in &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-7396&quot; title=&quot;Allow selecting Map values and Set elements&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-7396&quot;&gt;&lt;del&gt;CASSANDRA-7396&lt;/del&gt;&lt;/a&gt; as part of 4.0. So the patch will need to be done for 4.0.&lt;/li&gt;
	&lt;li&gt;The checks that needs to be modified is in &lt;tt&gt;Selectable.WithElementSelection&lt;/tt&gt; and &lt;tt&gt;Selectable.WithSliceSelection&lt;/tt&gt;&lt;/li&gt;
	&lt;li&gt;The unit tests should be added to &lt;tt&gt;CollectionsTest&lt;/tt&gt;&lt;/li&gt;
&lt;/ul&gt;
</description>
                <environment></environment>
        <key id="13482624">CASSANDRA-17913</key>
            <summary>Nested selection of reversed collections fails</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10002" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Normal</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="masokol">Maciej Sokol</assignee>
                                    <reporter username="dcapwell">David Capwell</reporter>
                        <labels>
                    </labels>
                <created>Wed, 21 Sep 2022 16:31:34 +0000</created>
                <updated>Tue, 12 Sep 2023 13:03:11 +0000</updated>
                            <resolved>Fri, 14 Apr 2023 10:16:31 +0000</resolved>
                                        <fixVersion>4.0.10</fixVersion>
                    <fixVersion>4.1.2</fixVersion>
                    <fixVersion>5.0-alpha1</fixVersion>
                    <fixVersion>5.0</fixVersion>
                                    <component>Consistency/Coordination</component>
                    <component>CQL/Semantics</component>
                    <component>Legacy/Local Write-Read Paths</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                    <progress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                            <timeestimate seconds="0">0h</timeestimate>
                            <timespent seconds="4800">1h 20m</timespent>
                                <comments>
                            <comment id="17607868" author="dcapwell" created="Wed, 21 Sep 2022 16:44:30 +0000"  >&lt;p&gt;This was found in fuzz testing for the Accord Transaction syntax patch (&lt;a href=&quot;https://github.com/maedhroz/cassandra/pull/4&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/maedhroz/cassandra/pull/4&lt;/a&gt;), for now Accord Fuzz tests need to ignore Reversed Types as normal read/write path has issues...&lt;/p&gt;</comment>
                            <comment id="17629721" author="JIRAUSER285315" created="Mon, 7 Nov 2022 09:47:21 +0000"  >&lt;p&gt;&lt;a href=&quot;https://github.com/apache/cassandra/pull/1978&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;PR for 4.0&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;I&apos;m kinda new to this part of the code, i&apos;ve added unittests for these changes to test different scenarios.&lt;/p&gt;

&lt;p&gt;All tests in CollectionsTest are running green for me.&lt;/p&gt;

&lt;p&gt;I&apos;ve run circleCI but by the looks of it i don&apos;t have enough resources. I get similar failures for this PR and 4.0 branch. If someone could run CI that would be great.&lt;/p&gt;</comment>
                            <comment id="17675548" author="brandon.williams" created="Wed, 11 Jan 2023 12:33:33 +0000"  >&lt;p&gt;&lt;a href=&quot;https://app.circleci.com/pipelines/github/driftx/cassandra/748/workflows/a447f23b-f64a-4bf7-98df-fc10a4f3b797&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;Here&lt;/a&gt; is a circle j8 run for 4.0.&lt;/p&gt;</comment>
                            <comment id="17692731" author="brandon.williams" created="Thu, 23 Feb 2023 15:13:40 +0000"  >&lt;p&gt;This looks good to me if you want to go ahead with 4.1 and trunk patches to get this finished.&lt;/p&gt;</comment>
                            <comment id="17711442" author="smiklosovic" created="Wed, 12 Apr 2023 15:20:38 +0000"  >&lt;p&gt;I wrote &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=masokol&quot; class=&quot;user-hover&quot; rel=&quot;masokol&quot;&gt;masokol&lt;/a&gt; privately and he agreed with myself finishing that.&lt;/p&gt;

&lt;p&gt;PRs are here:&lt;/p&gt;

&lt;p&gt;4.0 &lt;a href=&quot;https://github.com/apache/cassandra/pull/2271&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/cassandra/pull/2271&lt;/a&gt;&lt;br/&gt;
4.1 &lt;a href=&quot;https://github.com/apache/cassandra/pull/2270&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/cassandra/pull/2270&lt;/a&gt;&lt;br/&gt;
trunk &lt;a href=&quot;https://github.com/apache/cassandra/pull/2272&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/cassandra/pull/2272&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;There are subtle differences between all branches. In trunk, type is set in constructor but in 4.1 it is not. I extracted common logic to a method so there is not code duplication - in ElementSelector. I left changes in Selectable as they were originally introduced by Maciej. Classes in Selectable are just implementing Selectable, not an abstract class, and extracting that logic to that interface seems just strange.&lt;/p&gt;

&lt;p&gt;I am building it as I write this.&lt;/p&gt;</comment>
                            <comment id="17711778" author="smiklosovic" created="Thu, 13 Apr 2023 09:29:30 +0000"  >&lt;p&gt;4.0 &lt;a href=&quot;https://github.com/apache/cassandra/pull/2271&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/cassandra/pull/2271&lt;/a&gt;&lt;br/&gt;
4.1 &lt;a href=&quot;https://github.com/apache/cassandra/pull/2270&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/cassandra/pull/2270&lt;/a&gt;&lt;br/&gt;
trunk &lt;a href=&quot;https://github.com/apache/cassandra/pull/2272&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/cassandra/pull/2272&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;4.0 &lt;a href=&quot;https://ci-cassandra.apache.org/view/patches/job/Cassandra-devbranch/2421/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://ci-cassandra.apache.org/view/patches/job/Cassandra-devbranch/2421/&lt;/a&gt;&lt;br/&gt;
4.1 &lt;a href=&quot;https://ci-cassandra.apache.org/view/patches/job/Cassandra-devbranch/2424/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://ci-cassandra.apache.org/view/patches/job/Cassandra-devbranch/2424/&lt;/a&gt;&lt;br/&gt;
trunk &lt;a href=&quot;https://ci-cassandra.apache.org/view/patches/job/Cassandra-devbranch/2423/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://ci-cassandra.apache.org/view/patches/job/Cassandra-devbranch/2423/&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17711933" author="brandon.williams" created="Thu, 13 Apr 2023 14:57:48 +0000"  >&lt;p&gt;Doublechecked with circle and also repeated the new tests:&lt;/p&gt;

&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;Branch&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;CI&lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/driftx/cassandra/tree/CASSANDRA-17913-4.0&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;4.0&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://app.circleci.com/pipelines/github/driftx/cassandra/973/workflows/fd8f4eb8-478f-4bd2-9ab6-0ae2f5041197&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;j8&lt;/a&gt;, &lt;a href=&quot;https://app.circleci.com/pipelines/github/driftx/cassandra/973/workflows/9c320e3e-f6f2-4743-9e5c-d220f99b6fd4&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;j11&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/driftx/cassandra/tree/CASSANDRA-17913-4.1&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;4.1&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://app.circleci.com/pipelines/github/driftx/cassandra/972/workflows/67ae6f03-237a-4292-bad6-50587342216a&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;j8&lt;/a&gt;, &lt;a href=&quot;https://app.circleci.com/pipelines/github/driftx/cassandra/972/workflows/d36492c2-dfe7-4742-8174-c13a1fda247b&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;j11&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/driftx/cassandra/tree/CASSANDRA-17913-trunk&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;trunk&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://app.circleci.com/pipelines/github/driftx/cassandra/971/workflows/639a4f14-64f5-4583-8908-9a759f51459b&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;j8&lt;/a&gt;, &lt;a href=&quot;https://app.circleci.com/pipelines/github/driftx/cassandra/971/workflows/f0ccbda0-2f3c-4823-9516-7747a69861b8&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;j11&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;


&lt;p&gt;No related failures, +1.&lt;/p&gt;</comment>
                            <comment id="17712314" author="smiklosovic" created="Fri, 14 Apr 2023 10:18:26 +0000"  >&lt;p&gt;note: change fix version to 4.0.10 when such version is available to choose. &lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[masokol]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12313825" key="com.atlassian.jira.plugin.system.customfieldtypes:cascadingselect">
                        <customfieldname>Bug Category</customfieldname>
                        <customfieldvalues>
                                                    <customfieldvalue key="12982" cascade-level=""><![CDATA[Correctness]]></customfieldvalue>
                                <customfieldvalue key="13161" cascade-level="1"><![CDATA[Unrecoverable Corruption / Loss]]></customfieldvalue>
            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12313821" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Complexity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12965"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313822" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Discovered By</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12972"><![CDATA[Fuzz Test]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12313922" key="jira.plugin.projectspecificselectfield.jpssf:multicftype">
                        <customfieldname>Impacts</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="13100"><![CDATA[None]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            2 years, 30 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12313921" key="jira.plugin.projectspecificselectfield.jpssf:multicftype">
                        <customfieldname>Platform</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="13076"><![CDATA[All]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z18qtc:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12962"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12311420" key="com.atlassian.jira.plugin.system.customfieldtypes:version">
                        <customfieldname>Since Version</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="12350367">4.0.0</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313924" key="com.atlassian.jira.plugin.system.customfieldtypes:textfield">
                        <customfieldname>Source Control Link</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>&lt;p&gt;&lt;a href=&quot;https://github.com/apache/cassandra/commit/2fce3025c448316720d9cf7447fe7d1d34e17625&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/cassandra/commit/2fce3025c448316720d9cf7447fe7d1d34e17625&lt;/a&gt;&lt;/p&gt;</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313823" key="com.atlassian.jira.plugin.system.customfieldtypes:textarea">
                        <customfieldname>Test and Documentation Plan</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>&lt;p&gt;unittests&lt;/p&gt;</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>