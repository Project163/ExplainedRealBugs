<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 23:13:47 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-14592] Reconcile should not be dependent on nowInSec</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-14592</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;To have the arrival time of a mutation on a replica determine the reconciliation priority seems to provide for unintuitive database behaviour.&#160; It seems we should formalise our reconciliation logic in a manner that does not depend on this, and modify our internal APIs to prevent this dependency.&lt;br/&gt;
&#160;&lt;br/&gt;
Take the following example, where both writes have the same timestamp:&lt;br/&gt;
&#160;&lt;br/&gt;
Write X with a value A, TTL of 1s&lt;br/&gt;
Write Y with a value B, no TTL&lt;br/&gt;
&#160;&lt;br/&gt;
If X and Y arrive on replicas in &amp;lt; 1s, X and Y are both live, so record Y wins the reconciliation.&#160; The value B appears in the database.&lt;br/&gt;
However, if X and Y arrive on replicas in &amp;gt; 1s, X is now (effectively) a tombstone.&#160; This wins the reconciliation race, and NO value is the result.&lt;br/&gt;
&#160;&lt;br/&gt;
Note that the weirdness of this is more pronounced than it might first appear.&#160; If write X gets stuck in hints for a period on the coordinator to one replica, the value B appears in the database until the hint is replayed.&#160; So now we&#8217;re in a very uncertain state - will hints get replayed or not?&#160; If they do, the value B will disappear; if they don&#8217;t it won&#8217;t.&#160; This is despite a QUORUM of replicas ACKing both writes, and a QUORUM of readers being engaged on read; the database still changes state to the user suddenly at some arbitrary future point in time.&lt;br/&gt;
&#160;&lt;br/&gt;
It seems to me that a simple solution to this, is to permit TTL&#8217;d data to always win a reconciliation against non-TTL&#8217;d data (of same timestamp), so that we are consistent across TTLs being transformed into tombstones.&lt;br/&gt;
&#160;&lt;br/&gt;
4.0 seems like a good opportunity to fix this behaviour, and mention in CHANGES.txt.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13174399">CASSANDRA-14592</key>
            <summary>Reconcile should not be dependent on nowInSec</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10002" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Normal</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="benedict">Benedict Elliott Smith</assignee>
                                    <reporter username="benedict">Benedict Elliott Smith</reporter>
                        <labels>
                    </labels>
                <created>Wed, 25 Jul 2018 16:04:35 +0000</created>
                <updated>Fri, 15 May 2020 08:04:48 +0000</updated>
                            <resolved>Thu, 23 Aug 2018 13:16:47 +0000</resolved>
                                        <fixVersion>4.0-alpha1</fixVersion>
                    <fixVersion>4.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="16564320" author="benedict" created="Tue, 31 Jul 2018 20:14:27 +0000"  >&lt;p&gt;&lt;a href=&quot;https://github.com/belliottsmith/cassandra/tree/CASSANDRA-14592&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;patch&lt;/a&gt;, &lt;a href=&quot;https://circleci.com/workflow-run/8eed6e83-be3d-473c-9390-8e908e84bcfd&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;Circle CI&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16587593" author="benedict" created="Tue, 21 Aug 2018 15:29:09 +0000"  >&lt;p&gt;Pushed an update that addresses (I think, it&apos;s been a while) Aleksey&apos;s offline review comments.&lt;/p&gt;

&lt;p&gt;We collaborated to modify the reconcile semantics a little further, so that reconciliation is as consistent as possible.  Now the only situations that might arise with inconsistent reconciliation occur when one cell is expiring, another is a tombstone, and only at the point where both are logically a tombstone.  Specifically, we now prefer:&lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;The most recent timestamp&lt;/li&gt;
	&lt;li&gt;If either are a tombstone or expiring
	&lt;ol&gt;
		&lt;li&gt;If one is regular, select the tombstone or expiring&lt;/li&gt;
		&lt;li&gt;If one is expiring, select the tombstone&lt;/li&gt;
		&lt;li&gt;The most recent deletion time&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
	&lt;li&gt;The highest value (by raw ByteBuffer comparison)&lt;/li&gt;
&lt;/ol&gt;
</comment>
                            <comment id="16587746" author="iamaleksey" created="Tue, 21 Aug 2018 17:00:26 +0000"  >&lt;p&gt;+1&lt;/p&gt;</comment>
                            <comment id="16590200" author="benedict" created="Thu, 23 Aug 2018 13:16:40 +0000"  >&lt;p&gt;Thanks; &lt;a href=&quot;https://github.com/apache/cassandra/commit/e225c88a65f2e8091f8ea6212c291416674882a1&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;committed to trunk&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="16590926" author="bdeggleston" created="Thu, 23 Aug 2018 23:28:43 +0000"  >&lt;p&gt;Looks like this broke &lt;tt&gt;org.apache.cassandra.db.CellTest#testExpiringCellReconile&lt;/tt&gt;. There was also a merge mixup with &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-10726&quot; title=&quot;Read repair inserts should not be blocking&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-10726&quot;&gt;&lt;del&gt;CASSANDRA-10726&lt;/del&gt;&lt;/a&gt; which I ninja&apos;d &lt;a href=&quot;https://github.com/apache/cassandra/commit/6e35cf340a4da8409482230b170a8b7546a6569b&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;here&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16590939" author="benedict" created="Thu, 23 Aug 2018 23:39:03 +0000"  >&lt;p&gt;Thanks.  I&apos;ve also ninja&apos;d the test &lt;a href=&quot;https://github.com/apache/cassandra/commit/f5adeeb8da15db0336db741bd39da46117fa9b73&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;here&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[benedict]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 12 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3w9xr:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>aleksey</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[aleksey]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12962"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>