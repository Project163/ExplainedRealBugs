<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 22:49:31 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-8208] Inconsistent failure handling with repair</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-8208</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;I think we introduced this with &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-6455&quot; title=&quot;Improve concurrency of repair process&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-6455&quot;&gt;&lt;del&gt;CASSANDRA-6455&lt;/del&gt;&lt;/a&gt;, problem is that we now treat all repair futures as a single unit (Futures.allAsList(..)) which makes the whole thing fail if one sub-future fails. Also, when one of those fail, we notify nodetool that we failed and we stop the executor with shutdownNow() which throws out any pending RepairJobs.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=yukim&quot; class=&quot;user-hover&quot; rel=&quot;yukim&quot;&gt;yukim&lt;/a&gt; I think we used to be able to proceed with the other RepairSessions even if one fails, right? If not, we should probably call cancel on the RepairJob runnables which are in queue for the executor after calling shutdownNow() in repairComplete() in StorageService. &lt;/p&gt;</description>
                <environment></environment>
        <key id="12751382">CASSANDRA-8208</key>
            <summary>Inconsistent failure handling with repair</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10002" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Normal</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="yukim">Yuki Morishita</assignee>
                                    <reporter username="marcuse">Marcus Eriksson</reporter>
                        <labels>
                            <label>repair</label>
                    </labels>
                <created>Wed, 29 Oct 2014 14:17:40 +0000</created>
                <updated>Tue, 16 Apr 2019 09:31:29 +0000</updated>
                            <resolved>Thu, 13 Nov 2014 18:57:07 +0000</resolved>
                                        <fixVersion>2.2.0 beta 1</fixVersion>
                                    <component>Legacy/Streaming and Messaging</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="14190369" author="yukim" created="Thu, 30 Oct 2014 16:58:16 +0000"  >&lt;p&gt;I think you are right. Maybe we can just switch from Futures.allAsList() (its returned Future immediately fails when one of given Futures fails) to Futures.successfulAsList() and check null for failed repair in callback.&lt;/p&gt;</comment>
                            <comment id="14195035" author="yukim" created="Mon, 3 Nov 2014 20:27:20 +0000"  >&lt;p&gt;Also &lt;a href=&quot;https://github.com/yukim/cassandra/tree/8208&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/yukim/cassandra/tree/8208&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Changed from allAsList to successfulAsList so that repair does not fail immediately. Also switched to addListener since successfulAsList does not &quot;fail&quot;.&lt;/p&gt;</comment>
                            <comment id="14196106" author="krummas" created="Tue, 4 Nov 2014 13:49:02 +0000"  >&lt;p&gt;I think this makes us run anticompaction even if one of the sessions fail.&lt;/p&gt;

&lt;p&gt;Looks like we just left the parent repair sessions around if we failed before as well, we should probably add a flag to the AnticompactionRequest message that we send out in ARS#finishParentSession that says whether or not we were actually successful&lt;/p&gt;</comment>
                            <comment id="14206608" author="yukim" created="Tue, 11 Nov 2014 16:46:09 +0000"  >&lt;p&gt;Pushed v2 to &lt;a href=&quot;https://github.com/yukim/cassandra/commits/8208-2&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/yukim/cassandra/commits/8208-2&lt;/a&gt;&lt;br/&gt;
which contains &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-8291&quot; title=&quot;Parent repair session is not removed in remote node&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-8291&quot;&gt;&lt;del&gt;CASSANDRA-8291&lt;/del&gt;&lt;/a&gt; also.&lt;/p&gt;

&lt;p&gt;This time I changed AnticompactionRequest to send successful repair ranges, so that anticompaction runs only on those ranges.&lt;br/&gt;
If there is no successful repair, then just skips anticompaction.&lt;/p&gt;</comment>
                            <comment id="14209759" author="krummas" created="Thu, 13 Nov 2014 13:43:34 +0000"  >&lt;p&gt;+1&lt;/p&gt;

&lt;p&gt;Small nit; we only use &apos;range&apos; in RepairSessionResult so I guess we could skip introducing that class, but it might also make it clearer, so totally fine to leave it in.&lt;/p&gt;</comment>
                            <comment id="14210153" author="yukim" created="Thu, 13 Nov 2014 18:57:07 +0000"  >&lt;p&gt;Thanks for the review.&lt;br/&gt;
I just left the class for now.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10032">
                    <name>Blocker</name>
                                            <outwardlinks description="blocks">
                                        <issuelink>
            <issuekey id="12661321">CASSANDRA-5839</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12679019" name="8208.txt" size="2996" author="yukim" created="Mon, 3 Nov 2014 20:27:20 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[yukim]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            11 years, 1 week, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i21pvr:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>marcuse</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[marcuse]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12962"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>