<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 23:31:40 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-20295] Fix  Min/Max aggregation function on reversed types</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-20295</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;&lt;b&gt;Cassandra version&lt;/b&gt;&lt;/p&gt;

&lt;p&gt;5.0.3&lt;/p&gt;

&lt;p&gt;docker run --name cassandra -d cassandra:5&lt;/p&gt;

&lt;p&gt;docker exec -it cassandra cqlsh&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&lt;b&gt;Data schema&lt;/b&gt;&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
CREATE KEYSPACE IF NOT EXISTS test WITH replication = { &lt;span class=&quot;code-quote&quot;&gt;&apos;class&apos;&lt;/span&gt;: &lt;span class=&quot;code-quote&quot;&gt;&apos;SimpleStrategy&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;replication_factor&apos;&lt;/span&gt;: 1 } AND durable_writes = &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;; 

USE test;

CREATE TABLE data(
  sensor_id text,
  time timestamp,
  value &lt;span class=&quot;code-object&quot;&gt;double&lt;/span&gt;,
  PRIMARY KEY (sensor_id, time)
) WITH CLUSTERING ORDER BY (time DESC)
  AND compaction = {&lt;span class=&quot;code-quote&quot;&gt;&apos;class&apos;&lt;/span&gt;: &lt;span class=&quot;code-quote&quot;&gt;&apos;TimeWindowCompactionStrategy&apos;&lt;/span&gt; }; 

INSERT INTO data (sensor_id, time, value) VALUES (&lt;span class=&quot;code-quote&quot;&gt;&apos;s1&apos;&lt;/span&gt;, 0,    1);
INSERT INTO data (sensor_id, time, value) VALUES (&lt;span class=&quot;code-quote&quot;&gt;&apos;s1&apos;&lt;/span&gt;, 1000, 2);&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&lt;b&gt;Actual result&lt;/b&gt;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
SELECT min(time), max(time) FROM data WHERE sensor_id = &lt;span class=&quot;code-quote&quot;&gt;&apos;s1&apos;&lt;/span&gt;; 

system.min(time) &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;| system.max(time)
---------------------------------+---------------------------------
&#160;1970-01-01 00:00:01.000000+0000 | 1970-01-01 00:00:00.000000+0000(1 rows)&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&lt;b&gt;Expected result&lt;/b&gt;&lt;b&gt;{&lt;/b&gt;}&lt;/p&gt;

&lt;p&gt;On cassandra 4 (tested with 4.1.8) everything is working fine&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
SELECT min(time), max(time) FROM data WHERE sensor_id = &lt;span class=&quot;code-quote&quot;&gt;&apos;s1&apos;&lt;/span&gt;; 

system.min(time) &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;| system.max(time)
---------------------------------+---------------------------------
&#160;1970-01-01 00:00:00.000000+0000 | 1970-01-01 00:00:01.000000+0000(1 rows)&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&lt;b&gt;Note&lt;/b&gt;&lt;/p&gt;

&lt;p&gt;If we&apos;ll change clustering order from DESC to ASC then problem disappear&#160;&lt;/p&gt;</description>
                <environment></environment>
        <key id="13607492">CASSANDRA-20295</key>
            <summary>Fix  Min/Max aggregation function on reversed types</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10002" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Normal</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="smiklosovic">Stefan Miklosovic</assignee>
                                    <reporter username="scrat98">Artem Golovko</reporter>
                        <labels>
                    </labels>
                <created>Wed, 5 Feb 2025 19:07:38 +0000</created>
                <updated>Fri, 7 Feb 2025 22:46:21 +0000</updated>
                            <resolved>Fri, 7 Feb 2025 22:45:08 +0000</resolved>
                                        <fixVersion>5.0.x</fixVersion>
                    <fixVersion>5.x</fixVersion>
                                    <component>Legacy/Core</component>
                    <component>Legacy/Local Write-Read Paths</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                    <progress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                            <timeestimate seconds="0">0h</timeestimate>
                            <timespent seconds="5400">1.5h</timespent>
                                <comments>
                            <comment id="17924227" author="smiklosovic" created="Wed, 5 Feb 2025 19:24:08 +0000"  >&lt;p&gt;verified on trunk that this is happening&lt;/p&gt;</comment>
                            <comment id="17924228" author="smiklosovic" created="Wed, 5 Feb 2025 19:25:19 +0000"  >&lt;p&gt;It seems like the results of max and min are switched and / or something is going on with ASC / DESC&lt;/p&gt;</comment>
                            <comment id="17924231" author="smiklosovic" created="Wed, 5 Feb 2025 19:30:40 +0000"  >&lt;p&gt;This is not only about timestamp type specifically, just &quot;int&quot; does it too:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
cassandra@cqlsh:test&amp;gt; CREATE TABLE data2( &#160; sensor_id text, &#160; cl &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;, &#160; val &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;, &#160; PRIMARY KEY (sensor_id, cl) ) WITH CLUSTERING ORDER BY (cl DESC) &#160; AND compaction = {&lt;span class=&quot;code-quote&quot;&gt;&apos;class&apos;&lt;/span&gt;: &lt;span class=&quot;code-quote&quot;&gt;&apos;TimeWindowCompactionStrategy&apos;&lt;/span&gt; };

cassandra@cqlsh:test&amp;gt; INSERT INTO data2(sensor_id , cl , val ) VALUES ( &lt;span class=&quot;code-quote&quot;&gt;&apos;s1&apos;&lt;/span&gt;, 0, 1);
cassandra@cqlsh:test&amp;gt; INSERT INTO data2(sensor_id , cl , val ) VALUES ( &lt;span class=&quot;code-quote&quot;&gt;&apos;s1&apos;&lt;/span&gt;, 1000, 2);

cassandra@cqlsh:test&amp;gt; select * from data2 ; 

sensor_id  | cl &#160; | val
-----------+------+-----
&#160; &#160; &#160; &#160; s1 | 1000 | &#160; 2
&#160; &#160; &#160; &#160; s1 | &#160; &#160;0 | &#160; 1

(2 rows)

cassandra@cqlsh:test&amp;gt; SELECT min(cl), max(cl) FROM data2 WHERE sensor_id = &lt;span class=&quot;code-quote&quot;&gt;&apos;s1&apos;&lt;/span&gt;;

 system.min(cl) | system.max(cl)
----------------+----------------
&#160; &#160; &#160; &#160; &#160; &#160;1000 | &#160; &#160; &#160; &#160; &#160; &#160; &#160;0
 &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="17924239" author="smiklosovic" created="Wed, 5 Feb 2025 19:56:21 +0000"  >&lt;p&gt;I believe this is the fix (1). We are not treating reversed types in these functions properly (reversed -&amp;gt; desc).&lt;/p&gt;

&lt;p&gt;I still need to write tests for this but we found the culprit.&lt;/p&gt;

&lt;p&gt;(1) &lt;a href=&quot;https://github.com/apache/cassandra/pull/3872&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/cassandra/pull/3872&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17924246" author="smiklosovic" created="Wed, 5 Feb 2025 20:23:33 +0000"  >&lt;p&gt;I went a little bit wild there, I abstracted what I could otherwise it would be quite duplicative. Tests on the way.&lt;/p&gt;</comment>
                            <comment id="17924248" author="smiklosovic" created="Wed, 5 Feb 2025 20:38:24 +0000"  >&lt;p&gt;added tests, waiting for review.&lt;/p&gt;</comment>
                            <comment id="17924387" author="smiklosovic" created="Thu, 6 Feb 2025 07:10:32 +0000"  >&lt;p&gt;I have drastically simplified that thanks to a hint of &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=dcapwell&quot; class=&quot;user-hover&quot; rel=&quot;dcapwell&quot;&gt;dcapwell&lt;/a&gt; .&lt;/p&gt;</comment>
                            <comment id="17924711" author="dcapwell" created="Thu, 6 Feb 2025 22:13:44 +0000"  >&lt;p&gt;+1&lt;/p&gt;</comment>
                            <comment id="17924994" author="smiklosovic" created="Fri, 7 Feb 2025 18:38:21 +0000"  >&lt;p&gt;&lt;a href=&quot;https://github.com/instaclustr/cassandra/tree/CASSANDRA-20295-5.0&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;CASSANDRA-20295-5.0&lt;/a&gt;&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;java17_pre-commit_tests                         
  &#10003; j17_build                                        3m 54s
  &#10003; j17_cqlsh_dtests_py311                           6m 27s
  &#10003; j17_cqlsh_dtests_py311_vnode                     6m 33s
  &#10003; j17_cqlsh_dtests_py38                            6m 13s
  &#10003; j17_cqlsh_dtests_py38_vnode                      5m 53s
  &#10003; j17_cqlshlib_cython_tests                        7m 32s
  &#10003; j17_cqlshlib_tests                               9m 47s
  &#10003; j17_dtests_latest                               40m 24s
  &#10003; j17_jvm_dtests                                  23m 54s
  &#10003; j17_jvm_dtests_latest_vnode                     20m 16s
  &#10003; j17_unit_tests                                   17m 7s
  &#10003; j17_unit_tests_repeat                           12m 47s
  &#10003; j17_utests_latest                                17m 3s
  &#10003; j17_utests_latest_repeat                        14m 37s
  &#10003; j17_utests_oa                                   17m 11s
  &#10003; j17_utests_oa_repeat                             14m 5s
  &#10005; j17_dtests                                      34m 58s
      refresh_test.TestRefresh test_refresh_deadlock_startup
  &#10005; j17_dtests_vnode                                42m 19s
      bootstrap_test.TestBootstrap test_killed_wiped_node_cannot_join
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;a href=&quot;https://app.circleci.com/pipelines/github/instaclustr/cassandra/5388/workflows/1a51861a-d14f-44da-ac92-3171972c64e8&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;java17_pre-commit_tests&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17925063" author="smiklosovic" created="Fri, 7 Feb 2025 21:35:08 +0000"  >&lt;p&gt;&lt;a href=&quot;https://github.com/instaclustr/cassandra/tree/CASSANDRA-20295-trunk&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;CASSANDRA-20295-trunk&lt;/a&gt;&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;java17_pre-commit_tests                         
  &#10003; j17_build                                        4m 35s
  &#10003; j17_cqlsh_dtests_py311                            7m 0s
  &#10003; j17_cqlsh_dtests_py311_vnode                     7m 35s
  &#10003; j17_cqlsh_dtests_py38                            6m 59s
  &#10003; j17_cqlshlib_cython_tests                        8m 14s
  &#10003; j17_cqlshlib_tests                               7m 19s
  &#10003; j17_dtests_latest                               41m 50s
  &#10003; j17_dtests_vnode                                41m 54s
  &#10003; j17_unit_tests                                  15m 49s
  &#10003; j17_unit_tests_repeat                           12m 52s
  &#10003; j17_utests_latest                               17m 35s
  &#10003; j17_utests_latest_repeat                        13m 14s
  &#10003; j17_utests_oa                                   16m 29s
  &#10003; j17_utests_oa_repeat                            14m 23s
  &#10005; j17_cqlsh_dtests_py38_vnode                      8m 41s
      cqlsh_tests.test_cqlsh_copy.TestCqlshCopy test_bulk_round_trip_with_timeouts
  &#10005; j17_dtests                                      38m 42s
      refresh_test.TestRefresh test_refresh_deadlock_startup
  &#10005; j17_jvm_dtests                                  24m 32s
      org.apache.cassandra.fuzz.sai.MultiNodeSAITest indexOnlySaiTest TIMEOUTED
  &#10005; j17_jvm_dtests_latest_vnode                     24m 55s
      org.apache.cassandra.fuzz.sai.MultiNodeSAITest indexOnlySaiTest TIMEOUTED
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;a href=&quot;https://app.circleci.com/pipelines/github/instaclustr/cassandra/5394/workflows/b6a6c3a7-ecdd-4bda-bc02-0f4efecf34be&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;java17_pre-commit_tests&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[smiklosovic]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12313825" key="com.atlassian.jira.plugin.system.customfieldtypes:cascadingselect">
                        <customfieldname>Bug Category</customfieldname>
                        <customfieldvalues>
                                                    <customfieldvalue key="12982" cascade-level=""><![CDATA[Correctness]]></customfieldvalue>
                                <customfieldvalue key="12988" cascade-level="1"><![CDATA[API / Semantic Implementation]]></customfieldvalue>
            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12313821" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Complexity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12965"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313822" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Discovered By</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12969"><![CDATA[User Report]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12313922" key="jira.plugin.projectspecificselectfield.jpssf:multicftype">
                        <customfieldname>Impacts</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="13100"><![CDATA[None]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            39 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12313921" key="jira.plugin.projectspecificselectfield.jpssf:multicftype">
                        <customfieldname>Platform</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="13076"><![CDATA[All]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z1u1m8:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[dcapwell]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12962"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12311420" key="com.atlassian.jira.plugin.system.customfieldtypes:version">
                        <customfieldname>Since Version</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="12355063">5.0.0</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313924" key="com.atlassian.jira.plugin.system.customfieldtypes:textfield">
                        <customfieldname>Source Control Link</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>&lt;p&gt;&lt;a href=&quot;https://github.com/apache/cassandra/commit/881a1f023fb1ab304921399d983f01bfbba0e917&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/cassandra/commit/881a1f023fb1ab304921399d983f01bfbba0e917&lt;/a&gt;&lt;/p&gt;</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313823" key="com.atlassian.jira.plugin.system.customfieldtypes:textarea">
                        <customfieldname>Test and Documentation Plan</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>&lt;p&gt;CI and test&lt;/p&gt;</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>