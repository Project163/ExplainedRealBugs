<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 23:33:51 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-20398] Unified Compaction does not properly validate min and target sizes</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-20398</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
AND compaction = {&lt;span class=&quot;code-quote&quot;&gt;&apos;base_shard_count&apos;&lt;/span&gt;: &lt;span class=&quot;code-quote&quot;&gt;&apos;7&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;class&apos;&lt;/span&gt;: &lt;span class=&quot;code-quote&quot;&gt;&apos;org.apache.cassandra.db.compaction.UnifiedCompactionStrategy&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;flush_size_override&apos;&lt;/span&gt;: &lt;span class=&quot;code-quote&quot;&gt;&apos;492E+207 KiB&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;min_sstable_size&apos;&lt;/span&gt;: &lt;span class=&quot;code-quote&quot;&gt;&apos;871 GiB&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;provide_overlapping_tombstones&apos;&lt;/span&gt;: &lt;span class=&quot;code-quote&quot;&gt;&apos;CELL&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;target_sstable_size&apos;&lt;/span&gt;: &lt;span class=&quot;code-quote&quot;&gt;&apos;12E899 B&apos;&lt;/span&gt;}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;In this example min_sstable_size &amp;lt; target_sstable_size but the error the user sees is&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
Caused by: org.apache.cassandra.exceptions.ConfigurationException: Invalid configuration, min_sstable_size (871.000GiB) should be less than the target size minimum: 2.000GiB at org.apache.cassandra.db.compaction.unified.Controller.validateOptions(Controller.java:627) at org.apache.cassandra.db.compaction.UnifiedCompactionStrategy.validateOptions(UnifiedCompactionStrategy.java:106)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The variables in question for this error&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
targetSSTableSize = 9223372036854775807
sizeInBytes = 935229128704
limit = 2147483647 &lt;span class=&quot;code-comment&quot;&gt;// (&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;) (targetSSTableSize * &lt;span class=&quot;code-object&quot;&gt;Math&lt;/span&gt;.sqrt(0.5))&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The issue here is that the target size is larger than int max so we wrap around!&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
sizeInBytes &amp;gt;= &lt;span class=&quot;code-object&quot;&gt;Math&lt;/span&gt;.ceil(targetSSTableSize * INVERSE_SQRT_2) == &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;
sizeInBytes &amp;gt;= (&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;) &lt;span class=&quot;code-object&quot;&gt;Math&lt;/span&gt;.ceil(targetSSTableSize * INVERSE_SQRT_2) == &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Here is another example where the error isn&apos;t clear but isn&apos;t due to wrap arround&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
AND compaction = {&lt;span class=&quot;code-quote&quot;&gt;&apos;base_shard_count&apos;&lt;/span&gt;: &lt;span class=&quot;code-quote&quot;&gt;&apos;2&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;class&apos;&lt;/span&gt;: &lt;span class=&quot;code-quote&quot;&gt;&apos;org.apache.cassandra.db.compaction.UnifiedCompactionStrategy&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;min_sstable_size&apos;&lt;/span&gt;: &lt;span class=&quot;code-quote&quot;&gt;&apos;437.825 MiB&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;scaling_parameters&apos;&lt;/span&gt;: &lt;span class=&quot;code-quote&quot;&gt;&apos;T2,N,1961141729,-163573937,L10,L3,T4,N,N&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;target_sstable_size&apos;&lt;/span&gt;: &lt;span class=&quot;code-quote&quot;&gt;&apos;+565 MiB&apos;&lt;/span&gt;}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
Caused by: org.apache.cassandra.exceptions.ConfigurationException: Invalid configuration, min_sstable_size (437.825MiB) should be less than the target size minimum: 399.515MiB
	at org.apache.cassandra.db.compaction.unified.Controller.validateOptions(Controller.java:627)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Here the same variables above are&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
targetSSTableSize = 592445440
sizeInBytes = 459092787
limit = 418922189
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This looks to be due to the 70% (INVERSE_SQRT_2) on the target, so the error uses a value the user doesn&apos;t provide but rather one that is calculated.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13610648">CASSANDRA-20398</key>
            <summary>Unified Compaction does not properly validate min and target sizes</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10002" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Normal</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="pranavshenoy06">Pranav</assignee>
                                    <reporter username="dcapwell">David Capwell</reporter>
                        <labels>
                    </labels>
                <created>Tue, 4 Mar 2025 22:44:53 +0000</created>
                <updated>Tue, 27 May 2025 22:28:38 +0000</updated>
                            <resolved>Tue, 27 May 2025 22:27:15 +0000</resolved>
                                        <fixVersion>5.0.5</fixVersion>
                    <fixVersion>5.1</fixVersion>
                                    <component>Local/Compaction/UCS</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                    <progress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                            <timeestimate seconds="0">0h</timeestimate>
                            <timespent seconds="18600">5h 10m</timespent>
                                <comments>
                            <comment id="17941412" author="JIRAUSER308790" created="Sun, 6 Apr 2025 19:40:43 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=dcapwell&quot; class=&quot;user-hover&quot; rel=&quot;dcapwell&quot;&gt;dcapwell&lt;/a&gt;&#160; can I pick this up?&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;I looked into this issue and I think we could the following changes. Please let me know if this is the right direction.&#160;&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;In the first case, the target_size is going beyond INT_MAX. Should we have a logic to check if it goes beyond INT MAX and log it specifically so that the user will get the accurate description?&#160;&lt;/li&gt;
&lt;/ol&gt;


&lt;ol&gt;
	&lt;li&gt;&#160;In the second case, should we modify the log to explicity specify that the target size is 70% of the user inputs?&#160;&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;Thanks.&lt;/p&gt;

&lt;p&gt;&#160;&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=claude&quot; class=&quot;user-hover&quot; rel=&quot;claude&quot;&gt;claude&lt;/a&gt; could you please share your thoughts as well? Thanks&lt;/p&gt;</comment>
                            <comment id="17943377" author="dcapwell" created="Thu, 10 Apr 2025 22:29:23 +0000"  >&lt;p&gt;feel free to take&lt;/p&gt;</comment>
                            <comment id="17953558" author="dcapwell" created="Thu, 22 May 2025 23:19:11 +0000"  >&lt;p&gt;+1 from Branimir and I in GH; ill merge tomorrow unless he beats me to it.&lt;/p&gt;</comment>
                            <comment id="17954434" author="dcapwell" created="Tue, 27 May 2025 22:27:31 +0000"  >&lt;p&gt;Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=pranavshenoy06&quot; class=&quot;user-hover&quot; rel=&quot;pranavshenoy06&quot;&gt;pranavshenoy06&lt;/a&gt; and everyone on the review!  merged&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="13076722" name="ci_summary-cassandra-5.0-329ae3e136835f0e477f20e0aa7426de3f6250b6.html" size="4910" author="dcapwell" created="Tue, 27 May 2025 22:26:11 +0000"/>
                            <attachment id="13076723" name="ci_summary-trunk-07ad173d471311ce8de9136e05de4d047f4678ee.html" size="4910" author="dcapwell" created="Tue, 27 May 2025 22:26:12 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[pranavshenoy06]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12313825" key="com.atlassian.jira.plugin.system.customfieldtypes:cascadingselect">
                        <customfieldname>Bug Category</customfieldname>
                        <customfieldvalues>
                                                    <customfieldvalue key="12982" cascade-level=""><![CDATA[Correctness]]></customfieldvalue>
                                <customfieldvalue key="13162" cascade-level="1"><![CDATA[API / Semantic Definition]]></customfieldvalue>
            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12313821" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Complexity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12964"><![CDATA[Low Hanging Fruit]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313822" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Discovered By</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12972"><![CDATA[Fuzz Test]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12313922" key="jira.plugin.projectspecificselectfield.jpssf:multicftype">
                        <customfieldname>Impacts</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="13100"><![CDATA[None]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            24 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12313921" key="jira.plugin.projectspecificselectfield.jpssf:multicftype">
                        <customfieldname>Platform</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="13076"><![CDATA[All]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z1ukmo:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[blambov]]></customfieldvalue>
        <customfieldvalue><![CDATA[claude]]></customfieldvalue>
        <customfieldvalue><![CDATA[dcapwell]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12962"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12311420" key="com.atlassian.jira.plugin.system.customfieldtypes:version">
                        <customfieldname>Since Version</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="12351720">5.0</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313924" key="com.atlassian.jira.plugin.system.customfieldtypes:textfield">
                        <customfieldname>Source Control Link</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>&lt;p&gt;&lt;a href=&quot;https://github.com/apache/cassandra/commit/823f48663e62eed5ec21e1c9e6c60d5eac839dc2&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/cassandra/commit/823f48663e62eed5ec21e1c9e6c60d5eac839dc2&lt;/a&gt;&lt;/p&gt;</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313823" key="com.atlassian.jira.plugin.system.customfieldtypes:textarea">
                        <customfieldname>Test and Documentation Plan</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>&lt;p&gt;wrote a unit test for this use case&lt;/p&gt;</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>