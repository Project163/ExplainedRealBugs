<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 22:41:45 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-6231] Add snapshot disk space to cfstats</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-6231</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;As discussed in &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-6179&quot; title=&quot;&amp;quot;Load&amp;quot; calculated in &amp;quot;nodetool info&amp;quot; is strange/inaccurate in JBOD setups&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-6179&quot;&gt;&lt;del&gt;CASSANDRA-6179&lt;/del&gt;&lt;/a&gt;, this could help avoid some user confusion, especially when snapshots are autocreated for drop/truncate.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12675154">CASSANDRA-6231</key>
            <summary>Add snapshot disk space to cfstats</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10003" iconUrl="https://issues.apache.org/jira/images/icons/priorities/trivial.svg">Low</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="mishail">Mikhail Stepura</assignee>
                                    <reporter username="jbellis">Jonathan Ellis</reporter>
                        <labels>
                            <label>lhf</label>
                    </labels>
                <created>Tue, 22 Oct 2013 23:18:51 +0000</created>
                <updated>Tue, 16 Apr 2019 09:32:02 +0000</updated>
                            <resolved>Tue, 26 Nov 2013 21:21:15 +0000</resolved>
                                        <fixVersion>2.1 beta1</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>6</watches>
                                                                                                                <comments>
                            <comment id="13830772" author="mishail" created="Sat, 23 Nov 2013 20:54:55 +0000"  >&lt;p&gt;Patch: added a method to &lt;tt&gt;Directories&lt;/tt&gt; to calculate an allocated size in &quot;snapshots&quot; directory&lt;/p&gt;</comment>
                            <comment id="13831677" author="jbellis" created="Mon, 25 Nov 2013 18:03:22 +0000"  >&lt;p&gt;How hard would it be to break out &quot;space used by sstables that aren&apos;t live anymore?&quot;  Could be confusing to double-count (or 10x-count or more with lots of snapshots).&lt;/p&gt;</comment>
                            <comment id="13831958" author="mishail" created="Mon, 25 Nov 2013 21:55:12 +0000"  >&lt;p&gt;Patch v2. Separately report a space used by obsolete sstables. Assuming &quot;obsolete&quot; are those not reported by &lt;tt&gt;SSTableLister&lt;/tt&gt;&lt;/p&gt;</comment>
                            <comment id="13831980" author="jbellis" created="Mon, 25 Nov 2013 22:19:30 +0000"  >&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Both numbers need to be &quot;de-duplicated&quot; across snapshots right?&lt;/li&gt;
	&lt;li&gt;Looks like we could cut down on the file walking if we restricted it to the subdirectory of the CFS in question&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13832002" author="mishail" created="Mon, 25 Nov 2013 22:37:14 +0000"  >&lt;blockquote&gt;&lt;p&gt;Both numbers need to be &quot;de-duplicated&quot; across snapshots right?&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;I will fix that&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;Looks like we could cut down on the file walking if we restricted it to the subdirectory of the CFS in question&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;We start walking from &quot;snapshots&quot; subdirectory of the CFS in question. Not sure how it can be reduced/restricted further.&lt;/p&gt;</comment>
                            <comment id="13832021" author="jbellis" created="Mon, 25 Nov 2013 22:51:51 +0000"  >&lt;p&gt;Ah, right.  Then isn&apos;t the prefix check redundant?&lt;/p&gt;</comment>
                            <comment id="13832025" author="mishail" created="Mon, 25 Nov 2013 22:56:31 +0000"  >&lt;blockquote&gt;&lt;p&gt;Ah, right. Then isn&apos;t the prefix check redundant?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;That is to separate the CF in question and its &quot;index&quot; CFs, they are reported separately in cfstats.  &lt;/p&gt;</comment>
                            <comment id="13832038" author="mishail" created="Mon, 25 Nov 2013 23:06:47 +0000"  >&lt;p&gt;And it seems that we only have to report that &quot;obsolete&quot; number. Because it makes no sense to count those from snapshots which are just links to existing files.&lt;/p&gt;</comment>
                            <comment id="13832047" author="jbellis" created="Mon, 25 Nov 2013 23:12:31 +0000"  >&lt;p&gt;Makes sense to me.&lt;/p&gt;</comment>
                            <comment id="13832082" author="mishail" created="Mon, 25 Nov 2013 23:54:22 +0000"  >&lt;p&gt;Patch v3. Count only the size of snapshot files (once for each file) which are not links for &quot;live&quot; SSTables.&lt;/p&gt;</comment>
                            <comment id="13832333" author="jbellis" created="Tue, 26 Nov 2013 05:21:24 +0000"  >&lt;p&gt;LGTM!&lt;/p&gt;

&lt;p&gt;Last thing, the size methods in CFSMBean are deprecated because we&apos;re moving to CFMetrics.  Not much reason to add this to both places; let&apos;s just do it in metrics.  (So it&apos;s probably easier to just do this for trunk since otherwise you&apos;d have to do support both in nodecmd.)&lt;/p&gt;</comment>
                            <comment id="13832916" author="nickmbailey" created="Tue, 26 Nov 2013 19:22:46 +0000"  >&lt;p&gt;I&apos;d just like to make a note that we&apos;ve (opscenter) have seen issues with inspecting snapshots for LCS column families. LCS can create a very large number of sstable files (anywhere from 10k to 100k+ range) , and just storing strings for all the file names was giving us some issues. In our case we were dealing with much smaller heap sizes though. Also this is already handling duplicate sstables, but it doesn&apos;t sound unreasonable that the number of distinct files could get extremely large, even by just taking daily snapshots.&lt;/p&gt;</comment>
                            <comment id="13832937" author="jbellis" created="Tue, 26 Nov 2013 19:37:08 +0000"  >&lt;p&gt;100k distinct filenames would be about 50MB of heap at 500 bytes each, and 16TB worth of data on disk.  I&apos;m okay with those numbers.  (If you&apos;re still using 5MB sstables you should probably fix that before calling this, but you probably already have more important reasons to fix that.)&lt;/p&gt;</comment>
                            <comment id="13832967" author="mishail" created="Tue, 26 Nov 2013 20:01:50 +0000"  >&lt;p&gt;V3 of the patch with changes for trunk. (Use o.a.c.metrcis)&lt;/p&gt;</comment>
                            <comment id="13833085" author="jbellis" created="Tue, 26 Nov 2013 21:21:15 +0000"  >&lt;p&gt;committed!&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310051">
                    <name>Supercedes</name>
                                            <outwardlinks description="supercedes">
                                        <issuelink>
            <issuekey id="12673240">CASSANDRA-6179</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12615682" name="CASSANDRA-2.0-6231-v2.patch" size="7719" author="mishail" created="Mon, 25 Nov 2013 21:55:12 +0000"/>
                            <attachment id="12615731" name="CASSANDRA-2.0-6231-v3.patch" size="7491" author="mishail" created="Mon, 25 Nov 2013 23:54:22 +0000"/>
                            <attachment id="12615472" name="CASSANDRA-2.0-6231.patch" size="6035" author="mishail" created="Sat, 23 Nov 2013 20:54:55 +0000"/>
                            <attachment id="12615898" name="trunk-6231-v3.patch" size="9999" author="mishail" created="Tue, 26 Nov 2013 20:01:50 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>4.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[mishail]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>354774</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            12 years ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1p5vj:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>355063</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>jbellis</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[jbellis]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12961"><![CDATA[Low]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>