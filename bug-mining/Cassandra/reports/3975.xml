<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 22:59:38 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-10758] Dropping an index does not invalidate prepared statements anymore</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-10758</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;When we drop an index, we should invalidate (&lt;tt&gt;SELECT&lt;/tt&gt;) statements on the base table as those may involve the index (and, for instance, validating an index exists is done a preparation time in &lt;tt&gt;SELECT&lt;/tt&gt;, so a &lt;tt&gt;SELECT&lt;/tt&gt; does potentially become invalid if an index is dropped). As far as I can tell, this is properly done in pre-3.0, because &lt;tt&gt;CFMetaData.apply&lt;/tt&gt; will return &lt;tt&gt;true&lt;/tt&gt; which will trigger the statements invalidations. And that is because, before 3.0, index definitions are part of the &lt;tt&gt;ColumnDefinition&lt;/tt&gt; of the base table and thus dropping an index is (rightfullly in a way) considered by &lt;tt&gt;CFMetaData&lt;/tt&gt; as a change to the table columns. In 3.0 however, as indexes has been moved out of &lt;tt&gt;ColumnDefinition&lt;/tt&gt;, &lt;tt&gt;CFMetaData.apply&lt;/tt&gt; returns &lt;tt&gt;false&lt;/tt&gt; in that case and statements are not invalidated.&lt;/p&gt;

&lt;p&gt;I&apos;ll note that the changes to &lt;tt&gt;CQLTester&lt;/tt&gt; done in &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-10631&quot; title=&quot;JSON Update not working with PreparedStatement&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-10631&quot;&gt;&lt;del&gt;CASSANDRA-10631&lt;/del&gt;&lt;/a&gt; actually expose this problem (but indirectly so we should create a purpose built tests for this).&lt;/p&gt;</description>
                <environment></environment>
        <key id="12915340">CASSANDRA-10758</key>
            <summary>Dropping an index does not invalidate prepared statements anymore</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10002" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Normal</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="samt">Sam Tunnicliffe</assignee>
                                    <reporter username="slebresne">Sylvain Lebresne</reporter>
                        <labels>
                            <label>secondary_index</label>
                    </labels>
                <created>Mon, 23 Nov 2015 14:16:14 +0000</created>
                <updated>Tue, 16 Apr 2019 09:30:49 +0000</updated>
                            <resolved>Mon, 30 Nov 2015 12:40:20 +0000</resolved>
                                        <fixVersion>3.0.1</fixVersion>
                    <fixVersion>3.1</fixVersion>
                                    <component>Legacy/CQL</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="15029844" author="beobal" created="Fri, 27 Nov 2015 12:47:37 +0000"  >&lt;p&gt;The changes to &lt;tt&gt;CQLTester&lt;/tt&gt; from &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-10631&quot; title=&quot;JSON Update not working with PreparedStatement&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-10631&quot;&gt;&lt;del&gt;CASSANDRA-10631&lt;/del&gt;&lt;/a&gt; do mean that the existing tests in &lt;tt&gt;SecondaryIndexTest&lt;/tt&gt; exercise this to a large extent. Removing the temporary workaround which disables prepared statement reuse shows the issue (and shows that the patch fixes it). To be a bit more explicit, I&apos;ve added an additional test to inspect the prepared statement caches in &lt;tt&gt;QueryHandler&lt;/tt&gt; after an index is dropped. This is pretty trivial to do, and probably good enough for now. &lt;/p&gt;

&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;branch&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;testall&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;dtest&lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/beobal/cassandra/tree/10758-3.0&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;10758-3.0&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/beobal/job/beobal-10758-3.0-testall&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;testall&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/beobal/job/beobal-10758-3.0-dtest&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;dtest&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/beobal/cassandra/tree/10758-trunk&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;10758-trunk&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/beobal/job/beobal-10758-trunk-testall&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;testall&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/beobal/job/beobal-10758-trunk-dtest&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;dtest&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;


&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=slebresne&quot; class=&quot;user-hover&quot; rel=&quot;slebresne&quot;&gt;slebresne&lt;/a&gt; re: this comment on &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-10631&quot; title=&quot;JSON Update not working with PreparedStatement&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-10631&quot;&gt;&lt;del&gt;CASSANDRA-10631&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;fixing it is not trivial enough that I feel confident shoving it in that (unrelated) ticket. &lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Had you got something more in mind? We could extend &lt;tt&gt;MigrationListener&lt;/tt&gt; with index specific stuff, though I&apos;m not sure how much value there&apos;d be in that.&lt;/p&gt;</comment>
                            <comment id="15029862" author="slebresne" created="Fri, 27 Nov 2015 13:21:07 +0000"  >&lt;blockquote&gt;&lt;p&gt;Had you got something more in mind?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Not particularly. My sentence should really be read &quot;I&apos;m tired of looking at fixing stuff that are not directly related to the issue&quot; and I hadn&apos;t really looked at how to fix it at all tbh. But the fix does is trivial so good and +1 on the patch, modulo clean CI (which doesn&apos;t seem to have been started yet).&lt;/p&gt;</comment>
                            <comment id="15031717" author="beobal" created="Mon, 30 Nov 2015 12:40:20 +0000"  >&lt;p&gt;Thanks. The CI looks good in general, although it&apos;s a little tricky to compare dtest runs against the mainline branches because the last runs of those failed with compilation errors. Those errors seem to be related to fetching dependencies though and judging by some other recent dev branch runs they appear to be transient, so I&apos;ve committed to 3.0 in &lt;tt&gt;4c56c89a1e47927d6006a6f4294c8a84035fe623&lt;/tt&gt;.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[samt]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 51 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2osen:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12962"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>