<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 23:11:32 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-14451] Infinity ms Commit Log Sync</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-14451</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;Its giving commit log sync warnings where there were apparently zero syncs and therefore gives &quot;Infinityms&quot; as the average duration&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
WARN [PERIODIC-COMMIT-LOG-SYNCER] 2018-05-16 21:11:14,294 NoSpamLogger.java:94 - Out of 0 commit log syncs over the past 0.00s with average duration of Infinityms, 1 have exceeded the configured commit interval by an average of 74.40ms 
WARN [PERIODIC-COMMIT-LOG-SYNCER] 2018-05-16 21:16:57,844 NoSpamLogger.java:94 - Out of 0 commit log syncs over the past 0.00s with average duration of Infinityms, 1 have exceeded the configured commit interval by an average of 198.69ms 
WARN [PERIODIC-COMMIT-LOG-SYNCER] 2018-05-16 21:24:46,325 NoSpamLogger.java:94 - Out of 0 commit log syncs over the past 0.00s with average duration of Infinityms, 1 have exceeded the configured commit interval by an average of 264.11ms 
WARN [PERIODIC-COMMIT-LOG-SYNCER] 2018-05-16 21:29:46,393 NoSpamLogger.java:94 - Out of 32 commit log syncs over the past 268.84s with, average duration of 17.56ms, 1 have exceeded the configured commit interval by an average of 173.66ms&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment>&lt;p&gt;3.11.2 - 2 DC&lt;/p&gt;</environment>
        <key id="13160049">CASSANDRA-14451</key>
            <summary>Infinity ms Commit Log Sync</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10003" iconUrl="https://issues.apache.org/jira/images/icons/priorities/trivial.svg">Low</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="jasobrown">Jason Brown</assignee>
                                    <reporter username="ozzieisaacs">Harry Hough</reporter>
                        <labels>
                    </labels>
                <created>Thu, 17 May 2018 15:08:43 +0000</created>
                <updated>Wed, 24 Mar 2021 00:44:48 +0000</updated>
                            <resolved>Tue, 5 Jun 2018 20:56:44 +0000</resolved>
                                        <fixVersion>3.0.17</fixVersion>
                    <fixVersion>3.11.3</fixVersion>
                    <fixVersion>4.0-alpha1</fixVersion>
                    <fixVersion>4.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>9</watches>
                                                                                                                <comments>
                            <comment id="16479277" author="jasobrown" created="Thu, 17 May 2018 16:03:16 +0000"  >&lt;p&gt;Is this on a new cluster, or after an upgrade from a previous version?&lt;/p&gt;</comment>
                            <comment id="16479284" author="ozzieisaacs" created="Thu, 17 May 2018 16:06:40 +0000"  >&lt;p&gt;Upgraded from 3.10&lt;/p&gt;</comment>
                            <comment id="16479423" author="jasobrown" created="Thu, 17 May 2018 17:25:57 +0000"  >&lt;p&gt;This is probably me, related to &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-14108&quot; title=&quot;Improve commit log chain marker updating&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-14108&quot;&gt;&lt;del&gt;CASSANDRA-14108&lt;/del&gt;&lt;/a&gt;. I&apos;ll take a look into it.&lt;/p&gt;</comment>
                            <comment id="16484164" author="aby786" created="Tue, 22 May 2018 15:47:44 +0000"  >&lt;p&gt;all,&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;even i recently upgraded from 3.10 to 3.11.2 and recieving similar errros&#160;PERIODIC-COMMIT-LOG-SYNCER.&lt;/p&gt;

&lt;p&gt;One thing i observed is even cqlsh login takes over a minute when these erros are reported., also my lowest non prod with 4 nodes 1 DC setup is showing this error and memory was configured as 16GB, the usage went on to 13 to 14 GB. seems to be related .&lt;/p&gt;

&lt;p&gt;Is this bug with 3.11.2 ?&lt;br/&gt;
&#160;&lt;/p&gt;</comment>
                            <comment id="16497916" author="jasobrown" created="Fri, 1 Jun 2018 12:14:29 +0000"  >&lt;p&gt;As I suspected, this is just a bug with logging (due to &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-14108&quot; title=&quot;Improve commit log chain marker updating&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-14108&quot;&gt;&lt;del&gt;CASSANDRA-14108&lt;/del&gt;&lt;/a&gt;), and no real behavior or correctness is impacted. I have a patch for 3.11, but need to port to 3.0 and trunk.&lt;/p&gt;</comment>
                            <comment id="16498619" author="jasobrown" created="Fri, 1 Jun 2018 21:55:23 +0000"  >&lt;p&gt;Below are branches that resolve the problem&lt;/p&gt;
&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;3.0&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;3.11&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;trunk&lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/jasobrown/cassandra/tree/14451-3.0&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;branch&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/jasobrown/cassandra/tree/14451-3.11&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;branch&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/jasobrown/cassandra/tree/14451-trunk&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;branch&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://circleci.com/gh/jasobrown/workflows/cassandra/tree/14451-3.0&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;utests &amp;amp; dtests&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://circleci.com/gh/jasobrown/workflows/cassandra/tree/14451-3.11&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;utests &amp;amp; dtests&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://circleci.com/gh/jasobrown/workflows/cassandra/tree/14451-trunk&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;utests &amp;amp; dtests&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;


&lt;p&gt;The bug was using &lt;tt&gt;markerIntervalNanos&lt;/tt&gt; in the &lt;tt&gt;wakeUpAt&lt;/tt&gt; variable as basis for determining if we&apos;ve lagged in the actual flush to disk. The code should use &lt;tt&gt;syncIntervalNanos&lt;/tt&gt; for that determination. Once again, the only problem here is around determining if we should log about the commitlog flushing falling behind, not that the commitlog is actually falling behind (it ins&apos;t, at least as far as the overlogging here is concerned).&lt;/p&gt;

&lt;p&gt;Most of the change was moving the logging code out of the primary &lt;tt&gt;AbstractCommitLogService.SyncRunnable#sync()&lt;/tt&gt; and into a subroutine. This allowed me to add unit tests, as well as clean up/clarify the &lt;tt&gt;sync()&lt;/tt&gt; method.&lt;/p&gt;</comment>
                            <comment id="16499232" author="aby786" created="Sun, 3 Jun 2018 00:20:58 +0000"  >&lt;p&gt;Can this cause Memory usage to go high ?&lt;/p&gt;

&lt;p&gt;&#160;after 3.11.2 upgrade i am getting high memory usage alerts and nothing in errorlog sometime , but sometime i see same PERIODIC-COMMIT-LOG-SYNCER message&lt;/p&gt;</comment>
                            <comment id="16499266" author="jasobrown" created="Sun, 3 Jun 2018 02:09:30 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=aby786&quot; class=&quot;user-hover&quot; rel=&quot;aby786&quot;&gt;aby786&lt;/a&gt; I would highly doubt the logging thing would cause your memory problems. You should probably open a separate ticket and describe all the symptoms you are seeing, with as much detail as possible.&lt;/p&gt;</comment>
                            <comment id="16501213" author="jrwest" created="Tue, 5 Jun 2018 02:42:20 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jasobrown&quot; class=&quot;user-hover&quot; rel=&quot;jasobrown&quot;&gt;jasobrown&lt;/a&gt; change LGTM. A few questions and minor comments:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;Are the ArchiveCommitLog dtest failures expected on the 3.0 branch?&#160;&lt;/li&gt;
	&lt;li&gt;The &#8220;sleep any time we have left&#8221; comment would be more appropriate above the assignment&#160;of &lt;tt&gt;wakeUpAt&lt;/tt&gt;.&#160;&lt;/li&gt;
	&lt;li&gt;Mark &lt;tt&gt;maybeLogFlushLag&lt;/tt&gt;&#160;and &lt;tt&gt;getTotalSyncDuration&lt;/tt&gt;&#160;as &lt;tt&gt;@VisibleForTesting&lt;/tt&gt;&lt;/li&gt;
	&lt;li&gt;Just wanted to check that the change in behavior of updating &lt;tt&gt;totalSyncDuration&lt;/tt&gt;&#160;is intentional. It makes sense to me that we only increment it if a sync actually occurs but that wasn&#8217;t the case before.&#160;&lt;/li&gt;
	&lt;li&gt;Is there are reason you opted for the &#8220;excessTimeToFlush&#8221; approach in 3.0 but the &#8220;maxFlushTimestamp&#8221; approach on 3.11 and trunk? The only difference I see is the unit of time.&#160;&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="16501696" author="jasobrown" created="Tue, 5 Jun 2018 12:35:55 +0000"  >&lt;blockquote&gt;&lt;p&gt;Are the ArchiveCommitLog dtest failures expected on the 3.0 branch?&#160;&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Yes, 3.0 dtests consistently have about 14 failures, including &lt;tt&gt;ArchiveCommitLog&lt;/tt&gt;. So, unfortunately, this is expected.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;The &#8220;sleep any time we have left&#8221; comment would be more appropriate above the assignment of wakeUpAt.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I left it where it was previously located, but can move it to the more logical spot.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;change in behavior of updating totalSyncDuration is intentional&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;lol, it wasn&apos;t intentional, but it now does the correct thing! You are right that in &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-14108&quot; title=&quot;Improve commit log chain marker updating&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-14108&quot;&gt;&lt;del&gt;CASSANDRA-14108&lt;/del&gt;&lt;/a&gt; I was adding time to mark the headers (without flushing) to &lt;tt&gt;totalSyncDuration&lt;/tt&gt;, which is incorrect.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;Is there are reason you opted for the &#8220;excessTimeToFlush&#8221; approach in 3.0 but the &#8220;maxFlushTimestamp&#8221; approach on 3.11 and trunk?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I wanted to keep the logic as close to the original as possible, since 3.0 is far along in it&apos;s age. I suppose it doesn&apos;t matter that much, though, and can change if you think it&apos;s worthwhile. wdyt?&lt;/p&gt;</comment>
                            <comment id="16501923" author="jrwest" created="Tue, 5 Jun 2018 15:07:54 +0000"  >&lt;blockquote&gt;&lt;p&gt;&#160;I left it where it was previously located, but can move it to the more logical spot.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;I don&apos;t find it very useful where it is now. Would vote to move it or remove it (the code is pretty clear).&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;I wanted to keep the logic as close to the original as possible, since 3.0 is far along in it&apos;s age. I suppose it doesn&apos;t matter that much, though, and can change if you think it&apos;s worthwhile. wdyt?&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;From the review perspective it was just a second implementation to check for correctness and it seems like either implementation could be used. Would vote for them to be the same but fine as is if you prefer.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;Otherwise, +1&lt;/p&gt;</comment>
                            <comment id="16502492" author="jasobrown" created="Tue, 5 Jun 2018 20:56:44 +0000"  >&lt;p&gt;Made all the last recs from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jrwest&quot; class=&quot;user-hover&quot; rel=&quot;jrwest&quot;&gt;jrwest&lt;/a&gt;, and committed as sha &lt;tt&gt;214a3abfcc25460af50805b543a5833697a1b341&lt;/tt&gt;. Thanks, all!&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                                                <inwardlinks description="is duplicated by">
                                        <issuelink>
            <issuekey id="12947100">CASSANDRA-11307</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[jasobrown]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 24 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3tu5j:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>jwest</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[jwest]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12961"><![CDATA[Low]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>