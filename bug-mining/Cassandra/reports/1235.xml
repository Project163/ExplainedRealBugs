<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 22:24:59 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-3369] AssertionError when adding a node and doing repair, repair hangs</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-3369</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;Hi again,&lt;/p&gt;

&lt;p&gt;I was playing aroung with Cassandra 1.0.0-rc2 and got an AssertionError. The cluster I set up was two cassandra nodes on one laptop using different 127.0.0.* loopback devices. Both nodes have separate folders on the harddisk.&lt;/p&gt;


&lt;p&gt;Here is what I did:&lt;/p&gt;


&lt;p&gt;1. Started node1 and inserted some data into it using a simple singlethreaded testprogram (uses hector 0.8.0-2):&lt;br/&gt;
127.0.0.1       datacenter1 rack1       Up     Normal  583.55 MB       100.00% Token(bytes&lt;span class=&quot;error&quot;&gt;&amp;#91;63e5b6995466cd3221cba16646ae19ed&amp;#93;&lt;/span&gt;)&lt;/p&gt;

&lt;p&gt;2. I started another node, node 2 = 127.0.0.2:&lt;br/&gt;
127.0.0.2       datacenter1 rack1       Up     Normal  147.57 KB       50.00%  Token(bytes&lt;span class=&quot;error&quot;&gt;&amp;#91;4d6ccfeaa8bb59551751a2816fde9343&amp;#93;&lt;/span&gt;)&lt;br/&gt;
127.0.0.1       datacenter1 rack1       Up     Normal  583.55 MB       50.00%  Token(bytes&lt;span class=&quot;error&quot;&gt;&amp;#91;63e5b6995466cd3221cba16646ae19ed&amp;#93;&lt;/span&gt;)&lt;/p&gt;

&lt;p&gt;3. I triggered a &quot;nodetool -h 127.0.0.1  repair&quot; on the first node that had the data from my test.&lt;/p&gt;


&lt;p&gt;This repair does not seem to ever end. The nodetool is hanging now but my computer is idle. I get an AssertionError on the first node:&lt;br/&gt;
java.lang.AssertionError&lt;br/&gt;
	at org.apache.cassandra.service.AntiEntropyService$Validator.prepare(AntiEntropyService.java:283)&lt;br/&gt;
	at org.apache.cassandra.db.compaction.CompactionManager.doValidationCompaction(CompactionManager.java:825)&lt;br/&gt;
	at org.apache.cassandra.db.compaction.CompactionManager.access$600(CompactionManager.java:63)&lt;br/&gt;
	at org.apache.cassandra.db.compaction.CompactionManager$6.call(CompactionManager.java:432)&lt;br/&gt;
	at java.util.concurrent.FutureTask$Sync.innerRun(FutureTask.java:303)&lt;br/&gt;
	at java.util.concurrent.FutureTask.run(FutureTask.java:138)&lt;br/&gt;
	at java.util.concurrent.ThreadPoolExecutor$Worker.runTask(ThreadPoolExecutor.java:886)&lt;br/&gt;
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:908)&lt;br/&gt;
	at java.lang.Thread.run(Thread.java:662)&lt;/p&gt;


&lt;p&gt;Update: I dont know if it is important but here is the schema of my test:&lt;br/&gt;
create keyspace Test with placement_strategy = &apos;org.apache.cassandra.locator.SimpleStrategy&apos; and strategy_options = &lt;/p&gt;
{replication_factor:2}
&lt;p&gt;;&lt;br/&gt;
CREATE COLUMN FAMILY Response WITH key_validation_class=BytesType AND compression_options=&lt;/p&gt;
{sstable_compression:DeflateCompressor}
&lt;p&gt;;&lt;/p&gt;


&lt;p&gt;kind regards,&lt;br/&gt;
Christian&lt;/p&gt;</description>
                <environment>&lt;p&gt;Ubuntu Linux amd64, 1.0.0-rc2&lt;/p&gt;</environment>
        <key id="12527360">CASSANDRA-3369</key>
            <summary>AssertionError when adding a node and doing repair, repair hangs</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10002" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Normal</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="slebresne">Sylvain Lebresne</assignee>
                                    <reporter username="christianmovi">Christian Spriegel</reporter>
                        <labels>
                    </labels>
                <created>Sun, 16 Oct 2011 16:35:01 +0000</created>
                <updated>Tue, 16 Apr 2019 09:32:48 +0000</updated>
                            <resolved>Fri, 21 Oct 2011 13:33:30 +0000</resolved>
                                        <fixVersion>0.8.8</fixVersion>
                    <fixVersion>1.0.1</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                                                                <comments>
                            <comment id="13128439" author="christianmovi" created="Sun, 16 Oct 2011 16:38:05 +0000"  >&lt;p&gt;Added config and log files from both cassandra nodes.&lt;/p&gt;</comment>
                            <comment id="13128541" author="christianmovi" created="Sun, 16 Oct 2011 23:09:15 +0000"  >&lt;p&gt;Update: I also had problems because I was using Defalte compression, which seems to be broken. The AssertionError during repair still occurs with Snappy Compression.&lt;/p&gt;</comment>
                            <comment id="13129645" author="slebresne" created="Tue, 18 Oct 2011 10:23:31 +0000"  >&lt;p&gt;This is due to the code not handling correctly a case of having no sample keys for one of it&apos;s token range.&lt;/p&gt;

&lt;p&gt;Let&apos;s not that:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;this is not specific to 1.0.0, 0.8 is affected too.&lt;/li&gt;
	&lt;li&gt;this only affect order preserving partitioner (not because the order matter but because this code path is not taken with RandomPartitioner since a few releases now, at least as far as repair is concerned).&lt;/li&gt;
	&lt;li&gt;this would be unlikely to show in any serious production setting, since having no sample for a given range means that either you have almost no rows in the cluster or that the cluster is extremely badly balanced.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Patch attached to fix (against 0.8).&lt;/p&gt;</comment>
                            <comment id="13132092" author="jbellis" created="Thu, 20 Oct 2011 21:54:52 +0000"  >&lt;p&gt;+1&lt;/p&gt;</comment>
                            <comment id="13132668" author="slebresne" created="Fri, 21 Oct 2011 13:33:30 +0000"  >&lt;p&gt;Committed&lt;/p&gt;</comment>
                            <comment id="13132769" author="hudson" created="Fri, 21 Oct 2011 16:00:27 +0000"  >&lt;p&gt;Integrated in Cassandra-0.8 #384 (See &lt;a href=&quot;https://builds.apache.org/job/Cassandra-0.8/384/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/Cassandra-0.8/384/&lt;/a&gt;)&lt;br/&gt;
    fix assertion error during repair with ordered partitioners&lt;br/&gt;
patch by slebresne; reviewed by jbellis for &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-3369&quot; title=&quot;AssertionError when adding a node and doing repair, repair hangs&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-3369&quot;&gt;&lt;del&gt;CASSANDRA-3369&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;slebresne : &lt;a href=&quot;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1187333&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1187333&lt;/a&gt;&lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/cassandra/branches/cassandra-0.8/CHANGES.txt&lt;/li&gt;
	&lt;li&gt;/cassandra/branches/cassandra-0.8/src/java/org/apache/cassandra/io/sstable/SSTableReader.java&lt;/li&gt;
	&lt;li&gt;/cassandra/branches/cassandra-0.8/src/java/org/apache/cassandra/service/AntiEntropyService.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                    </comments>
                    <attachments>
                            <attachment id="12499528" name="3369.patch" size="2065" author="slebresne" created="Tue, 18 Oct 2011 10:23:31 +0000"/>
                            <attachment id="12499204" name="NODE1_cassandra.yaml" size="17627" author="christianmovi" created="Sun, 16 Oct 2011 16:38:05 +0000"/>
                            <attachment id="12499205" name="NODE1_system.log" size="32010" author="christianmovi" created="Sun, 16 Oct 2011 16:38:05 +0000"/>
                            <attachment id="12499206" name="NODE2_cassandra.yaml" size="17627" author="christianmovi" created="Sun, 16 Oct 2011 16:38:05 +0000"/>
                            <attachment id="12499207" name="NODE2_system.log" size="21515" author="christianmovi" created="Sun, 16 Oct 2011 16:38:05 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>5.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[slebresne]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>87508</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            14 years, 5 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0gj1r:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>94516</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>jbellis</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[jbellis]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12962"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>