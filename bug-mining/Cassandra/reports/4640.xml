<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 23:06:31 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-9639] size_estimates is inacurate in multi-dc clusters</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-9639</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-7688&quot; title=&quot;Add data sizing to a system table&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-7688&quot;&gt;&lt;del&gt;CASSANDRA-7688&lt;/del&gt;&lt;/a&gt; introduced size_estimates to replace the thrift describe_splits_ex command.&lt;/p&gt;

&lt;p&gt;Users have reported seeing estimates that are widely off in multi-dc clusters.&lt;/p&gt;

&lt;p&gt;system.size_estimates show the wrong range_start / range_end&lt;/p&gt;</description>
                <environment></environment>
        <key id="12839908">CASSANDRA-9639</key>
            <summary>size_estimates is inacurate in multi-dc clusters</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10003" iconUrl="https://issues.apache.org/jira/images/icons/priorities/trivial.svg">Low</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="cnlwsu">Chris Lohfink</assignee>
                                    <reporter username="sebastian.estevez@datastax.com">Sebastian Estevez</reporter>
                        <labels>
                    </labels>
                <created>Tue, 23 Jun 2015 17:53:58 +0000</created>
                <updated>Tue, 16 Apr 2019 09:31:07 +0000</updated>
                            <resolved>Wed, 15 Feb 2017 13:00:12 +0000</resolved>
                                        <fixVersion>3.0.11</fixVersion>
                                        <due></due>
                            <votes>3</votes>
                                    <watches>7</watches>
                                                                                                                <comments>
                            <comment id="15839888" author="cnlwsu" created="Thu, 26 Jan 2017 15:44:09 +0000"  >&lt;p&gt;The primary ranges will differ based on the keyspace and replication strategy/factor. Particularly true of vnode/multi DC environments where the TokenMetadata.getPredecessor of each local token is not necessarily the bounds of the primary ranges. patch at &lt;a href=&quot;https://github.com/clohfink/cassandra/pull/6&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/clohfink/cassandra/pull/6&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15860082" author="pauloricardomg" created="Thu, 9 Feb 2017 19:54:15 +0000"  >&lt;p&gt;LGTM, thanks! We should also take the chance here to avoid merging overlapping ranges (which was introduced on &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-9462?focusedCommentId=14611854&amp;amp;page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-14611854&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;CASSANDRA-9462&lt;/a&gt;), since this will require the client to manually split the ranges to be able to directly run repair on ranges from the &lt;tt&gt;size_estimates&lt;/tt&gt; table. For instance, a node with ranges (-2688160409776496397, -2506475074448728501) and (-2506475074448728501, 8473270337963525440) will currently be inserted into &lt;tt&gt;system.size_estimates&lt;/tt&gt; as (-2688160409776496397, 8473270337963525440), due to the merging of neighbor ranges.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=cnlwsu&quot; class=&quot;user-hover&quot; rel=&quot;cnlwsu&quot;&gt;cnlwsu&lt;/a&gt; can you have a look on &lt;a href=&quot;https://github.com/pauloricardomg/cassandra/commit/e26e1513812c3f2df2ea375585a575730bbb949e&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;this commit&lt;/a&gt;? It basically avoids normalizing ranges, but instead just unwrap wrap-around ranges, which was the original idea behind &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-9462&quot; title=&quot;ViewTest.sstableInBounds is failing&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-9462&quot;&gt;&lt;del&gt;CASSANDRA-9462&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;I also added a regression &lt;a href=&quot;https://github.com/riptano/cassandra-dtest/pull/1439&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;dtest&lt;/a&gt; to make sure this is working as expected.&lt;/p&gt;

&lt;p&gt;Updated patch and tests available below:&lt;/p&gt;
&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;3.0&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;dtest&lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/apache/cassandra/compare/cassandra-3.0...pauloricardomg:3.0-9639&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;branch&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/riptano/cassandra-dtest/compare/master...pauloricardomg:9639&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;branch&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/paulomotta/job/pauloricardomg-3.0-9639-testall/lastCompletedBuild/testReport/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;testall&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/paulomotta/job/pauloricardomg-3.0-9639-dtest/lastCompletedBuild/testReport/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;dtest&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;
</comment>
                            <comment id="15861967" author="cnlwsu" created="Fri, 10 Feb 2017 23:00:38 +0000"  >&lt;p&gt;+1 on changes from me&lt;/p&gt;</comment>
                            <comment id="15866591" author="scottbale" created="Tue, 14 Feb 2017 20:32:19 +0000"  >&lt;p&gt;If at all possible, could we add this bit of improved logging to &lt;tt&gt;ActiveRepairService.java&lt;/tt&gt; as part of this ticket? We have been frequently running into this &quot;Requested range intersects...&quot; error as we try to repair the cluster which is what led us to this ticket.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;diff --git a/src/java/org/apache/cassandra/service/ActiveRepairService.java b/src/java/org/apache/cassandra/service/ActiveRepairService.java
index bde5313005..18d43ed56f 100644
--- a/src/java/org/apache/cassandra/service/ActiveRepairService.java
+++ b/src/java/org/apache/cassandra/service/ActiveRepairService.java
@@ -220,7 +220,8 @@ &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;ActiveRepairService &lt;span class=&quot;code-keyword&quot;&gt;implements&lt;/span&gt; IEndpointStateChangeSubscriber, IFai
             }
             &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (range.intersects(toRepair))
             {
-                &lt;span class=&quot;code-keyword&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; IllegalArgumentException(&lt;span class=&quot;code-quote&quot;&gt;&quot;Requested range intersects a local range but is not fully contained in one; &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; would lead to imprecise repair&quot;&lt;/span&gt;);
+                &lt;span class=&quot;code-keyword&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; IllegalArgumentException(&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;.format(&lt;span class=&quot;code-quote&quot;&gt;&quot;Requested range %s intersects a local range %s but is not fully contained in one; &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; would lead to imprecise repair. keyspace: %s&quot;&lt;/span&gt;, toRepair.toString(), range.toString(), keyspaceName));
             }
         }
         &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (rangeSuperSet == &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; || !replicaSets.containsKey(rangeSuperSet))
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="15867787" author="pauloricardomg" created="Wed, 15 Feb 2017 13:00:13 +0000"  >&lt;p&gt;Added NEWS.txt entry about change on &lt;tt&gt;system.size_estimates&lt;/tt&gt; table and committed to 3.0 and up as &lt;tt&gt;af7b20bd0ea0d1e80553c519510c9ad9f29af64a&lt;/tt&gt;. Committed ninja fix to subrange repair error message to 3.0 and merged up as &lt;tt&gt;f02f154e47be13dd481fe7afe18183c615f39c71&lt;/tt&gt;. Merged &lt;a href=&quot;https://github.com/riptano/cassandra-dtest/pull/1439&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;cassandra-dtest PR&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;Thanks all!&lt;/p&gt;</comment>
                            <comment id="15868113" author="scottbale" created="Wed, 15 Feb 2017 16:17:58 +0000"  >&lt;p&gt;Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=pauloricardomg&quot; class=&quot;user-hover&quot; rel=&quot;pauloricardomg&quot;&gt;pauloricardomg&lt;/a&gt;!&lt;/p&gt;</comment>
                            <comment id="15939995" author="ifesdjeen" created="Fri, 24 Mar 2017 08:31:30 +0000"  >&lt;p&gt;Unfortunately, added dtest was / is failing for this issue: &lt;a href=&quot;http://cassci.datastax.com/job/trunk_dtest/lastCompletedBuild/testReport/junit/topology_test/TestTopology/size_estimates_multidc_test/history/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;history&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310050">
                    <name>Regression</name>
                                            <outwardlinks description="breaks">
                                        <issuelink>
            <issuekey id="13043673">CASSANDRA-13229</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[cnlwsu]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 34 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2geav:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>pauloricardomg</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[pauloricardomg]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12961"><![CDATA[Low]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>