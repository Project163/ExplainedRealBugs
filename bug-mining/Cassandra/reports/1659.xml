<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 22:33:38 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-4311] clean up messagingservice protocol limitations</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-4311</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;Weaknesses of the existing protocol:&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;information asymmetry: node A can know what version node B expects, but not vice versa (see &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-4101&quot; title=&quot;Gossip should propagate MessagingService.version&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-4101&quot;&gt;&lt;del&gt;CASSANDRA-4101&lt;/del&gt;&lt;/a&gt;)&lt;/li&gt;
	&lt;li&gt;delayed information: node A will often not know what version node B expects, until after first contacting node B &amp;#8211; forcing it to throw that first message away and retry for the next one&lt;/li&gt;
	&lt;li&gt;protocol cannot handle both cross-dc forwarding and broadcast_address != socket address (see bottom of &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-4099&quot; title=&quot;IncomingTCPConnection recognizes from by doing socket.getInetAddress() instead of BroadCastAddress&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-4099&quot;&gt;&lt;del&gt;CASSANDRA-4099&lt;/del&gt;&lt;/a&gt;)&lt;/li&gt;
	&lt;li&gt;version is partly global, partly per-connection, and partly per-message, resulting in some interesting hacks (&lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-3166&quot; title=&quot;Rolling upgrades from 0.7 to 0.8 not possible&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-3166&quot;&gt;&lt;del&gt;CASSANDRA-3166&lt;/del&gt;&lt;/a&gt;) and difficulty layering more sophisticated OutputStreams on the socket (&lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-3127&quot; title=&quot;Message (inter-node) compression&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-3127&quot;&gt;&lt;del&gt;CASSANDRA-3127&lt;/del&gt;&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-4139&quot; title=&quot;Add varint encoding to Messaging service&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-4139&quot;&gt;&lt;del&gt;CASSANDRA-4139&lt;/del&gt;&lt;/a&gt;)&lt;/li&gt;
&lt;/ul&gt;
</description>
                <environment></environment>
        <key id="12559479">CASSANDRA-4311</key>
            <summary>clean up messagingservice protocol limitations</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10002" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Normal</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="jbellis">Jonathan Ellis</assignee>
                                    <reporter username="jbellis">Jonathan Ellis</reporter>
                        <labels>
                            <label>jmx</label>
                    </labels>
                <created>Wed, 6 Jun 2012 02:18:57 +0000</created>
                <updated>Tue, 16 Apr 2019 09:32:33 +0000</updated>
                            <resolved>Thu, 14 Jun 2012 23:03:46 +0000</resolved>
                                        <fixVersion>1.2.0 beta 1</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="13289905" author="jbellis" created="Wed, 6 Jun 2012 02:22:54 +0000"  >&lt;p&gt;I think we can address all of these by making these changes to VERSION_12 protocol:&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;send version and connection metadata just once per connection.  This will give the other side enough information to know whether to expect a compressed or varint stream&lt;/li&gt;
	&lt;li&gt;&lt;b&gt;both&lt;/b&gt; sides exchange CURRENT_VERSION when connection is established; each side will then have version information immediately upon contacting another node&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;As a consequence,&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;When version changes, we need to drop existing connections and reconnect (already implied but not yet implemented by &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-3127&quot; title=&quot;Message (inter-node) compression&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-3127&quot;&gt;&lt;del&gt;CASSANDRA-3127&lt;/del&gt;&lt;/a&gt;)&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13289921" author="jbellis" created="Wed, 6 Jun 2012 03:11:38 +0000"  >&lt;p&gt;I think the changes to ITC demonstrate what I have in mind pretty clearly (attached).  I&apos;ll flesh the rest of this out shortly.&lt;/p&gt;</comment>
                            <comment id="13290264" author="brandon.williams" created="Wed, 6 Jun 2012 16:52:52 +0000"  >&lt;p&gt;This looks like a good solution so far.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;When version changes, we need to drop existing connections and reconnect&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Let me take this opportunity to suggest that set/getVersion be moved out of Gossiper (which does nothing but expose a Map) and into MS.&lt;/p&gt;</comment>
                            <comment id="13290314" author="jbellis" created="Wed, 6 Jun 2012 18:17:16 +0000"  >&lt;p&gt;Pushed to &lt;a href=&quot;https://github.com/jbellis/cassandra/branches/4311-2&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/jbellis/cassandra/branches/4311-2&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13290969" author="krummas" created="Thu, 7 Jun 2012 12:36:55 +0000"  >&lt;p&gt;looks good to me, just a bit confusing calling it a &apos;header&apos; when it is essentially a handshake packet&lt;/p&gt;

&lt;p&gt;could we negotiate SSL the way we do compression? nothing &apos;secret&apos; is shared during the handshake phase anyway, after that we could upgrade sockets&lt;/p&gt;</comment>
                            <comment id="13291160" author="brandon.williams" created="Thu, 7 Jun 2012 17:49:45 +0000"  >&lt;p&gt;MS.setVersion needs a minor fix to prevent NPE:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;     public Integer setVersion(InetAddress address, int version)
     {
         logger.debug(&quot;Setting version {} for {}&quot;, version, address);
         Integer v = versions.put(address, version);
         return v == null ? version : v;
     }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;+1 otherwise.&lt;/p&gt;</comment>
                            <comment id="13295367" author="jbellis" created="Thu, 14 Jun 2012 23:03:46 +0000"  >&lt;blockquote&gt;&lt;p&gt;MS.setVersion needs a minor fix to prevent NPE&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Done and committed.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;could we negotiate SSL the way we do compression&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Sure, can you open a separate ticket for that?&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12559719">CASSANDRA-4317</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12531058" name="4311-skeleton.txt" size="8419" author="jbellis" created="Wed, 6 Jun 2012 03:11:37 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[jbellis]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>256050</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            13 years, 23 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0gug7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>96363</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>brandon.williams</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[brandon.williams]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12962"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>