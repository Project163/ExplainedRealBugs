<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 23:29:55 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-18635] Test failure: org.apache.cassandra.distributed.test.UpgradeSSTablesTest</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-18635</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;Seen here: &lt;a href=&quot;https://app.circleci.com/pipelines/github/driftx/cassandra/1095/workflows/6114e2e3-8dcc-4bb0-b664-ae7d82c3349f/jobs/33405/tests&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://app.circleci.com/pipelines/github/driftx/cassandra/1095/workflows/6114e2e3-8dcc-4bb0-b664-ae7d82c3349f/jobs/33405/tests&lt;/a&gt;&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;junit.framework.AssertionFailedError: expected:&amp;lt;0&amp;gt; but was:&amp;lt;2&amp;gt;
	at org.apache.cassandra.distributed.test.UpgradeSSTablesTest.upgradeSSTablesInterruptsOngoingCompaction(UpgradeSSTablesTest.java:86)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="13541767">CASSANDRA-18635</key>
            <summary>Test failure: org.apache.cassandra.distributed.test.UpgradeSSTablesTest</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10002" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Normal</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="bereng">Berenguer Blasi</assignee>
                                    <reporter username="brandon.williams">Brandon Williams</reporter>
                        <labels>
                    </labels>
                <created>Wed, 28 Jun 2023 10:56:28 +0000</created>
                <updated>Fri, 10 Oct 2025 08:47:58 +0000</updated>
                            <resolved>Mon, 11 Mar 2024 07:12:06 +0000</resolved>
                                        <fixVersion>5.0-rc1</fixVersion>
                    <fixVersion>5.0</fixVersion>
                    <fixVersion>5.1</fixVersion>
                                    <component>Test/dtest/java</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>6</watches>
                                                                                                                <comments>
                            <comment id="17748119" author="adelapena" created="Thu, 27 Jul 2023 12:02:58 +0000"  >&lt;p&gt;I haven&apos;t been able to reproduce the test failure with 6x2000 runs of the separate test method on CircleCI:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;&lt;a href=&quot;https://app.circleci.com/pipelines/github/adelapena/cassandra/3065/workflows/b4f20634-76f8-4a6a-8fda-740c252c3a79&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://app.circleci.com/pipelines/github/adelapena/cassandra/3065/workflows/b4f20634-76f8-4a6a-8fda-740c252c3a79&lt;/a&gt;&lt;/li&gt;
	&lt;li&gt;&lt;a href=&quot;https://app.circleci.com/pipelines/github/adelapena/cassandra/3065/workflows/61985e9e-647a-44e0-bad6-9728944b1fc2&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://app.circleci.com/pipelines/github/adelapena/cassandra/3065/workflows/61985e9e-647a-44e0-bad6-9728944b1fc2&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;The config has been generated with:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
.circleci/generate.sh -ps \ 
  -e REPEATED_JVM_DTESTS=org.apache.cassandra.distributed.test.UpgradeSSTablesTest#upgradeSSTablesInterruptsOngoingCompaction \
  -e REPEATED_JVM_DTESTS_COUNT=2000
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="17748142" author="brandon.williams" created="Thu, 27 Jul 2023 12:53:04 +0000"  >&lt;p&gt;I haven&apos;t seen it again since that one run, but it&apos;s an assertion so I suspect it&apos;s just quite rare.&lt;/p&gt;</comment>
                            <comment id="17748255" author="adelapena" created="Thu, 27 Jul 2023 16:56:46 +0000"  >&lt;p&gt;I&apos;ve hit it once again while trying to run the entire suite, although I don&apos;t think that&apos;s related:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;&lt;a href=&quot;https://app.circleci.com/pipelines/github/adelapena/cassandra/3066/workflows/829e7359-a093-4bf2-8ea3-8378cdb1aef0/jobs/63858/tests&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://app.circleci.com/pipelines/github/adelapena/cassandra/3066/workflows/829e7359-a093-4bf2-8ea3-8378cdb1aef0/jobs/63858/tests&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
junit.framework.AssertionFailedError: Expected &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; code 0 but found 2, stdout: jobs (2) is bigger than configured concurrent_compactors (1) on the host, using at most 1 threads
, stderr: error: Compaction interrupted: Upgrade sstables(eb86b21a-2c90-11ee-a988-c3c90d9686be, 0 / 11304 bytes)@eae20da0-2c90-11ee-a988-c3c90d9686be(distributed_test_keyspace, tbl)
-- StackTrace --
org.apache.cassandra.db.compaction.CompactionInterruptedException: Compaction interrupted: Upgrade sstables(eb86b21a-2c90-11ee-a988-c3c90d9686be, 0 / 11304 bytes)@eae20da0-2c90-11ee-a988-c3c90d9686be(distributed_test_keyspace, tbl)
	at org.apache.cassandra.db.compaction.CompactionTask.runMayThrow(CompactionTask.java:204)
	at org.apache.cassandra.utils.WrappedRunnable.run(WrappedRunnable.java:26)
	at org.apache.cassandra.db.compaction.CompactionTask.executeInternal(CompactionTask.java:86)
	at org.apache.cassandra.db.compaction.AbstractCompactionTask.execute(AbstractCompactionTask.java:100)
	at org.apache.cassandra.db.compaction.CompactionManager$4.execute(CompactionManager.java:611)
	at org.apache.cassandra.db.compaction.CompactionManager$1.call(CompactionManager.java:456)
	at org.apache.cassandra.concurrent.FutureTask.call(FutureTask.java:61)
	at org.apache.cassandra.concurrent.FutureTask.run(FutureTask.java:71)
	at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1128)
	at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:628)
	at io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)
	at java.base/java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:829)

 expected:&amp;lt;0&amp;gt; but was:&amp;lt;2&amp;gt;
	at org.apache.cassandra.distributed.test.UpgradeSSTablesTest.upgradeSSTablesInterruptsOngoingCompaction(UpgradeSSTablesTest.java:89)
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43) &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Somehow the compaction task submitted by &lt;tt&gt;upgradesstables&lt;/tt&gt; gets interrupted.&lt;/p&gt;</comment>
                            <comment id="17752137" author="adelapena" created="Tue, 8 Aug 2023 17:02:50 +0000"  >&lt;p&gt;The test seems to be flaky since its introduction by&#160;&lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-17851&quot; title=&quot;Add interim prioritization logic for CompactionTasks&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-17851&quot;&gt;&lt;del&gt;CASSANDRA-17851&lt;/del&gt;&lt;/a&gt; (&lt;a href=&quot;https://github.com/apache/cassandra/commit/377e114cb1459895423c292cb0bf7f921fd30e43&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;377e114cb1459895423c292cb0bf7f921fd30e43&lt;/a&gt;): &lt;a href=&quot;https://app.circleci.com/pipelines/github/adelapena/cassandra/3093/workflows/67c2fdec-1f07-4343-9482-150478cea032/jobs/66582/tests&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://app.circleci.com/pipelines/github/adelapena/cassandra/3093/workflows/67c2fdec-1f07-4343-9482-150478cea032/jobs/66582/tests&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;CC &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ifesdjeen&quot; class=&quot;user-hover&quot; rel=&quot;ifesdjeen&quot;&gt;ifesdjeen&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jmckenzie&quot; class=&quot;user-hover&quot; rel=&quot;jmckenzie&quot;&gt;jmckenzie&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17782349" author="edimitrova" created="Thu, 2 Nov 2023 23:08:57 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ifesdjeen&quot; class=&quot;user-hover&quot; rel=&quot;ifesdjeen&quot;&gt;ifesdjeen&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=JoshuaMcKenzie&quot; class=&quot;user-hover&quot; rel=&quot;JoshuaMcKenzie&quot;&gt;JoshuaMcKenzie&lt;/a&gt;, did you have any chance to look into this one?&#160;&lt;/p&gt;

&lt;p&gt;Do we know whether this is a production or test bug to triage it better?&lt;/p&gt;</comment>
                            <comment id="17783775" author="jmckenzie" created="Tue, 7 Nov 2023 19:50:39 +0000"  >&lt;p&gt;I&apos;ll try and carve out time to take a closer look later this week.&lt;/p&gt;</comment>
                            <comment id="17783778" author="edimitrova" created="Tue, 7 Nov 2023 20:12:45 +0000"  >&lt;p&gt;Thanks, appreciate it!&lt;/p&gt;</comment>
                            <comment id="17813124" author="bereng" created="Thu, 1 Feb 2024 09:17:22 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jmckenzie&quot; class=&quot;user-hover&quot; rel=&quot;jmckenzie&quot;&gt;jmckenzie&lt;/a&gt; can I steal this one from you? I think I have it pinned down or at least I am in the right track&lt;/p&gt;</comment>
                            <comment id="17813524" author="bereng" created="Fri, 2 Feb 2024 07:29:09 +0000"  >&lt;p&gt;Posting my findings so far: The exception is &lt;a href=&quot;https://github.com/apache/cassandra/blob/cassandra-5.0/src/java/org/apache/cassandra/db/compaction/CompactionTask.java#L204&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;thrown&lt;/a&gt; when the CSM is paused which can happen for number of reasons such as stopping or forcing a compaction, acquiring sstables, etc. If a compaction is forced, pausing the CSM, just as a compaction task is already running then it throws. This is why it&apos;s so difficult to repro.&lt;/p&gt;

&lt;p&gt;I didn&apos;t manage to repro but forcing to throw from the CompactionTask reproduces the same exact stracktrace, error codes, messages and all the dots seem to connect nicely. Here we have some log + extra stack traces, where code lines also match test code lines, where the issued compaction pauses and resumes the CSM, then a later &lt;tt&gt;upgradesstables&lt;/tt&gt; does indeed interrupt the compaction. Given these are async an unlucky run will hit the problem:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;DEBUG [node1_isolatedExecutor:1] node1 2024-02-01 10:13:04,909 Cancelling in-progress compactions for tbl
DEBUG [node1_isolatedExecutor:1] node1 2024-02-01 10:13:04,910 Bereng paused
java.lang.Exception
	at org.apache.cassandra.db.compaction.CompactionStrategyManager.pause(CompactionStrategyManager.java:306)
	at org.apache.cassandra.db.ColumnFamilyStore.pauseCompactionStrategies(ColumnFamilyStore.java:2899)
	at org.apache.cassandra.db.ColumnFamilyStore.runWithCompactionsDisabled(ColumnFamilyStore.java:2846)
	at org.apache.cassandra.db.ColumnFamilyStore.runWithCompactionsDisabled(ColumnFamilyStore.java:2815)
	at org.apache.cassandra.db.compaction.CompactionStrategyManager.getMaximalTasks(CompactionStrategyManager.java:1071)
	at org.apache.cassandra.db.compaction.CompactionManager.submitMaximal(CompactionManager.java:993)
	at org.apache.cassandra.distributed.test.UpgradeSSTablesTest.lambda$upgradeSSTablesInterruptsOngoingCompaction$53e4ed01$1(UpgradeSSTablesTest.java:84)
	at org.apache.cassandra.distributed.impl.IsolatedExecutor.lambda$async$10(IsolatedExecutor.java:156)
	at org.apache.cassandra.concurrent.FutureTask$1.call(FutureTask.java:96)
	at org.apache.cassandra.concurrent.FutureTask.call(FutureTask.java:61)
	at org.apache.cassandra.concurrent.FutureTask.run(FutureTask.java:71)
	at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1128)
	at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:628)
	at io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)
	at java.base/java.lang.Thread.run(Thread.java:829)

DEBUG [node1_isolatedExecutor:1] node1 2024-02-01 10:13:04,913 Bereng resume
java.lang.Exception
	at org.apache.cassandra.db.compaction.CompactionStrategyManager.resume(CompactionStrategyManager.java:287)
	at org.apache.cassandra.db.ColumnFamilyStore.resumeAll(ColumnFamilyStore.java:2917)
	at org.apache.cassandra.db.ColumnFamilyStore.lambda$pauseCompactionStrategies$14(ColumnFamilyStore.java:2902)
	at org.apache.cassandra.db.ColumnFamilyStore.runWithCompactionsDisabled(ColumnFamilyStore.java:2887)
	at org.apache.cassandra.db.ColumnFamilyStore.runWithCompactionsDisabled(ColumnFamilyStore.java:2815)
	at org.apache.cassandra.db.compaction.CompactionStrategyManager.getMaximalTasks(CompactionStrategyManager.java:1071)
	at org.apache.cassandra.db.compaction.CompactionManager.submitMaximal(CompactionManager.java:993)
	at org.apache.cassandra.distributed.test.UpgradeSSTablesTest.lambda$upgradeSSTablesInterruptsOngoingCompaction$53e4ed01$1(UpgradeSSTablesTest.java:84)
	at org.apache.cassandra.distributed.impl.IsolatedExecutor.lambda$async$10(IsolatedExecutor.java:156)
	at org.apache.cassandra.concurrent.FutureTask$1.call(FutureTask.java:96)
	at org.apache.cassandra.concurrent.FutureTask.call(FutureTask.java:61)
	at org.apache.cassandra.concurrent.FutureTask.run(FutureTask.java:71)
	at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1128)
	at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:628)
	at io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)
	at java.base/java.lang.Thread.run(Thread.java:829)

INFO  [node1_isolatedExecutor:1] node1 2024-02-01 10:13:04,913 Major compaction will not result in a single sstable - repaired and unrepaired data is kept separate and compaction runs per data_file_directory.
DEBUG [node1_CompactionExecutor:1] node1 2024-02-01 10:13:04,915 FileStore / (/dev/nvme0n1p3) has 257607498752 bytes available, checking if we can write 2639 bytes
INFO  [node1_CompactionExecutor:1] node1 2024-02-01 10:13:04,916 Compacting (1b5a7900-c0e2-11ee-a2d5-d1a8b9818275) [/home/bereng/work/repos/bdpWS/18635/build/tmp/dtests9959175088994503563/node1/data0/distributed_test_keyspace/tbl-1a850090c0e211eea2d5d1a8b9818275/nb-4-big-Data.db:level=0, /home/bereng/work/repos/bdpWS/18635/build/tmp/dtests9959175088994503563/node1/data0/distributed_test_keyspace/tbl-1a850090c0e211eea2d5d1a8b9818275/nb-1-big-Data.db:level=0, /home/bereng/work/repos/bdpWS/18635/build/tmp/dtests9959175088994503563/node1/data0/distributed_test_keyspace/tbl-1a850090c0e211eea2d5d1a8b9818275/nb-13-big-Data.db:level=0, /home/bereng/work/repos/bdpWS/18635/build/tmp/dtests9959175088994503563/node1/data0/distributed_test_keyspace/tbl-1a850090c0e211eea2d5d1a8b9818275/nb-7-big-Data.db:level=0, /home/bereng/work/repos/bdpWS/18635/build/tmp/dtests9959175088994503563/node1/data0/distributed_test_keyspace/tbl-1a850090c0e211eea2d5d1a8b9818275/nb-10-big-Data.db:level=0, ]
INFO  [node1_isolatedExecutor:2] node1 2024-02-01 10:13:04,928 Starting Upgrade sstables on distributed_test_keyspace.[tbl]
DEBUG [node1_isolatedExecutor:2] node1 2024-02-01 10:13:04,932 Cancelling in-progress compactions for tbl
DEBUG [node1_isolatedExecutor:2] node1 2024-02-01 10:13:04,932 Bereng paused
java.lang.Exception
	at org.apache.cassandra.db.compaction.CompactionStrategyManager.pause(CompactionStrategyManager.java:306)
	at org.apache.cassandra.db.ColumnFamilyStore.pauseCompactionStrategies(ColumnFamilyStore.java:2899)
	at org.apache.cassandra.db.ColumnFamilyStore.runWithCompactionsDisabled(ColumnFamilyStore.java:2846)
	at org.apache.cassandra.db.ColumnFamilyStore.runWithCompactionsDisabled(ColumnFamilyStore.java:2815)
	at org.apache.cassandra.db.ColumnFamilyStore.withAllSSTables(ColumnFamilyStore.java:2938)
	at org.apache.cassandra.db.compaction.CompactionManager.parallelAllSSTableOperation(CompactionManager.java:430)
	at org.apache.cassandra.db.compaction.CompactionManager.performSSTableRewrite(CompactionManager.java:584)
	at org.apache.cassandra.db.compaction.CompactionManager.performSSTableRewrite(CompactionManager.java:557)
	at org.apache.cassandra.db.ColumnFamilyStore.sstablesRewrite(ColumnFamilyStore.java:1813)
	at org.apache.cassandra.service.StorageService.rewriteSSTables(StorageService.java:4167)
	at org.apache.cassandra.service.StorageService.upgradeSSTables(StorageService.java:4145)
	at org.apache.cassandra.tools.NodeProbe.upgradeSSTables(NodeProbe.java:369)
	at org.apache.cassandra.tools.NodeProbe.lambda$upgradeSSTables$4(NodeProbe.java:424)
	at org.apache.cassandra.tools.NodeProbe.perform(NodeProbe.java:435)
	at org.apache.cassandra.tools.NodeProbe.upgradeSSTables(NodeProbe.java:423)
	at org.apache.cassandra.tools.nodetool.UpgradeSSTable.execute(UpgradeSSTable.java:61)
	at org.apache.cassandra.tools.NodeTool$NodeToolCmd.runInternal(NodeTool.java:383)
	at org.apache.cassandra.tools.NodeTool$NodeToolCmd.run(NodeTool.java:368)
	at org.apache.cassandra.tools.NodeTool.execute(NodeTool.java:267)
	at org.apache.cassandra.distributed.impl.Instance$DTestNodeTool.execute(Instance.java:1104)
	at org.apache.cassandra.distributed.impl.Instance.lambda$nodetoolResult$50(Instance.java:1013)
	at org.apache.cassandra.concurrent.FutureTask.call(FutureTask.java:61)
	at org.apache.cassandra.concurrent.FutureTask.run(FutureTask.java:71)
	at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1128)
	at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:628)
	at io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)
	at java.base/java.lang.Thread.run(Thread.java:829)

INFO  [node1_CompactionExecutor:1] node1 2024-02-01 10:13:04,956 Compaction interrupted: Compaction(1b5a7900-c0e2-11ee-a2d5-d1a8b9818275, 0 / 49835 bytes)@1a850090-c0e2-11ee-a2d5-d1a8b9818275(distributed_test_keyspace, tbl)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;So everything seems correct where the compaction is issued and then later interrupted . I would suggest a fix where nodetool&apos;s &lt;tt&gt;upgradesstables&lt;/tt&gt; would just spin+retry for 5s if that exception is hit. My 2cts.&lt;/p&gt;</comment>
                            <comment id="17817058" author="edimitrova" created="Tue, 13 Feb 2024 16:13:00 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=Bereng&quot; class=&quot;user-hover&quot; rel=&quot;bereng&quot;&gt;Bereng&lt;/a&gt; , I just hit this failure from the same class:&lt;/p&gt;

&lt;p&gt;truncateWhileUpgrading-_jdk17&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
junit.framework.AssertionFailedError at org.apache.cassandra.distributed.test.UpgradeSSTablesTest.truncateWhileUpgrading(UpgradeSSTablesTest.java:220) at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method) at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77) at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&lt;a href=&quot;https://app.circleci.com/pipelines/github/ekaterinadimitrova2/cassandra/2646/workflows/bc2bba74-9e56-4bea-8de7-4ff840c4f450/jobs/56028/tests#failed-test-0&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://app.circleci.com/pipelines/github/ekaterinadimitrova2/cassandra/2646/workflows/bc2bba74-9e56-4bea-8de7-4ff840c4f450/jobs/56028/tests#failed-test-0&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Not sure whether it can be related to what you do here, checking before moving to opening a new ticket, etc. Please advise.&#160;&lt;/p&gt;</comment>
                            <comment id="17817318" author="bereng" created="Wed, 14 Feb 2024 10:29:33 +0000"  >&lt;p&gt;I have mixed feelings here. I &apos;solved&apos; the present failure in a way everything makes sense to me. But this new failure makes me wonder if there is sthg fundamentally wrong in &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-17851&quot; title=&quot;Add interim prioritization logic for CompactionTasks&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-17851&quot;&gt;&lt;del&gt;CASSANDRA-17851&lt;/del&gt;&lt;/a&gt; or if it&apos;s just another case of unlucky async races.&lt;/p&gt;

&lt;p&gt;I &lt;em&gt;do&lt;/em&gt; understand this ticket&apos;s failure, or so I think, but not the one you bring. They might end up being the same thing or not. I vote to get this into review to get an extra pair of eyes but I would be inclined to open a new ticket. Reasoning being that this failure is on a race on tooling, whereas the new one is on not interrupting compactions while upgrading, which seems like a fundamental behavioral problem.&lt;/p&gt;</comment>
                            <comment id="17817513" author="edimitrova" created="Wed, 14 Feb 2024 20:06:49 +0000"  >&lt;p&gt;Thanks, I opened&#160;&lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-19398&quot; title=&quot;Test Failure: org.apache.cassandra.distributed.test.UpgradeSSTablesTest.truncateWhileUpgrading&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-19398&quot;&gt;&lt;del&gt;CASSANDRA-19398&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;My testing shows that the test was not failing when introduced, but it failed on the current 5.0.&#160;&lt;/p&gt;</comment>
                            <comment id="17817593" author="bereng" created="Thu, 15 Feb 2024 06:38:06 +0000"  >&lt;p&gt;^ ahhh so iiuc this might be sthg different. As this ticket&apos;s failure Andres bisected it to &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-17851&quot; title=&quot;Add interim prioritization logic for CompactionTasks&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-17851&quot;&gt;&lt;del&gt;CASSANDRA-17851&lt;/del&gt;&lt;/a&gt; thx&lt;/p&gt;</comment>
                            <comment id="17821799" author="edimitrova" created="Wed, 28 Feb 2024 18:04:28 +0000"  >&lt;p&gt;What do we do with this patch? &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jmckenzie&quot; class=&quot;user-hover&quot; rel=&quot;jmckenzie&quot;&gt;jmckenzie&lt;/a&gt; , as the original author, can you take a look, please?&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="17823937" author="bereng" created="Wed, 6 Mar 2024 09:41:58 +0000"  >&lt;p&gt;Ping. Reviewer needed.&lt;/p&gt;</comment>
                            <comment id="17823956" author="smiklosovic" created="Wed, 6 Mar 2024 10:25:52 +0000"  >&lt;p&gt;+1, I added 2 comments in the PR.&lt;/p&gt;</comment>
                            <comment id="17824445" author="brandon.williams" created="Thu, 7 Mar 2024 15:22:29 +0000"  >&lt;p&gt;Since we now know from &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-19398&quot; title=&quot;Test Failure: org.apache.cassandra.distributed.test.UpgradeSSTablesTest.truncateWhileUpgrading&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-19398&quot;&gt;&lt;del&gt;CASSANDRA-19398&lt;/del&gt;&lt;/a&gt; that was a separate issue, everything here makes sense to me.  I think we should do a run on trunk to confirm everything is good there and then I think we are ready to commit.&lt;/p&gt;</comment>
                            <comment id="17824723" author="bereng" created="Fri, 8 Mar 2024 10:42:50 +0000"  >&lt;p&gt;I pushed, rebased both PRs and added CI. 5.0 is green besides what I believe is a new flaky. Trunk it&apos;s just too difficult to tell and we can&apos;t match against jenkins. I think we&apos;ll have to use our best guesswork and comparision against 18753&apos;s trunk run &lt;a href=&quot;https://app.circleci.com/pipelines/github/blambov/cassandra?branch=CASSANDRA-18753-trunk?&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://app.circleci.com/pipelines/github/blambov/cassandra?branch=CASSANDRA-18753-trunk?&lt;/a&gt; I think it is ok to merge and failures look unrelated but I am happy to hear opinions.&lt;/p&gt;</comment>
                            <comment id="17824727" author="brandon.williams" created="Fri, 8 Mar 2024 10:50:49 +0000"  >&lt;p&gt;That all looks unrelated to me and the repeated tests passed, so I&apos;m +1&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310560">
                    <name>Problem/Incident</name>
                                                                <inwardlinks description="is caused by">
                                        <issuelink>
            <issuekey id="13478270">CASSANDRA-17851</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="13568453">CASSANDRA-19398</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[bereng]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12313825" key="com.atlassian.jira.plugin.system.customfieldtypes:cascadingselect">
                        <customfieldname>Bug Category</customfieldname>
                        <customfieldvalues>
                                                    <customfieldvalue key="12982" cascade-level=""><![CDATA[Correctness]]></customfieldvalue>
                                <customfieldvalue key="12990" cascade-level="1"><![CDATA[Test Failure]]></customfieldvalue>
            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12313821" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Complexity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12965"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313822" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Discovered By</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12969"><![CDATA[User Report]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12313922" key="jira.plugin.projectspecificselectfield.jpssf:multicftype">
                        <customfieldname>Impacts</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="13100"><![CDATA[None]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            1 year, 35 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12313921" key="jira.plugin.projectspecificselectfield.jpssf:multicftype">
                        <customfieldname>Platform</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="13076"><![CDATA[All]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z1iueg:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[brandon.williams]]></customfieldvalue>
        <customfieldvalue><![CDATA[smiklosovic]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12962"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12311420" key="com.atlassian.jira.plugin.system.customfieldtypes:version">
                        <customfieldname>Since Version</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="12353633">5.0-alpha2</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313924" key="com.atlassian.jira.plugin.system.customfieldtypes:textfield">
                        <customfieldname>Source Control Link</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>&lt;p&gt;&lt;a href=&quot;https://github.com/apache/cassandra/commit/451b0c010f0997d7bf9e3f4687bf9e75e2ebb004&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/cassandra/commit/451b0c010f0997d7bf9e3f4687bf9e75e2ebb004&lt;/a&gt;&lt;/p&gt;</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313823" key="com.atlassian.jira.plugin.system.customfieldtypes:textarea">
                        <customfieldname>Test and Documentation Plan</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>&lt;p&gt;See PR&lt;/p&gt;</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>