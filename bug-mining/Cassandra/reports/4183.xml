<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 23:02:00 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-11226] nodetool tablestats&apos; keyspace-level metrics are wrong/misleading</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-11226</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;In the nodetool tablestats output (formerly cfstats), we display &quot;keyspace&quot; level metrics before the table-level metrics:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Keyspace: testks
        Read Count: 14772528
        Read Latency: 0.14456651623879135 ms.
        Write Count: 4761283
        Write Latency: 0.062120404521218336 ms.
        Pending Flushes: 0
                Table: processes
                SSTable count: 7
                Space used (live): 496.76 MB
                Space used (total): 496.76 MB
                Space used by snapshots (total): 0 bytes
                Off heap memory used (total): 285.76 KB
                SSTable Compression Ratio: 0.2318241570710227
                Number of keys (estimate): 3027
                Memtable cell count: 2140
                Memtable data size: 1.66 MB
                Memtable off heap memory used: 0 bytes
                Memtable switch count: 967
                Local read count: 14772528
                Local read latency: 0.159 ms
                Local write count: 4761283
                Local write latency: 0.068 ms
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;However, the keyspace-level metrics are misleading, at best.  They are aggregate metrics for every table in the keyspace &lt;em&gt;that is included in the command line filters&lt;/em&gt;.  So, if you run &lt;tt&gt;tablestats&lt;/tt&gt; for a single table, the keyspace-level stats will only reflect that table&apos;s stats.&lt;/p&gt;

&lt;p&gt;I see two possible fixes:&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;If the command line options don&apos;t include the entire keyspace, skip the keyspace-level stats&lt;/li&gt;
	&lt;li&gt;Ignore the command line options, and always make the keyspace-level stats an aggregate of all tables in the keyspace&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;My only concern with option 2 is that performance may suffer a bit on keyspaces with many tables.  However, this is a command line tool, so as long as the response time is reasonable, I don&apos;t think it&apos;s a big deal.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12943092">CASSANDRA-11226</key>
            <summary>nodetool tablestats&apos; keyspace-level metrics are wrong/misleading</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10003" iconUrl="https://issues.apache.org/jira/images/icons/priorities/trivial.svg">Low</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="slebresne">Sylvain Lebresne</assignee>
                                    <reporter username="thobbs">Tom Hobbs</reporter>
                        <labels>
                            <label>lhf</label>
                    </labels>
                <created>Wed, 24 Feb 2016 21:59:52 +0000</created>
                <updated>Tue, 16 Apr 2019 09:30:41 +0000</updated>
                            <resolved>Thu, 17 Mar 2016 13:47:16 +0000</resolved>
                                        <fixVersion>3.6</fixVersion>
                                    <component>Tool/nodetool</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="15199355" author="slebresne" created="Thu, 17 Mar 2016 11:36:24 +0000"  >&lt;p&gt;Patch is &lt;a href=&quot;https://github.com/pcmanus/cassandra/commits/11226&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;here&lt;/a&gt;. I went with option 2: we don&apos;t really support humongous amounts of tables in the first place and as you said, it&apos;s not a performance sensible tool in the first place. Plus, while this might maybe be improvement, the current implementation iterates over all tables of all keyspaces no matter what ends up being displayed, so it&apos;s not like this patch will have any performance impact on the status quo.&lt;/p&gt;

&lt;p&gt;I took the liberty to do a few cleanups while at it btw. And the patch is against trunk: not convinced it&apos;s worth backporting given that it&apos;s been the way it is forever and that in theory changing the numbers in a minor/bug fix release feels not nice.&lt;/p&gt;</comment>
                            <comment id="15199448" author="krummas" created="Thu, 17 Mar 2016 12:55:08 +0000"  >&lt;p&gt;+1 with nit: &lt;a href=&quot;https://github.com/pcmanus/cassandra/commit/5e6b857e89a2b30f02d5236724ebae1544e147e7#diff-17c4e254aa945a51527760c21d45b265R75&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;this&lt;/a&gt; should be tableProxy.getTableName()&lt;/p&gt;</comment>
                            <comment id="15199539" author="slebresne" created="Thu, 17 Mar 2016 13:47:16 +0000"  >&lt;p&gt;Committed, thanks.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[slebresne]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 35 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2ti8v:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>marcuse</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[marcuse]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12961"><![CDATA[Low]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>