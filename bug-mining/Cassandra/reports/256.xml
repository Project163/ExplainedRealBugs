<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 22:12:14 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-658] Hinted Handoff CF contention</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-658</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;Hinted handoff causes a lot of contention on the HH CF, causing insert speed to massively drop.  Most of the row mutation stage threads end up blocking on each other at Memtable.resolve.  This is because HH sends the hint to the closest node, which will always be the node handling the write.&lt;/p&gt;

&lt;p&gt;To reproduce: start a cluster with even InitialTokens, and begin a constant stream of writes to one node, with an even key distribution. (I used 4 nodes and stress.py in random mode.)  Take a node down, and the insert rate begin to drop, eventually settling between 100-300/s and sustaining there.  Bringing the down node back up will restore the original insert rate.&lt;/p&gt;</description>
                <environment>&lt;p&gt;debian lenny amd64 OpenJDK 64-Bit Server VM (build 1.6.0_0-b11, mixed mode)&lt;/p&gt;</environment>
        <key id="12444353">CASSANDRA-658</key>
            <summary>Hinted Handoff CF contention</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10002" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Normal</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="jbellis">Jonathan Ellis</assignee>
                                    <reporter username="brandon.williams">Brandon Williams</reporter>
                        <labels>
                    </labels>
                <created>Wed, 30 Dec 2009 02:44:28 +0000</created>
                <updated>Tue, 16 Apr 2019 09:33:30 +0000</updated>
                            <resolved>Thu, 7 Jan 2010 05:41:38 +0000</resolved>
                                        <fixVersion>0.6</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="12795653" author="stuhood" created="Thu, 31 Dec 2009 19:44:23 +0000"  >&lt;p&gt;Brilliant... I really like this change.&lt;/p&gt;

&lt;p&gt;I think the main reason that we had an Atomic variable for size() in CF and SC was to perform this calculation, so perhaps that code should be considered dead, and removed. I noticed a bunch of subtle bugs in it last time I was looking anyway. The size() method can remain, and calculate the size for each call?&lt;/p&gt;</comment>
                            <comment id="12795678" author="jbellis" created="Thu, 31 Dec 2009 21:18:51 +0000"  >&lt;p&gt;We still want to know size for when we&apos;re serializing, so I&apos;ve left that code alone for now.&lt;/p&gt;</comment>
                            <comment id="12795687" author="stuhood" created="Thu, 31 Dec 2009 21:57:08 +0000"  >&lt;p&gt;Removes the atomic size calculation from SuperColumn, which was not being updated for remove() anyway.&lt;/p&gt;</comment>
                            <comment id="12795726" author="jbellis" created="Fri, 1 Jan 2010 02:22:23 +0000"  >&lt;p&gt;this actually has a race for simple columns: if a value is preset for a given column name, and two threads (A and B) run the putIfAbsent part at the same time, then A goes into the synchronized block and changes the value, thread C could attempt addColumn and sync on the value put by A, while B syncs on the old value.&lt;/p&gt;

&lt;p&gt;This should be fixable by using replace(), not put().&lt;/p&gt;</comment>
                            <comment id="12795733" author="jbellis" created="Fri, 1 Jan 2010 04:04:58 +0000"  >&lt;p&gt;new version 2 fixes the races and adds a similar fine-grained approach to SuperColumn (which is not really more expensive, since we&apos;re paying the price of using a Concurrent map implementation already).  This includes Stu&apos;s size-removal patch.  03 does more cleanup.&lt;/p&gt;</comment>
                            <comment id="12797517" author="brandon.williams" created="Thu, 7 Jan 2010 05:15:45 +0000"  >&lt;p&gt;+1, I replicated the exact scenario originally outlined and insert speed does not dramatically drop.&lt;/p&gt;</comment>
                            <comment id="12797525" author="jbellis" created="Thu, 7 Jan 2010 05:41:37 +0000"  >&lt;p&gt;committed&lt;/p&gt;</comment>
                            <comment id="12797616" author="hudson" created="Thu, 7 Jan 2010 13:08:33 +0000"  >&lt;p&gt;Integrated in Cassandra #316 (See &lt;a href=&quot;http://hudson.zones.apache.org/hudson/job/Cassandra/316/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://hudson.zones.apache.org/hudson/job/Cassandra/316/&lt;/a&gt;)&lt;br/&gt;
    replace sharded row locks with column-level locking&lt;br/&gt;
patch by jbellis; tested by Brandon Williams for &lt;br/&gt;
use throughput and op count instead of size and column count to determine when to flush, greatly reducing the amount of synchronization required to insert&lt;br/&gt;
patch by jbellis; tested by Brandon Williams for &lt;/p&gt;</comment>
                            <comment id="12797998" author="hudson" created="Fri, 8 Jan 2010 12:38:36 +0000"  >&lt;p&gt;Integrated in Cassandra #317 (See &lt;a href=&quot;http://hudson.zones.apache.org/hudson/job/Cassandra/317/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://hudson.zones.apache.org/hudson/job/Cassandra/317/&lt;/a&gt;)&lt;br/&gt;
    update release notes for config changes&lt;/p&gt;

&lt;p&gt;Patch by eevans for &lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12429240" name="ASF.LICENSE.NOT.GRANTED--0001-use-throughput-and-op-count-instead-of-size-and-column.txt" size="13216" author="jbellis" created="Fri, 1 Jan 2010 04:02:29 +0000"/>
                            <attachment id="12429241" name="ASF.LICENSE.NOT.GRANTED--0002-replace-sharded-row-locks-with-column-level-locking.txt" size="16333" author="jbellis" created="Fri, 1 Jan 2010 04:02:29 +0000"/>
                            <attachment id="12429242" name="ASF.LICENSE.NOT.GRANTED--0003-r-m-unused-code.txt" size="4704" author="jbellis" created="Fri, 1 Jan 2010 04:02:29 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[jbellis]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>19806</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            15 years, 46 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0g0af:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>91477</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12962"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>