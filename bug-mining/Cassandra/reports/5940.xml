<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 23:23:58 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-17352] CVE-2021-44521: Apache Cassandra: Remote code execution for scripted UDFs</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-17352</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;When running Apache Cassandra with the following configuration:&lt;/p&gt;

&lt;p&gt;enable_user_defined_functions: true&lt;br/&gt;
enable_scripted_user_defined_functions: true&lt;br/&gt;
enable_user_defined_functions_threads: false &lt;/p&gt;

&lt;p&gt;it is possible for an attacker to execute arbitrary code on the host. The attacker would need to have enough permissions to create user defined functions in the cluster to be able to exploit this. Note that this configuration is documented as unsafe, and will continue to be considered unsafe after this CVE.&lt;/p&gt;

&lt;p&gt;This issue is being tracked as &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-17352&quot; title=&quot;CVE-2021-44521: Apache Cassandra: Remote code execution for scripted UDFs&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-17352&quot;&gt;&lt;del&gt;CASSANDRA-17352&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Mitigation:&lt;/p&gt;

&lt;p&gt;Set `enable_user_defined_functions_threads: true` (this is default)&lt;br/&gt;
or&lt;br/&gt;
3.0 users should upgrade to 3.0.26&lt;br/&gt;
3.11 users should upgrade to 3.11.12&lt;br/&gt;
4.0 users should upgrade to 4.0.2&lt;/p&gt;

&lt;p&gt;Credit:&lt;/p&gt;

&lt;p&gt;This issue was discovered by Omer Kaspi of the JFrog Security vulnerability research team.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13426900">CASSANDRA-17352</key>
            <summary>CVE-2021-44521: Apache Cassandra: Remote code execution for scripted UDFs</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10002" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Normal</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="marcuse">Marcus Eriksson</assignee>
                                    <reporter username="marcuse">Marcus Eriksson</reporter>
                        <labels>
                    </labels>
                <created>Mon, 7 Feb 2022 11:45:12 +0000</created>
                <updated>Tue, 14 Oct 2025 12:13:54 +0000</updated>
                            <resolved>Fri, 11 Feb 2022 17:36:22 +0000</resolved>
                                        <fixVersion>3.0.26</fixVersion>
                    <fixVersion>3.11.12</fixVersion>
                    <fixVersion>4.0.2</fixVersion>
                                    <component>Feature/UDF</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="17490815" author="krummas" created="Fri, 11 Feb 2022 10:14:37 +0000"  >&lt;p&gt;It is possible for an attacker to create a scripted UDF which executes arbitrary code on the server.&lt;/p&gt;

&lt;p&gt;Attacker needs to have enough permissions to create user defined functions on the server, and  &lt;tt&gt;enable_user_defined_functions_threads&lt;/tt&gt; must have been changed from &lt;tt&gt;true&lt;/tt&gt; to &lt;tt&gt;false&lt;/tt&gt; by the operator&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/apache/cassandra/commit/5c9ba06dd31157cd224af2cec75521fefe2c9883&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/cassandra/commit/5c9ba06dd31157cd224af2cec75521fefe2c9883&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;to continue running with &lt;tt&gt;enable_user_defined_functions_threads: false&lt;/tt&gt; setting &lt;tt&gt;allow_insecure_udfs: true&lt;/tt&gt; is required&lt;/p&gt;

&lt;p&gt;to continue accessing &lt;tt&gt;System.*&lt;/tt&gt; classes, &lt;tt&gt;allow_extra_insecure_udfs: true&lt;/tt&gt; is required&lt;/p&gt;</comment>
                            <comment id="17493836" author="tomasz.lasica" created="Thu, 17 Feb 2022 10:17:09 +0000"  >&lt;p&gt;There is one thing I do not understand, so please correct me if I get it wrong:&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;default is `public boolean enable_user_defined_functions_threads = true;`&lt;/li&gt;
	&lt;li&gt;&quot;insecure&quot; value is `false`&lt;/li&gt;
	&lt;li&gt;so why &quot;Attacker needs to have enough permissions to (...) and &lt;tt&gt;enable_user_defined_functions_threads&lt;/tt&gt;&#160;must have been changed from&#160;&lt;tt&gt;false&lt;/tt&gt;&#160;to&#160;&lt;tt&gt;true&lt;/tt&gt;&#160;by the operator&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;Looking at the patch:&lt;/p&gt;

&lt;p&gt;Should all the checks in startup be done if user defined functions are completely disabled?&lt;/p&gt;</comment>
                            <comment id="17493841" author="krummas" created="Thu, 17 Feb 2022 10:21:31 +0000"  >&lt;p&gt;nice catch - I flipped the booleans in the comment above (and edited comment to be correct)&lt;/p&gt;</comment>
                            <comment id="17493856" author="tomasz.lasica" created="Thu, 17 Feb 2022 10:39:52 +0000"  >&lt;p&gt;Thanks, what about:&lt;/p&gt;

&lt;p&gt;&amp;gt; Should all the checks in startup be done if user defined functions are completely disabled?&lt;/p&gt;</comment>
                            <comment id="17493892" author="krummas" created="Thu, 17 Feb 2022 11:40:47 +0000"  >&lt;p&gt;not sure I understand the question - is there a problem with the patch?&lt;/p&gt;</comment>
                            <comment id="17493903" author="tomasz.lasica" created="Thu, 17 Feb 2022 12:09:27 +0000"  >&lt;p&gt;If I understand correctly to exploit following conditions are required:&lt;/p&gt;

&lt;p&gt;(after &lt;a href=&quot;https://jfrog.com/blog/cve-2021-44521-exploiting-apache-cassandra-user-defined-functions-for-remote-code-execution/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://jfrog.com/blog/cve-2021-44521-exploiting-apache-cassandra-user-defined-functions-for-remote-code-execution/&lt;/a&gt; )&lt;/p&gt;

&lt;p&gt;Cassandra deployments are vulnerable to CVE-2021-44521 when the&#160;&lt;b&gt;cassandra.yaml&lt;/b&gt;&#160;configuration file contains the following definitions:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
enable_user_defined_functions: &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;
enable_scripted_user_defined_functions: &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;
enable_user_defined_functions_threads: &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;And I wonder what will be the behavior of the patch with following settings:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
enable_user_defined_functions: &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;
enable_scripted_user_defined_functions: &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;
enable_user_defined_functions_threads: &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;
allow_insecure_udfs: &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt; (&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt; after upgrade)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;In this case there is no vulnerability yet I think ConfigurationException will be fired?&lt;br/&gt;
Is this expected behavior?&lt;/p&gt;</comment>
                            <comment id="17493907" author="tomasz.lasica" created="Thu, 17 Feb 2022 12:12:40 +0000"  >&lt;p&gt;&amp;gt; not sure I understand the question - is there a problem with the patch?&lt;/p&gt;

&lt;p&gt;That is what I am trying to find out. But mostly I am trying to get full understanding about expected behavior.&lt;/p&gt;</comment>
                            <comment id="17493908" author="krummas" created="Thu, 17 Feb 2022 12:16:36 +0000"  >&lt;p&gt;yes, &lt;a href=&quot;https://github.com/apache/cassandra/blob/cassandra-3.0/src/java/org/apache/cassandra/config/Config.java#L329-L340&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/cassandra/blob/cassandra-3.0/src/java/org/apache/cassandra/config/Config.java#L329-L340&lt;/a&gt; - there are most likely other issues when running with &lt;tt&gt;enable_user_defined_functions_threads: false&lt;/tt&gt;&lt;/p&gt;</comment>
                            <comment id="17493909" author="tomasz.lasica" created="Thu, 17 Feb 2022 12:27:20 +0000"  >&lt;p&gt;Thanks a lot for all the explanation.&lt;/p&gt;</comment>
                            <comment id="17494313" author="JIRAUSER308715" created="Fri, 18 Feb 2022 01:27:04 +0000"  >&lt;p&gt;Is there a unit test that can be pushed now that this is public?&lt;/p&gt;</comment>
                            <comment id="17601997" author="jeromatron" created="Thu, 8 Sep 2022 20:10:41 +0000"  >&lt;p&gt;I just want to make sure the settings have the practical outcomes that are intended.&lt;/p&gt;

&lt;p&gt;I can use UDFs with just the following setting:&lt;/p&gt;

&lt;p&gt;&lt;tt&gt;enable_user_defined_functions: true&lt;/tt&gt;&lt;/p&gt;

&lt;p&gt;However if I want to enable multi-threaded behavior in the UDFs, I would need to set:&lt;/p&gt;

&lt;p&gt;&lt;tt&gt;enable_user_defined_functions: true&lt;/tt&gt;&lt;br/&gt;
&lt;tt&gt;enable_user_defined_functions_threads: false&lt;/tt&gt;&lt;br/&gt;
&lt;tt&gt;allow_insecure_udfs: true&lt;/tt&gt;&lt;/p&gt;

&lt;p&gt;If I don&apos;t do the last one, &lt;tt&gt;allow_insecure_udfs: true&lt;/tt&gt;, then the server doesn&apos;t start and it gives the warning/recommendation but also says that it would require that field to be set to true to continue.&lt;/p&gt;

&lt;p&gt;Once these fields are set, I can start the server (in my case 3.11.13).  However according to the &lt;a href=&quot;https://github.com/apache/cassandra/blob/cassandra-3.11/src/java/org/apache/cassandra/security/ThreadAwareSecurityManager.java#L186&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;code&lt;/a&gt;, it looks like the &lt;tt&gt;allow_extra_insecure_udfs&lt;/tt&gt; setting should also be set to true for the server to start up.  Otherwise it should throw an AccessDenied exception.&lt;/p&gt;

&lt;p&gt;So my question is: is there a bug in the implementation where we allow it to start without setting &lt;tt&gt;allow_extra_insecure_udfs: true&lt;/tt&gt;?  Also if it does throw an AccessDenied exception, shouldn&apos;t it fail earlier when parsing the configuration with a log message that it is required?&lt;/p&gt;

&lt;p&gt;That leads to another question about this, if it does require both flags to start the server, why do we have two flags?  Why not just &lt;tt&gt;allow_insecure_udfs&lt;/tt&gt; if there is no effective difference between setting &lt;tt&gt;allow_insecure_udfs&lt;/tt&gt; and setting both of them.  I know the intent from the ticket was that the &lt;tt&gt;allow_extra_insecure_udfs&lt;/tt&gt; was to further relax security for those wanting to use the java.lang.System package in the UDF, but the line of code from the ThreadAwareSecurityManager seems to suggest that there is no difference.&lt;/p&gt;</comment>
                            <comment id="17610206" author="jeromatron" created="Tue, 27 Sep 2022 19:32:59 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=marcuse&quot; class=&quot;user-hover&quot; rel=&quot;marcuse&quot;&gt;marcuse&lt;/a&gt;&#160;do you have any thoughts on the flags that were used here? &#160;Am I misunderstanding intent of having two flags?&lt;/p&gt;</comment>
                            <comment id="17610385" author="krummas" created="Wed, 28 Sep 2022 07:07:09 +0000"  >&lt;p&gt;The difference between the flags is;&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;to continue running with enable_user_defined_functions_threads: false setting allow_insecure_udfs: true is required&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;to continue accessing System.* classes, allow_extra_insecure_udfs: true is required&lt;/p&gt;&lt;/blockquote&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="13429385">CASSANDRA-17394</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="13429035">CASSANDRA-17388</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[marcuse]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12313825" key="com.atlassian.jira.plugin.system.customfieldtypes:cascadingselect">
                        <customfieldname>Bug Category</customfieldname>
                        <customfieldvalues>
                                                    <customfieldvalue key="12985" cascade-level=""><![CDATA[Security]]></customfieldvalue>
                                <customfieldvalue key="13002" cascade-level="1"><![CDATA[Remote Code Execution]]></customfieldvalue>
            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12313821" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Complexity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12965"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313822" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Discovered By</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12969"><![CDATA[User Report]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12313922" key="jira.plugin.projectspecificselectfield.jpssf:multicftype">
                        <customfieldname>Impacts</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="13100"><![CDATA[None]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            3 years, 6 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12313921" key="jira.plugin.projectspecificselectfield.jpssf:multicftype">
                        <customfieldname>Platform</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="13076"><![CDATA[All]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0zb3s:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12963"><![CDATA[Critical]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313823" key="com.atlassian.jira.plugin.system.customfieldtypes:textarea">
                        <customfieldname>Test and Documentation Plan</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>&lt;p&gt;cci run&lt;/p&gt;</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>