<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 23:23:07 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-17084] startup fails if directories do not exist</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-17084</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;Prior to &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-16926&quot; title=&quot;Mockable FileSystem&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-16926&quot;&gt;&lt;del&gt;CASSANDRA-16926&lt;/del&gt;&lt;/a&gt;, having commitlog and data dirs defined that did not exist would be created on startup, but now we throw:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Exception (org.apache.cassandra.exceptions.ConfigurationException) encountered during startup: Unable check disk space in &apos;bin/../data/commitlog&apos;. Perhaps the Cassandra user does not have the necessary permissions
org.apache.cassandra.exceptions.ConfigurationException: Unable check disk space in &apos;bin/../data/commitlog&apos;. Perhaps the Cassandra user does not have the necessary permissions
        at org.apache.cassandra.config.DatabaseDescriptor.lambda$tryGetSpace$3(DatabaseDescriptor.java:1188)
        at org.apache.cassandra.io.util.PathUtils.tryOnFileStore(PathUtils.java:639)
        at org.apache.cassandra.io.util.PathUtils.tryGetSpace(PathUtils.java:665)
        at org.apache.cassandra.config.DatabaseDescriptor.tryGetSpace(DatabaseDescriptor.java:1188)
        at org.apache.cassandra.config.DatabaseDescriptor.applySimpleConfig(DatabaseDescriptor.java:553)
        at org.apache.cassandra.config.DatabaseDescriptor.applyAll(DatabaseDescriptor.java:350)
        at org.apache.cassandra.config.DatabaseDescriptor.daemonInitialization(DatabaseDescriptor.java:178)
        at org.apache.cassandra.config.DatabaseDescriptor.daemonInitialization(DatabaseDescriptor.java:162)
        at org.apache.cassandra.service.CassandraDaemon.applyConfig(CassandraDaemon.java:800)
        at org.apache.cassandra.service.CassandraDaemon.activate(CassandraDaemon.java:736)
        at org.apache.cassandra.service.CassandraDaemon.main(CassandraDaemon.java:871)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This was at least convenient for development, but also may be relied upon by some tooling/automation.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13409140">CASSANDRA-17084</key>
            <summary>startup fails if directories do not exist</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10002" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Normal</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="brandon.williams">Brandon Williams</assignee>
                                    <reporter username="brandon.williams">Brandon Williams</reporter>
                        <labels>
                    </labels>
                <created>Fri, 29 Oct 2021 15:24:45 +0000</created>
                <updated>Fri, 27 May 2022 19:24:56 +0000</updated>
                            <resolved>Fri, 14 Jan 2022 17:56:54 +0000</resolved>
                                        <fixVersion>4.1-alpha1</fixVersion>
                    <fixVersion>4.1</fixVersion>
                                    <component>Local/Startup and Shutdown</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="17436139" author="brandon.williams" created="Fri, 29 Oct 2021 18:52:34 +0000"  >&lt;p&gt;Previously we could get past DD.daemonInitialization and then in setup() when initializing the commitlog it ends up calling DD.createAllDirectories, but this is now too late.  I don&apos;t think calling createAllDirectories sooner now is the solution though, since we use daemonInitialization extensively in tests, and probably don&apos;t want the side effect of it creating directories.&lt;/p&gt;</comment>
                            <comment id="17454888" author="brandon.williams" created="Tue, 7 Dec 2021 22:47:37 +0000"  >&lt;p&gt;PathUtils.tryOnFileStore was already attempting to copy the previous behavior, but was using relative paths so they never existed. &lt;a href=&quot;https://github.com/driftx/cassandra/tree/CASSANDRA-17084&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;Branch&lt;/a&gt;, &lt;a href=&quot;https://app.circleci.com/pipelines/github/driftx/cassandra?branch=CASSANDRA-17084&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;circle&lt;/a&gt;, &lt;a href=&quot;https://ci-cassandra.apache.org/blue/organizations/jenkins/Cassandra-devbranch/detail/Cassandra-devbranch/1314/pipeline&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;&lt;span class=&quot;image-wrap&quot; style=&quot;&quot;&gt;&lt;img src=&quot;https://ci-cassandra.apache.org/job/Cassandra-devbranch/1314/badge/icon&quot; style=&quot;border: 0px solid black&quot; /&gt;&lt;/span&gt;&lt;/a&gt; with this &lt;a href=&quot;https://github.com/driftx/cassandra-dtest/tree/CASSANDRA-17084&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;dtest branch&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="17471803" author="bereng" created="Mon, 10 Jan 2022 09:37:01 +0000"  >&lt;p&gt;They seem to be failing &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=brandon.williams&quot; class=&quot;user-hover&quot; rel=&quot;brandon.williams&quot;&gt;brandon.williams&lt;/a&gt;?&lt;/p&gt;</comment>
                            <comment id="17472792" author="brandon.williams" created="Tue, 11 Jan 2022 14:47:24 +0000"  >&lt;p&gt;They only fail on circle, and it&apos;s just the test I wrote for this issue (where the fix is quite obviously correct.)  They fail in the teardown:&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;test teardown failure&lt;br/&gt;
Unexpected error found in node logs (see stdout for full details). Errors: [ERROR &lt;span class=&quot;error&quot;&gt;&amp;#91;COMMIT-LOG-ALLOCATOR&amp;#93;&lt;/span&gt; 2022-01-10 17:56:48,793 JVMStabilityInspector.java:185 - Exiting due to error while processing commit log during initialization.&lt;br/&gt;
java.lang.ExceptionInInitializerError: null&lt;br/&gt;
	at org.apache.cassandra.db.commitlog.CommitLogSegmentManagerStandard.createSegment(CommitLogSegmentManagerStandard.java:64)&lt;br/&gt;
	at org.apache.cassandra.db.commitlog.AbstractCommitLogSegmentManager$AllocatorRunnable.run(AbstractCommitLogSegmentManager.java:153)&lt;br/&gt;
	at org.apache.cassandra.concurrent.InfiniteLoopExecutor.loop(InfiniteLoopExecutor.java:114)&lt;br/&gt;
	at io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)&lt;br/&gt;
	at java.base/java.lang.Thread.run(Thread.java:834)&lt;br/&gt;
Caused by: java.lang.NullPointerException: null&lt;br/&gt;
	at org.apache.cassandra.db.commitlog.CommitLogSegment.&amp;lt;clinit&amp;gt;(CommitLogSegment.java:79)&lt;br/&gt;
	... 5 common frames omitted, ERROR &lt;span class=&quot;error&quot;&gt;&amp;#91;COMMIT-LOG-ALLOCATOR&amp;#93;&lt;/span&gt; 2022-01-10 17:56:48,793 JVMStabilityInspector.java:185 - Exiting due to error while processing commit log during initialization.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;But that sure doesn&apos;t &lt;em&gt;seem&lt;/em&gt; like teardown to me, but initialization.  I&apos;m not really sure how to attack this problem except for trial and error since it is localized to circle.&lt;/p&gt;</comment>
                            <comment id="17472995" author="brandon.williams" created="Tue, 11 Jan 2022 18:07:37 +0000"  >&lt;p&gt;The stacktrace seems to imply that `commitlog_directory` is null, but it&apos;s being explicitly set in the test and works everywhere else I run it.&lt;/p&gt;</comment>
                            <comment id="17475224" author="bereng" created="Thu, 13 Jan 2022 09:52:02 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=brandon.williams&quot; class=&quot;user-hover&quot; rel=&quot;brandon.williams&quot;&gt;brandon.williams&lt;/a&gt;,&lt;/p&gt;

&lt;p&gt;While looking into the failures I&apos;ve been playing with &lt;tt&gt;commitlog_directory&lt;/tt&gt; and I can&apos;t get it to fail locally. Paths being relative or not it always creates the folder for me. There is a note in the javadoc that all these methods are implementation dependent. Hence I can only think there is some code there behaving differently depending on where it gets executed. I can only think to add a few debug statements and run it on circle to narrow the problem down. I am afraid I don&apos;t have a better suggestion here... :thinking:...&lt;/p&gt;</comment>
                            <comment id="17475673" author="brandon.williams" created="Thu, 13 Jan 2022 19:30:41 +0000"  >&lt;p&gt;Thanks for looking.&#160; I think the issue is that circle&apos;s current working directory when running the tests isn&apos;t the cassandra directory (and in retrospect that was probably a bad assumption to begin with) so the directories it&apos;s looking for actually do not exist at the base level, hence the NPE.&#160; I updated the dtest to create its &lt;a href=&quot;https://github.com/driftx/cassandra-dtest/commit/2c28040113e95bb277050e35fe60b3da2fd8edfa&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;own temp directory&lt;/a&gt; and point to relative (nonexistent) paths within that, and that fails without my patch, and &lt;a href=&quot;https://app.circleci.com/pipelines/github/driftx/cassandra?branch=CASSANDRA-17084&amp;amp;filter=all&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;passes on circle&lt;/a&gt; with it.&lt;/p&gt;</comment>
                            <comment id="17475962" author="bereng" created="Fri, 14 Jan 2022 05:55:14 +0000"  >&lt;p&gt;Yes. Good thinking. I went over everything and the random failures pass locally. Also the rest are just GH timeouts. +1&lt;/p&gt;</comment>
                            <comment id="17476304" author="brandon.williams" created="Fri, 14 Jan 2022 17:56:54 +0000"  >&lt;p&gt;Committed, thanks!&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                                                <inwardlinks description="is duplicated by">
                                        <issuelink>
            <issuekey id="13409734">CASSANDRA-17115</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[brandon.williams]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12313825" key="com.atlassian.jira.plugin.system.customfieldtypes:cascadingselect">
                        <customfieldname>Bug Category</customfieldname>
                        <customfieldvalues>
                                                    <customfieldvalue key="12983" cascade-level=""><![CDATA[Availability]]></customfieldvalue>
            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12313821" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Complexity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12965"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313822" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Discovered By</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12969"><![CDATA[User Report]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12313922" key="jira.plugin.projectspecificselectfield.jpssf:multicftype">
                        <customfieldname>Impacts</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="13100"><![CDATA[None]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            3 years, 43 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12313921" key="jira.plugin.projectspecificselectfield.jpssf:multicftype">
                        <customfieldname>Platform</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="13076"><![CDATA[All]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0wacw:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[bereng]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12962"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12311420" key="com.atlassian.jira.plugin.system.customfieldtypes:version">
                        <customfieldname>Since Version</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="12348835">NA</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313924" key="com.atlassian.jira.plugin.system.customfieldtypes:textfield">
                        <customfieldname>Source Control Link</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>&lt;p&gt;&lt;a href=&quot;https://github.com/apache/cassandra/commit/76f8333e9b9c89f029dd586273d5d42fdaf676dd&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/cassandra/commit/76f8333e9b9c89f029dd586273d5d42fdaf676dd&lt;/a&gt;&lt;/p&gt;</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313823" key="com.atlassian.jira.plugin.system.customfieldtypes:textarea">
                        <customfieldname>Test and Documentation Plan</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>&lt;p&gt;Added test&lt;/p&gt;</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>