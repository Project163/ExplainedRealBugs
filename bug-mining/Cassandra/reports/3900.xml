<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 22:58:52 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-10554] Batch that updates two or more table can produce unreadable SSTable (was: Auto Bootstraping a new node fails)</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-10554</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;I&apos;ve been trying to add a new node in my 3.0 cluster and it seems to fail. All my nodes are using apache/cassandra-3.0.0 branch. At the beginning, I can see the following error:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;INFO  18:45:55 [Stream #9f95fa90-7691-11e5-931f-5b735851f84a ID#0] Prepare completed. Receiving 42 files(1910066622 bytes), sending 0 files(0 bytes)
WARN  18:45:55 [Stream #9f95fa90-7691-11e5-931f-5b735851f84a] Retrying &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; following error
java.lang.RuntimeException: Unknown column added_time during deserialization
        at org.apache.cassandra.db.SerializationHeader$Component.toHeader(SerializationHeader.java:331) ~[main/:na]
        at org.apache.cassandra.streaming.StreamReader.createWriter(StreamReader.java:136) ~[main/:na]
        at org.apache.cassandra.streaming.compress.CompressedStreamReader.read(CompressedStreamReader.java:77) ~[main/:na]
        at org.apache.cassandra.streaming.messages.IncomingFileMessage$1.deserialize(IncomingFileMessage.java:50) [main/:na]
        at org.apache.cassandra.streaming.messages.IncomingFileMessage$1.deserialize(IncomingFileMessage.java:39) [main/:na]
        at org.apache.cassandra.streaming.messages.StreamMessage.deserialize(StreamMessage.java:59) [main/:na]
        at org.apache.cassandra.streaming.ConnectionHandler$IncomingMessageHandler.run(ConnectionHandler.java:261) [main/:na]
        at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:745) [na:1.8.0_45]
ERROR 18:45:55 [Stream #9f95fa90-7691-11e5-931f-5b735851f84a] Streaming error occurred
java.lang.IllegalArgumentException: Unknown type 0
        at org.apache.cassandra.streaming.messages.StreamMessage$Type.get(StreamMessage.java:97) ~[main/:na]
        at org.apache.cassandra.streaming.messages.StreamMessage.deserialize(StreamMessage.java:58) ~[main/:na]
        at org.apache.cassandra.streaming.ConnectionHandler$IncomingMessageHandler.run(ConnectionHandler.java:261) ~[main/:na]
        at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:745) [na:1.8.0_45]
INFO  18:45:55 [Stream #9f95fa90-7691-11e5-931f-5b735851f84a] Session with /54.210.187.114 is complete
INFO  18:45:56 [Stream #9f95fa90-7691-11e5-931f-5b735851f84a ID#0] Prepare completed. Receiving 38 files(2323537628 bytes), sending 0 files(0 bytes)
WARN  18:45:56 [Stream #9f95fa90-7691-11e5-931f-5b735851f84a] Retrying &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; following error
java.lang.RuntimeException: Unknown column added_time during deserialization
        at org.apache.cassandra.db.SerializationHeader$Component.toHeader(SerializationHeader.java:331) ~[main/:na]
        at org.apache.cassandra.streaming.StreamReader.createWriter(StreamReader.java:136) ~[main/:na]
        at org.apache.cassandra.streaming.compress.CompressedStreamReader.read(CompressedStreamReader.java:77) ~[main/:na]
        at org.apache.cassandra.streaming.messages.IncomingFileMessage$1.deserialize(IncomingFileMessage.java:50) [main/:na]
        at org.apache.cassandra.streaming.messages.IncomingFileMessage$1.deserialize(IncomingFileMessage.java:39) [main/:na]
        at org.apache.cassandra.streaming.messages.StreamMessage.deserialize(StreamMessage.java:59) [main/:na]
        at org.apache.cassandra.streaming.ConnectionHandler$IncomingMessageHandler.run(ConnectionHandler.java:261) [main/:na]
        at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:745) [na:1.8.0_45]
ERROR 18:45:56 [Stream #9f95fa90-7691-11e5-931f-5b735851f84a] Streaming error occurred
java.lang.IllegalArgumentException: Unknown type 0
        at org.apache.cassandra.streaming.messages.StreamMessage$Type.get(StreamMessage.java:97) ~[main/:na]
        at org.apache.cassandra.streaming.messages.StreamMessage.deserialize(StreamMessage.java:58) ~[main/:na]
        at org.apache.cassandra.streaming.ConnectionHandler$IncomingMessageHandler.run(ConnectionHandler.java:261) ~[main/:na]
        at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:745) [na:1.8.0_45]
INFO  18:45:56 [Stream #9f95fa90-7691-11e5-931f-5b735851f84a] Session with /54.210.184.198 is complete
INFO  18:45:56 [Stream #9f95fa90-7691-11e5-931f-5b735851f84a ID#0] Prepare completed. Receiving 35 files(2069893759 bytes), sending 0 files(0 bytes)
WARN  18:45:57 [Stream #9f95fa90-7691-11e5-931f-5b735851f84a] Retrying &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; following error
java.lang.AssertionError: &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;
        at org.apache.cassandra.db.PartitionColumns$Builder.add(PartitionColumns.java:168) ~[main/:na]
        at org.apache.cassandra.db.SerializationHeader$Component.toHeader(SerializationHeader.java:333) ~[main/:na]
        at org.apache.cassandra.streaming.StreamReader.createWriter(StreamReader.java:136) ~[main/:na]
        at org.apache.cassandra.streaming.compress.CompressedStreamReader.read(CompressedStreamReader.java:77) ~[main/:na]
        at org.apache.cassandra.streaming.messages.IncomingFileMessage$1.deserialize(IncomingFileMessage.java:50) [main/:na]
        at org.apache.cassandra.streaming.messages.IncomingFileMessage$1.deserialize(IncomingFileMessage.java:39) [main/:na]
        at org.apache.cassandra.streaming.messages.StreamMessage.deserialize(StreamMessage.java:59) [main/:na]
        at org.apache.cassandra.streaming.ConnectionHandler$IncomingMessageHandler.run(ConnectionHandler.java:261) [main/:na]
        at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:745) [na:1.8.0_45]
ERROR 18:45:57 [Stream #9f95fa90-7691-11e5-931f-5b735851f84a] Streaming error occurred
java.lang.IllegalArgumentException: Unknown type 0
        at org.apache.cassandra.streaming.messages.StreamMessage$Type.get(StreamMessage.java:97) ~[main/:na]
        at org.apache.cassandra.streaming.messages.StreamMessage.deserialize(StreamMessage.java:58) ~[main/:na]
        at org.apache.cassandra.streaming.ConnectionHandler$IncomingMessageHandler.run(ConnectionHandler.java:261) ~[main/:na]
        at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:745) [na:1.8.0_45]
INFO  18:45:57 [Stream #9f95fa90-7691-11e5-931f-5b735851f84a] Session with /54.210.157.2 is complete
WARN  18:45:57 [Stream #9f95fa90-7691-11e5-931f-5b735851f84a] Stream failed
ERROR 18:45:57 Error &lt;span class=&quot;code-keyword&quot;&gt;while&lt;/span&gt; waiting on bootstrap to complete. Bootstrap will have to be restarted.
java.util.concurrent.ExecutionException: org.apache.cassandra.streaming.StreamException: Stream failed
        at com.google.common.util.concurrent.AbstractFuture$Sync.getValue(AbstractFuture.java:299) ~[guava-18.0.jar:na]
        at com.google.common.util.concurrent.AbstractFuture$Sync.get(AbstractFuture.java:286) ~[guava-18.0.jar:na]
        at com.google.common.util.concurrent.AbstractFuture.get(AbstractFuture.java:116) ~[guava-18.0.jar:na]
        at org.apache.cassandra.service.StorageService.bootstrap(StorageService.java:1245) [main/:na]
        at org.apache.cassandra.service.StorageService.joinTokenRing(StorageService.java:935) [main/:na]
        at org.apache.cassandra.service.StorageService.initServer(StorageService.java:710) [main/:na]
        at org.apache.cassandra.service.StorageService.initServer(StorageService.java:581) [main/:na]
        at org.apache.cassandra.service.CassandraDaemon.setup(CassandraDaemon.java:345) [main/:na]
        at org.apache.cassandra.service.CassandraDaemon.activate(CassandraDaemon.java:561) [main/:na]
        at org.apache.cassandra.service.CassandraDaemon.main(CassandraDaemon.java:689) [main/:na]
Caused by: org.apache.cassandra.streaming.StreamException: Stream failed
        at org.apache.cassandra.streaming.management.StreamEventJMXNotifier.onFailure(StreamEventJMXNotifier.java:85) ~[main/:na]
        at com.google.common.util.concurrent.Futures$6.run(Futures.java:1310) ~[guava-18.0.jar:na]
        at com.google.common.util.concurrent.MoreExecutors$DirectExecutor.execute(MoreExecutors.java:457) ~[guava-18.0.jar:na]
        at com.google.common.util.concurrent.ExecutionList.executeListener(ExecutionList.java:156) ~[guava-18.0.jar:na]
        at com.google.common.util.concurrent.ExecutionList.execute(ExecutionList.java:145) ~[guava-18.0.jar:na]
        at com.google.common.util.concurrent.AbstractFuture.setException(AbstractFuture.java:202) ~[guava-18.0.jar:na]
        at org.apache.cassandra.streaming.StreamResultFuture.maybeComplete(StreamResultFuture.java:210) ~[main/:na]
        at org.apache.cassandra.streaming.StreamResultFuture.handleSessionComplete(StreamResultFuture.java:186) ~[main/:na]
        at org.apache.cassandra.streaming.StreamSession.closeSession(StreamSession.java:430) ~[main/:na]
        at org.apache.cassandra.streaming.StreamSession.onError(StreamSession.java:525) ~[main/:na]
        at org.apache.cassandra.streaming.ConnectionHandler$IncomingMessageHandler.run(ConnectionHandler.java:279) ~[main/:na]
        at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:745) ~[na:1.8.0_45]
Oct 19, 2015 6:45:57 PM com.google.common.util.concurrent.ExecutionList executeListener
SEVERE: RuntimeException &lt;span class=&quot;code-keyword&quot;&gt;while&lt;/span&gt; executing runnable com.google.common.util.concurrent.Futures$6@59444306 with executor INSTANCE
java.lang.NullPointerException
        at org.apache.cassandra.service.StorageService$2.onFailure(StorageService.java:1240)
        at com.google.common.util.concurrent.Futures$6.run(Futures.java:1310)
        at com.google.common.util.concurrent.MoreExecutors$DirectExecutor.execute(MoreExecutors.java:457)
        at com.google.common.util.concurrent.ExecutionList.executeListener(ExecutionList.java:156)
        at com.google.common.util.concurrent.ExecutionList.execute(ExecutionList.java:145)
        at com.google.common.util.concurrent.AbstractFuture.setException(AbstractFuture.java:202)
        at org.apache.cassandra.streaming.StreamResultFuture.maybeComplete(StreamResultFuture.java:210)
        at org.apache.cassandra.streaming.StreamResultFuture.handleSessionComplete(StreamResultFuture.java:186)
        at org.apache.cassandra.streaming.StreamSession.closeSession(StreamSession.java:430)
        at org.apache.cassandra.streaming.StreamSession.onError(StreamSession.java:525)
        at org.apache.cassandra.streaming.ConnectionHandler$IncomingMessageHandler.run(ConnectionHandler.java:279)
        at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:745)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The &quot;added_time&quot; is a bigint column. I do see that the node is marked as UJ in nodetool status and the bootstraping continue to run. But at a certain point, it hangs forever  and restarting it doesn&apos;t help. I&apos;m not 100% sure the hang issue is related to the above error though. But I&apos;d like to fix this one before trying again. Any idea what&apos;s going on with that bigint type?&lt;/p&gt;
</description>
                <environment></environment>
        <key id="12906083">CASSANDRA-10554</key>
            <summary>Batch that updates two or more table can produce unreadable SSTable (was: Auto Bootstraping a new node fails)</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10000" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Urgent</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="slebresne">Sylvain Lebresne</assignee>
                                    <reporter username="aboudreault">Alan Boudreault</reporter>
                        <labels>
                    </labels>
                <created>Mon, 19 Oct 2015 21:36:45 +0000</created>
                <updated>Tue, 16 Apr 2019 09:30:52 +0000</updated>
                            <resolved>Tue, 27 Oct 2015 12:55:44 +0000</resolved>
                                        <fixVersion>3.0.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="14964107" author="aboudreault" created="Mon, 19 Oct 2015 21:38:46 +0000"  >&lt;p&gt;FYI, I&apos;m giving it a new try with a completely new cluster. Will let you know how it goes.&lt;/p&gt;</comment>
                            <comment id="14964420" author="aboudreault" created="Tue, 20 Oct 2015 02:47:38 +0000"  >&lt;p&gt;No luck. Tried to use nodetool to resume somehow the bootstraping but got:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;...
[2015-10-20 02:34:50,848] received file /mnt/data/cassandra/data/manual/artist_to_user-6a01f82076aa11e59305f5ca02614f5c/ma-6-big-Data.db (progress: 190%)
[2015-10-20 02:34:50,848] received file /mnt/data/cassandra/data/manual/artist_to_user-6a01f82076aa11e59305f5ca02614f5c/ma-6-big-Data.db (progress: 191%)
[2015-10-20 02:34:50,848] received file /mnt/data/cassandra/data/manual/artist_to_user-6a01f82076aa11e59305f5ca02614f5c/ma-6-big-Data.db (progress: 192%)
[2015-10-20 02:34:50,849] received file /mnt/data/cassandra/data/manual/artist_to_user-6a01f82076aa11e59305f5ca02614f5c/ma-6-big-Data.db (progress: 193%)
[2015-10-20 02:34:50,849] received file /mnt/data/cassandra/data/manual/artist_to_user-6a01f82076aa11e59305f5ca02614f5c/ma-6-big-Data.db (progress: 194%)
[2015-10-20 02:34:50,849] received file /mnt/data/cassandra/data/manual/artist_to_user-6a01f82076aa11e59305f5ca02614f5c/ma-6-big-Data.db (progress: 195%)
[2015-10-20 02:34:50,849] received file /mnt/data/cassandra/data/manual/artist_to_user-6a01f82076aa11e59305f5ca02614f5c/ma-6-big-Data.db (progress: 196%)
[2015-10-20 02:34:50,849] received file /mnt/data/cassandra/data/manual/artist_to_user-6a01f82076aa11e59305f5ca02614f5c/ma-6-big-Data.db (progress: 197%)
[2015-10-20 02:34:50,849] received file /mnt/data/cassandra/data/manual/artist_to_user-6a01f82076aa11e59305f5ca02614f5c/ma-6-big-Data.db (progress: 198%)
[2015-10-20 02:34:50,849] received file /mnt/data/cassandra/data/manual/artist_to_user-6a01f82076aa11e59305f5ca02614f5c/ma-6-big-Data.db (progress: 200%)
[2015-10-20 02:34:50,850] received file /mnt/data/cassandra/data/manual/artist_to_user-6a01f82076aa11e59305f5ca02614f5c/ma-6-big-Data.db (progress: 201%)
[2015-10-20 02:34:50,850] received file /mnt/data/cassandra/data/manual/artist_to_user-6a01f82076aa11e59305f5ca02614f5c/ma-6-big-Data.db (progress: 202%)
[2015-10-20 02:34:50,850] received file /mnt/data/cassandra/data/manual/artist_to_user-6a01f82076aa11e59305f5ca02614f5c/ma-6-big-Data.db (progress: 203%)
[2015-10-20 02:34:50,850] received file /mnt/data/cassandra/data/manual/artist_to_user-6a01f82076aa11e59305f5ca02614f5c/ma-6-big-Data.db (progress: 204%)
[2015-10-20 02:34:50,850] received file /mnt/data/cassandra/data/manual/artist_to_user-6a01f82076aa11e59305f5ca02614f5c/ma-6-big-Data.db (progress: 205%)
[2015-10-20 02:34:50,850] received file /mnt/data/cassandra/data/manual/artist_to_user-6a01f82076aa11e59305f5ca02614f5c/ma-6-big-Data.db (progress: 206%)
[2015-10-20 02:34:50,851] received file /mnt/data/cassandra/data/manual/artist_to_user-6a01f82076aa11e59305f5ca02614f5c/ma-6-big-Data.db (progress: 207%)
[2015-10-20 02:34:50,851] received file /mnt/data/cassandra/data/manual/artist_to_user-6a01f82076aa11e59305f5ca02614f5c/ma-6-big-Data.db (progress: 208%)
[2015-10-20 02:34:50,882] session with /54.210.184.198 complete (progress: 208%)
[2015-10-20 02:34:50,883] Stream failed

&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="14965166" author="slebresne" created="Tue, 20 Oct 2015 14:23:32 +0000"  >&lt;p&gt;I&apos;m not sure this has anything to do with the column type. That error would typically happen if the node receiving is not up to date on the schema for the table streamed, but a bootstrapping node should be waiting on being up to date on schema before doing any streaming in theory (or has that changed?).&lt;/p&gt;

&lt;p&gt;In any case, if you can reproduce, can you apply the simple patch I attach (that only provide some additional logging) on the boostrapped node, reproduce, and attach the full log for that bootstrapped node? More details on what the test does would help too (if you could make it a reproducible dtest that would be the best thing since sliced bread).&lt;/p&gt;</comment>
                            <comment id="14965608" author="aboudreault" created="Tue, 20 Oct 2015 19:30:51 +0000"  >&lt;p&gt;Here&apos;s the system log. I will try to create a small test case that someone can reproduce easily with CCM. &lt;/p&gt;</comment>
                            <comment id="14965614" author="yukim" created="Tue, 20 Oct 2015 19:33:29 +0000"  >&lt;p&gt;Can you post debug.log also?&lt;/p&gt;</comment>
                            <comment id="14965763" author="aboudreault" created="Tue, 20 Oct 2015 21:03:54 +0000"  >&lt;p&gt;Here&apos;s the debug.log.&lt;/p&gt;</comment>
                            <comment id="14969187" author="aboudreault" created="Thu, 22 Oct 2015 13:55:36 +0000"  >&lt;p&gt;While trying to produce a local test case, I&apos;ve noticed that I can reproduce the error easily just by restarting a node. The error might not be related to the bootstraping anymore at this point since I can see it with a simple node restart. Here the error produce by my test case:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;ERROR [SSTableBatchOpen:2] 2015-10-22 09:48:04,721 CassandraDaemon.java:195 - Exception in thread &lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;[SSTableBatchOpen:2,5,main]
java.lang.RuntimeException: Unknown column added_time during deserialization
	at org.apache.cassandra.db.SerializationHeader$Component.toHeader(SerializationHeader.java:331) ~[main/:na]
	at org.apache.cassandra.io.sstable.format.SSTableReader.open(SSTableReader.java:477) ~[main/:na]
	at org.apache.cassandra.io.sstable.format.SSTableReader.open(SSTableReader.java:366) ~[main/:na]
	at org.apache.cassandra.io.sstable.format.SSTableReader$4.run(SSTableReader.java:525) ~[main/:na]
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511) ~[na:1.8.0_45]
	at java.util.concurrent.FutureTask.run(FutureTask.java:266) ~[na:1.8.0_45]
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1142) ~[na:1.8.0_45]
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:617) [na:1.8.0_45]
	at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:745) [na:1.8.0_45]
ERROR [SSTableBatchOpen:2] 2015-10-22 09:48:04,721 CassandraDaemon.java:195 - Exception in thread &lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;[SSTableBatchOpen:2,5,main]
java.lang.RuntimeException: Unknown column added_time during deserialization
	at org.apache.cassandra.db.SerializationHeader$Component.toHeader(SerializationHeader.java:331) ~[main/:na]
	at org.apache.cassandra.io.sstable.format.SSTableReader.open(SSTableReader.java:477) ~[main/:na]
	at org.apache.cassandra.io.sstable.format.SSTableReader.open(SSTableReader.java:366) ~[main/:na]
	at org.apache.cassandra.io.sstable.format.SSTableReader$4.run(SSTableReader.java:525) ~[main/:na]
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511) ~[na:1.8.0_45]
	at java.util.concurrent.FutureTask.run(FutureTask.java:266) ~[na:1.8.0_45]
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1142) ~[na:1.8.0_45]
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:617) [na:1.8.0_45]
	at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:745) [na:1.8.0_45]
ERROR [SSTableBatchOpen:1] 2015-10-22 09:48:04,721 CassandraDaemon.java:195 - Exception in thread &lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;[SSTableBatchOpen:1,5,main]
java.lang.RuntimeException: Unknown column added_time during deserialization
	at org.apache.cassandra.db.SerializationHeader$Component.toHeader(SerializationHeader.java:331) ~[main/:na]
	at org.apache.cassandra.io.sstable.format.SSTableReader.open(SSTableReader.java:477) ~[main/:na]
	at org.apache.cassandra.io.sstable.format.SSTableReader.open(SSTableReader.java:366) ~[main/:na]
	at org.apache.cassandra.io.sstable.format.SSTableReader$4.run(SSTableReader.java:525) ~[main/:na]
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511) ~[na:1.8.0_45]
	at java.util.concurrent.FutureTask.run(FutureTask.java:266) ~[na:1.8.0_45]
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1142) ~[na:1.8.0_45]
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:617) [na:1.8.0_45]
	at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:745) [na:1.8.0_45]
ERROR [SSTableBatchOpen:1] 2015-10-22 09:48:04,721 CassandraDaemon.java:195 - Exception in thread &lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;[SSTableBatchOpen:1,5,main]
java.lang.RuntimeException: Unknown column added_time during deserialization
	at org.apache.cassandra.db.SerializationHeader$Component.toHeader(SerializationHeader.java:331) ~[main/:na]
	at org.apache.cassandra.io.sstable.format.SSTableReader.open(SSTableReader.java:477) ~[main/:na]
	at org.apache.cassandra.io.sstable.format.SSTableReader.open(SSTableReader.java:366) ~[main/:na]
	at org.apache.cassandra.io.sstable.format.SSTableReader$4.run(SSTableReader.java:525) ~[main/:na]
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511) ~[na:1.8.0_45]
	at java.util.concurrent.FutureTask.run(FutureTask.java:266) ~[na:1.8.0_45]
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1142) ~[na:1.8.0_45]
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:617) [na:1.8.0_45]
	at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:745) [na:1.8.0_45]
INFO  [main] 2015-10-22 09:48:04,726 ColumnFamilyStore.java:381 - Initializing manual.genre_to_user
INFO  [main] 2015-10-22 09:48:04,726 ColumnFamilyStore.java:381 - Initializing manual.genre_to_user
DEBUG [SSTableBatchOpen:1] 2015-10-22 09:48:04,729 SSTableReader.java:470 - Opening /home/aboudreault/.ccm/10554/node2/data/manual/genre_to_user-65e9dfd078c311e5a6e729d4c8a5f42b/ma-1-big (665634 bytes)
ERROR [SSTableBatchOpen:1] 2015-10-22 09:48:04,729 CassandraDaemon.java:195 - Exception in thread &lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;[SSTableBatchOpen:1,5,main]
java.lang.RuntimeException: Unknown column added_time during deserialization
	at org.apache.cassandra.db.SerializationHeader$Component.toHeader(SerializationHeader.java:331) ~[main/:na]
	at org.apache.cassandra.io.sstable.format.SSTableReader.open(SSTableReader.java:477) ~[main/:na]
	at org.apache.cassandra.io.sstable.format.SSTableReader.open(SSTableReader.java:366) ~[main/:na]
	at org.apache.cassandra.io.sstable.format.SSTableReader$4.run(SSTableReader.java:525) ~[main/:na]
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511) ~[na:1.8.0_45]
	at java.util.concurrent.FutureTask.run(FutureTask.java:266) ~[na:1.8.0_45]
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1142) ~[na:1.8.0_45]
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:617) [na:1.8.0_45]
	at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:745) [na:1.8.0_45]
ERROR [SSTableBatchOpen:1] 2015-10-22 09:48:04,729 CassandraDaemon.java:195 - Exception in thread &lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;[SSTableBatchOpen:1,5,main]
java.lang.RuntimeException: Unknown column added_time during deserialization
	at org.apache.cassandra.db.SerializationHeader$Component.toHeader(SerializationHeader.java:331) ~[main/:na]
	at org.apache.cassandra.io.sstable.format.SSTableReader.open(SSTableReader.java:477) ~[main/:na]
	at org.apache.cassandra.io.sstable.format.SSTableReader.open(SSTableReader.java:366) ~[main/:na]
	at org.apache.cassandra.io.sstable.format.SSTableReader$4.run(SSTableReader.java:525) ~[main/:na]
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511) ~[na:1.8.0_45]
	at java.util.concurrent.FutureTask.run(FutureTask.java:266) ~[na:1.8.0_45]
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1142) ~[na:1.8.0_45]
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:617) [na:1.8.0_45]
	at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:745) [na:1.8.0_45]
INFO  [main] 2015-10-22 09:48:04,733 ColumnFamilyStore.java:381 - Initializing manual.recently_played
INFO  [main] 2015-10-22 09:48:04,733 ColumnFamilyStore.java:381 - Initializing manual.recently_played
INFO  [main] 2015-10-22 09:48:04,737 ColumnFamilyStore.java:381 - Initializing manual.song_to_user
INFO  [main] 2015-10-22 09:48:04,737 ColumnFamilyStore.java:381 - Initializing manual.song_to_user
DEBUG [SSTableBatchOpen:1] 2015-10-22 09:48:04,739 SSTableReader.java:470 - Opening /home/aboudreault/.ccm/10554/node2/data/manual/song_to_user-64c97bb078c311e5a6e729d4c8a5f42b/ma-1-big (465269 bytes)
DEBUG [SSTableBatchOpen:2] 2015-10-22 09:48:04,739 SSTableReader.java:470 - Opening /home/aboudreault/.ccm/10554/node2/data/manual/song_to_user-64c97bb078c311e5a6e729d4c8a5f42b/ma-2-big (588288 bytes)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;My test uses Jake&apos;s tool mvbench but I am not using MV at all. Just normal tables maintained manually with batchlog: &lt;span class=&quot;nobr&quot;&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12768038/12768038_test.sh&quot; title=&quot;test.sh attached to CASSANDRA-10554&quot;&gt;test.sh&lt;sup&gt;&lt;img class=&quot;rendericon&quot; src=&quot;https://issues.apache.org/jira/images/icons/link_attachment_7.gif&quot; height=&quot;7&quot; width=&quot;7&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/sup&gt;&lt;/a&gt;&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;You&apos;ll need to compile mvbench and use my branch which contain the driver update:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;git clone https:&lt;span class=&quot;code-comment&quot;&gt;//github.com/tjake/mvbench
&lt;/span&gt;cd mvbench
git remote add aboudreault https:&lt;span class=&quot;code-comment&quot;&gt;//github.com/aboudreault/mvbench.git
&lt;/span&gt;git fetch aboudreault
git checkout driver-and-schema-update
mvn compile
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;When test.sh run is finished, you should see the errors in the node2 system.log file. Let me know if you need anything else.&lt;/p&gt;</comment>
                            <comment id="14969557" author="yukim" created="Thu, 22 Oct 2015 18:03:38 +0000"  >&lt;p&gt;So I added some debug and found interesting trace:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;ERROR [SSTableBatchOpen:2] 2015-10-22 12:14:00,827 SSTableReader.java:541 - Cannot read sstable /home/yuki/.ccm/10544/node2/data/manual/song_to_user-2350231078e011e5877ca9fac1d00bce/ma-2-big=[Summary.db, Statistics.db, Filter.db, CompressionInfo.db, Digest.crc32, Index.db, TOC.txt, Data.db]; other IO error, skipping table
java.lang.RuntimeException: Unknown column artist_name during deserialization
	at org.apache.cassandra.db.SerializationHeader$Component.toHeader(SerializationHeader.java:331) ~[main/:na]
	at org.apache.cassandra.io.sstable.format.SSTableReader.open(SSTableReader.java:477) ~[main/:na]
	at org.apache.cassandra.io.sstable.format.SSTableReader.open(SSTableReader.java:366) ~[main/:na]
	at org.apache.cassandra.io.sstable.format.SSTableReader$4.run(SSTableReader.java:525) ~[main/:na]
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511) [na:1.8.0_51]
	at java.util.concurrent.FutureTask.run(FutureTask.java:266) [na:1.8.0_51]
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1142) [na:1.8.0_51]
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:617) [na:1.8.0_51]
	at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:745) [na:1.8.0_51]
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Since &lt;tt&gt;manual.song_to_user&lt;/tt&gt; doesn&apos;t have &lt;tt&gt;artist_name&lt;/tt&gt; in its schema (schema bellow), how does SSTable happen to have such column?&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;CREATE TABLE manual.song_to_user (
    song_id text,
    user_name text,
    playlist_name text,
    added_time bigint,
    PRIMARY KEY (song_id, user_name, playlist_name)
)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Will investigate more.&lt;/p&gt;</comment>
                            <comment id="14969752" author="aboudreault" created="Thu, 22 Oct 2015 19:42:01 +0000"  >&lt;p&gt;Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=yukim&quot; class=&quot;user-hover&quot; rel=&quot;yukim&quot;&gt;yukim&lt;/a&gt;. Let me know if I can help in any way.&lt;/p&gt;</comment>
                            <comment id="14969878" author="yukim" created="Thu, 22 Oct 2015 20:54:04 +0000"  >&lt;p&gt;I think I found the problem.&lt;br/&gt;
Batch statement seems to mix partitioned columns from those in its statement.&lt;br/&gt;
Memtable serializes those mixed &lt;tt&gt;PartitionColumns&lt;/tt&gt; to Stats.db&lt;/p&gt;

&lt;p&gt;CQL file to reproduce is attached.&lt;/p&gt;

&lt;p&gt;To reproduce:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;$ ccm node1 start # start node
$ cqlsh -f 10554.cql
$ nodetool flush manual # flush manual keyspace
&lt;span class=&quot;code-comment&quot;&gt;// then restart or anything that reads SSTable offline will &lt;span class=&quot;code-keyword&quot;&gt;throw&lt;/span&gt; error&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
</comment>
                            <comment id="14974562" author="slebresne" created="Mon, 26 Oct 2015 17:12:10 +0000"  >&lt;p&gt;That we mix columns from different tables in &lt;tt&gt;BatchStatement&lt;/tt&gt; is definitively an oversight. Pushed patch for this &lt;a href=&quot;https://github.com/pcmanus/cassandra/commits/10554&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;here&lt;/a&gt;. The patch includes a unit test because we didn&apos;t had one mixing 2 separate tables and figured having at least one couldn&apos;t hurt, but that test doesn&apos;t reproduce this issue as you need to restart a node (or use streaming) for &lt;tt&gt;Component.toHeader()&lt;/tt&gt; method to be called (and thus this error to be thrown). I&apos;ve pushed a dtest that does reproduce however &lt;a href=&quot;https://github.com/pcmanus/cassandra/commits/10554&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;here&lt;/a&gt; (which I&apos;ll commit once the patch is ok&apos;ed).&lt;/p&gt;</comment>
                            <comment id="14975281" author="aboudreault" created="Mon, 26 Oct 2015 22:51:48 +0000"  >&lt;p&gt;The patch works well. I&apos;ll rework on the bootstraping stuff tomorrow morning&lt;/p&gt;</comment>
                            <comment id="14976201" author="blambov" created="Tue, 27 Oct 2015 10:36:44 +0000"  >&lt;p&gt;Code looks good, commit when happy with CI.&lt;/p&gt;</comment>
                            <comment id="14976324" author="slebresne" created="Tue, 27 Oct 2015 12:55:44 +0000"  >&lt;p&gt;Committed, thanks.&lt;/p&gt;</comment>
                            <comment id="14976730" author="aboudreault" created="Tue, 27 Oct 2015 17:02:03 +0000"  >&lt;p&gt;I confirm that my bootstrap issue is now resolved. Thanks!&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12767598" name="0001-Add-debug.txt" size="1870" author="slebresne" created="Tue, 20 Oct 2015 14:23:32 +0000"/>
                            <attachment id="12768135" name="10554.cql" size="935" author="yukim" created="Thu, 22 Oct 2015 20:54:04 +0000"/>
                            <attachment id="12767670" name="debug.log" size="354329" author="aboudreault" created="Tue, 20 Oct 2015 21:03:54 +0000"/>
                            <attachment id="12767649" name="system.log" size="56060" author="aboudreault" created="Tue, 20 Oct 2015 19:30:51 +0000"/>
                            <attachment id="12768038" name="test.sh" size="372" author="aboudreault" created="Thu, 22 Oct 2015 13:56:05 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>5.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[slebresne]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 4 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2n7l3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>blambov</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[blambov]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12963"><![CDATA[Critical]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311124" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Tester</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>aboudreault</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>