<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 22:59:02 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-10628] get JEMAlloc debug output out of nodetool output</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-10628</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;This is a followup ticket for &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-10581&quot; title=&quot;Update cassandra.yaml comments to reflect memory_allocator deprecation, remove in 3.0&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-10581&quot;&gt;&lt;del&gt;CASSANDRA-10581&lt;/del&gt;&lt;/a&gt;. The consensus on the Cassandra TE is that the debug output for loading JEMAlloc is helpful (or at least harmless when starting C*, but not when starting &lt;tt&gt;nodetool&lt;/tt&gt;, which, it turns out, sources &lt;tt&gt;cassandra-env&lt;/tt&gt;:&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/apache/cassandra/blob/trunk/bin/nodetool#L53&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/cassandra/blob/trunk/bin/nodetool#L53&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;You can reproduce the excessive output with&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;ccm create test-nodetool-output -v git:cassandra-3.0 -n 1 ; ccm start --wait-&lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt;-binary-proto ; ccm node1 nodetool ring
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The simplest solution would probably be to redirect the output of the sourcing to &lt;tt&gt;/dev/null/&lt;/tt&gt;. I don&apos;t know if that&apos;s the right thing to do; it may be better to move the &lt;tt&gt;LD_PRELOAD&lt;/tt&gt;-setting logic to &lt;tt&gt;bin/cassandra&lt;/tt&gt;. I&apos;m not sure what the reasoning would be for putting something in one place or another, so I leave it to the dev team to decide on the best solution.&lt;/p&gt;

&lt;p&gt;Assigning &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=snazy&quot; class=&quot;user-hover&quot; rel=&quot;snazy&quot;&gt;snazy&lt;/a&gt; for now; feel free to reassign&lt;/p&gt;</description>
                <environment></environment>
        <key id="12909308">CASSANDRA-10628</key>
            <summary>get JEMAlloc debug output out of nodetool output</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10002" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Normal</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="snazy">Robert Stupp</assignee>
                                    <reporter username="mambocab">Jim Witschey</reporter>
                        <labels>
                    </labels>
                <created>Fri, 30 Oct 2015 20:02:41 +0000</created>
                <updated>Tue, 16 Apr 2019 09:30:51 +0000</updated>
                            <resolved>Wed, 4 Nov 2015 22:33:57 +0000</resolved>
                                        <fixVersion>2.2.4</fixVersion>
                    <fixVersion>3.0.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="14984339" author="snazy" created="Sun, 1 Nov 2015 10:42:29 +0000"  >&lt;p&gt;Wasn&apos;t aware that &lt;tt&gt;cassandra-env.sh&lt;/tt&gt; is sourced from &lt;tt&gt;bin/nodetool&lt;/tt&gt; (it does that to get the &lt;tt&gt;JMX_PORT&lt;/tt&gt; variable).&lt;/p&gt;

&lt;p&gt;Moved jemalloc-preload to &lt;tt&gt;bin/cassandra&lt;/tt&gt; and pushed a commit to &lt;a href=&quot;https://github.com/snazy/cassandra/tree/10628-move-jemalloc-2.2&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;this branch&lt;/a&gt; for 2.2 (&lt;a href=&quot;https://github.com/snazy/cassandra/tree/10628-move-jemalloc-3.0&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;3.0&lt;/a&gt;, &lt;a href=&quot;https://github.com/snazy/cassandra/tree/10628-move-jemalloc-trunk&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;trunk&lt;/a&gt;).&lt;/p&gt;</comment>
                            <comment id="14985257" author="slebresne" created="Mon, 2 Nov 2015 14:08:08 +0000"  >&lt;p&gt;Was was the ticket that introduced that output?&lt;/p&gt;</comment>
                            <comment id="14985357" author="mambocab" created="Mon, 2 Nov 2015 15:05:45 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=slebresne&quot; class=&quot;user-hover&quot; rel=&quot;slebresne&quot;&gt;slebresne&lt;/a&gt; it was &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-10581&quot; title=&quot;Update cassandra.yaml comments to reflect memory_allocator deprecation, remove in 3.0&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-10581&quot;&gt;&lt;del&gt;CASSANDRA-10581&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="14985402" author="slebresne" created="Mon, 2 Nov 2015 15:38:26 +0000"  >&lt;p&gt;This seems to be breaking a bunch of dtests for the record. &lt;/p&gt;</comment>
                            <comment id="14986043" author="aweisberg" created="Mon, 2 Nov 2015 21:02:58 +0000"  >&lt;p&gt;The dtests for this haven&apos;t run yet in Cassci. I started them on the 2.2 branch.&lt;/p&gt;</comment>
                            <comment id="14986874" author="slebresne" created="Tue, 3 Nov 2015 08:07:13 +0000"  >&lt;p&gt;As I mentioned in &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-10581&quot; title=&quot;Update cassandra.yaml comments to reflect memory_allocator deprecation, remove in 3.0&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-10581&quot;&gt;&lt;del&gt;CASSANDRA-10581&lt;/del&gt;&lt;/a&gt;, I&apos;m not terribly fan of the warning as it exists in the first place. I&apos;d have a strong preference for warning for this in the &lt;tt&gt;system.log&lt;/tt&gt; file, like we do for many other things. I can see at least 2 ways to make that happen: 1) export some custom variable in the startup shell script if JEMalloc is detected and check for that variable on the java side or 2) pass a startup option that says if we detected JEMalloc, with a preference for 1). Doing so will obviously also solve this ticket.&lt;/p&gt;</comment>
                            <comment id="14987958" author="snazy" created="Tue, 3 Nov 2015 19:42:08 +0000"  >&lt;p&gt;Updated the patch to pass a Java system property containing the path of the (probably) preloaded jemalloc to log the message from a &lt;tt&gt;StartupCheck&lt;/tt&gt; implementation.&lt;br/&gt;
Triggered &lt;a href=&quot;http://cassci.datastax.com/search/?q=snazy-10628-&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;testall + dtest for 2.2 and 3.0 branches&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="14990322" author="aweisberg" created="Wed, 4 Nov 2015 20:19:23 +0000"  >&lt;p&gt;The change LGTM. The dtests and utests look good although the trunk version is still running. I asked Robert to manually test on Linux and OS X, with and without jemalloc, and disabling jemalloc with &quot;-&quot;. If that checks out then +1.&lt;/p&gt;</comment>
                            <comment id="14990586" author="snazy" created="Wed, 4 Nov 2015 22:33:47 +0000"  >&lt;p&gt;Works on both OSX and Linux (latest Debian).&lt;br/&gt;
Thanks, committed as 0ff13d2a6847f7ecba1ac9a26b66714d9e58b60d to 2.2, 3.0, trunk&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[snazy]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 2 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2nrdj:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>aweisberg</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[aweisberg]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12962"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>