<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 23:14:17 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-15468] Unable to start embedded cassandra on JDK 11</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-15468</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;Cassandra fails to start without the following jvm options from jvm-11-server.options:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
-Djdk.attach.allowAttachSelf=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;
--add-exports java.base/jdk.internal.misc=ALL-UNNAMED
--add-exports java.base/jdk.internal.ref=ALL-UNNAMED
--add-exports java.base/sun.nio.ch=ALL-UNNAMED
--add-exports java.management.rmi/com.sun.jmx.remote.internal.rmi=ALL-UNNAMED
--add-exports java.rmi/sun.rmi.registry=ALL-UNNAMED
--add-exports java.rmi/sun.rmi.server=ALL-UNNAMED
--add-exports java.sql/java.sql=ALL-UNNAMED

--add-opens java.base/java.lang.module=ALL-UNNAMED
--add-opens java.base/jdk.internal.loader=ALL-UNNAMED
--add-opens java.base/jdk.internal.ref=ALL-UNNAMED
--add-opens java.base/jdk.internal.reflect=ALL-UNNAMED
--add-opens java.base/jdk.internal.math=ALL-UNNAMED
--add-opens java.base/jdk.internal.module=ALL-UNNAMED
--add-opens java.base/jdk.internal.util.jar=ALL-UNNAMED
--add-opens jdk.management/com.sun.management.internal=ALL-UNNAMED
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Without these options the following stack trace appears and prevents startup&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
2020-01-05T17:42:15,009 ERROR main org.apache.cassandra.service.CassandraDaemon Exception encountered during startup java.lang.ExceptionInInitializerError
	at org.apache.cassandra.config.DatabaseDescriptor.guessFileStore(DatabaseDescriptor.java:1127)
	at org.apache.cassandra.config.DatabaseDescriptor.applySimpleConfig(DatabaseDescriptor.java:541)
	at org.apache.cassandra.config.DatabaseDescriptor.applyAll(DatabaseDescriptor.java:340)
	at org.apache.cassandra.config.DatabaseDescriptor.daemonInitialization(DatabaseDescriptor.java:168)
	at org.apache.cassandra.config.DatabaseDescriptor.daemonInitialization(DatabaseDescriptor.java:152)
	at org.apache.cassandra.service.CassandraDaemon.applyConfig(CassandraDaemon.java:665)
	at org.apache.cassandra.service.CassandraDaemon.activate(CassandraDaemon.java:609)
	at org.jesterj.ingest.persistence.Cassandra.start(Cassandra.java:135)
	at org.jesterj.ingest.scanners.SimpleFileScannerImplFTITest.testScanWithMemory(SimpleFileScannerImplFTITest.java:63)
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.base/java.lang.reflect.Method.invoke(Method.java:566)
	at org.junit.runners.model.FrameworkMethod$1.runReflectiveCall(FrameworkMethod.java:45)
	at org.junit.internal.runners.model.ReflectiveCallable.run(ReflectiveCallable.java:15)
	at org.junit.runners.model.FrameworkMethod.invokeExplosively(FrameworkMethod.java:42)
	at org.junit.internal.runners.statements.InvokeMethod.evaluate(InvokeMethod.java:20)
	at org.junit.internal.runners.statements.RunBefores.evaluate(RunBefores.java:28)
	at org.junit.internal.runners.statements.RunAfters.evaluate(RunAfters.java:30)
	at org.junit.runners.ParentRunner.runLeaf(ParentRunner.java:263)
	at org.junit.runners.BlockJUnit4ClassRunner.runChild(BlockJUnit4ClassRunner.java:68)
	at org.junit.runners.BlockJUnit4ClassRunner.runChild(BlockJUnit4ClassRunner.java:47)
	at org.junit.runners.ParentRunner$3.run(ParentRunner.java:231)
	at org.junit.runners.ParentRunner$1.schedule(ParentRunner.java:60)
	at org.junit.runners.ParentRunner.runChildren(ParentRunner.java:229)
	at org.junit.runners.ParentRunner.access$000(ParentRunner.java:50)
	at org.junit.runners.ParentRunner$2.evaluate(ParentRunner.java:222)
	at org.junit.runners.ParentRunner.run(ParentRunner.java:300)
	at org.junit.runner.JUnitCore.run(JUnitCore.java:157)
	at com.intellij.junit4.JUnit4IdeaTestRunner.startRunnerWithArgs(JUnit4IdeaTestRunner.java:68)
	at com.intellij.rt.execution.junit.IdeaTestRunner$Repeater.startRunnerWithArgs(IdeaTestRunner.java:47)
	at com.intellij.rt.execution.junit.JUnitStarter.prepareStreamsAndStart(JUnitStarter.java:242)
	at com.intellij.rt.execution.junit.JUnitStarter.main(JUnitStarter.java:70)
Caused by: java.lang.RuntimeException: java.lang.IllegalAccessException: access to &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; member failed: jdk.internal.ref.Cleaner.clean[Ljava.lang.&lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt;;@779dfe55/invokeVirtual, from org.apache.cassandra.io.util.FileUtils (unnamed module @2eda0940)
	at org.apache.cassandra.io.util.FileUtils.&amp;lt;clinit&amp;gt;(FileUtils.java:95)
	... 33 more
Caused by: java.lang.IllegalAccessException: access to &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; member failed: jdk.internal.ref.Cleaner.clean[Ljava.lang.&lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt;;@779dfe55/invokeVirtual, from org.apache.cassandra.io.util.FileUtils (unnamed module @2eda0940)
	at java.base/java.lang.invoke.MemberName.makeAccessException(MemberName.java:942)
	at java.base/java.lang.invoke.MethodHandles$Lookup.checkAccess(MethodHandles.java:2206)
	at java.base/java.lang.invoke.MethodHandles$Lookup.checkMethod(MethodHandles.java:2146)
	at java.base/java.lang.invoke.MethodHandles$Lookup.getDirectMethodCommon(MethodHandles.java:2290)
	at java.base/java.lang.invoke.MethodHandles$Lookup.getDirectMethodNoSecurityManager(MethodHandles.java:2283)
	at java.base/java.lang.invoke.MethodHandles$Lookup.unreflect(MethodHandles.java:1747)
	at org.apache.cassandra.io.util.FileUtils.&amp;lt;clinit&amp;gt;(FileUtils.java:86)
	... 33 more
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Use of --add-exports is described in the oracle documentation as&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;You may use the --add-exports option as a temporary workaround to compile source code with references to JDK internal classes.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;which implies that this will not work forever.  Also the code in FileUtils seems somewhat confused as it prints out a warning, as if it means to allow startup with a lower performance expectation, and then throws an exception that entirely prevents startup.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13277595">CASSANDRA-15468</key>
            <summary>Unable to start embedded cassandra on JDK 11</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10002" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Normal</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="gus">Gus Heck</assignee>
                                    <reporter username="gus">Gus Heck</reporter>
                        <labels>
                    </labels>
                <created>Sun, 5 Jan 2020 22:57:19 +0000</created>
                <updated>Fri, 15 May 2020 08:54:52 +0000</updated>
                            <resolved>Mon, 13 Jan 2020 13:49:46 +0000</resolved>
                                        <fixVersion>4.0-alpha3</fixVersion>
                    <fixVersion>4.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="17008761" author="beobal" created="Mon, 6 Jan 2020 11:47:03 +0000"  >&lt;p&gt;As you&apos;ve seen from &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-9608&quot; title=&quot;Support Java 11&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-9608&quot;&gt;&lt;del&gt;CASSANDRA-9608&lt;/del&gt;&lt;/a&gt;, these options are required due to the use of internal jdk classes and compounded by the cross compilation requirement while we maintain support for java 8. I very much doubt that neither these requirements nor support for &lt;tt&gt;--add-exports&lt;/tt&gt; in the jdk are going to be removed any time soon. So you&apos;re right that this is a somewhat temporary solution, but it will be addressed when it becomes necessary to do so.&lt;/p&gt;

&lt;p&gt;Regarding the log message, I&apos;m not sure I agree that the messaging is ambiguous here given that the message is logged at &lt;tt&gt;ERROR&lt;/tt&gt; level and prefixed &lt;tt&gt;FATAL&lt;/tt&gt;. To me, that indicates pretty clearly that a failure is imminent.&lt;/p&gt;</comment>
                            <comment id="17010070" author="gus_heck" created="Tue, 7 Jan 2020 20:31:20 +0000"  >&lt;p&gt;I&apos;d like to respectfully ask that this not be resolved yet. I don&apos;t agree that there are no problems here. What is the point of the latter half of the message? &lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;Some data, both in-memory and on-disk, may live longer due to garbage collection.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I would say that&apos;s quite incorrect since Cassandra won&apos;t even be starting up, and even if it did attempts to use FileUtils.clean() are going to throw NPE&apos;s which will probably do a bit worse than cause data to live longer. &lt;br/&gt;
Additionally the message give here is cryptic and leaves the user unable to discern (without searching through your jira, and taking the time to fully debug cassandra&apos;s code, and read your startups scripts as I did) what the problem is or how to correct it. So before we close this I&apos;d like to suggest one thing that I hope is non-controversial, and another that might require some consideration:&lt;/p&gt;

&lt;p&gt;1. Revise the error message here for the case of an IllegalAccessException to advise the user how to move forward. Particularly tell them that they should either use the standard cassandra start up scripts, or (expert) supply the following --add-export and --add-open jvm args&lt;br/&gt;
2. Perhaps document the exports and opens requirements in a machine readable way by adding Add-Exports: and Add-Opens: attributes to the manifest for the jar file. &lt;/p&gt;

&lt;p&gt;Suggestion #2 will not change the need for the .options files unless a bigger change to invoke via java -jar happens (which I&apos;m not suggesting here, but it could eliminate that portion of the options file)&lt;/p&gt;

&lt;p&gt;At some point I&apos;ll likely add support to Uno-Jar  to dig through manifests of dependency jars looking for any jars with exports to collect them for the uber jar... obviously that can only be a best effort thing, since no spec requires such attributes but certainly it makes sense for jars to politely declare what exports they require. (except of course proprietary stuff that might seek to obfuscate and inhibit any usage not licensed...)&lt;/p&gt;</comment>
                            <comment id="17010072" author="gus_heck" created="Tue, 7 Jan 2020 20:32:41 +0000"  >&lt;p&gt;Patch suggesting a possible improved error message (item 1) attached.&lt;/p&gt;</comment>
                            <comment id="17011085" author="gus_heck" created="Thu, 9 Jan 2020 00:00:42 +0000"  >&lt;p&gt;Worth noting that I&apos;ve realized that &quot;Add-Opens&quot; does not exist in the world of jar Manifests AFAICT... I assumed it would if &quot;Add-Export&quot; did, but it didn&apos;t work and I find no references to it on the web. It might be possible for me to use that info in Uno-Jar anyway since I hope to add support for module layers such that dependencies on different versions can co-exist, and java.lang.Module has an addOpens() method, so while I&apos;m there playing with modules anyway... &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;.&lt;/p&gt;</comment>
                            <comment id="17014332" author="beobal" created="Mon, 13 Jan 2020 13:49:46 +0000"  >&lt;blockquote&gt;&lt;p&gt;I&apos;d like to respectfully ask that this not be resolved yet.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Fair enough, I was a bit hasty in closing it. The patch looks good and absolutely improves the user experience so I&apos;ve edited the title of this JIRA to reflect what it does. If you wouldn&apos;t mind opening follow up JIRAs for any work that needs to be done to support Uno-Jar or for making changes to the jar manifest, that&apos;d be great.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;
&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;branch&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;CI&lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/beobal/cassandra/tree/15468-trunk&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;15468-trunk&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://circleci.com/gh/beobal/workflows/cassandra/tree/15468-trunk&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;circle&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;


&lt;p&gt;(the few test failures are unrelated)&lt;/p&gt;

&lt;p&gt;Thanks&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12990129" name="CASSANDRA-15468.patch" size="1659" author="gus" created="Tue, 7 Jan 2020 20:31:15 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[gus]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12313922" key="jira.plugin.projectspecificselectfield.jpssf:multicftype">
                        <customfieldname>Impacts</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="13100"><![CDATA[None]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            5 years, 44 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12313921" key="jira.plugin.projectspecificselectfield.jpssf:multicftype">
                        <customfieldname>Platform</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="13076"><![CDATA[All]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0a7bc:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[samt]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12311420" key="com.atlassian.jira.plugin.system.customfieldtypes:version">
                        <customfieldname>Since Version</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="12336842">4.0</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313924" key="com.atlassian.jira.plugin.system.customfieldtypes:textfield">
                        <customfieldname>Source Control Link</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>&lt;p&gt;&lt;a href=&quot;https://github.com/apache/cassandra/commit/b30ebb952c53a3dae078f6883b26feca685eb7cc&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/cassandra/commit/b30ebb952c53a3dae078f6883b26feca685eb7cc&lt;/a&gt;&lt;/p&gt;</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313823" key="com.atlassian.jira.plugin.system.customfieldtypes:textarea">
                        <customfieldname>Test and Documentation Plan</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>&lt;p&gt;No additional testing required&lt;/p&gt;</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>