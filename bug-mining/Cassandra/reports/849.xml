<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 22:20:33 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-2290] Repair hangs if one of the neighbor is dead</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-2290</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;Repair don&apos;t cope well with dead/dying neighbors. There is 2 problems:&lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;Repair don&apos;t check if a node is dead before sending a TreeRequest; this is easily fixable.&lt;/li&gt;
	&lt;li&gt;If a neighbor dies mid-repair, the repair will also hang forever.&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;The second point is not easy to deal with. The best approach is probably &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-1740&quot; title=&quot;Nodetool commands to query and stop compaction, repair, cleanup and scrub&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-1740&quot;&gt;&lt;del&gt;CASSANDRA-1740&lt;/del&gt;&lt;/a&gt; however. That is, if we add a way to query the state of a repair, and that this query correctly check all neighbors and also add a way to cancel a repair, this would probably be enough.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12500799">CASSANDRA-2290</key>
            <summary>Repair hangs if one of the neighbor is dead</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10003" iconUrl="https://issues.apache.org/jira/images/icons/priorities/trivial.svg">Low</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="slebresne">Sylvain Lebresne</assignee>
                                    <reporter username="slebresne">Sylvain Lebresne</reporter>
                        <labels>
                    </labels>
                <created>Tue, 8 Mar 2011 19:09:32 +0000</created>
                <updated>Tue, 16 Apr 2019 09:33:04 +0000</updated>
                            <resolved>Tue, 19 Apr 2011 12:54:09 +0000</resolved>
                                        <fixVersion>0.7.5</fixVersion>
                    <fixVersion>0.8 beta 1</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                    <workratio workratioPercent="0"/>
                                    <progress percentage="0">
                                    <originalProgress>
                                                    <row percentage="100" backgroundColor="#89afd7"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="0" backgroundColor="#51a825"/>
                                                    <row percentage="100" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="0">
                                    <originalProgress>
                                                    <row percentage="100" backgroundColor="#89afd7"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="0" backgroundColor="#51a825"/>
                                                    <row percentage="100" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                    <timeoriginalestimate seconds="3600">1h</timeoriginalestimate>
                            <timeestimate seconds="3600">1h</timeestimate>
                                        <comments>
                            <comment id="13004532" author="slebresne" created="Wed, 9 Mar 2011 13:16:27 +0000"  >&lt;p&gt;Attaching patch for the first problem above. It checks that all neighbors are alive before attempting the repair. If not, it don&apos;t start the repair. Another option would be to still do the repair with whomever neighbor are alive (if any). But I think that refusing to repair is a saner default and I&apos;m fine waiting that someone needs the second option before considering adding it.&lt;/p&gt;</comment>
                            <comment id="13004707" author="amorton" created="Wed, 9 Mar 2011 18:32:12 +0000"  >&lt;p&gt;Not sure if this helps. I found a place where AES was hanging while testing failure during streaming transfer for &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-2088&quot; title=&quot;Clean up after failed (repair) streaming operation&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-2088&quot;&gt;&lt;del&gt;CASSANDRA-2088&lt;/del&gt;&lt;/a&gt; (against 0.7). I broke the FileStresmTask to only send one range and close the sending channel. &lt;/p&gt;

&lt;p&gt;The  IncomingStreamReader.readFile() got stuck in an infinite loop because it does not check the return from FileChannel.transferFrom(). It was returning 0 bytes read. Also the FileStreamTask does not check the bytes sent by transferTo()&lt;/p&gt;

&lt;p&gt;While stuck in the loop the socket it was reading from was (127.0.0.1 was in the loop, .0.2 was sending) &lt;br/&gt;
java      25371 aaron   73u  IPv4 0xffffff8010742ff8      0t0  TCP 127.0.0.1:7000-&amp;gt;127.0.0.2:52759 (CLOSE_WAIT)&lt;/p&gt;

&lt;p&gt;When I was debugging the socketChannel was still reporting it was open. &lt;/p&gt;

&lt;p&gt;Update: Modified FileStresmTask to call System.exit() after sending the first section and got the same result.&lt;/p&gt;</comment>
                            <comment id="13021306" author="jbellis" created="Mon, 18 Apr 2011 22:11:31 +0000"  >&lt;p&gt;+1 the check-neighbors patch&lt;/p&gt;</comment>
                            <comment id="13021317" author="slebresne" created="Mon, 18 Apr 2011 22:23:50 +0000"  >&lt;p&gt;Committed (to 0.7 and 0.8) the check-neighbor patch. I&apos;m closing this as the rest of this issue is a duplicate &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-2433&quot; title=&quot;Failed Streams Break Repair&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-2433&quot;&gt;&lt;del&gt;CASSANDRA-2433&lt;/del&gt;&lt;/a&gt; and could go there.&lt;/p&gt;</comment>
                            <comment id="13021356" author="jbellis" created="Tue, 19 Apr 2011 00:25:45 +0000"  >&lt;p&gt;oops, need to fix AESTest now&lt;/p&gt;</comment>
                            <comment id="13021527" author="hudson" created="Tue, 19 Apr 2011 10:28:08 +0000"  >&lt;p&gt;Integrated in Cassandra #856 (See &lt;a href=&quot;https://hudson.apache.org/hudson/job/Cassandra/856/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://hudson.apache.org/hudson/job/Cassandra/856/&lt;/a&gt;)&lt;/p&gt;
</comment>
                            <comment id="13021528" author="slebresne" created="Tue, 19 Apr 2011 10:39:21 +0000"  >&lt;p&gt;Tests fixed, sorry about that.&lt;/p&gt;</comment>
                            <comment id="13021529" author="hudson" created="Tue, 19 Apr 2011 10:46:54 +0000"  >&lt;p&gt;Integrated in Cassandra-0.8 #19 (See &lt;a href=&quot;https://hudson.apache.org/hudson/job/Cassandra-0.8/19/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://hudson.apache.org/hudson/job/Cassandra-0.8/19/&lt;/a&gt;)&lt;br/&gt;
    Fix unit tests for &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-2290&quot; title=&quot;Repair hangs if one of the neighbor is dead&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-2290&quot;&gt;&lt;del&gt;CASSANDRA-2290&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13021595" author="hudson" created="Tue, 19 Apr 2011 14:04:21 +0000"  >&lt;p&gt;Integrated in Cassandra-0.7 #447 (See &lt;a href=&quot;https://hudson.apache.org/hudson/job/Cassandra-0.7/447/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://hudson.apache.org/hudson/job/Cassandra-0.7/447/&lt;/a&gt;)&lt;/p&gt;
</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10001">
                    <name>dependent</name>
                                            <outwardlinks description="depends upon">
                                        <issuelink>
            <issuekey id="12479848">CASSANDRA-1740</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12473125" name="0001-Don-t-start-repair-if-a-neighbor-is-dead.patch" size="1702" author="slebresne" created="Wed, 9 Mar 2011 13:16:27 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[slebresne]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>20543</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            14 years, 32 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0gahz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>93131</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>jbellis</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[jbellis]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12961"><![CDATA[Low]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>