<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 22:30:40 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-3758] parallel compaction hang (on large rows?)</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-3758</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;it is observed that:&lt;/p&gt;

&lt;p&gt;nodetool -h 127.0.0.1 -p 8080 compactionstats&lt;br/&gt;
pending tasks: 1&lt;br/&gt;
compaction type keyspace column family bytes compacted bytes total progress&lt;br/&gt;
Compaction SyncCoreComputedContactNetworks 119739938 0 n/a&lt;/p&gt;

&lt;p&gt;and that is not moving (ie the bytes compacted never increase, the bytes total stay 0).&lt;/p&gt;

&lt;p&gt;this is probably going to be difficult to reproduce, as the problem is observed when compacting 15 large sstables (total ~300G).&lt;/p&gt;

&lt;p&gt;attaching the thread dumps (along with logs), when such happen.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12539073">CASSANDRA-3758</key>
            <summary>parallel compaction hang (on large rows?)</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10003" iconUrl="https://issues.apache.org/jira/images/icons/priorities/trivial.svg">Low</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="3">Duplicate</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="cywjackson">Jackson Chung</reporter>
                        <labels>
                            <label>compaction</label>
                            <label>datastax_qa</label>
                    </labels>
                <created>Fri, 20 Jan 2012 00:03:31 +0000</created>
                <updated>Tue, 16 Apr 2019 09:32:42 +0000</updated>
                            <resolved>Fri, 4 May 2012 15:39:04 +0000</resolved>
                                                            <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                                                                <comments>
                            <comment id="13189516" author="cywjackson" created="Fri, 20 Jan 2012 00:04:49 +0000"  >&lt;p&gt;ps: i had a problem unzip it originally, but getaround by gunzip -c &lt;span class=&quot;error&quot;&gt;&amp;#91;file&amp;#93;&lt;/span&gt; &amp;gt; /path/to/file .. just in case&lt;/p&gt;</comment>
                            <comment id="13194059" author="cywjackson" created="Thu, 26 Jan 2012 18:34:04 +0000"  >&lt;p&gt;confirmed that disable multithreaded_compaction allows compaction to finish&lt;/p&gt;</comment>
                            <comment id="13242226" author="slebresne" created="Fri, 30 Mar 2012 10:19:37 +0000"  >&lt;p&gt;I&apos;m not sure what&apos;s going on here. I went back over the parallel compaction code and didn&apos;t saw any obvious problem. I&apos;m not sure it&apos;ll be easy to fix without being able to repro.&lt;/p&gt;

&lt;p&gt;I&apos;m also not completely sure what to make of the provided thread dump. Is that only one giant thread dump? If so, there seems to be tons of CompactionReducer threads, coming for lots of different ParallelCompactionIterable,  which would suggest we don&apos;t shutdown the executor of CompactionReducer correctly. But I don&apos;t see why that would happen.&lt;/p&gt;

&lt;p&gt;At least, what is annoying is that the reporting of the total bytes to compact is buggy for parallel compactions (if it wasn&apos;t we could tell more precisely when during the compaction the hanging occured). So attaching a patch to fix that problem.&lt;/p&gt;</comment>
                            <comment id="13242362" author="jbellis" created="Fri, 30 Mar 2012 14:09:34 +0000"  >&lt;blockquote&gt;&lt;p&gt;there seems to be tons of CompactionReducer threads, coming for lots of different ParallelCompactionIterable, which would suggest we don&apos;t shutdown the executor of CompactionReducer correctly. But I don&apos;t see why that would happen&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I assume they are using a version from before &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-3711&quot; title=&quot;Unsustainable Thread Accumulation in ParallelCompactionIterable.Reducer ThreadPoolExecutor&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-3711&quot;&gt;&lt;del&gt;CASSANDRA-3711&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;attaching a patch to fix that problem&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;+1&lt;/p&gt;</comment>
                            <comment id="13242372" author="slebresne" created="Fri, 30 Mar 2012 14:24:15 +0000"  >&lt;blockquote&gt;&lt;p&gt;I assume they are using a version from before &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-3711&quot; title=&quot;Unsustainable Thread Accumulation in ParallelCompactionIterable.Reducer ThreadPoolExecutor&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-3711&quot;&gt;&lt;del&gt;CASSANDRA-3711&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I remembered we had something like that but wasn&apos;t able to find the issue. You&apos;re probably right they ran into this, and maybe that happen to have something to do with the hanging too (even though the lack of any error is kind of weird).&lt;/p&gt;

&lt;p&gt;I&apos;ve committed the total bytes count fix. I wonder if we should try to close this one on the idea that it would be a consequence of &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-3711&quot; title=&quot;Unsustainable Thread Accumulation in ParallelCompactionIterable.Reducer ThreadPoolExecutor&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-3711&quot;&gt;&lt;del&gt;CASSANDRA-3711&lt;/del&gt;&lt;/a&gt; and just let someone reopen if he can reproduce with 1.0.7+ ?&lt;/p&gt;</comment>
                            <comment id="13259645" author="tantra" created="Mon, 23 Apr 2012 15:09:12 +0000"  >&lt;p&gt;Looks like on 0.8 we have the same problem. This happens when we run nodetool cleanup, after adding capacity to cluster&lt;/p&gt;</comment>
                            <comment id="13259687" author="jbellis" created="Mon, 23 Apr 2012 16:05:35 +0000"  >&lt;p&gt;parallel compaction does not exist in 0.8, so you must be seeing something different.  are you on the latest 0.8 release?&lt;/p&gt;</comment>
                            <comment id="13261597" author="tantra" created="Wed, 25 Apr 2012 12:36:48 +0000"  >&lt;p&gt;We use 0.8.10. &lt;/p&gt;

&lt;p&gt;And &lt;/p&gt;

&lt;p&gt;nodetool -h localhost compactionstats&lt;br/&gt;
pending tasks: 1&lt;/p&gt;

&lt;p&gt;Dissapear only after cassandra restart. This happens only ones, without no any warning or Exceptions in logs&lt;/p&gt;</comment>
                            <comment id="13268462" author="slebresne" created="Fri, 4 May 2012 15:39:04 +0000"  >&lt;p&gt;Resolving as dupe of &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-3711&quot; title=&quot;Unsustainable Thread Accumulation in ParallelCompactionIterable.Reducer ThreadPoolExecutor&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-3711&quot;&gt;&lt;del&gt;CASSANDRA-3711&lt;/del&gt;&lt;/a&gt;. Please reopen if you run into this with a version that have the &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-3711&quot; title=&quot;Unsustainable Thread Accumulation in ParallelCompactionIterable.Reducer ThreadPoolExecutor&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-3711&quot;&gt;&lt;del&gt;CASSANDRA-3711&lt;/del&gt;&lt;/a&gt; fix.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12520590" name="0001-Fix-totalBytes-count-for-ParallelCompactionIterable.txt" size="4452" author="slebresne" created="Fri, 30 Mar 2012 10:19:37 +0000"/>
                            <attachment id="12511196" name="cassandra.log.zip" size="3124863" author="cywjackson" created="Fri, 20 Jan 2012 00:04:49 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>224575</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            13 years, 29 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0gnvj:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>95298</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12961"><![CDATA[Low]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>