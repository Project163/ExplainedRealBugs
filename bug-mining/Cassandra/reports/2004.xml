<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 22:36:58 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-5107] node fails to start because host id is missing</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-5107</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;I saw this once on dtestbot but couldn&apos;t figure it out, but now I&apos;ve encountered it myself:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;ERROR 22:04:45,949 Exception encountered during startup
java.lang.AssertionError
   at org.apache.cassandra.locator.TokenMetadata.updateHostId(TokenMetadata.java:219)
   at org.apache.cassandra.service.StorageService.initServer(StorageService.java:442)
   at org.apache.cassandra.service.StorageService.initServer(StorageService.java:397)
   at org.apache.cassandra.service.CassandraDaemon.setup(CassandraDaemon.java:309)
   at org.apache.cassandra.service.CassandraDaemon.activate(CassandraDaemon.java:397)
   at org.apache.cassandra.service.CassandraDaemon.main(CassandraDaemon.java:440)
java.lang.AssertionError
   at org.apache.cassandra.locator.TokenMetadata.updateHostId(TokenMetadata.java:219)
   at org.apache.cassandra.service.StorageService.initServer(StorageService.java:442)
   at org.apache.cassandra.service.StorageService.initServer(StorageService.java:397)
   at org.apache.cassandra.service.CassandraDaemon.setup(CassandraDaemon.java:309)
   at org.apache.cassandra.service.CassandraDaemon.activate(CassandraDaemon.java:397)
   at org.apache.cassandra.service.CassandraDaemon.main(CassandraDaemon.java:440)
Exception encountered during startup: null
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Somehow our own hostid is null sometimes.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12625922">CASSANDRA-5107</key>
            <summary>node fails to start because host id is missing</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10002" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Normal</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="brandon.williams">Brandon Williams</assignee>
                                    <reporter username="brandon.williams">Brandon Williams</reporter>
                        <labels>
                    </labels>
                <created>Thu, 3 Jan 2013 22:12:07 +0000</created>
                <updated>Tue, 16 Apr 2019 09:32:20 +0000</updated>
                            <resolved>Fri, 22 Feb 2013 21:00:17 +0000</resolved>
                                        <fixVersion>1.2.2</fixVersion>
                                        <due></due>
                            <votes>1</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="13550559" author="brandon.williams" created="Thu, 10 Jan 2013 23:25:48 +0000"  >&lt;p&gt;Another trace that may be related:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;ERROR [main] 2013-01-10 17:17:20,150 CassandraDaemon.java (line 387) Exception encountered during startup
java.lang.AssertionError
    at org.apache.cassandra.service.StorageService.getLocalTokens(StorageService.java:1969)
    at org.apache.cassandra.service.StorageService.setTokens(StorageService.java:209)
    at org.apache.cassandra.service.StorageService.joinTokenRing(StorageService.java:740)
    at org.apache.cassandra.service.StorageService.initServer(StorageService.java:508)
    at org.apache.cassandra.service.StorageService.initServer(StorageService.java:406)
    at org.apache.cassandra.service.CassandraDaemon.setup(CassandraDaemon.java:282)
    at org.apache.cassandra.service.CassandraDaemon.activate(CassandraDaemon.java:370)
    at org.apache.cassandra.service.CassandraDaemon.main(CassandraDaemon.java:413)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;We must be wiping our own tokens out so that there&apos;s nothing left to retrieve subsequently.&lt;/p&gt;</comment>
                            <comment id="13551087" author="slebresne" created="Fri, 11 Jan 2013 12:50:20 +0000"  >&lt;p&gt;That second trace is &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-5121&quot; title=&quot;system.peers.tokens is empty after node restart&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-5121&quot;&gt;&lt;del&gt;CASSANDRA-5121&lt;/del&gt;&lt;/a&gt; (which has a patch attached). Maybe the patch there fixes the first trace too, not sure.&lt;/p&gt;</comment>
                            <comment id="13556376" author="brandon.williams" created="Thu, 17 Jan 2013 17:00:57 +0000"  >&lt;p&gt;I think &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-5121&quot; title=&quot;system.peers.tokens is empty after node restart&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-5121&quot;&gt;&lt;del&gt;CASSANDRA-5121&lt;/del&gt;&lt;/a&gt; solved this.&lt;/p&gt;</comment>
                            <comment id="13557273" author="brandon.williams" created="Fri, 18 Jan 2013 15:26:12 +0000"  >&lt;p&gt;It didn&apos;t &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/sad.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;  Here&apos;s another slightly different stacktrace where a remote node&apos;s hostId is missing:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt; INFO [main] 2013-01-18 09:24:30,576 StorageService.java (line 1288) Node /127.0.0.3 state jump to normal
 INFO [main] 2013-01-18 09:24:30,583 StorageService.java (line 744) Startup completed! Now serving reads.
 WARN [main] 2013-01-18 09:24:30,597 Auth.java (line 131) Skipping default superuser setup: some nodes are not ready
 INFO [GossipStage:1] 2013-01-18 09:24:30,637 Gossiper.java (line 782) Node /127.0.0.1 has restarted, now UP
 INFO [GossipStage:1] 2013-01-18 09:24:30,637 Gossiper.java (line 750) InetAddress /127.0.0.1 is now UP
 INFO [GossipStage:1] 2013-01-18 09:24:30,639 StorageService.java (line 1288) Node /127.0.0.1 state jump to normal
 INFO [GossipStage:2] 2013-01-18 09:24:30,640 Gossiper.java (line 782) Node /127.0.0.2 has restarted, now UP
ERROR [GossipStage:1] 2013-01-18 09:24:30,641 CassandraDaemon.java (line 133) Exception in thread Thread[GossipStage:1,5,main]
java.lang.NullPointerException
    at org.apache.cassandra.gms.Gossiper.getHostId(Gossiper.java:637)
    at org.apache.cassandra.service.StorageService.handleStateNormal(StorageService.java:1304)
    at org.apache.cassandra.service.StorageService.onChange(StorageService.java:1166)
    at org.apache.cassandra.service.StorageService.onJoin(StorageService.java:1899)
    at org.apache.cassandra.gms.Gossiper.handleMajorStateChange(Gossiper.java:802)
    at org.apache.cassandra.gms.Gossiper.applyStateLocally(Gossiper.java:853)
    at org.apache.cassandra.gms.GossipDigestAck2VerbHandler.doVerb(GossipDigestAck2VerbHandler.java:43)
    at org.apache.cassandra.net.MessageDeliveryTask.run(MessageDeliveryTask.java:56)
    at java.util.concurrent.ThreadPoolExecutor$Worker.runTask(ThreadPoolExecutor.java:886)
    at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:908)
    at java.lang.Thread.run(Thread.java:662)
 INFO [GossipStage:2] 2013-01-18 09:24:30,642 Gossiper.java (line 750) InetAddress /127.0.0.2 is now UP
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="13557306" author="slebresne" created="Fri, 18 Jan 2013 16:01:31 +0000"  >&lt;p&gt;Can&apos;t that be because we start gossiper before setting the applicationState (including the host_id)? Granted we have a 1 second delay before really starting the gossipTask, but if those stack traces come from the test bot, maybe sometime the machine is slow enough that you can have a whole second interruption of the thread initializing the server.&lt;/p&gt;

&lt;p&gt;In any case, this feel dangerous to me. Maybe we could split Gossiper.start into a Gossiper.init(), followed by the addition of the applicationstate that we expect to be always there, and then we start it.&lt;/p&gt;</comment>
                            <comment id="13557372" author="brandon.williams" created="Fri, 18 Jan 2013 17:25:44 +0000"  >&lt;p&gt;I&apos;m not convinced this is the cause, but you&apos;re right that this seems dangerous regardless.  Patch to preload essential gossip states before starting the gossiper.&lt;/p&gt;</comment>
                            <comment id="13557384" author="slebresne" created="Fri, 18 Jan 2013 17:42:04 +0000"  >&lt;p&gt;Nit: the gossip info are not &quot;pre-loaded&quot;, maybe they good for good measure (splitting start() into init() and start() would have allowed to reuse the gossipSnitchInfo as is &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;, though I&apos;m fine with duplicating the 2 lines of that function if you prefer). Also, currently the &quot;gossip snitch infos&quot; comment are misplaced.&lt;/p&gt;

&lt;p&gt;But that&apos;s details, +1 in any case.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;I&apos;m not convinced this is the cause&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I&apos;m not either, but I don&apos;t see anything else so far. Besides, I&apos;ve seen dtest getting to a bit of crawl for some tests that were involving many nodes, so it&apos;s far fetched, but not impossible.&lt;/p&gt;</comment>
                            <comment id="13557397" author="brandon.williams" created="Fri, 18 Jan 2013 17:50:51 +0000"  >&lt;blockquote&gt;&lt;p&gt;Nit: the gossip info are not &quot;pre-loaded&quot;, maybe they good for good measure (splitting start() into init() and start() would have allowed to reuse the gossipSnitchInfo as is&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;The problem with start/init is propagating the passed in generation, and we can&apos;t add states until we&apos;ve added our local state, which is why I added a new start() signature instead.  I get what you&apos;re saying about gossipSnitchInfo, but it&apos;s also called from PFS.reloadConfiguration, and since addLocalApplicationState does notifications where this &apos;preload&apos; does not, I didn&apos;t want to risk breaking anything there.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;Also, currently the &quot;gossip snitch infos&quot; comment are misplaced.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Actually I fixed that in a ninja-reupload. &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;Committed 0001, leaving this ticket open to see what happens.&lt;/p&gt;</comment>
                            <comment id="13584686" author="brandon.williams" created="Fri, 22 Feb 2013 21:00:17 +0000"  >&lt;p&gt;Closing since I haven&apos;t seen this repro since we committed the fix.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12565509" name="0001-Preload-gossip-application-states-before-starting.txt" size="5046" author="brandon.williams" created="Fri, 18 Jan 2013 17:30:59 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[brandon.williams]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>302504</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            12 years, 39 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i173lz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>249552</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>slebresne</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[slebresne]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12962"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>