<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 22:42:19 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-6603] &quot;hung&quot; repair results in drain hanging</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-6603</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;A &quot;hung&quot; repair (pile of outstanding streams with no visible progress) can result in drain never completing of run.  This is a problem because restarting is a reasonable thing to do with a node that has a hung repair, and drain is a standard part of the restart procedure.  I have had this happen &amp;gt; 20 times.&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt; WARN [RMI TCP Connection(7752)-10.20.6.115] 2014-01-17 12:56:51,162 StorageService.java (line 288) Stopping gossip by operator request
 INFO [RMI TCP Connection(7752)-10.20.6.115] 2014-01-17 12:56:51,162 Gossiper.java (line 1194) Announcing shutdown
 INFO [RMI TCP Connection(7754)-10.20.6.115] 2014-01-17 12:57:09,217 StorageService.java (line 942) DRAINING: starting drain process
 INFO [RMI TCP Connection(7754)-10.20.6.115] 2014-01-17 12:57:09,217 ThriftServer.java (line 116) Stop listening to thrift clients
 INFO [RMI TCP Connection(7754)-10.20.6.115] 2014-01-17 12:57:09,251 Gossiper.java (line 1194) Announcing shutdown
 INFO [RMI TCP Connection(7754)-10.20.6.115] 2014-01-17 12:57:11,252 MessagingService.java (line 694) Waiting for messaging service to quiesce
 INFO [ACCEPT-ldc1e.clearspring.local/10.20.6.115] 2014-01-17 12:57:11,253 MessagingService.java (line 904) MessagingService shutting down server thread.
 ...
wait 10 minutes with nothing happening
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
</description>
                <environment>&lt;p&gt;1.2.12 w/ 1.2.13 patches&lt;/p&gt;</environment>
        <key id="12689535">CASSANDRA-6603</key>
            <summary>&quot;hung&quot; repair results in drain hanging</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10003" iconUrl="https://issues.apache.org/jira/images/icons/priorities/trivial.svg">Low</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="jasobrown">Jason Brown</assignee>
                                    <reporter username="cburroughs">Chris Burroughs</reporter>
                        <labels>
                    </labels>
                <created>Fri, 17 Jan 2014 18:26:27 +0000</created>
                <updated>Tue, 16 Apr 2019 09:31:55 +0000</updated>
                            <resolved>Fri, 17 Jan 2014 23:14:31 +0000</resolved>
                                        <fixVersion>1.2.14</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="13875057" author="cburroughs" created="Fri, 17 Jan 2014 18:28:09 +0000"  >&lt;p&gt;netstats has &amp;gt; 150 streams where visual inspection did not reveal any forward progress&lt;/p&gt;</comment>
                            <comment id="13875073" author="jasobrown" created="Fri, 17 Jan 2014 18:42:50 +0000"  >&lt;p&gt;Well, the good news is that&apos;s not hung - it&apos;s waiting for up to 24 hours for streams to complete :/ . In MS.waitForStreaming (&lt;a href=&quot;https://github.com/apache/cassandra/blob/cassandra-1.2/src/java/org/apache/cassandra/net/MessagingService.java#L675&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/cassandra/blob/cassandra-1.2/src/java/org/apache/cassandra/net/MessagingService.java#L675&lt;/a&gt;) you can see it. &lt;/p&gt;</comment>
                            <comment id="13875080" author="jasobrown" created="Fri, 17 Jan 2014 18:48:15 +0000"  >&lt;p&gt;Note: I didn&apos;t mean my previous comment to sound flippant, but this is the current state of the code in c-1.2. Doing my homework and checking 2.0/trunk now...&lt;/p&gt;</comment>
                            <comment id="13875095" author="jasobrown" created="Fri, 17 Jan 2014 18:56:46 +0000"  >&lt;p&gt;Looks like these lines are removed in c* 2.0 from MS.drain()&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;setMode(Mode.DRAINING, &lt;span class=&quot;code-quote&quot;&gt;&quot;waiting &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; streaming&quot;&lt;/span&gt;, &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;);
MessagingService.instance().waitForStreaming();&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;So, at least in 2.0, I think we won&apos;t block on streaming during drain. &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=yukim&quot; class=&quot;user-hover&quot; rel=&quot;yukim&quot;&gt;yukim&lt;/a&gt; can you comment on this? Thanks&lt;/p&gt;
</comment>
                            <comment id="13875104" author="brandon.williams" created="Fri, 17 Jan 2014 19:01:45 +0000"  >&lt;p&gt;Hmm, I don&apos;t see the &apos;waiting for streaming&apos; line in the description, is that just oversight &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=cburroughs&quot; class=&quot;user-hover&quot; rel=&quot;cburroughs&quot;&gt;cburroughs&lt;/a&gt;?&lt;/p&gt;</comment>
                            <comment id="13875119" author="jasobrown" created="Fri, 17 Jan 2014 19:11:03 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=brandon.williams&quot; class=&quot;user-hover&quot; rel=&quot;brandon.williams&quot;&gt;brandon.williams&lt;/a&gt; The last arg to setMode() is a boolean if we should log at INFO the msg (2nd arg), else if gets logged at DEBUG.&lt;/p&gt;</comment>
                            <comment id="13875125" author="brandon.williams" created="Fri, 17 Jan 2014 19:14:06 +0000"  >&lt;p&gt;Ah, you&apos;re right.  setMode is so whack.&lt;/p&gt;</comment>
                            <comment id="13875157" author="yukim" created="Fri, 17 Jan 2014 19:29:44 +0000"  >&lt;p&gt;waitFoStreaming is removed in 36f54f939caeeb57f4583bb526fe3b9f73296cf6.&lt;/p&gt;</comment>
                            <comment id="13875167" author="brandon.williams" created="Fri, 17 Jan 2014 19:36:48 +0000"  >&lt;p&gt;Any reason why we should wait for it on drain to begin with? Obviously the operator is looking to restart/shutdown when draining.&lt;/p&gt;</comment>
                            <comment id="13875267" author="jasobrown" created="Fri, 17 Jan 2014 21:16:57 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=yukim&quot; class=&quot;user-hover&quot; rel=&quot;yukim&quot;&gt;yukim&lt;/a&gt; was hoping you could explain why it was changed in 2.0 &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="13875283" author="jasobrown" created="Fri, 17 Jan 2014 21:36:34 +0000"  >&lt;p&gt;patch for c* 1.2 attached for skipping the block for streaming during drain. Looks like it&apos;s already gone in 2.0&lt;/p&gt;</comment>
                            <comment id="13875369" author="yukim" created="Fri, 17 Jan 2014 23:01:50 +0000"  >&lt;p&gt;I think it&apos;s ok to remove wait for streaming completely.&lt;/p&gt;

&lt;p&gt;Looks like wait for streaming had been around at least since 0.6, at first for &lt;a href=&quot;https://github.com/apache/cassandra/blob/cassandra-0.6/src/java/org/apache/cassandra/net/MessagingService.java#L341&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;5 sec&lt;/a&gt; and then changed to 24 hours (&lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-3679&quot; title=&quot;clean up multithreaded streaming to use a ConcurrentMap instead of explicit locking&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-3679&quot;&gt;&lt;del&gt;CASSANDRA-3679&lt;/del&gt;&lt;/a&gt;).&lt;/p&gt;

&lt;p&gt;Since 2.0, streaming does not use streaming executor, thus removed.&lt;/p&gt;</comment>
                            <comment id="13875384" author="jasobrown" created="Fri, 17 Jan 2014 23:14:23 +0000"  >&lt;p&gt;committed to 1.2. thanks!&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12623730" name="6603_v1.diff" size="2355" author="jasobrown" created="Fri, 17 Jan 2014 21:36:34 +0000"/>
                            <attachment id="12623698" name="CassandraDaemon.stack" size="314468" author="cburroughs" created="Fri, 17 Jan 2014 18:28:09 +0000"/>
                            <attachment id="12623699" name="CassandraDaemon.stack2" size="314367" author="cburroughs" created="Fri, 17 Jan 2014 18:28:09 +0000"/>
                            <attachment id="12623700" name="drain.stack" size="6033" author="cburroughs" created="Fri, 17 Jan 2014 18:28:09 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>4.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[jasobrown]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>368502</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            11 years, 44 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1rijz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>368806</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>yukim</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[yukim]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12961"><![CDATA[Low]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>