<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 23:12:04 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-14749] Collection Deletions for Dropped Columns in 2.1/3.0 mixed-mode can delete rows</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-14749</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;Similar to &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-14568&quot; title=&quot;Static collection deletions are corrupted in 3.0 -&amp;gt; 2.{1,2} messages&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-14568&quot;&gt;&lt;del&gt;CASSANDRA-14568&lt;/del&gt;&lt;/a&gt;, if a 2.1 node sends a response to a 3.0 node containing a deletion for a dropped collection column, instead of deleting the collection, we will delete the row containing the collection.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;This is an admittedly unlikely cluster state but, during such a state, a great deal of data loss could happen.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13184944">CASSANDRA-14749</key>
            <summary>Collection Deletions for Dropped Columns in 2.1/3.0 mixed-mode can delete rows</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10000" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Urgent</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="benedict">Benedict Elliott Smith</assignee>
                                    <reporter username="benedict">Benedict Elliott Smith</reporter>
                        <labels>
                    </labels>
                <created>Thu, 13 Sep 2018 16:02:07 +0000</created>
                <updated>Fri, 2 Aug 2019 02:48:26 +0000</updated>
                            <resolved>Mon, 17 Sep 2018 13:13:02 +0000</resolved>
                                        <fixVersion>3.0.18</fixVersion>
                                    <component>Messaging/Internode</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="16613722" author="benedict" created="Thu, 13 Sep 2018 16:23:56 +0000"  >&lt;p&gt;&lt;a href=&quot;https://github.com/belliottsmith/cassandra/tree/14749&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;3.0&lt;/a&gt;&#160;&lt;a href=&quot;https://circleci.com/workflow-run/c877e18e-ea8e-45ec-b090-4652445f487d&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;CI&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Since this has already been reviewed in &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-14568&quot; title=&quot;Static collection deletions are corrupted in 3.0 -&amp;gt; 2.{1,2} messages&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-14568&quot;&gt;&lt;del&gt;CASSANDRA-14568&lt;/del&gt;&lt;/a&gt;, if either of you could give a quick cursory +1 to the split, that would be great.  I felt it warranted its own CHANGES.txt entry and JIRA.&lt;/p&gt;</comment>
                            <comment id="16613774" author="iamaleksey" created="Thu, 13 Sep 2018 16:55:09 +0000"  >&lt;p&gt;Should probably pass &lt;tt&gt;isStatic&lt;/tt&gt; to that &lt;tt&gt;CFMetaData.getDroppedColumnDefinition()&lt;/tt&gt; call, or else it just defaults to &lt;tt&gt;false&lt;/tt&gt;. May or may not have effect here, but since you have that flag in hand already, might as well use it. +1 otherwise.&lt;/p&gt;

&lt;p&gt;On a related note, I&apos;m not 100% certain that other calls of &lt;tt&gt;CFMetaData.getDroppedColumnDefinition()&lt;/tt&gt; are oll korrect, it&apos;s something to look into later.&lt;/p&gt;</comment>
                            <comment id="16613795" author="benedict" created="Thu, 13 Sep 2018 17:04:26 +0000"  >&lt;p&gt;&lt;del&gt;Good job I did (split this out) - this time, Aleksey pointed out the &lt;tt&gt;getDroppedColumn&lt;/tt&gt; invokes another method &lt;tt&gt;getDroppedColumn(name, isStatic)&lt;/tt&gt; with a default parameter of &lt;tt&gt;false&lt;/tt&gt; for &lt;tt&gt;isStatic&lt;/tt&gt;&lt;/del&gt;  (That&apos;s what I get for not refreshing the page)&lt;/p&gt;

&lt;p&gt;I&apos;ve pushed an update, but I think the defaulting variant of &lt;tt&gt;getDroppedColumn&lt;/tt&gt; probably shouldn&apos;t exist.&lt;/p&gt;</comment>
                            <comment id="16613865" author="iamaleksey" created="Thu, 13 Sep 2018 18:10:47 +0000"  >&lt;p&gt;LGTM. I&apos;ll file a JIRA to follow-up on the defaulting variant audit and/or removal.&lt;/p&gt;</comment>
                            <comment id="16613870" author="benedict" created="Thu, 13 Sep 2018 18:13:13 +0000"  >&lt;p&gt;&lt;del&gt;FWIW, I&apos;ve been planning to file a ticket to audit the non-use of &lt;tt&gt;getDroppedColumn&lt;/tt&gt; also, off the back of this, and perhaps we should combine the two efforts.  I&apos;m sure most uses of &lt;tt&gt;getColumn&lt;/tt&gt; should have a corresponding use of &lt;tt&gt;getDroppedColumn&lt;/tt&gt; and I&apos;m sure there have been other oversights than this.  We could keep two separate endeavours though.&lt;/del&gt;&lt;/p&gt;

&lt;p&gt;At least in trunk, it seems dropped columns have been considered in all places that we invoke &lt;tt&gt;getColumn&lt;/tt&gt;, besides in test cases&lt;/p&gt;</comment>
                            <comment id="16614642" author="benedict" created="Fri, 14 Sep 2018 10:29:23 +0000"  >&lt;p&gt;Thanks.  Committed as &lt;a href=&quot;https://github.com/apache/cassandra/commit/06c55f779ae68de98cce531e0b78be5716849003&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;06c55f779ae68de98cce531e0b78be5716849003&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="16617331" author="snazy" created="Mon, 17 Sep 2018 10:20:36 +0000"  >&lt;p&gt;Seems that this commit broke the build in cassandra-3.11:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
build-test:
[javac] Compiling 540 source files to /home/automaton/cassandra-src/build/test/classes
[javac] /home/automaton/cassandra-src/test/unit/org/apache/cassandra/db/LegacyLayoutTest.java:279: error: Clustering is &lt;span class=&quot;code-keyword&quot;&gt;abstract&lt;/span&gt;; cannot be instantiated
[javac] builder.newRow(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Clustering(UTF8Serializer.instance.serialize(&lt;span class=&quot;code-quote&quot;&gt;&quot;a&quot;&lt;/span&gt;)));
[javac] ^
[javac] /home/automaton/cassandra-src/test/unit/org/apache/cassandra/db/LegacyLayoutTest.java:280: error: no suitable method found &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; live(CFMetaData,ColumnDefinition,&lt;span class=&quot;code-object&quot;&gt;long&lt;/span&gt;,ByteBuffer,&amp;lt;&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;&amp;gt;)
[javac] builder.addCell(BufferCell.live(table, v, 0L, Int32Serializer.instance.serialize(1), &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;));
[javac] ^
[javac] method BufferCell.live(ColumnDefinition,&lt;span class=&quot;code-object&quot;&gt;long&lt;/span&gt;,ByteBuffer) is not applicable
[javac] (actual and formal argument lists differ in length)
[javac] method BufferCell.live(ColumnDefinition,&lt;span class=&quot;code-object&quot;&gt;long&lt;/span&gt;,ByteBuffer,CellPath) is not applicable
[javac] (actual and formal argument lists differ in length)
[javac] Note: Some input files use or override a deprecated API.
[javac] Note: Recompile with -Xlint:deprecation &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; details.
[javac] Note: Some input files use unchecked or unsafe operations.
[javac] Note: Recompile with -Xlint:unchecked &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; details.
[javac] 2 errors
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="16617364" author="benedict" created="Mon, 17 Sep 2018 10:57:22 +0000"  >&lt;p&gt;Hmm.  Sorry about that.  I ran &lt;tt&gt;ant clean &amp;amp;&amp;amp; ant&lt;/tt&gt; but clearly didn&apos;t look closely at the result.  I&apos;ll ninja a fix in shortly, since it&apos;s only tests affected.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[benedict]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12313825" key="com.atlassian.jira.plugin.system.customfieldtypes:cascadingselect">
                        <customfieldname>Bug Category</customfieldname>
                        <customfieldvalues>
                                                    <customfieldvalue key="12982" cascade-level=""><![CDATA[Correctness]]></customfieldvalue>
                                <customfieldvalue key="12986" cascade-level="1"><![CDATA[Recoverable Corruption / Loss]]></customfieldvalue>
            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12313821" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Complexity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12966"><![CDATA[Challenging]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313822" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Discovered By</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12977"><![CDATA[Adhoc Test]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 9 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3y2cv:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[aleksey]]></customfieldvalue>
        <customfieldvalue><![CDATA[slebresne]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12963"><![CDATA[Critical]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12311420" key="com.atlassian.jira.plugin.system.customfieldtypes:version">
                        <customfieldname>Since Version</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="12333891">3.0.0</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>