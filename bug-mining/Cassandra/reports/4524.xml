<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 23:05:27 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-12296] Better error message when streaming with insufficient sources in DC</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-12296</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;This came up in discussion of &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-11687&quot; title=&quot;dtest failure in rebuild_test.TestRebuild.simple_rebuild_test&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-11687&quot;&gt;&lt;del&gt;CASSANDRA-11687&lt;/del&gt;&lt;/a&gt;. &lt;tt&gt;nodetool rebuild&lt;/tt&gt; was failing in a dtest. &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=pauloricardomg&quot; class=&quot;user-hover&quot; rel=&quot;pauloricardomg&quot;&gt;pauloricardomg&lt;/a&gt; explained:&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;before &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-11848&quot; title=&quot;replace address can &amp;quot;succeed&amp;quot; without actually streaming anything&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-11848&quot;&gt;&lt;del&gt;CASSANDRA-11848&lt;/del&gt;&lt;/a&gt; the local node could be considered a source, while now sources are restricted only to dc2, so since &lt;tt&gt;system_auth&lt;/tt&gt; uses &lt;tt&gt;SimpleStrategy&lt;/tt&gt; depending on the token arrangement there could or not be sources from dc2. Fix is to either use &lt;tt&gt;-Dcassandra.consistent.rangemovement=false&lt;/tt&gt; or update &lt;tt&gt;system_auth&lt;/tt&gt; to use &lt;tt&gt;NetworkTopologyStrategy&lt;/tt&gt; with 2 dcs..&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;This is, at the very least, a UX bug. When &lt;tt&gt;rebuild&lt;/tt&gt; fails, it fails with&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;nodetool: Unable to find sufficient sources &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; streaming range (-3287869951390391138,-1624006824486474209] in keyspace system_auth with RF=1.If you want to ignore &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;, consider using system property -Dcassandra.consistent.rangemovement=&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;.
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;which suggests that a user should give up consistency guarantees when it&apos;s not necessary.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12992589">CASSANDRA-12296</key>
            <summary>Better error message when streaming with insufficient sources in DC</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10003" iconUrl="https://issues.apache.org/jira/images/icons/priorities/trivial.svg">Low</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="KurtG">Kurt Greaves</assignee>
                                    <reporter username="mambocab">Jim Witschey</reporter>
                        <labels>
                            <label>lhf</label>
                    </labels>
                <created>Tue, 26 Jul 2016 14:14:35 +0000</created>
                <updated>Tue, 16 Apr 2019 09:30:25 +0000</updated>
                            <resolved>Mon, 7 Nov 2016 04:29:57 +0000</resolved>
                                        <fixVersion>3.0.10</fixVersion>
                    <fixVersion>3.10</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="15394150" author="pauloricardomg" created="Tue, 26 Jul 2016 17:34:01 +0000"  >&lt;p&gt;I wonder if this is really a bug, given that we recommend users to switch their keyspaces to use &lt;tt&gt;NetworkTopologyStrategy&lt;/tt&gt; &lt;a href=&quot;https://docs.datastax.com/en/cassandra/2.0/cassandra/operations/ops_add_dc_to_cluster_t.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;before performing a rebuild&lt;/a&gt;:&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;Ensure that you are using NetworkTopologyStrategy for all of your keyspaces.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;But perhaps we can indeed update the message to make this more clear.&lt;/p&gt;</comment>
                            <comment id="15394169" author="mambocab" created="Tue, 26 Jul 2016 17:40:26 +0000"  >&lt;blockquote&gt;&lt;p&gt;perhaps we can indeed update the message to make this more clear.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Yeah, that&apos;s why I say it might just be a UX bug.&lt;/p&gt;

&lt;p&gt;Telling users to use NTS for all &lt;em&gt;their&lt;/em&gt; keyspaces doesn&apos;t necessarily imply doing so for &lt;em&gt;system&lt;/em&gt; keyspaces. I&apos;d expect those to just work, and as a user I might not think of them as &quot;mine&quot;.&lt;/p&gt;

&lt;p&gt;Why does &lt;tt&gt;system_auth&lt;/tt&gt; use &lt;tt&gt;SimpleStrategy&lt;/tt&gt; in the first place?&lt;/p&gt;</comment>
                            <comment id="15567253" author="kurtg" created="Wed, 12 Oct 2016 01:53:56 +0000"  >&lt;p&gt;Attached a patch that just changes the message, removing the suggestion to use consistent.rangemovement=false and instead suggesting to use NetworkTopologyStrategy.&lt;/p&gt;

&lt;p&gt;Patch is against 3.0 as this isn&apos;t a critical bugfix, however looks like it would be very similar for 2.2/2.1&lt;/p&gt;</comment>
                            <comment id="15567411" author="jjirsa" created="Wed, 12 Oct 2016 03:20:11 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=KurtG&quot; class=&quot;user-hover&quot; rel=&quot;KurtG&quot;&gt;KurtG&lt;/a&gt; - If you&apos;re running NTS with only one replica, the patch will advise you to consider &lt;tt&gt;NetworkTopologyStrategy&lt;/tt&gt;. Further, &lt;tt&gt;SimpleStrategy&lt;/tt&gt; with a higher RF would also be adequate to find a second replica for streaming - the datastax docs recommending &lt;tt&gt;NetworkTopologyStrategy&lt;/tt&gt; before &lt;tt&gt;nodetool rebuild&lt;/tt&gt; are specifically referencing adding a new DC. The error message above is not limited to ONLY adding a new DC, and could be hit in a number of other ways, where the recommendation to switch to NTS isn&apos;t necessary.&lt;/p&gt;

&lt;p&gt;I agree the message is difficult to understand now, but &quot;please switch to NTS&quot; isn&apos;t the right fix here, either.&lt;/p&gt;

</comment>
                            <comment id="15567449" author="brandon.williams" created="Wed, 12 Oct 2016 03:44:09 +0000"  >&lt;p&gt;Let&apos;s decide what is, then, since we tagged this lhf.&lt;/p&gt;</comment>
                            <comment id="15567560" author="kurtg" created="Wed, 12 Oct 2016 04:39:39 +0000"  >&lt;p&gt;Yep, I didn&apos;t expect it to be correct. Just needed a starting point to get someone talking about it.&lt;/p&gt;

&lt;p&gt;Also:&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;If you&apos;re running NTS with only one replica, the patch will advise you to consider NetworkTopologyStrategy&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;is not true, at least from my testing with rebuilds. This is because the replica will always be in the specified DC, whereas with SimpleStrategy the replica could potentially reside either in the current DC or another DC. When else would this error message be triggered? I couldn&apos;t force this error message to occur with repair, but maybe I&apos;m missing something.&lt;/p&gt;

&lt;p&gt;I can&apos;t see how SimpleStrategy would work if you take into account multiple datacentres. If a user has 3 datacentres then an RF of 2 wouldn&apos;t be adequate. It seems like there would be too many cases to cover to make a concise recommendation to people.&lt;/p&gt;</comment>
                            <comment id="15567769" author="jjirsa" created="Wed, 12 Oct 2016 06:25:12 +0000"  >&lt;blockquote&gt;
&lt;p&gt;is not true, at least from my testing with rebuilds... I couldn&apos;t force this error message to occur with repair, but maybe I&apos;m missing something.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;It can&apos;t hit with repair because that code block requires &lt;tt&gt;strat.getReplicationFactor() == 1&lt;/tt&gt; - in that case, there would be nothing to repair.&lt;/p&gt;

&lt;p&gt;The case I was imagining was bootstrap related, which has a similar error message, but is actually in &lt;tt&gt;getAllRangesWithStrictSourcesFor&lt;/tt&gt; rather than &lt;tt&gt;getRangeFetchMap&lt;/tt&gt; - so I withdraw my comment, and insert foot firmly into mouth - I can&apos;t see any way to trigger this with NTS, so perhaps &quot;switch to NTS&quot; is the right fix. &lt;/p&gt;</comment>
                            <comment id="15570067" author="kurtg" created="Wed, 12 Oct 2016 22:28:03 +0000"  >&lt;p&gt;Don&apos;t insert your foot there too soon. Bootstrap is fine however you still get an incorrect error message if you try and rebuild from the same DC using NTS from a DC that doesn&apos;t contain the keyspace. When I was testing this case apparently the error got masked by another keyspace which makes me think there may be another bug here (I will investigate and write up another JIRA if I manage to figure it out) i.e:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt; keyspace_name      | durable_writes | replication
--------------------+----------------+-------------------------------------------------------------------------------------
               test |           True |       {&lt;span class=&quot;code-quote&quot;&gt;&apos;class&apos;&lt;/span&gt;: &lt;span class=&quot;code-quote&quot;&gt;&apos;org.apache.cassandra.locator.NetworkTopologyStrategy&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;dc1&apos;&lt;/span&gt;: &lt;span class=&quot;code-quote&quot;&gt;&apos;1&apos;&lt;/span&gt;}

ccm node2 nodetool rebuild test dc2
 nodetool: Unable to find sufficient sources &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; streaming range (-1977532406384460074,-1976661853362798275] in keyspace test with RF=1. Consider using NetworkTopologyStrategy &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; keyspace.
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;In this case, node2 is in dc1, and although test isn&apos;t replicated to dc2 it still gets to that error message.&lt;/p&gt;

&lt;p&gt;I suppose alternatives could be:&lt;br/&gt;
1. Make the error more generic (e.g: &apos;Ensure this keyspace has replicas in the source datacentre&apos;)&lt;br/&gt;
2. Catch this case separately and warn that you can&apos;t rebuild from a DC that has no replicas.&lt;/p&gt;

&lt;p&gt;Something more generic is probably OK and with a bit of thought the user should come to a conclusion on how to deal with the issue like increase RF or change to NTS - As long as we can be sure this only occurs from rebuilds. I can&apos;t see any path that leads to here from anywhere other than a rebuild however I haven&apos;t completely ruled out bootstrap yet.&lt;/p&gt;

&lt;p&gt;What do you think &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jjirsa&quot; class=&quot;user-hover&quot; rel=&quot;jjirsa&quot;&gt;jjirsa&lt;/a&gt;?&lt;/p&gt;</comment>
                            <comment id="15570877" author="jjirsa" created="Thu, 13 Oct 2016 05:15:54 +0000"  >&lt;blockquote&gt;
&lt;p&gt;you still get an incorrect error message if you try and rebuild from the same DC using NTS from a DC that doesn&apos;t contain the keyspace. When I was testing this case apparently the error got masked by another keyspace which makes me think there may be another bug here &lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Glad you found a way to trigger it with NTS (good work there). Would personally vote for a more generic error rather than multiple different error messages for each possible failure situation. &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=brandon.williams&quot; class=&quot;user-hover&quot; rel=&quot;brandon.williams&quot;&gt;brandon.williams&lt;/a&gt; - you deal with a lot of end users, are you good with what he proposed ( &lt;tt&gt;Ensure this keyspace has replicas in the source datacentre&lt;/tt&gt; )? &lt;/p&gt;</comment>
                            <comment id="15633373" author="brandon.williams" created="Thu, 3 Nov 2016 16:36:47 +0000"  >&lt;p&gt;Aside from bikeshedding the spelling of datacenter, yes, that looks good to me. &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="15634780" author="kurtg" created="Fri, 4 Nov 2016 00:34:03 +0000"  >&lt;p&gt;Attached patch with updated wording. Oh and I kept the real english spelling &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;.&lt;/p&gt;</comment>
                            <comment id="15643070" author="jjirsa" created="Mon, 7 Nov 2016 04:29:58 +0000"  >&lt;p&gt;Committed in &lt;tt&gt;c3f24ef3795a8823e63d63a473e5f68b22f134bb&lt;/tt&gt;, thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=KurtG&quot; class=&quot;user-hover&quot; rel=&quot;KurtG&quot;&gt;KurtG&lt;/a&gt;!&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12837005" name="12296-3.0.patch" size="2255" author="KurtG" created="Fri, 4 Nov 2016 00:34:03 +0000"/>
                            <attachment id="12832810" name="12296.patch" size="1326" author="KurtG" created="Wed, 12 Oct 2016 01:53:56 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[KurtG]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 2 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i31ih3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>jjirsa</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[jjirsa]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12961"><![CDATA[Low]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>