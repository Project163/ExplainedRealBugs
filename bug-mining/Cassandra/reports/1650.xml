<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 22:33:28 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-4307] isMarkedForDelete can return false if it is a few seconds in the future</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-4307</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;The patch in &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-3716&quot; title=&quot;Clean up isMarkedForDelete / getLocalDeletionTime&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-3716&quot;&gt;&lt;del&gt;CASSANDRA-3716&lt;/del&gt;&lt;/a&gt; causes some weird issues to arrise when server times don&apos;t exactly match up (and since the resolution is seconds, it is easy to be off by just enough to see it).&lt;/p&gt;

&lt;p&gt;I am seeing a case where during schema propagation .isMarkedForDelete() is checked, but the timestamp is a few seconds in the future because the schema was sent from a different node. The code then happily tries to interpret the value of the column as a String, but it is actually the Int encoded deletion time.&lt;/p&gt;

&lt;p&gt;Here is an example in the code that does this check and will do the wrong thing if the deletion timestamp is even just a few seconds in the future: &lt;a href=&quot;https://github.com/apache/cassandra/blob/47f0cc5d38d272ec9f7d6179eb3ffa28c6f74107/src/java/org/apache/cassandra/cql3/statements/SelectStatement.java#L607-609&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/cassandra/blob/47f0cc5d38d272ec9f7d6179eb3ffa28c6f74107/src/java/org/apache/cassandra/cql3/statements/SelectStatement.java#L607-609&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To prove that this is a problem, here is a stack trace of a machine trying to interpret the &quot;localDeletionTime&quot; value of a DeletedColumn as UTF-8 because the .isMarkedForDeletion() check failed:&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://gist.github.com/deb064d4377d206368d3&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gist.github.com/deb064d4377d206368d3&lt;/a&gt;&lt;/p&gt;</description>
                <environment></environment>
        <key id="12559327">CASSANDRA-4307</key>
            <summary>isMarkedForDelete can return false if it is a few seconds in the future</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10002" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Normal</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="slebresne">Sylvain Lebresne</assignee>
                                    <reporter username="wadey">Wade Simmons</reporter>
                        <labels>
                    </labels>
                <created>Tue, 5 Jun 2012 06:09:19 +0000</created>
                <updated>Tue, 16 Apr 2019 09:32:33 +0000</updated>
                            <resolved>Wed, 6 Jun 2012 08:06:42 +0000</resolved>
                                        <fixVersion>1.1.2</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="13289447" author="slebresne" created="Tue, 5 Jun 2012 14:20:12 +0000"  >&lt;p&gt;I believer you&apos;re right, good catch!&lt;br/&gt;
Attaching patch to re-add the overwrite of isMarkedForDelete in DeletedColumn. We shouldn&apos;t have removed it since DeletedColumn should never ever be interpreted as live columns, even with lack of node synchronization (it&apos;s ok for expiring columns though).&lt;/p&gt;</comment>
                            <comment id="13289494" author="jbellis" created="Tue, 5 Jun 2012 15:49:45 +0000"  >&lt;p&gt;+1&lt;/p&gt;</comment>
                            <comment id="13289570" author="wadey" created="Tue, 5 Jun 2012 17:40:35 +0000"  >&lt;p&gt;Test case to ensure no future regressions. Fails if 4307 patch is not applied.&lt;/p&gt;</comment>
                            <comment id="13290005" author="slebresne" created="Wed, 6 Jun 2012 08:06:42 +0000"  >&lt;p&gt;Committed. I included the unit test, thanks Wade.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12530986" name="4307-test.txt" size="2448" author="wadey" created="Tue, 5 Jun 2012 17:40:35 +0000"/>
                            <attachment id="12530959" name="4307.txt" size="997" author="slebresne" created="Tue, 5 Jun 2012 14:20:12 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[slebresne]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>256047</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            13 years, 24 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0guev:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>96357</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>jbellis</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[jbellis]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12962"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>