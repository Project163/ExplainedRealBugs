<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 23:05:14 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-11803] Creating a materialized view on a table with &quot;token&quot; column breaks the cluster</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-11803</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;On a new Cassandra cluster, if we create a table with a field called &quot;token&quot; (with quotes) and then create a materialized view that uses &quot;token&quot;, the cluster breaks. A ServerError is returned, and no further nodetool operations on the sstables work. Restarting the Cassandra server will also fail. It seems like the entire cluster is hosed.&lt;/p&gt;

&lt;p&gt;We tried this on Cassandra 3.3 and 3.5. &lt;/p&gt;

&lt;p&gt;Here&apos;s how to produce (on an new, empty cassandra 3.5 docker container):&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;[cqlsh 5.0.1 | Cassandra 3.5 | CQL spec 3.4.0 | Native protocol v4]
Use HELP &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; help.
cqlsh&amp;gt; CREATE KEYSPACE account WITH REPLICATION = { &lt;span class=&quot;code-quote&quot;&gt;&apos;class&apos;&lt;/span&gt; : &lt;span class=&quot;code-quote&quot;&gt;&apos;SimpleStrategy&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;replication_factor&apos;&lt;/span&gt; : 1 };
cqlsh&amp;gt; CREATE TABLE account.session  (
   ...   &lt;span class=&quot;code-quote&quot;&gt;&quot;token&quot;&lt;/span&gt; blob,
   ...   account_id uuid,
   ...   PRIMARY KEY(&lt;span class=&quot;code-quote&quot;&gt;&quot;token&quot;&lt;/span&gt;)
   ... )WITH compaction={&lt;span class=&quot;code-quote&quot;&gt;&apos;class&apos;&lt;/span&gt;: &lt;span class=&quot;code-quote&quot;&gt;&apos;LeveledCompactionStrategy&apos;&lt;/span&gt;} AND
   ...   compression={&lt;span class=&quot;code-quote&quot;&gt;&apos;sstable_compression&apos;&lt;/span&gt;: &lt;span class=&quot;code-quote&quot;&gt;&apos;LZ4Compressor&apos;&lt;/span&gt;};
cqlsh&amp;gt; CREATE MATERIALIZED VIEW account.account_session AS
   ...        SELECT account_id,&lt;span class=&quot;code-quote&quot;&gt;&quot;token&quot;&lt;/span&gt; FROM account.session
   ...        WHERE &lt;span class=&quot;code-quote&quot;&gt;&quot;token&quot;&lt;/span&gt; IS NOT NULL and account_id IS NOT NULL
   ...        PRIMARY KEY (account_id, &lt;span class=&quot;code-quote&quot;&gt;&quot;token&quot;&lt;/span&gt;);
ServerError: &amp;lt;ErrorMessage code=0000 [Server error] message=&lt;span class=&quot;code-quote&quot;&gt;&quot;java.lang.RuntimeException: java.util.concurrent.ExecutionException: org.apache.cassandra.exceptions.SyntaxException: line 1:25 no viable alternative at input &lt;span class=&quot;code-quote&quot;&gt;&apos;FROM&apos;&lt;/span&gt; (SELECT account_id, token [FROM]...)&quot;&lt;/span&gt;&amp;gt;
cqlsh&amp;gt; drop table account.session;
ServerError: &amp;lt;ErrorMessage code=0000 [Server error] message=&lt;span class=&quot;code-quote&quot;&gt;&quot;java.lang.RuntimeException: java.util.concurrent.ExecutionException: org.apache.cassandra.exceptions.SyntaxException: line 1:25 no viable alternative at input &lt;span class=&quot;code-quote&quot;&gt;&apos;FROM&apos;&lt;/span&gt; (SELECT account_id, token [FROM]...)&quot;&lt;/span&gt;&amp;gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;When any sstable*, nodetool, or when the Cassandra process is restarted, this is emitted on startup and Cassandra exits (copied from a server w/ data):&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;INFO  [main] 2016-05-12 23:25:30,074 ColumnFamilyStore.java:395 - Initializing system_schema.indexes
DEBUG [SSTableBatchOpen:1] 2016-05-12 23:25:30,075 SSTableReader.java:480 - Opening /mnt/cassandra/data/system_schema/indexes-0feb57ac311f382fba6d9024d305702f/ma-4-big (91 bytes)
ERROR [main] 2016-05-12 23:25:30,143 CassandraDaemon.java:697 - Exception encountered during startup
org.apache.cassandra.exceptions.SyntaxException: line 1:59 no viable alternative at input &lt;span class=&quot;code-quote&quot;&gt;&apos;FROM&apos;&lt;/span&gt; (..., expire_at, last_used, token [FROM]...)
        at org.apache.cassandra.cql3.ErrorCollector.throwFirstSyntaxError(ErrorCollector.java:101) ~[apache-cassandra-3.5.0.jar:3.5.0]
        at org.apache.cassandra.cql3.CQLFragmentParser.parseAnyUnhandled(CQLFragmentParser.java:80) ~[apache-cassandra-3.5.0.jar:3.5.0]
        at org.apache.cassandra.cql3.QueryProcessor.parseStatement(QueryProcessor.java:512) ~[apache-cassandra-3.5.0.jar:3.5.0]
        at org.apache.cassandra.schema.SchemaKeyspace.fetchView(SchemaKeyspace.java:1128) ~[apache-cassandra-3.5.0.jar:3.5.0]
        at org.apache.cassandra.schema.SchemaKeyspace.fetchViews(SchemaKeyspace.java:1092) ~[apache-cassandra-3.5.0.jar:3.5.0]
        at org.apache.cassandra.schema.SchemaKeyspace.fetchKeyspace(SchemaKeyspace.java:903) ~[apache-cassandra-3.5.0.jar:3.5.0]
        at org.apache.cassandra.schema.SchemaKeyspace.fetchKeyspacesWithout(SchemaKeyspace.java:879) ~[apache-cassandra-3.5.0.jar:3.5.0]
        at org.apache.cassandra.schema.SchemaKeyspace.fetchNonSystemKeyspaces(SchemaKeyspace.java:867) ~[apache-cassandra-3.5.0.jar:3.5.0]
        at org.apache.cassandra.config.Schema.loadFromDisk(Schema.java:134) ~[apache-cassandra-3.5.0.jar:3.5.0]
        at org.apache.cassandra.config.Schema.loadFromDisk(Schema.java:124) ~[apache-cassandra-3.5.0.jar:3.5.0]
        at org.apache.cassandra.service.CassandraDaemon.setup(CassandraDaemon.java:229) [apache-cassandra-3.5.0.jar:3.5.0]
        at org.apache.cassandra.service.CassandraDaemon.activate(CassandraDaemon.java:551) [apache-cassandra-3.5.0.jar:3.5.0]
        at org.apache.cassandra.service.CassandraDaemon.main(CassandraDaemon.java:680) [apache-cassandra-3.5.0.jar:3.5.0]
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment>&lt;p&gt;Kernel:&lt;br/&gt;
Linux 4.4.8-20.46.amzn1.x86_64&lt;/p&gt;

&lt;p&gt;Java:&lt;br/&gt;
Java OpenJDK Runtime Environment (build 1.8.0_91-b14)&lt;br/&gt;
OpenJDK 64-Bit Server VM (build 25.91-b14, mixed mode)&lt;/p&gt;

&lt;p&gt;Cassandra: &lt;br/&gt;
datastax-ddc-3.3.0-1.noarch&lt;br/&gt;
datastax-ddc-tools-3.3.0-1.noarch&lt;/p&gt;</environment>
        <key id="12969605">CASSANDRA-11803</key>
            <summary>Creating a materialized view on a table with &quot;token&quot; column breaks the cluster</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10000" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Urgent</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="carlyeks">Carl Yeksigian</assignee>
                                    <reporter username="victortrac">Victor Trac</reporter>
                        <labels>
                    </labels>
                <created>Fri, 13 May 2016 19:13:59 +0000</created>
                <updated>Wed, 15 Oct 2025 09:48:57 +0000</updated>
                            <resolved>Wed, 19 Oct 2016 15:14:12 +0000</resolved>
                                        <fixVersion>3.0.10</fixVersion>
                    <fixVersion>3.10</fixVersion>
                    <fixVersion>4.0-alpha1</fixVersion>
                    <fixVersion>4.0</fixVersion>
                                    <component>Feature/Materialized Views</component>
                    <component>Legacy/CQL</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>10</watches>
                                                                                                                <comments>
                            <comment id="15284661" author="jmckenzie" created="Mon, 16 May 2016 14:40:54 +0000"  >&lt;p&gt;Given that &apos;token&apos; is a &lt;a href=&quot;https://github.com/apache/cassandra/blob/trunk/src/antlr/Lexer.g#L164&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;reserved keyword&lt;/a&gt;, we could validate on MV creation that we don&apos;t have any of those keywords in use as column names. Maybe in &lt;a href=&quot;https://github.com/apache/cassandra/blob/trunk/src/java/org/apache/cassandra/cql3/statements/CreateViewStatement.java#L114&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;CreateViewStatement.announceMigration&lt;/a&gt;, maybe in &lt;a href=&quot;https://github.com/apache/cassandra/blob/trunk/src/antlr/Parser.g#L714-L732&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;Parser.g createMaterializedViewStatement&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;Alternatively, we could try to preserve the quoting so it doesn&apos;t blow up, but I&apos;m personally of the opinion that it&apos;s best to avoid the rat&apos;s nest of nested escaping of strings. Would perhaps be inconsistent to reject on MV but not on base table however.&lt;/p&gt;</comment>
                            <comment id="15286576" author="slebresne" created="Tue, 17 May 2016 13:07:13 +0000"  >&lt;blockquote&gt;&lt;p&gt;Alternatively, we could try to preserve the quoting so it doesn&apos;t blow up&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;While I haven&apos;t looked at the details of this particular case, not preserving the quoting probably means things don&apos;t work well with any quoted identifier, which is just not ok. And if we handled quoting properly, there shouldn&apos;t be any particular problem for reserved keyword. I also don&apos;t think quoting identifiers is too complex since we don&apos;t allow escaping character (we even already have the 3 lines function to do so in &lt;tt&gt;ColumnIdentifier&lt;/tt&gt;). And of course, as you said, rejecting this on MV when it&apos;s support on the base table wouldn&apos;t be very user friendly at all. So I very much think properly quoting is &lt;em&gt;the&lt;/em&gt; right way to fix this. &lt;/p&gt;</comment>
                            <comment id="15286644" author="jmckenzie" created="Tue, 17 May 2016 13:47:52 +0000"  >&lt;blockquote&gt;&lt;p&gt;Would perhaps be inconsistent to reject on MV but not on base table however.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;I was less in the market of advocating for a specific solution and more jotting down my observations since I took a minute to poke around this ticket as it caught my eye. I&apos;m +1 on us being consistent and preserving quoting correctly.&lt;/p&gt;

&lt;p&gt;edit:&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;I&apos;m personally of the opinion that it&apos;s best to avoid the rat&apos;s nest of nested escaping of strings.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Correction to my above: I was weakly advocating for a position that&apos;s less flexible for users in pursuit of making things less complex on our implementation side. I concede your point(s), however.&lt;/p&gt;</comment>
                            <comment id="15286883" author="carlyeks" created="Tue, 17 May 2016 15:48:28 +0000"  >&lt;p&gt;For most of where we require quotes, this works properly &amp;#8211; we parse the where clause and then regenerate it using &lt;tt&gt;ColumnIdentifier.maybeQuote&lt;/tt&gt;. This works fine for most of the required quotes (mixed-case columns), but not for our reserved words.&lt;/p&gt;

&lt;p&gt;We don&apos;t have a list of reserved words, instead relying on the parser to reject our reserved words. I&apos;m not sure if we want to preserve the quotes from users, or create a list of reserved words that need to be quoted and use that in &lt;tt&gt;maybeQuote&lt;/tt&gt;. &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=slebresne&quot; class=&quot;user-hover&quot; rel=&quot;slebresne&quot;&gt;slebresne&lt;/a&gt; I&apos;ll defer to your decision on this.&lt;/p&gt;</comment>
                            <comment id="15545796" author="carlyeks" created="Tue, 4 Oct 2016 15:49:08 +0000"  >&lt;p&gt;I&apos;ve posted a branch which adds a list of reserved words and will also quote if it is a reserved word. If this approach looks OK, I&apos;ll add a test for it.&lt;/p&gt;

&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;3.0&lt;/th&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/carlyeks/cassandra/tree/ticket/11803/3.0&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;branch&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;http://cassci.datastax.com/job/carlyeks-ticket-11803-3.0-testall/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;utest&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;http://cassci.datastax.com/job/carlyeks-ticket-11803-3.0-dtest/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;dtest&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;
</comment>
                            <comment id="15554374" author="slebresne" created="Fri, 7 Oct 2016 07:25:57 +0000"  >&lt;blockquote&gt;&lt;p&gt;I&apos;m not sure if we want to preserve the quotes from users, or create a list of reserved word&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I&apos;d go with a list of reserved keywords as you did since that&apos;s likely much easier and theoretically that list should never change anyway (so it shouldn&apos;t be a maintenance pain).&lt;/p&gt;</comment>
                            <comment id="15555121" author="hazel" created="Fri, 7 Oct 2016 13:45:11 +0000"  >&lt;p&gt;Applied the patch to 3.0.9 and looks to work fine. No issues with the protected words in any fields and no stack on node restart&lt;/p&gt;
</comment>
                            <comment id="15564983" author="ifesdjeen" created="Tue, 11 Oct 2016 09:17:25 +0000"  >&lt;p&gt;The patch looks good with 2 small nits:&lt;/p&gt;

&lt;p&gt;It&apos;d be to add some negative tests for preserving quotes when building &lt;tt&gt;SELECT&lt;/tt&gt; statement as you&apos;ve mentioned. &lt;br/&gt;
Also, it looks like &quot;synonym&quot; reserved keywords are missing: &lt;tt&gt;SCHEMA&lt;/tt&gt; and &lt;tt&gt;TABLE&lt;/tt&gt;.&lt;/p&gt;</comment>
                            <comment id="15572655" author="carlyeks" created="Thu, 13 Oct 2016 17:43:57 +0000"  >&lt;p&gt;I just pushed a couple of updates to address your nits, and rebased and pushed up two new branches for 3.x and trunk:&lt;/p&gt;

&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;3.x&lt;/th&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/carlyeks/cassandra/tree/ticket/11803/3.x&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;branch&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/carlyeks/job/carlyeks-ticket-11803-3.x-testall/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;utest&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/carlyeks/job/carlyeks-ticket-11803-3.x-dtest/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;dtest&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;trunk&lt;/th&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/carlyeks/cassandra/tree/ticket/11803/trunk&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;branch&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/carlyeks/job/carlyeks-ticket-11803-trunk-testall/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;utest&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/carlyeks/job/carlyeks-ticket-11803-trunk-dtest/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;dtest&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;
</comment>
                            <comment id="15574693" author="ifesdjeen" created="Fri, 14 Oct 2016 08:52:30 +0000"  >&lt;p&gt;Great, thank you! &lt;/p&gt;

&lt;p&gt;+1&lt;/p&gt;</comment>
                            <comment id="15575511" author="carlyeks" created="Fri, 14 Oct 2016 14:31:31 +0000"  >&lt;p&gt;Thanks for the review &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ifesdjeen&quot; class=&quot;user-hover&quot; rel=&quot;ifesdjeen&quot;&gt;ifesdjeen&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;Committed as &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=cassandra.git;a=commit;h=153583be55e2a0bba74102bf1d5fc7a79d314b1f&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;153583b&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="15581975" author="eduard.tudenhoefner" created="Mon, 17 Oct 2016 11:37:40 +0000"  >&lt;p&gt;Code that would do something like&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;Row row = execute(&lt;span class=&quot;code-quote&quot;&gt;&quot;SELECT count(*) FROM ks&quot;&lt;/span&gt;).one();
row.getLong(row.getColumns().get(0).name.toCQLString());
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;is failing now with a NPE because &lt;b&gt;count&lt;/b&gt; is now quoted&lt;/p&gt;</comment>
                            <comment id="15582462" author="mshuler" created="Mon, 17 Oct 2016 14:51:32 +0000"  >&lt;p&gt;Reopening per comment above.&lt;/p&gt;</comment>
                            <comment id="15582495" author="ifesdjeen" created="Mon, 17 Oct 2016 15:08:00 +0000"  >&lt;p&gt;I&apos;ve checked multiple cases, and was wondering why not use &lt;tt&gt;toString&lt;/tt&gt;, as &lt;tt&gt;toCQLString&lt;/tt&gt;&apos;s purpose is to quote/double-quote identifiers if necessary. &lt;/p&gt;

&lt;p&gt;&lt;tt&gt;toString&lt;/tt&gt; would work for cases such as &lt;tt&gt;select count(&amp;#42;) as &quot;QuotedIdentifierCaseSenitive&quot; from %s&lt;/tt&gt; as well, while &lt;tt&gt;toCQLString&lt;/tt&gt; would break because of quoting. So I&apos;d say &lt;tt&gt;toCQLString&lt;/tt&gt; was not working for all cases already.&lt;/p&gt;</comment>
                            <comment id="15582727" author="carlyeks" created="Mon, 17 Oct 2016 16:49:41 +0000"  >&lt;p&gt;It looks like &lt;tt&gt;COUNT&lt;/tt&gt;, &lt;tt&gt;WRITETIME&lt;/tt&gt;, &lt;tt&gt;TTL&lt;/tt&gt;, and &lt;tt&gt;KEY&lt;/tt&gt;, and the CQL types, should not be in the reserved keyword list: &lt;a href=&quot;https://github.com/apache/cassandra/blob/cassandra-3.0/src/java/org/apache/cassandra/cql3/Cql.g#L1578:L1633&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/cassandra/blob/cassandra-3.0/src/java/org/apache/cassandra/cql3/Cql.g#L1578:L1633&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;I initially just used the &lt;tt&gt;basic_unreserved_keywords&lt;/tt&gt; to determine the keywords, so I&apos;ve removed others which should not have been included: &lt;a href=&quot;https://github.com/carlyeks/cassandra/commit/ee76a10c75cc859ba178a7ec321b98aee2c0939a&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/carlyeks/cassandra/commit/ee76a10c75cc859ba178a7ec321b98aee2c0939a&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15583247" author="ifesdjeen" created="Mon, 17 Oct 2016 19:51:01 +0000"  >&lt;p&gt;Thanks for the quick reaction! &lt;/p&gt;

&lt;p&gt;+1 on changes. As discussed offline, it&apos;d be great to have a test for non-reserved word.&lt;/p&gt;</comment>
                            <comment id="15583332" author="carlyeks" created="Mon, 17 Oct 2016 20:22:39 +0000"  >&lt;p&gt;Thanks for the quick review, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ifesdjeen&quot; class=&quot;user-hover&quot; rel=&quot;ifesdjeen&quot;&gt;ifesdjeen&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;Removed the bad keywords and added a test to ensure all words in the ReservedKeywords list do not parse in &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=cassandra.git;a=commit;h=bc9a0793944f7dd481646c4014d13b844439906c&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;bc9a079&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="15587804" author="stefania" created="Wed, 19 Oct 2016 06:11:39 +0000"  >&lt;p&gt;This broke &lt;a href=&quot;https://cassci.datastax.com/view/cassandra-3.X/job/cassandra-3.X_testall/lastCompletedBuild/testReport/org.apache.cassandra.db/ColumnFamilyStoreCQLHelperTest/testDynamicComposite/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;&lt;tt&gt;ColumnFamilyStoreCQLHelperTest.testDynamicComposite&lt;/tt&gt;&lt;/a&gt;, I think you just need to roll back the changes in &lt;a href=&quot;https://github.com/carlyeks/cassandra/commit/92be6501048ce6d682855ba54740f0d9cd22ab2c#diff-3ce9da4a5e19883b119f0037b27b2d81R652&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;&lt;tt&gt;ColumnFamilyStoreCQLHelperTest&lt;/tt&gt;&lt;/a&gt; since &lt;tt&gt;key&lt;/tt&gt; is not a reserved keyword.&lt;/p&gt;</comment>
                            <comment id="15587845" author="ifesdjeen" created="Wed, 19 Oct 2016 06:38:24 +0000"  >&lt;p&gt;Sorry. Frankly speaking, I did not see the CI results for the fix. &lt;/p&gt;

&lt;p&gt;Below is the patch for both branches and triggered CI:&lt;/p&gt;

&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/ifesdjeen/cassandra/tree/11803-test-fix-trunk&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;trunk&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;http://cassci.datastax.com/job/ifesdjeen-11803-test-fix-trunk-testall/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;dtest&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;http://cassci.datastax.com/job/ifesdjeen-11803-test-fix-trunk-dtest/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;utest&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/ifesdjeen/cassandra/tree/11803-test-fix-3.X&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;3.X&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;http://cassci.datastax.com/job/ifesdjeen-11803-test-fix-3.X-testall/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;dtest&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;http://cassci.datastax.com/job/ifesdjeen-11803-test-fix-3.X-dtest/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;utest&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;
</comment>
                            <comment id="15589020" author="carlyeks" created="Wed, 19 Oct 2016 15:14:13 +0000"  >&lt;p&gt;Thanks, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=Stefania&quot; class=&quot;user-hover&quot; rel=&quot;stefania&quot;&gt;Stefania&lt;/a&gt; and &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ifesdjeen&quot; class=&quot;user-hover&quot; rel=&quot;ifesdjeen&quot;&gt;ifesdjeen&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;Looked good &amp;#8211; committed as &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf/cassandra/repo?p=cassandra.git;a=commit;h=5f2367ef92517ac0bf7b7315de248021da2de4a6&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;5f2367e&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="15590438" author="stefania" created="Thu, 20 Oct 2016 01:24:07 +0000"  >&lt;p&gt;Backported latest fix to 3.0 as &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf/cassandra/repo?p=cassandra.git;a=commit;h=55568c17d6100cedc77747dfe1ad05a40191216b&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;55568c1&lt;/a&gt;.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                                                <inwardlinks description="is duplicated by">
                                        <issuelink>
            <issuekey id="13010108">CASSANDRA-12753</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                            <issuelinktype id="12310050">
                    <name>Regression</name>
                                            <outwardlinks description="breaks">
                                        <issuelink>
            <issuekey id="13013504">CASSANDRA-12810</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[carlyeks]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12313825" key="com.atlassian.jira.plugin.system.customfieldtypes:cascadingselect">
                        <customfieldname>Bug Category</customfieldname>
                        <customfieldvalues>
                                                    <customfieldvalue key="12983" cascade-level=""><![CDATA[Availability]]></customfieldvalue>
                                <customfieldvalue key="12993" cascade-level="1"><![CDATA[Cluster Crash]]></customfieldvalue>
            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 4 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2xy4v:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12311421" key="com.atlassian.jira.plugin.system.customfieldtypes:multiversion">
                        <customfieldname>Reproduced In</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="12333891">3.0.0</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>ifesdjeen</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[ifesdjeen]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12963"><![CDATA[Critical]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12311420" key="com.atlassian.jira.plugin.system.customfieldtypes:version">
                        <customfieldname>Since Version</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="12334609">3.3</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>