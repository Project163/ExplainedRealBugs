<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 22:50:40 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-8623] sstablesplit fails *randomly* with Data component is missing</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-8623</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;I&apos;m experiencing an issue related to sstablesplit. I would like to understand if I am doing something wrong or there is an issue in the split process. The process fails randomly with the following exception:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;ERROR 02:17:36 Error in ThreadPoolExecutor
java.lang.AssertionError: Data component is missing &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; sstable./tools/bin/../../data/data/system/compactions_in_progress-55080ab05d9c388690a4acb25fe1f77b/system-compactions_in_progress-ka-16
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;See attached output.log file. The process never stops after this exception and I&apos;ve also seen the dataset growing indefinitely (number of sstables).  &lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;I have not been able to reproduce the issue with a single sstablesplit command. ie, specifying all files with glob matching.&lt;/li&gt;
	&lt;li&gt;I can reproduce the bug if I call multiple sstablesplit one file at the time (the way ccm does)&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Here is the test case file to reproduce the bug:&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://drive.google.com/file/d/0BwZ_GPM33j6KdVh0NTdkOWV2R1E/view?usp=sharing&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://drive.google.com/file/d/0BwZ_GPM33j6KdVh0NTdkOWV2R1E/view?usp=sharing&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;1. Download the split_issue.tar.gz file. It includes latest cassandra-2.1 branch binaries.&lt;br/&gt;
2. Extract it&lt;br/&gt;
3. CD inside the use case directory&lt;br/&gt;
4. Download the dataset (2G) just to be sure we have the same thing, and place it in the working directory.&lt;br/&gt;
   &lt;a href=&quot;https://docs.google.com/uc?id=0BwZ_GPM33j6KV3ViNnpPcVFndUU&amp;amp;export=download&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://docs.google.com/uc?id=0BwZ_GPM33j6KV3ViNnpPcVFndUU&amp;amp;export=download&lt;/a&gt;&lt;br/&gt;
5. The first time, run ./test.sh. This will setup and run a test.&lt;br/&gt;
6. The next times, you can only run ./test --no-setup . This will only reset the dataset as its initial state and re-run the test. You might have to run the tests some times before experiencing it... but I&apos;m always able with only 2-3 runs.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12767650">CASSANDRA-8623</key>
            <summary>sstablesplit fails *randomly* with Data component is missing</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10002" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Normal</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="marcuse">Marcus Eriksson</assignee>
                                    <reporter username="aboudreault">Alan Boudreault</reporter>
                        <labels>
                            <label>qa-resolved</label>
                    </labels>
                <created>Thu, 15 Jan 2015 03:40:43 +0000</created>
                <updated>Tue, 16 Apr 2019 09:31:23 +0000</updated>
                            <resolved>Thu, 29 Jan 2015 09:27:55 +0000</resolved>
                                        <fixVersion>2.1.3</fixVersion>
                                    <component>Legacy/Tools</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="14284536" author="aboudreault" created="Tue, 20 Jan 2015 22:21:00 +0000"  >&lt;p&gt;I have been able to reproduce the issue using a single sstable and calling multiple sstablesplit. Question: what are the files created in system/compactions_in_progress during the split?&lt;/p&gt;</comment>
                            <comment id="14286409" author="jbellis" created="Wed, 21 Jan 2015 22:19:08 +0000"  >&lt;p&gt;/cc &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=benedict&quot; class=&quot;user-hover&quot; rel=&quot;benedict&quot;&gt;benedict&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14287640" author="benedict" created="Thu, 22 Jan 2015 15:59:41 +0000"  >&lt;p&gt;I&apos;ve had a bit of a look into the code (I&apos;m not familiar with the book keeping), and I think the interesting question here is simply why the data component is missing, and what other components aren&apos;t.&lt;/p&gt;

&lt;p&gt;I suspect, without digging deeply, that normal compactions aren&apos;t disabled (can&apos;t see the disable compactions call), and so compactions_in_progress is itself being compacted. The system.exit(0) call probably interleaves with one of the SSTableDeletingTask calls (we may wait for prior deleting tasks to complete, but this doesn&apos;t prevent another to be queued straight after us from a parallel compaction).&lt;/p&gt;

&lt;p&gt;At  the same time, it looks to me like our whole approach to compactions and leftovers needs to be revisited, and should probably come under the umbrella of &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-8568&quot; title=&quot;Extend Transactional API to sstable lifecycle management&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-8568&quot;&gt;&lt;del&gt;CASSANDRA-8568&lt;/del&gt;&lt;/a&gt;. For instance: do we really need to cleanup compaction leftovers if we leave them all as tmp files until we&apos;re done? Since they&apos;ll be cleaned up on restart either way. It may be the whole system table is unnecessary (except for a slight lack of atomicity at replacement time, but this could be achieved more simply).&lt;/p&gt;</comment>
                            <comment id="14291547" author="krummas" created="Mon, 26 Jan 2015 07:47:01 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=aboudreault&quot; class=&quot;user-hover&quot; rel=&quot;aboudreault&quot;&gt;aboudreault&lt;/a&gt; could you test this patch? I have not been able to reproduce this myself&lt;/p&gt;

&lt;p&gt;Patch just makes sure all compactions are finished before waiting for the deletion tasks&lt;/p&gt;

&lt;p&gt;Same issue could be in offline cleanup and offline scrub&lt;/p&gt;

&lt;p&gt;oh btw, you can make the offline tools log more by changing WARN to DEBUG in conf/logback-tools.xml if it still fails&lt;/p&gt;</comment>
                            <comment id="14292233" author="aboudreault" created="Mon, 26 Jan 2015 19:03:49 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=krummas&quot; class=&quot;user-hover&quot; rel=&quot;krummas&quot;&gt;krummas&lt;/a&gt; Tried the patch. I&apos;m now getting this exception: &lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;ERROR 18:23:48 Error in ThreadPoolExecutor
java.util.concurrent.RejectedExecutionException: ThreadPoolExecutor has shut down
	at org.apache.cassandra.concurrent.DebuggableThreadPoolExecutor$1.rejectedExecution(DebuggableThreadPoolExecutor.java:61) ~[main/:na]
	at java.util.concurrent.ThreadPoolExecutor.reject(ThreadPoolExecutor.java:821) ~[na:1.7.0_72]
	at java.util.concurrent.ThreadPoolExecutor.execute(ThreadPoolExecutor.java:1372) ~[na:1.7.0_72]
	at org.apache.cassandra.concurrent.DebuggableThreadPoolExecutor.execute(DebuggableThreadPoolExecutor.java:150) ~[main/:na]
	at java.util.concurrent.AbstractExecutorService.submit(AbstractExecutorService.java:110) ~[na:1.7.0_72]
	at org.apache.cassandra.db.compaction.CompactionManager.submitBackground(CompactionManager.java:183) ~[main/:na]
	at org.apache.cassandra.db.compaction.CompactionManager$BackgroundCompactionTask.run(CompactionManager.java:239) ~[main/:na]
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:471) ~[na:1.7.0_72]
	at java.util.concurrent.FutureTask.run(FutureTask.java:262) ~[na:1.7.0_72]
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1145) ~[na:1.7.0_72]
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:615) [na:1.7.0_72]
	at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:745) [na:1.7.0_72]
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;See output2.log for more information.&lt;/p&gt;</comment>
                            <comment id="14293499" author="krummas" created="Tue, 27 Jan 2015 13:30:06 +0000"  >&lt;p&gt;new patch that avoids submitting tasks if the executor is shut down&lt;/p&gt;</comment>
                            <comment id="14295387" author="aboudreault" created="Wed, 28 Jan 2015 16:54:00 +0000"  >&lt;p&gt;Tested multiple runs of my test and it looks like we are good with that v2 patch! I couldn&apos;t get any exception and all my splits finished successfully. Thanks Markus!&lt;/p&gt;</comment>
                            <comment id="14296015" author="yukim" created="Wed, 28 Jan 2015 23:02:27 +0000"  >&lt;p&gt;+1&lt;/p&gt;</comment>
                            <comment id="14296634" author="krummas" created="Thu, 29 Jan 2015 09:27:55 +0000"  >&lt;p&gt;committed, thanks&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12694495" name="0001-make-sure-we-finish-compactions-before-waiting-for-d.patch" size="5877" author="marcuse" created="Mon, 26 Jan 2015 07:47:01 +0000"/>
                            <attachment id="12694777" name="8623-v2.patch" size="9471" author="marcuse" created="Tue, 27 Jan 2015 13:30:06 +0000"/>
                            <attachment id="12692436" name="output.log" size="3843" author="aboudreault" created="Thu, 15 Jan 2015 03:40:43 +0000"/>
                            <attachment id="12694595" name="output2.log" size="1407870" author="aboudreault" created="Mon, 26 Jan 2015 19:03:48 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>4.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[marcuse]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 42 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i24eb3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12311421" key="com.atlassian.jira.plugin.system.customfieldtypes:multiversion">
                        <customfieldname>Reproduced In</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="12328841">2.1.2</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>yukim</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[yukim]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12962"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311124" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Tester</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>aboudreault</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>