<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 22:18:52 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-2073] Streaming occasionally makes gossip back up</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-2073</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;Streaming occasionally makes gossip back up, causing nodes to mark each other as down even though the network is ok.  This appears to happen just after streaming has finished.  I noticed this in the course of working on &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-2072&quot; title=&quot;Race condition during decommission&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-2072&quot;&gt;&lt;del&gt;CASSANDRA-2072&lt;/del&gt;&lt;/a&gt;, so decommission is one way to reproduce.  It seems to happen maybe one of fifteen or twenty tries, so it&apos;s fairly rare.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12497092">CASSANDRA-2073</key>
            <summary>Streaming occasionally makes gossip back up</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10003" iconUrl="https://issues.apache.org/jira/images/icons/priorities/trivial.svg">Low</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="jbellis">Jonathan Ellis</assignee>
                                    <reporter username="brandon.williams">Brandon Williams</reporter>
                        <labels>
                    </labels>
                <created>Fri, 28 Jan 2011 20:47:18 +0000</created>
                <updated>Tue, 16 Apr 2019 09:33:08 +0000</updated>
                            <resolved>Mon, 31 Jan 2011 19:04:16 +0000</resolved>
                                        <fixVersion>0.7.1</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                    <workratio workratioPercent="0"/>
                                    <progress percentage="0">
                                    <originalProgress>
                                                    <row percentage="100" backgroundColor="#89afd7"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="0" backgroundColor="#51a825"/>
                                                    <row percentage="100" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="0">
                                    <originalProgress>
                                                    <row percentage="100" backgroundColor="#89afd7"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="0" backgroundColor="#51a825"/>
                                                    <row percentage="100" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                    <timeoriginalestimate seconds="7200">2h</timeoriginalestimate>
                            <timeestimate seconds="7200">2h</timeestimate>
                                        <comments>
                            <comment id="12988240" author="gdusbabek" created="Fri, 28 Jan 2011 21:21:47 +0000"  >&lt;p&gt;I see this regularly during repair operations.&lt;/p&gt;</comment>
                            <comment id="12988242" author="brandon.williams" created="Fri, 28 Jan 2011 21:24:08 +0000"  >&lt;p&gt;I&apos;m fairly certain this is the true cause of &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-1730&quot; title=&quot;Fat clients are never removed&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-1730&quot;&gt;&lt;del&gt;CASSANDRA-1730&lt;/del&gt;&lt;/a&gt; and other &quot;gossip took longer than RING_DELAY&quot; bugs we&apos;ve had.&lt;/p&gt;</comment>
                            <comment id="12988244" author="jbellis" created="Fri, 28 Jan 2011 21:28:39 +0000"  >&lt;blockquote&gt;&lt;p&gt;Streaming occasionally makes gossip back up&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;On the StreamOut &lt;span class=&quot;error&quot;&gt;&amp;#91;source&amp;#93;&lt;/span&gt; side, the StreamIn &lt;span class=&quot;error&quot;&gt;&amp;#91;receiver&amp;#93;&lt;/span&gt; side, or both?&lt;/p&gt;</comment>
                            <comment id="12988248" author="brandon.williams" created="Fri, 28 Jan 2011 21:40:38 +0000"  >&lt;p&gt;Appears to be the receiver.  I just repro&apos;d it with decom.  Nodes A, B, and C.  Decom B, streams to A and C complete, and afterwards A and C cannot gossip to each other for approximately 40s or so.  B did get the usual exception:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;ERROR [Thread-6] 2011-01-28 21:23:08,720 AbstractCassandraDaemon.java (line 119) Fatal exception in thread Thread[Thread-6,5,main]
java.util.concurrent.RejectedExecutionException: ThreadPoolExecutor has shut down
        at org.apache.cassandra.concurrent.DebuggableThreadPoolExecutor$1.rejectedExecution(DebuggableThreadPoolExecutor.java:62)
        at java.util.concurrent.ThreadPoolExecutor.reject(ThreadPoolExecutor.java:767)
        at java.util.concurrent.ThreadPoolExecutor.execute(ThreadPoolExecutor.java:658)
        at org.apache.cassandra.net.MessagingService.receive(MessagingService.java:387)
        at org.apache.cassandra.net.IncomingTcpConnection.run(IncomingTcpConnection.java:91)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;(I had &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-2072&quot; title=&quot;Race condition during decommission&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-2072&quot;&gt;&lt;del&gt;CASSANDRA-2072&lt;/del&gt;&lt;/a&gt; applied to avoid other problems) and I don&apos;t see any message about streaming completing on it, though A and C show StreamInSessions finishing right before the gossip outage.&lt;/p&gt;</comment>
                            <comment id="12988250" author="brandon.williams" created="Fri, 28 Jan 2011 21:41:53 +0000"  >&lt;p&gt;tpstats on both nodes showed one active gossip task and a bunch pending.&lt;/p&gt;</comment>
                            <comment id="12988257" author="jbellis" created="Fri, 28 Jan 2011 21:51:31 +0000"  >&lt;p&gt;i wonder if we have a Thread.sleep(RING_DELAY) in code that gets called on the gossip path.&lt;/p&gt;

&lt;p&gt;jstack during the pause?&lt;/p&gt;</comment>
                            <comment id="12988272" author="brandon.williams" created="Fri, 28 Jan 2011 22:09:49 +0000"  >&lt;p&gt;It looks like in my case, both nodes are stuck in the same spot:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;
&quot;GossipStage:1&quot; prio=10 tid=0x0000000041644000 nid=0xece waiting on condition [0x00007fdbe861f000]
   java.lang.Thread.State: WAITING (parking)
    at sun.misc.Unsafe.park(Native Method)
    - parking to wait for  &amp;lt;0x00007fdc5ecf8828&amp;gt; (a java.util.concurrent.FutureTask$Sync)
    at java.util.concurrent.locks.LockSupport.park(LockSupport.java:158)
    at java.util.concurrent.locks.AbstractQueuedSynchronizer.parkAndCheckInterrupt(AbstractQueuedSynchronizer.java:811)
    at java.util.concurrent.locks.AbstractQueuedSynchronizer.doAcquireSharedInterruptibly(AbstractQueuedSynchronizer.java:969)
    at java.util.concurrent.locks.AbstractQueuedSynchronizer.acquireSharedInterruptibly(AbstractQueuedSynchronizer.java:1281)
    at java.util.concurrent.FutureTask$Sync.innerGet(FutureTask.java:218)
    at java.util.concurrent.FutureTask.get(FutureTask.java:83)
    at org.apache.cassandra.db.HintedHandOffManager.deleteHintsForEndPoint(HintedHandOffManager.java:156)
    at org.apache.cassandra.service.StorageService.excise(StorageService.java:831)
    at org.apache.cassandra.service.StorageService.handleStateLeft(StorageService.java:787)
    at org.apache.cassandra.service.StorageService.onChange(StorageService.java:645)
    at org.apache.cassandra.gms.Gossiper.doNotifications(Gossiper.java:742)
    at org.apache.cassandra.gms.Gossiper.applyApplicationStateLocally(Gossiper.java:732)
    at org.apache.cassandra.gms.Gossiper.applyStateLocally(Gossiper.java:649)
    at org.apache.cassandra.gms.GossipDigestAckVerbHandler.doVerb(GossipDigestAckVerbHandler.java:68)
    at org.apache.cassandra.net.MessageDeliveryTask.run(MessageDeliveryTask.java:70)
    at java.util.concurrent.ThreadPoolExecutor$Worker.runTask(ThreadPoolExecutor.java:886)
    at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:908)
    at java.lang.Thread.run(Thread.java:662)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;They are waiting on deleting hints, and then likely for the hints CF to compact.&lt;/p&gt;</comment>
                            <comment id="12988273" author="jbellis" created="Fri, 28 Jan 2011 22:15:17 +0000"  >&lt;p&gt;Bingo.  I don&apos;t see any reason why we&apos;d want that to be blocking, do you?&lt;/p&gt;

&lt;p&gt;If not we can just remove the .get().&lt;/p&gt;</comment>
                            <comment id="12988275" author="jbellis" created="Fri, 28 Jan 2011 22:16:51 +0000"  >&lt;p&gt;... however, we DO want the flush before compaction to be blocking.&lt;/p&gt;

&lt;p&gt;possibly kicking the whole operation out to the StorageService task queue is the best move.&lt;/p&gt;

&lt;p&gt;(in which case the .get() is a no-op and can still be removed.)&lt;/p&gt;</comment>
                            <comment id="12988314" author="brandon.williams" created="Fri, 28 Jan 2011 23:56:11 +0000"  >&lt;p&gt;I don&apos;t see any reason why it should block, no.  Also I can&apos;t repro with repair on a real cluster, so I think this is the only bug.&lt;/p&gt;</comment>
                            <comment id="12988341" author="jbellis" created="Sat, 29 Jan 2011 00:55:01 +0000"  >&lt;p&gt;attached&lt;/p&gt;</comment>
                            <comment id="12988782" author="gdusbabek" created="Mon, 31 Jan 2011 15:26:48 +0000"  >&lt;p&gt;+1&lt;/p&gt;</comment>
                            <comment id="12988842" author="jbellis" created="Mon, 31 Jan 2011 19:04:16 +0000"  >&lt;p&gt;committed&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12469720" name="2073.txt" size="2283" author="jbellis" created="Sat, 29 Jan 2011 00:55:01 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[jbellis]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>20428</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            14 years, 43 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0g95r:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>92914</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>gdusbabek</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[gdusbabek]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12961"><![CDATA[Low]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>