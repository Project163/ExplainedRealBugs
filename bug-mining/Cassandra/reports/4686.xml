<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 23:06:56 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-13247] index on udt built failed and no data could be inserted</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-13247</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;index on udt built failed and no data could be inserted&lt;/p&gt;

&lt;p&gt;steps to reproduce:&lt;/p&gt;

&lt;p&gt;CREATE KEYSPACE ks1 WITH replication = &lt;/p&gt;
{&apos;class&apos;: &apos;SimpleStrategy&apos;, &apos;replication_factor&apos;: &apos;2&apos;}
&lt;p&gt;  AND durable_writes = true;&lt;/p&gt;

&lt;p&gt;CREATE TYPE ks1.address (&lt;br/&gt;
    street text,&lt;br/&gt;
    city text,&lt;br/&gt;
    zip_code int,&lt;br/&gt;
    phones set&amp;lt;text&amp;gt;&lt;br/&gt;
);&lt;/p&gt;

&lt;p&gt;CREATE TYPE ks1.fullname (&lt;br/&gt;
    firstname text,&lt;br/&gt;
    lastname text&lt;br/&gt;
);&lt;/p&gt;

&lt;p&gt;CREATE TABLE ks1.users (&lt;br/&gt;
    id uuid PRIMARY KEY,&lt;br/&gt;
    addresses map&amp;lt;text, frozen&amp;lt;address&amp;gt;&amp;gt;,&lt;br/&gt;
    age int,&lt;br/&gt;
    direct_reports set&amp;lt;frozen&amp;lt;fullname&amp;gt;&amp;gt;,&lt;br/&gt;
    name fullname&lt;br/&gt;
) WITH bloom_filter_fp_chance = 0.01&lt;br/&gt;
    AND caching = &lt;/p&gt;
{&apos;keys&apos;: &apos;ALL&apos;, &apos;rows_per_partition&apos;: &apos;NONE&apos;}
&lt;p&gt;    AND comment = &apos;&apos;&lt;br/&gt;
    AND compaction = &lt;/p&gt;
{&apos;class&apos;: &apos;org.apache.cassandra.db.compaction.SizeTieredCompactionStrategy&apos;, &apos;max_threshold&apos;: &apos;32&apos;, &apos;min_threshold&apos;: &apos;4&apos;}
&lt;p&gt;    AND compression = &lt;/p&gt;
{&apos;chunk_length_in_kb&apos;: &apos;64&apos;, &apos;class&apos;: &apos;org.apache.cassandra.io.compress.LZ4Compressor&apos;}
&lt;p&gt;    AND crc_check_chance = 1.0&lt;br/&gt;
    AND dclocal_read_repair_chance = 0.1&lt;br/&gt;
    AND default_time_to_live = 0&lt;br/&gt;
    AND gc_grace_seconds = 864000&lt;br/&gt;
    AND max_index_interval = 2048&lt;br/&gt;
    AND memtable_flush_period_in_ms = 0&lt;br/&gt;
    AND min_index_interval = 128&lt;br/&gt;
    AND read_repair_chance = 0.0&lt;br/&gt;
    AND speculative_retry = &apos;99PERCENTILE&apos;;&lt;/p&gt;


&lt;p&gt;SELECT * FROM users where name = &lt;/p&gt;
{ firstname : &apos;first&apos; , lastname : &apos;last&apos;}
&lt;p&gt; allow filtering;&lt;br/&gt;
ReadFailure: Error from server: code=1300 &lt;span class=&quot;error&quot;&gt;&amp;#91;Replica(s) failed to execute read&amp;#93;&lt;/span&gt; message=&quot;Operation failed - received 0 responses and 1 failures&quot; info=&lt;/p&gt;
{&apos;failures&apos;: 1, &apos;received_responses&apos;: 0, &apos;required_responses&apos;: 1, &apos;consistency&apos;: &apos;ONE&apos;}

&lt;p&gt;WARN  &lt;span class=&quot;error&quot;&gt;&amp;#91;ReadStage-2&amp;#93;&lt;/span&gt; 2017-02-22 16:59:33,392 AbstractLocalAwareExecutorService.java:169 - Uncaught exception on thread Thread&lt;span class=&quot;error&quot;&gt;&amp;#91;ReadStage-2,5,main&amp;#93;&lt;/span&gt;: {}&lt;br/&gt;
java.lang.AssertionError: Only CONTAINS and CONTAINS_KEY are supported for &apos;complex&apos; types&lt;br/&gt;
	at org.apache.cassandra.db.filter.RowFilter$SimpleExpression.isSatisfiedBy(RowFilter.java:683) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;apache-cassandra-3.9.jar:3.9&amp;#93;&lt;/span&gt;&lt;br/&gt;
	at org.apache.cassandra.db.filter.RowFilter$CQLFilter$1IsSatisfiedFilter.applyToRow(RowFilter.java:303) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;apache-cassandra-3.9.jar:3.9&amp;#93;&lt;/span&gt;&lt;br/&gt;
	at org.apache.cassandra.db.transform.BaseRows.applyOne(BaseRows.java:120) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;apache-cassandra-3.9.jar:3.9&amp;#93;&lt;/span&gt;&lt;br/&gt;
	at org.apache.cassandra.db.transform.BaseRows.add(BaseRows.java:110) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;apache-cassandra-3.9.jar:3.9&amp;#93;&lt;/span&gt;&lt;br/&gt;
	at org.apache.cassandra.db.transform.UnfilteredRows.add(UnfilteredRows.java:41) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;apache-cassandra-3.9.jar:3.9&amp;#93;&lt;/span&gt;&lt;br/&gt;
	at org.apache.cassandra.db.transform.Transformation.add(Transformation.java:162) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;apache-cassandra-3.9.jar:3.9&amp;#93;&lt;/span&gt;&lt;br/&gt;
	at org.apache.cassandra.db.transform.Transformation.apply(Transformation.java:128) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;apache-cassandra-3.9.jar:3.9&amp;#93;&lt;/span&gt;&lt;br/&gt;
	at org.apache.cassandra.db.filter.RowFilter$CQLFilter$1IsSatisfiedFilter.applyToPartition(RowFilter.java:292) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;apache-cassandra-3.9.jar:3.9&amp;#93;&lt;/span&gt;&lt;br/&gt;
	at org.apache.cassandra.db.filter.RowFilter$CQLFilter$1IsSatisfiedFilter.applyToPartition(RowFilter.java:281) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;apache-cassandra-3.9.jar:3.9&amp;#93;&lt;/span&gt;&lt;br/&gt;
	at org.apache.cassandra.db.transform.BasePartitions.hasNext(BasePartitions.java:96) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;apache-cassandra-3.9.jar:3.9&amp;#93;&lt;/span&gt;&lt;br/&gt;
	at org.apache.cassandra.db.partitions.UnfilteredPartitionIterators$Serializer.serialize(UnfilteredPartitionIterators.java:289) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;apache-cassandra-3.9.jar:3.9&amp;#93;&lt;/span&gt;&lt;br/&gt;
	at org.apache.cassandra.db.ReadResponse$LocalDataResponse.build(ReadResponse.java:145) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;apache-cassandra-3.9.jar:3.9&amp;#93;&lt;/span&gt;&lt;br/&gt;
	at org.apache.cassandra.db.ReadResponse$LocalDataResponse.&amp;lt;init&amp;gt;(ReadResponse.java:138) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;apache-cassandra-3.9.jar:3.9&amp;#93;&lt;/span&gt;&lt;br/&gt;
	at org.apache.cassandra.db.ReadResponse$LocalDataResponse.&amp;lt;init&amp;gt;(ReadResponse.java:134) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;apache-cassandra-3.9.jar:3.9&amp;#93;&lt;/span&gt;&lt;br/&gt;
	at org.apache.cassandra.db.ReadResponse.createDataResponse(ReadResponse.java:76) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;apache-cassandra-3.9.jar:3.9&amp;#93;&lt;/span&gt;&lt;br/&gt;
	at org.apache.cassandra.db.ReadCommand.createResponse(ReadCommand.java:323) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;apache-cassandra-3.9.jar:3.9&amp;#93;&lt;/span&gt;&lt;br/&gt;
	at org.apache.cassandra.service.StorageProxy$LocalReadRunnable.runMayThrow(StorageProxy.java:1803) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;apache-cassandra-3.9.jar:3.9&amp;#93;&lt;/span&gt;&lt;br/&gt;
	at org.apache.cassandra.service.StorageProxy$DroppableRunnable.run(StorageProxy.java:2486) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;apache-cassandra-3.9.jar:3.9&amp;#93;&lt;/span&gt;&lt;br/&gt;
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;na:1.8.0_121&amp;#93;&lt;/span&gt;&lt;br/&gt;
	at org.apache.cassandra.concurrent.AbstractLocalAwareExecutorService$FutureTask.run(AbstractLocalAwareExecutorService.java:164) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;apache-cassandra-3.9.jar:3.9&amp;#93;&lt;/span&gt;&lt;br/&gt;
	at org.apache.cassandra.concurrent.AbstractLocalAwareExecutorService$LocalSessionFutureTask.run(AbstractLocalAwareExecutorService.java:136) &lt;span class=&quot;error&quot;&gt;&amp;#91;apache-cassandra-3.9.jar:3.9&amp;#93;&lt;/span&gt;&lt;br/&gt;
	at org.apache.cassandra.concurrent.SEPWorker.run(SEPWorker.java:109) &lt;span class=&quot;error&quot;&gt;&amp;#91;apache-cassandra-3.9.jar:3.9&amp;#93;&lt;/span&gt;&lt;br/&gt;
	at java.lang.Thread.run(Thread.java:745) &lt;span class=&quot;error&quot;&gt;&amp;#91;na:1.8.0_121&amp;#93;&lt;/span&gt;&lt;/p&gt;


&lt;p&gt;CREATE INDEX users_name_idx ON ks1.users (name);&lt;/p&gt;

&lt;p&gt;ERROR &lt;span class=&quot;error&quot;&gt;&amp;#91;CompactionExecutor:776&amp;#93;&lt;/span&gt; 2017-02-22 16:49:41,934 CassandraDaemon.java:226 - Exception in thread Thread&lt;span class=&quot;error&quot;&gt;&amp;#91;CompactionExecutor:776,1,main&amp;#93;&lt;/span&gt;&lt;br/&gt;
java.lang.RuntimeException: null for ks: ks1, table: users.users_name_idx&lt;br/&gt;
	at org.apache.cassandra.db.ColumnFamilyStore.apply(ColumnFamilyStore.java:1316) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;apache-cassandra-3.9.jar:3.9&amp;#93;&lt;/span&gt;&lt;br/&gt;
	at org.apache.cassandra.index.internal.CassandraIndex.insert(CassandraIndex.java:531) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;apache-cassandra-3.9.jar:3.9&amp;#93;&lt;/span&gt;&lt;br/&gt;
	at org.apache.cassandra.index.internal.CassandraIndex.access$100(CassandraIndex.java:72) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;apache-cassandra-3.9.jar:3.9&amp;#93;&lt;/span&gt;&lt;br/&gt;
	at org.apache.cassandra.index.internal.CassandraIndex$1.indexCell(CassandraIndex.java:444) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;apache-cassandra-3.9.jar:3.9&amp;#93;&lt;/span&gt;&lt;br/&gt;
	at org.apache.cassandra.index.internal.CassandraIndex$1.indexCells(CassandraIndex.java:436) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;apache-cassandra-3.9.jar:3.9&amp;#93;&lt;/span&gt;&lt;br/&gt;
	at org.apache.cassandra.index.internal.CassandraIndex$1.insertRow(CassandraIndex.java:386) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;apache-cassandra-3.9.jar:3.9&amp;#93;&lt;/span&gt;&lt;br/&gt;
	at org.apache.cassandra.index.SecondaryIndexManager.lambda$indexPartition$17(SecondaryIndexManager.java:552) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;apache-cassandra-3.9.jar:3.9&amp;#93;&lt;/span&gt;&lt;br/&gt;
	at java.lang.Iterable.forEach(Iterable.java:75) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;na:1.8.0_121&amp;#93;&lt;/span&gt;&lt;br/&gt;
	at org.apache.cassandra.index.SecondaryIndexManager.indexPartition(SecondaryIndexManager.java:552) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;apache-cassandra-3.9.jar:3.9&amp;#93;&lt;/span&gt;&lt;br/&gt;
	at org.apache.cassandra.db.Keyspace.indexPartition(Keyspace.java:566) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;apache-cassandra-3.9.jar:3.9&amp;#93;&lt;/span&gt;&lt;br/&gt;
	at org.apache.cassandra.index.internal.CollatedViewIndexBuilder.build(CollatedViewIndexBuilder.java:70) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;apache-cassandra-3.9.jar:3.9&amp;#93;&lt;/span&gt;&lt;br/&gt;
	at org.apache.cassandra.db.compaction.CompactionManager$12.run(CompactionManager.java:1468) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;apache-cassandra-3.9.jar:3.9&amp;#93;&lt;/span&gt;&lt;br/&gt;
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;na:1.8.0_121&amp;#93;&lt;/span&gt;&lt;br/&gt;
	at java.util.concurrent.FutureTask.run(FutureTask.java:266) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;na:1.8.0_121&amp;#93;&lt;/span&gt;&lt;br/&gt;
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1142) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;na:1.8.0_121&amp;#93;&lt;/span&gt;&lt;br/&gt;
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:617) &lt;span class=&quot;error&quot;&gt;&amp;#91;na:1.8.0_121&amp;#93;&lt;/span&gt;&lt;br/&gt;
	at java.lang.Thread.run(Thread.java:745) &lt;span class=&quot;error&quot;&gt;&amp;#91;na:1.8.0_121&amp;#93;&lt;/span&gt;&lt;br/&gt;
Caused by: java.nio.BufferUnderflowException: null&lt;br/&gt;
	at java.nio.Buffer.nextGetIndex(Buffer.java:506) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;na:1.8.0_121&amp;#93;&lt;/span&gt;&lt;br/&gt;
	at java.nio.HeapByteBuffer.getInt(HeapByteBuffer.java:361) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;na:1.8.0_121&amp;#93;&lt;/span&gt;&lt;br/&gt;
	at org.apache.cassandra.db.marshal.TupleType.compareCustom(TupleType.java:109) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;apache-cassandra-3.9.jar:3.9&amp;#93;&lt;/span&gt;&lt;br/&gt;
	at org.apache.cassandra.db.marshal.AbstractType.compare(AbstractType.java:159) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;apache-cassandra-3.9.jar:3.9&amp;#93;&lt;/span&gt;&lt;br/&gt;
	at org.apache.cassandra.dht.LocalPartitioner$LocalToken.compareTo(LocalPartitioner.java:139) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;apache-cassandra-3.9.jar:3.9&amp;#93;&lt;/span&gt;&lt;br/&gt;
	at org.apache.cassandra.dht.LocalPartitioner$LocalToken.compareTo(LocalPartitioner.java:120) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;apache-cassandra-3.9.jar:3.9&amp;#93;&lt;/span&gt;&lt;br/&gt;
	at org.apache.cassandra.db.DecoratedKey.compareTo(DecoratedKey.java:85) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;apache-cassandra-3.9.jar:3.9&amp;#93;&lt;/span&gt;&lt;br/&gt;
	at org.apache.cassandra.db.DecoratedKey.compareTo(DecoratedKey.java:39) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;apache-cassandra-3.9.jar:3.9&amp;#93;&lt;/span&gt;&lt;br/&gt;
	at java.util.concurrent.ConcurrentSkipListMap.cpr(ConcurrentSkipListMap.java:655) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;na:1.8.0_121&amp;#93;&lt;/span&gt;&lt;br/&gt;
	at java.util.concurrent.ConcurrentSkipListMap.doGet(ConcurrentSkipListMap.java:794) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;na:1.8.0_121&amp;#93;&lt;/span&gt;&lt;br/&gt;
	at java.util.concurrent.ConcurrentSkipListMap.get(ConcurrentSkipListMap.java:1546) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;na:1.8.0_121&amp;#93;&lt;/span&gt;&lt;br/&gt;
	at org.apache.cassandra.db.Memtable.put(Memtable.java:234) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;apache-cassandra-3.9.jar:3.9&amp;#93;&lt;/span&gt;&lt;br/&gt;
	at org.apache.cassandra.db.ColumnFamilyStore.apply(ColumnFamilyStore.java:1303) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;apache-cassandra-3.9.jar:3.9&amp;#93;&lt;/span&gt;&lt;br/&gt;
	... 16 common frames omitted&lt;br/&gt;
ERROR &lt;span class=&quot;error&quot;&gt;&amp;#91;SecondaryIndexManagement:3&amp;#93;&lt;/span&gt; 2017-02-22 16:49:41,934 CassandraDaemon.java:226 - Exception in thread Thread&lt;span class=&quot;error&quot;&gt;&amp;#91;SecondaryIndexManagement:3,5,main&amp;#93;&lt;/span&gt;&lt;br/&gt;
java.lang.RuntimeException: java.util.concurrent.ExecutionException: java.lang.RuntimeException: null for ks: ks1, table: users.users_name_idx&lt;br/&gt;
	at org.apache.cassandra.utils.FBUtilities.waitOnFuture(FBUtilities.java:403) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;apache-cassandra-3.9.jar:3.9&amp;#93;&lt;/span&gt;&lt;br/&gt;
	at org.apache.cassandra.index.internal.CassandraIndex.buildBlocking(CassandraIndex.java:715) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;apache-cassandra-3.9.jar:3.9&amp;#93;&lt;/span&gt;&lt;br/&gt;
	at org.apache.cassandra.index.internal.CassandraIndex.lambda$getBuildIndexTask$5(CassandraIndex.java:685) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;apache-cassandra-3.9.jar:3.9&amp;#93;&lt;/span&gt;&lt;br/&gt;
	at java.util.concurrent.FutureTask.run(FutureTask.java:266) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;na:1.8.0_121&amp;#93;&lt;/span&gt;&lt;br/&gt;
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1142) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;na:1.8.0_121&amp;#93;&lt;/span&gt;&lt;br/&gt;
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:617) &lt;span class=&quot;error&quot;&gt;&amp;#91;na:1.8.0_121&amp;#93;&lt;/span&gt;&lt;br/&gt;
	at java.lang.Thread.run(Thread.java:745) &lt;span class=&quot;error&quot;&gt;&amp;#91;na:1.8.0_121&amp;#93;&lt;/span&gt;&lt;br/&gt;
Caused by: java.util.concurrent.ExecutionException: java.lang.RuntimeException: null for ks: ks1, table: users.users_name_idx&lt;br/&gt;
	at java.util.concurrent.FutureTask.report(FutureTask.java:122) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;na:1.8.0_121&amp;#93;&lt;/span&gt;&lt;br/&gt;
	at java.util.concurrent.FutureTask.get(FutureTask.java:192) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;na:1.8.0_121&amp;#93;&lt;/span&gt;&lt;br/&gt;
	at org.apache.cassandra.utils.FBUtilities.waitOnFuture(FBUtilities.java:399) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;apache-cassandra-3.9.jar:3.9&amp;#93;&lt;/span&gt;&lt;br/&gt;
	... 6 common frames omitted&lt;br/&gt;
Caused by: java.lang.RuntimeException: null for ks: ks1, table: users.users_name_idx&lt;br/&gt;
	at org.apache.cassandra.db.ColumnFamilyStore.apply(ColumnFamilyStore.java:1316) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;apache-cassandra-3.9.jar:3.9&amp;#93;&lt;/span&gt;&lt;br/&gt;
	at org.apache.cassandra.index.internal.CassandraIndex.insert(CassandraIndex.java:531) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;apache-cassandra-3.9.jar:3.9&amp;#93;&lt;/span&gt;&lt;br/&gt;
	at org.apache.cassandra.index.internal.CassandraIndex.access$100(CassandraIndex.java:72) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;apache-cassandra-3.9.jar:3.9&amp;#93;&lt;/span&gt;&lt;br/&gt;
	at org.apache.cassandra.index.internal.CassandraIndex$1.indexCell(CassandraIndex.java:444) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;apache-cassandra-3.9.jar:3.9&amp;#93;&lt;/span&gt;&lt;br/&gt;
	at org.apache.cassandra.index.internal.CassandraIndex$1.indexCells(CassandraIndex.java:436) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;apache-cassandra-3.9.jar:3.9&amp;#93;&lt;/span&gt;&lt;br/&gt;
	at org.apache.cassandra.index.internal.CassandraIndex$1.insertRow(CassandraIndex.java:386) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;apache-cassandra-3.9.jar:3.9&amp;#93;&lt;/span&gt;&lt;br/&gt;
	at org.apache.cassandra.index.SecondaryIndexManager.lambda$indexPartition$17(SecondaryIndexManager.java:552) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;apache-cassandra-3.9.jar:3.9&amp;#93;&lt;/span&gt;&lt;br/&gt;
	at java.lang.Iterable.forEach(Iterable.java:75) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;na:1.8.0_121&amp;#93;&lt;/span&gt;&lt;br/&gt;
	at org.apache.cassandra.index.SecondaryIndexManager.indexPartition(SecondaryIndexManager.java:552) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;apache-cassandra-3.9.jar:3.9&amp;#93;&lt;/span&gt;&lt;br/&gt;
	at org.apache.cassandra.db.Keyspace.indexPartition(Keyspace.java:566) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;apache-cassandra-3.9.jar:3.9&amp;#93;&lt;/span&gt;&lt;br/&gt;
	at org.apache.cassandra.index.internal.CollatedViewIndexBuilder.build(CollatedViewIndexBuilder.java:70) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;apache-cassandra-3.9.jar:3.9&amp;#93;&lt;/span&gt;&lt;br/&gt;
	at org.apache.cassandra.db.compaction.CompactionManager$12.run(CompactionManager.java:1468) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;apache-cassandra-3.9.jar:3.9&amp;#93;&lt;/span&gt;&lt;br/&gt;
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;na:1.8.0_121&amp;#93;&lt;/span&gt;&lt;br/&gt;
	... 4 common frames omitted&lt;br/&gt;
Caused by: java.nio.BufferUnderflowException: null&lt;br/&gt;
	at java.nio.Buffer.nextGetIndex(Buffer.java:506) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;na:1.8.0_121&amp;#93;&lt;/span&gt;&lt;br/&gt;
	at java.nio.HeapByteBuffer.getInt(HeapByteBuffer.java:361) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;na:1.8.0_121&amp;#93;&lt;/span&gt;&lt;br/&gt;
	at org.apache.cassandra.db.marshal.TupleType.compareCustom(TupleType.java:109) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;apache-cassandra-3.9.jar:3.9&amp;#93;&lt;/span&gt;&lt;br/&gt;
	at org.apache.cassandra.db.marshal.AbstractType.compare(AbstractType.java:159) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;apache-cassandra-3.9.jar:3.9&amp;#93;&lt;/span&gt;&lt;br/&gt;
	at org.apache.cassandra.dht.LocalPartitioner$LocalToken.compareTo(LocalPartitioner.java:139) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;apache-cassandra-3.9.jar:3.9&amp;#93;&lt;/span&gt;&lt;br/&gt;
	at org.apache.cassandra.dht.LocalPartitioner$LocalToken.compareTo(LocalPartitioner.java:120) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;apache-cassandra-3.9.jar:3.9&amp;#93;&lt;/span&gt;&lt;br/&gt;
	at org.apache.cassandra.db.DecoratedKey.compareTo(DecoratedKey.java:85) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;apache-cassandra-3.9.jar:3.9&amp;#93;&lt;/span&gt;&lt;br/&gt;
	at org.apache.cassandra.db.DecoratedKey.compareTo(DecoratedKey.java:39) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;apache-cassandra-3.9.jar:3.9&amp;#93;&lt;/span&gt;&lt;br/&gt;
	at java.util.concurrent.ConcurrentSkipListMap.cpr(ConcurrentSkipListMap.java:655) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;na:1.8.0_121&amp;#93;&lt;/span&gt;&lt;br/&gt;
	at java.util.concurrent.ConcurrentSkipListMap.doGet(ConcurrentSkipListMap.java:794) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;na:1.8.0_121&amp;#93;&lt;/span&gt;&lt;br/&gt;
	at java.util.concurrent.ConcurrentSkipListMap.get(ConcurrentSkipListMap.java:1546) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;na:1.8.0_121&amp;#93;&lt;/span&gt;&lt;br/&gt;
	at org.apache.cassandra.db.Memtable.put(Memtable.java:234) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;apache-cassandra-3.9.jar:3.9&amp;#93;&lt;/span&gt;&lt;br/&gt;
	at org.apache.cassandra.db.ColumnFamilyStore.apply(ColumnFamilyStore.java:1303) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;apache-cassandra-3.9.jar:3.9&amp;#93;&lt;/span&gt;&lt;br/&gt;
	... 16 common frames omitted&lt;/p&gt;


&lt;p&gt;SELECT * FROM users where name = &lt;/p&gt;
{ firstname : &apos;first&apos; , lastname : &apos;last&apos;}
&lt;p&gt;;&lt;br/&gt;
ReadFailure: Error from server: code=1300 &lt;span class=&quot;error&quot;&gt;&amp;#91;Replica(s) failed to execute read&amp;#93;&lt;/span&gt; message=&quot;Operation failed - received 0 responses and 1 failures&quot; info=&lt;/p&gt;
{&apos;failures&apos;: 1, &apos;received_responses&apos;: 0, &apos;required_responses&apos;: 1, &apos;consistency&apos;: &apos;ONE&apos;}

&lt;p&gt;WARN  &lt;span class=&quot;error&quot;&gt;&amp;#91;ReadStage-2&amp;#93;&lt;/span&gt; 2017-02-22 16:55:43,139 AbstractLocalAwareExecutorService.java:169 - Uncaught exception on thread Thread&lt;span class=&quot;error&quot;&gt;&amp;#91;ReadStage-2,5,main&amp;#93;&lt;/span&gt;: {}&lt;br/&gt;
java.lang.RuntimeException: org.apache.cassandra.index.IndexNotAvailableException: The secondary index &apos;users_name_idx&apos; is not yet available&lt;br/&gt;
	at org.apache.cassandra.service.StorageProxy$DroppableRunnable.run(StorageProxy.java:2490) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;apache-cassandra-3.9.jar:3.9&amp;#93;&lt;/span&gt;&lt;br/&gt;
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;na:1.8.0_121&amp;#93;&lt;/span&gt;&lt;br/&gt;
	at org.apache.cassandra.concurrent.AbstractLocalAwareExecutorService$FutureTask.run(AbstractLocalAwareExecutorService.java:164) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;apache-cassandra-3.9.jar:3.9&amp;#93;&lt;/span&gt;&lt;br/&gt;
	at org.apache.cassandra.concurrent.AbstractLocalAwareExecutorService$LocalSessionFutureTask.run(AbstractLocalAwareExecutorService.java:136) &lt;span class=&quot;error&quot;&gt;&amp;#91;apache-cassandra-3.9.jar:3.9&amp;#93;&lt;/span&gt;&lt;br/&gt;
	at org.apache.cassandra.concurrent.SEPWorker.run(SEPWorker.java:109) &lt;span class=&quot;error&quot;&gt;&amp;#91;apache-cassandra-3.9.jar:3.9&amp;#93;&lt;/span&gt;&lt;br/&gt;
	at java.lang.Thread.run(Thread.java:745) &lt;span class=&quot;error&quot;&gt;&amp;#91;na:1.8.0_121&amp;#93;&lt;/span&gt;&lt;br/&gt;
Caused by: org.apache.cassandra.index.IndexNotAvailableException: The secondary index &apos;users_name_idx&apos; is not yet available&lt;br/&gt;
	at org.apache.cassandra.db.ReadCommand.executeLocally(ReadCommand.java:390) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;apache-cassandra-3.9.jar:3.9&amp;#93;&lt;/span&gt;&lt;br/&gt;
	at org.apache.cassandra.service.StorageProxy$LocalReadRunnable.runMayThrow(StorageProxy.java:1801) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;apache-cassandra-3.9.jar:3.9&amp;#93;&lt;/span&gt;&lt;br/&gt;
	at org.apache.cassandra.service.StorageProxy$DroppableRunnable.run(StorageProxy.java:2486) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;apache-cassandra-3.9.jar:3.9&amp;#93;&lt;/span&gt;&lt;br/&gt;
	... 5 common frames omitted&lt;/p&gt;


&lt;p&gt;insert into users (id, name) values (uuid(), &lt;/p&gt;
{firstname: &apos;a&apos;, lastname: &apos;b&apos;}
&lt;p&gt;);&lt;br/&gt;
WriteFailure: Error from server: code=1500 &lt;span class=&quot;error&quot;&gt;&amp;#91;Replica(s) failed to execute write&amp;#93;&lt;/span&gt; message=&quot;Operation failed - received 0 responses and 1 failures&quot; info=&lt;/p&gt;
{&apos;failures&apos;: 1, &apos;received_responses&apos;: 0, &apos;required_responses&apos;: 1, &apos;consistency&apos;: &apos;ONE&apos;}

&lt;p&gt;ERROR &lt;span class=&quot;error&quot;&gt;&amp;#91;MutationStage-2&amp;#93;&lt;/span&gt; 2017-02-22 17:04:34,355 StorageProxy.java:1353 - Failed to apply mutation locally : {}&lt;br/&gt;
java.lang.RuntimeException: null for ks: ks1, table: users.users_name_idx for ks: ks1, table: users&lt;br/&gt;
	at org.apache.cassandra.db.ColumnFamilyStore.apply(ColumnFamilyStore.java:1316) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;apache-cassandra-3.9.jar:3.9&amp;#93;&lt;/span&gt;&lt;br/&gt;
	at org.apache.cassandra.db.Keyspace.apply(Keyspace.java:526) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;apache-cassandra-3.9.jar:3.9&amp;#93;&lt;/span&gt;&lt;br/&gt;
	at org.apache.cassandra.db.Keyspace.apply(Keyspace.java:396) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;apache-cassandra-3.9.jar:3.9&amp;#93;&lt;/span&gt;&lt;br/&gt;
	at org.apache.cassandra.db.Mutation.applyFuture(Mutation.java:215) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;apache-cassandra-3.9.jar:3.9&amp;#93;&lt;/span&gt;&lt;br/&gt;
	at org.apache.cassandra.db.Mutation.apply(Mutation.java:227) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;apache-cassandra-3.9.jar:3.9&amp;#93;&lt;/span&gt;&lt;br/&gt;
	at org.apache.cassandra.db.Mutation.apply(Mutation.java:241) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;apache-cassandra-3.9.jar:3.9&amp;#93;&lt;/span&gt;&lt;br/&gt;
	at org.apache.cassandra.service.StorageProxy$8.runMayThrow(StorageProxy.java:1347) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;apache-cassandra-3.9.jar:3.9&amp;#93;&lt;/span&gt;&lt;br/&gt;
	at org.apache.cassandra.service.StorageProxy$LocalMutationRunnable.run(StorageProxy.java:2539) &lt;span class=&quot;error&quot;&gt;&amp;#91;apache-cassandra-3.9.jar:3.9&amp;#93;&lt;/span&gt;&lt;br/&gt;
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511) &lt;span class=&quot;error&quot;&gt;&amp;#91;na:1.8.0_121&amp;#93;&lt;/span&gt;&lt;br/&gt;
	at org.apache.cassandra.concurrent.AbstractLocalAwareExecutorService$FutureTask.run(AbstractLocalAwareExecutorService.java:164) &lt;span class=&quot;error&quot;&gt;&amp;#91;apache-cassandra-3.9.jar:3.9&amp;#93;&lt;/span&gt;&lt;br/&gt;
	at org.apache.cassandra.concurrent.AbstractLocalAwareExecutorService$LocalSessionFutureTask.run(AbstractLocalAwareExecutorService.java:136) &lt;span class=&quot;error&quot;&gt;&amp;#91;apache-cassandra-3.9.jar:3.9&amp;#93;&lt;/span&gt;&lt;br/&gt;
	at org.apache.cassandra.concurrent.SEPWorker.run(SEPWorker.java:109) &lt;span class=&quot;error&quot;&gt;&amp;#91;apache-cassandra-3.9.jar:3.9&amp;#93;&lt;/span&gt;&lt;br/&gt;
	at java.lang.Thread.run(Thread.java:745) &lt;span class=&quot;error&quot;&gt;&amp;#91;na:1.8.0_121&amp;#93;&lt;/span&gt;&lt;br/&gt;
Caused by: java.lang.RuntimeException: null for ks: ks1, table: users.users_name_idx&lt;br/&gt;
	at org.apache.cassandra.db.ColumnFamilyStore.apply(ColumnFamilyStore.java:1316) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;apache-cassandra-3.9.jar:3.9&amp;#93;&lt;/span&gt;&lt;br/&gt;
	at org.apache.cassandra.index.internal.CassandraIndex.insert(CassandraIndex.java:531) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;apache-cassandra-3.9.jar:3.9&amp;#93;&lt;/span&gt;&lt;br/&gt;
	at org.apache.cassandra.index.internal.CassandraIndex.access$100(CassandraIndex.java:72) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;apache-cassandra-3.9.jar:3.9&amp;#93;&lt;/span&gt;&lt;br/&gt;
	at org.apache.cassandra.index.internal.CassandraIndex$1.indexCell(CassandraIndex.java:444) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;apache-cassandra-3.9.jar:3.9&amp;#93;&lt;/span&gt;&lt;br/&gt;
	at org.apache.cassandra.index.internal.CassandraIndex$1.indexCells(CassandraIndex.java:436) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;apache-cassandra-3.9.jar:3.9&amp;#93;&lt;/span&gt;&lt;br/&gt;
	at org.apache.cassandra.index.internal.CassandraIndex$1.insertRow(CassandraIndex.java:386) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;apache-cassandra-3.9.jar:3.9&amp;#93;&lt;/span&gt;&lt;br/&gt;
	at org.apache.cassandra.index.SecondaryIndexManager$WriteTimeTransaction.onInserted(SecondaryIndexManager.java:808) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;apache-cassandra-3.9.jar:3.9&amp;#93;&lt;/span&gt;&lt;br/&gt;
	at org.apache.cassandra.db.partitions.AtomicBTreePartition$RowUpdater.apply(AtomicBTreePartition.java:335) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;apache-cassandra-3.9.jar:3.9&amp;#93;&lt;/span&gt;&lt;br/&gt;
	at org.apache.cassandra.db.partitions.AtomicBTreePartition$RowUpdater.apply(AtomicBTreePartition.java:295) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;apache-cassandra-3.9.jar:3.9&amp;#93;&lt;/span&gt;&lt;br/&gt;
	at org.apache.cassandra.utils.btree.BTree.buildInternal(BTree.java:137) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;apache-cassandra-3.9.jar:3.9&amp;#93;&lt;/span&gt;&lt;br/&gt;
	at org.apache.cassandra.utils.btree.BTree.build(BTree.java:119) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;apache-cassandra-3.9.jar:3.9&amp;#93;&lt;/span&gt;&lt;br/&gt;
	at org.apache.cassandra.utils.btree.BTree.update(BTree.java:175) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;apache-cassandra-3.9.jar:3.9&amp;#93;&lt;/span&gt;&lt;br/&gt;
	at org.apache.cassandra.db.partitions.AtomicBTreePartition.addAllWithSizeDelta(AtomicBTreePartition.java:156) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;apache-cassandra-3.9.jar:3.9&amp;#93;&lt;/span&gt;&lt;br/&gt;
	at org.apache.cassandra.db.Memtable.put(Memtable.java:258) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;apache-cassandra-3.9.jar:3.9&amp;#93;&lt;/span&gt;&lt;br/&gt;
	at org.apache.cassandra.db.ColumnFamilyStore.apply(ColumnFamilyStore.java:1303) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;apache-cassandra-3.9.jar:3.9&amp;#93;&lt;/span&gt;&lt;br/&gt;
	... 12 common frames omitted&lt;br/&gt;
Caused by: java.nio.BufferUnderflowException: null&lt;br/&gt;
	at java.nio.Buffer.nextGetIndex(Buffer.java:506) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;na:1.8.0_121&amp;#93;&lt;/span&gt;&lt;br/&gt;
	at java.nio.HeapByteBuffer.getInt(HeapByteBuffer.java:361) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;na:1.8.0_121&amp;#93;&lt;/span&gt;&lt;br/&gt;
	at org.apache.cassandra.db.marshal.TupleType.compareCustom(TupleType.java:109) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;apache-cassandra-3.9.jar:3.9&amp;#93;&lt;/span&gt;&lt;br/&gt;
	at org.apache.cassandra.db.marshal.AbstractType.compare(AbstractType.java:159) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;apache-cassandra-3.9.jar:3.9&amp;#93;&lt;/span&gt;&lt;br/&gt;
	at org.apache.cassandra.dht.LocalPartitioner$LocalToken.compareTo(LocalPartitioner.java:139) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;apache-cassandra-3.9.jar:3.9&amp;#93;&lt;/span&gt;&lt;br/&gt;
	at org.apache.cassandra.dht.LocalPartitioner$LocalToken.compareTo(LocalPartitioner.java:120) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;apache-cassandra-3.9.jar:3.9&amp;#93;&lt;/span&gt;&lt;br/&gt;
	at org.apache.cassandra.db.DecoratedKey.compareTo(DecoratedKey.java:85) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;apache-cassandra-3.9.jar:3.9&amp;#93;&lt;/span&gt;&lt;br/&gt;
	at org.apache.cassandra.db.DecoratedKey.compareTo(DecoratedKey.java:39) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;apache-cassandra-3.9.jar:3.9&amp;#93;&lt;/span&gt;&lt;br/&gt;
	at java.util.concurrent.ConcurrentSkipListMap.cpr(ConcurrentSkipListMap.java:655) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;na:1.8.0_121&amp;#93;&lt;/span&gt;&lt;br/&gt;
	at java.util.concurrent.ConcurrentSkipListMap.doGet(ConcurrentSkipListMap.java:794) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;na:1.8.0_121&amp;#93;&lt;/span&gt;&lt;br/&gt;
	at java.util.concurrent.ConcurrentSkipListMap.get(ConcurrentSkipListMap.java:1546) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;na:1.8.0_121&amp;#93;&lt;/span&gt;&lt;br/&gt;
	at org.apache.cassandra.db.Memtable.put(Memtable.java:234) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;apache-cassandra-3.9.jar:3.9&amp;#93;&lt;/span&gt;&lt;br/&gt;
	at org.apache.cassandra.db.ColumnFamilyStore.apply(ColumnFamilyStore.java:1303) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;apache-cassandra-3.9.jar:3.9&amp;#93;&lt;/span&gt;&lt;br/&gt;
	... 26 common frames omitted&lt;/p&gt;




</description>
                <environment></environment>
        <key id="13045157">CASSANDRA-13247</key>
            <summary>index on udt built failed and no data could be inserted</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10000" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Urgent</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="adelapena">Andres de la Pe&#241;a</assignee>
                                    <reporter username="mashudong">mashudong</reporter>
                        <labels>
                    </labels>
                <created>Wed, 22 Feb 2017 09:19:24 +0000</created>
                <updated>Fri, 15 May 2020 08:06:34 +0000</updated>
                            <resolved>Thu, 23 Mar 2017 17:12:01 +0000</resolved>
                                        <fixVersion>3.11.0</fixVersion>
                    <fixVersion>4.0-alpha1</fixVersion>
                    <fixVersion>4.0</fixVersion>
                                    <component>Legacy/CQL</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="15934421" author="adelapena" created="Tue, 21 Mar 2017 10:43:27 +0000"  >&lt;p&gt;It seems there are two separate problems here. &lt;/p&gt;

&lt;p&gt;At first,  without any index created, the query using &lt;tt&gt;ALLOW FILTERING&lt;/tt&gt; over a non frozen UDT should either work or, if it is not supported, show a meaningfull CQL message:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;CREATE KEYSPACE ks1 WITH replication = {&lt;span class=&quot;code-quote&quot;&gt;&apos;class&apos;&lt;/span&gt;: &lt;span class=&quot;code-quote&quot;&gt;&apos;SimpleStrategy&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;replication_factor&apos;&lt;/span&gt;: &lt;span class=&quot;code-quote&quot;&gt;&apos;1&apos;&lt;/span&gt;};

CREATE TYPE ks1.fullname (
	firstname text,
	lastname text
);

CREATE TABLE ks1.users (
	id uuid PRIMARY KEY,
	name fullname
);

INSERT INTO ks1.users(id, name) VALUES (now(), {firstname : &lt;span class=&quot;code-quote&quot;&gt;&apos;first&apos;&lt;/span&gt;, lastname : &lt;span class=&quot;code-quote&quot;&gt;&apos;last&apos;&lt;/span&gt;});

SELECT * FROM ks1.users WHERE name = {firstname : &lt;span class=&quot;code-quote&quot;&gt;&apos;first&apos;&lt;/span&gt;, lastname : &lt;span class=&quot;code-quote&quot;&gt;&apos;last&apos;&lt;/span&gt;} ALLOW FILTERING;
ReadFailure: Error from server: code=1300 [Replica(s) failed to execute read] message=&lt;span class=&quot;code-quote&quot;&gt;&quot;Operation failed - received 0 responses and 1 failures&quot;&lt;/span&gt; info={&lt;span class=&quot;code-quote&quot;&gt;&apos;failures&apos;&lt;/span&gt;: 1, &lt;span class=&quot;code-quote&quot;&gt;&apos;received_responses&apos;&lt;/span&gt;: 0, &lt;span class=&quot;code-quote&quot;&gt;&apos;required_responses&apos;&lt;/span&gt;: 1, &lt;span class=&quot;code-quote&quot;&gt;&apos;consistency&apos;&lt;/span&gt;: &lt;span class=&quot;code-quote&quot;&gt;&apos;ONE&apos;&lt;/span&gt;}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Also, as a second problem, index creation over a non frozen UDT should either work or, if it is not supported, fail during CQL validation showing a meaningfull message:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;CREATE KEYSPACE ks1 WITH replication = {&lt;span class=&quot;code-quote&quot;&gt;&apos;class&apos;&lt;/span&gt;: &lt;span class=&quot;code-quote&quot;&gt;&apos;SimpleStrategy&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;replication_factor&apos;&lt;/span&gt;: &lt;span class=&quot;code-quote&quot;&gt;&apos;1&apos;&lt;/span&gt;};

CREATE TYPE ks1.fullname (
	firstname text,
	lastname text
);

CREATE TABLE ks1.users (
	id uuid PRIMARY KEY,
	name fullname
);

CREATE INDEX users_name_idx ON ks1.users (name);

INSERT INTO ks1.users(id, name) VALUES (now(), {firstname : &lt;span class=&quot;code-quote&quot;&gt;&apos;first&apos;&lt;/span&gt;, lastname : &lt;span class=&quot;code-quote&quot;&gt;&apos;last&apos;&lt;/span&gt;});
WriteFailure: Error from server: code=1500 [Replica(s) failed to execute write] message=&lt;span class=&quot;code-quote&quot;&gt;&quot;Operation failed - received 0 responses and 1 failures&quot;&lt;/span&gt; info={&lt;span class=&quot;code-quote&quot;&gt;&apos;failures&apos;&lt;/span&gt;: 1, &lt;span class=&quot;code-quote&quot;&gt;&apos;received_responses&apos;&lt;/span&gt;: 0, &lt;span class=&quot;code-quote&quot;&gt;&apos;required_responses&apos;&lt;/span&gt;: 1, &lt;span class=&quot;code-quote&quot;&gt;&apos;consistency&apos;&lt;/span&gt;: &lt;span class=&quot;code-quote&quot;&gt;&apos;ONE&apos;&lt;/span&gt;}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="15936928" author="adelapena" created="Wed, 22 Mar 2017 19:01:25 +0000"  >&lt;p&gt;I&apos;m working on an initial version of the patch &lt;a href=&quot;https://github.com/apache/cassandra/compare/trunk...adelapena:13247-trunk&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;here&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;The patch makes CQL validation layer to forbid &lt;tt&gt;SELECT&lt;/tt&gt; restrictions and &lt;tt&gt;CREATE INDEX&lt;/tt&gt; over non-frozen UDT columns, which are not supported operations. Both operations are still perfectly possible with frozen UDTs.&lt;/p&gt;</comment>
                            <comment id="15938407" author="adelapena" created="Thu, 23 Mar 2017 14:21:22 +0000"  >&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;&lt;a href=&quot;https://github.com/apache/cassandra/compare/trunk...adelapena:13247-trunk&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;trunk&lt;/a&gt;&lt;/th&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/adelapena/job/adelapena-13247-trunk-testall/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;utests&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/adelapena/job/adelapena-13247-trunk-dtest/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;dtests&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;&lt;a href=&quot;https://github.com/apache/cassandra/compare/cassandra-3.11...adelapena:13247-3.11&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;3.11&lt;/a&gt;&lt;/th&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/adelapena/job/adelapena-13247-3.11-testall/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;utests&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/adelapena/job/adelapena-13247-3.11-dtest/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;dtests&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;
</comment>
                            <comment id="15938576" author="blerer" created="Thu, 23 Mar 2017 15:32:12 +0000"  >&lt;p&gt;The patch looks good. Nice work &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;.&lt;/p&gt;

&lt;p&gt;I just have two minor nits:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;Can you remove the &lt;tt&gt;TODO&lt;/tt&gt; comment. If you think that adding such a feature might be usefull it is probably better to open a JIRA to keep track of it.&lt;/li&gt;
	&lt;li&gt;If you want to check that a query will not return any results in the unit tests it is better to use &lt;tt&gt;assertEmpty&lt;/tt&gt; as it is more explicite.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;No need to re-trigger CI for those changes.&lt;/p&gt;</comment>
                            <comment id="15938747" author="blerer" created="Thu, 23 Mar 2017 16:47:30 +0000"  >&lt;p&gt;+1&lt;/p&gt;</comment>
                            <comment id="15938748" author="blerer" created="Thu, 23 Mar 2017 16:48:33 +0000"  >&lt;p&gt;Committed into 3.11 at 82d3cdcd6cfeff043c92ea7a060498942130feb5 and merged into trunk.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12853916" name="udt_index.txt" size="19933" author="mashudong" created="Wed, 22 Feb 2017 09:19:24 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[adelapena]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 34 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3aflj:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12311421" key="com.atlassian.jira.plugin.system.customfieldtypes:multiversion">
                        <customfieldname>Reproduced In</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="12337344">3.9</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>blerer</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[blerer]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12963"><![CDATA[Critical]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>