<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 22:43:59 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-6825] Slice Queries Can Skip Intersecting SSTables</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-6825</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;Investigating another problem, I needed to do COUNT&lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/star_yellow.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; on the several partitions of a table immediately after a test case ran, and I discovered that count&lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/star_yellow.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; on the full table and on each of the partitions returned different counts.  &lt;/p&gt;

&lt;p&gt;In particular case, SELECT COUNT&lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/star_yellow.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; FROM sr LIMIT 1000000; returned the expected count from the test 99999 rows.  The composite primary key splits the logical row into six distinct partitions, and when I issue a query asking for the total across all six partitions, the returned result is only 83999.  Drilling down, I find that SELECT * from sr WHERE s = 5 AND l = 11 AND partition = 0; returns 30,000 rows, but a SELECT COUNT&lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/star_yellow.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; with the identical WHERE predicate reports only 14,000. &lt;/p&gt;

&lt;p&gt;This is failing immediately after running a single small test, such that there are only two SSTables, sr-jb-1 and sr-jb-2.  Compaction never needed to run.  &lt;/p&gt;

&lt;p&gt;In selectrowcounts.txt is a copy of the cqlsh output showing the incorrect count&lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/star_yellow.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; results.&lt;/p&gt;</description>
                <environment>&lt;p&gt;quad core Windows7 x64, single node cluster&lt;br/&gt;
Cassandra 2.0.5&lt;/p&gt;</environment>
        <key id="12699517">CASSANDRA-6825</key>
            <summary>Slice Queries Can Skip Intersecting SSTables</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10002" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Normal</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="thobbs">Tom Hobbs</assignee>
                                    <reporter username="wtmitchell3">Bill Mitchell</reporter>
                        <labels>
                    </labels>
                <created>Fri, 7 Mar 2014 21:57:03 +0000</created>
                <updated>Tue, 16 Apr 2019 09:31:52 +0000</updated>
                            <resolved>Wed, 2 Apr 2014 20:03:29 +0000</resolved>
                                        <fixVersion>2.0.7</fixVersion>
                    <fixVersion>2.1 beta2</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="13924392" author="wtmitchell3" created="Fri, 7 Mar 2014 22:08:55 +0000"  >&lt;p&gt;I&apos;ve also attached the cassandra.log from the period during which the test was running.  &lt;/p&gt;</comment>
                            <comment id="13924394" author="wtmitchell3" created="Fri, 7 Mar 2014 22:11:06 +0000"  >&lt;p&gt;In selectpartitions.txt, one can see the full selects for each of the separate partition values.&lt;/p&gt;</comment>
                            <comment id="13924454" author="jbellis" created="Fri, 7 Mar 2014 23:00:17 +0000"  >&lt;p&gt;Is this a single-node cluster?&lt;/p&gt;</comment>
                            <comment id="13924480" author="wtmitchell3" created="Fri, 7 Mar 2014 23:25:29 +0000"  >&lt;p&gt;Yes.  I&apos;ve added that to the environment description.  &lt;/p&gt;

&lt;p&gt;The partitioning is in the schema and in the code for when we move this to a non-trivial cluster.&lt;/p&gt;</comment>
                            <comment id="13924659" author="jbellis" created="Sat, 8 Mar 2014 02:04:57 +0000"  >&lt;p&gt;Can your team reproduce, Ryan?&lt;/p&gt;</comment>
                            <comment id="13924860" author="wtmitchell3" created="Sat, 8 Mar 2014 13:43:11 +0000"  >&lt;p&gt;If it helps in reproducing it, unlike my earlier report in &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-6736&quot; title=&quot;Windows7 AccessDeniedException on commit log &quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-6736&quot;&gt;&lt;del&gt;CASSANDRA-6736&lt;/del&gt;&lt;/a&gt;, this failure and that of &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-6826&quot; title=&quot;Query returns different number of results depending on fetchsize&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-6826&quot;&gt;&lt;del&gt;CASSANDRA-6826&lt;/del&gt;&lt;/a&gt; appear in a small volume test, less than 100,000 rows total.  This lower number was being run in a JUnit test as part of a maven build of a complete product, such that the test keyspace and tables were created, but the row insertion did not begin until 9 minutes later.  So Cassandra is not noting these as high-volume activity, and the row width is not large enough to provoke incremental compaction, or in fact any compaction whatsoever.  &lt;/p&gt;</comment>
                            <comment id="13926090" author="rhatch" created="Mon, 10 Mar 2014 19:33:58 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=wtmitchell3&quot; class=&quot;user-hover&quot; rel=&quot;wtmitchell3&quot;&gt;wtmitchell3&lt;/a&gt; &amp;#8211; I&apos;m working to reproduce this issue. To get as close to the mark can you provide me with a full schema for the table? (Mainly I&apos;m interested in which columns are part of the primary key &amp;#8211; aside from the siteid, listid, and partition).&lt;/p&gt;</comment>
                            <comment id="13926446" author="wtmitchell3" created="Mon, 10 Mar 2014 23:36:22 +0000"  >&lt;p&gt;After shortening the column names, the schema is: CREATE TABLE sr (s bigint, l bigint, partition int, cd timestamp, ec text, ea text, properties text, rd timestamp, PRIMARY KEY ((s, l, p), cd, ec)) WITH CLUSTERING ORDER BY (cd DESC, ec ASC).&lt;/p&gt;</comment>
                            <comment id="13942193" author="rhatch" created="Thu, 20 Mar 2014 19:48:31 +0000"  >&lt;p&gt;Unfortunately I was not able to reproduce this issue. I tried cassandra 2.0.5 on linux, and also on Win7 (tried with the python driver, and cqlsh for checking the counts). I was using java 1.7.0_51.&lt;/p&gt;</comment>
                            <comment id="13942232" author="wtmitchell3" created="Thu, 20 Mar 2014 20:24:55 +0000"  >&lt;p&gt;I can confirm the problem is still there in 2.0.6.  As I was verifying that I could still reproduce &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-6826&quot; title=&quot;Query returns different number of results depending on fetchsize&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-6826&quot;&gt;&lt;del&gt;CASSANDRA-6826&lt;/del&gt;&lt;/a&gt;, I checked for the COUNT&lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/star_yellow.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; issue too.  In one of the tables six partitions, a COUNT&lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/star_yellow.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; reported 10000 rows, but if I did a SELECT * in either ascending or descending order, cqlsh printed 20000 rows.  Would it help if I zipped up the data directory containing the table after the problem appeared?  Or would you need other information from the system directory, too, to see how the data is recorded? That might help in isolating how the problem arises.&lt;/p&gt;</comment>
                            <comment id="13942437" author="thobbs" created="Thu, 20 Mar 2014 22:39:56 +0000"  >&lt;p&gt;The overcounting problem seems to be limited to overwrites that end up in different SSTables (or a memtable).   If you write once, flush, and then overwrite, your count will be exactly 2x.&lt;/p&gt;</comment>
                            <comment id="13942500" author="thobbs" created="Thu, 20 Mar 2014 23:18:01 +0000"  >&lt;p&gt;Scratch that, I made a mistake in my test case (facepalm).  After fixing that, I&apos;m not able to reproduce.  &lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=billmichell&quot; class=&quot;user-hover&quot; rel=&quot;billmichell&quot;&gt;billmichell&lt;/a&gt;  A zip of your sstables could be useful if you can still provide that.&lt;/p&gt;</comment>
                            <comment id="13942757" author="wtmitchell3" created="Fri, 21 Mar 2014 04:01:31 +0000"  >&lt;p&gt;I&apos;ve attached a testdb_1395372407904.zip of the data/testdb_1395372407904 directory after the test ran.  After the test completed, I did select * from sr and it returned 100000 rows:&lt;/p&gt;

&lt;p&gt;cqlsh:testdb_1395372407904&amp;gt; select count&lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/star_yellow.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; from sr limit 100000;&lt;/p&gt;

&lt;p&gt; count&lt;br/&gt;
--------&lt;br/&gt;
 100000&lt;/p&gt;

&lt;p&gt;(1 rows)&lt;/p&gt;

&lt;p&gt;When I did a select count&lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/star_yellow.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; for each of the six partitions, they total only 90000:&lt;br/&gt;
cqlsh:testdb_1395372407904&amp;gt; select count&lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/star_yellow.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; from sr where siteID = &apos;4CA4F79E-3AB&lt;br/&gt;
2-41C5-AE42-C7009736F1D5&apos; and listID = 24 and partition = 0 LIMIT 100000;&lt;/p&gt;

&lt;p&gt; count&lt;br/&gt;
-------&lt;br/&gt;
 20000&lt;/p&gt;

&lt;p&gt;(1 rows)&lt;/p&gt;

&lt;p&gt;cqlsh:testdb_1395372407904&amp;gt; select count&lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/star_yellow.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; from sr where siteID = &apos;4CA4F79E-3AB&lt;br/&gt;
2-41C5-AE42-C7009736F1D5&apos; and listID = 24 and partition = 1 LIMIT 100000;&lt;/p&gt;

&lt;p&gt; count&lt;br/&gt;
-------&lt;br/&gt;
 20000&lt;/p&gt;

&lt;p&gt;(1 rows)&lt;/p&gt;

&lt;p&gt;cqlsh:testdb_1395372407904&amp;gt; select count&lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/star_yellow.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; from sr where siteID = &apos;4CA4F79E-3AB&lt;br/&gt;
2-41C5-AE42-C7009736F1D5&apos; and listID = 24 and partition = 2 LIMIT 100000;&lt;/p&gt;

&lt;p&gt; count&lt;br/&gt;
-------&lt;br/&gt;
 10000&lt;/p&gt;

&lt;p&gt;(1 rows)&lt;/p&gt;

&lt;p&gt;cqlsh:testdb_1395372407904&amp;gt; select count&lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/star_yellow.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; from sr where siteID = &apos;4CA4F79E-3AB&lt;br/&gt;
2-41C5-AE42-C7009736F1D5&apos; and listID = 24 and partition = 3 LIMIT 100000;&lt;/p&gt;

&lt;p&gt; count&lt;br/&gt;
-------&lt;br/&gt;
 10000&lt;/p&gt;

&lt;p&gt;(1 rows)&lt;/p&gt;

&lt;p&gt;cqlsh:testdb_1395372407904&amp;gt; select count&lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/star_yellow.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; from sr where siteID = &apos;4CA4F79E-3AB&lt;br/&gt;
2-41C5-AE42-C7009736F1D5&apos; and listID = 24 and partition = 4 LIMIT 100000;&lt;/p&gt;

&lt;p&gt; count&lt;br/&gt;
-------&lt;br/&gt;
 10000&lt;/p&gt;

&lt;p&gt;(1 rows)&lt;/p&gt;

&lt;p&gt;cqlsh:testdb_1395372407904&amp;gt; select count&lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/star_yellow.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; from sr where siteID = &apos;4CA4F79E-3AB&lt;br/&gt;
2-41C5-AE42-C7009736F1D5&apos; and listID = 24 and partition = 5 LIMIT 100000;&lt;/p&gt;

&lt;p&gt; count&lt;br/&gt;
-------&lt;br/&gt;
 20000&lt;/p&gt;

&lt;p&gt;(1 rows)&lt;/p&gt;

&lt;p&gt;As it turns out, the 10000 rows not counted were all from partition=2, and have a createDate identical except in the milliseconds to 10000 rows that do appear.  The common key values of the presumably uncounted rows (as they are the rows that did not return on the SELECT query, &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-6826&quot; title=&quot;Query returns different number of results depending on fetchsize&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-6826&quot;&gt;&lt;del&gt;CASSANDRA-6826&lt;/del&gt;&lt;/a&gt;) are siteID=4CA4F79E-3AB2-41C5-AE42-C7009736F1D5,listID=24,partition=2,createDate=2014-03-20T22:27:26.457-0500. &lt;/p&gt;</comment>
                            <comment id="13942881" author="wtmitchell3" created="Fri, 21 Mar 2014 08:21:27 +0000"  >&lt;p&gt;Tyler, you used an interesting word, &quot;flush&quot;.  After running a test with a different database name, I went back and looked at the first keyspace, as I did not drain the node before zipping the file the first time.  A third SSTable had now been written.  See the larger .zip file I have attached.  When I try the same statements through cqlsh, a SELECT * FROM sr WHERE ... AND partition = 2 now shows 20000 rows, but SELECT COUNT&lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/star_yellow.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; FROM sr WHERE ... AND partition=2 still returns a count of 10000.  So the count is still incorrect.  &lt;/p&gt;</comment>
                            <comment id="13943492" author="thobbs" created="Fri, 21 Mar 2014 20:16:53 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=wtmitchell3&quot; class=&quot;user-hover&quot; rel=&quot;wtmitchell3&quot;&gt;wtmitchell3&lt;/a&gt; what type is the siteid column supposed to be?  So far I&apos;ve tried varint, uuid, and text and had problems with each.   Just pasting &quot;DESCRIBE KEYSPACE testdb_xxxx&quot; from cqlsh would also work.&lt;/p&gt;</comment>
                            <comment id="13943586" author="wtmitchell3" created="Fri, 21 Mar 2014 21:31:40 +0000"  >&lt;p&gt;As it happens, I have that info handy as my JUnit testcase includes it in the log4j output:&lt;/p&gt;


&lt;p&gt;CREATE TABLE testdb_1395374703023.sr (&lt;br/&gt;
    siteid text,&lt;br/&gt;
    listid bigint,&lt;br/&gt;
    partition int,&lt;br/&gt;
    createdate timestamp,&lt;br/&gt;
    emailcrypt text,&lt;br/&gt;
    emailaddr text,&lt;br/&gt;
    properties text,&lt;br/&gt;
    removedate timestamp,&lt;br/&gt;
    PRIMARY KEY ((siteid, listid, partition), createdate, emailcrypt)&lt;br/&gt;
) WITH CLUSTERING ORDER BY (createdate DESC, emailcrypt ASC)&lt;br/&gt;
   AND read_repair_chance = 0.1&lt;br/&gt;
   AND dclocal_read_repair_chance = 0.0&lt;br/&gt;
   AND replicate_on_write = true&lt;br/&gt;
   AND gc_grace_seconds = 864000&lt;br/&gt;
   AND bloom_filter_fp_chance = 0.01&lt;br/&gt;
   AND caching = &apos;KEYS_ONLY&apos;&lt;br/&gt;
   AND comment = &apos;&apos;&lt;br/&gt;
   AND compaction = &lt;/p&gt;
{ &apos;class&apos; : &apos;org.apache.cassandra.db.compaction.SizeTieredCompactionStrategy&apos; }
&lt;p&gt;   AND compression = &lt;/p&gt;
{ &apos;sstable_compression&apos; : &apos;org.apache.cassandra.io.compress.SnappyCompressor&apos; }
&lt;p&gt;;&lt;/p&gt;

&lt;p&gt;(siteID was a BIGINT until recently when the schema was changed to TEXT to match the use of siteID elsewhere in the product.  I had not thought to represent our Java String as a Cassandra UUID.)&lt;/p&gt;</comment>
                            <comment id="13951200" author="thobbs" created="Fri, 28 Mar 2014 18:37:44 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=wtmitchell3&quot; class=&quot;user-hover&quot; rel=&quot;wtmitchell3&quot;&gt;wtmitchell3&lt;/a&gt; thanks! I can reproduce the issue now, so I should be able to track down what&apos;s going on.&lt;/p&gt;</comment>
                            <comment id="13951437" author="thobbs" created="Fri, 28 Mar 2014 21:35:56 +0000"  >&lt;p&gt;It loos like &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-6327&quot; title=&quot;select with &amp;quot;in&amp;quot; clause wrongly returns empty result&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-6327&quot;&gt;&lt;del&gt;CASSANDRA-6327&lt;/del&gt;&lt;/a&gt; is the cause for this.  The logic for testing sstables for inclusion when there&apos;s a composite comparator and multiple components in the slice filter is off.  This showed up for &lt;tt&gt;count(&amp;#42;)&lt;/tt&gt; because counting queries are always paged internally; the second page was erroneously skipping an sstable.  If the &lt;tt&gt;select *&lt;/tt&gt; query has the same page size (10k), it will also omit results.&lt;/p&gt;</comment>
                            <comment id="13956669" author="slebresne" created="Tue, 1 Apr 2014 15:49:58 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=thobbs&quot; class=&quot;user-hover&quot; rel=&quot;thobbs&quot;&gt;thobbs&lt;/a&gt; Any insights on what it off in the logic exactly?&lt;/p&gt;</comment>
                            <comment id="13956721" author="thobbs" created="Tue, 1 Apr 2014 16:28:43 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=slebresne&quot; class=&quot;user-hover&quot; rel=&quot;slebresne&quot;&gt;slebresne&lt;/a&gt; the logic is primarily broken because it continues checking latter components after it knows that the first component intersects.  For example, suppose you have a slice of &lt;tt&gt;((1, 1), &quot;&quot;)&lt;/tt&gt;, min column names of &lt;tt&gt;(0, 2)&lt;/tt&gt;, and max column names of &lt;tt&gt;(2, 3)&lt;/tt&gt;.  The first component of the slice start falls within the min/max range; the second component does not.  Although the slice is &lt;em&gt;starting&lt;/em&gt; outside of the min/max range for the second component, it should be considered intersecting because we&apos;ll accept other values for the second component (for higher values of the first component).  The current logic sees that the second component doesn&apos;t fall within min/max and considers it non-intersecting.&lt;/p&gt;</comment>
                            <comment id="13956963" author="thobbs" created="Tue, 1 Apr 2014 20:06:28 +0000"  >&lt;p&gt;The attached patch (and &lt;a href=&quot;https://github.com/thobbs/cassandra/tree/CASSANDRA-6825&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;branch&lt;/a&gt;) fixes &lt;tt&gt;CompositeType.intersects()&lt;/tt&gt; and adds unit tests.  I also added some basic debug logging around query paging, since there wasn&apos;t anything there.&lt;/p&gt;</comment>
                            <comment id="13957648" author="slebresne" created="Wed, 2 Apr 2014 13:35:20 +0000"  >&lt;p&gt;I&apos;m not sure the example above is really the one you meant (because I believe that the current code does return that there is intersection for that example), I think you meant something along the lines of a slice of say &lt;tt&gt;((1, 3), &quot;&quot;)&lt;/tt&gt; with min=&lt;tt&gt;(0, 1)&lt;/tt&gt; and max=&lt;tt&gt;(3, 2)&lt;/tt&gt;, but I agree there&apos;s a problem.&lt;/p&gt;

&lt;p&gt;The patch looks mostly good, but regarding the &quot;optimization&quot; inner loop in CompositeType.intersects, I believe it could be simplified to:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;for (int i = 0; i &amp;lt; Math.min(Math.min(start.length, finish.length), minColumnNames.size()); i++)
{
    AbstractType&amp;lt;?&amp;gt; t = types.get(i);
    if (t.compare(start[i], finish[i]) != 0)
        break;

    // we already know the first component falls within its min/max range (otherwise we wouldn&apos;t get here)
    if (i &amp;gt; 0 &amp;amp;&amp;amp; !t.intersects(minColumnNames.get(i), maxColumnNames.get(i), start[i], finish[i]))
        continue outer;
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Note in particular that we shouldn&apos;t assume that minColumnNames/maxColumnNames length is always bigger or equal that the slice bounds. But +1 if we agree on that change.&lt;/p&gt;</comment>
                            <comment id="13957836" author="thobbs" created="Wed, 2 Apr 2014 16:16:38 +0000"  >&lt;blockquote&gt;&lt;p&gt;I think you meant something along the lines of a slice of say &lt;tt&gt;((1, 3), &quot;&quot;)&lt;/tt&gt; with min=&lt;tt&gt;(0, 1)&lt;/tt&gt; and max=&lt;tt&gt;(3, 2)&lt;/tt&gt;&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Oops, you&apos;re correct there.&lt;/p&gt;

&lt;p&gt;Your simplification is good, except that the equality check for the start and finish needs to happen after the min/max intersects check.  Non-equal start/finish can still fall outside the min/max range.&lt;/p&gt;

&lt;p&gt;The v2 patch uses the simplification with that correction.  (The branch is also updated.)&lt;/p&gt;</comment>
                            <comment id="13957845" author="slebresne" created="Wed, 2 Apr 2014 16:30:08 +0000"  >&lt;blockquote&gt;&lt;p&gt;except that the equality check for the start and finish needs to happen after the min/max intersects check&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Hum, you&apos;re right, it just felt less natural for me to check the equals afterwards for some reason, but fair enough, +1 on v2&lt;/p&gt;</comment>
                            <comment id="13957990" author="thobbs" created="Wed, 2 Apr 2014 18:21:42 +0000"  >&lt;p&gt;Thanks, committed.&lt;/p&gt;</comment>
                            <comment id="13958057" author="thobbs" created="Wed, 2 Apr 2014 19:14:38 +0000"  >&lt;p&gt;Looks like I missed one case, which ended up breaking KeyspaceTest.testLimitSSTableComposites().  In particular, the sstable-skipping optimization can&apos;t stop at &lt;tt&gt;min(min(start.length, finish.length), minColumnNames.size())&lt;/tt&gt;, because it needs to handle starts and finishes of different lengths.&lt;/p&gt;

&lt;p&gt;6825-2.0-part2.txt corrects that and adds another case to CompositeTypeTest to explicitly cover this.&lt;/p&gt;</comment>
                            <comment id="13958067" author="slebresne" created="Wed, 2 Apr 2014 19:22:03 +0000"  >&lt;p&gt;Good catch, +1&lt;/p&gt;</comment>
                            <comment id="13958109" author="thobbs" created="Wed, 2 Apr 2014 20:03:29 +0000"  >&lt;p&gt;Thanks, part2 patch committed as well.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                                                <inwardlinks description="is duplicated by">
                                        <issuelink>
            <issuekey id="12699535">CASSANDRA-6826</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12638312" name="6825-2.0-part2.txt" size="2843" author="thobbs" created="Wed, 2 Apr 2014 19:14:38 +0000"/>
                            <attachment id="12638280" name="6825-2.0-v2.txt" size="27152" author="thobbs" created="Wed, 2 Apr 2014 16:16:38 +0000"/>
                            <attachment id="12638122" name="6825-2.0.txt" size="27650" author="thobbs" created="Tue, 1 Apr 2014 20:06:27 +0000"/>
                            <attachment id="12633471" name="cassandra.log" size="76248" author="wtmitchell3" created="Fri, 7 Mar 2014 22:08:55 +0000"/>
                            <attachment id="12633472" name="selectpartitions.zip" size="2812183" author="wtmitchell3" created="Fri, 7 Mar 2014 22:11:06 +0000"/>
                            <attachment id="12633470" name="selectrowcounts.txt" size="598" author="wtmitchell3" created="Fri, 7 Mar 2014 21:57:03 +0000"/>
                            <attachment id="12635975" name="testdb_1395372407904.zip" size="9659913" author="wtmitchell3" created="Fri, 21 Mar 2014 08:09:01 +0000"/>
                            <attachment id="12635952" name="testdb_1395372407904.zip" size="5672165" author="wtmitchell3" created="Fri, 21 Mar 2014 03:55:22 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>8.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[thobbs]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>377864</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            11 years, 33 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1t3zr:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>378156</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>slebresne</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[slebresne]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12962"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12311420" key="com.atlassian.jira.plugin.system.customfieldtypes:version">
                        <customfieldname>Since Version</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="12325322">2.0.3</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>