<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 22:22:18 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-2993] Issues with parameters being escaped correctly in Python CQL</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-2993</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;When using parameterised queries in Python CQL strings are not being escaped correctly.&lt;/p&gt;


&lt;p&gt;Query and Parameters:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-quote&quot;&gt;&apos;UPDATE sites SET :col = :val WHERE KEY = :site_id&apos;&lt;/span&gt;

{&lt;span class=&quot;code-quote&quot;&gt;&apos;col&apos;&lt;/span&gt;: &lt;span class=&quot;code-quote&quot;&gt;&apos;feed_stats:1312493736688033024&apos;&lt;/span&gt;,
 &lt;span class=&quot;code-quote&quot;&gt;&apos;site_id&apos;&lt;/span&gt;: &lt;span class=&quot;code-quote&quot;&gt;&apos;899d15e8-bd4a-11e0-bc8c-001fe14cba06&apos;&lt;/span&gt;,
 &lt;span class=&quot;code-quote&quot;&gt;&apos;val&apos;&lt;/span&gt;: &lt;span class=&quot;code-quote&quot;&gt;&quot;(dp0\nS&lt;span class=&quot;code-quote&quot;&gt;&apos;1&apos;&lt;/span&gt;\np1\n(lp2\nI1\naI2\naI3\naI4\nasS&lt;span class=&quot;code-quote&quot;&gt;&apos;0&apos;&lt;/span&gt;\np3\n(lp4\nI1\naI2\naI3\naI4\nasS&lt;span class=&quot;code-quote&quot;&gt;&apos;3&apos;&lt;/span&gt;\np5\n(lp6\nI1\naI2\naI3\naI4\nasS&lt;span class=&quot;code-quote&quot;&gt;&apos;2&apos;&lt;/span&gt;\np7\n(lp8\nI1\naI2\naI3\naI4\nas.&quot;&lt;/span&gt;}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Query trying to be executed after processing parameters&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;     
&lt;span class=&quot;code-quote&quot;&gt;&quot;UPDATE sites SET &lt;span class=&quot;code-quote&quot;&gt;&apos;feed_stats:1312493736688033024&apos;&lt;/span&gt; = &lt;span class=&quot;code-quote&quot;&gt;&apos;(dp0\nS&apos;&lt;/span&gt;&lt;span class=&quot;code-quote&quot;&gt;&apos;1&apos;&lt;/span&gt;&lt;span class=&quot;code-quote&quot;&gt;&apos;\np1\n(lp2\nI1\naI2\naI3\naI4\nasS&apos;&lt;/span&gt;&lt;span class=&quot;code-quote&quot;&gt;&apos;0&apos;&lt;/span&gt;&lt;span class=&quot;code-quote&quot;&gt;&apos;\np3\n(lp4\nI1\naI2\naI3\naI4\nasS&apos;&lt;/span&gt;&lt;span class=&quot;code-quote&quot;&gt;&apos;3&apos;&lt;/span&gt;&lt;span class=&quot;code-quote&quot;&gt;&apos;\np5\n(lp6\nI1\naI2\naI3\naI4\nasS&apos;&lt;/span&gt;&lt;span class=&quot;code-quote&quot;&gt;&apos;2&apos;&lt;/span&gt;&lt;span class=&quot;code-quote&quot;&gt;&apos;\np7\n(lp8\nI1\naI2\naI3\naI4\nas.&apos;&lt;/span&gt; WHERE KEY = &lt;span class=&quot;code-quote&quot;&gt;&apos;899d15e8-bd4a-11e0-bc8c-001fe14cba06&apos;&lt;/span&gt;&quot;&lt;/span&gt;

&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment>&lt;p&gt;Python CQL&lt;/p&gt;</environment>
        <key id="12517966">CASSANDRA-2993</key>
            <summary>Issues with parameters being escaped correctly in Python CQL</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10002" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Normal</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="thobbs">Tom Hobbs</assignee>
                                    <reporter username="bcvisin">Blake Visin</reporter>
                        <labels>
                            <label>CQL</label>
                            <label>parameter</label>
                            <label>python</label>
                    </labels>
                <created>Thu, 4 Aug 2011 21:54:05 +0000</created>
                <updated>Tue, 16 Apr 2019 09:32:54 +0000</updated>
                            <resolved>Wed, 10 Aug 2011 14:37:12 +0000</resolved>
                                        <fixVersion>0.8.4</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                                                                <comments>
                            <comment id="13079629" author="bcvisin" created="Thu, 4 Aug 2011 21:55:25 +0000"  >&lt;p&gt;This is using pickle to serialise objects in python.&lt;/p&gt;</comment>
                            <comment id="13081157" author="thobbs" created="Mon, 8 Aug 2011 19:49:41 +0000"  >&lt;p&gt;I think this is primarily an issue with multiline string literals, both in the CQL grammar and in the python driver.&lt;/p&gt;

&lt;p&gt;2993-pycql.txt updates the python cql driver regex to handle multiline SELECT clauses.&lt;/p&gt;

&lt;p&gt;2993-cql-grammar.txt makes the STRING_LITERAL token include &apos;\r&apos; and &apos;\n&apos;.&lt;/p&gt;

&lt;p&gt;2993-system-test.txt adds a system test for multiline keys, names, and values.&lt;/p&gt;</comment>
                            <comment id="13081271" author="bcvisin" created="Mon, 8 Aug 2011 22:52:03 +0000"  >&lt;p&gt;I believe Tyler is correct in his diagnosis and I think that the patches should fix the issues I am having.&lt;/p&gt;</comment>
                            <comment id="13081291" author="bcvisin" created="Mon, 8 Aug 2011 23:17:41 +0000"  >&lt;p&gt;Try:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;cql = &lt;span class=&quot;code-quote&quot;&gt;&apos;UPDATE sites SET :col = :val WHERE KEY = :site_id&apos;&lt;/span&gt;

vals = {&lt;span class=&quot;code-quote&quot;&gt;&apos;col&apos;&lt;/span&gt;: &lt;span class=&quot;code-quote&quot;&gt;&apos;feed_stats:1312493736688033024&apos;&lt;/span&gt;,
 &lt;span class=&quot;code-quote&quot;&gt;&apos;site_id&apos;&lt;/span&gt;: &lt;span class=&quot;code-quote&quot;&gt;&apos;29ffb9d2-c205-11e0-a2a2-001fe14cba06&apos;&lt;/span&gt;,
 &lt;span class=&quot;code-quote&quot;&gt;&apos;val&apos;&lt;/span&gt;: &lt;span class=&quot;code-quote&quot;&gt;&quot;(dp0\nS&lt;span class=&quot;code-quote&quot;&gt;&apos;1&apos;&lt;/span&gt;\np1\n(lp2\nI1\naI2\naI3\naI4\nasS&lt;span class=&quot;code-quote&quot;&gt;&apos;0&apos;&lt;/span&gt;\np3\n(lp4\nI1\naI2\naI3\naI4\nasS&lt;span class=&quot;code-quote&quot;&gt;&apos;3&apos;&lt;/span&gt;\np5\n(lp6\nI1\naI2\naI3\naI4\nasS&lt;span class=&quot;code-quote&quot;&gt;&apos;2&apos;&lt;/span&gt;\np7\n(lp8\nI1\naI2\naI3\naI4\nas.&quot;&lt;/span&gt;}

cursor = cql.connect(&lt;span class=&quot;code-quote&quot;&gt;&apos;cf&apos;&lt;/span&gt;)
cursor.execute(cql, vals)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;My Result (after patching with Tyler&apos;s pycql.txt, but not with cql-grammar.txt)&lt;br/&gt;
I am printing out the prepared query&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;USE totalporn;
UPDATE sites SET &lt;span class=&quot;code-quote&quot;&gt;&apos;feed_stats:1312493736688033024&apos;&lt;/span&gt; = &apos;(dp0
S&lt;span class=&quot;code-quote&quot;&gt;&apos;&apos;1&apos;&lt;/span&gt;&apos;
p1
(lp2
I1
aI2
aI3
aI4
asS&lt;span class=&quot;code-quote&quot;&gt;&apos;&apos;0&apos;&lt;/span&gt;&apos;
p3
(lp4
I1
aI2
aI3
aI4
asS&lt;span class=&quot;code-quote&quot;&gt;&apos;&apos;3&apos;&lt;/span&gt;&apos;
p5
(lp6
I1
aI2
aI3
aI4
asS&lt;span class=&quot;code-quote&quot;&gt;&apos;&apos;2&apos;&lt;/span&gt;&apos;
p7
(lp8
I1
aI2
aI3
aI4
as.&lt;span class=&quot;code-quote&quot;&gt;&apos; WHERE KEY = &apos;&lt;/span&gt;29ffb9d2-c205-11e0-a2a2-001fe14cba06&apos;
Traceback (most recent call last):
  File &lt;span class=&quot;code-quote&quot;&gt;&quot;/home/blake/test.py&quot;&lt;/span&gt;, line 10, in &amp;lt;module&amp;gt;
    cursor.execute(sql, vals)
  File &lt;span class=&quot;code-quote&quot;&gt;&quot;/usr/local/lib/python2.7/dist-packages/cql/cursor.py&quot;&lt;/span&gt;, line 135, in execute
    raise cql.ProgrammingError(&lt;span class=&quot;code-quote&quot;&gt;&quot;Bad Request: %s&quot;&lt;/span&gt; % ire.why)
cql.ProgrammingError: Bad Request: line 30:3 mismatched character &lt;span class=&quot;code-quote&quot;&gt;&apos;&apos;&apos; expecting &apos;&lt;/span&gt;.&apos;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;


&lt;p&gt;The string comes from a pickle&apos;d dict contaning strings as keys and a list as values:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; pickle

vals = {&lt;span class=&quot;code-quote&quot;&gt;&apos;col&apos;&lt;/span&gt;: &lt;span class=&quot;code-quote&quot;&gt;&apos;feed_stats:1312493736688033024&apos;&lt;/span&gt;,
 &lt;span class=&quot;code-quote&quot;&gt;&apos;site_id&apos;&lt;/span&gt;: &lt;span class=&quot;code-quote&quot;&gt;&apos;29ffb9d2-c205-11e0-a2a2-001fe14cba06&apos;&lt;/span&gt;,
 &lt;span class=&quot;code-quote&quot;&gt;&apos;val&apos;&lt;/span&gt;: &lt;span class=&quot;code-quote&quot;&gt;&quot;(dp0\nS&lt;span class=&quot;code-quote&quot;&gt;&apos;1&apos;&lt;/span&gt;\np1\n(lp2\nI1\naI2\naI3\naI4\nasS&lt;span class=&quot;code-quote&quot;&gt;&apos;0&apos;&lt;/span&gt;\np3\n(lp4\nI1\naI2\naI3\naI4\nasS&lt;span class=&quot;code-quote&quot;&gt;&apos;3&apos;&lt;/span&gt;\np5\n(lp6\nI1\naI2\naI3\naI4\nasS&lt;span class=&quot;code-quote&quot;&gt;&apos;2&apos;&lt;/span&gt;\np7\n(lp8\nI1\naI2\naI3\naI4\nas.&quot;&lt;/span&gt;}

print pickle.loads((vals[&lt;span class=&quot;code-quote&quot;&gt;&apos;val&apos;&lt;/span&gt;]))

&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;returns&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;{&lt;span class=&quot;code-quote&quot;&gt;&apos;1&apos;&lt;/span&gt;: [1, 2, 3, 4], &lt;span class=&quot;code-quote&quot;&gt;&apos;0&apos;&lt;/span&gt;: [1, 2, 3, 4], &lt;span class=&quot;code-quote&quot;&gt;&apos;3&apos;&lt;/span&gt;: [1, 2, 3, 4], &lt;span class=&quot;code-quote&quot;&gt;&apos;2&apos;&lt;/span&gt;: [1, 2, 3, 4]}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

</comment>
                            <comment id="13081391" author="thobbs" created="Tue, 9 Aug 2011 03:08:51 +0000"  >&lt;p&gt;Blake: after applying the cql-grammar patch (and doing &quot;ant clean&quot; before &quot;ant&quot;), this test case works for me.&lt;/p&gt;</comment>
                            <comment id="13081879" author="bcvisin" created="Tue, 9 Aug 2011 19:57:26 +0000"  >&lt;p&gt;Works for me too.  Thanks Tyler!&lt;/p&gt;</comment>
                            <comment id="13082369" author="xedin" created="Wed, 10 Aug 2011 14:37:12 +0000"  >&lt;p&gt;committed, thanks!&lt;/p&gt;</comment>
                            <comment id="13082395" author="hudson" created="Wed, 10 Aug 2011 15:24:53 +0000"  >&lt;p&gt;Integrated in Cassandra-0.8 #266 (See &lt;a href=&quot;https://builds.apache.org/job/Cassandra-0.8/266/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/Cassandra-0.8/266/&lt;/a&gt;)&lt;br/&gt;
    Fixes issues with parameters being escaped incorrectly in Python CQL&lt;br/&gt;
patch by Tyler Hobbs; reviewed by Pavel Yaskevich for &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-2993&quot; title=&quot;Issues with parameters being escaped correctly in Python CQL&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-2993&quot;&gt;&lt;del&gt;CASSANDRA-2993&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;xedin : &lt;a href=&quot;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1156198&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1156198&lt;/a&gt;&lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/cassandra/branches/cassandra-0.8/test/system/test_cql.py&lt;/li&gt;
	&lt;li&gt;/cassandra/branches/cassandra-0.8/CHANGES.txt&lt;/li&gt;
	&lt;li&gt;/cassandra/drivers/py/cql/cursor.py&lt;/li&gt;
	&lt;li&gt;/cassandra/branches/cassandra-0.8/src/java/org/apache/cassandra/cql/Cql.g&lt;/li&gt;
	&lt;li&gt;/cassandra/drivers/py/test/test_regex.py&lt;/li&gt;
&lt;/ul&gt;
</comment>
                    </comments>
                    <attachments>
                            <attachment id="12489734" name="2993-cql-grammar.txt" size="516" author="thobbs" created="Mon, 8 Aug 2011 19:49:41 +0000"/>
                            <attachment id="12489733" name="2993-pycql.txt" size="1356" author="thobbs" created="Mon, 8 Aug 2011 19:49:41 +0000"/>
                            <attachment id="12489735" name="2993-system-test.txt" size="1132" author="thobbs" created="Mon, 8 Aug 2011 19:49:41 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[thobbs]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>20928</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            14 years, 15 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0gepz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>93815</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>xedin</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[xedin]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12962"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>