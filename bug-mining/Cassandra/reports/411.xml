<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 22:15:34 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-1313] make cache sizes in CfDef Strings again so we can use %s of rows in the CF as in 0.6</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-1313</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;(note, this was reverted for 0.7 in &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-1394&quot; title=&quot;Blank listen_address/rpc_address no longer binds based on hostname&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-1394&quot;&gt;&lt;del&gt;CASSANDRA-1394&lt;/del&gt;&lt;/a&gt;)&lt;/p&gt;</description>
                <environment></environment>
        <key id="12470053">CASSANDRA-1313</key>
            <summary>make cache sizes in CfDef Strings again so we can use %s of rows in the CF as in 0.6</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10003" iconUrl="https://issues.apache.org/jira/images/icons/priorities/trivial.svg">Low</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="jhermes">Jon Hermes</assignee>
                                    <reporter username="jbellis">Jonathan Ellis</reporter>
                        <labels>
                    </labels>
                <created>Fri, 23 Jul 2010 22:21:05 +0000</created>
                <updated>Tue, 16 Apr 2019 09:33:20 +0000</updated>
                            <resolved>Fri, 13 Aug 2010 15:56:50 +0000</resolved>
                                        <fixVersion>0.7 beta 2</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                                                                <comments>
                            <comment id="12893383" author="jhermes" created="Wed, 28 Jul 2010 21:44:40 +0000"  >&lt;p&gt;Simply making {rows,keys}_cached strings instead of doubles is problematic. The current code looks for &apos;double {rows,keys}_cached&apos;, and changing every lookup is a non-trivial chunk of code. The lookup would also take extra cycles (or just two extra cycles if the first lookups cache the String-&amp;gt;Double operation).&lt;/p&gt;

&lt;p&gt;Loading a String into a Double from the YAML using snakeyaml directly has proven difficult:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;Getters and setters on the Config/RawKS/RawCF beans are never called, so there is no immediate hook.&lt;/li&gt;
	&lt;li&gt;Telling the constructor in DD that &quot;50%&quot; should be a double does not help the constructor parse the string into a double &amp;#8211; snakeyaml explodes.&lt;/li&gt;
	&lt;li&gt;Pushing the values into a String on the bean, then populating the double from the string leaves extra variables around. Also, these extra variables have to be named something different than {rows,keys}_cached, which means extra work in our 0.6-&amp;gt;0.7 Converter.&lt;/li&gt;
	&lt;li&gt;Pushing the values into a String on a FooConfig, then generating Config from FooConfig works, but means two passes on the load and hard to maintain later.&lt;/li&gt;
	&lt;li&gt;&lt;b&gt;Finally,&lt;/b&gt; change the snakeyaml code directly. Whenever it sees a number followed by a percent, it should correctly construct a FloatType (be it Float, Double, or BigDecimal according to destination).&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;I decided the best fix is to effect a change in snakeyaml as outlined above (and tracked at: &lt;a href=&quot;http://code.google.com/p/snakeyaml/issues/detail?id=75&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://code.google.com/p/snakeyaml/issues/detail?id=75&lt;/a&gt; ).&lt;/p&gt;

&lt;p&gt;Attached are 3 things:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;The patch to snakeyaml trunk, named snakeyaml-percentToFloat.txt,&lt;/li&gt;
	&lt;li&gt;The lib built from trunk after patch applied, named snakeyaml-r1131-dev1.jar,&lt;/li&gt;
	&lt;li&gt;and a patch for C trunk (changes conf/cassandra.yaml and test/conf/cassandra.yaml), named 1313.txt.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;With this, the values legal for {rows,keys}_cached is a literal (1000, 0.5, 0) or a string (&quot;1000&quot;, &quot;50%&quot;, &quot;0%&quot;). As before, a value between &lt;span class=&quot;error&quot;&gt;&amp;#91;0,1&amp;#93;&lt;/span&gt; is a fraction of the total, and all larger values are absolute. Because this is a change to the parser, you can also give percents anywhere else a double is expected (read_repair_chance: &apos;72.25%&apos; if you want).&lt;/p&gt;

&lt;p&gt;Should this change not be accepted, one of the above methods can be employed in our code, or I can override-in all the functionality of the patch (though the code will look like a trainwreck).&lt;/p&gt;</comment>
                            <comment id="12893384" author="jhermes" created="Wed, 28 Jul 2010 21:46:08 +0000"  >&lt;p&gt;Attached debugging patch to print the values of {rows,keys}_cached to STDOUT when the config is first loaded.&lt;br/&gt;
Named snakeyaml-output.patch.&lt;/p&gt;</comment>
                            <comment id="12893419" author="mdennis" created="Wed, 28 Jul 2010 23:18:24 +0000"  >&lt;p&gt;+1 on the approach.  I&apos;d like to see snakeyaml adopt this patch.&lt;/p&gt;</comment>
                            <comment id="12893484" author="jbellis" created="Thu, 29 Jul 2010 02:53:18 +0000"  >&lt;p&gt;I like this, too.  Nice work.&lt;/p&gt;</comment>
                            <comment id="12894062" author="py4fun" created="Fri, 30 Jul 2010 15:14:05 +0000"  >&lt;p&gt;You do not need to patch SnakeYAML to achieve the goal. SnakeYAML has the following feature: any scalar which matches a given regular expression can be constructed with some custom code.&lt;br/&gt;
Examples can be found in the tests.&lt;/p&gt;

&lt;p&gt;We shall think twice before we patch SnakeYAML. Appending &apos;%&apos; to a number is not a common pattern. It is not part of the YAML specification. Other users may be confused when they get Float when they expect String&lt;/p&gt;

&lt;p&gt;-&lt;br/&gt;
Andrey &lt;/p&gt;</comment>
                            <comment id="12895793" author="jhermes" created="Thu, 5 Aug 2010 20:47:38 +0000"  >&lt;p&gt;Replacing snakeyaml with yamlbeans.&lt;/p&gt;

&lt;p&gt;Status:&lt;br/&gt;
M       conf/cassandra.yaml&lt;br/&gt;
D       src/java/org/apache/cassandra/utils/SkipNullRepresenter.java&lt;br/&gt;
M       src/java/org/apache/cassandra/tools/NodeProbe.java&lt;br/&gt;
M       src/java/org/apache/cassandra/tools/SchemaTool.java&lt;br/&gt;
M       src/java/org/apache/cassandra/service/StorageService.java&lt;br/&gt;
M       src/java/org/apache/cassandra/service/StorageServiceMBean.java&lt;br/&gt;
M       src/java/org/apache/cassandra/config/DatabaseDescriptor.java&lt;br/&gt;
M       src/java/org/apache/cassandra/config/Config.java&lt;br/&gt;
M       src/java/org/apache/cassandra/config/Converter.java&lt;br/&gt;
M       src/java/org/apache/cassandra/config/RawColumnFamily.java&lt;br/&gt;
M       NOTICE.txt&lt;br/&gt;
D       lib/snakeyaml-1.6.jar&lt;br/&gt;
A       lib/yamlbeans-1.04.jar&lt;/p&gt;

&lt;p&gt;Reading the config and loading keyspaces works properly.&lt;br/&gt;
Exporting keyspaces (using schematool) works properly given a target output file.&lt;br/&gt;
Converting from 0.6 to 0.7 has no diff from using snakeyaml.&lt;/p&gt;</comment>
                            <comment id="12895797" author="jhermes" created="Thu, 5 Aug 2010 20:56:21 +0000"  >&lt;p&gt;Re-attaching snakeyaml approach.&lt;/p&gt;</comment>
                            <comment id="12895800" author="jhermes" created="Thu, 5 Aug 2010 20:58:00 +0000"  >&lt;p&gt;And lastly fixing 1313-YB.txt to remove debug statements.&lt;/p&gt;</comment>
                            <comment id="12896033" author="py4fun" created="Fri, 6 Aug 2010 13:46:24 +0000"  >&lt;p&gt;Jon, may I kindly ask you to clarify your decision ?&lt;/p&gt;

&lt;p&gt;1)  you requested to change SnakeYAML without clear message what other users (not only Cassandra) will gain from such a change&lt;br/&gt;
2) I have provided you with a solution (&lt;a href=&quot;http://code.google.com/p/snakeyaml/source/browse/src/test/java/examples/CustomImplicitResolverTest.java&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://code.google.com/p/snakeyaml/source/browse/src/test/java/examples/CustomImplicitResolverTest.java&lt;/a&gt;) which you can copy-and-paste to your code with minimum effort. You did not give any feedback back to the SnakeYAML community (&lt;a href=&quot;http://code.google.com/p/snakeyaml/issues/detail?id=75&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://code.google.com/p/snakeyaml/issues/detail?id=75&lt;/a&gt;). Why the solution did not work ?&lt;br/&gt;
3) using YamlBeans does not actually solve your problem. As far as I can see you introduced &quot;These getters/setters allow us to read X% in as a double&quot;. The same can be done with SnakeYAML&lt;br/&gt;
4) Be aware that SnakeYAML implements complete 1.1 YAML specification and it has many other unique features not available in YamlBeans.&lt;/p&gt;


&lt;p&gt;I strongly believe that communication is the best way to quickly solve the issues. SnakeYAML is open for suggestions and we are glad to help others to use the library. But we also expect that the community explains the decision and help us to improve SnakeYAML where it needs to be improved.&lt;/p&gt;</comment>
                            <comment id="12896076" author="jhermes" created="Fri, 6 Aug 2010 16:24:51 +0000"  >&lt;p&gt;1) I&apos;ve made it painfully clear why I offered the patch to the community.&lt;br/&gt;
2) I have many good solutions now. This has been a solved problem for a while. There is a reason why snakeyaml-75 is marked as an Enhancement, not a Bug.&lt;br/&gt;
3,4) Switching to YamlBeans was not because I couldn&apos;t solve the problem without it, but because the code is much easier to read, smaller, and removed many lines of our code.&lt;/p&gt;

&lt;p&gt;If you still desire clarification, feel free to e-mail me. Unless there are complications on this defect, I&apos;m considering it finished and moving on to other things. As for snakeyaml-75, I&apos;m leaving it open to be closed as Invalid at your discretion.&lt;/p&gt;</comment>
                            <comment id="12898289" author="jbellis" created="Fri, 13 Aug 2010 15:56:50 +0000"  >&lt;p&gt;committed, w/ removal of commented-out snakeyaml code and printStackTrace calls&lt;/p&gt;</comment>
                            <comment id="12898584" author="hudson" created="Sat, 14 Aug 2010 12:48:35 +0000"  >&lt;p&gt;Integrated in Cassandra #514 (See &lt;a href=&quot;http://hudson.zones.apache.org/hudson/job/Cassandra/514/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://hudson.zones.apache.org/hudson/job/Cassandra/514/&lt;/a&gt;)&lt;br/&gt;
    add back percentage option for cache size configuration, and replace SnakeYAML with YamlBeans.  patch by Jon Hermes; reviewed by jbellis for &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-1313&quot; title=&quot;make cache sizes in CfDef Strings again so we can use %s of rows in the CF as in 0.6&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-1313&quot;&gt;&lt;del&gt;CASSANDRA-1313&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12451370" name="1313-SY.txt" size="236800" author="jhermes" created="Thu, 5 Aug 2010 20:56:21 +0000"/>
                            <attachment id="12451373" name="1313-YB.txt" size="252447" author="jhermes" created="Thu, 5 Aug 2010 20:58:00 +0000"/>
                            <attachment id="12451371" name="snakeyaml-percentToFloat.txt" size="6161" author="jhermes" created="Thu, 5 Aug 2010 20:56:21 +0000"/>
                            <attachment id="12451372" name="snakeyaml-r1131-dev.jar" size="248002" author="jhermes" created="Thu, 5 Aug 2010 20:56:21 +0000"/>
                            <attachment id="12451368" name="yamlbeans-1.04.jar" size="131101" author="jhermes" created="Thu, 5 Aug 2010 20:47:38 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>5.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[jhermes]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>20075</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            15 years, 15 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0g4an:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>92126</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12961"><![CDATA[Low]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>