<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 22:43:24 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-6827] Using static with a counter column is broken</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-6827</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;From a client:&lt;br/&gt;
Looks like there is a problem with serialisation//deserialisation of static counters. &lt;br/&gt;
It reproduces on the 2.0 branch, but doesn&apos;t appear to be a problem on trunk.&lt;/p&gt;

&lt;p&gt;Here is a small cql script which reproduces the problem:&lt;/p&gt;

&lt;p&gt;CREATE KEYSPACE ks1 WITH replication = &lt;/p&gt;
{&apos;class&apos;: &apos;SimpleStrategy&apos;, &apos;replication_factor&apos;: 1}
&lt;p&gt;; &lt;br/&gt;
use ks1; &lt;br/&gt;
CREATE COLUMNFAMILY problematic ( stat_cnt counter static, norm_cnt counter, pk text, ck text, PRIMARY KEY (pk, ck) ); &lt;br/&gt;
UPDATE problematic SET stat_cnt = stat_cnt + 1 WHERE pk = &apos;foo&apos;; &lt;br/&gt;
SELECT * FROM problematic ;&lt;/p&gt;

&lt;p&gt;and an example of the error from cqlsh: &lt;br/&gt;
cqlsh:ks1&amp;gt; SELECT * FROM problematic ;&lt;/p&gt;

&lt;p&gt;pk | ck | stat_cnt | norm_cnt &lt;br/&gt;
----&lt;del&gt;&lt;ins&gt;&lt;/del&gt;----&lt;del&gt;&lt;/ins&gt;&lt;/del&gt;------------------------------------------------------------------------------------------------------------------------------------&lt;del&gt;+&lt;/del&gt;--------- &lt;br/&gt;
foo | null | &apos;\x00\x01\x00\x00\xf1$\t`\xa6\x1d\x11\xe3\x82\x9a\x9fqi\x80\x1f\xec\x00\x00\x00\x00\x00\x00\x00\x01\x00\x00\x00\x00\x00\x00\x00\x01&apos; | null&lt;/p&gt;

&lt;p&gt;(1 rows)&lt;/p&gt;

&lt;p&gt;Failed to decode value &apos;\x00\x01\x00\x00\xf1$\t`\xa6\x1d\x11\xe3\x82\x9a\x9fqi\x80\x1f\xec\x00\x00\x00\x00\x00\x00\x00\x01\x00\x00\x00\x00\x00\x00\x00\x01&apos; (for column &apos;stat_cnt&apos;) as counter: unpack requires a string argument of length 8&lt;/p&gt;

&lt;p&gt;It seems like the problem lies in SelectStatement, it doesn&apos;t resolve the counter and ends up sending the entire 36 bytes of raw counter rather than the 8 bytes.&lt;/p&gt;

&lt;p&gt;In select statement we seem to keep the bytebuffer and then in two different places we end up calling the following method:&lt;/p&gt;

&lt;p&gt;Selection.ResultSetBuilder.add(ByteBuffer v ) &lt;br/&gt;
rather than: add(Column c) &lt;br/&gt;
(Which in turn calls value() and invokes the CounterContext)&lt;/p&gt;

&lt;p&gt;I suppose the fix is just to ensure that the CounterContext is invoked for static counters. &lt;br/&gt;
I can see various ways and places of putting it in place. &lt;br/&gt;
Presumably you&apos;d want to reconcile the static counters just once, earlier and keep the resolved value around to be ouput in several rows. &lt;br/&gt;
I suppose somewhere here either by extending the ternary or changing getSimpleValue : &lt;br/&gt;
staticValues.put(name, name.type.isCollection() ? getCollectionValue(name, group) : getSimpleValue(name, group));&lt;/p&gt;

&lt;p&gt;ColumnGroupMap seems to contain the relevant byte buffers and has methods: &lt;br/&gt;
getCollection &lt;br/&gt;
getSimple &lt;br/&gt;
which could be extended to contain some counter related call wrapped in SelectStatement similarly.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12699561">CASSANDRA-6827</key>
            <summary>Using static with a counter column is broken</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10003" iconUrl="https://issues.apache.org/jira/images/icons/priorities/trivial.svg">Low</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="aleksey">Aleksey Yeschenko</assignee>
                                    <reporter username="jeremiah">Jeremiah Jordan</reporter>
                        <labels>
                    </labels>
                <created>Sat, 8 Mar 2014 01:15:47 +0000</created>
                <updated>Tue, 14 Oct 2025 12:09:27 +0000</updated>
                            <resolved>Wed, 12 Mar 2014 12:09:57 +0000</resolved>
                                        <fixVersion>2.0.7</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="13931574" author="slebresne" created="Wed, 12 Mar 2014 09:23:07 +0000"  >&lt;p&gt;+1&lt;/p&gt;</comment>
                            <comment id="13931682" author="iamaleksey" created="Wed, 12 Mar 2014 12:09:57 +0000"  >&lt;p&gt;Committed, thanks.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12633528" name="6827.txt" size="2914" author="aleksey" created="Sat, 8 Mar 2014 06:49:35 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[aleksey]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>377908</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            11 years, 36 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1t49j:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>378200</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12311421" key="com.atlassian.jira.plugin.system.customfieldtypes:multiversion">
                        <customfieldname>Reproduced In</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="12325761">2.0.5</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>slebresne</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[slebresne]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12961"><![CDATA[Low]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>