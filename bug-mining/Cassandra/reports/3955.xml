<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 22:59:28 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-9355] RecoveryManagerTruncateTest fails in test-compression</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-9355</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;$ ant test-compression -Dtest.name=RecoveryManagerTruncateTest
...
    [junit] Testsuite: org.apache.cassandra.db.RecoveryManagerTruncateTest
    [junit] Tests run: 3, Failures: 1, Errors: 0, Skipped: 0, Time elapsed: 9.221 sec
    [junit] 
    [junit] Testcase: testTruncatePointInTimeReplayList(org.apache.cassandra.db.RecoveryManagerTruncateTest):   FAILED
    [junit] 
    [junit] junit.framework.AssertionFailedError: 
    [junit]     at org.apache.cassandra.db.RecoveryManagerTruncateTest.testTruncatePointInTimeReplayList(RecoveryManagerTruncateTest.java:159)
    [junit] 
    [junit] 
    [junit] Test org.apache.cassandra.db.RecoveryManagerTruncateTest FAILED
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;system.log from just this failed test attached.&lt;/p&gt;</description>
                <environment>&lt;p&gt;2.1 commit: ac70e37&lt;/p&gt;</environment>
        <key id="12828999">CASSANDRA-9355</key>
            <summary>RecoveryManagerTruncateTest fails in test-compression</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10002" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Normal</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="aweisberg">Ariel Weisberg</assignee>
                                    <reporter username="mshuler">Michael Shuler</reporter>
                        <labels>
                    </labels>
                <created>Mon, 11 May 2015 23:15:57 +0000</created>
                <updated>Tue, 16 Apr 2019 09:31:11 +0000</updated>
                            <resolved>Mon, 23 Nov 2015 17:18:29 +0000</resolved>
                                        <fixVersion>2.1.12</fixVersion>
                                    <component>Legacy/Testing</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="14538856" author="mshuler" created="Mon, 11 May 2015 23:20:20 +0000"  >&lt;p&gt;This test looks like it passes in trunk, currently.&lt;/p&gt;</comment>
                            <comment id="14982807" author="iamaleksey" created="Fri, 30 Oct 2015 16:27:44 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mshuler&quot; class=&quot;user-hover&quot; rel=&quot;mshuler&quot;&gt;mshuler&lt;/a&gt; is it still relevant?&lt;/p&gt;</comment>
                            <comment id="14986071" author="mshuler" created="Mon, 2 Nov 2015 21:15:30 +0000"  >&lt;p&gt;This does appear to fail periodically:&lt;br/&gt;
&lt;a href=&quot;http://cassci.datastax.com/job/cassandra-2.1_utest_compression/lastCompletedBuild/testReport/org.apache.cassandra.db/RecoveryManagerTruncateTest/history/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://cassci.datastax.com/job/cassandra-2.1_utest_compression/lastCompletedBuild/testReport/org.apache.cassandra.db/RecoveryManagerTruncateTest/history/&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14994092" author="aweisberg" created="Fri, 6 Nov 2015 18:05:01 +0000"  >&lt;p&gt;I added a CL sync to each test before the reset and recovery since the others have been flaky historically.&lt;/p&gt;

&lt;p&gt;It looks like the CL replayer looked for the sync entry and the sync entry is only written if there is a sync.&lt;/p&gt;

&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/apache/cassandra/compare/apache:cassandra-2.1...aweisberg:CASSANDRA-9355-2.1?expand=1&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;2.1 code&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/aweisberg/job/aweisberg-CASSANDRA-9355-2.1-testall/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;utests&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/aweisberg/job/aweisberg-CASSANDRA-9355-2.1-dtest/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;dtests&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;


&lt;p&gt;Assigning to Benedict for review since he is familiar with the CL and this isn&apos;t a rush job.&lt;/p&gt;</comment>
                            <comment id="14994117" author="aweisberg" created="Fri, 6 Nov 2015 18:11:03 +0000"  >&lt;p&gt;Posted my comment that precedes the patch submission under &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-9358&quot; title=&quot;RecoveryManagerTruncateTest.testTruncatePointInTimeReplayList times out periodically&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-9358&quot;&gt;&lt;del&gt;CASSANDRA-9358&lt;/del&gt;&lt;/a&gt; and also misnamed the branch. Will fix it. Here is the comment.&lt;/p&gt;

&lt;p&gt;Adding a commit log sync before reseting and restoring from PIT fixes this test. It&apos;s not super reproducible on my Linux box although it will happen in a loop. On OS X it fails pretty reliably.&lt;/p&gt;

&lt;p&gt;I am going to dig a little deeper into why a sync is necessary for the commit log contents to be usable. &lt;/p&gt;

&lt;p&gt;When it fails I see this in the log&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;    [junit] WARN  17:32:49 Encountered bad header at position 16 of commit log /home/aweisberg/cassandra/build/test/cassandra/commitlog:0/CommitLog-4-1446831167254.log, with invalid CRC. The end of segment marker should be zero.
    [junit] WARN  17:32:49 Encountered bad header at position 16 of commit log /home/aweisberg/cassandra/build/test/cassandra/commitlog:0/CommitLog-4-1446831167254.log, with invalid CRC. The end of segment marker should be zero.
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="15006616" author="blambov" created="Mon, 16 Nov 2015 12:41:54 +0000"  >&lt;p&gt;We only replay mutations up to the last correct sync header, mutations made after that will follow an empty or invalid sync header which is treated as an end marker. I think this was done to ensure we don&apos;t replay data from the previous write cycle on this segment when they were being reused.&lt;/p&gt;

&lt;p&gt;The test is not failing in 2.2 and later, because a sync is part of closing the segment during CommitLog shutdown. 2.1 will also sync once after shutdown is requested, but not during &lt;tt&gt;resetUnsafe&lt;/tt&gt; as used by tests. Perhaps a more thorough solution is to include a sync (and wait for it to complete) as part of the latter?&lt;/p&gt;</comment>
                            <comment id="15006842" author="aweisberg" created="Mon, 16 Nov 2015 16:06:55 +0000"  >&lt;p&gt;We could try that. It&apos;s a pretty invasive change in that tests that weren&apos;t expecting a sync would be getting a sync and might no longer test what they were expecting to test.&lt;/p&gt;

&lt;p&gt;Alternate version&lt;/p&gt;
&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/apache/cassandra/compare/apache:cassandra-2.1...aweisberg:CASSANDRA-9355-2.1-v2?expand=1&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;2.1 code&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/aweisberg/job/aweisberg-CASSANDRA-9355-2.1-v2-testall/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;utests&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/aweisberg/job/aweisberg-CASSANDRA-9355-2.1-v2-dtest/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;dtests&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;
</comment>
                            <comment id="15006846" author="blambov" created="Mon, 16 Nov 2015 16:12:51 +0000"  >&lt;p&gt;The links don&apos;t appear to be pointing to the right place (did the push succeed?).&lt;/p&gt;</comment>
                            <comment id="15006867" author="aweisberg" created="Mon, 16 Nov 2015 16:23:45 +0000"  >&lt;p&gt;Sorry wrong branch name&lt;/p&gt;</comment>
                            <comment id="15008547" author="blambov" created="Tue, 17 Nov 2015 12:02:13 +0000"  >&lt;p&gt;Both options look good to me. I personally prefer the latter as that&apos;s what we do in 2.2+, but it&apos;s up to you to choose the one to go with.&lt;/p&gt;</comment>
                            <comment id="15017740" author="slebresne" created="Fri, 20 Nov 2015 12:51:10 +0000"  >&lt;p&gt;It&apos;s not 100% clear from the comments above which branch exactly is &quot;ready to commit&quot;. Is that &lt;a href=&quot;https://github.com/aweisberg/cassandra/commits/CASSANDRA-9355-2.1-v2&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/aweisberg/cassandra/commits/CASSANDRA-9355-2.1-v2&lt;/a&gt; ?&lt;/p&gt;</comment>
                            <comment id="15018316" author="aweisberg" created="Fri, 20 Nov 2015 16:51:39 +0000"  >&lt;p&gt;We are going to go with v2 (the one you linked). Also only merging this to 2.1 as it appears to pass in later versions.&lt;/p&gt;</comment>
                            <comment id="15022502" author="iamaleksey" created="Mon, 23 Nov 2015 17:16:55 +0000"  >&lt;p&gt;Committed as &lt;a href=&quot;https://github.com/apache/cassandra/commit/4a94f75b0177cab18539317c3f58db2014091a9b&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;4a94f75b0177cab18539317c3f58db2014091a9b&lt;/a&gt; to 2.1, thanks.&lt;/p&gt;</comment>
                            <comment id="15022506" author="iamaleksey" created="Mon, 23 Nov 2015 17:18:29 +0000"  >&lt;p&gt;I did accidentally put &apos;reviewed by Aleksey Yeschenko&apos; instead of &apos;reviewed by Branimir Lambov&apos; in the commit message. My apologies to &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=blambov&quot; class=&quot;user-hover&quot; rel=&quot;blambov&quot;&gt;blambov&lt;/a&gt;.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12732054" name="system.log" size="1246065" author="mshuler" created="Mon, 11 May 2015 23:15:57 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[aweisberg]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2el6n:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>blambov</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[blambov]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12962"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>