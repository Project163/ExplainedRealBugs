<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 23:33:47 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-20659] Gossip doesn&apos;t converge due to race condition when updating EndpointStates multiple fields</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-20659</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;The issue seen is during shrinks or token moves the cluster gets into a state where some of the nodes never converge and see the latest STATUS state for the changed peers.&lt;/p&gt;

&lt;p&gt;In testing this it was found that:&lt;/p&gt;

&lt;p&gt;1) org.apache.cassandra.gms.Gossiper#applyStateLocally expects to run in a single thread, so doesn&apos;t take any locks&lt;br/&gt;
2) org.apache.cassandra.gms.Gossiper.GossipTask runs in another thread and uses a taskLock to avoid sending partial state&lt;br/&gt;
3) org.apache.cassandra.gms.Gossiper#applyNewStates gets called when the generation matches, and tries to apply the state sequentially.&lt;/p&gt;

&lt;p&gt;The theory (and test) is&lt;/p&gt;

&lt;p&gt;1) localState.setHeartBeatState(remoteState.getHeartBeatState()); runs&lt;br/&gt;
2) something (gossip or paxos) read the state&lt;br/&gt;
3) localState.addApplicationStates(updatedStates); updates the state&lt;/p&gt;

&lt;p&gt;the &quot;something&quot; in step 2 sends around the heartbeat which cause others to see a higher max version, so the delta logic won&apos;t see the mutations done in step 3&lt;/p&gt;</description>
                <environment></environment>
        <key id="13618578">CASSANDRA-20659</key>
            <summary>Gossip doesn&apos;t converge due to race condition when updating EndpointStates multiple fields</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10002" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Normal</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="dcapwell">David Capwell</assignee>
                                    <reporter username="dcapwell">David Capwell</reporter>
                        <labels>
                    </labels>
                <created>Mon, 19 May 2025 22:37:45 +0000</created>
                <updated>Thu, 22 May 2025 23:13:30 +0000</updated>
                            <resolved>Thu, 22 May 2025 21:20:03 +0000</resolved>
                                        <fixVersion>4.0.18</fixVersion>
                    <fixVersion>4.1.10</fixVersion>
                    <fixVersion>5.0.5</fixVersion>
                    <fixVersion>5.1</fixVersion>
                                    <component>Cluster/Gossip</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                    <progress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                            <timeestimate seconds="0">0h</timeestimate>
                            <timespent seconds="4200">1h 10m</timespent>
                                <comments>
                            <comment id="17952840" author="beobal" created="Tue, 20 May 2025 12:24:01 +0000"  >&lt;p&gt;Trunk should not be affected in the same way as earlier versions because:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;Node status is derived from ClusterMetadata not gossip, so although we still propagate app states like STATUS_WITH_PORT for instance, these don&apos;t materially affect things like replica placement etc. &lt;tt&gt;StorageService::onChange&lt;/tt&gt; does very little in trunk and could probably do even less.&lt;/li&gt;
	&lt;li&gt;Paxos no longer relies on/mutates gossip state during electorate verification.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Gossip state is now the source of truth only for transient node state like LOAD &amp;amp; RPC_READY. For persistent state such as STATUS_WITH_PORT, DC, RACK, this is all derived from ClusterMetadata. &lt;br/&gt;
So there is probably some scope on trunk for further cleaning up of the processing of gossip state/changes in state, but I think this is mostly just housekeeping.&lt;/p&gt;</comment>
                            <comment id="17953209" author="dcapwell" created="Wed, 21 May 2025 17:16:04 +0000"  >&lt;p&gt;Thanks for the reply &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=samt&quot; class=&quot;user-hover&quot; rel=&quot;samt&quot;&gt;samt&lt;/a&gt;!  The issue was found in 4.1 and the first patch was written there, but my habit is to patch trunk then back port (was about to back port to 4.0 right now as Brandon/Blake both gave thumbs up on direction).&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;Gossip state is now the source of truth only for transient node state like LOAD &amp;amp; RPC_READY.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;And SEVERITY =)&lt;/p&gt;

&lt;p&gt;The trunk patch makes this logic more likely to progress, but to your point the impact is mostly to 4.x and 5.0; TCM solves all problems =D.&lt;/p&gt;

&lt;p&gt;Gossip is mostly in sync cross all branches (other than shadow) so the patch is likely to be very much the same... ill get the 4.x / 5.0 patches out today&lt;/p&gt;</comment>
                            <comment id="17953230" author="brandon.williams" created="Wed, 21 May 2025 18:51:30 +0000"  >&lt;p&gt;4.x/5 branches look good, +1 if CI is happy too.&lt;/p&gt;</comment>
                            <comment id="17953231" author="dcapwell" created="Wed, 21 May 2025 18:53:05 +0000"  >&lt;p&gt;+1 in GH and slack&lt;/p&gt;</comment>
                            <comment id="17953549" author="dcapwell" created="Thu, 22 May 2025 21:55:29 +0000"  >&lt;p&gt;Failed Builds:&lt;/p&gt;
&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;Build&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;Result&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;Reason&lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; jvm-dtest-simulator &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; unknown &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; No test results found                                                                                &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; jvm-upgrade-dtests  &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; fail    &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; Test org.apache.cassandra.distributed.upgrade.CompactStoragePagingWithProtocolV30Test::testPagingWit &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; jvm8-dtests         &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; fail    &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; Test org.apache.cassandra.distributed.test.RepairTest::testForcedNormalRepairWithOneNodeDown had an  &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; jvm8-utests         &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; fail    &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; Test org.apache.cassandra.cql3.ViewComplexTTLTest::testUpdateColumnInViewPKWithTTLWithoutFlush&lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt; ha &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; python-dtests       &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; fail    &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; Test auth_test.TestNetworkAuth::auth_test.py::TestNetworkAuth::test_revoked_login had an error,Test  &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;Repo&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;Branch&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;Parent Branch&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;SHA&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;Status&lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;https://github.com/dcapwell/cassandra.git&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;commit_remote_branch/&lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-20659&quot; title=&quot;Gossip doesn&amp;#39;t converge due to race condition when updating EndpointStates multiple fields&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-20659&quot;&gt;&lt;del&gt;CASSANDRA-20659&lt;/del&gt;&lt;/a&gt;-cassandra-4.0-42C17482-740E-40E5-A5E2-16F925410B1E&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;cassandra-4.0&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;7e04a922c3203c0970e220643b117f5e3f1f8f5f&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;Unstable&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;


&lt;p&gt;Failed Builds:&lt;/p&gt;
&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;Build&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;Result&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;Reason&lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; jvm-dtest-simulator &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; unknown &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; No test results found                                                                                &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; jvm-upgrade-dtests  &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; fail    &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; Test org.apache.cassandra.distributed.upgrade.CompactStoragePagingWithProtocolV30Test::testPagingWit &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; jvm8-dtests         &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; fail    &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; Test org.apache.cassandra.distributed.test.RepairTest::testForcedNormalRepairWithOneNodeDown had an  &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; jvm8-utests         &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; fail    &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; Test org.apache.cassandra.cql3.ViewComplexTTLTest::testUpdateColumnInViewPKWithTTLWithoutFlush&lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt; ha &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; python-dtests       &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; fail    &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; Test auth_test.TestNetworkAuth::auth_test.py::TestNetworkAuth::test_revoked_login had an error,Test  &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;Repo&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;Branch&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;Parent Branch&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;SHA&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;Status&lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;https://github.com/dcapwell/cassandra.git&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;commit_remote_branch/&lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-20659&quot; title=&quot;Gossip doesn&amp;#39;t converge due to race condition when updating EndpointStates multiple fields&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-20659&quot;&gt;&lt;del&gt;CASSANDRA-20659&lt;/del&gt;&lt;/a&gt;-cassandra-4.1-42C17482-740E-40E5-A5E2-16F925410B1E&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;cassandra-4.1&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;8cfc452b9a77e89ad06563cfdf25f150af524d9c&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;Unstable&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;


&lt;p&gt;Failed Builds:&lt;/p&gt;
&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;Build&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;Result&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;Reason&lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; jvm11-dtests          &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; fail &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; Test org.apache.cassandra.distributed.test.NetstatsBootstrapWithEntireSSTablesCompressionStreamingTe &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; jvm11-utests-long     &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; fail &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; Test org.apache.cassandra.cql3.ViewLongTest::testExpiredLivenessInfoWithDefaultTTLWithFlush&lt;span class=&quot;error&quot;&gt;&amp;#91;0&amp;#93;&lt;/span&gt; faile &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; python-upgrade-dtests &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; fail &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; Test upgrade_tests.cql_tests.cls::upgrade_tests.py::cql_tests::test_empty_in had an error,Test upgra &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;Repo&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;Branch&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;Parent Branch&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;SHA&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;Status&lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;https://github.com/dcapwell/cassandra.git&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;commit_remote_branch/&lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-20659&quot; title=&quot;Gossip doesn&amp;#39;t converge due to race condition when updating EndpointStates multiple fields&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-20659&quot;&gt;&lt;del&gt;CASSANDRA-20659&lt;/del&gt;&lt;/a&gt;-cassandra-5.0-42C17482-740E-40E5-A5E2-16F925410B1E&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;cassandra-5.0&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;c2ad8e703375af6e7848c8a52592cb3df5f7a7b3&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;Unstable&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;


&lt;p&gt;Failed Builds:&lt;/p&gt;
&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;Build&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;Result&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;Reason&lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; jvm11-utests                &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; fail    &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; Test org.apache.cassandra.io.sstable.SSTableReaderTest::testSpannedIndexPositions-cassandra.testtag_ &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; jvm17-utests                &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; fail    &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; Test org.apache.cassandra.io.sstable.SSTableReaderTest::testSpannedIndexPositions-cassandra.testtag_ &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; python-dtests               &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; fail    &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; Test gossip_test.TestGossip::gossip_test.py::TestGossip::test_2dc_parallel_startup failed,Test cqlsh &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; python-dtests-large         &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; fail    &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; Test consistency_test.TestAccuracy::consistency_test.py::TestAccuracy::test_network_topology_strateg &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; python-upgrade-dtests       &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; unknown &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; No test results found                                                                                &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; python-upgrade-dtests-large &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; unknown &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; No test results found                                                                                &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;Repo&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;Branch&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;Parent Branch&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;SHA&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;Status&lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;https://github.com/dcapwell/cassandra.git&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;commit_remote_branch/&lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-20659&quot; title=&quot;Gossip doesn&amp;#39;t converge due to race condition when updating EndpointStates multiple fields&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-20659&quot;&gt;&lt;del&gt;CASSANDRA-20659&lt;/del&gt;&lt;/a&gt;-trunk-42C17482-740E-40E5-A5E2-16F925410B1E&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;trunk&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;f2fdc52c5b8c900b350ff5f4c81dd8a33df7530b&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;Unstable&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;


&lt;p&gt;Failed Builds:&lt;/p&gt;
&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;Build&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;Result&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;Reason&lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; jvm11-dtests-fuzz     &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; unknown &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; No test results found                                                                                &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; jvm11-utests          &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; fail    &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; Test org.apache.cassandra.io.sstable.SSTableReaderTest::testSpannedIndexPositions-cassandra.testtag_ &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; jvm17-dtests          &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; fail    &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; Test org.apache.cassandra.distributed.test.accord.AccordIncrementalRepairTest::onlyAccordWithForceTe &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; jvm17-utests          &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; fail    &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; Test org.apache.cassandra.io.sstable.SSTableReaderTest::testSpannedIndexPositions-cassandra.testtag_ &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; jvm17-utests-long     &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; fail    &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; Test org.apache.cassandra.cql3.ViewLongTest::testExpiredLivenessInfoWithDefaultTTLWithFlush&lt;span class=&quot;error&quot;&gt;&amp;#91;2&amp;#93;&lt;/span&gt;-_jdk1 &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; python-dtests         &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; fail    &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; Test gossip_test.TestGossip::gossip_test.py::TestGossip::test_2dc_parallel_startup_one_seed failed,T &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; python-upgrade-dtests &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; fail    &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; Test upgrade_tests.upgrade_through_versions_test.TestUpgrade_current_5_0_x_To_indev_trunk::upgrade_t &lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;
</comment>
                            <comment id="17953550" author="dcapwell" created="Thu, 22 May 2025 21:56:13 +0000"  >&lt;p&gt;there were more failures than I would expect for the past, so had to rerun the older builds without my patch to confirm its safe to merge... all the &quot;new&quot; failures (comparing the runs) all looked like flakey issues...&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="13076646" name="ci_summary-cassandra-4.0-7e04a922c3203c0970e220643b117f5e3f1f8f5f.html" size="33943" author="dcapwell" created="Thu, 22 May 2025 21:54:15 +0000"/>
                            <attachment id="13076647" name="ci_summary-cassandra-4.1-8cfc452b9a77e89ad06563cfdf25f150af524d9c.html" size="32762" author="dcapwell" created="Thu, 22 May 2025 21:54:15 +0000"/>
                            <attachment id="13076648" name="ci_summary-cassandra-5.0-c2ad8e703375af6e7848c8a52592cb3df5f7a7b3.html" size="46101" author="dcapwell" created="Thu, 22 May 2025 21:54:15 +0000"/>
                            <attachment id="13076649" name="ci_summary-trunk-f2fdc52c5b8c900b350ff5f4c81dd8a33df7530b.html" size="13039" author="dcapwell" created="Thu, 22 May 2025 21:54:14 +0000"/>
                            <attachment id="13076650" name="result_details-cassandra-4.0-7e04a922c3203c0970e220643b117f5e3f1f8f5f.tar.gz" size="61330073" author="dcapwell" created="Thu, 22 May 2025 21:54:35 +0000"/>
                            <attachment id="13076651" name="result_details-cassandra-5.0-c2ad8e703375af6e7848c8a52592cb3df5f7a7b3.tar.gz" size="2503668" author="dcapwell" created="Thu, 22 May 2025 21:54:16 +0000"/>
                            <attachment id="13076652" name="result_details-trunk-f2fdc52c5b8c900b350ff5f4c81dd8a33df7530b.tar.gz" size="3835990" author="dcapwell" created="Thu, 22 May 2025 21:54:22 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>7.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[dcapwell]]></customfieldvalue>
        <customfieldvalue><![CDATA[mbyrd]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12313825" key="com.atlassian.jira.plugin.system.customfieldtypes:cascadingselect">
                        <customfieldname>Bug Category</customfieldname>
                        <customfieldvalues>
                                                    <customfieldvalue key="12982" cascade-level=""><![CDATA[Correctness]]></customfieldvalue>
                                <customfieldvalue key="13161" cascade-level="1"><![CDATA[Unrecoverable Corruption / Loss]]></customfieldvalue>
            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12313821" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Complexity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12965"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313822" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Discovered By</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12969"><![CDATA[User Report]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12313922" key="jira.plugin.projectspecificselectfield.jpssf:multicftype">
                        <customfieldname>Impacts</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="13100"><![CDATA[None]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            24 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12313921" key="jira.plugin.projectspecificselectfield.jpssf:multicftype">
                        <customfieldname>Platform</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="13076"><![CDATA[All]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z1vxjc:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[bdeggleston]]></customfieldvalue>
        <customfieldvalue><![CDATA[brandon.williams]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12963"><![CDATA[Critical]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12311420" key="com.atlassian.jira.plugin.system.customfieldtypes:version">
                        <customfieldname>Since Version</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="12313861">0.3</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313924" key="com.atlassian.jira.plugin.system.customfieldtypes:textfield">
                        <customfieldname>Source Control Link</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>&lt;p&gt;&lt;a href=&quot;https://github.com/apache/cassandra/commit/c736d22cf855d0981bb514fce5cb3a149b8c2f43&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/cassandra/commit/c736d22cf855d0981bb514fce5cb3a149b8c2f43&lt;/a&gt;&lt;/p&gt;</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313823" key="com.atlassian.jira.plugin.system.customfieldtypes:textarea">
                        <customfieldname>Test and Documentation Plan</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>&lt;p&gt;existing tests&lt;/p&gt;</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>