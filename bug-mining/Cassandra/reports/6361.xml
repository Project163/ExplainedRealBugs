<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 23:28:44 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-18757] UnifiedCompactionTask is incorrectly setting keepOriginals</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-18757</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;super&lt;/span&gt;(cfs, txn, gcBefore, strategy.getController().getIgnoreOverlapsInExpirationCheck());&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;in &lt;tt&gt;UnifiedCompactionTask&lt;/tt&gt; is calling the base constructor&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
 &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; CompactionTask(ColumnFamilyStore cfs, LifecycleTransaction txn, &lt;span class=&quot;code-object&quot;&gt;long&lt;/span&gt; gcBefore, &lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt; keepOriginals)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;which can set &lt;tt&gt;keepOriginals&lt;/tt&gt; to true when it should not be.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13547384">CASSANDRA-18757</key>
            <summary>UnifiedCompactionTask is incorrectly setting keepOriginals</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10002" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Normal</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="ethan.brown">Ethan Brown</assignee>
                                    <reporter username="blambov">Branimir Lambov</reporter>
                        <labels>
                    </labels>
                <created>Tue, 15 Aug 2023 13:20:09 +0000</created>
                <updated>Tue, 28 Nov 2023 15:50:24 +0000</updated>
                            <resolved>Thu, 23 Nov 2023 15:29:06 +0000</resolved>
                                        <fixVersion>5.0-beta1</fixVersion>
                    <fixVersion>5.1</fixVersion>
                                    <component>Local/Compaction</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                    <progress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                            <timeestimate seconds="0">0h</timeestimate>
                            <timespent seconds="1800">0.5h</timespent>
                                <comments>
                            <comment id="17786085" author="smiklosovic" created="Tue, 14 Nov 2023 21:29:54 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=blambov&quot; class=&quot;user-hover&quot; rel=&quot;blambov&quot;&gt;blambov&lt;/a&gt; good to go? I can do the usual builds etc, may even appear in beta1.&lt;/p&gt;

&lt;p&gt;btw, was not that done on purpose? &lt;/p&gt;</comment>
                            <comment id="17786282" author="blambov" created="Wed, 15 Nov 2023 10:02:34 +0000"  >&lt;p&gt;I think it is a leftover from a refactoring that (among other things) fixed &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-18756&quot; title=&quot;TimeWindowCompactionStrategy with unsafe_aggressive_sstable_expiration keeps overlaping SSTable references&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-18756&quot;&gt;&lt;del&gt;CASSANDRA-18756&lt;/del&gt;&lt;/a&gt; in DSE.&lt;/p&gt;

&lt;p&gt;Fix LGTM, but it&apos;s a shame that no test caught it.&lt;/p&gt;</comment>
                            <comment id="17786288" author="smiklosovic" created="Wed, 15 Nov 2023 10:10:29 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ethan.brown&quot; class=&quot;user-hover&quot; rel=&quot;ethan.brown&quot;&gt;ethan.brown&lt;/a&gt; is there any will to add a test in a forseeable future or we just deliver it as it is?&lt;/p&gt;</comment>
                            <comment id="17786356" author="smiklosovic" created="Wed, 15 Nov 2023 13:43:31 +0000"  >&lt;p&gt;I am running the builds. If we don&apos;t add a test we will go without. Merging realistically next week (Monday-ish)&lt;/p&gt;</comment>
                            <comment id="17786527" author="JIRAUSER302087" created="Wed, 15 Nov 2023 22:33:15 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=smiklosovic&quot; class=&quot;user-hover&quot; rel=&quot;smiklosovic&quot;&gt;smiklosovic&lt;/a&gt; I don&apos;t think there are any plans to add a test right now, but if you think it would be a good idea I can add one.&lt;/p&gt;</comment>
                            <comment id="17786650" author="smiklosovic" created="Thu, 16 Nov 2023 08:00:03 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ethan.brown&quot; class=&quot;user-hover&quot; rel=&quot;ethan.brown&quot;&gt;ethan.brown&lt;/a&gt; ok so please add one. As I read it, you do not seem to object the idea. If it is not in beta1 it can be still added later, in rc1 or something like that ... If you made that test the next week that would be great. Nowhere to hurry, let&apos;s just do this &quot;properly&quot;.&lt;/p&gt;</comment>
                            <comment id="17788365" author="smiklosovic" created="Tue, 21 Nov 2023 11:04:31 +0000"  >&lt;p&gt;Thank you for the test, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ethan.brown&quot; class=&quot;user-hover&quot; rel=&quot;ethan.brown&quot;&gt;ethan.brown&lt;/a&gt; , I am going to build this, as usually, and let you know.&lt;/p&gt;</comment>
                            <comment id="17788661" author="smiklosovic" created="Wed, 22 Nov 2023 07:44:27 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ethan.brown&quot; class=&quot;user-hover&quot; rel=&quot;ethan.brown&quot;&gt;ethan.brown&lt;/a&gt;&#160; I am not able to run a multiplexer in my CI because there is a timeout of 1 hour in my jobs. The whole test changes you did take like 5 minutes locally and it adds up pretty quickly. (the test you rewrote just recently). Would you mind to lower the wait there from 1 minute to 30 seconds, for example? Is it really necessary to wait so long?&#160;&lt;/p&gt;

&lt;p&gt;Another solution is to lower the number of the tests but there is a rule we try to stick to that we run any (changed) test 500 times to rule out any flakiness. I would have to split it into two runs for 250 for example which is a little bit ... uncomfortable.&lt;/p&gt;

&lt;p&gt;I naively tried to lower the wait from 1 minute to 30s but it fails. Maybe there is some knob to turn to change it from 1 minute to 30 seconds? What influences that 1 minute gap?&#160;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://app.circleci.com/pipelines/github/instaclustr/cassandra/3540/workflows/6b8040ec-e5a8-4f45-a346-8afd8c99a961/jobs/155512&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://app.circleci.com/pipelines/github/instaclustr/cassandra/3540/workflows/6b8040ec-e5a8-4f45-a346-8afd8c99a961/jobs/155512&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="17788730" author="blambov" created="Wed, 22 Nov 2023 11:13:40 +0000"  >&lt;p&gt;How about splitting this into separate tests for the 4 cases? I.e. have the four calls in &lt;tt&gt;testIgnoreOverlaps&lt;/tt&gt; run in separate &lt;tt&gt;@Test&lt;/tt&gt;-annotated methods?&lt;/p&gt;</comment>
                            <comment id="17788739" author="smiklosovic" created="Wed, 22 Nov 2023 11:56:31 +0000"  >&lt;p&gt;That might work too, so then I will run just a test method just added?&#160;&lt;/p&gt;

&lt;p&gt;I run it in 25 containers and limit is 1 hour so I have 25*60=1500 minutes to run 500 tests which is 3 minutes per test. (or per test method if I run just that one).&lt;/p&gt;

&lt;p&gt;There is also 8 minutes limit for any unit test here (1)&lt;/p&gt;

&lt;p&gt;(1) &lt;a href=&quot;https://github.com/apache/cassandra/blob/trunk/build.xml#L123&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/cassandra/blob/trunk/build.xml#L123&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17788858" author="JIRAUSER302087" created="Wed, 22 Nov 2023 18:40:24 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=smiklosovic&quot; class=&quot;user-hover&quot; rel=&quot;smiklosovic&quot;&gt;smiklosovic&lt;/a&gt; I split the test into 4 separate tests (1 for each case).&#160; The reason for the 1 minute wait is to allow the &lt;tt&gt;overlapIterator&lt;/tt&gt; to refresh.  &lt;tt&gt;runMayThrow()&lt;/tt&gt; in &lt;tt&gt;CompactionTask.java&lt;/tt&gt; only refreshes the &lt;tt&gt;overlapIterator&lt;/tt&gt; if 1 minute has passed since the last refresh.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/apache/cassandra/blob/cassandra-5.0/src/java/org/apache/cassandra/db/compaction/CompactionTask.java#L219&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/cassandra/blob/cassandra-5.0/src/java/org/apache/cassandra/db/compaction/CompactionTask.java#L219&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17789130" author="blambov" created="Thu, 23 Nov 2023 13:31:45 +0000"  >&lt;p&gt;Tests look good, repeated test completed with no failures: &lt;a href=&quot;https://app.circleci.com/pipelines/github/blambov/cassandra?branch=CASSANDRA-18757&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://app.circleci.com/pipelines/github/blambov/cassandra?branch=CASSANDRA-18757&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=smiklosovic&quot; class=&quot;user-hover&quot; rel=&quot;smiklosovic&quot;&gt;smiklosovic&lt;/a&gt;, do you give a second approval so that I can commit this?&lt;/p&gt;</comment>
                            <comment id="17789172" author="smiklosovic" created="Thu, 23 Nov 2023 15:28:53 +0000"  >&lt;p&gt;+1&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[ethan.brown]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12313825" key="com.atlassian.jira.plugin.system.customfieldtypes:cascadingselect">
                        <customfieldname>Bug Category</customfieldname>
                        <customfieldvalues>
                                                    <customfieldvalue key="12984" cascade-level=""><![CDATA[Degradation]]></customfieldvalue>
                                <customfieldvalue key="12995" cascade-level="1"><![CDATA[Resource Management]]></customfieldvalue>
            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12313821" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Complexity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12964"><![CDATA[Low Hanging Fruit]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313822" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Discovered By</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12975"><![CDATA[Code Inspection]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12313922" key="jira.plugin.projectspecificselectfield.jpssf:multicftype">
                        <customfieldname>Impacts</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="13100"><![CDATA[None]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            1 year, 50 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12313921" key="jira.plugin.projectspecificselectfield.jpssf:multicftype">
                        <customfieldname>Platform</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="13076"><![CDATA[All]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z1jsm8:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[blambov]]></customfieldvalue>
        <customfieldvalue><![CDATA[smiklosovic]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12961"><![CDATA[Low]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12311420" key="com.atlassian.jira.plugin.system.customfieldtypes:version">
                        <customfieldname>Since Version</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="12353513">5.0-alpha1</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313924" key="com.atlassian.jira.plugin.system.customfieldtypes:textfield">
                        <customfieldname>Source Control Link</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>&lt;p&gt;&lt;a href=&quot;https://github.com/apache/cassandra/commit/9c6e671434b6b44c8969dbc965fedbdcf21be340&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/cassandra/commit/9c6e671434b6b44c8969dbc965fedbdcf21be340&lt;/a&gt;&lt;/p&gt;</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313823" key="com.atlassian.jira.plugin.system.customfieldtypes:textarea">
                        <customfieldname>Test and Documentation Plan</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>&lt;p&gt;CI&lt;/p&gt;</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>