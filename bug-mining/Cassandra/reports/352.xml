<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 22:13:20 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-1188] multiget_slice calls do not close files resulting in file descriptor leak</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-1188</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;Insert  1000 rows into a super column family. Read them back in a loop using multiget_slice. Note leaked file descriptors with lsof:&lt;br/&gt;
lsof -p `ps ax | grep &lt;span class=&quot;error&quot;&gt;&amp;#91;C&amp;#93;&lt;/span&gt;assandraDaemon | awk &apos;&lt;/p&gt;
{print $1}
&lt;p&gt;&apos;` | awk &apos;&lt;/p&gt;
{print $9}
&lt;p&gt;&apos; | sort | uniq -c | sort -n | tail -n 5&lt;/p&gt;

&lt;p&gt;Looks like SSTableNamesIterator is never closing the files it creates via the sstable ...?&lt;/p&gt;

&lt;p&gt;This is similar to &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-1178&quot; title=&quot;get_slice calls do not close files when finished resulting in &amp;quot;too many open files&amp;quot; exceptions and rendering C unusable&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-1178&quot;&gt;&lt;del&gt;CASSANDRA-1178&lt;/del&gt;&lt;/a&gt; except for use of multiget_slice instead of get_slice&lt;/p&gt;
</description>
                <environment>&lt;p&gt;Ubuntu 10.04&lt;/p&gt;</environment>
        <key id="12466908">CASSANDRA-1188</key>
            <summary>multiget_slice calls do not close files resulting in file descriptor leak</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10000" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Urgent</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="mdennis">Matthew F. Dennis</assignee>
                                    <reporter username="wr0ngway">Matt Conway</reporter>
                        <labels>
                    </labels>
                <created>Mon, 14 Jun 2010 15:12:36 +0000</created>
                <updated>Tue, 16 Apr 2019 09:33:22 +0000</updated>
                            <resolved>Mon, 14 Jun 2010 17:58:00 +0000</resolved>
                                        <fixVersion>0.7 beta 1</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                                                                <comments>
                            <comment id="12878656" author="wr0ngway" created="Mon, 14 Jun 2010 17:43:45 +0000"  >&lt;p&gt;I ran my tests against this patch and they pass, looks like this cleared up the leak.  Thanks! &lt;/p&gt;

&lt;p&gt;BTW, oddly enough, my tests never fail (i.e. lsof never balloons up) on OS X even before the fix for &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-1178&quot; title=&quot;get_slice calls do not close files when finished resulting in &amp;quot;too many open files&amp;quot; exceptions and rendering C unusable&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-1178&quot;&gt;&lt;del&gt;CASSANDRA-1178&lt;/del&gt;&lt;/a&gt;, any ideas why that might be?  I&apos;m guessing implementation details of GC or underlying OS are to blame, but don&apos;t know enough to say for sure.  Not important, just curious.&lt;/p&gt;</comment>
                            <comment id="12878668" author="jbellis" created="Mon, 14 Jun 2010 17:58:00 +0000"  >&lt;p&gt;committed, with formatting cleanup.&lt;/p&gt;

&lt;p&gt;yes, the jdk declares finalizers on file streams to close them if the GC runs in time; as you note, it&apos;s implementation-dependent how often that actually happens.&lt;/p&gt;</comment>
                            <comment id="12878694" author="mdennis" created="Mon, 14 Jun 2010 18:44:46 +0000"  >&lt;p&gt;not all GC implementations close file descriptors when the objects are collected.  Apparently the one you&apos;re using on OSX does.  Curious though, you didn&apos;t see &lt;b&gt;any&lt;/b&gt; ballooning?  If OSX was releasing the descriptors when the objects were collected, I would expect to see a few hundred open files while reading in a loop on OSX and only a handful after the patch.&lt;/p&gt;

&lt;p&gt;random thought: It may also be a difference in memmapped IO versus not - perhaps OSX doesn&apos;t use it (or isn&apos;t configured to)?&lt;/p&gt;</comment>
                            <comment id="12878716" author="wr0ngway" created="Mon, 14 Jun 2010 19:49:04 +0000"  >&lt;p&gt;I wasn&apos;t really watching it while it was running, just checking the count of open files after.&lt;/p&gt;

&lt;p&gt;No idea about memmapped IO in OS X, I didn&apos;t explicitly set anything up w.r.t. it anyway...&lt;/p&gt;
</comment>
                            <comment id="12878964" author="hudson" created="Tue, 15 Jun 2010 12:51:22 +0000"  >&lt;p&gt;Integrated in Cassandra #466 (See &lt;a href=&quot;http://hudson.zones.apache.org/hudson/job/Cassandra/466/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://hudson.zones.apache.org/hudson/job/Cassandra/466/&lt;/a&gt;)&lt;br/&gt;
    close file in SSTableNamesIterator when opened locally.  patch by mdennis; reviewed by jbellis for &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-1188&quot; title=&quot;multiget_slice calls do not close files resulting in file descriptor leak&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-1188&quot;&gt;&lt;del&gt;CASSANDRA-1188&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12447042" name="0001-trunk-1188.patch" size="4824" author="mdennis" created="Mon, 14 Jun 2010 17:17:38 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[mdennis]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>20028</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            15 years, 24 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0g3jb:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>92003</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12963"><![CDATA[Critical]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>