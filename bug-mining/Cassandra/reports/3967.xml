<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 22:59:34 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-10729] SELECT statement with IN restrictions on partition key + ORDER BY + LIMIT return wrong results</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-10729</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;If we execute a request with paging turned off, an IN restriction on the partition key, ORDER BY and LIMIT the result returned are not the expected ones.&lt;/p&gt;

&lt;p&gt;The following test can be used to reproduce the problem.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;        createTable(&lt;span class=&quot;code-quote&quot;&gt;&quot;CREATE TABLE %s (pk1 &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;, pk2 &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;, c &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;, v text, PRIMARY KEY ((pk1, pk2), c) )&quot;&lt;/span&gt;);
        execute(&lt;span class=&quot;code-quote&quot;&gt;&quot;INSERT INTO %s (pk1, pk2, c, v) VALUES (?, ?, ?, ?)&quot;&lt;/span&gt;, 1, 1, 2, &lt;span class=&quot;code-quote&quot;&gt;&quot;A&quot;&lt;/span&gt;);
        execute(&lt;span class=&quot;code-quote&quot;&gt;&quot;INSERT INTO %s (pk1, pk2, c, v) VALUES (?, ?, ?, ?)&quot;&lt;/span&gt;, 1, 2, 1, &lt;span class=&quot;code-quote&quot;&gt;&quot;B&quot;&lt;/span&gt;);
        execute(&lt;span class=&quot;code-quote&quot;&gt;&quot;INSERT INTO %s (pk1, pk2, c, v) VALUES (?, ?, ?, ?)&quot;&lt;/span&gt;, 1, 3, 3, &lt;span class=&quot;code-quote&quot;&gt;&quot;C&quot;&lt;/span&gt;);
        execute(&lt;span class=&quot;code-quote&quot;&gt;&quot;INSERT INTO %s (pk1, pk2, c, v) VALUES (?, ?, ?, ?)&quot;&lt;/span&gt;, 1, 1, 4, &lt;span class=&quot;code-quote&quot;&gt;&quot;D&quot;&lt;/span&gt;);

        assertRows(execute(&lt;span class=&quot;code-quote&quot;&gt;&quot;SELECT v as c FROM %s where pk1 = ? AND pk2 IN (?, ?) ORDER BY c; &quot;&lt;/span&gt;, 1, 1, 2),
                   row(&lt;span class=&quot;code-quote&quot;&gt;&quot;B&quot;&lt;/span&gt;),
                   row(&lt;span class=&quot;code-quote&quot;&gt;&quot;A&quot;&lt;/span&gt;),
                   row(&lt;span class=&quot;code-quote&quot;&gt;&quot;D&quot;&lt;/span&gt;));

        assertRows(execute(&lt;span class=&quot;code-quote&quot;&gt;&quot;SELECT v as c FROM %s where pk1 = ? AND pk2 IN (?, ?) ORDER BY c LIMIT 2; &quot;&lt;/span&gt;, 1, 1, 2),
                   row(&lt;span class=&quot;code-quote&quot;&gt;&quot;B&quot;&lt;/span&gt;),
                   row(&lt;span class=&quot;code-quote&quot;&gt;&quot;A&quot;&lt;/span&gt;));
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="12914148">CASSANDRA-10729</key>
            <summary>SELECT statement with IN restrictions on partition key + ORDER BY + LIMIT return wrong results</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10002" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Normal</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="blerer">Benjamin Lerer</assignee>
                                    <reporter username="blerer">Benjamin Lerer</reporter>
                        <labels>
                    </labels>
                <created>Wed, 18 Nov 2015 15:53:27 +0000</created>
                <updated>Tue, 16 Apr 2019 09:30:49 +0000</updated>
                            <resolved>Thu, 26 Nov 2015 16:59:18 +0000</resolved>
                                        <fixVersion>3.0.1</fixVersion>
                    <fixVersion>3.1</fixVersion>
                    <fixVersion>3.2</fixVersion>
                                    <component>Legacy/CQL</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="15013245" author="blerer" created="Thu, 19 Nov 2015 09:45:23 +0000"  >&lt;p&gt;The problem is a regression in &lt;tt&gt;3.0&lt;/tt&gt;. &lt;/p&gt;</comment>
                            <comment id="15016722" author="blerer" created="Fri, 20 Nov 2015 12:30:36 +0000"  >&lt;p&gt;The patch makes sure that we do not use any limit in paging when we do post sorting and trim the results once they are sorted.&lt;/p&gt;

&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;unit tests &lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt; dtests &lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/blerer/job/blerer-10729-3.0-testall/1/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;10729-3.0&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/blerer/job/blerer-10729-3.0-dtest/1/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;10729-3.0&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;
</comment>
                            <comment id="15028495" author="slebresne" created="Thu, 26 Nov 2015 10:25:37 +0000"  >&lt;p&gt;Lgtm with the caveat that the &quot;May be used by custom QueryHandler implementations&quot; comment should refer to &lt;tt&gt;getUserLimit&lt;/tt&gt; and not &lt;tt&gt;getDataLimits&lt;/tt&gt;, and that while I have nothing against the &lt;tt&gt;getUserLimit&lt;/tt&gt; naming in principle,  maybe it&apos;s worth keeping &lt;tt&gt;getLimit&lt;/tt&gt; for the sake of QueryHandler implementations.&lt;/p&gt;</comment>
                            <comment id="15028911" author="blerer" created="Thu, 26 Nov 2015 14:38:48 +0000"  >&lt;p&gt;I renamed &lt;tt&gt;getUserLimit&lt;/tt&gt; to &lt;tt&gt;getLimit&lt;/tt&gt;, moved the comment and made &lt;tt&gt;getDataLimit&lt;/tt&gt; private.&lt;br/&gt;
The new patch can be found &lt;a href=&quot;https://github.com/apache/cassandra/compare/trunk...blerer:10729-3.0&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;here&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15028954" author="slebresne" created="Thu, 26 Nov 2015 15:08:03 +0000"  >&lt;p&gt;+1&lt;/p&gt;</comment>
                            <comment id="15029106" author="blerer" created="Thu, 26 Nov 2015 16:59:18 +0000"  >&lt;p&gt;Committed in 3.0 at 7e6c1d5483b35ab911113dff0f5fd559760d733b and merged into 3.1, trunk&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12774538" name="10729-3.0-V2.txt" size="16820" author="blerer" created="Thu, 26 Nov 2015 16:19:40 +0000"/>
                            <attachment id="12773501" name="10729-3.0.txt" size="16731" author="blerer" created="Fri, 20 Nov 2015 12:30:36 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[blerer]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 51 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2ol2n:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12311421" key="com.atlassian.jira.plugin.system.customfieldtypes:multiversion">
                        <customfieldname>Reproduced In</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="12333891">3.0.0</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>slebresne</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[slebresne]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12962"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>