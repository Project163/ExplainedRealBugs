<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 22:11:11 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-383] StorageProxy.insertBlocking does not perform hinted handoff</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-383</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;insertBlocking should use getNStorageEndPointMap (like insert) instead of just getNStorageEndPoint so that it can perform hinted handoff.&lt;/p&gt;
</description>
                <environment>&lt;p&gt;all&lt;/p&gt;</environment>
        <key id="12433523">CASSANDRA-383</key>
            <summary>StorageProxy.insertBlocking does not perform hinted handoff</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10002" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Normal</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="sandeep_tata">Sandeep Tata</assignee>
                                    <reporter username="sandeep_tata">Sandeep Tata</reporter>
                        <labels>
                    </labels>
                <created>Thu, 20 Aug 2009 00:22:05 +0000</created>
                <updated>Tue, 16 Apr 2019 09:33:34 +0000</updated>
                            <resolved>Mon, 24 Aug 2009 16:49:25 +0000</resolved>
                                        <fixVersion>0.4</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                                                                <comments>
                            <comment id="12745252" author="sandeep_tata" created="Thu, 20 Aug 2009 00:28:18 +0000"  >&lt;p&gt;Need to fix this so both insert paths can echo writes to the bootstrapping nodes for &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-375&quot; title=&quot;Echo writes to bootstrapping nodes&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-375&quot;&gt;&lt;del&gt;CASSANDRA-375&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="12745257" author="sandeep_tata" created="Thu, 20 Aug 2009 00:47:06 +0000"  >&lt;p&gt;insertBlocking now uses getNStorageEndPointMap&lt;/p&gt;</comment>
                            <comment id="12745268" author="jbellis" created="Thu, 20 Aug 2009 01:08:07 +0000"  >&lt;p&gt;eyeballing it looks ok.  will commit after i get to my machine that has Thrift installed tomorrow to run nosetests. &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="12745476" author="jbellis" created="Thu, 20 Aug 2009 16:20:20 +0000"  >&lt;p&gt;I get many nosetests failures with this patch (on a single machine ofc)&lt;/p&gt;</comment>
                            <comment id="12745769" author="sandeep_tata" created="Fri, 21 Aug 2009 02:15:17 +0000"  >&lt;p&gt;Oops, can&apos;t quite cast to EndPoint[] like I was doing.&lt;br/&gt;
v2 passes nosetests and ant test.&lt;/p&gt;</comment>
                            <comment id="12745818" author="euphoria" created="Fri, 21 Aug 2009 06:01:03 +0000"  >&lt;p&gt;I think this is what you&apos;ll want to do, getting rid of the temp counter.&lt;br/&gt;
{{{&lt;br/&gt;
EndPoint[] endPoints = (EndPoint[])endpointMap.keySet().toArray(new EndPoint&lt;span class=&quot;error&quot;&gt;&amp;#91;endpointMap.size()&amp;#93;&lt;/span&gt;);&lt;br/&gt;
}}}&lt;/p&gt;

&lt;p&gt;It might be pedantic, but I also think we should be making the quorum calculation consistent, instead of&lt;br/&gt;
availability style&lt;br/&gt;
{{{&lt;br/&gt;
(DatabaseDescriptor.getReplicationFactor() / 2) + 1)&lt;br/&gt;
}}}&lt;br/&gt;
versus blocking style&lt;br/&gt;
{{{&lt;br/&gt;
(DatabaseDescriptor.getReplicationFactor() &amp;gt;&amp;gt; 1) + 1)&lt;br/&gt;
}}}&lt;/p&gt;

&lt;p&gt;Apart from these, looks good.&lt;/p&gt;</comment>
                            <comment id="12746085" author="sandeep_tata" created="Fri, 21 Aug 2009 16:55:29 +0000"  >&lt;p&gt;Thanks &amp;#8211; v3 with Michaels&apos; suggestions.&lt;/p&gt;</comment>
                            <comment id="12746091" author="jbellis" created="Fri, 21 Aug 2009 17:02:12 +0000"  >&lt;p&gt;instead of&lt;br/&gt;
            if (endpointMap.size() &amp;lt; (DatabaseDescriptor.getReplicationFactor() / 2) + 1)&lt;/p&gt;
            {
                throw new UnavailableException();
            }&lt;br/&gt;
            int blockFor = determineBlockFor(consistency_level);&lt;br/&gt;
&lt;br/&gt;
we should have&lt;br/&gt;
&lt;br/&gt;
            int blockFor = determineBlockFor(consistency_level);&lt;br/&gt;
            if (endpointMap.size() &amp;lt; blockFor)&lt;br/&gt;
            {                throw new UnavailableException();            }</comment>
                            <comment id="12746093" author="jbellis" created="Fri, 21 Aug 2009 17:03:56 +0000"  >&lt;p&gt;minor point: the (EndPoint[]) is redundant in the toArray call&lt;/p&gt;</comment>
                            <comment id="12746110" author="jbellis" created="Fri, 21 Aug 2009 17:47:50 +0000"  >&lt;p&gt;rather belatedly I realized that we have a deeper problem here.&lt;/p&gt;

&lt;p&gt;we don&apos;t want to count hint destinations as counting towards the W consistency level, or we are violating our contract that W + R &amp;gt; N = consistent (or unavailableexception).&lt;/p&gt;

&lt;p&gt;we do want to write hints if for instance a quorum write is requested and we have 2 of 3 nodes live, we write the third to a hint.  but that can&apos;t count towards the quorum since that node won&apos;t be a potential read target.  so getNStorageEndPointMap is the wrong thing to do here.&lt;/p&gt;

&lt;p&gt;i think we actually have to go below that abstraction: use getStorageEndPoints directly, count the live nodes to see if we have enough to satisfy consistency_level, write those out, and if that is less than N, then add hinted writes.&lt;/p&gt;</comment>
                            <comment id="12746129" author="sandeep_tata" created="Fri, 21 Aug 2009 18:27:53 +0000"  >&lt;p&gt;True, the blockFor semantics so far has simply been a W-durability guarantee.&lt;br/&gt;
If we want to guarantee W + R &amp;gt; N = consistent, HHO nodes can&apos;t count towards W.&lt;/p&gt;</comment>
                            <comment id="12746147" author="sandeep_tata" created="Fri, 21 Aug 2009 18:55:12 +0000"  >&lt;p&gt;v4 fixes blockFor semantics to actually block for W live nodes and then do hinted handoff after that succeeds.&lt;/p&gt;

&lt;p&gt;We don&apos;t want to do HHO in parallel to make sure we don&apos;t write any value in case the quorum write fails .. clients will see a failed write, but quorum reads might succeed after handoff.&lt;/p&gt;</comment>
                            <comment id="12746946" author="jbellis" created="Mon, 24 Aug 2009 16:48:00 +0000"  >&lt;p&gt;committed v4 w/ minor changes (renamed getLiveNodes -&amp;gt; getUnhintedNodes)&lt;/p&gt;</comment>
                            <comment id="12747431" author="hudson" created="Tue, 25 Aug 2009 14:21:26 +0000"  >&lt;p&gt;Integrated in Cassandra #177 (See &lt;a href=&quot;http://hudson.zones.apache.org/hudson/job/Cassandra/177/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://hudson.zones.apache.org/hudson/job/Cassandra/177/&lt;/a&gt;)&lt;br/&gt;
    allow blocking write to create hints if not enough of the &quot;correct&quot; nodes are live, but enough are to fulfil the requested consistency level.  patch by Sandeep Tata; reviewed by jbellis and Michael Greene for &lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10032">
                    <name>Blocker</name>
                                            <outwardlinks description="blocks">
                                        <issuelink>
            <issuekey id="12433392">CASSANDRA-375</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12417085" name="383-v1.patch" size="3363" author="sandeep_tata" created="Thu, 20 Aug 2009 00:47:06 +0000"/>
                            <attachment id="12417209" name="383-v2.patch" size="3610" author="sandeep_tata" created="Fri, 21 Aug 2009 02:15:17 +0000"/>
                            <attachment id="12417283" name="383-v3.patch" size="3504" author="sandeep_tata" created="Fri, 21 Aug 2009 16:55:29 +0000"/>
                            <attachment id="12417301" name="383-v4.patch" size="4483" author="sandeep_tata" created="Fri, 21 Aug 2009 18:55:11 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>4.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[sandeep_tata]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>19662</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            16 years, 14 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0fylj:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>91203</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12962"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>