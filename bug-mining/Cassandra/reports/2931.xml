<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 22:46:16 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-7496] ClassCastException in MessagingService</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-7496</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;Got the following exception when running repair on a 3 node ccm cluster&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;ERROR [EXPIRING-MAP-REAPER:1] 2014-07-03 21:24:33,063 CassandraDaemon.java:166 - Exception in thread &lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;[EXPIRING-MAP-REAPER:1,5,main]
java.lang.ClassCastException: org.apache.cassandra.net.CallbackInfo cannot be &lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt; to org.apache.cassandra.net.WriteCallbackInfo
	at org.apache.cassandra.net.MessagingService$5.apply(MessagingService.java:352) ~[main/:na]
	at org.apache.cassandra.net.MessagingService$5.apply(MessagingService.java:335) ~[main/:na]
	at org.apache.cassandra.utils.ExpiringMap$1.run(ExpiringMap.java:98) ~[main/:na]
	at org.apache.cassandra.concurrent.DebuggableScheduledThreadPoolExecutor$UncomplainingRunnable.run(DebuggableScheduledThreadPoolExecutor.java:75) ~[main/:na]
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:471) [na:1.7.0_60]
	at java.util.concurrent.FutureTask.runAndReset(FutureTask.java:304) [na:1.7.0_60]
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.access$301(ScheduledThreadPoolExecutor.java:178) [na:1.7.0_60]
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:293) [na:1.7.0_60]
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1145) [na:1.7.0_60]
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:615) [na:1.7.0_60]
	at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:745) [na:1.7.0_60]
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Looks like that block (MessagingService, li. 352), was changed with &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-7245&quot; title=&quot;Out-of-Order keys with stress + CQL3&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-7245&quot;&gt;&lt;del&gt;CASSANDRA-7245&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;While I produced this on trunk, I compared the MS code on trunk with 2.1.0 and it is  the same. This is the change that 7245 introduced:&lt;/p&gt;

&lt;p&gt;pre-7245&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;                &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (expiredCallbackInfo.shouldHint())
                {
                    Mutation mutation = (Mutation) ((WriteCallbackInfo) expiredCallbackInfo).sentMessage.payload;
                    &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; StorageProxy.submitHint(mutation, expiredCallbackInfo.target, &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;);
                }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;7245:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;                Mutation mutation = (Mutation) ((WriteCallbackInfo) expiredCallbackInfo).sentMessage.payload;

                &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt;
                {
                    &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (expiredCallbackInfo.shouldHint())
                    {
                        &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; StorageProxy.submitHint(mutation, expiredCallbackInfo.target, &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;);
                    }
                }
                &lt;span class=&quot;code-keyword&quot;&gt;finally&lt;/span&gt;
                {
                    &lt;span class=&quot;code-comment&quot;&gt;//We serialized a hint so we don&apos;t need &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; mutation anymore
&lt;/span&gt;                    mutation.release();
                }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment>&lt;p&gt;3 node ccm cluster running in a linux VM on my laptop&lt;/p&gt;</environment>
        <key id="12725422">CASSANDRA-7496</key>
            <summary>ClassCastException in MessagingService</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10002" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Normal</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="jasobrown">Jason Brown</assignee>
                                    <reporter username="jasobrown">Jason Brown</reporter>
                        <labels>
                    </labels>
                <created>Fri, 4 Jul 2014 04:49:42 +0000</created>
                <updated>Tue, 16 Apr 2019 09:31:41 +0000</updated>
                            <resolved>Mon, 7 Jul 2014 05:04:51 +0000</resolved>
                                        <fixVersion>2.1 rc3</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="14052171" author="jasobrown" created="Fri, 4 Jul 2014 05:06:04 +0000"  >&lt;p&gt;Looks like the cast to WCI should be moved back after the shouldHint() check as CallbackInfo.shouldHint() is hardcoded to return false, thus it could never downcast anyway.&lt;/p&gt;

&lt;p&gt;So probably this will fix it (move the cast after the shouldHint() check):&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (expiredCallbackInfo.shouldHint())
        {
            &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt;
            {
                Mutation mutation = (Mutation) ((WriteCallbackInfo) expiredCallbackInfo).sentMessage.payload;
                &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; StorageProxy.submitHint(mutation, expiredCallbackInfo.target, &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;);
            }
            &lt;span class=&quot;code-keyword&quot;&gt;finally&lt;/span&gt;
            {
                &lt;span class=&quot;code-comment&quot;&gt;//We serialized a hint so we don&apos;t need &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; mutation anymore
&lt;/span&gt;                mutation.release();
            }
        }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt; </comment>
                            <comment id="14052381" author="tjake" created="Fri, 4 Jul 2014 11:49:39 +0000"  >&lt;p&gt;Patch with your fix attached.  Can you describe your ccm scenario that caused this?  I&apos;d like to add a dtest for this.&lt;/p&gt;</comment>
                            <comment id="14053344" author="jbellis" created="Mon, 7 Jul 2014 05:04:51 +0000"  >&lt;p&gt;Committed so we can roll rc3.&lt;/p&gt;

&lt;p&gt;If you want to follow up with a test, it looks to me like this will happen 100% of the time when we have a callback on a non-write, expired message.  (Not actually sure what this includes &amp;#8211; we have lots of non-write messages with callbacks, but most aren&apos;t allowed to expire.  Clearly there must be some.)&lt;/p&gt;</comment>
                            <comment id="14053571" author="jasobrown" created="Mon, 7 Jul 2014 11:56:40 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tjake&quot; class=&quot;user-hover&quot; rel=&quot;tjake&quot;&gt;tjake&lt;/a&gt; I produced this by building a 3 node cluster in ccm. Then I ran &apos;stress write&apos; to get some data into the cluster (with RF=2), calling flush every tens seconds so I could monitor the amount of data per node (didn&apos;t need much data, just something to play with). Then I ran &lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;ccm node1 nodetool repair Keyspace1 Standard1&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;, node1 would get the exception in under 30 seconds (usually occurring a few times during the span over the repair). &lt;/p&gt;

&lt;p&gt;As I was testing out some changes I&apos;m working on, I don&apos;t believe the cause of the messages timing out during repair is a problem in 2.1 (just my own bugs to work out on my branch).&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12654089" name="7496.txt" size="1419" author="tjake" created="Fri, 4 Jul 2014 11:49:39 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[jasobrown]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>403582</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            11 years, 20 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1xgkv:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>403626</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12311421" key="com.atlassian.jira.plugin.system.customfieldtypes:multiversion">
                        <customfieldname>Reproduced In</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="12324159">2.1 rc3</customfieldvalue>
    <customfieldvalue id="12324945">2.2.0 beta 1</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>tjake</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[tjake]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12962"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>