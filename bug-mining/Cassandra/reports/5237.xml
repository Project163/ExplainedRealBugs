<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 23:14:03 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-15347] Add client testing capabilities to in-jvm tests</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-15347</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;Allow testing native transport code path using in-jvm tests.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13261062">CASSANDRA-15347</key>
            <summary>Add client testing capabilities to in-jvm tests</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10002" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Normal</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="drohrer">Doug Rohrer</assignee>
                                    <reporter username="ifesdjeen">Alex Petrov</reporter>
                        <labels>
                            <label>patch-available</label>
                            <label>pull-request-available</label>
                    </labels>
                <created>Tue, 8 Oct 2019 08:20:36 +0000</created>
                <updated>Thu, 27 Aug 2020 15:09:50 +0000</updated>
                            <resolved>Mon, 11 Nov 2019 15:03:41 +0000</resolved>
                                        <fixVersion>2.2.16</fixVersion>
                    <fixVersion>3.0.20</fixVersion>
                    <fixVersion>3.11.6</fixVersion>
                    <fixVersion>4.0-alpha3</fixVersion>
                    <fixVersion>4.0</fixVersion>
                                    <component>Test/dtest/java</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                    <progress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                            <timeestimate seconds="0">0h</timeestimate>
                            <timespent seconds="18600">5h 10m</timespent>
                                <comments>
                            <comment id="16964853" author="drohrer" created="Fri, 1 Nov 2019 14:11:11 +0000"  >&lt;p&gt;This set of PRs allows the in-jvm dtest framework to support native protocol clients, which allows for testing of the Java client and other use-cases where it makes sense to test from &quot;outside&quot; (Spark, for example).&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;Four PRs for different Cassandra versions:&lt;/p&gt;

&lt;p&gt;2.2 &lt;a href=&quot;https://github.com/apache/cassandra/pull/377&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;changes&lt;/a&gt; &lt;a href=&quot;https://circleci.com/workflow-run/19f5082f-eedc-4d8e-8d33-558848fddc77&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;Circle&lt;/a&gt;&lt;br/&gt;
 3.0 &lt;a href=&quot;https://github.com/apache/cassandra/pull/376&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;changes&lt;/a&gt; &lt;a href=&quot;https://circleci.com/workflow-run/ddf5b452-2a51-4d3a-9cd4-d4b279e0f280&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;Circle&lt;/a&gt;&lt;br/&gt;
 3.11 &lt;a href=&quot;https://github.com/apache/cassandra/pull/375&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;changes&lt;/a&gt; &lt;a href=&quot;https://circleci.com/workflow-run/59c4d1b6-c0c2-4179-b719-a8c041c849ff&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;Circle&lt;/a&gt;&lt;br/&gt;
 Trunk &lt;a href=&quot;https://github.com/apache/cassandra/pull/374&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;changes&lt;/a&gt; &lt;a href=&quot;https://circleci.com/workflow-run/fea3a793-bf13-4652-8b88-d29e1b513254&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;Circle&lt;/a&gt; &lt;/p&gt;

&lt;p&gt;The changes are more extensive than just &quot;Add Native Transport Support,&quot; as I ran into several reliability issues with the tests once we started allowing connectivity via the native transport, but may have already been causing some level of instability, and to speed up test execution times. These changes include:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Setting &lt;tt&gt;auto_bootstrap&lt;/tt&gt; to false by default for in-jvm dtests. There was no reason to wait for instances to bootstrap before starting tests, as the cluster is empty, which could slow down test execution and caused some test timing issues where requests could be made before the instance was fully ready. Tests that may need &lt;tt&gt;auto_bootstrap&lt;/tt&gt; later can always set it explicitly.&lt;/li&gt;
	&lt;li&gt;It was possible, especially in &lt;tt&gt;trunk&lt;/tt&gt;, for tests to fail to be able to create the initial keyspace requested in &lt;tt&gt;DistributedTestBase.init&lt;/tt&gt; because of a race between a hard-coded 60-second timeout in MigrationManager &lt;tt&gt;MIGRATION_DELAY_IN_MS&lt;/tt&gt; and an identical 60-second hard-coded wait timeout in the &lt;tt&gt;SchemaChangeMonitor&lt;/tt&gt;. This could occur if the instance where the schema change was submitted did not yet see one or more other instances in its live member list when first gossiping the schema change. There were two changes made to alleviate this issue:
	&lt;ul&gt;
		&lt;li&gt;Extend the &lt;tt&gt;SchemaChangeMonitor&lt;/tt&gt;&apos;s delay to 70 seconds to accommodate the &lt;tt&gt;MigrationManager&lt;/tt&gt;&apos;s 60-second delay&lt;/li&gt;
		&lt;li&gt;&#160;In order to avoid the root cause, and the potential of a 70 second delay if tests hit the race, also added a new monitor &lt;tt&gt;LiveMemberAgreementMonitor&lt;/tt&gt; which waits for all instances to agree that the live member count is equal to our expected count of instances running before moving on from Cluster.startup. This adds a very minor potential delay to cluster startup as we wait for the members to all see each other, but completely avoids the possibility that the subsequent schema change will be delayed by up to 60 seconds.&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;There are a few other minor changes/refactorings that were picked up from Alex&apos;s original patch for this change, which was never submitted to C*, so he was kind enough to help me put this together and has done some early code review as well. A new test &lt;tt&gt;NativeTransportTest&lt;/tt&gt; was added to cover the native transport functionality and a new &lt;tt&gt;ResourceLeakTest&lt;/tt&gt; to make sure we weren&apos;t introducing any cross-classloader references that would block collection of classes and exhaust java&apos;s metaspace.&lt;/p&gt;</comment>
                            <comment id="16969616" author="ifesdjeen" created="Thu, 7 Nov 2019 22:42:45 +0000"  >&lt;p&gt;Thank you for the patch! I&apos;ve left several comments here: &lt;a href=&quot;https://github.com/apache/cassandra/pull/377#pullrequestreview-313587421&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/cassandra/pull/377#pullrequestreview-313587421&lt;/a&gt; &lt;/p&gt;

&lt;p&gt;I&apos;ll check out the other branches as soon as we have an agreement on 2.x branch.&lt;/p&gt;</comment>
                            <comment id="16971657" author="ifesdjeen" created="Mon, 11 Nov 2019 15:02:39 +0000"  >&lt;p&gt;During commit, I&apos;ve noticed a couple of minor problems: &lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;in 2.2, we have to await for shutdown of the transport, since otherwise Netty cleanup task may attempt to call allocator, which may be unloaded by that time&lt;/li&gt;
	&lt;li&gt;in 3.11, the approach I&apos;ve suggested with polling didn&apos;t work, since it was causing gossiper instance to initialise token metadata before database descriptor, resulting into empty partitioner. I&apos;ve fixed the order there, too.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;There were several minor changes on commit, but all of them were cosmetic.&lt;/p&gt;

&lt;p&gt;Committed to 2.2 with &lt;a href=&quot;https://github.com/apache/cassandra/commit/d90dc87bd3f8a149d98ccf40b40bf152405fbbec&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;d90dc87bd3f8a149d98ccf40b40bf152405fbbec&lt;/a&gt; and merged up to &lt;a href=&quot;https://github.com/apache/cassandra/commit/d90dc87bd3f8a149d98ccf40b40bf152405fbbec&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;3.0&lt;/a&gt;, &lt;a href=&quot;https://github.com/apache/cassandra/commit/0d5ccb9c2f65ddee4a1b18b76800b7b88d3c6379&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;3.11&lt;/a&gt;, and &lt;a href=&quot;https://github.com/apache/cassandra/commit/fa85ff978bae303fe1b06dce64b758b635278a4d&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;trunk&lt;/a&gt;.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[drohrer]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12313825" key="com.atlassian.jira.plugin.system.customfieldtypes:cascadingselect">
                        <customfieldname>Bug Category</customfieldname>
                        <customfieldvalues>
                                                    <customfieldvalue key="13163" cascade-level=""><![CDATA[Code]]></customfieldvalue>
            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12313821" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Complexity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12965"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313822" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Discovered By</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12975"><![CDATA[Code Inspection]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12313922" key="jira.plugin.projectspecificselectfield.jpssf:multicftype">
                        <customfieldname>Impacts</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="13100"><![CDATA[None]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            6 years, 1 week, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12313921" key="jira.plugin.projectspecificselectfield.jpssf:multicftype">
                        <customfieldname>Platform</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="13076"><![CDATA[All]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z07ds0:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[ifesdjeen]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12962"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12311420" key="com.atlassian.jira.plugin.system.customfieldtypes:version">
                        <customfieldname>Since Version</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="12344929">2.2.15</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313924" key="com.atlassian.jira.plugin.system.customfieldtypes:textfield">
                        <customfieldname>Source Control Link</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>&lt;p&gt;&lt;a href=&quot;https://github.com/apache/cassandra/commit/50b7094278241f389d3b0b49b02e893fd4322b12&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/cassandra/commit/50b7094278241f389d3b0b49b02e893fd4322b12&lt;/a&gt;&lt;/p&gt;</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313823" key="com.atlassian.jira.plugin.system.customfieldtypes:textarea">
                        <customfieldname>Test and Documentation Plan</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>&lt;p&gt;See comments for PRs.&lt;/p&gt;</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>