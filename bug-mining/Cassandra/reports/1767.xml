<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 22:35:02 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-4612] cql error with ORDER BY when using IN</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-4612</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;            CREATE TABLE test(
                my_id varchar, 
                col1 &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;, 
                value varchar, 
                PRIMARY KEY (my_id, col1)
            );

INSERT INTO test(my_id, col1, value) VALUES ( &lt;span class=&quot;code-quote&quot;&gt;&apos;key1&apos;&lt;/span&gt;, 1, &lt;span class=&quot;code-quote&quot;&gt;&apos;a&apos;&lt;/span&gt;);
INSERT INTO test(my_id, col1, value) VALUES ( &lt;span class=&quot;code-quote&quot;&gt;&apos;key2&apos;&lt;/span&gt;, 3, &lt;span class=&quot;code-quote&quot;&gt;&apos;c&apos;&lt;/span&gt;);
INSERT INTO test(my_id, col1, value) VALUES ( &lt;span class=&quot;code-quote&quot;&gt;&apos;key3&apos;&lt;/span&gt;, 2, &lt;span class=&quot;code-quote&quot;&gt;&apos;b&apos;&lt;/span&gt;);
INSERT INTO test(my_id, col1, value) VALUES ( &lt;span class=&quot;code-quote&quot;&gt;&apos;key4&apos;&lt;/span&gt;, 4, &lt;span class=&quot;code-quote&quot;&gt;&apos;d&apos;&lt;/span&gt;);
SELECT col1 FROM test WHERE my_id in(&lt;span class=&quot;code-quote&quot;&gt;&apos;key1&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;key2&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;key3&apos;&lt;/span&gt;) ORDER BY col1;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The following error results: TSocket read 0 bytes&lt;br/&gt;
The log gives a traceback:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;ERROR [Thrift:8] 2012-09-04 12:02:15,894 CustomTThreadPoolServer.java (line 202) Error occurred during processing of message.
java.lang.IndexOutOfBoundsException: Index: 1, Size: 1
	at java.util.ArrayList.RangeCheck(ArrayList.java:547)
	at java.util.ArrayList.get(ArrayList.java:322)
	at org.apache.cassandra.cql3.statements.SelectStatement$SingleColumnComparator.compare(SelectStatement.java:1356)
	at org.apache.cassandra.cql3.statements.SelectStatement$SingleColumnComparator.compare(SelectStatement.java:1343)
	at java.util.Arrays.mergeSort(Arrays.java:1270)
	at java.util.Arrays.sort(Arrays.java:1210)
	at java.util.Collections.sort(Collections.java:159)
	at org.apache.cassandra.cql3.statements.SelectStatement.orderResults(SelectStatement.java:821)
	at org.apache.cassandra.cql3.statements.SelectStatement.process(SelectStatement.java:793)
	at org.apache.cassandra.cql3.statements.SelectStatement.executeInternal(SelectStatement.java:136)
	at org.apache.cassandra.cql3.statements.SelectStatement.execute(SelectStatement.java:118)
	at org.apache.cassandra.cql3.statements.SelectStatement.execute(SelectStatement.java:62)
	at org.apache.cassandra.cql3.QueryProcessor.processStatement(QueryProcessor.java:107)
	at org.apache.cassandra.cql3.QueryProcessor.process(QueryProcessor.java:115)
	at org.apache.cassandra.thrift.CassandraServer.execute_cql_query(CassandraServer.java:1521)
	at org.apache.cassandra.thrift.Cassandra$Processor$execute_cql_query.getResult(Cassandra.java:3618)
	at org.apache.cassandra.thrift.Cassandra$Processor$execute_cql_query.getResult(Cassandra.java:3606)
	at org.apache.thrift.ProcessFunction.process(ProcessFunction.java:32)
	at org.apache.thrift.TBaseProcessor.process(TBaseProcessor.java:34)
	at org.apache.cassandra.thrift.CustomTThreadPoolServer$WorkerProcess.run(CustomTThreadPoolServer.java:184)
	at java.util.concurrent.ThreadPoolExecutor$Worker.runTask(ThreadPoolExecutor.java:886)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:908)
	at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:662)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment>&lt;p&gt;ubuntu, cassandra trunk (commit 769fe895a36868c47101f681f5fdd721bee1ad62 )&lt;/p&gt;</environment>
        <key id="12606123">CASSANDRA-4612</key>
            <summary>cql error with ORDER BY when using IN</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10002" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Normal</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="xedin">Pavel Yaskevich</assignee>
                                    <reporter username="tpatterson">Tyler Patterson</reporter>
                        <labels>
                    </labels>
                <created>Tue, 4 Sep 2012 18:20:39 +0000</created>
                <updated>Tue, 16 Apr 2019 09:32:28 +0000</updated>
                            <resolved>Fri, 7 Sep 2012 16:01:38 +0000</resolved>
                                        <fixVersion>1.1.5</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="13449576" author="xedin" created="Thu, 6 Sep 2012 11:28:44 +0000"  >&lt;p&gt;fixed problem related to determining position when single &apos;order by&apos; condition is used and added a check to prevent users from ordering by columns which are not included in the select clause.&lt;/p&gt;</comment>
                            <comment id="13449705" author="slebresne" created="Thu, 6 Sep 2012 14:32:14 +0000"  >&lt;p&gt;The fix for the case where there is only one ordered column lgtm but this doesn&apos;t handle the CompositeComparator case.&lt;/p&gt;</comment>
                            <comment id="13449706" author="slebresne" created="Thu, 6 Sep 2012 14:34:14 +0000"  >&lt;p&gt;Also, I believe this affect 1.1 as well, so I would suggest fixing it there.&lt;/p&gt;</comment>
                            <comment id="13449728" author="xedin" created="Thu, 6 Sep 2012 15:15:05 +0000"  >&lt;p&gt;ported to 1.1 and added composite support.&lt;/p&gt;</comment>
                            <comment id="13449823" author="slebresne" created="Thu, 6 Sep 2012 17:16:47 +0000"  >&lt;p&gt;I believe that removing the &quot;Order by currently only support the ordering of columns following their declared order in the PRIMARY KEY&quot; is buggy because it still doesn&apos;t work in the case where the key restriction is an EQ (i.e. not an IN). That is, we can remove it but in that case we must change the condition at the top of orderResults() so that we go through the &apos;CompositeComparator&apos; path if the keyRestriction is an EQ and the requested orderings are not in the same order that in the PK definition. Not a bad idea though.&lt;/p&gt;

&lt;p&gt;Some minor nits:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;We can provide the size when allocating the typesWithPositions list. I would have split typesWithPositions in two lists as this reduce the number of allocation needed (because you avoid all the Pair but also because you can use int[] for the positions) and in that case wouldn&apos;t really complicate the code anyway.&lt;/li&gt;
	&lt;li&gt;In getColumnPositionInSelect, we could use a by-index for loop and directly return the current index when we find the name. That way we can throw an assertion if we didn&apos;t find the name at all since that shouldn&apos;t happen anyway (tiny bonus: iteration by index on ArrayList is slightly cheaper as it avoids the iterator allocation).&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13449891" author="xedin" created="Thu, 6 Sep 2012 18:17:27 +0000"  >&lt;p&gt;Looks like its&apos;s just not my day today, I will fix keyRestriction thing and nits asap.&lt;/p&gt;</comment>
                            <comment id="13450037" author="xedin" created="Thu, 6 Sep 2012 20:55:46 +0000"  >&lt;p&gt;v2 with nits fixed and order restriction reverted to original state after discussion with Jonathan.&lt;/p&gt;</comment>
                            <comment id="13450503" author="slebresne" created="Fri, 7 Sep 2012 10:04:51 +0000"  >&lt;p&gt;lgtm, +1&lt;/p&gt;</comment>
                            <comment id="13450741" author="xedin" created="Fri, 7 Sep 2012 16:01:38 +0000"  >&lt;p&gt;Committed.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12544107" name="CASSANDRA-4612-v2.patch" size="6024" author="xedin" created="Thu, 6 Sep 2012 20:55:46 +0000"/>
                            <attachment id="12544056" name="CASSANDRA-4612.patch" size="6622" author="xedin" created="Thu, 6 Sep 2012 15:15:05 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[xedin]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>244027</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            13 years, 11 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i05ajr:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>28806</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>slebresne</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[slebresne]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12962"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>