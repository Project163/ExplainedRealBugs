<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 23:06:38 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-13237] Legacy deserializer can create unexpected boundary range tombstones</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-13237</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;Most of the code don&apos;t generate a range tombstone boundary with the same deletion time on both side as this is basically useless, and there is some assertion in &lt;tt&gt;DataResolver&lt;/tt&gt; that actually expect this. However, the deserializer for legacy sstable doesn&apos;t always properly avoid their creation and we can thus generate them (and break the &lt;tt&gt;DataResolver&lt;/tt&gt; assertion.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13044000">CASSANDRA-13237</key>
            <summary>Legacy deserializer can create unexpected boundary range tombstones</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10002" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Normal</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="slebresne">Sylvain Lebresne</assignee>
                                    <reporter username="slebresne">Sylvain Lebresne</reporter>
                        <labels>
                    </labels>
                <created>Fri, 17 Feb 2017 13:53:33 +0000</created>
                <updated>Tue, 16 Apr 2019 09:30:09 +0000</updated>
                            <resolved>Thu, 23 Feb 2017 14:22:25 +0000</resolved>
                                        <fixVersion>3.0.12</fixVersion>
                    <fixVersion>3.11.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="15871929" author="slebresne" created="Fri, 17 Feb 2017 14:43:56 +0000"  >&lt;p&gt;Attaching patches for the problem below:&lt;/p&gt;
&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;a href=&quot;https://github.com/pcmanus/cassandra/commits/13237-3.0&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;13237-3.0&lt;/a&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;a href=&quot;http://cassci.datastax.com/job/pcmanus-13237-3.0-testall&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;utests&lt;/a&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;a href=&quot;http://cassci.datastax.com/job/pcmanus-13237-3.0-dtest&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;dtests&lt;/a&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;a href=&quot;https://github.com/pcmanus/cassandra/commits/13237-3.11&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;13237-3.11&lt;/a&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;a href=&quot;http://cassci.datastax.com/job/pcmanus-13237-3.11-testall&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;utests&lt;/a&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;a href=&quot;http://cassci.datastax.com/job/pcmanus-13237-3.11-dtest&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;dtests&lt;/a&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;a href=&quot;https://github.com/pcmanus/cassandra/commits/13237-trunk&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;13237-trunk&lt;/a&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;a href=&quot;http://cassci.datastax.com/job/pcmanus-13237-trunk-testall&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;utests&lt;/a&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;a href=&quot;http://cassci.datastax.com/job/pcmanus-13237-trunk-dtest&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;dtests&lt;/a&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;


&lt;p&gt;The first commit of the 3.0/3.11 patches is actually not doing anything but just adding a unit test that shows we can indeed create a range tombstone boundary that have the same deletion on both sides. For that, and because we don&apos;t have an easy way to actually write old sstable, the patch also refactor &lt;tt&gt;UnfilteredDeserializer.OldFormatDeserializer&lt;/tt&gt; so that it can be unit tested. So while the diff may look &quot;large-ish&quot;, it&apos;s really just moving some code around for the test purposes.&lt;/p&gt;

&lt;p&gt;The 2nd commit does 2 things:&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;it fixes the legacy deserializer to stop doing this.&lt;/li&gt;
	&lt;li&gt;it update the assertion in &lt;tt&gt;DataResolver&lt;/tt&gt; that breaks with such boundaries (again, same deletion on both side of the boundary).&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;Not that while it may sound like the 1st part is enough, we can&apos;t guarantee that some use having already upgraded haven&apos;t some bad boundaries already (let&apos;s clarify when I say &quot;bad&quot; that it&apos;s really just an small inefficiency so not really a big deal) so we shouldn&apos;t break on those. Still, no point in creating such useless boundaries, hence the 1st part.&lt;/p&gt;

&lt;p&gt;The trunk patch really only include the &lt;tt&gt;DataResolver&lt;/tt&gt; change since legacy code has been removed there.&lt;/p&gt;</comment>
                            <comment id="15874391" author="blambov" created="Mon, 20 Feb 2017 11:16:45 +0000"  >&lt;p&gt;The deserializer fix and test look good, but there are some problems in &lt;tt&gt;DataResolver&lt;/tt&gt;:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Shouldn&apos;t we be looking at &lt;tt&gt;openDeletionTime&lt;/tt&gt; &lt;a href=&quot;https://github.com/pcmanus/cassandra/commit/ba7d1763c108a4a7d84b91ab9eb9b36d04efb0f5#diff-8781f9483cca1cfc87145c767295cc79R341&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;here&lt;/a&gt;?&lt;/li&gt;
	&lt;li&gt;Regardless of the result of that test, you are still setting &lt;tt&gt;markerToRepair&lt;/tt&gt; on the &lt;a href=&quot;https://github.com/pcmanus/cassandra/commit/ba7d1763c108a4a7d84b91ab9eb9b36d04efb0f5#diff-8781f9483cca1cfc87145c767295cc79R344&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;next line&lt;/a&gt; &amp;#8211; I don&apos;t think this is the intended behaviour.&lt;/li&gt;
	&lt;li&gt;Is it too hard to write a test for the above?&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="15874730" author="slebresne" created="Mon, 20 Feb 2017 15:55:28 +0000"  >&lt;p&gt;You&apos;re right, I didn&apos;t re-read the patch and botched it, sorry about that. I&apos;ve pushed an update to all branches that fixes both of your point in &lt;tt&gt;DataResolver&lt;/tt&gt; (both were indeed typos) and add a new test in &lt;tt&gt;DataResolverTest&lt;/tt&gt; to test this.&lt;/p&gt;

&lt;p&gt;I did rebased and force pushed the update mostly because I wanted the new test to be in the first commit so I could easily test it with and without the fixes (crappy excuse, I know) and I hope this isn&apos;t too much trouble (but I truly only did the changes of your points above).&lt;/p&gt;</comment>
                            <comment id="15875453" author="blambov" created="Tue, 21 Feb 2017 06:49:43 +0000"  >&lt;p&gt;The trunk patch doesn&apos;t appear to have any changes?&lt;/p&gt;

&lt;p&gt;Apart from that it looks good to me.&lt;/p&gt;</comment>
                            <comment id="15875619" author="slebresne" created="Tue, 21 Feb 2017 08:52:59 +0000"  >&lt;blockquote&gt;&lt;p&gt;The trunk patch doesn&apos;t appear to have any changes?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Forgot to commit before pushing, sorry &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/sad.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;. Done now so I&apos;ll wait on the CI to make sure.&lt;/p&gt;</comment>
                            <comment id="15880504" author="slebresne" created="Thu, 23 Feb 2017 14:22:25 +0000"  >&lt;p&gt;Alright, committed, thanks.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[slebresne]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 38 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3a8o7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>blambov</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[blambov]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12962"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>