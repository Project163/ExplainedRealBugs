<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 23:00:21 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-10880] Paging state between 2.2 and 3.0 are incompatible on protocol v4</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-10880</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;In &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-10254&quot; title=&quot;3.0 paging states are incompatible with pre-3.0 nodes&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-10254&quot;&gt;&lt;del&gt;CASSANDRA-10254&lt;/del&gt;&lt;/a&gt;, the paging states generated by 3.0 for the native protocol v4 were made 3.0 specific. This was done because the paging state in pre-3.0 versions contains a serialized cell name, but 3.0 doesn&apos;t talk in term of cells internally (at least not the pre-3.0 ones) and so using an old-format cell name when we only have 3.0 nodes is inefficient and inelegant.&lt;/p&gt;

&lt;p&gt;Unfortunately that change was made on the assumption than the protocol v4 was 3.0 only but it&apos;s not, it ended up being released with 2.2 and that completely slipped my mind. So in practice, you can&apos;t properly have a mixed 2.2/3.0 cluster if your driver is using the protocol v4.&lt;/p&gt;

&lt;p&gt;And unfortunately, I don&apos;t think there is an easy way to fix that without breaking something. Concretely, I can see 3 choices:&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;we change 3.0 so that it generates old-format paging states on the v4 protocol. The 2 main downsides are that 1) this breaks 3.0 upgrades if the driver is using the v4 protocol, and at least on the java side the only driver versions that support 3.0 will use v4 by default and 2) we&apos;re signing off on having sub-optimal paging state until the protocol v5 ships (probably not too soon).&lt;/li&gt;
	&lt;li&gt;we remove the v4 protocol from 2.2. This means 2.2 will have to use v3 before upgrade at the risk of breaking upgrade. This is also bad, but I&apos;m not sure the driver version using the v4 protocol are quite ready yet (at least the java driver is not GA yet) so if we work with the drivers teams to make sure the v3 protocol gets prefered by default on 2.2 in the GA versions of these driver, this might be somewhat transparent to users.&lt;/li&gt;
	&lt;li&gt;we don&apos;t change anything code-wise, but we document clearly that you can&apos;t upgrade from 2.2 to 3.0 if your clients use protocol v4 (so we leave upgrade broken if the v4 protocol is used as it is currently). This is not great, but we can work with the drivers teams here again to make sure drivers prefer the v3 version for 2.2 nodes so most people don&apos;t notice in practice.&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;I think I&apos;m leaning towards solution 3). It&apos;s not great but at least we break no minor upgrades (neither on 2.2, nor on 3.0) which is probably the most important. We&apos;d basically be just adding a new condition on 2.2-&amp;gt;3.0 upgrades.  We could additionally make 3.0 node completely refuse v4 connections if they know a 2.2 nodes is in the cluster for extra safety.&lt;/p&gt;

&lt;p&gt;Ping &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=omichallat&quot; class=&quot;user-hover&quot; rel=&quot;omichallat&quot;&gt;omichallat&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=adutra&quot; class=&quot;user-hover&quot; rel=&quot;adutra&quot;&gt;adutra&lt;/a&gt; and &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=aholmber&quot; class=&quot;user-hover&quot; rel=&quot;aholmber&quot;&gt;aholmber&lt;/a&gt; as you might want to be aware of that ticket.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12922349">CASSANDRA-10880</key>
            <summary>Paging state between 2.2 and 3.0 are incompatible on protocol v4</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10000" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Urgent</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="slebresne">Sylvain Lebresne</assignee>
                                    <reporter username="slebresne">Sylvain Lebresne</reporter>
                        <labels>
                    </labels>
                <created>Wed, 16 Dec 2015 11:24:48 +0000</created>
                <updated>Wed, 6 Nov 2019 21:57:47 +0000</updated>
                            <resolved>Thu, 7 Jan 2016 15:28:36 +0000</resolved>
                                        <fixVersion>3.0.3</fixVersion>
                    <fixVersion>3.2</fixVersion>
                                    <component>Legacy/CQL</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>9</watches>
                                                                                                                <comments>
                            <comment id="15060103" author="aholmber" created="Wed, 16 Dec 2015 15:06:10 +0000"  >&lt;p&gt;Just a note on v4 and preferred version: Python driver has supported v4 (and defaulted it) since version 2.6.0 ( released in conjunction with Cassandra 2.2.0 pre-release series in June 2015).&lt;/p&gt;</comment>
                            <comment id="15060536" author="stamhankar999" created="Wed, 16 Dec 2015 18:57:36 +0000"  >&lt;p&gt;Not sure if we want to prefer v3 for Cassandra 2.2 because then we lose UDF/UDA support in the driver, don&apos;t we? For example, the v3 protocol doc doesn&apos;t mention how to handle schema change events for FUNCTIONs and AGGREGATEs, while the v4 protocol doc does.&lt;/p&gt;</comment>
                            <comment id="15061862" author="slebresne" created="Thu, 17 Dec 2015 10:32:45 +0000"  >&lt;blockquote&gt;&lt;p&gt;we lose UDF/UDA support in the driver, don&apos;t we?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Well, not really. We really only lose the &lt;em&gt;specific&lt;/em&gt; schema change events, but changes are still notified (as keyspace update if memory serves) so drivers can still deal with it (albeit in a slightly less efficient manner since they don&apos;t know what function has been added/updated and they may have to read more to figure that out, but that is unlikely to have much visible impact to users in practice).&lt;/p&gt;

&lt;p&gt;But let me be clear that I&apos;m not pretending any of the solutions above are great, they&apos;re not. And if someone has some idea I haven&apos;t think of that is much better, please do share. Short of that, I think &quot;you shouldn&apos;t use the nice-but-not-absolutely-necessary additions of the v4 protocol until 3.0&quot; is better than &quot;you cannot upgrade to 3.x&quot;.&lt;/p&gt;</comment>
                            <comment id="15081085" author="slebresne" created="Mon, 4 Jan 2016 12:23:25 +0000"  >&lt;p&gt;After some offline discussions, there was some agreement on going with option 3 above: simply document clearly that the protocol v3 should be used when migrating to 3.X. Unless someone has a strong objection to this or something better to suggest in the next day or so, I&apos;ll proceed by adding a clear mention in the &lt;tt&gt;NEWS&lt;/tt&gt; file (including what you lose by sticking to the protocol v3, which as said above is not a whole lot) and sending a mail to the user list to grab attention on this issue.&lt;/p&gt;</comment>
                            <comment id="15087573" author="slebresne" created="Thu, 7 Jan 2016 15:28:36 +0000"  >&lt;p&gt;As said above, I&apos;ve now pushed an email to the mailing list about this and added instructions (to use the native protocol v3 during upgrades) to the NEWS file, so closing.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                                                <inwardlinks description="is duplicated by">
                                        <issuelink>
            <issuekey id="13158783">CASSANDRA-14444</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[slebresne]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12313922" key="jira.plugin.projectspecificselectfield.jpssf:multicftype">
                        <customfieldname>Impacts</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="13101"><![CDATA[Clients]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 45 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2pz3j:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12963"><![CDATA[Critical]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>