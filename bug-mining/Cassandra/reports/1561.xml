<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 22:31:21 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-4100] Make scrub and cleanup operations throttled</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-4100</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;Looks like scrub and cleanup operations are not throttled and it will be nice to throttle else we are likely to run into IO issues while running it on live cluster.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12548569">CASSANDRA-4100</key>
            <summary>Make scrub and cleanup operations throttled</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10003" iconUrl="https://issues.apache.org/jira/images/icons/priorities/trivial.svg">Low</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="vijay2win@yahoo.com">Vijay</assignee>
                                    <reporter username="vijay2win@yahoo.com">Vijay</reporter>
                        <labels>
                            <label>compaction</label>
                    </labels>
                <created>Wed, 28 Mar 2012 22:42:35 +0000</created>
                <updated>Tue, 16 Apr 2019 09:32:36 +0000</updated>
                            <resolved>Wed, 11 Apr 2012 00:49:10 +0000</resolved>
                                        <fixVersion>1.1.1</fixVersion>
                    <fixVersion>1.2.0 beta 1</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                                                                <comments>
                            <comment id="13245624" author="vijay2win@yahoo.com" created="Tue, 3 Apr 2012 19:15:58 +0000"  >&lt;p&gt;Attached patch adds the throttle for cleanup and scrub. &lt;br/&gt;
Note: compaction_throughput_mb_per_sec is used for the throttling, not sure if making a seperate property for cleanup/scrub is better....&lt;/p&gt;</comment>
                            <comment id="13246329" author="yukim" created="Wed, 4 Apr 2012 15:01:09 +0000"  >&lt;p&gt;Looks like patch is against trunk, though fix version is marked as 1.0.10.&lt;br/&gt;
Anyway, I think Throttle object in CompcationController should be non-static since compactions may run in parallel.&lt;/p&gt;</comment>
                            <comment id="13246370" author="vijay2win@yahoo.com" created="Wed, 4 Apr 2012 15:36:35 +0000"  >&lt;p&gt;&amp;gt;&amp;gt;&amp;gt; I think Throttle object in CompcationController should be non-static since compactions may run in parallel.&lt;br/&gt;
Exactly thats why static is better, Parallel compaction is not a problem per say (ParallelCompactionIterable.getReduced() will take care of it), but compaction running one after the other (lot of small compactions).&lt;/p&gt;

&lt;p&gt;Let me know if everything else is ok i will rebase to 1.0.10 and move away from static (I am ok either ways), if needed. Thanks!&lt;/p&gt;</comment>
                            <comment id="13250188" author="yukim" created="Mon, 9 Apr 2012 21:18:08 +0000"  >&lt;p&gt;OK, so static Throttle is fine here since one compaction_throughput_mb_per_sec is used for all compactions. Then, do we need to divide that by number of active compactions? I&apos;m referring the code inside the implementation of ThroughputFunction:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;totalBytesPerMS / &lt;span class=&quot;code-object&quot;&gt;Math&lt;/span&gt;.max(1, CompactionManager.instance.getActiveCompactions());
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="13250304" author="vijay2win@yahoo.com" created="Mon, 9 Apr 2012 23:38:40 +0000"  >&lt;p&gt;Fixed. Thanks!&lt;/p&gt;</comment>
                            <comment id="13250486" author="slebresne" created="Tue, 10 Apr 2012 07:27:11 +0000"  >&lt;blockquote&gt;&lt;p&gt;OK, so static Throttle is fine&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I&apos;ll have to disagree. I&apos;m pretty sure this patch break throttling. If more than one compaction share the Throttle object, they also share the Throttle.timeAtLastDelay field. Which means that as soon as there is more than 1 compaction running at any given time, the interval on which throttling is computing is bogus, and thus throttling will be bogus.&lt;/p&gt;

&lt;p&gt;More generally, I&apos;m -1 on changing code that does not have any known problem on the 1.0 branch (and as far as I know, current throttling works well) as 1.0 is getting really stable and we should start being conservative there (but I&apos;d be fine with a patch that just add throttling to scrub and cleanup for 1.0).&lt;/p&gt;</comment>
                            <comment id="13250489" author="slebresne" created="Tue, 10 Apr 2012 07:37:07 +0000"  >&lt;p&gt;And to be clear, I&apos;m not saying that throttling cannot be improved (it is true that currently it is too conservative and could throttle a thread even though the total throughput is below the threshold), but I&apos;m saying that 1) this patch does not fix that correctly and 2) in any case this should be another ticket that shouldn&apos;t be targeted at 1.0.&lt;/p&gt;</comment>
                            <comment id="13250877" author="vijay2win@yahoo.com" created="Tue, 10 Apr 2012 17:53:48 +0000"  >&lt;p&gt;Alright, v3 simply adds throttle to scrub and cleanup... Simple refactor to move the throttle to compaction controller.&lt;/p&gt;</comment>
                            <comment id="13251101" author="yukim" created="Tue, 10 Apr 2012 21:59:02 +0000"  >&lt;p&gt;v3 looks good to me, but as Sylvain said, I&apos;m +1 to put this to version 1.1.1 instead of 1.0.10.&lt;/p&gt;</comment>
                            <comment id="13251214" author="vijay2win@yahoo.com" created="Wed, 11 Apr 2012 00:49:10 +0000"  >&lt;p&gt;Committed to 1.1 and trunk. Thanks!&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12522040" name="0001-CASSANDRA-4100-v2.patch" size="10232" author="vijay2win@yahoo.com" created="Mon, 9 Apr 2012 23:38:40 +0000"/>
                            <attachment id="12522138" name="0001-CASSANDRA-4100-v3.patch" size="8618" author="vijay2win@yahoo.com" created="Tue, 10 Apr 2012 17:53:47 +0000"/>
                            <attachment id="12521194" name="0001-CASSANDRA-4100.patch" size="9903" author="vijay2win@yahoo.com" created="Tue, 3 Apr 2012 19:15:58 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[vijay2win@yahoo.com]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>233666</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            13 years, 32 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0grz3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>95962</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>yukim</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[yukim]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12961"><![CDATA[Low]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>