<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 22:55:32 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-9418] Fix dtests on 2.2 branch on Windows</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-9418</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;There&apos;s a variety of infrastructural failures within dtest w/regards to windows that are causing tests to fail and those failures to cascade.&lt;/p&gt;

&lt;p&gt;Error: failure to delete commit log after a test / ccm cluster is stopped:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Traceback (most recent call last):
  File &quot;C:\src\cassandra-dtest\dtest.py&quot;, line 452, in tearDown
    self._cleanup_cluster()
  File &quot;C:\src\cassandra-dtest\dtest.py&quot;, line 172, in _cleanup_cluster
    self.cluster.remove()
  File &quot;build\bdist.win-amd64\egg\ccmlib\cluster.py&quot;, line 212, in remove
    shutil.rmtree(self.get_path())
  File &quot;C:\Python27\lib\shutil.py&quot;, line 247, in rmtree
    rmtree(fullname, ignore_errors, onerror)
  File &quot;C:\Python27\lib\shutil.py&quot;, line 247, in rmtree
    rmtree(fullname, ignore_errors, onerror)
  File &quot;C:\Python27\lib\shutil.py&quot;, line 252, in rmtree
    onerror(os.remove, fullname, sys.exc_info())
  File &quot;C:\Python27\lib\shutil.py&quot;, line 250, in rmtree
    os.remove(fullname)
WindowsError: [Error 5] Access is denied: &apos;c:\\temp\\dtest-4rxq2i\\test\\node1\\commitlogs\\CommitLog-5-1431969131917.log&apos;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Cascading error: implication is that tests aren&apos;t shutting down correctly and subsequent tests cannot start:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;06:00:20 ERROR: test_incr_decr_super_remove (thrift_tests.TestMutations)
06:00:20 ----------------------------------------------------------------------
06:00:20 Traceback (most recent call last):
06:00:20   File &quot;D:\jenkins\workspace\trunk_dtest_win32\cassandra-dtest\thrift_tests.py&quot;, line 55, in setUp
06:00:20     cluster.start()
06:00:20   File &quot;build\bdist.win-amd64\egg\ccmlib\cluster.py&quot;, line 249, in start
06:00:20     p = node.start(update_pid=False, jvm_args=jvm_args, profile_options=profile_options)
06:00:20   File &quot;build\bdist.win-amd64\egg\ccmlib\node.py&quot;, line 457, in start
06:00:20     common.check_socket_available(itf)
06:00:20   File &quot;build\bdist.win-amd64\egg\ccmlib\common.py&quot;, line 341, in check_socket_available
06:00:20     raise UnavailableSocketError(&quot;Inet address %s:%s is not available: %s&quot; % (addr, port, msg))
06:00:20 UnavailableSocketError: Inet address 127.0.0.1:9042 is not available: [Errno 10013] An attempt was made to access a socket in a way forbidden by its access permissions
06:00:20 -------------------- &amp;gt;&amp;gt; begin captured logging &amp;lt;&amp;lt; --------------------
06:00:20 dtest: DEBUG: removing ccm cluster test at: d:\temp\dtest-a5iny5
06:00:20 dtest: DEBUG: cluster ccm directory: d:\temp\dtest-dalzcy
06:00:20 --------------------- &amp;gt;&amp;gt; end captured logging &amp;lt;&amp;lt; ---------------------
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I&apos;ve also seen (and am debugging) an error where a node just fails to start via ccm.&lt;/p&gt;

&lt;p&gt;I&apos;ll update this ticket with PR&apos;s to dtest or other observations of interest.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12830796">CASSANDRA-9418</key>
            <summary>Fix dtests on 2.2 branch on Windows</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10002" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Normal</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="2">Won&apos;t Fix</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="jmckenzie">Josh McKenzie</reporter>
                        <labels>
                            <label>Windows</label>
                    </labels>
                <created>Mon, 18 May 2015 19:11:24 +0000</created>
                <updated>Wed, 15 Oct 2025 09:49:06 +0000</updated>
                            <resolved>Wed, 29 Sep 2021 17:32:15 +0000</resolved>
                                        <fixVersion>2.2.x</fixVersion>
                                    <component>Test/dtest/python</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                                                            <comments>
                            <comment id="14561704" author="jmckenzie" created="Wed, 27 May 2015 20:51:47 +0000"  >&lt;p&gt;A simple ccm PR (&lt;a href=&quot;https://github.com/pcmanus/ccm/pull/289&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;link&lt;/a&gt;) and a dtest PR (&lt;a href=&quot;https://github.com/riptano/cassandra-dtest/pull/299&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;link&lt;/a&gt;) have knocked off 226 more failures and gotten us down to 338 failures from 564 (&lt;a href=&quot;http://cassci.datastax.com/view/trunk/job/trunk_dtest_win32/271/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;test run here&lt;/a&gt;).&lt;/p&gt;

&lt;p&gt;In the logs there&apos;s a very high count of &quot;Found running cassandra process with pid: 15776. Killing.&quot; from the dtest change to kill running cassandra processes during Tester.setUp(). The matching ccm PR was intended to give us something to correlate w/those failures to find out if there were specific tests that were hanging and address them, however this first test run gave us over 100 instances of hung tests that had to be killed. Hopefully there&apos;s a systemic infrastructural issue that we can address that will help with those errors.&lt;/p&gt;

&lt;p&gt;There&apos;s still a high number of errors indicating missing system.log, conf&amp;#42;, or bin&amp;#42; files; there&apos;s some environmental silliness occurring I haven&apos;t gotten any clarity on yet as it&apos;s CI specific. The PR for ccm didn&apos;t actually print to stderr so once I figure out why CI / nosetests is absorbing that output, I&apos;ll probably also put in some more debug information from ccm regarding starting and stopping clusters and point CI to that debug branch to get more information out of it.&lt;/p&gt;</comment>
                            <comment id="14571257" author="jmckenzie" created="Wed, 3 Jun 2015 16:07:38 +0000"  >&lt;p&gt;After removing a windows-specific wrapper script and some windows-specific changes to both ccm and dtest:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;01:13:57 Ran 662 tests in 25177.644s
01:13:57 
01:13:57 FAILED (SKIP=49, errors=46, failures=18)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Moving on to addressing this class of errors next:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;01:13:57 ERROR: complex_data_types_test (json_test.FromJsonInsertTests)
01:13:57 ----------------------------------------------------------------------
01:13:57 Traceback (most recent call last):
01:13:57   File &quot;D:\jenkins\workspace\trunk_dtest_win32\cassandra-dtest\json_test.py&quot;, line 1030, in complex_data_types_test
01:13:57     run_func_docstring(tester=self, test_func=self.complex_data_types_test)
01:13:57   File &quot;D:\jenkins\workspace\trunk_dtest_win32\cassandra-dtest\json_test.py&quot;, line 165, in run_func_docstring
01:13:57     raise RuntimeError(&quot;Doctest failed! Captured output:\n{}&quot;.format(test_output_capturer.content))
01:13:57 RuntimeError: Doctest failed! Captured output:
01:13:57 **********************************************************************
01:13:57 Line 70, in complex_data_types_test
01:13:57 Failed example:
01:13:57     cqlsh_print(&quot;SELECT key1, mylist from complex_types where key1 in (&apos;row1&apos;, &apos;row2&apos;)&quot;)
01:13:57 Expected:
01:13:57     &amp;lt;BLANKLINE&amp;gt;
01:13:57      key1 | mylist
01:13:57     ------+-----------------------------------
01:13:57      row1 | [&apos;five&apos;, &apos;six&apos;, &apos;seven&apos;, &apos;eight&apos;]
01:13:57      row2 | [&apos;five&apos;, &apos;six&apos;, &apos;seven&apos;, &apos;eight&apos;]
01:13:57     &amp;lt;BLANKLINE&amp;gt;
01:13:57     (2 rows)
01:13:57     &amp;lt;BLANKLINE&amp;gt;
01:13:57 Got:
01:13:57     

01:13:57      key1 | mylist

01:13:57     ------+-----------------------------------

01:13:57      row1 | [&apos;five&apos;, &apos;six&apos;, &apos;seven&apos;, &apos;eight&apos;]

01:13:57      row2 | [&apos;five&apos;, &apos;six&apos;, &apos;seven&apos;, &apos;eight&apos;]

01:13:57     

01:13:57     (2 rows)

01:13:57     &amp;lt;BLANKLINE&amp;gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Once errors are address, then failures, then finally performance. 7 hours for a full run is pretty painful, but there&apos;s certainly some opportunities for optimization on the windows startup scripts etc.&lt;/p&gt;</comment>
                            <comment id="14573406" author="jmckenzie" created="Thu, 4 Jun 2015 19:07:34 +0000"  >&lt;p&gt;Issues w/json tests are two-fold:&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;&amp;lt;BLANKLINE&amp;gt; comparisons are mismatched on Windows&lt;/li&gt;
	&lt;li&gt;Default timestamp formatting is different on Windows.&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;Re: #1: python coerces line-endings on all print or write calls to platform-specific endings, CRLF in Windows&apos; case, which subsequently causes failures during the regex change and comparison in doctest.check_output as \s$ doesn&apos;t match the \s^M$ on Windows output. In order to resolve this, I&apos;ve opened a dtest PR to convert CRLF to LF in cqlsh_print on Windows: &lt;a href=&quot;https://github.com/riptano/cassandra-dtest/pull/312&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;PR&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Re: #2: It turns out there&apos;s a bug in the interaction between python&apos;s strftime and Windows clibs, specifically w/regards to %z in strftime (&lt;a href=&quot;http://bugs.python.org/issue20010&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;bug report&lt;/a&gt;) giving us a long string return on %z rather than the desired +/- vs. GMT.  &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-4746&quot; title=&quot;cqlsh timestamp formatting is broken - displays wrong timezone info (at least on Ubuntu)&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-4746&quot;&gt;&lt;del&gt;CASSANDRA-4746&lt;/del&gt;&lt;/a&gt; dealt with a somewhat similar issue so I&apos;ve piggybacked on that and attached a patch that will change the datetime formatter in cqlshlib to manually fix the TZ when on Windows and with a %z formatting flag.&lt;/p&gt;

&lt;p&gt;With the PR for dtest and the patch attached, all but 2 of the json tests are passing locally now.&lt;/p&gt;</comment>
                            <comment id="14575096" author="jmckenzie" created="Fri, 5 Jun 2015 19:51:33 +0000"  >&lt;p&gt;Marked docs-impacting since the windows %z replacement at 2 char from end should likely be mentioned on our &lt;a href=&quot;http://docs.datastax.com/en/cql/3.1/cql/cql_reference/cqlsh.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;cqlshrc documentation&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="14575191" author="aweisberg" created="Fri, 5 Jun 2015 20:46:37 +0000"  >&lt;p&gt;+1 for the patch attached to the ticket. We should document that on Windows with formats that end with %z we are going to nuke any non-&lt;span class=&quot;error&quot;&gt;&amp;#91;numeric | punctuation&amp;#93;&lt;/span&gt; characters that come out with the formatted time.&lt;/p&gt;</comment>
                            <comment id="14575723" author="jmckenzie" created="Sat, 6 Jun 2015 13:46:38 +0000"  >&lt;p&gt;&lt;a href=&quot;http://cassci.datastax.com/view/trunk/job/trunk_dtest_win32/307/#showFailuresLink&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;Down to 59 failures&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;CqlshCopyTests are next in line:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;[Errno 13] Permission denied: &apos;d:\\temp\\tmpyymlia&apos;

Stacktrace

  File &quot;D:\Python27\lib\unittest\case.py&quot;, line 329, in run
    testMethod()
  File &quot;D:\jenkins\workspace\trunk_dtest_win32\cassandra-dtest\cqlsh_tests\cqlsh_copy_tests.py&quot;, line 591, in test_read_invalid_float
    self.data_validation_on_read_template(2.14, expect_invalid=True)
  File &quot;D:\jenkins\workspace\trunk_dtest_win32\cassandra-dtest\cqlsh_tests\cqlsh_copy_tests.py&quot;, line 564, in data_validation_on_read_template
    write_rows_to_csv(tempfile.name, data)
  File &quot;D:\jenkins\workspace\trunk_dtest_win32\cassandra-dtest\cqlsh_tests\cqlsh_tools.py&quot;, line 59, in write_rows_to_csv
    with open(filename, &apos;w&apos;) as csvfile:
&quot;[Errno 13] Permission denied: &apos;d:\\\\temp\\\\tmpyymlia&apos;\n-------------------- &amp;gt;&amp;gt; begin captured logging &amp;lt;&amp;lt; --------------------\ndtest: DEBUG: cluster ccm directory: d:\\temp\\dtest-9uh67e\n--------------------- &amp;gt;&amp;gt; end captured logging &amp;lt;&amp;lt; ---------------------&quot;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="14639184" author="jmckenzie" created="Thu, 23 Jul 2015 17:26:29 +0000"  >&lt;p&gt;Rebased and committed the %z json fixing patch to 2.2 and trunk - slipped through the cracks.&lt;/p&gt;</comment>
                            <comment id="17422280" author="brandon.williams" created="Wed, 29 Sep 2021 17:32:15 +0000"  >&lt;p&gt;2.2 and windows are both gone.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12850346">CASSANDRA-9942</issuekey>
        </issuelink>
                            </outwardlinks>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12850345">CASSANDRA-9941</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12737658" name="9418_tz_formatting.txt" size="2361" author="joshuamckenzie" created="Thu, 4 Jun 2015 19:09:58 +0000"/>
                    </attachments>
                <subtasks>
                            <subtask id="12844861">CASSANDRA-9795</subtask>
                            <subtask id="12846943">CASSANDRA-9866</subtask>
                            <subtask id="12848381">CASSANDRA-9873</subtask>
                            <subtask id="12848945">CASSANDRA-9897</subtask>
                            <subtask id="12849393">CASSANDRA-9902</subtask>
                            <subtask id="12849404">CASSANDRA-9903</subtask>
                            <subtask id="12849406">CASSANDRA-9904</subtask>
                            <subtask id="12850737">CASSANDRA-9950</subtask>
                            <subtask id="12851492">CASSANDRA-9982</subtask>
                            <subtask id="12851491">CASSANDRA-9981</subtask>
                            <subtask id="12851486">CASSANDRA-9980</subtask>
                            <subtask id="12851500">CASSANDRA-9983</subtask>
                            <subtask id="12852289">CASSANDRA-9994</subtask>
                            <subtask id="12853887">CASSANDRA-10029</subtask>
                            <subtask id="12853921">CASSANDRA-10037</subtask>
                            <subtask id="12855409">CASSANDRA-10051</subtask>
                            <subtask id="12855734">CASSANDRA-10062</subtask>
                            <subtask id="12856203">CASSANDRA-10075</subtask>
                            <subtask id="12856205">CASSANDRA-10076</subtask>
                            <subtask id="12856207">CASSANDRA-10077</subtask>
                            <subtask id="12856209">CASSANDRA-10078</subtask>
                            <subtask id="12856960">CASSANDRA-10116</subtask>
                            <subtask id="12859686">CASSANDRA-10208</subtask>
                            <subtask id="12862457">CASSANDRA-10281</subtask>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12313922" key="jira.plugin.projectspecificselectfield.jpssf:multicftype">
                        <customfieldname>Impacts</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="13102"><![CDATA[Docs]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            4 years, 6 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2ew1r:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12962"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>