<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 22:55:27 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-9582] MarshalException after upgrading to 2.1.6</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-9582</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;I&apos;ve upgraded a node from 2.0.10 to 2.1.6. Before taking down the node, I&apos;ve run nodetool upgradesstables and nodetool scrub.&lt;/p&gt;

&lt;p&gt;When starting up the node with 2.1.6, I&apos;m getting a MarshalException (stacktrace included below). For some reason, it seems that C* is trying to convert a text value from the column &apos;currencyCode&apos; to a UUID, which it isn&apos;t.&lt;br/&gt;
I&apos;ve had similar errors for two other columns as well, which I could work around by dropping the table, since it wasn&apos;t used anymore.&lt;/p&gt;

&lt;p&gt;The only thing I could do was restoring a snapshot and starting up the old 2.0.10 again.&lt;/p&gt;

&lt;p&gt;The schema of the table (I&apos;ve got only one table containing a column named &apos;currencyCode&apos;) is:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;CREATE TABLE &lt;span class=&quot;code-quote&quot;&gt;&quot;InvoiceItem&quot;&lt;/span&gt; (
  key blob,
  column1 uuid,
  &lt;span class=&quot;code-quote&quot;&gt;&quot;currencyCode&quot;&lt;/span&gt; text,
  description text,
  &lt;span class=&quot;code-quote&quot;&gt;&quot;priceGross&quot;&lt;/span&gt; bigint,
  &lt;span class=&quot;code-quote&quot;&gt;&quot;priceNett&quot;&lt;/span&gt; bigint,
  quantity varint,
  sku text,
  &lt;span class=&quot;code-quote&quot;&gt;&quot;unitPriceGross&quot;&lt;/span&gt; bigint,
  &lt;span class=&quot;code-quote&quot;&gt;&quot;unitPriceNett&quot;&lt;/span&gt; bigint,
  vat bigint,
  &lt;span class=&quot;code-quote&quot;&gt;&quot;vatRateBasisPoints&quot;&lt;/span&gt; varint,
  PRIMARY KEY ((key), column1)
) WITH COMPACT STORAGE AND
  bloom_filter_fp_chance=0.010000 AND
  caching=&lt;span class=&quot;code-quote&quot;&gt;&apos;KEYS_ONLY&apos;&lt;/span&gt; AND
  comment=&apos;&apos; AND
  dclocal_read_repair_chance=0.000000 AND
  gc_grace_seconds=864000 AND
  index_interval=128 AND
  read_repair_chance=1.000000 AND
  replicate_on_write=&lt;span class=&quot;code-quote&quot;&gt;&apos;&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&apos;&lt;/span&gt; AND
  populate_io_cache_on_flush=&lt;span class=&quot;code-quote&quot;&gt;&apos;&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;&apos;&lt;/span&gt; AND
  default_time_to_live=0 AND
  speculative_retry=&lt;span class=&quot;code-quote&quot;&gt;&apos;99.0PERCENTILE&apos;&lt;/span&gt; AND
  memtable_flush_period_in_ms=0 AND
  compaction={&lt;span class=&quot;code-quote&quot;&gt;&apos;class&apos;&lt;/span&gt;: &lt;span class=&quot;code-quote&quot;&gt;&apos;SizeTieredCompactionStrategy&apos;&lt;/span&gt;} AND
  compression={};&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;


&lt;p&gt;The stack trace when starting up:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;ERROR 13:51:57 Exception encountered during startup
org.apache.cassandra.serializers.MarshalException: unable to make version 1 UUID from &lt;span class=&quot;code-quote&quot;&gt;&apos;currencyCode&apos;&lt;/span&gt;
	at org.apache.cassandra.db.marshal.UUIDType.fromString(UUIDType.java:188) ~[apache-cassandra-2.1.6.jar:2.1.6]
	at org.apache.cassandra.db.marshal.AbstractCompositeType.fromString(AbstractCompositeType.java:242) ~[apache-cassandra-2.1.6.jar:2.1.6]
	at org.apache.cassandra.config.ColumnDefinition.fromSchema(ColumnDefinition.java:397) ~[apache-cassandra-2.1.6.jar:2.1.6]
	at org.apache.cassandra.config.CFMetaData.fromSchemaNoTriggers(CFMetaData.java:1750) ~[apache-cassandra-2.1.6.jar:2.1.6]
	at org.apache.cassandra.config.CFMetaData.fromSchema(CFMetaData.java:1860) ~[apache-cassandra-2.1.6.jar:2.1.6]
	at org.apache.cassandra.config.KSMetaData.deserializeColumnFamilies(KSMetaData.java:321) ~[apache-cassandra-2.1.6.jar:2.1.6]
	at org.apache.cassandra.config.KSMetaData.fromSchema(KSMetaData.java:302) ~[apache-cassandra-2.1.6.jar:2.1.6]
	at org.apache.cassandra.db.DefsTables.loadFromKeyspace(DefsTables.java:133) ~[apache-cassandra-2.1.6.jar:2.1.6]
	at org.apache.cassandra.config.DatabaseDescriptor.loadSchemas(DatabaseDescriptor.java:696) ~[apache-cassandra-2.1.6.jar:2.1.6]
	at org.apache.cassandra.config.DatabaseDescriptor.loadSchemas(DatabaseDescriptor.java:672) ~[apache-cassandra-2.1.6.jar:2.1.6]
	at org.apache.cassandra.service.CassandraDaemon.setup(CassandraDaemon.java:293) [apache-cassandra-2.1.6.jar:2.1.6]
	at org.apache.cassandra.service.CassandraDaemon.activate(CassandraDaemon.java:536) [apache-cassandra-2.1.6.jar:2.1.6]
	at org.apache.cassandra.service.CassandraDaemon.main(CassandraDaemon.java:625) [apache-cassandra-2.1.6.jar:2.1.6]
Caused by: org.apache.cassandra.serializers.MarshalException: unable to coerce &lt;span class=&quot;code-quote&quot;&gt;&apos;currencyCode&apos;&lt;/span&gt; to a  formatted date (&lt;span class=&quot;code-object&quot;&gt;long&lt;/span&gt;)
	at org.apache.cassandra.serializers.TimestampSerializer.dateStringToTimestamp(TimestampSerializer.java:111) ~[apache-cassandra-2.1.6.jar:2.1.6]
	at org.apache.cassandra.db.marshal.UUIDType.fromString(UUIDType.java:184) ~[apache-cassandra-2.1.6.jar:2.1.6]
	... 12 common frames omitted
Caused by: java.text.ParseException: Unable to parse the date: currencyCode
	at org.apache.commons.lang3.time.DateUtils.parseDateWithLeniency(DateUtils.java:336) ~[commons-lang3-3.1.jar:3.1]
	at org.apache.commons.lang3.time.DateUtils.parseDateStrictly(DateUtils.java:286) ~[commons-lang3-3.1.jar:3.1]
	at org.apache.cassandra.serializers.TimestampSerializer.dateStringToTimestamp(TimestampSerializer.java:107) ~[apache-cassandra-2.1.6.jar:2.1.6]
	... 13 common frames omitted
org.apache.cassandra.serializers.MarshalException: unable to make version 1 UUID from &lt;span class=&quot;code-quote&quot;&gt;&apos;currencyCode&apos;&lt;/span&gt;
	at org.apache.cassandra.db.marshal.UUIDType.fromString(UUIDType.java:188)
	at org.apache.cassandra.db.marshal.AbstractCompositeType.fromString(AbstractCompositeType.java:242)
	at org.apache.cassandra.config.ColumnDefinition.fromSchema(ColumnDefinition.java:397)
	at org.apache.cassandra.config.CFMetaData.fromSchemaNoTriggers(CFMetaData.java:1750)
	at org.apache.cassandra.config.CFMetaData.fromSchema(CFMetaData.java:1860)
	at org.apache.cassandra.config.KSMetaData.deserializeColumnFamilies(KSMetaData.java:321)
	at org.apache.cassandra.config.KSMetaData.fromSchema(KSMetaData.java:302)
	at org.apache.cassandra.db.DefsTables.loadFromKeyspace(DefsTables.java:133)
	at org.apache.cassandra.config.DatabaseDescriptor.loadSchemas(DatabaseDescriptor.java:696)
	at org.apache.cassandra.config.DatabaseDescriptor.loadSchemas(DatabaseDescriptor.java:672)
	at org.apache.cassandra.service.CassandraDaemon.setup(CassandraDaemon.java:293)
	at org.apache.cassandra.service.CassandraDaemon.activate(CassandraDaemon.java:536)
	at org.apache.cassandra.service.CassandraDaemon.main(CassandraDaemon.java:625)
Caused by: org.apache.cassandra.serializers.MarshalException: unable to coerce &lt;span class=&quot;code-quote&quot;&gt;&apos;currencyCode&apos;&lt;/span&gt; to a  formatted date (&lt;span class=&quot;code-object&quot;&gt;long&lt;/span&gt;)
	at org.apache.cassandra.serializers.TimestampSerializer.dateStringToTimestamp(TimestampSerializer.java:111)
	at org.apache.cassandra.db.marshal.UUIDType.fromString(UUIDType.java:184)
	... 12 more
Caused by: java.text.ParseException: Unable to parse the date: currencyCode
	at org.apache.commons.lang3.time.DateUtils.parseDateWithLeniency(DateUtils.java:336)
	at org.apache.commons.lang3.time.DateUtils.parseDateStrictly(DateUtils.java:286)
	at org.apache.cassandra.serializers.TimestampSerializer.dateStringToTimestamp(TimestampSerializer.java:107)
	... 13 more
Exception encountered during startup: unable to make version 1 UUID from &lt;span class=&quot;code-quote&quot;&gt;&apos;currencyCode&apos;&lt;/span&gt;&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

</description>
                <environment></environment>
        <key id="12837175">CASSANDRA-9582</key>
            <summary>MarshalException after upgrading to 2.1.6</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10002" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Normal</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="slebresne">Sylvain Lebresne</assignee>
                                    <reporter username="tomvandenberge">Tom van den Berge</reporter>
                        <labels>
                    </labels>
                <created>Thu, 11 Jun 2015 15:36:35 +0000</created>
                <updated>Tue, 16 Apr 2019 09:31:08 +0000</updated>
                            <resolved>Wed, 22 Jul 2015 08:24:24 +0000</resolved>
                                        <fixVersion>2.1.9</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>8</watches>
                                                                                                                <comments>
                            <comment id="14582125" author="tomvandenberge" created="Thu, 11 Jun 2015 15:46:51 +0000"  >&lt;p&gt;This table is created as a super column family using cassandra-cli.&lt;/p&gt;</comment>
                            <comment id="14582145" author="snazy" created="Thu, 11 Jun 2015 15:59:19 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tomvandenberge&quot; class=&quot;user-hover&quot; rel=&quot;tomvandenberge&quot;&gt;tomvandenberge&lt;/a&gt;, can you post the rows from &lt;tt&gt;system.schema_columns&lt;/tt&gt; and &lt;tt&gt;system.schema_columnfamilies&lt;/tt&gt; for that table and the script to create the table?&lt;/p&gt;</comment>
                            <comment id="14583088" author="tomvandenberge" created="Fri, 12 Jun 2015 07:20:39 +0000"  >&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt; keyspace_name | columnfamily_name | column_name        | component_index | index_name | index_options | index_type | type           | validator
---------------+-------------------+--------------------+-----------------+------------+---------------+------------+----------------+---------------------------------------------
     drillster |       InvoiceItem |            column1 |               0 |       &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; |          &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; |       &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; | clustering_key |    org.apache.cassandra.db.marshal.UUIDType
     drillster |       InvoiceItem |       currencyCode |            &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; |       &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; |          &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; |       &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; |        regular |    org.apache.cassandra.db.marshal.UTF8Type
     drillster |       InvoiceItem |        description |            &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; |       &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; |          &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; |       &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; |        regular |    org.apache.cassandra.db.marshal.UTF8Type
     drillster |       InvoiceItem |                key |            &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; |       &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; |          &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; |       &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; |  partition_key |   org.apache.cassandra.db.marshal.BytesType
     drillster |       InvoiceItem |         priceGross |            &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; |       &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; |          &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; |       &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; |        regular |    org.apache.cassandra.db.marshal.LongType
     drillster |       InvoiceItem |          priceNett |            &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; |       &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; |          &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; |       &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; |        regular |    org.apache.cassandra.db.marshal.LongType
     drillster |       InvoiceItem |           quantity |            &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; |       &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; |          &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; |       &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; |        regular | org.apache.cassandra.db.marshal.IntegerType
     drillster |       InvoiceItem |                sku |            &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; |       &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; |          &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; |       &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; |        regular |    org.apache.cassandra.db.marshal.UTF8Type
     drillster |       InvoiceItem |     unitPriceGross |            &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; |       &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; |          &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; |       &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; |        regular |    org.apache.cassandra.db.marshal.LongType
     drillster |       InvoiceItem |      unitPriceNett |            &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; |       &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; |          &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; |       &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; |        regular |    org.apache.cassandra.db.marshal.LongType
     drillster |       InvoiceItem |                vat |            &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; |       &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; |          &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; |       &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; |        regular |    org.apache.cassandra.db.marshal.LongType
     drillster |       InvoiceItem | vatRateBasisPoints |            &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; |       &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; |          &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; |       &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; |        regular | org.apache.cassandra.db.marshal.IntegerType
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt; keyspace_name | columnfamily_name | bloom_filter_fp_chance | caching   | column_aliases | comment | compaction_strategy_class                                       | compaction_strategy_options | comparator                               | compression_parameters | default_time_to_live | default_validator                         | dropped_columns | gc_grace_seconds | index_interval | is_dense | key_aliases | key_validator                             | local_read_repair_chance | max_compaction_threshold | memtable_flush_period_in_ms | min_compaction_threshold | populate_io_cache_on_flush | read_repair_chance | replicate_on_write | speculative_retry | subcomparator                            | type  | value_alias
---------------+-------------------+------------------------+-----------+----------------+---------+-----------------------------------------------------------------+-----------------------------+------------------------------------------+------------------------+----------------------+-------------------------------------------+-----------------+------------------+----------------+----------+-------------+-------------------------------------------+--------------------------+--------------------------+-----------------------------+--------------------------+----------------------------+--------------------+--------------------+-------------------+------------------------------------------+-------+-------------
     drillster |       InvoiceItem |                   &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; | KEYS_ONLY |             [] |         | org.apache.cassandra.db.compaction.SizeTieredCompactionStrategy |                          {} | org.apache.cassandra.db.marshal.UUIDType |                     {} |                    0 | org.apache.cassandra.db.marshal.BytesType |            &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; |           864000 |            128 |    False |          [] | org.apache.cassandra.db.marshal.BytesType |                        0 |                       32 |                           0 |                        4 |                      False |                  1 |               True |    99.0PERCENTILE | org.apache.cassandra.db.marshal.UTF8Type | Super |        &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="14635157" author="blafrisch" created="Tue, 21 Jul 2015 14:01:58 +0000"  >&lt;p&gt;I have the same problem and did some digging because it worked in our one environment but not another.  Note that this is a column definition within a super column family, same as the other user is experiencing.&lt;/p&gt;

&lt;p&gt;Here&apos;s the row key and the super column definitions, it&apos;s the same in both environments:&lt;br/&gt;
MyKeyspace | MyColumnFamily | key | null | null | null | null | partition_key | org.apache.cassandra.db.marshal.TimeUUIDType&lt;br/&gt;
MyKeyspace | MyColumnFamily | column1 | 0 | null | null | null | clustering_key | org.apache.cassandra.db.marshal.TimeUUIDType&lt;/p&gt;

&lt;p&gt;Broken column definition:&lt;br/&gt;
MyKeyspace | MyColumnFamily | MyColumn | null | null | null | null | regular | org.apache.cassandra.db.marshal.UTF8Type&lt;/p&gt;

&lt;p&gt;Working column definition:&lt;br/&gt;
MyKeyspace | MyColumnFamily | MyColumn | 1 | null | null | null | regular | org.apache.cassandra.db.marshal.UTF8Type&lt;/p&gt;

&lt;p&gt;Note that the only difference between working and broken is that component index is set to 1 instead of null.  Which brings me to ask about the code in ColumnDefinition.java.  It would seem to me that the logic for public static List&amp;lt;ColumnDefinition&amp;gt; fromSchema(...) is broken.&lt;/p&gt;

&lt;p&gt;Original component index code (starting at line 389 in v2.1.8):&lt;br/&gt;
            if (row.has(COMPONENT_INDEX))&lt;br/&gt;
                componentIndex = row.getInt(COMPONENT_INDEX);&lt;br/&gt;
            else if (kind == Kind.CLUSTERING_COLUMN &amp;amp;&amp;amp; isSuper)&lt;br/&gt;
                componentIndex = 1; // A ColumnDefinition for super columns applies to the column component&lt;/p&gt;

&lt;p&gt;Should it not be:&lt;br/&gt;
            if (row.has(COMPONENT_INDEX))&lt;br/&gt;
                componentIndex = row.getInt(COMPONENT_INDEX);&lt;br/&gt;
            else if (kind == Kind.REGULAR &amp;amp;&amp;amp; isSuper)&lt;br/&gt;
                componentIndex = 1; // A ColumnDefinition for super columns applies to the column component&lt;/p&gt;

&lt;p&gt;Or even:&lt;br/&gt;
            if (row.has(COMPONENT_INDEX))&lt;br/&gt;
                componentIndex = row.getInt(COMPONENT_INDEX);&lt;br/&gt;
            else if (kind == Kind.CLUSTERING_COLUMN &amp;amp;&amp;amp; isSuper)&lt;br/&gt;
                componentIndex = 0;&lt;br/&gt;
            else if (kind == Kind.REGULAR &amp;amp;&amp;amp; isSuper)&lt;br/&gt;
                componentIndex = 1;&lt;/p&gt;</comment>
                            <comment id="14635297" author="slebresne" created="Tue, 21 Jul 2015 15:58:06 +0000"  >&lt;p&gt;Michael is right, that &lt;tt&gt;kind == CLUSTERING_COLUMN&lt;/tt&gt; should definitively be a &lt;tt&gt;kind == REGULAR&lt;/tt&gt; as is pretty much explained by the comment below. So attaching the simple fix, but I&apos;ve switched the order or the &lt;tt&gt;if-else&lt;/tt&gt; so that if the wrong componentIndex has mistakenly be persisted due to this bug, we auto-correct it.&lt;/p&gt;

&lt;p&gt;Special casing the &lt;tt&gt;CLUSTERING_COLUMN&lt;/tt&gt; is not necessary however since the componentIndex should never be null in that case, and if it is it might be indicative of a more serious bug (one that may not be specific to super columns maybe) so I&apos;d rather catch it than hide it.&lt;/p&gt;</comment>
                            <comment id="14635542" author="iamaleksey" created="Tue, 21 Jul 2015 18:18:35 +0000"  >&lt;p&gt;The ticket reference in the comment is wrong (9562 is not this ticket) - make it #9582. Otherwise +1.&lt;/p&gt;</comment>
                            <comment id="14635559" author="iamaleksey" created="Tue, 21 Jul 2015 18:31:09 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=philipthompson&quot; class=&quot;user-hover&quot; rel=&quot;philipthompson&quot;&gt;philipthompson&lt;/a&gt; How come our upgrade tests aren&apos;t catching this? (or, weren&apos;t catching this) I thought we had some Thrift coverage in there. If not, can we add some? Thanks.&lt;/p&gt;</comment>
                            <comment id="14636494" author="slebresne" created="Wed, 22 Jul 2015 08:24:24 +0000"  >&lt;p&gt;Alright, committed, thanks, but I&apos;ve created &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-9860&quot; title=&quot;Better testing of the the upgrade of super column tables&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-9860&quot;&gt;CASSANDRA-9860&lt;/a&gt; to follow-up on adding a test to experience this kind of upgrade.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12746372" name="9582.txt" size="1494" author="slebresne" created="Tue, 21 Jul 2015 15:55:05 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[slebresne]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 17 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2fxqf:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12311421" key="com.atlassian.jira.plugin.system.customfieldtypes:multiversion">
                        <customfieldname>Reproduced In</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="12332265">2.1.6</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>aleksey</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[aleksey]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12962"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311124" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Tester</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>rhatch</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>