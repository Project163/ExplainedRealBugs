<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 22:54:53 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-9649] Paxos ballot in StorageProxy could clash</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-9649</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;This code in &lt;tt&gt;StorageProxy.beginAndRepairPaxos()&lt;/tt&gt; takes a timestamp in microseconds but divides it by 1000 before adding one. So if the summary is null, ballotMillis would be the same for up to 1000 possible state timestamp values:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;    &lt;span class=&quot;code-object&quot;&gt;long&lt;/span&gt; currentTime = (state.getTimestamp() / 1000) + 1;
    &lt;span class=&quot;code-object&quot;&gt;long&lt;/span&gt; ballotMillis = summary == &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;
                                 ? currentTime
                                 : &lt;span class=&quot;code-object&quot;&gt;Math&lt;/span&gt;.max(currentTime, 1 +    UUIDGen.unixTimestamp(summary.mostRecentInProgressCommit.ballot));
    UUID ballot = UUIDGen.getTimeUUID(ballotMillis);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;tt&gt;state.getTimestamp()&lt;/tt&gt; returns the time in micro seconds and it ensures to add one microsecond to any previously used timestamp if the client sends the same or an older timestamp. &lt;/p&gt;

&lt;p&gt;Initially I used this code in &lt;tt&gt;ModificationStatement.casInternal()&lt;/tt&gt;, introduced by &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-9160&quot; title=&quot;Migrate CQL dtests to unit tests&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-9160&quot;&gt;&lt;del&gt;CASSANDRA-9160&lt;/del&gt;&lt;/a&gt; to support cas unit tests, but occasionally these tests were failing. It was only when I ensured uniqueness of the ballot that the tests started to pass reliably.&lt;/p&gt;

&lt;p&gt;I wonder if we could ever have the same issue in StorageProxy?&lt;/p&gt;

&lt;p&gt;cc &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jbellis&quot; class=&quot;user-hover&quot; rel=&quot;jbellis&quot;&gt;jbellis&lt;/a&gt; and &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=slebresne&quot; class=&quot;user-hover&quot; rel=&quot;slebresne&quot;&gt;slebresne&lt;/a&gt; for &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-7801&quot; title=&quot;A successful INSERT with CAS does not always store data in the DB after a DELETE&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-7801&quot;&gt;&lt;del&gt;CASSANDRA-7801&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;</description>
                <environment></environment>
        <key id="12840391">CASSANDRA-9649</key>
            <summary>Paxos ballot in StorageProxy could clash</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10003" iconUrl="https://issues.apache.org/jira/images/icons/priorities/trivial.svg">Low</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="stefania">Stefania Alborghetti</assignee>
                                    <reporter username="stefania">Stefania Alborghetti</reporter>
                        <labels>
                            <label>LWT</label>
                    </labels>
                <created>Thu, 25 Jun 2015 01:09:12 +0000</created>
                <updated>Fri, 25 Oct 2019 13:10:54 +0000</updated>
                            <resolved>Mon, 29 Jun 2015 08:55:01 +0000</resolved>
                                        <fixVersion>2.0.17</fixVersion>
                    <fixVersion>2.1.8</fixVersion>
                    <fixVersion>2.2.0 rc2</fixVersion>
                                    <component>Feature/Lightweight Transactions</component>
                    <component>Legacy/Coordination</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>9</watches>
                                                                                                                <comments>
                            <comment id="14601016" author="slebresne" created="Thu, 25 Jun 2015 11:15:30 +0000"  >&lt;p&gt;I believe you&apos;re right. We need ballots to be globally unique, which given we provide our own timestamp to &lt;tt&gt;UUIDGen.getTimeUUID()&lt;/tt&gt; means that we must ensure said timestamp is locally unique. And that has been broken by &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-5667&quot; title=&quot;Change timestamps used in CAS ballot proposals to be more resilient to clock skew&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-5667&quot;&gt;&lt;del&gt;CASSANDRA-5667&lt;/del&gt;&lt;/a&gt; (before that we were letting &lt;tt&gt;UUIDGen&lt;/tt&gt; pick the timestamp which does the right thing).&lt;/p&gt;

&lt;p&gt;And dividing &lt;tt&gt;state.getTimestamp()&lt;/tt&gt; is only one of the problems, we have 2 others: the fact that &lt;tt&gt;state.getTimestamp()&lt;/tt&gt; is currently only unique to a connection not a VM, and the fact that 2 racy operations that do get a &lt;tt&gt;summary&lt;/tt&gt; might see the same &lt;tt&gt;mostRecentInProgressCommit&lt;/tt&gt; and thus pick the same timestamp.&lt;/p&gt;

&lt;p&gt;So anyway, I&apos;ve pushed &lt;a href=&quot;https://github.com/pcmanus/cassandra/commits/9649&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;here&lt;/a&gt; a commit to fix that. I&apos;m also going to bump the priority since unless I&apos;m forgetting a reason why this is not a problem, it&apos;s kind of a big deal.&lt;/p&gt;

&lt;p&gt;I do want to note one point: due to the conjonction of &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-7801&quot; title=&quot;A successful INSERT with CAS does not always store data in the DB after a DELETE&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-7801&quot;&gt;&lt;del&gt;CASSANDRA-7801&lt;/del&gt;&lt;/a&gt; and &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-5667&quot; title=&quot;Change timestamps used in CAS ballot proposals to be more resilient to clock skew&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-5667&quot;&gt;&lt;del&gt;CASSANDRA-5667&lt;/del&gt;&lt;/a&gt;, if a node has its clock in the future, other nodes might &quot;synchronize&quot; themselves on that clock through Paxos operations. While this is probably ok for small drift (this may even be considered a good thing), this could be rather problematic if a node ends up with a clock far in the future (even temporarily, due to an operator error for instance). This is a risk for our Paxos by design, but &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-7801&quot; title=&quot;A successful INSERT with CAS does not always store data in the DB after a DELETE&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-7801&quot;&gt;&lt;del&gt;CASSANDRA-7801&lt;/del&gt;&lt;/a&gt; makes the consequences potentially affect other operation as well. This makes me nervous and while I still think &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-7801&quot; title=&quot;A successful INSERT with CAS does not always store data in the DB after a DELETE&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-7801&quot;&gt;&lt;del&gt;CASSANDRA-7801&lt;/del&gt;&lt;/a&gt; is theoreticaly a good idea, I&apos;m starting to think that it might not be worth the risk and so I wanted to float the idea of reversing it. I&apos;ve pushed a branch &lt;a href=&quot;https://github.com/pcmanus/cassandra/commits/9649-without-7801&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;here&lt;/a&gt; with an additional (simple) commit to show what I have in mind.&lt;/p&gt;

&lt;p&gt;The patch is against 2.1. C* 2.0 is affected too but the patch won&apos;t apply because it builds on top of &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-7801&quot; title=&quot;A successful INSERT with CAS does not always store data in the DB after a DELETE&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-7801&quot;&gt;&lt;del&gt;CASSANDRA-7801&lt;/del&gt;&lt;/a&gt; which isn&apos;t on 2.0. I&apos;m a bit reluctant to mess too much with 2.0 at this point so I would suggest to basically revert &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-5667&quot; title=&quot;Change timestamps used in CAS ballot proposals to be more resilient to clock skew&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-5667&quot;&gt;&lt;del&gt;CASSANDRA-5667&lt;/del&gt;&lt;/a&gt; by simply relying on &lt;tt&gt;UUIGen.getTimeUUID()&lt;/tt&gt; without providing our own timestamp.&lt;/p&gt;</comment>
                            <comment id="14601256" author="snazy" created="Thu, 25 Jun 2015 14:21:45 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=slebresne&quot; class=&quot;user-hover&quot; rel=&quot;slebresne&quot;&gt;slebresne&lt;/a&gt;, I wanted to ask why we don&apos;t use &#181;s precision here - answered while lurking to your branch. The changes LGTM.&lt;br/&gt;
The main problem (&lt;em&gt;dear operator, do never ever set the wrong system time&lt;/em&gt;) is indeed a big one - a problem that we can detect and react to these situations:&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;check whether the system time of a starting/joining node is within some allowed range and prevent it to join the ring&lt;/li&gt;
	&lt;li&gt;detect abrupt/big clock skews of a node via gossip and issue warnings&lt;/li&gt;
	&lt;li&gt;detect abrupt/big clock skews by comparing the diff of &lt;tt&gt;System.currentTimeMillis()&lt;/tt&gt; and &lt;tt&gt;nanoTime()&lt;/tt&gt; and issue warnings&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;The consequences of an abrupt/big clock skew could be mitigated by de-coupling &lt;tt&gt;System.currentTimeMillis()&lt;/tt&gt; from &lt;tt&gt;UUIDGen&lt;/tt&gt; and &lt;tt&gt;ClientState&lt;/tt&gt; and only allow it to go faster/slower at a max rate - basically preventing an &lt;em&gt;immediate&lt;/em&gt; system clock change from 06/25/2015-16:18:30 to 06/25/2015-16:48:30 (what NTP usually does, advance slowly) - or even do not allow the &quot;internal clock&quot; to ever go backwards. WDYT? (I think there was some discussion around that a while ago - but honestly I cannot recall.)&lt;/p&gt;</comment>
                            <comment id="14602180" author="stefania" created="Fri, 26 Jun 2015 00:29:36 +0000"  >&lt;p&gt;You may be interested in this ticket, &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-6680&quot; title=&quot;Clock skew detection via gossip&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-6680&quot;&gt;&lt;del&gt;CASSANDRA-6680&lt;/del&gt;&lt;/a&gt;. It&apos;s assigned to me but I haven&apos;t really had any time to work on it so far.&lt;/p&gt;</comment>
                            <comment id="14602298" author="stefania" created="Fri, 26 Jun 2015 02:34:57 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=slebresne&quot; class=&quot;user-hover&quot; rel=&quot;slebresne&quot;&gt;slebresne&lt;/a&gt; thanks for the patch. I made a tiny change to pick up as much of your code as possible in the unit tests. I created a pull request &lt;a href=&quot;https://github.com/pcmanus/cassandra/pull/52&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;here&lt;/a&gt;. Sorry about the rebase.&lt;/p&gt;

&lt;p&gt;The patch seems to apply to 2.2 so nothing to do other than monitoring CI.&lt;/p&gt;

&lt;p&gt;For 2.0 I&apos;m not sure if it helps but rather than just calling &lt;tt&gt;UUIDGen.getTimeUUID()&lt;/tt&gt; I modified &lt;tt&gt;UUIDGen.getTimeUUID(long when)&lt;/tt&gt; to do the same thing as the override without any arguments. It seems to be called only by a test method and by &lt;tt&gt;StorageProxy.beginAndRepairPaxos()&lt;/tt&gt;. One thing that is not clear to me is why isn&apos;t &lt;tt&gt;UUIDGen.lastNanos&lt;/tt&gt; an atomic long?&lt;/p&gt;

&lt;p&gt;I guess you could put yourself as the author and myself as the reviewer.&lt;/p&gt;

&lt;p&gt;My branches:&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/stef1927/cassandra/tree/9649-2.0&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/stef1927/cassandra/tree/9649-2.0&lt;/a&gt;&lt;br/&gt;
&lt;a href=&quot;https://github.com/stef1927/cassandra/tree/9649-2.1&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/stef1927/cassandra/tree/9649-2.1&lt;/a&gt;&lt;br/&gt;
&lt;a href=&quot;https://github.com/stef1927/cassandra/tree/9649-2.2&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/stef1927/cassandra/tree/9649-2.2&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;The CI views:&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://cassci.datastax.com/job/stef1927-9649-2.0-testall/lastCompletedBuild/testReport/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://cassci.datastax.com/job/stef1927-9649-2.0-testall/lastCompletedBuild/testReport/&lt;/a&gt;&lt;br/&gt;
&lt;a href=&quot;http://cassci.datastax.com/job/stef1927-9649-2.0-dtest/lastCompletedBuild/testReport/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://cassci.datastax.com/job/stef1927-9649-2.0-dtest/lastCompletedBuild/testReport/&lt;/a&gt;&lt;br/&gt;
&lt;a href=&quot;http://cassci.datastax.com/job/stef1927-9649-2.1-testall/lastCompletedBuild/testReport/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://cassci.datastax.com/job/stef1927-9649-2.1-testall/lastCompletedBuild/testReport/&lt;/a&gt;&lt;br/&gt;
&lt;a href=&quot;http://cassci.datastax.com/job/stef1927-9649-2.1-dtest/lastCompletedBuild/testReport/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://cassci.datastax.com/job/stef1927-9649-2.1-dtest/lastCompletedBuild/testReport/&lt;/a&gt;&lt;br/&gt;
&lt;a href=&quot;http://cassci.datastax.com/job/stef1927-9649-2.2-testall/lastCompletedBuild/testReport/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://cassci.datastax.com/job/stef1927-9649-2.2-testall/lastCompletedBuild/testReport/&lt;/a&gt;&lt;br/&gt;
&lt;a href=&quot;http://cassci.datastax.com/job/stef1927-9649-2.2-dtest/lastCompletedBuild/testReport/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://cassci.datastax.com/job/stef1927-9649-2.2-dtest/lastCompletedBuild/testReport/&lt;/a&gt;&lt;/p&gt;
</comment>
                            <comment id="14602587" author="slebresne" created="Fri, 26 Jun 2015 08:56:27 +0000"  >&lt;blockquote&gt;&lt;p&gt;I modified UUIDGen.getTimeUUID(long when) to do the same thing as the override without any arguments.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;The problem is that this ends up potentially modifying the &lt;tt&gt;UUIGen&lt;/tt&gt; clock, so a big clock skew of a node in the future can now &quot;screw up&quot; any generated time UUID in other nodes, which is scary. The idea being just getting back to the no arg &lt;tt&gt;UUIDGen.getTimeUUID()&lt;/tt&gt; is that it&apos;s the simplest thing that is basically guaranteed to not create any unintended consequence for other parts of the code. All we&apos;re giving up is &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-5667&quot; title=&quot;Change timestamps used in CAS ballot proposals to be more resilient to clock skew&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-5667&quot;&gt;&lt;del&gt;CASSANDRA-5667&lt;/del&gt;&lt;/a&gt; but that was &quot;just an optimization&quot; in the first place.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;One thing that is not clear to me is why isn&apos;t UUIDGen.lastNanos an atomic long?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;It doesn&apos;t have to because the only method that ever read/modify it is synchronized (I don&apos;t know if much though went into doing it this way rather than using an atomic long (and no synchronized method) but I do know that such considerations are out of scope for this ticket &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;)&lt;/p&gt;</comment>
                            <comment id="14602599" author="stefania" created="Fri, 26 Jun 2015 09:09:54 +0000"  >&lt;blockquote&gt;&lt;p&gt;The problem is that this ends up potentially modifying the UUIGen clock, so a big clock skew of a node in the future can now &quot;screw up&quot; any generated time UUID in other nodes, which is scary. The idea being just getting back to the no arg UUIDGen.getTimeUUID() is that it&apos;s the simplest thing that is basically guaranteed to not create any unintended consequence for other parts of the code. All we&apos;re giving up is &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-5667&quot; title=&quot;Change timestamps used in CAS ballot proposals to be more resilient to clock skew&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-5667&quot;&gt;&lt;del&gt;CASSANDRA-5667&lt;/del&gt;&lt;/a&gt; but that was &quot;just an optimization&quot; in the first place.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I see, thanks for the explanation. I force pushed a commit to revert back to getTimeUUID(). Is this enough or do we need to revert the entire change introduced by &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-5667&quot; title=&quot;Change timestamps used in CAS ballot proposals to be more resilient to clock skew&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-5667&quot;&gt;&lt;del&gt;CASSANDRA-5667&lt;/del&gt;&lt;/a&gt;?&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;It doesn&apos;t have to because the only method that ever read/modify it is synchronized (I don&apos;t know if much though went into doing it this way rather than using an atomic long (and no synchronized method) but I do know that such considerations are out of scope for this ticket )&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Agreed.&lt;/p&gt;</comment>
                            <comment id="14602629" author="slebresne" created="Fri, 26 Jun 2015 09:45:38 +0000"  >&lt;blockquote&gt;&lt;p&gt;Is this enough or do we need to revert the entire change introduced by &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-5667&quot; title=&quot;Change timestamps used in CAS ballot proposals to be more resilient to clock skew&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-5667&quot;&gt;&lt;del&gt;CASSANDRA-5667&lt;/del&gt;&lt;/a&gt;?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;It is enough. Most of the other change from &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-5667&quot; title=&quot;Change timestamps used in CAS ballot proposals to be more resilient to clock skew&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-5667&quot;&gt;&lt;del&gt;CASSANDRA-5667&lt;/del&gt;&lt;/a&gt; were either not directly related in the first place, or have been changed since then by other patches. So I&apos;m good with the current version of you branches and if we&apos;re good with that I&apos;ll commit once CI has finished re-running on every branch.&lt;/p&gt;

&lt;p&gt;I&apos;ve moved the discussion about potentially reverting &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-7801&quot; title=&quot;A successful INSERT with CAS does not always store data in the DB after a DELETE&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-7801&quot;&gt;&lt;del&gt;CASSANDRA-7801&lt;/del&gt;&lt;/a&gt; to &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-9655&quot; title=&quot;Consider reverting CASSANDRA-7801&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-9655&quot;&gt;CASSANDRA-9655&lt;/a&gt; since it&apos;s largely orthogonal to this issue (the problem exists with or without this patch).&lt;/p&gt;</comment>
                            <comment id="14602634" author="stefania" created="Fri, 26 Jun 2015 09:51:15 +0000"  >&lt;p&gt;Great, thank you.&lt;/p&gt;</comment>
                            <comment id="14603070" author="slebresne" created="Fri, 26 Jun 2015 15:46:33 +0000"  >&lt;p&gt;So there seems to be some test failure on all branches. I tried to compare with the tests failing on the non-patched branch but not all tests are failing there, but I haven&apos;t looked closely enough to see if the tests are just flaky or not. It&apos;s mostly dtests though (except for &lt;a href=&quot;http://cassci.datastax.com/job/stef1927-9649-2.1-testall/lastCompletedBuild/testReport/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;that&lt;/a&gt; that looks completely unrelated to this issue). &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=stefania&quot; class=&quot;user-hover&quot; rel=&quot;stefania&quot;&gt;stefania&lt;/a&gt; can you see if you can force cassci to re-run on your branch to see if we can shake some potential shakiness?&lt;/p&gt;</comment>
                            <comment id="14605000" author="stefania" created="Mon, 29 Jun 2015 00:23:28 +0000"  >&lt;p&gt;I&apos;ve run the tests one more time. Here is my analysis, all tests are either flacky and have failed at least once in the past on the unpatched branches, or quite simply fail all the time. For some we definitely have JIRAs but I have not mentioned them here as I don&apos;t have the numbers at hand.&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;2.0 testall:
	&lt;ul&gt;
		&lt;li&gt;no failures&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;2.0 dtest:
	&lt;ul&gt;
		&lt;li&gt;jmxmetrics_test.TestJMXMetrics.begin_test: failed on unpatched 2.0, build #80&lt;/li&gt;
		&lt;li&gt;counter_tests.TestCounters.upgrade_test: failed on unpatched 2.0, build #78&lt;/li&gt;
		&lt;li&gt;compaction_test.TestCompaction_with_DateTieredCompactionStrategy.sstable_deletion_test: failed on unpatched 2.0, build #80&lt;/li&gt;
		&lt;li&gt;compaction_test.TestCompaction_with_SizeTieredCompactionStrategy.sstable_deletion_test: failed on unpatched 2.0, build #80&lt;/li&gt;
		&lt;li&gt;thrift_hsha_test.ThriftHSHATest.test_closing_connections: failed on unpatched 2.0, build #76&lt;/li&gt;
		&lt;li&gt;repair_test.TestRepair.dc_repair_test: failed on unpatched 2.0, build #69&lt;/li&gt;
		&lt;li&gt;paging_test.TestPagingWithDeletions.test_single_partition_deletions: failed on unpatched 2.0, build #72&lt;/li&gt;
		&lt;li&gt;paging_test.TestPagingWithDeletions.test_single_row_deletions: failed on unpatched 2.0, build #62&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;2.1 testall:
	&lt;ul&gt;
		&lt;li&gt;org.apache.cassandra.concurrent.LongSharedExecutorPoolTest.testPromptnessOfExecution: failed on unpatched 2.1, build #106&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;2.1 dtest:
	&lt;ul&gt;
		&lt;li&gt;jmxmetrics_test.TestJMXMetrics.begin_test: failed on unpatched 2.1, build #154&lt;/li&gt;
		&lt;li&gt;repair_test.TestRepair.dc_repair_test: failed on unpatched 2.1, build #154&lt;/li&gt;
		&lt;li&gt;compaction_test.TestCompaction_with_DateTieredCompactionStrategy.sstable_deletion_test: failed on unpatched 2.1, build #154&lt;/li&gt;
		&lt;li&gt;compaction_test.TestCompaction_with_SizeTieredCompactionStrategy.sstable_deletion_test: failed on unpatched 2.1, build #154&lt;/li&gt;
		&lt;li&gt;thrift_hsha_test.ThriftHSHATest.test_closing_connections: failed on unpatched 2.1, build #102&lt;/li&gt;
		&lt;li&gt;upgrade_supercolumns_test.TestSCUpgrade.upgrade_with_counters_test: failed on unpatched 2.1, build #122&lt;/li&gt;
		&lt;li&gt;cql_tests.MiscellaneousCQLTester.prepared_statement_invalidation_test: failed on unpatched 2.1, build #149&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;2.2 testall:
	&lt;ul&gt;
		&lt;li&gt;org.apache.cassandra.db.lifecycle.ViewTest.testSSTablesInBounds: failed on unpatched 2.2, build #88&lt;/li&gt;
		&lt;li&gt;org.apache.cassandra.db.lifecycle.ViewTest.testSSTablesInBounds-compression: failed on unpatched 2.2, build #88&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;2.2 dtest:
	&lt;ul&gt;
		&lt;li&gt;consistency_test.TestConsistency.short_read_test: failed on unpatched 2.2, build #72&lt;/li&gt;
		&lt;li&gt;jmx_test.TestJMX.cfhistograms_test: failed on unpatched 2.2, build #115&lt;/li&gt;
		&lt;li&gt;upgrade_internal_auth_test.TestAuthUpgrade.upgrade_to_30_test: failed on unpatched 2.2, build #120&lt;/li&gt;
		&lt;li&gt;compaction_test.TestCompaction_with_DateTieredCompactionStrategy.sstable_deletion_test: failed on unpatched 2.2, build #120&lt;/li&gt;
		&lt;li&gt;compaction_test.TestCompaction_with_LeveledCompactionStrategy.sstable_deletion_test: failed on unpatched 2.2, build #120&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="14605303" author="slebresne" created="Mon, 29 Jun 2015 08:55:01 +0000"  >&lt;p&gt;Thanks Stefania for looking into this in details. Hopefully we get tests less flaky in the future. Anyway, committed.&lt;/p&gt;</comment>
                            <comment id="14605306" author="stefania" created="Mon, 29 Jun 2015 08:57:22 +0000"  >&lt;p&gt;Thanks!&lt;/p&gt;</comment>
                            <comment id="15326656" author="kohlisankalp" created="Sun, 12 Jun 2016 22:16:22 +0000"  >&lt;p&gt;cc &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=slebresne&quot; class=&quot;user-hover&quot; rel=&quot;slebresne&quot;&gt;slebresne&lt;/a&gt; Did you create a JIRA to fix issue introduced in this JIRA? Please let me know. &lt;/p&gt;</comment>
                            <comment id="15326938" author="slebresne" created="Mon, 13 Jun 2016 07:36:37 +0000"  >&lt;p&gt;I did, &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-11991&quot; title=&quot;On clock skew, paxos may &amp;quot;corrupt&amp;quot; the node clock&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-11991&quot;&gt;&lt;del&gt;CASSANDRA-11991&lt;/del&gt;&lt;/a&gt;, sorry for not mentioning it here earlier.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12735336">CASSANDRA-7801</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12819988">CASSANDRA-9160</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[stefania]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 23 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2ggtj:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>slebresne</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[slebresne]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12961"><![CDATA[Low]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>