<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 22:41:20 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-6270] SERIAL consistency in errors to v1 protocol driver</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-6270</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;I&apos;m the author of the Ruby driver for CQL, and I got a bug report about strange errors when running on C* 2.0 and using lightweight transaction queries. The bug report can be found here: &lt;a href=&quot;https://github.com/iconara/cql-rb/issues/53&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/iconara/cql-rb/issues/53&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;The client sent &lt;tt&gt;UPDATE table SET val = 42 WHERE row_id = 5 IF val = 41&lt;/tt&gt; and when C* couldn&apos;t fulfill SERIAL consistency it sent an error back saying &quot;Operation timed out - received only -1 responses&quot;.&lt;/p&gt;

&lt;p&gt;So far so good, but it also set the &lt;tt&gt;consistency&lt;/tt&gt; field in the error response to 8, corresponding to &lt;tt&gt;SERIAL&lt;/tt&gt; in v2 of the binary protocol, even if the communication with the client was over v1 of the protocol. Since my driver doesn&apos;t yet support v2 it doesn&apos;t think that 8 is a valid consistency, and fails to parse the frame.&lt;/p&gt;

&lt;p&gt;Is this the intended behaviour of C*, or an oversight in how that error is formulated? I could easily add &lt;tt&gt;SERIAL&lt;/tt&gt; and accept it even if the communication is over v1 of the protocol, but the bigger issue is how C* handles drivers that do not speak the latest version of the protocol. People should be able to use a driver that worked correctly with C* X with C* X+1, right?&lt;/p&gt;

&lt;p&gt;Do drivers have to be accepting in what they receive from C* because they might get consistencies, data types, etc. that are from future versions of the protocol, or does C* guarantee that frames will conform to the protocol that the driver says it understands?&lt;/p&gt;</description>
                <environment>&lt;p&gt;Cassandra 2.0&lt;/p&gt;</environment>
        <key id="12676559">CASSANDRA-6270</key>
            <summary>SERIAL consistency in errors to v1 protocol driver</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10003" iconUrl="https://issues.apache.org/jira/images/icons/priorities/trivial.svg">Low</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="slebresne">Sylvain Lebresne</assignee>
                                    <reporter username="iconara">Theo Hultberg</reporter>
                        <labels>
                            <label>LWT</label>
                    </labels>
                <created>Wed, 30 Oct 2013 06:47:10 +0000</created>
                <updated>Fri, 25 Oct 2019 13:11:09 +0000</updated>
                            <resolved>Wed, 30 Oct 2013 16:24:57 +0000</resolved>
                                        <fixVersion>2.0.3</fixVersion>
                                    <component>Feature/Lightweight Transactions</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="13808941" author="iamaleksey" created="Wed, 30 Oct 2013 10:36:12 +0000"  >&lt;p&gt;v1 native protocol is not intended to support all the Cassandra 2.0 features. (If it could, we wouldn&apos;t need v2 native protocol in the first place).&lt;/p&gt;

&lt;p&gt;To use 2.0 CAS with native proto you should be using the v2 protocol.&lt;/p&gt;</comment>
                            <comment id="13809065" author="iconara" created="Wed, 30 Oct 2013 13:22:26 +0000"  >&lt;p&gt;In that case Cassandra should fail the request because it uses a CQL syntax that is not supported over that version of the protocol. Cassandra has accepted that the connection will use CQL v3.0.0 and the frame was sent with v1 of the protocol. The right thing to do is to fail the request because it uses features that are not in CQL v3.0.0, but instead it sends a frame back that a v1 driver cannot parse.&lt;/p&gt;

&lt;p&gt;Drivers can&apos;t tell if the CQL is valid because they don&apos;t parse it, they can&apos;t tell if the CQL uses features not available in the version of the binary protocol or not. Cassandra has to say that the request is not valid, and it can&apos;t send frames back that are not valid in the protocol specified by the driver.&lt;/p&gt;</comment>
                            <comment id="13809195" author="adstage-david" created="Wed, 30 Oct 2013 15:07:05 +0000"  >&lt;p&gt;I originally reported the bug on the Ruby project, just thought it might be useful to clarify a bit:&lt;/p&gt;

&lt;p&gt;I could &lt;em&gt;sometimes&lt;/em&gt; successfully use lightweight transactions successfully over the v1 binary protocol the ruby driver is using (specifying a consistency of :quorum on writes), but sometimes it would throw this error. &lt;/p&gt;</comment>
                            <comment id="13809235" author="slebresne" created="Wed, 30 Oct 2013 15:34:56 +0000"  >&lt;p&gt;I agree that sending frames that are not valid is a tad anti-social. Attaching simple patch that throw an InvalidRequestException if the user tries to use CAS with the protocol v1.&lt;/p&gt;</comment>
                            <comment id="13809262" author="iamaleksey" created="Wed, 30 Oct 2013 16:00:01 +0000"  >&lt;p&gt;LGTM, although I&apos;d slightly prefer protocol version be a enum (UNDEFINED, V1, V2), but not strongly.&lt;/p&gt;</comment>
                            <comment id="13809290" author="slebresne" created="Wed, 30 Oct 2013 16:24:57 +0000"  >&lt;p&gt;Committed, thanks.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;I&apos;d slightly prefer protocol version be a enum (UNDEFINED, V1, V2)&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Bah, we use int for the encoding/decoding methods and perhaps more importantly, I&apos;m lazy &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12611098" name="6270.txt" size="8150" author="slebresne" created="Wed, 30 Oct 2013 15:34:56 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[slebresne]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>355991</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            12 years, 3 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1pddj:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>356279</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>aleksey</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[aleksey]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12961"><![CDATA[Low]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>