<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 23:31:40 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-20189] Avoid possible consistency violations for SAI intersection queries over repaired index matches and multiple non-indexed column matches</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-20189</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;&lt;tt&gt;FilterTree&lt;/tt&gt;, which is responsible for SAI&apos;s post-filtering, is too aggressive about automatically using strict filtering when a.) only repaired matches are returned from index columns and b.) there are still multiple non-indexed columns that must be post-filtered. The following test illustrates this:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;@Test
public void testPartialUpdatesOnNonIndexedColumnsAfterRepair()
{
   CLUSTER.schemaChange(withKeyspace(&quot;CREATE TABLE %s.partial_updates (k int PRIMARY KEY, a int, b int, c int) WITH read_repair = &apos;NONE&apos;&quot;));
   CLUSTER.schemaChange(withKeyspace(&quot;CREATE INDEX ON %s.partial_updates(a) USING &apos;sai&apos;&quot;));
   SAIUtil.waitForIndexQueryable(CLUSTER, KEYSPACE);

   CLUSTER.coordinator(1).execute(withKeyspace(&quot;INSERT INTO %s.partial_updates(k, a) VALUES (0, 1) USING TIMESTAMP 1&quot;), ConsistencyLevel.ALL);
   CLUSTER.get(1).nodetoolResult(&quot;repair&quot;, KEYSPACE).asserts().success();

   // insert a split row
   CLUSTER.get(1).executeInternal(withKeyspace(&quot;INSERT INTO %s.partial_updates(k, b) VALUES (0, 2) USING TIMESTAMP 2&quot;));
   CLUSTER.get(2).executeInternal(withKeyspace(&quot;INSERT INTO %s.partial_updates(k, c) VALUES (0, 3) USING TIMESTAMP 3&quot;));

   String select = withKeyspace(&quot;SELECT * FROM %s.partial_updates WHERE a = 1 AND b = 2 AND c = 3 ALLOW FILTERING&quot;);
   Object[][] initialRows = CLUSTER.coordinator(1).execute(select, ConsistencyLevel.ALL);
   assertRows(initialRows, row(0, 1, 2, 3));
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This should be easy to fix without adversely affecting performance too much, given the selectivity of the clauses on the indexed columns still determines the upper bound on how many rows can be returned to the coordinator for coordinator-side filtering.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13603997">CASSANDRA-20189</key>
            <summary>Avoid possible consistency violations for SAI intersection queries over repaired index matches and multiple non-indexed column matches</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10002" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Normal</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="maedhroz">Caleb Rackliffe</assignee>
                                    <reporter username="maedhroz">Caleb Rackliffe</reporter>
                        <labels>
                    </labels>
                <created>Tue, 7 Jan 2025 01:56:26 +0000</created>
                <updated>Thu, 6 Feb 2025 20:01:28 +0000</updated>
                            <resolved>Thu, 6 Feb 2025 20:00:03 +0000</resolved>
                                        <fixVersion>5.0.4</fixVersion>
                    <fixVersion>5.1</fixVersion>
                                    <component>Consistency/Coordination</component>
                    <component>Feature/SAI</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                    <progress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                            <timeestimate seconds="0">0h</timeestimate>
                            <timespent seconds="6600">1h 50m</timespent>
                                <comments>
                            <comment id="17915757" author="maedhroz" created="Tue, 21 Jan 2025 16:42:56 +0000"  >&lt;p&gt;Working on expanding the newly pulled-to-trunk Harry 2.0 tests to cover this class of problem...&lt;/p&gt;</comment>
                            <comment id="17916110" author="maedhroz" created="Wed, 22 Jan 2025 16:48:37 +0000"  >&lt;p&gt;Expanded &lt;tt&gt;MultiNodeSAITest&lt;/tt&gt; to cover mixed filtering scenarios like the one in the description above, and I have a couple seeds failing:&lt;/p&gt;

&lt;p&gt;&lt;tt&gt;585168312844541L&lt;/tt&gt; in &lt;tt&gt;mixedFilteringRepairOnlySaiTest()&lt;/tt&gt; and &lt;tt&gt;indexOnlyRepairOnlySaiTest()&lt;/tt&gt;&lt;br/&gt;
&lt;tt&gt;585764698219625L&lt;/tt&gt; in &lt;tt&gt;mixedFilteringNoRepairSaiTest()&lt;/tt&gt; and &lt;tt&gt;indexOnlyNoRepairSaiTest()&lt;/tt&gt;&lt;/p&gt;

&lt;p&gt;Working through those, and then we can move to review and the 5.0 patch...&lt;/p&gt;</comment>
                            <comment id="17921580" author="maedhroz" created="Tue, 28 Jan 2025 01:25:14 +0000"  >&lt;p&gt;It turns out the reason the seeds above were failing is that Harry was generating range queries over SAI column indexes that didn&apos;t support range queries. That meant we just degraded to AF, and since those are still broken (see &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-19007&quot; title=&quot;Queries with multi-column replica-side filtering can miss rows&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-19007&quot;&gt;CASSANDRA-19007&lt;/a&gt;), we ran into failures. Once I started making sure we only generated queries SAI supports, things started running clean. In any case, the patch is ready for review, it fixes what we set out to fix here (while expanding the Harry tests), and I&apos;ll have some CI results shortly...&lt;/p&gt;</comment>
                            <comment id="17921599" author="maedhroz" created="Tue, 28 Jan 2025 04:06:31 +0000"  >&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/apache/cassandra/pull/3873&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;5.0&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;span class=&quot;nobr&quot;&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/13074531/13074531_ci_summary-1.html&quot; title=&quot;ci_summary-1.html attached to CASSANDRA-20189&quot;&gt;ci_summary-1.html&lt;sup&gt;&lt;img class=&quot;rendericon&quot; src=&quot;https://issues.apache.org/jira/images/icons/link_attachment_7.gif&quot; height=&quot;7&quot; width=&quot;7&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/sup&gt;&lt;/a&gt;&lt;/span&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/apache/cassandra/pull/3779&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;trunk&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;span class=&quot;nobr&quot;&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/13074508/13074508_ci_summary.html&quot; title=&quot;ci_summary.html attached to CASSANDRA-20189&quot;&gt;ci_summary.html&lt;sup&gt;&lt;img class=&quot;rendericon&quot; src=&quot;https://issues.apache.org/jira/images/icons/link_attachment_7.gif&quot; height=&quot;7&quot; width=&quot;7&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/sup&gt;&lt;/a&gt;&lt;/span&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;
</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="13557387">CASSANDRA-19018</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="13074531" name="ci_summary-1.html" size="15336" author="maedhroz" created="Thu, 6 Feb 2025 17:13:05 +0000"/>
                            <attachment id="13074508" name="ci_summary.html" size="33664" author="maedhroz" created="Wed, 5 Feb 2025 21:37:02 +0000"/>
                            <attachment id="13074532" name="result_details.tar-1.gz" size="2246623" author="maedhroz" created="Thu, 6 Feb 2025 17:13:06 +0000"/>
                            <attachment id="13074509" name="result_details.tar.gz" size="2555214" author="maedhroz" created="Wed, 5 Feb 2025 21:37:03 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>4.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[maedhroz]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12313825" key="com.atlassian.jira.plugin.system.customfieldtypes:cascadingselect">
                        <customfieldname>Bug Category</customfieldname>
                        <customfieldvalues>
                                                    <customfieldvalue key="12982" cascade-level=""><![CDATA[Correctness]]></customfieldvalue>
                                <customfieldvalue key="12987" cascade-level="1"><![CDATA[Transient Incorrect Response]]></customfieldvalue>
            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12313821" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Complexity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12965"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313822" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Discovered By</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12975"><![CDATA[Code Inspection]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12311120" key="com.pyxis.greenhopper.jira:gh-epic-link">
                        <customfieldname>Epic Link</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>CASSANDRA-19224</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12313922" key="jira.plugin.projectspecificselectfield.jpssf:multicftype">
                        <customfieldname>Impacts</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="13100"><![CDATA[None]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            41 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12313921" key="jira.plugin.projectspecificselectfield.jpssf:multicftype">
                        <customfieldname>Platform</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="13076"><![CDATA[All]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z1tg3c:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[dcapwell]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12962"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12311420" key="com.atlassian.jira.plugin.system.customfieldtypes:version">
                        <customfieldname>Since Version</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="12355063">5.0.0</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313924" key="com.atlassian.jira.plugin.system.customfieldtypes:textfield">
                        <customfieldname>Source Control Link</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>&lt;p&gt;&lt;a href=&quot;https://github.com/apache/cassandra/commit/953ab6cf64088614ada26e05d664b6a25b1d561d&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/cassandra/commit/953ab6cf64088614ada26e05d664b6a25b1d561d&lt;/a&gt;&lt;/p&gt;</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313823" key="com.atlassian.jira.plugin.system.customfieldtypes:textarea">
                        <customfieldname>Test and Documentation Plan</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>&lt;p&gt;new tests around strict filtering&lt;/p&gt;</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>