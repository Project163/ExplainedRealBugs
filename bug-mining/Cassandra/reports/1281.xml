<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 22:27:18 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-3466] Hinted handoff not working after rolling upgrade from 0.8.7 to 1.0.2</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-3466</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;While testing rolling upgrades from 0.8.7 to 1.0.2 on a test cluster I&apos;ve noticed that hinted hand-off didn&apos;t always work properly. Hints generated on an upgraded node does not seem to be delivered to other newly upgraded nodes once they rejoin the ring. They only way I&apos;ve found to get a node to deliver its hints is to restart it.&lt;/p&gt;

&lt;p&gt;Here&apos;s some steps to reproduce this issue:&lt;/p&gt;

&lt;p&gt;1. Install cassandra 0.8.7 on node1 and node2 using default settings.&lt;br/&gt;
2. Create keyspace foo with &lt;/p&gt;
{replication_factor: 2}
&lt;p&gt;. Create column family bar&lt;br/&gt;
3. Shutdown node2 &lt;br/&gt;
4. Insert data into bar and verify that HintsColumnFamily on node2 contains hints&lt;br/&gt;
5. Start node2 and verify that hinted handoff is performed and HintsColumnFamily becomes empty again.&lt;/p&gt;

&lt;p&gt;6. Upgrade and restart node1&lt;br/&gt;
7. Shutdown node2 &lt;br/&gt;
8. Insert data into bar and verify that HintsColumnFamily on node2 contains hints&lt;br/&gt;
9. Upgrade and start node2&lt;br/&gt;
10. Notice that hinted handoff is &lt;b&gt;not&lt;/b&gt; performed when &quot;node2&quot; comes back. (Only if node1 is restarted)&lt;/p&gt;</description>
                <environment></environment>
        <key id="12530617">CASSANDRA-3466</key>
            <summary>Hinted handoff not working after rolling upgrade from 0.8.7 to 1.0.2</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10002" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Normal</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="jbellis">Jonathan Ellis</assignee>
                                    <reporter username="jborgstrom">Jonas Borgstr&#246;m</reporter>
                        <labels>
                            <label>hintedhandoff</label>
                    </labels>
                <created>Mon, 7 Nov 2011 19:16:31 +0000</created>
                <updated>Tue, 16 Apr 2019 09:32:46 +0000</updated>
                            <resolved>Fri, 11 Nov 2011 19:54:48 +0000</resolved>
                                        <fixVersion>1.0.3</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="13145912" author="jbellis" created="Mon, 7 Nov 2011 22:57:50 +0000"  >&lt;p&gt;Do you observe the same behavior if both nodes start life as 1.x?&lt;/p&gt;

&lt;p&gt;Is node2 down long enough for node1 failure detector to notice?  (i.e. shows as DOWN in nodetool ring)&lt;/p&gt;</comment>
                            <comment id="13146124" author="jborgstrom" created="Tue, 8 Nov 2011 07:40:19 +0000"  >&lt;p&gt;&amp;gt; Do you observe the same behavior if both nodes start life as 1.x?&lt;/p&gt;

&lt;p&gt;No. Hinted handoff seems to work well if I either start with 1.0.2 nodes or restart all nodes once all nodes have been upgraded to 1.0.2. Probably something in the gossip state confusing hinted hand-offs.&lt;/p&gt;

&lt;p&gt;&amp;gt; Is node2 down long enough for node1 failure detector to notice? (i.e. shows as DOWN in nodetool ring)&lt;/p&gt;

&lt;p&gt;Yes. This from the node1 log:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;Node2 is shut down
  INFO 19:39:08,331 InetAddress /127.0.0.2 is now dead.
Hint is triggered using set bar[x][x]=&lt;span class=&quot;code-quote&quot;&gt;&apos;x&apos;&lt;/span&gt;
  INFO 19:40:52,126 Node /127.0.0.2 has restarted, now UP
  INFO 19:40:52,127 InetAddress /127.0.0.2 is now UP
  INFO 19:40:52,127 Node /127.0.0.2 state jump to normal
Nothing happens, hint stays in HintsColumnFamily forever
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Calling deliverHints() using JMX also does not seem to work. Restarting node1 will though...&lt;/p&gt;</comment>
                            <comment id="13146165" author="jborgstrom" created="Tue, 8 Nov 2011 08:41:01 +0000"  >&lt;p&gt;&amp;gt; Do you observe the same behavior if both nodes start life as 1.x?&lt;/p&gt;

&lt;p&gt;I spoke too soon. I did some more testing with fresh 1.0.2 installs (and empty data directories).&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;1. Start node1 and node2 and create keyspace and cf.
2. Stop node2, wait until &lt;span class=&quot;code-quote&quot;&gt;&quot;is now dead&quot;&lt;/span&gt;.
3. Trigger hint using &lt;span class=&quot;code-quote&quot;&gt;&quot;set bar[x][x]=&lt;span class=&quot;code-quote&quot;&gt;&apos;x&apos;&lt;/span&gt;;&quot;&lt;/span&gt;
4. Start node2, wait &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; hint delivery... Nothing happens
5. Restart node1, hints are &lt;span class=&quot;code-keyword&quot;&gt;finally&lt;/span&gt; delivered.
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Now it gets really weird...&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;2. Stop node2, wait until &lt;span class=&quot;code-quote&quot;&gt;&quot;is now dead&quot;&lt;/span&gt;.
3. Trigger hint using &lt;span class=&quot;code-quote&quot;&gt;&quot;set bar[x][x]=&lt;span class=&quot;code-quote&quot;&gt;&apos;x&apos;&lt;/span&gt;;&quot;&lt;/span&gt;
4. Start node2. Node1 attempts to deliver hints but fails with:
 INFO 09:29:35,153 Started hinted handoff &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; token: 23495828435496583962471242736585511198 with IP: /127.0.0.2
ERROR 09:29:35,212 Fatal exception in thread &lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;[HintedHandoff:1,1,main]
java.lang.AssertionError
	at org.apache.cassandra.db.HintedHandOffManager.deliverHintsToEndpoint(HintedHandOffManager.java:301)
	at org.apache.cassandra.db.HintedHandOffManager.access$100(HintedHandOffManager.java:81)
	at org.apache.cassandra.db.HintedHandOffManager$2.runMayThrow(HintedHandOffManager.java:353)
	at org.apache.cassandra.utils.WrappedRunnable.run(WrappedRunnable.java:30)
	at java.util.concurrent.ThreadPoolExecutor$Worker.runTask(ThreadPoolExecutor.java:886)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:908)
	at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:680)

On node1:
[&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;@system] list HintsColumnFamily;
Using &lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt; limit of 100
-------------------
RowKey: 11ad21c7d112e903d71645d1d951911e
=&amp;gt; (super_column=b2cd983009e311e10000fe8ebeead9cf,
     (column=6b6579, value=78, timestamp=1320740935987, ttl=864000)
     (column=6d75746174696f6e, value=0003666f6f00017800000001000003e801000003e880000000800000000000000000000001000178000004b134f65401d80000000139, timestamp=1320740935987, ttl=864000)
     (column=7461626c65, value=666f6f, timestamp=1320740935987, ttl=864000)
     (column=76657273696f6e, value=00000003, timestamp=1320740935987, ttl=864000))
=&amp;gt; (super_column=f929a36009e211e10000fe8ebeead9df,
     (column=6b6579, value=78, timestamp=1320740624538, ttl=864000)
     (column=7461626c65, value=666f6f, timestamp=1320740624538, ttl=864000))
1 Row Returned.
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Is that a 0.8 hint showing up out of the blue on a pure 1.0.2 cluster? Or did I mess up my test somehow?&lt;/p&gt;</comment>
                            <comment id="13147007" author="brandon.williams" created="Wed, 9 Nov 2011 12:50:55 +0000"  >&lt;p&gt;I haven&apos;t been able to reproduce the assertion errors, but I did find what is preventing hint delivery in some cases:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;        if (hintStore.getSSTables().isEmpty())
            return; // nothing to do, don&apos;t confuse users by logging a no-op handoff
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;If you&apos;re testing with a small enough amount of hints that the hints table never flushes, we never deliver the hints in the current memtable.&lt;/p&gt;</comment>
                            <comment id="13147016" author="hsn" created="Wed, 9 Nov 2011 13:00:57 +0000"  >&lt;p&gt;Thats true. i did more testing in this area today. Deleted hints sstables from disk to be sure that no 0.8.x possible hints are there - but they should not be there anyway because i had snapshot from CF hints truncate around. And i could not get any hints delivered to second node (no exceptions today).&lt;/p&gt;

&lt;p&gt;Thats probably deserves to roll new cassandra version soon, because it is very important to get hints properly delivered as soon as possible.&lt;/p&gt;</comment>
                            <comment id="13147027" author="brandon.williams" created="Wed, 9 Nov 2011 13:19:38 +0000"  >&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;=&amp;gt; (super_column=f929a36009e211e10000fe8ebeead9df,
     (column=6b6579, value=78, timestamp=1320740624538, ttl=864000)
     (column=7461626c65, value=666f6f, timestamp=1320740624538, ttl=864000))
1 Row Returned.
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The odd thing here is that you have the &apos;table&apos; and &apos;key&apos; subcolumns, but not the &apos;mutation&apos; or &apos;version&apos; subcolumns.  Since these are all applied at once I&apos;m not sure how they could be missing.&lt;/p&gt;</comment>
                            <comment id="13147028" author="hsn" created="Wed, 9 Nov 2011 13:23:00 +0000"  >&lt;p&gt;application is doing row delete and then row insert&lt;/p&gt;</comment>
                            <comment id="13147054" author="jborgstrom" created="Wed, 9 Nov 2011 13:56:56 +0000"  >&lt;p&gt;&amp;gt; I haven&apos;t been able to reproduce the assertion errors, but I did find what is preventing hint delivery in some cases&lt;/p&gt;

&lt;p&gt;Brandon, Did you verify that removing those lines of code actually fixes hint delivery? &lt;/p&gt;

&lt;p&gt;Instead of changing the code I just did a quick experiment with &quot;nodetool flush&quot; on the node holding the hints and then restarting the other node but that was not enough to trigger hints delivery:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;Node1 notices that node2 is backup up
  INFO 14:41:50,752 Node /127.0.0.2 has restarted, now UP
  INFO 14:41:50,752 InetAddress /127.0.0.2 is now UP
  INFO 14:41:50,753 Node /127.0.0.2 state jump to normal
But no hints are delivered...

nodetool flush is used to make sure hints hit the disk on node1:

  INFO 14:42:32,675 Enqueuing flush of Memtable-Versions@1503666327(83/103 serialized/live bytes, 3 ops)
  INFO 14:42:32,675 Writing Memtable-Versions@1503666327(83/103 serialized/live bytes, 3 ops)
  INFO 14:42:32,681 Completed flushing /tmp/node1/data/data/system/Versions-h-1-Data.db (247 bytes)
  INFO 14:42:32,682 Enqueuing flush of Memtable-HintsColumnFamily@737188401(177/221 serialized/live bytes, 1 ops)
  INFO 14:42:32,682 Writing Memtable-HintsColumnFamily@737188401(177/221 serialized/live bytes, 1 ops)
  INFO 14:42:32,688 Completed flushing /tmp/node1/data/data/system/HintsColumnFamily-h-1-Data.db (277 bytes)
  INFO 14:42:32,691 Enqueuing flush of Memtable-bar@1831941861(17/21 serialized/live bytes, 1 ops)
  INFO 14:42:32,691 Writing Memtable-bar@1831941861(17/21 serialized/live bytes, 1 ops)
  INFO 14:42:32,694 Completed flushing /tmp/node1/data/data/foo/bar-h-1-Data.db (68 bytes)

Node2 is restarted once more to check &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; will trigger hints delivery:
  INFO 14:42:54,650 InetAddress /127.0.0.2 is now dead.
  INFO 14:43:02,628 Node /127.0.0.2 has restarted, now UP
  INFO 14:43:02,629 InetAddress /127.0.0.2 is now UP
  INFO 14:43:02,629 Node /127.0.0.2 state jump to normal

Still nothing...  Restarting node 1 will deliver the hints within a few seconds though...
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Regarding reproducing the assertion error it&apos;s a bit tricky. But after letting my two node test cluster performing hints delivery for each other a few times I was able to reproduce it once more. Is there anything special you would like me to test?&lt;/p&gt;

</comment>
                            <comment id="13147057" author="brandon.williams" created="Wed, 9 Nov 2011 14:04:08 +0000"  >&lt;blockquote&gt;&lt;p&gt;Brandon, Did you verify that removing those lines of code actually fixes hint delivery?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Yes.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;Instead of changing the code I just did a quick experiment with &quot;nodetool flush&quot; on the node holding the hints and then restarting the other node but that was not enough to trigger hints delivery&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Hints aren&apos;t delivered immediately, there&apos;s up to a 60s random delay to stagger the replay.  Did you wait long enough to be sure it passed?&lt;/p&gt;</comment>
                            <comment id="13147060" author="jborgstrom" created="Wed, 9 Nov 2011 14:16:31 +0000"  >&lt;blockquote&gt;&lt;p&gt;Hints aren&apos;t delivered immediately, there&apos;s up to a 60s random delay to stagger the replay. Did you wait long enough to be sure it passed?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Yes, I&apos;ve waited a couple of minutes now and still nothing. So I guess issuing &quot;nodetool flush&quot; isn&apos;t enough. I&apos;ll leave it running while I recompile with your changes and re-test.&lt;/p&gt;</comment>
                            <comment id="13147070" author="jborgstrom" created="Wed, 9 Nov 2011 14:47:22 +0000"  >&lt;p&gt;Brandon, you&apos;re right. After commenting out those two lines I can no longer reproduce the hint delivery problem.&lt;/p&gt;

&lt;p&gt;The AssertionError is still there though and I managed to reproduce it with my two node setup.&lt;br/&gt;
I&apos;ll attach a tarball with my config, DEBUG-level log files and data directories shortly.&lt;br/&gt;
What I did was basically:&lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;Start a new cluster with a patched 1.0.2 and create keyspace and column family.&lt;/li&gt;
	&lt;li&gt;Bring down node2, trigger hints on node1&lt;/li&gt;
	&lt;li&gt;Bring up node2, notice that hints are delivered, YAY!&lt;/li&gt;
	&lt;li&gt;Bring down node1, trigger hints on node2&lt;/li&gt;
	&lt;li&gt;Bring up node1, noticed AssertionError in log file for node1   (node1/system.log:2036)&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;To me it looks like the assertionError on node1 is triggered when node2 connects to deliver its hints.&lt;/p&gt;</comment>
                            <comment id="13147071" author="jborgstrom" created="Wed, 9 Nov 2011 14:49:38 +0000"  >&lt;p&gt;Logs, config files and data files from a setup that triggered AssertionError in HintedHandoffManager&lt;/p&gt;</comment>
                            <comment id="13147190" author="brandon.williams" created="Wed, 9 Nov 2011 17:56:16 +0000"  >&lt;p&gt;Jonas,&lt;/p&gt;

&lt;p&gt;Thanks for the data files.  Looking at them with sstable2json I see the all the subcolumns are actually there, so I think what you may be seeing is &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-3446&quot; title=&quot;Problem SliceByNamesReadCommand on super column family after flush operation&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-3446&quot;&gt;&lt;del&gt;CASSANDRA-3446&lt;/del&gt;&lt;/a&gt;, could you try to reproduce with that patch applied?&lt;/p&gt;</comment>
                            <comment id="13147254" author="jborgstrom" created="Wed, 9 Nov 2011 20:10:21 +0000"  >&lt;blockquote&gt;&lt;p&gt;Jonas,&lt;/p&gt;&lt;/blockquote&gt;

&lt;blockquote&gt;&lt;p&gt;Thanks for the data files. Looking at them with sstable2json I see the all the subcolumns are actually there, so I think what you may be seeing is &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-3446&quot; title=&quot;Problem SliceByNamesReadCommand on super column family after flush operation&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-3446&quot;&gt;&lt;del&gt;CASSANDRA-3446&lt;/del&gt;&lt;/a&gt;, could you try to reproduce with that patch applied?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Jikes, that one looks pretty bad.&lt;/p&gt;

&lt;p&gt;Anyway, with the patches in &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-3446&quot; title=&quot;Problem SliceByNamesReadCommand on super column family after flush operation&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-3446&quot;&gt;&lt;del&gt;CASSANDRA-3446&lt;/del&gt;&lt;/a&gt; in combination with the modifications of HintedHandOffManager.py mentioned earlier I&apos;ve so far not been able to reproduce any of the issues I&apos;ve observed earlier.&lt;/p&gt;

&lt;p&gt;Thanks for your help!&lt;/p&gt;</comment>
                            <comment id="13147647" author="jborgstrom" created="Thu, 10 Nov 2011 12:55:49 +0000"  >&lt;p&gt;I&apos;ve unfortunately managed to reproduce this AssertionError even with the &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-3446&quot; title=&quot;Problem SliceByNamesReadCommand on super column family after flush operation&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-3446&quot;&gt;&lt;del&gt;CASSANDRA-3446&lt;/del&gt;&lt;/a&gt; patches and the HintedHandOffManager.java modification.&lt;/p&gt;

&lt;p&gt;I used the same two node setup as before initialized with:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;create keyspace foo with placement_strategy = &lt;span class=&quot;code-quote&quot;&gt;&apos;org.apache.cassandra.locator.SimpleStrategy&apos;&lt;/span&gt; and strategy_options = {replication_factor:2};
use foo;
create column family bar with comparator=UTF8Type and key_validation_class=UTF8Type;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;ol&gt;
	&lt;li&gt;Shutdown node2 and wait until it&apos;s detected as down&lt;br/&gt;
trigger hints on node1 (using random values):
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;use foo;
set bar[0][0]=&lt;span class=&quot;code-quote&quot;&gt;&apos;1&apos;&lt;/span&gt;;
set bar[2][3]=&lt;span class=&quot;code-quote&quot;&gt;&apos;1&apos;&lt;/span&gt;;
set bar[3][3]=&lt;span class=&quot;code-quote&quot;&gt;&apos;1&apos;&lt;/span&gt;;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Verify that `list HintsColumnFamily` looks OK&lt;/p&gt;&lt;/li&gt;
	&lt;li&gt;Start node2 and wait for hints delivery&lt;br/&gt;
Verify that `list HintsColumnFamily` is empty after hints delivery&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;After repeating step 1-2 a few times (sometimes once is enough) &quot;HintsColumnFamily&quot; will become &quot;corrupt&quot; after hints delivery instead of empty. And if node1 is restarted after that it will trigger the AssertionError.&lt;/p&gt;

&lt;p&gt;The attached file contains DEBUG-log files, data directories and conf-directories from one test where HintsColumnFamily ended up looking like this:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;[&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;@system] list HintsColumnFamily;
Using &lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt; limit of 100
-------------------
RowKey: 1b226da5af66854850abdcc6ab4ce9c6
=&amp;gt; (super_column=1f2860e00b9811e10000fe8ebeead9ff,
     (column=6b6579, value=33, timestamp=1320928378352, ttl=864000))

1 Row Returned.
Elapsed time: 6 msec(s).
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="13147748" author="slebresne" created="Thu, 10 Nov 2011 15:12:23 +0000"  >&lt;p&gt;The system log indicates an assertion error on HintedHandoffManager line 298. But it&apos;s not an assertion on this line in 1.0.2. Would you mind trying to see if you can reproduce on the current 1.0 branch (or 1.0.2 patched with &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-3446&quot; title=&quot;Problem SliceByNamesReadCommand on super column family after flush operation&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-3446&quot;&gt;&lt;del&gt;CASSANDRA-3446&lt;/del&gt;&lt;/a&gt;)? Just want to make sure you&apos;re not hitting something fixed already.&lt;/p&gt;</comment>
                            <comment id="13147762" author="jborgstrom" created="Thu, 10 Nov 2011 15:26:26 +0000"  >&lt;p&gt;I&apos;m running 1.0.2 with the 3446 patches &lt;b&gt;and&lt;/b&gt; the following three lines removed from HintedHandOffManager.java (As discussed earlier in this ticket)&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (hintStore.getSSTables().isEmpty())
            &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt;; &lt;span class=&quot;code-comment&quot;&gt;// nothing to &lt;span class=&quot;code-keyword&quot;&gt;do&lt;/span&gt;, don&apos;t confuse users by logging a no-op handoff
&lt;/span&gt;&lt;span class=&quot;code-comment&quot;&gt;// An empty line&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;That should explain the line number mismatch (-3).&lt;br/&gt;
Without this change hinted handoff wouldn&apos;t work at all for me unless HintsColumnFamily is large enough to flow to disk before the other node gets back up.&lt;/p&gt;</comment>
                            <comment id="13147902" author="jbellis" created="Thu, 10 Nov 2011 18:39:54 +0000"  >&lt;p&gt;So I should be looking at node1 HintsColumnFamily for the corruption, right?&lt;/p&gt;</comment>
                            <comment id="13147923" author="jbellis" created="Thu, 10 Nov 2011 19:02:16 +0000"  >&lt;p&gt;Fix attached.  The problem is we were deleting the hint with the timestamp from the &lt;tt&gt;version&lt;/tt&gt; subcolumn, but the subcolumn timestamps were generated independently so it&apos;s possible for there to be &quot;orphaned&quot; subcolumns left over.&lt;/p&gt;

&lt;p&gt;Patch (1) uses same ts for all hint subcolumns and (2) creates the tombstone w/ the max ts from the subcolumns.&lt;/p&gt;

&lt;p&gt;Also fixes the isEmpty delivery bug by checking memtable contents as well.&lt;/p&gt;</comment>
                            <comment id="13148698" author="brandon.williams" created="Fri, 11 Nov 2011 19:47:48 +0000"  >&lt;p&gt;+1&lt;/p&gt;</comment>
                            <comment id="13148704" author="jbellis" created="Fri, 11 Nov 2011 19:54:48 +0000"  >&lt;p&gt;committed&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12503277" name="3466.txt" size="2449" author="jbellis" created="Thu, 10 Nov 2011 19:02:16 +0000"/>
                            <attachment id="12503200" name="CASSANDRA-3466-2.tar.gz" size="96057" author="jborgstrom" created="Thu, 10 Nov 2011 12:55:48 +0000"/>
                            <attachment id="12503083" name="CASSANDRA-3466.tar.gz" size="73875" author="jborgstrom" created="Wed, 9 Nov 2011 14:49:37 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[jbellis]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>216355</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            14 years, 2 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0gk93:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>94711</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>brandon.williams</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[brandon.williams]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12962"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>