<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 23:09:38 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-13880] Fix short read protection for tables with no clustering columns</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-13880</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-12872&quot; title=&quot;Fix short read protection when more than one row is missing&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-12872&quot;&gt;&lt;del&gt;CASSANDRA-12872&lt;/del&gt;&lt;/a&gt; fixed counting replica rows, so that we do now fetch more than one extra row if necessary.&lt;/p&gt;

&lt;p&gt;Fixing the issue caused consistency_test.py:TestConsistency.test_13747 to start failing, by exposing a bug in the way we handle empty clusterings.&lt;/p&gt;

&lt;p&gt;When &lt;tt&gt;moreContents()&lt;/tt&gt; asks for another row and &lt;tt&gt;lastClustering&lt;/tt&gt; is &lt;tt&gt;EMPTY&lt;/tt&gt;, the response again (and again) contains the row with &lt;tt&gt;EMPTY&lt;/tt&gt; clustering.&lt;/p&gt;

&lt;p&gt;SRP assumes it&#8217;s a new row, counts it as one, gets confused and keeps asking for more, in a loop, again and again.&lt;/p&gt;

&lt;p&gt;Arguably, a response to a read command with the following non-inclusive &lt;tt&gt;ClusteringIndexFilter&lt;/tt&gt;:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;command.clusteringIndexFilter(partitionKey).forPaging(metadata.comparator, Clustering.EMPTY, &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;... should return nothing at all rather than a row with an empty clustering.&lt;/p&gt;

&lt;p&gt;Also arguably, SRP should not even attempt to fetch more rows if &lt;tt&gt;lastClustering == Clustering.EMPTY&lt;/tt&gt;. In a partition key only column&lt;br/&gt;
we shouldn&#8217;t expect any more rows.&lt;/p&gt;

&lt;p&gt;This JIRA is to fix the latter issue on SRP side - to modify SRP logic to short-circuit execution if &lt;tt&gt;lastClustering&lt;/tt&gt; was an &lt;tt&gt;EMPTY&lt;/tt&gt; one instead of querying pointlessly for non-existent extra rows.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13102665">CASSANDRA-13880</key>
            <summary>Fix short read protection for tables with no clustering columns</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10002" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Normal</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="aleksey">Aleksey Yeschenko</assignee>
                                    <reporter username="aleksey">Aleksey Yeschenko</reporter>
                        <labels>
                    </labels>
                <created>Fri, 15 Sep 2017 19:18:00 +0000</created>
                <updated>Tue, 16 Apr 2019 09:29:59 +0000</updated>
                            <resolved>Tue, 19 Sep 2017 10:21:49 +0000</resolved>
                                        <fixVersion>3.0.15</fixVersion>
                    <fixVersion>3.11.1</fixVersion>
                                    <component>Legacy/Coordination</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="16170260" author="iamaleksey" created="Mon, 18 Sep 2017 16:35:55 +0000"  >&lt;p&gt;Branches with fixes: &lt;a href=&quot;https://github.com/iamaleksey/cassandra/commits/13880-3.0&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;3.0&lt;/a&gt;, &lt;a href=&quot;https://github.com/iamaleksey/cassandra/commits/13880-3.11&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;3.11&lt;/a&gt;, &lt;a href=&quot;https://github.com/iamaleksey/cassandra/commits/13880-4.0&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;4.0&lt;/a&gt;. An isolated dtest &lt;a href=&quot;https://github.com/iamaleksey/cassandra-dtest/commits/13880&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;here&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;The issue only triggers with a per partition limit set, doesn&apos;t with a regular limit. I am investigating why, but whatever the reason is, this fix is wanted/needed anyway - it does save us a pointless roundtrip in many scenarios.&lt;/p&gt;</comment>
                            <comment id="16170580" author="benedict" created="Mon, 18 Sep 2017 19:57:42 +0000"  >&lt;p&gt;+1&lt;/p&gt;</comment>
                            <comment id="16171476" author="iamaleksey" created="Tue, 19 Sep 2017 10:21:34 +0000"  >&lt;p&gt;Thanks.&lt;/p&gt;

&lt;p&gt;CircleCI run for &lt;a href=&quot;https://circleci.com/gh/iamaleksey/cassandra/34&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;3.0&lt;/a&gt; has a bunch of annoying MV timeout issues again, and &lt;a href=&quot;https://builds.apache.org/view/A-D/view/Cassandra/job/Cassandra-devbranch-dtest/326/testReport/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;dtests&lt;/a&gt; have those annoying git clone issues, again, but everything seems alright otherwise.&lt;/p&gt;

&lt;p&gt;Committed to 3.0 as &lt;a href=&quot;https://github.com/apache/cassandra/commit/35e32f20ba8cba6cbfb1bee4252c0edd8684cdb1&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;35e32f20ba8cba6cbfb1bee4252c0edd8684cdb1&lt;/a&gt; and merged with 3.11 and trunk. Dtest committed as &lt;a href=&quot;https://github.com/apache/cassandra-dtest/commit/163f82c2db0e86d4dd8f312b291ccd094891b986&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;163f82c2db0e86d4dd8f312b291ccd094891b986&lt;/a&gt;.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[aleksey]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 9 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3k4zz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>benedict</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[benedict]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12962"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>