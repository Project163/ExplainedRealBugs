<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 23:21:56 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-12734] Materialized View schema file for snapshots created as tables</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-12734</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;The materialized view schema file that gets created and stored with the sstables is created as a table instead of a materialized view.  &lt;/p&gt;

&lt;p&gt;Can the materialized view be created and added to the corresponding table&apos;s  schema file?&lt;/p&gt;</description>
                <environment></environment>
        <key id="13008887">CASSANDRA-12734</key>
            <summary>Materialized View schema file for snapshots created as tables</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10002" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Normal</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="edimitrova">Ekaterina Dimitrova</assignee>
                                    <reporter username="nothau">Hau Phan</reporter>
                        <labels>
                    </labels>
                <created>Fri, 30 Sep 2016 14:11:08 +0000</created>
                <updated>Fri, 10 Oct 2025 08:47:47 +0000</updated>
                            <resolved>Fri, 3 Sep 2021 15:05:21 +0000</resolved>
                                        <fixVersion>3.0.26</fixVersion>
                    <fixVersion>3.11.12</fixVersion>
                    <fixVersion>4.0.2</fixVersion>
                    <fixVersion>4.1-alpha1</fixVersion>
                    <fixVersion>4.1</fixVersion>
                                    <component>Feature/Materialized Views</component>
                    <component>Legacy/Tools</component>
                        <due></due>
                            <votes>2</votes>
                                    <watches>11</watches>
                                                                                                                <comments>
                            <comment id="15542631" author="iamaleksey" created="Mon, 3 Oct 2016 15:06:50 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ifesdjeen&quot; class=&quot;user-hover&quot; rel=&quot;ifesdjeen&quot;&gt;ifesdjeen&lt;/a&gt; I think we also need CREATE MV WITH ID for this to work.&lt;/p&gt;</comment>
                            <comment id="16830037" author="realitix" created="Tue, 30 Apr 2019 08:00:23 +0000"  >&lt;p&gt;Hello,&lt;/p&gt;

&lt;p&gt;Any news on this bug ? Is someone working on it ?&lt;/p&gt;

&lt;p&gt;Sincerely,&lt;br/&gt;
Jean-S&#233;bastien&lt;/p&gt;</comment>
                            <comment id="16836027" author="btellier" created="Thu, 9 May 2019 02:05:33 +0000"  >
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
cqlsh -e &lt;span class=&quot;code-quote&quot;&gt;&quot;DESCRIBE SCHEMA&quot;&lt;/span&gt; &amp;gt; schema.cql
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Is able to export the creation command for the dematerialized view. One can thus create the right tables prior importing the snapshots.&lt;/p&gt;</comment>
                            <comment id="17404077" author="edimitrova" created="Tue, 24 Aug 2021 21:59:05 +0000"  >&lt;p&gt;Zhao has created a patch applicable to 3.0 and 3.11 which I ported.&#160;&lt;/p&gt;
&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;&lt;a href=&quot;https://github.com/ekaterinadimitrova2/cassandra/pull/new/12734-3.0&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;3.0&lt;/a&gt;&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;&lt;a href=&quot;https://github.com/ekaterinadimitrova2/cassandra/pull/new/12734-3.11&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;3.11&lt;/a&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;


&lt;p&gt;He also added two tests which I ported to &lt;a href=&quot;https://github.com/apache/cassandra/compare/trunk...ekaterinadimitrova2:12734-4.0?expand=1&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;4.0&lt;/a&gt;&#160;where the issue was already fixed before but the new tests revealed issues not related to the issue we are trying to fix as part of this ticket.&#160;&lt;/p&gt;

&lt;p&gt;The tests showed 4.0 regression and change of behavior, not related to this issue though.&#160;&lt;/p&gt;

&lt;p&gt;1) The clustering order is always ASC when we create a materialized view, even when we want it explicitly DESC.&lt;/p&gt;

&lt;p&gt;2) While both 3.0 and 3.11 will produce the same &lt;a href=&quot;https://github.com/apache/cassandra/compare/trunk...ekaterinadimitrova2:12734-3.11?expand=1#diff-41e29794572dd219fb3b5b15b0fccfe2d0b92f6eeb0b84a91b3ee22bacd83d61R740-R744&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;expectedViewSnapshot&lt;/a&gt;, In 4.0 this will look in the following way:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
CREATE MATERIALIZED VIEW IF NOT EXISTS %s.%s AS
 SELECT pk2, pk1, ck2, ck1, reg1, reg2
 FROM %s.%s
 WHERE pk2 IS NOT NULL AND pk1 IS NOT NULL AND ck2 IS NOT NULL AND ck1 IS NOT NULL
 PRIMARY KEY ((pk2, pk1), ck2, ck1)
 WITH ID = %s
 AND CLUSTERING ORDER BY (ck2 ASC, ck1 ASC)&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Probably worth it to open separate ticket for Cassandra 4, the code was refactored there, instead of fixing everything as part of this one.&lt;/p&gt;

&lt;p&gt;CC &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=blerer&quot; class=&quot;user-hover&quot; rel=&quot;blerer&quot;&gt;blerer&lt;/a&gt;&#160;as I know he was also looking into this ticket.&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="17404277" author="blerer" created="Wed, 25 Aug 2021 08:42:06 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=e.dimitrova&quot; class=&quot;user-hover&quot; rel=&quot;e.dimitrova&quot;&gt;e.dimitrova&lt;/a&gt; I ran some tests on 4.0 and hit another issue related to DESCRIBE. I need to dig a deeper. &lt;/p&gt;</comment>
                            <comment id="17408121" author="blerer" created="Wed, 1 Sep 2021 12:00:17 +0000"  >&lt;p&gt;The underlying issue on 4.0 is now fixed (see &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-16898&quot; title=&quot;The clustering order logic in Materialized view creation changed in 4.0&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-16898&quot;&gt;&lt;del&gt;CASSANDRA-16898&lt;/del&gt;&lt;/a&gt;). The patch for 3.0 and 3.11 LGTM. We probably just need to make a patch for 4.0 and trunk with only the unit tests. &lt;/p&gt;</comment>
                            <comment id="17409033" author="edimitrova" created="Thu, 2 Sep 2021 18:45:38 +0000"  >&lt;p&gt;Thank you for raising &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-16898&quot; title=&quot;The clustering order logic in Materialized view creation changed in 4.0&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-16898&quot;&gt;&lt;del&gt;CASSANDRA-16898&lt;/del&gt;&lt;/a&gt; and the quick fix.&lt;/p&gt;

&lt;p&gt;Tests added to &lt;a href=&quot;https://github.com/apache/cassandra/compare/trunk...ekaterinadimitrova2:12734-4.0?expand=1&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;4.0&lt;/a&gt;&#160;and &lt;a href=&quot;https://github.com/apache/cassandra/compare/trunk...ekaterinadimitrova2:12734-trunk?expand=1&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;trunk&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;&#160;I am running in a loop the two new tests &lt;a href=&quot;https://app.circleci.com/pipelines/github/ekaterinadimitrova2/cassandra?branch=12734-4.0&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;here&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;I also rebased and pushed full CI Jenkins run for the other two branches:&lt;/p&gt;
&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt; Patch &lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt; CI &lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/apache/cassandra/compare/trunk...ekaterinadimitrova2:12734-3.0?expand=1&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;3.0&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://jenkins-cm4.apache.org/job/Cassandra-devbranch/1094/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;CI&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/apache/cassandra/compare/trunk...ekaterinadimitrova2:12734-3.11?expand=1&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;3.11&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://jenkins-cm4.apache.org/job/Cassandra-devbranch/1095/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;CI&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;


&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="17409354" author="blerer" created="Fri, 3 Sep 2021 08:02:36 +0000"  >&lt;p&gt;The patches look good to me. Thanks &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; &lt;/p&gt;</comment>
                            <comment id="17409553" author="edimitrova" created="Fri, 3 Sep 2021 15:03:41 +0000"  >&lt;p&gt;To &lt;a href=&quot;https://github.com/apache/cassandra.git&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/cassandra.git&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&#160;&#160; e4b37c3271..67eb22ec9d&#160; cassandra-3.0 -&amp;gt; cassandra-3.0&lt;/p&gt;

&lt;p&gt;&#160;&#160; 957c6264ef..d6e1c41c48&#160; cassandra-3.11 -&amp;gt; cassandra-3.11&lt;/p&gt;

&lt;p&gt;&#160;&#160; 6a4a93a808..49e83027e2&#160; cassandra-4.0 -&amp;gt; cassandra-4.0&lt;/p&gt;

&lt;p&gt;&#160;&#160; f9aa19e3b1..163a4d7137&#160; trunk -&amp;gt; trunk&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;CI also looked ok, committed, thanks!&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10032">
                    <name>Blocker</name>
                                                                <inwardlinks description="is blocked by">
                                        <issuelink>
            <issuekey id="13398226">CASSANDRA-16898</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                            <issuelinktype id="12310460">
                    <name>Child-Issue</name>
                                                                <inwardlinks description="is a child of">
                                        <issuelink>
            <issuekey id="13314858">CASSANDRA-15921</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[edimitrova]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            4 years, 10 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i34ayn:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[blerer]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12962"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12313924" key="com.atlassian.jira.plugin.system.customfieldtypes:textfield">
                        <customfieldname>Source Control Link</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>&lt;p&gt;&lt;a href=&quot;https://github.com/apache/cassandra/commit/67eb22ec9d588c9f984d13c0ffd703a14181f775&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/cassandra/commit/67eb22ec9d588c9f984d13c0ffd703a14181f775&lt;/a&gt;&lt;/p&gt;</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313823" key="com.atlassian.jira.plugin.system.customfieldtypes:textarea">
                        <customfieldname>Test and Documentation Plan</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>&lt;p&gt;The patches add additional unit tests&lt;/p&gt;</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>