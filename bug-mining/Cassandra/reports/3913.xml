<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 22:59:01 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-10298] Replaced dead node stayed in gossip forever</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-10298</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;The dead node stayed in the nodetool status,&lt;/p&gt;

&lt;p&gt;DN  10.210.165.55                    379.76 GB  256     ?       null&lt;/p&gt;

&lt;p&gt;And in the log, it throws NPE when trying to remove it.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;2015-09-10_06:41:22.92453 ERROR 06:41:22 Exception in thread &lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;[GossipStage:1,5,main]
2015-09-10_06:41:22.92454 java.lang.NullPointerException: &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;
2015-09-10_06:41:22.92455       at org.apache.cassandra.utils.UUIDGen.decompose(UUIDGen.java:100) 
2015-09-10_06:41:22.92455       at org.apache.cassandra.db.HintedHandOffManager.deleteHintsForEndpoint(HintedHandOffManager.java:201) 
2015-09-10_06:41:22.92455       at org.apache.cassandra.service.StorageService.excise(StorageService.java:1886) 
2015-09-10_06:41:22.92455       at org.apache.cassandra.service.StorageService.excise(StorageService.java:1902) 
2015-09-10_06:41:22.92456       at org.apache.cassandra.service.StorageService.handleStateLeft(StorageService.java:1805)
2015-09-10_06:41:22.92457       at org.apache.cassandra.service.StorageService.onChange(StorageService.java:1473) 
2015-09-10_06:41:22.92457       at org.apache.cassandra.service.StorageService.onJoin(StorageService.java:2099) 
2015-09-10_06:41:22.92457       at org.apache.cassandra.gms.Gossiper.handleMajorStateChange(Gossiper.java:1009) 
2015-09-10_06:41:22.92458       at org.apache.cassandra.gms.Gossiper.applyStateLocally(Gossiper.java:1085) 
2015-09-10_06:41:22.92458       at org.apache.cassandra.gms.GossipDigestAck2VerbHandler.doVerb(GossipDigestAck2VerbHandler.java:49) 
2015-09-10_06:41:22.92458       at org.apache.cassandra.net.MessageDeliveryTask.run(MessageDeliveryTask.java:62) 
2015-09-10_06:41:22.92459       at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1145) ~[na:1.7.0_45]
2015-09-10_06:41:22.92460       at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:615) ~[na:1.7.0_45]
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="12862975">CASSANDRA-10298</key>
            <summary>Replaced dead node stayed in gossip forever</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10002" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Normal</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="dikanggu">Dikang Gu</assignee>
                                    <reporter username="dikanggu">Dikang Gu</reporter>
                        <labels>
                    </labels>
                <created>Thu, 10 Sep 2015 06:58:46 +0000</created>
                <updated>Tue, 16 Apr 2019 09:30:56 +0000</updated>
                            <resolved>Wed, 4 Nov 2015 14:08:34 +0000</resolved>
                                        <fixVersion>2.1.12</fixVersion>
                    <fixVersion>2.2.4</fixVersion>
                    <fixVersion>3.0.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="14739197" author="mshuler" created="Thu, 10 Sep 2015 17:33:31 +0000"  >&lt;p&gt;What steps did you take to remove the node from the cluster?&lt;/p&gt;</comment>
                            <comment id="14740275" author="dikanggu" created="Fri, 11 Sep 2015 06:20:27 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mshuler&quot; class=&quot;user-hover&quot; rel=&quot;mshuler&quot;&gt;mshuler&lt;/a&gt; I used the -Dcassandra.replace_address=&amp;lt;ip address&amp;gt; to replace that dead node.&lt;/p&gt;</comment>
                            <comment id="14740279" author="dikanggu" created="Fri, 11 Sep 2015 06:23:13 +0000"  >&lt;p&gt;The new node successfully finished the replacement, but for some reason, the dead node still stayed in the nodetool status for some other live nodes.&lt;/p&gt;

&lt;p&gt;I can not remove it from the gossip, even after restarting some live node.&lt;/p&gt;</comment>
                            <comment id="14744236" author="mambocab" created="Mon, 14 Sep 2015 20:48:59 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=dikanggu&quot; class=&quot;user-hover&quot; rel=&quot;dikanggu&quot;&gt;dikanggu&lt;/a&gt; Is this related to &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-10321&quot; title=&quot;Gossip to dead nodes caused CPU usage to be 100% &quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-10321&quot;&gt;&lt;del&gt;CASSANDRA-10321&lt;/del&gt;&lt;/a&gt;, and if so, how? You mentioned &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-10321?focusedCommentId=14744120&amp;amp;page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-14744120&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;in this comment&lt;/a&gt; that the node was running, but marked as having Thrift and Gossip unavailable. Is that the same node you tried to remove? and could that unavailable state be the result of the failed removal?&lt;/p&gt;</comment>
                            <comment id="14744325" author="dikanggu" created="Mon, 14 Sep 2015 21:37:51 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mambocab&quot; class=&quot;user-hover&quot; rel=&quot;mambocab&quot;&gt;mambocab&lt;/a&gt;, no they are complaining different nodes, so it looks like different issues to me.&lt;/p&gt;</comment>
                            <comment id="14804670" author="mambocab" created="Thu, 17 Sep 2015 22:53:42 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=dikanggu&quot; class=&quot;user-hover&quot; rel=&quot;dikanggu&quot;&gt;dikanggu&lt;/a&gt; Thanks for the information. I just noticed the patch you attached; sorry I missed it earlier. What branch of Cassandra does it target? I&apos;m assuming cassandra-2.1, since that&apos;s the version you marked this ticket with.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=iamaleksey&quot; class=&quot;user-hover&quot; rel=&quot;iamaleksey&quot;&gt;iamaleksey&lt;/a&gt; May I assign you this ticket, as you&apos;re the most recent person to work with the hinted handoff manager (at least on trunk)? Or, can you recommend someone else to take this ticket?&lt;/p&gt;</comment>
                            <comment id="14805065" author="dikanggu" created="Fri, 18 Sep 2015 06:35:58 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mambocab&quot; class=&quot;user-hover&quot; rel=&quot;mambocab&quot;&gt;mambocab&lt;/a&gt; yeah, the patch is targeting 2.1, and it is easy to be ported to other version since it&apos;s a very simple fix.&lt;/p&gt;

&lt;p&gt;I still need to test it, and probably &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=iamaleksey&quot; class=&quot;user-hover&quot; rel=&quot;iamaleksey&quot;&gt;iamaleksey&lt;/a&gt; can take a look at it, see if it makes sense?&lt;/p&gt;

&lt;p&gt;Is it OK that I assign this jiar to myself?&lt;/p&gt;</comment>
                            <comment id="14875932" author="mambocab" created="Fri, 18 Sep 2015 16:47:59 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=dikanggu&quot; class=&quot;user-hover&quot; rel=&quot;dikanggu&quot;&gt;dikanggu&lt;/a&gt; I&apos;ll assign you for now, and we can evaluate later depending on how review goes.&lt;/p&gt;

&lt;p&gt;EDIT: Looks like I can&apos;t assign you, my mistake.&lt;/p&gt;

&lt;p&gt;&lt;del&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=iamaleksey&quot; class=&quot;user-hover&quot; rel=&quot;iamaleksey&quot;&gt;iamaleksey&lt;/a&gt; In light of that, may I mark you as a reviewer on this?&lt;/del&gt;&lt;/p&gt;</comment>
                            <comment id="14875935" author="iamaleksey" created="Fri, 18 Sep 2015 16:49:46 +0000"  >&lt;blockquote&gt;&lt;p&gt;In light of that, may I mark you as a reviewer on this?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Done. Next time just go ahead - I&apos;ll reassign if necessary.&lt;/p&gt;</comment>
                            <comment id="14909092" author="dikanggu" created="Sat, 26 Sep 2015 05:14:31 +0000"  >&lt;p&gt;tested on some of our production servers, the &quot;DN 10.210.165.55&quot; disappeared from the nodetool status after deploying this patch.&lt;/p&gt;</comment>
                            <comment id="14909392" author="stefania" created="Sat, 26 Sep 2015 18:16:05 +0000"  >&lt;p&gt;It seems it&apos;s the same exception as in &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-10231&quot; title=&quot;Null status entries on nodes that crash during decommission of a different node&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-10231&quot;&gt;&lt;del&gt;CASSANDRA-10231&lt;/del&gt;&lt;/a&gt;. As for the part of the patch that deals with tokens being null, for that there is a fix in &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-10089&quot; title=&quot;NullPointerException in Gossip handleStateNormal&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-10089&quot;&gt;&lt;del&gt;CASSANDRA-10089&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="14933609" author="dikanggu" created="Mon, 28 Sep 2015 17:19:52 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=Stefania&quot; class=&quot;user-hover&quot; rel=&quot;stefania&quot;&gt;Stefania&lt;/a&gt;, yeah, looks like the same issues, have you committed your patches to 2.1 branch?&lt;/p&gt;</comment>
                            <comment id="14934354" author="stefania" created="Mon, 28 Sep 2015 23:43:37 +0000"  >&lt;p&gt;No they are both still under test, besides we are focusing on the 3.0 branch for the tests. If you really need this in 2.1 then you can commit this patch.&lt;/p&gt;</comment>
                            <comment id="14935515" author="dikanggu" created="Tue, 29 Sep 2015 17:45:56 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=Stefania&quot; class=&quot;user-hover&quot; rel=&quot;stefania&quot;&gt;Stefania&lt;/a&gt;, I see, yes, I&apos;d like to check it in 2.1, how can I commit it?&lt;/p&gt;</comment>
                            <comment id="14939214" author="stefania" created="Thu, 1 Oct 2015 03:18:50 +0000"  >&lt;p&gt;Sorry I wasn&apos;t very clear: the patch needs to be reviewed, then a committer will be able to commit it.&lt;/p&gt;

&lt;p&gt;However, I would like to reproduce this problem in a dtest first, could you give us the exact steps on how to reproduce it? Did you follow &lt;a href=&quot;http://docs.datastax.com/en/cassandra/2.1/cassandra/operations/ops_replace_node_t.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;these instructions&lt;/a&gt; or deviated in any way?&lt;/p&gt;

&lt;p&gt;In fact from a closer look, this is a slightly different problem than &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-10231&quot; title=&quot;Null status entries on nodes that crash during decommission of a different node&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-10231&quot;&gt;&lt;del&gt;CASSANDRA-10231&lt;/del&gt;&lt;/a&gt; because there we are processing new states (&lt;tt&gt;applyNewStates&lt;/tt&gt;) whereas here we have received a major update (&lt;tt&gt;handleMajorStateChange&lt;/tt&gt;).&lt;/p&gt;</comment>
                            <comment id="14982521" author="iamaleksey" created="Fri, 30 Oct 2015 12:58:57 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=Stefania&quot; class=&quot;user-hover&quot; rel=&quot;stefania&quot;&gt;Stefania&lt;/a&gt; Reassigning reviewership to you as you see to be aware of the context.&lt;/p&gt;</comment>
                            <comment id="14984617" author="stefania" created="Mon, 2 Nov 2015 00:57:06 +0000"  >&lt;p&gt;+1, pending CI here:&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/stef1927/job/stef1927-10298-2.1-testall/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://cassci.datastax.com/view/Dev/view/stef1927/job/stef1927-10298-2.1-testall/&lt;/a&gt;&lt;br/&gt;
&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/stef1927/job/stef1927-10298-2.1-dtest/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://cassci.datastax.com/view/Dev/view/stef1927/job/stef1927-10298-2.1-dtest/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;The code that catches the exception in &lt;tt&gt;handleStateLeft()&lt;/tt&gt; will be improved by &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-10089&quot; title=&quot;NullPointerException in Gossip handleStateNormal&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-10089&quot;&gt;&lt;del&gt;CASSANDRA-10089&lt;/del&gt;&lt;/a&gt; where we will return an empty collection in case of no tokens therefore removing the need for a try/catch. We must also remember to check for &lt;tt&gt;!tokens.isEmpty()&lt;/tt&gt; in &lt;tt&gt;excise()&lt;/tt&gt; but we&apos;ll deal with this in 10089.&lt;/p&gt;

&lt;p&gt;A test to reproduce this problem would be helpful to ensure we don&apos;t break it again later on. &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=dikanggu&quot; class=&quot;user-hover&quot; rel=&quot;dikanggu&quot;&gt;dikanggu&lt;/a&gt; are you able to reproduce this regularly and if so what are the exact steps?&lt;/p&gt;

</comment>
                            <comment id="14984888" author="stefania" created="Mon, 2 Nov 2015 08:49:06 +0000"  >&lt;p&gt;CI is similar to the unpatched branch. Unfortunately at the moment we have many dtests failing on 2.1.&lt;/p&gt;</comment>
                            <comment id="14989584" author="iamaleksey" created="Wed, 4 Nov 2015 14:08:11 +0000"  >&lt;p&gt;Committed as &lt;a href=&quot;https://github.com/apache/cassandra/commit/b6015fa4883182531d66527780fce34c9b125e46&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;b6015fa4883182531d66527780fce34c9b125e46&lt;/a&gt; to 2.1, merged with 2.2, 3.0, and trunk.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=Stefania&quot; class=&quot;user-hover&quot; rel=&quot;stefania&quot;&gt;Stefania&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=dikanggu&quot; class=&quot;user-hover&quot; rel=&quot;dikanggu&quot;&gt;dikanggu&lt;/a&gt; There was an issue with braces/newlines that went against code style, I fixed that on commit. I hope nothing else was overlooked though.&lt;/p&gt;</comment>
                            <comment id="14989972" author="dikanggu" created="Wed, 4 Nov 2015 17:24:31 +0000"  >&lt;p&gt;Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=iamaleksey&quot; class=&quot;user-hover&quot; rel=&quot;iamaleksey&quot;&gt;iamaleksey&lt;/a&gt; and &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=Stefania&quot; class=&quot;user-hover&quot; rel=&quot;stefania&quot;&gt;Stefania&lt;/a&gt;!&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12762499" name="CASSANDRA-10298.patch" size="2309" author="dikanggu" created="Sat, 26 Sep 2015 05:12:58 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[dikanggu]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 2 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2jzf3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>stefania</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[stefania]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12962"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12311420" key="com.atlassian.jira.plugin.system.customfieldtypes:version">
                        <customfieldname>Since Version</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="12329874">2.1.5</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>