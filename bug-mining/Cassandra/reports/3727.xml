<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 22:55:51 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-9965] Add new JMX methods to change local compaction strategy</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-9965</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;&lt;tt&gt;ColumnFamilyStore.setCompactionStrategyClass()&lt;/tt&gt; should get the same treatment wrt JMX/schema switches that &lt;tt&gt;enabled&lt;/tt&gt; got in &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-9899&quot; title=&quot;If compaction is disabled in schema, you can&amp;#39;t enable a single node through nodetool&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-9899&quot;&gt;&lt;del&gt;CASSANDRA-9899&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;It should also not alter the &lt;tt&gt;CFMetaData&lt;/tt&gt; object directly, ever. Only DDL statements should be allowed to do that.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-9712&quot; title=&quot;Refactor CFMetaData&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-9712&quot;&gt;CASSANDRA-9712&lt;/a&gt; will temporarily throw UOE for that call.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12851159">CASSANDRA-9965</key>
            <summary>Add new JMX methods to change local compaction strategy</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10003" iconUrl="https://issues.apache.org/jira/images/icons/priorities/trivial.svg">Low</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="marcuse">Marcus Eriksson</assignee>
                                    <reporter username="aleksey">Aleksey Yeschenko</reporter>
                        <labels>
                    </labels>
                <created>Mon, 3 Aug 2015 17:48:19 +0000</created>
                <updated>Tue, 16 Apr 2019 09:31:02 +0000</updated>
                            <resolved>Mon, 10 Aug 2015 07:37:28 +0000</resolved>
                                        <fixVersion>2.1.9</fixVersion>
                    <fixVersion>2.2.1</fixVersion>
                    <fixVersion>3.0 beta 1</fixVersion>
                                    <component>Local/Compaction</component>
                        <due></due>
                            <votes>1</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="14652301" author="snazy" created="Mon, 3 Aug 2015 19:13:37 +0000"  >&lt;p&gt;Setting compactionStrategyClass without setting the compaction parameters is probably not a good idea at all - different strategies means different/incompatible options.&lt;/p&gt;</comment>
                            <comment id="14653208" author="iamaleksey" created="Tue, 4 Aug 2015 07:36:26 +0000"  >&lt;p&gt;See also: &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-9969&quot; title=&quot;Expose the DTCS configuration parameters (base time, min threshold, max age) via jmx&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-9969&quot;&gt;&lt;del&gt;CASSANDRA-9969&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14658803" author="krummas" created="Wed, 5 Aug 2015 20:10:16 +0000"  >&lt;p&gt;Patch here: &lt;a href=&quot;https://github.com/krummas/cassandra/commits/marcuse/9965&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/krummas/cassandra/commits/marcuse/9965&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Adds two JMX methods, one to set strategy+options using the same &apos;compaction = &lt;/p&gt;
{...}
&lt;p&gt;&apos;-string you would use in CREATE/ALTER, and one taking a Map&amp;lt;String, String&amp;gt;. Reason for having two methods is that it seems impossible to call a JMX method that takes a Map from jconsole/jmc&lt;/p&gt;

&lt;p&gt;If a user sets the local compaction strategy that will be set until an ALTER that touches compaction options is executed (or the node is restarted)&lt;/p&gt;</comment>
                            <comment id="14660281" author="iamaleksey" created="Thu, 6 Aug 2015 16:42:42 +0000"  >&lt;p&gt;Could you please push branches for 2.2 and 3.0, too? 3.0 will be somewhat different, using &lt;tt&gt;CompactionParams&lt;/tt&gt; instead.&lt;/p&gt;

&lt;p&gt;Also links to cassci dtest/utest runs for each branch would be nice. Thanks.&lt;/p&gt;</comment>
                            <comment id="14660393" author="iamaleksey" created="Thu, 6 Aug 2015 17:21:17 +0000"  >&lt;p&gt;As for the 2.1 branch,&lt;/p&gt;

&lt;p&gt;Nits:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;&lt;tt&gt;CFMetaData.createCompactionStrategyInstance()&lt;/tt&gt; has a redundant &lt;tt&gt;this&lt;/tt&gt; in &lt;tt&gt;this.compactionStrategyOptions&lt;/tt&gt;&lt;/li&gt;
	&lt;li&gt;&lt;tt&gt;ColumnFamilyStore.setLocalCompactionStrategyString()&lt;/tt&gt; doesn&apos;t really need an intermediate &lt;tt&gt;optionMap&lt;/tt&gt; variable&lt;/li&gt;
	&lt;li&gt;&lt;tt&gt;ColumnFamilyStore.setLocalCompactionStrategy()&lt;/tt&gt; should probably copy the &lt;tt&gt;options&lt;/tt&gt; map before removing anything from it, and not imply that the passed-in map will always be mutable&lt;/li&gt;
	&lt;li&gt;in &lt;tt&gt;WrappingCompactionStrategy.maybeReloadCompactionStrategy()&lt;/tt&gt; is it actually possible for &lt;tt&gt;schemaCompactionStrategyClass&lt;/tt&gt; and &lt;tt&gt;schemaCompactionOptions&lt;/tt&gt; to be null?&lt;/li&gt;
	&lt;li&gt;is it intentional that in &lt;tt&gt;setNewLocalCompactionStrategy&lt;/tt&gt; &lt;tt&gt;startup()&lt;/tt&gt; happens before &lt;tt&gt;shouldBeEnabled()&lt;/tt&gt; check, and in reverse order in &lt;tt&gt;reloadCompactionStrategy()&lt;/tt&gt;?&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Other than that things LGTM, assuming cassci is happy.&lt;/p&gt;</comment>
                            <comment id="14660682" author="krummas" created="Thu, 6 Aug 2015 19:47:13 +0000"  >&lt;p&gt;pushed with nits fixed:&lt;br/&gt;
&lt;a href=&quot;https://github.com/krummas/cassandra/commits/marcuse/9965&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/krummas/cassandra/commits/marcuse/9965&lt;/a&gt;&lt;br/&gt;
&lt;a href=&quot;https://github.com/krummas/cassandra/commits/marcuse/9965-2.2&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/krummas/cassandra/commits/marcuse/9965-2.2&lt;/a&gt;&lt;br/&gt;
&lt;a href=&quot;https://github.com/krummas/cassandra/commits/marcuse/9965-3.0&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/krummas/cassandra/commits/marcuse/9965-3.0&lt;/a&gt;&lt;br/&gt;
&lt;a href=&quot;https://github.com/krummas/cassandra/commits/marcuse/9965-trunk&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/krummas/cassandra/commits/marcuse/9965-trunk&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;note that for 3.0+ I removed the deprecated methods and added a jmx method to get the globally configured compaction strategy, so that users can compare and see if the local one is changed.&lt;/p&gt;

&lt;p&gt;tests (soon):&lt;br/&gt;
&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/krummas/job/krummas-marcuse-9965-dtest/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://cassci.datastax.com/view/Dev/view/krummas/job/krummas-marcuse-9965-dtest/&lt;/a&gt;&lt;br/&gt;
&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/krummas/job/krummas-marcuse-9965-2.2-dtest/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://cassci.datastax.com/view/Dev/view/krummas/job/krummas-marcuse-9965-2.2-dtest/&lt;/a&gt;&lt;br/&gt;
&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/krummas/job/krummas-marcuse-9965-3.0-dtest/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://cassci.datastax.com/view/Dev/view/krummas/job/krummas-marcuse-9965-3.0-dtest/&lt;/a&gt;&lt;br/&gt;
&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/krummas/job/krummas-marcuse-9965-trunk-dtest/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://cassci.datastax.com/view/Dev/view/krummas/job/krummas-marcuse-9965-trunk-dtest/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/krummas/job/krummas-marcuse-9965-testall/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://cassci.datastax.com/view/Dev/view/krummas/job/krummas-marcuse-9965-testall/&lt;/a&gt;&lt;br/&gt;
&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/krummas/job/krummas-marcuse-9965-2.2-testall/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://cassci.datastax.com/view/Dev/view/krummas/job/krummas-marcuse-9965-2.2-testall/&lt;/a&gt;&lt;br/&gt;
&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/krummas/job/krummas-marcuse-9965-3.0-testall/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://cassci.datastax.com/view/Dev/view/krummas/job/krummas-marcuse-9965-3.0-testall/&lt;/a&gt;&lt;br/&gt;
&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/krummas/job/krummas-marcuse-9965-trunk-testall/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://cassci.datastax.com/view/Dev/view/krummas/job/krummas-marcuse-9965-trunk-testall/&lt;/a&gt;&lt;/p&gt;
</comment>
                            <comment id="14661714" author="iamaleksey" created="Fri, 7 Aug 2015 11:49:48 +0000"  >&lt;p&gt;Looks good to me, including cassci runs. Could you consider doing the following things on commit (without rerunning tests or another round of review)?&lt;/p&gt;

&lt;p&gt;1. Add a short deprecation/new methods note to NEWS.txt in 2.1/2.2&lt;br/&gt;
2. Add a short removal/new methods note in NEWS.txt in 3.0&lt;br/&gt;
3. In &lt;tt&gt;maybeReloadCompactionStrategy()&lt;/tt&gt; in all versions swap &lt;tt&gt;.equals()&lt;/tt&gt; call order (so that we have &lt;tt&gt;metadata.params.compaction.equals(params)&lt;/tt&gt;) - this would guarantee no NPEs, and I&apos;ll sleep better knowing that my previous suggestion will never break anything&lt;br/&gt;
4. In consistency with CFS compressions setters/getters, do the following renames:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;&lt;tt&gt;setLocalCompactionStrategy()&lt;/tt&gt; -&amp;gt; &lt;tt&gt;setCompactionParameters()&lt;/tt&gt;&lt;/li&gt;
	&lt;li&gt;&lt;tt&gt;getLocalCompactionStrategy()&lt;/tt&gt; -&amp;gt; &lt;tt&gt;getCompactionParameters()&lt;/tt&gt;&lt;/li&gt;
	&lt;li&gt;&lt;tt&gt;setLocalCompactionStrategyString()&lt;/tt&gt; -&amp;gt; &lt;tt&gt;setCompactionParametersFromJson()&lt;/tt&gt; (&apos;string&apos; is ambiguous, &apos;Json&apos; or &apos;JSON&apos; encapsulates intent in the name)&lt;/li&gt;
	&lt;li&gt;&lt;tt&gt;getLocalCompactionStrategyString()&lt;/tt&gt; -&amp;gt; &lt;tt&gt;getCompactionParametersAsJson()&lt;/tt&gt; - same reasoning and symmetry&lt;br/&gt;
5. Remove the variants that return what&apos;s configured in schema (&lt;tt&gt;getCompactionStrategy()&lt;/tt&gt;). I see the rationale, but the user can compare JMX output with cqlsh, we don&apos;t need an extra way to fetch schema&lt;br/&gt;
6. Mark &lt;tt&gt;getCompactionStrategyClass()&lt;/tt&gt; deprecated in 2.2, as well.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Feel free to treat 3, 4, 5, and 6 as easily ignorable suggestions. It really is gtg.&lt;/p&gt;</comment>
                            <comment id="14679717" author="krummas" created="Mon, 10 Aug 2015 07:37:28 +0000"  >&lt;p&gt;Committed&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;setLocalCompactionStrategyString() -&amp;gt; setCompactionParametersFromJson() (&apos;string&apos; is ambiguous, &apos;Json&apos; or &apos;JSON&apos; encapsulates intent in the name)&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;getLocalCompactionStrategyString() -&amp;gt; getCompactionParametersAsJson() - same reasoning and symmetry&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;I left &quot;As&quot;/&quot;From&quot; as jmx methods should be name the same except for get/set&lt;/p&gt;</comment>
                            <comment id="14679837" author="iamaleksey" created="Mon, 10 Aug 2015 09:12:19 +0000"  >&lt;p&gt;Perfect, thanks.&lt;/p&gt;</comment>
                            <comment id="15152465" author="weideng" created="Thu, 18 Feb 2016 15:40:19 +0000"  >&lt;p&gt;Updated the title of this JIRA as it doesn&apos;t describe in natural language what it&apos;s trying to do and makes finding this JIRA much harder. I&apos;m copy/pasting the description from the CHANGES.txt.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                                                <inwardlinks description="is duplicated by">
                                        <issuelink>
            <issuekey id="12851229">CASSANDRA-9969</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[marcuse]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 39 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2i9yn:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>aleksey</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[aleksey]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12961"><![CDATA[Low]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>