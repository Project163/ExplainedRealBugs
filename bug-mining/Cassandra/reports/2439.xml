<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 22:41:11 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-6194] speculative retry can sometimes violate consistency</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-6194</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;This is most evident with intermittent failures of the short_read dtests.  I&apos;ll focus on short_read_reversed_test for explanation, since that&apos;s what I used to bisect.  This test inserts some columns into a row, then deletes a subset, but it performs each delete on a different node, with another node down (hints are disabled.)  Finally it reads the row back at QUORUM and checks that it doesn&apos;t see any deleted columns, however with speculative retry on this often fails.  I bisected this to the change that made 99th percentile SR the default reliably by looping the test enough times at each iteration to be sure it was passing or failing.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12673619">CASSANDRA-6194</key>
            <summary>speculative retry can sometimes violate consistency</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10002" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Normal</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="jbellis">Jonathan Ellis</assignee>
                                    <reporter username="brandon.williams">Brandon Williams</reporter>
                        <labels>
                    </labels>
                <created>Sun, 13 Oct 2013 18:56:44 +0000</created>
                <updated>Tue, 16 Apr 2019 09:32:02 +0000</updated>
                            <resolved>Wed, 23 Oct 2013 15:52:09 +0000</resolved>
                                        <fixVersion>2.0.2</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="13793755" author="brandon.williams" created="Sun, 13 Oct 2013 18:58:13 +0000"  >&lt;p&gt;Unfortunately I haven&apos;t been able to repro manually and ccm has a problem with logging at debug on 2.0+ currently.  10 iterations of the test should be enough to trigger, though I bisected again to the same point with 30.&lt;/p&gt;</comment>
                            <comment id="13801827" author="jbellis" created="Tue, 22 Oct 2013 13:53:40 +0000"  >&lt;p&gt;Patch attached to wait for all the contacted replicas on DME.  Not sure how this could cause the test failure though so it&apos;s kind of a shot in the dark.&lt;/p&gt;</comment>
                            <comment id="13802020" author="slebresne" created="Tue, 22 Oct 2013 17:10:05 +0000"  >&lt;p&gt;For the record, the error returned by the dtest is:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;======================================================================
FAIL: short_read_reversed_test (consistency_test.TestConsistency)
----------------------------------------------------------------------
Traceback (most recent call last):
  File &quot;/home/mcmanus/Git/dtest-cassandra/consistency_test.py&quot;, line 309, in short_read_reversed_test
    assert res[i][1] == &apos;value%d&apos; % (5-i), &apos;Expecting value%d, got %s (%s)&apos; % (5-i, res[i][1], str(res))
AssertionError: Expecting value5, got value8 ([[u&apos;c000008&apos;, u&apos;value8&apos;], [u&apos;c000005&apos;, u&apos;value5&apos;], [u&apos;c000004&apos;, u&apos;value4&apos;]])

----------------------------------------------------------------------
Ran 1 test in 130.035s
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="13802182" author="brandon.williams" created="Tue, 22 Oct 2013 19:44:11 +0000"  >&lt;p&gt;Worth noting that there&apos;s no real pattern to the columns, other than they&apos;re wrong&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;AssertionError: Expecting value5, got value7 ([[u&apos;c000007&apos;, u&apos;value7&apos;], [u&apos;c000005&apos;, u&apos;value5&apos;], [u&apos;c000004&apos;, u&apos;value4&apos;]])
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="13802211" author="jbellis" created="Tue, 22 Oct 2013 20:08:41 +0000"  >&lt;p&gt;The problem is that when we speculate, we do multiple data reads, and RowDigestResolver assumes there is only one data read.  (If there is more than one, it does not error out but silently drops all but one.)&lt;/p&gt;

&lt;p&gt;So if the speculative read results in triggering the callback&apos;s &quot;we have enough replies to satisfy CL&quot; logic, and the speculative data read finished before the digest, we effectively do CL.ONE logic instead of CL.QUORUM.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/jbellis/cassandra/commits/6194&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/jbellis/cassandra/commits/6194&lt;/a&gt; includes a fix for this and also a fix for DigestMismatch logic with SR.&lt;/p&gt;</comment>
                            <comment id="13802234" author="brandon.williams" created="Tue, 22 Oct 2013 20:36:16 +0000"  >&lt;p&gt;This fixes the test for me.&lt;/p&gt;</comment>
                            <comment id="13802971" author="iamaleksey" created="Wed, 23 Oct 2013 15:52:09 +0000"  >&lt;p&gt;LGTM and committed (also made 99PERCENTILE the default again).&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12609652" name="6194.txt" size="7704" author="jbellis" created="Tue, 22 Oct 2013 13:53:40 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[jbellis]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>353242</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            12 years, 4 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1owi7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>353535</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>aleksey</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[aleksey]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12962"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>