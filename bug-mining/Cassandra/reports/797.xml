<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 22:20:07 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-2321] disallow to querying a counter CF with non-counter operation</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-2321</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;CounterColumnType.getString() returns hexString.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; getString(ByteBuffer bytes)
{ 
       &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; ByteBufferUtil.bytesToHex(bytes);
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;and python stress.py reader returns&lt;/p&gt;


&lt;p&gt;[ColumnOrSuperColumn(column=None, super_column=SuperColumn(name=&apos;19&apos;, columns=&lt;span class=&quot;error&quot;&gt;&amp;#91;Column(timestamp=1299984960277, name=&amp;#39;56&amp;#39;, value=&amp;#39;\x7f\x00\x00\x01\x00\x00\x00\x00\x00\x00\x00\x08\x00\x00\x00\x00\x00\x00\x00,&amp;#39;, ttl=None), Column(timestamp=1299985019923, name=&amp;#39;57&amp;#39;, value=&amp;#39;\x7f\x00\x00\x01\x00\x00\x00\x00\x00\x00\x00;\x00\x00\x00\x00\x00\x00\x08\xfd&amp;#39;, ttl=None))&amp;#93;&lt;/span&gt;&lt;/p&gt;</description>
                <environment>&lt;p&gt;Linux&lt;/p&gt;</environment>
        <key id="12501289">CASSANDRA-2321</key>
            <summary>disallow to querying a counter CF with non-counter operation</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10003" iconUrl="https://issues.apache.org/jira/images/icons/priorities/trivial.svg">Low</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="slebresne">Sylvain Lebresne</assignee>
                                    <reporter username="mubarak.seyed">Mubarak Seyed</reporter>
                        <labels>
                    </labels>
                <created>Sun, 13 Mar 2011 05:27:53 +0000</created>
                <updated>Tue, 16 Apr 2019 09:33:04 +0000</updated>
                            <resolved>Tue, 29 Mar 2011 20:39:25 +0000</resolved>
                                        <fixVersion>0.8 beta 1</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="13006986" author="slebresne" created="Tue, 15 Mar 2011 16:08:19 +0000"  >&lt;p&gt;Actually, having getString() return hexString is the right thing to do, because internally counters are bytes and getString is used by sstable2json in particular.&lt;/p&gt;

&lt;p&gt;The problem however is that it is not disallowed to query a counter CF with non-counter operation. Attaching a patch to correct this. This is a bigger patch that one would hope because ThriftValidation doesn&apos;t help. So the patch does a bunch of refactoring to allow what it must do. As a side node, the refactoring makes it more efficient (We don&apos;t revalidate the column family for each mutation of a batch_mutate).&lt;/p&gt;

&lt;p&gt;Btw, stress.py has no support for counters, but stress.java has it. &lt;/p&gt;</comment>
                            <comment id="13011183" author="slebresne" created="Fri, 25 Mar 2011 12:58:56 +0000"  >&lt;p&gt;Rebased patch attached&lt;/p&gt;</comment>
                            <comment id="13011301" author="jbellis" created="Fri, 25 Mar 2011 17:37:20 +0000"  >&lt;p&gt;I&apos;m not sure this refactor is much of an improvement.  Seems like the code moves around a lot but volume and complexity are not really reduced.&lt;/p&gt;

&lt;p&gt;Can&apos;t we just add a &quot;validateCounterCF&quot; to counter calls and &quot;validateNonCounterCF&quot; otherwise?&lt;/p&gt;

&lt;p&gt;(I&apos;d prefer to say &quot;counter/noncounter&quot; vs &quot;noncommutative/commutative&quot; but if you really prefer the other that&apos;s okay too.)&lt;/p&gt;</comment>
                            <comment id="13011356" author="slebresne" created="Fri, 25 Mar 2011 19:00:18 +0000"  >&lt;blockquote&gt;&lt;p&gt;I&apos;m not sure this refactor is much of an improvement. Seems like the code moves around a lot but volume and complexity are not really reduced.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I do believe the refactor is an improvement (granted, maybe not a huge one). During validation we do a bunch of queries to DatabaseDescriptor to check the cf exists, then to get its type (super or standard), then to get its value validator, etc... Granted those are just hashMaps gets, but they are just unnecessary. I do think that the method used by the refactor, that is getting the metadata once and giving it to all other method is cleaner. There also the fact that we revalidate the column family for each Mutation of a batch_mutate, even if all of them are on the same cf, which this refactor fixes too.&lt;br/&gt;
I don&apos;t care so much about those and won&apos;t fight over it, but I think it would be a pity to leave ThriftValidation in that state (and the refactoring is really trivial). Note that I&apos;ll be perfectly ok with moving the refactor in another ticket if that makes it better.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;Can&apos;t we just add a &quot;validateCounterCF&quot; to counter calls and &quot;validateNonCounterCF&quot; otherwise?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Yes we could, up to the fact that the refactor would still make sense I think for the reason above &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;(I&apos;d prefer to say &quot;counter/noncounter&quot; vs &quot;noncommutative/commutative&quot; but if you really prefer the other that&apos;s okay too.)&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;When I have a few free cycles I plan to remove the &apos;commutative&apos; wording completely as I think this was premature generalization and make the code less readable right now. So I&apos;m on your side, I just went for consistency with the rest of the code for now.&lt;/p&gt;</comment>
                            <comment id="13012677" author="jbellis" created="Tue, 29 Mar 2011 20:39:25 +0000"  >&lt;p&gt;committed&lt;/p&gt;</comment>
                            <comment id="13012781" author="hudson" created="Tue, 29 Mar 2011 23:53:54 +0000"  >&lt;p&gt;Integrated in Cassandra #817 (See &lt;a href=&quot;https://hudson.apache.org/hudson/job/Cassandra/817/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://hudson.apache.org/hudson/job/Cassandra/817/&lt;/a&gt;)&lt;/p&gt;
</comment>
                    </comments>
                    <attachments>
                            <attachment id="12474612" name="0001-Don-t-allow-normal-query-on-counter-CF.patch" size="46018" author="slebresne" created="Fri, 25 Mar 2011 12:58:56 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[slebresne]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>20560</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            14 years, 34 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0gaov:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>93162</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>jbellis</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[jbellis]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12961"><![CDATA[Low]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>