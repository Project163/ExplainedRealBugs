<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 23:04:50 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-12060] Establish consistent distinction between non-existing partition and NULL value for LWTs on static columns</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-12060</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;When executing following CQL commands: &lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;CREATE KEYSPACE test WITH replication = {&lt;span class=&quot;code-quote&quot;&gt;&apos;class&apos;&lt;/span&gt;: &lt;span class=&quot;code-quote&quot;&gt;&apos;NetworkTopologyStrategy&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;datacenter1&apos;&lt;/span&gt;: &lt;span class=&quot;code-quote&quot;&gt;&apos;1&apos;&lt;/span&gt; };
USE test;
CREATE TABLE testtable (a &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;, b &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;, s1 &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt;, s2 &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt;, v &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;, PRIMARY KEY (a, b));
INSERT INTO testtable (a,b,s1,s2,v) VALUES (2,2,2,&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;,2);
DELETE s1 FROM testtable WHERE a = 2 IF s2 IN (10,20,30);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The output is different between &lt;tt&gt;2.x&lt;/tt&gt; and &lt;tt&gt;3.x&lt;/tt&gt;:&lt;/p&gt;

&lt;p&gt;2.x:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;cqlsh:test&amp;gt; DELETE s1 FROM testtable WHERE a = 2 IF s2 = 5;

 [applied] | s2
-----------+------
     False | &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;3.x:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;cqlsh:test&amp;gt; DELETE s1 FROM testtable WHERE a = 2 IF s2 = 5;

 [applied]
-----------
     False
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;tt&gt;2.x&lt;/tt&gt; would although return same result if executed on a partition that does not exist at all:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;cqlsh:test&amp;gt; DELETE s1 FROM testtable WHERE a = 5 IF s2 = 5;

 [applied]
-----------
     False
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;It &lt;em&gt;might&lt;/em&gt; be related to static column LWTs, as I could not reproduce same behaviour with non-static column LWTs. The most recent change was &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-10532&quot; title=&quot;Allow LWT operation on static column with only partition keys&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-10532&quot;&gt;&lt;del&gt;CASSANDRA-10532&lt;/del&gt;&lt;/a&gt;, which enabled LWT operations on static columns with partition keys only. &lt;del&gt;Another possible relation is &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-9842&quot; title=&quot;Inconsistent behavior for &amp;#39;= null&amp;#39; conditions on static columns&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-9842&quot;&gt;&lt;del&gt;CASSANDRA-9842&lt;/del&gt;&lt;/a&gt;, which removed distinction between &lt;tt&gt;null&lt;/tt&gt; column and non-existing row.&lt;/del&gt; (striked through since same happens on pre-&lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-9842&quot; title=&quot;Inconsistent behavior for &amp;#39;= null&amp;#39; conditions on static columns&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-9842&quot;&gt;&lt;del&gt;CASSANDRA-9842&lt;/del&gt;&lt;/a&gt; code.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12981933">CASSANDRA-12060</key>
            <summary>Establish consistent distinction between non-existing partition and NULL value for LWTs on static columns</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10002" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Normal</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="ifesdjeen">Alex Petrov</assignee>
                                    <reporter username="ifesdjeen">Alex Petrov</reporter>
                        <labels>
                            <label>LWT</label>
                    </labels>
                <created>Wed, 22 Jun 2016 15:49:21 +0000</created>
                <updated>Wed, 15 Oct 2025 09:49:06 +0000</updated>
                            <resolved>Wed, 21 Sep 2016 14:29:55 +0000</resolved>
                                        <fixVersion>3.0.10</fixVersion>
                    <fixVersion>3.10</fixVersion>
                                    <component>Feature/Lightweight Transactions</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="15346028" author="slebresne" created="Thu, 23 Jun 2016 08:15:27 +0000"  >&lt;p&gt;In a way, that it behaves the same way in 3.x whether or not the partition itself exists or not is consistent with not making a distinction for static column {{ == null }} conditions between having the partition exists or not (&lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-9842&quot; title=&quot;Inconsistent behavior for &amp;#39;= null&amp;#39; conditions on static columns&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-9842&quot;&gt;&lt;del&gt;CASSANDRA-9842&lt;/del&gt;&lt;/a&gt;). That said, I&apos;m having second though about &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-9842&quot; title=&quot;Inconsistent behavior for &amp;#39;= null&amp;#39; conditions on static columns&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-9842&quot;&gt;&lt;del&gt;CASSANDRA-9842&lt;/del&gt;&lt;/a&gt;. I know I said offline that trying to make a difference between the 2 cases was probably annoying, but I think I was tired when I said that because I said otherwise earlier in &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-9842?focusedCommentId=15066724&amp;amp;page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-15066724&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;this comment&lt;/a&gt;. Long story short, from a pure consistency of the language standpoint, I wonder if the best course of action wouldn&apos;t be to 1) re-open &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-9842&quot; title=&quot;Inconsistent behavior for &amp;#39;= null&amp;#39; conditions on static columns&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-9842&quot;&gt;&lt;del&gt;CASSANDRA-9842&lt;/del&gt;&lt;/a&gt; to see if we can make it behave so that &lt;tt&gt;s == null&lt;/tt&gt; only apply if the partition exists (and s is &lt;tt&gt;null&lt;/tt&gt; obviously) and 2) fix this issue so that 3.x behaves as 2.x.&lt;/p&gt;

&lt;p&gt;Otherwise, if we think keeping &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-9842&quot; title=&quot;Inconsistent behavior for &amp;#39;= null&amp;#39; conditions on static columns&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-9842&quot;&gt;&lt;del&gt;CASSANDRA-9842&lt;/del&gt;&lt;/a&gt; as is is the right thing to do, then I think it follows that the 3.x behavior is kind of correct, and we&apos;ll have to document it as a change of behavior.&lt;/p&gt;</comment>
                            <comment id="15346396" author="ifesdjeen" created="Thu, 23 Jun 2016 13:06:39 +0000"  >&lt;p&gt;I&apos;ve checked the pre-9842 behaviour (on top of &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-10532&quot; title=&quot;Allow LWT operation on static column with only partition keys&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-10532&quot;&gt;&lt;del&gt;CASSANDRA-10532&lt;/del&gt;&lt;/a&gt; alone)&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;[cqlsh 5.0.1 | Cassandra 2.1.14-SNAPSHOT | CQL spec 3.2.1 | Native protocol v3]
Use HELP &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; help.
cqlsh&amp;gt; CREATE KEYSPACE test WITH replication = {&lt;span class=&quot;code-quote&quot;&gt;&apos;class&apos;&lt;/span&gt;: &lt;span class=&quot;code-quote&quot;&gt;&apos;NetworkTopologyStrategy&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;datacenter1&apos;&lt;/span&gt;: &lt;span class=&quot;code-quote&quot;&gt;&apos;1&apos;&lt;/span&gt; };
cqlsh&amp;gt; USE test;
cqlsh:test&amp;gt; CREATE TABLE testtable (a &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;, b &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;, s1 &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt;, s2 &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt;, v &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;, PRIMARY KEY (a, b));
cqlsh:test&amp;gt; INSERT INTO testtable (a,b,s1,s2,v) VALUES (2,2,2,&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;,2);
cqlsh:test&amp;gt; DELETE s1 FROM testtable WHERE a = 2 IF s2 IN (10,20,30);

 [applied] | s2
-----------+------
     False | &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;[cqlsh 5.0.1 | Cassandra 3.0.7-SNAPSHOT | CQL spec 3.4.0 | Native protocol v4]
Use HELP &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; help.
cqlsh&amp;gt; CREATE KEYSPACE test WITH replication = {&lt;span class=&quot;code-quote&quot;&gt;&apos;class&apos;&lt;/span&gt;: &lt;span class=&quot;code-quote&quot;&gt;&apos;NetworkTopologyStrategy&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;datacenter1&apos;&lt;/span&gt;: &lt;span class=&quot;code-quote&quot;&gt;&apos;1&apos;&lt;/span&gt; };
cqlsh&amp;gt; USE test;
cqlsh:test&amp;gt; CREATE TABLE testtable (a &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;, b &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;, s1 &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt;, s2 &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt;, v &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;, PRIMARY KEY (a, b));
cqlsh:test&amp;gt; INSERT INTO testtable (a,b,s1,s2,v) VALUES (2,2,2,&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;,2);
cqlsh:test&amp;gt; DELETE s1 FROM testtable WHERE a = 2 IF s2 IN (10,20,30);

 [applied]
-----------
     False
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;UPDATE&amp;#93;&lt;/span&gt; (previous version of this message was due to wrong checked out commit on &lt;tt&gt;3.0&lt;/tt&gt;) So the inconsistency was there before the &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-9842&quot; title=&quot;Inconsistent behavior for &amp;#39;= null&amp;#39; conditions on static columns&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-9842&quot;&gt;&lt;del&gt;CASSANDRA-9842&lt;/del&gt;&lt;/a&gt;. &lt;/p&gt;</comment>
                            <comment id="15346432" author="slebresne" created="Thu, 23 Jun 2016 13:35:05 +0000"  >&lt;p&gt;I didn&apos;t said that the inconsistency of this ticket was &lt;b&gt;due&lt;/b&gt; to &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-9842&quot; title=&quot;Inconsistent behavior for &amp;#39;= null&amp;#39; conditions on static columns&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-9842&quot;&gt;&lt;del&gt;CASSANDRA-9842&lt;/del&gt;&lt;/a&gt;. I haven&apos;t checked closely, but It&apos;s almost surely due to the fact that in 3.0, the underlying paxos read only query the static part, and so when it gets back an empty result, it really has no way to know the difference between &quot;the partition just doesn&apos;t exist&quot; or &quot;the partition actually exists, but has nothing for the static part (at least not for the part we have condition on)&quot;.&lt;/p&gt;

&lt;p&gt;What I&apos;m saying is that it&apos;s due to the same fact than in &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-9842&quot; title=&quot;Inconsistent behavior for &amp;#39;= null&amp;#39; conditions on static columns&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-9842&quot;&gt;&lt;del&gt;CASSANDRA-9842&lt;/del&gt;&lt;/a&gt;: because ironically 3.0 is able to only query the static part, it doesn&apos;t know when it gets no results anything about the liveness of the partition. I say ironically because it wasn&apos;t a problem in 2.0 due to it being somewhat imprecise: to query the static part we were simply query the whole partition (since the storage engine didn&apos;t knew about static stuff) with a limit of 1. Thanks to that though, if we got back no static part, we knew if the partition was live (meant we did got one row back, it was just not static) or not (we got nothing back).&lt;/p&gt;

&lt;p&gt;And my point is that we should probably try to get back to the 2.x behavior, because 1) it&apos;s more helpful (we get more info when there is not static part) and 2) that avoid breaking changes between 2.x and 3.x. So in other words,  when we have conditions on a static column, we should probably internally query both the static part &lt;b&gt;and&lt;/b&gt; the first live row of the partition. The last part being slightly inefficient, but necessary to make the distinction between live/dead partition when there is nothing static. And if we do that, then we should apply it to both this ticket and the case covered by &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-9842&quot; title=&quot;Inconsistent behavior for &amp;#39;= null&amp;#39; conditions on static columns&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-9842&quot;&gt;&lt;del&gt;CASSANDRA-9842&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="15346475" author="ifesdjeen" created="Thu, 23 Jun 2016 14:03:57 +0000"  >&lt;p&gt;Sure, I&apos;m just giving a bit more information for the ticket. &lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;And my point is that we should probably try to get back to the 2.x behavior&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Sounds good. &lt;/p&gt;</comment>
                            <comment id="15407448" author="slebresne" created="Thu, 4 Aug 2016 09:00:10 +0000"  >&lt;blockquote&gt;&lt;p&gt;Sounds good.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I probably optimistically assumed that as you taking on yourself to make that change. So &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ifesdjeen&quot; class=&quot;user-hover&quot; rel=&quot;ifesdjeen&quot;&gt;ifesdjeen&lt;/a&gt;, do you want to handle this, by which I mean getting 3.x to make a difference again between a &quot;live&quot; partition with no static content (but some other live rows), and a &quot;dead&quot; partition (with no live content at all), and this both the case of this ticket &lt;b&gt;and&lt;/b&gt; the ones from &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-9842&quot; title=&quot;Inconsistent behavior for &amp;#39;= null&amp;#39; conditions on static columns&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-9842&quot;&gt;&lt;del&gt;CASSANDRA-9842&lt;/del&gt;&lt;/a&gt;. If so, I think we should do that asap as we have a bad behavior currently committed.&lt;/p&gt;

&lt;p&gt;If you don&apos;t have time, I&apos;ll try to find someone else (or try to do it myself, but I&apos;m off for 3 weeks very soon and I&apos;d rather not wait until then if we can avoid it). &lt;/p&gt;</comment>
                            <comment id="15415266" author="ifesdjeen" created="Wed, 10 Aug 2016 13:29:59 +0000"  >&lt;p&gt;Talked with &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=slebresne&quot; class=&quot;user-hover&quot; rel=&quot;slebresne&quot;&gt;slebresne&lt;/a&gt; offline, and he suggested to fix the behaviour for all branches as follows: &lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;we want x == null to mean &quot;the container of x exists but x itself is null&quot;&lt;/p&gt;&lt;/blockquote&gt;

&lt;ul&gt;
	&lt;li&gt;If partition exists, but column is null, &lt;tt&gt;= null&lt;/tt&gt; LWT will succeed&lt;/li&gt;
	&lt;li&gt;If partition does not exist, &lt;tt&gt;= null&lt;/tt&gt; LWT will fail&lt;/li&gt;
&lt;/ul&gt;


&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/ifesdjeen/cassandra/tree/12060-2.1&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;2.1 &lt;/a&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://cassci.datastax.com/view/Dev/view/ifesdjeen/job/ifesdjeen-12060-2.1-testall/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;utest&lt;/a&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://cassci.datastax.com/view/Dev/view/ifesdjeen/job/ifesdjeen-12060-2.1-dtest/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;dtest&lt;/a&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/ifesdjeen/cassandra/tree/12060-2.2&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;2.2 &lt;/a&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://cassci.datastax.com/view/Dev/view/ifesdjeen/job/ifesdjeen-12060-2.2-testall/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;utest&lt;/a&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://cassci.datastax.com/view/Dev/view/ifesdjeen/job/ifesdjeen-12060-2.2-dtest/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;dtest&lt;/a&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/ifesdjeen/cassandra/tree/12060-3.0&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;3.0 &lt;/a&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://cassci.datastax.com/view/Dev/view/ifesdjeen/job/ifesdjeen-12060-3.0-testall/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;utest&lt;/a&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://cassci.datastax.com/view/Dev/view/ifesdjeen/job/ifesdjeen-12060-3.0-dtest/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;dtest&lt;/a&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/ifesdjeen/cassandra/tree/12060-trunk&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;trunk &lt;/a&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://cassci.datastax.com/view/Dev/view/ifesdjeen/job/ifesdjeen-12060-trunk-testall/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;utest&lt;/a&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://cassci.datastax.com/view/Dev/view/ifesdjeen/job/ifesdjeen-12060-trunk-dtest/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;dtest&lt;/a&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;


&lt;p&gt;&lt;a href=&quot;https://github.com/ifesdjeen/cassandra-dtest/tree/12060-trunk&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;dtest branch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Also, adressing differences in the original issue:&lt;/p&gt;

&lt;p&gt;&lt;tt&gt;trunk&lt;/tt&gt;:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;Connected to Test Cluster at 127.0.0.1:9042.
[cqlsh 5.0.1 | Cassandra 3.10-SNAPSHOT | CQL spec 3.4.2 | Native protocol v4]
Use HELP &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; help.
cqlsh&amp;gt; CREATE KEYSPACE test WITH replication = {&lt;span class=&quot;code-quote&quot;&gt;&apos;class&apos;&lt;/span&gt;: &lt;span class=&quot;code-quote&quot;&gt;&apos;NetworkTopologyStrategy&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;datacenter1&apos;&lt;/span&gt;: &lt;span class=&quot;code-quote&quot;&gt;&apos;1&apos;&lt;/span&gt; };
cqlsh&amp;gt; USE test;
cqlsh:test&amp;gt; CREATE TABLE testtable (a &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;, b &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;, s1 &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt;, s2 &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt;, v &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;, PRIMARY KEY (a, b));
cqlsh:test&amp;gt; INSERT INTO testtable (a,b,s1,s2,v) VALUES (2,2,2,&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;,2);
cqlsh:test&amp;gt; DELETE s1 FROM testtable WHERE a = 2 IF s2 IN (10,20,30);

 [applied] | s2
-----------+------
     False | &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;is now same as on &lt;tt&gt;2.2&lt;/tt&gt;:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;Connected to Test Cluster at 127.0.0.1:9042.
[cqlsh 5.0.1 | Cassandra 2.2.7-SNAPSHOT | CQL spec 3.3.1 | Native protocol v4]
Use HELP &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; help.
cqlsh&amp;gt; CREATE KEYSPACE test WITH replication = {&lt;span class=&quot;code-quote&quot;&gt;&apos;class&apos;&lt;/span&gt;: &lt;span class=&quot;code-quote&quot;&gt;&apos;NetworkTopologyStrategy&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;datacenter1&apos;&lt;/span&gt;: &lt;span class=&quot;code-quote&quot;&gt;&apos;1&apos;&lt;/span&gt; };
cqlsh&amp;gt; USE test;
cqlsh:test&amp;gt; CREATE TABLE testtable (a &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;, b &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;, s1 &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt;, s2 &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt;, v &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;, PRIMARY KEY (a, b));
cqlsh:test&amp;gt; INSERT INTO testtable (a,b,s1,s2,v) VALUES (2,2,2,&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;,2);
cqlsh:test&amp;gt; DELETE s1 FROM testtable WHERE a = 2 IF s2 IN (10,20,30);

 [applied] | s2
-----------+------
     False | &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="15421399" author="jmckenzie" created="Mon, 15 Aug 2016 18:12:53 +0000"  >&lt;p&gt;Setting Sylvain to review though he&apos;s out for a few weeks still. If a) this is an immediate concern to get into a release, or b) someone else is familiar with this code and has the bandwidth for a review, please feel free to poach it.&lt;/p&gt;</comment>
                            <comment id="15490098" author="slebresne" created="Wed, 14 Sep 2016 10:41:30 +0000"  >&lt;p&gt;I&apos;ll have to apologize here because while reviewing this I&apos;m realizing that I&apos;ve been confused and have pushed for the wrong thing.&lt;/p&gt;

&lt;p&gt;My confusion had to do with the fact that CQL doesn&apos;t behave as I though it did. Let me explain. This ticket and &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-9842&quot; title=&quot;Inconsistent behavior for &amp;#39;= null&amp;#39; conditions on static columns&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-9842&quot;&gt;&lt;del&gt;CASSANDRA-9842&lt;/del&gt;&lt;/a&gt; are about what differences CAS queries with conditions on static columns make between existing and non-existing partitions. For that, my guideline was to make it consistent with how CAS queries with conditions on regular columns differenciate between existing and non-existing rows, and that where I was wrong.&lt;/p&gt;

&lt;p&gt;Let&apos;s consider the following example:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;CREATE TABLE test (k int, t int, v int, PRIMARY KEY (k, t));
SELECT v FROM test WHERE k = 0 AND t = 0;
&amp;gt;  v
&amp;gt; ------
&amp;gt;
&amp;gt; (0 rows)
INSERT INTO test(k, t) VALUES (0, 0);
SELECT v FROM test WHERE k = 0 AND t = 0;
&amp;gt;  v
&amp;gt; ------
&amp;gt;  null
&amp;gt;
&amp;gt; (1 rows)
UPDATE test SET v = 42 WHERE k = 0 AND t = 1 IF v = 1;  // Note we try updating another row
&amp;gt;  [applied]
&amp;gt; -----------
&amp;gt;      False
UPDATE test SET v = 42 WHERE k = 0 AND t = 0 IF v = 1; // The row we&apos;ve inserted before, but v is null
&amp;gt;  [applied] | v
&amp;gt; -----------+------
&amp;gt;      False | null
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Both in SELECT and in CAS queries result set, we make a difference between a row existing or not existing. For some reason, I though this difference somewhat carried on to whether a &lt;tt&gt;IF v = null&lt;/tt&gt; would apply (or any &lt;tt&gt;IF v != &amp;lt;something&amp;gt;&lt;/tt&gt; condition). I was sure that it was applied if the row existed but had no value for &lt;tt&gt;v&lt;/tt&gt; but did &lt;b&gt;not&lt;/b&gt; applied if the row didn&apos;t existed at all. In other words, what I &lt;em&gt;though&lt;/em&gt; we had was:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;UPDATE test SET v = 42 WHERE k = 0 AND t = 1 IF v = null; // Trying to updated a non existing row
&amp;gt;  [applied]
&amp;gt; -----------
&amp;gt;      False
UPDATE test SET v = 42 WHERE k = 0 AND t = 0 IF v = null; // The row exist and v is null
&amp;gt;  [applied]
&amp;gt; -----------
&amp;gt;       True
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;and I advocated we did the same for static columns and existing/non-existing partitions. But that&apos;s &lt;b&gt;not&lt;/b&gt; how it works and the first query above does apply. That is, even though we always make a difference in result sets between existing row (but with null value) and non-existing row, we don&apos;t make one when evaluating if a &lt;tt&gt;IF v = null&lt;/tt&gt; condition applies.&lt;/p&gt;

&lt;p&gt;So anyway, what semantic would be better in theory doesn&apos;t matter much. The way &lt;tt&gt;IF v = null&lt;/tt&gt; currently works for normal column is that it makes no difference between the row existing (and having no value for v) or not existing and it&apos;s probably too late to change that, so we should make that work consistently for static column and hence you should just have ignored me on this ticket since that&apos;s how it works in 3.0 after &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-9842&quot; title=&quot;Inconsistent behavior for &amp;#39;= null&amp;#39; conditions on static columns&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-9842&quot;&gt;&lt;del&gt;CASSANDRA-9842&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;With that all said, we still should do what this ticket initiall sets to do: we should make that existing versus not existing partition difference for static columns in CAS result sets because that&apos;s how it works for rows/normal columns and we should be consistent.&lt;/p&gt;

&lt;p&gt;Doing that last part requires most of the linked patch, though I have the following remarks on said patch:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;I&apos;m not sure I understand the reason for the change in &lt;tt&gt;CQL3CasRequest.columnsToRead()&lt;/tt&gt;. In particular, the comment talks about having to query a row, but that method is about which columns we bother fetching, not which row we query.&lt;/li&gt;
	&lt;li&gt;I&apos;m not fond of using &lt;tt&gt;null&lt;/tt&gt; for empty partitions since we can just test with &lt;tt&gt;isEmpty()&lt;/tt&gt; directly. Granted, the current code is confusing as &lt;tt&gt;appliesTo()&lt;/tt&gt; test for &lt;tt&gt;null&lt;/tt&gt; even though it&apos;s neither passed currently and that&apos;s really oversight from &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-8099&quot; title=&quot;Refactor and modernize the storage engine&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-8099&quot;&gt;&lt;del&gt;CASSANDRA-8099&lt;/del&gt;&lt;/a&gt;. I think we should stick to &lt;tt&gt;isEmpty()&lt;/tt&gt; but remove the useless code.&lt;/li&gt;
	&lt;li&gt;Regarding querying the first row of a partition when we only have static conditions, I think the code would be easier to follow if we separated static conditions in &lt;tt&gt;CQL3CasRequest&lt;/tt&gt;. In fact, once we do that, we can also use names queries for &quot;normal&quot; conditions (instead of doing slices of one row, the former being potentially more optimized), which is not all that related to this patch tbh, but is kind of an oversight of the code so we might as well fix it while we&apos;re at it.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Anyway, as I felt bad about the back and forth on this, I took the liberty to made the changes related to what&apos;s above:&lt;/p&gt;
&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;a href=&quot;https://github.com/pcmanus/cassandra/commits/12060-3.0-v2&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;12060-3.0-v2&lt;/a&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;a href=&quot;http://cassci.datastax.com/job/pcmanus-12060-3.0-v2-testall&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;utests&lt;/a&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;a href=&quot;http://cassci.datastax.com/job/pcmanus-12060-3.0-v2-dtest&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;dtests&lt;/a&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;a href=&quot;https://github.com/pcmanus/cassandra/commits/12060-trunk-v2&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;12060-trunk-v2&lt;/a&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;a href=&quot;http://cassci.datastax.com/job/pcmanus-12060-trunk-v2-testall&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;utests&lt;/a&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;a href=&quot;http://cassci.datastax.com/job/pcmanus-12060-trunk-v2-dtest&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;dtests&lt;/a&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;
</comment>
                            <comment id="15490342" author="ifesdjeen" created="Wed, 14 Sep 2016 12:41:15 +0000"  >&lt;p&gt;Thanks for reviewing the patch and for elaborate comment.&lt;/p&gt;

&lt;p&gt;I agree that having the behaviour consistent with the regular columns makes most sense. &lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;I&apos;m not sure I understand the reason for the change in CQL3CasRequest.columnsToRead() &lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;This was added to make sure that output in 3.x is same as in 2.x: &lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;assertRows(execute(&lt;span class=&quot;code-quote&quot;&gt;&quot;BEGIN BATCH &quot;&lt;/span&gt; +
                           &lt;span class=&quot;code-quote&quot;&gt;&quot;UPDATE %1$s SET v=&lt;span class=&quot;code-quote&quot;&gt;&apos;foobar&apos;&lt;/span&gt; WHERE id=0 AND k=&lt;span class=&quot;code-quote&quot;&gt;&apos;k1&apos;&lt;/span&gt;; &quot;&lt;/span&gt; +
                           &lt;span class=&quot;code-quote&quot;&gt;&quot;UPDATE %1$s SET v=&lt;span class=&quot;code-quote&quot;&gt;&apos;barfoo&apos;&lt;/span&gt; WHERE id=0 AND k=&lt;span class=&quot;code-quote&quot;&gt;&apos;k2&apos;&lt;/span&gt;; &quot;&lt;/span&gt; +
                           &lt;span class=&quot;code-quote&quot;&gt;&quot;UPDATE %1$s SET version=3 WHERE id=0 IF version=1; &quot;&lt;/span&gt; +
                           &lt;span class=&quot;code-quote&quot;&gt;&quot;APPLY BATCH &quot;&lt;/span&gt;),
                   row(&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;, 0, &lt;span class=&quot;code-quote&quot;&gt;&quot;k1&quot;&lt;/span&gt;, 2));
&lt;span class=&quot;code-comment&quot;&gt;// vs
&lt;/span&gt;&lt;span class=&quot;code-comment&quot;&gt;//                 row(&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;, 0, &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;, 2));&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;blockquote&gt;&lt;p&gt;I&apos;m not fond of using null for empty partitions since we can just test with isEmpty() directly.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Agree. This makes it much cleaner. &lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;I think the code would be easier to follow if we separated static conditions in CQL3CasRequest&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;True, it is much easier to follow now. Special-casing static clause was quite counter-intuitive.&lt;/p&gt;

&lt;p&gt;I&apos;ve ran the dtests locally and they&apos;re failing, but they&apos;re mostly cosmetic (condition is being applied correctly, just returned results differ a bit). Do we want to keep the resultset format for LWTs completely same as it was in 2.x?..&lt;/p&gt;

&lt;p&gt;I would also leave &lt;tt&gt;testConditionalUpdatesWithNonExistingValues&lt;/tt&gt; test to make sure we cover both behaviours, given we&apos;ve had quite a few iterations, so we could keep this behaviour well-documented.&lt;/p&gt;</comment>
                            <comment id="15490369" author="slebresne" created="Wed, 14 Sep 2016 12:55:40 +0000"  >&lt;blockquote&gt;&lt;p&gt;This was added to make sure that output in 3.x is same as in 2.x&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Slightly confused here. I did noticed that the output of that test differed between your branch and after having reverted the changes to &lt;tt&gt;columnsToRead()&lt;/tt&gt;, but it looks that it&apos;s our version that was inconsistent with 2.x. Namely, your branch returns &lt;tt&gt;row(false, 0, &quot;k1&quot;, 2)&lt;/tt&gt; but it seems both &lt;a href=&quot;https://github.com/apache/cassandra/blob/cassandra-2.1/test/unit/org/apache/cassandra/cql3/validation/operations/InsertUpdateIfConditionTest.java#L229&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;2.1&lt;/a&gt; and &lt;a href=&quot;https://github.com/apache/cassandra/blob/cassandra-2.2/test/unit/org/apache/cassandra/cql3/validation/operations/InsertUpdateIfConditionTest.java#L229&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;2.2&lt;/a&gt; returns &lt;tt&gt;row(false, 0, null, 2)&lt;/tt&gt; instead. Am I not looking at the right place/missing something?&lt;/p&gt;</comment>
                            <comment id="15490382" author="ifesdjeen" created="Wed, 14 Sep 2016 13:00:48 +0000"  >&lt;p&gt;Sorry, my wording was ambiguous. That was only required in my branch, so I was only trying to justify why I put it there. To give a bit more background: for 2.x version to work and distinguish between &quot;existing container and null value&quot; and &quot;non existing container&quot; we had to read out at least one row, which was leading to change in this output. To keep things consistent between versions, I made 3.x returns same. &lt;/p&gt;

&lt;p&gt;This is not required after the behaviour changes you&apos;ve introduced, so we&apos;re good.&lt;/p&gt;</comment>
                            <comment id="15493049" author="ifesdjeen" created="Thu, 15 Sep 2016 11:23:34 +0000"  >&lt;p&gt;I&apos;ve re-added the test for non-existing values and added a patch for 2.1 and 2.2 to match outputs on empty static columns (also, added static / regular column condition separation in similar way you&apos;ve done in 3.x patch): &lt;/p&gt;

&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/ifesdjeen/cassandra/tree/12060-2.1-v2&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;2.1 &lt;/a&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://cassci.datastax.com/view/Dev/view/ifesdjeen/job/ifesdjeen-12060-2.1-v2-testall/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;utest&lt;/a&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://cassci.datastax.com/view/Dev/view/ifesdjeen/job/ifesdjeen-12060-2.1-v2-dtest/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;dtest&lt;/a&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/ifesdjeen/cassandra/tree/12060-2.2-v2&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;2.2&lt;/a&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://cassci.datastax.com/view/Dev/view/ifesdjeen/job/ifesdjeen-12060-2.2-v2-testall/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;utest&lt;/a&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://cassci.datastax.com/view/Dev/view/ifesdjeen/job/ifesdjeen-12060-2.2-v2-dtest/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;dtest&lt;/a&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/ifesdjeen/cassandra/tree/12060-3.0-v2&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;3.0&lt;/a&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://cassci.datastax.com/view/Dev/view/ifesdjeen/job/ifesdjeen-12060-3.0-v2-testall/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;utest&lt;/a&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://cassci.datastax.com/view/Dev/view/ifesdjeen/job/ifesdjeen-12060-3.0-v2-dtest/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;dtest&lt;/a&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/ifesdjeen/cassandra/tree/12060-trunk-v2&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;trunk&lt;/a&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://cassci.datastax.com/view/Dev/view/ifesdjeen/job/ifesdjeen-12060-trunk-v2-testall/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;utest&lt;/a&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://cassci.datastax.com/view/Dev/view/ifesdjeen/job/ifesdjeen-12060-trunk-v2-dtest/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;dtest&lt;/a&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;&lt;a href=&quot;https://github.com/ifesdjeen/cassandra-dtest/tree/12060-trunk-v2&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;dtest patch&lt;/a&gt; &lt;/th&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;


&lt;p&gt;I&apos;ve ran tests only locally, CI pending.&lt;/p&gt;</comment>
                            <comment id="15493095" author="slebresne" created="Thu, 15 Sep 2016 11:51:20 +0000"  >&lt;p&gt;I really don&apos;t think we should modify anything in 2.1 and 2.2 here. And 3.x should behave as 2.x as much as possible, unless there is a good reason to think the 2.x behavior is broken and even then we should probably only consider fixing it in 3.x at this point.&lt;/p&gt;</comment>
                            <comment id="15493125" author="ifesdjeen" created="Thu, 15 Sep 2016 12:09:20 +0000"  >&lt;p&gt;In this case I think 3.x behaviour is correct: when using &lt;tt&gt;UPDATE ... IF&lt;/tt&gt;, it returns the &lt;tt&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;applied&amp;#93;&lt;/span&gt;&lt;/tt&gt; column and existing values that caused the transaction to fail, whereas 2.x returns just &lt;tt&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;applied&amp;#93;&lt;/span&gt;&lt;/tt&gt; with &lt;tt&gt;false&lt;/tt&gt;. &lt;/p&gt;

&lt;p&gt;We can leave the 2.x behaviour unchanged and introduce special-case in dtests or make a 2-line fix for 2.x like &lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; (Composite prefix : conditions.keySet())
{
    &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (prefix.isStatic() &amp;amp;&amp;amp; conditions.size() == 1)
        slices[i++] = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; ColumnSlice(Composites.EMPTY, Composites.EMPTY);
    &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt;
        slices[i++] = prefix.slice();
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="15496036" author="slebresne" created="Fri, 16 Sep 2016 11:08:57 +0000"  >&lt;blockquote&gt;&lt;p&gt;In this case I think 3.x behaviour is correct&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;You&apos;re right, I agree. But with that said, it&apos;s a pretty minor thing and the 2.x branches are in a critical bug fixes. We added the values for the conditions that failed to CAS result sets mainly to avoid having to do another round-trip to fetch the current value for those columns when you want to re-submit your CAS with an updated condition, so it&apos;s mainly an optimization in the first place. So I think the right thing to do here is to special-case the dtests. Do you want to  update your dtest patch or do you prefer me to have a shot at it?&lt;/p&gt;</comment>
                            <comment id="15496076" author="ifesdjeen" created="Fri, 16 Sep 2016 11:33:40 +0000"  >&lt;p&gt;True, that would not be a critical bugfix. &lt;br/&gt;
I&apos;ll update dtest shortly to special-case 2.x.&lt;/p&gt;</comment>
                            <comment id="15496610" author="ifesdjeen" created="Fri, 16 Sep 2016 15:42:40 +0000"  >&lt;p&gt;I&apos;ve updated tests to pass on current 2.1 and 2.2, rebased and re-triggered unit and dtests for 3.x and 3.0.x (CI pending).&lt;/p&gt;

&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/ifesdjeen/cassandra/tree/12060-3.0-v2&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;3.0&lt;/a&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://cassci.datastax.com/view/Dev/view/ifesdjeen/job/ifesdjeen-12060-3.0-v2-testall/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;utest&lt;/a&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://cassci.datastax.com/view/Dev/view/ifesdjeen/job/ifesdjeen-12060-3.0-v2-dtest/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;dtest&lt;/a&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/ifesdjeen/cassandra/tree/12060-trunk-v2&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;trunk&lt;/a&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://cassci.datastax.com/view/Dev/view/ifesdjeen/job/ifesdjeen-12060-trunk-v2-testall/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;utest&lt;/a&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://cassci.datastax.com/view/Dev/view/ifesdjeen/job/ifesdjeen-12060-trunk-v2-dtest/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;dtest&lt;/a&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://cassci.datastax.com/view/Dev/view/ifesdjeen/job/ifesdjeen-12060-2.1-nochanges-dtest/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;2.1 dtest&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://cassci.datastax.com/job/cassandra-2.2_dtest/688/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;2.2 dtest&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;&lt;a href=&quot;https://github.com/ifesdjeen/cassandra-dtest/tree/12060-trunk-v2&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;dtest patch&lt;/a&gt; &lt;/th&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;

</comment>
                            <comment id="15502704" author="slebresne" created="Mon, 19 Sep 2016 08:28:43 +0000"  >&lt;p&gt;Thanks, this sounds good to go but there seems to have been problems with the CI runs either not running or doing crazy things. Also, the branch as many commits adding stuffs that are later removed so I squashed the brand to make sure we didn&apos;t missed something (which we don&apos;t seem to have) and re-ran the tests below. Could you btw turn your dtest update into a pull request so it&apos;s easier to merge there?&lt;/p&gt;

&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;a href=&quot;https://github.com/pcmanus/cassandra/commits/12060-3.0-squashed&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;12060-3.0-squashed&lt;/a&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;a href=&quot;http://cassci.datastax.com/job/pcmanus-12060-3.0-squashed-testall&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;utests&lt;/a&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;a href=&quot;http://cassci.datastax.com/job/pcmanus-12060-3.0-squashed-dtest&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;dtests&lt;/a&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;a href=&quot;https://github.com/pcmanus/cassandra/commits/12060-trunk-squashed&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;12060-trunk-squashed&lt;/a&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;a href=&quot;http://cassci.datastax.com/job/pcmanus-12060-trunk-squashed-testall&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;utests&lt;/a&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;a href=&quot;http://cassci.datastax.com/job/pcmanus-12060-trunk-squashed-dtest&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;dtests&lt;/a&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;
</comment>
                            <comment id="15502822" author="ifesdjeen" created="Mon, 19 Sep 2016 09:18:57 +0000"  >&lt;p&gt;dtest failures were related to the fact that ccm now was returning LooseVersion, but my branch was not rebased.&lt;/p&gt;

&lt;p&gt;And dtest pull request: &lt;a href=&quot;https://github.com/riptano/cassandra-dtest/pull/1328&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;dtest PR&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15508953" author="ifesdjeen" created="Wed, 21 Sep 2016 06:42:42 +0000"  >&lt;p&gt;I&apos;ve rebuilt the dtests for 3.0 and trunk that were failing (they were launched from the &lt;tt&gt;master&lt;/tt&gt;, so I ran them from the patched branch). &lt;tt&gt;trunk&lt;/tt&gt; job had to be re-published:&lt;/p&gt;

&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/pcmanus/cassandra/tree/12060-3.0-squashed&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;3.0&lt;/a&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;http://cassci.datastax.com/job/pcmanus-12060-3.0-squashed-testall/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;utest&lt;/a&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;http://cassci.datastax.com/job/pcmanus-12060-3.0-squashed-dtest/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;dtest&lt;/a&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/pcmanus/cassandra/tree/12060-trunk-squashed&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;trunk&lt;/a&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;http://cassci.datastax.com/job/pcmanus-12060-trunk-squashed-testall/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;utest&lt;/a&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;http://cassci.datastax.com/job/ifesdjeen-12060-trunk-squashed-dtest/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;dtest&lt;/a&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://cassci.datastax.com/view/Dev/view/ifesdjeen/job/ifesdjeen-12060-2.1-nochanges-dtest/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;2.1 dtest&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://cassci.datastax.com/job/cassandra-2.2_dtest/688/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;2.2 dtest&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/riptano/cassandra-dtest/pull/1328&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;dtest&lt;/a&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;


&lt;p&gt;All tests look clean now, across all branches including &lt;tt&gt;2.x&lt;/tt&gt;.&lt;/p&gt;</comment>
                            <comment id="15510112" author="slebresne" created="Wed, 21 Sep 2016 14:29:56 +0000"  >&lt;p&gt;Thanks for re-running the test. Committed.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="13016744">CASSANDRA-12867</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[ifesdjeen]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 8 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2zwtz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>slebresne</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[slebresne]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12962"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>