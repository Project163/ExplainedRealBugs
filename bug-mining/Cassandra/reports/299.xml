<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 22:12:53 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-935] login() request via Thrift/PHP fails with &quot;Unexpected authentication problem&quot; in cassandra log / &quot;Internal error processing login&quot; in Thrift</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-935</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;When issuing a login request via PHP Thrift with the following parameters:&lt;/p&gt;

&lt;p&gt;$auth_request = new cassandra_AuthenticationRequest;&lt;br/&gt;
$auth_request-&amp;gt;credentials = array (&lt;br/&gt;
    &quot;username&quot; =&amp;gt; &quot;jsmith&quot;,&lt;br/&gt;
     &quot;password&quot; =&amp;gt; &quot;havebadpass&quot;,&lt;br/&gt;
);&lt;br/&gt;
$client-&amp;gt;login(&quot;Keyspace1&quot;, $auth_request);&lt;/p&gt;

&lt;p&gt;I get an exception, with the following details&lt;/p&gt;

&lt;p&gt;PHP Exception:&lt;br/&gt;
PHP Fatal error:  Uncaught exception &apos;TApplicationException&apos; with message &apos;Internal error processing login&apos; in /home/redsolar/html/includes/thrift/packages/cassandra/Cassandra.php:73&lt;/p&gt;

&lt;p&gt;Cassandra log:&lt;/p&gt;

&lt;p&gt;ERROR 13:00:53,823 Internal error processing login&lt;br/&gt;
java.lang.RuntimeException: Unexpected authentication problem&lt;br/&gt;
        at org.apache.cassandra.auth.SimpleAuthenticator.login(SimpleAuthenticator.java:113)&lt;br/&gt;
        at org.apache.cassandra.thrift.CassandraServer.login(CassandraServer.java:651)&lt;br/&gt;
        at org.apache.cassandra.thrift.Cassandra$Processor$login.process(Cassandra.java:1147)&lt;br/&gt;
        at org.apache.cassandra.thrift.Cassandra$Processor.process(Cassandra.java:1125)&lt;br/&gt;
        at org.apache.thrift.server.TThreadPoolServer$WorkerProcess.run(TThreadPoolServer.java:253)&lt;br/&gt;
        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1110)&lt;br/&gt;
        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:603)&lt;br/&gt;
        at java.lang.Thread.run(Thread.java:636)&lt;br/&gt;
Caused by: java.lang.NullPointerException&lt;br/&gt;
        at java.io.FileInputStream.&amp;lt;init&amp;gt;(FileInputStream.java:133)&lt;br/&gt;
        at java.io.FileInputStream.&amp;lt;init&amp;gt;(FileInputStream.java:96)&lt;br/&gt;
        at org.apache.cassandra.auth.SimpleAuthenticator.login(SimpleAuthenticator.java:82)&lt;br/&gt;
        ... 7 more&lt;/p&gt;

&lt;p&gt;File contents (all chmod 777 for testing):&lt;/p&gt;

&lt;p&gt;&quot;conf/access.properties&quot;&lt;br/&gt;
Keyspace1=jsmith,Elvis Presley,dilbert&lt;/p&gt;

&lt;p&gt;&quot;conf/password.properties&quot;&lt;br/&gt;
jsmith=havebadpass&lt;br/&gt;
Elvis\ Presley=graceland4evar&lt;br/&gt;
dilbert=nomoovertime&lt;/p&gt;</description>
                <environment>&lt;p&gt;PHP 5.3, Cassandra 0.6.0-rc1 (as in current vote), CentOS 5.4 x64, 4-node cluster&lt;/p&gt;</environment>
        <key id="12460737">CASSANDRA-935</key>
            <summary>login() request via Thrift/PHP fails with &quot;Unexpected authentication problem&quot; in cassandra log / &quot;Internal error processing login&quot; in Thrift</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10003" iconUrl="https://issues.apache.org/jira/images/icons/priorities/trivial.svg">Low</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="rschildmeijer">Roger Schildmeijer</assignee>
                                    <reporter username="redsolar">Vitaly Pecharsky</reporter>
                        <labels>
                    </labels>
                <created>Tue, 30 Mar 2010 20:22:13 +0000</created>
                <updated>Tue, 16 Apr 2019 09:33:26 +0000</updated>
                            <resolved>Sat, 3 Apr 2010 21:59:33 +0000</resolved>
                                        <fixVersion>0.7 beta 1</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="12851565" author="jbellis" created="Tue, 30 Mar 2010 20:24:22 +0000"  >&lt;p&gt;are you setting -DPASSWD_FILENAME_PROPERTY=path/to/access.properties ?  because that is what SimpleAuthenticator looks for.  (it should probably just try to load from classpath, that seems more java-ish.)&lt;/p&gt;</comment>
                            <comment id="12851571" author="rschildmeijer" created="Tue, 30 Mar 2010 20:29:49 +0000"  >&lt;p&gt;In fact the property keys are called passwd.properties and access.properties. &lt;br/&gt;
    -Dpasswd.properties=&amp;lt;PATH&amp;gt;/passwd.properties&lt;br/&gt;
    -Daccess.properties=&amp;lt;PATH&amp;gt;access.properties&lt;/p&gt;

&lt;p&gt;(The PASSWD_FILENAME_PROPERTY is just the name of the static constant)&lt;/p&gt;
</comment>
                            <comment id="12851574" author="redsolar" created="Tue, 30 Mar 2010 20:39:34 +0000"  >&lt;p&gt;Running cassandra with &quot;bin/cassandra -f -Dpasswd.properties=conf/passwd.properties -Daccess.properties=conf/access.properties&quot; solved the issue&lt;/p&gt;</comment>
                            <comment id="12851580" author="rschildmeijer" created="Tue, 30 Mar 2010 20:51:21 +0000"  >&lt;p&gt;We should probably add a check that everything was properly defined and &quot;bail out&quot; otherwise&lt;/p&gt;</comment>
                            <comment id="12851583" author="rschildmeijer" created="Tue, 30 Mar 2010 20:52:45 +0000"  >&lt;p&gt;Verifies that access.properties and passwd.properties are defined if SimpleAuthenticator is used (in storage-conf.xml)&lt;/p&gt;</comment>
                            <comment id="12851880" author="urandom" created="Wed, 31 Mar 2010 14:30:26 +0000"  >&lt;p&gt;I think I&apos;m -1 on this patch Roger. Those authenticators are pluggable, I&apos;d rather that we didn&apos;t have implementation details leaking out of them.&lt;/p&gt;</comment>
                            <comment id="12851888" author="rschildmeijer" created="Wed, 31 Mar 2010 14:49:15 +0000"  >&lt;p&gt;I agree. &lt;/p&gt;

&lt;p&gt;I was considering a solution that augmented the IAuthenticator interface with methods like isAuthenticationRequired(), getAccessFileName(), getPasswordFileName, but that felt like polluting the interface with implementation specific details.&lt;/p&gt;

&lt;p&gt;What speaks for the submitted solution (atleast to some extent) is that we are handling faulty configuration more correctly when using the built in/shipped authentication (SimpleAuthenticator).   &lt;/p&gt;</comment>
                            <comment id="12851892" author="urandom" created="Wed, 31 Mar 2010 14:57:15 +0000"  >&lt;p&gt;I think the correct solution is just to make SimpleAuthenticator produce a clearer error message when it&apos;s been misconfigured.&lt;/p&gt;</comment>
                            <comment id="12851895" author="jbellis" created="Wed, 31 Mar 2010 15:08:28 +0000"  >&lt;p&gt;Could we add a validateConfiguration method to IAuthenticator?&lt;/p&gt;</comment>
                            <comment id="12851908" author="urandom" created="Wed, 31 Mar 2010 15:28:26 +0000"  >&lt;p&gt;works for me.&lt;/p&gt;</comment>
                            <comment id="12852049" author="tzz" created="Wed, 31 Mar 2010 18:56:07 +0000"  >&lt;p&gt;What should validateConfiguration() do that login() should not do as well?&lt;/p&gt;

&lt;p&gt;I&apos;d rather add the necessary checks to login().  The performance penalty is negligible.  See attached patch.&lt;/p&gt;</comment>
                            <comment id="12852054" author="jbellis" created="Wed, 31 Mar 2010 19:01:43 +0000"  >&lt;p&gt;&amp;gt; What should validateConfiguration() do that login() should not do as well? &lt;/p&gt;

&lt;p&gt;fail the startup rather than breaking things when you try to query, which as we&apos;ve seen here is the wrong approach.&lt;/p&gt;</comment>
                            <comment id="12852059" author="tzz" created="Wed, 31 Mar 2010 19:13:38 +0000"  >&lt;p&gt;How about checking in the constructor?  Attaching patch to do it this way.&lt;/p&gt;</comment>
                            <comment id="12852078" author="rschildmeijer" created="Wed, 31 Mar 2010 20:08:53 +0000"  >&lt;p&gt;I totaly agree that we should do the validation as early as possible (prefer startup check instead of &quot;on query check&quot;).&lt;br/&gt;
I think the IAuthenticator API is easier to get a correct implementation for using the two method version (see &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-935&quot; title=&quot;login() request via Thrift/PHP fails with &amp;quot;Unexpected authentication problem&amp;quot; in cassandra log / &amp;quot;Internal error processing login&amp;quot; in Thrift&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-935&quot;&gt;&lt;del&gt;CASSANDRA-935&lt;/del&gt;&lt;/a&gt;-v2.patch) instead of relying on that implementors throws an exception in the ctor.&lt;/p&gt;</comment>
                            <comment id="12852083" author="tzz" created="Wed, 31 Mar 2010 20:25:39 +0000"  >&lt;p&gt;Either validateConfiguration() or in the constructor works.  Assuming your patch goes in, I would distinguish between the two kinds of configuration exception for the two possible missing items or show the actual values in the exception message, e.g.&lt;/p&gt;

&lt;p&gt;String.format(&quot;When using %s, properties %s (currently %s) and %s (currently %s) must be defined, ...)&lt;/p&gt;</comment>
                            <comment id="12852974" author="urandom" created="Fri, 2 Apr 2010 22:22:45 +0000"  >&lt;p&gt;I think I prefer the validateConfiguration() approach.&lt;/p&gt;

&lt;p&gt;Roger, can you use o.a.c.config.DatabaseDescriptor.ConfigurationException instead of javax.naming.ConfigurationException? I&apos;m also having some trouble applying your patch to trunk/ (maybe it just needs to be rebased).&lt;/p&gt;</comment>
                            <comment id="12853088" author="rschildmeijer" created="Sat, 3 Apr 2010 07:04:45 +0000"  >&lt;p&gt;Patch rebased (v3)&lt;/p&gt;</comment>
                            <comment id="12853204" author="urandom" created="Sat, 3 Apr 2010 21:59:33 +0000"  >&lt;p&gt;committed; thanks Roger!&lt;/p&gt;</comment>
                            <comment id="12853921" author="hudson" created="Tue, 6 Apr 2010 13:10:16 +0000"  >&lt;p&gt;Integrated in Cassandra #399 (See &lt;a href=&quot;http://hudson.zones.apache.org/hudson/job/Cassandra/399/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://hudson.zones.apache.org/hudson/job/Cassandra/399/&lt;/a&gt;)&lt;/p&gt;
</comment>
                    </comments>
                    <attachments>
                            <attachment id="12440379" name="CASSANDRA-935-check-properties.patch" size="1930" author="tzz" created="Wed, 31 Mar 2010 19:13:38 +0000"/>
                            <attachment id="12440378" name="CASSANDRA-935-check-properties.patch" size="1049" author="tzz" created="Wed, 31 Mar 2010 18:56:28 +0000"/>
                            <attachment id="12440370" name="CASSANDRA-935-v2.patch" size="3657" author="rschildmeijer" created="Wed, 31 Mar 2010 18:07:09 +0000"/>
                            <attachment id="12440672" name="CASSANDRA-935-v3.patch" size="3908" author="rschildmeijer" created="Sat, 3 Apr 2010 07:04:45 +0000"/>
                            <attachment id="12440275" name="CASSANDRA-935.patch" size="1727" author="rschildmeijer" created="Tue, 30 Mar 2010 20:52:45 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>5.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[rschildmeijer]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>19925</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            15 years, 34 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0g1zj:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>91752</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12961"><![CDATA[Low]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>