<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 22:36:11 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-4813] Problem using BulkOutputFormat while streaming several SSTables simultaneously from a given node.</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-4813</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;The issue occurs when streaming simultaneously SSTables from the same node to a cassandra cluster using SSTableloader. It seems to me that Cassandra cannot handle receiving simultaneously SSTables from the same node. However, when it receives simultaneously SSTables from two different nodes, everything works fine. As a consequence, when using BulkOutputFormat to generate SSTables and stream them to a cassandra cluster, I cannot use more than one reducer per node otherwise I get a java.io.EOFException in the tasktracker&apos;s logs and a java.io.IOException: Broken pipe in the Cassandra logs.&lt;/p&gt;</description>
                <environment>&lt;p&gt;I am using SLES 10 SP3, Java 6, 4 Cassandra + Hadoop nodes, 3 Hadoop only nodes (datanodes/tasktrackers), 1 namenode/jobtracker. The machines used are Six-Core AMD Opteron(tm) Processor 8431, 24 cores and 33 GB of RAM. I get the issue on both cassandra 1.1.3, 1.1.5 and I am using Hadoop 0.20.2.&lt;/p&gt;</environment>
        <key id="12611994">CASSANDRA-4813</key>
            <summary>Problem using BulkOutputFormat while streaming several SSTables simultaneously from a given node.</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10003" iconUrl="https://issues.apache.org/jira/images/icons/priorities/trivial.svg">Low</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="yukim">Yuki Morishita</assignee>
                                    <reporter username="ralph.romanos">Ralph Romanos</reporter>
                        <labels>
                            <label>Bulkoutputformat</label>
                            <label>Hadoop</label>
                            <label>SSTables</label>
                    </labels>
                <created>Tue, 16 Oct 2012 08:58:50 +0000</created>
                <updated>Tue, 16 Apr 2019 09:32:25 +0000</updated>
                            <resolved>Tue, 13 Nov 2012 22:39:07 +0000</resolved>
                                        <fixVersion>1.2.0 beta 3</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="13477398" author="brandon.williams" created="Tue, 16 Oct 2012 22:09:04 +0000"  >&lt;p&gt;Can you post a stacktrace?&lt;/p&gt;</comment>
                            <comment id="13477678" author="ralph.romanos" created="Wed, 17 Oct 2012 06:58:31 +0000"  >&lt;p&gt;I get the following error in the tasktracker&apos;s logs when SSTables &lt;br/&gt;
are streamed into the Cassandra cluster:&lt;/p&gt;

&lt;p&gt;Exception in thread &quot;Streaming to /172.16.110.79:1&quot; java.lang.RuntimeException: java.io.EOFException&lt;br/&gt;
	at org.apache.cassandra.utils.FBUtilities.unchecked(FBUtilities.java:628)&lt;br/&gt;
	at org.apache.cassandra.utils.WrappedRunnable.run(WrappedRunnable.java:34)&lt;br/&gt;
	at java.util.concurrent.ThreadPoolExecutor$Worker.runTask(Unknown Source)&lt;br/&gt;
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(Unknown Source)&lt;br/&gt;
	at java.lang.Thread.run(Unknown Source)&lt;br/&gt;
Caused by: java.io.EOFException&lt;br/&gt;
	at java.io.DataInputStream.readInt(Unknown Source)&lt;br/&gt;
	at org.apache.cassandra.streaming.FileStreamTask.receiveReply(FileStreamTask.java:194)&lt;br/&gt;
	at org.apache.cassandra.streaming.FileStreamTask.stream(FileStreamTask.java:181)&lt;br/&gt;
	at org.apache.cassandra.streaming.FileStreamTask.runMayThrow(FileStreamTask.java:94)&lt;br/&gt;
	at org.apache.cassandra.utils.WrappedRunnable.run(WrappedRunnable.java:30)&lt;br/&gt;
	... 3 more&lt;br/&gt;
Exception in thread &quot;Streaming to /172.16.110.92:1&quot; java.lang.RuntimeException: java.io.EOFException&lt;br/&gt;
	at org.apache.cassandra.utils.FBUtilities.unchecked(FBUtilities.java:628)&lt;br/&gt;
	at org.apache.cassandra.utils.WrappedRunnable.run(WrappedRunnable.java:34)&lt;br/&gt;
	at java.util.concurrent.ThreadPoolExecutor$Worker.runTask(Unknown Source)&lt;br/&gt;
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(Unknown Source)&lt;br/&gt;
	at java.lang.Thread.run(Unknown Source)&lt;br/&gt;
Caused by: java.io.EOFException&lt;br/&gt;
	at java.io.DataInputStream.readInt(Unknown Source)&lt;br/&gt;
	at org.apache.cassandra.streaming.FileStreamTask.receiveReply(FileStreamTask.java:194)&lt;br/&gt;
	at org.apache.cassandra.streaming.FileStreamTask.stream(FileStreamTask.java:181)&lt;br/&gt;
	at org.apache.cassandra.streaming.FileStreamTask.runMayThrow(FileStreamTask.java:94)&lt;br/&gt;
	at org.apache.cassandra.utils.WrappedRunnable.run(WrappedRunnable.java:30)&lt;br/&gt;
	... 3 more&lt;/p&gt;</comment>
                            <comment id="13478302" author="mkjellman" created="Wed, 17 Oct 2012 19:47:51 +0000"  >&lt;p&gt;Same issue with 1.1.6 and Hadoop 1.0.3&lt;/p&gt;

&lt;p&gt;I have the following from the Cassandra logs as well&lt;/p&gt;

&lt;p&gt;ERROR 12:46:06,256 Exception in thread Thread&lt;span class=&quot;error&quot;&gt;&amp;#91;Thread-1224,5,main&amp;#93;&lt;/span&gt;&lt;br/&gt;
java.lang.AssertionError: We shouldn&apos;t fail acquiring a reference on a sstable that has just been transferred&lt;br/&gt;
	at org.apache.cassandra.streaming.StreamInSession.closeIfFinished(StreamInSession.java:188)&lt;br/&gt;
	at org.apache.cassandra.streaming.IncomingStreamReader.read(IncomingStreamReader.java:103)&lt;br/&gt;
	at org.apache.cassandra.net.IncomingTcpConnection.stream(IncomingTcpConnection.java:182)&lt;br/&gt;
	at org.apache.cassandra.net.IncomingTcpConnection.run(IncomingTcpConnection.java:78)&lt;/p&gt;</comment>
                            <comment id="13478352" author="mkjellman" created="Wed, 17 Oct 2012 20:42:51 +0000"  >&lt;p&gt;Just confirmed that limiting the reducer to 1 does not change the behavior in my environment. Also noticed that BulkRecordWriter will always throw an IOException (as mentioned in the original bug) if mapreduce.output.bulkoutputformat.maxfailedhosts is ever &amp;gt; 0 (assuming defaults).&lt;/p&gt;

&lt;p&gt;In my case future.getFailedHosts() always returns every node in my cluster when the condition occurs. I&apos;m doing about 50 million insertions into 50 million rows and the EOFExceptions seem to crop up after a good number of the sstables have already been successfully sent.&lt;/p&gt;</comment>
                            <comment id="13478362" author="ralph.romanos" created="Wed, 17 Oct 2012 20:50:38 +0000"  >&lt;p&gt;Do you stream the SSTables in your reducer? And when you tried to limit the reducer to 1, did you restart the cassandra cluster?&lt;/p&gt;</comment>
                            <comment id="13478368" author="mkjellman" created="Wed, 17 Oct 2012 20:57:01 +0000"  >&lt;p&gt;Yes, in my reducer. Didn&apos;t restart the Cassandra cluster &amp;#8211; what would that accomplish? Limited the reducer in my job configuration.&lt;/p&gt;</comment>
                            <comment id="13478380" author="ralph.romanos" created="Wed, 17 Oct 2012 21:06:48 +0000"  >&lt;p&gt;I had the same error (IOException) when I did not restart Cassandra. It is caused by the EOFException and because the streaming failed in your previous job. Restarting Cassandra should allow you to make it work with 1 reducer.&lt;/p&gt;</comment>
                            <comment id="13478536" author="mkjellman" created="Thu, 18 Oct 2012 00:45:48 +0000"  >&lt;p&gt;you&apos;re quite right. no issues after a rolling restart and only one reducer.&lt;/p&gt;</comment>
                            <comment id="13480351" author="mkjellman" created="Fri, 19 Oct 2012 20:21:02 +0000"  >&lt;p&gt;just reproduced this again with one reducer.&lt;/p&gt;</comment>
                            <comment id="13481658" author="yukim" created="Mon, 22 Oct 2012 19:08:49 +0000"  >&lt;p&gt;This is limitation of BulkOutputFormat right now. Currently, streaming session uses (IP, counter) for its ID. Since counter is per JVM, running two or more reducers on same node streaming to one cassandra node likely cause session conflict, and I think that is causing the issue here.&lt;br/&gt;
To resolve this, we need to change the way to distinguish each session(possibly by changing to use UUID for session ID).&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mkjellman&quot; class=&quot;user-hover&quot; rel=&quot;mkjellman&quot;&gt;mkjellman&lt;/a&gt; Do you run your reducer on top of cassandra node? If that is the case, session conflict I described above may be the cause. If not, there is another issue in your one reducer case I think.&lt;/p&gt;</comment>
                            <comment id="13481673" author="mkjellman" created="Mon, 22 Oct 2012 19:15:23 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=nakagawayk&quot; class=&quot;user-hover&quot; rel=&quot;nakagawayk&quot;&gt;nakagawayk&lt;/a&gt; Yes - the single reducer was running on top of a Cassandra node. Why would having the reducer+the cassandra node cause a session ID collision if there is only one reducer?&lt;/p&gt;</comment>
                            <comment id="13482174" author="ralph.romanos" created="Tue, 23 Oct 2012 07:35:55 +0000"  >&lt;p&gt;I never get this exception when I run my reducer on a single node (either on top of a cassandra node or on a Hadoop only node). In addition, when I run multiple reducers, I create a java process for each reducer; therefore my reducers should be running on different JVMs right? If that is the case we shouldn&apos;t get counter conflicts when running multiple reducers.&lt;/p&gt;</comment>
                            <comment id="13482389" author="yukim" created="Tue, 23 Oct 2012 15:07:09 +0000"  >&lt;p&gt;Session counter is per JVM, so when you spawn two or more stream session on different JVM on same host, you will have chance to get same session ID, say (10.x.x.x, 1) on both JVM.&lt;br/&gt;
This is also true with Cassandra on one JVM and reducer on the other JVM on the same machine(but session collision in this set up is less likely than two reducers spawned simultaneously on the same node).&lt;/p&gt;</comment>
                            <comment id="13482652" author="jbellis" created="Tue, 23 Oct 2012 20:29:12 +0000"  >&lt;p&gt;If we need to change streaming protocol to fix this then we should target 1.2.&lt;/p&gt;</comment>
                            <comment id="13487180" author="yukim" created="Tue, 30 Oct 2012 20:14:03 +0000"  >&lt;p&gt;Attaching patch to change streaming session ID from (host, counter) pair to Time UUID. This should hugely drop probability of session ID collision. I haven&apos;t tested with BOF, but I spawned 3 sstableloader simultaneously on the same node with C* and could finish streaming without getting errors.&lt;/p&gt;</comment>
                            <comment id="13487867" author="mkjellman" created="Wed, 31 Oct 2012 15:38:20 +0000"  >&lt;p&gt;Yuki- Thanks for your work on the patch. I&apos;ll test BOF with 1.1.6 today.&lt;/p&gt;</comment>
                            <comment id="13487869" author="yukim" created="Wed, 31 Oct 2012 15:41:45 +0000"  >&lt;p&gt;Michael,&lt;/p&gt;

&lt;p&gt;Patch is for trunk(version 1.2). The change breaks messaging compatibility in 1.1, so this won&apos;t be ported for next 1.1.7 release.&lt;/p&gt;</comment>
                            <comment id="13487876" author="mkjellman" created="Wed, 31 Oct 2012 15:45:18 +0000"  >&lt;p&gt;Good to know - I&apos;ll get a 1.2 cluster setup on trunk then and test.&lt;/p&gt;</comment>
                            <comment id="13487901" author="ralph.romanos" created="Wed, 31 Oct 2012 16:12:35 +0000"  >&lt;p&gt;Me too, I will let u know as soon as I test it. Thank you for this quick patch Yuki.&lt;/p&gt;</comment>
                            <comment id="13488239" author="yukim" created="Wed, 31 Oct 2012 21:16:52 +0000"  >&lt;p&gt;Attaching newer version. Since with this patch, we only distinguish streaming session by UUID, we don&apos;t need to carry around broadcast address(&lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-3503&quot; title=&quot;IncomingStreamReader uses socket.getRemoteSocketAddress() which might be diffrent than FB.getBroadcastAddress()&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-3503&quot;&gt;&lt;del&gt;CASSANDRA-3503&lt;/del&gt;&lt;/a&gt;), so I removed it from StreamHeader.&lt;/p&gt;</comment>
                            <comment id="13488774" author="mkjellman" created="Thu, 1 Nov 2012 15:42:50 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=yukim&quot; class=&quot;user-hover&quot; rel=&quot;yukim&quot;&gt;yukim&lt;/a&gt; not sure if this will be an issue for &quot;normal&quot; upgraders or if this was because i went between patch versions but just wanted you to be aware of the EOF i saw on startup. Node only has the system schema at this point.&lt;/p&gt;

&lt;p&gt;WARN 08:40:29,821 error reading saved cache /ssd/saved_caches/system-local-KeyCache-b.db&lt;br/&gt;
java.io.EOFException&lt;br/&gt;
	at java.io.DataInputStream.readInt(DataInputStream.java:392)&lt;br/&gt;
	at org.apache.cassandra.utils.ByteBufferUtil.readWithLength(ByteBufferUtil.java:349)&lt;br/&gt;
	at org.apache.cassandra.service.CacheService$KeyCacheSerializer.deserialize(CacheService.java:378)&lt;br/&gt;
	at org.apache.cassandra.cache.AutoSavingCache.loadSaved(AutoSavingCache.java:144)&lt;br/&gt;
	at org.apache.cassandra.db.ColumnFamilyStore.&amp;lt;init&amp;gt;(ColumnFamilyStore.java:278)&lt;br/&gt;
	at org.apache.cassandra.db.ColumnFamilyStore.createColumnFamilyStore(ColumnFamilyStore.java:393)&lt;br/&gt;
	at org.apache.cassandra.db.ColumnFamilyStore.createColumnFamilyStore(ColumnFamilyStore.java:365)&lt;br/&gt;
	at org.apache.cassandra.db.Table.initCf(Table.java:334)&lt;br/&gt;
	at org.apache.cassandra.db.Table.&amp;lt;init&amp;gt;(Table.java:272)&lt;br/&gt;
	at org.apache.cassandra.db.Table.open(Table.java:102)&lt;br/&gt;
	at org.apache.cassandra.db.Table.open(Table.java:80)&lt;br/&gt;
	at org.apache.cassandra.db.SystemTable.checkHealth(SystemTable.java:320)&lt;br/&gt;
	at org.apache.cassandra.service.CassandraDaemon.setup(CassandraDaemon.java:203)&lt;br/&gt;
	at org.apache.cassandra.service.CassandraDaemon.activate(CassandraDaemon.java:395)&lt;br/&gt;
	at org.apache.cassandra.service.CassandraDaemon.main(CassandraDaemon.java:438)&lt;/p&gt;

&lt;p&gt;Edit: actually thinking this is a totally unrelated bug?&lt;/p&gt;</comment>
                            <comment id="13489106" author="yukim" created="Thu, 1 Nov 2012 22:59:25 +0000"  >&lt;p&gt;Michael,&lt;/p&gt;

&lt;p&gt;I think it is not related to this issue.&lt;br/&gt;
Do you upgrade from which version? &apos;-b&apos; in system-local-KeyCache-b.db indicates it&apos;s from version 1.2.&lt;br/&gt;
Also, it possible that the saved cache file is really corrupted for some reason(shutting down in the middle of cache saving?), so C* was just WARNing you about it.&lt;/p&gt;</comment>
                            <comment id="13489127" author="mkjellman" created="Thu, 1 Nov 2012 23:15:52 +0000"  >&lt;p&gt;Brand new cluster running 1.2 with your original patch, nodetool drain, put new jar with new patch in place, started Cassandra and got error. had to delete the cache file as subsequent initializations threw the EOF as well. Happened on all three nodes in the 3 node test cluster.&lt;/p&gt;</comment>
                            <comment id="13490728" author="yukim" created="Mon, 5 Nov 2012 16:48:34 +0000"  >&lt;p&gt;Michael,&lt;/p&gt;

&lt;p&gt;I couldn&apos;t reproduce your error, and I believe that is not related to this issue.&lt;br/&gt;
So if you see that error constantly, please open another issue.&lt;/p&gt;</comment>
                            <comment id="13490732" author="mkjellman" created="Mon, 5 Nov 2012 16:53:00 +0000"  >&lt;p&gt;Sounds good Yuki. I&apos;ve been trying to get a secondary cluster setup since the 31st..keep getting pulled away. I promise i&apos;ll get multiple reducers tested today &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="13491032" author="mkjellman" created="Mon, 5 Nov 2012 23:19:40 +0000"  >&lt;p&gt;Exception in thread &quot;Streaming to /10.25.9.5:1&quot; java.lang.RuntimeException: java.net.SocketException: Already bound&lt;br/&gt;
        at com.google.common.base.Throwables.propagate(Throwables.java:156)&lt;br/&gt;
        at org.apache.cassandra.utils.WrappedRunnable.run(WrappedRunnable.java:32)&lt;br/&gt;
        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1110)&lt;br/&gt;
        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:603)&lt;br/&gt;
        at java.lang.Thread.run(Thread.java:722)&lt;br/&gt;
Caused by: java.net.SocketException: Already bound&lt;br/&gt;
        at sun.nio.ch.Net.translateToSocketException(Net.java:109)&lt;br/&gt;
        at sun.nio.ch.Net.translateException(Net.java:141)&lt;br/&gt;
        at sun.nio.ch.Net.translateException(Net.java:147)&lt;br/&gt;
        at sun.nio.ch.SocketAdaptor.bind(SocketAdaptor.java:147)&lt;br/&gt;
        at org.apache.cassandra.net.OutboundTcpConnectionPool.newSocket(OutboundTcpConnectionPool.java:128)&lt;br/&gt;
        at org.apache.cassandra.streaming.FileStreamTask.connectAttempt(FileStreamTask.java:236)&lt;br/&gt;
        at org.apache.cassandra.streaming.FileStreamTask.runMayThrow(FileStreamTask.java:88)&lt;br/&gt;
        at org.apache.cassandra.utils.WrappedRunnable.run(WrappedRunnable.java:28)&lt;br/&gt;
        ... 3 more&lt;br/&gt;
Caused by: java.nio.channels.AlreadyBoundException&lt;br/&gt;
        at sun.nio.ch.SocketChannelImpl.bind(SocketChannelImpl.java:556)&lt;br/&gt;
        at sun.nio.ch.SocketAdaptor.bind(SocketAdaptor.java:145)&lt;br/&gt;
        ... 7 more&lt;/p&gt;

&lt;p&gt;is it intended that we fail that reducer? this looks like just a more elegant collision, no? seeing the same failure on every node.&lt;/p&gt;
</comment>
                            <comment id="13491678" author="mkjellman" created="Tue, 6 Nov 2012 18:26:01 +0000"  >&lt;p&gt;Also, while we don&apos;t throw the EOF anymore further down the stack as far as I can tell from my testing, the net result is an IOException being thrown in the Reducer.&lt;/p&gt;</comment>
                            <comment id="13493534" author="yukim" created="Thu, 8 Nov 2012 21:55:22 +0000"  >&lt;p&gt;ok, it looks like we have &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-3839&quot; title=&quot;BulkOutputFormat binds to wrong client address when client is Dual-stack and server is IPv6&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-3839&quot;&gt;&lt;del&gt;CASSANDRA-3839&lt;/del&gt;&lt;/a&gt; for BOF.&lt;br/&gt;
Updated patch to avoid socket re-binding.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mkjellman&quot; class=&quot;user-hover&quot; rel=&quot;mkjellman&quot;&gt;mkjellman&lt;/a&gt; How about this one?&lt;/p&gt;</comment>
                            <comment id="13493597" author="mkjellman" created="Thu, 8 Nov 2012 23:13:31 +0000"  >&lt;p&gt;new problem now with current patch.&lt;/p&gt;

&lt;p&gt;2012-11-08 15:29:05,323 ERROR org.apache.cassandra.concurrent.DebuggableThreadPoolExecutor: Error in ThreadPoolExecutor&lt;br/&gt;
java.lang.RuntimeException: java.io.IOException: Broken pipe&lt;br/&gt;
        at com.google.common.base.Throwables.propagate(Throwables.java:156)&lt;br/&gt;
        at org.apache.cassandra.utils.WrappedRunnable.run(WrappedRunnable.java:32)&lt;br/&gt;
        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1110)&lt;br/&gt;
        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:603)&lt;br/&gt;
        at java.lang.Thread.run(Thread.java:722)&lt;br/&gt;
Caused by: java.io.IOException: Broken pipe&lt;br/&gt;
        at sun.nio.ch.FileDispatcherImpl.write0(Native Method)&lt;br/&gt;
        at sun.nio.ch.SocketDispatcher.write(SocketDispatcher.java:47)&lt;br/&gt;
        at sun.nio.ch.IOUtil.writeFromNativeBuffer(IOUtil.java:89)&lt;br/&gt;
        at sun.nio.ch.IOUtil.write(IOUtil.java:60)&lt;br/&gt;
        at sun.nio.ch.SocketChannelImpl.write(SocketChannelImpl.java:450)&lt;br/&gt;
        at java.nio.channels.Channels.writeFullyImpl(Channels.java:78)&lt;br/&gt;
        at java.nio.channels.Channels.writeFully(Channels.java:98)&lt;br/&gt;
        at java.nio.channels.Channels.access$000(Channels.java:61)&lt;br/&gt;
        at java.nio.channels.Channels$1.write(Channels.java:174)&lt;br/&gt;
        at com.ning.compress.lzf.LZFChunk.writeCompressedHeader(LZFChunk.java:77)&lt;br/&gt;
        at com.ning.compress.lzf.ChunkEncoder.encodeAndWriteChunk(ChunkEncoder.java:132)&lt;br/&gt;
        at com.ning.compress.lzf.LZFOutputStream.writeCompressedBlock(LZFOutputStream.java:203)&lt;br/&gt;
        at com.ning.compress.lzf.LZFOutputStream.write(LZFOutputStream.java:97)&lt;br/&gt;
        at org.apache.cassandra.streaming.FileStreamTask.write(FileStreamTask.java:218)&lt;br/&gt;
        at org.apache.cassandra.streaming.FileStreamTask.stream(FileStreamTask.java:164)&lt;br/&gt;
        at org.apache.cassandra.streaming.FileStreamTask.runMayThrow(FileStreamTask.java:91)&lt;br/&gt;
        at org.apache.cassandra.utils.WrappedRunnable.run(WrappedRunnable.java:28)&lt;br/&gt;
        ... 3 more&lt;/p&gt;</comment>
                            <comment id="13494315" author="yukim" created="Fri, 9 Nov 2012 21:16:09 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mkjellman&quot; class=&quot;user-hover&quot; rel=&quot;mkjellman&quot;&gt;mkjellman&lt;/a&gt; Just checking, did you use patched version for both Cassandra and hadoop job?&lt;/p&gt;</comment>
                            <comment id="13494317" author="mkjellman" created="Fri, 9 Nov 2012 21:19:39 +0000"  >&lt;p&gt;yes, actually the first time I tested I did forget to ensure both the Hadoop jar and Cassandra nodes had the newest patched version. I&apos;ve tested a few times now just to make sure i&apos;m not missing anything. Seems to die as soon as it tries to stream the first sstable to the nodes. Never progresses past 0% on the streaming and then throws the exception.&lt;/p&gt;

&lt;p&gt;applied patch to trunk when it was at commit f09a89f4cd13af2087fcc92f09f6cf1ee4785feb. i rebuilt the entire cluster, and ensured my maven dependencies were all set. Still reproduced the problem unfortunately (i actually thought it had been resolved but i just reproduced the java.io.IOException: Broken pipe again).&lt;/p&gt;

&lt;p&gt;MD5 (build/apache-cassandra-1.2.0-beta2-SNAPSHOT.jar) = 92d8ffacb3963116dd153a2c8c83fbe9&lt;/p&gt;</comment>
                            <comment id="13495461" author="yukim" created="Mon, 12 Nov 2012 18:04:05 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mkjellman&quot; class=&quot;user-hover&quot; rel=&quot;mkjellman&quot;&gt;mkjellman&lt;/a&gt; Hmm, I tried standalone and psuedo-cluster hadoop on my machine and haven&apos;t seen that error. I will try in fully distributed mode.&lt;br/&gt;
By the way, what kind of error did you see on cassandra side? Can you post stacktrace?&lt;/p&gt;</comment>
                            <comment id="13495517" author="mkjellman" created="Mon, 12 Nov 2012 19:06:57 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=yukim&quot; class=&quot;user-hover&quot; rel=&quot;yukim&quot;&gt;yukim&lt;/a&gt; I can produce it in local mode (standalone) and distributed mode with the current revision of the patch. I haven&apos;t ran it in psuedo-cluster mode. Also should mention I have reproduced it even when I limit to 1 reducer.&lt;/p&gt;</comment>
                            <comment id="13496406" author="yukim" created="Tue, 13 Nov 2012 18:45:23 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mkjellman&quot; class=&quot;user-hover&quot; rel=&quot;mkjellman&quot;&gt;mkjellman&lt;/a&gt; OK, I did test on distributed hadoop cluster with multiple reducers and job succeeded.&lt;br/&gt;
At first I was getting the same error as yours (java.io.IOException: Broken pipe), but I figured out it was due to the mismatch in partitioner(My cluster was configured as RandomPartitioner and I used Murmur3Partitioner for BOF).&lt;br/&gt;
Can you check that also?&lt;br/&gt;
If that&apos;s not your case, can you upload Cassandra system.log?&lt;/p&gt;</comment>
                            <comment id="13496504" author="mkjellman" created="Tue, 13 Nov 2012 20:16:22 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=yukim&quot; class=&quot;user-hover&quot; rel=&quot;yukim&quot;&gt;yukim&lt;/a&gt; Looks like you are right. Was Murmur Partitioner and my job was configured for Random. On a first run looks like this patch is good to go. Sorry for the wild goose chase there.&lt;/p&gt;</comment>
                            <comment id="13496587" author="mkjellman" created="Tue, 13 Nov 2012 21:54:03 +0000"  >&lt;p&gt;Just tested a few more times. Looks good. Ship it!&lt;/p&gt;</comment>
                            <comment id="13496627" author="yukim" created="Tue, 13 Nov 2012 22:39:07 +0000"  >&lt;p&gt;Thanks for testing! Committed for 1.2 release.&lt;/p&gt;

&lt;p&gt;For partitioner mismatch part, I opened &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-4957&quot; title=&quot;When bulk loading, validate SSTable&amp;#39;s partitioner as much as possible&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-4957&quot;&gt;&lt;del&gt;CASSANDRA-4957&lt;/del&gt;&lt;/a&gt; to follow up.&lt;/p&gt;</comment>
                            <comment id="13497063" author="ralph.romanos" created="Wed, 14 Nov 2012 12:52:00 +0000"  >&lt;p&gt;Hello, &lt;br/&gt;
I just tested the patch on 1.2 with 2 reducers per node and 7 nodes. Everything works fine now.&lt;/p&gt;

&lt;p&gt;Thank you Yuki!&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                            <outwardlinks description="duplicates">
                                        <issuelink>
            <issuekey id="12615013">CASSANDRA-4922</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12552717" name="4813.txt" size="38337" author="yukim" created="Thu, 8 Nov 2012 21:55:22 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[yukim]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>248935</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            13 years, 1 week, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0a2l3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>56692</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>mkjellman</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[mkjellman]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12961"><![CDATA[Low]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>