<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 22:18:32 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-1959] java.lang.ArrayIndexOutOfBoundsException while executing repair on a freshly added node (0.7.0)</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-1959</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;Hi,&lt;/p&gt;

&lt;p&gt;I added a node to the cluster (20 nodes in total) and ran repair on it after a while.&lt;/p&gt;

&lt;p&gt;The repair still runs, but there are errors in the log file (see below).&lt;/p&gt;

&lt;p&gt;Some of the data in the clsuter has been filled with rc-4. The cluster runs on version 0.7.0 (the release linked on the main cassandra web site).&lt;/p&gt;

&lt;p&gt;Any ideas what might cause this?&lt;br/&gt;
(PS. 0.7.0 turns up as unreleased version in Affects Version/s&lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; &lt;/p&gt;


&lt;p&gt;INFO &lt;span class=&quot;error&quot;&gt;&amp;#91;CompactionExecutor:1&amp;#93;&lt;/span&gt; 2011-01-10 19:55:20,684 SSTableReader.java (line 158) Opening /hd2/cassandra_md5/data/table_x/table_x-e-4&lt;br/&gt;
 INFO &lt;span class=&quot;error&quot;&gt;&amp;#91;CompactionExecutor:1&amp;#93;&lt;/span&gt; 2011-01-10 19:55:20,775 SSTableReader.java (line 158) Opening /hd2/cassandra_md5/data/table_x/table_x_meta-e-14&lt;br/&gt;
ERROR &lt;span class=&quot;error&quot;&gt;&amp;#91;RequestResponseStage:3&amp;#93;&lt;/span&gt; 2011-01-10 19:55:20,856 DebuggableThreadPoolExecutor.java (line 103) Error in ThreadPoolExecutor&lt;br/&gt;
java.lang.ArrayIndexOutOfBoundsException: -1&lt;br/&gt;
        at java.util.ArrayList.fastRemove(ArrayList.java:441)&lt;br/&gt;
        at java.util.ArrayList.remove(ArrayList.java:424)&lt;br/&gt;
        at com.google.common.collect.AbstractMultimap.remove(AbstractMultimap.java:219)&lt;br/&gt;
        at com.google.common.collect.ArrayListMultimap.remove(ArrayListMultimap.java:60)&lt;br/&gt;
        at org.apache.cassandra.net.MessagingService.responseReceivedFrom(MessagingService.java:436)&lt;br/&gt;
        at org.apache.cassandra.net.ResponseVerbHandler.doVerb(ResponseVerbHandler.java:40)&lt;br/&gt;
        at org.apache.cassandra.net.MessageDeliveryTask.run(MessageDeliveryTask.java:63)&lt;br/&gt;
        at java.util.concurrent.ThreadPoolExecutor$Worker.runTask(ThreadPoolExecutor.java:886)&lt;br/&gt;
        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:908)&lt;br/&gt;
        at java.lang.Thread.run(Thread.java:662)&lt;br/&gt;
ERROR &lt;span class=&quot;error&quot;&gt;&amp;#91;RequestResponseStage:3&amp;#93;&lt;/span&gt; 2011-01-10 19:55:20,856 AbstractCassandraDaemon.java (line 91) Fatal exception in thread Thread&lt;span class=&quot;error&quot;&gt;&amp;#91;RequestResponseStage:3,5,main&amp;#93;&lt;/span&gt;&lt;br/&gt;
java.lang.ArrayIndexOutOfBoundsException: -1&lt;br/&gt;
        at java.util.ArrayList.fastRemove(ArrayList.java:441)&lt;br/&gt;
        at java.util.ArrayList.remove(ArrayList.java:424)&lt;br/&gt;
        at com.google.common.collect.AbstractMultimap.remove(AbstractMultimap.java:219)&lt;br/&gt;
        at com.google.common.collect.ArrayListMultimap.remove(ArrayListMultimap.java:60)&lt;br/&gt;
        at org.apache.cassandra.net.MessagingService.responseReceivedFrom(MessagingService.java:436)&lt;br/&gt;
        at org.apache.cassandra.net.ResponseVerbHandler.doVerb(ResponseVerbHandler.java:40)&lt;br/&gt;
        at org.apache.cassandra.net.MessageDeliveryTask.run(MessageDeliveryTask.java:63)&lt;br/&gt;
        at java.util.concurrent.ThreadPoolExecutor$Worker.runTask(ThreadPoolExecutor.java:886)&lt;br/&gt;
        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:908)&lt;br/&gt;
        at java.lang.Thread.run(Thread.java:662)&lt;/p&gt;</description>
                <environment></environment>
        <key id="12495158">CASSANDRA-1959</key>
            <summary>java.lang.ArrayIndexOutOfBoundsException while executing repair on a freshly added node (0.7.0)</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10002" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Normal</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="jbellis">Jonathan Ellis</assignee>
                                    <reporter username="tbritz">Thibaut</reporter>
                        <labels>
                    </labels>
                <created>Mon, 10 Jan 2011 19:03:47 +0000</created>
                <updated>Tue, 16 Apr 2019 09:33:09 +0000</updated>
                            <resolved>Tue, 11 Jan 2011 23:41:56 +0000</resolved>
                                        <fixVersion>0.6.10</fixVersion>
                    <fixVersion>0.7.1</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                    <workratio workratioPercent="0"/>
                                    <progress percentage="0">
                                    <originalProgress>
                                                    <row percentage="100" backgroundColor="#89afd7"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="0" backgroundColor="#51a825"/>
                                                    <row percentage="100" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="0">
                                    <originalProgress>
                                                    <row percentage="100" backgroundColor="#89afd7"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="0" backgroundColor="#51a825"/>
                                                    <row percentage="100" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                    <timeoriginalestimate seconds="14400">4h</timeoriginalestimate>
                            <timeestimate seconds="14400">4h</timeestimate>
                                        <comments>
                            <comment id="12979989" author="messi" created="Tue, 11 Jan 2011 08:21:54 +0000"  >&lt;p&gt;Looks like MessagingService.targets needs to be synchronized.&lt;/p&gt;</comment>
                            <comment id="12980174" author="nickmbailey" created="Tue, 11 Jan 2011 16:46:26 +0000"  >&lt;p&gt;Looks like this was caused by &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-1905&quot; title=&quot;count timeouts towards dynamicsnitch latencies&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-1905&quot;&gt;&lt;del&gt;CASSANDRA-1905&lt;/del&gt;&lt;/a&gt;. Or maybe just exposed by it.&lt;/p&gt;

&lt;p&gt;I think this may be particularly nasty due to the fact that droped responses will lead to inflated timings reported to the DynamicEndpointSnitch.  I&apos;m not sure but I think this may be contributing to flapping in another case where I&apos;ve seen this error.&lt;/p&gt;</comment>
                            <comment id="12980193" author="jbellis" created="Tue, 11 Jan 2011 17:24:33 +0000"  >&lt;p&gt;Right, this is from 1905 and there&apos;s definitely a concurrency bug here.&lt;/p&gt;

&lt;p&gt;I don&apos;t want to use the synchronized multimap option though since &lt;b&gt;every&lt;/b&gt; message hits this so we need better concurrency.  v2 is a patch that replaces multimap with a manually constructed Map of Sets.&lt;/p&gt;</comment>
                            <comment id="12980330" author="messi" created="Tue, 11 Jan 2011 21:03:39 +0000"  >&lt;p&gt;I saw that you added putTarget() as instance method although targets itself is a static field. This patch cleans up these inconsistencies and makes MessagingService a true singleton.&lt;/p&gt;</comment>
                            <comment id="12980466" author="hudson" created="Wed, 12 Jan 2011 00:37:57 +0000"  >&lt;p&gt;Integrated in Cassandra-0.7 #152 (See &lt;a href=&quot;https://hudson.apache.org/hudson/job/Cassandra-0.7/152/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://hudson.apache.org/hudson/job/Cassandra-0.7/152/&lt;/a&gt;)&lt;br/&gt;
    convert MessagingService into a true singleton&lt;br/&gt;
patch by Folke Behrens; reviewed by jbellis for &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-1959&quot; title=&quot;java.lang.ArrayIndexOutOfBoundsException while executing repair on a freshly added node (0.7.0)&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-1959&quot;&gt;&lt;del&gt;CASSANDRA-1959&lt;/del&gt;&lt;/a&gt;&lt;br/&gt;
fix race condition in MessagingService.targets&lt;br/&gt;
patch by jbellis; reviewed by Folke Behrens for &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-1959&quot; title=&quot;java.lang.ArrayIndexOutOfBoundsException while executing repair on a freshly added node (0.7.0)&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-1959&quot;&gt;&lt;del&gt;CASSANDRA-1959&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="12980468" author="hudson" created="Wed, 12 Jan 2011 00:38:08 +0000"  >&lt;p&gt;Integrated in Cassandra-0.6 #49 (See &lt;a href=&quot;https://hudson.apache.org/hudson/job/Cassandra-0.6/49/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://hudson.apache.org/hudson/job/Cassandra-0.6/49/&lt;/a&gt;)&lt;br/&gt;
    backport &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-1959&quot; title=&quot;java.lang.ArrayIndexOutOfBoundsException while executing repair on a freshly added node (0.7.0)&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-1959&quot;&gt;&lt;del&gt;CASSANDRA-1959&lt;/del&gt;&lt;/a&gt; from 0.7&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12468027" name="1959-v2.txt" size="4776" author="jbellis" created="Tue, 11 Jan 2011 17:24:33 +0000"/>
                            <attachment id="12468057" name="post-1959-v2-cleanup.patch.txt" size="15577" author="messi" created="Tue, 11 Jan 2011 21:03:39 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[jbellis]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>20382</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            14 years, 45 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0g8g7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>92799</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>messi</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[messi]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12962"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>