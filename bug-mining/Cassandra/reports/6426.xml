<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 23:29:28 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-19278] AND queries involving both static and regular columns can hide matches from Memtable-attached indexes</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-19278</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;As part of our ongoing work on &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-18275&quot; title=&quot;Harry model and in-JVM test for partition-restricted 2i queries&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-18275&quot;&gt;&lt;del&gt;CASSANDRA-18275&lt;/del&gt;&lt;/a&gt;, Harry started surfacing errors shortly after we added static columns to the schema of &lt;tt&gt;SingleNodeSAITest&lt;/tt&gt;. After a bit of debugging, I was able to come up with the following concrete repro:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;import org.junit.Test;

import org.apache.cassandra.cql3.UntypedResultSet;
import org.apache.cassandra.index.sai.utils.SAIRandomizedTester;

public class InMemoryIntersectionsTest extends SAIRandomizedTester
{
    @Test
    public void staticAndRegularIntersection()
    {
        createTable(&quot;CREATE TABLE %s (pk int, ck int, v1 int, s1 int static, PRIMARY KEY(pk, ck))&quot;);
        createIndex(&quot;CREATE INDEX ON %s(v1) USING &apos;sai&apos;&quot;);
        createIndex(&quot;CREATE INDEX ON %s(s1) USING &apos;sai&apos;&quot;);

        execute(&quot;INSERT INTO %s (pk, ck, v1) VALUES (?, ?, ?)&quot;, 0, 1, 0);
        execute(&quot;INSERT INTO %s (pk, ck, v1) VALUES (?, ?, ?)&quot;, 0, 2, 1);
        execute(&quot;INSERT INTO %s (pk, ck, v1) VALUES (?, ?, ?)&quot;, 0, 3, 2);
        execute(&quot;INSERT INTO %s (pk, ck, v1) VALUES (?, ?, ?)&quot;, 0, 4, 3);
        execute(&quot;INSERT INTO %s (pk, ck, v1) VALUES (?, ?, ?)&quot;, 0, 5, 4);
        execute(&quot;INSERT INTO %s (pk, ck, v1) VALUES (?, ?, ?)&quot;, 0, 6, 5);

        execute(&quot;INSERT INTO %s (pk, s1) VALUES (?, ?)&quot;, 0, 100);

	// Flushing here passes test

        UntypedResultSet result1 = execute(&quot;SELECT * FROM %s WHERE pk = ? AND v1 &amp;gt; ?&quot;, 0, 2);
        assertRowCount(result1, 3);
        UntypedResultSet result2 = execute(&quot;SELECT * FROM %s WHERE pk = ? AND v1 &amp;gt; ? AND s1 = ?&quot;, 0, 2, 100);        
        assertRowCount(result2, 3); // Only returns one result!
    }
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Flushing memtables immediately before the queries passes the test, but it seems we have an issue with how the &lt;tt&gt;PrimaryKey&lt;/tt&gt; iterators produced by static and regular column indexes are intersected when the iterators come from Memtable-attached indexes. Once the root cause of this is determined, it might make some sense to enhance &lt;tt&gt;RandomIntersectionTest&lt;/tt&gt; to cover this interaction as well, just in case it turns up further problems.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13565294">CASSANDRA-19278</key>
            <summary>AND queries involving both static and regular columns can hide matches from Memtable-attached indexes</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10002" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Normal</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="maedhroz">Caleb Rackliffe</assignee>
                                    <reporter username="maedhroz">Caleb Rackliffe</reporter>
                        <labels>
                    </labels>
                <created>Thu, 18 Jan 2024 17:54:40 +0000</created>
                <updated>Fri, 31 Jan 2025 12:01:30 +0000</updated>
                            <resolved>Mon, 29 Jan 2024 15:56:53 +0000</resolved>
                                        <fixVersion>5.0-rc1</fixVersion>
                    <fixVersion>5.0</fixVersion>
                    <fixVersion>5.1</fixVersion>
                                    <component>Feature/SAI</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                    <progress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                            <timeestimate seconds="0">0h</timeestimate>
                            <timespent seconds="16800">4h 40m</timespent>
                                <comments>
                            <comment id="17808592" author="maedhroz" created="Fri, 19 Jan 2024 10:42:25 +0000"  >&lt;p&gt;5.0 &lt;a href=&quot;https://github.com/apache/cassandra/pull/3054&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;patch&lt;/a&gt;  &lt;span class=&quot;nobr&quot;&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/13066162/13066162_ci_summary.html&quot; title=&quot;ci_summary.html attached to CASSANDRA-19278&quot;&gt;ci_summary.html&lt;sup&gt;&lt;img class=&quot;rendericon&quot; src=&quot;https://issues.apache.org/jira/images/icons/link_attachment_7.gif&quot; height=&quot;7&quot; width=&quot;7&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/sup&gt;&lt;/a&gt;&lt;/span&gt;&lt;br/&gt;
trunk &lt;a href=&quot;https://github.com/apache/cassandra/pull/3067&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;patch&lt;/a&gt;  &lt;span class=&quot;nobr&quot;&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/13066292/13066292_ci_summary-1.html&quot; title=&quot;ci_summary-1.html attached to CASSANDRA-19278&quot;&gt;ci_summary-1.html&lt;sup&gt;&lt;img class=&quot;rendericon&quot; src=&quot;https://issues.apache.org/jira/images/icons/link_attachment_7.gif&quot; height=&quot;7&quot; width=&quot;7&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/sup&gt;&lt;/a&gt;&lt;/span&gt; &lt;/p&gt;</comment>
                            <comment id="17811412" author="maedhroz" created="Fri, 26 Jan 2024 22:56:33 +0000"  >&lt;p&gt;The 5.0 patch ended up cherry-picking cleanly to trunk, and CI looks good for both branches (modulo a couple pre-existing issues).&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=pkolaczk&quot; class=&quot;user-hover&quot; rel=&quot;pkolaczk&quot;&gt;pkolaczk&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ifesdjeen&quot; class=&quot;user-hover&quot; rel=&quot;ifesdjeen&quot;&gt;ifesdjeen&lt;/a&gt; The only thing I&apos;d wait for, at this point, is possibly pulling into the trunk patch the statics torture test &lt;a href=&quot;https://github.com/apache/cassandra/commit/67fdda4249363557aceca28d0000f0865f0a341a#diff-d9b9ba4b4e071f9195d5488d60043f4fdcf84352b3ee1c2e9b1cce483c52bc27&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;here&lt;/a&gt;. We could also just include that w/ &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-18275&quot; title=&quot;Harry model and in-JVM test for partition-restricted 2i queries&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-18275&quot;&gt;&lt;del&gt;CASSANDRA-18275&lt;/del&gt;&lt;/a&gt;, which is what we were working on when we discovered this issue in the first place. I&apos;d lean toward committing what we have here (the latter option), which is itself supported by a bunch of new randomized tests.&lt;/p&gt;

&lt;p&gt;Thoughts?&lt;/p&gt;</comment>
                            <comment id="17811816" author="ifesdjeen" created="Mon, 29 Jan 2024 10:46:59 +0000"  >&lt;p&gt;+1, LGTM (one tiny typo, comment left on trunk patch)&lt;/p&gt;

&lt;p&gt;I&apos;ve ran statics torture test with different configurations locally for quite a bit. I can also post a separate PR, a follow up to this issue, with a statics torture test. Or we can include it in a 18275.&lt;/p&gt;</comment>
                            <comment id="17811958" author="maedhroz" created="Mon, 29 Jan 2024 15:56:53 +0000"  >&lt;p&gt;Committed to 5.0 as &lt;a href=&quot;https://github.com/apache/cassandra/commit/87f2a7b7637a346cdeea23e0b74d9968ccfca619&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/cassandra/commit/87f2a7b7637a346cdeea23e0b74d9968ccfca619&lt;/a&gt; and trunk as &lt;a href=&quot;https://github.com/apache/cassandra/commit/d6c7c87f553a66b8fc270b273886e5fdf3a34f41&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/cassandra/commit/d6c7c87f553a66b8fc270b273886e5fdf3a34f41&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="13066292" name="ci_summary-1.html" size="7091" author="maedhroz" created="Fri, 26 Jan 2024 22:51:43 +0000"/>
                            <attachment id="13066162" name="ci_summary.html" size="7088" author="maedhroz" created="Sat, 20 Jan 2024 07:01:02 +0000"/>
                            <attachment id="13066293" name="result_details.tar-1.gz" size="41775401" author="maedhroz" created="Fri, 26 Jan 2024 22:51:48 +0000"/>
                            <attachment id="13066163" name="result_details.tar.gz" size="39439542" author="maedhroz" created="Sat, 20 Jan 2024 07:01:12 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>4.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[maedhroz]]></customfieldvalue>
        <customfieldvalue><![CDATA[pkolaczk]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12313825" key="com.atlassian.jira.plugin.system.customfieldtypes:cascadingselect">
                        <customfieldname>Bug Category</customfieldname>
                        <customfieldvalues>
                                                    <customfieldvalue key="12982" cascade-level=""><![CDATA[Correctness]]></customfieldvalue>
                                <customfieldvalue key="12987" cascade-level="1"><![CDATA[Transient Incorrect Response]]></customfieldvalue>
            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12313821" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Complexity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12965"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313822" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Discovered By</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12972"><![CDATA[Fuzz Test]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12311120" key="com.pyxis.greenhopper.jira:gh-epic-link">
                        <customfieldname>Epic Link</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>CASSANDRA-18473</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12313922" key="jira.plugin.projectspecificselectfield.jpssf:multicftype">
                        <customfieldname>Impacts</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="13100"><![CDATA[None]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            1 year, 41 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12313921" key="jira.plugin.projectspecificselectfield.jpssf:multicftype">
                        <customfieldname>Platform</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="13076"><![CDATA[All]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z1muqo:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[ifesdjeen]]></customfieldvalue>
        <customfieldvalue><![CDATA[pkolaczk]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12963"><![CDATA[Critical]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12311420" key="com.atlassian.jira.plugin.system.customfieldtypes:version">
                        <customfieldname>Since Version</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="12353513">5.0-alpha1</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313924" key="com.atlassian.jira.plugin.system.customfieldtypes:textfield">
                        <customfieldname>Source Control Link</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>&lt;p&gt;&lt;a href=&quot;https://github.com/apache/cassandra/commit/87f2a7b7637a346cdeea23e0b74d9968ccfca619&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/cassandra/commit/87f2a7b7637a346cdeea23e0b74d9968ccfca619&lt;/a&gt;&lt;/p&gt;</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313823" key="com.atlassian.jira.plugin.system.customfieldtypes:textarea">
                        <customfieldname>Test and Documentation Plan</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>&lt;p&gt;new randomized tests (or rather enhancements to an existing one)&lt;/p&gt;</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>