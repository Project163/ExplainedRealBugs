<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 22:58:35 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-10367] Aggregate with Initial Condition fails with C* 3.0</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-10367</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;I&apos;m seeing some inconsistent behavior between  2.2 and 3.0 C* with regards to UDF, Aggregates and Initial Conditions. I have a scenario, which I think is valid. It works in C* 2.2 but not in 3.0&lt;/p&gt;

&lt;p&gt;Using the following user defined function&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-sql&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;CREATE&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;OR&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;REPLACE&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;FUNCTION&lt;/span&gt; extend_list(s list&amp;lt;&lt;span class=&quot;code-keyword&quot;&gt;text&lt;/span&gt;&amp;gt;, i &lt;span class=&quot;code-keyword&quot;&gt;int&lt;/span&gt;)
                                  &lt;span class=&quot;code-keyword&quot;&gt;CALLED&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;ON&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;NULL&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;INPUT&lt;/span&gt;
                                  &lt;span class=&quot;code-keyword&quot;&gt;RETURNS&lt;/span&gt; list&amp;lt;&lt;span class=&quot;code-keyword&quot;&gt;text&lt;/span&gt;&amp;gt;
                                  &lt;span class=&quot;code-keyword&quot;&gt;LANGUAGE&lt;/span&gt; java &lt;span class=&quot;code-keyword&quot;&gt;AS&lt;/span&gt; &lt;span class=&quot;code-quote&quot;&gt;&apos;&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (i != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) s.&lt;span class=&quot;code-keyword&quot;&gt;add&lt;/span&gt;(&lt;span class=&quot;code-keyword&quot;&gt;String&lt;/span&gt;.valueOf(i)); &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; s;&apos;&lt;/span&gt;;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;With the aggregate below&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-sql&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;CREATE&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;AGGREGATE&lt;/span&gt; aggregatemetadata.test_init_cond_aggregate(&lt;span class=&quot;code-keyword&quot;&gt;int&lt;/span&gt;) SFUNC extend_list STYPE list&amp;lt;&lt;span class=&quot;code-keyword&quot;&gt;text&lt;/span&gt;&amp;gt; INITCOND [  ]
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;When I attempt to exercise the aggregate on from a simple key value table.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-sql&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;SELECT&lt;/span&gt; test_init_cond_aggregate(v) &lt;span class=&quot;code-keyword&quot;&gt;AS&lt;/span&gt; list_res &lt;span class=&quot;code-keyword&quot;&gt;FROM&lt;/span&gt; t
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;in 2.2 it works fine and returns the aggregate.&lt;/p&gt;

&lt;p&gt;The exact same test ran against the 3.0 branch produces the following exception from the server.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;InvalidRequest: code=2200 [Invalid query] message=&lt;span class=&quot;code-quote&quot;&gt;&quot;ERROR FUNCTION_FAILURE: execution of &lt;span class=&quot;code-quote&quot;&gt;&apos;aggregatemetadata.extend_list[list&amp;lt;text&amp;gt;, &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;]&apos;&lt;/span&gt; failed: java.lang.UnsupportedOperationException&quot;&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I&apos;ve grepped through the C* logs but I couldn&apos;t find a more verbose stack trace, or any errors. &lt;br/&gt;
Robert Stupp suggested I open a ticket.&lt;/p&gt;


&lt;p&gt;I am able to reproduce both in the python driver manually using cql.&lt;/p&gt;</description>
                <environment>&lt;p&gt;Cassandra 3.0 branch&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/cassandra/tree/cassandra-3.0&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/cassandra/tree/cassandra-3.0&lt;/a&gt;&lt;/p&gt;</environment>
        <key id="12875661">CASSANDRA-10367</key>
            <summary>Aggregate with Initial Condition fails with C* 3.0</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10002" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Normal</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="snazy">Robert Stupp</assignee>
                                    <reporter username="greg.bestland">Greg Bestland</reporter>
                        <labels>
                    </labels>
                <created>Thu, 17 Sep 2015 19:18:51 +0000</created>
                <updated>Tue, 16 Apr 2019 09:30:55 +0000</updated>
                            <resolved>Tue, 20 Oct 2015 15:48:10 +0000</resolved>
                                        <fixVersion>3.0.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="14804389" author="snazy" created="Thu, 17 Sep 2015 20:04:53 +0000"  >&lt;p&gt;Can reproduce this issue.&lt;br/&gt;
The &lt;tt&gt;java.lang.UnsupportedOperationException&lt;/tt&gt; originates from &lt;tt&gt;java.util.Collections$UnmodifiableCollection.add&lt;/tt&gt;.&lt;br/&gt;
The &lt;em&gt;newer Java Drivers&lt;/em&gt; return unmodifiable collections for some reason I don&apos;t know. In C* we could however create a new collection instance, but that feels too ugly to me. The Java driver however should return a modifiable collection IMO.&lt;br/&gt;
/cc &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=omichallat&quot; class=&quot;user-hover&quot; rel=&quot;omichallat&quot;&gt;omichallat&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=adutra&quot; class=&quot;user-hover&quot; rel=&quot;adutra&quot;&gt;adutra&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14804397" author="snazy" created="Thu, 17 Sep 2015 20:07:51 +0000"  >&lt;p&gt;FYI - I&apos;ve setup a unit test to verify the behaviour in a &lt;a href=&quot;https://github.com/snazy/cassandra/tree/10367-uda-unmod-3.0&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;git branch&lt;/a&gt; in &lt;tt&gt;AggregationTest.testEmptyListInitcond()&lt;/tt&gt;&lt;/p&gt;</comment>
                            <comment id="14804550" author="omichallat" created="Thu, 17 Sep 2015 21:32:19 +0000"  >&lt;p&gt;Which driver method returns the empty collection?&lt;/p&gt;</comment>
                            <comment id="14804553" author="snazy" created="Thu, 17 Sep 2015 21:34:03 +0000"  >&lt;p&gt;Every &lt;tt&gt;TypeCodec.deserialize()&lt;/tt&gt; implementation for collection types.&lt;/p&gt;</comment>
                            <comment id="14805225" author="slebresne" created="Fri, 18 Sep 2015 08:41:49 +0000"  >&lt;p&gt;I don&apos;t think it&apos;s reasonable to assume any library function returns a mutable collection (unless that&apos;s explicitly documented by the method of course). In fact, I would argue it&apos;s a good think for a library to return immutable results as much as possible. So in any case, I think we should copy the collection if we plan on mutating it. &lt;/p&gt;</comment>
                            <comment id="14805305" author="snazy" created="Fri, 18 Sep 2015 09:39:21 +0000"  >&lt;p&gt;IMO it&apos;s reasonable to return a mutable collection (or a mutable object in general) as long as that cannot change the internal state of the returning function&apos;s object.&lt;br/&gt;
(&lt;tt&gt;TypeCodec.deserialize()&lt;/tt&gt; returns mutable UDT and tuple values.)&lt;/p&gt;

&lt;p&gt;The problem with aggregates (better: UDAs) is that IMO we shouldn&apos;t force users to create a new copy on each invocation of the state function (and maybe the final function).&lt;/p&gt;</comment>
                            <comment id="14805309" author="slebresne" created="Fri, 18 Sep 2015 09:41:29 +0000"  >&lt;p&gt;Can you maybe first please point us to where and why we need to modify a collection from &lt;tt&gt;TypeCodec.deserialize()&lt;/tt&gt;, as it&apos;s not immediately obvious to me why we would need it.&lt;/p&gt;</comment>
                            <comment id="14805364" author="snazy" created="Fri, 18 Sep 2015 10:29:05 +0000"  >&lt;p&gt;Sure. It&apos;s all about maintaining the state of the aggregate.&lt;/p&gt;

&lt;p&gt;The current flow for UDAs is (roughly) like this&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;create initial state variable instance, serialized (the collection in this case)&lt;/li&gt;
	&lt;li&gt;for each row
	&lt;ol&gt;
		&lt;li&gt;deserialize state variable instance (the collection in this case)&lt;/li&gt;
		&lt;li&gt;call UDA state function with deserialized state variable and row&apos;s column value&lt;/li&gt;
		&lt;li&gt;UDA state function modifies state variable (the collection in this case)&lt;/li&gt;
		&lt;li&gt;store serialized state variable instance as returned by UDA state function&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
	&lt;li&gt;for final function
	&lt;ol&gt;
		&lt;li&gt;deserialize state variable instance&lt;/li&gt;
		&lt;li&gt;call UDA final function with deserialized state variable&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
	&lt;li&gt;return UDA final value&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;Superfluous re-serialization is addressed in &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-9613&quot; title=&quot;Omit (de)serialization of state variable in UDAs&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-9613&quot;&gt;&lt;del&gt;CASSANDRA-9613&lt;/del&gt;&lt;/a&gt;. So the flow would then be:&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;Create state variable instance (non-serialized, a &quot;real&quot; object)&lt;/li&gt;
	&lt;li&gt;for each row
	&lt;ol&gt;
		&lt;li&gt;Call state function with state variable object and row&apos;s column value&lt;/li&gt;
		&lt;li&gt;store state variable object returned from state function&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
	&lt;li&gt;for final function
	&lt;ol&gt;
		&lt;li&gt;Call final function with state variable object&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
	&lt;li&gt;serialize state variable or final function&apos;s return value&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;But for unmodifiable collections, the UDA&apos;s state variable has to do something like this:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;public List myStateFunction(List state, String value)
{
  state = new ArrayList(state); // &amp;lt;-- THIS ONE
  state.add(value);
  return state;
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;This can become quite expensive (CPU and garbage) if the UDA&apos;s being used on a partition with several hundred/thousand rows - especially if people use bigger maps, store more intermediate results, etc, etc.&lt;/p&gt;

&lt;p&gt;OTOH this will also be true for tuples and UDTs as these always (de)serialize for every get/set, which is also imperfect IMO (but not something to be addressed in the driver).&lt;/p&gt;

&lt;p&gt;So, long wall of text...&lt;br/&gt;
&lt;b&gt;TL;DR&lt;/b&gt; - Having said that tuples and UDTs do serialization, I&apos;d like to address that in &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-9613&quot; title=&quot;Omit (de)serialization of state variable in UDAs&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-9613&quot;&gt;&lt;del&gt;CASSANDRA-9613&lt;/del&gt;&lt;/a&gt; to also prevent that. So my plan would be: resolve this as &quot;duplicate&quot; of 9613 and fix it there for UDAs. But I&apos;m still unsure if returning an unmodifiable collection is a good idea in the driver. &lt;br/&gt;
WDYT?&lt;/p&gt;</comment>
                            <comment id="14809189" author="slebresne" created="Fri, 18 Sep 2015 10:39:09 +0000"  >&lt;p&gt;So yeah, it sounds pretty clear to me that the main problem is &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-9613&quot; title=&quot;Omit (de)serialization of state variable in UDAs&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-9613&quot;&gt;&lt;del&gt;CASSANDRA-9613&lt;/del&gt;&lt;/a&gt;. We shouldn&apos;t have to re-serialize the state every time and so this shouldn&apos;t matter.&lt;/p&gt;

&lt;p&gt;So I say, let&apos;s copy the collection for now (I honestly doubt anyone will see any measurable difference in practice) and let &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-9613&quot; title=&quot;Omit (de)serialization of state variable in UDAs&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-9613&quot;&gt;&lt;del&gt;CASSANDRA-9613&lt;/del&gt;&lt;/a&gt; optimize the inefficiency.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;I&apos;m still unsure if returning an unmodifiable collection is a good idea in the driver&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I disagree but that&apos;s a decision for the driver. There is no point in forcing the driver to change their code when copying the collection is really not a big deal and we know we&apos;ll optimize it out soon enough.&lt;/p&gt;</comment>
                            <comment id="14847280" author="snazy" created="Fri, 18 Sep 2015 11:35:31 +0000"  >&lt;p&gt;Resolving as &quot;duplicate&quot; of &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-9613&quot; title=&quot;Omit (de)serialization of state variable in UDAs&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-9613&quot;&gt;&lt;del&gt;CASSANDRA-9613&lt;/del&gt;&lt;/a&gt;.&lt;br/&gt;
Well - it&apos;s not really a duplicate, but 9613 will be the solution for this one.&lt;/p&gt;

&lt;p&gt;As a workaround, re-instantiate the collection using &lt;tt&gt;new java.util.ArrayList(state)&lt;/tt&gt;.&lt;/p&gt;</comment>
                            <comment id="14847291" author="slebresne" created="Fri, 18 Sep 2015 11:42:14 +0000"  >&lt;p&gt;Wait, having a code that works in 2.2 broken in 3.0 is not acceptable. When I said we should copy the list as a temporary solution until &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-9613&quot; title=&quot;Omit (de)serialization of state variable in UDAs&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-9613&quot;&gt;&lt;del&gt;CASSANDRA-9613&lt;/del&gt;&lt;/a&gt;, I meant that we should do it in the server, not that client code should do it.&lt;/p&gt;</comment>
                            <comment id="14847293" author="snazy" created="Fri, 18 Sep 2015 11:44:26 +0000"  >&lt;p&gt;Oh, right. 9613 is 3.x not 3.0.x.&lt;/p&gt;</comment>
                            <comment id="14847353" author="snazy" created="Fri, 18 Sep 2015 12:26:05 +0000"  >&lt;p&gt;Provided a workaround (don&apos;t like the term &quot;patch&quot; in this case &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/wink.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; ) as discussed (copying the unmodifiable collection to a modifiable one) and a utest.&lt;/p&gt;

&lt;p&gt;However, this doesn&apos;t solve anything for nested collections or collections in tuples/UDTs.&lt;/p&gt;</comment>
                            <comment id="14875678" author="slebresne" created="Fri, 18 Sep 2015 14:22:18 +0000"  >&lt;p&gt;I think a better way to handle this would be to register our own &lt;tt&gt;TypeCodec&lt;/tt&gt; for collections (as I suggested on the driver ticket, the driver might want to provide such codec out of the box, but it&apos;s not very hard to implement it on our side in the meantime (it&apos;s especially trivial since we can just extend the driver&apos;s list, set and map code and just override their &lt;tt&gt;unmodifiable&lt;/tt&gt; method)). That would handle tuples and UDTs.&lt;/p&gt;</comment>
                            <comment id="14875772" author="snazy" created="Fri, 18 Sep 2015 15:25:10 +0000"  >&lt;p&gt;Yes, it&apos;s possible to extend the List/Set/MapCodecs - but the codec instances themselves are created programmatically in CodecRegistry (which is &lt;tt&gt;final&lt;/tt&gt;&#160;btw).&lt;br/&gt;
This would need some kind of &quot;codec factory&quot; to work.&lt;br/&gt;
I can intercept all calls to &lt;tt&gt;CodecRegistry.codecFor&lt;/tt&gt; - but that&apos;s not what&apos;s really needed, as a type like &lt;tt&gt;tuple&amp;lt;list&amp;lt;text&amp;gt;&amp;gt;&lt;/tt&gt; wouldn&apos;t be caught at all.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=omichallat&quot; class=&quot;user-hover&quot; rel=&quot;omichallat&quot;&gt;omichallat&lt;/a&gt;: Do you have an idea for this? I think the simplest (but maybe that&apos;s just a hack) approach would be to make &lt;tt&gt;CodecRegistry&lt;/tt&gt; non-final and the &lt;tt&gt;maybeCreateCodec&lt;/tt&gt; methods protected.&lt;/p&gt;</comment>
                            <comment id="14875783" author="slebresne" created="Fri, 18 Sep 2015 15:32:25 +0000"  >&lt;p&gt;Hum, I assumed you could just override the default codec for a given by calling &lt;tt&gt;register()&lt;/tt&gt;, but from the code, it doesn&apos;t seem to work. Though that sounds like something the driver should fix however.&lt;/p&gt;</comment>
                            <comment id="14947064" author="omichallat" created="Wed, 7 Oct 2015 15:47:09 +0000"  >&lt;p&gt;Can&apos;t 9613 be reprioritized for 3.0.x?&lt;/p&gt;

&lt;p&gt;Fixing this on the driver side forces us to expose an overkill API (&quot;codec factory&quot; as suggested by Robert) that is unlikely to ever be useful elsewhere. That&apos;s particularly overkill if it&apos;s just a temporary fix for something that will eventually get solved in another Cassandra ticket.&lt;/p&gt;

&lt;p&gt;A corollary to this question is, do you plan to backport 9613 to the 2.2 branch? Since recent versions of the 2.2 driver will also exhibit the issue.&lt;/p&gt;</comment>
                            <comment id="14948281" author="snazy" created="Thu, 8 Oct 2015 08:35:27 +0000"  >&lt;p&gt;I think the current PR for JAVA-922 is fine as a solution for this ticket.&lt;/p&gt;

&lt;p&gt;I agree that sth like a &quot;codec factory&quot; as a temporary fix for this is overkill.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-9613&quot; title=&quot;Omit (de)serialization of state variable in UDAs&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-9613&quot;&gt;&lt;del&gt;CASSANDRA-9613&lt;/del&gt;&lt;/a&gt; is &quot;just&quot; a performance improvement. Do you mean &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-9543&quot; title=&quot;Integrate release 2.2 java driver&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-9543&quot;&gt;&lt;del&gt;CASSANDRA-9543&lt;/del&gt;&lt;/a&gt;? ATM C* 2.2 uses a pre-production 2.2 Java Driver, that does not cause this problem. IMO as soon as we have JAVA-922 in a released version, we can also resolve 9543 with that released Java Driver. But TBH I don&apos;t think 9543 a major issue ATM as there are no known problems.&lt;/p&gt;</comment>
                            <comment id="14948297" author="omichallat" created="Thu, 8 Oct 2015 08:45:19 +0000"  >&lt;p&gt;No I mean 9613. From previous comments, I understand that it would fix this issue:&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;9613 will be the solution for this one&lt;/p&gt;&lt;/blockquote&gt;

&lt;blockquote&gt;&lt;p&gt;we should copy the list as a temporary solution until 9613&lt;/p&gt;&lt;/blockquote&gt;</comment>
                            <comment id="14948312" author="snazy" created="Thu, 8 Oct 2015 08:53:38 +0000"  >&lt;p&gt;Ah - got your point.&lt;br/&gt;
ATM the state of aggregates is deserialized when the state/final aggregate methods are called and their return value is always serialized. The step to re-serialize the state value is superfluous and that&apos;s what 9613 is about to fix.&lt;br/&gt;
But 9613 (even with copying) could not solve this for types like &lt;tt&gt;list&amp;lt;tuple&amp;lt;list&amp;lt;int&amp;gt;,set&amp;lt;text&amp;gt;&amp;gt;&amp;gt;&lt;/tt&gt; - it just skips the re-serialization of the &quot;whole thing&quot;.&lt;/p&gt;</comment>
                            <comment id="14948397" author="slebresne" created="Thu, 8 Oct 2015 09:47:41 +0000"  >&lt;blockquote&gt;&lt;p&gt;Can&apos;t 9613 be reprioritized for 3.0.x?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Not within our current timeline for 3.0 and delaying 3.0 for this is really something I&apos;d rather avoid.&lt;/p&gt;

&lt;p&gt;But &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=omichallat&quot; class=&quot;user-hover&quot; rel=&quot;omichallat&quot;&gt;omichallat&lt;/a&gt;, I understood you reached the consensus of making collections mutable by default in &lt;a href=&quot;https://datastax-oss.atlassian.net/browse/JAVA-922&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;JAVA-922&lt;/a&gt;. If you do that and give us a version of the driver with that (or really, we can build one yourselves if it comes to that), then we&apos;re fine, we don&apos;t need anything else. And I think that&apos;s the easier solution at this point so if you have a reason to think it&apos;s not doable, please quickly inform us as we need to find an alternative.&lt;/p&gt;</comment>
                            <comment id="14948445" author="omichallat" created="Thu, 8 Oct 2015 10:26:59 +0000"  >&lt;p&gt;We were still experimenting with other alternatives and I wanted to get the whole picture Cassandra-side. But all things considered, we&apos;ve decided to proceed with JAVA-922. Thanks for the clarifications.&lt;/p&gt;</comment>
                            <comment id="14948611" author="snazy" created="Thu, 8 Oct 2015 12:50:29 +0000"  >&lt;p&gt;I&apos;ve built current java-driver-3.0-alpha4 with JAVA-922 (&lt;a href=&quot;https://github.com/snazy/java-driver/commits/java922-3.0&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;java-driver git branch&lt;/a&gt;) to confirm it&apos;s working for us (it does). The &lt;a href=&quot;https://github.com/snazy/cassandra/tree/10367-uda-unmod-3.0&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;C* git branch&lt;/a&gt; includes this driver version - Cassci is currently working on that branch.&lt;/p&gt;</comment>
                            <comment id="14965155" author="snazy" created="Tue, 20 Oct 2015 14:15:07 +0000"  >&lt;p&gt;Recently released java-driver 3.0.0-alpha4 works fine. Updated the git branch (&lt;a href=&quot;https://github.com/apache/cassandra/compare/trunk...snazy:10367-uda-unmod-3.0?expand=1&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;diff here&lt;/a&gt;). We could review and commit it now or wait until 3.0.0-beta1 (or even a newer version) is available.&lt;/p&gt;</comment>
                            <comment id="14965167" author="slebresne" created="Tue, 20 Oct 2015 14:25:39 +0000"  >&lt;p&gt;+1 on the patch and using alpha4 (we can always update once newer versions are available, but we&apos;re currently using alpha3 so alpha4 is still progress).&lt;/p&gt;</comment>
                            <comment id="14965280" author="snazy" created="Tue, 20 Oct 2015 15:48:10 +0000"  >&lt;p&gt;Thanks!&lt;br/&gt;
Committed as 615945d275efe1899634f7db6f240f4c1f90b495.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[snazy]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 5 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2kcs7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12311421" key="com.atlassian.jira.plugin.system.customfieldtypes:multiversion">
                        <customfieldname>Reproduced In</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="12333287">3.0 beta 2</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>slebresne</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[slebresne]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12962"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>