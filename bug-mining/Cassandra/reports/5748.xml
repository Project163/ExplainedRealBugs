<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 23:20:47 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-16637] LongLeveledCompactionStrategyCQLTest.stressTestCompactionStrategyManager fails</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-16637</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;Test is failing occasionally as follows:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Caused by: java.lang.AssertionError: Got unexpected overlap in level 3
	at org.apache.cassandra.db.compaction.LeveledGenerations.addAll(LeveledGenerations.java:161)
	at org.apache.cassandra.db.compaction.LeveledManifest.addSSTables(LeveledManifest.java:131)
	at org.apache.cassandra.db.compaction.LeveledCompactionStrategy.addSSTable(LeveledCompactionStrategy.java:365)
	at org.apache.cassandra.db.compaction.CompactionStrategyManager.startup(CompactionStrategyManager.java:312)
	at org.apache.cassandra.db.compaction.CompactionStrategyManager.reload(CompactionStrategyManager.java:532)
	at org.apache.cassandra.db.compaction.CompactionStrategyManager.maybeReloadDiskBoundaries(CompactionStrategyManager.java:495)
	at org.apache.cassandra.db.compaction.CompactionStrategyManager.handleNotification(CompactionStrategyManager.java:743)
	at org.apache.cassandra.db.lifecycle.Tracker.notify(Tracker.java:508)
	at org.apache.cassandra.db.lifecycle.Tracker.notifyDiscarded(Tracker.java:502)
	at org.apache.cassandra.db.lifecycle.Tracker.replaceFlushed(Tracker.java:373)
	at org.apache.cassandra.db.ColumnFamilyStore.replaceFlushed(ColumnFamilyStore.java:1592)
	at org.apache.cassandra.db.ColumnFamilyStore$Flush.flushMemtable(ColumnFamilyStore.java:1194)
	at org.apache.cassandra.db.ColumnFamilyStore$Flush.run(ColumnFamilyStore.java:1075)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;a href=&quot;https://ci-cassandra.apache.org/job/Cassandra-trunk/476/testReport/junit/org.apache.cassandra.db.compaction/LongLeveledCompactionStrategyCQLTest/stressTestCompactionStrategyManager/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;Recent ci&lt;/a&gt;&lt;/p&gt;</description>
                <environment></environment>
        <key id="13375402">CASSANDRA-16637</key>
            <summary>LongLeveledCompactionStrategyCQLTest.stressTestCompactionStrategyManager fails</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10002" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Normal</priority>
                        <status id="3" iconUrl="https://issues.apache.org/jira/images/icons/statuses/inprogress.png" description="This issue is being actively worked on at the moment by the assignee.">In Progress</status>
                    <statusCategory id="4" key="indeterminate" colorName="yellow"/>
                                    <resolution id="-1">Unresolved</resolution>
                                        <assignee username="marcuse">Marcus Eriksson</assignee>
                                    <reporter username="aholmber">Adam Holmberg</reporter>
                        <labels>
                    </labels>
                <created>Tue, 27 Apr 2021 17:21:18 +0000</created>
                <updated>Fri, 10 Oct 2025 08:47:58 +0000</updated>
                                                <fixVersion>4.0.x</fixVersion>
                                    <component>Local/Compaction/LCS</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="17333542" author="edimitrova" created="Tue, 27 Apr 2021 20:44:43 +0000"  >&lt;p&gt;I can reproduce it locally, haven&apos;t worked on that area of the code but I will give it a try. If anyone has any hints - feel free to chime in, I will work more actively on it tomorrow afternoon&lt;/p&gt;</comment>
                            <comment id="17333550" author="edimitrova" created="Tue, 27 Apr 2021 21:05:32 +0000"  >&lt;p&gt;/CC &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=marcuse&quot; class=&quot;user-hover&quot; rel=&quot;marcuse&quot;&gt;marcuse&lt;/a&gt;&#160;in case you have any hints as I see you were the last one working in that area of the code as part of&#160;&lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-16552&quot; title=&quot;Anticompaction appears to race with Compaction, preventing forward compaction progress after an incremental repair&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-16552&quot;&gt;&lt;del&gt;CASSANDRA-16552&lt;/del&gt;&lt;/a&gt;. Not saying that ticket is the reason for the flakiness, but you might have an idea already on what is going on. &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="17334542" author="bereng" created="Wed, 28 Apr 2021 07:56:38 +0000"  >&lt;p&gt;^ I was looking at this one also in the background and reached similar conclusions as far as I went. Seems there could be a race somewhere as to repro locally you have to change the sleeps. It&apos;s very time sensitive.&lt;/p&gt;</comment>
                            <comment id="17337420" author="edimitrova" created="Fri, 30 Apr 2021 14:18:33 +0000"  >&lt;p&gt;A few observations:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;I can reproduce failures with overlapping sometimes level 1, sometimes level 3.&lt;/li&gt;
	&lt;li&gt;The issue was there before&#160; &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-16552&quot; title=&quot;Anticompaction appears to race with Compaction, preventing forward compaction progress after an incremental repair&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-16552&quot;&gt;&lt;del&gt;CASSANDRA-16552&lt;/del&gt;&lt;/a&gt;&#160;&#160;but less obvious, failed for me after 24 runs.&lt;/li&gt;
	&lt;li&gt;As per Marcus&apos; suggestion I tried to &#160;set&#160;&lt;em&gt;sstable_preemptive_open_interval_in_mb=-1&lt;/em&gt;&#160;and I can confirm that the issue is still reproducible.&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="17337867" author="edimitrova" created="Sat, 1 May 2021 17:56:40 +0000"  >&lt;p&gt;Reassigning to Marcus as per Slack, thank you!&lt;/p&gt;</comment>
                            <comment id="17346786" author="krummas" created="Tue, 18 May 2021 10:55:09 +0000"  >&lt;p&gt;Looks like this can happen for two reasons - first we seem to be notifying the compaction strategies twice about the sstables that are getting removed after compaction - first via a &lt;a href=&quot;https://github.com/apache/cassandra/blob/trunk/src/java/org/apache/cassandra/db/lifecycle/LogTransaction.java#L192&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;SSTableDeletingNotification&lt;/a&gt; and then via a &lt;a href=&quot;https://github.com/apache/cassandra/blob/trunk/src/java/org/apache/cassandra/db/lifecycle/LifecycleTransaction.java#L233&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;SSTableListChangedNotification&lt;/a&gt;. This means that there is a small window where LCS doesn&apos;t know about the old or the new sstables, and in this case we might pick sstables for compaction that cause overlap with those new sstables.&lt;/p&gt;

&lt;p&gt;Secondly there is a window after compaction where both the old and new sstables are &apos;live&apos;, so if we &lt;a href=&quot;https://github.com/apache/cassandra/blob/trunk/src/java/org/apache/cassandra/db/compaction/CompactionStrategyManager.java#L509&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;reload&lt;/a&gt; the compaction strategies just in that moment, both will be added to the compaction strategy and there will be overlaps (say we were compacting L2 -&amp;gt; L3, we will create a bunch of new L3 sstables from a set of L2 + L3 sstables, so the old + new L3 sstables will overlap)&lt;/p&gt;

&lt;p&gt;Both these issues are currently handled by sending the offending sstable to L0, which of course is inefficient if its the new sstable getting getting sent there. This is not a new issue in 4.0 so I don&apos;t think we should block GA on it.&lt;/p&gt;

&lt;p&gt;I&apos;ll work on fixes for these issues, but changing fix version.&lt;/p&gt;</comment>
                            <comment id="17347256" author="edimitrova" created="Wed, 19 May 2021 02:06:36 +0000"  >&lt;p&gt;Thanks a lot &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=marcuse&quot; class=&quot;user-hover&quot; rel=&quot;marcuse&quot;&gt;marcuse&lt;/a&gt;!&lt;br/&gt;
As one of the requirements for GA release is the CI to be fully green in 5 consecutive runs, I was wondering also whether to mark this test as flaky and trigger 1 rerun on failure until the bugs are fixed, what do you think?&lt;/p&gt;</comment>
                            <comment id="17347305" author="bereng" created="Wed, 19 May 2021 05:28:03 +0000"  >&lt;p&gt;^What if through &lt;tt&gt;CassandraVersion&lt;/tt&gt; we skip the test if version == 4.0? Googling a bit seems &lt;tt&gt;org.junit.Assume.assumeTrue(someCondition())&lt;/tt&gt;  in the &lt;tt&gt;BeforeClass&lt;/tt&gt; would skip the test. Disclaimer: I haven&apos;t tried it.&lt;/p&gt;

&lt;p&gt;If we wanted to avoid skpping the full test we could catch the specific failure, which seems to be always the same, and not fail if version==4.0. wdyt?&lt;/p&gt;</comment>
                            <comment id="17347641" author="edimitrova" created="Wed, 19 May 2021 12:41:52 +0000"  >&lt;p&gt;I think we might miss different type of failure or further regression if we completely skip it, I will defer the decision to &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=marcuse&quot; class=&quot;user-hover&quot; rel=&quot;marcuse&quot;&gt;marcuse&lt;/a&gt;. I guess it also depends on when he will have the time to work on the patch.&lt;/p&gt;</comment>
                            <comment id="17348141" author="krummas" created="Thu, 20 May 2021 08:12:14 +0000"  >&lt;p&gt;patch to temporarily skip the overlap check: &lt;a href=&quot;https://github.com/krummas/cassandra/commits/marcuse/16637&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/krummas/cassandra/commits/marcuse/16637&lt;/a&gt;&lt;br/&gt;
cci: &lt;a href=&quot;https://app.circleci.com/pipelines/github/krummas/cassandra?branch=marcuse%2F16637&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://app.circleci.com/pipelines/github/krummas/cassandra?branch=marcuse%2F16637&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17348509" author="edimitrova" created="Thu, 20 May 2021 13:06:20 +0000"  >&lt;p&gt;LGTM, maybe we can actually just comment it for later instead of removing? I will defer the decision to you &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=marcuse&quot; class=&quot;user-hover&quot; rel=&quot;marcuse&quot;&gt;marcuse&lt;/a&gt;. Thank you!&lt;/p&gt;</comment>
                            <comment id="17349034" author="bereng" created="Fri, 21 May 2021 07:07:23 +0000"  >&lt;p&gt;I would also favor commenting it out with a note and a ticket reference. Although my preference would be to try to skip by actually detecting the version if that is possible and we&apos;re not in a hot path. I would also open a ticket as a reminder. Hope it makes sense.&lt;/p&gt;</comment>
                            <comment id="17349151" author="edimitrova" created="Fri, 21 May 2021 11:03:16 +0000"  >&lt;p&gt;This is not only 4.0 issue and also we already have this ticket open so I don&apos;t see a reason to open new one or check versions.&lt;/p&gt;</comment>
                            <comment id="17350261" author="bereng" created="Mon, 24 May 2021 06:19:41 +0000"  >&lt;blockquote&gt;&lt;p&gt;This is not a new issue in 4.0 so I don&apos;t think we should block GA on it.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;iiuc this ticket will unblock 4.0 GA as this is an issue that existed previously. So we will remove that fix now but we need to open a new ticket to properly fix this issue in the future if I am not missing anything.&lt;/p&gt;</comment>
                            <comment id="17350412" author="edimitrova" created="Mon, 24 May 2021 12:54:06 +0000"  >&lt;p&gt;The issue will be fixed as part of this ticket, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=marcuse&quot; class=&quot;user-hover&quot; rel=&quot;marcuse&quot;&gt;marcuse&lt;/a&gt;&#160;removed the check that is failing for tests and used only in the tests in order to clean the noise in the CI until the issue is resolved. No need of a new ticket or something.&#160;&lt;/p&gt;</comment>
                            <comment id="17355556" author="bereng" created="Wed, 2 Jun 2021 08:13:14 +0000"  >&lt;p&gt;This is still &lt;a href=&quot;https://ci-cassandra.apache.org/job/Cassandra-4.0/70/testReport/junit/org.apache.cassandra.db.compaction/LongLeveledCompactionStrategyCQLTest/stressTestCompactionStrategyManager/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;coming up&lt;/a&gt; in 4.0 CI&lt;/p&gt;

&lt;p&gt;Didn&apos;t we settle we&apos;d at least merge that check removal to get a clean CI in 4.0? #collaborating&lt;/p&gt;</comment>
                            <comment id="17355566" author="krummas" created="Wed, 2 Jun 2021 08:25:24 +0000"  >&lt;p&gt;right, I&apos;ll commit&lt;/p&gt;</comment>
                            <comment id="17355569" author="krummas" created="Wed, 2 Jun 2021 08:28:58 +0000"  >&lt;p&gt;&lt;a href=&quot;https://github.com/apache/cassandra/commit/aef535cae16986c10f635e71dcbcf0759310ac29&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/cassandra/commit/aef535cae16986c10f635e71dcbcf0759310ac29&lt;/a&gt; to 4.0 and merged up&lt;/p&gt;</comment>
                            <comment id="17355578" author="bereng" created="Wed, 2 Jun 2021 08:50:58 +0000"  >&lt;p&gt;That was fast! thx &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[marcuse]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12313825" key="com.atlassian.jira.plugin.system.customfieldtypes:cascadingselect">
                        <customfieldname>Bug Category</customfieldname>
                        <customfieldvalues>
                                                    <customfieldvalue key="12982" cascade-level=""><![CDATA[Correctness]]></customfieldvalue>
                                <customfieldvalue key="12990" cascade-level="1"><![CDATA[Test Failure]]></customfieldvalue>
            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12313821" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Complexity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12965"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313822" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Discovered By</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12970"><![CDATA[Unit Test]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12313922" key="jira.plugin.projectspecificselectfield.jpssf:multicftype">
                        <customfieldname>Impacts</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="13100"><![CDATA[None]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            4 years, 23 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12313921" key="jira.plugin.projectspecificselectfield.jpssf:multicftype">
                        <customfieldname>Platform</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="13076"><![CDATA[All]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0qif4:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[bereng]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12962"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>