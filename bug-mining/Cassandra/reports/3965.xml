<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 22:59:33 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-10760] Counters are erroneously allowed as map key type</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-10760</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;We do validate collection value types, but not collection key types, which allows counters to be used as map keys:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;cqlsh&amp;gt; create keyspace test with replication = {&apos;class&apos;: &apos;SimpleStrategy&apos;, &apos;replication_factor&apos;: 1};
cqlsh&amp;gt; use test;
cqlsh:test&amp;gt; create table test.test (id int primary key, amap map&amp;lt;counter, text&amp;gt;);
cqlsh:test&amp;gt; insert into test.test (id, amap) values (0, {1: &apos;2&apos;});
cqlsh:test&amp;gt; select * from test.test;

 id | amap
----+----------
  0 | {1: &apos;2&apos;}

(1 rows)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This should obviously not be allowed and must be rejected.&lt;/p&gt;

&lt;p&gt;/cc &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=slebresne&quot; class=&quot;user-hover&quot; rel=&quot;slebresne&quot;&gt;slebresne&lt;/a&gt;&lt;/p&gt;</description>
                <environment></environment>
        <key id="12915485">CASSANDRA-10760</key>
            <summary>Counters are erroneously allowed as map key type</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10003" iconUrl="https://issues.apache.org/jira/images/icons/priorities/trivial.svg">Low</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="michaeledge">Michael Edge</assignee>
                                    <reporter username="aleksey">Aleksey Yeschenko</reporter>
                        <labels>
                            <label>cql</label>
                            <label>cqlsh</label>
                    </labels>
                <created>Mon, 23 Nov 2015 18:43:25 +0000</created>
                <updated>Tue, 16 Apr 2019 09:30:49 +0000</updated>
                            <resolved>Thu, 26 Nov 2015 09:50:59 +0000</resolved>
                                        <fixVersion>2.1.12</fixVersion>
                    <fixVersion>2.2.4</fixVersion>
                    <fixVersion>3.0.1</fixVersion>
                                    <component>Legacy/CQL</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="15026524" author="michaeledge" created="Wed, 25 Nov 2015 09:53:23 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=iamaleksey&quot; class=&quot;user-hover&quot; rel=&quot;iamaleksey&quot;&gt;iamaleksey&lt;/a&gt;, if this is what you&apos;re expecting I&apos;ll create patches for v2.1 and v2.2.&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;cqlsh&amp;gt; create keyspace test with replication = {&apos;class&apos;: &apos;SimpleStrategy&apos;, &apos;replication_factor&apos;: 1};
cqlsh&amp;gt; create table test.test (id int primary key, amap map&amp;lt;counter, text&amp;gt;);
InvalidRequest: code=2200 [Invalid query] message=&quot;Counters are not allowed as keys inside collections: map&amp;lt;counter, text&amp;gt;&quot;
cqlsh&amp;gt; create table test.test (id int primary key, amap map&amp;lt;int, counter&amp;gt;);
InvalidRequest: code=2200 [Invalid query] message=&quot;Counters are not allowed as values inside collections: map&amp;lt;int, counter&amp;gt;&quot;

cqlsh:test&amp;gt; create table test.test (id int primary key, alist list&amp;lt;counter&amp;gt;);
InvalidRequest: code=2200 [Invalid query] message=&quot;Counters are not allowed as values inside collections: list&amp;lt;counter&amp;gt;&quot;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Note the error message for LIST is the same as for MAP (both refer to &apos;values inside collections&apos;). If this is confusing I&apos;ll just remove the &apos;as values&apos;.&lt;/p&gt;

&lt;p&gt;One thing I&apos;m not 100% sure of is whether we allow counters as map keys for supercolumns. Seems we do allow counters as map values for supercolumns. If we do not allow them as map keys then the &lt;tt&gt;isInternal&lt;/tt&gt; check in &lt;tt&gt;org/apache/cassandra/cql3/CQL3Type.java&lt;/tt&gt; can be removed (see patch).&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;+                    &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (keys.isCounter() &amp;amp;&amp;amp; !isInternal)
+                        &lt;span class=&quot;code-keyword&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; InvalidRequestException(&lt;span class=&quot;code-quote&quot;&gt;&quot;Counters are not allowed as keys inside collections: &quot;&lt;/span&gt; + &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="15026550" author="michaeledge" created="Wed, 25 Nov 2015 10:08:46 +0000"  >&lt;p&gt;Patch for v3.0&lt;/p&gt;</comment>
                            <comment id="15028450" author="slebresne" created="Thu, 26 Nov 2015 09:50:59 +0000"  >&lt;p&gt;Committed (with minor nits, see below), thanks.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;the error message for LIST is the same as for MAP (both refer to &apos;values inside collections&apos;)&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I took the liberty of leaving the error message alone and use the same for both case because while no-one should rely on a particular error message, I still prefer not changing them if it&apos;s not a clear improvement. And I doubt anyone will have trouble fixing their problem with just &quot;Counters are not allowed inside collections&quot;.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;whether we allow counters as map keys for supercolumns.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;We don&apos;t. And truly, the storage engine doesn&apos;t support it as counter resolution rules only ever apply to cell values and a map key is part of the cell path. So removed the &lt;tt&gt;isInternal&lt;/tt&gt; check on commit.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12774309" name="CASSANDRA-3.0-10760-Counters-in-Maps.patch" size="1653" author="michaeledge" created="Wed, 25 Nov 2015 10:08:46 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[michaeledge]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 51 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2otav:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12311421" key="com.atlassian.jira.plugin.system.customfieldtypes:multiversion">
                        <customfieldname>Reproduced In</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="12333770">2.1.11</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>slebresne</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[slebresne]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12961"><![CDATA[Low]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>