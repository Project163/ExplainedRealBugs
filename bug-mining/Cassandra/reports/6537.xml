<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 23:30:49 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-13704] Safer handling of out of range tokens</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-13704</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;It is possible for nodes to have a divergent view of the ring, which can result in some operations being sent to the wrong nodes. This is an umbrella ticket to mitigate such issues by adding logging when a node is asked to perform an operation for tokens it does not own. This will be useful for detecting when the nodes&apos; views of the ring diverge, which is not highly visible at the moment, and also for post-hoc analysis.&lt;/p&gt;

&lt;p&gt;It may also be beneficial to straight up reject certain operations, though this will need to balance the risk of performing those ops against the consequences rejecting them has on availability.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13088789">CASSANDRA-13704</key>
            <summary>Safer handling of out of range tokens</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10000" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Urgent</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="maedhroz">Caleb Rackliffe</assignee>
                                    <reporter username="samt">Sam Tunnicliffe</reporter>
                        <labels>
                    </labels>
                <created>Thu, 20 Jul 2017 15:34:42 +0000</created>
                <updated>Tue, 28 Oct 2025 16:20:31 +0000</updated>
                            <resolved>Tue, 17 Sep 2024 22:29:40 +0000</resolved>
                                        <fixVersion>4.0.14</fixVersion>
                    <fixVersion>4.1.7</fixVersion>
                    <fixVersion>5.0.1</fixVersion>
                                    <component>Legacy/Coordination</component>
                    <component>Legacy/Observability</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>13</watches>
                                                    <progress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                            <timeestimate seconds="0">0h</timeestimate>
                            <timespent seconds="29400">8h 10m</timespent>
                                                        <aggregatetimeremainingestimate seconds="0">0h</aggregatetimeremainingestimate>
                                        <aggregatetimespent seconds="29400">8h 10m</aggregatetimespent>
                                    <comments>
                            <comment id="16597435" author="benedict" created="Thu, 30 Aug 2018 13:16:40 +0000"  >&lt;p&gt;I think this is actually a fairly critical correctness issue.  In the case of queries at ONE, or where we speculatively send multiple data requests, this could break our consistency guarantees.  It&apos;s going to be more of an issue with &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-14405&quot; title=&quot;Transient Replication: Metadata refactor&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-14405&quot;&gt;&lt;del&gt;CASSANDRA-14405&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="16612422" author="aweisberg" created="Wed, 12 Sep 2018 16:24:11 +0000"  >&lt;p&gt;Should we also handle when we receive a read request for a range we are pending for? We shouldn&apos;t answer such queries?&lt;/p&gt;</comment>
                            <comment id="17880836" author="maedhroz" created="Wed, 11 Sep 2024 02:38:21 +0000"  >&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;4.0&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/apache/cassandra/pull/3526&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;patch&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&#160;&lt;span class=&quot;nobr&quot;&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/13071488/13071488_ci_summary.html&quot; title=&quot;ci_summary.html attached to CASSANDRA-13704&quot;&gt;ci_summary.html&lt;sup&gt;&lt;img class=&quot;rendericon&quot; src=&quot;https://issues.apache.org/jira/images/icons/link_attachment_7.gif&quot; height=&quot;7&quot; width=&quot;7&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/sup&gt;&lt;/a&gt;&lt;/span&gt;&#160;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;n/a&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;4.1&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/apache/cassandra/pull/3539&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;patch&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&#160;&lt;span class=&quot;nobr&quot;&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/13071491/13071491_ci_summary-1.html&quot; title=&quot;ci_summary-1.html attached to CASSANDRA-13704&quot;&gt;ci_summary-1.html&lt;sup&gt;&lt;img class=&quot;rendericon&quot; src=&quot;https://issues.apache.org/jira/images/icons/link_attachment_7.gif&quot; height=&quot;7&quot; width=&quot;7&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/sup&gt;&lt;/a&gt;&lt;/span&gt;&#160;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;n/a&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;5.0&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/apache/cassandra/pull/3544&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;patch&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;span class=&quot;nobr&quot;&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/13071513/13071513_ci_summary-2.html&quot; title=&quot;ci_summary-2.html attached to CASSANDRA-13704&quot;&gt;ci_summary-2.html&lt;sup&gt;&lt;img class=&quot;rendericon&quot; src=&quot;https://issues.apache.org/jira/images/icons/link_attachment_7.gif&quot; height=&quot;7&quot; width=&quot;7&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/sup&gt;&lt;/a&gt;&lt;/span&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://ci-cassandra.apache.org/view/patches/job/Cassandra-devbranch-5/67/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;ASF CI&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;


&lt;p&gt;I&apos;ve&#160;now posted PRs for 4.0, 4.1, and 5.0. CI is looking pretty clean on 4.0 and 4.1, and 5.0 runs are in progress...&lt;/p&gt;

&lt;p&gt;The patch introduces two new YAML options, &lt;tt&gt;log_out_of_token_range_requests&lt;/tt&gt; and &lt;tt&gt;reject_out_of_token_range_requests&lt;/tt&gt;, which default to &lt;tt&gt;true&lt;/tt&gt;. They determine how streaming, repair, hints, mutations, read repair, and point/range reads handle cases where they are being executed on nodes that do not own the range(es) for the data involved.&lt;/p&gt;

&lt;p&gt;When enabled, &lt;tt&gt;log_out_of_token_range_requests&lt;/tt&gt; logs at WARN level, indicating the kind of request, its source, the invalid ranges requested, and the ranges the node actually owns. When &lt;tt&gt;reject_out_of_token_range_requests&lt;/tt&gt;, out-of-range operations are outright rejected, rather than being accepted by a node that may never own the relevant range(s) and cannot, for example, safely participate in a write quorum. (Writes are not considered out-of-range if the range is pending, but in the event the node itself isn&apos;t yet aware of the pending range, they will be rejected. This may cause a short window of degraded availability, but it is safer and more visible than silently and erroneously accepting them.)&lt;/p&gt;

&lt;p&gt;Once review settles, I&apos;ll likely add entries to &lt;tt&gt;NEWS.txt&lt;/tt&gt; along w/ the CHANGES content, but given this is something we should probably never disable, I&apos;m not too keen on adding it to the example &lt;tt&gt;cassandra.yaml&lt;/tt&gt;.&lt;/p&gt;

&lt;p&gt;Finally,&#160;&lt;tt&gt;nodetool info&lt;/tt&gt; has a new option, &lt;tt&gt;--out-of-range-ops&lt;/tt&gt;, that will display per-keyspace counts of operations for invalid tokens.&lt;/p&gt;</comment>
                            <comment id="17881259" author="michaelsembwever" created="Thu, 12 Sep 2024 10:12:40 +0000"  >&lt;p&gt;Configuration wise, doesn&apos;t this fit into guardrails better ? &lt;br/&gt;
(and log_out_of_token_range_requests &#8594; warn_out_of_token_range_requests)&lt;br/&gt;
(can guardrails also be hidden?)&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;They determine how streaming, repair, hints, mutations, read repair, and point/range reads handle cases where they are being executed on nodes that do not own the range(es) for the data involved.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;It only applies to single partition reads and mutations.  So rejection only provides a mix mode of guarantees (and degraded availability) &#8230;?&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;Finally, nodetool info has a new option, --out-of-range-ops, that will display per-keyspace counts of operations for invalid tokens.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Why do we only collect metrics when log_out_of_token_range_requests is enabled ?  I would think this is useful regardless.  Are we expecting a significant performance impact from it?&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;Once review settles, I&apos;ll likely add entries to NEWS.txt along w/ the CHANGES content, but given this is something we should probably never disable, I&apos;m not too keen on adding it to the example cassandra.yaml.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;This needs a dev ML discussion.&lt;br/&gt;
It is a substantial patch for stable branches, and &lt;em&gt;if rejection is default true&lt;/em&gt; it is a significant behavioural change.  This may not suit all users, and introduce unexpected and unnecessary degraded availability.  &lt;/p&gt;</comment>
                            <comment id="17881342" author="maedhroz" created="Thu, 12 Sep 2024 15:06:56 +0000"  >&lt;blockquote&gt;&lt;p&gt;Configuration wise, doesn&apos;t this fit into guardrails better?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;The Guardrails framework does not exist in 4.0, and I don&apos;t have much incentive to make the solution different across branches.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;It only applies to single partition reads and mutations.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;This should cover the vast majority of reads and writes (that anyone would reasonably make at higher CLs especially). If someone wants to expand on this work, no objections from me.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;Why do we only collect metrics when log_out_of_token_range_requests is enabled? I would think this is useful regardless. Are we expecting a significant performance impact from it?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Yeah, I guess we could go either way on that. I practice, I don&apos;t think this will matter as, at the very least, logging warnings &lt;em&gt;will&lt;/em&gt; be enabled.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;This needs a dev ML discussion.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Sure. I&apos;ll start one today...&lt;/p&gt;</comment>
                            <comment id="17881590" author="michaelsembwever" created="Fri, 13 Sep 2024 14:35:06 +0000"  >&lt;p&gt;Agreed on &lt;a href=&quot;https://lists.apache.org/thread/5d76zdkf3q7yt0033311oq5op14h7zm8&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;ML&lt;/a&gt; is to apply the patch to 4.0, 4.1 and 5.0, with defaults to log and reject out-of-range writes.&lt;/p&gt;</comment>
                            <comment id="17881616" author="maedhroz" created="Fri, 13 Sep 2024 16:27:12 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mck&quot; class=&quot;user-hover&quot; rel=&quot;mck&quot;&gt;mck&lt;/a&gt; The &lt;a href=&quot;https://ci-cassandra.apache.org/view/patches/job/Cassandra-devbranch-5/62/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;ASF CI run for 5.0&lt;/a&gt; only surfaces one unrelated test failure, but I&apos;m not sure what to make of the job&apos;s overall failure from the logs.&lt;/p&gt;</comment>
                            <comment id="17882186" author="michaelsembwever" created="Mon, 16 Sep 2024 20:29:13 +0000"  >&lt;p&gt;+1 on Caleb&apos;s patches:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;4.0 &#8211;&#160;&lt;a href=&quot;https://github.com/apache/cassandra/pull/3526&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/cassandra/pull/3526&lt;/a&gt;&lt;/li&gt;
	&lt;li&gt;4.1 &#8211; &lt;a href=&quot;https://github.com/apache/cassandra/pull/3539&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/cassandra/pull/3539&lt;/a&gt;&lt;/li&gt;
	&lt;li&gt;5.0 &#8211; &lt;a href=&quot;https://github.com/apache/cassandra/pull/3544&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/cassandra/pull/3544&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;just waiting for final CI runs on each.&lt;/p&gt;

&lt;p&gt;CI&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;5.0 profile &quot;pre-commit&quot;:  &lt;span class=&quot;nobr&quot;&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/13071601/13071601_CASSANDRA-13704_5-0_23_ci_summary.html&quot; title=&quot;CASSANDRA-13704_5-0_23_ci_summary.html attached to CASSANDRA-13704&quot;&gt;CASSANDRA-13704_5-0_23_ci_summary.html&lt;sup&gt;&lt;img class=&quot;rendericon&quot; src=&quot;https://issues.apache.org/jira/images/icons/link_attachment_7.gif&quot; height=&quot;7&quot; width=&quot;7&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/sup&gt;&lt;/a&gt;&lt;/span&gt; and  &lt;span class=&quot;nobr&quot;&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/13071602/13071602_CASSANDRA-13704_5-0_23_results_details.tar.xz&quot; title=&quot;CASSANDRA-13704_5-0_23_results_details.tar.xz attached to CASSANDRA-13704&quot;&gt;CASSANDRA-13704_5-0_23_results_details.tar.xz&lt;sup&gt;&lt;img class=&quot;rendericon&quot; src=&quot;https://issues.apache.org/jira/images/icons/link_attachment_7.gif&quot; height=&quot;7&quot; width=&quot;7&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/sup&gt;&lt;/a&gt;&lt;/span&gt;&lt;/li&gt;
	&lt;li&gt;5.0 profile &quot;post-commit&quot;:  &lt;span class=&quot;nobr&quot;&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/13071611/13071611_CASSANDRA-13704_5-0_24_ci_summary.html&quot; title=&quot;CASSANDRA-13704_5-0_24_ci_summary.html attached to CASSANDRA-13704&quot;&gt;CASSANDRA-13704_5-0_24_ci_summary.html&lt;sup&gt;&lt;img class=&quot;rendericon&quot; src=&quot;https://issues.apache.org/jira/images/icons/link_attachment_7.gif&quot; height=&quot;7&quot; width=&quot;7&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/sup&gt;&lt;/a&gt;&lt;/span&gt; and  &lt;span class=&quot;nobr&quot;&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/13071610/13071610_CASSANDRA-13704_5-0_24_results_details.tar.xz&quot; title=&quot;CASSANDRA-13704_5-0_24_results_details.tar.xz attached to CASSANDRA-13704&quot;&gt;CASSANDRA-13704_5-0_24_results_details.tar.xz&lt;sup&gt;&lt;img class=&quot;rendericon&quot; src=&quot;https://issues.apache.org/jira/images/icons/link_attachment_7.gif&quot; height=&quot;7&quot; width=&quot;7&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/sup&gt;&lt;/a&gt;&lt;/span&gt;&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="17882427" author="michaelsembwever" created="Tue, 17 Sep 2024 14:32:10 +0000"  >&lt;p&gt;I&apos;m seeing failures in 5.0&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;failed on teardown with &quot;Unexpected error found in node logs (see stdout for full details). Errors: [[node1] &apos;ERROR [MutationStage-1] 2024-09-17 13:03:31,667 JVMStabilityInspector.java:70 - Exception in thread Thread[MutationStage-1,10,SharedPool]
java.lang.IllegalArgumentException: Conflicting replica added (expected unique endpoints): Full(/127.0.0.3:7000,(4611686018427387904,0]); existing: Full(/127.0.0.3:7000,(281474976710656,0])
at org.apache.cassandra.locator.EndpointsForToken$Builder.add(EndpointsForToken.java:102)
at org.apache.cassandra.locator.EndpointsForToken$Builder.add(EndpointsForToken.java:79)
at org.apache.cassandra.locator.ReplicaCollection$Builder.addAll(ReplicaCollection.java:160)
at org.apache.cassandra.locator.ReplicaCollection$Builder.addAll(ReplicaCollection.java:166)
at org.apache.cassandra.locator.EndpointsForToken.copyOf(EndpointsForToken.java:162)
at org.apache.cassandra.locator.AbstractReplicationStrategy.getNaturalAndPendingReplicasForToken(AbstractReplicationStrategy.java:126)
at org.apache.cassandra.service.StorageService.isEndpointValidForWrite(StorageService.java:5162)
at org.apache.cassandra.db.AbstractMutationVerbHandler.isOutOfRangeMutation(AbstractMutationVerbHandler.java:79)
at org.apache.cassandra.db.AbstractMutationVerbHandler.processMessage(AbstractMutationVerbHandler.java:53)
at org.apache.cassandra.db.AbstractMutationVerbHandler.doVerb(AbstractMutationVerbHandler.java:44)
at org.apache.cassandra.db.ReadRepairVerbHandler.doVerb(ReadRepairVerbHandler.java:35)
at org.apache.cassandra.net.InboundSink.lambda$new$0(InboundSink.java:78)
at org.apache.cassandra.net.InboundSink.accept(InboundSink.java:97)
at org.apache.cassandra.net.InboundSink.accept(InboundSink.java:45)
at org.apache.cassandra.net.InboundMessageHandler$ProcessMessage.run(InboundMessageHandler.java:430)
at org.apache.cassandra.concurrent.ExecutionFailure$1.run(ExecutionFailure.java:133)
at org.apache.cassandra.concurrent.SEPWorker.run(SEPWorker.java:143)
at io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)at java.base/java.lang.Thread.run(Thread.java:829)&apos;]&quot;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;in&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;dtest-novnode jdk11 57/64 / dtest-novnode.consistent_bootstrap_test.TestBootstrapConsistency.test_consistent_reads_after_move&lt;/li&gt;
	&lt;li&gt;dtest-latest jdk11 43/64 / dtest-latest.materialized_views_test.TestMaterializedViews.test_insert_during_range_movement_rf3&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="17882514" author="michaelsembwever" created="Tue, 17 Sep 2024 21:09:01 +0000"  >&lt;p&gt;New CI round after &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=maedhroz&quot; class=&quot;user-hover&quot; rel=&quot;maedhroz&quot;&gt;maedhroz&lt;/a&gt;&apos;s &lt;a href=&quot;https://github.com/apache/cassandra/pull/3544/commits/cf1918e9b621ccc8a90b4260489ce46f695bf6e1&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;fix&lt;/a&gt;:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;5.0 profile &quot;post-commit&quot;:  &lt;span class=&quot;nobr&quot;&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/13071619/13071619_CASSANDRA-13704_5-0_25_ci_summary.html&quot; title=&quot;CASSANDRA-13704_5-0_25_ci_summary.html attached to CASSANDRA-13704&quot;&gt;CASSANDRA-13704_5-0_25_ci_summary.html&lt;sup&gt;&lt;img class=&quot;rendericon&quot; src=&quot;https://issues.apache.org/jira/images/icons/link_attachment_7.gif&quot; height=&quot;7&quot; width=&quot;7&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/sup&gt;&lt;/a&gt;&lt;/span&gt; and  &lt;span class=&quot;nobr&quot;&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/13071620/13071620_CASSANDRA-13704_5-0_25_results_details.tar.xz&quot; title=&quot;CASSANDRA-13704_5-0_25_results_details.tar.xz attached to CASSANDRA-13704&quot;&gt;CASSANDRA-13704_5-0_25_results_details.tar.xz&lt;sup&gt;&lt;img class=&quot;rendericon&quot; src=&quot;https://issues.apache.org/jira/images/icons/link_attachment_7.gif&quot; height=&quot;7&quot; width=&quot;7&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/sup&gt;&lt;/a&gt;&lt;/span&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Three failures, all unrelated.&lt;/p&gt;

&lt;p&gt;The failing tests were also run repeatedly locally (using &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-18942&quot; title=&quot;Repeatable java test runs on jenkins&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-18942&quot;&gt;&lt;del&gt;CASSANDRA-18942&lt;/del&gt;&lt;/a&gt;), previous failure rates were 1:4, now gone.&lt;/p&gt;</comment>
                            <comment id="17882524" author="maedhroz" created="Tue, 17 Sep 2024 22:29:40 +0000"  >&lt;p&gt;Thanks to &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=samt&quot; class=&quot;user-hover&quot; rel=&quot;samt&quot;&gt;samt&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=aweisberg&quot; class=&quot;user-hover&quot; rel=&quot;aweisberg&quot;&gt;aweisberg&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mck&quot; class=&quot;user-hover&quot; rel=&quot;mck&quot;&gt;mck&lt;/a&gt;, and &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jonmeredith&quot; class=&quot;user-hover&quot; rel=&quot;jonmeredith&quot;&gt;jonmeredith&lt;/a&gt; for their contributions!&lt;/p&gt;</comment>
                            <comment id="18033390" author="JIRAUSER303782" created="Tue, 28 Oct 2025 00:44:00 +0000"  >&lt;p&gt;This question is about Cassandra 4.x behavior.&lt;/p&gt;

&lt;p&gt;If the warning logs or rejection errors introduced by this change are enabled, I assume they might appear even during regular range movement operations, such as when adding a new node. This is because node status (joining, normal, etc..) changes are propagated through gossip, which is eventually consistent.&lt;/p&gt;

&lt;p&gt;For example:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;At &lt;b&gt;t&#8320;&lt;/b&gt;, node5 finishes joining and becomes &lt;b&gt;UN&lt;/b&gt;, making an existing node (say, node0) no longer own token range &lt;b&gt;range_x&lt;/b&gt;.&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;At &lt;b&gt;t&#8321;&lt;/b&gt;, node0 learns from gossip that node5 is &lt;b&gt;UN&lt;/b&gt;.&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;At &lt;b&gt;t&#8322;&lt;/b&gt;, node1 learns the same.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Between &lt;b&gt;t&#8321;&lt;/b&gt; and &lt;b&gt;t&#8322;&lt;/b&gt;, if a request involving &lt;b&gt;range_x&lt;/b&gt; reaches node1 as the coordinator, node1&#8212;still believing node0 owns that range&#8212;would forward the request to node0. However, node0, having already updated its view, would know it no longer owns &lt;b&gt;range_x&lt;/b&gt; and thus emit the warning log or rejection error.&lt;/p&gt;

&lt;p&gt;&lt;b&gt;1&lt;/b&gt;. Is my understanding correct that such warnings or rejections are expected (and relatively common) during operations like node additions, especially in larger clusters where gossip convergence takes longer?&lt;/p&gt;

&lt;p&gt;&lt;b&gt;2&lt;/b&gt;. Another question: if my understanding is correct, would CEP-21 (transactional cluster metadata) completely solve this issue or at least greatly reduce its likelihood?&lt;br/&gt;
Thanks!&lt;/p&gt;</comment>
                            <comment id="18033598" author="maedhroz" created="Tue, 28 Oct 2025 16:20:31 +0000"  >&lt;p&gt;I&apos;ll answer #2 at least...correct, this should no longer be possible w/ TCM&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310010">
                    <name>Incorporates</name>
                                            <outwardlinks description="incorporates">
                                        <issuelink>
            <issuekey id="13088790">CASSANDRA-13705</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="13088791">CASSANDRA-13706</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="13088792">CASSANDRA-13707</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="13088793">CASSANDRA-13708</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="13088794">CASSANDRA-13709</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="13088795">CASSANDRA-13710</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="13071601" name="CASSANDRA-13704_5-0_23_ci_summary.html" size="1062073" author="mck" created="Tue, 17 Sep 2024 11:02:56 +0000"/>
                            <attachment id="13071602" name="CASSANDRA-13704_5-0_23_results_details.tar.xz" size="1298424" author="mck" created="Tue, 17 Sep 2024 11:02:56 +0000"/>
                            <attachment id="13071611" name="CASSANDRA-13704_5-0_24_ci_summary.html" size="51396468" author="mck" created="Tue, 17 Sep 2024 14:37:19 +0000"/>
                            <attachment id="13071610" name="CASSANDRA-13704_5-0_24_results_details.tar.xz" size="13884052" author="mck" created="Tue, 17 Sep 2024 14:37:15 +0000"/>
                            <attachment id="13071619" name="CASSANDRA-13704_5-0_25_ci_summary.html" size="33290501" author="mck" created="Tue, 17 Sep 2024 21:07:41 +0000"/>
                            <attachment id="13071620" name="CASSANDRA-13704_5-0_25_results_details.tar.xz" size="9777180" author="mck" created="Tue, 17 Sep 2024 21:07:33 +0000"/>
                            <attachment id="13071491" name="ci_summary-1.html" size="89775" author="maedhroz" created="Wed, 11 Sep 2024 02:36:27 +0000"/>
                            <attachment id="13071513" name="ci_summary-2.html" size="39746" author="maedhroz" created="Thu, 12 Sep 2024 05:35:30 +0000"/>
                            <attachment id="13071488" name="ci_summary.html" size="7710" author="maedhroz" created="Tue, 10 Sep 2024 18:01:36 +0000"/>
                            <attachment id="13071508" name="result_details.tar-1.gz" size="42257016" author="maedhroz" created="Wed, 11 Sep 2024 16:57:15 +0000"/>
                            <attachment id="13071514" name="result_details.tar-2.gz" size="2685040" author="maedhroz" created="Thu, 12 Sep 2024 05:35:38 +0000"/>
                            <attachment id="13071507" name="result_details.tar.gz" size="30177565" author="maedhroz" created="Wed, 11 Sep 2024 16:56:47 +0000"/>
                    </attachments>
                <subtasks>
                            <subtask id="13088790">CASSANDRA-13705</subtask>
                            <subtask id="13088791">CASSANDRA-13706</subtask>
                            <subtask id="13088792">CASSANDRA-13707</subtask>
                            <subtask id="13088793">CASSANDRA-13708</subtask>
                            <subtask id="13088794">CASSANDRA-13709</subtask>
                            <subtask id="13088795">CASSANDRA-13710</subtask>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>12.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[aweisberg]]></customfieldvalue>
        <customfieldvalue><![CDATA[maedhroz]]></customfieldvalue>
        <customfieldvalue><![CDATA[mck]]></customfieldvalue>
        <customfieldvalue><![CDATA[samt]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            2 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3hszr:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[mck]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12963"><![CDATA[Critical]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12311420" key="com.atlassian.jira.plugin.system.customfieldtypes:version">
                        <customfieldname>Since Version</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="12336842">4.0</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313924" key="com.atlassian.jira.plugin.system.customfieldtypes:textfield">
                        <customfieldname>Source Control Link</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>&lt;p&gt;&lt;a href=&quot;https://github.com/apache/cassandra/commit/b4f1c6d250991fc27c5f87a2dc0fd81e7ad0d272&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/cassandra/commit/b4f1c6d250991fc27c5f87a2dc0fd81e7ad0d272&lt;/a&gt;&lt;/p&gt;</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313823" key="com.atlassian.jira.plugin.system.customfieldtypes:textarea">
                        <customfieldname>Test and Documentation Plan</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>&lt;p&gt;There are several new unit and distributed tests around out-of-token-range requests, in addition to new bits of logging when these requests occur and metrics that count their frequencies.&lt;/p&gt;</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>