<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 22:53:24 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-9190] Map keys aren&apos;t properly serialized as strings in SELECT JSON queries</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-9190</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;When I run a SELECT JSON query on a table that contains a column of type map, the JSON output doesn&#8217;t wrap the map keys with quotes, thus creating a non-standard JSON representation, which doesn&#8217;t play along with JSON parsers very well. &lt;/p&gt;

&lt;p&gt;Here&#8217;s an example where the map keys are actually a set:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;create table table1 (id &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; primary key, mymap map&amp;lt;frozen&amp;lt;set&amp;lt;&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;&amp;gt;&amp;gt;,&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;&amp;gt;);
insert into table1 (id,mymap) values (1, {{1,2,3,4}:1});
select json id,mymap from table1;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The output is:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;{&quot;id&quot;: 1, &quot;mymap&quot;: {[1, 2, 3, 4]: 1}}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;But what I expected was that the map key, in this case the entire integer set, would be wrapped with quotes.&lt;br/&gt;
The same thing happens when the key is a primitive, such as int, or when it&#8217;s another type of collection.&lt;/p&gt;

&lt;p&gt;I tried this with the latest version of the Cassandra codebase from the repository&#8217;s trunk (1f65a12c33).&lt;/p&gt;</description>
                <environment></environment>
        <key id="12820981">CASSANDRA-9190</key>
            <summary>Map keys aren&apos;t properly serialized as strings in SELECT JSON queries</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10002" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Normal</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="thobbs">Tom Hobbs</assignee>
                                    <reporter username="gianluca">Gianluca Righetto</reporter>
                        <labels>
                    </labels>
                <created>Tue, 14 Apr 2015 21:50:55 +0000</created>
                <updated>Tue, 16 Apr 2019 09:31:14 +0000</updated>
                            <resolved>Wed, 13 May 2015 17:39:50 +0000</resolved>
                                        <fixVersion>2.2.0 beta 1</fixVersion>
                                    <component>Legacy/CQL</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="14540635" author="thobbs" created="Tue, 12 May 2015 20:22:06 +0000"  >&lt;p&gt;The attached patch ensures map keys are strings and adds a unit test.&lt;/p&gt;

&lt;p&gt;The cassci test jobs (still pending, right now):&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/thobbs/job/thobbs-CASSANDRA-9190-dtest/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://cassci.datastax.com/view/Dev/view/thobbs/job/thobbs-CASSANDRA-9190-dtest/&lt;/a&gt;&lt;/li&gt;
	&lt;li&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/thobbs/job/thobbs-CASSANDRA-9190-testall/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://cassci.datastax.com/view/Dev/view/thobbs/job/thobbs-CASSANDRA-9190-testall/&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="14542184" author="jbellis" created="Wed, 13 May 2015 16:23:03 +0000"  >&lt;blockquote&gt;
&lt;p&gt;+        if (parsed instanceof String)&lt;br/&gt;
+            parsed = Json.decodeJson((String) parsed);&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;So if it&apos;s just a string literal, is decodeJson a no-op?&lt;/p&gt;</comment>
                            <comment id="14542222" author="thobbs" created="Wed, 13 May 2015 16:50:38 +0000"  >&lt;blockquote&gt;&lt;p&gt;So if it&apos;s just a string literal, is decodeJson a no-op?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;No, it&apos;s not a no-op.  It will attempt to decode it as a normal JSON string.  For example, if you&apos;ve got a &lt;tt&gt;map&amp;lt;frozen&amp;lt;set&amp;lt;int&amp;gt;&amp;gt;, boolean&amp;gt;&lt;/tt&gt; column and you try to pass a string literal &quot;abc&quot; for a map key, you&apos;ll get an error like the following:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Error decoding JSON value for column1: Error decoding JSON string: Unexpected character (&apos;a&apos; (code 97)): expected a valid value (number, String, array, object, &apos;true&apos;, &apos;false&apos; or &apos;null&apos;)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I could improve the error message somewhat if you&apos;d like, but it should be a pretty rare case.&lt;/p&gt;</comment>
                            <comment id="14542237" author="jbellis" created="Wed, 13 May 2015 17:01:28 +0000"  >&lt;p&gt;I think we&apos;re okay, since we expect people to be using JSON primarily to round-trip through our own code and secondarily with other JSON libraries.  We don&apos;t need to worry too much about helping people debug bad JSON I think.  Even if it is bad JSON of the kind we generated pre-beta. &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;+1 from me.&lt;/p&gt;
</comment>
                            <comment id="14542296" author="thobbs" created="Wed, 13 May 2015 17:39:51 +0000"  >&lt;p&gt;Thanks, committed as &lt;tt&gt;b7be1980b1b41731f27433cd80743ec76b4beab1&lt;/tt&gt; to trunk.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12732357" name="9190-trunk.txt" size="13034" author="thobbs" created="Tue, 12 May 2015 20:22:06 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[thobbs]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 27 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2d94n:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>jbellis</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[jbellis]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12962"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>