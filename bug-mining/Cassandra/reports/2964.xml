<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 22:46:34 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-7588] cqlsh error for query against collection index - list index out of range</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-7588</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;This worked in 2.1 RC1&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Connected to Test Cluster at 127.0.0.1:9042.
[cqlsh 5.0.1 | Cassandra 2.1.0-rc1-SNAPSHOT | CQL spec 3.1.7 | Native protocol v3]
Use HELP for help.
cqlsh&amp;gt; use k1;
cqlsh:k1&amp;gt; SELECT id, description FROM products WHERE categories CONTAINS &apos;hdtv&apos;;

 id    | description
-------+-----------------------------
 29412 |    32-inch LED HDTV (black)
 34134 | 120-inch 1080p 3D plasma TV

(2 rows)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;But fails on 2.1:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Connected to Test Cluster at 127.0.0.1:9042.
[cqlsh 5.0.1 | Cassandra 2.1.0-rc4-SNAPSHOT | CQL spec 3.2.0 | Native protocol v3]
Use HELP for help.
cqlsh&amp;gt; use k1;
cqlsh:k1&amp;gt; SELECT id, description FROM products WHERE categories CONTAINS &apos;hdtv&apos;;
list index out of range
cqlsh:k1&amp;gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This is using the example from the blog post &lt;a href=&quot;http://www.datastax.com/dev/blog/cql-in-2-1&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://www.datastax.com/dev/blog/cql-in-2-1&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;A more complete repro:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;cqlsh:k1&amp;gt;
cqlsh:k1&amp;gt; CREATE KEYSPACE cat_index_test
      ... WITH replication = {&apos;class&apos;: &apos;SimpleStrategy&apos;, &apos;replication_factor&apos;: 1};
cqlsh:k1&amp;gt; USE cat_index_test;
cqlsh:cat_index_test&amp;gt;
cqlsh:cat_index_test&amp;gt;  CREATE TABLE IF NOT EXISTS products (
                  ...       id int PRIMARY KEY,
                  ...       description text,
                  ...       price int,
                  ...       categories set&amp;lt;text&amp;gt;,
                  ...       features map&amp;lt;text, text&amp;gt;
                  ...   );
cqlsh:cat_index_test&amp;gt;
cqlsh:cat_index_test&amp;gt;   CREATE INDEX IF NOT EXISTS cat_index ON products(categories);
cqlsh:cat_index_test&amp;gt;   CREATE INDEX IF NOT EXISTS feat_index ON products(features);
cqlsh:cat_index_test&amp;gt;
cqlsh:cat_index_test&amp;gt;   INSERT INTO products(id, description, price, categories, features)
                  ...        VALUES (34134,
                  ...                &apos;120-inch 1080p 3D plasma TV&apos;,
                  ...                9999,
                  ...                {&apos;tv&apos;, &apos;3D&apos;, &apos;hdtv&apos;},
                  ...                {&apos;screen&apos; : &apos;120-inch&apos;, &apos;refresh-rate&apos; : &apos;400hz&apos;, &apos;techno&apos; : &apos;plasma&apos;});
cqlsh:cat_index_test&amp;gt;
cqlsh:cat_index_test&amp;gt;   INSERT INTO products(id, description, price, categories, features)
                  ...        VALUES (29412,
                  ...                &apos;32-inch LED HDTV (black)&apos;,
                  ...                929,
                  ...                {&apos;tv&apos;, &apos;hdtv&apos;},
                  ...                {&apos;screen&apos; : &apos;32-inch&apos;, &apos;techno&apos; : &apos;LED&apos;});
cqlsh:cat_index_test&amp;gt;
cqlsh:cat_index_test&amp;gt;   INSERT INTO products(id, description, price, categories, features)
                  ...        VALUES (38471,
                  ...                &apos;32-inch LCD TV&apos;,
                  ...                110,
                  ...                {&apos;tv&apos;, &apos;used&apos;},
                  ...                {&apos;screen&apos; : &apos;32-inch&apos;, &apos;techno&apos; : &apos;LCD&apos;});
cqlsh:cat_index_test&amp;gt;   SELECT id, description FROM products WHERE categories CONTAINS &apos;hdtv&apos;;
list index out of range
cqlsh:cat_index_test&amp;gt;   SELECT id, description FROM products WHERE features CONTAINS &apos;32-inch&apos;;
list index out of range
cqlsh:cat_index_test&amp;gt; DROP INDEX feat_index;
cqlsh:cat_index_test&amp;gt; CREATE INDEX feat_key_index ON products(KEYS(features));
cqlsh:cat_index_test&amp;gt;
cqlsh:cat_index_test&amp;gt; SELECT id, description
                  ... FROM products
                  ... WHERE features CONTAINS KEY &apos;refresh-rate&apos;;
list index out of range
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This appears to be a cqlsh issue, since these queries still work when executed using DevCenter.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12728904">CASSANDRA-7588</key>
            <summary>cqlsh error for query against collection index - list index out of range</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10002" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Normal</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="snazy">Robert Stupp</assignee>
                                    <reporter username="djatnieks">dan jatnieks</reporter>
                        <labels>
                            <label>cqlsh</label>
                    </labels>
                <created>Tue, 22 Jul 2014 17:18:30 +0000</created>
                <updated>Tue, 16 Apr 2019 09:31:39 +0000</updated>
                            <resolved>Tue, 22 Jul 2014 19:11:10 +0000</resolved>
                                        <fixVersion>2.1.1</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="14070568" author="brandon.williams" created="Tue, 22 Jul 2014 17:39:59 +0000"  >&lt;p&gt;Works fine for me:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;cqlsh:cat_index_test&amp;gt; SELECT id, description FROM products WHERE categories CONTAINS &apos;hdtv&apos;;

 id    | description
-------+-----------------------------
 29411 |    32-inch LED HDTV (black)
 34134 | 120-inch 1080p 3D plasma TV

(2 rows)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="14070569" author="brandon.williams" created="Tue, 22 Jul 2014 17:40:34 +0000"  >&lt;p&gt;Try cqlsh with --debug&lt;/p&gt;</comment>
                            <comment id="14070649" author="snazy" created="Tue, 22 Jul 2014 18:31:32 +0000"  >&lt;p&gt;This is a regression of &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-6910&quot; title=&quot;Better table structure display in cqlsh&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-6910&quot;&gt;&lt;del&gt;CASSANDRA-6910&lt;/del&gt;&lt;/a&gt;.&lt;br/&gt;
Suggestion: revert commit for &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-6910&quot; title=&quot;Better table structure display in cqlsh&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-6910&quot;&gt;&lt;del&gt;CASSANDRA-6910&lt;/del&gt;&lt;/a&gt; and implement &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-6910&quot; title=&quot;Better table structure display in cqlsh&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-6910&quot;&gt;&lt;del&gt;CASSANDRA-6910&lt;/del&gt;&lt;/a&gt; properly in 2.1.1&lt;/p&gt;

&lt;p&gt;I had a similar failure (&lt;em&gt;list index out of range&lt;/em&gt;) with UDFs (&lt;tt&gt;::&lt;/tt&gt; notation). Reason is that cqlsh does not &quot;recognize&quot; the &lt;tt&gt;::&lt;/tt&gt; notation in its grammar - same for this issue: cqlsh does not know about &lt;tt&gt;contains&lt;/tt&gt;.&lt;/p&gt;

&lt;p&gt;EDIT: &quot;properly&quot; means to check every &lt;tt&gt;SELECT&lt;/tt&gt; statement variant with cqlsh.&lt;/p&gt;</comment>
                            <comment id="14070670" author="brandon.williams" created="Tue, 22 Jul 2014 18:40:46 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-6910&quot; title=&quot;Better table structure display in cqlsh&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-6910&quot;&gt;&lt;del&gt;CASSANDRA-6910&lt;/del&gt;&lt;/a&gt; is not in rc4, though.&lt;/p&gt;</comment>
                            <comment id="14070678" author="snazy" created="Tue, 22 Jul 2014 18:46:13 +0000"  >&lt;p&gt;Yes - 6910 went into 2.1 branch - not in 2.1.0 branch.&lt;br/&gt;
I&apos;ll try if a similar fix works for this - need 15 minutes...&lt;/p&gt;</comment>
                            <comment id="14070701" author="snazy" created="Tue, 22 Jul 2014 18:57:12 +0000"  >&lt;p&gt;Yup - I&apos;m 99.9% sure it&apos;s 6910.&lt;br/&gt;
Not reproducible with 2.1.0-rc4&lt;br/&gt;
Not reproducible on branch cassandra-2.1.0&lt;br/&gt;
Reproducible on branch cassandra-2.1&lt;/p&gt;</comment>
                            <comment id="14070707" author="snazy" created="Tue, 22 Jul 2014 18:59:15 +0000"  >&lt;p&gt;Patch attached (add &lt;tt&gt;CONTAINS&lt;/tt&gt; to comparators in cql3handling.py)&lt;/p&gt;</comment>
                            <comment id="14070710" author="snazy" created="Tue, 22 Jul 2014 19:00:44 +0000"  >&lt;p&gt;Note: traceback with &lt;tt&gt;cqlsh --debug&lt;/tt&gt; is:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;cqlsh&amp;gt; SELECT id, description FROM cat_index_test.products WHERE features CONTAINS &apos;32-inch&apos;;
Traceback (most recent call last):
  File &quot;bin/cqlsh&quot;, line 822, in onecmd
    self.handle_statement(st, statementtext)
  File &quot;bin/cqlsh&quot;, line 862, in handle_statement
    return self.handle_parse_error(cmdword, tokens, parsed, srcstr)
  File &quot;bin/cqlsh&quot;, line 871, in handle_parse_error
    return self.perform_statement(cqlruleset.cql_extract_orig(tokens, srcstr))
  File &quot;bin/cqlsh&quot;, line 895, in perform_statement
    with_default_limit=with_default_limit)
  File &quot;bin/cqlsh&quot;, line 919, in perform_simple_statement
    parsed = cqlruleset.cql_parse(statement.query_string)[1]
IndexError: list index out of range
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="14070718" author="snazy" created="Tue, 22 Jul 2014 19:07:57 +0000"  >&lt;p&gt;&lt;tt&gt;ALLOW FILTERING&lt;/tt&gt; was also missing - combined patch attached&lt;/p&gt;</comment>
                            <comment id="14070719" author="brandon.williams" created="Tue, 22 Jul 2014 19:08:01 +0000"  >&lt;p&gt;That LGTM, but &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=djatnieks&quot; class=&quot;user-hover&quot; rel=&quot;djatnieks&quot;&gt;djatnieks&lt;/a&gt; did you mistag the sincever on this?  I know I changed it to rc4, but that was because you tagged it rc3 and I noticed rc4 hadn&apos;t been created/released in jira yet, so I did that and changed it.&lt;/p&gt;</comment>
                            <comment id="14070727" author="brandon.williams" created="Tue, 22 Jul 2014 19:11:04 +0000"  >&lt;p&gt;Alright, committed this.  Please open a new ticket if you actually can repro this on rc4.&lt;/p&gt;</comment>
                            <comment id="14070789" author="djatnieks" created="Tue, 22 Jul 2014 19:55:04 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=brandon.williams&quot; class=&quot;user-hover&quot; rel=&quot;brandon.williams&quot;&gt;brandon.williams&lt;/a&gt; You&apos;re right, I was on cassandra-2.1, and I was going by what cqlsh reported. Sorry for the confusion. And, yes, I tagged as rc3 because I didn&apos;t find rc4.&lt;/p&gt;</comment>
                            <comment id="14199150" author="lexlythius" created="Wed, 5 Nov 2014 21:40:45 +0000"  >&lt;p&gt;This still happens in version 2.1.1, CQLSH 5.0.1.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&amp;gt; SELECT * from uloc8 where info2 CONTAINS KEY &lt;span class=&quot;code-quote&quot;&gt;&apos;spd&apos;&lt;/span&gt;;
Traceback (most recent call last):
  File &lt;span class=&quot;code-quote&quot;&gt;&quot;/usr/bin/cqlsh&quot;&lt;/span&gt;, line 861, in onecmd
    self.handle_statement(st, statementtext)
  File &lt;span class=&quot;code-quote&quot;&gt;&quot;/usr/bin/cqlsh&quot;&lt;/span&gt;, line 901, in handle_statement
    &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; self.handle_parse_error(cmdword, tokens, parsed, srcstr)
  File &lt;span class=&quot;code-quote&quot;&gt;&quot;/usr/bin/cqlsh&quot;&lt;/span&gt;, line 910, in handle_parse_error
    &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; self.perform_statement(cqlruleset.cql_extract_orig(tokens, srcstr))
  File &lt;span class=&quot;code-quote&quot;&gt;&quot;/usr/bin/cqlsh&quot;&lt;/span&gt;, line 935, in perform_statement
    result = self.perform_simple_statement(stmt)
  File &lt;span class=&quot;code-quote&quot;&gt;&quot;/usr/bin/cqlsh&quot;&lt;/span&gt;, line 968, in perform_simple_statement
    self.print_result(rows, self.parse_for_table_meta(statement.query_string))
  File &lt;span class=&quot;code-quote&quot;&gt;&quot;/usr/bin/cqlsh&quot;&lt;/span&gt;, line 946, in parse_for_table_meta
    parsed = cqlruleset.cql_parse(query_string)[1]
IndexError: list index out of range
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="14199175" author="mshuler" created="Wed, 5 Nov 2014 21:49:47 +0000"  >&lt;p&gt;see:  &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-8258&quot; title=&quot;SELECT ... TOKEN() function broken in C* 2.1.1&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-8258&quot;&gt;&lt;del&gt;CASSANDRA-8258&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12657162" name="7588-cqlsh-6910-contains-allow-filtering.txt" size="1221" author="snazy" created="Tue, 22 Jul 2014 19:07:57 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[snazy]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>406978</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            11 years, 2 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1y17j:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>406997</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>brandon.williams</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[brandon.williams]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12962"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>