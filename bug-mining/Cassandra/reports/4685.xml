<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 23:06:55 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-13340] Bugs handling range tombstones in the sstable iterators</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-13340</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;There is 2 bugs in the way sstable iterators handle range tombstones:&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;empty range tombstones can be returned due to a strict comparison that shouldn&apos;t be.&lt;/li&gt;
	&lt;li&gt;the sstable reversed iterator can actually return completely bogus results when range tombstones are spanning multiple index blocks.&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;The 2 bugs are admittedly separate but as they both impact the same area of code and are both range tombstones related, I suggest just fixing both here (unless something really really mind).&lt;/p&gt;

&lt;p&gt;Marking the ticket critical mostly for the 2nd bug: it can truly make use return bad results on reverse queries.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13056710">CASSANDRA-13340</key>
            <summary>Bugs handling range tombstones in the sstable iterators</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10000" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Urgent</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="slebresne">Sylvain Lebresne</assignee>
                                    <reporter username="slebresne">Sylvain Lebresne</reporter>
                        <labels>
                    </labels>
                <created>Thu, 16 Mar 2017 16:01:44 +0000</created>
                <updated>Tue, 16 Apr 2019 09:30:07 +0000</updated>
                            <resolved>Thu, 23 Mar 2017 16:20:07 +0000</resolved>
                                        <fixVersion>3.0.13</fixVersion>
                    <fixVersion>3.11.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>11</watches>
                                                                                                                <comments>
                            <comment id="15928350" author="slebresne" created="Thu, 16 Mar 2017 16:18:13 +0000"  >&lt;p&gt;Attaching fix for both issue with unit test below. I tried to explain the problems it solves and how it solves it in the patches.&lt;/p&gt;
&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;a href=&quot;https://github.com/pcmanus/cassandra/commits/13340-3.0&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;13340-3.0&lt;/a&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;a href=&quot;http://cassci.datastax.com/job/pcmanus-13340-3.0-testall&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;utests&lt;/a&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;a href=&quot;http://cassci.datastax.com/job/pcmanus-13340-3.0-dtest&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;dtests&lt;/a&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;a href=&quot;https://github.com/pcmanus/cassandra/commits/13340-3.11&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;13340-3.11&lt;/a&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;a href=&quot;http://cassci.datastax.com/job/pcmanus-13340-3.11-testall&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;utests&lt;/a&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;a href=&quot;http://cassci.datastax.com/job/pcmanus-13340-3.11-dtest&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;dtests&lt;/a&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;
</comment>
                            <comment id="15929099" author="mkjellman" created="Thu, 16 Mar 2017 23:06:52 +0000"  >&lt;p&gt;did you mean to commit this line in one of the unit tests commented out?&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/pcmanus/cassandra/commit/66100ffecba6ff55027f6e85b29efaf98700edaa#diff-70d3a7f61389330811d6eb2f7d2d1b76R1391&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/pcmanus/cassandra/commit/66100ffecba6ff55027f6e85b29efaf98700edaa#diff-70d3a7f61389330811d6eb2f7d2d1b76R1391&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15929568" author="slebresne" created="Fri, 17 Mar 2017 08:17:49 +0000"  >&lt;p&gt;Forgot to remove it, sorry, I can do so on commit though if that&apos;s fine (it&apos;s not needed for the test to reproduce the failure and I prefer unit test to be as focused as possible, but I indeed forgot to remove it entirely). Thanks for the notice.&lt;/p&gt;</comment>
                            <comment id="15938125" author="blambov" created="Thu, 23 Mar 2017 11:19:52 +0000"  >&lt;p&gt;I think this is correct but I find the terminology confusing. Previous block &lt;a href=&quot;https://github.com/pcmanus/cassandra/commit/75a0c57b3c130343dd8068e32ef096e3057191e9#diff-68d265d33b5303cd50645cb4a7eba569R309&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;sometimes&lt;/a&gt; means the next we&apos;ll iterate to (previous on disk), &lt;a href=&quot;https://github.com/pcmanus/cassandra/commit/75a0c57b3c130343dd8068e32ef096e3057191e9#diff-68d265d33b5303cd50645cb4a7eba569R327&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;other times&lt;/a&gt; the previous we iterated. I&apos;d prefer a consistent meaning for these; it looks like the new code is at odds with the previous convention on these, so the meanings of &lt;tt&gt;hasPrevious/NextBlock&lt;/tt&gt; need reversing. &lt;tt&gt;skipLast/First&lt;/tt&gt; have the same problem, I&apos;d at least add &lt;tt&gt;IteratedItem&lt;/tt&gt; to their names to add a little clarity.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/pcmanus/cassandra/commit/75a0c57b3c130343dd8068e32ef096e3057191e9#diff-68d265d33b5303cd50645cb4a7eba569R334&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;&lt;tt&gt;canIncludeSliceStart/End&lt;/tt&gt;&lt;/a&gt; appear to have exactly the opposite meaning of &lt;tt&gt;hasPrevious/NextBlock&lt;/tt&gt;. I can see &lt;tt&gt;loadFromDisk&lt;/tt&gt; needs separate booleans for the difference in the non-indexed case, but &lt;tt&gt;readCurrentBlock&lt;/tt&gt; can do without the latter, can&apos;t it?&lt;/p&gt;</comment>
                            <comment id="15938545" author="slebresne" created="Thu, 23 Mar 2017 15:14:06 +0000"  >&lt;blockquote&gt;&lt;p&gt;Previous block sometimes means the next we&apos;ll iterate to (previous on disk), other times the previous we iterated.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;You&apos;re right, that&apos;s confusing. That said, I tried switching the newly introduced &lt;tt&gt;hasPrevious/NextBlock&lt;/tt&gt; but at least to me that felt pretty confusing, so I decide to switch the existing usage. Basically feels more logical to me, though that&apos;s possibly somewhat personal. In any case it&apos;s consistent now, previous/next refer to the previous/next block we&apos;ll iterate.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;&lt;tt&gt;skipLast/First&lt;/tt&gt; have the same problem&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;If you mean that first/last can be a tad confused when we&apos;re reading a block in one sense but iterating on its items afterward in the other sense, then I agree, but I didn&apos;t felt inverting those was really improving things. I did added &lt;tt&gt;IteratedItem&lt;/tt&gt; and completed the comments so it&apos;s hopefully more clear.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;but &lt;tt&gt;readCurrentBlock&lt;/tt&gt; can do without the latter, can&apos;t it?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Absolutely, removed the redundant argument, thanks.&lt;/p&gt;</comment>
                            <comment id="15938583" author="blambov" created="Thu, 23 Mar 2017 15:38:08 +0000"  >&lt;p&gt;LGTM&lt;/p&gt;

&lt;p&gt;Nit: there are a few more inverted meanings: &lt;a href=&quot;https://github.com/pcmanus/cassandra/blob/94c0a9cca6b072e5f35c666c56e7ad1eb0577e7c/src/java/org/apache/cassandra/db/columniterator/SSTableReversedIterator.java#L189&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;in these two comments&lt;/a&gt; as well as &lt;a href=&quot;https://github.com/pcmanus/cassandra/blob/94c0a9cca6b072e5f35c666c56e7ad1eb0577e7c/src/java/org/apache/cassandra/db/columniterator/SSTableReversedIterator.java#L352&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;this &lt;tt&gt;lastOfPrevious&lt;/tt&gt;&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="15938684" author="slebresne" created="Thu, 23 Mar 2017 16:20:07 +0000"  >&lt;p&gt;Committed (with nits fixed), thanks.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[slebresne]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 34 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3cdjb:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>blambov</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[blambov]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12963"><![CDATA[Critical]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>