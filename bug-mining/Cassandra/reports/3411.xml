<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 22:51:17 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-8689] Assertion error in 2.1.2: ERROR [IndexSummaryManager:1]</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-8689</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;After upgrading a 6 nodes cassandra from 2.1.0 to 2.1.2, start getting the following assertion error.&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;ERROR [IndexSummaryManager:1] 2015-01-26 20:55:40,451 CassandraDaemon.java:153 - Exception in thread Thread[IndexSummaryManager:1,1,main]
java.lang.AssertionError: null
        at org.apache.cassandra.io.util.Memory.size(Memory.java:307) ~[apache-cassandra-2.1.2.jar:2.1.2]
        at org.apache.cassandra.io.sstable.IndexSummary.getOffHeapSize(IndexSummary.java:192) ~[apache-cassandra-2.1.2.jar:2.1.2]
        at org.apache.cassandra.io.sstable.SSTableReader.getIndexSummaryOffHeapSize(SSTableReader.java:1070) ~[apache-cassandra-2.1.2.jar:2.1.2]
        at org.apache.cassandra.io.sstable.IndexSummaryManager.redistributeSummaries(IndexSummaryManager.java:292) ~[apache-cassandra-2.1.2.jar:2.1.2]
        at org.apache.cassandra.io.sstable.IndexSummaryManager.redistributeSummaries(IndexSummaryManager.java:238) ~[apache-cassandra-2.1.2.jar:2.1.2]
        at org.apache.cassandra.io.sstable.IndexSummaryManager$1.runMayThrow(IndexSummaryManager.java:139) ~[apache-cassandra-2.1.2.jar:2.1.2]
        at org.apache.cassandra.utils.WrappedRunnable.run(WrappedRunnable.java:28) ~[apache-cassandra-2.1.2.jar:2.1.2]
        at org.apache.cassandra.concurrent.DebuggableScheduledThreadPoolExecutor$UncomplainingRunnable.run(DebuggableScheduledThreadPoolExecutor.java:77) ~[apache-cassandra-2.1.2.jar:2.1.2]
        at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:471) [na:1.7.0_45]
        at java.util.concurrent.FutureTask.runAndReset(FutureTask.java:304) [na:1.7.0_45]
        at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.access$301(ScheduledThreadPoolExecutor.java:178) [na:1.7.0_45]
        at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:293) [na:1.7.0_45]
        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1145) [na:1.7.0_45]
        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:615) [na:1.7.0_45]
        at java.lang.Thread.run(Thread.java:744) [na:1.7.0_45]
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;cassandra service is still running despite the issue. Node has total 8G memory with 2G allocated to heap. We are basically running read queries to retrieve data out of cassandra.&lt;/p&gt;

</description>
                <environment></environment>
        <key id="12770196">CASSANDRA-8689</key>
            <summary>Assertion error in 2.1.2: ERROR [IndexSummaryManager:1]</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10002" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Normal</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="benedict">Benedict Elliott Smith</assignee>
                                    <reporter username="jeffl">Jeff Liu</reporter>
                        <labels>
                    </labels>
                <created>Mon, 26 Jan 2015 21:39:04 +0000</created>
                <updated>Tue, 16 Apr 2019 09:31:22 +0000</updated>
                            <resolved>Wed, 4 Mar 2015 16:08:25 +0000</resolved>
                                        <fixVersion>2.1.5</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="14299350" author="thobbs" created="Fri, 30 Jan 2015 23:08:55 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jeffl&quot; class=&quot;user-hover&quot; rel=&quot;jeffl&quot;&gt;jeffl&lt;/a&gt; can you enable TRACE level logging on the IndexSummaryManager class to see if we can get more details about what might be happening?&lt;/p&gt;

&lt;p&gt;You should be able to do that by adding the following line to &lt;tt&gt;logback.xml&lt;/tt&gt;:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;&amp;lt;logger name=&quot;org.apache.cassandra.io.sstable.IndexSummaryManager&quot; level=&quot;TRACE&quot;/&amp;gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The IndexSummaryManager runs a resize process once every hour (by default), so it may take a while to see something in the logs.&lt;/p&gt;</comment>
                            <comment id="14299920" author="benedict" created="Sat, 31 Jan 2015 18:19:49 +0000"  >&lt;p&gt;I&apos;ve been meaning to file a bug about something for a while, after investigating if it happens anywhere, and it looks to me like this may be it in action (in one of many potential bolt holes).&lt;/p&gt;

&lt;p&gt;In markCompacting we don&apos;t ensure the sstable we&apos;re marking compacting is actually in the set of live sstables. So we really need to take a reference either before or after marking compacting, or we need to ensure the intersection with the live set is the same as the set we are marking. We can&apos;t do this universally, though, because we sometimes deliberately markCompacting files not in the live set.&lt;/p&gt;

&lt;p&gt;Anyway, the upshot is that if we don&apos;t do this we can start working on a file that has been dropped and cleaned up. The race window for grabbing such a file is narrow, but the window over which it can cause problems once we do is unbounded.&lt;/p&gt;

&lt;p&gt;IndexSummaryManager.getCompactingAndNonCompactingSSTables looks to me to exhibit this race condition.&lt;/p&gt;</comment>
                            <comment id="14301596" author="jeffl" created="Mon, 2 Feb 2015 18:24:06 +0000"  >&lt;p&gt;Surprised to know that there are so much information behind this blur java assertion error. Thank you Benedict for the info. What is the impact of this issue without fix? are in some kind of compacting danger ? I guess I&apos;m really asking for the criticality of this issue. Thanks.&lt;/p&gt;</comment>
                            <comment id="14301599" author="benedict" created="Mon, 2 Feb 2015 18:26:01 +0000"  >&lt;p&gt;It is unlikely this will cause any degradation to your cluster. The problem should just prevent summaries from being redistributed at that moment in time, which is a harmless setback.&lt;/p&gt;</comment>
                            <comment id="14307404" author="benedict" created="Thu, 5 Feb 2015 15:27:39 +0000"  >&lt;p&gt;&lt;del&gt;Can we get a bisect run on this?&lt;/del&gt;&lt;/p&gt;

&lt;p&gt;Scratch that; wrong memory bug ticket.&lt;/p&gt;</comment>
                            <comment id="14308004" author="benedict" created="Thu, 5 Feb 2015 21:10:59 +0000"  >&lt;p&gt;Patch available &lt;a href=&quot;https://github.com/belliottsmith/cassandra/tree/8689-racemarkcompact&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;here&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This converts the Set of live sstables in DataTracker.View to a Map, so that we can easily perform identity checks as well as equality checks. When marking compacting, we now indicate if we expect the sstables to be present (by default we do), and we then check that not only are they all present in the live set, but that the exact instance present is the one we made our decision to compact against.&lt;/p&gt;</comment>
                            <comment id="14310006" author="jbellis" created="Fri, 6 Feb 2015 21:54:21 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tjake&quot; class=&quot;user-hover&quot; rel=&quot;tjake&quot;&gt;tjake&lt;/a&gt; to review&lt;/p&gt;</comment>
                            <comment id="14316974" author="tjake" created="Wed, 11 Feb 2015 21:04:03 +0000"  >&lt;p&gt;Apologies for the delay, could you rebase this?&lt;/p&gt;

&lt;p&gt;It would be good to put your comment above as a code comment explaining any why we need sstable map. &lt;br/&gt;
I&apos;ve been trying to trigger this issue with stress by re summarizing every 1 minute.  I agree with your guess that this is the problem causing this error but it would be great to repro.&lt;/p&gt;</comment>
                            <comment id="14317933" author="benedict" created="Thu, 12 Feb 2015 10:07:25 +0000"  >&lt;p&gt;Rebased and pushed with the comment included above the sstablesMap property. &lt;/p&gt;

&lt;p&gt;Not totally sure about the best way to exhibit this bug. Reckon a unit test for the act of marking compacting something we shouldn&apos;t be able to (i.e. something not in the live set) would be sufficient? Since if it &lt;em&gt;does&lt;/em&gt; occur, it can definitely result in this (just with timing issues that are hard to replicate). We should be able to get that much without too much difficulty.&lt;/p&gt;</comment>
                            <comment id="14319025" author="tjake" created="Thu, 12 Feb 2015 21:38:24 +0000"  >&lt;p&gt;Attaching a test that replicates the issue.  Is still happening with your patch.  This may be a separate issue.&lt;/p&gt;

&lt;p&gt;It might take a few runs before it fails. But happens pretty regularly for me.&lt;/p&gt;</comment>
                            <comment id="14319199" author="benedict" created="Thu, 12 Feb 2015 23:13:54 +0000"  >&lt;p&gt;Well that&apos;s annoying. Nice work reproducing though.&lt;/p&gt;</comment>
                            <comment id="14320016" author="benedict" created="Fri, 13 Feb 2015 12:35:20 +0000"  >&lt;p&gt;If I run this against a merge of my latest branch for 8757 with my branch here, the test passes. With either one it does not. However with both of these branches, this test causes the &lt;em&gt;other&lt;/em&gt; tests to fail, whilst passing itself (and they passing together if this test is excluded), so clearly there&apos;s still some problematic state&lt;/p&gt;</comment>
                            <comment id="14320482" author="benedict" created="Fri, 13 Feb 2015 18:14:08 +0000"  >&lt;p&gt;It looks like that is something else entirely, caused by that test leaving an infinite loop of summary redistribution running. I&apos;ve filed &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-8805&quot; title=&quot;runWithCompactionsDisabled only cancels compactions, which is not the only source of markCompacted&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-8805&quot;&gt;&lt;del&gt;CASSANDRA-8805&lt;/del&gt;&lt;/a&gt; to deal with that. So, those two patches together fixes the problem, although why that is I am not certain.&lt;/p&gt;</comment>
                            <comment id="14326440" author="tjake" created="Wed, 18 Feb 2015 19:33:29 +0000"  >&lt;p&gt;I&apos;m not able to apply the patch for 8757 to this one (can you rebase them all?)&lt;/p&gt;</comment>
                            <comment id="14327723" author="benedict" created="Thu, 19 Feb 2015 16:54:51 +0000"  >&lt;p&gt;I&apos;ve rebased both, but you should be able to just merge from one into the other.&lt;/p&gt;</comment>
                            <comment id="14339748" author="tjake" created="Fri, 27 Feb 2015 05:31:22 +0000"  >&lt;p&gt;I&apos;m now seeing many other failures related to index summaries&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;    [echo] running test bucket 0 tests
    [junit] WARNING: multiple versions of ant detected in path &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; junit 
    [junit]          jar:file:/usr/share/ant/lib/ant.jar!/org/apache/tools/ant/Project.class
    [junit]      and jar:file:/home/jake/workspace/cassandra/build/lib/jars/ant-1.6.5.jar!/org/apache/tools/ant/Project.class
    [junit] Testsuite: org.apache.cassandra.io.sstable.IndexSummaryManagerTest
    [junit] Tests run: 6, Failures: 5, Errors: 0, Skipped: 0, Time elapsed: 10.138 sec
    [junit] 
    [junit] ------------- Standard Output ---------------
    [junit] ERROR 05:25:52 LEAK DETECTED: a reference (org.apache.cassandra.utils.concurrent.Ref$State@9f7cd4c) to &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;org.apache.cassandra.io.sstable.SSTableReader$InstanceTidier@1638131854:build/test/cassandra/data:0/Keyspace1/StandardLowIndexInterval-15bf0780be4111e4869db7d84572b531/Keyspace1-StandardLowIndexInterval-ka-2 was not released before the reference was garbage collected
    [junit] ERROR 05:25:52 LEAK DETECTED: a reference (org.apache.cassandra.utils.concurrent.Ref$State@9f7cd4c) to &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;org.apache.cassandra.io.sstable.SSTableReader$InstanceTidier@1638131854:build/test/cassandra/data:0/Keyspace1/StandardLowIndexInterval-15bf0780be4111e4869db7d84572b531/Keyspace1-StandardLowIndexInterval-ka-2 was not released before the reference was garbage collected
    [junit] ERROR 05:25:52 Allocate trace org.apache.cassandra.utils.concurrent.Ref$State@9f7cd4c:
    [junit] &lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;[main,5,main]
    [junit] 	at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.getStackTrace(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:1589)
    [junit] 	at org.apache.cassandra.utils.concurrent.Ref$Debug.&amp;lt;init&amp;gt;(Ref.java:196)
    [junit] 	at org.apache.cassandra.utils.concurrent.Ref$State.&amp;lt;init&amp;gt;(Ref.java:133)
    [junit] 	at org.apache.cassandra.utils.concurrent.Ref.&amp;lt;init&amp;gt;(Ref.java:60)
    [junit] 	at org.apache.cassandra.io.sstable.SSTableReader.&amp;lt;init&amp;gt;(SSTableReader.java:242)
    [junit] 	at org.apache.cassandra.io.sstable.SSTableReader.&amp;lt;init&amp;gt;(SSTableReader.java:605)
    [junit] 	at org.apache.cassandra.io.sstable.SSTableReader.cloneWithNewSummarySamplingLevel(SSTableReader.java:991)
    [junit] 	at org.apache.cassandra.io.sstable.IndexSummaryManager.adjustSamplingLevels(IndexSummaryManager.java:410)
    [junit] 	at org.apache.cassandra.io.sstable.IndexSummaryManager.redistributeSummaries(IndexSummaryManager.java:288)
    [junit] 	at org.apache.cassandra.io.sstable.IndexSummaryManagerTest.testChangeMaxIndexInterval(IndexSummaryManagerTest.java:319)
    [junit] 	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
    [junit] 	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:57)
    [junit] 	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
    [junit] 	at java.lang.reflect.Method.invoke(Method.java:606)
    [junit] 	at org.junit.runners.model.FrameworkMethod$1.runReflectiveCall(FrameworkMethod.java:44)
    [junit] 	at org.junit.internal.runners.model.ReflectiveCallable.run(ReflectiveCallable.java:15)
    [junit] 	at org.junit.runners.model.FrameworkMethod.invokeExplosively(FrameworkMethod.java:41)
    [junit] 	at org.junit.internal.runners.statements.InvokeMethod.evaluate(InvokeMethod.java:20)
    [junit] 	at org.junit.internal.runners.statements.RunBefores.evaluate(RunBefores.java:28)
    [junit] 	at org.junit.internal.runners.statements.RunAfters.evaluate(RunAfters.java:31)
    [junit] 	at org.junit.runners.BlockJUnit4ClassRunner.runChild(BlockJUnit4ClassRunner.java:70)
    [junit] 	at org.junit.runners.BlockJUnit4ClassRunner.runChild(BlockJUnit4ClassRunner.java:44)
    [junit] 	at org.junit.runners.ParentRunner.runChildren(ParentRunner.java:180)
    [junit] 	at org.junit.runners.ParentRunner.access$000(ParentRunner.java:41)
    [junit] 	at org.junit.runners.ParentRunner$1.evaluate(ParentRunner.java:173)
    [junit] 	at org.junit.internal.runners.statements.RunBefores.evaluate(RunBefores.java:28)
    [junit] 	at org.junit.internal.runners.statements.RunAfters.evaluate(RunAfters.java:31)
    [junit] 	at org.junit.runners.ParentRunner.run(ParentRunner.java:220)
    [junit] 	at junit.framework.JUnit4TestAdapter.run(JUnit4TestAdapter.java:39)
    [junit] 	at org.apache.tools.ant.taskdefs.optional.junit.JUnitTestRunner.run(JUnitTestRunner.java:532)
    [junit] 	at org.apache.tools.ant.taskdefs.optional.junit.JUnitTestRunner.launch(JUnitTestRunner.java:1179)
    [junit] 	at org.apache.tools.ant.taskdefs.optional.junit.JUnitTestRunner.main(JUnitTestRunner.java:1030)
    [junit] 
    [junit] ERROR 05:25:52 Allocate trace org.apache.cassandra.utils.concurrent.Ref$State@9f7cd4c:
    [junit] &lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;[main,5,main]
    [junit] 	at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.getStackTrace(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:1589)
    [junit] 	at org.apache.cassandra.utils.concurrent.Ref$Debug.&amp;lt;init&amp;gt;(Ref.java:196)
    [junit] 	at org.apache.cassandra.utils.concurrent.Ref$State.&amp;lt;init&amp;gt;(Ref.java:133)
    [junit] 	at org.apache.cassandra.utils.concurrent.Ref.&amp;lt;init&amp;gt;(Ref.java:60)
    [junit] 	at org.apache.cassandra.io.sstable.SSTableReader.&amp;lt;init&amp;gt;(SSTableReader.java:242)
    [junit] 	at org.apache.cassandra.io.sstable.SSTableReader.&amp;lt;init&amp;gt;(SSTableReader.java:605)
    [junit] 	at org.apache.cassandra.io.sstable.SSTableReader.cloneWithNewSummarySamplingLevel(SSTableReader.java:991)
    [junit] 	at org.apache.cassandra.io.sstable.IndexSummaryManager.adjustSamplingLevels(IndexSummaryManager.java:410)
    [junit] 	at org.apache.cassandra.io.sstable.IndexSummaryManager.redistributeSummaries(IndexSummaryManager.java:288)
    [junit] 	at org.apache.cassandra.io.sstable.IndexSummaryManagerTest.testChangeMaxIndexInterval(IndexSummaryManagerTest.java:319)
    [junit] 	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
    [junit] 	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:57)
    [junit] 	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
    [junit] 	at java.lang.reflect.Method.invoke(Method.java:606)
    [junit] 	at org.junit.runners.model.FrameworkMethod$1.runReflectiveCall(FrameworkMethod.java:44)
    [junit] 	at org.junit.internal.runners.model.ReflectiveCallable.run(ReflectiveCallable.java:15)
    [junit] 	at org.junit.runners.model.FrameworkMethod.invokeExplosively(FrameworkMethod.java:41)
    [junit] 	at org.junit.internal.runners.statements.InvokeMethod.evaluate(InvokeMethod.java:20)
    [junit] 	at org.junit.internal.runners.statements.RunBefores.evaluate(RunBefores.java:28)
    [junit] 	at org.junit.internal.runners.statements.RunAfters.evaluate(RunAfters.java:31)
    [junit] 	at org.junit.runners.BlockJUnit4ClassRunner.runChild(BlockJUnit4ClassRunner.java:70)
    [junit] 	at org.junit.runners.BlockJUnit4ClassRunner.runChild(BlockJUnit4ClassRunner.java:44)
    [junit] 	at org.junit.runners.ParentRunner.runChildren(ParentRunner.java:180)
    [junit] 	at org.junit.runners.ParentRunner.access$000(ParentRunner.java:41)
    [junit] 	at org.junit.runners.ParentRunner$1.evaluate(ParentRunner.java:173)
    [junit] 	at org.junit.internal.runners.statements.RunBefores.evaluate(RunBefores.java:28)
    [junit] 	at org.junit.internal.runners.statements.RunAfters.evaluate(RunAfters.java:31)
    [junit] 	at org.junit.runners.ParentRunner.run(ParentRunner.java:220)
    [junit] 	at junit.framework.JUnit4TestAdapter.run(JUnit4TestAdapter.java:39)
    [junit] 	at org.apache.tools.ant.taskdefs.optional.junit.JUnitTestRunner.run(JUnitTestRunner.java:532)
    [junit] 	at org.apache.tools.ant.taskdefs.optional.junit.JUnitTestRunner.launch(JUnitTestRunner.java:1179)
    [junit] 	at org.apache.tools.ant.taskdefs.optional.junit.JUnitTestRunner.main(JUnitTestRunner.java:1030)
    [junit] 
    [junit] WARN  05:25:52 Unable to cancel in-progress compactions &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; StandardLowIndexInterval.  Perhaps there is an unusually large row in progress somewhere, or the system is simply overloaded.
    [junit] WARN  05:25:52 Unable to cancel in-progress compactions &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; StandardLowIndexInterval.  Perhaps there is an unusually large row in progress somewhere, or the system is simply overloaded.
    [junit] ------------- ---------------- ---------------
    [junit] Testcase: testChangeMinIndexInterval(org.apache.cassandra.io.sstable.IndexSummaryManagerTest):	FAILED
    [junit] expected:&amp;lt;16.0&amp;gt; but was:&amp;lt;8.0&amp;gt;
    [junit] junit.framework.AssertionFailedError: expected:&amp;lt;16.0&amp;gt; but was:&amp;lt;8.0&amp;gt;
    [junit] 	at org.apache.cassandra.io.sstable.IndexSummaryManagerTest.testChangeMinIndexInterval(IndexSummaryManagerTest.java:248)
    [junit] 
    [junit] 
    [junit] Testcase: testChangeMaxIndexInterval(org.apache.cassandra.io.sstable.IndexSummaryManagerTest):	FAILED
    [junit] &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;
    [junit] junit.framework.AssertionFailedError
    [junit] 	at org.apache.cassandra.io.sstable.SSTableReader.setReplacedBy(SSTableReader.java:875)
    [junit] 	at org.apache.cassandra.io.sstable.SSTableReader.cloneWithNewSummarySamplingLevel(SSTableReader.java:996)
    [junit] 	at org.apache.cassandra.io.sstable.IndexSummaryManager.adjustSamplingLevels(IndexSummaryManager.java:410)
    [junit] 	at org.apache.cassandra.io.sstable.IndexSummaryManager.redistributeSummaries(IndexSummaryManager.java:288)
    [junit] 	at org.apache.cassandra.io.sstable.IndexSummaryManagerTest.testChangeMaxIndexInterval(IndexSummaryManagerTest.java:319)
    [junit] 
    [junit] 
    [junit] Testcase: testRedistributeSummaries(org.apache.cassandra.io.sstable.IndexSummaryManagerTest):	FAILED
    [junit] [SSTableReader(path=&lt;span class=&quot;code-quote&quot;&gt;&apos;/home/jake/workspace/cassandra/build/test/cassandra/data:0/Keyspace1/StandardLowIndexInterval-15bf0780be4111e4869db7d84572b531/Keyspace1-StandardLowIndexInterval-ka-2-Data.db&apos;&lt;/span&gt;)]
    [junit] junit.framework.AssertionFailedError: [SSTableReader(path=&lt;span class=&quot;code-quote&quot;&gt;&apos;/home/jake/workspace/cassandra/build/test/cassandra/data:0/Keyspace1/StandardLowIndexInterval-15bf0780be4111e4869db7d84572b531/Keyspace1-StandardLowIndexInterval-ka-2-Data.db&apos;&lt;/span&gt;)]
    [junit] 	at org.apache.cassandra.db.ColumnFamilyStore.discardSSTables(ColumnFamilyStore.java:2889)
    [junit] 	at org.apache.cassandra.db.ColumnFamilyStore$10.run(ColumnFamilyStore.java:2532)
    [junit] 	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:471)
    [junit] 	at org.apache.cassandra.db.ColumnFamilyStore.runWithCompactionsDisabled(ColumnFamilyStore.java:2596)
    [junit] 	at org.apache.cassandra.db.ColumnFamilyStore.truncateBlocking(ColumnFamilyStore.java:2543)
    [junit] 	at org.apache.cassandra.io.sstable.IndexSummaryManagerTest.createSSTables(IndexSummaryManagerTest.java:128)
    [junit] 	at org.apache.cassandra.io.sstable.IndexSummaryManagerTest.testRedistributeSummaries(IndexSummaryManagerTest.java:346)
    [junit] 	at java.util.concurrent.FutureTask.run(FutureTask.java:262)
    [junit] 	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1145)
    [junit] 	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:615)
    [junit] 	at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:745)
    [junit] 
    [junit] 
    [junit] Testcase: testRebuildAtSamplingLevel(org.apache.cassandra.io.sstable.IndexSummaryManagerTest):	FAILED
    [junit] expected:&amp;lt;1&amp;gt; but was:&amp;lt;2&amp;gt;
    [junit] junit.framework.AssertionFailedError: expected:&amp;lt;1&amp;gt; but was:&amp;lt;2&amp;gt;
    [junit] 	at org.apache.cassandra.io.sstable.IndexSummaryManagerTest.testRebuildAtSamplingLevel(IndexSummaryManagerTest.java:481)
    [junit] 
    [junit] 
    [junit] Testcase: testJMXFunctions(org.apache.cassandra.io.sstable.IndexSummaryManagerTest):	FAILED
    [junit] [SSTableReader(path=&lt;span class=&quot;code-quote&quot;&gt;&apos;/home/jake/workspace/cassandra/build/test/cassandra/data:0/Keyspace1/StandardLowIndexInterval-15bf0780be4111e4869db7d84572b531/Keyspace1-StandardLowIndexInterval-ka-2-Data.db&apos;&lt;/span&gt;), SSTableReader(path=&lt;span class=&quot;code-quote&quot;&gt;&apos;/home/jake/workspace/cassandra/build/test/cassandra/data:0/Keyspace1/StandardLowIndexInterval-15bf0780be4111e4869db7d84572b531/Keyspace1-StandardLowIndexInterval-ka-3-Data.db&apos;&lt;/span&gt;)]
    [junit] junit.framework.AssertionFailedError: [SSTableReader(path=&lt;span class=&quot;code-quote&quot;&gt;&apos;/home/jake/workspace/cassandra/build/test/cassandra/data:0/Keyspace1/StandardLowIndexInterval-15bf0780be4111e4869db7d84572b531/Keyspace1-StandardLowIndexInterval-ka-2-Data.db&apos;&lt;/span&gt;), SSTableReader(path=&lt;span class=&quot;code-quote&quot;&gt;&apos;/home/jake/workspace/cassandra/build/test/cassandra/data:0/Keyspace1/StandardLowIndexInterval-15bf0780be4111e4869db7d84572b531/Keyspace1-StandardLowIndexInterval-ka-3-Data.db&apos;&lt;/span&gt;)]
    [junit] 	at org.apache.cassandra.db.ColumnFamilyStore.discardSSTables(ColumnFamilyStore.java:2889)
    [junit] 	at org.apache.cassandra.db.ColumnFamilyStore$10.run(ColumnFamilyStore.java:2532)
    [junit] 	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:471)
    [junit] 	at org.apache.cassandra.db.ColumnFamilyStore.runWithCompactionsDisabled(ColumnFamilyStore.java:2596)
    [junit] 	at org.apache.cassandra.db.ColumnFamilyStore.truncateBlocking(ColumnFamilyStore.java:2543)
    [junit] 	at org.apache.cassandra.io.sstable.IndexSummaryManagerTest.testJMXFunctions(IndexSummaryManagerTest.java:525)
    [junit] 
    [junit] 
    [junit] Test org.apache.cassandra.io.sstable.IndexSummaryManagerTest FAILED

&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="14341734" author="benedict" created="Sat, 28 Feb 2015 19:16:23 +0000"  >&lt;p&gt;Since you&apos;re running 6 tests, I assume you&apos;re running with your test (as stands) included? This breaks the other tests for the two reasons I gave above: &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-8805&quot; title=&quot;runWithCompactionsDisabled only cancels compactions, which is not the only source of markCompacted&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-8805&quot;&gt;&lt;del&gt;CASSANDRA-8805&lt;/del&gt;&lt;/a&gt;, and because the threads are still running mucking around with the state even after the new test finishes successfully.&lt;/p&gt;</comment>
                            <comment id="14343329" author="tjake" created="Mon, 2 Mar 2015 16:20:48 +0000"  >&lt;p&gt;Ah I.C.  I tried cleaning up the tp and compactions and forced the test to run last and that fixed the issue. Attached new test patch.&lt;/p&gt;

&lt;p&gt;So this in conjunction with &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-8757&quot; title=&quot;IndexSummaryBuilder should construct itself offheap, and share memory between the result of each build() invocation&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-8757&quot;&gt;&lt;del&gt;CASSANDRA-8757&lt;/del&gt;&lt;/a&gt; looks good +1&lt;/p&gt;
</comment>
                            <comment id="14347067" author="benedict" created="Wed, 4 Mar 2015 16:08:25 +0000"  >&lt;p&gt;Thanks, committed with your new test&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12701894" name="8689-testv2.txt" size="5826" author="tjake" created="Mon, 2 Mar 2015 16:24:04 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[benedict]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 37 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i24tf3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12311421" key="com.atlassian.jira.plugin.system.customfieldtypes:multiversion">
                        <customfieldname>Reproduced In</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="12328841">2.1.2</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>tjake</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[tjake]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12962"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>