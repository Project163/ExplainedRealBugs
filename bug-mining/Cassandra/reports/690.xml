<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 22:19:00 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-2101] support deletes in counters</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-2101</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;Obey timestampOfLastDelete during reconciliation.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12497514">CASSANDRA-2101</key>
            <summary>support deletes in counters</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10002" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Normal</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="kelvin">Kelvin Kakugawa</assignee>
                                    <reporter username="kelvin">Kelvin Kakugawa</reporter>
                        <labels>
                    </labels>
                <created>Wed, 2 Feb 2011 22:05:51 +0000</created>
                <updated>Tue, 16 Apr 2019 09:33:07 +0000</updated>
                            <resolved>Sat, 5 Feb 2011 05:13:57 +0000</resolved>
                                        <fixVersion>0.8 beta 1</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                                                                <comments>
                            <comment id="12989821" author="kelvin" created="Wed, 2 Feb 2011 22:06:38 +0000"  >&lt;p&gt;timestampOfLastDelete was added and 90% implemented.  Missed this last logic.&lt;/p&gt;</comment>
                            <comment id="12989823" author="kelvin" created="Wed, 2 Feb 2011 22:07:50 +0000"  >&lt;p&gt;add logic to reconcile; test logic.&lt;/p&gt;</comment>
                            <comment id="12989832" author="kelvin" created="Wed, 2 Feb 2011 22:22:32 +0000"  >&lt;p&gt;modified patch w/o dependencies on expiring counter column code.&lt;/p&gt;</comment>
                            <comment id="12990081" author="slebresne" created="Thu, 3 Feb 2011 13:08:02 +0000"  >&lt;p&gt;Before commenting on the patch itself, I want to use this ticket to recall that counter deletes are intrinsically broken. It has been said already but I&apos;ll use this comment to explain in more depth how so and keep a trace of this for the record.&lt;/p&gt;

&lt;p&gt;First, I&apos;ll use the following notation:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;  c(x, 3)@[4, 2] - for a counter column of name x, value 3, timestamp 4 and timestampOfLastDelete 2 (I&apos;ll use -1 as the min timestampOfLastDelete).
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;and&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;  d(x)@[5] - for a tombstone of name x and timestamp 5
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;And now suppose that the following inserts are done (in that order):&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;   c(x, 1)@[1, -1]
   d(x)@[2]
   c(x, 1)@[3, -1]
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;If these inserts are resolved in that order, everything is fine:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;   c(x, 1)@[1, -1]
 + d(x)@[2]
=&amp;gt; d(x)@[2]
 + c(x, 1)@[3, -1]
=&amp;gt; c(x, 1)@[3, 2]
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;However, some reordering don&apos;t work. Namely, if you merge the two counts together, before you merge one of the count with the delete:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;   c(x, 1)@[1, -1]
 + c(x, 1)@[3, -1]
=&amp;gt; c(x, 2)@[3, -1]
 + d(x)@[2]
=&amp;gt; c(x, 2)@[3, 2]
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The problem is, the resolve operation is not commutative when you consider counter columns and tombstones. But Cassandra rely heavily on resolve being commutative (as a side note, I never understood the reason of the CommutativeType terminology in the code. It suggest that regular columns are not commutative, while they are as far as resolve is concerned. Resolve is not idempotent on counters however).&lt;/p&gt;

&lt;p&gt;Not only is there no guarantee on which order the insert will be received by each node, but even if they are in the right order, there is no guarantee that (minor) compaction won&apos;t screw up this.&lt;/p&gt;

&lt;p&gt;Hence I think that there is not much guarantee we can give on deletes. The only one I can think of is that when on issue a delete, you must wait to issue any following update that the delete have reach all the nodes and all of them have been fully compacted.&lt;/p&gt;

&lt;p&gt;That being said, we can keep counter deletes. It&apos;s at least useful for cases where you know that you won&apos;t reuse a counter ever and want to get rid of the disk space. But I would add a very strong warning to its documentation.&lt;/p&gt;

&lt;p&gt;Lastly, the deletion of full counter rows or super columns suffers the same problem for the same reason.&lt;/p&gt;</comment>
                            <comment id="12990082" author="slebresne" created="Thu, 3 Feb 2011 13:08:50 +0000"  >&lt;p&gt;+1 on the patch in the spirit of &quot;let&apos;s make delete work as often as we can&quot;.&lt;/p&gt;

&lt;p&gt;However, I realized that the first &apos;if&apos; of CounterColumn.reconcile() is dead-code since a CounterColumn is never markedForDelete(). It would be nice to remove it while submitting this&lt;/p&gt;</comment>
                            <comment id="12990301" author="kelvin" created="Thu, 3 Feb 2011 20:55:13 +0000"  >&lt;p&gt;Good point, Sylvain!&lt;/p&gt;

&lt;p&gt;Attached a new patch w/ the irrelevant code removed.&lt;/p&gt;</comment>
                            <comment id="12990542" author="slebresne" created="Fri, 4 Feb 2011 12:10:18 +0000"  >&lt;p&gt;So +1 on the new patch&lt;/p&gt;</comment>
                            <comment id="12990916" author="jbellis" created="Sat, 5 Feb 2011 05:13:57 +0000"  >&lt;p&gt;committed&lt;/p&gt;</comment>
                            <comment id="12990923" author="hudson" created="Sat, 5 Feb 2011 06:42:05 +0000"  >&lt;p&gt;Integrated in Cassandra #709 (See &lt;a href=&quot;https://hudson.apache.org/hudson/job/Cassandra/709/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://hudson.apache.org/hudson/job/Cassandra/709/&lt;/a&gt;)&lt;br/&gt;
    add delete support for counters&lt;br/&gt;
patch by Kelvin Kakugawa; reviewed by slebresne for &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-2101&quot; title=&quot;support deletes in counters&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-2101&quot;&gt;&lt;del&gt;CASSANDRA-2101&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10001">
                    <name>dependent</name>
                                            <outwardlinks description="depends upon">
                                        <issuelink>
            <issuekey id="12464162">CASSANDRA-1072</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12494726">CASSANDRA-1936</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12470183" name="0001-CASSANDRA-2101-obey-tsOfLastDelete-remove-irrelevant.patch" size="8266" author="kelvin" created="Thu, 3 Feb 2011 20:55:13 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[kelvin]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>20443</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            14 years, 42 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0g9bj:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>92940</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>slebresne</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[slebresne]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12962"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>