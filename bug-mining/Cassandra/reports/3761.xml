<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 22:56:52 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-9906] get_slice and multiget_slice failing on trunk</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-9906</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;&lt;tt&gt;get_slice&lt;/tt&gt; and &lt;tt&gt;multiget_slice&lt;/tt&gt; are failing on trunk with the following error:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;java.lang.AssertionError: null
	at org.apache.cassandra.db.filter.ClusteringIndexNamesFilter.&amp;lt;init&amp;gt;(ClusteringIndexNamesFilter.java:53) ~[cassandra-all-3.0.0.592.jar:3.0.0.592]
	at org.apache.cassandra.thrift.CassandraServer.toInternalFilter(CassandraServer.java:405) ~[cassandra-all-3.0.0.592.jar:5.0.0-SNAPSHOT]
	at org.apache.cassandra.thrift.CassandraServer.multigetSliceInternal(CassandraServer.java:547) ~[cassandra-all-3.0.0.592.jar:5.0.0-SNAPSHOT]
	at org.apache.cassandra.thrift.CassandraServer.multiget_slice(CassandraServer.java:348) ~[cassandra-all-3.0.0.592.jar:5.0.0-SNAPSHOT]
	at org.apache.cassandra.thrift.Cassandra$Processor$multiget_slice.getResult(Cassandra.java:3716) ~[cassandra-thrift-3.0.0.592.jar:5.0.0-SNAPSHOT]
	at org.apache.cassandra.thrift.Cassandra$Processor$multiget_slice.getResult(Cassandra.java:3700) ~[cassandra-thrift-3.0.0.592.jar:5.0.0-SNAPSHOT]
	at org.apache.thrift.ProcessFunction.process(ProcessFunction.java:39) ~[libthrift-0.9.2.jar:0.9.2]
	at org.apache.thrift.TBaseProcessor.process(TBaseProcessor.java:39) ~[libthrift-0.9.2.jar:0.9.2]
	at org.apache.cassandra.thrift.CustomTThreadPoolServer$WorkerProcess.run(CustomTThreadPoolServer.java:204) ~[cassandra-all-3.0.0.592.jar:5.0.0-SNAPSHOT]
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1142) ~[na:1.8.0_45]
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:617) ~[na:1.8.0_45]
	at java.lang.Thread.run(Thread.java:745) ~[na:1.8.0_45]
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;The schema used for this was&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;create table test (k int, v int, primary key(k)) with compact storage;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;and the code used for the call was&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;        SlicePredicate predicate = new SlicePredicate();
        predicate.column_names = Collections.singletonList(ByteBufferUtil.bytes(&quot;v&quot;));
        client.multiget_slice(Collections.singletonList(key), new ColumnParent(&quot;test&quot;), predicate, ConsistencyLevel.ONE);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;The error is coming from this line in &lt;tt&gt;ClusteringIndexNamesFilter&lt;/tt&gt;&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;        assert !clusterings.contains(Clustering.STATIC_CLUSTERING);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;which is failing the assertion because column &apos;v&apos; is static.&lt;/p&gt;

&lt;p&gt;Apologies for the line mismatches in &lt;tt&gt;ClusteringIndexNamesFilter&lt;/tt&gt; I had some debug statements in the code to help track down what was happening&lt;/p&gt;</description>
                <environment></environment>
        <key id="12849570">CASSANDRA-9906</key>
            <summary>get_slice and multiget_slice failing on trunk</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10000" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Urgent</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="blerer">Benjamin Lerer</assignee>
                                    <reporter username="mike_tr_adamson">Mike Adamson</reporter>
                        <labels>
                    </labels>
                <created>Tue, 28 Jul 2015 09:58:53 +0000</created>
                <updated>Tue, 16 Apr 2019 09:31:03 +0000</updated>
                            <resolved>Mon, 24 Aug 2015 12:52:01 +0000</resolved>
                                        <fixVersion>3.0 beta 2</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>8</watches>
                                                                                                                <comments>
                            <comment id="14654451" author="thobbs" created="Tue, 4 Aug 2015 22:14:51 +0000"  >&lt;p&gt;I won&apos;t be able to get to this soon, so reassigning to &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=blerer&quot; class=&quot;user-hover&quot; rel=&quot;blerer&quot;&gt;blerer&lt;/a&gt;.  You should be able to add a test case to the &lt;tt&gt;thrift_tests.py&lt;/tt&gt; dtest to reproduce the issue.&lt;/p&gt;</comment>
                            <comment id="14681788" author="blerer" created="Tue, 11 Aug 2015 13:22:21 +0000"  >&lt;p&gt;The patch makes sure that clusterings does no include &lt;tt&gt;STATIC_CLUSTERING&lt;/tt&gt; and fix the creation of the &lt;tt&gt;ColumnFilter&lt;/tt&gt;.&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;The unit test results are &lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/blerer/job/blerer-9906-testall/lastCompletedBuild/testReport/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;here&lt;/a&gt;&lt;/li&gt;
	&lt;li&gt;The DTest results are &lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/blerer/job/blerer-9906-dtest/lastCompletedBuild/testReport/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;here&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="14681790" author="blerer" created="Tue, 11 Aug 2015 13:23:08 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=Stefania&quot; class=&quot;user-hover&quot; rel=&quot;stefania&quot;&gt;Stefania&lt;/a&gt; can you review?&lt;/p&gt;</comment>
                            <comment id="14681810" author="stefania" created="Tue, 11 Aug 2015 13:41:43 +0000"  >&lt;p&gt;Sure.&lt;/p&gt;</comment>
                            <comment id="14692676" author="stefania" created="Wed, 12 Aug 2015 00:52:47 +0000"  >&lt;p&gt;+1, provided we fix the imports, they are not needed and out of order.&lt;/p&gt;

&lt;p&gt;A number of unit tests have been fixed on 3.0 I believe, so the failing utests don&apos;t match 3.0. A couple of dtests also don&apos;t fail on 3.0, but did not check thoroughly. I&apos;ve run the mismatched failing utests and dtests on my box and they pass locally, so they should be unrelated. However we may want to run the patch on cassci one more time before committing.&lt;/p&gt;</comment>
                            <comment id="14697596" author="blerer" created="Fri, 14 Aug 2015 19:29:29 +0000"  >&lt;ul&gt;
	&lt;li&gt;The results of the tests are &lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/blerer/job/blerer-9906-testall/lastCompletedBuild/testReport/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;here&lt;/a&gt;&lt;/li&gt;
	&lt;li&gt;The results of the Dtests are &lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/blerer/job/blerer-9906-dtest/lastCompletedBuild/testReport/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;here&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;As we have a lot of DTests failing on 3.0, it is difficult to be fully sure that the patch does not break anything. I have checked the failing DTests and it seems that the failures are not related to the patch.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=iamaleksey&quot; class=&quot;user-hover&quot; rel=&quot;iamaleksey&quot;&gt;iamaleksey&lt;/a&gt; could you have a quick look to the patch to be sure that we did not miss anything?&lt;/p&gt;</comment>
                            <comment id="14698889" author="stefania" created="Sun, 16 Aug 2015 23:31:12 +0000"  >&lt;p&gt;The utests are definitely OK and the dtests seem inline with 3.0 so I am +1.&lt;/p&gt;</comment>
                            <comment id="14699691" author="slebresne" created="Mon, 17 Aug 2015 15:34:08 +0000"  >&lt;p&gt;The fix of the static clustering is clearly fine, but could you comment on the &lt;tt&gt;ColumnFilter&lt;/tt&gt; creation change? Because you&apos;ve changed it so that all columns of a row are queried, but that&apos;s not what we want for thrift and those change looks a priori incorrect. Is the test failing without this change, and can you explain why?&lt;/p&gt;</comment>
                            <comment id="14699729" author="blerer" created="Mon, 17 Aug 2015 15:57:48 +0000"  >&lt;p&gt;I will have another look at the patch as this change is probably wrong. The original &lt;tt&gt;ColumnFilter&lt;/tt&gt; was not working properly and the thrift call was not returning anything. I changed it to make it work but I did not realize that I was returning more data than expected. &lt;/p&gt;</comment>
                            <comment id="14707282" author="blerer" created="Fri, 21 Aug 2015 19:10:42 +0000"  >&lt;p&gt;The new patch is &lt;a href=&quot;https://github.com/apache/cassandra/compare/trunk...blerer:9906&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;here&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;It fix the problem by adding for static compact tables the &lt;tt&gt;value&lt;/tt&gt; column to the &lt;tt&gt;ColumnFilter&lt;/tt&gt;. &lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;The results of the unit tests are &lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/blerer/job/blerer-9906-testall/7/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;here&lt;/a&gt;&lt;/li&gt;
	&lt;li&gt;The results of the DTests are &lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/blerer/job/blerer-9906-dtest/6/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;here&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=slebresne&quot; class=&quot;user-hover&quot; rel=&quot;slebresne&quot;&gt;slebresne&lt;/a&gt;, does it look good to you?&lt;/p&gt;</comment>
                            <comment id="14707310" author="slebresne" created="Fri, 21 Aug 2015 19:28:15 +0000"  >&lt;p&gt;The patch looks good in principle but there seems to be more failure on both unit and dtest than we currently have on the cassandra-3.0. Maybe you haven&apos;t rebased that branch in a while?&lt;/p&gt;</comment>
                            <comment id="14707371" author="blerer" created="Fri, 21 Aug 2015 19:59:01 +0000"  >&lt;p&gt;I have pushed a rebased version. Waiting for CI-results.&lt;/p&gt;</comment>
                            <comment id="14708948" author="blerer" created="Mon, 24 Aug 2015 08:19:25 +0000"  >&lt;p&gt;The results for the last run of the unit tests and DTests are &lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/blerer/job/blerer-9906-testall/8/testReport/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;here&lt;/a&gt; and &lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/blerer/job/blerer-9906-dtest/7/testReport/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;here&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14709025" author="slebresne" created="Mon, 24 Aug 2015 09:43:09 +0000"  >&lt;p&gt;CI looks good, +1 from me.&lt;/p&gt;</comment>
                            <comment id="14709183" author="blerer" created="Mon, 24 Aug 2015 12:35:59 +0000"  >&lt;p&gt;Final version of the patch&lt;/p&gt;</comment>
                            <comment id="14709211" author="blerer" created="Mon, 24 Aug 2015 12:52:01 +0000"  >&lt;p&gt;Cassandra commit: 706ba8767e7339e0af5eebf84cc61bc21883f6e0&lt;br/&gt;
DTest commit: a7617bb3965f93e2130021622b33f52e23799e9c&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12752007" name="9906-V2.txt" size="2837" author="blerer" created="Mon, 24 Aug 2015 12:35:59 +0000"/>
                            <attachment id="12749836" name="9906.txt" size="2780" author="blerer" created="Tue, 11 Aug 2015 13:22:21 +0000"/>
                            <attachment id="12749837" name="dtest-CASSANDRA-9906.txt" size="2081" author="blerer" created="Tue, 11 Aug 2015 13:22:21 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[blerer]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 13 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2i0dj:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>stefania</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[stefania]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12963"><![CDATA[Critical]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>