<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 22:52:20 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-7292] Can&apos;t seed new node into ring with (public) ip of an old node</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-7292</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;This bug prevents node to return with bootstrap into the cluster with its old ip.&lt;/p&gt;

&lt;p&gt;Scenario: five node ec2 cluster spread into three AZ, all in one region. I&apos;m using Ec2MultiRegionSnitch. Nodes are reported with their public ips (as Ec2MultiRegionSnitch requires)&lt;/p&gt;

&lt;p&gt;I simulated a loss of one node by terminating one instance. nodetool status reported correctly that node was down. Then I launched new instance with the old public ip (i&apos;m using elastic ips) with &quot;Dcassandra.replace_address=IP_ADDRESS&quot; but the new node can&apos;t join the cluster:&lt;/p&gt;

&lt;p&gt; INFO 07:20:43,424 Gathering node replacement information for /54.86.191.30&lt;br/&gt;
 INFO 07:20:43,428 Starting Messaging Service on port 9043&lt;br/&gt;
 INFO 07:20:43,489 Handshaking version with /54.86.171.10&lt;br/&gt;
 INFO 07:20:43,491 Handshaking version with /54.86.187.245&lt;br/&gt;
(some delay)&lt;br/&gt;
ERROR 07:21:14,445 Exception encountered during startup&lt;br/&gt;
java.lang.RuntimeException: Unable to gossip with any seeds&lt;br/&gt;
	at org.apache.cassandra.gms.Gossiper.doShadowRound(Gossiper.java:1193)&lt;br/&gt;
	at org.apache.cassandra.service.StorageService.prepareReplacementInfo(StorageService.java:419)&lt;br/&gt;
	at org.apache.cassandra.service.StorageService.prepareToJoin(StorageService.java:650)&lt;br/&gt;
	at org.apache.cassandra.service.StorageService.initServer(StorageService.java:612)&lt;br/&gt;
	at org.apache.cassandra.service.StorageService.initServer(StorageService.java:505)&lt;br/&gt;
	at org.apache.cassandra.service.CassandraDaemon.setup(CassandraDaemon.java:362)&lt;br/&gt;
	at org.apache.cassandra.service.CassandraDaemon.activate(CassandraDaemon.java:480)&lt;br/&gt;
	at org.apache.cassandra.service.CassandraDaemon.main(CassandraDaemon.java:569)&lt;/p&gt;

&lt;p&gt;It does not help if I remove the &quot;Dcassandra.replace_address=IP_ADDRESS&quot; system property. &lt;/p&gt;

&lt;p&gt;Also it does not help to remove the node with &quot;nodetool removenode&quot; with or without the cassandra.replace_address property.&lt;/p&gt;

&lt;p&gt;I think this is because the node information is preserved in the gossip info as seen this output of &quot;nodetool gossipinfo&quot;&lt;br/&gt;
/54.86.191.30&lt;br/&gt;
  INTERNAL_IP:172.16.1.231&lt;br/&gt;
  DC:us-east&lt;br/&gt;
  REMOVAL_COORDINATOR:REMOVER,d581309a-8610-40d4-ba30-cb250eda22a8&lt;br/&gt;
  STATUS:removed,19311925-46b5-4fe4-928a-321e8adb731d,1401089960664&lt;br/&gt;
  HOST_ID:19311925-46b5-4fe4-928a-321e8adb731d&lt;br/&gt;
  RPC_ADDRESS:0.0.0.0&lt;br/&gt;
  NET_VERSION:7&lt;br/&gt;
  SCHEMA:226f9315-b4b2-32c1-bfe1-f4bb49fccfd5&lt;br/&gt;
  RACK:1b&lt;br/&gt;
  LOAD:7.075290515E9&lt;br/&gt;
  SEVERITY:0.0&lt;br/&gt;
  RELEASE_VERSION:2.0.7&lt;/p&gt;

</description>
                <environment>&lt;p&gt;Cassandra 2.0.7, Ec2MultiRegionSnitch&lt;/p&gt;</environment>
        <key id="12716282">CASSANDRA-7292</key>
            <summary>Can&apos;t seed new node into ring with (public) ip of an old node</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10002" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Normal</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="brandon.williams">Brandon Williams</assignee>
                                    <reporter username="garo5">Juho M&#228;kinen</reporter>
                        <labels>
                            <label>bootstrap</label>
                            <label>gossip</label>
                    </labels>
                <created>Fri, 23 May 2014 08:01:44 +0000</created>
                <updated>Tue, 16 Apr 2019 09:31:44 +0000</updated>
                            <resolved>Fri, 17 Apr 2015 22:39:57 +0000</resolved>
                                        <fixVersion>2.0.15</fixVersion>
                    <fixVersion>2.1.5</fixVersion>
                                        <due></due>
                            <votes>2</votes>
                                    <watches>8</watches>
                                                                                                                <comments>
                            <comment id="14007277" author="brandon.williams" created="Fri, 23 May 2014 15:52:03 +0000"  >&lt;p&gt;The dead state isn&apos;t relevant, you more likely have a problem with your seed list like &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-6523&quot; title=&quot;&amp;quot;Unable to contact any seeds!&amp;quot; with multi-DC cluster and listen != broadcast address&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-6523&quot;&gt;&lt;del&gt;CASSANDRA-6523&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14007347" author="garo5" created="Fri, 23 May 2014 16:48:01 +0000"  >&lt;p&gt;I gave a quick read on &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-6523&quot; title=&quot;&amp;quot;Unable to contact any seeds!&amp;quot; with multi-DC cluster and listen != broadcast address&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-6523&quot;&gt;&lt;del&gt;CASSANDRA-6523&lt;/del&gt;&lt;/a&gt; and I&apos;m still digesting the ideas and info on that. To begin with, my seed list contains two public/broadcast ips from the cluster. I haven&apos;t tried specifying private addresses to the seed list, but I can do that on Monday if you feel if that might help. Anyway I agree that the error messages could be made much more informative.&lt;/p&gt;</comment>
                            <comment id="14043243" author="qiny" created="Wed, 25 Jun 2014 09:29:16 +0000"  >&lt;p&gt;Frankly I don&apos;t think &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-6523&quot; title=&quot;&amp;quot;Unable to contact any seeds!&amp;quot; with multi-DC cluster and listen != broadcast address&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-6523&quot;&gt;&lt;del&gt;CASSANDRA-6523&lt;/del&gt;&lt;/a&gt; is relevant to this.&lt;br/&gt;
These involve two different exceptions, RuntimeException(&quot;Unable to gossip with any seeds&quot;) from Gossiper#doShadowRound, which occurs specifically in the node replacement case, and IllegalStateException(&quot;Unable to contact any seeds!&quot;) from StorageService#bootstrap.&lt;/p&gt;

&lt;p&gt;Any further feedback on this issue is appreciated.&lt;/p&gt;</comment>
                            <comment id="14112390" author="jw.clark" created="Wed, 27 Aug 2014 16:18:20 +0000"  >&lt;p&gt;I&apos;m running into this same issue using version 1.2.16. &lt;/p&gt;

&lt;p&gt;The seed list does not appear to be an issue as I have no problems bringing a new node into the cluster with a different public IP address using the same seed list.&lt;/p&gt;

&lt;p&gt;Furthermore, On the seed node I see an incoming TCP connection from the replacement node when I try to start it up:&lt;/p&gt;

&lt;p&gt;Aug 26 21:50:24 &amp;lt;seed node&amp;gt; cassandra:  &lt;span class=&quot;error&quot;&gt;&amp;#91;Thread-9&amp;#93;&lt;/span&gt; DEBUG org.apache.cassandra.net.IncomingTcpConnection  - Connection version 6 from &amp;lt;replacement node public IP&amp;gt;&lt;br/&gt;
Aug 26 21:50:24 &amp;lt;seed node&amp;gt; cassandra:  &lt;span class=&quot;error&quot;&gt;&amp;#91;Thread-9&amp;#93;&lt;/span&gt; DEBUG org.apache.cassandra.net.IncomingTcpConnection  - Upgrading incoming connection to be compressed&lt;br/&gt;
Aug 26 21:50:24 &amp;lt;seed node&amp;gt; cassandra:  &lt;span class=&quot;error&quot;&gt;&amp;#91;Thread-9&amp;#93;&lt;/span&gt; DEBUG org.apache.cassandra.net.IncomingTcpConnection  - Max version for &amp;lt;replacement node public IP&amp;gt; is 6&lt;br/&gt;
Aug 26 21:50:24 &amp;lt;seed node&amp;gt; cassandra:  &lt;span class=&quot;error&quot;&gt;&amp;#91;Thread-9&amp;#93;&lt;/span&gt; DEBUG org.apache.cassandra.net.MessagingService  - Setting version 6 for &amp;lt;replacement node public IP&amp;gt;&lt;br/&gt;
Aug 26 21:50:24 &amp;lt;seed node&amp;gt; cassandra:  &lt;span class=&quot;error&quot;&gt;&amp;#91;Thread-9&amp;#93;&lt;/span&gt; DEBUG org.apache.cassandra.net.IncomingTcpConnection  - Set version for &amp;lt;replacement node public IP&amp;gt; to 6 (will use 6)&lt;br/&gt;
Aug 26 21:50:24 &amp;lt;seed node&amp;gt; cassandra:  &lt;span class=&quot;error&quot;&gt;&amp;#91;GossipStage:1&amp;#93;&lt;/span&gt; DEBUG org.apache.cassandra.gms.Gossiper  - Shadow request received, adding all states&lt;br/&gt;
Aug 26 21:50:50 &amp;lt;seed node&amp;gt; cassandra:  &lt;span class=&quot;error&quot;&gt;&amp;#91;ScheduledTasks:1&amp;#93;&lt;/span&gt; DEBUG org.apache.cassandra.service.LoadBroadcaster  - Disseminating load info ...&lt;br/&gt;
Aug 26 21:50:55 &amp;lt;seed node&amp;gt; cassandra:  &lt;span class=&quot;error&quot;&gt;&amp;#91;Thread-9&amp;#93;&lt;/span&gt; DEBUG org.apache.cassandra.net.MessagingService  - Reseting version for &amp;lt;replacement node public IP&amp;gt;&lt;/p&gt;

&lt;p&gt;Shortly afterward the cassandra service on the replacement node logs the error message reported in the bug description and stops.&lt;/p&gt;

&lt;p&gt;Aug 26 21:50:54 &amp;lt;replacement node&amp;gt; java.lang.RuntimeException:  Unable to gossip with any seeds&lt;br/&gt;
Aug 26 21:50:54 &amp;lt;replacement node&amp;gt;: at org.apache.cassandra.gms.Gossiper.doShadowRound(Gossiper.java:1124)&lt;br/&gt;
Aug 26 21:50:54 &amp;lt;replacement node&amp;gt;:      at org.apache.cassandra.service.StorageService.prepareReplacementInfo(StorageService.java:396)&lt;br/&gt;
Aug 26 21:50:54 &amp;lt;replacement node&amp;gt;:      at org.apache.cassandra.service.StorageService.joinTokenRing(StorageService.java:612)&lt;br/&gt;
Aug 26 21:50:54 &amp;lt;replacement node&amp;gt;:      at org.apache.cassandra.service.StorageService.initServer(StorageService.java:591)&lt;br/&gt;
Aug 26 21:50:54 &amp;lt;replacement node&amp;gt;:      at org.apache.cassandra.service.StorageService.initServer(StorageService.java:480)&lt;br/&gt;
Aug 26 21:50:54 &amp;lt;replacement node&amp;gt;:      at org.apache.cassandra.service.CassandraDaemon.setup(CassandraDaemon.java:348)&lt;br/&gt;
Aug 26 21:50:54 &amp;lt;replacement node&amp;gt;:      at org.apache.cassandra.service.CassandraDaemon.activate(CassandraDaemon.java:447)&lt;br/&gt;
Aug 26 21:50:54 &amp;lt;replacement node&amp;gt;:      at org.apache.cassandra.service.CassandraDaemon.main(CassandraDaemon.java:490)&lt;br/&gt;
Aug 26 21:50:54 &amp;lt;replacement node&amp;gt;:  &lt;span class=&quot;error&quot;&gt;&amp;#91;StorageServiceShutdownHook&amp;#93;&lt;/span&gt; ERROR org.apache.cassandra.service.CassandraDaemon  - Exception in thread Thread&lt;span class=&quot;error&quot;&gt;&amp;#91;StorageServiceShutdownHook,5,main&amp;#93;&lt;/span&gt;&lt;br/&gt;
Aug 26 21:50:54 &amp;lt;replacement node&amp;gt;:      at org.apache.cassandra.gms.Gossiper.stop(Gossiper.java:1193)&lt;br/&gt;
Aug 26 21:50:54 &amp;lt;replacement node&amp;gt;:      at org.apache.cassandra.service.StorageService$1.runMayThrow(StorageService.java:550)&lt;br/&gt;
Aug 26 21:50:54 &amp;lt;replacement node&amp;gt;:      at org.apache.cassandra.utils.WrappedRunnable.run(WrappedRunnable.java:28)&lt;br/&gt;
Aug 26 21:50:54 &amp;lt;replacement node&amp;gt;:      at java.lang.Thread.run(Unknown Source)&lt;/p&gt;</comment>
                            <comment id="14173952" author="brandon.williams" created="Thu, 16 Oct 2014 17:01:08 +0000"  >&lt;p&gt;Closing in favor of 8072 since Ryan can reproduce reliably with a clean setup.&lt;/p&gt;</comment>
                            <comment id="14499848" author="brandon.williams" created="Fri, 17 Apr 2015 13:46:44 +0000"  >&lt;p&gt;Reopening and attaching the possible fix we discovered in 8072. &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=albertsj1&quot; class=&quot;user-hover&quot; rel=&quot;albertsj1&quot;&gt;albertsj1&lt;/a&gt; please update this ticket if this patches solves your problem.&lt;/p&gt;</comment>
                            <comment id="14500557" author="albertsj1" created="Fri, 17 Apr 2015 19:55:58 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=brandon.williams&quot; class=&quot;user-hover&quot; rel=&quot;brandon.williams&quot;&gt;brandon.williams&lt;/a&gt; I was able to get this patch to fix my problem last night but tried again today and couldn&apos;t reproduce.  I think the db had issues from multiple restarts, version switches, etc.  I&apos;m going to start from scratch with a new cluster, re-test, and I&apos;ll get back to you.&lt;/p&gt;</comment>
                            <comment id="14500811" author="albertsj1" created="Fri, 17 Apr 2015 22:31:09 +0000"  >&lt;p&gt;I was able to confirm this patch does indeed seem to fix the problem I was having.  The patch was built against tag &apos;cassandra-2.0.11&apos; running on amazon linux 2014.03.&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=brandon.williams&quot; class=&quot;user-hover&quot; rel=&quot;brandon.williams&quot;&gt;brandon.williams&lt;/a&gt; Thank you for all of your help with providing a fix for this issue.  Can&apos;t wait until it&apos;s in an official release package.&lt;/p&gt;</comment>
                            <comment id="14500827" author="brandon.williams" created="Fri, 17 Apr 2015 22:39:57 +0000"  >&lt;p&gt;Committed, thanks!&lt;/p&gt;</comment>
                            <comment id="14538117" author="aweisberg" created="Mon, 11 May 2015 16:26:03 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=brandon.williams&quot; class=&quot;user-hover&quot; rel=&quot;brandon.williams&quot;&gt;brandon.williams&lt;/a&gt; would this have been good retrospective fodder? We are obviously going to test bootstrapping nodes with the original IP just as part of generally manipulating the cluster. What would we have to test to capture stale state issues like this? How much of it is specific to EC2 configs and snitches and are they testable in non-EC2 configs (and is it common to say how we run on GCE?)&lt;/p&gt;</comment>
                            <comment id="14538175" author="brandon.williams" created="Mon, 11 May 2015 17:00:31 +0000"  >&lt;p&gt;You could test with GPFS instead of EC2, but you&apos;d have to mimic the way EC2&apos;s network (doesn&apos;t) work.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                            <outwardlinks description="duplicates">
                                        <issuelink>
            <issuekey id="12746431">CASSANDRA-8072</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12726158" name="7292.txt" size="1662" author="brandon.williams" created="Fri, 17 Apr 2015 13:46:44 +0000"/>
                            <attachment id="12646471" name="cassandra-replace-address.log" size="122404" author="garo5" created="Fri, 23 May 2014 08:01:44 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[brandon.williams]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>394490</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 28 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1vx8v:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>394631</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12311421" key="com.atlassian.jira.plugin.system.customfieldtypes:multiversion">
                        <customfieldname>Reproduced In</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="12326472">2.0.7</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>albertsj1</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[albertsj1]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12962"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>