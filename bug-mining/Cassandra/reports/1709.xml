<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 22:34:26 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-4442] Stack size settings in cassandra-env.sh assume 64-bit x86</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-4442</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;The fix for &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-4275&quot; title=&quot;Oracle Java 1.7 u4 does not allow Xss128k&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-4275&quot;&gt;&lt;del&gt;CASSANDRA-4275&lt;/del&gt;&lt;/a&gt; hard-codes a 160 KB stack size when using Java 7 on Linux. This assumes the Oracle 7u4 JVM on 64-bit x86. For systems like 32-bit ARM, this size is excessive (the minimum for 7u4 on ARM is 60-64 KB). Also, the minimum allowed value is version-dependent and is calculated dynamically by the JVM on startup based on Linux parameters that can also change. A better approach would be to query the JVM for the minimum stack size.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12599284">CASSANDRA-4442</key>
            <summary>Stack size settings in cassandra-env.sh assume 64-bit x86</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10002" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Normal</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="2">Won&apos;t Fix</resolution>
                                        <assignee username="scurrilous">Trevor Robinson</assignee>
                                    <reporter username="scurrilous">Trevor Robinson</reporter>
                        <labels>
                    </labels>
                <created>Wed, 18 Jul 2012 15:37:25 +0000</created>
                <updated>Tue, 16 Apr 2019 09:32:30 +0000</updated>
                            <resolved>Sat, 10 Aug 2013 21:43:33 +0000</resolved>
                                                            <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="13417180" author="scurrilous" created="Wed, 18 Jul 2012 15:39:59 +0000"  >&lt;p&gt;The attached patch was tested with Oracle 7u4 and OpenJDK 6u24 on amd64, and Oracle 7u4 on ARMv7. Reported stack sizes of 160k, 104k, and 64k, respectively. Just tested startup on amd64, but ran &apos;stress -o insert&apos; on ARM.&lt;/p&gt;

&lt;p&gt;Note that the patch also fixes an issue with &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-4366&quot; title=&quot;add UseCondCardMark XX jvm settings on jdk 1.7&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-4366&quot;&gt;&lt;del&gt;CASSANDRA-4366&lt;/del&gt;&lt;/a&gt; (UseCondCardMark) where JDK 1.7 was only detected on Linux.&lt;/p&gt;</comment>
                            <comment id="13419510" author="brandon.williams" created="Fri, 20 Jul 2012 20:05:26 +0000"  >&lt;p&gt;Committed, though I suspect we&apos;d have the same problem on other operating systems running on ARM.  But we probably won&apos;t see those anytime soon.&lt;/p&gt;</comment>
                            <comment id="13419544" author="brandon.williams" created="Fri, 20 Jul 2012 20:42:33 +0000"  >&lt;p&gt;Reverted, as this is causing failures:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;
java.lang.StackOverflowError
        at java.net.SocketOutputStream.socketWrite0(Native Method)
        at java.net.SocketOutputStream.socketWrite(SocketOutputStream.java:92)
        at java.net.SocketOutputStream.write(SocketOutputStream.java:136)
        at java.io.BufferedOutputStream.flushBuffer(BufferedOutputStream.java:65)
        at java.io.BufferedOutputStream.flush(BufferedOutputStream.java:123)
        at java.io.DataOutputStream.flush(DataOutputStream.java:106)
        at org.apache.cassandra.net.OutboundTcpConnection.writeConnected(OutboundTcpConnection.java:156)
        at org.apache.cassandra.net.OutboundTcpConnection.run(OutboundTcpConnection.java:126)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="13419564" author="scurrilous" created="Fri, 20 Jul 2012 20:59:17 +0000"  >&lt;p&gt;So apparently we don&apos;t want the minimum after all. &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;What type of system hit the failure? Java 6 on amd64, I&apos;m guessing, since it used to use 128k vs 104k.&lt;/p&gt;

&lt;p&gt;Should the patch be changed to add a 25% margin? ((128 - 104) / 104 = ~0.23) This would yield settings of 200k, 130k, and 80k for the systems mentioned in my initial comment.&lt;/p&gt;</comment>
                            <comment id="13419850" author="brandon.williams" created="Sat, 21 Jul 2012 14:06:35 +0000"  >&lt;blockquote&gt;&lt;p&gt;Should the patch be changed to add a 25% margin? &lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I don&apos;t think a fudge factor is something I want in the stack size.  If we have to, I&apos;d prefer explicit arch detection along with the version and have the decision based on those.&lt;/p&gt;</comment>
                            <comment id="13419851" author="brandon.williams" created="Sat, 21 Jul 2012 14:07:13 +0000"  >&lt;blockquote&gt;&lt;p&gt;What type of system hit the failure? Java 6 on amd64, I&apos;m guessing&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Yep.&lt;/p&gt;</comment>
                            <comment id="13419916" author="scurrilous" created="Sat, 21 Jul 2012 19:30:12 +0000"  >&lt;p&gt;How do you propose to determine the correct stack size for a particular arch/version? Even with testing and measurement, it seems like it always has to involve some sort of fudge factor, since the code is non-trivial and ever-changing, and the VM internals are unknown.&lt;/p&gt;

&lt;p&gt;Despite the unflattering label, scaling it based on the JVM minimum doesn&apos;t seem unreasonable, since that value hopefully embodies some knowledge from the VM designer about how the stack is used. Even if you want to maintain a known arch/version table in the script, there should be some fallback logic for new or untested versions. As 7u4 shows, even a minor version update can significantly change stack usage, so fixed values should only be used with a strict arch/version match.&lt;/p&gt;

&lt;p&gt;To look at it another way, we only have 3 (fuzzy) data points now: 128k seems to be the accepted &quot;correct&quot; value for Java 6 on amd64, 160k is known to be too small for 7u4 on amd64 (&lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-4457&quot; title=&quot;Find the cause for the need for a larger stack size with jdk 7&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-4457&quot;&gt;&lt;del&gt;CASSANDRA-4457&lt;/del&gt;&lt;/a&gt;), and 160k is way too big for 32-bit/ARM (even in 7u4). The updated patch hits those points (fixing the stack overflow on 7u4 amd64) and provides a better fallback for other systems than using the &lt;em&gt;much&lt;/em&gt; larger JVM defaults (e.g. 320k for ARM and 1024k for amd64 in 7u4). &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-4457&quot; title=&quot;Find the cause for the need for a larger stack size with jdk 7&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-4457&quot;&gt;&lt;del&gt;CASSANDRA-4457&lt;/del&gt;&lt;/a&gt; may change things, but it&apos;s a difficult issue with minor priority, so it&apos;s hard to imagine it being resolved soon.&lt;/p&gt;</comment>
                            <comment id="13419919" author="scurrilous" created="Sat, 21 Jul 2012 19:50:32 +0000"  >&lt;blockquote&gt;&lt;p&gt;I suspect we&apos;d have the same problem on other operating systems running on ARM.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Unfortunately, there aren&apos;t really any other viable operating systems right now. Oracle &lt;a href=&quot;http://www.oracle.com/technetwork/java/embedded/downloads/javase/index.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;only supports Linux&lt;/a&gt; and OpenJDK has &lt;a href=&quot;http://fullshovel.wordpress.com/2012/07/11/java-vs-c-on-arm/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;abysmal performance&lt;/a&gt; on ARM.&lt;/p&gt;</comment>
                            <comment id="13461982" author="jbellis" created="Mon, 24 Sep 2012 18:35:52 +0000"  >&lt;p&gt;Note that recent 1.6 JVMs need more than the minimum stack size to actually do network operations; we&apos;re using Xss=180, where the minimum is 160.&lt;/p&gt;</comment>
                            <comment id="13473045" author="zenek_kraweznik0" created="Wed, 10 Oct 2012 07:11:08 +0000"  >&lt;p&gt;On 1.6 JVM I&apos;m using Xss=192k, with 180k I&apos;ve seen some errors in log.&lt;/p&gt;

&lt;p&gt;Can we expect fix in 1.1.6 version instead of 1.1.7?&lt;/p&gt;</comment>
                            <comment id="13512028" author="jbellis" created="Thu, 6 Dec 2012 19:20:01 +0000"  >&lt;p&gt;I don&apos;t think we have a good way to autodetect this post-installation.  (Starting up a JVM is just &quot;a way.&quot; &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;Don&apos;t package managers support applying changes for different architectures as appropriate?  That seems like the right way to go here.&lt;/p&gt;</comment>
                            <comment id="13736060" author="jbellis" created="Sat, 10 Aug 2013 21:43:33 +0000"  >&lt;p&gt;Wontfixing for lack of follow up.&lt;/p&gt;</comment>
                            <comment id="13736391" author="scurrilous" created="Sun, 11 Aug 2013 19:24:45 +0000"  >&lt;p&gt;Wasn&apos;t following up for lack of any way forward. &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; You didn&apos;t like my &quot;a way&quot; of starting a JVM, and no one seemed in favor of a hard-coded version lookup table. I&apos;m not sure what package managers have to do with Apache Cassandra. Isn&apos;t it only distributed as a tarball or an architecture-independent .deb?&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12557011">CASSANDRA-4275</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12537007" name="v1-0001-CASSANDRA-4275-Use-JVM-s-reported-minimum-stack-size-o.txt" size="1766" author="scurrilous" created="Wed, 18 Jul 2012 15:39:59 +0000"/>
                            <attachment id="12546357" name="v1-0001-CASSANDRA-4442-Use-JVM-s-reported-minimum-stack-size-o.txt" size="1917" author="scurrilous" created="Mon, 24 Sep 2012 18:32:54 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[scurrilous]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>246154</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            12 years, 15 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i07hsf:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>41649</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>brandon.williams</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[brandon.williams]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12962"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>