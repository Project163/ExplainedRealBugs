<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 23:07:18 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-12728] Handling partially written hint files</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-12728</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;ERROR [HintsDispatcher:1] 2016-09-28 17:44:43,397 HintsDispatchExecutor.java:225 - Failed to dispatch hints file d5d7257c-9f81-49b2-8633-6f9bda6e3dea-1474892654160-1.hints: file is corrupted ({})
org.apache.cassandra.io.FSReadError: java.io.EOFException
        at org.apache.cassandra.hints.HintsReader$BuffersIterator.computeNext(HintsReader.java:282) ~[apache-cassandra-3.0.6.jar:3.0.6]
        at org.apache.cassandra.hints.HintsReader$BuffersIterator.computeNext(HintsReader.java:252) ~[apache-cassandra-3.0.6.jar:3.0.6]
        at org.apache.cassandra.utils.AbstractIterator.hasNext(AbstractIterator.java:47) ~[apache-cassandra-3.0.6.jar:3.0.6]
        at org.apache.cassandra.hints.HintsDispatcher.sendHints(HintsDispatcher.java:156) ~[apache-cassandra-3.0.6.jar:3.0.6]
        at org.apache.cassandra.hints.HintsDispatcher.sendHintsAndAwait(HintsDispatcher.java:137) ~[apache-cassandra-3.0.6.jar:3.0.6]
        at org.apache.cassandra.hints.HintsDispatcher.dispatch(HintsDispatcher.java:119) ~[apache-cassandra-3.0.6.jar:3.0.6]
        at org.apache.cassandra.hints.HintsDispatcher.dispatch(HintsDispatcher.java:91) ~[apache-cassandra-3.0.6.jar:3.0.6]
        at org.apache.cassandra.hints.HintsDispatchExecutor$DispatchHintsTask.deliver(HintsDispatchExecutor.java:259) [apache-cassandra-3.0.6.jar:3.0.6]
        at org.apache.cassandra.hints.HintsDispatchExecutor$DispatchHintsTask.dispatch(HintsDispatchExecutor.java:242) [apache-cassandra-3.0.6.jar:3.0.6]
        at org.apache.cassandra.hints.HintsDispatchExecutor$DispatchHintsTask.dispatch(HintsDispatchExecutor.java:220) [apache-cassandra-3.0.6.jar:3.0.6]
        at org.apache.cassandra.hints.HintsDispatchExecutor$DispatchHintsTask.run(HintsDispatchExecutor.java:199) [apache-cassandra-3.0.6.jar:3.0.6]
        at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511) [na:1.8.0_77]
        at java.util.concurrent.FutureTask.run(FutureTask.java:266) [na:1.8.0_77]
        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1142) [na:1.8.0_77]
        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:617) [na:1.8.0_77]
        at java.lang.Thread.run(Thread.java:745) [na:1.8.0_77]
Caused by: java.io.EOFException: null
        at org.apache.cassandra.io.util.RebufferingInputStream.readFully(RebufferingInputStream.java:68) ~[apache-cassandra-3.0.6.jar:3.0.6]
        at org.apache.cassandra.io.util.RebufferingInputStream.readFully(RebufferingInputStream.java:60) ~[apache-cassandra-3.0.6.jar:3.0.6]
        at org.apache.cassandra.hints.ChecksummedDataInput.readFully(ChecksummedDataInput.java:126) ~[apache-cassandra-3.0.6.jar:3.0.6]
        at org.apache.cassandra.utils.ByteBufferUtil.read(ByteBufferUtil.java:402) ~[apache-cassandra-3.0.6.jar:3.0.6]
        at org.apache.cassandra.hints.HintsReader$BuffersIterator.readBuffer(HintsReader.java:310) ~[apache-cassandra-3.0.6.jar:3.0.6]
        at org.apache.cassandra.hints.HintsReader$BuffersIterator.computeNextInternal(HintsReader.java:301) ~[apache-cassandra-3.0.6.jar:3.0.6]
        at org.apache.cassandra.hints.HintsReader$BuffersIterator.computeNext(HintsReader.java:278) ~[apache-cassandra-3.0.6.jar:3.0.6]
        ... 15 common frames omitted
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;We&apos;ve found out that the hint file was truncated because there was a hard reboot around the time of last write to the file. I think we basically need to handle partially written hint files. Also, the CRC file does not exist in this case (probably because it crashed while writing the hints file). May be ignoring and cleaning up such partially written hint files can be a way to fix this?&lt;/p&gt;</description>
                <environment></environment>
        <key id="13008389">CASSANDRA-12728</key>
            <summary>Handling partially written hint files</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10002" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Normal</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="garvitjuniwal">Garvit Juniwal</assignee>
                                    <reporter username="sharvanath">Sharvanath Pathak</reporter>
                        <labels>
                            <label>lhf</label>
                    </labels>
                <created>Wed, 28 Sep 2016 23:36:14 +0000</created>
                <updated>Fri, 15 May 2020 08:03:03 +0000</updated>
                            <resolved>Tue, 18 Apr 2017 20:29:07 +0000</resolved>
                                        <fixVersion>3.0.14</fixVersion>
                    <fixVersion>3.11.0</fixVersion>
                    <fixVersion>4.0-alpha1</fixVersion>
                    <fixVersion>4.0</fixVersion>
                                    <component>Consistency/Hints</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>14</watches>
                                                                                                                <comments>
                            <comment id="15531256" author="sharvanath" created="Wed, 28 Sep 2016 23:41:01 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=iamaleksey&quot; class=&quot;user-hover&quot; rel=&quot;iamaleksey&quot;&gt;iamaleksey&lt;/a&gt; Can you take a look?&lt;/p&gt;</comment>
                            <comment id="15532281" author="iamaleksey" created="Thu, 29 Sep 2016 09:24:02 +0000"  >&lt;p&gt;This is without compression enabled?&lt;/p&gt;</comment>
                            <comment id="15532285" author="sharvanath" created="Thu, 29 Sep 2016 09:25:37 +0000"  >&lt;p&gt;yeah&lt;/p&gt;</comment>
                            <comment id="15576548" author="garvitjuniwal" created="Fri, 14 Oct 2016 21:29:46 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=iamaleksey&quot; class=&quot;user-hover&quot; rel=&quot;iamaleksey&quot;&gt;iamaleksey&lt;/a&gt; Can you please take a look at the patch? Is that the correct fix? Here is my commit summary:&lt;/p&gt;

&lt;p&gt;If a hints file gets truncated due to a crash, the last hint might have&lt;br/&gt;
been written incompletely. Presence of a corrupted hints file can put&lt;br/&gt;
cassandra in a crash loop trying to read a corrupted hint over and over.&lt;br/&gt;
Ignore and discard the last incomplete hint instead of throwing a&lt;br/&gt;
FSReadError exception.&lt;/p&gt;</comment>
                            <comment id="15604272" author="hari708" created="Tue, 25 Oct 2016 05:36:14 +0000"  >&lt;p&gt;Reproduced the same error in 3.9 also.Run nodetool drain in one node , 3 nodes went down with this error.&lt;/p&gt;

&lt;p&gt;ERROR &lt;span class=&quot;error&quot;&gt;&amp;#91;HintsDispatcher:2&amp;#93;&lt;/span&gt; 2016-10-25 05:08:00,157 HintsDispatchExecutor.java:225 - Failed to dispatch hints file 49c3290a-fafd-456c-966e-8bcd1eab9af8-1477371781565-1.hints: file is corrupted ({})&lt;br/&gt;
org.apache.cassandra.io.FSReadError: java.io.EOFException&lt;br/&gt;
        at org.apache.cassandra.hints.HintsReader$BuffersIterator.computeNext(HintsReader.java:284) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;apache-cassandra-3.9.jar:3.9&amp;#93;&lt;/span&gt;&lt;br/&gt;
        at org.apache.cassandra.hints.HintsReader$BuffersIterator.computeNext(HintsReader.java:254) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;apache-cassandra-3.9.jar:3.9&amp;#93;&lt;/span&gt;&lt;br/&gt;
        at org.apache.cassandra.utils.AbstractIterator.hasNext(AbstractIterator.java:47) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;apache-cassandra-3.9.jar:3.9&amp;#93;&lt;/span&gt;&lt;br/&gt;
        at org.apache.cassandra.hints.HintsDispatcher.sendHints(HintsDispatcher.java:156) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;apache-cassandra-3.9.jar:3.9&amp;#93;&lt;/span&gt;&lt;br/&gt;
        at org.apache.cassandra.hints.HintsDispatcher.sendHintsAndAwait(HintsDispatcher.java:137) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;apache-cassandra-3.9.jar:3.9&amp;#93;&lt;/span&gt;&lt;br/&gt;
        at org.apache.cassandra.hints.HintsDispatcher.dispatch(HintsDispatcher.java:119) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;apache-cassandra-3.9.jar:3.9&amp;#93;&lt;/span&gt;&lt;br/&gt;
        at org.apache.cassandra.hints.HintsDispatcher.dispatch(HintsDispatcher.java:91) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;apache-cassandra-3.9.jar:3.9&amp;#93;&lt;/span&gt;&lt;br/&gt;
        at org.apache.cassandra.hints.HintsDispatchExecutor$DispatchHintsTask.deliver(HintsDispatchExecutor.java:259) &lt;span class=&quot;error&quot;&gt;&amp;#91;apache-cassandra-3.9.jar:3.9&amp;#93;&lt;/span&gt;&lt;br/&gt;
        at org.apache.cassandra.hints.HintsDispatchExecutor$DispatchHintsTask.dispatch(HintsDispatchExecutor.java:242) &lt;span class=&quot;error&quot;&gt;&amp;#91;apache-cassandra-3.9.jar:3.9&amp;#93;&lt;/span&gt;&lt;br/&gt;
        at org.apache.cassandra.hints.HintsDispatchExecutor$DispatchHintsTask.dispatch(HintsDispatchExecutor.java:220) &lt;span class=&quot;error&quot;&gt;&amp;#91;apache-cassandra-3.9.jar:3.9&amp;#93;&lt;/span&gt;&lt;br/&gt;
        at org.apache.cassandra.hints.HintsDispatchExecutor$DispatchHintsTask.run(HintsDispatchExecutor.java:199) &lt;span class=&quot;error&quot;&gt;&amp;#91;apache-cassandra-3.9.jar:3.9&amp;#93;&lt;/span&gt;&lt;br/&gt;
        at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511) &lt;span class=&quot;error&quot;&gt;&amp;#91;na:1.8.0_102&amp;#93;&lt;/span&gt;&lt;br/&gt;
        at java.util.concurrent.FutureTask.run(FutureTask.java:266) &lt;span class=&quot;error&quot;&gt;&amp;#91;na:1.8.0_102&amp;#93;&lt;/span&gt;&lt;br/&gt;
        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1142) &lt;span class=&quot;error&quot;&gt;&amp;#91;na:1.8.0_102&amp;#93;&lt;/span&gt;&lt;br/&gt;
        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:617) &lt;span class=&quot;error&quot;&gt;&amp;#91;na:1.8.0_102&amp;#93;&lt;/span&gt;&lt;br/&gt;
        at java.lang.Thread.run(Thread.java:745) &lt;span class=&quot;error&quot;&gt;&amp;#91;na:1.8.0_102&amp;#93;&lt;/span&gt;&lt;br/&gt;
Caused by: java.io.EOFException: null&lt;br/&gt;
        at org.apache.cassandra.io.util.RebufferingInputStream.readByte(RebufferingInputStream.java:146) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;apache-cassandra-3.9.jar:3.9&amp;#93;&lt;/span&gt;&lt;br/&gt;
        at org.apache.cassandra.io.util.RebufferingInputStream.readPrimitiveSlowly(RebufferingInputStream.java:108) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;apache-cassandra-3.9.jar:3.9&amp;#93;&lt;/span&gt;&lt;br/&gt;
        at org.apache.cassandra.io.util.RebufferingInputStream.readInt(RebufferingInputStream.java:188) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;apache-cassandra-3.9.jar:3.9&amp;#93;&lt;/span&gt;&lt;br/&gt;
        at org.apache.cassandra.hints.HintsReader$BuffersIterator.computeNextInternal(HintsReader.java:297) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;apache-cassandra-3.9.jar:3.9&amp;#93;&lt;/span&gt;&lt;br/&gt;
        at org.apache.cassandra.hints.HintsReader$BuffersIterator.computeNext(HintsReader.java:280) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;apache-cassandra-3.9.jar:3.9&amp;#93;&lt;/span&gt;&lt;br/&gt;
        ... 15 common frames omitted&lt;/p&gt;</comment>
                            <comment id="15610825" author="zznate" created="Thu, 27 Oct 2016 06:11:16 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=garvitjuniwal&quot; class=&quot;user-hover&quot; rel=&quot;garvitjuniwal&quot;&gt;garvitjuniwal&lt;/a&gt; Thank you for the patch, but we should not swallow the exception and continue. Doing so would not inform the operator that they are potentially missing data. &lt;/p&gt;

&lt;p&gt;Further, I&apos;m not sure we &lt;b&gt;want&lt;/b&gt; to continue in this case and it looks to me that HintsDispatchExecutor is doing the right thing. In other words, I would prefer we error out and let the operator make the decision about wether they should delete the specific file and then try again. &lt;/p&gt;

&lt;p&gt;That said, it looks like we do have an issue with the log message:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;HintsDispatchExecutor.java:225 - Failed to dispatch hints file 49c3290a-fafd-456c-966e-8bcd1eab9af8-1477371781565-1.hints: file is corrupted ({})
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The second log parameter which should be the file path is not filled in because the wrong logger invocation is used. A patch for that would be awesome!&lt;/p&gt;</comment>
                            <comment id="15612056" author="iamaleksey" created="Thu, 27 Oct 2016 14:32:08 +0000"  >&lt;p&gt;Could be that a configurable failure policy akin to those we have for commit log might be the best way to go.&lt;/p&gt;</comment>
                            <comment id="15709858" author="brstgt" created="Wed, 30 Nov 2016 21:37:09 +0000"  >&lt;p&gt;+1&lt;/p&gt;

&lt;p&gt;Let the operator decide if he prefers a crash or inconsistency. When not crashing it should be logged as error, so you can check error logs and instead of having to recover from a crash, you could start a repair if desired. The only recovery action one can take is to repair anyway. The only question is how to fail and how to get notified.&lt;br/&gt;
If the node crashes and the operator recognizes too late, situation may become even worse when hints expire.&lt;br/&gt;
The crash doesn&apos;t necessarily happen on startup. It may occur much later if there are a lot of hints and only the very last file is broken.&lt;/p&gt;</comment>
                            <comment id="15931607" author="jjirsa" created="Sun, 19 Mar 2017 08:05:17 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=garvitjuniwal&quot; class=&quot;user-hover&quot; rel=&quot;garvitjuniwal&quot;&gt;garvitjuniwal&lt;/a&gt; - are you still interested in working on this?&lt;/p&gt;
</comment>
                            <comment id="15937459" author="garvitjuniwal" created="Thu, 23 Mar 2017 00:34:25 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jjirsa&quot; class=&quot;user-hover&quot; rel=&quot;jjirsa&quot;&gt;jjirsa&lt;/a&gt;&lt;br/&gt;
Assuming that writes are only acknowledged to client after hints are &quot;synced&quot; to disk, I believe that patch I have is correct because you can safely ignore any partially flushed hint at the end of file that was not synced.&lt;br/&gt;
If hints are written lazily (i.e., writes are acknowledged even before syncing hints to disk,) it is implicit that Cassandra is resilient to loosing hints in face of crashes. Even in this scenario, dropping the last partially written hint is correct.&lt;/p&gt;

&lt;p&gt;I do not understand the suggestion of making this an operator decision. There could be hints that did not make it to disk in the of face of crashes, and I do not know how you would detect them and force a crash.&lt;/p&gt;</comment>
                            <comment id="15937488" author="jjirsa" created="Thu, 23 Mar 2017 01:01:28 +0000"  >&lt;p&gt;Ignore my previous (now deleted) comment - I hadn&apos;t seen your response.  I haven&apos;t yet read the code, so I&apos;m not the best person to answer that. &lt;/p&gt;
</comment>
                            <comment id="15937540" author="jjirsa" created="Thu, 23 Mar 2017 01:46:23 +0000"  >&lt;p&gt;It is true, however, that there are &lt;a href=&quot;https://github.com/apache/cassandra/blob/cassandra-3.9/src/java/org/apache/cassandra/hints/HintsReader.java#L239-L246&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;other places&lt;/a&gt; where we clearly log+skip potentially corrupt data, and hints ARE best effort (but that doesn&apos;t mean they&apos;re so worthless that we want to throw them away, and more importantly, we really need to be careful anytime we see any kind of corruption).&lt;/p&gt;

&lt;p&gt;Also worth noting that we&apos;re failing to calculate the next page, so we don&apos;t know if it&apos;s the last hint, or potentially many many hints. Further, we don&apos;t know if it&apos;s corrupt because we shut down uncleanly, or if it&apos;s corrupt because the disk is failing and giving us invalid blocks.&lt;/p&gt;

&lt;p&gt;If you follow &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=iamaleksey&quot; class=&quot;user-hover&quot; rel=&quot;iamaleksey&quot;&gt;iamaleksey&lt;/a&gt; &apos;s suggestion, though, and make hints inspect errors in the same way the commitlog inspects errors (see &lt;a href=&quot;https://github.com/apache/cassandra/blob/cassandra-3.9/src/java/org/apache/cassandra/db/commitlog/CommitLog.java#L480-L498&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/cassandra/blob/cassandra-3.9/src/java/org/apache/cassandra/db/commitlog/CommitLog.java#L480-L498&lt;/a&gt; and/or &lt;a href=&quot;https://github.com/apache/cassandra/blob/cassandra-3.9/src/java/org/apache/cassandra/db/commitlog/CommitLogReplayer.java#L390-L413&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/cassandra/blob/cassandra-3.9/src/java/org/apache/cassandra/db/commitlog/CommitLogReplayer.java#L390-L413&lt;/a&gt;) , we can let the user decide how paranoid they want to be. &lt;/p&gt;</comment>
                            <comment id="15938918" author="garvitjuniwal" created="Thu, 23 Mar 2017 18:05:18 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jjirsa&quot; class=&quot;user-hover&quot; rel=&quot;jjirsa&quot;&gt;jjirsa&lt;/a&gt; In my patch, the only exception that is ignored is EOF error. So there is no possibility of missing more hints by ignoring this error. From my cursory reading of &lt;a href=&quot;https://github.com/apache/cassandra/blob/cassandra-3.9/src/java/org/apache/cassandra/db/commitlog/CommitLogReplayer.java#L390-L413&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/cassandra/blob/cassandra-3.9/src/java/org/apache/cassandra/db/commitlog/CommitLogReplayer.java#L390-L413&lt;/a&gt;, seems like we are ignoring errors due to incomplete flushes (quoting: &quot;Ignoring commit log replay error likely due to incomplete flush to disk&quot;) without caring about any operator policy, which is the right thing to do IMO and that is what I am trying to achieve in the patch as well. Lmk if I have misunderstood something.&lt;/p&gt;</comment>
                            <comment id="15946027" author="iamaleksey" created="Tue, 28 Mar 2017 21:41:05 +0000"  >&lt;p&gt;You are correct - when replaying the commitlog we do tolerate EOF in the last segment.&lt;/p&gt;

&lt;p&gt;I&apos;m fine with doing this for hints, just for EOF. However, please also:&lt;br/&gt;
1. Fix you indentation to match C* code style (brackets on new lines)&lt;br/&gt;
2. Add some logging. Aborting replay silently is not what we want.&lt;br/&gt;
3. Update NEWS.txt to document the change.&lt;/p&gt;

&lt;p&gt;I&apos;m also not quite sure which version of C* this should go to, if we are going to quietly change the default behaviour like this. &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jjirsa&quot; class=&quot;user-hover&quot; rel=&quot;jjirsa&quot;&gt;jjirsa&lt;/a&gt;?&lt;/p&gt;</comment>
                            <comment id="15946034" author="jjirsa" created="Tue, 28 Mar 2017 21:44:42 +0000"  >&lt;p&gt;Seems like a bug fix to me, would hope for 3.0 and newer personally.&lt;/p&gt;


</comment>
                            <comment id="15955588" author="jjirsa" created="Tue, 4 Apr 2017 18:38:51 +0000"  >&lt;p&gt;Given the delay on reviewing the patch (uploaded in October), I&apos;ve gone ahead and made the tweaks suggested by Aleksey (at least the code changes, I&apos;ll add the NEWS entry on final commit) and kicked off CI. I&apos;ll keep the assignee and author on the commit as &lt;tt&gt;Garvit Juniwal&lt;/tt&gt; to recognize his work/contribution.&lt;/p&gt;

&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt; Branch &lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt; Testall &lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt; Dtest&lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;a href=&quot;https://github.com/jeffjirsa/cassandra/commits/cassandra-3.0-12728&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;3.0&lt;/a&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;a href=&quot;https://circleci.com/gh/jeffjirsa/cassandra/tree/cassandra-3.0-12728&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;testall on circle&lt;/a&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;a href=&quot;https://github.com/jeffjirsa/cassandra/commits/cassandra-3.11-12728&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;3.11&lt;/a&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://circleci.com/gh/jeffjirsa/cassandra/tree/cassandra-3.11-12728&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;testall on circle&lt;/a&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;a href=&quot;https://github.com/jeffjirsa/cassandra/commits/cassandra-12728&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;trunk&lt;/a&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;a href=&quot;https://circleci.com/gh/jeffjirsa/cassandra/tree/cassandra-12728&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;testall on circle&lt;/a&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;


&lt;p&gt;(CI links coming soon)&lt;/p&gt;</comment>
                            <comment id="15955605" author="garvitjuniwal" created="Tue, 4 Apr 2017 18:44:04 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jjirsa&quot; class=&quot;user-hover&quot; rel=&quot;jjirsa&quot;&gt;jjirsa&lt;/a&gt; Thanks a lot. Just yesterday I was looking into getting my cassandra repo back and make/test the suggested changes but inertia kept me back. I am also not familiar with the commit process. Your help is really appreciated.&lt;/p&gt;</comment>
                            <comment id="15956880" author="iamaleksey" created="Wed, 5 Apr 2017 13:41:42 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jjirsa&quot; class=&quot;user-hover&quot; rel=&quot;jjirsa&quot;&gt;jjirsa&lt;/a&gt; Looks good to me, though can you please extend the log message to include the name of the file that caused EOF? Thanks.&lt;/p&gt;</comment>
                            <comment id="15973440" author="jjirsa" created="Tue, 18 Apr 2017 20:29:07 +0000"  >&lt;p&gt;Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=garvitjuniwal&quot; class=&quot;user-hover&quot; rel=&quot;garvitjuniwal&quot;&gt;garvitjuniwal&lt;/a&gt; and &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=iamaleksey&quot; class=&quot;user-hover&quot; rel=&quot;iamaleksey&quot;&gt;iamaleksey&lt;/a&gt; - committed to 3.0 as &lt;tt&gt;3110d27dde2d518297e118c2f1f6b6bccfed7899&lt;/tt&gt; and merged up through trunk.&lt;/p&gt;</comment>
                            <comment id="16269314" author="alekiv" created="Tue, 28 Nov 2017 19:22:02 +0000"  >&lt;p&gt;Seems it is not fully fixed.&lt;br/&gt;
Log form v3.0.14:&lt;/p&gt;


&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
INFO  [main] 2017-11-28 19:10:13,554 StorageService.java:575 - Cassandra version: 3.0.14
INFO  [main] 2017-11-28 19:10:13,555 StorageService.java:576 - Thrift API version: 20.1.0
INFO  [main] 2017-11-28 19:10:13,555 StorageService.java:577 - CQL supported versions: 3.4.0 (&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;: 3.4.0)
ERROR [main] 2017-11-28 19:10:13,592 CassandraDaemon.java:710 - Exception encountered during startup
org.apache.cassandra.io.FSReadError: java.io.EOFException
        at org.apache.cassandra.hints.HintsDescriptor.readFromFile(HintsDescriptor.java:142) ~[apache-cassandra-3.0.14.jar:3.0.14]
        at java.util.stream.ReferencePipeline$3$1.accept(ReferencePipeline.java:193) ~[na:1.8.0_141]
        at java.util.stream.ReferencePipeline$2$1.accept(ReferencePipeline.java:175) ~[na:1.8.0_141]
        at java.util.Iterator.forEachRemaining(Iterator.java:116) ~[na:1.8.0_141]
        at java.util.Spliterators$IteratorSpliterator.forEachRemaining(Spliterators.java:1801) ~[na:1.8.0_141]
        at java.util.stream.AbstractPipeline.copyInto(AbstractPipeline.java:481) ~[na:1.8.0_141]
        at java.util.stream.AbstractPipeline.wrapAndCopyInto(AbstractPipeline.java:471) ~[na:1.8.0_141]
        at java.util.stream.ReduceOps$ReduceOp.evaluateSequential(ReduceOps.java:708) ~[na:1.8.0_141]
        at java.util.stream.AbstractPipeline.evaluate(AbstractPipeline.java:234) ~[na:1.8.0_141]
        at java.util.stream.ReferencePipeline.collect(ReferencePipeline.java:499) ~[na:1.8.0_141]
        at org.apache.cassandra.hints.HintsCatalog.load(HintsCatalog.java:65) ~[apache-cassandra-3.0.14.jar:3.0.14]
        at org.apache.cassandra.hints.HintsService.&amp;lt;init&amp;gt;(HintsService.java:88) ~[apache-cassandra-3.0.14.jar:3.0.14]
        at org.apache.cassandra.hints.HintsService.&amp;lt;clinit&amp;gt;(HintsService.java:63) ~[apache-cassandra-3.0.14.jar:3.0.14]
        at org.apache.cassandra.service.StorageProxy.&amp;lt;clinit&amp;gt;(StorageProxy.java:121) ~[apache-cassandra-3.0.14.jar:3.0.14]
        at java.lang.&lt;span class=&quot;code-object&quot;&gt;Class&lt;/span&gt;.forName0(Native Method) ~[na:1.8.0_141]
        at java.lang.&lt;span class=&quot;code-object&quot;&gt;Class&lt;/span&gt;.forName(&lt;span class=&quot;code-object&quot;&gt;Class&lt;/span&gt;.java:264) ~[na:1.8.0_141]
        at org.apache.cassandra.service.StorageService.initServer(StorageService.java:585) ~[apache-cassandra-3.0.14.jar:3.0.14]
        at org.apache.cassandra.service.StorageService.initServer(StorageService.java:570) ~[apache-cassandra-3.0.14.jar:3.0.14]
        at org.apache.cassandra.service.CassandraDaemon.setup(CassandraDaemon.java:346) [apache-cassandra-3.0.14.jar:3.0.14]
        at org.apache.cassandra.service.CassandraDaemon.activate(CassandraDaemon.java:569) [apache-cassandra-3.0.14.jar:3.0.14]
        at org.apache.cassandra.service.CassandraDaemon.main(CassandraDaemon.java:697) [apache-cassandra-3.0.14.jar:3.0.14]
Caused by: java.io.EOFException: &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;
        at java.io.RandomAccessFile.readInt(RandomAccessFile.java:803) ~[na:1.8.0_141]
        at org.apache.cassandra.hints.HintsDescriptor.deserialize(HintsDescriptor.java:237) ~[apache-cassandra-3.0.14.jar:3.0.14]
        at org.apache.cassandra.hints.HintsDescriptor.readFromFile(HintsDescriptor.java:138) ~[apache-cassandra-3.0.14.jar:3.0.14]
        ... 20 common frames omitted
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;



&lt;p&gt;After several 0 size hints files deletion Cassandra started successfully. &lt;/p&gt;</comment>
                            <comment id="16271255" author="jjirsa" created="Wed, 29 Nov 2017 18:05:52 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=alekiv&quot; class=&quot;user-hover&quot; rel=&quot;alekiv&quot;&gt;alekiv&lt;/a&gt; can you open a new JIRA and link it back to this one? It&apos;s possible that the original patch didn&apos;t consider 0 byte files (I don&apos;t have time to go back and look at the commit, and it was long enough ago that I&apos;ve forgotten) - were all of your files 0 bytes?&lt;/p&gt;


</comment>
                            <comment id="16272579" author="alekiv" created="Thu, 30 Nov 2017 12:08:15 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-14080&quot; title=&quot;Handle incompletely written hint descriptors during startup&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-14080&quot;&gt;&lt;del&gt;CASSANDRA-14080&lt;/del&gt;&lt;/a&gt; created&lt;/p&gt;</comment>
                            <comment id="16429241" author="vinegh" created="Sat, 7 Apr 2018 05:20:48 +0000"  >&lt;p&gt;We are seeing this issue with 14 node cluster. We are currently on 3.11.1. Any ideas on what might be wrong?&lt;/p&gt;

&lt;p&gt;ERROR &lt;span class=&quot;error&quot;&gt;&amp;#91;HintsDispatcher:1&amp;#93;&lt;/span&gt; 2018-04-06 16:26:44,423 CassandraDaemon.java:228 - Exception in thread Thread&lt;span class=&quot;error&quot;&gt;&amp;#91;HintsDispatcher:1,1,main&amp;#93;&lt;/span&gt;&lt;br/&gt;
org.apache.cassandra.io.FSReadError: java.io.IOException: Digest mismatch exception&lt;br/&gt;
 at org.apache.cassandra.hints.HintsReader$BuffersIterator.computeNext(HintsReader.java:298) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;apache-cassandra-3.11.1.jar:3.11.1-SNAPSHOT&amp;#93;&lt;/span&gt;&lt;br/&gt;
 at org.apache.cassandra.hints.HintsReader$BuffersIterator.computeNext(HintsReader.java:263) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;apache-cassandra-3.11.1.jar:3.11.1-SNAPSHOT&amp;#93;&lt;/span&gt;&lt;br/&gt;
 at org.apache.cassandra.utils.AbstractIterator.hasNext(AbstractIterator.java:47) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;apache-cassandra-3.11.1.jar:3.11.1-SNAPSHOT&amp;#93;&lt;/span&gt;&lt;br/&gt;
 at org.apache.cassandra.hints.HintsDispatcher.sendHints(HintsDispatcher.java:169) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;apache-cassandra-3.11.1.jar:3.11.1-SNAPSHOT&amp;#93;&lt;/span&gt;&lt;br/&gt;
 at org.apache.cassandra.hints.HintsDispatcher.sendHintsAndAwait(HintsDispatcher.java:128) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;apache-cassandra-3.11.1.jar:3.11.1-SNAPSHOT&amp;#93;&lt;/span&gt;&lt;br/&gt;
 at org.apache.cassandra.hints.HintsDispatcher.dispatch(HintsDispatcher.java:113) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;apache-cassandra-3.11.1.jar:3.11.1-SNAPSHOT&amp;#93;&lt;/span&gt;&lt;br/&gt;
 at org.apache.cassandra.hints.HintsDispatcher.dispatch(HintsDispatcher.java:94) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;apache-cassandra-3.11.1.jar:3.11.1-SNAPSHOT&amp;#93;&lt;/span&gt;&lt;br/&gt;
 at org.apache.cassandra.hints.HintsDispatchExecutor$DispatchHintsTask.deliver(HintsDispatchExecutor.java:278) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;apache-cassandra-3.11.1.jar:3.11.1-SNAPSHOT&amp;#93;&lt;/span&gt;&lt;br/&gt;
 at org.apache.cassandra.hints.HintsDispatchExecutor$DispatchHintsTask.dispatch(HintsDispatchExecutor.java:260) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;apache-cassandra-3.11.1.jar:3.11.1-SNAPSHOT&amp;#93;&lt;/span&gt;&lt;br/&gt;
 at org.apache.cassandra.hints.HintsDispatchExecutor$DispatchHintsTask.dispatch(HintsDispatchExecutor.java:238) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;apache-cassandra-3.11.1.jar:3.11.1-SNAPSHOT&amp;#93;&lt;/span&gt;&lt;br/&gt;
 at org.apache.cassandra.hints.HintsDispatchExecutor$DispatchHintsTask.run(HintsDispatchExecutor.java:217) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;apache-cassandra-3.11.1.jar:3.11.1-SNAPSHOT&amp;#93;&lt;/span&gt;&lt;br/&gt;
 at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;na:1.8.0_141&amp;#93;&lt;/span&gt;&lt;br/&gt;
 at java.util.concurrent.FutureTask.run(FutureTask.java:266) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;na:1.8.0_141&amp;#93;&lt;/span&gt;&lt;br/&gt;
 at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;na:1.8.0_141&amp;#93;&lt;/span&gt;&lt;br/&gt;
 at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624) &lt;span class=&quot;error&quot;&gt;&amp;#91;na:1.8.0_141&amp;#93;&lt;/span&gt;&lt;br/&gt;
 at org.apache.cassandra.concurrent.NamedThreadFactory.lambda$threadLocalDeallocator$0(NamedThreadFactory.java:81) &lt;span class=&quot;error&quot;&gt;&amp;#91;apache-cassandra-3.11.1.jar:3.11.1-SNAPSHOT&amp;#93;&lt;/span&gt;&lt;br/&gt;
 at java.lang.Thread.run(Thread.java:748) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;na:1.8.0_141&amp;#93;&lt;/span&gt;&lt;br/&gt;
Caused by: java.io.IOException: Digest mismatch exception&lt;/p&gt;</comment>
                            <comment id="16430985" author="vinegh" created="Mon, 9 Apr 2018 18:03:26 +0000"  >&lt;p&gt;Sorry this was not the place where I intended to put this up&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                                                <inwardlinks description="is duplicated by">
                                        <issuelink>
            <issuekey id="12963384">CASSANDRA-11678</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="13015547">CASSANDRA-12844</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12953232">CASSANDRA-11426</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="13015547">CASSANDRA-12844</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="13121897">CASSANDRA-14080</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12833452" name="CASSANDRA-12728.patch" size="1816" author="garvitjuniwal" created="Fri, 14 Oct 2016 21:27:48 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[garvitjuniwal]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12313825" key="com.atlassian.jira.plugin.system.customfieldtypes:cascadingselect">
                        <customfieldname>Bug Category</customfieldname>
                        <customfieldvalues>
                                                    <customfieldvalue key="12982" cascade-level=""><![CDATA[Correctness]]></customfieldvalue>
                                <customfieldvalue key="12989" cascade-level="1"><![CDATA[Consistency]]></customfieldvalue>
            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 32 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i347vz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12311421" key="com.atlassian.jira.plugin.system.customfieldtypes:multiversion">
                        <customfieldname>Reproduced In</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="12337349">3.0.9</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>aleksey</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[aleksey]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12962"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>