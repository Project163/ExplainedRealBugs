<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 22:54:00 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-8801] Decommissioned nodes are willing to rejoin the cluster if restarted</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-8801</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;This issue comes from the Cassandra user group.&lt;/p&gt;

&lt;p&gt;If a node which was successfully decommissioned gets restarted with its data directory in tact, it will rejoin the cluster immediately going to &lt;tt&gt;UN&lt;/tt&gt; and beginning to serve client requests.&lt;/p&gt;

&lt;p&gt;This is wrong - the node has consistency issues, having missed any writes while it was offline because no hinted handoffs were being kept.  And in the best case scenario (it&apos;s spotted and remediated immediately), near-100% overstreaming will still occur.&lt;/p&gt;

&lt;p&gt;Also, whatever reasons the operator had for decommissioning the node would presumably still be valid, so this action may threaten cluster stability if the node is underpowered or suffering hardware issues.&lt;/p&gt;

&lt;p&gt;But what elevates this to critical is that if the node had been offline longer than gc_grace_seconds, it may cause permanent and unrecoverable consistency issues due to data resurrection.&lt;/p&gt;

&lt;h3&gt;&lt;a name=&quot;Recommendation%3A&quot;&gt;&lt;/a&gt;Recommendation:&lt;/h3&gt;
&lt;p&gt;A node should remember that it was decommissioned and refuse to rejoin a cluster without at least a -Dflag forcing it to.  &lt;/p&gt;</description>
                <environment></environment>
        <key id="12774914">CASSANDRA-8801</key>
            <summary>Decommissioned nodes are willing to rejoin the cluster if restarted</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10002" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Normal</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="brandon.williams">Brandon Williams</assignee>
                                    <reporter username="mightye">Eric Stevens</reporter>
                        <labels>
                    </labels>
                <created>Fri, 13 Feb 2015 15:03:58 +0000</created>
                <updated>Tue, 16 Apr 2019 09:31:20 +0000</updated>
                            <resolved>Tue, 19 May 2015 15:47:40 +0000</resolved>
                                        <fixVersion>3.0 alpha 1</fixVersion>
                                        <due></due>
                            <votes>1</votes>
                                    <watches>9</watches>
                                                                                                                <comments>
                            <comment id="14339047" author="brandon.williams" created="Thu, 26 Feb 2015 19:57:47 +0000"  >&lt;p&gt;Cassandra has had this behavior since the inception of decom, and it has saved more people who accidentally issue a decom against the wrong node than it has bitten.  That said I agree with your recommendation to remember decommissioning and requiring a -D flag to rejoin.&lt;/p&gt;</comment>
                            <comment id="14339724" author="mshuler" created="Fri, 27 Feb 2015 04:59:06 +0000"  >&lt;p&gt;I think &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-5780&quot; title=&quot;nodetool status and ring report incorrect/stale information after decommission&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-5780&quot;&gt;CASSANDRA-5780&lt;/a&gt; could be resolved at the same time.&lt;/p&gt;</comment>
                            <comment id="14499904" author="brandon.williams" created="Fri, 17 Apr 2015 14:33:07 +0000"  >&lt;p&gt;Patch to add a new BootstrapState to the system ks to remember when decommissioned, but allow overriding this with cassandra.override_decommission&lt;/p&gt;</comment>
                            <comment id="14500265" author="jbellis" created="Fri, 17 Apr 2015 17:38:50 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=thobbs&quot; class=&quot;user-hover&quot; rel=&quot;thobbs&quot;&gt;thobbs&lt;/a&gt; to review&lt;/p&gt;</comment>
                            <comment id="14519597" author="carlyeks" created="Wed, 29 Apr 2015 15:45:25 +0000"  >&lt;p&gt;I was able to bring up a node again after decommissioning; it doesn&apos;t seem like the &lt;tt&gt;DECOMMISSIONED&lt;/tt&gt; state gets saved to the &lt;tt&gt;system.local&lt;/tt&gt; table.&lt;/p&gt;

&lt;p&gt;The cause is IOErrors from MessagingService while it was trying to close the socket threads. Wrapping MessagingService in a try block fixed the problem, and when I restarted, it error&apos;d that the node had been decommissioned, and I was able to use the &lt;tt&gt;override_decommission&lt;/tt&gt; flag.&lt;/p&gt;

&lt;p&gt;I&apos;ve attached the change that I made to make it work.&lt;/p&gt;

&lt;p&gt;Just one nit otherwise, there is an unnecessary whitespace change in StorageService.&lt;/p&gt;</comment>
                            <comment id="14519635" author="brandon.williams" created="Wed, 29 Apr 2015 16:10:29 +0000"  >&lt;p&gt;Out of curiosity, do you have the stacktrace from MS erroring?  That seems like a separate problem.&lt;/p&gt;</comment>
                            <comment id="14519664" author="carlyeks" created="Wed, 29 Apr 2015 16:26:31 +0000"  >&lt;p&gt;Yeah, it&apos;s below. It happens every time during decommission; running OS X 10.9, Java 8.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;java.io.IOError: java.io.IOException: No such file or directory
	at org.apache.cassandra.net.MessagingService.shutdown(MessagingService.java:737) ~[main/:na]
	at org.apache.cassandra.service.StorageService$6.run(StorageService.java:3278) ~[main/:na]
	at org.apache.cassandra.service.StorageService.unbootstrap(StorageService.java:3351) [main/:na]
	at org.apache.cassandra.service.StorageService.decommission(StorageService.java:3288) [main/:na]
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method) ~[na:1.8.0_31]
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62) ~[na:1.8.0_31]
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43) ~[na:1.8.0_31]
	at java.lang.reflect.Method.invoke(Method.java:483) ~[na:1.8.0_31]
	at sun.reflect.misc.Trampoline.invoke(MethodUtil.java:71) [na:1.8.0_31]
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method) ~[na:1.8.0_31]
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62) ~[na:1.8.0_31]
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43) ~[na:1.8.0_31]
	at java.lang.reflect.Method.invoke(Method.java:483) ~[na:1.8.0_31]
	at sun.reflect.misc.MethodUtil.invoke(MethodUtil.java:275) [na:1.8.0_31]
	at com.sun.jmx.mbeanserver.StandardMBeanIntrospector.invokeM2(StandardMBeanIntrospector.java:112) [na:1.8.0_31]
	at com.sun.jmx.mbeanserver.StandardMBeanIntrospector.invokeM2(StandardMBeanIntrospector.java:46) [na:1.8.0_31]
	at com.sun.jmx.mbeanserver.MBeanIntrospector.invokeM(MBeanIntrospector.java:237) [na:1.8.0_31]
	at com.sun.jmx.mbeanserver.PerInterface.invoke(PerInterface.java:138) [na:1.8.0_31]
	at com.sun.jmx.mbeanserver.MBeanSupport.invoke(MBeanSupport.java:252) [na:1.8.0_31]
	at com.sun.jmx.interceptor.DefaultMBeanServerInterceptor.invoke(DefaultMBeanServerInterceptor.java:819) [na:1.8.0_31]
	at com.sun.jmx.mbeanserver.JmxMBeanServer.invoke(JmxMBeanServer.java:801) [na:1.8.0_31]
	at javax.management.remote.rmi.RMIConnectionImpl.doOperation(RMIConnectionImpl.java:1466) [na:1.8.0_31]
	at javax.management.remote.rmi.RMIConnectionImpl.access$300(RMIConnectionImpl.java:76) [na:1.8.0_31]
	at javax.management.remote.rmi.RMIConnectionImpl$PrivilegedOperation.run(RMIConnectionImpl.java:1307) [na:1.8.0_31]
	at javax.management.remote.rmi.RMIConnectionImpl.doPrivilegedOperation(RMIConnectionImpl.java:1399) [na:1.8.0_31]
	at javax.management.remote.rmi.RMIConnectionImpl.invoke(RMIConnectionImpl.java:828) [na:1.8.0_31]
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method) ~[na:1.8.0_31]
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62) ~[na:1.8.0_31]
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43) ~[na:1.8.0_31]
	at java.lang.reflect.Method.invoke(Method.java:483) ~[na:1.8.0_31]
	at sun.rmi.server.UnicastServerRef.dispatch(UnicastServerRef.java:323) [na:1.8.0_31]
	at sun.rmi.transport.Transport$1.run(Transport.java:200) [na:1.8.0_31]
	at sun.rmi.transport.Transport$1.run(Transport.java:197) [na:1.8.0_31]
	at java.security.AccessController.doPrivileged(Native Method) [na:1.8.0_31]
	at sun.rmi.transport.Transport.serviceCall(Transport.java:196) [na:1.8.0_31]
	at sun.rmi.transport.tcp.TCPTransport.handleMessages(TCPTransport.java:568) [na:1.8.0_31]
	at sun.rmi.transport.tcp.TCPTransport$ConnectionHandler.run0(TCPTransport.java:826) [na:1.8.0_31]
	at sun.rmi.transport.tcp.TCPTransport$ConnectionHandler.lambda$run$240(TCPTransport.java:683) [na:1.8.0_31]
	at sun.rmi.transport.tcp.TCPTransport$ConnectionHandler$$Lambda$1/497297407.run(Unknown Source) [na:1.8.0_31]
	at java.security.AccessController.doPrivileged(Native Method) [na:1.8.0_31]
	at sun.rmi.transport.tcp.TCPTransport$ConnectionHandler.run(TCPTransport.java:682) [na:1.8.0_31]
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1142) [na:1.8.0_31]
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:617) [na:1.8.0_31]
	at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:745) [na:1.8.0_31]
Caused by: java.io.IOException: No such file or directory
	at sun.nio.ch.NativeThread.signal(Native Method) ~[na:1.8.0_31]
	at sun.nio.ch.ServerSocketChannelImpl.implCloseSelectableChannel(ServerSocketChannelImpl.java:283) ~[na:1.8.0_31]
	at java.nio.channels.spi.AbstractSelectableChannel.implCloseChannel(AbstractSelectableChannel.java:234) ~[na:1.8.0_31]
	at java.nio.channels.spi.AbstractInterruptibleChannel.close(AbstractInterruptibleChannel.java:115) ~[na:1.8.0_31]
	at sun.nio.ch.ServerSocketAdaptor.close(ServerSocketAdaptor.java:137) ~[na:1.8.0_31]
	at org.apache.cassandra.net.MessagingService$SocketThread.close(MessagingService.java:958) ~[main/:na]
	at org.apache.cassandra.net.MessagingService.shutdown(MessagingService.java:733) ~[main/:na]
	... 43 common frames omitted
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="14539973" author="brandon.williams" created="Tue, 12 May 2015 15:01:36 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=philipthompson&quot; class=&quot;user-hover&quot; rel=&quot;philipthompson&quot;&gt;philipthompson&lt;/a&gt; to add a dtest.&lt;/p&gt;</comment>
                            <comment id="14549603" author="mambocab" created="Tue, 19 May 2015 01:10:28 +0000"  >&lt;p&gt;&lt;a href=&quot;https://github.com/riptano/cassandra-dtest/pull/281&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;dtest added&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=brandon.williams&quot; class=&quot;user-hover&quot; rel=&quot;brandon.williams&quot;&gt;brandon.williams&lt;/a&gt;: if you think this tests the change properly, I&apos;m +1 on the patch as applied to trunk.&lt;/p&gt;</comment>
                            <comment id="14550647" author="brandon.williams" created="Tue, 19 May 2015 15:47:40 +0000"  >&lt;p&gt;Committed.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12658829">CASSANDRA-5780</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12729202" name="8801-v2.txt" size="4104" author="carlyeks" created="Wed, 29 Apr 2015 15:45:25 +0000"/>
                            <attachment id="12726166" name="8801.txt" size="4107" author="brandon.williams" created="Fri, 17 Apr 2015 14:33:07 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[brandon.williams]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 27 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i25lp3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>carlyeks</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[carlyeks]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12962"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311124" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Tester</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>mambocab</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>