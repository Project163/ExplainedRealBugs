<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 22:15:42 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-1384] ERROR [MIGRATION-STAGE:1] Previous Version Mistmatch</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-1384</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;I fired up a 3 node cluster. I created few keyspaces using API and inserted to them with no problem. Now I tried to add more CFs to one of those existing Keyspaces in a loop. I got the following exception:&lt;/p&gt;

&lt;p&gt;ERROR &lt;span class=&quot;error&quot;&gt;&amp;#91;MIGRATION-STAGE:1&amp;#93;&lt;/span&gt; 2010-08-12 14:46:40,493 CassandraDaemon.java (line 82) Uncaught exception in thread Thread&lt;span class=&quot;error&quot;&gt;&amp;#91;MIGRATION-STAGE:1,5,main&amp;#93;&lt;/span&gt;&lt;br/&gt;
java.util.concurrent.ExecutionException: java.lang.RuntimeException: org.apache.cassandra.config.ConfigurationException: Previous version mismatch. cannot apply.&lt;br/&gt;
	at java.util.concurrent.FutureTask$Sync.innerGet(FutureTask.java:252)&lt;br/&gt;
	at java.util.concurrent.FutureTask.get(FutureTask.java:111)&lt;br/&gt;
	at org.apache.cassandra.concurrent.DebuggableThreadPoolExecutor.afterExecute(DebuggableThreadPoolExecutor.java:87)&lt;br/&gt;
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1118)&lt;br/&gt;
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:603)&lt;br/&gt;
	at java.lang.Thread.run(Thread.java:636)&lt;br/&gt;
Caused by: java.lang.RuntimeException: org.apache.cassandra.config.ConfigurationException: Previous version mismatch. cannot apply.&lt;br/&gt;
	at org.apache.cassandra.utils.WrappedRunnable.run(WrappedRunnable.java:34)&lt;br/&gt;
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:471)&lt;br/&gt;
	at java.util.concurrent.FutureTask$Sync.innerRun(FutureTask.java:334)&lt;br/&gt;
	at java.util.concurrent.FutureTask.run(FutureTask.java:166)&lt;br/&gt;
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1110)&lt;br/&gt;
	... 2 more&lt;br/&gt;
Caused by: org.apache.cassandra.config.ConfigurationException: Previous version mismatch. cannot apply.&lt;br/&gt;
	at org.apache.cassandra.db.migration.Migration.apply(Migration.java:101)&lt;br/&gt;
	at org.apache.cassandra.db.DefinitionsUpdateResponseVerbHandler$1.runMayThrow(DefinitionsUpdateResponseVerbHandler.java:70)&lt;br/&gt;
	at org.apache.cassandra.utils.WrappedRunnable.run(WrappedRunnable.java:30)&lt;br/&gt;
	... 6 more&lt;/p&gt;

&lt;p&gt;The above exception is logged in the log of node in which I send the request to and not other seeds. It is noteworthy that my schem_agreement is stuck in a disagreed state:&lt;/p&gt;

&lt;p&gt;Array&lt;br/&gt;
(&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;1775e847-a658-11df-960f-7d867dfef3ae&amp;#93;&lt;/span&gt; =&amp;gt; Array&lt;br/&gt;
        (&lt;br/&gt;
            &lt;span class=&quot;error&quot;&gt;&amp;#91;0&amp;#93;&lt;/span&gt; =&amp;gt; 10.50.26.134&lt;br/&gt;
        )&lt;/p&gt;

&lt;p&gt;    &lt;span class=&quot;error&quot;&gt;&amp;#91;163d874a-a65b-11df-aef0-d73a63bafff3&amp;#93;&lt;/span&gt; =&amp;gt; Array&lt;br/&gt;
        (&lt;br/&gt;
            &lt;span class=&quot;error&quot;&gt;&amp;#91;0&amp;#93;&lt;/span&gt; =&amp;gt; 10.50.26.133&lt;br/&gt;
        )&lt;/p&gt;

&lt;p&gt;    &lt;span class=&quot;error&quot;&gt;&amp;#91;14869031-a658-11df-8553-930ba61048ac&amp;#93;&lt;/span&gt; =&amp;gt; Array&lt;br/&gt;
        (&lt;br/&gt;
            &lt;span class=&quot;error&quot;&gt;&amp;#91;0&amp;#93;&lt;/span&gt; =&amp;gt; 10.50.26.132&lt;br/&gt;
        )&lt;/p&gt;

&lt;p&gt;)&lt;/p&gt;

&lt;p&gt;And this does not change. Affect is that some keyspaces would not respond to reads any more giving Internal Error:&lt;/p&gt;

&lt;p&gt;ERROR &lt;span class=&quot;error&quot;&gt;&amp;#91;pool-1-thread-26&amp;#93;&lt;/span&gt; 2010-08-12 14:50:57,034 Cassandra.java (line 2988) Internal error processing batch_mutate&lt;br/&gt;
java.lang.AssertionError&lt;br/&gt;
	at org.apache.cassandra.locator.AbstractReplicationStrategy.getNaturalEndpoints(AbstractReplicationStrategy.java:91)&lt;br/&gt;
	at org.apache.cassandra.service.StorageService.getNaturalEndpoints(StorageService.java:1289)&lt;br/&gt;
	at org.apache.cassandra.service.StorageService.getNaturalEndpoints(StorageService.java:1277)&lt;br/&gt;
	at org.apache.cassandra.service.StorageProxy.mutateBlocking(StorageProxy.java:193)&lt;br/&gt;
	at org.apache.cassandra.thrift.CassandraServer.doInsert(CassandraServer.java:474)&lt;br/&gt;
	at org.apache.cassandra.thrift.CassandraServer.batch_mutate(CassandraServer.java:438)&lt;br/&gt;
	at org.apache.cassandra.thrift.Cassandra$Processor$batch_mutate.process(Cassandra.java:2980)&lt;br/&gt;
	at org.apache.cassandra.thrift.Cassandra$Processor.process(Cassandra.java:2499)&lt;br/&gt;
	at org.apache.cassandra.thrift.CustomTThreadPoolServer$WorkerProcess.run(CustomTThreadPoolServer.java:167)&lt;br/&gt;
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1110)&lt;br/&gt;
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:603)&lt;br/&gt;
	at java.lang.Thread.run(Thread.java:636)&lt;/p&gt;

&lt;p&gt;In my CF creation, I block for CF creation of the same name and not different names. &lt;/p&gt;

&lt;p&gt;Please advice.&lt;/p&gt;</description>
                <environment>&lt;p&gt;CentOS 5.2&lt;br/&gt;
Trunc August 12th, 2010 at 1:30pm&lt;/p&gt;</environment>
        <key id="12471466">CASSANDRA-1384</key>
            <summary>ERROR [MIGRATION-STAGE:1] Previous Version Mistmatch</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10002" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Normal</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="gdusbabek">Gary Dusbabek</assignee>
                                    <reporter username="arya">Arya Goudarzi</reporter>
                        <labels>
                    </labels>
                <created>Thu, 12 Aug 2010 22:04:26 +0000</created>
                <updated>Tue, 16 Apr 2019 09:33:19 +0000</updated>
                            <resolved>Mon, 16 Aug 2010 19:26:40 +0000</resolved>
                                        <fixVersion>0.7 beta 2</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                                                                <comments>
                            <comment id="12898265" author="gdusbabek" created="Fri, 13 Aug 2010 15:03:25 +0000"  >&lt;p&gt;I think the problem is that the exception is not being handled properly.  Cassandra is throwing a RuntimeException, which is bad because this is a totally recoverable situation.&lt;/p&gt;</comment>
                            <comment id="12898293" author="gdusbabek" created="Fri, 13 Aug 2010 16:09:15 +0000"  >&lt;p&gt;Arya: I wasn&apos;t able to replicate your problem, but I think I understand it enough to provide this fix.  Can you please apply and test it?&lt;/p&gt;

&lt;p&gt;Basically, a ConfigurationException which Cassandra can recover from is percolating up and getting re-thrown as a RuntimeException, which is bad.&lt;/p&gt;</comment>
                            <comment id="12898307" author="jbellis" created="Fri, 13 Aug 2010 16:41:49 +0000"  >&lt;p&gt;what causes the first type?&lt;/p&gt;

&lt;p&gt;+                                    logger.info(&quot;Migration not applied &quot; + ex.getMessage());&lt;/p&gt;

&lt;p&gt;should that be error instead of info?&lt;/p&gt;</comment>
                            <comment id="12898348" author="gdusbabek" created="Fri, 13 Aug 2010 18:09:59 +0000"  >&lt;p&gt;&amp;gt;what causes the first type?&lt;br/&gt;
Trying to apply the same migration twice.  This happens as a result of gossip.  I was dropping them silently before, but figured a log message would be ok.&lt;/p&gt;</comment>
                            <comment id="12898379" author="jbellis" created="Fri, 13 Aug 2010 19:27:18 +0000"  >&lt;p&gt;let&apos;s comment that and move it to debug then.  +1 otherwise&lt;/p&gt;</comment>
                            <comment id="12898392" author="gdusbabek" created="Fri, 13 Aug 2010 19:46:35 +0000"  >&lt;p&gt;ok.  I&apos;m going to hold off on committing this until I hear back from Arya.&lt;/p&gt;</comment>
                            <comment id="12898458" author="arya" created="Fri, 13 Aug 2010 22:46:29 +0000"  >&lt;p&gt;I updated my trunc with revision #985305 which includes your change and looks good to me. I tried it few times and I could not get the exception any more. +1&lt;/p&gt;</comment>
                            <comment id="12898580" author="hudson" created="Sat, 14 Aug 2010 12:48:33 +0000"  >&lt;p&gt;Integrated in Cassandra #514 (See &lt;a href=&quot;http://hudson.zones.apache.org/hudson/job/Cassandra/514/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://hudson.zones.apache.org/hudson/job/Cassandra/514/&lt;/a&gt;)&lt;br/&gt;
    revert last change (committed wrong branch &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-1384&quot; title=&quot;ERROR [MIGRATION-STAGE:1] Previous Version Mistmatch&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-1384&quot;&gt;&lt;del&gt;CASSANDRA-1384&lt;/del&gt;&lt;/a&gt;)&lt;/p&gt;</comment>
                            <comment id="12899043" author="gdusbabek" created="Mon, 16 Aug 2010 19:26:40 +0000"  >&lt;p&gt;committed.&lt;/p&gt;</comment>
                            <comment id="12899391" author="hudson" created="Tue, 17 Aug 2010 12:59:51 +0000"  >&lt;p&gt;Integrated in Cassandra #516 (See &lt;a href=&quot;https://hudson.apache.org/hudson/job/Cassandra/516/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://hudson.apache.org/hudson/job/Cassandra/516/&lt;/a&gt;)&lt;br/&gt;
    trap ConfigExceptions so they don&apos;t become RTEs. patch by gdusbabek, reviewed by jbellis. &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-1384&quot; title=&quot;ERROR [MIGRATION-STAGE:1] Previous Version Mistmatch&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-1384&quot;&gt;&lt;del&gt;CASSANDRA-1384&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12452032" name="ASF.LICENSE.NOT.GRANTED--v1-0001-trap-ConfigExceptions-so-they-don-t-become-RTEs.txt" size="3215" author="gdusbabek" created="Fri, 13 Aug 2010 16:06:18 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[gdusbabek]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>20113</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            15 years, 15 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0g4q7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>92196</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12962"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>