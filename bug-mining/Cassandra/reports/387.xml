<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 22:14:17 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-1237] Store AccessLevels externally to IAuthenticator</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-1237</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;Currently, the concept of authentication (proving the identity of a user) is mixed up with permissions (determining whether a user is able to create/read/write databases). Rather than determining the permissions that a user has, the IAuthenticator should only be capable of authenticating a user, and permissions (specifically, an AccessLevel) should be stored consistently by Cassandra.&lt;/p&gt;

&lt;p&gt;EDIT: Adding summary&lt;/p&gt;

&lt;hr /&gt;

&lt;p&gt;In summary, there appear to be 3 distinct options for how to move forward with authorization. Remember that this ticket is about disconnecting authorization (permissions) from authentication (user/group identification), and its goal is to leave authentication pluggable.&lt;/p&gt;

&lt;p&gt;Options:&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;Leave authentication and authorization in the same interface. If we choose this option, this ticket is invalid, and &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-1271&quot; title=&quot;Improve permissions to allow control over creation/removal/listing of Keyspaces&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-1271&quot;&gt;&lt;del&gt;CASSANDRA-1271&lt;/del&gt;&lt;/a&gt; and &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-1320&quot; title=&quot;Convert AccessLevel to Set&amp;lt;Permission&amp;gt;&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-1320&quot;&gt;&lt;del&gt;CASSANDRA-1320&lt;/del&gt;&lt;/a&gt; will add-to/improve IAuthenticator
	&lt;ul&gt;
		&lt;li&gt;Pros:
		&lt;ul&gt;
			&lt;li&gt;Least change&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
		&lt;li&gt;Cons:
		&lt;ul&gt;
			&lt;li&gt;Very little actually implemented by Cassandra: burden is on the backend implementors&lt;/li&gt;
			&lt;li&gt;Each combination of authz and authc backends would require a new implementation (PAM for authc + permissions keyspace for authz, for instance), causing an explosion of implementations&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
	&lt;li&gt;Separate out a pluggable IAuthority interface to implement authorization
	&lt;ol&gt;
		&lt;li&gt;IAuthenticator interface would be called at login time to determine user/groups membership&lt;/li&gt;
		&lt;li&gt;IAuthority would be called at operation time with the user/groups determined earlier, and the required permission for the operation&lt;/li&gt;
	&lt;/ol&gt;
	&lt;ul&gt;
		&lt;li&gt;Pros:
		&lt;ul&gt;
			&lt;li&gt;Provides the cleanest separation of concerns&lt;/li&gt;
			&lt;li&gt;Allows plugability for permissions&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
		&lt;li&gt;Cons:
		&lt;ul&gt;
			&lt;li&gt;Pluggability of permissions gains limited benefit&lt;/li&gt;
			&lt;li&gt;IAuthority would need to support callbacks for keyspace/cf creation and removal to keep existing keyspaces in sync with their permissions (although technically, option 1 suffers from this as well)&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
	&lt;li&gt;Separate authorization, but do not make it pluggable
	&lt;ul&gt;
		&lt;li&gt;This option is implemented by the existing patchset by attaching permissions to metadata, but could have an alternative implementation that stores permissions in a permissions keyspace.&lt;/li&gt;
		&lt;li&gt;Pros:
		&lt;ul&gt;
			&lt;li&gt;Cassandra controls the scalability of authorization, and can ensure it does not become a bottleneck&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
		&lt;li&gt;Cons:
		&lt;ul&gt;
			&lt;li&gt;Would need to support callbacks for user creation and removal to keep existing users in sync with their permissions&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ol&gt;
</description>
                <environment></environment>
        <key id="12468077">CASSANDRA-1237</key>
            <summary>Store AccessLevels externally to IAuthenticator</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10002" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Normal</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="stuhood">Stu Hood</assignee>
                                    <reporter username="stuhood">Stu Hood</reporter>
                        <labels>
                    </labels>
                <created>Mon, 28 Jun 2010 18:29:20 +0000</created>
                <updated>Tue, 16 Apr 2019 09:33:21 +0000</updated>
                            <resolved>Wed, 25 Aug 2010 20:43:17 +0000</resolved>
                                        <fixVersion>0.7 beta 2</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="12890495" author="stuhood" created="Tue, 20 Jul 2010 23:24:29 +0000"  >&lt;p&gt;Patchset to separate permissions from authentication.&lt;/p&gt;</comment>
                            <comment id="12890497" author="stuhood" created="Tue, 20 Jul 2010 23:25:17 +0000"  >&lt;p&gt;The set currently uses our old-school KSMetaData serialization, so it will need a rebase when &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-1186&quot; title=&quot;futureproof [KS|CF]MetaData&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-1186&quot;&gt;&lt;del&gt;CASSANDRA-1186&lt;/del&gt;&lt;/a&gt; makes it in.&lt;/p&gt;</comment>
                            <comment id="12890852" author="stuhood" created="Wed, 21 Jul 2010 19:43:23 +0000"  >&lt;p&gt;Rebased post 1186.&lt;/p&gt;</comment>
                            <comment id="12890854" author="stuhood" created="Wed, 21 Jul 2010 19:46:49 +0000"  >&lt;p&gt;This should be ready for review.&lt;/p&gt;

&lt;p&gt;One thing that might block it getting committed, though, is that we probably need to automate the conversion from &apos;access.properties&apos; to per-keyspace access maps. Perhaps during loadFromYaml, we could check for the existence of an &apos;access.properties&apos; file, and apply the properties found there to the new keyspaces?&lt;/p&gt;</comment>
                            <comment id="12890879" author="messi" created="Wed, 21 Jul 2010 20:40:21 +0000"  >&lt;p&gt;Failing to authenticate correctly is not an exception. OTOH, accessing a keyspace you&apos;re not authorized for is. All RPC methods except &quot;login&quot; should throw AuthorizationException.&lt;/p&gt;

&lt;p&gt;While you&apos;re at it, please look at &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-974&quot; title=&quot;SASL authentication support&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-974&quot;&gt;&lt;del&gt;CASSANDRA-974&lt;/del&gt;&lt;/a&gt;. I suggest renaming &quot;login&quot; to &quot;authenticate&quot; and have it return Map&amp;lt;String,String&amp;gt; to make it future-proof for SASL authentication schemes, like DIGEST-MD5.&lt;/p&gt;</comment>
                            <comment id="12891250" author="stuhood" created="Thu, 22 Jul 2010 17:15:20 +0000"  >&lt;p&gt;&amp;gt; Failing to authenticate correctly is not an exception.&lt;br/&gt;
(Keeping in mind that I didn&apos;t change any of the Exception handling/throwing in this patch) I think I agree with the original decision. A failed authentication should be extremely rare, and therefore exceptional.&lt;/p&gt;

&lt;p&gt;&amp;gt; All RPC methods except &quot;login&quot; should throw AuthorizationException.&lt;br/&gt;
Agreed, but out of the scope of this ticket.&lt;/p&gt;

&lt;p&gt;&amp;gt; While you&apos;re at it, please look at &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-974&quot; title=&quot;SASL authentication support&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-974&quot;&gt;&lt;del&gt;CASSANDRA-974&lt;/del&gt;&lt;/a&gt;. I suggest renaming &quot;login&quot; to &quot;authenticate&quot;&lt;br/&gt;
I&apos;m thinking of the IAuthenticator interface and login() methods as stopgaps until Avro adds support for SASL in their custom protocol (&lt;a href=&quot;https://issues.apache.org/jira/browse/AVRO-341&quot; title=&quot;specify avro transport in spec&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AVRO-341&quot;&gt;AVRO-341&lt;/a&gt;), so I don&apos;t think breaking the Thrift API right now is worth it.&lt;/p&gt;</comment>
                            <comment id="12891315" author="stuhood" created="Thu, 22 Jul 2010 20:12:35 +0000"  >&lt;p&gt;Rebased for trunk, and added 0006 to handle upgrades by parsing the deprecated &apos;access.properties&apos; when users call readTablesFromYaml.&lt;/p&gt;

&lt;p&gt;This should be ready for review.&lt;/p&gt;</comment>
                            <comment id="12892440" author="stuhood" created="Mon, 26 Jul 2010 19:55:28 +0000"  >&lt;p&gt;Rebased for trunk.&lt;/p&gt;</comment>
                            <comment id="12892611" author="messi" created="Tue, 27 Jul 2010 02:19:22 +0000"  >&lt;p&gt;Attached patch shows a simple IAuthenticator for JAAS. With JAAS you can configure LoginModules for Unix users or PAM, for LDAP or Kerberos and you can also write your own LoginModule reading passwd.properties files or even column families. In fact, I have a SimpleLoginModule (similar to SimpleAuthenticator) half ready.&lt;/p&gt;

&lt;p&gt;This authenticator is also not finished, yet. I submitted it because I hope it&apos;s not too late to urge you to make/keep IAuthenticator as lightweight as possible.&lt;br/&gt;
The proposed defaultUser() would make IAuthenticators somewhat stateful. Not good.&lt;/p&gt;

&lt;p&gt;If you&apos;re interested I can open a new issue and submit my JAAS classes there including sample config files and a programmatic JAAS configuration.&lt;/p&gt;</comment>
                            <comment id="12892612" author="messi" created="Tue, 27 Jul 2010 02:21:58 +0000"  >&lt;p&gt;By the way, I think the constants USERNAME_KEY and PASSWORD_KEY should go into IAuthenticator because these are common keys used by all authenticators.&lt;/p&gt;</comment>
                            <comment id="12892882" author="gdusbabek" created="Tue, 27 Jul 2010 18:37:57 +0000"  >&lt;p&gt;Folke, I&apos;d be interested in seeing your classes (on a separate ticket).&lt;/p&gt;</comment>
                            <comment id="12892883" author="gdusbabek" created="Tue, 27 Jul 2010 18:38:05 +0000"  >&lt;p&gt;0003: unavronateAccessMap is checking for null on the wrong variable.&lt;br/&gt;
0004: is there a way to not have a default user? I think it adds some noise to the interface.  &lt;/p&gt;

&lt;p&gt;Feel free to make breaking changes (no need to support access.properties) if it simplifies things.  Our authentication API has been explicitly &apos;experimental&apos; from day one.&lt;/p&gt;</comment>
                            <comment id="12892936" author="messi" created="Tue, 27 Jul 2010 21:29:44 +0000"  >&lt;p&gt;In AuthenticatedUser.toString(): String.format() is a static method that takes the format as its first parameter.&lt;/p&gt;

&lt;p&gt;Again, please drop defaultUser() and put the &quot;super admin&quot; status directly into AuthenticatedUser or use a not configurable pseudo group for super admins.&lt;/p&gt;</comment>
                            <comment id="12893246" author="stuhood" created="Wed, 28 Jul 2010 16:58:45 +0000"  >&lt;ul&gt;
	&lt;li&gt;0003: Fixed unavronateAccessMap null check (good eye!)&lt;/li&gt;
	&lt;li&gt;0004: Moved &apos;isSuper&apos; onto AuthenticatedUser&lt;/li&gt;
	&lt;li&gt;0004: Fixed static/instance String.format usage&lt;/li&gt;
	&lt;li&gt;0005: Fixed an error where calling set_keyspace before login would fail&lt;/li&gt;
&lt;/ul&gt;


&lt;hr /&gt;

&lt;p&gt;I can&apos;t think of a good way to remove defaultUser: it replaced lots of (authenticator instanceof AllowAllAuthenticator) calls, which existed to check whether it was necessary for the user to login.&lt;/p&gt;</comment>
                            <comment id="12893313" author="messi" created="Wed, 28 Jul 2010 19:03:45 +0000"  >&lt;p&gt;I see.&lt;/p&gt;

&lt;p&gt;A few suggestions then:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;rename &quot;AuthenticatedUser&quot; to just &quot;User&quot;.&lt;/li&gt;
	&lt;li&gt;add &quot;isAuthenticated&quot; state to User.&lt;/li&gt;
	&lt;li&gt;add package private getter(s) and setter(s) that allow Authenticators to manipulate their User objects.&lt;/li&gt;
	&lt;li&gt;add &quot;User&quot; as argument to &quot;login&quot; (and &quot;logout&quot;). Authenticators use the credentials to fill in the details.&lt;/li&gt;
	&lt;li&gt;rename &quot;defaultUser&quot; to &quot;createUser&quot; to make it clear that it&apos;s a factory method that must always return a (new) User who may or may not already be authenticated.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;I know. It&apos;s probably too much.&lt;/p&gt;</comment>
                            <comment id="12893364" author="gdusbabek" created="Wed, 28 Jul 2010 21:05:43 +0000"  >&lt;p&gt;+1 committed.&lt;/p&gt;</comment>
                            <comment id="12893487" author="jbellis" created="Thu, 29 Jul 2010 03:36:42 +0000"  >&lt;p&gt;committing to a users-and-groups approach seems very wrongheaded to me.  the approach of pluggable authenticators to PAM etc seems much better to me (although it&apos;s hard to say now since that patch was deleted &amp;#8211; bad practice there...)&lt;/p&gt;</comment>
                            <comment id="12893489" author="jbellis" created="Thu, 29 Jul 2010 03:50:24 +0000"  >&lt;p&gt;similarly, the AccessLevel change is moving 180 degrees in the wrong direction &amp;#8211; we &lt;em&gt;want&lt;/em&gt; to push that into the authenticator rather than hard-coding it somewhere &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/sad.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="12893608" author="hudson" created="Thu, 29 Jul 2010 13:14:36 +0000"  >&lt;p&gt;Integrated in Cassandra #503 (See &lt;a href=&quot;http://hudson.zones.apache.org/hudson/job/Cassandra/503/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://hudson.zones.apache.org/hudson/job/Cassandra/503/&lt;/a&gt;)&lt;br/&gt;
    apply access.properties to KSM during loadSchemaFromYaml. patch by stuhood, reviewed by gdusbabek. &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-1237&quot; title=&quot;Store AccessLevels externally to IAuthenticator&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-1237&quot;&gt;&lt;del&gt;CASSANDRA-1237&lt;/del&gt;&lt;/a&gt;&lt;br/&gt;
move CS threadlocals into single object. patch by stuhood, reviewed by gdusbabek. &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-1237&quot; title=&quot;Store AccessLevels externally to IAuthenticator&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-1237&quot;&gt;&lt;del&gt;CASSANDRA-1237&lt;/del&gt;&lt;/a&gt;&lt;br/&gt;
new IAuthenticator interface. patch by stuhood, reviewed by gdusbabek. &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-1237&quot; title=&quot;Store AccessLevels externally to IAuthenticator&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-1237&quot;&gt;&lt;del&gt;CASSANDRA-1237&lt;/del&gt;&lt;/a&gt;&lt;br/&gt;
push access structures into KSM. patch by stuhood, reviewed by gdusbabek. &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-1237&quot; title=&quot;Store AccessLevels externally to IAuthenticator&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-1237&quot;&gt;&lt;del&gt;CASSANDRA-1237&lt;/del&gt;&lt;/a&gt;&lt;br/&gt;
put access structures in KsDef. patch by stuhood, reviewed by gdusbabek. &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-1237&quot; title=&quot;Store AccessLevels externally to IAuthenticator&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-1237&quot;&gt;&lt;del&gt;CASSANDRA-1237&lt;/del&gt;&lt;/a&gt;&lt;br/&gt;
move KSM modification code into copy methods. patch by stuhood, reviewed by gdusbabek. &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-1237&quot; title=&quot;Store AccessLevels externally to IAuthenticator&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-1237&quot;&gt;&lt;del&gt;CASSANDRA-1237&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="12893689" author="urandom" created="Thu, 29 Jul 2010 16:29:38 +0000"  >&lt;p&gt;On the one hand, decoupling access levels seems like a Good Move, and from that stand-point this is an improvement over the status quo, but I disagree with the decision to bundle the access levels in keyspace definitions.&lt;/p&gt;

&lt;p&gt;Wouldn&apos;t it be reasonable to create another interface (IAuthority or whatever) and off-load how access levels are persisted to implementations (similar to how it is done with IAuthenticator)?&lt;/p&gt;

&lt;p&gt;-1 (in the ASF-sense), I believe this should be rolled back.&lt;/p&gt;

&lt;p&gt;EDIT: and I do apologize for coming into this late, as opposed to when it was actively being discussed.&lt;/p&gt;</comment>
                            <comment id="12893690" author="urandom" created="Thu, 29 Jul 2010 16:32:43 +0000"  >
&lt;blockquote&gt;
&lt;p&gt;Attached patch shows a simple IAuthenticator for JAAS. With JAAS you can configure LoginModules for Unix users or PAM, for LDAP or Kerberos and you can also write your own LoginModule reading passwd.properties files or even column families. In fact, I have a SimpleLoginModule (similar to SimpleAuthenticator) half ready.&lt;br/&gt;
This authenticator is also not finished, yet. I submitted it because I hope it&apos;s not too late to urge you to make/keep IAuthenticator as lightweight as possible.&lt;br/&gt;
The proposed defaultUser() would make IAuthenticators somewhat stateful. Not good.&lt;/p&gt;

&lt;p&gt;If you&apos;re interested I can open a new issue and submit my JAAS classes there including sample config files and a programmatic JAAS configuration.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;What happened to this? This sounds quite interesting.&lt;/p&gt;</comment>
                            <comment id="12893699" author="stuhood" created="Thu, 29 Jul 2010 17:01:06 +0000"  >&lt;p&gt;&amp;gt; the approach of pluggable authenticators to PAM&lt;br/&gt;
&amp;gt; we want to push that into the authenticator rather than hard-coding it somewhere&lt;br/&gt;
I feel like you&apos;re mixing up &apos;authentication&apos; with &apos;permissions/authorization&apos;... the reasoning behind this ticket is that backends like PAM aren&apos;t designed to provide storage for permissions. Folke&apos;s JAAS example is a great example of authentication (and what he coded will still apply post 1237), but I haven&apos;t seen any JAAS/PAM backends that implement permissions storage.&lt;/p&gt;

&lt;p&gt;&amp;gt; Wouldn&apos;t it be reasonable to create another interface (IAuthority or whatever) and off-load how access levels are persisted&lt;br/&gt;
I think that would be a mistake, without a working backend that filled the interface. Then, imagine how that backend might fill that interface, and I expect you&apos;ll come up with either storing the permissions in their own Keyspace, storing them in a backend specific manner, or attaching them as metadata to the keyspace. The first option is an alternative that should only be implemented once, and therefore shouldn&apos;t have an interface. The second could be handled by the IAuthenticator, and is what we have now. The third option is what is implemented here.&lt;/p&gt;</comment>
                            <comment id="12893730" author="urandom" created="Thu, 29 Jul 2010 17:39:14 +0000"  >&lt;blockquote&gt;&lt;p&gt;...the reasoning behind this ticket is that backends like PAM aren&apos;t designed to provide storage for permissions.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;PAM is a bad example here, and there are plenty of other (more relevant) services and frameworks that do, (think LDAP, radius, tacacs, etc).&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;I think that would be a mistake, without a working backend that filled the interface.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Right, you&apos;d need at least the equivalent of SimpleAuthenticator.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;Then, imagine how that backend might fill that interface, and I expect you&apos;ll come up with either storing the permissions in their own Keyspace, storing them in a backend specific manner, or attaching them as metadata to the keyspace. The first option is an alternative that should only be implemented once, and therefore shouldn&apos;t have an interface. The second could be handled by the IAuthenticator, and is what we have now. The third option is what is implemented here.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;If authorization should be pluggable (I&apos;ve argued that is should be), then &quot;backend specific&quot; is the only option that makes sense.&lt;/p&gt;
</comment>
                            <comment id="12893753" author="messi" created="Thu, 29 Jul 2010 18:23:42 +0000"  >&lt;p&gt;I&apos;m sorry I deleted my patch too early. I wanted to open a new ticket but when I looked over my code I thought that it&apos;s not ready and I want to work on it over the weekend.&lt;/p&gt;

&lt;p&gt;The attached patch adds several classes:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;&lt;ins&gt;JAASAuthenticator:&lt;/ins&gt; an IAuthenticator implemention that uses a LoginContext to request authentication against configured LoginModules. Very simple stuff.&lt;/li&gt;
	&lt;li&gt;&lt;ins&gt;SimpleLoginModule:&lt;/ins&gt; LoginModule impl that could replace SimpleAuthenticator.&lt;/li&gt;
	&lt;li&gt;&lt;ins&gt;SimpleLoginModuleConfiguration:&lt;/ins&gt; programmatic configuration of LoginModules.&lt;/li&gt;
	&lt;li&gt;&lt;ins&gt;User/Group:&lt;/ins&gt; implementations of java.security.Principal added by SimpleLoginModule to the Subject that is passed from the LoginContext to all configured LoginModules.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;This is only proof-of-concept code. I hope I have something cleaner and more robust ready by Sunday.&lt;/p&gt;</comment>
                            <comment id="12893766" author="jbellis" created="Thu, 29 Jul 2010 18:45:20 +0000"  >&lt;p&gt;I agree that committing this was premature, and also apologize for not looking at it earlier.&lt;/p&gt;</comment>
                            <comment id="12893780" author="stuhood" created="Thu, 29 Jul 2010 19:09:11 +0000"  >&lt;p&gt;&amp;gt; If authorization should be pluggable (I&apos;ve argued that is should be)&lt;br/&gt;
I&apos;d be interested in seeing the reasons for making permissions pluggable, if you know where I can find the thread.&lt;/p&gt;</comment>
                            <comment id="12893784" author="gdusbabek" created="Thu, 29 Jul 2010 19:15:43 +0000"  >&lt;p&gt;&amp;gt;&amp;gt; If authorization should be pluggable (I&apos;ve argued that is should be)&lt;br/&gt;
&amp;gt;I&apos;d be interested in seeing the reasons for making permissions pluggable, if you know where I can find the thread.&lt;/p&gt;

&lt;p&gt;Separation of concerns.  I tried to make the argument yesterday that mixing KS definitions with KS permissions was not the right design.&lt;/p&gt;</comment>
                            <comment id="12893787" author="stuhood" created="Thu, 29 Jul 2010 19:25:57 +0000"  >&lt;p&gt;&amp;gt; Separation of concerns. I tried to make the argument yesterday that mixing KS definitions with KS permissions was not the right design.&lt;br/&gt;
Separation of concerns is not an argument for making it pluggable (pluggable implies multiple implementations), although it is an argument for storing the permissions somewhere other than in the metadata for the keyspace.&lt;/p&gt;</comment>
                            <comment id="12893794" author="urandom" created="Thu, 29 Jul 2010 19:43:44 +0000"  >&lt;blockquote&gt;
&lt;p&gt;&amp;gt; If authorization should be pluggable (I&apos;ve argued that is should be)&lt;br/&gt;
I&apos;d be interested in seeing the reasons for making permissions pluggable, if you know where I can find the thread.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Directory services like LDAP and Active Directory seem like prominent examples of existing systems that people might want to integrate with for authorization, (as well as authentication). And, I&apos;m sure there are plenty of people with existing databases, web services, etc that would appreciate the opportunity to integrate instead of duplicating that information.&lt;/p&gt;</comment>
                            <comment id="12893806" author="messi" created="Thu, 29 Jul 2010 20:22:28 +0000"  >&lt;p&gt;I don&apos;t think you can make authorization pluggable: authorization is very specific, it requires predefined permissions and/or group/role names, and authz is done at many places in the code. I recommend an authorization infrastructure that does not authorize users directly but groups or roles. An authenticator must return a list of groups a user belongs to and the authz infrastructure renders a list of permissions. In Cassandra you just ask if UserX.isAllowedTo(READ, &quot;Keyspace1&quot;);&lt;/p&gt;</comment>
                            <comment id="12894040" author="hudson" created="Fri, 30 Jul 2010 13:37:48 +0000"  >&lt;p&gt;Integrated in Cassandra #504 (See &lt;a href=&quot;http://hudson.zones.apache.org/hudson/job/Cassandra/504/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://hudson.zones.apache.org/hudson/job/Cassandra/504/&lt;/a&gt;)&lt;br/&gt;
    revert 980215, 980217, 980220, 980222, 980225, 980226. &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-1237&quot; title=&quot;Store AccessLevels externally to IAuthenticator&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-1237&quot;&gt;&lt;del&gt;CASSANDRA-1237&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="12899052" author="stuhood" created="Mon, 16 Aug 2010 19:49:09 +0000"  >&lt;p&gt;In summary, there appear to be 3 distinct options for how to move forward with authorization. Remember that this ticket is about disconnecting authorization (permissions) from authentication (user/group identification), and its goal is to leave authentication pluggable.&lt;/p&gt;

&lt;p&gt;Options:&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;Leave authentication and authorization in the same interface. If we choose this option, this ticket is invalid, and &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-1271&quot; title=&quot;Improve permissions to allow control over creation/removal/listing of Keyspaces&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-1271&quot;&gt;&lt;del&gt;CASSANDRA-1271&lt;/del&gt;&lt;/a&gt; and &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-1320&quot; title=&quot;Convert AccessLevel to Set&amp;lt;Permission&amp;gt;&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-1320&quot;&gt;&lt;del&gt;CASSANDRA-1320&lt;/del&gt;&lt;/a&gt; will add-to/improve IAuthenticator
	&lt;ul&gt;
		&lt;li&gt;Pros:
		&lt;ul&gt;
			&lt;li&gt;Least change&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
		&lt;li&gt;Cons:
		&lt;ul&gt;
			&lt;li&gt;Very little actually implemented by Cassandra: burden is on the backend implementors&lt;/li&gt;
			&lt;li&gt;Each combination of authz and authc backends would require a new implementation (PAM for authc + permissions keyspace for authz, for instance), causing an explosion of implementations&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
	&lt;li&gt;Separate out a pluggable IAuthority interface to implement authorization
	&lt;ol&gt;
		&lt;li&gt;IAuthenticator interface would be called at login time to determine user/groups membership&lt;/li&gt;
		&lt;li&gt;IAuthority would be called at operation time with the user/groups determined earlier, and the required permission for the operation&lt;/li&gt;
	&lt;/ol&gt;
	&lt;ul&gt;
		&lt;li&gt;Pros:
		&lt;ul&gt;
			&lt;li&gt;Provides the cleanest separation of concerns&lt;/li&gt;
			&lt;li&gt;Allows plugability for permissions&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
		&lt;li&gt;Cons:
		&lt;ul&gt;
			&lt;li&gt;Pluggability of permissions gains limited benefit&lt;/li&gt;
			&lt;li&gt;IAuthority would need to support callbacks for keyspace/cf creation and removal to keep existing keyspaces in sync with their permissions (although technically, option 1 suffers from this as well)&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
	&lt;li&gt;Separate authorization, but do not make it pluggable
	&lt;ul&gt;
		&lt;li&gt;This option is implemented by the existing patchset by attaching permissions to metadata, but could have an alternative implementation that stores permissions in a permissions keyspace.&lt;/li&gt;
		&lt;li&gt;Pros:
		&lt;ul&gt;
			&lt;li&gt;Cassandra controls the scalability of authorization, and can ensure it does not become a bottleneck&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
		&lt;li&gt;Cons:
		&lt;ul&gt;
			&lt;li&gt;Would need to support callbacks for user creation and removal to keep existing users in sync with their permissions&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ol&gt;
</comment>
                            <comment id="12899074" author="urandom" created="Mon, 16 Aug 2010 20:24:11 +0000"  >&lt;p&gt;The pressing problem is that the current implementation predates dynamically created keyspaces/column families and as a result it&apos;s not possible to add/remove keyspaces with auth enabled.  It&apos;s also quite late in the 0.7 cycle so &quot;least change&quot; from #1 seems quite appealing.&lt;/p&gt;</comment>
                            <comment id="12899079" author="stuhood" created="Mon, 16 Aug 2010 20:37:53 +0000"  >&lt;p&gt;&amp;gt; The pressing problem is that the current implementation predates dynamically created keyspaces/column families&lt;br/&gt;
Correct.. &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-1271&quot; title=&quot;Improve permissions to allow control over creation/removal/listing of Keyspaces&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-1271&quot;&gt;&lt;del&gt;CASSANDRA-1271&lt;/del&gt;&lt;/a&gt; addresses that issue. I think it is too late to make any of these changes in 0.7, so I&apos;m interested in what you think we can/should do for 0.8.&lt;/p&gt;</comment>
                            <comment id="12899134" author="toulmean" created="Mon, 16 Aug 2010 22:15:39 +0000"  >&lt;p&gt;I am in favor of 3. I like that it keeps scalability over checking permissions, and I like it is made pluggable for people to integrate with LDAP or their own framework.&lt;/p&gt;</comment>
                            <comment id="12899138" author="urandom" created="Mon, 16 Aug 2010 22:22:45 +0000"  >&lt;blockquote&gt;&lt;p&gt;I am in favor of 3. I like that it keeps scalability over checking permissions, and I like it is made pluggable for people to integrate with LDAP or their own framework.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;3 is decidedly &lt;em&gt;not&lt;/em&gt; pluggable with respect to authorization (only authentication).   Also, there is also nothing to prevent you from implementing a back-end that stored credentials and/or permissions in Cassandra. &lt;/p&gt;</comment>
                            <comment id="12899555" author="rnirmal" created="Tue, 17 Aug 2010 20:07:53 +0000"  >&lt;p&gt;Here&apos;s some probable use cases for Authz:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;User A / Group B -&amp;gt; read/write KS1, KS2: read KS3&lt;/li&gt;
	&lt;li&gt;User C / Group D -&amp;gt; create/rename/drop KS/CF&lt;/li&gt;
	&lt;li&gt;User E -&amp;gt; read/write KS1-CF1, KS1-CF2: read KS1-CF3&lt;/li&gt;
	&lt;li&gt;Admin -&amp;gt; add/modify/delete Users/groups/permissions&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="12901550" author="stuhood" created="Mon, 23 Aug 2010 19:27:27 +0000"  >&lt;p&gt;I think it should be possible to implement option #2 before 0.7 final, if we defer implementing the &apos;callbacks&apos; until we have a backend that can support modifying its permissions (SimpleAuthenticator cannot).&lt;/p&gt;

&lt;p&gt;Split &lt;tt&gt;AccessLevel IAuthenticator.login(String keyspace, Map credentials)&lt;/tt&gt; into:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;&lt;tt&gt;AuthenticatedUser IAuthenticator.authenticate(Map credentials)&lt;/tt&gt;
	&lt;ul&gt;
		&lt;li&gt;Where AuthenticatedUser is similar to the implementation in the existing patchset, but without a &apos;isSuper&apos; flag, since the IAuthority should make that decision&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
	&lt;li&gt;&lt;tt&gt;AccessLevel IAuthority.authorize(AuthenticatedUser user,  String keyspace)&lt;/tt&gt;
	&lt;ul&gt;
		&lt;li&gt;In &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-1320&quot; title=&quot;Convert AccessLevel to Set&amp;lt;Permission&amp;gt;&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-1320&quot;&gt;&lt;del&gt;CASSANDRA-1320&lt;/del&gt;&lt;/a&gt;, AccessLevel will be replaced with a Set&amp;lt;Permission&amp;gt;&lt;/li&gt;
		&lt;li&gt;In &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-1271&quot; title=&quot;Improve permissions to allow control over creation/removal/listing of Keyspaces&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-1271&quot;&gt;&lt;del&gt;CASSANDRA-1271&lt;/del&gt;&lt;/a&gt;, keyspace will be replaced with a generic &apos;resource&apos; hierarchy&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Does this sound reasonable?&lt;/p&gt;</comment>
                            <comment id="12901569" author="urandom" created="Mon, 23 Aug 2010 20:04:20 +0000"  >&lt;blockquote&gt;&lt;p&gt;Does this sound reasonable?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;It sounds reasonable to me.&lt;/p&gt;</comment>
                            <comment id="12902280" author="stuhood" created="Wed, 25 Aug 2010 02:29:52 +0000"  >&lt;p&gt;Implementation of option 2:&lt;/p&gt;

&lt;p&gt;v2-0001 - Removes AccessLevel return value from login in the client APIs&lt;br/&gt;
v2-0002 - Splits IAuthority out of IAuthenticator: SimpleAuthority and SimpleAuthenticator are backwards compatible&lt;br/&gt;
v2-0003 - Removes some reflection-centered duplication&lt;br/&gt;
v2-0004 - Allows configuration of an IAuthority, and specifies SimpleAuthority for upgraders who have configured SimpleAuthenticator&lt;br/&gt;
v2-0005 - Splits the authc/z ThreadLocals out of the CassandraServers and into a ClientState object&lt;/p&gt;</comment>
                            <comment id="12902281" author="stuhood" created="Wed, 25 Aug 2010 02:31:11 +0000"  >&lt;p&gt;Optimistically targetting back to 0.7-beta2 (sorry for the flapping).&lt;/p&gt;</comment>
                            <comment id="12902620" author="urandom" created="Wed, 25 Aug 2010 20:43:17 +0000"  >&lt;p&gt;committed; thanks!&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10032">
                    <name>Blocker</name>
                                                                <inwardlinks description="is blocked by">
                                        <issuelink>
            <issuekey id="12466832">CASSANDRA-1186</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12450717" name="0001-Consolidate-KSMetaData-mutations-into-copy-methods.patch" size="9143" author="stuhood" created="Wed, 28 Jul 2010 16:58:14 +0000"/>
                            <attachment id="12450718" name="0002-Thrift-and-Avro-interface-changes.patch" size="53979" author="stuhood" created="Wed, 28 Jul 2010 16:58:14 +0000"/>
                            <attachment id="12450719" name="0003-Add-user-and-group-access-maps-to-Keyspace-metadata.patch" size="15891" author="stuhood" created="Wed, 28 Jul 2010 16:58:14 +0000"/>
                            <attachment id="12450720" name="0004-Remove-AccessLevel-return-value-from-login-and-retur.patch" size="19108" author="stuhood" created="Wed, 28 Jul 2010 16:58:45 +0000"/>
                            <attachment id="12450721" name="0005-Move-per-thread-state-into-a-ClientState-object-1-pe.patch" size="31557" author="stuhood" created="Wed, 28 Jul 2010 16:58:45 +0000"/>
                            <attachment id="12450722" name="0006-Apply-access.properties-to-keyspaces-during-an-upgra.patch" size="5266" author="stuhood" created="Wed, 28 Jul 2010 16:58:45 +0000"/>
                            <attachment id="12453007" name="sample-usage.patch" size="1988" author="stuhood" created="Wed, 25 Aug 2010 02:29:52 +0000"/>
                            <attachment id="12450850" name="simple-jaas-authenticator.patch" size="20064" author="messi" created="Thu, 29 Jul 2010 18:23:42 +0000"/>
                            <attachment id="12453002" name="v2-0001-Remove-AccessLevel-return-value-from-login-since-aut.patch" size="13469" author="stuhood" created="Wed, 25 Aug 2010 02:21:58 +0000"/>
                            <attachment id="12453005" name="v2-0002-Add-IAuthority-and-split-login-into-authenticate-aut.patch" size="23993" author="stuhood" created="Wed, 25 Aug 2010 02:29:52 +0000"/>
                            <attachment id="12453004" name="v2-0003-Factor-out-reflection-based-class-construction.patch" size="14358" author="stuhood" created="Wed, 25 Aug 2010 02:21:58 +0000"/>
                            <attachment id="12453003" name="v2-0004-Add-configuration-for-IAuthority-and-handle-SimpleAu.patch" size="5570" author="stuhood" created="Wed, 25 Aug 2010 02:21:58 +0000"/>
                            <attachment id="12453006" name="v2-0005-Separate-authentication-and-authorization-into-Clien.patch" size="28761" author="stuhood" created="Wed, 25 Aug 2010 02:29:52 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>13.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[stuhood]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>20043</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            15 years, 13 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0g3tz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>92051</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>urandom</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[urandom]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12962"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>