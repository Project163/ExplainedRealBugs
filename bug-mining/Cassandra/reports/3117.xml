<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 22:48:09 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-7828] New node cannot be joined if a value in composite type column is dropped (description updated)</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-7828</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;I get a &lt;b&gt;RuntimeException&lt;/b&gt; at new node system.log on bootstrapping a new DC:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-style: solid;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeHeader panelHeader&quot; style=&quot;border-bottom-width: 1px;border-bottom-style: solid;&quot;&gt;&lt;b&gt;system.out - RuntimeException caused by IllegalArgumentException in Buffer.limit&lt;/b&gt;&lt;/div&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;INFO [NonPeriodicTasks:1] 2014-08-26 15:43:01,030 SecondaryIndexManager.java (line 137) Submitting index build of [myColumnFamily.myColumnFamily_myColumn] &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; data in SSTableReader(path=&lt;span class=&quot;code-quote&quot;&gt;&apos;/&lt;span class=&quot;code-keyword&quot;&gt;var&lt;/span&gt;/lib/cassandra/data/testbug/myColumnFamily/testbug-myColumnFamily-jb-1-Data.db&apos;&lt;/span&gt;)
ERROR [CompactionExecutor:2] 2014-08-26 15:43:01,035 CassandraDaemon.java (line 199) Exception in thread &lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;[CompactionExecutor:2,1,main]
java.lang.IllegalArgumentException
	at java.nio.Buffer.limit(Buffer.java:267)
	at org.apache.cassandra.utils.ByteBufferUtil.readBytes(ByteBufferUtil.java:587)
	at org.apache.cassandra.utils.ByteBufferUtil.readBytesWithShortLength(ByteBufferUtil.java:596)
	at org.apache.cassandra.db.marshal.AbstractCompositeType.compare(AbstractCompositeType.java:61)
	at org.apache.cassandra.db.marshal.AbstractCompositeType.compare(AbstractCompositeType.java:36)
	at org.apache.cassandra.dht.LocalToken.compareTo(LocalToken.java:44)
	at org.apache.cassandra.db.DecoratedKey.compareTo(DecoratedKey.java:85)
	at org.apache.cassandra.db.DecoratedKey.compareTo(DecoratedKey.java:36)
	at java.util.concurrent.ConcurrentSkipListMap.findPredecessor(ConcurrentSkipListMap.java:727)
	at java.util.concurrent.ConcurrentSkipListMap.findNode(ConcurrentSkipListMap.java:789)
	at java.util.concurrent.ConcurrentSkipListMap.doGet(ConcurrentSkipListMap.java:828)
	at java.util.concurrent.ConcurrentSkipListMap.get(ConcurrentSkipListMap.java:1626)
	at org.apache.cassandra.db.Memtable.resolve(Memtable.java:215)
	at org.apache.cassandra.db.Memtable.put(Memtable.java:173)
	at org.apache.cassandra.db.ColumnFamilyStore.apply(ColumnFamilyStore.java:900)
	at org.apache.cassandra.db.index.AbstractSimplePerColumnSecondaryIndex.insert(AbstractSimplePerColumnSecondaryIndex.java:107)
	at org.apache.cassandra.db.index.SecondaryIndexManager.indexRow(SecondaryIndexManager.java:441)
	at org.apache.cassandra.db.Keyspace.indexRow(Keyspace.java:413)
	at org.apache.cassandra.db.index.SecondaryIndexBuilder.build(SecondaryIndexBuilder.java:62)
	at org.apache.cassandra.db.compaction.CompactionManager$9.run(CompactionManager.java:834)
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:471)
	at java.util.concurrent.FutureTask.run(FutureTask.java:262)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1145)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:615)
	at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:745)
ERROR [NonPeriodicTasks:1] 2014-08-26 15:43:01,035 CassandraDaemon.java (line 199) Exception in thread &lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;[NonPeriodicTasks:1,5,main]
java.lang.RuntimeException: java.util.concurrent.ExecutionException: java.lang.IllegalArgumentException
	at org.apache.cassandra.utils.FBUtilities.waitOnFuture(FBUtilities.java:413)
	at org.apache.cassandra.db.index.SecondaryIndexManager.maybeBuildSecondaryIndexes(SecondaryIndexManager.java:142)
	at org.apache.cassandra.streaming.StreamReceiveTask$OnCompletionRunnable.run(StreamReceiveTask.java:113)
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:471)
	at java.util.concurrent.FutureTask.run(FutureTask.java:262)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.access$201(ScheduledThreadPoolExecutor.java:178)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:292)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1145)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:615)
	at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:745)
Caused by: java.util.concurrent.ExecutionException: java.lang.IllegalArgumentException
	at java.util.concurrent.FutureTask.report(FutureTask.java:122)
	at java.util.concurrent.FutureTask.get(FutureTask.java:188)
	at org.apache.cassandra.utils.FBUtilities.waitOnFuture(FBUtilities.java:409)
	... 9 more
Caused by: java.lang.IllegalArgumentException
	at java.nio.Buffer.limit(Buffer.java:267)
	at org.apache.cassandra.utils.ByteBufferUtil.readBytes(ByteBufferUtil.java:587)
	at org.apache.cassandra.utils.ByteBufferUtil.readBytesWithShortLength(ByteBufferUtil.java:596)
	at org.apache.cassandra.db.marshal.AbstractCompositeType.compare(AbstractCompositeType.java:61)
	at org.apache.cassandra.db.marshal.AbstractCompositeType.compare(AbstractCompositeType.java:36)
	at org.apache.cassandra.dht.LocalToken.compareTo(LocalToken.java:44)
	at org.apache.cassandra.db.DecoratedKey.compareTo(DecoratedKey.java:85)
	at org.apache.cassandra.db.DecoratedKey.compareTo(DecoratedKey.java:36)
	at java.util.concurrent.ConcurrentSkipListMap.findPredecessor(ConcurrentSkipListMap.java:727)
	at java.util.concurrent.ConcurrentSkipListMap.findNode(ConcurrentSkipListMap.java:789)
	at java.util.concurrent.ConcurrentSkipListMap.doGet(ConcurrentSkipListMap.java:828)
	at java.util.concurrent.ConcurrentSkipListMap.get(ConcurrentSkipListMap.java:1626)
	at org.apache.cassandra.db.Memtable.resolve(Memtable.java:215)
	at org.apache.cassandra.db.Memtable.put(Memtable.java:173)
	at org.apache.cassandra.db.ColumnFamilyStore.apply(ColumnFamilyStore.java:900)
	at org.apache.cassandra.db.index.AbstractSimplePerColumnSecondaryIndex.insert(AbstractSimplePerColumnSecondaryIndex.java:107)
	at org.apache.cassandra.db.index.SecondaryIndexManager.indexRow(SecondaryIndexManager.java:441)
	at org.apache.cassandra.db.Keyspace.indexRow(Keyspace.java:413)
	at org.apache.cassandra.db.index.SecondaryIndexBuilder.build(SecondaryIndexBuilder.java:62)
	at org.apache.cassandra.db.compaction.CompactionManager$9.run(CompactionManager.java:834)
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:471)
	at java.util.concurrent.FutureTask.run(FutureTask.java:262)
	... 3 more
ERROR [CompactionExecutor:2] 2014-08-26 15:43:01,036 CassandraDaemon.java (line 199) Exception in thread &lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;[CompactionExecutor:2,1,main]
java.lang.IllegalArgumentException
	at java.nio.Buffer.limit(Buffer.java:267)
	at org.apache.cassandra.utils.ByteBufferUtil.readBytes(ByteBufferUtil.java:587)
	at org.apache.cassandra.utils.ByteBufferUtil.readBytesWithShortLength(ByteBufferUtil.java:596)
	at org.apache.cassandra.db.marshal.AbstractCompositeType.compare(AbstractCompositeType.java:61)
	at org.apache.cassandra.db.marshal.AbstractCompositeType.compare(AbstractCompositeType.java:36)
	at org.apache.cassandra.dht.LocalToken.compareTo(LocalToken.java:44)
	at org.apache.cassandra.db.DecoratedKey.compareTo(DecoratedKey.java:85)
	at org.apache.cassandra.db.DecoratedKey.compareTo(DecoratedKey.java:36)
	at java.util.concurrent.ConcurrentSkipListMap.findPredecessor(ConcurrentSkipListMap.java:727)
	at java.util.concurrent.ConcurrentSkipListMap.findNode(ConcurrentSkipListMap.java:789)
	at java.util.concurrent.ConcurrentSkipListMap.doGet(ConcurrentSkipListMap.java:828)
	at java.util.concurrent.ConcurrentSkipListMap.get(ConcurrentSkipListMap.java:1626)
	at org.apache.cassandra.db.Memtable.resolve(Memtable.java:215)
	at org.apache.cassandra.db.Memtable.put(Memtable.java:173)
	at org.apache.cassandra.db.ColumnFamilyStore.apply(ColumnFamilyStore.java:900)
	at org.apache.cassandra.db.index.AbstractSimplePerColumnSecondaryIndex.insert(AbstractSimplePerColumnSecondaryIndex.java:107)
	at org.apache.cassandra.db.index.SecondaryIndexManager.indexRow(SecondaryIndexManager.java:441)
	at org.apache.cassandra.db.Keyspace.indexRow(Keyspace.java:413)
	at org.apache.cassandra.db.index.SecondaryIndexBuilder.build(SecondaryIndexBuilder.java:62)
	at org.apache.cassandra.db.compaction.CompactionManager$9.run(CompactionManager.java:834)
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:471)
	at java.util.concurrent.FutureTask.run(FutureTask.java:262)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1145)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:615)
	at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:745)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;My steps to reproduce (&#1057;assandra 2.0.9):&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;In one node datacenter DC1 create a keyspace with NetworkTopologyStrategy, options DC1=1, DC2=1.&lt;/li&gt;
	&lt;li&gt;Create a CF with a secondary index on a CompositeType(Int32Type, UUIDType).&lt;/li&gt;
	&lt;li&gt;Write any composite value to a row.&lt;/li&gt;
	&lt;li&gt;Drop the value.&lt;/li&gt;
	&lt;li&gt;Write another composite value to another row.&lt;/li&gt;
	&lt;li&gt;Drop second value.&lt;/li&gt;
	&lt;li&gt;Bootstrap add a new node in DC2.&lt;/li&gt;
	&lt;li&gt;DC2 gets an exception.&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;The similar issue I got  on indexed composite column in a single 3 nodes DC with SimpleStrategy and replication_factor=3 (cassandra 1.2.18).&lt;/p&gt;

&lt;p&gt;I use Astyanax 2.0.1 (I tested on Astyanax 1.56.49 as well), here is the code that generates keyspace (steps 1-6) that fails on a new datacenter node bootstrap:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-style: solid;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeHeader panelHeader&quot; style=&quot;border-bottom-width: 1px;border-bottom-style: solid;&quot;&gt;&lt;b&gt;CassandraBugTest.java&lt;/b&gt;&lt;/div&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;package&lt;/span&gt; test;

&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; com.netflix.astyanax.AstyanaxContext;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; com.netflix.astyanax.Cluster;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; com.netflix.astyanax.Keyspace;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; com.netflix.astyanax.connectionpool.NodeDiscoveryType;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; com.netflix.astyanax.connectionpool.exceptions.BadRequestException;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; com.netflix.astyanax.connectionpool.exceptions.ConnectionException;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; com.netflix.astyanax.connectionpool.impl.ConnectionPoolConfigurationImpl;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; com.netflix.astyanax.connectionpool.impl.ConnectionPoolType;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; com.netflix.astyanax.connectionpool.impl.Slf4jConnectionPoolMonitorImpl;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; com.netflix.astyanax.ddl.ColumnDefinition;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; com.netflix.astyanax.ddl.ColumnFamilyDefinition;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; com.netflix.astyanax.ddl.KeyspaceDefinition;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; com.netflix.astyanax.impl.AstyanaxConfigurationImpl;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; com.netflix.astyanax.model.ColumnFamily;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; com.netflix.astyanax.model.Composite;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; com.netflix.astyanax.model.ConsistencyLevel;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; com.netflix.astyanax.serializers.*;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; com.netflix.astyanax.thrift.ThriftFamilyFactory;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.junit.Test;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.junit.runner.RunWith;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.junit.runners.JUnit4;

&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; java.util.HashMap;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; java.util.Map;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; java.util.UUID;

@RunWith(JUnit4.class)
&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;CassandraBugTest
{
    &lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; SEEDS = &lt;span class=&quot;code-quote&quot;&gt;&quot;dc1n1&quot;&lt;/span&gt;;
    &lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; CLUSTER_NAME = &lt;span class=&quot;code-quote&quot;&gt;&quot;Test Cluster&quot;&lt;/span&gt;;
    &lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; KEYSPACE_NAME = &lt;span class=&quot;code-quote&quot;&gt;&quot;testbug&quot;&lt;/span&gt;;
    &lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; COLUMN_FAMILY_NAME = &lt;span class=&quot;code-quote&quot;&gt;&quot;myColumnFamily&quot;&lt;/span&gt;;
    &lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; COLUMN_NAME = &lt;span class=&quot;code-quote&quot;&gt;&quot;myColumn&quot;&lt;/span&gt;;

    @Test
    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void test() &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; ConnectionException, InterruptedException
    {
        AstyanaxContext.Builder builder = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; AstyanaxContext.Builder()
                .forCluster(CLUSTER_NAME)
                .forKeyspace(KEYSPACE_NAME)
                .withAstyanaxConfiguration(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; AstyanaxConfigurationImpl()
                                .setDiscoveryType(NodeDiscoveryType.RING_DESCRIBE)
                                .setConnectionPoolType(ConnectionPoolType.TOKEN_AWARE)
                                .setCqlVersion(&lt;span class=&quot;code-quote&quot;&gt;&quot;3.1.7&quot;&lt;/span&gt;)
                                .setTargetCassandraVersion(&lt;span class=&quot;code-quote&quot;&gt;&quot;2.0.9&quot;&lt;/span&gt;)
                                .setDefaultWriteConsistencyLevel(ConsistencyLevel.CL_LOCAL_QUORUM)
                                .setDefaultReadConsistencyLevel(ConsistencyLevel.CL_LOCAL_QUORUM)
                )
                .withConnectionPoolConfiguration(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; ConnectionPoolConfigurationImpl(&lt;span class=&quot;code-quote&quot;&gt;&quot;TaxiClusterConnectionPool&quot;&lt;/span&gt;)
                                .setInitConnsPerHost(1)
                                .setMaxConnsPerHost(8)
                                .setSeeds(SEEDS)
                )
                .withConnectionPoolMonitor(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Slf4jConnectionPoolMonitorImpl());

        AstyanaxContext&amp;lt;Cluster&amp;gt; clusterContext = builder.buildCluster(ThriftFamilyFactory.getInstance());
        clusterContext.start();
        Cluster cluster = clusterContext.getClient();

        Map&amp;lt;&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;, &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;&amp;gt; options = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; HashMap&amp;lt;&amp;gt;();
        options.put(&lt;span class=&quot;code-quote&quot;&gt;&quot;DC1&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;1&quot;&lt;/span&gt;);
        options.put(&lt;span class=&quot;code-quote&quot;&gt;&quot;DC2&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;1&quot;&lt;/span&gt;);

        KeyspaceDefinition keyspaceDef = cluster.makeKeyspaceDefinition()
                                                .setName(KEYSPACE_NAME)
                                                .setStrategyClass(&lt;span class=&quot;code-quote&quot;&gt;&quot;NetworkTopologyStrategy&quot;&lt;/span&gt;)
                                                .setStrategyOptions(options);

        &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt;
        {
            cluster.dropKeyspace(KEYSPACE_NAME);
        }
        &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt; (BadRequestException e)
        {
        }

        cluster.addKeyspace(keyspaceDef);

        ColumnFamily&amp;lt;UUID, &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;&amp;gt; profiles = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; ColumnFamily&amp;lt;&amp;gt;(COLUMN_FAMILY_NAME, UUIDSerializer.get(), StringSerializer.get());

        ColumnFamilyDefinition columnFamilyDef = cluster.makeColumnFamilyDefinition()
                                                        .setName(profiles.getName())
                                                        .setKeyspace(KEYSPACE_NAME)
                                                        .setKeyValidationClass(profiles.getKeySerializer().getComparatorType().getTypeName())
                                                        .setComparatorType(profiles.getColumnSerializer().getComparatorType().getTypeName());

        ColumnDefinition columnDef = cluster.makeColumnDefinition()
                                            .setValidationClass(
                                                    ComparatorType.COMPOSITETYPE.getTypeName() +
                                                    &lt;span class=&quot;code-quote&quot;&gt;&quot;(&quot;&lt;/span&gt; + ComparatorType.INT32TYPE.getTypeName() +
                                                    &lt;span class=&quot;code-quote&quot;&gt;&quot;,&quot;&lt;/span&gt; + ComparatorType.UUIDTYPE.getTypeName() +
                                                    &lt;span class=&quot;code-quote&quot;&gt;&quot;)&quot;&lt;/span&gt;
                                            )
&lt;span class=&quot;code-comment&quot;&gt;//                                             Use BYTESTYPE here &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; validation &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;&lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; workaround, then no bug occurs.
&lt;/span&gt;&lt;span class=&quot;code-comment&quot;&gt;//                                            .setValidationClass(ComparatorType.BYTESTYPE.getTypeName())
&lt;/span&gt;                                            .setName(COLUMN_NAME)
                                            .setIndex(COLUMN_FAMILY_NAME + &lt;span class=&quot;code-quote&quot;&gt;&quot;_&quot;&lt;/span&gt; + COLUMN_NAME, &lt;span class=&quot;code-quote&quot;&gt;&quot;KEYS&quot;&lt;/span&gt;);

        columnFamilyDef.addColumnDefinition(columnDef);

        cluster.addColumnFamily(columnFamilyDef);

        AstyanaxContext&amp;lt;Keyspace&amp;gt; keyspaceContext = builder.buildKeyspace(ThriftFamilyFactory.getInstance());
        keyspaceContext.start();
        Keyspace keyspace = keyspaceContext.getClient();

        &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; (&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; i = 0; i &amp;lt; 100; ++i)
        {
            UUID id = UUID.randomUUID();
            Composite value = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Composite();
            value.addComponent(1, IntegerSerializer.get());
            value.addComponent(UUID.randomUUID(), UUIDSerializer.get());
            value.setSerializersByPosition(IntegerSerializer.get(), UUIDSerializer.get());

            keyspace.prepareColumnMutation(profiles, id, COLUMN_NAME)
                    .putValue(value, CompositeSerializer.get(), &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;)
                    .execute();

            keyspace.prepareColumnMutation(profiles, id, COLUMN_NAME)
                    .deleteColumn()
                    .execute();
        }
    }
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="12736680">CASSANDRA-7828</key>
            <summary>New node cannot be joined if a value in composite type column is dropped (description updated)</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10002" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Normal</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="mishail">Mikhail Stepura</assignee>
                                    <reporter username="geagle">Igor Zubchenok</reporter>
                        <labels>
                    </labels>
                <created>Tue, 26 Aug 2014 00:43:39 +0000</created>
                <updated>Tue, 16 Apr 2019 09:31:35 +0000</updated>
                            <resolved>Mon, 8 Sep 2014 19:23:22 +0000</resolved>
                                        <fixVersion>1.2.19</fixVersion>
                    <fixVersion>2.0.11</fixVersion>
                    <fixVersion>2.1.1</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>6</watches>
                                                                                                                <comments>
                            <comment id="14110763" author="geagle" created="Tue, 26 Aug 2014 14:37:17 +0000"  >&lt;p&gt;As a workaround I found that it works if I use BytesType validation class for the column (aka blob). But still no way to have it working with CompositeType.&lt;/p&gt;</comment>
                            <comment id="14121934" author="geagle" created="Thu, 4 Sep 2014 20:23:23 +0000"  >&lt;p&gt;Could anyone comment on this? Thanks&lt;/p&gt;</comment>
                            <comment id="14122069" author="mshuler" created="Thu, 4 Sep 2014 22:07:52 +0000"  >&lt;p&gt;Is this reproducible on 2.0.10?&lt;/p&gt;</comment>
                            <comment id="14124256" author="mishail" created="Sat, 6 Sep 2014 02:05:43 +0000"  >&lt;p&gt;It looks like the problem is that &lt;tt&gt;SecondaryIndexManager.indexRow()&lt;/tt&gt; doesn&apos;t check whether a cell is alive or not.&lt;br/&gt;
I was able to reproduce the problem using &lt;tt&gt;loadNewSSTables&lt;/tt&gt; with files in the attached zip, which use the same code path.&lt;/p&gt;

&lt;p&gt;I&apos;m attaching a patch to add such check&lt;/p&gt;</comment>
                            <comment id="14125776" author="mishail" created="Mon, 8 Sep 2014 17:21:37 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=iamaleksey&quot; class=&quot;user-hover&quot; rel=&quot;iamaleksey&quot;&gt;iamaleksey&lt;/a&gt; could you please review?&lt;/p&gt;</comment>
                            <comment id="14125848" author="iamaleksey" created="Mon, 8 Sep 2014 18:13:37 +0000"  >&lt;p&gt;+1&lt;/p&gt;

&lt;p&gt;On merge w/ 2.1 should switch to argument-less Cell#isLive().&lt;/p&gt;</comment>
                            <comment id="14125943" author="mishail" created="Mon, 8 Sep 2014 19:14:21 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=iamaleksey&quot; class=&quot;user-hover&quot; rel=&quot;iamaleksey&quot;&gt;iamaleksey&lt;/a&gt; should we merge it into 2.1.0 as well?&lt;/p&gt;</comment>
                            <comment id="14125944" author="iamaleksey" created="Mon, 8 Sep 2014 19:15:21 +0000"  >&lt;p&gt;No, cassandra-2.1.0 branch will be removed soon, since 2.1.0 is done.&lt;/p&gt;</comment>
                            <comment id="14125956" author="mishail" created="Mon, 8 Sep 2014 19:23:22 +0000"  >&lt;p&gt;Committed, thanks&lt;/p&gt;</comment>
                            <comment id="14127645" author="peter-librato" created="Tue, 9 Sep 2014 22:10:03 +0000"  >&lt;p&gt;This is listed in the 2.0 CHANGES.txt as present in 2.0.10 but &quot;Fix Versions&quot; shows 2.0.11.&lt;/p&gt;</comment>
                            <comment id="14127663" author="mishail" created="Tue, 9 Sep 2014 22:18:21 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=peter-librato&quot; class=&quot;user-hover&quot; rel=&quot;peter-librato&quot;&gt;peter-librato&lt;/a&gt; Mea culpa. That&apos;s because a merge conflict&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12666975" name="1409959462180-myColumnFamily.zip" size="16408" author="mishail" created="Sat, 6 Sep 2014 02:05:43 +0000"/>
                            <attachment id="12666974" name="CASSANDRA-2.0-7828.patch" size="1041" author="mishail" created="Sat, 6 Sep 2014 02:05:43 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[mishail]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            11 years, 11 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1zbk7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12311421" key="com.atlassian.jira.plugin.system.customfieldtypes:multiversion">
                        <customfieldname>Reproduced In</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="12327158">1.2.18</customfieldvalue>
    <customfieldvalue id="12327164">2.0.10</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>aleksey</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[aleksey]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12962"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12311420" key="com.atlassian.jira.plugin.system.customfieldtypes:version">
                        <customfieldname>Since Version</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="12327158">1.2.18</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>