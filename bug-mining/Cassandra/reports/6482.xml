<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 23:30:14 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-19565] SIGSEGV on Cassandra v4.1.4</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-19565</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;Hello,&lt;/p&gt;

&lt;p&gt;Since upgrading to v4.1. we cannat run CAssandra any more. Each start immediately crashes:&lt;br/&gt;
{{Apr 17 08:58:34 SVALD108 cassandra&lt;span class=&quot;error&quot;&gt;&amp;#91;1116450&amp;#93;&lt;/span&gt;: # A fatal error has been detected by the Java Runtime Environment:&lt;br/&gt;
Apr 17 08:58:34 SVALD108 cassandra&lt;span class=&quot;error&quot;&gt;&amp;#91;1116450&amp;#93;&lt;/span&gt;: #  SIGSEGV (0xb) at pc=0x00007fccaab4d152, pid=1116450, tid=1116451}}&lt;/p&gt;

&lt;p&gt;I have added the log from the coe dump.&lt;/p&gt;

&lt;p&gt;This issue is perhaps related to &lt;a href=&quot;https://davecturner.github.io/2021/08/30/seven-year-old-segfault.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://davecturner.github.io/2021/08/30/seven-year-old-segfault.html&lt;/a&gt; ?&lt;/p&gt;</description>
                <environment></environment>
        <key id="13576162">CASSANDRA-19565</key>
            <summary>SIGSEGV on Cassandra v4.1.4</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10002" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Normal</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="brandon.williams">Brandon Williams</assignee>
                                    <reporter username="twdkeule">Thomas De Keulenaer</reporter>
                        <labels>
                    </labels>
                <created>Wed, 17 Apr 2024 07:52:13 +0000</created>
                <updated>Fri, 10 Oct 2025 08:47:48 +0000</updated>
                            <resolved>Mon, 6 May 2024 13:44:37 +0000</resolved>
                                        <fixVersion>4.0.14</fixVersion>
                    <fixVersion>4.1.6</fixVersion>
                    <fixVersion>5.0-rc1</fixVersion>
                    <fixVersion>5.0</fixVersion>
                    <fixVersion>5.1</fixVersion>
                                    <component>Packaging</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="17838026" author="bereng" created="Wed, 17 Apr 2024 08:13:32 +0000"  >&lt;p&gt;Which was your previous version?&lt;/p&gt;</comment>
                            <comment id="17838027" author="twdkeule" created="Wed, 17 Apr 2024 08:18:48 +0000"  >&lt;p&gt;cassandra-4.0.12-1.noarch&lt;br/&gt;
I think 4.0.12 als uses a different version of JNA (5.6.0 vs 5.9.0)&lt;/p&gt;</comment>
                            <comment id="17838030" author="twdkeule" created="Wed, 17 Apr 2024 08:23:03 +0000"  >&lt;p&gt;in JNA 5.10.0 the SIGSEGV replaced with a regular exception:&lt;br/&gt;
&lt;a href=&quot;https://github.com/java-native-access/jna/pull/1378&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/java-native-access/jna/pull/1378&lt;/a&gt;&lt;br/&gt;
that does not fix the issue, but it is handled better&lt;/p&gt;</comment>
                            <comment id="17838033" author="bereng" created="Wed, 17 Apr 2024 08:28:29 +0000"  >&lt;p&gt;^that is exactly what I was trying to get to... Bc C* code for &lt;tt&gt;NativeLibraryLinux&lt;/tt&gt; looks identical 4.0 vs 4.1&lt;/p&gt;</comment>
                            <comment id="17838041" author="bereng" created="Wed, 17 Apr 2024 08:37:00 +0000"  >&lt;p&gt;Do you have a machine you can test a PR on? would you need a proper release or are you good building from a PR? Bc I don&apos;t think it&apos;s going to be an easy one to repro outside your env...&lt;/p&gt;</comment>
                            <comment id="17838052" author="twdkeule" created="Wed, 17 Apr 2024 09:06:05 +0000"  >&lt;p&gt;Setting the cassandra user&apos;s home directory (/var/lib/cassandra) to read+write+executable and owned by cassandra, solves the issue.&lt;br/&gt;
I suspect this is not done by default by the redhat package installation.&lt;/p&gt;</comment>
                            <comment id="17838061" author="bereng" created="Wed, 17 Apr 2024 09:27:36 +0000"  >&lt;p&gt;Oh Icwym. &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=brandon.williams&quot; class=&quot;user-hover&quot; rel=&quot;brandon.williams&quot;&gt;brandon.williams&lt;/a&gt; is familiar with the releases code so pinging him. Also should we upgrade JNA &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=brandon.williams&quot; class=&quot;user-hover&quot; rel=&quot;brandon.williams&quot;&gt;brandon.williams&lt;/a&gt; as in my PR or better leave it alone, wdyt?&lt;/p&gt;</comment>
                            <comment id="17838062" author="bereng" created="Wed, 17 Apr 2024 09:32:09 +0000"  >&lt;p&gt;I wonder what&apos;s the proposed solution here: &lt;a href=&quot;https://access.redhat.com/solutions/6991416&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://access.redhat.com/solutions/6991416&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17838067" author="twdkeule" created="Wed, 17 Apr 2024 09:39:46 +0000"  >&lt;blockquote&gt;&lt;p&gt;I wonder what&apos;s the proposed solution here: &lt;a href=&quot;https://access.redhat.com/solutions/6991416&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://access.redhat.com/solutions/6991416&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;I cannot access that issue.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;Also should we upgrade JNA Brandon Williams as in my PR or better leave it alone, wdyt?&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;FYI: Upgrading JNA wont actually solve the issue, it will only prevent the SIGSEGV + core dump and replace it with a java exception. &lt;/p&gt;</comment>
                            <comment id="17838113" author="twdkeule" created="Wed, 17 Apr 2024 11:13:26 +0000"  >&lt;p&gt;If you do upgrade to JNA 5.10, you should probably set LIBFFI_TMPDIR to the same value as jna.tmpdir:&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;-Djna.tmpdir=/cassandra/tmp -Dio.netty.native.workdir=/cassandra/tmp &lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Like &lt;a href=&quot;https://github.com/elastic/elasticsearch/issues/77014&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/elastic/elasticsearch/issues/77014&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17838114" author="twdkeule" created="Wed, 17 Apr 2024 11:13:47 +0000"  >&lt;p&gt;I see the trunk is already at JNA 5.13: &lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-18050&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/CASSANDRA-18050&lt;/a&gt;&lt;br/&gt;
idem for 5.0&lt;/p&gt;</comment>
                            <comment id="17838116" author="brandon.williams" created="Wed, 17 Apr 2024 11:19:01 +0000"  >&lt;p&gt;The directory is created by useradd &lt;a href=&quot;https://github.com/apache/cassandra/blob/trunk/redhat/cassandra.spec#L140&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;here&lt;/a&gt;, and this is what the directory listing looks like on a fresh install:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;]# ls -al /var/lib/cassandra/
total 0
drwxr-xr-x 6 root      root       68 Apr 17 11:13 .
drwxr-xr-x 1 root      root      131 Apr 17 11:13 ..
drwxr-xr-x 2 cassandra cassandra   6 Jan 23 19:52 commitlog
drwxr-xr-x 2 cassandra cassandra   6 Jan 23 19:52 data
drwxr-xr-x 2 cassandra cassandra   6 Jan 23 19:52 hints
drwxr-xr-x 2 cassandra cassandra   6 Jan 23 19:52 saved_caches
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Maybe you have a modified /etc/login.defs with a different umask or similar?&lt;/p&gt;</comment>
                            <comment id="17838125" author="twdkeule" created="Wed, 17 Apr 2024 11:47:23 +0000"  >&lt;blockquote&gt;&lt;p&gt;drwxr-xr-x 6 root      root       68 Apr 17 11:13 .&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;This should be owned by cassandra:cassandra, not root:root.&lt;br/&gt;
If root owns the HOME dir, the program cannot write to it.&lt;/p&gt;</comment>
                            <comment id="17838127" author="twdkeule" created="Wed, 17 Apr 2024 11:48:31 +0000"  >&lt;blockquote&gt;&lt;p&gt;%attr(750,%{username},%{username}) %config(noreplace) /var/lib/%{username}/*&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;The  &lt;blockquote&gt;&lt;p&gt;/*&lt;/p&gt;&lt;/blockquote&gt; at the end of line 166 is the culprit&lt;/p&gt;</comment>
                            <comment id="17838133" author="brandon.williams" created="Wed, 17 Apr 2024 11:56:24 +0000"  >&lt;p&gt;Hmm, that was added as part of &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-17470&quot; title=&quot;Default directory permissions for /var/lib/cassandra could be more restrictive&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-17470&quot;&gt;&lt;del&gt;CASSANDRA-17470&lt;/del&gt;&lt;/a&gt;.  I suspect the config/noreplace is what is preventing it, and I think that was chosen to not modify any existing installs that may have changed it, but it&apos;s still curious how there&apos;s no effect on new installations.  Let me run some tests and see what&apos;s going on.&lt;/p&gt;</comment>
                            <comment id="17838134" author="brandon.williams" created="Wed, 17 Apr 2024 11:58:50 +0000"  >&lt;blockquote&gt;&lt;p&gt;at the end of line 166 is the culprit&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Ah, that is because we were only changing the subdirs to not be world-writable, we only changed the umask of what was there before.&lt;/p&gt;</comment>
                            <comment id="17838136" author="brandon.williams" created="Wed, 17 Apr 2024 12:02:48 +0000"  >&lt;p&gt;I&apos;m not opposed to changing the home dir owner/perms, but&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;Setting the cassandra user&apos;s home directory (/var/lib/cassandra) to read+write+executable and owned by cassandra, solves the issue.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;do we know why this is?  The owner/perms has been this way a long time, is your TMPDIR set to the home dir?&lt;/p&gt;</comment>
                            <comment id="17838137" author="bereng" created="Wed, 17 Apr 2024 12:04:58 +0000"  >&lt;blockquote&gt;&lt;p&gt;Upgrading JNA wont actually solve the issue, it will only prevent the SIGSEGV + core dump and replace it with a java exception&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Correct. But it&apos;s better than just barfing imo.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;do we know why this is?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;That&apos;s the tricky bit. Getting to the bottom of it but without a repro it may be really really hard. So far I have only seen mapping of C functions. I haven&apos;t found anything suggesting this might be linked to permissions or folders like the ES case. Maybe if some gclib is not reachable or... I&apos;m still pulling the thread.&lt;/p&gt;</comment>
                            <comment id="17838148" author="twdkeule" created="Wed, 17 Apr 2024 12:18:51 +0000"  >&lt;p&gt;The &lt;a href=&quot;https://davecturner.github.io/2021/08/30/seven-year-old-segfault.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;article&lt;/a&gt; gives a very detailed explaination:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;The usual solution seems to be to write the code into a file and then use something like mmap() to load it again into read-only-but-executable pages. In order to do this we need some temporary space that isn&#8217;t mounted noexec.&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;...&amp;#93;&lt;/span&gt;&lt;br/&gt;
That tells us that libffi will sometimes create temporary executable files, and it will always create them when running under SELinux. It&#8217;s important to note that this is completely independent of the fact that JNA creates temporary executable files: libffi is a language-independent library for calling foreign functions so it doesn&#8217;t know anything about Java and therefore doesn&#8217;t have access to the Java system properties java.io.tmpdir and jna.tmpdir which control where JNA does its work. Instead, on Linux libffi tries to create its temporary executable files in various places in the following order of preference:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;$LIBFFI_TMPDIR&lt;/li&gt;
	&lt;li&gt;$TMPDIR&lt;/li&gt;
	&lt;li&gt;/tmp&lt;/li&gt;
	&lt;li&gt;/var/tmp&lt;/li&gt;
	&lt;li&gt;/dev/shm&lt;/li&gt;
	&lt;li&gt;$HOME&lt;/li&gt;
&lt;/ul&gt;
&lt;/blockquote&gt;

&lt;p&gt;But I admit, it is also unclear to me why this is only an issue in Cassandra 4.1.4 and not on 4.0.12.&lt;/p&gt;</comment>
                            <comment id="17838156" author="brandon.williams" created="Wed, 17 Apr 2024 12:25:41 +0000"  >&lt;blockquote&gt;&lt;p&gt;But I admit, it is also unclear to me why this is only an issue in Cassandra 4.1.4 and not on 4.0.12.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I think the difference must be in the jna versions.  I&apos;ve seen noexec on tmp many times, and the solution has always been to redefine java.io.tmpdir to a more forgiving path, but it seems newer jna will try to write other locations too (and then segfault if they don&apos;t work.)&lt;/p&gt;

&lt;p&gt;In any case, if fixing the home dir perms solves this I&apos;m not opposed to that; even though we haven&apos;t needed it in the past it&apos;s the most correct thing to do.&lt;/p&gt;</comment>
                            <comment id="17838178" author="bereng" created="Wed, 17 Apr 2024 13:14:09 +0000"  >&lt;p&gt;^I checked code to some extent and things look the same to me C* wise. I agree jna versions is probably the difference hence why updating seems like a good idea besides the cosmetics of the failure. Having said that jna is always a hairy subject so if we&apos;d prefer to not update it I&apos;d be fine as well with that. I&apos;m on the fence on this one, though I&apos;d personally update it.&lt;/p&gt;</comment>
                            <comment id="17838273" author="brandon.williams" created="Wed, 17 Apr 2024 16:07:20 +0000"  >&lt;p&gt;I think updating something as far reaching as JNA in a minor release is a tough sell, especially if we are only gaining cosmetics which we can obviate the need for by changing the ownership in the packaging.  &lt;/p&gt;</comment>
                            <comment id="17838287" author="edimitrova" created="Wed, 17 Apr 2024 16:43:43 +0000"  >&lt;blockquote&gt;&lt;p&gt;I think updating something as far reaching as JNA in a minor release is a tough sell, especially if we are only gaining cosmetics which we can obviate the need for by changing the ownership in the packaging.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;+1 on what &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=brandon.williams&quot; class=&quot;user-hover&quot; rel=&quot;brandon.williams&quot;&gt;brandon.williams&lt;/a&gt; said. If we can limit the amount of change to only change of ownership with no side effects, I think the risk updating by exception JNA in a patch release is not justified. It would require also @dev discussion&lt;/p&gt;</comment>
                            <comment id="17838298" author="brandon.williams" created="Wed, 17 Apr 2024 17:00:25 +0000"  >&lt;p&gt;If we change the &apos;-M&apos; flag to useradd to &apos;-m&apos; to create the home directory, that leaves us with:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;drwx------ 6 cassandra cassandra 124 Apr 17 16:58 .
drwxr-xr-x 1 root      root      131 Apr 17 16:58 ..
-rw-r--r-- 1 cassandra cassandra  18 Aug  3  2022 .bash_logout
-rw-r--r-- 1 cassandra cassandra 141 Aug  3  2022 .bash_profile
-rw-r--r-- 1 cassandra cassandra 376 Aug  3  2022 .bashrc
drwxr-xr-x 2 cassandra cassandra   6 Apr 17 16:55 commitlog
drwxr-xr-x 2 cassandra cassandra   6 Apr 17 16:55 data
drwxr-xr-x 2 cassandra cassandra   6 Apr 17 16:55 hints
drwxr-xr-x 2 cassandra cassandra   6 Apr 17 16:55 saved_caches
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Even though nothing else &lt;em&gt;should&lt;/em&gt; need to read or list this directory, we had more permissive perms before and perhaps should continue that here.  WDYT?&lt;/p&gt;</comment>
                            <comment id="17838303" author="edimitrova" created="Wed, 17 Apr 2024 17:12:02 +0000"  >&lt;blockquote&gt;&lt;p&gt;&#160;perhaps should continue that here&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;That is what I would expect too&lt;/p&gt;</comment>
                            <comment id="17838391" author="brandon.williams" created="Wed, 17 Apr 2024 22:15:07 +0000"  >&lt;p&gt;I have a patch &lt;a href=&quot;https://github.com/driftx/cassandra/tree/CASSANDRA-19565-4.1&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;here&lt;/a&gt; that will set the ownership as follows:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;drwxr-xr-x 6 cassandra cassandra  68 Apr 17 22:03 .
drwxr-xr-x 1 root      root      131 Apr 17 22:03 ..
drwxr-xr-x 2 cassandra cassandra   6 Apr 17 21:48 commitlog
drwxr-xr-x 2 cassandra cassandra   6 Apr 17 21:48 data
drwxr-xr-x 2 cassandra cassandra   6 Apr 17 21:48 hints
drwxr-xr-x 2 cassandra cassandra   6 Apr 17 21:48 saved_caches
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Debian packaging already creates /var/lib/cassandra with the correct ownership.  Now I just need to figure out CI for packaging on 4.1.&lt;/p&gt;</comment>
                            <comment id="17838476" author="bereng" created="Thu, 18 Apr 2024 05:51:42 +0000"  >&lt;p&gt;Yep that&apos;s the problem with jna... So we&apos;re not updating it agreed.&lt;/p&gt;

&lt;p&gt;Patch lgtm although we don&apos;t have a repro env. I think we can fire CI for packaging even if it&apos;s only 5.0+?&lt;/p&gt;

&lt;p&gt;It&apos;s a pity we don&apos;t have a repro, we could upgrade jna on a 4.0 PR and see if it fails then, confirming the jna upgrade is the bit causing the problem&lt;/p&gt;</comment>
                            <comment id="17838494" author="twdkeule" created="Thu, 18 Apr 2024 07:08:49 +0000"  >&lt;blockquote&gt;&lt;p&gt;It&apos;s a pity we don&apos;t have a repro, we could upgrade jna on a 4.0 PR and see if it fails then, confirming the jna upgrade is the bit causing the problem&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;You probably also need to lock the machine down with SE Linux to force libffi to create executable files.&lt;br/&gt;
&lt;a href=&quot;https://github.com/elastic/elasticsearch/issues/77014&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;ElasticSearch&lt;/a&gt;  also had this issue.&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Do we have an idea of the specific controls that need to be enabled to reproduce?&lt;br/&gt;
We know at least some of them I think:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;SELinux enabled &amp;amp; configured to prevent mmap() from creating anonymous executable &amp;amp; writeable mappings&lt;/li&gt;
	&lt;li&gt;/tmp, /var/tmp, /dev/shm all nonexistent or mounted noexec&lt;/li&gt;
	&lt;li&gt;$HOME nonexistent for the elasticsearch user&lt;/li&gt;
	&lt;li&gt;All mount points in /etc/mtab not writable by elasticsearch, or mounted noexec&lt;/li&gt;
	&lt;li&gt;$ES_TMPDIR (and hence java.io.tmpdir and/or jna.tmpdir) pointing somewhere writeable and not mounted noexec.&lt;/li&gt;
	&lt;li&gt;$TMPDIR unset&lt;/li&gt;
&lt;/ul&gt;
&lt;/blockquote&gt;

&lt;p&gt;Also, on Cassandra 5.x with JNA &amp;gt;= 5.10.0 you can specify LIBFFI_TMPDIR.&lt;br/&gt;
I think it is best to set this to the same value as jna.tmpdir. Perhaps in cassandra-env.sh?&lt;/p&gt;</comment>
                            <comment id="17838506" author="bereng" created="Thu, 18 Apr 2024 07:37:25 +0000"  >&lt;p&gt;It is not a bad idea at all to add that var 5.0+&lt;/p&gt;</comment>
                            <comment id="17838617" author="brandon.williams" created="Thu, 18 Apr 2024 11:33:43 +0000"  >&lt;blockquote&gt;&lt;p&gt;Also, on Cassandra 5.x with JNA &amp;gt;= 5.10.0 you can specify LIBFFI_TMPDIR.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Can you open a new ticket for this?&lt;/p&gt;</comment>
                            <comment id="17838977" author="brandon.williams" created="Fri, 19 Apr 2024 12:21:19 +0000"  >&lt;blockquote&gt;&lt;p&gt;Now I just need to figure out CI for packaging on 4.1.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;This turned out to be problematic, but I merged into 5.0 &lt;a href=&quot;https://github.com/driftx/cassandra/tree/CASSANDRA-19565-5.0&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;here&lt;/a&gt; and ran the packaging build in private CI, then attached the logs from the package building here.  The package changes will be the same in all branches so this should be equivalent.&lt;/p&gt;</comment>
                            <comment id="17839262" author="brandon.williams" created="Sat, 20 Apr 2024 17:06:00 +0000"  >&lt;p&gt;&lt;a href=&quot;https://ci-cassandra.apache.org/view/patches/job/Cassandra-devbranch-before-5/2677/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;Here&lt;/a&gt; is CI for 4.1&lt;/p&gt;</comment>
                            <comment id="17841872" author="bereng" created="Mon, 29 Apr 2024 07:22:29 +0000"  >&lt;p&gt;Good that dev-branch is back online. So iiuc packaging is all good. CI failures are known offenders. We&apos;re only missing CI and a branch for trunk. But it should be the same as 5.0 so +1 LGTM&lt;/p&gt;</comment>
                            <comment id="17842667" author="brandon.williams" created="Wed, 1 May 2024 14:22:52 +0000"  >&lt;p&gt;As I went to commit this, it occurred to me we should go ahead and take this opportunity to achieve parity with the Debian package from 4.0 onward, and not create the commitlog, data, etc dirs that tie the packaging to the application, since we now have correct ownership/perms on the home directory.  I have done this &lt;a href=&quot;https://github.com/driftx/cassandra/commit/2f86759d4a3a88e321d0f4232bd132bb9424d699&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;here&lt;/a&gt; but now packaging CI for 4.x is broken so I&apos;ll have to sort that first.&lt;/p&gt;</comment>
                            <comment id="17843225" author="brandon.williams" created="Fri, 3 May 2024 14:23:58 +0000"  >&lt;p&gt;Ok, I fixed packaging in &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-19606&quot; title=&quot;Fix building debian packages&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-19606&quot;&gt;&lt;del&gt;CASSANDRA-19606&lt;/del&gt;&lt;/a&gt; and I&apos;ve started CI runs here:&lt;/p&gt;

&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;Branch&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;CI&lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/driftx/cassandra/tree/CASSANDRA-19565-4.0&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;4.0&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://ci-cassandra.apache.org/view/patches/job/Cassandra-devbranch-before-5-artifacts/11/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;jenkins&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/driftx/cassandra/tree/CASSANDRA-19565-4.1&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;4.1&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://ci-cassandra.apache.org/job/Cassandra-devbranch-before-5-artifacts/12/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;jenkins&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/driftx/cassandra/tree/CASSANDRA-19565-5.0&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;5.0&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://ci-cassandra.apache.org/view/patches/job/Cassandra-devbranch-5/26/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;jenkins&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/driftx/cassandra/tree/CASSANDRA-19565-trunk&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;trunk&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://ci-cassandra.apache.org/view/patches/job/Cassandra-devbranch-5/27/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;jenkins&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;


&lt;p&gt;I&apos;ll check back when those complete.&lt;/p&gt;</comment>
                            <comment id="17843565" author="brandon.williams" created="Sun, 5 May 2024 11:52:27 +0000"  >&lt;p&gt;CI completed successfully, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=bereng&quot; class=&quot;user-hover&quot; rel=&quot;bereng&quot;&gt;bereng&lt;/a&gt; can you find time to take one last look?&lt;/p&gt;</comment>
                            <comment id="17843647" author="bereng" created="Mon, 6 May 2024 06:27:38 +0000"  >&lt;p&gt;Nice one and everything on devbranch &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; +1&lt;/p&gt;</comment>
                            <comment id="17843751" author="brandon.williams" created="Mon, 6 May 2024 13:44:37 +0000"  >&lt;p&gt;Committed, thanks for the review!&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="13576365">CASSANDRA-19570</issuekey>
        </issuelink>
                            </outwardlinks>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="13502719">CASSANDRA-18050</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="13068318" name="cassandra_57_debian_jdk11_amd64_attempt1.log.xz" size="3204" author="brandon.williams" created="Fri, 19 Apr 2024 12:20:23 +0000"/>
                            <attachment id="13068317" name="cassandra_57_redhat_jdk11_amd64_attempt1.log.xz" size="4984" author="brandon.williams" created="Fri, 19 Apr 2024 12:20:23 +0000"/>
                            <attachment id="13068245" name="hs_err_pid1116450.log" size="585330" author="twdkeule" created="Wed, 17 Apr 2024 07:14:28 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[brandon.williams]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12313825" key="com.atlassian.jira.plugin.system.customfieldtypes:cascadingselect">
                        <customfieldname>Bug Category</customfieldname>
                        <customfieldvalues>
                                                    <customfieldvalue key="12982" cascade-level=""><![CDATA[Correctness]]></customfieldvalue>
            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12313821" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Complexity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12965"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313822" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Discovered By</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12969"><![CDATA[User Report]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12313922" key="jira.plugin.projectspecificselectfield.jpssf:multicftype">
                        <customfieldname>Impacts</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="13100"><![CDATA[None]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            1 year, 27 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12313921" key="jira.plugin.projectspecificselectfield.jpssf:multicftype">
                        <customfieldname>Platform</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="13076"><![CDATA[All]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z1oowg:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[bereng]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12962"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12311420" key="com.atlassian.jira.plugin.system.customfieldtypes:version">
                        <customfieldname>Since Version</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="12348835">NA</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313924" key="com.atlassian.jira.plugin.system.customfieldtypes:textfield">
                        <customfieldname>Source Control Link</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>&lt;p&gt;&lt;a href=&quot;https://github.com/apache/cassandra/commit/f12f928dee2291d0ca98a20c788d545e6ffb623b&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/cassandra/commit/f12f928dee2291d0ca98a20c788d545e6ffb623b&lt;/a&gt;&lt;/p&gt;</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313823" key="com.atlassian.jira.plugin.system.customfieldtypes:textarea">
                        <customfieldname>Test and Documentation Plan</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>&lt;p&gt;run packaging CI&lt;/p&gt;</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>