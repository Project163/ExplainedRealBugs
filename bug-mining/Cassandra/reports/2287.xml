<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 22:39:38 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-5826] Fix trigger directory detection code</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-5826</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;At least when building from source, Cassandra determines the trigger directory wrong. C* calculates the trigger directory as &apos;build/triggers&apos; instead of &apos;triggers&apos;.&lt;/p&gt;

&lt;p&gt;FBUtilities.cassandraHomeDir() is to blame, and should be replaced with something more robust.&lt;/p&gt;</description>
                <environment>&lt;p&gt;OS X&lt;/p&gt;</environment>
        <key id="12660523">CASSANDRA-5826</key>
            <summary>Fix trigger directory detection code</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10002" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Normal</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="vijay2win@yahoo.com">Vijay</assignee>
                                    <reporter username="aleksey">Aleksey Yeschenko</reporter>
                        <labels>
                            <label>triggers</label>
                    </labels>
                <created>Mon, 29 Jul 2013 23:33:45 +0000</created>
                <updated>Tue, 16 Apr 2019 09:32:08 +0000</updated>
                            <resolved>Tue, 6 Aug 2013 02:55:46 +0000</resolved>
                                        <fixVersion>2.0 rc1</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="13724240" author="vijay2win@yahoo.com" created="Tue, 30 Jul 2013 18:41:00 +0000"  >&lt;p&gt;Probably have to change the build.xml to copy the trigger directory to build like what we do with conf directory?&lt;br/&gt;
I will add the above and also add it to Debian package may be (in addition adding a property to override the trigger absolute path).&lt;/p&gt;</comment>
                            <comment id="13725600" author="vijay2win@yahoo.com" created="Wed, 31 Jul 2013 19:04:42 +0000"  >&lt;p&gt;Attached a small patch moves the trigger directory into conf directory, hope it is fine. that way we can just search for the triggers directory in the class path (which is Conf). Thanks!&lt;/p&gt;</comment>
                            <comment id="13727878" author="jbellis" created="Fri, 2 Aug 2013 17:53:06 +0000"  >&lt;p&gt;What is the Right Thing to do here?&lt;/p&gt;

&lt;p&gt;I kind of like the original idea of locating lib/ and making triggers/ be a sibling of that by convention.&lt;/p&gt;

&lt;p&gt;&quot;Any directory named triggers on the classpath&quot; makes me nervous.&lt;/p&gt;

&lt;p&gt;What would a Real Java Programmer do here &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=zznate&quot; class=&quot;user-hover&quot; rel=&quot;zznate&quot;&gt;zznate&lt;/a&gt;?&lt;/p&gt;</comment>
                            <comment id="13727929" author="zznate" created="Fri, 2 Aug 2013 18:30:07 +0000"  >&lt;blockquote&gt;&lt;p&gt;What would a Real Java Programmer do here Nate McCall?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Awww shucks. Capitalized and everything!&lt;/p&gt;

&lt;p&gt;I would expect that it is on me to put my own dependencies in the existing &quot;lib&quot; directory. As a principle of least surprise: web containers, such as Tomcat, have a top level lib directory where you can put shared dependencies (&lt;a href=&quot;http://tomcat.apache.org/tomcat-7.0-doc/appdev/deployment.html#Shared_Library_Files&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://tomcat.apache.org/tomcat-7.0-doc/appdev/deployment.html#Shared_Library_Files&lt;/a&gt;). &lt;/p&gt;

&lt;p&gt;This has the benefit of not requiring modification of cassandra.in.sh or similar init scripts already in the wild. &lt;/p&gt;

&lt;p&gt;As long as we are not trying to isolate classloaders or anything (not a bad idea for triggers in the future) there is no need technically or conventionally to have user binaries somewhere else. If folks want something different, they can hack the scripts to noodle the classpath to their hearts content. &lt;/p&gt;</comment>
                            <comment id="13727960" author="vijay2win@yahoo.com" created="Fri, 2 Aug 2013 18:57:57 +0000"  >&lt;blockquote&gt;
&lt;p&gt;As long as we are not trying to isolate classloaders or anything &lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Actually we do it with triggers, similar to what solr does for Tokenizer code etc (but not the same). &lt;/p&gt;

&lt;p&gt;For the record: You can place all of your dependencies in the trigger directory except everything which Cassandra depends on.&lt;br/&gt;
If the user uses maven for building, all he needs to do is, and place the jars in the trigger directory.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;    &amp;lt;dependency&amp;gt;
      &amp;lt;groupId&amp;gt;org.apache.cassandra&amp;lt;/groupId&amp;gt;
      &amp;lt;artifactId&amp;gt;cassandra-all&amp;lt;/artifactId&amp;gt;
      &amp;lt;version&amp;gt;2.0.0-beta2&amp;lt;/version&amp;gt;
      &amp;lt;scope&amp;gt;provided&amp;lt;/scope&amp;gt;
    &amp;lt;/dependency&amp;gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;My understanding is that, Java doesn&apos;t do nested class path scanning on sub directories, hence conf file was ok to do. &lt;br/&gt;
But understand it is kind of scary if someone places in conf instead.&lt;/p&gt;</comment>
                            <comment id="13728034" author="zznate" created="Fri, 2 Aug 2013 20:13:29 +0000"  >&lt;p&gt;Ok, if the classloader is already isolated, a separate top-level &quot;triggers&quot; dir(s) would be fine. &lt;/p&gt;

&lt;p&gt;As a point of reference, and it&apos;s significantly more sophisticated than our current needs here, but Vert.x has a nice scanning and loading system for this.&lt;br/&gt;
Details:&lt;br/&gt;
&lt;a href=&quot;http://vertx.io/mods_manual.html#module-classpath&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://vertx.io/mods_manual.html#module-classpath&lt;/a&gt;&lt;br/&gt;
Impl:&lt;br/&gt;
&lt;a href=&quot;https://github.com/eclipse/vert.x/blob/master/vertx-platform/src/main/java/org/vertx/java/platform/impl/ModuleClassLoader.java&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/eclipse/vert.x/blob/master/vertx-platform/src/main/java/org/vertx/java/platform/impl/ModuleClassLoader.java&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This approach has the benefit of being able load directly from dirs and bintray or maven repos (local, remote or central). This flexibility is way outside scope here, but just food for thought. &lt;/p&gt;

</comment>
                            <comment id="13728393" author="jbellis" created="Sat, 3 Aug 2013 02:04:37 +0000"  >&lt;p&gt;What the hell, we&apos;re already labeling this Experimental.&lt;/p&gt;

&lt;p&gt;Ship it!&lt;/p&gt;</comment>
                            <comment id="13728615" author="vijay2win@yahoo.com" created="Sat, 3 Aug 2013 18:32:37 +0000"  >&lt;p&gt;Committed to trunk, Thanks!&lt;/p&gt;

&lt;p&gt;Nate: All we wanted to do was to separate/sandbox the ITriggers from already loaded Cassandra&apos;s classes, &lt;a href=&quot;https://github.com/apache/cassandra/blob/trunk/src/java/org/apache/cassandra/triggers/CustomClassLoader.java&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/cassandra/blob/trunk/src/java/org/apache/cassandra/triggers/CustomClassLoader.java&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="13729769" author="brandon.williams" created="Mon, 5 Aug 2013 18:33:46 +0000"  >&lt;p&gt;Reopening because first of all the directory detection code doesn&apos;t work when the directory does not exist:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;ERROR 18:32:00,800 Exception in thread Thread[NonPeriodicTasks:1,5,main]
java.lang.ExceptionInInitializerError
        at org.apache.cassandra.service.StorageProxy.mutateWithTriggers(StorageProxy.java:535)
        at org.apache.cassandra.cql3.statements.ModificationStatement.executeWithoutCondition(ModificationStatement.java:358)
        at org.apache.cassandra.cql3.statements.ModificationStatement.execute(ModificationStatement.java:342)
        at org.apache.cassandra.cql3.QueryProcessor.processStatement(QueryProcessor.java:101)
        at org.apache.cassandra.cql3.QueryProcessor.process(QueryProcessor.java:117)
        at org.apache.cassandra.cql3.QueryProcessor.process(QueryProcessor.java:130)
        at org.apache.cassandra.auth.Auth.setupDefaultSuperuser(Auth.java:209)
        at org.apache.cassandra.auth.Auth.access$000(Auth.java:44)
        at org.apache.cassandra.auth.Auth$1.run(Auth.java:144)
        at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:471)
        at java.util.concurrent.FutureTask$Sync.innerRun(FutureTask.java:334)
        at java.util.concurrent.FutureTask.run(FutureTask.java:166)
        at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.access$201(ScheduledThreadPoolExecutor.java:178)
        at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:292)
        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1145)
        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:615)
        at java.lang.Thread.run(Thread.java:722)
Caused by: java.lang.NullPointerException
        at org.apache.cassandra.utils.FBUtilities.cassandraTriggerDir(FBUtilities.java:351)
        at org.apache.cassandra.triggers.TriggerExecutor.&amp;lt;init&amp;gt;(TriggerExecutor.java:45)
        at org.apache.cassandra.triggers.TriggerExecutor.&amp;lt;clinit&amp;gt;(TriggerExecutor.java:41)
        ... 17 more
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;And secondly, I don&apos;t think we should throw if the directory doesn&apos;t exist, instead just move along without triggers (perhaps log a warning)&lt;/p&gt;</comment>
                            <comment id="13729782" author="vijay2win@yahoo.com" created="Mon, 5 Aug 2013 18:42:59 +0000"  >&lt;p&gt;Hi Brandon, Oooops... Isn&apos;t the directory found in conf? i can remove the RTE and make it log, if not found.&lt;/p&gt;</comment>
                            <comment id="13729791" author="brandon.williams" created="Mon, 5 Aug 2013 18:46:35 +0000"  >&lt;p&gt;The config is unmodified, but the conf/triggers dir itself is missing.&lt;/p&gt;</comment>
                            <comment id="13729889" author="vijay2win@yahoo.com" created="Mon, 5 Aug 2013 20:18:53 +0000"  >&lt;p&gt;Hi Brandon, Attached, handles un reachable trigger directory.&lt;/p&gt;</comment>
                            <comment id="13729900" author="brandon.williams" created="Mon, 5 Aug 2013 20:35:57 +0000"  >&lt;p&gt;This actually doesn&apos;t help since the NPE is occurring slightly sooner:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Caused by: java.lang.NullPointerException
        at org.apache.cassandra.utils.FBUtilities.cassandraTriggerDir(FBUtilities.java:350)
        at org.apache.cassandra.triggers.TriggerExecutor.reloadClasses(TriggerExecutor.java:58)
        at org.apache.cassandra.triggers.TriggerExecutor.&amp;lt;init&amp;gt;(TriggerExecutor.java:49)
        at org.apache.cassandra.triggers.TriggerExecutor.&amp;lt;clinit&amp;gt;(TriggerExecutor.java:41)
        ... 17 more
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="13729907" author="vijay2win@yahoo.com" created="Mon, 5 Aug 2013 20:42:05 +0000"  >&lt;p&gt;Hi Brandon did the patch apply clean? &lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;        File tiggerDirectory = FBUtilities.cassandraTriggerDir();
        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (tiggerDirectory == &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;)
            &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt;;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;should save a NPE, i did test it and worked fine for me.&lt;/p&gt;</comment>
                            <comment id="13729990" author="brandon.williams" created="Mon, 5 Aug 2013 21:39:42 +0000"  >&lt;p&gt;The NPE is on 350 (with the patch applied) in FBU, which is this:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;            triggerDir = new File(FBUtilities.class.getClassLoader().getResource(DEFAULT_TRIGGER_DIR).getFile());
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="13730143" author="vijay2win@yahoo.com" created="Mon, 5 Aug 2013 23:39:15 +0000"  >&lt;p&gt;Hi Brandon, fixed in v2 &lt;/p&gt;</comment>
                            <comment id="13730258" author="brandon.williams" created="Tue, 6 Aug 2013 01:51:28 +0000"  >&lt;p&gt;+1, minor nit: s/Directory doesnt/directory doesn&apos;t/ in the warning.&lt;/p&gt;</comment>
                            <comment id="13730288" author="vijay2win@yahoo.com" created="Tue, 6 Aug 2013 02:55:46 +0000"  >&lt;p&gt;Committed, with nit Thanks!&lt;/p&gt;</comment>
                            <comment id="13730304" author="jbellis" created="Tue, 6 Aug 2013 03:11:03 +0000"  >&lt;p&gt;It looks like you only committed to trunk.  You should cherry-pick to 2.0.0, then merge to 2.0 and then to trunk again.&lt;/p&gt;</comment>
                            <comment id="13730309" author="vijay2win@yahoo.com" created="Tue, 6 Aug 2013 03:20:44 +0000"  >&lt;p&gt;Done, sorry for all the mess on a simple patch.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12595243" name="0001-5826.patch" size="4312" author="vijay2win@yahoo.com" created="Wed, 31 Jul 2013 19:04:42 +0000"/>
                            <attachment id="12596240" name="0001-handle-trigger-non-existance-v2.patch" size="3265" author="vijay2win@yahoo.com" created="Mon, 5 Aug 2013 23:39:15 +0000"/>
                            <attachment id="12596207" name="0001-handle-trigger-non-existance.patch" size="2844" author="vijay2win@yahoo.com" created="Mon, 5 Aug 2013 20:18:53 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[vijay2win@yahoo.com]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>340714</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            12 years, 16 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1mrhr:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>341032</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>jbellis</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[jbellis]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12962"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>