<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 22:46:22 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-7535] Coverage analysis for range queries</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-7535</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;This is a regression related to &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-4858&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;CASSANDRA-4858&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Range queries are taking orders of magnitude more time to complete than before because the query planner is frequently unable to calculate the correct intersection of contiguous ranges for a given node.&lt;/p&gt;

&lt;p&gt;For example, SELECT * FROM TBL should result in exactly one scan at CL.ONE when RF = #nodes when in fact it can result in several hundred scans (sometimes thousands). The problem is exasperated with vnodes.&lt;/p&gt;

&lt;p&gt;The regression occurred at some point between 2.0.4 (which works fine) and 2.0.9.   &lt;/p&gt;</description>
                <environment></environment>
        <key id="12726788">CASSANDRA-7535</key>
            <summary>Coverage analysis for range queries</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10002" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Normal</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="thobbs">Tom Hobbs</assignee>
                                    <reporter username="hymanroth">David Semeria</reporter>
                        <labels>
                    </labels>
                <created>Fri, 11 Jul 2014 11:45:54 +0000</created>
                <updated>Tue, 16 Apr 2019 09:31:40 +0000</updated>
                            <resolved>Sat, 12 Jul 2014 04:51:39 +0000</resolved>
                                        <fixVersion>2.0.10</fixVersion>
                    <fixVersion>2.1 rc4</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="14058954" author="jbellis" created="Fri, 11 Jul 2014 16:24:44 +0000"  >&lt;p&gt;Is this the same as &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-6976&quot; title=&quot;Determining replicas to query is very slow with large numbers of nodes or vnodes&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-6976&quot;&gt;&lt;del&gt;CASSANDRA-6976&lt;/del&gt;&lt;/a&gt;?&lt;/p&gt;</comment>
                            <comment id="14058976" author="hymanroth" created="Fri, 11 Jul 2014 16:42:35 +0000"  >&lt;p&gt;I think not. &lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-6906&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;CASSANDRA-6906&lt;/a&gt; refers to skipping the &quot;Determining replicas to query&quot; step in range slice queries, whereas &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-4858&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;CASSANDRA-4858&lt;/a&gt; refers specifically to the problem of correctly calculating contiguous ranges.&lt;/p&gt;

&lt;p&gt;In a nutshell, we&apos;re doing hundreds of separate single range scans when a single scan over a broader range would suffice.&lt;/p&gt;</comment>
                            <comment id="14059004" author="brandon.williams" created="Fri, 11 Jul 2014 17:02:12 +0000"  >&lt;p&gt;Can you provide a simple way to reproduce?  Does it absolutely require vnodes?  I tried rf=3/n=3 with single token nodes on 2.0.4 and 2.0 head and saw no differences with tracing on.&lt;/p&gt;</comment>
                            <comment id="14059031" author="hymanroth" created="Fri, 11 Jul 2014 17:18:40 +0000"  >&lt;p&gt;Brandon, 2.0.4 works as expected, try it with 2.0.9.&lt;/p&gt;

&lt;p&gt;We have two DCs, one running 2.0.4 and the other running 2.0.9. Range scans are coming back in around 10ms in DC1 (RF=3/n=3) and were taking anywhere between 200 and 1000ms in DC2 (RF= 5,n=5). When I put the 2.0.4 cassandra jar in DC2 the latencies disappeared. &lt;/p&gt;</comment>
                            <comment id="14059059" author="hymanroth" created="Fri, 11 Jul 2014 17:36:27 +0000"  >&lt;p&gt;Sorry Brandon, I misinterpreted your reply. What I meant to say was to check 2.0.9 which I believe is the current stable version. I don&apos;t know if vnodes are the culprit because I don&apos;t have a simple way of checking. I&apos;m guessing that a vnode range is the same as a normal range, except there are more of them.&lt;/p&gt;

&lt;p&gt;Just to emphasize the point, running a range query from DC1 with CL.ALL was 10x quicker than running the same query with CL.LOCAL_ONE in DC2. It&apos;s clearly an issue with the query planner in 2.0.9&lt;/p&gt;</comment>
                            <comment id="14059243" author="brandon.williams" created="Fri, 11 Jul 2014 19:30:36 +0000"  >&lt;p&gt;By &quot;2.0 head&quot; I meant the latest 2.0 in the git repo, which is newer than 2.0.9, so I&apos;m still not sure how to reproduce since that worked the same as 2.0.4&lt;/p&gt;</comment>
                            <comment id="14059349" author="hymanroth" created="Fri, 11 Jul 2014 21:00:37 +0000"  >&lt;p&gt;I can only suggest you try vnodes. We have 5 clusters running 2.0.9 and all exhibit the same behavior. Tomorrow I will try to reproduce using single tokens.&lt;/p&gt;</comment>
                            <comment id="14059353" author="benedict" created="Fri, 11 Jul 2014 21:03:07 +0000"  >&lt;p&gt;If the problem is vnodes, it is quite likely it is related to &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-6976&quot; title=&quot;Determining replicas to query is very slow with large numbers of nodes or vnodes&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-6976&quot;&gt;&lt;del&gt;CASSANDRA-6976&lt;/del&gt;&lt;/a&gt;. Although there is no doubt a possible expansion of scope to the actual despatch of those range queries as well as the calculation of where they should go&lt;/p&gt;</comment>
                            <comment id="14059380" author="hymanroth" created="Fri, 11 Jul 2014 21:22:27 +0000"  >&lt;p&gt;See &lt;a href=&quot;https://gist.github.com/hymanroth/cd9124b458870925afa2&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;here&lt;/a&gt; for two example tracings, both produced with 2.0.9 running vnodes. In the first tracing there are around around 100 scans and in the second there are several thousand. Querying the same node from another node running 2.0.4 consistently involved a single scan.&lt;/p&gt;

&lt;p&gt;I don&apos;t know if it&apos;s the same issue as &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-6976&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;CASSANDRA-6976&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14059399" author="thobbs" created="Fri, 11 Jul 2014 21:41:41 +0000"  >&lt;p&gt;I&apos;m able to reproduce the issue pretty consistently, and it starts with 2.0.5.&lt;/p&gt;</comment>
                            <comment id="14059423" author="hymanroth" created="Fri, 11 Jul 2014 22:04:06 +0000"  >&lt;p&gt;I forgot to mention that the issue starts to occur around 5 minutes after booting. This is why I think the dynamic snitch might be playing a role, see the comments for &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-4858&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;CASSANDRA-4858&lt;/a&gt;. When the issue occurs, the scans randomly vary between hundreds and thousands for each query, but never one.&lt;/p&gt;</comment>
                            <comment id="14059460" author="thobbs" created="Fri, 11 Jul 2014 22:50:42 +0000"  >&lt;p&gt;It&apos;s not yet clear to me why this is the case, but &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-6465&quot; title=&quot;DES scores fluctuate too much for cache pinning&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-6465&quot;&gt;&lt;del&gt;CASSANDRA-6465&lt;/del&gt;&lt;/a&gt; is the cause.&lt;/p&gt;</comment>
                            <comment id="14059506" author="thobbs" created="Fri, 11 Jul 2014 23:40:41 +0000"  >&lt;p&gt;Post-6465, it was much more likely for all scores to be 0.  In this case, &lt;tt&gt;maxMerged &amp;lt; maxL1 + maxL2&lt;/tt&gt; is false, so the ranges were not merged.  The 7535.txt patch makes that a &lt;tt&gt;&amp;lt;=&lt;/tt&gt; check to handle the all-zeroes case.&lt;/p&gt;

&lt;p&gt;Besides that, it seems like we should give some additional preference to merging ranges, given the overhead of each range request.  This is especially true for vnodes.  So, I&apos;ve also added a &lt;tt&gt;RANGE_MERGING_PREFERENCE&lt;/tt&gt; of 1.5, meaning the merged score must be that much worse than the separate scores for the ranges to remain split.  I don&apos;t believe there&apos;s a lot of value in making this configurable, so I&apos;ve left it hard-coded for now.&lt;/p&gt;

&lt;p&gt;There&apos;s also a &lt;a href=&quot;https://github.com/thobbs/cassandra/tree/CASSANDRA-7535&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;branch&lt;/a&gt; with the changes.&lt;/p&gt;</comment>
                            <comment id="14059527" author="hymanroth" created="Sat, 12 Jul 2014 00:04:56 +0000"  >&lt;p&gt;The all scores zero might explain each node&apos;s log containing a line&lt;/p&gt;

&lt;p&gt;&lt;tt&gt;WARN 23:58:59,178 Couldn&apos;t determine workload for &lt;b&gt;IP REDACTED&lt;/b&gt; from value NULL&lt;/tt&gt;&lt;/p&gt;

&lt;p&gt;for every node except itself at boot.&lt;/p&gt;

</comment>
                            <comment id="14059645" author="jbellis" created="Sat, 12 Jul 2014 04:51:39 +0000"  >&lt;p&gt;LGTM, committed&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12655339" name="7535.txt" size="1391" author="thobbs" created="Fri, 11 Jul 2014 23:40:41 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[thobbs]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>404895</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            11 years, 19 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1xol3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>404933</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12311421" key="com.atlassian.jira.plugin.system.customfieldtypes:multiversion">
                        <customfieldname>Reproduced In</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="12326830">2.0.9</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>jbellis</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[jbellis]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12962"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12311420" key="com.atlassian.jira.plugin.system.customfieldtypes:version">
                        <customfieldname>Since Version</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="12325761">2.0.5</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>