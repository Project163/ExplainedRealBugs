<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 22:43:15 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-5201] Cassandra/Hadoop does not support current Hadoop releases</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-5201</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;Using Hadoop 0.22.0 with Cassandra results in the stack trace below.&lt;br/&gt;
It appears that version 0.21+ changed org.apache.hadoop.mapreduce.JobContext&lt;br/&gt;
from a class to an interface.&lt;/p&gt;


&lt;p&gt;Exception in thread &quot;main&quot; java.lang.IncompatibleClassChangeError: Found interface org.apache.hadoop.mapreduce.JobContext, but class was expected&lt;br/&gt;
	at org.apache.cassandra.hadoop.ColumnFamilyInputFormat.getSplits(ColumnFamilyInputFormat.java:103)&lt;br/&gt;
	at org.apache.hadoop.mapreduce.JobSubmitter.writeNewSplits(JobSubmitter.java:445)&lt;br/&gt;
	at org.apache.hadoop.mapreduce.JobSubmitter.writeSplits(JobSubmitter.java:462)&lt;br/&gt;
	at org.apache.hadoop.mapreduce.JobSubmitter.submitJobInternal(JobSubmitter.java:357)&lt;br/&gt;
	at org.apache.hadoop.mapreduce.Job$2.run(Job.java:1045)&lt;br/&gt;
	at org.apache.hadoop.mapreduce.Job$2.run(Job.java:1042)&lt;br/&gt;
	at java.security.AccessController.doPrivileged(Native Method)&lt;br/&gt;
	at javax.security.auth.Subject.doAs(Subject.java:415)&lt;br/&gt;
	at org.apache.hadoop.security.UserGroupInformation.doAs(UserGroupInformation.java:1153)&lt;br/&gt;
	at org.apache.hadoop.mapreduce.Job.submit(Job.java:1042)&lt;br/&gt;
	at org.apache.hadoop.mapreduce.Job.waitForCompletion(Job.java:1062)&lt;br/&gt;
	at MyHadoopApp.run(MyHadoopApp.java:163)&lt;br/&gt;
	at org.apache.hadoop.util.ToolRunner.run(ToolRunner.java:69)&lt;br/&gt;
	at MyHadoopApp.main(MyHadoopApp.java:82)&lt;br/&gt;
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)&lt;br/&gt;
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:57)&lt;br/&gt;
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)&lt;br/&gt;
	at java.lang.reflect.Method.invoke(Method.java:601)&lt;br/&gt;
	at org.apache.hadoop.util.RunJar.main(RunJar.java:192)&lt;/p&gt;</description>
                <environment></environment>
        <key id="12629942">CASSANDRA-5201</key>
            <summary>Cassandra/Hadoop does not support current Hadoop releases</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10002" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Normal</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="bcoverston">Benjamin Coverston</assignee>
                                    <reporter username="jeltema">Brian Jeltema</reporter>
                        <labels>
                    </labels>
                <created>Wed, 30 Jan 2013 17:11:09 +0000</created>
                <updated>Fri, 4 Oct 2019 16:20:09 +0000</updated>
                            <resolved>Wed, 5 Mar 2014 19:00:44 +0000</resolved>
                                        <fixVersion>2.0.6</fixVersion>
                    <fixVersion>2.1 beta2</fixVersion>
                                        <due></due>
                            <votes>10</votes>
                                    <watches>24</watches>
                                                                                                                <comments>
                            <comment id="13566669" author="jeromatron" created="Wed, 30 Jan 2013 17:29:56 +0000"  >&lt;p&gt;The current stable hadoop version is still the 1.0.x line according to &lt;a href=&quot;http://hadoop.apache.org/releases.html#Download&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://hadoop.apache.org/releases.html#Download&lt;/a&gt; As long as the 1.0.x support isn&apos;t adversely affected, I would think a patch to provide support for all hadoop versions would be welcome.&lt;/p&gt;</comment>
                            <comment id="13567176" author="brandon.williams" created="Thu, 31 Jan 2013 00:47:56 +0000"  >&lt;p&gt;I think the last time I looked into this I couldn&apos;t find a way to support both versions, so we&apos;re either stuck with 0.21+ being broken, or breaking it for everyone that&apos;s on a lower version already.&lt;/p&gt;</comment>
                            <comment id="13569628" author="genx7up" created="Sat, 2 Feb 2013 19:42:26 +0000"  >&lt;p&gt;Do you have a patch?&lt;/p&gt;</comment>
                            <comment id="13592956" author="dbrosius" created="Tue, 5 Mar 2013 02:11:31 +0000"  >&lt;p&gt;what if the hadoop directory was split out into two separate sub-projects which produced two separate jars, thus a jar for old hadoop support and one for new hadoop. then folks could choose which jar to add to the cassandra classpath?&lt;/p&gt;</comment>
                            <comment id="13593034" author="brandon.williams" created="Tue, 5 Mar 2013 03:43:42 +0000"  >&lt;p&gt;That&apos;s not a bad idea, but I&apos;m not sure how it&apos;d work entirely, care to formulate a patch? &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="13593127" author="dbrosius" created="Tue, 5 Mar 2013 06:40:45 +0000"  >&lt;p&gt;Actually, i only see 0.20.&lt;b&gt;, 1.0.&lt;/b&gt; (both of which have JobContext as a class) on the central maven repository, and on apache&apos;s download page... &lt;/p&gt;

&lt;p&gt;Does the 0.21+ jars still exist, (supported)?&lt;/p&gt;
</comment>
                            <comment id="13596320" author="genx7up" created="Thu, 7 Mar 2013 20:23:15 +0000"  >&lt;p&gt;We are using the newer 0.23.x &amp;amp; are facing this integration issue. Any workaround?&lt;/p&gt;</comment>
                            <comment id="13596829" author="dbrosius" created="Fri, 8 Mar 2013 05:04:42 +0000"  >&lt;p&gt;ah ok, here it is:&lt;/p&gt;

&lt;p&gt;groupid: org.apache.hadoop&lt;br/&gt;
artifactid: hadoop-mapreduce-client-core&lt;/p&gt;</comment>
                            <comment id="13596854" author="dbrosius" created="Fri, 8 Mar 2013 05:53:32 +0000"  >&lt;p&gt;initial patch against 1.2&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;pulls hadoop code into src/hadoop/hadoop-legacy&lt;/li&gt;
	&lt;li&gt;replicates that into src/hadoop/hadoop-new with changes for api changes.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;pulls new hadoop dependencies and builds separate jars for each.&lt;/p&gt;

&lt;p&gt;which jar you run against is still manual... command line switch?&lt;/p&gt;

&lt;p&gt;posted version a so i didn&apos;t lose stuff.&lt;/p&gt;

&lt;p&gt;This uses 0.23.6 versions of jars, which i assume is compatible with the 2.0a versions of the api.&lt;/p&gt;</comment>
                            <comment id="13596999" author="jeromatron" created="Fri, 8 Mar 2013 10:35:37 +0000"  >&lt;p&gt;I wonder if it would be preferable to have all of the code in tree in the same jar still, but have different package paths, like org.apache.cassandra.hadoop (for backwards compatibility) and org.apache.cassandra.hadoop2.  Would that work?&lt;/p&gt;</comment>
                            <comment id="13597054" author="brian.jeltema@digitalenvoy.net" created="Fri, 8 Mar 2013 12:06:12 +0000"  >&lt;p&gt;No workaround that I&apos;m aware of. We don&apos;t actually have this problem; I just became aware of it by&lt;br/&gt;
change while looking into a problem report, and filed an issue.&lt;/p&gt;

&lt;p&gt;Brian&lt;/p&gt;


</comment>
                            <comment id="13597775" author="dbrosius" created="Sat, 9 Mar 2013 01:12:47 +0000"  >&lt;blockquote&gt;&lt;p&gt; wonder if it would be preferable to have all of the code in tree in the same jar still, but have different package paths, like org.apache.cassandra.hadoop (for backwards compatibility) and org.apache.cassandra.hadoop2. Would that work?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;probably could be done. here&apos;s some &apos;issues&apos; with that approach.&lt;/p&gt;

&lt;p&gt;1) external code won&apos;t work against both versions with the same code base. Obviously the modifications are insignificant, (packages) but still.&lt;br/&gt;
2) Makes the build.xml file marginally more complicated as you have to use &amp;lt;exclude&amp;gt; elements in the build&lt;br/&gt;
3) Building in IDEs is complicated as you need to add resource excludes, since these packages need to be built as a separate project (at least one of them does).&lt;br/&gt;
4) If you have two IDE projects targetting the same classes dir, cleaning one project cleans the other.&lt;/p&gt;

&lt;p&gt;i could do it either way... whatever people think.&lt;/p&gt;</comment>
                            <comment id="13661509" author="michaelsembwever" created="Sun, 19 May 2013 07:49:08 +0000"  >&lt;p&gt;What about simply putting the hadoop2 package into a github project?&lt;br/&gt;
it would become available for others to use, and c* can switch to it when they feel ready to drop support for hadoop-0.20&lt;/p&gt;

&lt;p&gt;otherwise i&apos;m in favour of separate jar files (apache-cassandra-hadoop-legacy-XXX.jar and apache-cassandra-hadoop-XXX.jar). c* already bundles too much into the one jar file IMHO.&lt;/p&gt;</comment>
                            <comment id="13661512" author="michaelsembwever" created="Sun, 19 May 2013 08:37:35 +0000"  >&lt;blockquote&gt;&lt;p&gt;What about simply putting the hadoop2 package into a github project?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Done @&#160;&lt;a href=&quot;https://github.com/michaelsembwever/cassandra-hadoop&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/michaelsembwever/cassandra-hadoop&lt;/a&gt;&lt;br/&gt;
 (i refactor the new package to hadoop1 instead of hadoop2, to better match the hadoop version we are actually supporting).&lt;/p&gt;</comment>
                            <comment id="13792563" author="michaelsembwever" created="Fri, 11 Oct 2013 12:27:55 +0000"  >&lt;p&gt;I&apos;ve updated the github project so to be a &lt;a href=&quot;https://github.com/michaelsembwever/cassandra-hadoop/commit/6d7555ea205354a606907e40c16db35072004594&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;patch&lt;/a&gt; off the InputFormat and OutputFormat classes as found in cassandra-1.2.10&lt;br/&gt;
It works against hadoop-0.22.0&lt;/p&gt;</comment>
                            <comment id="13793706" author="jbellis" created="Sun, 13 Oct 2013 16:55:27 +0000"  >&lt;p&gt;How common is hadoop2 usage now?  Can we drop hadoop1 for 2.1?  /cc &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=bcoverston&quot; class=&quot;user-hover&quot; rel=&quot;bcoverston&quot;&gt;bcoverston&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13804877" author="kkrugler" created="Fri, 25 Oct 2013 00:55:55 +0000"  >&lt;p&gt;Re Hadoop 1.x vs. Hadoop 2.x - most companies I see are using a 1.x version of Hadoop. Usage of Hadoop 2.x is ramping up fast, but I&apos;m guessing it will be at least another year (probably more) before you&apos;d want to start thinking about phasing out support for Hadoop 1.x&lt;/p&gt;</comment>
                            <comment id="13805107" author="michaelsembwever" created="Fri, 25 Oct 2013 07:07:11 +0000"  >&lt;p&gt;Hadoop-2 only just came out of alpha/beta with hadoop-2.2.0&lt;/p&gt;</comment>
                            <comment id="13805165" author="nyo" created="Fri, 25 Oct 2013 08:34:33 +0000"  >&lt;p&gt;Why dropping support for old hadoop versions while you can just use a different package name (e.g  org.apache.cassandra.hadoop2.&amp;lt;SomeClass&amp;gt;)? Imo, the code in here:&lt;br/&gt;
&lt;a href=&quot;https://github.com/michaelsembwever/cassandra-hadoop/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/michaelsembwever/cassandra-hadoop/&lt;/a&gt; should just be merged with mainstream implementation, so both 1.x and 2.x users can  be happy.&lt;/p&gt;

&lt;p&gt;Or you can indeed make it a lot more complex by merging the 1.x and 2.x compatible implementations and deciding which one to use based on metadata obtained by polling the cluster, but that is a bit too sophisticated. For most people the first option, where they can choose which package to use, would be sufficient.&lt;/p&gt;</comment>
                            <comment id="13808139" author="claudio.romo.otto" created="Tue, 29 Oct 2013 16:18:45 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mck&quot; class=&quot;user-hover&quot; rel=&quot;mck&quot;&gt;mck&lt;/a&gt; How could be used your patch to make work Cassandra + Hadoop 2.2 + Pig? I have your library compiled but cannot figure how to apply to Cassandra or Pig to make it work, because I still hit the exception from Cassandra:&lt;br/&gt;
java.lang.IncompatibleClassChangeError: Found interface org.apache.hadoop.mapreduce.JobContext, but class was expected&lt;br/&gt;
	at org.apache.cassandra.hadoop.AbstractColumnFamilyInputFormat.getSplits(AbstractColumnFamilyInputFormat.java:115)&lt;/p&gt;</comment>
                            <comment id="13808162" author="nyo" created="Tue, 29 Oct 2013 16:32:28 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=claudio.romo.otto&quot; class=&quot;user-hover&quot; rel=&quot;claudio.romo.otto&quot;&gt;claudio.romo.otto&lt;/a&gt; &lt;br/&gt;
It is a bit complex but basically you need to use the org.apache.cassandra.hadoop2.ColumnFamilyInputFormat stuff from &lt;a href=&quot;https://github.com/michaelsembwever/cassandra-hadoop/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/michaelsembwever/cassandra-hadoop/&lt;/a&gt;&lt;br/&gt;
As far as hadoop goes, I ran succesfully with a cdh 4.4.1 cloudera hadoop lib, and with a cassandra 1.2.10. &lt;/p&gt;</comment>
                            <comment id="13808361" author="claudio.romo.otto" created="Tue, 29 Oct 2013 19:36:39 +0000"  >&lt;p&gt;So the correct way is to update cassandra 1.2.10 using org.apache.cassandra.hadoop2.ColumnFamilyInputFormat, right?&lt;/p&gt;</comment>
                            <comment id="13838294" author="bcoverston" created="Tue, 3 Dec 2013 22:58:16 +0000"  >&lt;p&gt;Poking around at other projects this generally gets solved in one of two ways: Ship two versions of their Hadoop integrations (one compiled for the old, and one compiled for the new), or use a little reflection to make things work across the board.&lt;/p&gt;

&lt;p&gt;I&apos;m attaching a patch that uses the hadoopCompat subproject of elephantbird. This will allow us to compile a single binary and run with the new and old context objects.&lt;/p&gt;

&lt;p&gt;I&apos;ve tested this patch with HDP 2.0, and Apache Hadoop 1.0.4 and it works fine with both (including Hive in DSE). With Pig I needed to compile our (optional) pig dependency with:&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;ant clean jar-withouthadoop -Dhadoopversion=23&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Only really needed if you&apos;re using one of the current versions of thrift with the new JobContext.&lt;/p&gt;</comment>
                            <comment id="13838325" author="bcoverston" created="Tue, 3 Dec 2013 23:36:16 +0000"  >&lt;p&gt;These changes also depend on &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-6309&quot; title=&quot;Pig CqlStorage generates  ERROR 1108: Duplicate schema alias&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-6309&quot;&gt;&lt;del&gt;CASSANDRA-6309&lt;/del&gt;&lt;/a&gt; for anything to work.&lt;/p&gt;</comment>
                            <comment id="13839417" author="jbellis" created="Wed, 4 Dec 2013 22:33:38 +0000"  >&lt;p&gt;WDYT &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=dbrosius&quot; class=&quot;user-hover&quot; rel=&quot;dbrosius&quot;&gt;dbrosius&lt;/a&gt;?&lt;/p&gt;</comment>
                            <comment id="13850067" author="jbellis" created="Tue, 17 Dec 2013 03:31:30 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mck&quot; class=&quot;user-hover&quot; rel=&quot;mck&quot;&gt;mck&lt;/a&gt;?  &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jeromatron&quot; class=&quot;user-hover&quot; rel=&quot;jeromatron&quot;&gt;jeromatron&lt;/a&gt;?&lt;/p&gt;</comment>
                            <comment id="13862442" author="jeromatron" created="Sat, 4 Jan 2014 23:29:32 +0000"  >&lt;p&gt;Seems reasonable if they&apos;re keeping their code up to date with all of the releases.  The code appears lightweight to make to use it as well.  I&apos;ve also tried to reach out to &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=dvryaboy&quot; class=&quot;user-hover&quot; rel=&quot;dvryaboy&quot;&gt;dvryaboy&lt;/a&gt; via twitter to see if he has any feedback about the approach of having elephant bird as a dependency, e.g. any hidden costs or pitfalls being more familiar with the project.&lt;/p&gt;</comment>
                            <comment id="13862670" author="dvryaboy" created="Sun, 5 Jan 2014 22:10:03 +0000"  >&lt;p&gt;The EB HadoopCompat is what we use in production at Twitter, and plan to keep up to date in the foreseeable future. Glad you are finding it useful.&lt;/p&gt;

&lt;p&gt;Maybe you can send that Reporter implementation as a pull request for hadoop-compat? Seems generally applicable.&lt;/p&gt;

&lt;p&gt;Thanks to this ping, I looked around and noticed that our Parquet project uses a slightly different version of the same code &amp;#8211; we&apos;ll take a look and merge things. Shouldn&apos;t change anything significantly for this patch.&lt;/p&gt;

&lt;p&gt;Also note that Tom White has a handy findbugs plugin to look for Hadoop incompatibility problems: &lt;a href=&quot;https://github.com/tomwhite/hadoop-incompatibility-findbugs-detector&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/tomwhite/hadoop-incompatibility-findbugs-detector&lt;/a&gt; &lt;/p&gt;

&lt;p&gt;Here&apos;s how you&apos;d use it: &lt;a href=&quot;https://github.com/Parquet/parquet-mr/pull/77/files&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/Parquet/parquet-mr/pull/77/files&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13862986" author="jeromatron" created="Mon, 6 Jan 2014 13:30:50 +0000"  >&lt;p&gt;Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=dvryaboy&quot; class=&quot;user-hover&quot; rel=&quot;dvryaboy&quot;&gt;dvryaboy&lt;/a&gt;!&lt;/p&gt;

&lt;p&gt;Just for completeness the twitter thread is &lt;a href=&quot;https://twitter.com/jeromatron/status/419607697588510721&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://twitter.com/jeromatron/status/419607697588510721&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=bcoverston&quot; class=&quot;user-hover&quot; rel=&quot;bcoverston&quot;&gt;bcoverston&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jbellis&quot; class=&quot;user-hover&quot; rel=&quot;jbellis&quot;&gt;jbellis&lt;/a&gt; what do you think?&lt;/p&gt;

&lt;p&gt;As for me, it sounds like the EB (or if it makes more sense Parquet) dependency makes sense.  The hadoop incompatibility findbugs detector also sounds great to include to catch anything before it is committed.  So I&apos;m +1 on this approach.&lt;/p&gt;</comment>
                            <comment id="13863170" author="bcoverston" created="Mon, 6 Jan 2014 18:02:48 +0000"  >&lt;p&gt;I&apos;ll submit the reporter impl upstream. Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=dvryaboy&quot; class=&quot;user-hover&quot; rel=&quot;dvryaboy&quot;&gt;dvryaboy&lt;/a&gt;!&lt;/p&gt;</comment>
                            <comment id="13896885" author="jbellis" created="Mon, 10 Feb 2014 19:19:38 +0000"  >&lt;p&gt;Are we good here &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=brandon.williams&quot; class=&quot;user-hover&quot; rel=&quot;brandon.williams&quot;&gt;brandon.williams&lt;/a&gt;?&lt;/p&gt;</comment>
                            <comment id="13897929" author="brandon.williams" created="Tue, 11 Feb 2014 15:39:33 +0000"  >&lt;p&gt;Committed to 2.0.  &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=bcoverston&quot; class=&quot;user-hover&quot; rel=&quot;bcoverston&quot;&gt;bcoverston&lt;/a&gt; can you rebase a patch for trunk?&lt;/p&gt;</comment>
                            <comment id="13898333" author="bcoverston" created="Tue, 11 Feb 2014 21:26:30 +0000"  >&lt;p&gt;Attached trunk-rebased patch.&lt;/p&gt;</comment>
                            <comment id="13898389" author="brandon.williams" created="Tue, 11 Feb 2014 22:10:59 +0000"  >&lt;p&gt;Committed.&lt;/p&gt;</comment>
                            <comment id="13914500" author="moliware" created="Thu, 27 Feb 2014 13:37:25 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=brandon.williams&quot; class=&quot;user-hover&quot; rel=&quot;brandon.williams&quot;&gt;brandon.williams&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;I&apos;m using this patch and I keep having compatibility problems while trying to write something with pig using CqlStorage.&lt;br/&gt;
I&apos;m using Hadoop 2.2 and Cassandra 2.0 branch.&lt;/p&gt;

&lt;p&gt;This is the full stack trace:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;java.lang.IncompatibleClassChangeError: Found interface org.apache.hadoop.mapreduce.TaskAttemptContext, but class was expected
        at org.apache.cassandra.hadoop.Progressable.progress(Progressable.java:45)
        at org.apache.cassandra.hadoop.cql3.CqlRecordWriter.write(CqlRecordWriter.java:183)        
        at org.apache.cassandra.hadoop.cql3.CqlRecordWriter.write(CqlRecordWriter.java:63)        
        at org.apache.cassandra.hadoop.pig.CqlStorage.sendCqlQuery(CqlStorage.java:440)        
        at org.apache.cassandra.hadoop.pig.CqlStorage.cqlQueryFromTuple(CqlStorage.java:414)        
        at org.apache.cassandra.hadoop.pig.CqlStorage.putNext(CqlStorage.java:362)        
        at org.apache.pig.backend.hadoop.executionengine.mapReduceLayer.PigOutputFormat$PigRecordWriter.write(PigOutputFormat.java:139)        
        at org.apache.pig.backend.hadoop.executionengine.mapReduceLayer.PigOutputFormat$PigRecordWriter.write(PigOutputFormat.java:98)        
        at org.apache.hadoop.mapred.ReduceTask$NewTrackingRecordWriter.write(ReduceTask.java:576)        
        at org.apache.hadoop.mapreduce.task.TaskInputOutputContextImpl.write(TaskInputOutputContextImpl.java:89)        
        at org.apache.hadoop.mapreduce.lib.reduce.WrappedReducer$Context.write(WrappedReducer.java:105)        
        at org.apache.pig.backend.hadoop.executionengine.mapReduceLayer.PigGenericMapReduce$Reduce.runPipeline(PigGenericMapReduce.java:467)        
        at org.apache.pig.backend.hadoop.executionengine.mapReduceLayer.PigGenericMapReduce$Reduce.processOnePackageOutput(PigGenericMapReduce.java:432)        
        at org.apache.pig.backend.hadoop.executionengine.mapReduceLayer.PigGenericMapReduce$Reduce.reduce(PigGenericMapReduce.java:412)        
        at org.apache.pig.backend.hadoop.executionengine.mapReduceLayer.PigGenericMapReduce$Reduce.reduce(PigGenericMapReduce.java:256)        
        at org.apache.hadoop.mapreduce.Reducer.run(Reducer.java:171)        
        at org.apache.hadoop.mapred.ReduceTask.runNewReducer(ReduceTask.java:645)        
        at org.apache.hadoop.mapred.ReduceTask.run(ReduceTask.java:405)        
        at org.apache.hadoop.mapred.YarnChild$2.run(YarnChild.java:162)        
        at java.security.AccessController.doPrivileged(Native Method)        
        at javax.security.auth.Subject.doAs(Subject.java:415)        
        at org.apache.hadoop.security.UserGroupInformation.doAs(UserGroupInformation.java:1491)        
        at org.apache.hadoop.mapred.YarnChild.main(YarnChild.java:157)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
</comment>
                            <comment id="13915996" author="bcoverston" created="Fri, 28 Feb 2014 16:57:16 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=moliware&quot; class=&quot;user-hover&quot; rel=&quot;moliware&quot;&gt;moliware&lt;/a&gt;,  attaching a patch that will fix the issue with progressable when used on the jobcontext object. I&apos;ve tested this with the latest HDP release, and it works with pig. &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=brandon.williams&quot; class=&quot;user-hover&quot; rel=&quot;brandon.williams&quot;&gt;brandon.williams&lt;/a&gt; take a look.&lt;/p&gt;</comment>
                            <comment id="13916086" author="moliware" created="Fri, 28 Feb 2014 17:51:12 +0000"  >&lt;p&gt;Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=bcoverston&quot; class=&quot;user-hover&quot; rel=&quot;bcoverston&quot;&gt;bcoverston&lt;/a&gt; I will test the patch probably on monday and will confirm you but it looks good. Thanks!&lt;/p&gt;</comment>
                            <comment id="13917833" author="moliware" created="Mon, 3 Mar 2014 08:24:45 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=bcoverston&quot; class=&quot;user-hover&quot; rel=&quot;bcoverston&quot;&gt;bcoverston&lt;/a&gt; Tested and It worked! Thanks!&lt;/p&gt;</comment>
                            <comment id="13917843" author="hkropp" created="Mon, 3 Mar 2014 08:44:00 +0000"  >&lt;p&gt;Does this patch include deployment with maven classifiers, so that hadoop1 or hadoop2 are referenced dependencies?&lt;/p&gt;</comment>
                            <comment id="13918536" author="hkropp" created="Mon, 3 Mar 2014 20:20:25 +0000"  >&lt;p&gt;I also was able to make this patch work with HDP 2.0. Nevertheless before this ticket is closed I would like to make 2 suggestions:&lt;br/&gt;
1. Use maven classifiers for deployment. If this is used in a hadoop2 project you don&apos;t want hadoop1 dependencies and vice versa. This approach is used by Parquet, Avro and EB. For detailed discussion please read &lt;a href=&quot;https://github.com/Parquet/parquet-mr/pull/32&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;here&lt;/a&gt;.&lt;br/&gt;
2. Change &lt;tt&gt;hadoop-core&lt;/tt&gt; to &lt;tt&gt;hadoop-client&lt;/tt&gt; dependency. &lt;tt&gt;hadoop-client&lt;/tt&gt; is the preferred dependency. Read &lt;a href=&quot;http://www.cloudera.com/content/cloudera-content/cloudera-docs/CDH4/latest/CDH-Version-and-Packaging-Information/cdhvd_topic_8_1.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;here&lt;/a&gt; and the link above.&lt;/p&gt;</comment>
                            <comment id="13918725" author="bcoverston" created="Mon, 3 Mar 2014 23:33:59 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=hkropp&quot; class=&quot;user-hover&quot; rel=&quot;hkropp&quot;&gt;hkropp&lt;/a&gt; I agree that we need to do the second change, but I don&apos;t see a need to add deployment classifiers. Because we&apos;re using Hadoop-Compat (from EB) a single binary will work for both.&lt;/p&gt;

&lt;p&gt;There&apos;s a niggle right now with Progressable that I&apos;m working on, but a single binary will work for new and legacy deployments.&lt;/p&gt;</comment>
                            <comment id="13919107" author="hkropp" created="Tue, 4 Mar 2014 07:54:50 +0000"  >&lt;p&gt;I might be missing an important point, but Hadoop-Compat is nothing other than ContextUtil of hadoop2? It uses reflection to test what&apos;s on the classpath to decide how or better what to return. I made it work with just using ContextUtil before I found this patch here.&lt;/p&gt;

&lt;p&gt;Therefor the binary works fine for both (btw I would not consider it legacy!), if you manage the dependencies on your own.&lt;/p&gt;

&lt;p&gt;But if you would start a new project you would import Cassandra for example like this:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;dependencies {
  ...
  compile &lt;span class=&quot;code-quote&quot;&gt;&apos;org.apache.cassandra:cassandra:2.0.6&apos;&lt;/span&gt;
  ...
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;What will happen now is, that this will load hadoop1 dependencies into my hadoop2 project for example, or not? To avoid this maven classifiers could be used, to call explicitly for hadoop2 dependencies:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;dependencies {
  ....
  compile &lt;span class=&quot;code-quote&quot;&gt;&apos;org.apache.cassandra:cassandra:2.0.6:hadoop2&apos;&lt;/span&gt;
  ...
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="13919579" author="bcoverston" created="Tue, 4 Mar 2014 16:36:34 +0000"  >&lt;p&gt;Take a look at the code, it works for Hadoop1 and Hadoop2 without recompliation, and without shipping two sets of dependencies. Basically it detects the current version of Hadoop that you&apos;re running and dynamically determines which TaskAttemptContext to use, the Class, or the Interface. There&apos;s no need to use deployment classifiers to solve this particular problem.&lt;/p&gt;</comment>
                            <comment id="13920052" author="bcoverston" created="Tue, 4 Mar 2014 21:31:32 +0000"  >&lt;p&gt;Attaching a patch that brings in hadoop-compat, and adds the progressable wrapper to it. I&apos;m going to submit this upstream to the elephant bird project, so we should be able to remove this code and add the dependency in the future.&lt;/p&gt;</comment>
                            <comment id="13920070" author="bcoverston" created="Tue, 4 Mar 2014 21:46:26 +0000"  >&lt;p&gt;Updated progressable-wrapper.patch to conform to current namespaces.&lt;/p&gt;</comment>
                            <comment id="13920129" author="bcoverston" created="Tue, 4 Mar 2014 22:33:53 +0000"  >&lt;p&gt;I removed the hadoop-compat dependency, as maven couldn&apos;t resolve the dependencies, reverted to the old version. This won&apos;t stop our input/output formats from being compatible with past and future releases.&lt;/p&gt;</comment>
                            <comment id="13921208" author="bcoverston" created="Wed, 5 Mar 2014 18:55:39 +0000"  >&lt;p&gt;Patch for 2.1 branch&lt;/p&gt;</comment>
                            <comment id="13921220" author="brandon.williams" created="Wed, 5 Mar 2014 19:00:44 +0000"  >&lt;p&gt;I had the same maven resolution problem with hadoop-compat.  Committed.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12572704" name="5201_a.txt" size="457196" author="dbrosius" created="Fri, 8 Mar 2013 05:53:32 +0000"/>
                            <attachment id="12632877" name="hadoop-compat-2.1-merge.patch" size="32982" author="bcoverston" created="Wed, 5 Mar 2014 18:55:38 +0000"/>
                            <attachment id="12616870" name="hadoopCompat.patch" size="19208" author="bcoverston" created="Tue, 3 Dec 2013 22:58:16 +0000"/>
                            <attachment id="12628339" name="hadoopcompat-trunk.patch" size="17467" author="bcoverston" created="Tue, 11 Feb 2014 21:26:30 +0000"/>
                            <attachment id="12631782" name="progressable-fix.patch" size="10817" author="bcoverston" created="Fri, 28 Feb 2014 16:57:16 +0000"/>
                            <attachment id="12632687" name="progressable-wrapper.patch" size="33000" author="bcoverston" created="Tue, 4 Mar 2014 22:33:53 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>6.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[bcoverston]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>310438</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            11 years, 37 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1hkq7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>310783</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>brandon.williams</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[brandon.williams]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12962"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>