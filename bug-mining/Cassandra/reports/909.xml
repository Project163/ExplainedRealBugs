<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 22:21:08 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-2619] secondary index not dropped until restart</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-2619</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;when dropping the secondary index (via cassandra-cli), the describe keyspace still shows the Built index entry. Only after a restart of the CassandraDaemon then the Built Index entry is gone. This seems indicate a problem with the index not really been dropped completed.&lt;/p&gt;

&lt;p&gt;to test, use a single node, create an index, then drop it from the cli (issue an update column family ... with metadata fields but not the index info)&lt;/p&gt;

&lt;p&gt;below is the original:&lt;/p&gt;

&lt;p&gt;  Column Families:&lt;br/&gt;
    ColumnFamily: inode&lt;br/&gt;
    &quot;Stores file meta data&quot;&lt;br/&gt;
      Key Validation Class: org.apache.cassandra.db.marshal.BytesType&lt;br/&gt;
      Default column value validator: org.apache.cassandra.db.marshal.BytesType&lt;br/&gt;
      Columns sorted by: org.apache.cassandra.db.marshal.BytesType&lt;br/&gt;
      Row cache size / save period in seconds: 0.0/0&lt;br/&gt;
      Key cache size / save period in seconds: 0.0/14400&lt;br/&gt;
      Memtable thresholds: 0.103125/22/1440 (millions of ops/MB/minutes)&lt;br/&gt;
      GC grace seconds: 60&lt;br/&gt;
      Compaction min/max thresholds: 4/32&lt;br/&gt;
      Read repair chance: 1.0&lt;br/&gt;
      Replicate on write: false&lt;br/&gt;
      &lt;font color=&quot;red&quot;&gt;Built indexes: &lt;span class=&quot;error&quot;&gt;&amp;#91;inode.path, inode.sentinel&amp;#93;&lt;/span&gt;&lt;/font&gt;&lt;br/&gt;
      Column Metadata:&lt;br/&gt;
        Column Name: path (70617468)&lt;br/&gt;
          Validation Class: org.apache.cassandra.db.marshal.BytesType&lt;br/&gt;
          &lt;font color=&quot;red&quot;&gt;Index Name: path&lt;br/&gt;
          Index Type: KEYS&lt;/font&gt;&lt;br/&gt;
        Column Name: sentinel (73656e74696e656c)&lt;br/&gt;
          Validation Class: org.apache.cassandra.db.marshal.BytesType&lt;br/&gt;
          &lt;font color=&quot;red&quot;&gt;Index Name: sentinel&lt;br/&gt;
          Index Type: KEYS&lt;/font&gt;&lt;/p&gt;

&lt;p&gt;issue an update:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;
[default@unknown] use cfs;
Authenticated to keyspace: cfs
[default@cfs] update column family inode with comparator=BytesType and column_metadata=[{column_name:70617468, validation_class:BytesType}, {column_name:73656e74696e656c,validation_class:BytesType}];
fca46d00-783c-11e0-0000-242d50cf1fff
Waiting for schema agreement...
... schemas agree across the cluster
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;describe the keyspace again:&lt;br/&gt;
Keyspace: cfs:&lt;br/&gt;
  Replication Strategy: org.apache.cassandra.locator.NetworkTopologyStrategy&lt;br/&gt;
    Options: &lt;span class=&quot;error&quot;&gt;&amp;#91;Brisk:1, Cassandra:0&amp;#93;&lt;/span&gt;&lt;br/&gt;
  Column Families:&lt;br/&gt;
    ColumnFamily: inode&lt;br/&gt;
    &quot;Stores file meta data&quot;&lt;br/&gt;
      Key Validation Class: org.apache.cassandra.db.marshal.BytesType&lt;br/&gt;
      Default column value validator: org.apache.cassandra.db.marshal.BytesType&lt;br/&gt;
      Columns sorted by: org.apache.cassandra.db.marshal.BytesType&lt;br/&gt;
      Row cache size / save period in seconds: 0.0/0&lt;br/&gt;
      Key cache size / save period in seconds: 0.0/14400&lt;br/&gt;
      Memtable thresholds: 0.103125/22/1440 (millions of ops/MB/minutes)&lt;br/&gt;
      GC grace seconds: 60&lt;br/&gt;
      Compaction min/max thresholds: 4/32&lt;br/&gt;
      Read repair chance: 1.0&lt;br/&gt;
      Replicate on write: false&lt;br/&gt;
      &lt;font color=&quot;red&quot;&gt;Built indexes: &lt;span class=&quot;error&quot;&gt;&amp;#91;inode.path, inode.sentinel&amp;#93;&lt;/span&gt;&lt;/font&gt;&lt;br/&gt;
      Column Metadata:&lt;br/&gt;
        Column Name: path (70617468)&lt;br/&gt;
          Validation Class: org.apache.cassandra.db.marshal.BytesType&lt;br/&gt;
        Column Name: sentinel (73656e74696e656c)&lt;br/&gt;
          Validation Class: org.apache.cassandra.db.marshal.BytesType&lt;/p&gt;

&lt;p&gt;&lt;b&gt;notice the red line on Built Indexes&lt;/b&gt;&lt;/p&gt;

&lt;p&gt;restart CassandraDaemon, describe again:&lt;/p&gt;

&lt;p&gt;Keyspace: cfs:&lt;br/&gt;
  Replication Strategy: org.apache.cassandra.locator.NetworkTopologyStrategy&lt;br/&gt;
    Options: &lt;span class=&quot;error&quot;&gt;&amp;#91;Brisk:1, Cassandra:0&amp;#93;&lt;/span&gt;&lt;br/&gt;
  Column Families:&lt;br/&gt;
    ColumnFamily: inode&lt;br/&gt;
    &quot;Stores file meta data&quot;&lt;br/&gt;
      Key Validation Class: org.apache.cassandra.db.marshal.BytesType&lt;br/&gt;
      Default column value validator: org.apache.cassandra.db.marshal.BytesType&lt;br/&gt;
      Columns sorted by: org.apache.cassandra.db.marshal.BytesType&lt;br/&gt;
      Row cache size / save period in seconds: 0.0/0&lt;br/&gt;
      Key cache size / save period in seconds: 0.0/14400&lt;br/&gt;
      Memtable thresholds: 0.103125/22/1440 (millions of ops/MB/minutes)&lt;br/&gt;
      GC grace seconds: 60&lt;br/&gt;
      Compaction min/max thresholds: 4/32&lt;br/&gt;
      Read repair chance: 1.0&lt;br/&gt;
      Replicate on write: false&lt;br/&gt;
      &lt;font color=&quot;red&quot;&gt;Built indexes: []&lt;/font&gt;&lt;br/&gt;
      Column Metadata:&lt;br/&gt;
        Column Name: path (70617468)&lt;br/&gt;
          Validation Class: org.apache.cassandra.db.marshal.BytesType&lt;br/&gt;
        Column Name: sentinel (73656e74696e656c)&lt;br/&gt;
          Validation Class: org.apache.cassandra.db.marshal.BytesType&lt;/p&gt;


&lt;p&gt;on another note, upon re-create the index, it does not appear the index is actually rebuilt. There is no need to restart CassandraDaemon for the Built Index to show up from the describe. But the update goes very fast. We could tell the index is not being rebuilt because we were getting NPE from:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;java.lang.RuntimeException: java.lang.NullPointerException
	at org.apache.cassandra.service.IndexScanVerbHandler.doVerb(IndexScanVerbHandler.java:51)
	at org.apache.cassandra.net.MessageDeliveryTask.run(MessageDeliveryTask.java:72)
	at java.util.concurrent.ThreadPoolExecutor$Worker.runTask(ThreadPoolExecutor.java:886)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:908)
	at java.lang.Thread.run(Thread.java:662)
Caused by: java.lang.NullPointerException
	at org.apache.cassandra.db.ColumnFamilyStore.satisfies(ColumnFamilyStore.java:1647)
	at org.apache.cassandra.db.ColumnFamilyStore.scan(ColumnFamilyStore.java:1594)
	at org.apache.cassandra.service.IndexScanVerbHandler.doVerb(IndexScanVerbHandler.java:42)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;and after re-create the index, the exception resurface (the exception does not surface upon drop).&lt;/p&gt;

&lt;p&gt;If we drop the index files and remove them, then re-create the index, the NPE is resolved: &lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;$ find /var/lib/cassandra/data/cfs -name &quot;*path*&quot; -o -name &quot;*sentinel* -exec rm {} \;&quot;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="12506473">CASSANDRA-2619</key>
            <summary>secondary index not dropped until restart</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10002" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Normal</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="jbellis">Jonathan Ellis</assignee>
                                    <reporter username="cywjackson">Jackson Chung</reporter>
                        <labels>
                    </labels>
                <created>Sat, 7 May 2011 00:36:24 +0000</created>
                <updated>Tue, 16 Apr 2019 09:32:59 +0000</updated>
                            <resolved>Mon, 9 May 2011 07:09:24 +0000</resolved>
                                        <fixVersion>0.7.6</fixVersion>
                    <fixVersion>0.8.0</fixVersion>
                                    <component>Feature/2i Index</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                                                                <comments>
                            <comment id="13030276" author="jbellis" created="Sat, 7 May 2011 04:54:36 +0000"  >&lt;p&gt;Patch attached. There are 3 main things going on here:&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;move DefsTest to config package (so it can access CFMetaData.column_metadata) and add a test to expose the bug&lt;/li&gt;
	&lt;li&gt;clarify the CFMetaData.apply code to make it clear where it&apos;s dealing w/ column addition/removal and not indexes per se (this is where I thought the bug was at first)&lt;/li&gt;
	&lt;li&gt;the actual fix, which is the 3 line change to CFS.reload&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;(Note that as a workaround, you can simply drop the column definition altogether instead of leaving the validator intact while removing the index type.)&lt;/p&gt;</comment>
                            <comment id="13030277" author="jbellis" created="Sat, 7 May 2011 05:08:06 +0000"  >&lt;p&gt;NOTE: because svn is retarded, you need to help patch figure out how to apply this, by first running&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;cp test/unit/org/apache/cassandra/db/DefsTest.java test/unit/org/apache/cassandra/config/DefsTest.java
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="13030283" author="brandon.williams" created="Sat, 7 May 2011 06:23:48 +0000"  >&lt;p&gt;+1&lt;/p&gt;</comment>
                            <comment id="13030288" author="hudson" created="Sat, 7 May 2011 07:16:21 +0000"  >&lt;p&gt;Integrated in Cassandra-0.7 #474 (See &lt;a href=&quot;https://builds.apache.org/hudson/job/Cassandra-0.7/474/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/hudson/job/Cassandra-0.7/474/&lt;/a&gt;)&lt;br/&gt;
    recognize attempt todrop just the index while leaving the column definition&lt;br/&gt;
patch by jbellis; reviewed by brandonwilliams for &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-2619&quot; title=&quot;secondary index not dropped until restart&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-2619&quot;&gt;&lt;del&gt;CASSANDRA-2619&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13030626" author="jbellis" created="Mon, 9 May 2011 07:09:24 +0000"  >&lt;p&gt;(committed)&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12478490" name="2619.txt" size="42768" author="jbellis" created="Sat, 7 May 2011 04:54:36 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[jbellis]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>20732</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            14 years, 29 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0gcg7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>93447</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>brandon.williams</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[brandon.williams]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12962"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>