<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 22:36:37 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-5079] Compaction deletes ExpiringColumns in Secondary Indexes</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-5079</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;From this discussion &lt;a href=&quot;http://www.mail-archive.com/user@cassandra.apache.org/msg26599.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://www.mail-archive.com/user@cassandra.apache.org/msg26599.html&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;CompactionManager.getDefaultGcBefore() set&apos;s the gc_before to be Integer.MAX_VALUE. &lt;/p&gt;

&lt;p&gt;In the example all entries in the secondary index have a TTL. In PreCompactedRow.removeDeletedAndOldShards() the CF is determined to have irrelevant data, the call to CFS.removeDeleted() results in the ExpiringColumns being removed and the row is treated as empty. CompactionTask.execute() exits at the &lt;tt&gt;if (!nni.hasNext())&lt;/tt&gt; test, so the sstables are marked as compacted and soon deleted. &lt;/p&gt;

&lt;p&gt;In the example the localDeletionTime was Thu, 21 Mar 2013 08:25:22 GMT and should not have been purged. &lt;/p&gt;

&lt;p&gt;In the example when the first compaction on the secondary index runs the on disk data for the index is deleted. The logs show a compaction starting and no associated &quot;Compacted to&quot; message from that compaction thread. &lt;/p&gt;

&lt;p&gt;The impact is incorrect results from secondary indexes queries.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12624763">CASSANDRA-5079</key>
            <summary>Compaction deletes ExpiringColumns in Secondary Indexes</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10002" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Normal</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="amorton">Aaron Morton</assignee>
                                    <reporter username="amorton">Aaron Morton</reporter>
                        <labels>
                    </labels>
                <created>Thu, 20 Dec 2012 04:05:36 +0000</created>
                <updated>Tue, 16 Apr 2019 09:32:20 +0000</updated>
                            <resolved>Thu, 20 Dec 2012 09:12:16 +0000</resolved>
                                        <fixVersion>1.1.9</fixVersion>
                    <fixVersion>1.2.0 rc2</fixVersion>
                                    <component>Feature/2i Index</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="13536768" author="amorton" created="Thu, 20 Dec 2012 04:32:44 +0000"  >&lt;p&gt;first version uses the current time for gc_before for secondary indexes.&lt;/p&gt;</comment>
                            <comment id="13536783" author="jbellis" created="Thu, 20 Dec 2012 05:09:50 +0000"  >&lt;p&gt;Thanks Aaron, that looks like good detective work.&lt;/p&gt;

&lt;p&gt;(Setting affects-version to when 2I were added.  Please correct if this was a more recent regression.)&lt;/p&gt;</comment>
                            <comment id="13536855" author="amorton" created="Thu, 20 Dec 2012 08:07:23 +0000"  >&lt;p&gt;Yup, was a fun few hours.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;(Setting affects-version to when 2I were added. Please correct if this was a more recent regression.)&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Yes it has always been there. &lt;/p&gt;

&lt;p&gt;Will need to patch 0.8 onwards. Do we still release 0.7?&lt;/p&gt;</comment>
                            <comment id="13536863" author="slebresne" created="Thu, 20 Dec 2012 08:31:49 +0000"  >&lt;p&gt;That patch is reversed, right? (i.e. it adds what it is supposed to remove and remove what it is supposed to add)&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;Will need to patch 0.8 onwards. Do we still release 0.7?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;We don&apos;t release 0.7 and we don&apos;t release 0.8 either. I don&apos;t even want to release a 1.0 anymore. If you haven&apos;t complained about this, you probably don&apos;t use 2i and TTL. Even if you do, then that&apos;s a good excuse to upgrade to 1.1 at last.&lt;/p&gt;</comment>
                            <comment id="13536878" author="slebresne" created="Thu, 20 Dec 2012 09:12:16 +0000"  >&lt;p&gt;Alright, I&apos;ve committed assuming the patch was indeed reversed (didn&apos;t make any sense otherwise anyway). Thanks.&lt;/p&gt;</comment>
                            <comment id="13537630" author="amorton" created="Fri, 21 Dec 2012 02:27:27 +0000"  >&lt;blockquote&gt;&lt;p&gt;assuming the patch was indeed reversed&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Not sure what you mean. Did i get the diff wrong?&lt;/p&gt;</comment>
                            <comment id="13537751" author="slebresne" created="Fri, 21 Dec 2012 08:05:39 +0000"  >&lt;p&gt;Yeah. If you look at the patch, the &apos;+&apos; should be &apos;-&apos; and vice-versa. You probably did a &lt;tt&gt;git diff patched HEAD&lt;/tt&gt; instead of &lt;tt&gt;git diff HEAD patch&lt;/tt&gt;. But anyway, that&apos;s ok, no harm done.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                            <outwardlinks description="duplicates">
                                        <issuelink>
            <issuekey id="12618640">CASSANDRA-5024</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12607869">CASSANDRA-4670</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12561842" name="5079.txt" size="1244" author="amorton" created="Thu, 20 Dec 2012 04:32:03 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[amorton]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>301269</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            12 years, 48 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i16r1b:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>247512</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>slebresne</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[slebresne]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12962"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>