<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 22:16:42 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-1467] replication factor exceeds number of endpoints, when attempting to join a new node (but cluster has enough running nodes to fulfill RF)</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-1467</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;What happens here the following:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;given a healthy running cluster of 2 nodes (it used to be 3 but I manually killed one down)&lt;/li&gt;
	&lt;li&gt;with a Keyspace having a ReplicationFactor of 2&lt;/li&gt;
	&lt;li&gt;(this cluster is operational, loaded with data and working well)&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt; as soon as I want to bring up a new 3rd node:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;the node is detected by the current cluster&lt;/li&gt;
	&lt;li&gt;but as soon as it tries to initiate bootstrap sequence it dies with:  replication factor (2) exceeds number of endpoints (1)&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;I believe this is similar to #1343, but not quite the same, since the keyspace and everything is already created, and I&apos;m not attempting any modification. This is purely bringing a new node up.&lt;/p&gt;

&lt;p&gt;One extra tidbit of information, in case it&apos;s important...maybe it is not: &lt;br/&gt;
I have only set 1 seed node configured (this is a test setup). And when the new node starts coming up (before the crash) its nodetool ring only reports the seed one.&lt;/p&gt;

&lt;p&gt;From the new node coming up (before it crashes):&lt;br/&gt;
root@node1-3:~# nodetool -h localhost -p 8080 ring&lt;br/&gt;
Address         Status State   Load            Token                                       &lt;br/&gt;
10.250.106.111  Up     Normal  116.3 GB        0          &amp;lt; = this the only configured seed node&lt;/p&gt;

&lt;p&gt;From one of the other running nodes (this is the real status of the cluster):&lt;br/&gt;
root@node1-2:~# nodetool -h localhost -p 8080 ring&lt;br/&gt;
Address         Status State   Load            Token                                       &lt;br/&gt;
                                       113416112894748789872342756657008344878    &lt;br/&gt;
10.250.106.111  Up     Normal  116.3 GB        0                                           &lt;br/&gt;
10.215.195.81   Up     Normal  116.31 GB       56713727820156410577229101238628035242      &lt;br/&gt;
10.246.65.221   Up     Joining 7.63 KB         113416112894748789872342756657008344878     &lt;/p&gt;


&lt;p&gt;Here&apos;s the full boot trace of the node is trying to join:&lt;br/&gt;
Java HotSpot(TM) Client VM warning: Can&apos;t detect initial thread stack location - find_vma failed&lt;br/&gt;
Create RMI registry on port 8081&lt;br/&gt;
Get the platform&apos;s MBean server&lt;br/&gt;
Initialize the environment map&lt;br/&gt;
Create an RMI connector server&lt;br/&gt;
Start the RMI connector server on port 8081&lt;br/&gt;
 INFO 22:32:50,448 Loading settings from /etc/cassandra/cassandra.yaml&lt;br/&gt;
DEBUG 22:32:50,537 Syncing log with a period of 10000&lt;br/&gt;
 INFO 22:32:50,538 DiskAccessMode &apos;auto&apos; determined to be standard, indexAccessMode is standard&lt;br/&gt;
DEBUG 22:32:50,548 setting auto_bootstrap to true&lt;br/&gt;
DEBUG 22:32:50,702 Starting CFS Statistics&lt;br/&gt;
DEBUG 22:32:50,710 key cache capacity for Statistics is 1&lt;br/&gt;
DEBUG 22:32:50,711 Starting CFS Schema&lt;br/&gt;
DEBUG 22:32:50,712 key cache capacity for Schema is 1&lt;br/&gt;
DEBUG 22:32:50,712 Starting CFS Migrations&lt;br/&gt;
DEBUG 22:32:50,713 key cache capacity for Migrations is 1&lt;br/&gt;
DEBUG 22:32:50,713 Starting CFS LocationInfo&lt;br/&gt;
DEBUG 22:32:50,713 key cache capacity for LocationInfo is 1&lt;br/&gt;
DEBUG 22:32:50,714 Starting CFS HintsColumnFamily&lt;br/&gt;
DEBUG 22:32:50,714 key cache capacity for HintsColumnFamily is 1&lt;br/&gt;
 INFO 22:32:50,736 Couldn&apos;t detect any schema definitions in local storage.&lt;br/&gt;
 INFO 22:32:50,737 Found table data in data directories. Consider using JMX to call org.apache.cassandra.service.StorageService.loadSchemaFromYaml().&lt;br/&gt;
DEBUG 22:32:50,738 opening keyspace system&lt;br/&gt;
 INFO 22:32:50,757 Cassandra version: &lt;br/&gt;
 INFO 22:32:50,757 Thrift API version: 10.0.0&lt;br/&gt;
 INFO 22:32:50,758 Saved Token not found. Using 113416112894748789872342756657008344878&lt;br/&gt;
 INFO 22:32:50,758 Saved ClusterName not found. Using SOMETHING &lt;br/&gt;
 INFO 22:32:50,763 Creating new commitlog segment /mnt/cassandra/commitlog/CommitLog-1283553170763.log&lt;br/&gt;
DEBUG 22:32:50,767 Estimating compactions for LocationInfo&lt;br/&gt;
DEBUG 22:32:50,768 Estimating compactions for HintsColumnFamily&lt;br/&gt;
DEBUG 22:32:50,768 Estimating compactions for Migrations&lt;br/&gt;
DEBUG 22:32:50,768 Estimating compactions for Schema&lt;br/&gt;
DEBUG 22:32:50,768 Estimating compactions for Statistics&lt;br/&gt;
DEBUG 22:32:50,769 Checking to see if compaction of LocationInfo would be useful&lt;br/&gt;
DEBUG 22:32:50,769 Checking to see if compaction of HintsColumnFamily would be useful&lt;br/&gt;
DEBUG 22:32:50,769 Checking to see if compaction of Migrations would be useful&lt;br/&gt;
DEBUG 22:32:50,769 Checking to see if compaction of Schema would be useful&lt;br/&gt;
DEBUG 22:32:50,769 Checking to see if compaction of Statistics would be useful&lt;br/&gt;
 INFO 22:32:50,779 switching in a fresh Memtable for LocationInfo at CommitLogContext(file=&apos;/mnt/cassandra/commitlog/CommitLog-1283553170763.log&apos;, position=276)&lt;br/&gt;
 INFO 22:32:50,782 Enqueuing flush of Memtable-LocationInfo@18721294(192 bytes, 4 operations)&lt;br/&gt;
 INFO 22:32:50,783 Writing Memtable-LocationInfo@18721294(192 bytes, 4 operations)&lt;br/&gt;
 INFO 22:32:50,897 Completed flushing /mnt/ebs/data/system/LocationInfo-e-1-Data.db&lt;br/&gt;
DEBUG 22:32:50,898 Checking to see if compaction of LocationInfo would be useful&lt;br/&gt;
DEBUG 22:32:50,898 Discarding 0&lt;br/&gt;
DEBUG 22:32:50,899 discard completed log segments for CommitLogContext(file=&apos;/mnt/cassandra/commitlog/CommitLog-1283553170763.log&apos;, position=276), column family 0.&lt;br/&gt;
DEBUG 22:32:50,899 Marking replay position 276 on commit log CommitLogSegment(/mnt/cassandra/commitlog/CommitLog-1283553170763.log)&lt;br/&gt;
 INFO 22:32:50,908 Starting up server gossip&lt;br/&gt;
 INFO 22:32:50,928 Joining: getting load information&lt;br/&gt;
 INFO 22:32:50,928 Sleeping 90000 ms to wait for load information...&lt;br/&gt;
DEBUG 22:32:50,940 attempting to connect to node1-1.domain.com/10.250.106.111&lt;br/&gt;
DEBUG 22:32:51,044 attempting to connect to node1-1.domain.com/10.250.106.111&lt;br/&gt;
DEBUG 22:32:51,045 attempting to connect to /10.215.195.81&lt;br/&gt;
 INFO 22:32:51,051 Node /10.215.195.81 is now part of the cluster&lt;br/&gt;
DEBUG 22:32:51,051 Resetting pool for /10.215.195.81&lt;br/&gt;
DEBUG 22:32:51,052 Token 113416112894748789872342756657008344877 removed manually (endpoint was unknown)&lt;br/&gt;
 INFO 22:32:51,052 Node /10.250.106.111 is now part of the cluster&lt;br/&gt;
DEBUG 22:32:51,053 Resetting pool for /10.250.106.111&lt;br/&gt;
DEBUG 22:32:51,053 Node /10.250.106.111 state normal, token 0&lt;br/&gt;
DEBUG 22:32:51,053 clearing cached endpoints&lt;br/&gt;
DEBUG 22:32:51,171 Applying AddKeyspace from /10.250.106.111&lt;br/&gt;
DEBUG 22:32:51,188 Applying migration 77e97d6c-b625-11df-8596-318df8b646e8&lt;br/&gt;
 INFO 22:32:51,189 switching in a fresh Memtable for Migrations at CommitLogContext(file=&apos;/mnt/cassandra/commitlog/CommitLog-1283553170763.log&apos;, position=7417)&lt;br/&gt;
 INFO 22:32:51,189 Enqueuing flush of Memtable-Migrations@18093512(4938 bytes, 1 operations)&lt;br/&gt;
 INFO 22:32:51,189 Writing Memtable-Migrations@18093512(4938 bytes, 1 operations)&lt;br/&gt;
 INFO 22:32:51,194 switching in a fresh Memtable for Schema at CommitLogContext(file=&apos;/mnt/cassandra/commitlog/CommitLog-1283553170763.log&apos;, position=7417)&lt;br/&gt;
 INFO 22:32:51,194 Enqueuing flush of Memtable-Schema@27402470(1784 bytes, 3 operations)&lt;br/&gt;
 INFO 22:32:51,274 Completed flushing /mnt/ebs/data/system/Migrations-e-1-Data.db&lt;br/&gt;
DEBUG 22:32:51,274 Checking to see if compaction of Migrations would be useful&lt;br/&gt;
DEBUG 22:32:51,275 Discarding 2&lt;br/&gt;
DEBUG 22:32:51,275 discard completed log segments for CommitLogContext(file=&apos;/mnt/cassandra/commitlog/CommitLog-1283553170763.log&apos;, position=7417), column family 2&lt;br/&gt;
.&lt;br/&gt;
DEBUG 22:32:51,275 Marking replay position 7417 on commit log CommitLogSegment(/mnt/cassandra/commitlog/CommitLog-1283553170763.log)&lt;br/&gt;
 INFO 22:32:51,275 Writing Memtable-Schema@27402470(1784 bytes, 3 operations)&lt;br/&gt;
 INFO 22:32:51,388 Completed flushing /mnt/ebs/data/system/Schema-e-1-Data.db&lt;br/&gt;
DEBUG 22:32:51,389 Checking to see if compaction of Schema would be useful&lt;br/&gt;
DEBUG 22:32:51,389 Discarding 3&lt;br/&gt;
DEBUG 22:32:51,389 discard completed log segments for CommitLogContext(file=&apos;/mnt/cassandra/commitlog/CommitLog-1283553170763.log&apos;, position=7417), column family 3&lt;br/&gt;
.&lt;br/&gt;
DEBUG 22:32:51,389 Marking replay position 7417 on commit log CommitLogSegment(/mnt/cassandra/commitlog/CommitLog-1283553170763.log)&lt;br/&gt;
DEBUG 22:32:51,406 Starting CFS MyColumnFamily&lt;br/&gt;
DEBUG 22:32:51,406 key cache capacity for MyColumnFamily is 200000&lt;br/&gt;
 INFO 22:32:51,407 Creating new commitlog segment /mnt/cassandra/commitlog/CommitLog-1283553171407.log&lt;br/&gt;
DEBUG 22:32:51,604 attempting to connect to node1-1.domain.com/10.250.106.111&lt;br/&gt;
 INFO 22:32:51,622 InetAddress /10.215.195.81 is now UP&lt;br/&gt;
 INFO 22:32:51,623 InetAddress /10.250.106.111 is now UP&lt;br/&gt;
 INFO 22:32:51,623 Started hinted handoff for endpoint /10.215.195.81&lt;br/&gt;
 INFO 22:32:51,631 Finished hinted handoff of 0 rows to endpoint /10.215.195.81&lt;br/&gt;
 INFO 22:32:51,632 Started hinted handoff for endpoint /10.250.106.111&lt;br/&gt;
 INFO 22:32:51,632 Finished hinted handoff of 0 rows to endpoint /10.250.106.111&lt;br/&gt;
DEBUG 22:32:51,918 GC for ParNew: 14 ms, 20561696 reclaimed leaving 149257720 used; max is 902627328&lt;br/&gt;
DEBUG 22:32:51,919 GC for ConcurrentMarkSweep: 73 ms, 4178480 reclaimed leaving 8520856 used; max is 902627328&lt;br/&gt;
DEBUG 22:32:52,924 Disseminating load info ...&lt;br/&gt;
DEBUG 22:32:53,929 attempting to connect to /10.215.195.81&lt;br/&gt;
DEBUG 22:32:54,925 GC for ConcurrentMarkSweep: 73 ms, 212034048 reclaimed leaving 15214608 used; max is 902627328&lt;br/&gt;
DEBUG 22:33:52,931 Disseminating load info ...&lt;br/&gt;
DEBUG 22:34:20,929 ... got load info&lt;br/&gt;
 INFO 22:34:20,929 Joining: getting bootstrap token&lt;br/&gt;
DEBUG 22:34:20,931 token manually specified as 113416112894748789872342756657008344878&lt;br/&gt;
 INFO 22:34:20,932 Joining: sleeping 30000 ms for pending range setup&lt;br/&gt;
 INFO 22:34:50,935 Bootstrapping&lt;br/&gt;
DEBUG 22:34:50,935 Beginning bootstrap process&lt;br/&gt;
java.lang.reflect.InvocationTargetException&lt;br/&gt;
        at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)&lt;br/&gt;
        at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)&lt;br/&gt;
        at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)&lt;br/&gt;
        at java.lang.reflect.Method.invoke(Method.java:597)&lt;br/&gt;
        at org.apache.commons.daemon.support.DaemonLoader.load(DaemonLoader.java:160)&lt;br/&gt;
Caused by: java.lang.IllegalStateException: replication factor (2) exceeds number of endpoints (1)&lt;br/&gt;
        at org.apache.cassandra.locator.RackUnawareStrategy.calculateNaturalEndpoints(RackUnawareStrategy.java:57)&lt;br/&gt;
        at org.apache.cassandra.locator.AbstractReplicationStrategy.getRangeAddresses(AbstractReplicationStrategy.java:195)&lt;br/&gt;
        at org.apache.cassandra.dht.BootStrapper.getRangesWithSources(BootStrapper.java:155)&lt;br/&gt;
        at org.apache.cassandra.dht.BootStrapper.startBootstrap(BootStrapper.java:73)&lt;br/&gt;
        at org.apache.cassandra.service.StorageService.startBootstrap(StorageService.java:467)&lt;br/&gt;
        at org.apache.cassandra.service.StorageService.initServer(StorageService.java:408)&lt;br/&gt;
        at org.apache.cassandra.thrift.CassandraDaemon.setup(CassandraDaemon.java:134)&lt;br/&gt;
        at org.apache.cassandra.service.AbstractCassandraDaemon.init(AbstractCassandraDaemon.java:57)&lt;br/&gt;
        ... 5 more&lt;br/&gt;
Cannot load daemon&lt;br/&gt;
Service exit with a return value of 3&lt;/p&gt;</description>
                <environment>&lt;p&gt;I&apos;m using 0.7 beta1. Built from: &lt;a href=&quot;http://www.apache.org/dyn/closer.cgi?path=/cassandra/0.7.0/apache-cassandra-0.7.0-beta1-src.tar.gz&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://www.apache.org/dyn/closer.cgi?path=/cassandra/0.7.0/apache-cassandra-0.7.0-beta1-src.tar.gz&lt;/a&gt;  using dpkg-buildpackage from it.&lt;/p&gt;</environment>
        <key id="12473291">CASSANDRA-1467</key>
            <summary>replication factor exceeds number of endpoints, when attempting to join a new node (but cluster has enough running nodes to fulfill RF)</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10002" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Normal</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="gdusbabek">Gary Dusbabek</assignee>
                                    <reporter username="blanquer">Josep M. Blanquer</reporter>
                        <labels>
                    </labels>
                <created>Fri, 3 Sep 2010 23:24:17 +0000</created>
                <updated>Tue, 16 Apr 2019 09:33:17 +0000</updated>
                            <resolved>Mon, 13 Sep 2010 16:11:49 +0000</resolved>
                                        <fixVersion>0.6.6</fixVersion>
                    <fixVersion>0.7 beta 2</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                                                                <comments>
                            <comment id="12906181" author="gdusbabek" created="Fri, 3 Sep 2010 23:58:46 +0000"  >&lt;p&gt;Did the node you were trying to bootstrap already have schema defined?&lt;/p&gt;</comment>
                            <comment id="12906187" author="blanquer" created="Sat, 4 Sep 2010 00:23:39 +0000"  >&lt;p&gt;No, it was a blank node. &lt;br/&gt;
I&apos;ve just wiped the data and commit log dirs clean, and restarted cassandra again with the same result.&lt;/p&gt;

&lt;p&gt;Here&apos;s the start of the system.log:&lt;br/&gt;
 INFO &lt;span class=&quot;error&quot;&gt;&amp;#91;main&amp;#93;&lt;/span&gt; 2010-09-04 00:19:19,744 DatabaseDescriptor.java (line 120) Loading settings from /etc/cassandra/cassandra.yaml&lt;br/&gt;
DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;main&amp;#93;&lt;/span&gt; 2010-09-04 00:19:19,923 DatabaseDescriptor.java (line 163) Syncing log with a period of 10000&lt;br/&gt;
 INFO &lt;span class=&quot;error&quot;&gt;&amp;#91;main&amp;#93;&lt;/span&gt; 2010-09-04 00:19:19,923 DatabaseDescriptor.java (line 171) DiskAccessMode &apos;auto&apos; determined to be standard, indexAccessMode is standard&lt;br/&gt;
DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;main&amp;#93;&lt;/span&gt; 2010-09-04 00:19:19,933 DatabaseDescriptor.java (line 311) setting auto_bootstrap to true&lt;br/&gt;
DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;main&amp;#93;&lt;/span&gt; 2010-09-04 00:19:20,122 ColumnFamilyStore.java (line 149) Starting CFS Statistics&lt;br/&gt;
DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;main&amp;#93;&lt;/span&gt; 2010-09-04 00:19:20,188 SSTableTracker.java (line 110) key cache capacity for Statistics is 1&lt;br/&gt;
DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;main&amp;#93;&lt;/span&gt; 2010-09-04 00:19:20,189 ColumnFamilyStore.java (line 149) Starting CFS Schema&lt;br/&gt;
DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;main&amp;#93;&lt;/span&gt; 2010-09-04 00:19:20,190 SSTableTracker.java (line 110) key cache capacity for Schema is 1&lt;br/&gt;
DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;main&amp;#93;&lt;/span&gt; 2010-09-04 00:19:20,191 ColumnFamilyStore.java (line 149) Starting CFS Migrations&lt;br/&gt;
DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;main&amp;#93;&lt;/span&gt; 2010-09-04 00:19:20,191 SSTableTracker.java (line 110) key cache capacity for Migrations is 1&lt;br/&gt;
DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;main&amp;#93;&lt;/span&gt; 2010-09-04 00:19:20,191 ColumnFamilyStore.java (line 149) Starting CFS LocationInfo&lt;br/&gt;
DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;main&amp;#93;&lt;/span&gt; 2010-09-04 00:19:20,192 SSTableTracker.java (line 110) key cache capacity for LocationInfo is 1&lt;br/&gt;
DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;main&amp;#93;&lt;/span&gt; 2010-09-04 00:19:20,193 ColumnFamilyStore.java (line 149) Starting CFS HintsColumnFamily&lt;br/&gt;
DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;main&amp;#93;&lt;/span&gt; 2010-09-04 00:19:20,193 SSTableTracker.java (line 110) key cache capacity for HintsColumnFamily is 1&lt;br/&gt;
 INFO &lt;span class=&quot;error&quot;&gt;&amp;#91;main&amp;#93;&lt;/span&gt; 2010-09-04 00:19:20,223 DatabaseDescriptor.java (line 442) &lt;b&gt;Couldn&apos;t detect any schema definitions in local storage.&lt;/b&gt;&lt;br/&gt;
 INFO &lt;span class=&quot;error&quot;&gt;&amp;#91;main&amp;#93;&lt;/span&gt; 2010-09-04 00:19:20,224 DatabaseDescriptor.java (line 468) Found table data in data directories. Consider using JMX to call org.apache.cassandra.service.StorageService.loadSchemaFromYaml().&lt;br/&gt;
DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;main&amp;#93;&lt;/span&gt; 2010-09-04 00:19:20,227 CassandraDaemon.java (line 115) opening keyspace system&lt;br/&gt;
 INFO &lt;span class=&quot;error&quot;&gt;&amp;#91;main&amp;#93;&lt;/span&gt; 2010-09-04 00:19:20,247 StorageService.java (line 342) Cassandra version:&lt;br/&gt;
 INFO &lt;span class=&quot;error&quot;&gt;&amp;#91;main&amp;#93;&lt;/span&gt; 2010-09-04 00:19:20,247 StorageService.java (line 343) Thrift API version: 10.0.0&lt;br/&gt;
 INFO &lt;span class=&quot;error&quot;&gt;&amp;#91;main&amp;#93;&lt;/span&gt; 2010-09-04 00:19:20,248 SystemTable.java (line 202) Saved Token not found. Using 113416112894748789872342756657008344878&lt;br/&gt;
 INFO &lt;span class=&quot;error&quot;&gt;&amp;#91;main&amp;#93;&lt;/span&gt; 2010-09-04 00:19:20,249 SystemTable.java (line 208) Saved ClusterName not found. ......&lt;/p&gt;</comment>
                            <comment id="12906979" author="gdusbabek" created="Tue, 7 Sep 2010 21:30:08 +0000"  >&lt;p&gt;It took some trying, but I can reproduce this now.&lt;/p&gt;</comment>
                            <comment id="12907671" author="gdusbabek" created="Thu, 9 Sep 2010 16:21:52 +0000"  >&lt;p&gt;Reproduced in 0.6 (mostly).  The bootstrap still happens because we don&apos;t enforce the RF restriction that we do now.  When the fourth node is brought up and bootstrapped, it sees the the ring minus the coordinator node from the removetoken operation.&lt;/p&gt;

&lt;p&gt;I&apos;ve got a patch worked up for trunk.  I&apos;ll port it to 0.6 and attach shortly.&lt;/p&gt;</comment>
                            <comment id="12907718" author="gdusbabek" created="Thu, 9 Sep 2010 18:31:52 +0000"  >&lt;p&gt;The first two patches are housekeeping.  Exposing the endpoint states via jmx was helpful for troubleshooting.&lt;br/&gt;
The third patch changes gossip so that the removetoken information is broadcast as part of a MOVE,NORMAL instead of MOVE,LEFT.  This means that we no longer have to distinguish between MOVE,LEFT,leaving and MOVE,LEFT,removetoken, so I removed that distinction.  &lt;/p&gt;

&lt;p&gt;Valid MOVE operations are now these:&lt;br/&gt;
MOVE,NORMAL,token&lt;span class=&quot;error&quot;&gt;&amp;#91;,&amp;lt;other command&amp;gt;,&amp;lt;other token&amp;gt;&amp;#93;&lt;/span&gt;&lt;br/&gt;
MOVE,LEFT,token&lt;br/&gt;
MOVE,BOOTSTRAPPING,token&lt;br/&gt;
MOVE,LEAVING,token&lt;/p&gt;

&lt;p&gt;If this patch goes into 0.6 as is, it alters gossip enough so that if a removetoken, decommission or loadbalance are in progress during the rolling upgrade, bad things might happen (the wrong handlers could be called).&lt;/p&gt;</comment>
                            <comment id="12907786" author="gdusbabek" created="Thu, 9 Sep 2010 21:09:38 +0000"  >&lt;p&gt;comments MOVE state transitions.&lt;/p&gt;</comment>
                            <comment id="12908802" author="jbellis" created="Mon, 13 Sep 2010 14:25:00 +0000"  >&lt;p&gt;+1&lt;/p&gt;</comment>
                            <comment id="12908843" author="gdusbabek" created="Mon, 13 Sep 2010 16:11:48 +0000"  >&lt;p&gt;committed 0.6 and trunk (0.7)&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12454241" name="1467-0.6.txt" size="17797" author="gdusbabek" created="Thu, 9 Sep 2010 21:09:38 +0000"/>
                            <attachment id="12454238" name="ASF.LICENSE.NOT.GRANTED--v1-0001-expose-endpoint-states-to-jmx.txt" size="1930" author="gdusbabek" created="Thu, 9 Sep 2010 21:07:06 +0000"/>
                            <attachment id="12454239" name="ASF.LICENSE.NOT.GRANTED--v1-0002-remove-unused-code-from-SLB.txt" size="981" author="gdusbabek" created="Thu, 9 Sep 2010 21:07:06 +0000"/>
                            <attachment id="12454240" name="ASF.LICENSE.NOT.GRANTED--v1-0003-broadcast-removetoken-using-MOVE-NORMAL-to-preserve-th.txt" size="18789" author="gdusbabek" created="Thu, 9 Sep 2010 21:07:06 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>4.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[gdusbabek]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>20157</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            15 years, 11 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0g58n:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>92279</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>jbellis</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[jbellis]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12962"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>