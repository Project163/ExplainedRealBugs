<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 22:29:16 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-2851] hex-to-bytes conversion accepts invalid inputs silently</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-2851</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;FBUtilities.hexToBytes() has a minor bug - it copes with single-character inputs by prepending &quot;0&quot;, which is OK - but it does this for any input with an odd number of characters, which is probably incorrect.&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;if (str.length() % 2 == 1)
    str = &quot;0&quot; + str;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Given &apos;fff&apos; as an input, can we really assume that this should be &apos;0fff&apos;? Isn&apos;t this just an error?&lt;/p&gt;

&lt;p&gt;Add the following to FBUtilitiesTest to demonstrate:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;String[] badvalues = new String[]{&quot;000&quot;, &quot;fff&quot;};
       
for (int i = 0; i &amp;lt; badvalues.length; i++)
    try
    {
        FBUtilities.hexToBytes(badvalues[i]);
        fail(&quot;Invalid hex value accepted&quot;+badvalues[i]);
    } catch (Exception e){}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="12512673">CASSANDRA-2851</key>
            <summary>hex-to-bytes conversion accepts invalid inputs silently</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10003" iconUrl="https://issues.apache.org/jira/images/icons/priorities/trivial.svg">Low</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="slebresne">Sylvain Lebresne</assignee>
                                    <reporter username="dallsopp">David Allsopp</reporter>
                        <labels>
                    </labels>
                <created>Sun, 3 Jul 2011 18:04:35 +0000</created>
                <updated>Tue, 16 Apr 2019 09:32:56 +0000</updated>
                            <resolved>Fri, 10 Feb 2012 19:15:15 +0000</resolved>
                                        <fixVersion>1.1.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                                                                <comments>
                            <comment id="13059246" author="dallsopp" created="Sun, 3 Jul 2011 18:12:28 +0000"  >&lt;p&gt;In addition to the invalid values, should probably also add a check in FBUtilitiesTest.testHexToBytesStringConversion() that &quot;&quot; is converted to byte&lt;span class=&quot;error&quot;&gt;&amp;#91;0&amp;#93;&lt;/span&gt;, and that a null input is handled appropriately.&lt;/p&gt;
</comment>
                            <comment id="13059262" author="dallsopp" created="Sun, 3 Jul 2011 19:12:54 +0000"  >&lt;p&gt;If there&apos;s agreement that odd-sized inputs should throw an exception, the attached patch does this and updates the unit test.&lt;/p&gt;</comment>
                            <comment id="13059362" author="slebresne" created="Mon, 4 Jul 2011 08:57:13 +0000"  >&lt;p&gt;Why would it be ok for single-character inputs and not other odd-sized inputs ? An odd-sized input doesn&apos;t (ever) correspond to a valid byte array, so I&apos;d say either we always silently add a 0 to &quot;make it fit&quot; or we never do it. I do actually am in favor of throwing an exception rather then coping with it silently since it&apos;s more likely to indicate a user error than to be helpful (but maybe that addition of a &apos;0&apos; in front was there for a reason?).&lt;br/&gt;
I&apos;ll note that even though I can&apos;t imagine why people would generate odd-sized hex input, since it is allowed so far, there is a chance someone out there does it, and it would be a &quot;regression&quot; for that guy. So maybe we should target 1.0 for the sake of making minor upgrade as smooth for everybody as can be.&lt;/p&gt;

&lt;p&gt;On the patch side, we must make sure every consumer of hexToBytes() handles the new exception (or make it a NumberFormatException but I don&apos;t think this is a good idea). For instance, at least BytesType.fromString() should catch the IllegalArgumentException and rethrow a MarshalException, otherwise CQL will crap his pants on odd-sized inputs.&lt;/p&gt;</comment>
                            <comment id="13059413" author="jbellis" created="Mon, 4 Jul 2011 12:35:29 +0000"  >&lt;blockquote&gt;&lt;p&gt;maybe that addition of a &apos;0&apos; in front was there for a reason&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I think it&apos;s there b/c of Integer.toHexString: &quot;This value is converted to a string of ASCII digits in hexadecimal (base 16) with no extra leading 0s.&quot;&lt;/p&gt;

&lt;p&gt;Our bytesToHex does pad... but only for single-digit results.  So if we fix hexToBytes we&apos;ll introduce an incompatibility. (Granted, a minor one.)&lt;/p&gt;</comment>
                            <comment id="13059484" author="slebresne" created="Mon, 4 Jul 2011 15:35:21 +0000"  >&lt;blockquote&gt;&lt;p&gt;Our bytesToHex does pad... but only for single-digit results. So if we fix hexToBytes we&apos;ll introduce an incompatibility. (Granted, a minor one.)&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I don&apos;t understand. There is no such thing as padding when you convert a byte array to hex (Integer.toHexString does return only the right number of hexadecimal digits because it has no reason to do otherwise, but it&apos;s an implementation detail of bytesToHex). A byte is always 8 bit, never 4, and the output of bytesToHex will &lt;b&gt;always&lt;/b&gt; have a even number of characters (as it should). Our hexToBytes just happen to semi-randomly add 0 in front to transform a buggy input with an odd number of character to a even one, in the off chance that a client used the (stupid) &quot;optimization&quot; of removing at most 1 leading 0 to win some space or something. In my opinion, it would be better to simply refuse odd sized input because this is more likely a truncated input (and people using stupid clients should fix them, though I&apos;m ok with saying that we&apos;ll force them to fix it only on a major upgrade).&lt;/p&gt;</comment>
                            <comment id="13059500" author="jbellis" created="Mon, 4 Jul 2011 16:16:03 +0000"  >&lt;p&gt;You&apos;re right, I was misreading how we were using Integer.toHexString.&lt;/p&gt;</comment>
                            <comment id="13059526" author="dallsopp" created="Mon, 4 Jul 2011 17:51:27 +0000"  >&lt;p&gt;The origin of the current behaviour is &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-1411&quot; title=&quot;FBUtilities.hexToBytes() doesn&amp;#39;t accommodate odd-length strings.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-1411&quot;&gt;&lt;del&gt;CASSANDRA-1411&lt;/del&gt;&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-1411&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/CASSANDRA-1411&lt;/a&gt; if that helps...&lt;/p&gt;
</comment>
                            <comment id="13059582" author="jbellis" created="Mon, 4 Jul 2011 19:18:51 +0000"  >&lt;p&gt;Good point, David.&lt;/p&gt;

&lt;p&gt;Sounds like the problem is thinking of this as a generic hex conversion function, rather than as &quot;hex that specifically represents bytes.&quot;&lt;/p&gt;</comment>
                            <comment id="13100184" author="slebresne" created="Thu, 8 Sep 2011 09:48:18 +0000"  >&lt;blockquote&gt;&lt;p&gt;Sounds like the problem is thinking of this as a generic hex conversion function, rather than as &quot;hex that specifically represents bytes.&quot;&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Well, in a way those methods never pretended being generic hex to &lt;b&gt;bits&lt;/b&gt; conversion functions since they are called hex2bytes and bytes2hex. I still think that the correct behavior for hex2bytes is to throw an exception on odd sized input. And that &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-1411&quot; title=&quot;FBUtilities.hexToBytes() doesn&amp;#39;t accommodate odd-length strings.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-1411&quot;&gt;&lt;del&gt;CASSANDRA-1411&lt;/del&gt;&lt;/a&gt; was a mistake: yes I understand that it&apos;s annoying the first time you use &apos;0&apos; as token to get an exception and to have to write &apos;00&apos;, but if you had written &apos;0&apos;, there is a good chance you had missed the meaning of the input, i.e that it is  an hex string representing a byte array.&lt;/p&gt;

&lt;p&gt;Now changing that behavior would not be backward compatible, so I wonder if we really should do anything here. I would be in favor however to refactor the code slightly so that hex2bytes do throw an exception on odd sized input (it would be fine if the method was named hex2bits, but it&apos;s fishy with hex2bytes) and to move the code that pads the input into ByteOrderedPartitioner, since that is what it was meant to: simplify the input of tokens.&lt;/p&gt;</comment>
                            <comment id="13100287" author="jbellis" created="Thu, 8 Sep 2011 13:03:20 +0000"  >&lt;p&gt;That sounds reasonable.&lt;/p&gt;</comment>
                            <comment id="13103513" author="dallsopp" created="Tue, 13 Sep 2011 10:32:09 +0000"  >&lt;p&gt;Sounds good to me - I agree the underlying conversion should be strict to&lt;br/&gt;
avoid inadvertent misuse and hidden bugs in future - with a more lenient&lt;br/&gt;
wrapper for specific cases and backward compatibility.&lt;/p&gt;

</comment>
                            <comment id="13205368" author="slebresne" created="Fri, 10 Feb 2012 11:30:55 +0000"  >&lt;p&gt;Attaching patch that implements the idea above, i.e. hexToBytes throw an exception on odd number of input characters, but silently adds a &apos;0&apos; in front when parsing a token for an ordered partitioner.&lt;/p&gt;

&lt;p&gt;This does mean BytesType will throw a MarshalException when given a string of odd length. I think it is a good thing, it was a but that we were potentially silently adding some zeroes to column names or values given by the user. However, this does kind of break some form of backward compatibility so I suppose we should either push it for 1.1.0 or report to 1.2. I personally would be good for 1.1.0 (I consider the current behavior a bug) but I won&apos;t argue if someone prefers 1.2.&lt;/p&gt;</comment>
                            <comment id="13205455" author="jbellis" created="Fri, 10 Feb 2012 13:44:15 +0000"  >&lt;p&gt;+1 for 1.1.0 from me&lt;/p&gt;</comment>
                            <comment id="13205657" author="slebresne" created="Fri, 10 Feb 2012 19:15:15 +0000"  >&lt;p&gt;Ok, committed to 1.1.0. We&apos;ll revert if someone feels strongly this is a violation of the freeze.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12514100" name="2851.patch" size="3921" author="slebresne" created="Fri, 10 Feb 2012 11:30:55 +0000"/>
                            <attachment id="12485099" name="cassandra-2851.diff" size="2237" author="dallsopp" created="Sun, 3 Jul 2011 19:12:54 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[slebresne]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>20865</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            13 years, 41 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0gduf:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>93673</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>jbellis</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[jbellis]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12961"><![CDATA[Low]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>