<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 22:50:58 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-8716] &quot;java.util.concurrent.ExecutionException: java.lang.AssertionError: Memory was freed&quot; when running cleanup</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-8716</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;Error occurred during cleanup
java.util.concurrent.ExecutionException: java.lang.AssertionError: Memory was freed
        at java.util.concurrent.FutureTask.report(FutureTask.java:122)
        at java.util.concurrent.FutureTask.get(FutureTask.java:188)
        at org.apache.cassandra.db.compaction.CompactionManager.performAllSSTableOperation(CompactionManager.java:234)
        at org.apache.cassandra.db.compaction.CompactionManager.performCleanup(CompactionManager.java:272)
        at org.apache.cassandra.db.ColumnFamilyStore.forceCleanup(ColumnFamilyStore.java:1115)
        at org.apache.cassandra.service.StorageService.forceKeyspaceCleanup(StorageService.java:2177)
        at sun.reflect.GeneratedMethodAccessor29.invoke(Unknown Source)
        at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
        at java.lang.reflect.Method.invoke(Method.java:606)
        at sun.reflect.misc.Trampoline.invoke(MethodUtil.java:75)
        at sun.reflect.GeneratedMethodAccessor8.invoke(Unknown Source)
        at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
        at java.lang.reflect.Method.invoke(Method.java:606)
        at sun.reflect.misc.MethodUtil.invoke(MethodUtil.java:279)
        at com.sun.jmx.mbeanserver.StandardMBeanIntrospector.invokeM2(StandardMBeanIntrospector.java:112)
        at com.sun.jmx.mbeanserver.StandardMBeanIntrospector.invokeM2(StandardMBeanIntrospector.java:46)
        at com.sun.jmx.mbeanserver.MBeanIntrospector.invokeM(MBeanIntrospector.java:237)
        at com.sun.jmx.mbeanserver.PerInterface.invoke(PerInterface.java:138)
        at com.sun.jmx.mbeanserver.MBeanSupport.invoke(MBeanSupport.java:252)
        at com.sun.jmx.interceptor.DefaultMBeanServerInterceptor.invoke(DefaultMBeanServerInterceptor.java:819)
        at com.sun.jmx.mbeanserver.JmxMBeanServer.invoke(JmxMBeanServer.java:801)
        at javax.management.remote.rmi.RMIConnectionImpl.doOperation(RMIConnectionImpl.java:1487)
        at javax.management.remote.rmi.RMIConnectionImpl.access$300(RMIConnectionImpl.java:97)
        at javax.management.remote.rmi.RMIConnectionImpl$PrivilegedOperation.run(RMIConnectionImpl.java:1328)
        at javax.management.remote.rmi.RMIConnectionImpl.doPrivilegedOperation(RMIConnectionImpl.java:1420)
        at javax.management.remote.rmi.RMIConnectionImpl.invoke(RMIConnectionImpl.java:848)
        at sun.reflect.GeneratedMethodAccessor23.invoke(Unknown Source)
        at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
        at java.lang.reflect.Method.invoke(Method.java:606)
        at sun.rmi.server.UnicastServerRef.dispatch(UnicastServerRef.java:322)
        at sun.rmi.transport.Transport$1.run(Transport.java:177)
        at sun.rmi.transport.Transport$1.run(Transport.java:174)
        at java.security.AccessController.doPrivileged(Native Method)
        at sun.rmi.transport.Transport.serviceCall(Transport.java:173)
        at sun.rmi.transport.tcp.TCPTransport.handleMessages(TCPTransport.java:556)
        at sun.rmi.transport.tcp.TCPTransport$ConnectionHandler.run0(TCPTransport.java:811)
        at sun.rmi.transport.tcp.TCPTransport$ConnectionHandler.run(TCPTransport.java:670)
        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1145)
        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:615)
        at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:745)
Caused by: java.lang.AssertionError: Memory was freed
        at org.apache.cassandra.io.util.Memory.checkPosition(Memory.java:259)
        at org.apache.cassandra.io.util.Memory.getInt(Memory.java:211)
        at org.apache.cassandra.io.sstable.IndexSummary.getIndex(IndexSummary.java:79)
        at org.apache.cassandra.io.sstable.IndexSummary.getKey(IndexSummary.java:84)
        at org.apache.cassandra.io.sstable.IndexSummary.binarySearch(IndexSummary.java:58)
        at org.apache.cassandra.io.sstable.SSTableReader.getIndexScanPosition(SSTableReader.java:602)
        at org.apache.cassandra.io.sstable.SSTableReader.getPosition(SSTableReader.java:947)
        at org.apache.cassandra.io.sstable.SSTableReader.getPosition(SSTableReader.java:910)
        at org.apache.cassandra.io.sstable.SSTableReader.getPositionsForRanges(SSTableReader.java:819)
        at org.apache.cassandra.db.ColumnFamilyStore.getExpectedCompactedFileSize(ColumnFamilyStore.java:1088)
        at org.apache.cassandra.db.compaction.CompactionManager.doCleanupCompaction(CompactionManager.java:564)
        at org.apache.cassandra.db.compaction.CompactionManager.access$400(CompactionManager.java:63)
        at org.apache.cassandra.db.compaction.CompactionManager$5.perform(CompactionManager.java:281)
        at org.apache.cassandra.db.compaction.CompactionManager$2.call(CompactionManager.java:225)
        at java.util.concurrent.FutureTask.run(FutureTask.java:262)
        ... 3 more&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;


&lt;p&gt;The error continue to happen even after scrub.&lt;br/&gt;
If I retry a few time, it may run successfully.&lt;br/&gt;
I am attaching the server log.&lt;/p&gt;</description>
                <environment>&lt;p&gt;Centos 6.6, Cassandra 2.0.12, Oracle JDK 1.7.0_67&lt;/p&gt;</environment>
        <key id="12771726">CASSANDRA-8716</key>
            <summary>&quot;java.util.concurrent.ExecutionException: java.lang.AssertionError: Memory was freed&quot; when running cleanup</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10003" iconUrl="https://issues.apache.org/jira/images/icons/priorities/trivial.svg">Low</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="snazy">Robert Stupp</assignee>
                                    <reporter username="imriz">Imri Zvik</reporter>
                        <labels>
                            <label>qa-resolved</label>
                    </labels>
                <created>Mon, 2 Feb 2015 13:32:58 +0000</created>
                <updated>Tue, 16 Apr 2019 09:31:22 +0000</updated>
                            <resolved>Tue, 17 Feb 2015 16:29:38 +0000</resolved>
                                        <fixVersion>2.0.13</fixVersion>
                                        <due></due>
                            <votes>1</votes>
                                    <watches>11</watches>
                                                                                                                <comments>
                            <comment id="14302728" author="philipthompson" created="Tue, 3 Feb 2015 03:33:05 +0000"  >&lt;p&gt;I can reproduce this very easily with java 1.7.0_67. It&apos;s just a matter of creating a 2.0.12 node with ccm, writing with stress and flushing, bootstrapping a second node, then running cleanup.&lt;/p&gt;

&lt;p&gt;Could this be related to &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-8718&quot; title=&quot;nodetool cleanup causes segfault&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-8718&quot;&gt;&lt;del&gt;CASSANDRA-8718&lt;/del&gt;&lt;/a&gt;?&lt;/p&gt;

&lt;p&gt;EDIT: I can confirm the issue is intermittent. I am opening a PR for a dtest for this issue. &lt;/p&gt;</comment>
                            <comment id="14307738" author="benedict" created="Thu, 5 Feb 2015 18:43:01 +0000"  >&lt;p&gt;Could we get a git bisect on this to help narrow it down?&lt;/p&gt;</comment>
                            <comment id="14321232" author="mishail" created="Sat, 14 Feb 2015 04:49:35 +0000"  >&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;8b5cf64043e2d002fdb91921319110911e332042 is the first bad commit
commit 8b5cf64043e2d002fdb91921319110911e332042
Author: Robert Stupp &amp;lt;snazy@snazy.de&amp;gt;
Date:   Tue Nov 25 19:45:34 2014 -0600

    Backport CASSANDRA-7386

:100644 100644 7519653816322c2cd744b0d11f89caebd7ded42a 937edbbd3ccbcc5402c80a3726bd4520c239c7a3 M	CHANGES.txt
:040000 040000 edcbc884d4b693cdaae047eec650035140c35cd2 c1a1d00be8b2f32a283ba9522a5e7829a956481a M	src
:040000 040000 2b6dba89cdf5bd19bf0f4feadc49fcca0f7a7c5f 1e8e1b958fcd16630758b8a9a900c5f8e01602c6 M	test
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="14321323" author="snazy" created="Sat, 14 Feb 2015 09:56:09 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=philipthompson&quot; class=&quot;user-hover&quot; rel=&quot;philipthompson&quot;&gt;philipthompson&lt;/a&gt; can you check that against current cassandra-2.1 branch as well?&lt;/p&gt;</comment>
                            <comment id="14321328" author="snazy" created="Sat, 14 Feb 2015 10:06:15 +0000"  >&lt;p&gt;I suspect &lt;tt&gt;CompactionManager.doCleanupCompaction&lt;/tt&gt; at line&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;File compactionFileLocation = cfs.directories.getWriteableLocationAsFile(cfs.getExpectedCompactedFileSize(sstables, OperationType.CLEANUP));
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;It iterates over the &lt;tt&gt;sstables&lt;/tt&gt; collection and passes the same collection to &lt;tt&gt;cfs.getExpectedCompactedFileSize&lt;/tt&gt;.&lt;/p&gt;</comment>
                            <comment id="14321329" author="snazy" created="Sat, 14 Feb 2015 10:09:44 +0000"  >&lt;p&gt;It should read &lt;tt&gt;getExpectedCompactedFileSize(Collections.singleton(sstable)&lt;/tt&gt; instead - right?&lt;/p&gt;</comment>
                            <comment id="14321331" author="benedict" created="Sat, 14 Feb 2015 10:14:22 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mishail&quot; class=&quot;user-hover&quot; rel=&quot;mishail&quot;&gt;mishail&lt;/a&gt; are you sure about that bisect? It doesn&apos;t look like a plausible candidate to me.&lt;/p&gt;</comment>
                            <comment id="14321332" author="snazy" created="Sat, 14 Feb 2015 10:21:31 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=philipthompson&quot; class=&quot;user-hover&quot; rel=&quot;philipthompson&quot;&gt;philipthompson&lt;/a&gt; i&apos;ve patched &lt;tt&gt;CompactionManager&lt;/tt&gt;&#160;at that point. Can you verify it? It that&apos;s the cause, 2.1 is not affected.&lt;/p&gt;</comment>
                            <comment id="14321333" author="snazy" created="Sat, 14 Feb 2015 10:23:25 +0000"  >&lt;p&gt;Might be the cause, if there are multiple sstables for the cleanup - and the same set is always passed to &apos;getExpectedCompactedFileSize&apos; - but already cleaned up sstables could have already been closed, causing the assertion to trigger.&lt;/p&gt;</comment>
                            <comment id="14321335" author="benedict" created="Sat, 14 Feb 2015 10:34:01 +0000"  >&lt;p&gt;Yes, looks like &lt;a href=&quot;https://github.com/apache/cassandra/blob/cassandra-2.0/src/java/org/apache/cassandra/db/compaction/CompactionManager.java#L567&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;this line&lt;/a&gt; is buggy. Should pass in the single sstable, not the set of all sstables (since we actually obsolete some of these ourselves in the method call).&lt;/p&gt;

&lt;p&gt;Well spotted. Didn&apos;t look like this messed with any resource logic at first glance.&lt;/p&gt;</comment>
                            <comment id="14324207" author="philipthompson" created="Tue, 17 Feb 2015 14:11:40 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=snazy&quot; class=&quot;user-hover&quot; rel=&quot;snazy&quot;&gt;snazy&lt;/a&gt;, the attached 8716.txt patch corrects the issue on 2.0 head for me.&lt;/p&gt;</comment>
                            <comment id="14324219" author="snazy" created="Tue, 17 Feb 2015 14:19:26 +0000"  >&lt;p&gt;Alright, just waiting for a formal review til I commit the patch.&lt;/p&gt;</comment>
                            <comment id="14324381" author="benedict" created="Tue, 17 Feb 2015 16:15:00 +0000"  >&lt;p&gt;+1, with one nit: sstableColl looks ugly, and we already have one slightly less ugly way of representing this, which is &quot;sstableAsSet&quot;. I&apos;d prefer not to proliferate too many ways of being ugly &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="14324399" author="snazy" created="Tue, 17 Feb 2015 16:29:24 +0000"  >&lt;p&gt;Committed as 7f10cbd8ad7b4ea1f7471084eeb935fe911845bb with the less uglier name &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="14337315" author="tobiashauth" created="Wed, 25 Feb 2015 22:09:26 +0000"  >&lt;p&gt;I hit this bug every time I want to run cleanup on 2.0.12. Is there any workaround until 2.0.13 is released? I tried upgradesstables and scrub and both did not help. Is there another command sequence to replace cleanup?&lt;/p&gt;</comment>
                            <comment id="14341848" author="gianlucaborello" created="Sun, 1 Mar 2015 00:14:49 +0000"  >&lt;p&gt;+1 for a workaround, I could really use a cleanup without downgrading production to 2.0.11&lt;/p&gt;</comment>
                            <comment id="14700286" author="evin.callahan" created="Mon, 17 Aug 2015 21:48:19 +0000"  >&lt;p&gt;+1 for a workaround&lt;/p&gt;</comment>
                            <comment id="14700907" author="benedict" created="Tue, 18 Aug 2015 08:18:05 +0000"  >&lt;p&gt;It&apos;s a very small patch. You can checkout 2.0.12, apply the patch, and build yourself a snapshot in the meantime.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310050">
                    <name>Regression</name>
                                                                <inwardlinks description="is broken by">
                                        <issuelink>
            <issuekey id="12720922">CASSANDRA-7386</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12698896" name="8716.txt" size="2445" author="snazy" created="Sat, 14 Feb 2015 10:21:31 +0000"/>
                            <attachment id="12695922" name="system.log.gz" size="168583" author="imriz" created="Mon, 2 Feb 2015 13:32:58 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[snazy]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 14 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i252p3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12311421" key="com.atlassian.jira.plugin.system.customfieldtypes:multiversion">
                        <customfieldname>Reproduced In</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="12328860">2.0.12</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>benedict</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[benedict]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12961"><![CDATA[Low]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311124" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Tester</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>philipthompson</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>