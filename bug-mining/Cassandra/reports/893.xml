<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 22:20:58 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-2571] Check for null super column for SC CF in ThriftValidation (and always validate the sc key)</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-2571</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;Run the following via cli:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;[default@test] use test;
Authenticated to keyspace: test
[default@test] create column family super with column_type=Super and default_validation_class=CounterColumnType;
d41df8e0-7055-11e0-0000-242d50cf1fbf
Waiting for schema agreement...
... schemas agree across the cluster
[default@test] incr super[&apos;0&apos;][&apos;0&apos;];
Value incremented.
[default@test] incr super[&apos;0&apos;][&apos;0&apos;][&apos;0&apos;];
null
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Obviously the first incr call is invalid, even though it reports otherwise, as well as generates this exception:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;ERROR 17:38:05,871 Fatal exception in thread Thread[COMMIT-LOG-WRITER,5,main]
java.lang.RuntimeException: java.lang.ClassCastException: org.apache.cassandra.db.CounterColumn cannot be cast to org.apache.cassandra.db.SuperColumn
        at org.apache.cassandra.utils.WrappedRunnable.run(WrappedRunnable.java:34)
        at java.lang.Thread.run(Thread.java:636)
Caused by: java.lang.ClassCastException: org.apache.cassandra.db.CounterColumn cannot be cast to org.apache.cassandra.db.SuperColumn
        at org.apache.cassandra.db.SuperColumnSerializer.serialize(SuperColumn.java:353)
        at org.apache.cassandra.db.SuperColumnSerializer.serialize(SuperColumn.java:337)
        at org.apache.cassandra.db.ColumnFamilySerializer.serializeForSSTable(ColumnFamilySerializer.java:88)
        at org.apache.cassandra.db.ColumnFamilySerializer.serialize(ColumnFamilySerializer.java:74)
        at org.apache.cassandra.db.RowMutation$RowMutationSerializer.serialize(RowMutation.java:353)
        at org.apache.cassandra.db.RowMutation.getSerializedBuffer(RowMutation.java:236)
        at org.apache.cassandra.db.commitlog.CommitLogSegment.write(CommitLogSegment.java:111)
        at org.apache.cassandra.db.commitlog.CommitLog$LogRecordAdder.run(CommitLog.java:480)
        at org.apache.cassandra.db.commitlog.PeriodicCommitLogExecutorService$1.runMayThrow(PeriodicCommitLogExecutorService.java:49)
        at org.apache.cassandra.utils.WrappedRunnable.run(WrappedRunnable.java:30)
        ... 1 more
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;But the second, proper incr call results in a bunch of exceptions and not a real increment.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12505255">CASSANDRA-2571</key>
            <summary>Check for null super column for SC CF in ThriftValidation (and always validate the sc key)</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10002" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Normal</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="slebresne">Sylvain Lebresne</assignee>
                                    <reporter username="mbulman">Mike Bulman</reporter>
                        <labels>
                    </labels>
                <created>Tue, 26 Apr 2011 22:53:30 +0000</created>
                <updated>Tue, 16 Apr 2019 09:33:00 +0000</updated>
                            <resolved>Fri, 29 Apr 2011 17:11:40 +0000</resolved>
                                        <fixVersion>0.7.6</fixVersion>
                    <fixVersion>0.8.0 beta 2</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                                                                <comments>
                            <comment id="13025888" author="slebresne" created="Wed, 27 Apr 2011 16:50:11 +0000"  >&lt;p&gt;Turns out this is not a counter related bug. We just don&apos;t check when doing a (single) insert (and thus a add) on a super CF that the super column is not null.&lt;/p&gt;

&lt;p&gt;Attached patch add a system test and fix it. It also fix another hole in ThriftValidation where the sc key was not validated. The patch is against 0.7 because it&apos;s not 0.8 specific.&lt;/p&gt;

&lt;p&gt;Note that in 0.8 the cli &quot;hides&quot; this error for non counter column, but it is still not counter specific. The fact that the cluster is then &quot;in a bad state&quot;, is because since we don&apos;t refuse the insert, some insert with a &apos;null&apos; key is inserted in the column family map and thus messed up following insert (I think at least, haven&apos;t check super closely).&lt;/p&gt;</comment>
                            <comment id="13026648" author="jbellis" created="Thu, 28 Apr 2011 19:26:35 +0000"  >&lt;p&gt;I find boolean (or other &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; flags that change method behavior subtly confusing.  Attached is a version that inlines the new check into insert(), which is the only place that wants it.&lt;/p&gt;</comment>
                            <comment id="13027063" author="hudson" created="Fri, 29 Apr 2011 16:27:55 +0000"  >&lt;p&gt;Integrated in Cassandra-0.7 #463 (See &lt;a href=&quot;https://builds.apache.org/hudson/job/Cassandra-0.7/463/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/hudson/job/Cassandra-0.7/463/&lt;/a&gt;)&lt;br/&gt;
    Reject queries with missing mandatory super column and always validate super column name&lt;br/&gt;
patch by jbellis and slebresne for &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-2571&quot; title=&quot;Check for null super column for SC CF in ThriftValidation (and always validate the sc key)&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-2571&quot;&gt;&lt;del&gt;CASSANDRA-2571&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13027083" author="slebresne" created="Fri, 29 Apr 2011 17:11:40 +0000"  >&lt;p&gt;Committed&lt;/p&gt;</comment>
                            <comment id="13027093" author="hudson" created="Fri, 29 Apr 2011 17:36:05 +0000"  >&lt;p&gt;Integrated in Cassandra #872 (See &lt;a href=&quot;https://builds.apache.org/hudson/job/Cassandra/872/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/hudson/job/Cassandra/872/&lt;/a&gt;)&lt;br/&gt;
    merge &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-2571&quot; title=&quot;Check for null super column for SC CF in ThriftValidation (and always validate the sc key)&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-2571&quot;&gt;&lt;del&gt;CASSANDRA-2571&lt;/del&gt;&lt;/a&gt; from 0.8&lt;/p&gt;</comment>
                            <comment id="13027803" author="hudson" created="Mon, 2 May 2011 19:54:50 +0000"  >&lt;p&gt;Integrated in Cassandra-0.8 #58 (See &lt;a href=&quot;https://builds.apache.org/hudson/job/Cassandra-0.8/58/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/hudson/job/Cassandra-0.8/58/&lt;/a&gt;)&lt;/p&gt;
</comment>
                    </comments>
                    <attachments>
                            <attachment id="12477563" name="0001-Improve-ThriftValidation.patch" size="8216" author="slebresne" created="Wed, 27 Apr 2011 16:50:11 +0000"/>
                            <attachment id="12477683" name="2571.txt" size="5363" author="jbellis" created="Thu, 28 Apr 2011 19:26:35 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[slebresne]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>20704</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            14 years, 30 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0gc5r:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>93400</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>jbellis</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[jbellis]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12962"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>