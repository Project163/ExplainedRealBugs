<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 22:22:19 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-3000] Ec2MultiRegionSnitch throws AssertionError on EC2</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-3000</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;I found Ec2MultiRegionSnitch patch at &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-2452&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/CASSANDRA-2452&lt;/a&gt; &lt;/p&gt;

&lt;p&gt;However, I could not find any documentation on how to get it working, which address to use as seed, listen and thrift addresses. I used the following, &lt;/p&gt;

&lt;p&gt;seed_address     = Public DNS of the seed node &lt;br/&gt;
listen_address   = Public DNS of the cluster node&lt;br/&gt;
rpc_address      = 0.0.0.0&lt;br/&gt;
endpoint_snitch: org.apache.cassandra.locator.Ec2MultiRegionSnitch&lt;/p&gt;


&lt;p&gt;When I try to start cassandra, I get the following error: &lt;/p&gt;

&lt;p&gt; INFO 14:44:19,822 Ec2Snitch adding ApplicationState ec2region=eu-west ec2zone=1c&lt;br/&gt;
 INFO 14:44:19,831 Starting Messaging Service on ec2-46-137-139-124.eu-west-1.compute.amazonaws.com/10.227.143.202:7000&lt;br/&gt;
 INFO 14:44:19,851 Using saved token 162732122844140653649170199706439942449&lt;br/&gt;
 INFO 14:44:19,852 Enqueuing flush of Memtable-LocationInfo@550579946(53/66 serialized/live bytes, 2 ops)&lt;br/&gt;
 INFO 14:44:19,852 Writing Memtable-LocationInfo@550579946(53/66 serialized/live bytes, 2 ops)&lt;br/&gt;
 INFO 14:44:19,908 Completed flushing /var/lib/cassandra/data/system/LocationInfo-h-20-Data.db (163 bytes)&lt;br/&gt;
 INFO 14:44:19,913 Compacting Major: &lt;span class=&quot;error&quot;&gt;&amp;#91;SSTableReader(path=&amp;#39;/var/lib/cassandra/data/system/LocationInfo-h-20-Data.db&amp;#39;), SSTableReader(path=&amp;#39;/var/lib/cassandra/data/system/LocationInfo-h-19-Data.db&amp;#39;), SSTableReader(path=&amp;#39;/var/lib/cassandra/data/system/LocationInfo-h-17-Data.db&amp;#39;), SSTableReader(path=&amp;#39;/var/lib/cassandra/data/system/LocationInfo-h-18-Data.db&amp;#39;)&amp;#93;&lt;/span&gt;&lt;br/&gt;
ERROR 14:44:19,922 Exception encountered during startup.&lt;br/&gt;
java.lang.AssertionError&lt;br/&gt;
        at org.apache.cassandra.gms.Gossiper.compareEndpointStartup(Gossiper.java:620)&lt;br/&gt;
        at org.apache.cassandra.service.StorageService.handleStateNormal(StorageService.java:803)&lt;br/&gt;
        at org.apache.cassandra.service.StorageService.onChange(StorageService.java:706)&lt;br/&gt;
        at org.apache.cassandra.gms.Gossiper.doNotifications(Gossiper.java:839)&lt;br/&gt;
        at org.apache.cassandra.gms.Gossiper.addLocalApplicationState(Gossiper.java:986)&lt;br/&gt;
        at org.apache.cassandra.service.StorageService.setToken(StorageService.java:219)&lt;br/&gt;
        at org.apache.cassandra.service.StorageService.joinTokenRing(StorageService.java:520)&lt;br/&gt;
        at org.apache.cassandra.service.StorageService.initServer(StorageService.java:434)&lt;br/&gt;
        at org.apache.cassandra.service.AbstractCassandraDaemon.setup(AbstractCassandraDaemon.java:213)&lt;br/&gt;
        at org.apache.cassandra.service.AbstractCassandraDaemon.activate(AbstractCassandraDaemon.java:335)&lt;br/&gt;
        at org.apache.cassandra.thrift.CassandraDaemon.main(CassandraDaemon.java:91)&lt;br/&gt;
Exception encountered during startup.&lt;br/&gt;
java.lang.AssertionError&lt;br/&gt;
        at org.apache.cassandra.gms.Gossiper.compareEndpointStartup(Gossiper.java:620)&lt;br/&gt;
        at org.apache.cassandra.service.StorageService.handleStateNormal(StorageService.java:803)&lt;br/&gt;
        at org.apache.cassandra.service.StorageService.onChange(StorageService.java:706)&lt;br/&gt;
        at org.apache.cassandra.gms.Gossiper.doNotifications(Gossiper.java:839)&lt;br/&gt;
        at org.apache.cassandra.gms.Gossiper.addLocalApplicationState(Gossiper.java:986)&lt;br/&gt;
        at org.apache.cassandra.service.StorageService.setToken(StorageService.java:219)&lt;br/&gt;
        at org.apache.cassandra.service.StorageService.joinTokenRing(StorageService.java:520)&lt;br/&gt;
        at org.apache.cassandra.service.StorageService.initServer(StorageService.java:434)&lt;br/&gt;
        at org.apache.cassandra.service.AbstractCassandraDaemon.setup(AbstractCassandraDaemon.java:213)&lt;br/&gt;
        at org.apache.cassandra.service.AbstractCassandraDaemon.activate(AbstractCassandraDaemon.java:335)&lt;br/&gt;
        at org.apache.cassandra.thrift.CassandraDaemon.main(CassandraDaemon.java:91)&lt;/p&gt;
</description>
                <environment>&lt;p&gt;build version: apache-cassandra-2011-08-07_02-23-42&lt;/p&gt;

&lt;p&gt;OS: Ubuntu 10.04.2 LTS \n \l&lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;uname -a&lt;br/&gt;
Linux ip-10-227-143-202 2.6.32-312-ec2 #24-Ubuntu SMP Fri Jan 7 18:30:50 UTC 2011 x86_64 GNU/Linux&lt;/li&gt;
&lt;/ol&gt;
</environment>
        <key id="12518136">CASSANDRA-3000</key>
            <summary>Ec2MultiRegionSnitch throws AssertionError on EC2</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10002" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Normal</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="vijay2win@yahoo.com">Vijay</assignee>
                                    <reporter username="initcron">Gourav Shah</reporter>
                        <labels>
                            <label>ec2multiregionsnitch</label>
                            <label>ec2snitch</label>
                            <label>snitch</label>
                    </labels>
                <created>Sun, 7 Aug 2011 14:47:41 +0000</created>
                <updated>Tue, 16 Apr 2019 09:32:54 +0000</updated>
                            <resolved>Wed, 10 Aug 2011 16:28:49 +0000</resolved>
                                                            <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                                                                <comments>
                            <comment id="13080756" author="vijay2win@yahoo.com" created="Mon, 8 Aug 2011 05:29:06 +0000"  >&lt;p&gt;&quot;listen_address = Public DNS of the cluster node&quot;&lt;br/&gt;
the idea is to use broadcast address as the AWS public ip and Listen address to use AWS private IP. it is done automatically.... I will add additional checks to look for user error like this...&lt;/p&gt;</comment>
                            <comment id="13080760" author="initcron" created="Mon, 8 Aug 2011 05:55:37 +0000"  >&lt;p&gt;&amp;gt;&quot;listen_address = Public DNS of the cluster node&quot;&lt;br/&gt;
&amp;gt;the idea is to use broadcast address as the AWS public ip and Listen address to use AWS private IP. it is done &amp;gt;automatically.... I will add additional checks to look for user error like this...&lt;/p&gt;

&lt;p&gt;Vijay, I still dont get this. What do you mean when you say &quot;it is done automatically&quot; ?  Does it mean that I do not need to configure listen address at all in cassandra.yaml and it will automatically be set?&lt;/p&gt;

&lt;p&gt;Also, the reason I set listen_address to public dns on the cluster node is because it will automatically get resolved to private ip for the instances within the same region. Only the tnstances in other ec2 regions will route to its public IP. So it should do the right thing while setting up the listen address. &lt;/p&gt;
</comment>
                            <comment id="13081011" author="vijay2win@yahoo.com" created="Mon, 8 Aug 2011 15:46:13 +0000"  >&lt;p&gt;Does it mean that I do not need to configure listen address at all in cassandra.yaml and it will automatically be set?&lt;/p&gt;

&lt;p&gt;Yes. And the private and public ip&apos;s are quried @ amazon. broadcast ip will be set to public ip and the private ip will be used for inter node communication within the region. (&lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-2452&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/CASSANDRA-2452&lt;/a&gt;)&lt;/p&gt;

&lt;p&gt;I couldn&apos;t reproduce this issue, do you have an existing cluster which you are trying to update the snitch?&lt;/p&gt;</comment>
                            <comment id="13081023" author="initcron" created="Mon, 8 Aug 2011 16:07:51 +0000"  >&lt;p&gt;Vijay, &lt;/p&gt;

&lt;p&gt;Here is the cassandra.yaml config I am using  &lt;a href=&quot;http://pastebin.com/7rBH45S8&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://pastebin.com/7rBH45S8&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;I am not updating snitch on a existing cluster, but building one from scratch. &lt;/p&gt;

&lt;p&gt;Could you have a look at the config and see if I am doing anything wrong? &lt;/p&gt;</comment>
                            <comment id="13082433" author="vijay2win@yahoo.com" created="Wed, 10 Aug 2011 16:16:55 +0000"  >&lt;p&gt;Issue seems to be caused by LocalAddress to broadcast address changes... but shows up when using broad cast address like in EC2MRS... Attached patch adds some comments and fixes.&lt;/p&gt;</comment>
                            <comment id="13082447" author="brandon.williams" created="Wed, 10 Aug 2011 16:28:49 +0000"  >&lt;p&gt;Committed.&lt;/p&gt;</comment>
                            <comment id="13082485" author="hudson" created="Wed, 10 Aug 2011 17:14:23 +0000"  >&lt;p&gt;Integrated in Cassandra #1014 (See &lt;a href=&quot;https://builds.apache.org/job/Cassandra/1014/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/Cassandra/1014/&lt;/a&gt;)&lt;br/&gt;
    Use broadcastAddress instead of localAddress.&lt;br/&gt;
Patch by Vijay, reviewed by brandonwilliams for &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-3000&quot; title=&quot;Ec2MultiRegionSnitch throws AssertionError on EC2&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-3000&quot;&gt;&lt;del&gt;CASSANDRA-3000&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;brandonwilliams : &lt;a href=&quot;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1156254&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1156254&lt;/a&gt;&lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/cassandra/trunk/src/java/org/apache/cassandra/service/StorageService.java&lt;/li&gt;
	&lt;li&gt;/cassandra/trunk/src/java/org/apache/cassandra/net/MessagingService.java&lt;/li&gt;
	&lt;li&gt;/cassandra/trunk/src/java/org/apache/cassandra/gms/Gossiper.java&lt;/li&gt;
	&lt;li&gt;/cassandra/trunk/src/java/org/apache/cassandra/service/StorageProxy.java&lt;/li&gt;
	&lt;li&gt;/cassandra/trunk/src/java/org/apache/cassandra/utils/FBUtilities.java&lt;/li&gt;
	&lt;li&gt;/cassandra/trunk/src/java/org/apache/cassandra/net/OutboundTcpConnection.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                    </comments>
                    <attachments>
                            <attachment id="12489994" name="0001-3000-fixing-localaddress-calls-insted-of-broadcastAd.patch" size="5434" author="vijay2win@yahoo.com" created="Wed, 10 Aug 2011 16:16:55 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[vijay2win@yahoo.com]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>20931</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            14 years, 15 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0gerj:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>93822</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>brandon.williams</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[brandon.williams]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12962"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>