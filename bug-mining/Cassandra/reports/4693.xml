<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 23:06:59 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-13274] Fix code to not exchange schema across major versions</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-13274</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;A rolling upgrade from 3.* to 4.0 (messaging version &lt;tt&gt;11&lt;/tt&gt;) unveils a regression caused by &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-11128&quot; title=&quot;Unexpected exception during request; AssertionError: null&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-11128&quot;&gt;&lt;del&gt;CASSANDRA-11128&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;Generally, we store all possible options/attributes including the default values in the schema. This causes (expected) schema-version-mismatches during rolling upgrades and therefore we prevent schema pulls/pushes in this situation, which has been broken by &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-11128&quot; title=&quot;Unexpected exception during request; AssertionError: null&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-11128&quot;&gt;&lt;del&gt;CASSANDRA-11128&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13046607">CASSANDRA-13274</key>
            <summary>Fix code to not exchange schema across major versions</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10000" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Urgent</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="snazy">Robert Stupp</assignee>
                                    <reporter username="snazy">Robert Stupp</reporter>
                        <labels>
                    </labels>
                <created>Mon, 27 Feb 2017 10:47:17 +0000</created>
                <updated>Tue, 16 Apr 2019 09:30:09 +0000</updated>
                            <resolved>Tue, 28 Mar 2017 07:49:22 +0000</resolved>
                                        <fixVersion>3.0.13</fixVersion>
                    <fixVersion>3.11.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="15885831" author="iamaleksey" created="Mon, 27 Feb 2017 14:06:13 +0000"  >&lt;p&gt;Not sure I understand the issue.&lt;/p&gt;

&lt;p&gt;Could you please be more clear regarding what is broken, what the expected behaviour is, and what is the behaviour you are observing?&lt;/p&gt;</comment>
                            <comment id="15885919" author="snazy" created="Mon, 27 Feb 2017 15:13:48 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-11138&quot; title=&quot;cassandra-stress tool - clustering key values not distributed&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-11138&quot;&gt;CASSANDRA-11138&lt;/a&gt; sets the messaging-version for any node to &lt;tt&gt;Math.min(version, current_version&lt;/tt&gt;. I.e. a newer node (aka C*4.0 using messaging-version 11) would appear as messaging-version 10 in 3.* nodes. That basically allows migration-tasks (schema pull/push) between different messaging versions.&lt;/p&gt;</comment>
                            <comment id="15885961" author="snazy" created="Mon, 27 Feb 2017 15:34:44 +0000"  >&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;cassandra-3.0&lt;/th&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/apache/cassandra/compare/cassandra-3.0...snazy:13274-rolling-upgrade-3.0&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;branch&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/snazy/job/snazy-13274-rolling-upgrade-3.0-testall/lastSuccessfulBuild/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;testall&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/snazy/job/snazy-13274-rolling-upgrade-3.0-dtest/lastSuccessfulBuild/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;dtest&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;cassandra-3.11&lt;/th&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/apache/cassandra/compare/cassandra-3.11...snazy:13274-rolling-upgrade-3.11&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;branch&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/snazy/job/snazy-13274-rolling-upgrade-3.11-testall/lastSuccessfulBuild/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;testall&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/snazy/job/snazy-13274-rolling-upgrade-3.11-dtest/lastSuccessfulBuild/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;dtest&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;trunk&lt;/th&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/apache/cassandra/compare/trunk...snazy:13274-rolling-upgrade-trunk&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;branch&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/snazy/job/snazy-13274-rolling-upgrade-trunk-testall/lastSuccessfulBuild/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;testall&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/snazy/job/snazy-13274-rolling-upgrade-trunk-dtest/lastSuccessfulBuild/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;dtest&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;


&lt;p&gt;CI triggered.&lt;/p&gt;

&lt;p&gt;Also tested a few CQL upgrade tests from &quot;legacy&quot; 3.0 to current trunk (to verify the upgrade issue locally) and this patch to trunk (to verify the fix).&lt;/p&gt;

&lt;p&gt;Also added an entry to &lt;tt&gt;NEWS.txt&lt;/tt&gt; in the trunk branch regarding rolling upgrades.&lt;/p&gt;

&lt;p&gt;Reviewer hint: for &lt;tt&gt;rolling_upgrade_test&lt;/tt&gt;, it&apos;s necessary to disable the &lt;tt&gt;nodetool upgradesstables }} (comment out {{node.nodetool(&apos;upgradesstables -a&apos;)&lt;/tt&gt; in &lt;tt&gt;upgrade_through_versions_test.py&lt;/tt&gt; line#446) invocation until &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-13059&quot; title=&quot;dtest failure in upgrade_tests.upgrade_through_versions_test.TestUpgrade_current_2_1_x_To_indev_3_x.rolling_upgrade_test&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-13059&quot;&gt;&lt;del&gt;CASSANDRA-13059&lt;/del&gt;&lt;/a&gt; is fixed.&lt;/p&gt;</comment>
                            <comment id="15943300" author="slebresne" created="Mon, 27 Mar 2017 13:50:20 +0000"  >&lt;p&gt;+1, but make sure to update NEWS file for trunk with the actual version this is going to make it in. Also, completely a nit, but for the changelog I&apos;d probably rephrase to something like &quot;Fix code to not exchange schema across major versions&quot; as that&apos;s more precise and avoid referencing a version that doesn&apos;t exists yet.&lt;/p&gt;</comment>
                            <comment id="15944711" author="snazy" created="Tue, 28 Mar 2017 07:49:22 +0000"  >&lt;p&gt;Thanks!&lt;br/&gt;
Committed as &lt;a href=&quot;https://github.com/apache/cassandra/commit/6da41ed047ed5ef8a5d11e7a60e73dfeb129a72a&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;6da41ed047ed5ef8a5d11e7a60e73dfeb129a72a&lt;/a&gt; to &lt;a href=&quot;https://github.com/apache/cassandra/tree/cassandra-3.0&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;cassandra-3.0&lt;/a&gt; and merged up to trunk.&lt;br/&gt;
Trunk commit contains the updated changes in NEWS.txt.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12904794">CASSANDRA-10520</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                            <issuelinktype id="12310050">
                    <name>Regression</name>
                                                                <inwardlinks description="is broken by">
                                        <issuelink>
            <issuekey id="12937226">CASSANDRA-11128</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[snazy]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 34 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3ao47:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>slebresne</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[slebresne]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12963"><![CDATA[Critical]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>