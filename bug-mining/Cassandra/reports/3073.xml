<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 22:47:44 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-7796] Stop inheriting liveRatio/computedAt from previous memtables</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-7796</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-6945&quot; title=&quot;Calculate liveRatio on per-memtable basis, non per-CF&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-6945&quot;&gt;&lt;del&gt;CASSANDRA-6945&lt;/del&gt;&lt;/a&gt; helped to reduce the risk of calculating an outlier liveRatio value, and having to stick with it for a long time, by making liveRatio per-memtable and not per-cf.&lt;/p&gt;

&lt;p&gt;The added optimization of inheriting liveRatio/calculatedAt to minimize recalculations, however, took us a step back to before &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-6945&quot; title=&quot;Calculate liveRatio on per-memtable basis, non per-CF&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-6945&quot;&gt;&lt;del&gt;CASSANDRA-6945&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;I suggest we get rid of inheriting the old values altogether, but reduce the rate of recalculation by demanding 10x increase in ops to trigger recalc, instead of the previous 2x.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12735141">CASSANDRA-7796</key>
            <summary>Stop inheriting liveRatio/computedAt from previous memtables</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10003" iconUrl="https://issues.apache.org/jira/images/icons/priorities/trivial.svg">Low</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="aleksey">Aleksey Yeschenko</assignee>
                                    <reporter username="aleksey">Aleksey Yeschenko</reporter>
                        <labels>
                    </labels>
                <created>Tue, 19 Aug 2014 19:31:25 +0000</created>
                <updated>Tue, 16 Apr 2019 09:31:36 +0000</updated>
                            <resolved>Wed, 20 Aug 2014 13:00:48 +0000</resolved>
                                        <fixVersion>2.0.10</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                                                                <comments>
                            <comment id="14102911" author="jbellis" created="Tue, 19 Aug 2014 21:49:00 +0000"  >&lt;p&gt;I&apos;m a little concerned that we&apos;re still experimenting with this in 2.0.x.  Should we just back out 6945 and put this in 2.1?&lt;/p&gt;</comment>
                            <comment id="14102917" author="iamaleksey" created="Tue, 19 Aug 2014 21:52:57 +0000"  >&lt;p&gt;There is no liveRatio in 2.1 (thank God). It&apos;s strictly 2.0. 6945 itself is fine. Even in its current form, it&apos;s better than pre-6945 situation was. This change is safe - it reduces complexity, if anything, so I feel fine putting this in 2.0.&lt;/p&gt;

&lt;p&gt;But I&apos;ll also sleep fine if we don&apos;t.&lt;/p&gt;</comment>
                            <comment id="14102925" author="jbellis" created="Tue, 19 Aug 2014 21:57:54 +0000"  >&lt;p&gt;You&apos;re right, this is just an optimization and doesn&apos;t really affect the design again.  +1&lt;/p&gt;</comment>
                            <comment id="14103213" author="benedict" created="Wed, 20 Aug 2014 01:40:03 +0000"  >&lt;p&gt;Are you sure this is better? I think we should inherit the ratio, but not the last computed at. This patch IMO makes it easier to OOM by inserts outpacing the liveRatio calculation after memtable switch. With inheritance we are only at risk if the data shape changes; with this patch we are at risk with the same data shape which to me seems like a larger affect window.&lt;/p&gt;</comment>
                            <comment id="14103660" author="iamaleksey" created="Wed, 20 Aug 2014 09:16:13 +0000"  >&lt;p&gt;Yes, I&apos;m sure. liveRatio is inherently flawed, so what 6945 and this one are about are about handling pathological scenarios. Pre-6945 if we happened to calculate the ratio on an empty-ish memtable at a reasonable time since CF init, we&apos;d be screwed for good, for long. Post-6945, to a lesser extent, you can still get similar bad behavior if you inherit a crazy recently calculated liveRatio with high-ish calculatedAt. IMO it&apos;s preferable to start with the default ratio, guaranteed to be non-crazy. For the same reason I&apos;m against inheriting just the liveRatio w/out computedAt.&lt;/p&gt;

&lt;p&gt;Now, there are ways to be smarter about it, but I&apos;m uncomfortable with experimenting at this point. I&apos;d rather just rollback this part of 6945.&lt;/p&gt;

&lt;p&gt;And the only way to truly fix this is to upgrade to 2.1 :\&lt;/p&gt;</comment>
                            <comment id="14103665" author="benedict" created="Wed, 20 Aug 2014 09:19:36 +0000"  >&lt;p&gt;My concern is I&apos;m pretty certain we encountered a user on the mailing list OOMing their servers by outpacing the live ratio calculation, which is why we introduced this.&lt;/p&gt;</comment>
                            <comment id="14103797" author="iamaleksey" created="Wed, 20 Aug 2014 12:03:08 +0000"  >&lt;p&gt;It&apos;s not why we introduced this, actually. Moving liveRatio to per-Memtable from per-CF was done to avoid getting stuck forever with an outlier liveRatio value. Inheriting them was an optimisation to reduce the number of recalculations themselves, but in retrospect it does sort of go against the very reason 6945 was introduced.&lt;/p&gt;

&lt;p&gt;That, and liveRatioComputedAt is really liveRatioScheduledToBeComputedAt. We can track the actual liveRatioComputedAt, or only inherit the previous ratio if its value is sane enough, but at this point in 2.0 cycle I&apos;m uncomfortable with that. Rolling back the inheritance part of 6945 (what this issue is about) I am comfortable with.&lt;/p&gt;</comment>
                            <comment id="14103845" author="iamaleksey" created="Wed, 20 Aug 2014 13:00:48 +0000"  >&lt;p&gt;Thanks. Committed to 2.0.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=benedict&quot; class=&quot;user-hover&quot; rel=&quot;benedict&quot;&gt;benedict&lt;/a&gt; We can change the default (initial) ratio to a higher/lower value, if you come up with a justified one.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12662822" name="7796.txt" size="3081" author="aleksey" created="Tue, 19 Aug 2014 19:31:55 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[aleksey]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            11 years, 13 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1z2an:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>jbellis</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[jbellis]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12961"><![CDATA[Low]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>