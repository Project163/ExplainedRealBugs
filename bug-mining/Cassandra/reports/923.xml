<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 22:21:14 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-2628] Empty Result with Secondary Index Queries with &quot;limit 1&quot;</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-2628</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;Empty result is returned by secondary index queries with &quot;limit 1&quot;.  Cassandra returns correct result for other numbers than &quot;1&quot; (e.g. limit 2, limit 3, etc.).  &lt;/p&gt;

&lt;p&gt;You can reproduce the problem with programs attached on &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-2406&quot; title=&quot;Secondary index and index expression problems&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-2406&quot;&gt;&lt;del&gt;CASSANDRA-2406&lt;/del&gt;&lt;/a&gt;.  &lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;1. Start Cassandra cluster. It consists of 3 cassandra nodes and distributes data by ByteOrderedPartitioner. Initial tokens of those nodes are &lt;span class=&quot;error&quot;&gt;&amp;#91;&amp;quot;31&amp;quot;, &amp;quot;32&amp;quot;, &amp;quot;33&amp;quot;&amp;#93;&lt;/span&gt;.&lt;/li&gt;
	&lt;li&gt;2. Create keyspace and column family, according to &quot;create_table.cli&quot;,&lt;/li&gt;
	&lt;li&gt;3. Execute &quot;secondary_index_insertv2.py&quot;, inserting a few hundred columns to cluster&lt;/li&gt;
	&lt;li&gt;4. Here, when you first use cassandra-cli and execute following lines, you can get correct result.&lt;/li&gt;
&lt;/ul&gt;


&lt;blockquote&gt;
&lt;p&gt;% bin/cassandra-cli&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;default@unknown&amp;#93;&lt;/span&gt; connect localhost/9160;&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;default@unknown&amp;#93;&lt;/span&gt; use SampleKS;&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;default@SampleKS&amp;#93;&lt;/span&gt; get SampleCF where up = &apos;up&apos; limit 3;               &lt;br/&gt;
-------------------&lt;br/&gt;
RowKey: 150&lt;br/&gt;
=&amp;gt; (column=date, value=150, timestamp=1304937931)&lt;br/&gt;
=&amp;gt; (column=up, value=up, timestamp=1304937931)&lt;br/&gt;
-------------------&lt;br/&gt;
RowKey: 151&lt;br/&gt;
=&amp;gt; (column=date, value=151, timestamp=1304937932)&lt;br/&gt;
=&amp;gt; (column=up, value=up, timestamp=1304937932)&lt;br/&gt;
-------------------&lt;br/&gt;
RowKey: 152&lt;br/&gt;
=&amp;gt; (column=date, value=152, timestamp=1304937932)&lt;br/&gt;
=&amp;gt; (column=up, value=up, timestamp=1304937932)&lt;br/&gt;
3 Rows Returned.  &lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;On the other hand, if you set limit to &quot;1&quot;, you can reproduce the problem.&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;default@SampleKS&amp;#93;&lt;/span&gt; get SampleCF where up = &apos;up&apos; and date &amp;gt; 150 limit 1;&lt;br/&gt;
0 Row Returned.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;There are two factors to cause this problem:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;1. scanned first column doesn&apos;t match at specified clause like &quot;date &amp;gt; 150&quot;.&lt;/li&gt;
	&lt;li&gt;2. &quot;limit 1&quot;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Only one factor doesn&apos;t cause problem.  For example, I can get correct data when I specify as following:&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;&quot;limit 1&quot; -&amp;gt; &quot;limit 2&quot;
&lt;blockquote&gt;
&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;default@SampleKS&amp;#93;&lt;/span&gt; get SampleCF where up = &apos;up&apos; and date &amp;gt; 150 limit 2;&lt;br/&gt;
-------------------&lt;br/&gt;
RowKey: 151&lt;br/&gt;
=&amp;gt; (column=date, value=151, timestamp=1304937932)&lt;br/&gt;
=&amp;gt; (column=up, value=up, timestamp=1304937932)&lt;br/&gt;
-------------------&lt;br/&gt;
RowKey: 152&lt;br/&gt;
=&amp;gt; (column=date, value=152, timestamp=1304937932)&lt;br/&gt;
=&amp;gt; (column=up, value=up, timestamp=1304937932)&lt;br/&gt;
2 Rows Returned.&lt;/p&gt;&lt;/blockquote&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;&quot;date &amp;gt; 150&quot; -&amp;gt; &quot;date &amp;gt;= 150&quot;
&lt;blockquote&gt;
&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;default@SampleKS&amp;#93;&lt;/span&gt; get SampleCF where up = &apos;up&apos; and date &amp;gt;= 150 limit 1;&lt;br/&gt;
-------------------&lt;br/&gt;
RowKey: 150&lt;br/&gt;
=&amp;gt; (column=date, value=150, timestamp=1304937931)&lt;br/&gt;
=&amp;gt; (column=up, value=up, timestamp=1304937931)&lt;br/&gt;
1 Row Returned.&lt;/p&gt;&lt;/blockquote&gt;&lt;/li&gt;
&lt;/ul&gt;
</description>
                <environment>&lt;p&gt;CentOS 5.5&lt;/p&gt;</environment>
        <key id="12506607">CASSANDRA-2628</key>
            <summary>Empty Result with Secondary Index Queries with &quot;limit 1&quot;</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10002" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Normal</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="slebresne">Sylvain Lebresne</assignee>
                                    <reporter username="muga_nishizawa">Muga Nishizawa</reporter>
                        <labels>
                    </labels>
                <created>Mon, 9 May 2011 13:29:20 +0000</created>
                <updated>Tue, 16 Apr 2019 09:32:59 +0000</updated>
                            <resolved>Thu, 12 May 2011 15:14:20 +0000</resolved>
                                        <fixVersion>0.7.6</fixVersion>
                    <fixVersion>0.8.0</fixVersion>
                                    <component>Feature/2i Index</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                                                                <comments>
                            <comment id="13032360" author="slebresne" created="Thu, 12 May 2011 11:07:17 +0000"  >&lt;p&gt;Attaching fix along with a unit test.&lt;/p&gt;

&lt;p&gt;Problem was we do some paging on the index using clause.count as the page size. And 1 is a pretty bad page size.&lt;/p&gt;

&lt;p&gt;Thanks Muga for the report and the clear instructions to reproduce.&lt;/p&gt;</comment>
                            <comment id="13032443" author="jbellis" created="Thu, 12 May 2011 14:55:38 +0000"  >&lt;p&gt;To clarify, the problem is that since slice is inclusive-from-start, if our page size is one a 2nd pass will get back the same row the first did, so the scan logic thinks there is no more data and breaks. (since that is exactly what you will see if you just scanned the last column in the index row.)&lt;/p&gt;

&lt;p&gt;+1 on the fix.&lt;/p&gt;</comment>
                            <comment id="13032450" author="slebresne" created="Thu, 12 May 2011 15:14:20 +0000"  >&lt;p&gt;Committed&lt;/p&gt;</comment>
                            <comment id="13032672" author="hudson" created="Thu, 12 May 2011 20:56:28 +0000"  >&lt;p&gt;Integrated in Cassandra-0.7 #483 (See &lt;a href=&quot;https://builds.apache.org/hudson/job/Cassandra-0.7/483/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/hudson/job/Cassandra-0.7/483/&lt;/a&gt;)&lt;/p&gt;
</comment>
                    </comments>
                    <attachments>
                            <attachment id="12478955" name="0001-2628.patch" size="4767" author="slebresne" created="Thu, 12 May 2011 11:07:17 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[slebresne]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>20740</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            14 years, 28 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0gci7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>93456</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>jbellis</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[jbellis]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12962"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>