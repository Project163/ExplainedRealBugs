<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 22:47:56 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-7831] recreating a counter column after dropping it leaves in unusable state</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-7831</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;create table counter_bug (t int, c counter, primary key (t));&lt;br/&gt;
update counter_bug set c = c +1 where t = 1;&lt;br/&gt;
select * from counter_bug ;&lt;/p&gt;

&lt;p&gt; t | c&lt;br/&gt;
--&lt;del&gt;+&lt;/del&gt;--&lt;br/&gt;
 1 | 1&lt;/p&gt;

&lt;p&gt;(1 rows)&lt;/p&gt;

&lt;p&gt;alter table counter_bug drop c;&lt;br/&gt;
alter table counter_bug add c counter;&lt;br/&gt;
update counter_bug set c = c +1 where t = 1;&lt;br/&gt;
select * from counter_bug;&lt;/p&gt;

&lt;p&gt;(0 rows)&lt;/p&gt;

&lt;p&gt;update counter_bug set c = c +1 where t = 2;&lt;br/&gt;
select * from counter_bug;&lt;/p&gt;

&lt;p&gt;(0 rows)&lt;/p&gt;</description>
                <environment></environment>
        <key id="12736811">CASSANDRA-7831</key>
            <summary>recreating a counter column after dropping it leaves in unusable state</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10002" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Normal</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="aleksey">Aleksey Yeschenko</assignee>
                                    <reporter username="pmaedel">Peter M&#228;del</reporter>
                        <labels>
                            <label>qa-resolved</label>
                    </labels>
                <created>Tue, 26 Aug 2014 14:13:13 +0000</created>
                <updated>Tue, 16 Apr 2019 09:31:35 +0000</updated>
                            <resolved>Thu, 28 Aug 2014 13:39:01 +0000</resolved>
                                        <fixVersion>2.0.11</fixVersion>
                    <fixVersion>2.1.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="14110761" author="philipthompson" created="Tue, 26 Aug 2014 14:35:12 +0000"  >&lt;p&gt;This does not reproduce on 2.1-HEAD. Instead what happens after&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;update counter_bug set c = c +1 where t = 1;
update counter_bug set c = c +1 where t = 2;
select * from counter_bug;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;is that &lt;/p&gt;

&lt;p&gt; t | c&lt;br/&gt;
--&lt;del&gt;+&lt;/del&gt;--&lt;br/&gt;
 1 | 2&lt;br/&gt;
 2 | 1&lt;/p&gt;

&lt;p&gt;is returned, implying that the previous value for c was preserved even though the column was dropped.&lt;/p&gt;</comment>
                            <comment id="14111443" author="brandon.williams" created="Tue, 26 Aug 2014 22:13:20 +0000"  >&lt;p&gt;Sounds like a symptom of &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-5202&quot; title=&quot;CFs should have globally and temporally unique CF IDs to prevent &amp;quot;reusing&amp;quot; data from earlier incarnation of same CF name&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-5202&quot;&gt;&lt;del&gt;CASSANDRA-5202&lt;/del&gt;&lt;/a&gt;, which would explain why it doesn&apos;t happen on 2.1&lt;/p&gt;</comment>
                            <comment id="14111492" author="philipthompson" created="Tue, 26 Aug 2014 22:42:12 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-5202&quot; title=&quot;CFs should have globally and temporally unique CF IDs to prevent &amp;quot;reusing&amp;quot; data from earlier incarnation of same CF name&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-5202&quot;&gt;&lt;del&gt;CASSANDRA-5202&lt;/del&gt;&lt;/a&gt; should prevent the behavior that is currently occurring on 2.1 though, yes?&lt;/p&gt;</comment>
                            <comment id="14111497" author="iamaleksey" created="Tue, 26 Aug 2014 22:47:19 +0000"  >&lt;p&gt;It&apos;s not &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-5202&quot; title=&quot;CFs should have globally and temporally unique CF IDs to prevent &amp;quot;reusing&amp;quot; data from earlier incarnation of same CF name&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-5202&quot;&gt;&lt;del&gt;CASSANDRA-5202&lt;/del&gt;&lt;/a&gt; related, it&apos;s slightly trickier than that. Will elaborate tomorrow.&lt;/p&gt;</comment>
                            <comment id="14112106" author="iamaleksey" created="Wed, 27 Aug 2014 10:06:50 +0000"  >&lt;p&gt;Okay. 2.0 behaves like this because for several C* version we&apos;ve mistakenly used millisecond-precision timestamps for counter cells. The timestamp of a column drop, however, is correctly recorded in microseconds. So, a dropped counter column on 2.0, if recreated, will never work. This was fixed in &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-7346&quot; title=&quot;Modify reconcile logic to always pick a tombstone over a counter cell&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-7346&quot;&gt;&lt;del&gt;CASSANDRA-7346&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;And it doesn&apos;t entirely work with 2.1 (includes the previous value), because removing dropped columns from the read values happens after reconcile, and counters reconcile differently from regular cells.&lt;/p&gt;

&lt;p&gt;There is no good fix for 2.0 (aside from special-casing counters and do an extra / 1000 division, but that would give you wrong results during 2.0-&amp;gt;2.1 upgrade, which is unacceptable).&lt;/p&gt;

&lt;p&gt;So until maybe we push dropped columns machinery deeper in the storage engine, I suggest simply rejecting ALTER TABLE ADD if a counter column with this name had been dropped in the past.&lt;/p&gt;</comment>
                            <comment id="14112289" author="jbellis" created="Wed, 27 Aug 2014 14:30:53 +0000"  >&lt;blockquote&gt;&lt;p&gt;until maybe we push dropped columns machinery deeper in the storage engine, I suggest simply rejecting ALTER TABLE ADD if a counter column with this name had been dropped in the past.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;We don&apos;t track dropped columns explicitly anywhere, do we?  Is adding that really so much simpler than fixing it?&lt;/p&gt;</comment>
                            <comment id="14112315" author="iamaleksey" created="Wed, 27 Aug 2014 15:04:29 +0000"  >&lt;blockquote&gt;&lt;p&gt;We don&apos;t track dropped columns explicitly anywhere, do we? Is adding that really so much simpler than fixing it?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;WDYM? Of course we track them (in dropped_columns of system.schema_columnfamilies). So throwing an exception is definitely easier (and the only solution for 2.0 anyway).&lt;/p&gt;</comment>
                            <comment id="14112650" author="iamaleksey" created="Wed, 27 Aug 2014 18:59:15 +0000"  >&lt;p&gt;Attaching a trivial 2.0 patch. Will add a dtest post-commit, if we go this route.&lt;/p&gt;</comment>
                            <comment id="14112661" author="philipthompson" created="Wed, 27 Aug 2014 19:07:25 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=iamaleksey&quot; class=&quot;user-hover&quot; rel=&quot;iamaleksey&quot;&gt;iamaleksey&lt;/a&gt; No need to add a dtest, I can do so.&lt;/p&gt;</comment>
                            <comment id="14112755" author="jbellis" created="Wed, 27 Aug 2014 20:07:30 +0000"  >&lt;p&gt;+1&lt;/p&gt;</comment>
                            <comment id="14113755" author="iamaleksey" created="Thu, 28 Aug 2014 13:39:01 +0000"  >&lt;p&gt;Committed, thanks.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=philipthompson&quot; class=&quot;user-hover&quot; rel=&quot;philipthompson&quot;&gt;philipthompson&lt;/a&gt; sure, go ahead.&lt;/p&gt;</comment>
                            <comment id="14113764" author="philipthompson" created="Thu, 28 Aug 2014 13:49:00 +0000"  >&lt;p&gt;Dtest for this behavior committed at &lt;a href=&quot;https://github.com/riptano/cassandra-dtest/commit/18de5d7dd248e7632fb85993b54e94bcab79bff7&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/riptano/cassandra-dtest/commit/18de5d7dd248e7632fb85993b54e94bcab79bff7&lt;/a&gt; . It is passing on 2.0 and 2.1 after Aleksey&apos;s commit.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12664711" name="7831.txt" size="935" author="aleksey" created="Wed, 27 Aug 2014 18:59:15 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[aleksey]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            11 years, 12 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1zcdb:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12311421" key="com.atlassian.jira.plugin.system.customfieldtypes:multiversion">
                        <customfieldname>Reproduced In</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="12326830">2.0.9</customfieldvalue>
    <customfieldvalue id="12327164">2.0.10</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>jbellis</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[jbellis]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12962"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311124" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Tester</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>philipthompson</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>