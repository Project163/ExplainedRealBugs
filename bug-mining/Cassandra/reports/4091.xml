<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 23:00:58 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-10779] Mutations do not block for completion under view lock contention</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-10779</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;Hi guys,&lt;/p&gt;

&lt;p&gt;I encountered the following warning message when I was testing to upgrade from v2.2.2 to v3.0.0. &lt;/p&gt;

&lt;p&gt;It looks like a write time-out but in an uncaught exception. Could this be an easy fix?&lt;/p&gt;

&lt;p&gt;Log file section below. Thank you!&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;	WARN  [SharedPool-Worker-64] 2015-11-26 14:04:24,678 AbstractTracingAwareExecutorService.java:169 - Uncaught exception on thread &lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;[SharedPool-Worker-64,10,main]: {}
org.apache.cassandra.exceptions.WriteTimeoutException: Operation timed out - received only 0 responses.
		at org.apache.cassandra.db.Keyspace.apply(Keyspace.java:427) ~[apache-cassandra-3.0.0.jar:3.0.0]
		at org.apache.cassandra.db.Keyspace.apply(Keyspace.java:386) ~[apache-cassandra-3.0.0.jar:3.0.0]
		at org.apache.cassandra.db.Mutation.apply(Mutation.java:205) ~[apache-cassandra-3.0.0.jar:3.0.0]
		at org.apache.cassandra.db.Keyspace.lambda$apply$59(Keyspace.java:435) ~[apache-cassandra-3.0.0.jar:3.0.0]
		at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511) ~[na:1.8.0_60]
		at org.apache.cassandra.concurrent.AbstractTracingAwareExecutorService$FutureTask.run(AbstractTracingAwareExecutorService.java:164) ~[apache-cassandra-3.0.0.jar:3.0.0]
		at org.apache.cassandra.concurrent.SEPWorker.run(SEPWorker.java:105) [apache-cassandra-3.0.0.jar:3.0.0]
		at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:745) [na:1.8.0_60]
	INFO  [IndexSummaryManager:1] 2015-11-26 14:41:10,527 IndexSummaryManager.java:257 - Redistributing index summaries
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment>&lt;p&gt;Windows 7 64-bit, Cassandra v3.0.0, Java 1.8u60&lt;/p&gt;</environment>
        <key id="12916618">CASSANDRA-10779</key>
            <summary>Mutations do not block for completion under view lock contention</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10002" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Normal</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="carlyeks">Carl Yeksigian</assignee>
                                    <reporter username="esvhd">Will Zhang</reporter>
                        <labels>
                    </labels>
                <created>Fri, 27 Nov 2015 11:56:51 +0000</created>
                <updated>Tue, 16 Apr 2019 09:30:49 +0000</updated>
                            <resolved>Wed, 3 Feb 2016 14:33:41 +0000</resolved>
                                        <fixVersion>3.0.3</fixVersion>
                    <fixVersion>3.3</fixVersion>
                                    <component>Feature/Materialized Views</component>
                    <component>Legacy/Local Write-Read Paths</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="15029890" author="slebresne" created="Fri, 27 Nov 2015 13:53:38 +0000"  >&lt;p&gt;Assigning to &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=carlyeks&quot; class=&quot;user-hover&quot; rel=&quot;carlyeks&quot;&gt;carlyeks&lt;/a&gt; since that&apos;s Materialized Views related. It does sound like the write timeout should be somehow propagated to the original method call, but that&apos;s incompatible with dealing with that case (where you can&apos;t acquire the lock right away) asynchronously, so not sure what&apos;s the best solution here.&lt;/p&gt;</comment>
                            <comment id="15064642" author="carlyeks" created="Fri, 18 Dec 2015 19:52:43 +0000"  >&lt;p&gt;I think there is a different issue lurking here, which is that we are responding to mutations early on the replicas if we don&apos;t acquire the lock right away. We are returning early from the &lt;tt&gt;mutation.apply&lt;/tt&gt; call because we were unable to acquire the lock, but in the &lt;tt&gt;MutationVerbHandler&lt;/tt&gt;, we&apos;re only don&apos;t reply in the case we get a WTE (which only happens in the MV path).&lt;/p&gt;

&lt;p&gt;The reason we changed this to put itself back on the queue when it was unable to acquire the lock was that we would otherwise be blocking other mutations that are waiting, especially the coordinator batchlog mutations. Since we aren&apos;t doing the coordinator batchlog, it might be best to just switch back to waiting for the lock synchronously. The other option would be to include a callback function with the mutation to run on success/failure.&lt;/p&gt;

&lt;p&gt;I&apos;m currently testing the impact of changing this to acquiring the lock synchronously; I&apos;ll also look into the amount of change required to add callback functions.&lt;/p&gt;</comment>
                            <comment id="15111619" author="thobbs" created="Thu, 21 Jan 2016 23:45:08 +0000"  >&lt;p&gt;I&apos;ve introduced a CompletableFuture which is only created and used when lock contention is encountered.  This allows &lt;tt&gt;Keyspace.apply()&lt;/tt&gt; calls to be synchronous without adding overhead to the non-contended path.&lt;/p&gt;

&lt;p&gt;Here are the branches and pending tests:&lt;/p&gt;

&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;branch&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;testall&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;dtest&lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/thobbs/cassandra/tree/CASSANDRA-10779&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;CASSANDRA-10779&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/thobbs/job/thobbs-CASSANDRA-10779-testall&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;testall&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/thobbs/job/thobbs-CASSANDRA-10779-dtest&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;dtest&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/thobbs/cassandra/tree/CASSANDRA-10779-3.3&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;CASSANDRA-10779-3.3&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/thobbs/job/thobbs-CASSANDRA-10779-3.3-testall&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;testall&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/thobbs/job/thobbs-CASSANDRA-10779-3.3-dtest&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;dtest&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/thobbs/cassandra/tree/CASSANDRA-10779-trunk&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;CASSANDRA-10779-trunk&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/thobbs/job/thobbs-CASSANDRA-10779-trunk-testall&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;testall&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/thobbs/job/thobbs-CASSANDRA-10779-trunk-dtest&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;dtest&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;


&lt;p&gt;Only the trunk merge had conflicts (due to &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-10981&quot; title=&quot;Consider striping view locks by key and cfid&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-10981&quot;&gt;&lt;del&gt;CASSANDRA-10981&lt;/del&gt;&lt;/a&gt;).&lt;/p&gt;</comment>
                            <comment id="15112604" author="carlyeks" created="Fri, 22 Jan 2016 16:19:08 +0000"  >&lt;p&gt;This will still block the current thread since we are calling &lt;tt&gt;.get()&lt;/tt&gt; on the Future, and also reschedule the task to happen on the &lt;tt&gt;Mutation&lt;/tt&gt; stage. This is equivalent to having a synchronous wait for the view lock, but also adds another task to the mutation queue, taking up another thread&apos;s work.&lt;/p&gt;

&lt;p&gt;We need to push the &lt;tt&gt;CompletableFuture&lt;/tt&gt; all the way up to the network reply, and reply if it is null or use &lt;tt&gt;thenApply&lt;/tt&gt; to reply after the &lt;tt&gt;CompletableFuture&lt;/tt&gt; is completed.&lt;/p&gt;</comment>
                            <comment id="15112892" author="thobbs" created="Fri, 22 Jan 2016 19:10:50 +0000"  >&lt;p&gt;Since &lt;tt&gt;Striped&lt;/tt&gt; actually uses &lt;tt&gt;ReentrantLocks&lt;/tt&gt;, it turns out a blocking solution works for my purposes.  I&apos;ve pushed a second branch with blocking lock acquisition.  As discussed, it uses &lt;tt&gt;bulkGet()&lt;/tt&gt; to ensure lock acquisition order is consistent (avoiding deadlock):&lt;/p&gt;

&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;branch&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;testall&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;dtest&lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/thobbs/cassandra/tree/CASSANDRA-10779-v2&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;CASSANDRA-10779-v2&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/thobbs/job/thobbs-CASSANDRA-10779-v2-testall&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;testall&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/thobbs/job/thobbs-CASSANDRA-10779-v2-dtest&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;dtest&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/thobbs/cassandra/tree/CASSANDRA-10779-v2-3.3&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;CASSANDRA-10779-v2-3.3&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/thobbs/job/thobbs-CASSANDRA-10779-v2-3.3-testall&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;testall&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/thobbs/job/thobbs-CASSANDRA-10779-v2-3.3-dtest&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;dtest&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/thobbs/cassandra/tree/CASSANDRA-10779-v2-trunk&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;CASSANDRA-10779-v2-trunk&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/thobbs/job/thobbs-CASSANDRA-10779-v2-trunk-testall&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;testall&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/thobbs/job/thobbs-CASSANDRA-10779-v2-trunk-dtest&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;dtest&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;


&lt;p&gt;The trunk merge was the only non-trivial one.&lt;/p&gt;</comment>
                            <comment id="15112903" author="tjake" created="Fri, 22 Jan 2016 19:21:18 +0000"  >&lt;p&gt;I don&apos;t see how this is going to help.  The issue is lock contention and blocking just makes it worse &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;I&apos;ll run some mvbench runs with your patch to back this up.  I think we need to make the completable future approach send the response as Carl mentioned above&lt;/p&gt;</comment>
                            <comment id="15112920" author="thobbs" created="Fri, 22 Jan 2016 19:26:03 +0000"  >&lt;p&gt;Well, the &lt;em&gt;real&lt;/em&gt; issue is responding before a mutation has been applied, which is a correctness/durability issue.  We just need to make sure to fix that in a way that doesn&apos;t severely hamper performance.  I was already talking with &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=carlyeks&quot; class=&quot;user-hover&quot; rel=&quot;carlyeks&quot;&gt;carlyeks&lt;/a&gt; about benchmarking these solutions before committing (which I think we do need to do), but I&apos;m not convinced that this approach will have worse performance than the current solution under contention.&lt;/p&gt;</comment>
                            <comment id="15112923" author="carlyeks" created="Fri, 22 Jan 2016 19:26:42 +0000"  >&lt;p&gt;This ticket isn&apos;t about solving the contention, but about making the behavior correct in the face of contention. This patch fixes that issue by making sure we don&apos;t respond back before we have actually completed the work.&lt;/p&gt;

&lt;p&gt;While moving to CompletableFutures would solve both, it&apos;s a far more invasive change than this one, so it makes sense to know what the change in performance is.&lt;/p&gt;</comment>
                            <comment id="15115679" author="tjake" created="Mon, 25 Jan 2016 18:09:40 +0000"  >&lt;p&gt;I&apos;m trying to explain the reason for non-blocking the Mutation stage.  For example this patch would block all non-mv mutations (including system keyspaces) if we encounter (write stage pool size MV writes on the same lock).&lt;/p&gt;

&lt;p&gt;If we decide to go with the non completable future approach then I would suggest we reintroduce the MV Write stage. So we don&apos;t block non MV mutations.&lt;/p&gt;</comment>
                            <comment id="15122100" author="carlyeks" created="Thu, 28 Jan 2016 18:53:57 +0000"  >&lt;p&gt;I put together a limited change to use completable futures only from the Mutation Verb handler, which seems to allow other mutations through while fixing the issue of not blocking with contention.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/carlyeks/cassandra/tree/ticket/10779/completableFuture&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;branch&lt;/a&gt; &lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/carlyeks/job/carlyeks-ticket-10779-completableFuture-testall/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;utest&lt;/a&gt; &lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/carlyeks/job/carlyeks-ticket-10779-completableFuture-dtest/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;dtest&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15122464" author="tjake" created="Thu, 28 Jan 2016 22:42:23 +0000"  >&lt;p&gt;I ran highly contended mvbench runs with 3.0 branch, Tyler&apos;s v2 branch and Carl&apos;s completable future test.  &lt;/p&gt;

&lt;p&gt;Both thobbs and carls fixes the timeout issue, but when I add a stress write workload running along side the view benchmark Tylers branch causes stress to timeout because the write stage is blocked waiting on the contended locks. In Carl&apos;s version this doesn&apos;t happen since the mutations are put back on the queue freeing threads to work on other things. So I think we should go with Carl&apos;s version.&lt;/p&gt;

&lt;p&gt;In the case of an uncontended mvbench run (no lock contention) there is no difference in performance between the current 3.0 branch and Carl&apos;s branch.&lt;/p&gt;

&lt;p&gt;In the highly contended case as we are now waiting before acking the write the performance has dropped to be 50% worse than non-mv.  However I think we can fix this by improving lock contention &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-10307&quot; title=&quot;Avoid always locking the partition key when a table has a materialized view&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-10307&quot;&gt;CASSANDRA-10307&lt;/a&gt;&lt;/p&gt;




</comment>
                            <comment id="15123891" author="thobbs" created="Fri, 29 Jan 2016 18:05:13 +0000"  >&lt;p&gt;Thanks for the benchmarks, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tjake&quot; class=&quot;user-hover&quot; rel=&quot;tjake&quot;&gt;tjake&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;I&apos;m good with going with passing the CompletableFuture up the stack, we just need to make sure all of the calling locations are blocking when necessary.  It looks like we&apos;re missing a few.&lt;/p&gt;</comment>
                            <comment id="15124020" author="carlyeks" created="Fri, 29 Jan 2016 19:16:14 +0000"  >&lt;p&gt;I pushed a change so that we only use the CompletableFuture in mutation verb handler; otherwise we call &lt;tt&gt;.get()&lt;/tt&gt; to turn it back into a synchronous call for the other places.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tjake&quot; class=&quot;user-hover&quot; rel=&quot;tjake&quot;&gt;tjake&lt;/a&gt; kicked off new runs, so we&apos;ll see how it fares. We should get one or the other committed before we code freeze 3.3.  &lt;/p&gt;</comment>
                            <comment id="15124163" author="tjake" created="Fri, 29 Jan 2016 20:38:21 +0000"  >&lt;p&gt;No difference in the tests with the new changes.  Likely due to the fact the mvbench test runs at quorum so the coordinator was waiting on the verb response&lt;/p&gt;</comment>
                            <comment id="15126617" author="thobbs" created="Mon, 1 Feb 2016 17:40:18 +0000"  >&lt;p&gt;There&apos;s still one more call path that needs to be updated:  &lt;tt&gt;PaxosState.commit()&lt;/tt&gt; calls &lt;tt&gt;Keyspace.apply()&lt;/tt&gt; and doesn&apos;t block on the future.  Other than that, the latest patch looks good to me.&lt;/p&gt;</comment>
                            <comment id="15126929" author="carlyeks" created="Mon, 1 Feb 2016 20:06:24 +0000"  >&lt;p&gt;Also CommitLogReplay; made those changes and am rerunning the tests now.&lt;/p&gt;</comment>
                            <comment id="15127144" author="carlyeks" created="Mon, 1 Feb 2016 22:10:13 +0000"  >&lt;p&gt;Test run was clean. Committed as &lt;a href=&quot;https://git1-us-west.apache.org/repos/asf?p=cassandra.git;a=commit;h=839a5bab2a7f5385a878e5dc5f8b01bda28fa777&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;839a5ba&lt;/a&gt; and merged forward.&lt;/p&gt;</comment>
                            <comment id="15128282" author="carlyeks" created="Tue, 2 Feb 2016 14:06:33 +0000"  >&lt;p&gt;Looks like we missed a couple of other usages &amp;#8211; Mutation.applyUnsafe() and apply(boolean).&lt;/p&gt;

&lt;p&gt;I pushed a new commit and am running CI now:&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/carlyeks/cassandra/commit/f6e40afb73dc9f5b1b2e57e96ed98e7356d48c6d&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;commit&lt;/a&gt; &lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/carlyeks/job/carlyeks-ticket-10779-fix-blocks-testall/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;utest&lt;/a&gt; &lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/carlyeks/job/carlyeks-ticket-10779-fix-blocks-dtest/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;dtest&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="15128424" author="slebresne" created="Tue, 2 Feb 2016 15:48:07 +0000"  >&lt;p&gt;I don&apos;t know if that&apos;s why you re-opened, but this seems to have broken &lt;tt&gt;materialized_views_test.TestMaterializedViewsConsistency.single_partition_consistent_reads_after_write_test&lt;/tt&gt;.&lt;/p&gt;</comment>
                            <comment id="15130363" author="carlyeks" created="Wed, 3 Feb 2016 13:14:57 +0000"  >&lt;p&gt;The test runs look good. I&apos;ve opened a PR for the &lt;a href=&quot;https://github.com/riptano/cassandra-dtest/pull/782&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;dtest&lt;/a&gt; to ignore that error; the test itself completed successfully.&lt;/p&gt;</comment>
                            <comment id="15130387" author="tjake" created="Wed, 3 Feb 2016 13:33:30 +0000"  >&lt;p&gt;Agreed the test is a non-issue +1&lt;/p&gt;</comment>
                            <comment id="15130392" author="carlyeks" created="Wed, 3 Feb 2016 13:36:43 +0000"  >&lt;p&gt;Committed as &lt;a href=&quot;https://git1-us-west.apache.org/repos/asf?p=cassandra.git;a=commit;h=c4d83f1ba31735963b451beb38a553c92145d5d4&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;c4d83f1&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="15130418" author="slebresne" created="Wed, 3 Feb 2016 13:58:54 +0000"  >&lt;blockquote&gt;&lt;p&gt;Agreed the test is a non-issue +1&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I&apos;m not sure I agree. That message is logged due to a timeout, which is not a real error as far as C* is concerned, and logging like that could easily flood the log with a not too useful message. In fact, it appears the place where the exception is throw was explicitly trying to ignore timeouts, but the timeout is wrapped by a &lt;tt&gt;RuntimeException&lt;/tt&gt; so it get through. I think we better fix that.&lt;/p&gt;

&lt;p&gt;In general, the MV tests don&apos;t do anything terribly nasty, so having them log anything at ERROR is definitively a bad smell.&lt;/p&gt;</comment>
                            <comment id="15130477" author="carlyeks" created="Wed, 3 Feb 2016 14:33:41 +0000"  >&lt;p&gt;Third time is the charm. Committed in &lt;a href=&quot;https://git1-us-west.apache.org/repos/asf?p=cassandra.git;a=commit;h=5f1e4bcad7d36feb97096c6149ad3c43f26f0fd9&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;5f1e4bc&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="15130504" author="carlyeks" created="Wed, 3 Feb 2016 14:45:40 +0000"  >&lt;p&gt;I mistakenly wrapped the ExecutionException&apos;s cause in a RuntimeException, when we should have been propogating it. Changed to use Throwables.propagate instead so that we get back the WriteTimeoutException instead of a RE.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="13020295">CASSANDRA-12905</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[carlyeks]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 41 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2p0an:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>thobbs</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[thobbs]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12962"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12311420" key="com.atlassian.jira.plugin.system.customfieldtypes:version">
                        <customfieldname>Since Version</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="12333891">3.0.0</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12311124" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Tester</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>tjake</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>