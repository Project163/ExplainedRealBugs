<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 22:29:29 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-3921] Compaction doesn&apos;t clear out expired tombstones from SerializingCache</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-3921</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;Compaction calls removeDeletedInCache, which looks like this:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;.   &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void removeDeletedInCache(DecoratedKey key)
    {
        ColumnFamily cachedRow = cfs.getRawCachedRow(key);
        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (cachedRow != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;)
            ColumnFamilyStore.removeDeleted(cachedRow, gcBefore);
    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;For the SerializingCache, this means it calls removeDeleted on a temporary, deserialized copy, which leaves the cache contents unaffected.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12542796">CASSANDRA-3921</key>
            <summary>Compaction doesn&apos;t clear out expired tombstones from SerializingCache</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10003" iconUrl="https://issues.apache.org/jira/images/icons/priorities/trivial.svg">Low</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="jbellis">Jonathan Ellis</assignee>
                                    <reporter username="jbellis">Jonathan Ellis</reporter>
                        <labels>
                    </labels>
                <created>Wed, 15 Feb 2012 23:56:17 +0000</created>
                <updated>Tue, 16 Apr 2019 09:32:39 +0000</updated>
                            <resolved>Thu, 16 Feb 2012 15:28:14 +0000</resolved>
                                        <fixVersion>1.1.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                                                                <comments>
                            <comment id="13208986" author="jbellis" created="Wed, 15 Feb 2012 23:57:07 +0000"  >&lt;p&gt;I&apos;m not sure what the right fix is.  We could invalidate the row, but that means a big compaction could wipe out the row cache entirely, which is worse.  Should we just wontfix this?&lt;/p&gt;</comment>
                            <comment id="13209048" author="scode" created="Thu, 16 Feb 2012 01:30:40 +0000"  >&lt;p&gt;With a typical workload, not evicting it would just fail to &quot;optimize&quot; - you have to wait for the data to get dropped out of cache.&lt;/p&gt;

&lt;p&gt;But if you do have a use-case where you have a lot of requests to non-existent data, this could &quot;silently&quot; render the row caches almost useless in a way that is very hard to detect. Suppose you have rows with a hot set where you want caching, but the data is made up of &quot;churning&quot; columns (insertions/deletions; the set of columns constantly  But, the &quot;damaged&quot; is limited to the ratio of requests for empty rows vs. other requests, and is less prominent the bigger the average requested row in relation to the size of a tombstone.&lt;/p&gt;

&lt;p&gt;The above should be true if the rows in cache only contain the tombstones.&lt;/p&gt;

&lt;p&gt;But consider a use-case where you have rows (hot) that gets constantly updated with insertion/deletion (let&apos;s say it has 1-5 columns at any point in time, with columns constantly &quot;churned&quot;). How you have something which is hot in cache due to reads (for the ones in hot set), data being over-written, and the per-row average size increasing over time. Cache locality becomes worse and worse and no one can see why, and a restart magically fixes it. This should hold true as long as row cache entries aren&apos;t entirely re-read on writes, which would in part defeat the purpose of caching (but I realize now I&apos;m not sure what we do here).&lt;/p&gt;</comment>
                            <comment id="13209202" author="slebresne" created="Thu, 16 Feb 2012 07:59:26 +0000"  >&lt;p&gt;Yeah, it&apos;s the serializing cache, we invalidate on each put, so the chance of tons of tombstone building up overtime is anecdotal imo. We could probably fix this by cloning the cachedRow after the get, apply removeDeleted on the clone and do a conditional replace (if it&apos;s still the value we got). This involve a bunch of serialization/deserialization so it&apos;s unclear that doing that is a better optimization than leaving the tombstone. So I&apos;m good leaving it the way it is. Except that we may want to make removeDeletedInCache be a noop for copying caches just to avoid the useless deserialization. &lt;/p&gt;</comment>
                            <comment id="13209211" author="scode" created="Thu, 16 Feb 2012 08:10:55 +0000"  >&lt;p&gt;If we invalidate on every put, I&apos;m +1 on just ignoring the problem. Sure, it&apos;s possible to have a constant subset of a hotset repeatedly read, and someone making an attempt to make it take less space in cache by deleting data and waiting for tombstones... but that&apos;s so obscure/extreme that we can probably fix 500 other JIRA:s before this is a priority &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; Definitely +1 on NOOP:ing the method though; or more importantly, documenting why it&apos;s a NOOP.&lt;/p&gt;

&lt;p&gt;(Btw the incoherence of my previous comment is what happens when you split the posting of a comment in two pieces with a meeting in between...)&lt;/p&gt;</comment>
                            <comment id="13209432" author="jbellis" created="Thu, 16 Feb 2012 15:28:14 +0000"  >&lt;blockquote&gt;&lt;p&gt;we may want to make removeDeletedInCache be a noop for copying caches just to avoid the useless deserialization&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;done in 94860c6c3713cda4f17dabb2ac2ce30cfe92f6e2&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[jbellis]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>228082</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            13 years, 40 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0gptz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>95615</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>slebresne</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[slebresne]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12961"><![CDATA[Low]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>