<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 23:09:31 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-13717] INSERT statement fails when Tuple type is used as clustering column with default DESC order</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-13717</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;When a column family is created and a Tuple is used on clustering column with default clustering order DESC, then the INSERT statement fails. &lt;/p&gt;

&lt;p&gt;For example, the following table will make the INSERT statement fail with error message &quot;Invalid tuple type literal for tdemo of type frozen&amp;lt;tuple&amp;lt;timestamp, text&amp;gt;&amp;gt;&quot; , although the INSERT statement is correct (works as expected when the default order is ASC)&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;create table test_table (
	id int,
	tdemo tuple&amp;lt;timestamp, varchar&amp;gt;,
	primary key (id, tdemo)
) with clustering order by (tdemo desc);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment>&lt;p&gt;Cassandra 3.11&lt;/p&gt;</environment>
        <key id="13089042">CASSANDRA-13717</key>
            <summary>INSERT statement fails when Tuple type is used as clustering column with default DESC order</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10000" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Urgent</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="skonto">Stavros Kontopoulos</assignee>
                                    <reporter username="akichidis">Anastasios Kichidis</reporter>
                        <labels>
                    </labels>
                <created>Fri, 21 Jul 2017 13:28:30 +0000</created>
                <updated>Fri, 15 May 2020 08:04:59 +0000</updated>
                            <resolved>Tue, 12 Sep 2017 21:19:27 +0000</resolved>
                                        <fixVersion>3.0.15</fixVersion>
                    <fixVersion>3.11.1</fixVersion>
                    <fixVersion>4.0-alpha1</fixVersion>
                    <fixVersion>4.0</fixVersion>
                                    <component>Legacy/Core</component>
                    <component>Legacy/CQL</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="16096262" author="akichidis" created="Fri, 21 Jul 2017 13:36:18 +0000"  >&lt;p&gt;After some quick debugging I saw that this error is thrown because of the tuple validation on Tuples.java:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;        if (!(receiver.type instanceof TupleType))
            throw invalidRequest(&quot;Invalid tuple type literal for %s of type %s&quot;, receiver.name, receiver.type.asCQL3Type());
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;When the default ordering on tuple is DESC, the &lt;b&gt;receiver.type&lt;/b&gt; is instance of type &lt;b&gt;ReversedType&lt;/b&gt; and not &lt;b&gt;TupleType&lt;/b&gt; . However, I don&apos;t have the expertise to know the cause of this.&lt;/p&gt;</comment>
                            <comment id="16096873" author="jjirsa" created="Fri, 21 Jul 2017 21:09:32 +0000"  >&lt;p&gt;There are a bunch of cases in &lt;tt&gt;Tuples.java&lt;/tt&gt; where we check &lt;tt&gt;instanceof TupleType&lt;/tt&gt; that are probably wrong in the case that it&apos;s Reversed. I suspect we should be checking if the &lt;tt&gt;baseType&lt;/tt&gt; (which is already public) of the &lt;tt&gt;ReversedType&lt;/tt&gt; is a Tuple.&lt;/p&gt;</comment>
                            <comment id="16120927" author="skonto" created="Thu, 10 Aug 2017 01:44:19 +0000"  >&lt;p&gt;I have created a patch and verified Jeff&apos;s suggestion:&lt;br/&gt;
&lt;a href=&quot;https://drive.google.com/open?id=0B0SeiqgJaLZvclhmY0N4dEJtUGs&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;patch&lt;/a&gt;&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;cqlsh&amp;gt; create keyspace test with replication = {&apos;class&apos;:&apos;SimpleStrategy&apos;,&apos;replication_factor&apos;: 1};cqlsh&amp;gt; create table test.test_table ( id int, tdemo tuple&amp;lt;timestamp, varchar&amp;gt;, primary key (id, tdemo) ) with clustering order by (tdemo desc);
cqlsh&amp;gt; insert into test.test_table (id, tdemo) values (1, (&apos;2017-02-03 03:05+0000&apos;,&apos;Europe&apos;));
cqlsh&amp;gt; select * from test.test_table;
 id | tdemo
----+-----------------------------------------------
  1 | (&apos;2017-02-03 03:05:00.000000+0000&apos;, &apos;Europe&apos;)

(1 rows)

&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;What are the next steps for the review (I am new here)?&lt;/p&gt;</comment>
                            <comment id="16120932" author="jjirsa" created="Thu, 10 Aug 2017 01:52:50 +0000"  >&lt;p&gt;Welcome &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=skonto&quot; class=&quot;user-hover&quot; rel=&quot;skonto&quot;&gt;skonto&lt;/a&gt; ! Next step would be to assign yourself (I&apos;ve done that for you), and then hit &apos;submit patch&apos; to mark the issue as patch available (I&apos;ve done that for you again).&lt;/p&gt;

&lt;p&gt;We typically ask either the contributor (you) or the reviewer (someone who will volunteer, hopefully soon) to push the patch to a github branch and kick off CI (we have it setup to use circleci for unit tests, and a committer can kick off dtests). We typically ask that your patch includes a test case that fails before your patch and succeeds after it&apos;s applied, so while this is not a review, I will say that any reviewer should ask you to do that. &lt;/p&gt;
</comment>
                            <comment id="16120960" author="skonto" created="Thu, 10 Aug 2017 02:37:44 +0000"  >&lt;p&gt;Thnx &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jjirsa&quot; class=&quot;user-hover&quot; rel=&quot;jjirsa&quot;&gt;jjirsa&lt;/a&gt; ! Here is my branch: &lt;a href=&quot;https://github.com/skonto/cassandra/tree/cassandra-13717&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/skonto/cassandra/tree/cassandra-13717&lt;/a&gt;. As for the test case I read the contribution wiki etc... still a bit confused where should I add it? In dtests or just part of the patch?&lt;/p&gt;</comment>
                            <comment id="16120965" author="jjirsa" created="Thu, 10 Aug 2017 02:43:06 +0000"  >&lt;p&gt;I typically prefer keeping them in unit tests (junit tests in the same repo, check out the test/ directory). There should be a section for cql3 tests, and almost certainly a TupleTest within it that you can add a function or two to.&lt;/p&gt;</comment>
                            <comment id="16121048" author="jjirsa" created="Thu, 10 Aug 2017 04:41:00 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=skonto&quot; class=&quot;user-hover&quot; rel=&quot;skonto&quot;&gt;skonto&lt;/a&gt; - do you know which versions need to be fixed? 3.0? 3.11? trunk?&lt;/p&gt;

&lt;p&gt;I&apos;ve kicked off some test builds &lt;a href=&quot;https://circleci.com/gh/jeffjirsa/cassandra/tree/cassandra-13717&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;here (unit tests)&lt;/a&gt; and &lt;a href=&quot;https://builds.apache.org/view/A-D/view/Cassandra/job/Cassandra-devbranch-dtest/173&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;here (dtest)&lt;/a&gt; - we&apos;ll want to do that for each branch that needs this fix (and of course, we&apos;ll want to add tests to this fix as well).&lt;/p&gt;</comment>
                            <comment id="16121472" author="skonto" created="Thu, 10 Aug 2017 11:13:48 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jjirsa&quot; class=&quot;user-hover&quot; rel=&quot;jjirsa&quot;&gt;jjirsa&lt;/a&gt; I fixed it for trunk (version 4). I could backport it to 3.11 (version reported) as soon as it is verified that this fix is ok.&lt;br/&gt;
Good to know about the test procedure, thanx a lot! I will check the unit tests.&lt;/p&gt;</comment>
                            <comment id="16121536" author="skonto" created="Thu, 10 Aug 2017 12:26:39 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jjirsa&quot; class=&quot;user-hover&quot; rel=&quot;jjirsa&quot;&gt;jjirsa&lt;/a&gt; I added a test there in TupleTypeTest, updated the branch. How can I update the patch? &lt;br/&gt;
Should I cancel it and add a new one?&lt;/p&gt;</comment>
                            <comment id="16134567" author="skonto" created="Sun, 20 Aug 2017 20:53:46 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jjirsa&quot; class=&quot;user-hover&quot; rel=&quot;jjirsa&quot;&gt;jjirsa&lt;/a&gt; Any update or something I should do?&lt;/p&gt;</comment>
                            <comment id="16162134" author="jasobrown" created="Mon, 11 Sep 2017 22:21:23 +0000"  >&lt;p&gt;This bug exists in 3.0, as well - perhaps earlier, but even if it does this doesn&apos;t meet the bar of being &apos;critical&apos; to patch 2.x for.&lt;/p&gt;</comment>
                            <comment id="16162195" author="jasobrown" created="Mon, 11 Sep 2017 23:03:30 +0000"  >&lt;p&gt;backported the patch to 3.0 and 3.11, and running tests now:&lt;/p&gt;

&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;3.0&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;3.11&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;trunk&lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/jasobrown/cassandra/tree/13717-3.0&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;branch&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/jasobrown/cassandra/tree/13717-3.11&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;branch&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/jasobrown/cassandra/tree/13717-trunk&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;branch&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://builds.apache.org/view/A-D/view/Cassandra/job/Cassandra-devbranch-dtest/298/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;dtest&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://builds.apache.org/view/A-D/view/Cassandra/job/Cassandra-devbranch-dtest/299/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;dtest&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://builds.apache.org/view/A-D/view/Cassandra/job/Cassandra-devbranch-dtest/300/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;dtest&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://circleci.com/gh/jasobrown/cassandra/tree/13717-3.0&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;utests&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://circleci.com/gh/jasobrown/cassandra/tree/13717-3.11&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;utests&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://circleci.com/gh/jasobrown/cassandra/tree/13717-trunk&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;utests&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;
</comment>
                            <comment id="16163672" author="jasobrown" created="Tue, 12 Sep 2017 21:19:27 +0000"  >&lt;p&gt;committed as sha &lt;tt&gt;a08a816a6a3497046ba75a38d76d5095347dfe95&lt;/tt&gt;.&lt;/p&gt;

&lt;p&gt;Thanks!&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12878350" name="example_queries.cql" size="408" author="akichidis" created="Fri, 21 Jul 2017 13:27:07 +0000"/>
                            <attachment id="12881118" name="fix_13717" size="4735" author="jjirsa" created="Thu, 10 Aug 2017 01:51:01 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[skonto]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 10 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3hujr:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12311421" key="com.atlassian.jira.plugin.system.customfieldtypes:multiversion">
                        <customfieldname>Reproduced In</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="12339157">3.11.0</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>jasobrown</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[jasobrown]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12963"><![CDATA[Critical]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>