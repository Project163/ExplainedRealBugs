<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 23:16:24 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-15901] Fix unit tests to load test/conf/cassandra.yaml (so to listen on a valid ip)</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-15901</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;Many of the ci-cassandra jenkins runs fail on &lt;tt&gt;ip-10-0-5-5: Name or service not known&lt;/tt&gt;. &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-15622&quot; title=&quot;Unit tests throw UnknownHostException trying to use `InetAddress.getLocalHost()` instead of `FBUtilities.getLocalAddress()`&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-15622&quot;&gt;&lt;del&gt;CASSANDRA-15622&lt;/del&gt;&lt;/a&gt; addressed some of these but many still remain. Currently test C* nodes are either failing or listening on a public ip depending on which agent they end up.&lt;/p&gt;

&lt;p&gt;The idea behind this ticket is to make ant force the private VPC ip in the cassandra yaml when building, this will force the nodes to listen on the correct ip.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13313438">CASSANDRA-15901</key>
            <summary>Fix unit tests to load test/conf/cassandra.yaml (so to listen on a valid ip)</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10002" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Normal</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="bereng">Berenguer Blasi</assignee>
                                    <reporter username="bereng">Berenguer Blasi</reporter>
                        <labels>
                    </labels>
                <created>Thu, 25 Jun 2020 12:48:53 +0000</created>
                <updated>Thu, 27 Aug 2020 15:00:06 +0000</updated>
                            <resolved>Tue, 7 Jul 2020 09:32:54 +0000</resolved>
                                        <fixVersion>4.0-beta1</fixVersion>
                    <fixVersion>4.0</fixVersion>
                                    <component>Test/dtest/python</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="17144997" author="bereng" created="Thu, 25 Jun 2020 15:05:40 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mck&quot; class=&quot;user-hover&quot; rel=&quot;mck&quot;&gt;mck&lt;/a&gt; This is the POC I came up with. I tested it on a local jenkins and I can see it being effective:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;16:56:29 forceDeviceListenAddress:
16:56:29      [exec] docker0: flags=4099&amp;lt;UP,BROADCAST,MULTICAST&amp;gt;  mtu 1500
16:56:29      [exec]         inet 172.17.0.1  netmask 255.255.0.0  broadcast 172.17.255.255
16:56:29      [exec]         inet6 fe80::42:26ff:fe25:c1e2  prefixlen 64  scopeid 0x20&amp;lt;link&amp;gt;
16:56:29      [exec]         ether 02:42:26:25:c1:e2  txqueuelen 0  (Ethernet)
16:56:29      [exec]         RX packets 78645  bytes 5621831 (5.6 MB)
16:56:29      [exec]         RX errors 0  dropped 0  overruns 0  frame 0
16:56:29      [exec]         TX packets 85630  bytes 1329098560 (1.3 GB)
16:56:29      [exec]         TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0
16:56:29      [exec] 
16:56:29      [exec] lo: flags=73&amp;lt;UP,LOOPBACK,RUNNING&amp;gt;  mtu 65536
16:56:29      [exec]         inet 127.0.0.1  netmask 255.0.0.0
16:56:29      [exec]         inet6 ::1  prefixlen 128  scopeid 0x10&amp;lt;host&amp;gt;
16:56:29      [exec]         loop  txqueuelen 1000  (Local Loopback)
16:56:29      [exec]         RX packets 66296  bytes 21093416 (21.0 MB)
16:56:29      [exec]         RX errors 0  dropped 0  overruns 0  frame 0
16:56:29      [exec]         TX packets 66296  bytes 21093416 (21.0 MB)
16:56:29      [exec]         TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0
16:56:29      [exec] 
16:56:29      [exec] wlp59s0: flags=4163&amp;lt;UP,BROADCAST,RUNNING,MULTICAST&amp;gt;  mtu 1500
16:56:29      [exec]         inet 192.168.1.131  netmask 255.255.255.0  broadcast 192.168.1.255
16:56:29      [exec]         inet6 fe80::9c8e:fcad:d881:ffda  prefixlen 64  scopeid 0x20&amp;lt;link&amp;gt;
16:56:29      [exec]         ether 18:1d:ea:b1:51:48  txqueuelen 1000  (Ethernet)
16:56:29      [exec]         RX packets 6031123  bytes 7766582727 (7.7 GB)
16:56:29      [exec]         RX errors 0  dropped 0  overruns 0  frame 0
16:56:29      [exec]         TX packets 2398356  bytes 1840272042 (1.8 GB)
16:56:29      [exec]         TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0
16:56:29      [exec] 
16:56:29      [echo] ******************* 192.168.1.131
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;You&apos;ll notice that a device is being force upon calling &lt;tt&gt;ifconfig&lt;/tt&gt;. This is bc many ips can match the regexp. On AWS the private ip is on eth0. So I&apos;d suggest this course of action:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Take a look at what I did and see if it makes sense at all&lt;/li&gt;
	&lt;li&gt;If it does we&apos;d need to run it against &lt;tt&gt;eth0&lt;/tt&gt; on all agents and see we indeed get what we expect and tests run ok&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;wdyt?&lt;/p&gt;</comment>
                            <comment id="17146130" author="michaelsembwever" created="Fri, 26 Jun 2020 08:47:02 +0000"  >&lt;p&gt;Quick interjection while i keep looking&#8230; &lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;If it does we&apos;d need to run it against eth0 on all agents and see we indeed get what we expect and tests run ok&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Not all the agents are AWS. Some are virtuals on-premise (e.g. iland). In fact I only know for certain that the Amazon agents are AWS  :shrug:&lt;/p&gt;
</comment>
                            <comment id="17146133" author="michaelsembwever" created="Fri, 26 Jun 2020 08:53:52 +0000"  >&lt;p&gt;Back references:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;example failure stacktrace on &lt;a href=&quot;https://ci-cassandra.apache.org/job/Cassandra-trunk/150/testReport/(root)/_init_/org_apache_cassandra_locator_ReplicaCollectionTest/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;ci-cassandra.a.o&lt;/a&gt;&lt;/li&gt;
	&lt;li&gt;dev ML &lt;a href=&quot;https://lists.apache.org/thread.html/r1a7bc49b0648ec3b4ab9245dc101dc7dfbec51048f83c7128e3989eb%40%3Cdev.cassandra.apache.org%3E&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;post&lt;/a&gt; asking for help&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="17146160" author="bereng" created="Fri, 26 Jun 2020 09:35:11 +0000"  >&lt;p&gt;After discussion with &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mck&quot; class=&quot;user-hover&quot; rel=&quot;mck&quot;&gt;mck&lt;/a&gt; it seems the underlying root cause is that some tests don&apos;t init the daemon. Hence the config/listen_address are never loaded and effective. We came up with the following course of action:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;Make all ci-cass agents fail consistently, so any new tests will get reported.&lt;/li&gt;
	&lt;li&gt;Fix all current tests to init the daemon correctly&lt;/li&gt;
	&lt;li&gt;Once ci-cass is in good shape we can link the report for the commit into the Jira ticket&lt;/li&gt;
	&lt;li&gt;Explore ways to make that fail locally so you get the failure pre-push rather than post-commit/ci-cass run&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="17147668" author="bereng" created="Mon, 29 Jun 2020 10:01:22 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mck&quot; class=&quot;user-hover&quot; rel=&quot;mck&quot;&gt;mck&lt;/a&gt; CI &lt;a href=&quot;https://app.circleci.com/pipelines/github/bereng/cassandra/51/workflows/e5aeb0d3-9bc6-43d1-a45c-8c6f6c3412b1&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;runs&lt;/a&gt; seem ok &amp;amp; tests pass locally as well, besides the OOM but circle was on a partial outage today... Do you think you could run the PR against cassandra13 and see if the issue has been sorted?&lt;/p&gt;</comment>
                            <comment id="17147803" author="michaelsembwever" created="Mon, 29 Jun 2020 13:59:53 +0000"  >&lt;blockquote&gt;&lt;p&gt;Do you think you could run the PR against cassandra13 and see if the issue has been sorted?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Running at &lt;a href=&quot;https://ci-cassandra.apache.org/job/Cassandra-devbranch-test/153/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://ci-cassandra.apache.org/job/Cassandra-devbranch-test/153/&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17147825" author="bereng" created="Mon, 29 Jun 2020 14:21:18 +0000"  >&lt;p&gt;Mmmm they seem to failing already but let it run to get an updated list of failing tests. I&apos;ll start digging...&lt;/p&gt;</comment>
                            <comment id="17147884" author="bereng" created="Mon, 29 Jun 2020 15:26:32 +0000"  >&lt;p&gt;Ok the ones failing on the hostname resolution have gone down from 20-ish to 3 and they look like snowflakes: unsing reflection and other non-std stuff. I&apos;ll fix those tomorrow but looks like we&apos;re on track.&lt;/p&gt;</comment>
                            <comment id="17148621" author="bereng" created="Tue, 30 Jun 2020 12:38:18 +0000"  >&lt;p&gt;The latest run with the latest commit looks ok imo:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;&lt;a href=&quot;https://app.circleci.com/pipelines/github/bereng/cassandra/52/workflows/573ad5be-e34d-4668-a0af-2726d4b35568&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;CI j11&lt;/a&gt; Failure seems unrelated and passes locally&lt;/li&gt;
	&lt;li&gt;&lt;a href=&quot;https://app.circleci.com/pipelines/github/bereng/cassandra/52/workflows/16e15155-7dce-4877-86f5-315c6a837d36&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;CI j8&lt;/a&gt; Seems to be a new flaky test but unrelated to the PR imo. It passes when ran locally but failed once locally on &lt;tt&gt;ant test&lt;/tt&gt;&lt;/li&gt;
	&lt;li&gt;The &lt;a href=&quot;https://ci-cassandra.apache.org/view/patches/job/Cassandra-devbranch-test/156/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;latest&lt;/a&gt; ci-cassandra run looks much better but:
	&lt;ul&gt;
		&lt;li&gt;ActiveRepairServiceTest could be a &lt;a href=&quot;https://ci-cassandra.apache.org/job/Cassandra-trunk/199/testReport/org.apache.cassandra.service/ActiveRepairServiceTest/testQueueWhenPoolFullStrategy_cdc/history/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;legit&lt;/a&gt; flaky&lt;/li&gt;
		&lt;li&gt;ClearSpanshotTest passes locally and it failed with some weird VM error :shrug:&lt;/li&gt;
		&lt;li&gt;Connection tests have given timeouts &lt;a href=&quot;https://ci-cassandra.apache.org/job/Cassandra-trunk/199/testReport/org.apache.cassandra.net/ConnectionTest/testMessageDeliveryOnReconnect_cdc/history/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;before&lt;/a&gt;&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;It would be good to have a second opinion here. But I think the failures we are hitting are legit flaky tests now that we&apos;ve removed much of the noise. &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mck&quot; class=&quot;user-hover&quot; rel=&quot;mck&quot;&gt;mck&lt;/a&gt; would you be so kind to run the tests again but not on cassandra13 to see what happens? I think we can then move this to review if no weird stuff happens. Wdyt?&lt;/p&gt;</comment>
                            <comment id="17148764" author="michaelsembwever" created="Tue, 30 Jun 2020 15:15:50 +0000"  >&lt;p&gt;Agreed!&lt;br/&gt;
New run &lt;a href=&quot;https://ci-cassandra.apache.org/job/Cassandra-devbranch-test/157/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;here&lt;/a&gt; (on cassandra35)&lt;/p&gt;</comment>
                            <comment id="17149196" author="bereng" created="Wed, 1 Jul 2020 07:52:43 +0000"  >&lt;p&gt;The new run is successful. So I am starting to think that cassandra13 should have been named cassandra12+1 instead as things tend to go wrong over there lol. Anyway this is removing lots of noise from test reports so I am moving it forward to review. We need another committer besides you &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mck&quot; class=&quot;user-hover&quot; rel=&quot;mck&quot;&gt;mck&lt;/a&gt; to +1 it. Sounds good?&lt;/p&gt;</comment>
                            <comment id="17149205" author="snazy" created="Wed, 1 Jul 2020 08:18:23 +0000"  >&lt;p&gt;I&apos;m not sure whether adding &lt;tt&gt;DatabaseDescriptor.daemonInitialization()&lt;/tt&gt; to the tests is the right way here. Those tests do not need the daemon at all and adding these DD.daemonInit() makes those tests slower. The change to &lt;tt&gt;DatabaseDescriptorRefTest&lt;/tt&gt; can actually break that test itself. The &lt;tt&gt;SSTable*Test.java&lt;/tt&gt; tests test offline tools, so DD.daemonInit() feels wrong here.&lt;/p&gt;</comment>
                            <comment id="17149258" author="bereng" created="Wed, 1 Jul 2020 09:54:19 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=snazy&quot; class=&quot;user-hover&quot; rel=&quot;snazy&quot;&gt;snazy&lt;/a&gt; Thanks for taking a look here! I replaced all daemon inits with a plain address load call and checked it still works locally. The {{SStable*Test}}s weren&apos;t using DD.daemonInit() but toolinit(). Still I have replaced those with plain address loads as well to avoid any other heavyweight lifting as you pointed out. Hope it looks better now?&lt;/p&gt;</comment>
                            <comment id="17149303" author="snazy" created="Wed, 1 Jul 2020 10:27:52 +0000"  >&lt;p&gt;Hm - maybe it&apos;s easier to change &lt;tt&gt;org.apache.cassandra.utils.FBUtilities#getJustLocalAddress&lt;/tt&gt; and add a try-catch(UnknownHostException) around the &lt;tt&gt;InetAddress.getLocalHost()&lt;/tt&gt; (&lt;em&gt;&quot;Returns the address of the local host. This is achieved by retrieving the name of the host from the system, then resolving that name into an &lt;tt&gt;InetAddress&lt;/tt&gt;.&quot;&lt;/em&gt;) and use &lt;tt&gt;InetAddress.getLoopbackAddress()&lt;/tt&gt; when that&apos;s thrown (to avoid a change of the current behavior). Guess, this affects all branches (and all other uses of &lt;tt&gt;InetAddress.getLocalHost()&lt;/tt&gt;).&lt;/p&gt;</comment>
                            <comment id="17149320" author="bereng" created="Wed, 1 Jul 2020 10:54:08 +0000"  >&lt;p&gt;If I am following you correctly you&apos;re proposing returning &lt;tt&gt;InetAddress.getLoopbackAddress()&lt;/tt&gt; when &lt;tt&gt;listen_address&lt;/tt&gt; is null and not resolvable:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;The original problem we are facing imo is that the specified&#160;&lt;tt&gt;listen_address&lt;/tt&gt; in the yaml is not being loaded, hence is not effective and using a default fallback. I would argue here you want the &lt;tt&gt;listen_address&lt;/tt&gt; you have in the test yaml to be effective rather than being resilient to a default fallback node mis-config? In fact it&apos;s actually good we found out we were not honoring the test yaml.&lt;/li&gt;
	&lt;li&gt;I played a bit on DD to try to load the address config sooner looking for alternatives, as you did, to the wall of test fixes. But some access the method well before the &lt;tt&gt;listen_address&lt;/tt&gt; is loaded. So that didn&apos;t work.&lt;/li&gt;
	&lt;li&gt;On your proposed fix it sounds great but maybe orthogonal (iiuc). Also would we prefer to fail if we can&apos;t resolve the machine name?&#160; I read a bit about {{&lt;tt&gt;getLoopbackAddress&lt;/tt&gt;}} and you might have some ipv4 vs ipv6 lo address being returned apparently :thinking:...&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;So TLDR: we need to make the yaml effective, I wasn&apos;t able to find a smarter alternative &amp;amp; your proposal could be a new ticket instead. Wdyt makes sense?&lt;/p&gt;</comment>
                            <comment id="17150049" author="michaelsembwever" created="Thu, 2 Jul 2020 07:58:11 +0000"  >&lt;blockquote&gt;&lt;p&gt;I would argue here you want the listen_address you have in the test yaml to be effective rather than being resilient to a default fallback node mis-config? In fact it&apos;s actually good we found out we were not honoring the test yaml.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I agree with this. The test yaml needs to honoured. And it would be nice to solve this ticket without touching runtime code.&lt;br/&gt;
Finding a lighter way to just load the yaml makes sense.&lt;/p&gt;</comment>
                            <comment id="17150084" author="snazy" created="Thu, 2 Jul 2020 08:56:09 +0000"  >&lt;p&gt;Well, the most unintrusive way would be to add the hostname to the 127.0.0.1 (or even better the host&apos;s public IP) entry in /etc/hosts.&lt;/p&gt;

&lt;p&gt;Mosts tests in question (e.g. the&#160;&lt;tt&gt;ReplicaCollectionTest&lt;/tt&gt; or &lt;tt&gt;SEPExecutorTest&lt;/tt&gt;) do not need a c-yaml at all (and didn&apos;t need it before), because those are &quot;pure&quot; unit tests (i.e. don&apos;t need a daemon or any configuration). Other tests (like the &lt;tt&gt;DatabaseDescriptorRefTest&lt;/tt&gt;) are &quot;allergic&quot; to touching classes before the actual test. The next guy who comes along these tests, likely thinks that the DD call is unnecessary and removes it, because the test passes locally and e.g. in CircleCI.&lt;/p&gt;

&lt;p&gt;The change to &lt;tt&gt;DatabaseDescriptorRefTest&lt;/tt&gt; actually causes the test to not fully exercise the DD-init code being tested (and &quot;silently pass&quot; although it didn&apos;t test the whole init code or, if new changes get in, fail because some expectations aren&apos;t met). TL;DR it breaks that test.&lt;/p&gt;

&lt;p&gt;The implemented default for &lt;tt&gt;broadcast_address&lt;/tt&gt; (defaulting to &lt;tt&gt;listen_address&lt;/tt&gt;, which in turn defaults to &lt;tt&gt;InetAddress.getLocalHost()&lt;/tt&gt;), is correct (the yaml says: &lt;em&gt;&quot;&lt;tt&gt;Leaving it blank leaves it up to InetAddress.getLocalHost(). This will always do the Right Thing &lt;b&gt;if the node is properly configured (hostname, name resolution, etc)&lt;/b&gt;, and the Right Thing is to use the address associated with the hostname (it might not be).&lt;/tt&gt;&quot;&lt;/em&gt;). I admit, it might be wrong to add a fallback to &lt;tt&gt;InetAddress.getLoopbackAddress()&lt;/tt&gt;.&lt;/p&gt;

&lt;p&gt;TL;DR I think it&apos;s much safer to fix the test environment (and not work around test environment issues by changing any existing code).&lt;/p&gt;

&lt;p&gt;Side note (feel free to ignore this): I do think that using &lt;tt&gt;InetAddress.getLocalHost()&lt;/tt&gt; is a mistake in general. It seems that (in practice) there is no guarantee that it &lt;tt&gt;IA.getLocalHost()&lt;/tt&gt; deterministically return the same address - think: DHCP changes, interfaces going up or down, hostnames that resolve to multiple IPs, etc etc.&lt;/p&gt;</comment>
                            <comment id="17150159" author="bereng" created="Thu, 2 Jul 2020 10:13:57 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=snazy&quot; class=&quot;user-hover&quot; rel=&quot;snazy&quot;&gt;snazy&lt;/a&gt; thx for the input.&lt;/p&gt;

&lt;p&gt;&lt;tt&gt;toolInit&lt;/tt&gt; isn&apos;t expected to have a loaded address config so the default behavior is what&apos;s expected. So adding an address load either from scratch or before the&#160;&lt;tt&gt;toolInit&lt;/tt&gt; is wrong. Icwym.&lt;/p&gt;

&lt;p&gt;On the other hand as discussed in &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-15622&quot; title=&quot;Unit tests throw UnknownHostException trying to use `InetAddress.getLocalHost()` instead of `FBUtilities.getLocalAddress()`&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-15622&quot;&gt;&lt;del&gt;CASSANDRA-15622&lt;/del&gt;&lt;/a&gt; there can be problems on test C* nodes listening on public ips /ports and ASF regulations I am not aware of as mentioned there. Given this is a source of false failures on ci-cass jenkins runs atm, maybe the best way forward is to fix the config in cassandra-13. Then open a ticket to put the full ci-cassandra jenkins master/slave things under a more secured env compliant to whatever ASF and other regulations there might be.&lt;/p&gt;

&lt;p&gt;What do you guys think? &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mck&quot; class=&quot;user-hover&quot; rel=&quot;mck&quot;&gt;mck&lt;/a&gt; is that even possible or am I talking nonsense?&lt;/p&gt;</comment>
                            <comment id="17150300" author="michaelsembwever" created="Thu, 2 Jul 2020 13:51:04 +0000"  >&lt;blockquote&gt;&lt;p&gt;Well, the most unintrusive way would be to add the hostname to the 127.0.0.1 (or even better the host&apos;s public IP) entry in /etc/hosts.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;These tests have also failed in the previous jenkins environment at builds.apache.org (long before circleci was introduced).&lt;/p&gt;

&lt;p&gt;The jenkins agents  require public ip and a valid hostname. So there is a valid reason that these nodes are &quot;not properly configured&quot; (according to our definition for a runtime node). &lt;/p&gt;

&lt;p&gt;And, we don&apos;t have ssh access. So this may be un-intrusive to code changes, but involves either waiting a few weeks or months for the owner of the donated agents to re-configure them (to incorrectly let tests listen on public interfaces), or containerising all tests (bc inside containers hostname can always safely be the private interface, like circleci).&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;&#8230; those are &quot;pure&quot; unit tests (i.e. don&apos;t need a daemon or any configuration)&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I&apos;m not sure I agree entirely with that statement. But those quotes imply you don&apos;t either. These unit tests are not really configuration free, the fault lies in the fact that the tests are looking up the configuration, and those that haven&apos;t defined the config then fall back onto an opinion that is incompatible with the &quot;jenkins agents around the world but unlike normal C* don&apos;t listen on the public interface because this is tests&quot; setup. A pure unit test shouldn&apos;t be resorting to either an opinion or an OS hostname lookup. A hardcoded default config would be more appropriate, in theory. But alas the C* is a bit too messy for the ideal &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/sad.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;Thanks for pushing back &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=snazy&quot; class=&quot;user-hover&quot; rel=&quot;snazy&quot;&gt;snazy&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="17151874" author="bereng" created="Mon, 6 Jul 2020 08:29:50 +0000"  >&lt;p&gt;So it seems after all the back and forth and given the current restrictions mainly:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;Not providing a synthetic address load which the test actually doesn&apos;t need&lt;/li&gt;
	&lt;li&gt;Avoiding failing on mis-config nodes&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Adding a 3rd fallback seems reasonable enough, moving from failing scenarios to a &apos;localhost&apos; listen in a major release. Both &lt;tt&gt;getLocalHost()&lt;/tt&gt; and &lt;tt&gt;getLoopbackAddress()&lt;/tt&gt; may fail under some OS/ip configs so we&apos;re not anyway worse than we used to be.&lt;/p&gt;

&lt;p&gt;The change has been pushed. It&apos;s undergoing review and an initial test run &lt;a href=&quot;https://ci-cassandra.apache.org/view/patches/job/Cassandra-devbranch-test/161/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;fired&lt;/a&gt;. Iirc at least the JMXAuth test is a legit failure I need to look into. Once that&apos;s done I&apos;ll run a full test suite as this is touching C* code: dtests, unit tests, jvm, etc...&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="17151890" author="bereng" created="Mon, 6 Jul 2020 08:58:51 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=snazy&quot; class=&quot;user-hover&quot; rel=&quot;snazy&quot;&gt;snazy&lt;/a&gt; I did accept your commits but for a single one on wording. Please take a look at it and the &lt;tt&gt;JMXAuthTest&lt;/tt&gt; failure, which is a hostname resolution error in some library. Wdyt?&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mck&quot; class=&quot;user-hover&quot; rel=&quot;mck&quot;&gt;mck&lt;/a&gt; could you be so kind to fire a run against cassandra13 please &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;?&lt;/p&gt;

&lt;p&gt;I am running a full CI on circle as well. If all goes well that should be it.&lt;/p&gt;</comment>
                            <comment id="17151899" author="michaelsembwever" created="Mon, 6 Jul 2020 09:08:47 +0000"  >&lt;p&gt;Just the unit tests (on cassandra13) at &lt;a href=&quot;https://ci-cassandra.apache.org/view/patches/job/Cassandra-devbranch-test/165&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://ci-cassandra.apache.org/view/patches/job/Cassandra-devbranch-test/165&lt;/a&gt;&lt;br/&gt;
Full devbranch pipeline (now that we&apos;re touching runtime code) at &lt;a href=&quot;https://ci-cassandra.apache.org/view/patches/job/Cassandra-devbranch/196/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://ci-cassandra.apache.org/view/patches/job/Cassandra-devbranch/196/&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17152581" author="bereng" created="Tue, 7 Jul 2020 09:06:06 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mck&quot; class=&quot;user-hover&quot; rel=&quot;mck&quot;&gt;mck&lt;/a&gt; the full pipeline failed on dtest &lt;a href=&quot;https://ci-cassandra.apache.org/view/patches/job/Cassandra-devbranch/196/testReport/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;replica_side_filtering_test&lt;/a&gt; which passes locally and passes on circle-ci. Is there a chance to re-run that? I know this is an extra day of waiting before commit, but it&apos;ll be better than merging sthg broken, despite I have the intuition this is probably a legit flaky.&lt;/p&gt;</comment>
                            <comment id="17152597" author="michaelsembwever" created="Tue, 7 Jul 2020 09:32:54 +0000"  >&lt;p&gt;Committed as &lt;a href=&quot;https://github.com/apache/cassandra/commit/4654ef09c1d3736e0b50e8d5756664cbf9e4ca84&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;4654ef09c1d3736e0b50e8d5756664cbf9e4ca84 &lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="17152599" author="michaelsembwever" created="Tue, 7 Jul 2020 09:33:58 +0000"  >&lt;blockquote&gt;&lt;p&gt;the full pipeline failed on dtest replica_side_filtering_test which passes locally and passes on circle-ci. Is there a chance to re-run that? &lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;this was a first-time-witnessed bug where the Jenkins pipeline copied the test report artefact from the wrong build. investigating this separately. &lt;/p&gt;</comment>
                            <comment id="17152600" author="bereng" created="Tue, 7 Jul 2020 09:34:36 +0000"  >&lt;p&gt;Ok after some investigation &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mck&quot; class=&quot;user-hover&quot; rel=&quot;mck&quot;&gt;mck&lt;/a&gt; discovered the final jenkins report is collecting results from other runs! If you check the stages one by one and make sure commit id matches we see none of those failures. This is jenkins being broken.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[bereng]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12313825" key="com.atlassian.jira.plugin.system.customfieldtypes:cascadingselect">
                        <customfieldname>Bug Category</customfieldname>
                        <customfieldvalues>
                                                    <customfieldvalue key="12982" cascade-level=""><![CDATA[Correctness]]></customfieldvalue>
                                <customfieldvalue key="12990" cascade-level="1"><![CDATA[Test Failure]]></customfieldvalue>
            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12313821" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Complexity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12965"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313822" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Discovered By</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12970"><![CDATA[Unit Test]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12313922" key="jira.plugin.projectspecificselectfield.jpssf:multicftype">
                        <customfieldname>Impacts</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="13100"><![CDATA[None]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            5 years, 19 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12313921" key="jira.plugin.projectspecificselectfield.jpssf:multicftype">
                        <customfieldname>Platform</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="13076"><![CDATA[All]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0g6wo:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[mck2]]></customfieldvalue>
        <customfieldvalue><![CDATA[snazy]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12962"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12311420" key="com.atlassian.jira.plugin.system.customfieldtypes:version">
                        <customfieldname>Since Version</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="12313861">0.3</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313924" key="com.atlassian.jira.plugin.system.customfieldtypes:textfield">
                        <customfieldname>Source Control Link</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>&lt;p&gt;&lt;a href=&quot;https://github.com/apache/cassandra/commit/4654ef09c1d3736e0b50e8d5756664cbf9e4ca84&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/cassandra/commit/4654ef09c1d3736e0b50e8d5756664cbf9e4ca84&lt;/a&gt;&lt;/p&gt;</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313823" key="com.atlassian.jira.plugin.system.customfieldtypes:textarea">
                        <customfieldname>Test and Documentation Plan</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>&lt;p&gt;See PR&lt;/p&gt;</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>