<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 23:00:19 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-9258] Range movement causes CPU &amp; performance impact</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-9258</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;Observing big CPU &amp;amp; latency regressions when doing range movements on clusters with many tens of thousands of vnodes. See CPU usage increase by ~80% when a single node is being replaced.&lt;/p&gt;

&lt;p&gt;Top methods are:&lt;/p&gt;

&lt;p&gt;1) Ljava/math/BigInteger;.compareTo in Lorg/apache/cassandra/dht/ComparableObjectToken;.compareTo &lt;br/&gt;
2) Lcom/google/common/collect/AbstractMapBasedMultimap;.wrapCollection in Lcom/google/common/collect/AbstractMapBasedMultimap$AsMap$AsMapIterator;.next&lt;br/&gt;
3) Lorg/apache/cassandra/db/DecoratedKey;.compareTo in Lorg/apache/cassandra/dht/Range;.contains&lt;/p&gt;

&lt;p&gt;Here&apos;s a sample stack from a thread dump:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-quote&quot;&gt;&quot;Thrift:50673&quot;&lt;/span&gt; daemon prio=10 tid=0x00007f2f20164800 nid=0x3a04af runnable [0x00007f2d878d0000]
   java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.State: RUNNABLE
      at org.apache.cassandra.dht.Range.isWrapAround(Range.java:260)
      at org.apache.cassandra.dht.Range.contains(Range.java:51)
      at org.apache.cassandra.dht.Range.contains(Range.java:110)
      at org.apache.cassandra.locator.TokenMetadata.pendingEndpointsFor(TokenMetadata.java:916)
      at org.apache.cassandra.service.StorageProxy.performWrite(StorageProxy.java:775)
      at org.apache.cassandra.service.StorageProxy.mutate(StorageProxy.java:541)
      at org.apache.cassandra.service.StorageProxy.mutateWithTriggers(StorageProxy.java:616)
      at org.apache.cassandra.thrift.CassandraServer.doInsert(CassandraServer.java:1101)
      at org.apache.cassandra.thrift.CassandraServer.doInsert(CassandraServer.java:1083)
      at org.apache.cassandra.thrift.CassandraServer.batch_mutate(CassandraServer.java:976)
      at org.apache.cassandra.thrift.Cassandra$Processor$batch_mutate.getResult(Cassandra.java:3996)
      at org.apache.cassandra.thrift.Cassandra$Processor$batch_mutate.getResult(Cassandra.java:3980)
      at org.apache.thrift.ProcessFunction.process(ProcessFunction.java:39)
      at org.apache.thrift.TBaseProcessor.process(TBaseProcessor.java:39)
      at org.apache.cassandra.thrift.CustomTThreadPoolServer$WorkerProcess.run(CustomTThreadPoolServer.java:205)
      at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1145)
      at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:615)
      at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:745)&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment>&lt;p&gt;Cassandra 2.1.4&lt;/p&gt;</environment>
        <key id="12825686">CASSANDRA-9258</key>
            <summary>Range movement causes CPU &amp; performance impact</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10002" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Normal</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="dikanggu">Dikang Gu</assignee>
                                    <reporter username="rbranson">Rick Branson</reporter>
                        <labels>
                    </labels>
                <created>Tue, 28 Apr 2015 21:33:48 +0000</created>
                <updated>Tue, 16 Apr 2019 09:31:13 +0000</updated>
                            <resolved>Tue, 5 Jan 2016 14:29:39 +0000</resolved>
                                        <fixVersion>2.2.5</fixVersion>
                    <fixVersion>3.0.3</fixVersion>
                    <fixVersion>3.3</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>11</watches>
                                                                                                                <comments>
                            <comment id="14518162" author="jbellis" created="Tue, 28 Apr 2015 21:52:45 +0000"  >&lt;p&gt;Could we make an IntervalTree of pending ranges &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=iamaleksey&quot; class=&quot;user-hover&quot; rel=&quot;iamaleksey&quot;&gt;iamaleksey&lt;/a&gt;?&lt;/p&gt;</comment>
                            <comment id="14518182" author="rbranson" created="Tue, 28 Apr 2015 22:02:32 +0000"  >&lt;p&gt;This is also an issue for large 2.0 clusters as well. The TokenMetadata path is identical between 2.1 and 2.0.&lt;/p&gt;</comment>
                            <comment id="14641207" author="dikanggu" created="Fri, 24 Jul 2015 22:58:07 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jbellis&quot; class=&quot;user-hover&quot; rel=&quot;jbellis&quot;&gt;jbellis&lt;/a&gt;, I&apos;m wondering is anyone looking at this issue now?&lt;/p&gt;</comment>
                            <comment id="14641218" author="jbellis" created="Fri, 24 Jul 2015 23:14:51 +0000"  >&lt;p&gt;No.&lt;/p&gt;</comment>
                            <comment id="14641714" author="benedict" created="Sat, 25 Jul 2015 16:24:56 +0000"  >&lt;p&gt;This looks like it fell through the cracks a little. Assigning to myself so I can keep an eye on it, and provide a patch once I have some free time. This may not be for a few months, so if somebody else wants to take it sooner, please feel 100% free to assign it to yourself.&lt;/p&gt;</comment>
                            <comment id="14901655" author="dikanggu" created="Tue, 22 Sep 2015 00:12:38 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=benedict&quot; class=&quot;user-hover&quot; rel=&quot;benedict&quot;&gt;benedict&lt;/a&gt;, I&apos;m going to work on this, since this caused problem to us, can you please assign it to me? (Seems I can not assign it to myself).&lt;/p&gt;</comment>
                            <comment id="14901702" author="benedict" created="Tue, 22 Sep 2015 01:03:40 +0000"  >&lt;p&gt;I&apos;ve added you to the contributor list and assigned you the ticket (you should be able to assign yourself from now on).&lt;/p&gt;</comment>
                            <comment id="14903170" author="brandon.williams" created="Tue, 22 Sep 2015 18:32:07 +0000"  >&lt;p&gt;In the future don&apos;t worry about assignee until commit.&lt;/p&gt;</comment>
                            <comment id="15004303" author="iamaleksey" created="Fri, 13 Nov 2015 17:08:25 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=dikanggu&quot; class=&quot;user-hover&quot; rel=&quot;dikanggu&quot;&gt;dikanggu&lt;/a&gt; Any progress on this? We want to deal with it soon-ish.&lt;/p&gt;</comment>
                            <comment id="15007120" author="dikanggu" created="Mon, 16 Nov 2015 18:56:28 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=iamaleksey&quot; class=&quot;user-hover&quot; rel=&quot;iamaleksey&quot;&gt;iamaleksey&lt;/a&gt; yes, I&apos;m working on it, I&apos;m trying to implement the pendingRanges based on the IntervalTree, will try to send out a patch this week.&lt;/p&gt;</comment>
                            <comment id="15027998" author="dikanggu" created="Thu, 26 Nov 2015 01:55:36 +0000"  >&lt;p&gt;I&apos;m fixing tests, will submit a patch soon.&lt;/p&gt;</comment>
                            <comment id="15033252" author="dikanggu" created="Tue, 1 Dec 2015 07:22:42 +0000"  >&lt;p&gt;Still testing it, let people look at it first. The idea is to make IntervalTree support wrap around tokens, and implement the pending ranges base on it.&lt;/p&gt;</comment>
                            <comment id="15044743" author="blambov" created="Mon, 7 Dec 2015 10:52:05 +0000"  >&lt;p&gt;If the patch is ready for review, could you please rebase it on latest 2.1?&lt;/p&gt;</comment>
                            <comment id="15046078" author="dikanggu" created="Tue, 8 Dec 2015 00:50:54 +0000"  >&lt;p&gt;rebase on top of 2.1&lt;/p&gt;</comment>
                            <comment id="15046080" author="dikanggu" created="Tue, 8 Dec 2015 00:52:10 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=blambov&quot; class=&quot;user-hover&quot; rel=&quot;blambov&quot;&gt;blambov&lt;/a&gt; sure, 0001-pending-ranges-2.1.patch is rebased on latest 2.1&lt;/p&gt;</comment>
                            <comment id="15048340" author="blambov" created="Wed, 9 Dec 2015 09:18:21 +0000"  >&lt;p&gt;I have some serious concerns about the solution.&lt;/p&gt;

&lt;p&gt;For one, &lt;tt&gt;allowWrapAround&lt;/tt&gt; changes the interval type from inclusive-start to exclusive-start, which is not made visible in the naming or documentation, and more importantly changes the meaning of &lt;tt&gt;interval.create(point, point, null)&lt;/tt&gt; to an interval that covers the whole space, making &lt;tt&gt;search(C)&lt;/tt&gt; meaningless in theory. This means that the fact that it works is, in fact, an error in the implementation.&lt;/p&gt;

&lt;p&gt;The other one is that as &lt;tt&gt;search(C)&lt;/tt&gt; is the only method in use, the whole &lt;tt&gt;IntervalTree&lt;/tt&gt; infrastructure is unnecessary for this problem. It is only necessary to find overlapping ranges. A much simpler and more straightforward solution is to store ranges in two navigable sets, one ordered by increasing starts and one by decreasing ends, and return a suitable selection built from their tail sets from the required token. This does not require modification to &lt;tt&gt;IntervalTree&lt;/tt&gt; and would be, in fact, dramatically faster.&lt;/p&gt;</comment>
                            <comment id="15049297" author="dikanggu" created="Wed, 9 Dec 2015 19:59:16 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=blambov&quot; class=&quot;user-hover&quot; rel=&quot;blambov&quot;&gt;blambov&lt;/a&gt;, Thanks for the review. yeah, I agree it&apos;s a bit hacky to make it work with IntervalTree. That&apos;s why I want people to take a look at it first.&lt;/p&gt;

&lt;p&gt;The approach of two sets sound promising to me, I will think about it, and see if I can get a diff out today or tmr.&lt;/p&gt;</comment>
                            <comment id="15053903" author="dikanggu" created="Sat, 12 Dec 2015 01:14:58 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=blambov&quot; class=&quot;user-hover&quot; rel=&quot;blambov&quot;&gt;blambov&lt;/a&gt;, here is a patch implemented based two NavigableMaps. &lt;/p&gt;</comment>
                            <comment id="15056216" author="blambov" created="Mon, 14 Dec 2015 16:22:47 +0000"  >&lt;p&gt;The solution looks good overall.&lt;/p&gt;

&lt;p&gt;&lt;tt&gt;PendingRangeMaps&lt;/tt&gt; could be declared iterable so that the for-in syntax can be used in e.g. &lt;tt&gt;TokenMetadata.getPendingRangesMM&lt;/tt&gt;.&lt;/p&gt;

&lt;p&gt;The comparators should not be created by the constructor as they can just as well be static final constants. It is not very clear why you need 4 of them, a comment explaining what each ordering does would help a lot (e.g. sorts ends ascending, and its secondary comparison for starts is chosen in such a way that and &amp;lt;end, end&amp;gt; ranges come before non-wraparound intervals with the same end).&lt;/p&gt;

&lt;p&gt;&lt;tt&gt;PendingRangeMaps.addPendingRange&lt;/tt&gt; needs a comment on why adding the address is done only once in the found case. Or restate it as finding the list to add to, creating if necessary, then adding the new address, for example:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;List&amp;lt;InetAddress&amp;gt; addresses = ascending.get(range);
&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (addresses == &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;)
{
    addresses = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; ArrayList&amp;lt;InetAddress&amp;gt;(1);
    ascending.put(range, addresses);
    descending.put(range, addresses);
}
addresses.add(address);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;In &lt;tt&gt;PendingRangeMaps.pendingEndpointsFor&lt;/tt&gt; the &lt;tt&gt;keySet, containsKey, get&lt;/tt&gt; sequence is a bit more expensive than it could be: either use &lt;tt&gt;entrySet&lt;/tt&gt; to avoid &lt;tt&gt;smaller.get&lt;/tt&gt;, or &lt;tt&gt;bigger.get&lt;/tt&gt; instead of &lt;tt&gt;containsKey&lt;/tt&gt; to directly use the value if it&apos;s not null. Similarly, the two wrap-around loops should be on the &lt;tt&gt;entrySet&lt;/tt&gt; s to avoid unnecessarily searching for the entry again.&lt;/p&gt;</comment>
                            <comment id="15057349" author="dikanggu" created="Tue, 15 Dec 2015 05:02:23 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=blambov&quot; class=&quot;user-hover&quot; rel=&quot;blambov&quot;&gt;blambov&lt;/a&gt;, thanks for the review, addressed the comments.&lt;/p&gt;</comment>
                            <comment id="15057958" author="blambov" created="Tue, 15 Dec 2015 12:13:28 +0000"  >&lt;p&gt;The tests, as well as &lt;tt&gt;PendingRangesMap.iterator&lt;/tt&gt; don&apos;t follow Cassandra&apos;s opening bracket convention.&lt;/p&gt;

&lt;p&gt;Nit: the repetition in &lt;tt&gt;PendingRangesMap.addPendingRange&lt;/tt&gt; could be removed by extracting the action in a private static method.&lt;br/&gt;
Smaller nit: the bigger/smaller selection would also look better if the intersection is done in a method call.&lt;/p&gt;

&lt;p&gt;Pushed to &lt;a href=&quot;https://github.com/blambov/cassandra/tree/dikang85/9258&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;github branch&lt;/a&gt; to have cassci run &lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/blambov/job/blambov-dikang85-9258-testall/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;unit tests&lt;/a&gt; and &lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/blambov/job/blambov-dikang85-9258-dtest/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;dtests&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;Note: If you want to invest more time in this, it could be made even more efficient, and perhaps cleaner, if you use two levels of indexing and unwrapping of the ranges.&lt;/p&gt;</comment>
                            <comment id="15058431" author="dikanggu" created="Tue, 15 Dec 2015 17:57:14 +0000"  >&lt;p&gt;Address nits.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=blambov&quot; class=&quot;user-hover&quot; rel=&quot;blambov&quot;&gt;blambov&lt;/a&gt; Sure, I&apos;d love to invest more time. I think this version is already much better than the trunk, can we try to commit this? Thanks!&lt;/p&gt;</comment>
                            <comment id="15059780" author="slebresne" created="Wed, 16 Dec 2015 10:02:40 +0000"  >&lt;p&gt;It would be great if we could get some form of (micro-)benchmark to demonstrate the gain of the new solution before committing. Ideally, this could be a &lt;tt&gt;jmh&lt;/tt&gt; benchmark in the same vein than &lt;tt&gt;test/microbench/.../OutputStreamBench.java&lt;/tt&gt;. &lt;/p&gt;</comment>
                            <comment id="15061188" author="dikanggu" created="Thu, 17 Dec 2015 00:13:20 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=slebresne&quot; class=&quot;user-hover&quot; rel=&quot;slebresne&quot;&gt;slebresne&lt;/a&gt;, I deploy this to our production environment, and see significant improvement of cpu when bootstrapping new node.&lt;/p&gt;

&lt;p&gt;I attached the profiling for with and without this patch.&lt;/p&gt;</comment>
                            <comment id="15061779" author="blambov" created="Thu, 17 Dec 2015 09:27:13 +0000"  >&lt;p&gt;The new version looks good to me. Updated the branch, test results should be available shortly: &lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/blambov/job/blambov-dikang85-9258-testall/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;unit tests&lt;/a&gt; and &lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/blambov/job/blambov-dikang85-9258-dtest/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;dtests&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;Sylvain, are you happy with the provided data or do you insist on writing a &lt;tt&gt;jmh&lt;/tt&gt; bench for regression testing?&lt;/p&gt;</comment>
                            <comment id="15061842" author="slebresne" created="Thu, 17 Dec 2015 10:16:04 +0000"  >&lt;blockquote&gt;&lt;p&gt;Sylvain, are you happy with the provided data or do you insist on writing a jmh bench for regression testing?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I think we still should write a jmh regression test for, well, regression testing, but also because it&apos;ll give us a good baseline for future improvements. That said, the provided data (and general reasoning) is convincing enough that this is a net improvement that if no-one has time to write that jmh bench shortly, I won&apos;t hold back on committing since this is potentially serious for some users. Still, let the record show that I dislike the idea of postponing the write of such regression test because history so far shows that this is codename for &quot;never getting it done&quot;.&lt;/p&gt;</comment>
                            <comment id="15063164" author="dikanggu" created="Fri, 18 Dec 2015 00:26:37 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=slebresne&quot; class=&quot;user-hover&quot; rel=&quot;slebresne&quot;&gt;slebresne&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=blambov&quot; class=&quot;user-hover&quot; rel=&quot;blambov&quot;&gt;blambov&lt;/a&gt;, I ported to 2.2 branch and wrote a micro bench for it.&lt;/p&gt;</comment>
                            <comment id="15064029" author="blambov" created="Fri, 18 Dec 2015 14:51:37 +0000"  >&lt;p&gt;Thank you for writing the benchmark. There are a couple problems with it, though:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;the generated ranges cover the space up to &lt;tt&gt;maxValue * 10 + 15&lt;/tt&gt;, but you only test tokens between 0 and &lt;tt&gt;maxValue&lt;/tt&gt; which is skewing the result;&lt;/li&gt;
	&lt;li&gt;ranges are non-overlapping except for a lot of wrap-around ones &amp;#8211; to better simulate the target usage, I&apos;d just use a single wrap-around range;&lt;/li&gt;
	&lt;li&gt;you could use more than one address for some of the ranges;&lt;/li&gt;
	&lt;li&gt;make sure it follows the code conventions;&lt;/li&gt;
	&lt;li&gt;could you post some before and after results?&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;A small correction on one of the changes you made on my request: &lt;tt&gt;addIntersection&lt;/tt&gt; was meant to just do the &lt;tt&gt;for&lt;/tt&gt; loop, so that it could be called like this:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (ascendingTailMap.size() &amp;lt; descendingTailMap.size())
            addIntersection(endpoints, ascendingTailMap, descendingTailMap);
        &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt;
            addIntersection(endpoints, descendingTailMap, ascendingTailMap);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="15074370" author="dikanggu" created="Tue, 29 Dec 2015 22:31:39 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=blambov&quot; class=&quot;user-hover&quot; rel=&quot;blambov&quot;&gt;blambov&lt;/a&gt;, addressed comments.&lt;/p&gt;

&lt;p&gt;some banchmark results:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
     [java] Benchmark                                                      Mode  Samples        Score       Error  Units
     [java] o.a.c.t.m.PendingRangesBench.searchToken                       avgt      150   200922.008 &#177; 10654.370  ns/op
     [java] o.a.c.t.m.PendingRangesBench.searchTokenForOldPendingRanges    avgt      150  1662673.223 &#177; 35110.983  ns/op

&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The new version is 8 times faster than the old one.&lt;/p&gt;</comment>
                            <comment id="15081211" author="blambov" created="Mon, 4 Jan 2016 14:33:46 +0000"  >&lt;p&gt;Sorry for not spotting this in the previous round: the &lt;tt&gt;Blackhole&lt;/tt&gt; is used to swallow results so that the compiler does not optimize away the thing you are trying to benchmark. &lt;tt&gt;setUp&lt;/tt&gt; does not need it as argument, but both test methods should take it and should pass the result to &lt;tt&gt;bh.consume&lt;/tt&gt;. I don&apos;t think this is affecting the results at the moment, but could do so with future JVM versions, so it should be corrected.&lt;/p&gt;

&lt;p&gt;Otherwise, LGTM. &lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/blambov/job/blambov-dikang85-9258-testall/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;utests&lt;/a&gt; and &lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/blambov/job/blambov-dikang85-9258-dtest/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;dtests&lt;/a&gt; look good as well.&lt;/p&gt;</comment>
                            <comment id="15081965" author="dikanggu" created="Mon, 4 Jan 2016 23:09:51 +0000"  >&lt;p&gt;Address comments.&lt;/p&gt;</comment>
                            <comment id="15083008" author="blambov" created="Tue, 5 Jan 2016 12:55:53 +0000"  >&lt;p&gt;LGTM&lt;/p&gt;

&lt;p&gt;Tests look good:&lt;br/&gt;
2.1 &lt;a href=&quot;http://cassci.datastax.com/job/blambov-dikang85-9258-testall/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;utests&lt;/a&gt; &lt;a href=&quot;http://cassci.datastax.com/job/blambov-dikang85-9258-dtest/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;dtests&lt;/a&gt;&lt;br/&gt;
2.2 &lt;a href=&quot;http://cassci.datastax.com/job/blambov-dikang85-9258-2.2-testall/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;utests&lt;/a&gt; &lt;a href=&quot;http://cassci.datastax.com/job/blambov-dikang85-9258-2.2-dtest/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;dtests&lt;/a&gt;&lt;/p&gt;
</comment>
                            <comment id="15083127" author="slebresne" created="Tue, 5 Jan 2016 14:29:39 +0000"  >&lt;p&gt;Committed, thanks.&lt;/p&gt;</comment>
                            <comment id="15086573" author="kohlisankalp" created="Thu, 7 Jan 2016 00:32:34 +0000"  >&lt;p&gt;Why is this not committed to trunk? &lt;/p&gt;</comment>
                            <comment id="15087182" author="slebresne" created="Thu, 7 Jan 2016 10:31:39 +0000"  >&lt;blockquote&gt;&lt;p&gt;Why is this not committed to trunk?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I&apos;m genuinely not sure what happened. I would seems I&apos;ve merged with &lt;tt&gt;--strategy=ours&lt;/tt&gt; when merging from 3.0 to 3.3/trunk but that was definitively an oversight if so. Anyway, this should be fixed now.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12780403" name="0001-pending-ranges-map.patch" size="23012" author="dikanggu" created="Mon, 4 Jan 2016 23:09:51 +0000"/>
                            <attachment id="12780404" name="0001-pending-ranges-maps-for-2.2.patch" size="25027" author="dikanggu" created="Mon, 4 Jan 2016 23:09:51 +0000"/>
                            <attachment id="12778142" name="Screenshot 2015-12-16 16.11.36.png" size="553143" author="dikanggu" created="Thu, 17 Dec 2015 00:13:20 +0000"/>
                            <attachment id="12778143" name="Screenshot 2015-12-16 16.11.51.png" size="556121" author="dikanggu" created="Thu, 17 Dec 2015 00:13:20 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>4.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[dikanggu]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 45 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2e1d3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12311421" key="com.atlassian.jira.plugin.system.customfieldtypes:multiversion">
                        <customfieldname>Reproduced In</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="12332829">2.1.8</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>blambov</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[blambov]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12962"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>