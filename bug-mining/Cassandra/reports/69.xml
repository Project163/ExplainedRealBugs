<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 22:10:46 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-287] Make iterator-based read code the One True Path</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-287</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;Since &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-172&quot; title=&quot;A improved and more general version of get_slice&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-172&quot;&gt;&lt;del&gt;CASSANDRA-172&lt;/del&gt;&lt;/a&gt; we&apos;ve had two read paths; the old, ad-hoc path based on the faulty assumption that we could skip checking older sstables if we got a hit earlier in the path (fixed in &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-223&quot; title=&quot;time-based slicing does not work correctly w/ &amp;quot;historical&amp;quot; memtables&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-223&quot;&gt;&lt;del&gt;CASSANDRA-223&lt;/del&gt;&lt;/a&gt; but still bearing the marks of its origin) and the new iterator-based path.&lt;/p&gt;

&lt;p&gt;This makes all read operations go through the iterator path, which cleans things up enormously and sets the stage for &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-139&quot; title=&quot;thrift API should use lists instead of colon-delimited strings to specify column path&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-139&quot;&gt;&lt;del&gt;CASSANDRA-139&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;I introduce a new QueryFilter interface, which has 3 main methods:&lt;/p&gt;

&lt;p&gt;    /**&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;returns an iterator that returns columns from the given memtable&lt;/li&gt;
	&lt;li&gt;matching the Filter criteria in sorted order.&lt;br/&gt;
     */&lt;br/&gt;
    public abstract ColumnIterator getMemColumnIterator(Memtable memtable);&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    /**&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;returns an iterator that returns columns from the given SSTable&lt;/li&gt;
	&lt;li&gt;matching the Filter criteria in sorted order.&lt;br/&gt;
     */&lt;br/&gt;
    public abstract ColumnIterator getSSTableColumnIterator(SSTableReader sstable) throws IOException;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    /**&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;subcolumns of a supercolumn are unindexed, so to pick out parts of those we operate in-memory.&lt;/li&gt;
	&lt;li&gt;@param superColumn&lt;br/&gt;
     */&lt;br/&gt;
    public abstract void filterSuperColumn(SuperColumn superColumn);&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;The first two are for pulling out indexed top-level columns, from a memtable or an sstable, respectively.&lt;/p&gt;

&lt;p&gt;If the query is on subcolumns of a supercolumn, which are unindexed, CFS.getColumnFamily does an indexed Name filter on the supercolumn, then asks filterSuperColumn on the primary QueryFilter to pick out the parts the user is requesting.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12429949">CASSANDRA-287</key>
            <summary>Make iterator-based read code the One True Path</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10002" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Normal</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="jbellis">Jonathan Ellis</assignee>
                                    <reporter username="jbellis">Jonathan Ellis</reporter>
                        <labels>
                    </labels>
                <created>Thu, 9 Jul 2009 15:14:22 +0000</created>
                <updated>Tue, 16 Apr 2019 09:33:36 +0000</updated>
                            <resolved>Tue, 14 Jul 2009 21:17:24 +0000</resolved>
                                        <fixVersion>0.4</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                                                                <comments>
                            <comment id="12729289" author="jbellis" created="Thu, 9 Jul 2009 15:17:13 +0000"  >&lt;p&gt;(01 and 02 are automated refactorings.)&lt;/p&gt;

&lt;p&gt;06&lt;br/&gt;
    add IdentityQueryFilter; finish removing IFilter&lt;/p&gt;

&lt;p&gt;05&lt;br/&gt;
    add TimeQueryFilter and nuke Timefilter&lt;/p&gt;

&lt;p&gt;04&lt;br/&gt;
    replace namesfilter with NamesQueryFilter.  mv filter code into separate package.&lt;/p&gt;

&lt;p&gt;03&lt;br/&gt;
    refactor out QueryFilter, SliceQueryFilter&lt;/p&gt;

&lt;p&gt;02&lt;br/&gt;
    rename lock_ -&amp;gt; sstableLock_&lt;/p&gt;

&lt;p&gt;01&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-287&quot; title=&quot;Make iterator-based read code the One True Path&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-287&quot;&gt;&lt;del&gt;CASSANDRA-287&lt;/del&gt;&lt;/a&gt; r/m unused (and dangerous) RowReadCommand&lt;/p&gt;</comment>
                            <comment id="12729442" author="junrao" created="Thu, 9 Jul 2009 23:04:28 +0000"  >&lt;p&gt;Review comments:&lt;br/&gt;
1. 0006 patch breaks compilation in unit test (merge conflicts included in the patch)&lt;br/&gt;
2. We should remove unused CMD_TYPE_GET_ROW,GET_SLICE AND SLICE_BY_RANGE in ReadCommand and renumber the rest.&lt;br/&gt;
3. SystemTable.StorageMetadata, 2nd line, change IdentityQueryFilter  to NamesQueryFilter.&lt;br/&gt;
4. What happens to those updateReadStatistics calls in various getRow in Table? Are they just got removed?&lt;br/&gt;
5. Need to add @override to all overridden methods in various filters class.&lt;/p&gt;</comment>
                            <comment id="12729467" author="jbellis" created="Fri, 10 Jul 2009 00:19:23 +0000"  >&lt;p&gt;thanks for having a look, Jun.&lt;/p&gt;

&lt;p&gt;1. oops. one too many rebases before submitting.  fixed.&lt;br/&gt;
2. fixed; if I&apos;m feeling extra energetic I&apos;ll make it an enum&lt;br/&gt;
3. hmm, I&apos;ll need to take a closer look at this one &amp;#8211; making that change breaks SystemTableTest&lt;br/&gt;
4. yes, so I&apos;m cheating a bit here to make the merge easier &amp;#8211; this is partially done in &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-272&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/CASSANDRA-272&lt;/a&gt; and will be completed in another patch&lt;br/&gt;
5. IMO it&apos;s bad form to @override an abstract method; are there others that I omitted?&lt;/p&gt;</comment>
                            <comment id="12729671" author="jbellis" created="Fri, 10 Jul 2009 15:25:17 +0000"  >&lt;p&gt;07 fixes points 1 and 2&lt;/p&gt;</comment>
                            <comment id="12729672" author="jbellis" created="Fri, 10 Jul 2009 15:26:33 +0000"  >&lt;p&gt;08 fixes point 3.  the problem was inconsistent handling of empty CFs &amp;#8211; to be consistent with the rest of cassandra, following the original FB conventions, an empty CF should be represented with a null reference.&lt;/p&gt;

&lt;p&gt;(IMO this is the wrong convention to pick but changing that is outside my scope for this ticket.)&lt;/p&gt;</comment>
                            <comment id="12729726" author="junrao" created="Fri, 10 Jul 2009 17:12:51 +0000"  >&lt;p&gt;The new patch looks good.&lt;/p&gt;</comment>
                            <comment id="12729740" author="jbellis" created="Fri, 10 Jul 2009 17:49:00 +0000"  >&lt;p&gt;committed&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12413127" name="0007-fixes.patch" size="3885" author="jbellis" created="Fri, 10 Jul 2009 15:25:17 +0000"/>
                            <attachment id="12413128" name="0008-fix-empty-CF-handling-should-always-be-null.patch" size="4075" author="jbellis" created="Fri, 10 Jul 2009 15:26:33 +0000"/>
                            <attachment id="12413023" name="ASF.LICENSE.NOT.GRANTED--0001-CASSANDRA-287-r-m-unused-and-dangerous-RowReadComman.txt" size="5091" author="jbellis" created="Thu, 9 Jul 2009 15:16:07 +0000"/>
                            <attachment id="12413024" name="ASF.LICENSE.NOT.GRANTED--0002-rename-lock_-sstableLock_.txt" size="5952" author="jbellis" created="Thu, 9 Jul 2009 15:16:07 +0000"/>
                            <attachment id="12413025" name="ASF.LICENSE.NOT.GRANTED--0003-refactor-out-QueryFilter-SliceQueryFilter.txt" size="12173" author="jbellis" created="Thu, 9 Jul 2009 15:16:07 +0000"/>
                            <attachment id="12413026" name="ASF.LICENSE.NOT.GRANTED--0004-replace-namesfilter-with-NamesQueryFilter.-mv-filter.txt" size="57776" author="jbellis" created="Thu, 9 Jul 2009 15:16:07 +0000"/>
                            <attachment id="12413027" name="ASF.LICENSE.NOT.GRANTED--0005-nuke-timefilter.txt" size="14423" author="jbellis" created="Thu, 9 Jul 2009 15:16:07 +0000"/>
                            <attachment id="12413028" name="ASF.LICENSE.NOT.GRANTED--0006-add-IdentityQueryFilter-finish-removing-IFilter.txt" size="60660" author="jbellis" created="Thu, 9 Jul 2009 15:16:07 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>8.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[jbellis]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>19622</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            16 years, 20 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0fy0f:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>91108</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12962"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>