<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 22:48:55 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-8108] Errors paging DISTINCT queries on static columns</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-8108</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;java.lang.ClassCastException: org.apache.cassandra.db.composites.Composites$EmptyComposite cannot be cast to org.apache.cassandra.db.composites.CellName
	at org.apache.cassandra.db.composites.AbstractCellNameType.cellFromByteBuffer(AbstractCellNameType.java:170) ~[apache-cassandra-2.1.0.jar:2.1.0]
	at org.apache.cassandra.service.pager.SliceQueryPager.&amp;lt;init&amp;gt;(SliceQueryPager.java:57) ~[apache-cassandra-2.1.0.jar:2.1.0]
	at org.apache.cassandra.service.pager.MultiPartitionPager.makePager(MultiPartitionPager.java:84) ~[apache-cassandra-2.1.0.jar:2.1.0]
	at org.apache.cassandra.service.pager.MultiPartitionPager.&amp;lt;init&amp;gt;(MultiPartitionPager.java:68) ~[apache-cassandra-2.1.0.jar:2.1.0]
	at org.apache.cassandra.service.pager.QueryPagers.pager(QueryPagers.java:101) ~[apache-cassandra-2.1.0.jar:2.1.0]
	at org.apache.cassandra.service.pager.QueryPagers.pager(QueryPagers.java:125) ~[apache-cassandra-2.1.0.jar:2.1.0]
	at org.apache.cassandra.cql3.statements.SelectStatement.execute(SelectStatement.java:215) ~[apache-cassandra-2.1.0.jar:2.1.0]
	at org.apache.cassandra.cql3.statements.SelectStatement.execute(SelectStatement.java:60) ~[apache-cassandra-2.1.0.jar:2.1.0]
	at org.apache.cassandra.cql3.QueryProcessor.processStatement(QueryProcessor.java:187) ~[apache-cassandra-2.1.0.jar:2.1.0]
	at org.apache.cassandra.cql3.QueryProcessor.processPrepared(QueryProcessor.java:413) ~[apache-cassandra-2.1.0.jar:2.1.0]
	at org.apache.cassandra.transport.messages.ExecuteMessage.execute(ExecuteMessage.java:133) ~[apache-cassandra-2.1.0.jar:2.1.0]
	at org.apache.cassandra.transport.Message$Dispatcher.channelRead0(Message.java:422) [apache-cassandra-2.1.0.jar:2.1.0]
	at org.apache.cassandra.transport.Message$Dispatcher.channelRead0(Message.java:318) [apache-cassandra-2.1.0.jar:2.1.0]
	at io.netty.channel.SimpleChannelInboundHandler.channelRead(SimpleChannelInboundHandler.java:103) [netty-all-4.0.20.Final.jar:4.0.20.Final]
	at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:332) [netty-all-4.0.20.Final.jar:4.0.20.Final]
	at io.netty.channel.AbstractChannelHandlerContext.access$700(AbstractChannelHandlerContext.java:31) [netty-all-4.0.20.Final.jar:4.0.20.Final]
	at io.netty.channel.AbstractChannelHandlerContext$8.run(AbstractChannelHandlerContext.java:323) [netty-all-4.0.20.Final.jar:4.0.20.Final]
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:471) [na:1.7.0_51]
	at org.apache.cassandra.concurrent.AbstractTracingAwareExecutorService$FutureTask.run(AbstractTracingAwareExecutorService.java:163) [apache-cassandra-2.1.0.jar:2.1.0]
	at org.apache.cassandra.concurrent.SEPWorker.run(SEPWorker.java:103) [apache-cassandra-2.1.0.jar:2.1.0]
	at java.lang.Thread.run(Thread.java:744) [na:1.7.0_51]
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment>&lt;p&gt;Cassandra 2.1.0&lt;br/&gt;
Datastax AMI on EC2 (Ubuntu Linux)&lt;/p&gt;</environment>
        <key id="12747641">CASSANDRA-8108</key>
            <summary>Errors paging DISTINCT queries on static columns</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10002" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Normal</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="thobbs">Tom Hobbs</assignee>
                                    <reporter username="hearndencanva">David Hearnden</reporter>
                        <labels>
                    </labels>
                <created>Mon, 13 Oct 2014 04:00:44 +0000</created>
                <updated>Tue, 16 Apr 2019 09:31:31 +0000</updated>
                            <resolved>Thu, 16 Oct 2014 16:13:35 +0000</resolved>
                                        <fixVersion>2.0.11</fixVersion>
                    <fixVersion>2.1.1</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="14168972" author="hearndencanva" created="Mon, 13 Oct 2014 05:45:36 +0000"  >&lt;p&gt;I get this performing a `SELECT DISCTINCT` query on some static columns using the Java driver version 2.1.1&lt;/p&gt;</comment>
                            <comment id="14171540" author="thobbs" created="Tue, 14 Oct 2014 21:13:58 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=hearndencanva&quot; class=&quot;user-hover&quot; rel=&quot;hearndencanva&quot;&gt;hearndencanva&lt;/a&gt; can you paste your schema for this table and the query that results in this error?&lt;/p&gt;</comment>
                            <comment id="14171556" author="hearndencanva" created="Tue, 14 Oct 2014 21:26:32 +0000"  >&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;CREATE TABLE comments (
    object ascii,
    id timeuuid,
    ...
    latest_content text static,
    ...
    PRIMARY KEY (object, id)
) WITH CLUSTERING ORDER BY (id DESC)
    AND bloom_filter_fp_chance = 0.01
    AND caching = &apos;{&quot;keys&quot;:&quot;ALL&quot;, &quot;rows_per_partition&quot;:&quot;NONE&quot;}&apos;
    AND comment = &apos;&apos;
    AND compaction = {&apos;min_threshold&apos;: &apos;4&apos;, &apos;class&apos;: &apos;org.apache.cassandra.db.compaction.SizeTieredCompactionStrategy&apos;, &apos;max_threshold&apos;: &apos;32&apos;}
    AND compression = {&apos;sstable_compression&apos;: &apos;org.apache.cassandra.io.compress.LZ4Compressor&apos;}
    AND dclocal_read_repair_chance = 0.1
    AND default_time_to_live = 0
    AND gc_grace_seconds = 864000
    AND max_index_interval = 2048
    AND memtable_flush_period_in_ms = 0
    AND min_index_interval = 128
    AND read_repair_chance = 0.0
    AND speculative_retry = &apos;99.0PERCENTILE&apos;;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The query that triggers the exception:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;SELECT DISTINCT object, latest_content 
FROM comments
WHERE object IN (...);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I only observe this error running Cassandra 2.1.0 via the Datastax AMI 2.5.1 (Ubuntu Linux 12.04) on EC2 (ami-ada2b6c4).&lt;br/&gt;
I don&apos;t observe this error running Cassandra 2.1.0 on 0S X 10.9.&lt;br/&gt;
I&apos;m about to test running Cassandra 2.1.0 on Ubuntu Linux 14.04 on EC2.&lt;/p&gt;</comment>
                            <comment id="14171577" author="thobbs" created="Tue, 14 Oct 2014 21:41:46 +0000"  >&lt;p&gt;Thanks, I can reproduce the issue.&lt;/p&gt;

&lt;p&gt;As a workaround in the meantime, you can disable paging at the driver level.  There should be a setFetchSize() command somewhere to do that.  Of course, if you&apos;re fetching a lot of keys at once, you&apos;ll want to break that up.&lt;/p&gt;</comment>
                            <comment id="14171646" author="hearndencanva" created="Tue, 14 Oct 2014 22:33:18 +0000"  >&lt;p&gt;Thanks Tyler, you helped me find an issue on my side - I had set the fetch size to 1, which was too low for that query.  I&apos;m now setting the fetch size to the expected number of results, and no longer see this issue.&lt;/p&gt;</comment>
                            <comment id="14172995" author="thobbs" created="Wed, 15 Oct 2014 21:38:44 +0000"  >&lt;p&gt;There were a couple of problems.  The first was that when the cell name in the paging state was null, an empty composite would be used, which isn&apos;t a valid CellName.  Switching to a Composite for the slice start fixed that.  The second problem was that the limit for individual slice queries would be overwritten with the page size; in the case of a DISTINCT query with static columns, the limit for each slice query should be 1.&lt;/p&gt;

&lt;p&gt;I&apos;m not 100% confident that this is the best fix, so please review carefully.&lt;/p&gt;

&lt;p&gt;I also added some documentation and did some minor renaming in AbstractQueryPager.&lt;/p&gt;

&lt;p&gt;Besides 8108.txt, there&apos;s also a &lt;a href=&quot;https://github.com/thobbs/cassandra/tree/CASSANDRA-8108&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;branch&lt;/a&gt; and a new &lt;a href=&quot;https://github.com/thobbs/cassandra-dtest/tree/CASSANDRA-8108&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;dtest&lt;/a&gt;.  I also ran the python driver paging tests and the tests from the &lt;a href=&quot;https://github.com/riptano/cassandra-dtest/pull/93&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;paging dtests branch&lt;/a&gt; to check for regressions.&lt;/p&gt;</comment>
                            <comment id="14173185" author="thobbs" created="Thu, 16 Oct 2014 00:42:28 +0000"  >&lt;p&gt;It looks like the second fix I mentioned is the cause for &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-8087&quot; title=&quot;Multiple non-DISTINCT rows returned when page_size set&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-8087&quot;&gt;&lt;del&gt;CASSANDRA-8087&lt;/del&gt;&lt;/a&gt;, so I&apos;ll resolve that as a duplicate of this and attach a patch for 2.0.&lt;/p&gt;</comment>
                            <comment id="14173849" author="slebresne" created="Thu, 16 Oct 2014 15:16:33 +0000"  >&lt;p&gt;+1 to both patches (but the filter count change might deserve a comment &amp;#8211; I don&apos;t see a much simpler/better fix right now, but it&apos;s still somewhat subtle).&lt;/p&gt;</comment>
                            <comment id="14173907" author="thobbs" created="Thu, 16 Oct 2014 16:13:35 +0000"  >&lt;p&gt;Thanks, committed with a comment on the limit calculation.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                                                <inwardlinks description="is duplicated by">
                                        <issuelink>
            <issuekey id="12746828">CASSANDRA-8087</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12675164" name="8108-2.0.txt" size="899" author="thobbs" created="Thu, 16 Oct 2014 00:45:43 +0000"/>
                            <attachment id="12675121" name="8108.txt" size="5922" author="thobbs" created="Wed, 15 Oct 2014 21:38:44 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[thobbs]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            11 years, 5 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i21393:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12311421" key="com.atlassian.jira.plugin.system.customfieldtypes:multiversion">
                        <customfieldname>Reproduced In</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="12327164">2.0.10</customfieldvalue>
    <customfieldvalue id="12327256">2.1.0</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>slebresne</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[slebresne]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12962"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>