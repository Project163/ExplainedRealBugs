<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 22:23:57 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-3289] assert err on ArrayBackedSortedColumns.addColumn(ArrayBackedSortedColumns.java:126)</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-3289</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;I have the following in trunk:&lt;/p&gt;

&lt;p&gt;RowKey: b&lt;br/&gt;
=&amp;gt; (column=a, value=38383838383838383838, timestamp=1317421952793000)&lt;br/&gt;
=&amp;gt; (column=d, value=617364646661736466, timestamp=1317420968944000)&lt;br/&gt;
=&amp;gt; (column=e, value=38383838383838383838, timestamp=1317421096152000)&lt;br/&gt;
=&amp;gt; (column=f, value=33343334333433343334, timestamp=1317422838818000)&lt;br/&gt;
=&amp;gt; (column=g, value=33343334333433343334, timestamp=1317422565130000)&lt;br/&gt;
=&amp;gt; (column=i, value=33343334333433343334, timestamp=1317422879258000)&lt;br/&gt;
=&amp;gt; (column=j, value=33343334333433343334, timestamp=1317422814873000)&lt;br/&gt;
=&amp;gt; (column=o, value=33343334333433343334, timestamp=1317422867106000)&lt;br/&gt;
=&amp;gt; (column=x, value=33343334333433343334, timestamp=1317422394097000)&lt;br/&gt;
=&amp;gt; (column=z, value=38383838383838383838, timestamp=1317421982057000)&lt;/p&gt;

&lt;p&gt;Keyspace: testks:&lt;br/&gt;
  Replication Strategy: org.apache.cassandra.locator.NetworkTopologyStrategy&lt;br/&gt;
  Durable Writes: true&lt;br/&gt;
    Options: &lt;span class=&quot;error&quot;&gt;&amp;#91;168:1&amp;#93;&lt;/span&gt;&lt;br/&gt;
  Column Families:&lt;br/&gt;
    ColumnFamily: testcf&lt;br/&gt;
      Key Validation Class: org.apache.cassandra.db.marshal.BytesType&lt;br/&gt;
      Default column value validator: org.apache.cassandra.db.marshal.BytesType&lt;br/&gt;
      Columns sorted by: org.apache.cassandra.db.marshal.BytesType&lt;br/&gt;
      Row cache size / save period in seconds / keys to save : 0.0/0/all&lt;br/&gt;
      Key cache size / save period in seconds: 200000.0/14400&lt;br/&gt;
      GC grace seconds: 864000&lt;br/&gt;
      Compaction min/max thresholds: 4/32&lt;br/&gt;
      Read repair chance: 1.0&lt;br/&gt;
      Replicate on write: true&lt;br/&gt;
      Built indexes: []&lt;br/&gt;
      Compaction Strategy: org.apache.cassandra.db.compaction.SizeTieredCompactionStrategy&lt;/p&gt;

&lt;p&gt;every thing is flushed to the sstables, but not in the same sstables, and the columns are in some what &apos;random&apos; form:&lt;/p&gt;

&lt;p&gt;/var/lib/cassandra/data/testks/testcf-h-10-Data.db&lt;br/&gt;
{&lt;br/&gt;
&quot;61&quot;: [&lt;span class=&quot;error&quot;&gt;&amp;#91;&amp;quot;0c&amp;quot;,&amp;quot;76&amp;quot;,1317405903119000&amp;#93;&lt;/span&gt;, &lt;span class=&quot;error&quot;&gt;&amp;#91;&amp;quot;0d&amp;quot;,&amp;quot;76&amp;quot;,1317405977002000&amp;#93;&lt;/span&gt;, &lt;span class=&quot;error&quot;&gt;&amp;#91;&amp;quot;7a&amp;quot;,&amp;quot;38383838383838383838&amp;quot;,1317422276322000&amp;#93;&lt;/span&gt;],&lt;br/&gt;
&quot;62&quot;: [&lt;span class=&quot;error&quot;&gt;&amp;#91;&amp;quot;61&amp;quot;,&amp;quot;38383838383838383838&amp;quot;,1317421952793000&amp;#93;&lt;/span&gt;, &lt;span class=&quot;error&quot;&gt;&amp;#91;&amp;quot;63&amp;quot;,&amp;quot;4e864303&amp;quot;,1317421827329000,&amp;quot;d&amp;quot;&amp;#93;&lt;/span&gt;, &lt;span class=&quot;error&quot;&gt;&amp;#91;&amp;quot;64&amp;quot;,&amp;quot;617364646661736466&amp;quot;,1317420968944000&amp;#93;&lt;/span&gt;, &lt;span class=&quot;error&quot;&gt;&amp;#91;&amp;quot;65&amp;quot;,&amp;quot;38383838383838383838&amp;quot;,1317421096152000&amp;#93;&lt;/span&gt;, &lt;span class=&quot;error&quot;&gt;&amp;#91;&amp;quot;67&amp;quot;,&amp;quot;33343334333433343334&amp;quot;,1317422565130000&amp;#93;&lt;/span&gt;, &lt;span class=&quot;error&quot;&gt;&amp;#91;&amp;quot;78&amp;quot;,&amp;quot;33343334333433343334&amp;quot;,1317422394097000&amp;#93;&lt;/span&gt;, &lt;span class=&quot;error&quot;&gt;&amp;#91;&amp;quot;7a&amp;quot;,&amp;quot;38383838383838383838&amp;quot;,1317421982057000&amp;#93;&lt;/span&gt;]&lt;br/&gt;
}&lt;br/&gt;
/var/lib/cassandra/data/testks/testcf-h-12-Data.db&lt;br/&gt;
{&lt;br/&gt;
&quot;62&quot;: [&lt;span class=&quot;error&quot;&gt;&amp;#91;&amp;quot;6a&amp;quot;,&amp;quot;33343334333433343334&amp;quot;,1317422814873000&amp;#93;&lt;/span&gt;]&lt;br/&gt;
}&lt;br/&gt;
/var/lib/cassandra/data/testks/testcf-h-13-Data.db&lt;br/&gt;
{&lt;br/&gt;
&quot;62&quot;: [&lt;span class=&quot;error&quot;&gt;&amp;#91;&amp;quot;66&amp;quot;,&amp;quot;33343334333433343334&amp;quot;,1317422838818000&amp;#93;&lt;/span&gt;]&lt;br/&gt;
}&lt;br/&gt;
/var/lib/cassandra/data/testks/testcf-h-14-Data.db&lt;br/&gt;
{&lt;br/&gt;
&quot;62&quot;: [&lt;span class=&quot;error&quot;&gt;&amp;#91;&amp;quot;6f&amp;quot;,&amp;quot;33343334333433343334&amp;quot;,1317422867106000&amp;#93;&lt;/span&gt;]&lt;br/&gt;
}&lt;br/&gt;
/var/lib/cassandra/data/testks/testcf-h-15-Data.db&lt;br/&gt;
{&lt;br/&gt;
&quot;62&quot;: [&lt;span class=&quot;error&quot;&gt;&amp;#91;&amp;quot;69&amp;quot;,&amp;quot;33343334333433343334&amp;quot;,1317422879258000&amp;#93;&lt;/span&gt;]&lt;br/&gt;
}&lt;/p&gt;


&lt;p&gt;then i basically make a call to get key=b with all the column names (yes included column names that didn&apos;t exist to save time):&lt;/p&gt;

&lt;p&gt;ColumnFamilyResult&amp;lt;String, String&amp;gt; queryColumns = template.queryColumns(&quot;b&quot;, Arrays.asList(&quot;a&quot;,&quot;b&quot;,&quot;c&quot;,&quot;d&quot;,&quot;e&quot;,&quot;f&quot;,&quot;g&quot;,&quot;h&quot;,&quot;i&quot;,&quot;j&quot;,&quot;k&quot;,&quot;l&quot;,&quot;m&quot;,&quot;n&quot;,&quot;o&quot;,&quot;p&quot;,&quot;q&quot;,&quot;r&quot;,&quot;s&quot;,&quot;t&quot;,&quot;u&quot;,&quot;v&quot;,&quot;w&quot;,&quot;x&quot;,&quot;y&quot;,&quot;z&quot;));&lt;/p&gt;

&lt;p&gt;(let me know if it would be easier to just upload the sstables to the ticket)&lt;/p&gt;</description>
                <environment></environment>
        <key id="12525378">CASSANDRA-3289</key>
            <summary>assert err on ArrayBackedSortedColumns.addColumn(ArrayBackedSortedColumns.java:126)</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10000" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Urgent</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="jbellis">Jonathan Ellis</assignee>
                                    <reporter username="cywjackson">Jackson Chung</reporter>
                        <labels>
                    </labels>
                <created>Fri, 30 Sep 2011 23:06:06 +0000</created>
                <updated>Tue, 16 Apr 2019 09:32:49 +0000</updated>
                            <resolved>Sat, 1 Oct 2011 15:04:25 +0000</resolved>
                                        <fixVersion>1.0.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                                                                <comments>
                            <comment id="13118559" author="cywjackson" created="Fri, 30 Sep 2011 23:08:54 +0000"  >&lt;p&gt;should mention a workaround is to do major compaction to stack everything back to a single sstable&lt;/p&gt;</comment>
                            <comment id="13118627" author="jbellis" created="Sat, 1 Oct 2011 02:01:19 +0000"  >&lt;p&gt;The full trace:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;java.lang.AssertionError: Added column does not sort as the last column
        at org.apache.cassandra.db.ArrayBackedSortedColumns.addColumn(ArrayBackedSortedColumns.java:126)
        at org.apache.cassandra.db.AbstractColumnContainer.addColumn(AbstractColumnContainer.java:123)
        at org.apache.cassandra.db.AbstractColumnContainer.addColumn(AbstractColumnContainer.java:118)
        at org.apache.cassandra.db.CollationController.collectTimeOrderedData(CollationController.java:116)
        at org.apache.cassandra.db.CollationController.getTopLevelColumns(CollationController.java:61)
        at org.apache.cassandra.db.ColumnFamilyStore.getTopLevelColumns(ColumnFamilyStore.java:1297)
        at org.apache.cassandra.db.ColumnFamilyStore.getColumnFamily(ColumnFamilyStore.java:1147)
        at org.apache.cassandra.db.ColumnFamilyStore.getColumnFamily(ColumnFamilyStore.java:1114)
        at org.apache.cassandra.db.Table.getRow(Table.java:388)
        at org.apache.cassandra.db.SliceByNamesReadCommand.getRow(SliceByNamesReadCommand.java:58)
        at org.apache.cassandra.service.StorageProxy$LocalReadRunnable.runMayThrow(StorageProxy.java:795)
        at org.apache.cassandra.service.StorageProxy$DroppableRunnable.run(StorageProxy.java:1263)
        at java.util.concurrent.ThreadPoolExecutor$Worker.runTask(ThreadPoolExecutor.java:886)
        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:908)
        at java.lang.Thread.run(Thread.java:662)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="13118634" author="jbellis" created="Sat, 1 Oct 2011 02:14:46 +0000"  >&lt;p&gt;collectTimeOrderedData has to use a column store that allows random inserts.  Patch attached to use ThreadSafeSortedColumns there, and ArrayBacked for collectAllData.&lt;/p&gt;</comment>
                            <comment id="13118806" author="slebresne" created="Sat, 1 Oct 2011 13:33:55 +0000"  >&lt;p&gt;Unfortunately this doesn&apos;t work in the case of reading to put in the cache, because in that case, we need to always use ThreadSafeSortedColumns (in CFS, line 1128). I see a few solutions:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;make ABSC work even if the input doesn&apos;t arrive in sorted order (i.e, remove the assertion since the code is already there). We had this debate already, I still think that it is a solution that make sense and note that in that case it would likely still be the more efficient solution. But I can understand that feeling is not shared.&lt;/li&gt;
	&lt;li&gt;make CollactionController only use non thread-safe CF (a little bit like the attached patch, but using TreeMapSortedColumns in the collectTimeOrderedData) &lt;b&gt;and&lt;/b&gt; add a  cloneMe towards TSSC in the &apos;read for cache&apos; case. But that involves a copy of the CF.&lt;/li&gt;
	&lt;li&gt;instead of passing the Factory around, pass a boolean indicating if the returned CF should be thread safe or not. In that way, if the boolean is true, both collectTimeOrderedData and collectAddData would use TSSC, otherwise, cTOD would use TMSC and cAD would use ABSC.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Again, I think the first one has my preference, but if we&apos;re afraid that by doing so we&apos;ll start using ABSC in places where it&apos;s clearly not the most efficient solution, then the last solution is probably the best one.&lt;/p&gt;

&lt;p&gt;But I would agree that this passing of Factory around is not very easy to use correctly and we should probably come up with a cleaner solution.&lt;/p&gt;</comment>
                            <comment id="13118820" author="jbellis" created="Sat, 1 Oct 2011 14:16:06 +0000"  >&lt;p&gt;v2 attached.  you will perhaps not be surprised that I prefer the boolean approach. &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="13118826" author="slebresne" created="Sat, 1 Oct 2011 14:52:32 +0000"  >&lt;blockquote&gt;&lt;p&gt;v2 attached&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;+1&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;you will perhaps not be surprised that I prefer the boolean approach&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;nothing ventured, nothing gained &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="13118830" author="jbellis" created="Sat, 1 Oct 2011 15:04:25 +0000"  >&lt;p&gt;committed&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12497361" name="3289-v2.txt" size="5457" author="jbellis" created="Sat, 1 Oct 2011 14:16:05 +0000"/>
                            <attachment id="12497262" name="3289.txt" size="3542" author="jbellis" created="Sat, 1 Oct 2011 02:14:46 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[jbellis]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>41740</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            14 years, 8 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0gi3j:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>94362</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>slebresne</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[slebresne]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12963"><![CDATA[Critical]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>