<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 23:04:07 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-12336] NullPointerException during compaction on table with static columns</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-12336</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;After being affected by &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-11988&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/CASSANDRA-11988&lt;/a&gt;, we built a5cbb0. &lt;/p&gt;

&lt;p&gt;Compaction still fails with the following trace:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;WARN  [SharedPool-Worker-2] 2016-07-28 10:51:56,111 AbstractLocalAwareExecutorService.java:169 - Uncaught exception on thread &lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;[SharedPool-Worker-2,5,main]: {}
java.lang.RuntimeException: java.lang.NullPointerException
	at org.apache.cassandra.service.StorageProxy$DroppableRunnable.run(StorageProxy.java:2453) ~[main/:na]
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511) ~[na:1.8.0_72]
	at org.apache.cassandra.concurrent.AbstractLocalAwareExecutorService$FutureTask.run(AbstractLocalAwareExecutorService.java:164) ~[main/:na]
	at org.apache.cassandra.concurrent.AbstractLocalAwareExecutorService$LocalSessionFutureTask.run(AbstractLocalAwareExecutorService.java:136) [main/:na]
	at org.apache.cassandra.concurrent.SEPWorker.run(SEPWorker.java:105) [main/:na]
	at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:745) [na:1.8.0_72]
Caused by: java.lang.NullPointerException: &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;
	at org.apache.cassandra.db.ReadCommand$1MetricRecording.applyToRow(ReadCommand.java:466) ~[main/:na]
	at org.apache.cassandra.db.ReadCommand$1MetricRecording.applyToStatic(ReadCommand.java:460) ~[main/:na]
	at org.apache.cassandra.db.transform.BaseRows.add(BaseRows.java:105) ~[main/:na]
	at org.apache.cassandra.db.transform.UnfilteredRows.add(UnfilteredRows.java:41) ~[main/:na]
	at org.apache.cassandra.db.transform.Transformation.add(Transformation.java:156) ~[main/:na]
	at org.apache.cassandra.db.transform.Transformation.apply(Transformation.java:122) ~[main/:na]
	at org.apache.cassandra.db.ReadCommand$1MetricRecording.applyToPartition(ReadCommand.java:454) ~[main/:na]
	at org.apache.cassandra.db.ReadCommand$1MetricRecording.applyToPartition(ReadCommand.java:438) ~[main/:na]
	at org.apache.cassandra.db.transform.BasePartitions.hasNext(BasePartitions.java:96) ~[main/:na]
	at org.apache.cassandra.db.partitions.UnfilteredPartitionIterators$Serializer.serialize(UnfilteredPartitionIterators.java:295) ~[main/:na]
	at org.apache.cassandra.db.ReadResponse$LocalDataResponse.build(ReadResponse.java:145) ~[main/:na]
	at org.apache.cassandra.db.ReadResponse$LocalDataResponse.&amp;lt;init&amp;gt;(ReadResponse.java:138) ~[main/:na]
	at org.apache.cassandra.db.ReadResponse$LocalDataResponse.&amp;lt;init&amp;gt;(ReadResponse.java:134) ~[main/:na]
	at org.apache.cassandra.db.ReadResponse.createDataResponse(ReadResponse.java:76) ~[main/:na]
	at org.apache.cassandra.db.ReadCommand.createResponse(ReadCommand.java:320) ~[main/:na]
	at org.apache.cassandra.service.StorageProxy$LocalReadRunnable.runMayThrow(StorageProxy.java:1796) ~[main/:na]
	at org.apache.cassandra.service.StorageProxy$DroppableRunnable.run(StorageProxy.java:2449) ~[main/:na]
	... 5 common frames omitted
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
</description>
                <environment>&lt;p&gt;cqlsh 5.0.1&lt;br/&gt;
Cassandra 3.0.8-SNAPSHOT (3.0.x dev - a5cbb0)&lt;/p&gt;</environment>
        <key id="12993291">CASSANDRA-12336</key>
            <summary>NullPointerException during compaction on table with static columns</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10002" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Normal</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="slebresne">Sylvain Lebresne</assignee>
                                    <reporter username="eprothro">Evan Prothro</reporter>
                        <labels>
                    </labels>
                <created>Thu, 28 Jul 2016 16:59:56 +0000</created>
                <updated>Tue, 16 Apr 2019 09:30:24 +0000</updated>
                            <resolved>Fri, 5 Aug 2016 13:05:04 +0000</resolved>
                                        <fixVersion>3.0.9</fixVersion>
                    <fixVersion>3.8</fixVersion>
                                    <component>Local/Compaction</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="15397828" author="eprothro" created="Thu, 28 Jul 2016 17:02:22 +0000"  >&lt;p&gt;Currently we&apos;re working around this by effectively disabling compaction with an extremely high value for `gc_grace_seconds` on tables with static fields. Clearly the shorter we have to live with that workaround the less nervous we are.&lt;/p&gt;

&lt;p&gt;Please don&apos;t hesitate to let us know anything we can do to help isolate or reproduce. We can provide an sstable and schema that should reproduce.&lt;br/&gt;
Reply&lt;/p&gt;</comment>
                            <comment id="15399114" author="slebresne" created="Fri, 29 Jul 2016 10:44:31 +0000"  >&lt;p&gt;The patch for &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-11988&quot; title=&quot;NullPointerException when reading/compacting table&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-11988&quot;&gt;&lt;del&gt;CASSANDRA-11988&lt;/del&gt;&lt;/a&gt; wasn&apos;t thorough enough. While the iterator won&apos;t return &lt;tt&gt;null&lt;/tt&gt; static rows, we may still have &lt;tt&gt;BaseRows.staticRow == null&lt;/tt&gt; after a transformation, and since transformation are &quot;chained&quot;, we can end up passing a &lt;tt&gt;null&lt;/tt&gt; to an &lt;tt&gt;applytoStatic()&lt;/tt&gt; call, which shouldn&apos;t really be done. Anyway, it&apos;s pretty easy to fix by guarding the call to &lt;tt&gt;applytoStatic()&lt;/tt&gt; (much like the call to &lt;tt&gt;applyToRow()&lt;/tt&gt; is for that matter).&lt;/p&gt;

&lt;p&gt;I was surprised the test added by &lt;tt&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-11988&quot; title=&quot;NullPointerException when reading/compacting table&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-11988&quot;&gt;&lt;del&gt;CASSANDRA-11988&lt;/del&gt;&lt;/a&gt;&lt;/tt&gt; didn&apos;t catch it but it appears to be a timing issue: even though the test sets &lt;tt&gt;gc_grace == 0&lt;/tt&gt;, it should wait at least 1 second to make sure stuffs gets purged, and I get to reproduce consistently with that additional wait (including in the patch below).&lt;/p&gt;

&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;a href=&quot;https://github.com/pcmanus/cassandra/commits/12336-3.0&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;12336-3.0&lt;/a&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;a href=&quot;http://cassci.datastax.com/job/pcmanus-12336-3.0-testall&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;utests&lt;/a&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;a href=&quot;http://cassci.datastax.com/job/pcmanus-12336-3.0-dtest&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;dtests&lt;/a&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;a href=&quot;https://github.com/pcmanus/cassandra/commits/12336-3.9&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;12336-3.9&lt;/a&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;a href=&quot;http://cassci.datastax.com/job/pcmanus-12336-3.9-testall&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;utests&lt;/a&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;a href=&quot;http://cassci.datastax.com/job/pcmanus-12336-3.9-dtest&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;dtests&lt;/a&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;
</comment>
                            <comment id="15399380" author="eprothro" created="Fri, 29 Jul 2016 14:07:19 +0000"  >&lt;p&gt;Confirmed that patch &lt;a href=&quot;https://github.com/pcmanus/cassandra/commits/12336-3.0&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;12336-3.0&lt;/a&gt; fixes this issue for us. Both manual and triggered-from-read compaction work without error.&lt;/p&gt;</comment>
                            <comment id="15399760" author="dannyantonetti" created="Fri, 29 Jul 2016 17:56:51 +0000"  >&lt;p&gt;This patch does seem to fix the issue that we saw before.&lt;/p&gt;</comment>
                            <comment id="15399763" author="dannyantonetti" created="Fri, 29 Jul 2016 17:58:38 +0000"  >&lt;p&gt;Looking a little bit into this, these seem to be bad rows in our database.&lt;br/&gt;
Is there a way to find them (maybe add a logging statement on the primary key), so that we can identify the records and investigate further, to see how many records that we have like this.&lt;/p&gt;</comment>
                            <comment id="15399808" author="eprothro" created="Fri, 29 Jul 2016 18:22:47 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=dannyantonetti&quot; class=&quot;user-hover&quot; rel=&quot;dannyantonetti&quot;&gt;dannyantonetti&lt;/a&gt; have you tried using &lt;tt&gt;sstabledump&lt;/tt&gt; to inspect your data? &lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://www.datastax.com/dev/blog/debugging-sstables-in-3-0-with-sstabledump&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://www.datastax.com/dev/blog/debugging-sstables-in-3-0-with-sstabledump&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15407830" author="slebresne" created="Thu, 4 Aug 2016 14:14:54 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=carlyeks&quot; class=&quot;user-hover&quot; rel=&quot;carlyeks&quot;&gt;carlyeks&lt;/a&gt; gentle ping to know if you would have time to have a quick look at this. The patch is a one liner and the test looks clear (though I just rebased and re-ran them to make doubly sure). I&apos;m off for vacation soon and I&apos;d rather not have that fell through the cracks. Thanks.&lt;/p&gt;</comment>
                            <comment id="15407836" author="carlyeks" created="Thu, 4 Aug 2016 14:19:53 +0000"  >&lt;p&gt;Sorry about that; didn&apos;t see it was patch available.&lt;/p&gt;

&lt;p&gt;+1, assuming a clean CI rerun&lt;/p&gt;</comment>
                            <comment id="15409419" author="slebresne" created="Fri, 5 Aug 2016 13:05:04 +0000"  >&lt;p&gt;Tests looked good so committed, thanks.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12977459">CASSANDRA-11988</issuekey>
        </issuelink>
                            </outwardlinks>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="13001795">CASSANDRA-12582</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[slebresne]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 15 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i31mt3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>carlyeks</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[carlyeks]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12962"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>