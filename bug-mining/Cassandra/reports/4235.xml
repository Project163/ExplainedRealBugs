<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 23:02:34 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-9935] Repair fails with RuntimeException</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-9935</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;We had problems with slow repair in 2.1.7 (&lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-9702&quot; title=&quot;Repair running really slow&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-9702&quot;&gt;&lt;del&gt;CASSANDRA-9702&lt;/del&gt;&lt;/a&gt;) but after upgrade to 2.1.8 it started to work faster but now it fails with:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;...
[2015-07-29 20:44:03,956] Repair session 23a811b0-3632-11e5-a93e-4963524a8bde &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; range (-5474076923322749342,-5468600594078911162] finished
[2015-07-29 20:44:03,957] Repair session 336f8740-3632-11e5-a93e-4963524a8bde &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; range (-8631877858109464676,-8624040066373718932] finished
[2015-07-29 20:44:03,957] Repair session 4ccd8430-3632-11e5-a93e-4963524a8bde &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; range (-5372806541854279315,-5369354119480076785] finished
[2015-07-29 20:44:03,957] Repair session 59f129f0-3632-11e5-a93e-4963524a8bde &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; range (8166489034383821955,8168408930184216281] finished
[2015-07-29 20:44:03,957] Repair session 6ae7a9a0-3632-11e5-a93e-4963524a8bde &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; range (6084602890817326921,6088328703025510057] finished
[2015-07-29 20:44:03,957] Repair session 8938e4a0-3632-11e5-a93e-4963524a8bde &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; range (-781874602493000830,-781745173070807746] finished
[2015-07-29 20:44:03,957] Repair command #4 finished
error: nodetool failed, check server logs
-- StackTrace --
java.lang.RuntimeException: nodetool failed, check server logs
        at org.apache.cassandra.tools.NodeTool$NodeToolCmd.run(NodeTool.java:290)
        at org.apache.cassandra.tools.NodeTool.main(NodeTool.java:202)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;After running:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;nodetool repair --partitioner-range --parallel --in-local-dc sync
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Last records in logs regarding repair are:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;INFO  [&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;-173887] 2015-07-29 20:44:03,956 StorageService.java:2952 - Repair session 09ff9e40-3632-11e5-a93e-4963524a8bde &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; range (-7695808664784761779,-7693529816291585568] finished
INFO  [&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;-173887] 2015-07-29 20:44:03,956 StorageService.java:2952 - Repair session 17d8d860-3632-11e5-a93e-4963524a8bde &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; range (8063716953988492222,8065203836608925992] finished
INFO  [&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;-173887] 2015-07-29 20:44:03,956 StorageService.java:2952 - Repair session 23a811b0-3632-11e5-a93e-4963524a8bde &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; range (-5474076923322749342,-5468600594078911162] finished
INFO  [&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;-173887] 2015-07-29 20:44:03,956 StorageService.java:2952 - Repair session 336f8740-3632-11e5-a93e-4963524a8bde &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; range (-8631877858109464676,-8624040066373718932] finished
INFO  [&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;-173887] 2015-07-29 20:44:03,957 StorageService.java:2952 - Repair session 4ccd8430-3632-11e5-a93e-4963524a8bde &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; range (-5372806541854279315,-5369354119480076785] finished
INFO  [&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;-173887] 2015-07-29 20:44:03,957 StorageService.java:2952 - Repair session 59f129f0-3632-11e5-a93e-4963524a8bde &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; range (8166489034383821955,8168408930184216281] finished
INFO  [&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;-173887] 2015-07-29 20:44:03,957 StorageService.java:2952 - Repair session 6ae7a9a0-3632-11e5-a93e-4963524a8bde &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; range (6084602890817326921,6088328703025510057] finished
INFO  [&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;-173887] 2015-07-29 20:44:03,957 StorageService.java:2952 - Repair session 8938e4a0-3632-11e5-a93e-4963524a8bde &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; range (-781874602493000830,-781745173070807746] finished
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;but a bit above I see (at least two times in attached log):&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;ERROR [&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;-173887] 2015-07-29 20:44:03,853 StorageService.java:2959 - Repair session 1b07ea50-3608-11e5-a93e-4963524a8bde &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; range (5765414319217852786,5781018794516851576] failed with error org.apache.cassandra.exceptions.RepairException: [repair #1b07ea50-3608-11e5-a93e-4963524a8bde on sync/entity_by_id2, (5765414319217852786,5781018794516851576]] Validation failed in /10.195.15.162
java.util.concurrent.ExecutionException: java.lang.RuntimeException: org.apache.cassandra.exceptions.RepairException: [repair #1b07ea50-3608-11e5-a93e-4963524a8bde on sync/entity_by_id2, (5765414319217852786,5781018794516851576]] Validation failed in /10.195.15.162
        at java.util.concurrent.FutureTask.report(FutureTask.java:122) [na:1.7.0_80]
        at java.util.concurrent.FutureTask.get(FutureTask.java:188) [na:1.7.0_80]
        at org.apache.cassandra.service.StorageService$4.runMayThrow(StorageService.java:2950) ~[apache-cassandra-2.1.8.jar:2.1.8]
        at org.apache.cassandra.utils.WrappedRunnable.run(WrappedRunnable.java:28) [apache-cassandra-2.1.8.jar:2.1.8]
        at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:471) [na:1.7.0_80]
        at java.util.concurrent.FutureTask.run(FutureTask.java:262) [na:1.7.0_80]
        at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:745) [na:1.7.0_80]
Caused by: java.lang.RuntimeException: org.apache.cassandra.exceptions.RepairException: [repair #1b07ea50-3608-11e5-a93e-4963524a8bde on sync/entity_by_id2, (5765414319217852786,5781018794516851576]] Validation failed in /10.195.15.162
        at com.google.common.base.Throwables.propagate(Throwables.java:160) ~[guava-16.0.jar:na]
        at org.apache.cassandra.utils.WrappedRunnable.run(WrappedRunnable.java:32) [apache-cassandra-2.1.8.jar:2.1.8]
        at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:471) [na:1.7.0_80]
        at java.util.concurrent.FutureTask.run(FutureTask.java:262) [na:1.7.0_80]
        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1145) ~[na:1.7.0_80]
        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:615) ~[na:1.7.0_80]        ... 1 common frames omitted
Caused by: org.apache.cassandra.exceptions.RepairException: [repair #1b07ea50-3608-11e5-a93e-4963524a8bde on sync/entity_by_id2, (5765414319217852786,5781018794516851576]] Validation failed in /10.195.15.162
        at org.apache.cassandra.repair.RepairSession.validationComplete(RepairSession.java:166) ~[apache-cassandra-2.1.8.jar:2.1.8]        at org.apache.cassandra.service.ActiveRepairService.handleMessage(ActiveRepairService.java:406) ~[apache-cassandra-2.1.8.jar:2.1.8]
        at org.apache.cassandra.repair.RepairMessageVerbHandler.doVerb(RepairMessageVerbHandler.java:134) ~[apache-cassandra-2.1.8.jar:2.1.8]        at org.apache.cassandra.net.MessageDeliveryTask.run(MessageDeliveryTask.java:62) ~[apache-cassandra-2.1.8.jar:2.1.8]
        ... 3 common frames omittedINFO  [&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;-173887] 2015-07-29 20:44:03,854 StorageService.java:2952 - Repair session 846d9300-3608-11e5-a93e-4963524a8bde &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; range (-6705935
742755245856,-6704072966568763453] finished
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment>&lt;p&gt;C* 2.1.8, Debian Wheezy&lt;/p&gt;</environment>
        <key id="12850184">CASSANDRA-9935</key>
            <summary>Repair fails with RuntimeException</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10002" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Normal</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="pauloricardomg">Paulo Motta</assignee>
                                    <reporter username="mlowicki">mlowicki</reporter>
                        <labels>
                            <label>lcs</label>
                    </labels>
                <created>Thu, 30 Jul 2015 07:43:44 +0000</created>
                <updated>Tue, 16 Apr 2019 09:31:02 +0000</updated>
                            <resolved>Tue, 26 Apr 2016 08:51:17 +0000</resolved>
                                        <fixVersion>2.1.15</fixVersion>
                    <fixVersion>2.2.7</fixVersion>
                    <fixVersion>3.0.6</fixVersion>
                    <fixVersion>3.6</fixVersion>
                                        <due></due>
                            <votes>2</votes>
                                    <watches>19</watches>
                                                                                                                <comments>
                            <comment id="14647877" author="yukim" created="Thu, 30 Jul 2015 16:13:28 +0000"  >&lt;p&gt;Do you see ERROR in /10.195.15.162?&lt;/p&gt;</comment>
                            <comment id="14647925" author="mlowicki" created="Thu, 30 Jul 2015 16:50:22 +0000"  >&lt;p&gt;&amp;gt; ping db1.sync.lati.osa&lt;br/&gt;
PING a10-05-07.lati.osa (10.195.15.162): 56 data bytes&lt;/p&gt;

&lt;p&gt;So you&apos;ve log attached to this ticket.&lt;/p&gt;</comment>
                            <comment id="14647948" author="yukim" created="Thu, 30 Jul 2015 17:02:25 +0000"  >&lt;p&gt;Ok, I looked at the attached log, but I think the log missed ERROR that I&apos;m looking for.&lt;br/&gt;
Can you still get the log from the time before attached log?&lt;br/&gt;
You have validation error in /10.195.15.176 also so looking at that node too may be helpful.&lt;/p&gt;</comment>
                            <comment id="14647968" author="mlowicki" created="Thu, 30 Jul 2015 17:14:08 +0000"  >&lt;p&gt;Attached log from 10.195.15.176 (db5.sync.lati.osa).&lt;/p&gt;

&lt;p&gt;Older ones available on &lt;a href=&quot;https://drive.google.com/file/d/0B_8mc_afWmd2Vnk4ZE5kS3J6OE0/view?usp=sharing&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://drive.google.com/file/d/0B_8mc_afWmd2Vnk4ZE5kS3J6OE0/view?usp=sharing&lt;/a&gt; and  &lt;a href=&quot;https://drive.google.com/file/d/0B_8mc_afWmd2UElxUEZQUmtsaFk/view?usp=sharing&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://drive.google.com/file/d/0B_8mc_afWmd2UElxUEZQUmtsaFk/view?usp=sharing&lt;/a&gt; (They are bigger than 10MB).&lt;/p&gt;</comment>
                            <comment id="14647981" author="mlowicki" created="Thu, 30 Jul 2015 17:20:21 +0000"  >&lt;p&gt;More logs from db1.sync.lati.osa (10.195.15.162) available on &lt;a href=&quot;https://drive.google.com/file/d/0B_8mc_afWmd2QVk2VVRTRVl1ZDQ/view?usp=sharing&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://drive.google.com/file/d/0B_8mc_afWmd2QVk2VVRTRVl1ZDQ/view?usp=sharing&lt;/a&gt; and &lt;a href=&quot;https://drive.google.com/file/d/0B_8mc_afWmd2MHREM2hzUlNjd0E/view?usp=sharing&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://drive.google.com/file/d/0B_8mc_afWmd2MHREM2hzUlNjd0E/view?usp=sharing&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="14648082" author="yukim" created="Thu, 30 Jul 2015 18:28:22 +0000"  >&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;/10.195.15.162

ERROR [ValidationExecutor:210] 2015-07-29 15:43:11,407 Validator.java:245 - Failed creating a merkle tree &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; [repair #1b07ea50-3608-11e5-a93e-4963524a8bde on sync/entity_by_id2, (5765414319217852786,5781018794516851576]], /10.195.15.162 (see log &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; details)
ERROR [ValidationExecutor:210] 2015-07-29 15:43:11,407 CassandraDaemon.java:223 - Exception in thread &lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;[ValidationExecutor:210,1,main]
java.lang.AssertionError: row DecoratedKey(5765594635590376341, 00093238343336363131320000040000c3c700) received out of order wrt DecoratedKey(5780928708170690997, 00093233353634313435340000040000c3c700)
	at org.apache.cassandra.repair.Validator.add(Validator.java:127) ~[apache-cassandra-2.1.8.jar:2.1.8]
	at org.apache.cassandra.db.compaction.CompactionManager.doValidationCompaction(CompactionManager.java:1011) ~[apache-cassandra-2.1.8.jar:2.1.8]
	at org.apache.cassandra.db.compaction.CompactionManager.access$600(CompactionManager.java:94) ~[apache-cassandra-2.1.8.jar:2.1.8]
	at org.apache.cassandra.db.compaction.CompactionManager$9.call(CompactionManager.java:623) ~[apache-cassandra-2.1.8.jar:2.1.8]
	at java.util.concurrent.FutureTask.run(FutureTask.java:262) ~[na:1.7.0_80]
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1145) ~[na:1.7.0_80]
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:615) [na:1.7.0_80]
	at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:745) [na:1.7.0_80]

/10.195.15.176

ERROR [ValidationExecutor:422] 2015-07-29 12:56:05,095 Validator.java:245 - Failed creating a merkle tree &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; [repair #296789f0-35f1-11e5-a93e-4963524a8bde on sync/entity2, (6044856108640048843,6045004223660784737]], /10.195.15.162 (see log &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; details)
ERROR [ValidationExecutor:422] 2015-07-29 12:56:05,096 CassandraDaemon.java:223 - Exception in thread &lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;[ValidationExecutor:422,1,main]
java.lang.AssertionError: row DecoratedKey(6044863856301870146, 00093239323237333032320000040000ba8100) received out of order wrt DecoratedKey(6044997179498328855, 000932393231393536313200000400025b9a00)
	at org.apache.cassandra.repair.Validator.add(Validator.java:127) ~[apache-cassandra-2.1.8.jar:2.1.8]
	at org.apache.cassandra.db.compaction.CompactionManager.doValidationCompaction(CompactionManager.java:1011) ~[apache-cassandra-2.1.8.jar:2.1.8]
	at org.apache.cassandra.db.compaction.CompactionManager.access$600(CompactionManager.java:94) ~[apache-cassandra-2.1.8.jar:2.1.8]
	at org.apache.cassandra.db.compaction.CompactionManager$9.call(CompactionManager.java:623) ~[apache-cassandra-2.1.8.jar:2.1.8]
	at java.util.concurrent.FutureTask.run(FutureTask.java:262) ~[na:1.7.0_80]
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1145) ~[na:1.7.0_80]
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:615) [na:1.7.0_80]
	at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:745) [na:1.7.0_80]

&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;There is &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-9126&quot; title=&quot;java.lang.RuntimeException: Last written key DecoratedKey &amp;gt;= current key DecoratedKey&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-9126&quot;&gt;&lt;del&gt;CASSANDRA-9126&lt;/del&gt;&lt;/a&gt;, and if you are using leveled compaction strategy on those table, out of order might come from &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-8211&quot; title=&quot;Overlapping sstables in L1+&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-8211&quot;&gt;&lt;del&gt;CASSANDRA-8211&lt;/del&gt;&lt;/a&gt;.&lt;br/&gt;
Can you run scrub on those nodes?&lt;/p&gt;</comment>
                            <comment id="14648101" author="mlowicki" created="Thu, 30 Jul 2015 18:37:36 +0000"  >&lt;p&gt;Should I run &lt;tt&gt;nodetool scrub sync&lt;/tt&gt; on db1.sync.lati.osa and db5.sync.lati.osa or on all nodes inside this data center?&lt;/p&gt;</comment>
                            <comment id="14648122" author="yukim" created="Thu, 30 Jul 2015 18:48:06 +0000"  >&lt;p&gt;just on those two nodes is fine for now.&lt;/p&gt;</comment>
                            <comment id="14648760" author="mlowicki" created="Fri, 31 Jul 2015 05:09:40 +0000"  >&lt;p&gt;&lt;tt&gt;nodetool scrub sync&lt;/tt&gt; finished on db1.sync.lati.osa and db5.sync.lati.osa. Just launched repair but it can take up to 10-12 hours before it crashes. Will keep you updated.&lt;/p&gt;</comment>
                            <comment id="14649575" author="mlowicki" created="Fri, 31 Jul 2015 18:09:19 +0000"  >&lt;p&gt;Failed with the same error after ~13 hours:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;[2015-07-31 16:57:43,909] Repair command #5 finished
error: nodetool failed, check server logs
-- StackTrace --
java.lang.RuntimeException: nodetool failed, check server logs
        at org.apache.cassandra.tools.NodeTool$NodeToolCmd.run(NodeTool.java:290)
        at org.apache.cassandra.tools.NodeTool.main(NodeTool.java:202)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Log file - &lt;a href=&quot;https://drive.google.com/file/d/0B_8mc_afWmd2OV96RDZBclRNSFE/view?usp=sharing&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://drive.google.com/file/d/0B_8mc_afWmd2OV96RDZBclRNSFE/view?usp=sharing&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;Tried yesterday to run repair in another DC but got the same error.&lt;/p&gt;</comment>
                            <comment id="14652638" author="mlowicki" created="Mon, 3 Aug 2015 22:05:18 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=yukim&quot; class=&quot;user-hover&quot; rel=&quot;yukim&quot;&gt;yukim&lt;/a&gt; ping.&lt;/p&gt;</comment>
                            <comment id="14652648" author="yukim" created="Mon, 3 Aug 2015 22:17:33 +0000"  >&lt;p&gt;Your log indicates validation error in /10.195.15.163 and /10.195.15.167.&lt;br/&gt;
If errors in those nodes are the same as above, then you need to run scrub on those also.&lt;br/&gt;
Are you using leveled compaciton strategy?&lt;/p&gt;</comment>
                            <comment id="14652680" author="mlowicki" created="Mon, 3 Aug 2015 22:29:56 +0000"  >&lt;p&gt;Yes, I&apos;m using LCS. I&apos;ll run scrub on these nodes and then repair. Will let you know about the result.&lt;/p&gt;</comment>
                            <comment id="14654169" author="mlowicki" created="Tue, 4 Aug 2015 19:05:21 +0000"  >&lt;p&gt;Just finished running &lt;tt&gt;nodetool scrub&lt;/tt&gt; on all nodes in single DC (took ~12 hours) and started repair.&lt;/p&gt;</comment>
                            <comment id="14654970" author="mlowicki" created="Wed, 5 Aug 2015 07:53:26 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=yukim&quot; class=&quot;user-hover&quot; rel=&quot;yukim&quot;&gt;yukim&lt;/a&gt; the same error after ~12 hours:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;[2015-08-05 06:35:07,340] Repair session 18f8c020-3b3c-11e5-a93e-4963524a8bde &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; range (-781874602493000830,-781745173070807746] finished[2015-08-05 06:35:07,340] Repair command #6 finished
error: nodetool failed, check server logs-- StackTrace --
java.lang.RuntimeException: nodetool failed, check server logs        at org.apache.cassandra.tools.NodeTool$NodeToolCmd.run(NodeTool.java:290)
        at org.apache.cassandra.tools.NodeTool.main(NodeTool.java:202)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Logs from db1.sync.lati.osa (10.195.15.162) - &lt;a href=&quot;https://drive.google.com/file/d/0B_8mc_afWmd2LWcxRWRPWTFnMlk/view?usp=sharing&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://drive.google.com/file/d/0B_8mc_afWmd2LWcxRWRPWTFnMlk/view?usp=sharing&lt;/a&gt; &lt;br/&gt;
Logs from db4.sync.lati.osa (10.195.15.167) - &lt;a href=&quot;https://drive.google.com/file/d/0B_8mc_afWmd2ejVnR24tVm5OZUk/view?usp=sharing&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://drive.google.com/file/d/0B_8mc_afWmd2ejVnR24tVm5OZUk/view?usp=sharing&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14658865" author="yukim" created="Wed, 5 Aug 2015 20:35:55 +0000"  >&lt;p&gt;Thanks.&lt;br/&gt;
Hmm, do you still have logs when running nodetool scrub?&lt;br/&gt;
Did it detect out of order rows in any SSTable?&lt;/p&gt;</comment>
                            <comment id="14658878" author="mlowicki" created="Wed, 5 Aug 2015 20:40:47 +0000"  >&lt;p&gt;It didn&apos;t print anything to the console on all nodes. I can grep through system.log or attach logs from each box if this helps?&lt;/p&gt;</comment>
                            <comment id="14659666" author="mlowicki" created="Thu, 6 Aug 2015 08:12:25 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=yukim&quot; class=&quot;user-hover&quot; rel=&quot;yukim&quot;&gt;yukim&lt;/a&gt; I&apos;ve launched repair in 2nd DC to get more logs from repair - &lt;a href=&quot;https://gist.github.com/mlowicki/43e3074f46f12737577e&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gist.github.com/mlowicki/43e3074f46f12737577e&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;I&apos;ve found two exceptions:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;[2015-08-06 03:03:33,231] Repair session d4f0d420-3baa-11e5-9ec3-75bb514ae072 &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; range (-1449999620433819156,-1424504876804571443] failed with error org.apache.cassandra.exceptions.RepairException: [repair #d4f0d420-3baa-11e5-9ec3-75bb514ae072 on sync/entity2, (-1449999620433819156,-1424504876804571443]] Validation failed in /10.210.3.162
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;


&lt;p&gt;and&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;[2015-08-06 03:03:33,239] Repair session 967ca730-3bb1-11e5-9ec3-75bb514ae072 &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; range (3125697280560263437,3131751716701120659] failed with error org.apache.cassa    ndra.exceptions.RepairException: [repair #967ca730-3bb1-11e5-9ec3-75bb514ae072 on sync/entity_by_id2, (3125697280560263437,3131751716701120659]] Validation failed in /10.210.3.221
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;10.210.3.162 = db6.sync.ams.osa&lt;br/&gt;
10.210.3.221 = db1.sync.ams.osa&lt;/p&gt;

&lt;p&gt;Repair was started on db1.sync.ams.osa.&lt;/p&gt;

&lt;p&gt;I see no errors on db6.sync.ams.osa in system.log starting from 2015-08-06 00:24:16,322 to 2015-08-06 08:04:58,283 (no &quot;ERROR&quot; string there).&lt;/p&gt;

&lt;p&gt;On db1.sync.ams.osa I&apos;ve found two errors - &lt;a href=&quot;https://gist.github.com/mlowicki/3bf39f9f9ad0d4e202e5&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gist.github.com/mlowicki/3bf39f9f9ad0d4e202e5&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;I&apos;ve launched &lt;tt&gt;nodetool scrub&lt;/tt&gt; on db6.sync.ams.osa and will send logs when finish.&lt;/p&gt;</comment>
                            <comment id="14660075" author="mlowicki" created="Thu, 6 Aug 2015 14:21:05 +0000"  >&lt;p&gt;Logs from db6.sync.ams.osa where scrub was started - &lt;a href=&quot;https://drive.google.com/file/d/0B_8mc_afWmd2NjZXZGJRRnI4TzA/view?usp=sharing&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://drive.google.com/file/d/0B_8mc_afWmd2NjZXZGJRRnI4TzA/view?usp=sharing&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14681935" author="mlowicki" created="Tue, 11 Aug 2015 15:21:39 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=yukim&quot; class=&quot;user-hover&quot; rel=&quot;yukim&quot;&gt;yukim&lt;/a&gt; any updates?&lt;/p&gt;</comment>
                            <comment id="14731416" author="mlowicki" created="Fri, 4 Sep 2015 21:03:39 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=yukim&quot; class=&quot;user-hover&quot; rel=&quot;yukim&quot;&gt;yukim&lt;/a&gt; I&apos;ve launched repair for all keyspaces &lt;tt&gt;nodetool repair --in-local-dc --parallel&lt;/tt&gt;. #1 was for &quot;OpsCenter&quot;, #2 for sync which is mentioned above in this thread, #3 for system_traces. Part of the output in &lt;a href=&quot;https://cpaste.org/plvyleda5&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://cpaste.org/plvyleda5&lt;/a&gt;. Interesting it says:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;[2015-09-04 18:07:55,588] Repair command #2 finished
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Maybe the problem with assertion error is while outputting results as repair for sync keyspace always fails after similar time period?&lt;/p&gt;</comment>
                            <comment id="14731492" author="yukim" created="Fri, 4 Sep 2015 21:52:18 +0000"  >&lt;p&gt;So your repair finally succeeded?&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;Maybe the problem with assertion error is while outputting results as repair for sync keyspace always fails after similar time period?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;That assertion error happens when creating Merkle Tree from group of SSTables.&lt;br/&gt;
It can be from unordered SSTable that happened sometime before, or LCS bug that used to allow overlapping within the level (&lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-8211&quot; title=&quot;Overlapping sstables in L1+&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-8211&quot;&gt;&lt;del&gt;CASSANDRA-8211&lt;/del&gt;&lt;/a&gt;).&lt;br/&gt;
The former can be checked with &lt;tt&gt;scrub&lt;/tt&gt;, but the log you attached before did not show unordered SSTable.&lt;br/&gt;
The latter may be fixed by restarting the node.&lt;/p&gt;</comment>
                            <comment id="14731811" author="mlowicki" created="Sat, 5 Sep 2015 05:27:40 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=yukim&quot; class=&quot;user-hover&quot; rel=&quot;yukim&quot;&gt;yukim&lt;/a&gt; how can I detect that repair succeeded?&lt;/p&gt;

&lt;p&gt;We&apos;ve restarted all nodes couple of days ago so it didn&apos;t helped.&lt;/p&gt;</comment>
                            <comment id="15025314" author="mlowicki" created="Tue, 24 Nov 2015 20:36:31 +0000"  >&lt;p&gt;Launched repair and got the same exception after couple of days but grepped through logs and found:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;ERROR [&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;-7155] 2015-11-24 17:38:24,895 StorageService.java:2999 - Repair session 3c9f7d40-8e19-11e5-bda4-0d9c8928349f &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; range (-1741218705797202342,-1741060704162047213] failed with error java.io.IOException: Failed during snapshot creation.
java.util.concurrent.ExecutionException: java.lang.RuntimeException: java.io.IOException: Failed during snapshot creation.
        at java.util.concurrent.FutureTask.report(FutureTask.java:122) [na:1.7.0_80]
        at java.util.concurrent.FutureTask.get(FutureTask.java:188) [na:1.7.0_80]
        at org.apache.cassandra.service.StorageService$4.runMayThrow(StorageService.java:2990) ~[apache-cassandra-2.1.11.jar:2.1.11]
        at org.apache.cassandra.utils.WrappedRunnable.run(WrappedRunnable.java:28) [apache-cassandra-2.1.11.jar:2.1.11]
        at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:471) [na:1.7.0_80]
        at java.util.concurrent.FutureTask.run(FutureTask.java:262) [na:1.7.0_80]
        at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:745) [na:1.7.0_80]
Caused by: java.lang.RuntimeException: java.io.IOException: Failed during snapshot creation.
        at com.google.common.base.Throwables.propagate(Throwables.java:160) ~[guava-16.0.jar:na]
        at org.apache.cassandra.utils.WrappedRunnable.run(WrappedRunnable.java:32) [apache-cassandra-2.1.11.jar:2.1.11]
        at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:471) [na:1.7.0_80]
        at java.util.concurrent.FutureTask.run(FutureTask.java:262) [na:1.7.0_80]
        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1145) ~[na:1.7.0_80]
        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:615) ~[na:1.7.0_80]
        ... 1 common frames omitted
Caused by: java.io.IOException: Failed during snapshot creation.
        at org.apache.cassandra.repair.RepairSession.failedSnapshot(RepairSession.java:344) ~[apache-cassandra-2.1.11.jar:2.1.11]
        at org.apache.cassandra.repair.RepairJob$2.onFailure(RepairJob.java:146) ~[apache-cassandra-2.1.11.jar:2.1.11]
        at com.google.common.util.concurrent.Futures$4.run(Futures.java:1172) ~[guava-16.0.jar:na]
        ... 3 common frames omitted
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Additionally:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;ERROR [&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;-7155] 2015-11-24 17:38:24,907 StorageService.java:2999 - Repair session b55b4930-8e73-11e5-bda4-0d9c8928349f &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; range (5801873202797297113,5802832998541920530] failed with error org.apache.cassandra.exceptions.RepairException: [repair #b55b4930-8e73-11e5-bda4-0d9c8928349f on sync/entity2, (5801873202797297113,5802832998541920530]] Validation failed in /10.195.15.167
java.util.concurrent.ExecutionException: java.lang.RuntimeException: org.apache.cassandra.exceptions.RepairException: [repair #b55b4930-8e73-11e5-bda4-0d9c8928349f on sync/entity2, (5801873202797297113,5802832998541920530]] Validation failed in /10.195.15.167
        at java.util.concurrent.FutureTask.report(FutureTask.java:122) [na:1.7.0_80]
        at java.util.concurrent.FutureTask.get(FutureTask.java:188) [na:1.7.0_80]
        at org.apache.cassandra.service.StorageService$4.runMayThrow(StorageService.java:2990) ~[apache-cassandra-2.1.11.jar:2.1.11]
        at org.apache.cassandra.utils.WrappedRunnable.run(WrappedRunnable.java:28) [apache-cassandra-2.1.11.jar:2.1.11]
        at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:471) [na:1.7.0_80]
        at java.util.concurrent.FutureTask.run(FutureTask.java:262) [na:1.7.0_80]
        at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:745) [na:1.7.0_80]
Caused by: java.lang.RuntimeException: org.apache.cassandra.exceptions.RepairException: [repair #b55b4930-8e73-11e5-bda4-0d9c8928349f on sync/entity2, (5801873202797297113,5802832998541920530]] Validation failed in /10.195.15.167
        at com.google.common.base.Throwables.propagate(Throwables.java:160) ~[guava-16.0.jar:na]
        at org.apache.cassandra.utils.WrappedRunnable.run(WrappedRunnable.java:32) [apache-cassandra-2.1.11.jar:2.1.11]
        at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:471) [na:1.7.0_80]
        at java.util.concurrent.FutureTask.run(FutureTask.java:262) [na:1.7.0_80]
        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1145) ~[na:1.7.0_80]
        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:615) ~[na:1.7.0_80]
        ... 1 common frames omitted
Caused by: org.apache.cassandra.exceptions.RepairException: [repair #b55b4930-8e73-11e5-bda4-0d9c8928349f on sync/entity2, (5801873202797297113,5802832998541920530]] Validation failed in /10.195.15.167
        at org.apache.cassandra.repair.RepairSession.validationComplete(RepairSession.java:166) ~[apache-cassandra-2.1.11.jar:2.1.11]
        at org.apache.cassandra.service.ActiveRepairService.handleMessage(ActiveRepairService.java:406) ~[apache-cassandra-2.1.11.jar:2.1.11]
        at org.apache.cassandra.repair.RepairMessageVerbHandler.doVerb(RepairMessageVerbHandler.java:134) ~[apache-cassandra-2.1.11.jar:2.1.11]
        at org.apache.cassandra.net.MessageDeliveryTask.run(MessageDeliveryTask.java:64) ~[apache-cassandra-2.1.11.jar:2.1.11]
        ... 3 common frames omitted
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;10.195.15.167 is the one where I&apos;ve started repair...&lt;/p&gt;</comment>
                            <comment id="15025417" author="yukim" created="Tue, 24 Nov 2015 21:13:55 +0000"  >&lt;p&gt;Those two have different repair session ID.&lt;br/&gt;
Can you grep logs on other replica with those ID and see if there are ERROR log?&lt;/p&gt;</comment>
                            <comment id="15025432" author="mlowicki" created="Tue, 24 Nov 2015 21:19:08 +0000"  >&lt;p&gt;Didn&apos;t found these session IDs on other nodes:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;&lt;a href=&quot;https://www.dropbox.com/s/qtx5rzmqzl9zj47/Screenshot%202015-11-24%2022.22.03.png?dl=0&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://www.dropbox.com/s/qtx5rzmqzl9zj47/Screenshot%202015-11-24%2022.22.03.png?dl=0&lt;/a&gt;&lt;/li&gt;
	&lt;li&gt;&lt;a href=&quot;https://www.dropbox.com/s/o7k0cfhscd1au50/Screenshot%202015-11-24%2022.22.19.png?dl=0&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://www.dropbox.com/s/o7k0cfhscd1au50/Screenshot%202015-11-24%2022.22.19.png?dl=0&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="15025455" author="yukim" created="Tue, 24 Nov 2015 21:30:37 +0000"  >&lt;p&gt;Is there a chance that older contains those?&lt;/p&gt;</comment>
                            <comment id="15025516" author="mlowicki" created="Tue, 24 Nov 2015 21:58:17 +0000"  >&lt;p&gt;Nothing found. Checked system.log.1.zip from /var/log/cassandra on each box but only on db8.lati (where repair started) found those session IDs.&lt;/p&gt;</comment>
                            <comment id="15030436" author="mlowicki" created="Sat, 28 Nov 2015 08:59:37 +0000"  >&lt;p&gt;Tried to run repair once again after online scrub and cleanup on all nodes. Failed with the same error. This is what I&apos;ve found in logs:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;ERROR [ValidationExecutor:1089] 2015-11-28 04:33:15,865 Validator.java:245 - Failed creating a merkle tree &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; [repair #0f9c5530-9589-11e5-b036-75bb514ae072 on sync/entity2, (-6842825601551036942,-6841068234348096268]], /10.210.3.221 (see log &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; details)
ERROR [ValidationExecutor:1089] 2015-11-28 04:33:15,866 CassandraDaemon.java:227 - Exception in thread &lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;[ValidationExecutor:1089,1,main]
java.lang.AssertionError: row DecoratedKey(-6842806631972123001, 00093238333134323933320000040000c3c700) received out of order wrt DecoratedKey(-6841074726771668561, 00093231363735323034340000040000c3c700)
        at org.apache.cassandra.repair.Validator.add(Validator.java:127) ~[apache-cassandra-2.1.11.jar:2.1.11]
        at org.apache.cassandra.db.compaction.CompactionManager.doValidationCompaction(CompactionManager.java:1010) ~[apache-cassandra-2.1.11.jar:2.1.11]
        at org.apache.cassandra.db.compaction.CompactionManager.access$600(CompactionManager.java:94) ~[apache-cassandra-2.1.11.jar:2.1.11]
        at org.apache.cassandra.db.compaction.CompactionManager$9.call(CompactionManager.java:622) ~[apache-cassandra-2.1.11.jar:2.1.11]
        at java.util.concurrent.FutureTask.run(FutureTask.java:262) ~[na:1.7.0_80]
        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1145) ~[na:1.7.0_80]
        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:615) [na:1.7.0_80]
        at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:745) [na:1.7.0_80]
ERROR [AntiEntropySessions:1957] 2015-11-28 04:33:15,868 RepairSession.java:303 - [repair #0f9c5530-9589-11e5-b036-75bb514ae072] session completed with the following error
org.apache.cassandra.exceptions.RepairException: [repair #0f9c5530-9589-11e5-b036-75bb514ae072 on sync/entity2, (-6842825601551036942,-6841068234348096268]] Validation failed in /10.210.3.221
        at org.apache.cassandra.repair.RepairSession.validationComplete(RepairSession.java:166) ~[apache-cassandra-2.1.11.jar:2.1.11]
        at org.apache.cassandra.service.ActiveRepairService.handleMessage(ActiveRepairService.java:406) ~[apache-cassandra-2.1.11.jar:2.1.11]
        at org.apache.cassandra.repair.RepairMessageVerbHandler.doVerb(RepairMessageVerbHandler.java:134) ~[apache-cassandra-2.1.11.jar:2.1.11]
        at org.apache.cassandra.net.MessageDeliveryTask.run(MessageDeliveryTask.java:64) ~[apache-cassandra-2.1.11.jar:2.1.11]
        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1145) [na:1.7.0_80]
        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:615) [na:1.7.0_80]
        at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:745) [na:1.7.0_80]
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;ERROR [AntiEntropySessions:1957] 2015-11-28 04:33:15,869 CassandraDaemon.java:227 - Exception in thread &lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;[AntiEntropySessions:1957,5,RMI &lt;span class=&quot;code-object&quot;&gt;Runtime&lt;/span&gt;]
java.lang.RuntimeException: org.apache.cassandra.exceptions.RepairException: [repair #0f9c5530-9589-11e5-b036-75bb514ae072 on sync/entity2, (-6842825601551036942,-6841068234348096268]] Validation failed in /10.210.3.221
        at com.google.common.base.Throwables.propagate(Throwables.java:160) ~[guava-16.0.jar:na]
        at org.apache.cassandra.utils.WrappedRunnable.run(WrappedRunnable.java:32) ~[apache-cassandra-2.1.11.jar:2.1.11]
        at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:471) ~[na:1.7.0_80]
        at java.util.concurrent.FutureTask.run(FutureTask.java:262) ~[na:1.7.0_80]
        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1145) ~[na:1.7.0_80]
        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:615) [na:1.7.0_80]
        at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:745) [na:1.7.0_80]
Caused by: org.apache.cassandra.exceptions.RepairException: [repair #0f9c5530-9589-11e5-b036-75bb514ae072 on sync/entity2, (-6842825601551036942,-6841068234348096268]] Validation failed in /10.210.3.221
        at org.apache.cassandra.repair.RepairSession.validationComplete(RepairSession.java:166) ~[apache-cassandra-2.1.11.jar:2.1.11]
        at org.apache.cassandra.service.ActiveRepairService.handleMessage(ActiveRepairService.java:406) ~[apache-cassandra-2.1.11.jar:2.1.11]
        at org.apache.cassandra.repair.RepairMessageVerbHandler.doVerb(RepairMessageVerbHandler.java:134) ~[apache-cassandra-2.1.11.jar:2.1.11]
        at org.apache.cassandra.net.MessageDeliveryTask.run(MessageDeliveryTask.java:64) ~[apache-cassandra-2.1.11.jar:2.1.11]
        ... 3 common frames omitted
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;ERROR [&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;-6628] 2015-11-28 08:17:03,350 StorageService.java:2999 - Repair session 93837260-92fb-11e5-b036-75bb514ae072 &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; range (-6012485790753833422,-6009995015166063234] failed with error org.apache.cassandra.exceptions.RepairException: [repair #93837260-92fb-11e5-b036-75bb514ae072 on sync/entity2, (-6012485790753833422,-6009995015166063234]] Validation failed in /10.210.3.118
java.util.concurrent.ExecutionException: java.lang.RuntimeException: org.apache.cassandra.exceptions.RepairException: [repair #93837260-92fb-11e5-b036-75bb514ae072 on sync/entity2, (-6012485790753833422,-6009995015166063234]] Validation failed in /10.210.3.118
        at java.util.concurrent.FutureTask.report(FutureTask.java:122) [na:1.7.0_80]
        at java.util.concurrent.FutureTask.get(FutureTask.java:188) [na:1.7.0_80]
        at org.apache.cassandra.service.StorageService$4.runMayThrow(StorageService.java:2990) ~[apache-cassandra-2.1.11.jar:2.1.11]
        at org.apache.cassandra.utils.WrappedRunnable.run(WrappedRunnable.java:28) [apache-cassandra-2.1.11.jar:2.1.11]
        at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:471) [na:1.7.0_80]
        at java.util.concurrent.FutureTask.run(FutureTask.java:262) [na:1.7.0_80]
        at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:745) [na:1.7.0_80]
Caused by: java.lang.RuntimeException: org.apache.cassandra.exceptions.RepairException: [repair #93837260-92fb-11e5-b036-75bb514ae072 on sync/entity2, (-6012485790753833422,-6009995015166063234]] Validation failed in /10.210.3.118
        at com.google.common.base.Throwables.propagate(Throwables.java:160) ~[guava-16.0.jar:na]
        at org.apache.cassandra.utils.WrappedRunnable.run(WrappedRunnable.java:32) [apache-cassandra-2.1.11.jar:2.1.11]
        at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:471) [na:1.7.0_80]
        at java.util.concurrent.FutureTask.run(FutureTask.java:262) [na:1.7.0_80]
        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1145) ~[na:1.7.0_80]
        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:615) ~[na:1.7.0_80]
        ... 1 common frames omitted
Caused by: org.apache.cassandra.exceptions.RepairException: [repair #93837260-92fb-11e5-b036-75bb514ae072 on sync/entity2, (-6012485790753833422,-6009995015166063234]] Validation failed in /10.210.3.118
        at org.apache.cassandra.repair.RepairSession.validationComplete(RepairSession.java:166) ~[apache-cassandra-2.1.11.jar:2.1.11]
        at org.apache.cassandra.service.ActiveRepairService.handleMessage(ActiveRepairService.java:406) ~[apache-cassandra-2.1.11.jar:2.1.11]
        at org.apache.cassandra.repair.RepairMessageVerbHandler.doVerb(RepairMessageVerbHandler.java:134) ~[apache-cassandra-2.1.11.jar:2.1.11]
        at org.apache.cassandra.net.MessageDeliveryTask.run(MessageDeliveryTask.java:64) ~[apache-cassandra-2.1.11.jar:2.1.11]
        ... 3 common frames omitted
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;ERROR [&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;-6628] 2015-11-28 08:17:03,404 StorageService.java:2999 - Repair session 89fa2b70-933d-11e5-b036-75bb514ae072 &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; range (-5867793819051725444,-5865919628027816979] failed with error org.apache.cassandra.exceptions.RepairException: [repair #89fa2b70-933d-11e5-b036-75bb514ae072 on sync/entity_by_id2, (-5867793819051725444,-5865919628027816979]] Validation failed in /10.210.3.117
java.util.concurrent.ExecutionException: java.lang.RuntimeException: org.apache.cassandra.exceptions.RepairException: [repair #89fa2b70-933d-11e5-b036-75bb514ae072 on sync/entity_by_id2, (-5867793819051725444,-5865919628027816979]] Validation failed in /10.210.3.117
        at java.util.concurrent.FutureTask.report(FutureTask.java:122) [na:1.7.0_80]
        at java.util.concurrent.FutureTask.get(FutureTask.java:188) [na:1.7.0_80]
        at org.apache.cassandra.service.StorageService$4.runMayThrow(StorageService.java:2990) ~[apache-cassandra-2.1.11.jar:2.1.11]
        at org.apache.cassandra.utils.WrappedRunnable.run(WrappedRunnable.java:28) [apache-cassandra-2.1.11.jar:2.1.11]
        at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:471) [na:1.7.0_80]
        at java.util.concurrent.FutureTask.run(FutureTask.java:262) [na:1.7.0_80]
        at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:745) [na:1.7.0_80]
Caused by: java.lang.RuntimeException: org.apache.cassandra.exceptions.RepairException: [repair #89fa2b70-933d-11e5-b036-75bb514ae072 on sync/entity_by_id2, (-5867793819051725444,-5865919628027816979]] Validation failed in /10.210.3.117
        at com.google.common.base.Throwables.propagate(Throwables.java:160) ~[guava-16.0.jar:na]
        at org.apache.cassandra.utils.WrappedRunnable.run(WrappedRunnable.java:32) [apache-cassandra-2.1.11.jar:2.1.11]
        at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:471) [na:1.7.0_80]
        at java.util.concurrent.FutureTask.run(FutureTask.java:262) [na:1.7.0_80]
        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1145) ~[na:1.7.0_80]
        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:615) ~[na:1.7.0_80]
        ... 1 common frames omitted
Caused by: org.apache.cassandra.exceptions.RepairException: [repair #89fa2b70-933d-11e5-b036-75bb514ae072 on sync/entity_by_id2, (-5867793819051725444,-5865919628027816979]] Validation failed in /10.210.3.117
        at org.apache.cassandra.repair.RepairSession.validationComplete(RepairSession.java:166) ~[apache-cassandra-2.1.11.jar:2.1.11]
        at org.apache.cassandra.service.ActiveRepairService.handleMessage(ActiveRepairService.java:406) ~[apache-cassandra-2.1.11.jar:2.1.11]
        at org.apache.cassandra.repair.RepairMessageVerbHandler.doVerb(RepairMessageVerbHandler.java:134) ~[apache-cassandra-2.1.11.jar:2.1.11]
        at org.apache.cassandra.net.MessageDeliveryTask.run(MessageDeliveryTask.java:64) ~[apache-cassandra-2.1.11.jar:2.1.11]
        ... 3 common frames omitted
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;ERROR [&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;-6628] 2015-11-28 08:17:03,446 StorageService.java:2999 - Repair session 3ff36a20-9372-11e5-b036-75bb514ae072 &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; range (8066543735336862962,8074446636728465478] failed with error java.io.IOException: Endpoint /10.210.3.230 died
java.util.concurrent.ExecutionException: java.lang.RuntimeException: java.io.IOException: Endpoint /10.210.3.230 died
        at java.util.concurrent.FutureTask.report(FutureTask.java:122) [na:1.7.0_80]
        at java.util.concurrent.FutureTask.get(FutureTask.java:188) [na:1.7.0_80]
        at org.apache.cassandra.service.StorageService$4.runMayThrow(StorageService.java:2990) ~[apache-cassandra-2.1.11.jar:2.1.11]
        at org.apache.cassandra.utils.WrappedRunnable.run(WrappedRunnable.java:28) [apache-cassandra-2.1.11.jar:2.1.11]
        at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:471) [na:1.7.0_80]
        at java.util.concurrent.FutureTask.run(FutureTask.java:262) [na:1.7.0_80]
        at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:745) [na:1.7.0_80]
Caused by: java.lang.RuntimeException: java.io.IOException: Endpoint /10.210.3.230 died
        at com.google.common.base.Throwables.propagate(Throwables.java:160) ~[guava-16.0.jar:na]
        at org.apache.cassandra.utils.WrappedRunnable.run(WrappedRunnable.java:32) [apache-cassandra-2.1.11.jar:2.1.11]
        at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:471) [na:1.7.0_80]
        at java.util.concurrent.FutureTask.run(FutureTask.java:262) [na:1.7.0_80]
        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1145) ~[na:1.7.0_80]
        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:615) ~[na:1.7.0_80]
        ... 1 common frames omitted
Caused by: java.io.IOException: Endpoint /10.210.3.230 died
        at org.apache.cassandra.repair.RepairSession.failedNode(RepairSession.java:351) ~[apache-cassandra-2.1.11.jar:2.1.11]
        at org.apache.cassandra.repair.RepairSession.convict(RepairSession.java:386) ~[apache-cassandra-2.1.11.jar:2.1.11]
        at org.apache.cassandra.gms.FailureDetector.interpret(FailureDetector.java:276) ~[apache-cassandra-2.1.11.jar:2.1.11]
        at org.apache.cassandra.gms.Gossiper.doStatusCheck(Gossiper.java:758) ~[apache-cassandra-2.1.11.jar:2.1.11]
        at org.apache.cassandra.gms.Gossiper.access$800(Gossiper.java:66) ~[apache-cassandra-2.1.11.jar:2.1.11]
        at org.apache.cassandra.gms.Gossiper$GossipTask.run(Gossiper.java:180) ~[apache-cassandra-2.1.11.jar:2.1.11]
        at org.apache.cassandra.concurrent.DebuggableScheduledThreadPoolExecutor$UncomplainingRunnable.run(DebuggableScheduledThreadPoolExecutor.java:118) ~[apache-cassandra-2.1.11.jar:2.1.11]
        at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:471) [na:1.7.0_80]
        at java.util.concurrent.FutureTask.runAndReset(FutureTask.java:304) [na:1.7.0_80]
        at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.access$301(ScheduledThreadPoolExecutor.java:178) ~[na:1.7.0_80]
        at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:293) ~[na:1.7.0_80]
        ... 3 common frames omitted
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;ERROR [&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;-6628] 2015-11-28 08:17:03,555 StorageService.java:2999 - Repair session 72d57040-943b-11e5-b036-75bb514ae072 &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; range (-2928915626059257529,-2921716383005026147] failed with error org.apache.cassandra.exceptions.RepairException: [repair #72d57040-943b-11e5-b036-75bb514ae072 on sync/entity2, (-2928915626059257529,-2921716383005026147]] Validation failed in /10.210.3.221
java.util.concurrent.ExecutionException: java.lang.RuntimeException: org.apache.cassandra.exceptions.RepairException: [repair #72d57040-943b-11e5-b036-75bb514ae072 on sync/entity2, (-2928915626059257529,-2921716383005026147]] Validation failed in /10.210.3.221
        at java.util.concurrent.FutureTask.report(FutureTask.java:122) [na:1.7.0_80]
        at java.util.concurrent.FutureTask.get(FutureTask.java:188) [na:1.7.0_80]
        at org.apache.cassandra.service.StorageService$4.runMayThrow(StorageService.java:2990) ~[apache-cassandra-2.1.11.jar:2.1.11]
        at org.apache.cassandra.utils.WrappedRunnable.run(WrappedRunnable.java:28) [apache-cassandra-2.1.11.jar:2.1.11]
        at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:471) [na:1.7.0_80]
        at java.util.concurrent.FutureTask.run(FutureTask.java:262) [na:1.7.0_80]
        at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:745) [na:1.7.0_80]
Caused by: java.lang.RuntimeException: org.apache.cassandra.exceptions.RepairException: [repair #72d57040-943b-11e5-b036-75bb514ae072 on sync/entity2, (-2928915626059257529,-2921716383005026147]] Validation failed in /10.210.3.221
        at com.google.common.base.Throwables.propagate(Throwables.java:160) ~[guava-16.0.jar:na]
        at org.apache.cassandra.utils.WrappedRunnable.run(WrappedRunnable.java:32) [apache-cassandra-2.1.11.jar:2.1.11]
        at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:471) [na:1.7.0_80]
        at java.util.concurrent.FutureTask.run(FutureTask.java:262) [na:1.7.0_80]
        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1145) ~[na:1.7.0_80]
        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:615) ~[na:1.7.0_80]
        ... 1 common frames omitted
Caused by: org.apache.cassandra.exceptions.RepairException: [repair #72d57040-943b-11e5-b036-75bb514ae072 on sync/entity2, (-2928915626059257529,-2921716383005026147]] Validation failed in /10.210.3.221
        at org.apache.cassandra.repair.RepairSession.validationComplete(RepairSession.java:166) ~[apache-cassandra-2.1.11.jar:2.1.11]
        at org.apache.cassandra.service.ActiveRepairService.handleMessage(ActiveRepairService.java:406) ~[apache-cassandra-2.1.11.jar:2.1.11]
        at org.apache.cassandra.repair.RepairMessageVerbHandler.doVerb(RepairMessageVerbHandler.java:134) ~[apache-cassandra-2.1.11.jar:2.1.11]
        at org.apache.cassandra.net.MessageDeliveryTask.run(MessageDeliveryTask.java:64) ~[apache-cassandra-2.1.11.jar:2.1.11]
        ... 3 common frames omitted
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;ERROR [&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;-6628] 2015-11-28 08:17:03,687 StorageService.java:2999 - Repair session e9f771a0-94fe-11e5-b036-75bb514ae072 &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; range (-2890799998431679809,-2889623741271856504] failed with error org.apache.cassandra.exceptions.RepairException: [repair #e9f771a0-94fe-11e5-b036-75bb514ae072 on sync/entity2, (-2890799998431679809,-2889623741271856504]] Validation failed in /10.210.3.221
java.util.concurrent.ExecutionException: java.lang.RuntimeException: org.apache.cassandra.exceptions.RepairException: [repair #e9f771a0-94fe-11e5-b036-75bb514ae072 on sync/entity2, (-2890799998431679809,-2889623741271856504]] Validation failed in /10.210.3.221
        at java.util.concurrent.FutureTask.report(FutureTask.java:122) [na:1.7.0_80]
        at java.util.concurrent.FutureTask.get(FutureTask.java:188) [na:1.7.0_80]
        at org.apache.cassandra.service.StorageService$4.runMayThrow(StorageService.java:2990) ~[apache-cassandra-2.1.11.jar:2.1.11]
        at org.apache.cassandra.utils.WrappedRunnable.run(WrappedRunnable.java:28) [apache-cassandra-2.1.11.jar:2.1.11]
        at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:471) [na:1.7.0_80]
        at java.util.concurrent.FutureTask.run(FutureTask.java:262) [na:1.7.0_80]
        at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:745) [na:1.7.0_80]
Caused by: java.lang.RuntimeException: org.apache.cassandra.exceptions.RepairException: [repair #e9f771a0-94fe-11e5-b036-75bb514ae072 on sync/entity2, (-2890799998431679809,-2889623741271856504]] Validation failed in /10.210.3.221
        at com.google.common.base.Throwables.propagate(Throwables.java:160) ~[guava-16.0.jar:na]
        at org.apache.cassandra.utils.WrappedRunnable.run(WrappedRunnable.java:32) [apache-cassandra-2.1.11.jar:2.1.11]
        at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:471) [na:1.7.0_80]
        at java.util.concurrent.FutureTask.run(FutureTask.java:262) [na:1.7.0_80]
        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1145) ~[na:1.7.0_80]
        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:615) ~[na:1.7.0_80]
        ... 1 common frames omitted
Caused by: org.apache.cassandra.exceptions.RepairException: [repair #e9f771a0-94fe-11e5-b036-75bb514ae072 on sync/entity2, (-2890799998431679809,-2889623741271856504]] Validation failed in /10.210.3.221
        at org.apache.cassandra.repair.RepairSession.validationComplete(RepairSession.java:166) ~[apache-cassandra-2.1.11.jar:2.1.11]
        at org.apache.cassandra.service.ActiveRepairService.handleMessage(ActiveRepairService.java:406) ~[apache-cassandra-2.1.11.jar:2.1.11]
        at org.apache.cassandra.repair.RepairMessageVerbHandler.doVerb(RepairMessageVerbHandler.java:134) ~[apache-cassandra-2.1.11.jar:2.1.11]
        at org.apache.cassandra.net.MessageDeliveryTask.run(MessageDeliveryTask.java:64) ~[apache-cassandra-2.1.11.jar:2.1.11]
        ... 3 common frames omitted
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;ERROR [&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;-6628] 2015-11-28 08:17:03,766 StorageService.java:2999 - Repair session 0f9c5530-9589-11e5-b036-75bb514ae072 &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; range (-6842825601551036942,-6841068234348096268] failed with error org.apache.cassandra.exceptions.RepairException: [repair #0f9c5530-9589-11e5-b036-75bb514ae072 on sync/entity2, (-6842825601551036942,-6841068234348096268]] Validation failed in /10.210.3.221
java.util.concurrent.ExecutionException: java.lang.RuntimeException: org.apache.cassandra.exceptions.RepairException: [repair #0f9c5530-9589-11e5-b036-75bb514ae072 on sync/entity2, (-6842825601551036942,-6841068234348096268]] Validation failed in /10.210.3.221
        at java.util.concurrent.FutureTask.report(FutureTask.java:122) [na:1.7.0_80]
        at java.util.concurrent.FutureTask.get(FutureTask.java:188) [na:1.7.0_80]
        at org.apache.cassandra.service.StorageService$4.runMayThrow(StorageService.java:2990) ~[apache-cassandra-2.1.11.jar:2.1.11]
        at org.apache.cassandra.utils.WrappedRunnable.run(WrappedRunnable.java:28) [apache-cassandra-2.1.11.jar:2.1.11]
        at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:471) [na:1.7.0_80]
        at java.util.concurrent.FutureTask.run(FutureTask.java:262) [na:1.7.0_80]
        at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:745) [na:1.7.0_80]
Caused by: java.lang.RuntimeException: org.apache.cassandra.exceptions.RepairException: [repair #0f9c5530-9589-11e5-b036-75bb514ae072 on sync/entity2, (-6842825601551036942,-6841068234348096268]] Validation failed in /10.210.3.221
        at com.google.common.base.Throwables.propagate(Throwables.java:160) ~[guava-16.0.jar:na]
        at org.apache.cassandra.utils.WrappedRunnable.run(WrappedRunnable.java:32) [apache-cassandra-2.1.11.jar:2.1.11]
        at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:471) [na:1.7.0_80]
        at java.util.concurrent.FutureTask.run(FutureTask.java:262) [na:1.7.0_80]
        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1145) ~[na:1.7.0_80]
        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:615) ~[na:1.7.0_80]
        ... 1 common frames omitted
Caused by: org.apache.cassandra.exceptions.RepairException: [repair #0f9c5530-9589-11e5-b036-75bb514ae072 on sync/entity2, (-6842825601551036942,-6841068234348096268]] Validation failed in /10.210.3.221
        at org.apache.cassandra.repair.RepairSession.validationComplete(RepairSession.java:166) ~[apache-cassandra-2.1.11.jar:2.1.11]
        at org.apache.cassandra.service.ActiveRepairService.handleMessage(ActiveRepairService.java:406) ~[apache-cassandra-2.1.11.jar:2.1.11]
        at org.apache.cassandra.repair.RepairMessageVerbHandler.doVerb(RepairMessageVerbHandler.java:134) ~[apache-cassandra-2.1.11.jar:2.1.11]
        at org.apache.cassandra.net.MessageDeliveryTask.run(MessageDeliveryTask.java:64) ~[apache-cassandra-2.1.11.jar:2.1.11]
        ... 3 common frames omitted
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Repair failed between 08:00 and 08:40.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;ERROR [&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;-6628] 2015-11-28 08:17:03,446 StorageService.java:2999 - Repair session 3ff36a20-9372-11e5-b036-75bb514ae072 &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; range (8066543735336862962,8074446636728465478] failed with error java.io.IOException: Endpoint /10.210.3.230 died
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Is interesting but I haven&apos;t found more about it in logs (Attached logs from box where I&apos;ve started repair - 10.210.3.221 and 10.210.3.230).&lt;/p&gt;

&lt;p&gt;If started repair for one of failed ranges then it works fine:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;root@db1:~# time nodetool repair --in-local-dc -st -2890799998431679809 -et -2889623741271856504 sync entity2
[2015-11-28 08:36:41,736] Starting repair command #5, repairing 1 ranges &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; keyspace sync (parallelism=SEQUENTIAL, full=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;)
[2015-11-28 08:37:48,286] Repair session 26483200-95ab-11e5-b036-75bb514ae072 &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; range (-2890799998431679809,-2889623741271856504] finished
[2015-11-28 08:37:48,286] Repair command #5 finished

real    1m8.393s
user    0m2.620s
sys     0m0.184s
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="15030439" author="mlowicki" created="Sat, 28 Nov 2015 09:05:56 +0000"  >&lt;p&gt;Also If I run repair for range where got this &quot;Endpoint X died&quot; it works fine:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;root@db1:~# time nodetool repair --in-local-dc -st 8066543735336862962 -et 8074446636728465478
[2015-11-28 08:55:19,048] Nothing to repair &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; keyspace &lt;span class=&quot;code-quote&quot;&gt;&apos;system&apos;&lt;/span&gt;
[2015-11-28 08:55:19,069] Starting repair command #6, repairing 1 ranges &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; keyspace OpsCenter (parallelism=SEQUENTIAL, full=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;)
[2015-11-28 08:55:19,176] Repair command #6 finished
[2015-11-28 08:55:19,188] Starting repair command #7, repairing 1 ranges &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; keyspace sync (parallelism=SEQUENTIAL, full=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;)
[2015-11-28 09:03:49,529] Repair session c054ec60-95ad-11e5-b036-75bb514ae072 &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; range (8066543735336862962,8074446636728465478] finished
[2015-11-28 09:03:49,529] Repair command #7 finished
[2015-11-28 09:03:49,544] Starting repair command #8, repairing 1 ranges &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; keyspace system_traces (parallelism=SEQUENTIAL, full=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;)
[2015-11-28 09:03:49,562] Repair command #8 finished

real    8m32.356s
user    0m2.784s
sys     0m0.224s
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="15031827" author="mlowicki" created="Mon, 30 Nov 2015 14:25:54 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=yukim&quot; class=&quot;user-hover&quot; rel=&quot;yukim&quot;&gt;yukim&lt;/a&gt;: any chance this is related to network issues? During the weekend I&apos;ve monitored it carefully and repair failed at the same time I see drop in number of requests sent to C* cluster in this datacenter. I&apos;ve decided to run repair for smaller tables where it takes 1-4 hours to complete and it happened once (launched on 6 nodes) also when such drop appears.&lt;/p&gt;

&lt;p&gt;Tried 2nd time and now it works (and I don&apos;t see any anomalies in metrics).&lt;/p&gt;</comment>
                            <comment id="15134437" author="jfgosselin" created="Fri, 5 Feb 2016 16:45:49 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=yukim&quot; class=&quot;user-hover&quot; rel=&quot;yukim&quot;&gt;yukim&lt;/a&gt; We are also seeing this issue in our multi datacenters cluster (3 DCs), C* 2.1.9 (and using LCS). We ran nodetool scrub on all the nodes but the error keeps coming back . &lt;/p&gt;

&lt;p&gt;We did have some network glitch, as &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mlowicki&quot; class=&quot;user-hover&quot; rel=&quot;mlowicki&quot;&gt;mlowicki&lt;/a&gt; was saying, can it be related to network issues ? &lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;ERROR [ValidationExecutor:5884] 2016-02-03 09:27:41,703 Validator.java:245 - Failed creating a merkle tree for [repair #a8f3f040-ca58-11e5-9dda-130298de45de on keyspace1/xyz, (5126461213031423923,5128334161692376535]], /10.174.216.163 (see log for details)
ERROR [ValidationExecutor:5884] 2016-02-03 09:27:41,704 CassandraDaemon.java:223 - Exception in thread Thread[ValidationExecutor:5884,1,main]
java.lang.AssertionError: row DecoratedKey(5126475305931285312, 00103cee13c2c0ea38328138fcad86515eef0000250233636565313363322d633065612d333833322d383133382d6663616438363531356565660000105cc950f02b6239f0bf9af60ac7dd452400) received out of order wrt DecoratedKey(5128167525973821686, 00105fe2e7db8810387a9a2955a07ecfa7d30000250235666532653764622d383831302d333837612d396132392d353561303765636661376433000010f64b1c2b7d1c3ff893b70c24c5dbdc6b00)
        at org.apache.cassandra.repair.Validator.add(Validator.java:126) ~[apache-cassandra-2.1.9.jar:2.1.9]
        at org.apache.cassandra.db.compaction.CompactionManager.doValidationCompaction(CompactionManager.java:1003) ~[apache-cassandra-2.1.9.jar:2.1.9]
        at org.apache.cassandra.db.compaction.CompactionManager.access$600(CompactionManager.java:94) ~[apache-cassandra-2.1.9.jar:2.1.9]
        at org.apache.cassandra.db.compaction.CompactionManager$9.call(CompactionManager.java:615) ~[apache-cassandra-2.1.9.jar:2.1.9]
        at java.util.concurrent.FutureTask.run(FutureTask.java:262) ~[na:1.7.0_65]
        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1145) ~[na:1.7.0_65]
        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:615) [na:1.7.0_65]
        at java.lang.Thread.run(Thread.java:745) [na:1.7.0_65]
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="15141000" author="yukim" created="Wed, 10 Feb 2016 15:30:12 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jfgosselin&quot; class=&quot;user-hover&quot; rel=&quot;jfgosselin&quot;&gt;jfgosselin&lt;/a&gt;&lt;br/&gt;
If LCS is the cause of out of order, you will see WARN message like following on start up or scrub:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;At level x, /data/foo/bar/xxx.db [xxxx, xxxx] overlaps /data/foo/bar/yyy.db [yyyy, yyyy]. ...
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Can you confirm if this is the case?&lt;/p&gt;</comment>
                            <comment id="15141245" author="jfgosselin" created="Wed, 10 Feb 2016 17:26:42 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=yukim&quot; class=&quot;user-hover&quot; rel=&quot;yukim&quot;&gt;yukim&lt;/a&gt;  The WARN message should be in the C* log or on the stdout of nodetool ?&lt;/p&gt;</comment>
                            <comment id="15141274" author="yukim" created="Wed, 10 Feb 2016 17:39:54 +0000"  >&lt;p&gt;It is in C* log.&lt;/p&gt;</comment>
                            <comment id="15141341" author="jfgosselin" created="Wed, 10 Feb 2016 18:09:44 +0000"  >&lt;p&gt;No, we haven&apos;t seen this WARN. The only thing we haven&apos;t tried is a node restart (based on you comment above &quot; ... The latter may be fixed by restarting the node.&quot; ) . Although I&apos;m not sure it will fix the problem since we&apos;ve used C* 2.1.9 from the beginning.&lt;/p&gt;</comment>
                            <comment id="15143270" author="jfgosselin" created="Thu, 11 Feb 2016 18:58:53 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=yukim&quot; class=&quot;user-hover&quot; rel=&quot;yukim&quot;&gt;yukim&lt;/a&gt; Yesterday we ran nodetool scrub on all the nodes and restarted the nodes. No luck we&apos;re still getting &quot;received out of order wrt DecoratedKey&quot; . Any suggestions for the next step ?&lt;/p&gt;</comment>
                            <comment id="15143307" author="jfgosselin" created="Thu, 11 Feb 2016 19:18:22 +0000"  >&lt;p&gt;Here&apos;s a new one with no clear message from the exception :&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;INFO  [AntiEntropyStage:1] 2016-02-11 17:21:20,947 RepairSession.java:171 - [repair #d78e02b0-d0e3-11e5-a04a-4ffa10ef584b] Received merkle tree for bar from /10.53.10.30
ERROR [AntiEntropySessions:28] 2016-02-11 17:21:21,033 RepairSession.java:303 - [repair #d78e02b0-d0e3-11e5-a04a-4ffa10ef584b] session completed with the following error
org.apache.cassandra.exceptions.RepairException: [repair #d78e02b0-d0e3-11e5-a04a-4ffa10ef584b on foo/bar, (-5525881226490706160,-5525442713957813067]] Validation failed in /172.16.63.39
	at org.apache.cassandra.repair.RepairSession.validationComplete(RepairSession.java:166) ~[apache-cassandra-2.1.9.jar:2.1.9]
	at org.apache.cassandra.service.ActiveRepairService.handleMessage(ActiveRepairService.java:406) ~[apache-cassandra-2.1.9.jar:2.1.9]
	at org.apache.cassandra.repair.RepairMessageVerbHandler.doVerb(RepairMessageVerbHandler.java:134) ~[apache-cassandra-2.1.9.jar:2.1.9]
	at org.apache.cassandra.net.MessageDeliveryTask.run(MessageDeliveryTask.java:64) ~[apache-cassandra-2.1.9.jar:2.1.9]
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1145) [na:1.7.0_65]
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:615) [na:1.7.0_65]
	at java.lang.Thread.run(Thread.java:745) [na:1.7.0_65]
ERROR [AntiEntropySessions:28] 2016-02-11 17:21:21,034 CassandraDaemon.java:223 - Exception in thread Thread[AntiEntropySessions:28,5,RMI Runtime]
java.lang.RuntimeException: org.apache.cassandra.exceptions.RepairException: [repair #d78e02b0-d0e3-11e5-a04a-4ffa10ef584b on foo/bar, (-5525881226490706160,-5525442713957813067]] Validation failed in /172.16.63.39
	at com.google.common.base.Throwables.propagate(Throwables.java:160) ~[guava-16.0.jar:na]
	at org.apache.cassandra.utils.WrappedRunnable.run(WrappedRunnable.java:32) ~[apache-cassandra-2.1.9.jar:2.1.9]
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:471) ~[na:1.7.0_65]
	at java.util.concurrent.FutureTask.run(FutureTask.java:262) ~[na:1.7.0_65]
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1145) ~[na:1.7.0_65]
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:615) [na:1.7.0_65]
	at java.lang.Thread.run(Thread.java:745) [na:1.7.0_65]
Caused by: org.apache.cassandra.exceptions.RepairException: [repair #d78e02b0-d0e3-11e5-a04a-4ffa10ef584b on foo/bar, (-5525881226490706160,-5525442713957813067]] Validation failed in /172.16.63.39
	at org.apache.cassandra.repair.RepairSession.validationComplete(RepairSession.java:166) ~[apache-cassandra-2.1.9.jar:2.1.9]
	at org.apache.cassandra.service.ActiveRepairService.handleMessage(ActiveRepairService.java:406) ~[apache-cassandra-2.1.9.jar:2.1.9]
	at org.apache.cassandra.repair.RepairMessageVerbHandler.doVerb(RepairMessageVerbHandler.java:134) ~[apache-cassandra-2.1.9.jar:2.1.9]
	at org.apache.cassandra.net.MessageDeliveryTask.run(MessageDeliveryTask.java:64) ~[apache-cassandra-2.1.9.jar:2.1.9]
	... 3 common frames omitted
ERROR [Thread-20728] 2016-02-11 17:21:21,034 StorageService.java:2966 - Repair session d78e02b0-d0e3-11e5-a04a-4ffa10ef584b for range (-5525881226490706160,-5525442713957813067] failed with error org.apache.cassandra.exceptions.RepairException: [repair #d78e02b0-d0e3-11e5-a04a-4ffa10ef584b on foo/bar, (-5525881226490706160,-5525442713957813067]] Validation failed in /172.16.63.39
java.util.concurrent.ExecutionException: java.lang.RuntimeException: org.apache.cassandra.exceptions.RepairException: [repair #d78e02b0-d0e3-11e5-a04a-4ffa10ef584b on foo/bar, (-5525881226490706160,-5525442713957813067]] Validation failed in /172.16.63.39
	at java.util.concurrent.FutureTask.report(FutureTask.java:122) [na:1.7.0_65]
	at java.util.concurrent.FutureTask.get(FutureTask.java:188) [na:1.7.0_65]
	at org.apache.cassandra.service.StorageService$4.runMayThrow(StorageService.java:2957) ~[apache-cassandra-2.1.9.jar:2.1.9]
	at org.apache.cassandra.utils.WrappedRunnable.run(WrappedRunnable.java:28) [apache-cassandra-2.1.9.jar:2.1.9]
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:471) [na:1.7.0_65]
	at java.util.concurrent.FutureTask.run(FutureTask.java:262) [na:1.7.0_65]
	at java.lang.Thread.run(Thread.java:745) [na:1.7.0_65]
Caused by: java.lang.RuntimeException: org.apache.cassandra.exceptions.RepairException: [repair #d78e02b0-d0e3-11e5-a04a-4ffa10ef584b on foo/bar, (-5525881226490706160,-5525442713957813067]] Validation failed in /172.16.63.39
	at com.google.common.base.Throwables.propagate(Throwables.java:160) ~[guava-16.0.jar:na]
	at org.apache.cassandra.utils.WrappedRunnable.run(WrappedRunnable.java:32) [apache-cassandra-2.1.9.jar:2.1.9]
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:471) [na:1.7.0_65]
	at java.util.concurrent.FutureTask.run(FutureTask.java:262) [na:1.7.0_65]
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1145) ~[na:1.7.0_65]
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:615) ~[na:1.7.0_65]
	... 1 common frames omitted
Caused by: org.apache.cassandra.exceptions.RepairException: [repair #d78e02b0-d0e3-11e5-a04a-4ffa10ef584b on foo/bar, (-5525881226490706160,-5525442713957813067]] Validation failed in /172.16.63.39
	at org.apache.cassandra.repair.RepairSession.validationComplete(RepairSession.java:166) ~[apache-cassandra-2.1.9.jar:2.1.9]
	at org.apache.cassandra.service.ActiveRepairService.handleMessage(ActiveRepairService.java:406) ~[apache-cassandra-2.1.9.jar:2.1.9]
	at org.apache.cassandra.repair.RepairMessageVerbHandler.doVerb(RepairMessageVerbHandler.java:134) ~[apache-cassandra-2.1.9.jar:2.1.9]
	at org.apache.cassandra.net.MessageDeliveryTask.run(MessageDeliveryTask.java:64) ~[apache-cassandra-2.1.9.jar:2.1.9]
	... 3 common frames omitted
INFO  [STREAM-IN-/10.53.10.29] 2016-02-11 17:21:21,056 StreamResultFuture.java:180 - [Stream #dccd16d2-d0e3-11e5-a04a-4ffa10ef584b] Session with /10.53.10.29 is complete
INFO  [STREAM-IN-/10.53.10.29] 2016-02-11 17:21:21,056 StreamResultFuture.java:212 - [Stream #dccd16d2-d0e3-11e5-a04a-4ffa10ef584b] All sessions completed
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="15143323" author="yukim" created="Thu, 11 Feb 2016 19:30:44 +0000"  >&lt;p&gt;What is the error in /172.16.63.39?&lt;/p&gt;</comment>
                            <comment id="15143400" author="jfgosselin" created="Thu, 11 Feb 2016 20:01:59 +0000"  >&lt;p&gt;Ok from 172.16.63.39, same error &quot;received out of order wrt DecoratedKey&quot; :&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;ERROR [ValidationExecutor:118] 2016-02-11 17:21:27,512 Validator.java:245 - Failed creating a merkle tree for [repair #d78e02b0-d0e3-11e5-a04a-4ffa10ef584b on foo/bar, (-5525881226490706160,-5525442713957813067]], /10.174.216.158 (see log for details)
ERROR [ValidationExecutor:118] 2016-02-11 17:21:27,516 CassandraDaemon.java:223 - Exception in thread Thread[ValidationExecutor:118,1,main]
java.lang.AssertionError: row DecoratedKey(-5525725068665570338, 0010e3a74bf82717394598e2b7421c89382e0000250265336137346266382d323731372d333934352d393865322d623734323163383933383265000010f64b1c2b7d1c3ff893b70c24c5dbdc6b00) received out of order wrt DecoratedKey(-5525444669477674618, 0010581499f0b99337e1bf468611fd0233e40000250235383134393966302d623939332d333765312d626634362d383631316664303233336534000010f64b1c2b7d1c3ff893b70c24c5dbdc6b00)
        at org.apache.cassandra.repair.Validator.add(Validator.java:126) ~[apache-cassandra-2.1.9.jar:2.1.9]
        at org.apache.cassandra.db.compaction.CompactionManager.doValidationCompaction(CompactionManager.java:1003) ~[apache-cassandra-2.1.9.jar:2.1.9]
        at org.apache.cassandra.db.compaction.CompactionManager.access$600(CompactionManager.java:94) ~[apache-cassandra-2.1.9.jar:2.1.9]
        at org.apache.cassandra.db.compaction.CompactionManager$9.call(CompactionManager.java:615) ~[apache-cassandra-2.1.9.jar:2.1.9]
        at java.util.concurrent.FutureTask.run(FutureTask.java:262) ~[na:1.7.0_65]
        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1145) ~[na:1.7.0_65]
        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:615) [na:1.7.0_65]
        at java.lang.Thread.run(Thread.java:745) [na:1.7.0_65]
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="15145336" author="jfgosselin" created="Fri, 12 Feb 2016 21:27:51 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=yukim&quot; class=&quot;user-hover&quot; rel=&quot;yukim&quot;&gt;yukim&lt;/a&gt; What&apos;s the next step to troubleshoot this issue ? Any specific log we could enable at DEBUG  ?&lt;/p&gt;</comment>
                            <comment id="15154700" author="yukim" created="Fri, 19 Feb 2016 19:16:58 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jfgosselin&quot; class=&quot;user-hover&quot; rel=&quot;jfgosselin&quot;&gt;jfgosselin&lt;/a&gt; Just want to check, how are you running repair?&lt;br/&gt;
What repair options are you using?&lt;br/&gt;
Have you run incremental repair?&lt;/p&gt;</comment>
                            <comment id="15154789" author="jfgosselin" created="Fri, 19 Feb 2016 20:06:33 +0000"  >&lt;p&gt;We are doing range repair with &lt;a href=&quot;https://github.com/spotify/cassandra-reaper&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/spotify/cassandra-reaper&lt;/a&gt; . We don&apos;t use incremental repair .  We also see the issue with :  nodetool repair -pr&lt;/p&gt;</comment>
                            <comment id="15188891" author="ruoranwang" created="Thu, 10 Mar 2016 08:10:59 +0000"  >&lt;p&gt;We are running 2.1.13, 1 DC 6 nodes, LCS, replication 3. We&apos;ve done a full repair on the cluster, and used sstablerepairedset marked all those are repaired.&lt;/p&gt;

&lt;p&gt;However, when we run incremental repair, nodetool repair --in-local-dc -par -pr -inc KEYSPACE, we got the same error log from the repairing node, and got the same DecoratedKey from the node that is sending merkle tree to repairing node.&lt;br/&gt;
We tried scrub on the failing keyspace/colum_family and restart, (tried on failing node, then tried on all nodes) but we are still occasionally getting the repair failures. So we haven&apos;t been able to run incremental repair on our cluster.&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;ERROR [Thread-46463] 2016-03-06 06:02:34,632 StorageService.java:3050 - Repair session 01e9f1b0-e361-11e5-9531-ffeee0307673 for range (5646258101641427476,5658366818450316790] failed with error org.apache.cassandra.exceptions.RepairException: [repair #01e9f1b0-e361-11e5-9531-ffeee0307673 on challenges/message, (5646258101641427476,5658366818450316790]] Validation failed in /10.125.218.156
java.util.concurrent.ExecutionException: java.lang.RuntimeException: org.apache.cassandra.exceptions.RepairException: [repair #01e9f1b0-e361-11e5-9531-ffeee0307673 on challenges/message, (5646258101641427476,5658366818450316790]] Validation failed in /10.125.218.156
        at java.util.concurrent.FutureTask.report(FutureTask.java:122) [na:1.8.0_66]
        at java.util.concurrent.FutureTask.get(FutureTask.java:192) [na:1.8.0_66]
        at org.apache.cassandra.service.StorageService$4.runMayThrow(StorageService.java:3041) ~[apache-cassandra-2.1.13.jar:2.1.13]
        at org.apache.cassandra.utils.WrappedRunnable.run(WrappedRunnable.java:28) [apache-cassandra-2.1.13.jar:2.1.13]
        at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511) [na:1.8.0_66]
        at java.util.concurrent.FutureTask.run(FutureTask.java:266) [na:1.8.0_66]
        at java.lang.Thread.run(Thread.java:745) [na:1.8.0_66]
Caused by: java.lang.RuntimeException: org.apache.cassandra.exceptions.RepairException: [repair #01e9f1b0-e361-11e5-9531-ffeee0307673 on challenges/message, (5646258101641427476,5658366818450316790]] Validation failed in /10.125.218.156
        at com.google.common.base.Throwables.propagate(Throwables.java:160) ~[guava-16.0.jar:na]
        at org.apache.cassandra.utils.WrappedRunnable.run(WrappedRunnable.java:32) [apache-cassandra-2.1.13.jar:2.1.13]
        at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511) [na:1.8.0_66]
        at java.util.concurrent.FutureTask.run(FutureTask.java:266) [na:1.8.0_66]
        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1142) ~[na:1.8.0_66]
        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:617) ~[na:1.8.0_66]
        ... 1 common frames omitted
Caused by: org.apache.cassandra.exceptions.RepairException: [repair #01e9f1b0-e361-11e5-9531-ffeee0307673 on challenges/message, (5646258101641427476,5658366818450316790]] Validation failed in /10.125.218.156
        at org.apache.cassandra.repair.RepairSession.validationComplete(RepairSession.java:166) ~[apache-cassandra-2.1.13.jar:2.1.13]
        at org.apache.cassandra.service.ActiveRepairService.handleMessage(ActiveRepairService.java:415) ~[apache-cassandra-2.1.13.jar:2.1.13]
        at org.apache.cassandra.repair.RepairMessageVerbHandler.doVerb(RepairMessageVerbHandler.java:134) ~[apache-cassandra-2.1.13.jar:2.1.13]
        at org.apache.cassandra.net.MessageDeliveryTask.run(MessageDeliveryTask.java:64) ~[apache-cassandra-2.1.13.jar:2.1.13]
        ... 3 common frames omitted
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;ERROR [ValidationExecutor:205] 2016-03-07 18:47:15,009 Validator.java:245 - Failed creating a merkle tree for [repair #02132fa0-e495-11e5-80cd-61571269f00d on challenges/message_by_modification, (2769065886542373503,2774747608185850009]], /10.57.198.15 (see log for details)
ERROR [ValidationExecutor:205] 2016-03-07 18:47:15,011 CassandraDaemon.java:229 - Exception in thread Thread[ValidationExecutor:205,1,main]
java.lang.AssertionError: row DecoratedKey(2769066505137675224, 00040000002e00000800000153441a3ef000) received out of order wrt DecoratedKey(2774747040849866654, 00040000019b0000080000015348847eb200)
        at org.apache.cassandra.repair.Validator.add(Validator.java:126) ~[apache-cassandra-2.1.13.jar:2.1.13]
        at org.apache.cassandra.db.compaction.CompactionManager.doValidationCompaction(CompactionManager.java:1051) ~[apache-cassandra-2.1.13.jar:2.1.13]
        at org.apache.cassandra.db.compaction.CompactionManager.access$600(CompactionManager.java:89) ~[apache-cassandra-2.1.13.jar:2.1.13]
        at org.apache.cassandra.db.compaction.CompactionManager$9.call(CompactionManager.java:662) ~[apache-cassandra-2.1.13.jar:2.1.13]
        at java.util.concurrent.FutureTask.run(FutureTask.java:266) ~[na:1.8.0_66]
        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1142) ~[na:1.8.0_66]
        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:617) [na:1.8.0_66]
        at java.lang.Thread.run(Thread.java:745) [na:1.8.0_66]
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="15189329" author="pauloricardomg" created="Thu, 10 Mar 2016 14:11:12 +0000"  >&lt;blockquote&gt;&lt;p&gt;We tried scrub on the failing keyspace/colum_family and restart&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Did you try &quot;nodetool scrub&quot; or offline &quot;sstablescrub&quot; tool? If you tried only online scrub, could you try running offline scrub in the offending sstable?&lt;/p&gt;

&lt;p&gt;You may find the offending sstable by running on &lt;tt&gt;10.125.218.156&lt;/tt&gt; &lt;tt&gt;nodetool getsstables challenges message_by_modification &amp;#8211; 00040000019b0000080000015348847eb200&lt;/tt&gt; (you ). More info on running offline scrub can be found on &lt;a href=&quot;https://engineering.gosquared.com/dealing-corrupt-sstable-cassandra&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;this post&lt;/a&gt; (although it&apos;s outdated, idea is the same).&lt;/p&gt;

&lt;p&gt;Also, is &lt;tt&gt;challenges/message_by_modification&lt;/tt&gt; a secondary index of &lt;tt&gt;challenges/message&lt;/tt&gt; or are they independent tables?&lt;/p&gt;</comment>
                            <comment id="15190304" author="ruoranwang" created="Fri, 11 Mar 2016 01:40:12 +0000"  >&lt;p&gt;I am geting the following error when running nodetool getsstables. Also tired the first number in DecoratedKey(2774747040849866654, 00040000019b0000080000015348847eb200), same error. Those are independent tables. &lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;error: For input string: &quot;0004000002bf0000080000015362933f0b00&quot;
-- StackTrace --
java.lang.NumberFormatException: For input string: &quot;0004000002bf0000080000015362933f0b00&quot;
	at java.lang.NumberFormatException.forInputString(NumberFormatException.java:65)
	at java.lang.Integer.parseInt(Integer.java:580)
	at java.lang.Integer.parseInt(Integer.java:615)
	at org.apache.cassandra.db.marshal.Int32Type.fromString(Int32Type.java:58)
	at org.apache.cassandra.db.marshal.AbstractCompositeType.fromString(AbstractCompositeType.java:242)
	at org.apache.cassandra.db.ColumnFamilyStore.getSSTablesForKey(ColumnFamilyStore.java:1980)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:497)
	at sun.reflect.misc.Trampoline.invoke(MethodUtil.java:71)
	at sun.reflect.GeneratedMethodAccessor7.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:497)
	at sun.reflect.misc.MethodUtil.invoke(MethodUtil.java:275)
	at com.sun.jmx.mbeanserver.StandardMBeanIntrospector.invokeM2(StandardMBeanIntrospector.java:112)
	at com.sun.jmx.mbeanserver.StandardMBeanIntrospector.invokeM2(StandardMBeanIntrospector.java:46)
	at com.sun.jmx.mbeanserver.MBeanIntrospector.invokeM(MBeanIntrospector.java:237)
	at com.sun.jmx.mbeanserver.PerInterface.invoke(PerInterface.java:138)
	at com.sun.jmx.mbeanserver.MBeanSupport.invoke(MBeanSupport.java:252)
	at com.sun.jmx.interceptor.DefaultMBeanServerInterceptor.invoke(DefaultMBeanServerInterceptor.java:819)
	at com.sun.jmx.mbeanserver.JmxMBeanServer.invoke(JmxMBeanServer.java:801)
	at javax.management.remote.rmi.RMIConnectionImpl.doOperation(RMIConnectionImpl.java:1471)
	at javax.management.remote.rmi.RMIConnectionImpl.access$300(RMIConnectionImpl.java:76)
	at javax.management.remote.rmi.RMIConnectionImpl$PrivilegedOperation.run(RMIConnectionImpl.java:1312)
	at javax.management.remote.rmi.RMIConnectionImpl.doPrivilegedOperation(RMIConnectionImpl.java:1404)
	at javax.management.remote.rmi.RMIConnectionImpl.invoke(RMIConnectionImpl.java:832)
	at sun.reflect.GeneratedMethodAccessor14.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:497)
	at sun.rmi.server.UnicastServerRef.dispatch(UnicastServerRef.java:323)
	at sun.rmi.transport.Transport$1.run(Transport.java:200)
	at sun.rmi.transport.Transport$1.run(Transport.java:197)
	at java.security.AccessController.doPrivileged(Native Method)
	at sun.rmi.transport.Transport.serviceCall(Transport.java:196)
	at sun.rmi.transport.tcp.TCPTransport.handleMessages(TCPTransport.java:568)
	at sun.rmi.transport.tcp.TCPTransport$ConnectionHandler.run0(TCPTransport.java:826)
	at sun.rmi.transport.tcp.TCPTransport$ConnectionHandler.lambda$run$95(TCPTransport.java:683)
	at java.security.AccessController.doPrivileged(Native Method)
	at sun.rmi.transport.tcp.TCPTransport$ConnectionHandler.run(TCPTransport.java:682)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1142)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:617)
	at java.lang.Thread.run(Thread.java:745)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="15191076" author="pauloricardomg" created="Fri, 11 Mar 2016 15:47:31 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ruoranwang&quot; class=&quot;user-hover&quot; rel=&quot;ruoranwang&quot;&gt;ruoranwang&lt;/a&gt; I&apos;ve added the option &lt;tt&gt;--hex-format&lt;/tt&gt; to &lt;tt&gt;nodetool getsstables&lt;/tt&gt; on &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-11337&quot; title=&quot;Add --hex-format option to nodetool getsstables&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-11337&quot;&gt;&lt;del&gt;CASSANDRA-11337&lt;/del&gt;&lt;/a&gt; to allow retrieving sstables from a key in hex format. Since it&apos;s not released yet, you can clone &lt;a href=&quot;https://github.com/pauloricardomg/cassandra/tree/2.1.13-11337&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;this repository&lt;/a&gt; and build with &lt;tt&gt;ant clean build jar&lt;/tt&gt; and then execute &lt;tt&gt;nodetool getsstables --hex-format keyspace1 standard1 00040000019b0000080000015348847eb200&lt;/tt&gt;.&lt;/p&gt;</comment>
                            <comment id="15191528" author="pauloricardomg" created="Fri, 11 Mar 2016 21:33:15 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ruoranwang&quot; class=&quot;user-hover&quot; rel=&quot;ruoranwang&quot;&gt;ruoranwang&lt;/a&gt; actually you&apos;ll also need to replace the &lt;tt&gt;lib/apache-cassandra-2.1.13.jar&lt;/tt&gt; with the generated &lt;tt&gt;apache-cassandra-2.1.13-SNAPSHOT.jar&lt;/tt&gt; on that node for the &lt;tt&gt;nodetool getsstables --hex-format&lt;/tt&gt; command to work properly. &lt;/p&gt;</comment>
                            <comment id="15194431" author="ruoranwang" created="Tue, 15 Mar 2016 00:09:49 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=pauloricardomg&quot; class=&quot;user-hover&quot; rel=&quot;pauloricardomg&quot;&gt;pauloricardomg&lt;/a&gt; thanks, that patch works. I am reproducing the error, I will post the result when the error shows up again.&lt;/p&gt;

&lt;p&gt;Btw, I noticed those two failing column families have high number of sstable count at level 1.&lt;br/&gt;
The follwing output is the sstable count for the 6 nodes we have. Top two are the column families that had the issue, the bottom two are two normal ones. I noticed this last Friday, the level 1 count didn&apos;t drop until today. I don&apos;t see any pending compactions (This is a performace testing cluster and I stopped read and write from last friday)&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;                SSTables in each level: [2, 20/10, 88, 0, 0, 0, 0, 0, 0]
                SSTables in each level: [0, 20/10, 103/100, 90, 0, 0, 0, 0, 0]
                SSTables in each level: [2, 10, 39, 0, 0, 0, 0, 0, 0]
                SSTables in each level: [2, 10, 58, 0, 0, 0, 0, 0, 0]
 
                SSTables in each level: [50/4, 20/10, 85, 0, 0, 0, 0, 0, 0]
                SSTables in each level: [1, 18/10, 108/100, 81, 0, 0, 0, 0, 0]
                SSTables in each level: [2, 10, 35, 0, 0, 0, 0, 0, 0]
                SSTables in each level: [2, 10, 59, 0, 0, 0, 0, 0, 0]
 
                SSTables in each level: [1, 22/10, 97, 0, 0, 0, 0, 0, 0]
                SSTables in each level: [0, 18/10, 107/100, 91, 0, 0, 0, 0, 0]
                SSTables in each level: [2, 10, 43, 0, 0, 0, 0, 0, 0]
                SSTables in each level: [2, 10, 67, 0, 0, 0, 0, 0, 0]
 
                SSTables in each level: [1, 20/10, 91, 0, 0, 0, 0, 0, 0]
                SSTables in each level: [1, 20/10, 108/100, 102, 0, 0, 0, 0, 0]
                SSTables in each level: [2, 10, 37, 0, 0, 0, 0, 0, 0]
                SSTables in each level: [2, 10, 61, 0, 0, 0, 0, 0, 0]
 
                SSTables in each level: [1, 21/10, 95, 0, 0, 0, 0, 0, 0]
                SSTables in each level: [1, 18/10, 114/100, 84, 0, 0, 0, 0, 0]
                SSTables in each level: [2, 10, 41, 0, 0, 0, 0, 0, 0]
                SSTables in each level: [2, 10, 67, 0, 0, 0, 0, 0, 0]

                SSTables in each level: [1, 20/10, 88, 0, 0, 0, 0, 0, 0]
                SSTables in each level: [1, 20/10, 110/100, 151, 0, 0, 0, 0, 0]
                SSTables in each level: [2, 10, 37, 0, 0, 0, 0, 0, 0]
                SSTables in each level: [2, 10, 56, 0, 0, 0, 0, 0, 0]
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="15194696" author="ruoranwang" created="Tue, 15 Mar 2016 03:49:31 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=pauloricardomg&quot; class=&quot;user-hover&quot; rel=&quot;pauloricardomg&quot;&gt;pauloricardomg&lt;/a&gt; Here is the recent Error message, and following are the sstables and their metadata.&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;ERROR [ValidationExecutor:8] 2016-03-15 03:19:25,473 Validator.java:245 - Failed creating a merkle tree for [repair #b82c4cf0-ea5c-11e5-8b54-71e192c0496a on KEYSPACE/COLUM_FAMILY, (8825693858844788422,8825705737822637605]], /10.57.198.67 (see log for details)
ERROR [ValidationExecutor:8] 2016-03-15 03:19:25,474 CassandraDaemon.java:229 - Exception in thread Thread[ValidationExecutor:8,1,main]
java.lang.AssertionError: row DecoratedKey(8825694477039867191, 0004000003b70000080000015363e13ed200) received out of order wrt DecoratedKey(8825705587125016582, 0004000000420000080000015363141ed900)
        at org.apache.cassandra.repair.Validator.add(Validator.java:126) ~[apache-cassandra-2.1.13.jar:2.1.13]
        at org.apache.cassandra.db.compaction.CompactionManager.doValidationCompaction(CompactionManager.java:1051) ~[apache-cassandra-2.1.13.jar:2.1.13]
        at org.apache.cassandra.db.compaction.CompactionManager.access$600(CompactionManager.java:89) ~[apache-cassandra-2.1.13.jar:2.1.13]
        at org.apache.cassandra.db.compaction.CompactionManager$9.call(CompactionManager.java:662) ~[apache-cassandra-2.1.13.jar:2.1.13]
        at java.util.concurrent.FutureTask.run(FutureTask.java:266) ~[na:1.8.0_66]
        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1142) ~[na:1.8.0_66]
        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:617) [na:1.8.0_66]
        at java.lang.Thread.run(Thread.java:745) [na:1.8.0_66]
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;nodetool getsstables --hex-format -- KEYSPACE COLUM_FAMILY 0004000003b70000080000015363e13ed200
/var/lib/cassandra/data/KEYSPACE/COLUM_FAMILY-d0500b80d14a11e5a42361571269f00d/KEYSPACE-COLUM_FAMILY-ka-59389-Data.db
/var/lib/cassandra/data/KEYSPACE/COLUM_FAMILY-d0500b80d14a11e5a42361571269f00d/KEYSPACE-COLUM_FAMILY-ka-59225-Data.db
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;


&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;nodetool getsstables --hex-format -- KEYSPACE COLUM_FAMILY 0004000000420000080000015363141ed900/var/lib/cassandra/data/KEYSPACE/COLUM_FAMILY-d0500b80d14a11e5a42361571269f00d/KEYSPACE-COLUM_FAMILY-ka-59389-Data.db
/var/lib/cassandra/data/KEYSPACE/COLUM_FAMILY-d0500b80d14a11e5a42361571269f00d/KEYSPACE-COLUM_FAMILY-ka-59225-Data.db
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;


&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;SSTable: /var/lib/cassandra/data/KEYSPACE/COLUM_FAMILY-d0500b80d14a11e5a42361571269f00d/KEYSPACE-COLUM_FAMILY-ka-59225
Partitioner: org.apache.cassandra.dht.Murmur3Partitioner
Bloom Filter FP chance: 0.100000
Minimum timestamp: 1457647152189000
Maximum timestamp: 1457683010045000
SSTable max local deletion time: 1458287810
Compression ratio: 0.2804368699432709
Estimated droppable tombstones: 0.1136631298580633
SSTable Level: 0
Repaired at: 0
ReplayPosition(segmentId=1457685762291, position=384)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;


&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;SSTable: /var/lib/cassandra/data/KEYSPACE/COLUM_FAMILY-d0500b80d14a11e5a42361571269f00d/KEYSPACE-COLUM_FAMILY-ka-59389
Partitioner: org.apache.cassandra.dht.Murmur3Partitioner
Bloom Filter FP chance: 0.100000
Minimum timestamp: 1457647152172001
Maximum timestamp: 1458009746854000
SSTable max local deletion time: 1458614546
Compression ratio: 0.2809352366738701
Estimated droppable tombstones: 0.11049303066041988
SSTable Level: 0
Repaired at: 0
ReplayPosition(segmentId=1457995474961, position=24034207)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="15195499" author="pauloricardomg" created="Tue, 15 Mar 2016 15:39:46 +0000"  >&lt;p&gt;did you run &lt;a href=&quot;https://engineering.gosquared.com/dealing-corrupt-sstable-cassandra&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;offline scrub&lt;/a&gt; on these faulty sstables?&lt;/p&gt;</comment>
                            <comment id="15196949" author="ruoranwang" created="Wed, 16 Mar 2016 07:34:53 +0000"  >&lt;p&gt;I did a offline scrub but that doesn&apos;t seem to help, the error showed up again.&lt;/p&gt;

&lt;p&gt;Btw here is another observation, the second of two consecutive repairs worked on one of the failing partition ranges (-st 5646258101641427476  -et 5658366818450316790). No scrub applied in between, but there is a cassandra restart on the node printing key out-of-order message.&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;$ nodetool repair -pr -par -inc -st 5646258101641427476  -et 5658366818450316790 -- KEYSPACE COLUM_FAMILY
[2016-03-16 06:57:54,519] Starting repair command #1, repairing 1 ranges for keyspace KEYSPACE (parallelism=PARALLEL, full=false)
[2016-03-16 06:57:56,101] Repair session 685850f0-eb44-11e5-88ab-ffeee0307673 for range (5646258101641427476,5658366818450316790] failed with error org.apache.cassandra.exceptions.RepairException: [repair #685850f0-eb44-11e5-88ab-ffeee0307673 on KEYSPACE/COLUM_FAMILY, (5646258101641427476,5658366818450316790]] Validation failed in /10.57.198.217
[2016-03-16 06:57:56,110] Repair command #1 finished
error: nodetool failed, check server logs
-- StackTrace --
java.lang.RuntimeException: nodetool failed, check server logs
at org.apache.cassandra.tools.NodeTool$NodeToolCmd.run(NodeTool.java:294)
at org.apache.cassandra.tools.NodeTool.main(NodeTool.java:206)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;$ nodetool repair -pr -par -inc -st 5646258101641427476  -et 5658366818450316790 -- KEYSPACE COLUM_FAMILY
[2016-03-16 07:06:16,557] Starting repair command #2, repairing 1 ranges for keyspace KEYSPACE (parallelism=PARALLEL, full=false)
[2016-03-16 07:06:20,879] Repair session 9393b5b0-eb45-11e5-88ab-ffeee0307673 for range (5646258101641427476,5658366818450316790] finished
[2016-03-16 07:08:32,581] Repair command #2 finished
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="15197339" author="pauloricardomg" created="Wed, 16 Mar 2016 13:50:26 +0000"  >&lt;p&gt;That&apos;s strange, did you take the node offline when running scrub? If not, it could be that the faulty sstable was still loaded so when the node was restarted only the correct sstable was loaded.&lt;/p&gt;

&lt;p&gt;Is the problem fixed now?&lt;/p&gt;</comment>
                            <comment id="15198666" author="ruoranwang" created="Thu, 17 Mar 2016 03:02:34 +0000"  >&lt;p&gt;I stopped cassandra then did the offline scrub. It&apos;s not fixed yet. &lt;/p&gt;</comment>
                            <comment id="15198847" author="ruoranwang" created="Thu, 17 Mar 2016 06:44:55 +0000"  >&lt;p&gt;I cleaned the data in the cluseter, then generated some data and the error is reproduced again.&lt;/p&gt;

&lt;p&gt;Here are part of those out of order errors. The first part of DecoratedKey is the Toke. In org.apache.cassandra.repair.Validator#add, there is an assertion &lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;  assert lastKey == null || lastKey.compareTo(row.key) &amp;lt; 0 : &quot;row &quot; + row.key + &quot; received out of order wrt &quot; + lastKey; &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;, which is trying to make sure if the lastKey is not null lastKey should be smaller than currentkey. The compare method will try to compare token (if tokens of those two keys are equal, compare the byte), and all those following failures (including other failures posted above) are caused by lastKey.token &amp;gt;= currentKey.token. Not sure why that&apos;s happening.&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;java.lang.AssertionError: row DecoratedKey(-8369102073622366180, 000400000001000008000001538239650100) received out of order wrt DecoratedKey(-8357216522748296009, 0004000000000000080000015382acbe8d00) column statsnull
java.lang.AssertionError: row DecoratedKey(-6257362846602517264, 0004000000000000080000015382949a0500) received out of order wrt DecoratedKey(-6236290075537674781, 0004000000010000080000015382a27e9600) column statsnull
java.lang.AssertionError: row DecoratedKey(2478458424628257677, 000400000001000008000001538271539a00) received out of order wrt DecoratedKey(2490779404447159202, 0004000000010000080000015382662a5000) column statsnull
java.lang.AssertionError: row DecoratedKey(8880802316577320376, 0004000000010000080000015382821cf300) received out of order wrt DecoratedKey(8881355423529151128, 00040000000100000800000153829533b900) column statsnull
java.lang.AssertionError: row DecoratedKey(-1344138391208803679, 00040000000100000800000153828d23dc00) received out of order wrt DecoratedKey(-1339348872117800450, 00040000000100000800000153829e30ea00) column statsnull
java.lang.AssertionError: row DecoratedKey(-3057182277536415874, 000400000000000008000001538286c44600) received out of order wrt DecoratedKey(-3053575924537508805, 000400000000000008000001538294cb5a00) column statsnull
java.lang.AssertionError: row DecoratedKey(5646261254263909895, 00040000000000000800000153824e3a4f00) received out of order wrt DecoratedKey(5658365860829244661, 00040000000000000800000153827dd3a600) column statsnull
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Another information might be useful is the partition key for that column family could collide, not sure if that&apos;s the cause.&lt;/p&gt;

&lt;p&gt;PRIMARY KEY ((bucket, modified_minute), id)&lt;/p&gt;</comment>
                            <comment id="15206457" author="pauloricardomg" created="Tue, 22 Mar 2016 14:39:11 +0000"  >&lt;blockquote&gt;&lt;p&gt;I cleaned the data in the cluster, then generated some data and the error is reproduced again.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Are you able to reproduce it in a clean cluster? If you could share reproduction steps that would be great.&lt;/p&gt;</comment>
                            <comment id="15207380" author="ruoranwang" created="Tue, 22 Mar 2016 21:51:35 +0000"  >&lt;p&gt;Yes, I am able to reproduce with new keyspace.&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;CREATE KEYSPACE test WITH replication = {&apos;class&apos;: &apos;SimpleStrategy&apos;, &apos;replication_factor&apos;: &apos;3&apos;}  AND durable_writes = true;

CREATE TABLE test.ui_by_modification (
    bucket int,
    modified_hour timestamp,
    user_id bigint,
    challenge_id uuid,
    created timestamp,
    creator_user_id bigint,
    type int,
    PRIMARY KEY ((bucket, modified_hour), user_id, challenge_id)
) WITH CLUSTERING ORDER BY (user_id ASC, challenge_id ASC)
    AND bloom_filter_fp_chance = 0.1
    AND caching = &apos;{&quot;keys&quot;:&quot;ALL&quot;, &quot;rows_per_partition&quot;:&quot;NONE&quot;}&apos;
    AND comment = &apos;&apos;
    AND compaction = {&apos;class&apos;: &apos;org.apache.cassandra.db.compaction.LeveledCompactionStrategy&apos;}
    AND compression = {&apos;sstable_compression&apos;: &apos;org.apache.cassandra.io.compress.LZ4Compressor&apos;}
    AND dclocal_read_repair_chance = 0.1
    AND default_time_to_live = 604800
    AND gc_grace_seconds = 864000
    AND max_index_interval = 2048
    AND memtable_flush_period_in_ms = 0
    AND min_index_interval = 128
    AND read_repair_chance = 0.0
    AND speculative_retry = &apos;99.0PERCENTILE&apos;;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Then I am generating data using&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;        Long creatorId = (long) random.nextInt(100000000);

        UUID uuid = UUID_GENERATOR.generate();
        int type = random.nextInt(10);
        getIdCache().put(creatorId, uuid);

        Date date = DateTime.now(DateTimeZone.UTC).toDate();

        try {

            runQuery(
                    &quot;insert into test.ui_by_modification(bucket, modified_hour, user_id, challenge_id, created, creator_user_id, type) VALUES (?, ?, ?, ?, ?, ?, ?)&quot;,
                    new Random().nextInt(1024), date, creatorId, UUID_GENERATOR.generate(), date, creatorId, type
            );

        } catch (Exception e) {
            log.error(&quot;error&quot;, e);
        }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I insert ~200 per second. Then I start first round of incremental repairs, repair -pr -par --in-local-dc -inc &amp;#8211; test, on this 6 nodes in the cluster. Then I waited ~1.5 hour then run the same inc repair, and then I got the same error. &lt;br/&gt;
I think there is a correlation between the composite partition key and this error.&lt;/p&gt;</comment>
                            <comment id="15209712" author="ruoranwang" created="Thu, 24 Mar 2016 04:15:22 +0000"  >&lt;p&gt;Using your nodetool getsstables --hex-format, I found all those hex keys show up in two sstables. ()&lt;br/&gt;
I checked those two sstables, found two entries in each sstable are exactly the same.&lt;/p&gt;</comment>
                            <comment id="15219158" author="ruoranwang" created="Thu, 31 Mar 2016 01:20:29 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=pauloricardomg&quot; class=&quot;user-hover&quot; rel=&quot;pauloricardomg&quot;&gt;pauloricardomg&lt;/a&gt; I am able to download the sstables to my local machine and step through the code (I&apos;m using 2.1.13). Here are things I found interesting, &lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Whenever the row key out of order error shows up, I can find two sstables, say A and B, where B is the subset of A. The average cell size is 93.&lt;/li&gt;
	&lt;li&gt;when stepping through the code, I found the unrepairedScanners in org.apache.cassandra.db.compaction.WrappingCompactionStrategy#getScanners are of type LeveledScanner.&lt;/li&gt;
	&lt;li&gt;I wonder why unrepaired in WrappingCompactionStrategy is set the same way as repaired (org.apache.cassandra.db.compaction.WrappingCompactionStrategy#setStrategy), and there are assert statements checking          assert repaired.getClass().equals(unrepaired.getClass()). From the documentation for incremental, my understanding is that unrepaired sstables should be using SizeTieredCompactionStrategy.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;I tried the following fix locally and it worked, gonna test it on prod machines. I would appreciated some help here to make sure my theory is not off the track.&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;diff --git a/src/java/org/apache/cassandra/db/compaction/AbstractCompactionStrategy.java b/src/java/org/apache/cassandra/db/compaction/AbstractCompactionStrategy.java
index 77ca404..498a939 100644
--- a/src/java/org/apache/cassandra/db/compaction/AbstractCompactionStrategy.java
+++ b/src/java/org/apache/cassandra/db/compaction/AbstractCompactionStrategy.java
@@ -261,13 +261,18 @@ public abstract class AbstractCompactionStrategy
         });
     }

+    public ScannerList getScanners(Collection&amp;lt;SSTableReader&amp;gt; sstables, Range&amp;lt;Token&amp;gt; range)
+    {
+        return getDefaultScanners(sstables, range);
+    }
+
     /**
      * Returns a list of KeyScanners given sstables and a range on which to scan.
      * The default implementation simply grab one SSTableScanner per-sstable, but overriding this method
      * allow for a more memory efficient solution if we know the sstable don&apos;t overlap (see
      * LeveledCompactionStrategy for instance).
      */
-    public ScannerList getScanners(Collection&amp;lt;SSTableReader&amp;gt; sstables, Range&amp;lt;Token&amp;gt; range)
+    public ScannerList getDefaultScanners(Collection&amp;lt;SSTableReader&amp;gt; sstables, Range&amp;lt;Token&amp;gt; range)
     {
         RateLimiter limiter = CompactionManager.instance.getRateLimiter();
         ArrayList&amp;lt;ISSTableScanner&amp;gt; scanners = new ArrayList&amp;lt;ISSTableScanner&amp;gt;();
diff --git a/src/java/org/apache/cassandra/db/compaction/WrappingCompactionStrategy.java b/src/java/org/apache/cassandra/db/compaction/WrappingCompactionStrategy.java
index 71a6bc1..f398067 100644
--- a/src/java/org/apache/cassandra/db/compaction/WrappingCompactionStrategy.java
+++ b/src/java/org/apache/cassandra/db/compaction/WrappingCompactionStrategy.java
@@ -404,7 +404,7 @@ public final class WrappingCompactionStrategy extends AbstractCompactionStrategy
             else
                 unrepairedSSTables.add(sstable);
         ScannerList repairedScanners = repaired.getScanners(repairedSSTables, range);
-        ScannerList unrepairedScanners = unrepaired.getScanners(unrepairedSSTables, range);
+        ScannerList unrepairedScanners = unrepaired.getDefaultScanners(unrepairedSSTables, range);
         List&amp;lt;ISSTableScanner&amp;gt; scanners = new ArrayList&amp;lt;&amp;gt;(repairedScanners.scanners.size() + unrepairedScanners.scanners.size());
         scanners.addAll(repairedScanners.scanners);
         scanners.addAll(unrepairedScanners.scanners);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="15220322" author="ruoranwang" created="Thu, 31 Mar 2016 17:53:28 +0000"  >&lt;p&gt;That&apos;s not an ideal fix. I noticed in LevelCompactionStrategy getScanners, it uses SSTableScanner for L0. However, those sstables have the issue are at L1, I need to figure out why that happens.&lt;/p&gt;</comment>
                            <comment id="15239551" author="pauloricardomg" created="Wed, 13 Apr 2016 16:30:33 +0000"  >&lt;p&gt;Hey &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ruoranwang&quot; class=&quot;user-hover&quot; rel=&quot;ruoranwang&quot;&gt;ruoranwang&lt;/a&gt;, thanks for the report and helping troubleshoot the issue.&lt;/p&gt;

&lt;p&gt;Do you have any update on this? While your patch might work, this might come at the expense of performance, because the default &lt;tt&gt;getScanner&lt;/tt&gt; implementation create an &lt;tt&gt;IScanner&lt;/tt&gt; instance for each sstable, while &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-4142&quot; title=&quot;OOM Exception during repair session with LeveledCompactionStrategy&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-4142&quot;&gt;&lt;del&gt;CASSANDRA-4142&lt;/del&gt;&lt;/a&gt; improved this for LCS to have one scanner per level, making iteration faster.&lt;/p&gt;

&lt;p&gt;I think that what might be happening is some race condition, where an sstable is added or removed from a level by a compaction during validation, but a &lt;tt&gt;LeveledScanner&lt;/tt&gt; is created assuming there are no overlaps within each level, so we get the &lt;tt&gt;received out of order AssertionError&lt;/tt&gt;.&lt;/p&gt;

&lt;p&gt;I created a &lt;a href=&quot;https://github.com/apache/cassandra/commit/a8c573547677f97b875583b8992155e7333659c3&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;patch&lt;/a&gt; that might solve this by verifying that the sstable level corresponds to the level in the current manifest, so we can guarantee non-overlapness. Otherwise it means that sstable was added or removed recently so we create an exclusive scanner for that sstable, so it will be merged correctly during validation.&lt;/p&gt;

&lt;p&gt;Are you able to create a custom jar with that patch and check if that solves the issue? I&apos;m attaching a .patch file to this ticket so you can apply in your custom branch.&lt;/p&gt;</comment>
                            <comment id="15239639" author="ruoranwang" created="Wed, 13 Apr 2016 17:12:35 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=pauloricardomg&quot; class=&quot;user-hover&quot; rel=&quot;pauloricardomg&quot;&gt;pauloricardomg&lt;/a&gt; I have some news. I mentioned earlier I found the two sstables returned from getsstables --hex-format always shows one is another&apos;s ancestor. So I looked at anticompaction, and I think it&apos;s the old sstable not being removed due to a race condition. &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-10831&quot; title=&quot;Fix the way we replace sstables after anticompaction&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-10831&quot;&gt;&lt;del&gt;CASSANDRA-10831&lt;/del&gt;&lt;/a&gt; moved &apos;markCompactedSSTablesReplaced&apos; out of a try catch clause. &lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;cfs.getDataTracker().markCompactedSSTablesReplaced(successfullyAntiCompactedSSTables, anticompactedSSTables, OperationType.ANTICOMPACTION);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;When I added try catch around this, I found an AssertError when the anticompaction process tries remove old sstables.&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;java.lang.AssertionError: Expecting new size of 95, got 96 while replacing XXX by XXX
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;That is thrown from org.apache.cassandra.db.DataTracker.View#replace&lt;/p&gt;

&lt;p&gt;So I think this could be caused by unmarkCompacting called before markCompactedSSTablesReplaced. Yesterday I created another ticket for 2.1.13, I also attached my proposed patch there.&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-11548&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/CASSANDRA-11548&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15247044" author="pauloricardomg" created="Tue, 19 Apr 2016 02:45:57 +0000"  >&lt;p&gt;Although the root cause of this issue is &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-11548&quot; title=&quot;Anticompaction not removing old sstables&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-11548&quot;&gt;&lt;del&gt;CASSANDRA-11548&lt;/del&gt;&lt;/a&gt;, it could&apos;ve been detected and fixed if we validated sstable levels while creating the &lt;tt&gt;LeveledScanner&lt;/tt&gt;, to guarantee there will be no-overlaps at each level.&lt;/p&gt;

&lt;p&gt;I added a regression test and fixed &lt;tt&gt;LeveledScanner&lt;/tt&gt; construction to verify sstable levels against &lt;tt&gt;LeveledManifest&lt;/tt&gt;, and create an exclusive scanner when an sstable level does not match its level on &lt;tt&gt;LeveledManifest&lt;/tt&gt;, so it does not cause the &lt;tt&gt;received out of order AssertionError&lt;/tt&gt; during scanning/validation.&lt;/p&gt;

&lt;p&gt;While this could happen in &quot;legal&quot; situations due to sstables changing level or being removed shortly after they are referenced for scanning, it could also happen due to orphaned sstables (like &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-11548&quot; title=&quot;Anticompaction not removing old sstables&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-11548&quot;&gt;&lt;del&gt;CASSANDRA-11548&lt;/del&gt;&lt;/a&gt;), so I added the following &lt;tt&gt;WARN&lt;/tt&gt; when an sstable level does not match the level in the &lt;tt&gt;LeveledManifest&lt;/tt&gt; so it will be easier to identify similar situations caused by bugs in the future:&lt;/p&gt;

&lt;p&gt;&lt;tt&gt;Live sstable /home/paulo/Workspace/cassandra/cassandra/build/test/cassandra/data/LongLeveledCompactionStrategyTest/StandardLeveled-bfa3d69005d411e6927b59837863b18e/la-360-big-Data.db from level 1 is not on corresponding level in the leveled manifest. This is not a problem per se, but may indicate an orphaned sstable due to a failed compaction not cleaned up properly.&lt;/tt&gt;&lt;/p&gt;

&lt;p&gt;Patch and CI tests available below:&lt;/p&gt;
&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;2.1&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;2.2&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;3.0&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;trunk&lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/apache/cassandra/compare/cassandra-2.1...pauloricardomg:2.1-9935&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;branch&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/apache/cassandra/compare/cassandra-2.2...pauloricardomg:2.2-9935&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;branch&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/apache/cassandra/compare/cassandra-3.0...pauloricardomg:3.0-9935&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;branch&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/apache/cassandra/compare/trunk...pauloricardomg:trunk-9935&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;branch&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/paulomotta/job/pauloricardomg-2.1-9935-testall/lastCompletedBuild/testReport/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;testall&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/paulomotta/job/pauloricardomg-2.2-9935-testall/lastCompletedBuild/testReport/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;testall&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/paulomotta/job/pauloricardomg-3.0-9935-testall/lastCompletedBuild/testReport/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;testall&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/paulomotta/job/pauloricardomg-trunk-9935-testall/lastCompletedBuild/testReport/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;testall&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/paulomotta/job/pauloricardomg-2.1-9935-dtest/lastCompletedBuild/testReport/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;dtest&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/paulomotta/job/pauloricardomg-2.2-9935-dtest/lastCompletedBuild/testReport/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;dtest&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/paulomotta/job/pauloricardomg-3.0-9935-dtest/lastCompletedBuild/testReport/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;dtest&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/paulomotta/job/pauloricardomg-trunk-9935-dtest/lastCompletedBuild/testReport/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;dtest&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;
</comment>
                            <comment id="15247560" author="pauloricardomg" created="Tue, 19 Apr 2016 11:06:51 +0000"  >&lt;p&gt;there was a minor nit on trunk &lt;tt&gt;testall&lt;/tt&gt; already fixed and resubmitted.&lt;/p&gt;</comment>
                            <comment id="15256641" author="iamaleksey" created="Mon, 25 Apr 2016 17:25:58 +0000"  >&lt;p&gt;Are we good to go on this yet?&lt;/p&gt;</comment>
                            <comment id="15256832" author="krummas" created="Mon, 25 Apr 2016 19:14:26 +0000"  >&lt;p&gt;yeah, I&apos;ll commit tomorrow, got distracted by &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-11625&quot; title=&quot;CFS.CANONICAL_SSTABLES adds compacting sstables without checking if they are still live&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-11625&quot;&gt;CASSANDRA-11625&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15257764" author="krummas" created="Tue, 26 Apr 2016 08:51:17 +0000"  >&lt;p&gt;committed!&lt;/p&gt;</comment>
                            <comment id="15312239" author="ahmed.eljami" created="Thu, 2 Jun 2016 12:46:06 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mlowicki&quot; class=&quot;user-hover&quot; rel=&quot;mlowicki&quot;&gt;mlowicki&lt;/a&gt; When you had a problem with repair, streamthroughput had the default value (200Mb/s) ? We lowered this value (50Mb/s) and since the repair fails with the same error like you!&lt;/p&gt;</comment>
                            <comment id="15315855" author="mlowicki" created="Sun, 5 Jun 2016 12:10:36 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=pauloricardomg&quot; class=&quot;user-hover&quot; rel=&quot;pauloricardomg&quot;&gt;pauloricardomg&lt;/a&gt; any ETA for 2.1.15 release?&lt;/p&gt;</comment>
                            <comment id="15321127" author="pauloricardomg" created="Wed, 8 Jun 2016 18:19:13 +0000"  >&lt;p&gt;not yet, I will try to find out and update here later.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                                                <inwardlinks description="is duplicated by">
                                        <issuelink>
            <issuekey id="12818799">CASSANDRA-9126</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12960780">CASSANDRA-11625</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12798535" name="9935.patch" size="3322" author="pauloricardomg" created="Wed, 13 Apr 2016 16:31:05 +0000"/>
                            <attachment id="12747940" name="db1.sync.lati.osa.cassandra.log" size="9245169" author="mlowicki" created="Thu, 30 Jul 2015 07:43:44 +0000"/>
                            <attachment id="12748031" name="db5.sync.lati.osa.cassandra.log" size="3883298" author="mlowicki" created="Thu, 30 Jul 2015 17:14:08 +0000"/>
                            <attachment id="12774702" name="system.log.10.210.3.117" size="13490013" author="mlowicki" created="Sat, 28 Nov 2015 08:59:31 +0000"/>
                            <attachment id="12774700" name="system.log.10.210.3.221" size="19935112" author="mlowicki" created="Sat, 28 Nov 2015 08:53:19 +0000"/>
                            <attachment id="12774701" name="system.log.10.210.3.230" size="14600943" author="mlowicki" created="Sat, 28 Nov 2015 08:53:19 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>6.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[pauloricardomg]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 23 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2i40v:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>marcuse</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[marcuse]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12962"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>