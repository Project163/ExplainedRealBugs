<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 23:07:48 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-12744] Randomness of stress distributions is not good</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-12744</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;The randomness of our distributions is pretty bad.  We are using the JDKRandomGenerator() but in testing of uniform(1..3) we see for 100 iterations it&apos;s only outputting 3.  If you bump it to 10k it hits all 3 values. &lt;/p&gt;

&lt;p&gt;I made a change to just use the default commons math random generator and now see all 3 values for n=10&lt;/p&gt;</description>
                <environment></environment>
        <key id="13009277">CASSANDRA-12744</key>
            <summary>Randomness of stress distributions is not good</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10003" iconUrl="https://issues.apache.org/jira/images/icons/priorities/trivial.svg">Low</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="slater_ben">Ben Slater</assignee>
                                    <reporter username="tjake">T Jake Luciani</reporter>
                        <labels>
                            <label>stress</label>
                    </labels>
                <created>Mon, 3 Oct 2016 16:49:30 +0000</created>
                <updated>Wed, 15 Oct 2025 09:49:04 +0000</updated>
                            <resolved>Tue, 6 Jun 2017 13:43:49 +0000</resolved>
                                        <fixVersion>4.0-alpha1</fixVersion>
                    <fixVersion>4.0</fixVersion>
                                    <component>Legacy/Tools</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>9</watches>
                                                                                                                <comments>
                            <comment id="15542859" author="tjake" created="Mon, 3 Oct 2016 16:56:38 +0000"  >&lt;p&gt;&lt;a href=&quot;https://github.com/tjake/cassandra/tree/stress-random&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;branch&lt;/a&gt;&lt;br/&gt;
&lt;a href=&quot;http://cassci.datastax.com/job/tjake-stress-random-testall/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;utest&lt;/a&gt;&lt;br/&gt;
&lt;a href=&quot;http://cassci.datastax.com/job/tjake-stress-random-dtest/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;dtests&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15562403" author="pauloricardomg" created="Mon, 10 Oct 2016 14:06:56 +0000"  >&lt;p&gt;some &lt;a href=&quot;http://cassci.datastax.com/job/tjake-stress-random-dtest/lastCompletedBuild/testReport/cqlsh_tests.cqlsh_copy_tests/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;cqlsh_copy_tests&lt;/a&gt; are outputting the following error:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;cassandra-stress did not import enough records
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;do you think this could be related to the distribution change? if not, can you maybe rebase and resubmit those?&lt;/p&gt;</comment>
                            <comment id="15580762" author="slater_ben" created="Sun, 16 Oct 2016 23:56:56 +0000"  >&lt;p&gt;I tried this patch out. It definitely seems to improves distribution to something like what you&apos;d expect. Didn&apos;t notice any issues.&lt;/p&gt;</comment>
                            <comment id="15826180" author="jmckenzie" created="Tue, 17 Jan 2017 15:06:23 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tjake&quot; class=&quot;user-hover&quot; rel=&quot;tjake&quot;&gt;tjake&lt;/a&gt; - is this patch available?&lt;/p&gt;</comment>
                            <comment id="15830595" author="tjake" created="Thu, 19 Jan 2017 20:57:31 +0000"  >&lt;p&gt;There are test failures I haven&apos;t looked into yet so no.&lt;/p&gt;</comment>
                            <comment id="16021038" author="slater_ben" created="Tue, 23 May 2017 11:03:26 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tjake&quot; class=&quot;user-hover&quot; rel=&quot;tjake&quot;&gt;tjake&lt;/a&gt; - just realised this one was still open. If you can kick off the tests again, I&apos;d be happy to dig into any issues.&lt;/p&gt;</comment>
                            <comment id="16021150" author="tjake" created="Tue, 23 May 2017 12:50:35 +0000"  >&lt;p&gt;Thanks Ben, I&apos;d appreciate it&lt;/p&gt;

&lt;p&gt;Rebased on trunk:&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/tjake/cassandra/tree/stress-random-trunk&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;branch&lt;/a&gt;&lt;br/&gt;
&lt;a href=&quot;http://cassci.datastax.com/job/tjake-stress-random-trunk-testall/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;utest&lt;/a&gt;&lt;br/&gt;
&lt;a href=&quot;http://cassci.datastax.com/job/tjake-stress-random-trunk-dtest/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;dtests&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16027722" author="slater_ben" created="Sun, 28 May 2017 06:48:34 +0000"  >&lt;p&gt;So I took a look into this with the following findings:&lt;br/&gt;
1) The dtest is broken because it assumes that when you when c*-stress with n=10000 you will end up with 10,000 rows inserted when I think the actual functional guarantee is that it will run 10,000 insert operations.&lt;br/&gt;
2) However, with the JDKRandomGenerator is assumption hold up to a few hundred thousand records. Even with n=1M you end up with 999,999 records in the table. For some reason, change to the library default Well19937c generator means no only is the assumption broken at n=10k but seem to get proportional worse as n increases.&lt;/p&gt;

&lt;p&gt;So, on those findings, I don&apos;t think changing the generator is a good idea.&lt;/p&gt;

&lt;p&gt;So, I tried to dig a bit deeper about what was causing the issue. As part of this, I wrote some code to generate values directly from the distributions in various ways and the results all seemed as expected (ie reasonably aligned with the distribution type). &lt;/p&gt;

&lt;p&gt;After a bit more digging, and to cut a long story short, I found that the actual is related to the -pop setting. I&apos;m still a bit hazy on this but it seems -pop is the distribution of all possible keys. So, if I have a -pop of dist(1..10) I can only have 10 possible key values (ie combinations across all columns) no matter what the ranges specified for the key column in the YAML file are. The default for -pop is UNIFORM(1..n) where n is specified or 1..1,000,000 where no n is specified. I think this all results in somewhat counter-intuitive results, particular with multi-part keys.&lt;/p&gt;

&lt;p&gt;So, I think the actual answer here is to change the rules for the default -pop  for yaml runs to have a population size equal to the product of the population size of each key as specified in the YAML.  For example, if I have two columns: &lt;br/&gt;
partition_key UNIFORM(1..1M)&lt;br/&gt;
cluster_key UNIFORM(1..100)&lt;/p&gt;

&lt;p&gt;then the default population should be 1..100M. I think this is already implied by the YAML and what people would expect (certainly what I expected). I&apos;ve done a few tests manual setting the pop and it seems to do what&apos;s expected.&lt;/p&gt;

&lt;p&gt;I don&apos;t think this change will be too hard to make but interested to hear if anyone has an opinions before I jump into it.&lt;/p&gt;</comment>
                            <comment id="16027755" author="slater_ben" created="Sun, 28 May 2017 09:37:37 +0000"  >&lt;p&gt;Actually, I think it&apos;s a bit more complex than I just said but still think it&apos;s related to the interaction between the population distribution and the individual column distributions. Just tried 10,000 inserts with -pop dist=uniform(1..25) and the following YAML and only get 1 row inserted. &lt;br/&gt;
table_definition: |&lt;br/&gt;
  CREATE TABLE test4 (&lt;br/&gt;
        pk text,&lt;br/&gt;
        pk2 text,&lt;br/&gt;
        val text,&lt;br/&gt;
        PRIMARY KEY ((pk,pk2))&lt;br/&gt;
  ) &lt;br/&gt;
columnspec:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;name: pk&lt;br/&gt;
    size: fixed(2) &lt;br/&gt;
    population: exp(1..5) &lt;/li&gt;
	&lt;li&gt;name: pk2&lt;br/&gt;
    size: fixed(2) &lt;br/&gt;
    population: exp(1..5)&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Running with -pop dist=uniform(1..10B) gives the expected 25 rows so it may be as simple as just setting a really big default population when running in user mode but I&apos;ll do a bit more digging.&lt;/p&gt;</comment>
                            <comment id="16028803" author="slater_ben" created="Tue, 30 May 2017 07:16:13 +0000"  >&lt;p&gt;After some more digging, I&apos;ve come to the conclusion that the issue is that the JDKRandomGenerator creates close random numbers when seeded with close values. So, when running with a small range of potential seeds (from the population) you end up with different random doubles which all round to the same long value. &lt;/p&gt;

&lt;p&gt;The attached patch multiplies the generated seed so that max seed values are of the order of 10^22. I&apos;ve tested this against a couple of the failed dtests and pass OK. In addition, I get the following results from a range of YAML files (without multiplier result is unmodified trunk, with multiplier is with this patch applied):&lt;/p&gt;

&lt;p&gt;Example 1:&lt;br/&gt;
table: test5&lt;br/&gt;
table_definition: |&lt;br/&gt;
  CREATE TABLE test5 (&lt;br/&gt;
        pk int,&lt;br/&gt;
        val text,&lt;br/&gt;
        PRIMARY KEY (pk)&lt;br/&gt;
  ) &lt;br/&gt;
columnspec:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;name: pk&lt;br/&gt;
    size: fixed(64) &lt;br/&gt;
    population: uniform(1..500) &lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;user profile=... ops(insert=1) n=1000 cl=ALL no-warmup  -rate threads=5 -node 127.0.0.1&lt;br/&gt;
without multiplier - 47 rows&lt;br/&gt;
with multiplier - 490 rows&lt;/p&gt;

&lt;p&gt;================================&lt;/p&gt;

&lt;p&gt;table: test4&lt;br/&gt;
table_definition: |&lt;br/&gt;
  CREATE TABLE test4 (&lt;br/&gt;
        pk int,&lt;br/&gt;
        pk2 text,&lt;br/&gt;
        val text,&lt;br/&gt;
        PRIMARY KEY ((pk,pk2))&lt;br/&gt;
  ) &lt;br/&gt;
columnspec:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;name: pk&lt;br/&gt;
    size: fixed(2) &lt;br/&gt;
    population: uniform(1..5) &lt;/li&gt;
	&lt;li&gt;name: pk2&lt;br/&gt;
    size: fixed(2) &lt;br/&gt;
    population: uniform(1..5) &lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;user profile=... ops(insert=1) n=1000 cl=ALL no-warmup  -rate threads=5 -node 127.0.0.1&lt;br/&gt;
without multipler - 1 row&lt;br/&gt;
with multiplier - 25 rows&lt;/p&gt;

&lt;p&gt;================================&lt;/p&gt;

&lt;p&gt;table: test4&lt;br/&gt;
table_definition: |&lt;br/&gt;
  CREATE TABLE test4 (&lt;br/&gt;
        pk int,&lt;br/&gt;
        pk2 text,&lt;br/&gt;
        val text,&lt;br/&gt;
        PRIMARY KEY ((pk,pk2))&lt;br/&gt;
  ) &lt;br/&gt;
columnspec:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;name: pk&lt;br/&gt;
    size: fixed(2) &lt;br/&gt;
    population: uniform(1..500M) &lt;/li&gt;
	&lt;li&gt;name: pk2&lt;br/&gt;
    size: fixed(2) &lt;br/&gt;
    population: uniform(1..5) &lt;br/&gt;
user profile=... ops(insert=1) n=1000 cl=ALL no-warmup  -rate threads=5 -node 127.0.0.1&lt;br/&gt;
without multipler - 1000 row&lt;br/&gt;
with multiplier - 1000 rows&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;===================================&lt;br/&gt;
table: test7&lt;br/&gt;
table_definition: |&lt;br/&gt;
  CREATE TABLE test7 (&lt;br/&gt;
        pk int,&lt;br/&gt;
        pk2 text,&lt;br/&gt;
        ck1 text,&lt;br/&gt;
        val text,&lt;br/&gt;
        PRIMARY KEY ((pk,pk2), ck1)&lt;br/&gt;
  ) &lt;br/&gt;
columnspec:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;name: pk&lt;br/&gt;
    size: fixed(2) &lt;br/&gt;
    population: uniform(1..100) &lt;/li&gt;
	&lt;li&gt;name: pk2&lt;br/&gt;
    size: fixed(4) &lt;br/&gt;
    population: uniform(1..10000) &lt;/li&gt;
	&lt;li&gt;name: pk2&lt;br/&gt;
    size: fixed(4) &lt;br/&gt;
    population: uniform(1..1000) &lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;user profile=... ops(insert=1) n=100000 cl=ALL no-warmup  -rate threads=5 -node 127.0.0.1&lt;br/&gt;
without multipler - 10342 row&lt;br/&gt;
with multiplier - 63387 rows&lt;/p&gt;

&lt;p&gt;=====================================&lt;br/&gt;
table_definition: |&lt;br/&gt;
  CREATE TABLE test7 (&lt;br/&gt;
        pk int,&lt;br/&gt;
        pk2 text,&lt;br/&gt;
        ck1 text,&lt;br/&gt;
        val text,&lt;br/&gt;
        PRIMARY KEY ((pk,pk2), ck1)&lt;br/&gt;
  ) &lt;br/&gt;
columnspec:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;name: pk&lt;br/&gt;
    size: fixed(4) &lt;br/&gt;
    population: seq(1..100) &lt;/li&gt;
	&lt;li&gt;name: pk2&lt;br/&gt;
    size: fixed(10) &lt;br/&gt;
    population: seq(1..10000) &lt;/li&gt;
	&lt;li&gt;name: pk2&lt;br/&gt;
    size: fixed(10) &lt;br/&gt;
    cluster: uniform(1..1000)&lt;br/&gt;
    population: seq(1..1000) &lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;user profile=... ops(insert=1) n=100000 cl=ALL no-warmup  -rate threads=5 -node 127.0.0.1&lt;br/&gt;
without multiplier - 25000 row&lt;br/&gt;
with multiplier - 43304 rows&lt;/p&gt;



</comment>
                            <comment id="16029477" author="tjake" created="Tue, 30 May 2017 14:26:25 +0000"  >&lt;p&gt;good find! I re-started the tests with your patch&lt;/p&gt;</comment>
                            <comment id="16038091" author="slater_ben" created="Tue, 6 Jun 2017 04:12:09 +0000"  >&lt;p&gt;Looks like the tests failures are unrelated? Are we OK to commit?&lt;/p&gt;</comment>
                            <comment id="16038912" author="tjake" created="Tue, 6 Jun 2017 13:43:49 +0000"  >&lt;p&gt;Committed thx!&lt;/p&gt;</comment>
                            <comment id="16043871" author="slater_ben" created="Fri, 9 Jun 2017 03:27:22 +0000"  >&lt;p&gt;One extra note for future searching: There is a fair chance this fix will change the workload quite substantially in a number of scenarios. So, if you want to compare benchmarks make sure you don&apos;t compare results from stress with this fix vs stress without this fix.&lt;/p&gt;</comment>
                            <comment id="16184418" author="daniel.cranford" created="Thu, 28 Sep 2017 16:37:01 +0000"  >&lt;p&gt;I think the math on this is broken slightly. The seed multiplier is intended to scale all seeds to the 10^22 magnitude. However, seeds (and the multiplier) are all stored in 64 bit integers and the math is performed on them is 64 bit math.&lt;/p&gt;

&lt;p&gt;10^22 is not representable as a long which has range &lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;[-(2^63) : 2^63 - 1] = [-9,223,372,036,854,775,808 : 9,223,372,036,854,775,807]&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Consider that for sample sizes under 1084, the line that calculates the the sample multiplier &lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;this.sampleMultiplier = 1 + Math.round(Math.pow(10D, 22 - Math.log10(sampleSize)));&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;will result in a multiplier of Long.MIN_VALUE which when multiplied by any long will result in 0 or Long.MIN_VALUE reducing your seeds to two distinct values.&lt;/p&gt;

&lt;p&gt;I think using 18 instead of 22 as the target exponent should resolve this issue.&lt;/p&gt;

&lt;p&gt;Additionally, I think the seed population size is being incorrectly calculated as the range of the revisit distribution (which defaults to uniform(1..1M)). However, when running in the default sequential seed mode (without revisits), eg &lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;cassandra-stress write n=100&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;, the size of the seed population is actually the length of the seed sequence (in this case 100).&lt;/p&gt;

&lt;p&gt;And when running with seeds generated from a distribution, eg &lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;cassandra-stress read -pop dist=gaussian(1..250M)&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt; the size of the seed population is actually the range of the seed distribution (in this case 250 million).&lt;/p&gt;</comment>
                            <comment id="16190085" author="daniel.cranford" created="Tue, 3 Oct 2017 18:13:28 +0000"  >&lt;p&gt;As I&apos;ve thought about how to fix the seed multiplier, I&apos;ve come to the conclusion that it is impossible to use an adaptive multiplier without breaking existing functionality or changing the command line interface.&lt;/p&gt;

&lt;p&gt;One of the key reasons you can specify how the seeds get generated is so that you can partition the seed space and run multiple cassandra-stress processes on different machines in parallel so the cassandra-stress client doesn&apos;t become the bottleneck. E.G. to write 2 million partitions from two client machines, you&apos;d run &lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;cassandra-stress write n=1000000 -pop seq=1..1000000&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt; on one client machine and &lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;cassandra-stress write n=1000000 -pop seq=1000001..2000000&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt; on the other client machine.&lt;/p&gt;

&lt;p&gt;An adaptive multiplier that attempts to scale the seed sequence so that it&apos;s range is 10^22 (or better, Long.MAX_VALUE since seeds are 64 bit longs) would generate the same multiplier for both client processes resulting in seed sequence overlaps.&lt;/p&gt;

&lt;p&gt;To correctly generate an adaptive multiplier, you need global knowledge of the entire range of seeds being generated by all cassandra-stress processes. This information cannot be supplied via the current command line interface. The command line interface would have to be updated in a breaking fashion to support an adaptive multiplier.&lt;/p&gt;

&lt;p&gt;Using a hardcoded static multiplier is safe, but would reduce the allowable range of seed values (and thus reduce the maximum number of distinct partition keys). This probably isn&apos;t a big deal since nobody wants to write 2^64 partitions. But it would need to be chosen with care so that the number of distinct seeds (and thus the number of distinct partitions) doesn&apos;t become too small.&lt;/p&gt;
</comment>
                            <comment id="16192820" author="daniel.cranford" created="Thu, 5 Oct 2017 12:49:42 +0000"  >&lt;p&gt;Some more thoughts:&lt;/p&gt;

&lt;p&gt;The generation of partition keys has been &quot;broken&quot; since &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-7519&quot; title=&quot;Further stress improvements to generate more realistic workloads&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-7519&quot;&gt;&lt;del&gt;CASSANDRA-7519&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;The Linear Congruential Generators (LCGs) used in java.util.Random and by extension JDKRandomGenerator generate good random number sequences, but similar seeds result in similar sequences. Using the lcg update function &lt;tt&gt;lcg&amp;#40;x) = a*x + c&lt;/tt&gt; like&lt;/p&gt;

&lt;p&gt;random &lt;sub&gt;1&lt;/sub&gt; = lcg(1)&lt;br/&gt;
random &lt;sub&gt;2&lt;/sub&gt; = lcg(2)&lt;br/&gt;
random &lt;sub&gt;3&lt;/sub&gt; = lcg(3)&lt;br/&gt;
...&lt;br/&gt;
random &lt;sub&gt;n&lt;/sub&gt; = lcg&amp;#40;n)&lt;/p&gt;

&lt;p&gt;does not generate a good random sequence, this is a misuse of the LCG. LCGs are supposed to be used like&lt;/p&gt;

&lt;p&gt;random &lt;sub&gt;1&lt;/sub&gt; = lcg(1)&lt;br/&gt;
random &lt;sub&gt;2&lt;/sub&gt; = lcg(lcg(1))&lt;br/&gt;
random &lt;sub&gt;3&lt;/sub&gt; = lcg(lcg(lcg(1)))&lt;br/&gt;
...&lt;br/&gt;
random &lt;sub&gt;n&lt;/sub&gt; = lcg &lt;sup&gt;n&lt;/sup&gt; (1)&lt;/p&gt;

&lt;p&gt;I say &quot;broken&quot; in quotes because the misuse of LCGs ends up not mattering. &lt;tt&gt;new java.util.Random(seed).nextDouble()&lt;/tt&gt; will always differ from &lt;tt&gt;new java.util.Random(seed + 1).nextDouble()&lt;/tt&gt; by more than 1/100,000,000,000 Thus with the default partition key population (=UNIFORM(1..100B)), seeds that differ by 1 will generate distinct partition keys.&lt;/p&gt;

&lt;p&gt;The only thing that matters about partition keys is how many distinct values there are (and how large their lexical value is). The number of partition key components doesn&apos;t matter. The cardinality of each partition key component doesn&apos;t matter. The distribution of values in the lexical partition key space doesn&apos;t matter.&lt;/p&gt;

&lt;p&gt;At the end of the day, all the partition key components get concatenated and the resulting bit vector is hashed resulting in a uniformly distributed 64 bit token that determines where the data will be stored.&lt;/p&gt;

&lt;p&gt;The easiest &quot;fix&quot; is to not use the partition key population to define the number of partition keys. Take advantage of the fact that the only thing that matters from a performance standpoint is the number of distinct partitions. Leave the partition key distribution at uniform(1..100B), and use the n= parameter to define the number of partitions.&lt;/p&gt;

&lt;p&gt;An ideal fix would update the way partition keys are generated to use the LCG generator properly. However, this seems difficult since LCGs don&apos;t support random access (i.e., the only way to calculate the nth item in an LCG sequence is to first calculate the n-1 preceding items), and all three seed generation modes rely on the ability to randomly jump around in the seed sequence. This could be worked around by using a PRNG that supports random access to the n&apos;th item in the sequence (e.g. something like JDK 1.8&apos;s SpittableRandom could be easily extended to support this).&lt;/p&gt;

&lt;p&gt;A more workable fix is to spread the generated seeds (typically drawn from a smallish range of integers) around in the 2 &lt;sup&gt;64&lt;/sup&gt; values a long can take before seeding the LCG. An additional caveat to whatever function is used for spreading the seeds needs to be invertable since LookbackableWriteGenerator&apos;s implementation relies on the properties of the sequence it generates to perform internal bookeeping.&lt;/p&gt;

&lt;p&gt;Multiplication by an odd integer happens to be an invertable function (although integer division is NOT the inverse operation, multiplication by the modular inverse is). So the initial implementation (although broken) is not actually that bad an idea. I propose fixing things by picking a static integer as the multiplier and using multiplication by it&apos;s modular inverse to invert it for LookbackableWriteGenerator&lt;/p&gt;</comment>
                            <comment id="16192827" author="daniel.cranford" created="Thu, 5 Oct 2017 12:53:49 +0000"  >&lt;p&gt;Created &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-13940&quot; title=&quot;Fix stress seed multiplier&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-13940&quot;&gt;CASSANDRA-13940&lt;/a&gt; to fix this.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="13107218">CASSANDRA-13940</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12870350" name="CASSANDRA_12744_SeedManager_changes-trunk.patch" size="5801" author="slater_ben" created="Tue, 30 May 2017 07:17:06 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[slater_ben]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 6 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i34dcn:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>tjake</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[tjake]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12961"><![CDATA[Low]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>