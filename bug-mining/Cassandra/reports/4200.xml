<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 23:02:15 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-10943] NullPointer during LegacySchemaMigrator</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-10943</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;I&apos;m trying to upgrade my Cassandra cluster  from 2.2.4 to 3.1.1.&lt;/p&gt;

&lt;p&gt;I used&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;nodetool upgradesstables&lt;br/&gt;
nodetool drain&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;before upgrading.  &lt;/p&gt;

&lt;p&gt;The result is this:&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;INFO  &lt;span class=&quot;error&quot;&gt;&amp;#91;main&amp;#93;&lt;/span&gt; 2015-12-26 22:41:44,114 SystemKeyspace.java:1284 - Detected version upgrade from 2.2.4 to 3.1.1, snapshotting system keyspace&lt;br/&gt;
WARN  &lt;span class=&quot;error&quot;&gt;&amp;#91;main&amp;#93;&lt;/span&gt; 2015-12-26 22:41:44,318 CompressionParams.java:382 - The sstable_compression option has been deprecated. You should use class instead&lt;br/&gt;
ERROR &lt;span class=&quot;error&quot;&gt;&amp;#91;main&amp;#93;&lt;/span&gt; 2015-12-26 22:41:44,427 CassandraDaemon.java:690 - Exception encountered during startup&lt;br/&gt;
java.lang.NullPointerException: null&lt;br/&gt;
	at org.apache.cassandra.serializers.BooleanSerializer.deserialize(BooleanSerializer.java:33) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;apache-cassandra-3.1.1.jar:3.1.1&amp;#93;&lt;/span&gt;&lt;br/&gt;
	at org.apache.cassandra.serializers.BooleanSerializer.deserialize(BooleanSerializer.java:24) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;apache-cassandra-3.1.1.jar:3.1.1&amp;#93;&lt;/span&gt;&lt;br/&gt;
	at org.apache.cassandra.db.marshal.AbstractType.compose(AbstractType.java:114) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;apache-cassandra-3.1.1.jar:3.1.1&amp;#93;&lt;/span&gt;&lt;br/&gt;
	at org.apache.cassandra.cql3.UntypedResultSet$Row.getBoolean(UntypedResultSet.java:272) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;apache-cassandra-3.1.1.jar:3.1.1&amp;#93;&lt;/span&gt;&lt;br/&gt;
	at org.apache.cassandra.schema.LegacySchemaMigrator.decodeTableMetadata(LegacySchemaMigrator.java:264) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;apache-cassandra-3.1.1.jar:3.1.1&amp;#93;&lt;/span&gt;&lt;br/&gt;
	at org.apache.cassandra.schema.LegacySchemaMigrator.readTableMetadata(LegacySchemaMigrator.java:250) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;apache-cassandra-3.1.1.jar:3.1.1&amp;#93;&lt;/span&gt;&lt;br/&gt;
	at org.apache.cassandra.schema.LegacySchemaMigrator.readTable(LegacySchemaMigrator.java:221) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;apache-cassandra-3.1.1.jar:3.1.1&amp;#93;&lt;/span&gt;&lt;br/&gt;
	at org.apache.cassandra.schema.LegacySchemaMigrator.lambda$readTables$218(LegacySchemaMigrator.java:214) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;apache-cassandra-3.1.1.jar:3.1.1&amp;#93;&lt;/span&gt;&lt;br/&gt;
	at java.util.ArrayList.forEach(ArrayList.java:1249) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;na:1.8.0_66&amp;#93;&lt;/span&gt;&lt;br/&gt;
	at org.apache.cassandra.schema.LegacySchemaMigrator.readTables(LegacySchemaMigrator.java:214) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;apache-cassandra-3.1.1.jar:3.1.1&amp;#93;&lt;/span&gt;&lt;br/&gt;
	at org.apache.cassandra.schema.LegacySchemaMigrator.readKeyspace(LegacySchemaMigrator.java:163) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;apache-cassandra-3.1.1.jar:3.1.1&amp;#93;&lt;/span&gt;&lt;br/&gt;
	at org.apache.cassandra.schema.LegacySchemaMigrator.lambda$readSchema$215(LegacySchemaMigrator.java:154) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;apache-cassandra-3.1.1.jar:3.1.1&amp;#93;&lt;/span&gt;&lt;br/&gt;
	at java.util.ArrayList.forEach(ArrayList.java:1249) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;na:1.8.0_66&amp;#93;&lt;/span&gt;&lt;br/&gt;
	at org.apache.cassandra.schema.LegacySchemaMigrator.readSchema(LegacySchemaMigrator.java:154) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;apache-cassandra-3.1.1.jar:3.1.1&amp;#93;&lt;/span&gt;&lt;br/&gt;
	at org.apache.cassandra.schema.LegacySchemaMigrator.migrate(LegacySchemaMigrator.java:77) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;apache-cassandra-3.1.1.jar:3.1.1&amp;#93;&lt;/span&gt;&lt;br/&gt;
	at org.apache.cassandra.service.CassandraDaemon.setup(CassandraDaemon.java:223) &lt;span class=&quot;error&quot;&gt;&amp;#91;apache-cassandra-3.1.1.jar:3.1.1&amp;#93;&lt;/span&gt;&lt;br/&gt;
	at org.apache.cassandra.service.CassandraDaemon.activate(CassandraDaemon.java:549) &lt;span class=&quot;error&quot;&gt;&amp;#91;apache-cassandra-3.1.1.jar:3.1.1&amp;#93;&lt;/span&gt;&lt;br/&gt;
	at org.apache.cassandra.service.CassandraDaemon.main(CassandraDaemon.java:677) &lt;span class=&quot;error&quot;&gt;&amp;#91;apache-cassandra-3.1.1.jar:3.1.1&amp;#93;&lt;/span&gt;&lt;/p&gt;&lt;/blockquote&gt;</description>
                <environment>&lt;p&gt;Debian Jessie&lt;br/&gt;
java version &quot;1.8.0_66&quot;&lt;br/&gt;
Cassandra 2.2.4 -&amp;gt; 3.1.1 migration&lt;/p&gt;</environment>
        <key id="12924375">CASSANDRA-10943</key>
            <summary>NullPointer during LegacySchemaMigrator</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10003" iconUrl="https://issues.apache.org/jira/images/icons/priorities/trivial.svg">Low</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="aleksey">Aleksey Yeschenko</assignee>
                                    <reporter username="wienczny">Stephan Wienczny</reporter>
                        <labels>
                    </labels>
                <created>Sat, 26 Dec 2015 22:10:40 +0000</created>
                <updated>Tue, 16 Apr 2019 09:30:46 +0000</updated>
                            <resolved>Fri, 1 Apr 2016 18:23:11 +0000</resolved>
                                        <fixVersion>3.0.5</fixVersion>
                    <fixVersion>3.5</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="15072179" author="snazy" created="Sun, 27 Dec 2015 16:17:23 +0000"  >&lt;p&gt;Attached patch &lt;b&gt;should&lt;/b&gt; solve the issue.&lt;br/&gt;
/cc &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=iamaleksey&quot; class=&quot;user-hover&quot; rel=&quot;iamaleksey&quot;&gt;iamaleksey&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15072187" author="iamaleksey" created="Sun, 27 Dec 2015 17:11:48 +0000"  >&lt;p&gt;Why &lt;tt&gt;false&lt;/tt&gt; as the default value?&lt;/p&gt;</comment>
                            <comment id="15072191" author="snazy" created="Sun, 27 Dec 2015 17:32:02 +0000"  >&lt;p&gt;Oh - so, if &lt;tt&gt;is_dense&lt;/tt&gt; is not present, then it defaults to true?&lt;/p&gt;</comment>
                            <comment id="15072192" author="iamaleksey" created="Sun, 27 Dec 2015 17:35:14 +0000"  >&lt;p&gt;You have to calculate it from the rest of the schema, there isn&apos;t supposed to be a default. Thought a 2.2 node should have it always present, I think, hence it&apos;s implied to be there.&lt;/p&gt;

&lt;p&gt;I&apos;ll have a look next year.&lt;/p&gt;</comment>
                            <comment id="15072207" author="wienczny" created="Sun, 27 Dec 2015 18:42:21 +0000"  >&lt;p&gt;1. If is_dense should be available in 2.2 why is it missing from my 2.2 node?&lt;br/&gt;
2. How do you create is_dense?&lt;/p&gt;</comment>
                            <comment id="15200387" author="iamaleksey" created="Thu, 17 Mar 2016 21:13:50 +0000"  >&lt;p&gt;There are actually scenarios where a pre &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-7744&quot; title=&quot;Dropping the last collection column turns CompoundSparseCellNameType$WithCollection into CompoundDenseCellNameType&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-7744&quot;&gt;&lt;del&gt;CASSANDRA-7744&lt;/del&gt;&lt;/a&gt; table can remain unupgraded all the way to 2.2. We should be calculating it dynamically on upgrade when it&apos;s missing.&lt;/p&gt;</comment>
                            <comment id="15209400" author="iamaleksey" created="Wed, 23 Mar 2016 23:21:25 +0000"  >&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;branch&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;testall&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;dtest&lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/iamaleksey/cassandra/tree/10943-3.0&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;10943-3.0&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/iamaleksey/job/iamaleksey-10943-3.0-testall&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;testall&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/iamaleksey/job/iamaleksey-10943-3.0-dtest&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;dtest&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/iamaleksey/cassandra/tree/10943-3.5&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;10943-3.5&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/iamaleksey/job/iamaleksey-10943-3.5-testall&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;testall&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/iamaleksey/job/iamaleksey-10943-3.5-dtest&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;dtest&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/iamaleksey/cassandra/tree/10943-3.6&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;10943-3.6&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/iamaleksey/job/iamaleksey-10943-3.6-testall&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;testall&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/iamaleksey/job/iamaleksey-10943-3.6-dtest&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;dtest&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;
</comment>
                            <comment id="15209407" author="iamaleksey" created="Wed, 23 Mar 2016 23:25:12 +0000"  >&lt;p&gt;Pushed a patch that simply future-ports &lt;tt&gt;calculateIsDense&lt;/tt&gt; logic verbatim to 3.0 from 2.1/2.2 and calls the method if &lt;tt&gt;is_dense&lt;/tt&gt; field is missing from the migrating tables for any reason. This fixes the potential NPE issue, though there is at least one more related problem with &lt;tt&gt;is_dense&lt;/tt&gt;, for Thrift tables that start as dense and get columns added later. I will address that - with extra tests - in &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-11315&quot; title=&quot;Fix upgrading sparse tables that are incorrectly marked as dense&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-11315&quot;&gt;&lt;del&gt;CASSANDRA-11315&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="15221863" author="slebresne" created="Fri, 1 Apr 2016 15:44:44 +0000"  >&lt;p&gt;+1&lt;/p&gt;</comment>
                            <comment id="15222109" author="iamaleksey" created="Fri, 1 Apr 2016 18:23:11 +0000"  >&lt;p&gt;Committed as &lt;a href=&quot;https://github.com/apache/cassandra/commit/1a1f836f20ba4bf1c263d4fd3c32338e55abbcbc&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;1a1f836f20ba4bf1c263d4fd3c32338e55abbcbc&lt;/a&gt; to 3.0 and merged with 3.5 and trunk, thanks.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12779587" name="10943.txt" size="953" author="snazy" created="Sun, 27 Dec 2015 16:17:23 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[aleksey]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 33 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2qbiv:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>slebresne</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[slebresne]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12961"><![CDATA[Low]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>