<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 23:11:12 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-14318] Fix query pager DEBUG log leak causing hit in paged reads throughput</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-14318</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;Debug logging can involve in many cases (especially very low latency ones) a very important overhead on the read path in 2.2 as we&apos;ve seen when upgrading clusters from 2.0 to 2.2.&lt;/p&gt;

&lt;p&gt;The performance impact was especially noticeable on the client side metrics, where p99 could go up to 10 times higher, while ClientRequest metrics recorded by Cassandra didn&apos;t show any overhead.&lt;/p&gt;

&lt;p&gt;Below shows latencies recorded on the client side with debug logging on first, and then without it :&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;image-wrap&quot; style=&quot;&quot;&gt;&lt;img src=&quot;https://issues.apache.org/jira/secure/attachment/12914871/12914871_debuglogging.png&quot; style=&quot;border: 0px solid black&quot; /&gt;&lt;/span&gt; &#160;&lt;/p&gt;

&lt;p&gt;We generated a flame graph before turning off debug logging that shows the read call stack is dominated by debug logging :&#160;&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;image-wrap&quot; style=&quot;&quot;&gt;&lt;img src=&quot;https://issues.apache.org/jira/secure/attachment/12914869/12914869_flame_graph_snapshot.png&quot; style=&quot;border: 0px solid black&quot; /&gt;&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;I&apos;ve attached the original flame graph for exploration.&lt;/p&gt;

&lt;p&gt;Once disabled, the new flame graph shows that the read call stack gets extremely thin, which is further confirmed by client recorded metrics :&#160;&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;image-wrap&quot; style=&quot;&quot;&gt;&lt;img src=&quot;https://issues.apache.org/jira/secure/attachment/12914868/12914868_flame22+nodebug+sjk+svg.png&quot; style=&quot;border: 0px solid black&quot; /&gt;&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;The query pager code has been reworked since 3.0 and it looks like log.debug() calls are gone there, but for 2.2 users and to prevent such issues to appear with default settings, I really think debug logging should be disabled by default.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13145729">CASSANDRA-14318</key>
            <summary>Fix query pager DEBUG log leak causing hit in paged reads throughput</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10002" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Normal</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="adejanovski">Alexander Dejanovski</assignee>
                                    <reporter username="adejanovski">Alexander Dejanovski</reporter>
                        <labels>
                            <label>lhf</label>
                            <label>performance</label>
                    </labels>
                <created>Fri, 16 Mar 2018 14:25:43 +0000</created>
                <updated>Tue, 14 Oct 2025 12:13:57 +0000</updated>
                            <resolved>Fri, 30 Mar 2018 15:18:23 +0000</resolved>
                                        <fixVersion>2.2.13</fixVersion>
                                        <due></due>
                            <votes>2</votes>
                                    <watches>11</watches>
                                                                                                                <comments>
                            <comment id="16401971" author="adejanovski" created="Fri, 16 Mar 2018 14:31:52 +0000"  >&lt;p&gt;Here&apos;s the &lt;a href=&quot;https://github.com/apache/cassandra/compare/cassandra-2.2...thelastpickle:disable-debug-logging-by-default&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;patch for 2.2&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;It should be mergeable in 3.0/3.11/4.0 without a problem.&lt;/p&gt;</comment>
                            <comment id="16402526" author="vinaykumarcse" created="Fri, 16 Mar 2018 20:59:10 +0000"  >&lt;p&gt;+1 on your perf test results. Patch LGTM.&lt;/p&gt;</comment>
                            <comment id="16403671" author="JIRAUSER308715" created="Sat, 17 Mar 2018 18:21:00 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-10241&quot; title=&quot;Keep a separate production debug log for troubleshooting&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-10241&quot;&gt;&lt;del&gt;CASSANDRA-10241&lt;/del&gt;&lt;/a&gt; created that debug.log to be a &#8220;production&#8221; debug log. If there are things being logged at DEBUG which cause performance issues we should disable those or move them to TRACE, not turn off the debug.log.&lt;/p&gt;</comment>
                            <comment id="16403694" author="adejanovski" created="Sat, 17 Mar 2018 19:18:41 +0000"  >&lt;p&gt;Fair enough, I&apos;ll go down the read and write path to see if there&apos;s debug logging in v3 and above, and switch debug to trace in the query pager in 2.2.&lt;/p&gt;</comment>
                            <comment id="16404134" author="pauloricardomg" created="Sun, 18 Mar 2018 19:25:08 +0000"  >&lt;p&gt;Hey Alexander, would you care to re-run the experiments with the query pager DEBUG logs changed to TRACE level to check if debug.log logging overhead will still persist? Thanks!&lt;/p&gt;</comment>
                            <comment id="16404797" author="adejanovski" created="Mon, 19 Mar 2018 13:22:18 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=pauloricardomg&quot; class=&quot;user-hover&quot; rel=&quot;pauloricardomg&quot;&gt;pauloricardomg&lt;/a&gt;, thanks for assigning the ticket to me.&lt;/p&gt;

&lt;p&gt;Whatever the implementation, I&apos;ll run new performance tests and generate flame graphs to verify the impact of the changes, no worries.&lt;/p&gt;

&lt;p&gt;I&apos;ll wait a bit for a consensus to come out of the discussion on the dev ML before moving on, as there seem to be some conflicting views on what should be done.&lt;/p&gt;</comment>
                            <comment id="16404814" author="JIRAUSER308715" created="Mon, 19 Mar 2018 13:41:52 +0000"  >&lt;p&gt;No matter what is decided we should move those log messages to TRACE.  So I think we can proceed here no matter what.&lt;/p&gt;</comment>
                            <comment id="16405051" author="adejanovski" created="Mon, 19 Mar 2018 16:10:27 +0000"  >&lt;p&gt;Fair point. I&apos;ll write the patch and run the benchmarks.&lt;/p&gt;</comment>
                            <comment id="16405580" author="jjirsa" created="Mon, 19 Mar 2018 23:21:48 +0000"  >&lt;p&gt;If you havent yet started the second run of benchmarks, you may also want to move the debug log statements from ReadCallback.java (one deals with digest mismatch exceptions, forgot what the other is) to trace as well.&#160;&lt;/p&gt;</comment>
                            <comment id="16415846" author="adejanovski" created="Tue, 27 Mar 2018 16:10:33 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jjirsa&quot; class=&quot;user-hover&quot; rel=&quot;jjirsa&quot;&gt;jjirsa&lt;/a&gt;: apparently the&#160;ReadCallback class already logs at TRACE and not DEBUG on the latest 2.2.&lt;/p&gt;

&lt;p&gt;I&apos;ve created the fix that downgrades debug logging to trace logging in the query pager classes, and here are the results :&#160;&lt;/p&gt;

&lt;p&gt;debug on - no fix :&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Results:
op rate : 6681 [read_event_1:1109, read_event_2:1119, read_event_3:4452]
partition rate : 6681 [read_event_1:1109, read_event_2:1119, read_event_3:4452]
row rate : 6681 [read_event_1:1109, read_event_2:1119, read_event_3:4452]
latency mean : 19,1 [read_event_1:15,4, read_event_2:15,4, read_event_3:21,0]
latency median : 15,6 [read_event_1:14,2, read_event_2:14,0, read_event_3:16,3]
latency 95th percentile : 39,1 [read_event_1:28,4, read_event_2:28,6, read_event_3:44,2]
latency 99th percentile : 75,6 [read_event_1:52,9, read_event_2:53,6, read_event_3:87,7]
latency 99.9th percentile : 315,7 [read_event_1:101,0, read_event_2:110,1, read_event_3:361,1]
latency max : 609,1 [read_event_1:319,6, read_event_2:315,9, read_event_3:609,1]
Total partitions : 993050 [read_event_1:164882, read_event_2:166381, read_event_3:661787]
Total errors : 0 [read_event_1:0, read_event_2:0, read_event_3:0]
total gc count : 189
total gc mb : 56464
total gc time (s) : 7
avg gc time(ms) : 37
stdev gc time(ms) : 8
Total operation time : 00:02:28&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;debug off - no fix :&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Results:
op rate : 12655 [read_event_1:2141, read_event_2:2093, read_event_3:8422]
partition rate : 12655 [read_event_1:2141, read_event_2:2093, read_event_3:8422]
row rate : 12655 [read_event_1:2141, read_event_2:2093, read_event_3:8422]
latency mean : 10,1 [read_event_1:10,1, read_event_2:10,1, read_event_3:10,1]
latency median : 9,2 [read_event_1:9,2, read_event_2:9,2, read_event_3:9,3]
latency 95th percentile : 15,2 [read_event_1:15,8, read_event_2:15,9, read_event_3:15,7]
latency 99th percentile : 29,3 [read_event_1:44,5, read_event_2:45,1, read_event_3:41,3]
latency 99.9th percentile : 52,7 [read_event_1:67,9, read_event_2:66,9, read_event_3:67,1]
latency max : 268,0 [read_event_1:257,1, read_event_2:263,3, read_event_3:268,0]
Total partitions : 983056 [read_event_1:166311, read_event_2:162570, read_event_3:654175]
Total errors : 0 [read_event_1:0, read_event_2:0, read_event_3:0]
total gc count : 100
total gc mb : 31529
total gc time (s) : 4
avg gc time(ms) : 37
stdev gc time(ms) : 5
Total operation time : 00:01:17&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;debug on - with fix :&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Results:
op rate : 12289 [read_event_1:2058, read_event_2:2051, read_event_3:8181]
partition rate : 12289 [read_event_1:2058, read_event_2:2051, read_event_3:8181]
row rate : 12289 [read_event_1:2058, read_event_2:2051, read_event_3:8181]
latency mean : 10,4 [read_event_1:10,4, read_event_2:10,4, read_event_3:10,4]
latency median : 9,4 [read_event_1:9,4, read_event_2:9,4, read_event_3:9,4]
latency 95th percentile : 16,3 [read_event_1:16,8, read_event_2:17,3, read_event_3:16,2]
latency 99th percentile : 36,6 [read_event_1:44,3, read_event_2:46,6, read_event_3:37,2]
latency 99.9th percentile : 62,2 [read_event_1:78,0, read_event_2:77,1, read_event_3:80,8]
latency max : 251,2 [read_event_1:246,9, read_event_2:249,9, read_event_3:251,2]
Total partitions : 1000000 [read_event_1:167422, read_event_2:166861, read_event_3:665717]
Total errors : 0 [read_event_1:0, read_event_2:0, read_event_3:0]
total gc count : 102
total gc mb : 31843
total gc time (s) : 4
avg gc time(ms) : 38
stdev gc time(ms) : 6
Total operation time : 00:01:21&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;So we have similar performance with debug logging off and with the fix and debug on.&lt;br/&gt;
 The difference in throughput is pretty massive as we roughly get &lt;b&gt;twice the read throughput&lt;/b&gt; with the fix.&lt;/p&gt;

&lt;p&gt;Latencies without the fix and with the fix :&#160;&lt;/p&gt;

&lt;p&gt;p95 : 35ms -&amp;gt; 16ms&lt;br/&gt;
 p99 : 75ms -&amp;gt; 36ms&lt;/p&gt;

&lt;p&gt;I&apos;ve ran all tests several times, alternating with and without the fix to make sure caches were not making a difference, and results were consistent with what&apos;s pasted above.&lt;br/&gt;
 It&apos;s been running on a single node using an i3.xlarge instance for Cassandra and another i3.large for running cassandra-stress.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&lt;b&gt;One pretty interesting thing to note&lt;/b&gt; is that when I tested with the predefined mode of cassandra-stress, no paging occurred and the performance difference was not noticeable. This is due to the fact that the predefined mode&#160;generates COMPACT STORAGE tables, which involve a different read path (apparently). I think anyone performing benchmarks for Cassandra changes should be aware that the predefined mode isn&apos;t relevant and that a user defined test should be used (maybe we should create one that would be used as standard benchmark).&#160;&lt;br/&gt;
 Here&apos;s the one I used :&#160;&lt;span class=&quot;nobr&quot;&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12916415/12916415_cassandra-2.2-debug.yaml&quot; title=&quot;cassandra-2.2-debug.yaml attached to CASSANDRA-14318&quot;&gt;cassandra-2.2-debug.yaml&lt;sup&gt;&lt;img class=&quot;rendericon&quot; src=&quot;https://issues.apache.org/jira/images/icons/link_attachment_7.gif&quot; height=&quot;7&quot; width=&quot;7&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/sup&gt;&lt;/a&gt;&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;With the following commands for writing :&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;/usr/bin/cassandra-stress user profile=/home/ec2-user/cassandra-2.2-debug.yaml n=1000000 &apos;ops(insert=1)&apos; cl=LOCAL_ONE no-warmup -node 172.31.31.42 -mode native cql3 compression=lz4 -rate threads=128&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;And for reading :&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;/usr/bin/cassandra-stress user profile=/home/ec2-user/cassandra-2.2-debug.yaml n=1000000 &apos;ops(read_event_1=1,read_event_2=1,read_event_3=4)&apos; cl=LOCAL_ONE no-warmup -node 172.31.31.42 -mode native cql3 compression=lz4 -rate threads=128&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=pauloricardomg&quot; class=&quot;user-hover&quot; rel=&quot;pauloricardomg&quot;&gt;pauloricardomg&lt;/a&gt; : here&apos;s the &lt;a href=&quot;https://github.com/apache/cassandra/compare/cassandra-2.2...thelastpickle:CASSANDRA-14318&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;patch&lt;/a&gt;&#160;if you&apos;re willing to review/commit it, and the unit test results in &lt;a href=&quot;https://circleci.com/gh/thelastpickle/cassandra/178&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;CircleCI&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="16415923" author="adejanovski" created="Tue, 27 Mar 2018 16:57:43 +0000"  >&lt;p&gt;For the record, the same tests on 3.11.2 didn&apos;t show any notable performance difference between debug on and off :&#160;&lt;/p&gt;

&lt;p&gt;Cassandra 3.11.2 debug on : &lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Results:
Op rate : 18&#160;777 op/s [read_event_1: 3&#160;165 op/s, read_event_2: 3&#160;109 op/s, read_event_3: 12&#160;562 op/s]
Partition rate : 6&#160;215 pk/s [read_event_1: 3&#160;165 pk/s, read_event_2: 3&#160;109 pk/s, read_event_3: 0 pk/s]
Row rate : 6&#160;215 row/s [read_event_1: 3&#160;165 row/s, read_event_2: 3&#160;109 row/s, read_event_3: 0 row/s]
Latency mean : 6,7 ms [read_event_1: 6,7 ms, read_event_2: 6,7 ms, read_event_3: 6,6 ms]
Latency median : 5,0 ms [read_event_1: 5,0 ms, read_event_2: 5,0 ms, read_event_3: 4,9 ms]
Latency 95th percentile : 15,6 ms [read_event_1: 15,5 ms, read_event_2: 15,9 ms, read_event_3: 15,5 ms]
Latency 99th percentile : 43,3 ms [read_event_1: 42,7 ms, read_event_2: 44,2 ms, read_event_3: 43,2 ms]
Latency 99.9th percentile : 82,0 ms [read_event_1: 80,3 ms, read_event_2: 82,4 ms, read_event_3: 82,1 ms]
Latency max : 272,4 ms [read_event_1: 272,4 ms, read_event_2: 268,7 ms, read_event_3: 245,1 ms]
Total partitions : 330&#160;970 [read_event_1: 165&#160;386, read_event_2: 165&#160;584, read_event_3: 0]
Total errors : 0 [read_event_1: 0, read_event_2: 0, read_event_3: 0]
Total GC count : 42
Total GC memory : 13,102 GiB
Total GC time : 1,8 seconds
Avg GC time : 42,4 ms
StdDev GC time : 1,3 ms
Total operation time : 00:00:53&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;&lt;/p&gt;


&lt;p&gt;Cassandra 3.11.2 debug off : &lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Results:
Op rate : 18&#160;853 op/s [read_event_1: 3&#160;138 op/s, read_event_2: 3&#160;137 op/s, read_event_3: 12&#160;578 op/s]
Partition rate : 6&#160;275 pk/s [read_event_1: 3&#160;138 pk/s, read_event_2: 3&#160;137 pk/s, read_event_3: 0 pk/s]
Row rate : 6&#160;275 row/s [read_event_1: 3&#160;138 row/s, read_event_2: 3&#160;137 row/s, read_event_3: 0 row/s]
Latency mean : 6,7 ms [read_event_1: 6,7 ms, read_event_2: 6,7 ms, read_event_3: 6,7 ms]
Latency median : 5,0 ms [read_event_1: 5,1 ms, read_event_2: 5,1 ms, read_event_3: 5,0 ms]
Latency 95th percentile : 15,5 ms [read_event_1: 15,5 ms, read_event_2: 15,6 ms, read_event_3: 15,4 ms]
Latency 99th percentile : 39,9 ms [read_event_1: 41,0 ms, read_event_2: 39,6 ms, read_event_3: 39,6 ms]
Latency 99.9th percentile : 73,3 ms [read_event_1: 73,4 ms, read_event_2: 71,6 ms, read_event_3: 73,6 ms]
Latency max : 367,0 ms [read_event_1: 240,5 ms, read_event_2: 250,3 ms, read_event_3: 367,0 ms]
Total partitions : 332&#160;852 [read_event_1: 166&#160;447, read_event_2: 166&#160;405, read_event_3: 0]
Total errors : 0 [read_event_1: 0, read_event_2: 0, read_event_3: 0]
Total GC count : 46
Total GC memory : 14,024 GiB
Total GC time : 2,0 seconds
Avg GC time : 42,7 ms
StdDev GC time : 3,9 ms
Total operation time : 00:00:53&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;The improvement over 2.2 is nice though &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="16420603" author="pauloricardomg" created="Fri, 30 Mar 2018 15:18:23 +0000"  >&lt;blockquote&gt;&lt;p&gt;I think anyone performing benchmarks for Cassandra changes should be aware that the predefined mode isn&apos;t relevant and that a user defined test should be used (maybe we should create one that would be used as standard benchmark).&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Good find! Can you check if this is the case in trunk, and if so maybe open a lhf ticket to change that?&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;For the record, the same tests on 3.11.2 didn&apos;t show any notable performance difference between debug on and off&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Nice to know we managed to handle all debug/verbose log leaks there. It will be easier to maintain this after &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-14326&quot; title=&quot;Handle verbose logging at a different level than DEBUG&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-14326&quot;&gt;CASSANDRA-14326&lt;/a&gt;.&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;here&apos;s the patch if you&apos;re willing to review/commit it, and the unit test results in CircleCI.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Thanks for the patch, experiments and analysis! Even though 2.2 is on critical fixes only mode, 50% is a significant performance hit on throughput for this workload, and since the patch is pretty simple I don&apos;t see a reason not to commit it.&lt;/p&gt;

&lt;p&gt;CI looks good. I added a CHANGES.txt not and committed as &lt;tt&gt;ac77e5e7742548f7c7c25da3923841f59d4b2713&lt;/tt&gt; to cassandra-2.2 branch.&lt;/p&gt;</comment>
                            <comment id="16423964" author="adejanovski" created="Tue, 3 Apr 2018 12:45:59 +0000"  >&lt;p&gt;Thanks for reviewing and merging &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=pauloricardomg&quot; class=&quot;user-hover&quot; rel=&quot;pauloricardomg&quot;&gt;pauloricardomg&lt;/a&gt; !&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-10857&quot; title=&quot;Allow dropping COMPACT STORAGE flag from tables in 3.X&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-10857&quot;&gt;&lt;del&gt;CASSANDRA-10857&lt;/del&gt;&lt;/a&gt;&#160;removed compact storage options in trunk and the standard1&amp;amp;counter1 tables are no longer using it : &lt;a href=&quot;https://github.com/apache/cassandra/commit/07fbd8ee6042797aaade90357d625ba9d79c31e0#diff-e5d5cb263c5c84c322cd09391af46d7dL141&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/cassandra/commit/07fbd8ee6042797aaade90357d625ba9d79c31e0#diff-e5d5cb263c5c84c322cd09391af46d7dL141&lt;/a&gt;&#160;&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310361">
                    <name>Blocked</name>
                                            <outwardlinks description="Blocked">
                                        <issuelink>
            <issuekey id="13146477">CASSANDRA-14326</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12916415" name="cassandra-2.2-debug.yaml" size="1338" author="adejanovski" created="Tue, 27 Mar 2018 16:04:28 +0000"/>
                            <attachment id="12914871" name="debuglogging.png" size="58229" author="adejanovski" created="Fri, 16 Mar 2018 13:55:25 +0000"/>
                            <attachment id="12914868" name="flame22 nodebug sjk svg.png" size="107458" author="adejanovski" created="Fri, 16 Mar 2018 14:05:25 +0000"/>
                            <attachment id="12914867" name="flame22-nodebug-sjk.svg" size="51956" author="adejanovski" created="Fri, 16 Mar 2018 14:05:31 +0000"/>
                            <attachment id="12914870" name="flame22-sjk.svg" size="77634" author="adejanovski" created="Fri, 16 Mar 2018 13:59:57 +0000"/>
                            <attachment id="12914869" name="flame_graph_snapshot.png" size="213171" author="adejanovski" created="Fri, 16 Mar 2018 14:00:33 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>6.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[adejanovski]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 33 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3rem7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12311421" key="com.atlassian.jira.plugin.system.customfieldtypes:multiversion">
                        <customfieldname>Reproduced In</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="12341718">2.2.12</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>pauloricardomg</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[pauloricardomg]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12962"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12311420" key="com.atlassian.jira.plugin.system.customfieldtypes:version">
                        <customfieldname>Since Version</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="12333059">2.2.1</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>