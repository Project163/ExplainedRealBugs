<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 23:01:28 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-11172] Infinite loop bug adding high-level SSTableReader in compaction</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-11172</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;Observed that after a large repair on LCS that sometimes the system will enter an infinite loop with vast amounts of logs lines recording, &quot;Adding high-level (L${LEVEL}) SSTableReader(path=&apos;${TABLE}&apos;) to candidates&quot;&lt;/p&gt;

&lt;p&gt;This results in an outage of the node and eventual crashing. The log spam quickly rotates out possibly useful earlier debugging.&lt;/p&gt;</description>
                <environment>&lt;p&gt;DSE 4.x / Cassandra 2.1.11.969&lt;/p&gt;</environment>
        <key id="12939330">CASSANDRA-11172</key>
            <summary>Infinite loop bug adding high-level SSTableReader in compaction</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10002" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Normal</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="marcuse">Marcus Eriksson</assignee>
                                    <reporter username="autocracy">Jeff Ferland</reporter>
                        <labels>
                            <label>lcs</label>
                    </labels>
                <created>Mon, 15 Feb 2016 17:43:47 +0000</created>
                <updated>Tue, 16 Apr 2019 09:30:42 +0000</updated>
                            <resolved>Tue, 23 Feb 2016 10:18:55 +0000</resolved>
                                        <fixVersion>2.1.14</fixVersion>
                    <fixVersion>2.2.6</fixVersion>
                    <fixVersion>3.0.4</fixVersion>
                    <fixVersion>3.4</fixVersion>
                                    <component>Local/Compaction</component>
                        <due></due>
                            <votes>2</votes>
                                    <watches>13</watches>
                                                                                                                <comments>
                            <comment id="15147693" author="krummas" created="Mon, 15 Feb 2016 18:42:00 +0000"  >&lt;p&gt;could you post logs?&lt;/p&gt;</comment>
                            <comment id="15148988" author="autocracy" created="Tue, 16 Feb 2016 17:55:23 +0000"  >&lt;p&gt;It&apos;s this: `INFO  &lt;span class=&quot;error&quot;&gt;&amp;#91;CompactionExecutor:12750&amp;#93;&lt;/span&gt; 2016-02-16 17:47:48,642  LeveledManifest.java:415 - Adding high-level (L0) SSTableReader(path=&apos;/mnt/cassandra/data/youtube/youtube_videos-2d16275b7ff93269bea0aac894e1abaa/youtube-youtube_videos-ka-104968-Data.db&apos;) to candidates` repeating endlessly. That one&apos;s extra special this time because of the L0. I&apos;ll look in our aggregation server and try to get value from the time when it starts.&lt;/p&gt;</comment>
                            <comment id="15148994" author="autocracy" created="Tue, 16 Feb 2016 18:00:56 +0000"  >&lt;p&gt;Possible duplicate of &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-10831&quot; title=&quot;Fix the way we replace sstables after anticompaction&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-10831&quot;&gt;&lt;del&gt;CASSANDRA-10831&lt;/del&gt;&lt;/a&gt; ?&lt;/p&gt;</comment>
                            <comment id="15149005" author="krummas" created="Tue, 16 Feb 2016 18:12:22 +0000"  >&lt;p&gt;do you run incremental repair?&lt;/p&gt;</comment>
                            <comment id="15149009" author="autocracy" created="Tue, 16 Feb 2016 18:14:54 +0000"  >&lt;p&gt;Yes. It&apos;s after incremental repair that I&apos;m seeing this. Next time around I&apos;ll check that the file listed doesn&apos;t exist before restart, but I think this is a duplicate.&lt;/p&gt;

&lt;p&gt;Alternately, though, I&apos;m also seeing the gossip thread lockup at times after incremental repair without mentioning higher level sstables, so that might be a new ticket to file next time around.&lt;/p&gt;</comment>
                            <comment id="15149188" author="krummas" created="Tue, 16 Feb 2016 19:50:19 +0000"  >&lt;p&gt;you should definitely upgrade&lt;/p&gt;

&lt;p&gt;but I have never seen this happen, but LCS with inc repair was very broken before &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-10831&quot; title=&quot;Fix the way we replace sstables after anticompaction&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-10831&quot;&gt;&lt;del&gt;CASSANDRA-10831&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15149814" author="_wsh" created="Wed, 17 Feb 2016 04:15:17 +0000"  >&lt;p&gt;Seeing this on C* 3.3 after running a full repair on another node. &lt;tt&gt;nodetool repair --full -pr -j 4 my_keyspace_name&lt;/tt&gt; I can provide whatever further details you&apos;d like, obviously.&lt;/p&gt;</comment>
                            <comment id="15149978" author="krummas" created="Wed, 17 Feb 2016 06:27:45 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=_wsh&quot; class=&quot;user-hover&quot; rel=&quot;_wsh&quot;&gt;_wsh&lt;/a&gt; do you have the logs leading up to the breakage? The debug.log would be helpful&lt;/p&gt;

&lt;p&gt;Does it happen every time for this node?&lt;/p&gt;</comment>
                            <comment id="15149983" author="krummas" created="Wed, 17 Feb 2016 06:31:09 +0000"  >&lt;p&gt;greping the logs for ma-3663 would be helpful as well&lt;/p&gt;</comment>
                            <comment id="15150049" author="_wsh" created="Wed, 17 Feb 2016 07:35:57 +0000"  >&lt;p&gt;debug.log? I can go hunt through my compressed files but this quickly pushes the other logs out of rotation. I&apos;ve watched it happen. Thousands upon thousands of lines. And it&apos;s happened for a bunch of different nodes. The solution has been to kill them and restart but it&apos;s temporary.&lt;/p&gt;

&lt;p&gt;I just checked--all 20 zipped system.logs are filled with 40,000+ lines like the ones in my sample file. I was going to upload some to you but they&apos;re just identical, including the earliest lines I have:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;INFO  [CompactionExecutor:35] 2016-02-17 01:59:03,111 LeveledManifest.java:438 - Adding high-level (L0) BigTableReader(path=&apos;/var/lib/cassandra/data/segmentation/domain_events_by_event_domain_time-e81d74f0cd3a11e5aad8e7b84e29e52f/ma-3663-big-Data.db&apos;) to candidates
INFO  [CompactionExecutor:37] 2016-02-17 01:59:03,112 LeveledManifest.java:438 - Adding high-level (L3) BigTableReader(path=&apos;/var/lib/cassandra/data/segmentation/times_by_event_domain_user-e6112a30cd3a11e5ba896547d15a24f6/ma-4586-big-Data.db&apos;) to candidates
INFO  [CompactionExecutor:35] 2016-02-17 01:59:03,276 LeveledManifest.java:438 - Adding high-level (L0) BigTableReader(path=&apos;/var/lib/cassandra/data/segmentation/domain_events_by_event_domain_time-e81d74f0cd3a11e5aad8e7b84e29e52f/ma-3663-big-Data.db&apos;) to candidates
INFO  [CompactionExecutor:37] 2016-02-17 01:59:03,276 LeveledManifest.java:438 - Adding high-level (L3) BigTableReader(path=&apos;/var/lib/cassandra/data/segmentation/times_by_event_domain_user-e6112a30cd3a11e5ba896547d15a24f6/ma-4586-big-Data.db&apos;) to candidates
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="15150082" author="_wsh" created="Wed, 17 Feb 2016 08:07:09 +0000"  >&lt;p&gt;I don&apos;t know if these are worth anything but, in case they are: &lt;tt&gt;nodetool tpstats&lt;/tt&gt; before I shut down the node and both mixed (native) and only-Java thread dumps.&lt;/p&gt;</comment>
                            <comment id="15150140" author="krummas" created="Wed, 17 Feb 2016 08:45:09 +0000"  >&lt;p&gt;The problem is (probably) that we have an sstable in the wrong level in the manifest.&lt;/p&gt;

&lt;p&gt;I have not been able to reproduce this locally but it would make sense (ie, the sstable would not get removed from the manifest and we could end up in an infinite loop), but I think we should see an exception before things explode like this, so it would be really helpful if anyone has logs an hour or so &lt;b&gt;before&lt;/b&gt; this happens&lt;/p&gt;</comment>
                            <comment id="15155763" author="pdehlke" created="Sat, 20 Feb 2016 21:46:01 +0000"  >&lt;p&gt;Just got hit with this today on 2.2.5.&lt;/p&gt;</comment>
                            <comment id="15156720" author="krummas" created="Mon, 22 Feb 2016 10:09:35 +0000"  >&lt;p&gt;Think I found the issue, this happens if you do nodetool repair -full (when replacing repaired sstables there was an assumption that the sstables was unrepaired before, but that is not the case when you do -full repairs)&lt;/p&gt;

&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;branch&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;testall&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;dtest&lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/krummas/cassandra/tree/marcuse/11172&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;marcuse/11172&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/krummas/job/krummas-marcuse-11172-testall&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;testall&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/krummas/job/krummas-marcuse-11172-dtest&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;dtest&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/krummas/cassandra/tree/marcuse/11172-3.0&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;marcuse/11172-3.0&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/krummas/job/krummas-marcuse-11172-3.0-testall&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;testall&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/krummas/job/krummas-marcuse-11172-3.0-dtest&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;dtest&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/krummas/cassandra/tree/marcuse/11172-trunk&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;marcuse/11172-trunk&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/krummas/job/krummas-marcuse-11172-trunk-testall&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;testall&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/krummas/job/krummas-marcuse-11172-trunk-dtest&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;dtest&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;
</comment>
                            <comment id="15156721" author="krummas" created="Mon, 22 Feb 2016 10:11:12 +0000"  >&lt;p&gt;and the problem is not the &quot;Adding high-level ...&quot; - it is the fact that we keep around sstables in the wrong compaction strategy instance..&lt;/p&gt;</comment>
                            <comment id="15157275" author="blambov" created="Mon, 22 Feb 2016 17:01:48 +0000"  >&lt;p&gt;The code looks good, but it needs a regression test.&lt;/p&gt;</comment>
                            <comment id="15157735" author="krummas" created="Mon, 22 Feb 2016 21:40:57 +0000"  >&lt;p&gt;I used &lt;a href=&quot;https://github.com/krummas/cassandra-dtest/commits/marcuse/11172&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;this&lt;/a&gt; to reproduce locally, but I was a bit skeptical to committing as it takes quite a long time to run and the failure case is that it hangs. But I guess it is a good test to run anyway.&lt;/p&gt;</comment>
                            <comment id="15157952" author="kohlisankalp" created="Mon, 22 Feb 2016 23:40:55 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=krummas&quot; class=&quot;user-hover&quot; rel=&quot;krummas&quot;&gt;krummas&lt;/a&gt; Fix version should also include 2.1? &lt;/p&gt;</comment>
                            <comment id="15158081" author="jjirsa" created="Tue, 23 Feb 2016 01:21:47 +0000"  >&lt;p&gt;+1 vote for inclusion in 2.1&lt;/p&gt;</comment>
                            <comment id="15158454" author="krummas" created="Tue, 23 Feb 2016 07:26:45 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=kohlisankalp&quot; class=&quot;user-hover&quot; rel=&quot;kohlisankalp&quot;&gt;kohlisankalp&lt;/a&gt; we have no way of triggering this in 2.1, it only happens if we repair (and anticompact) an already repaired sstable, and we can&apos;t do that in 2.1 - the only way to trigger anticompaction in 2.1 is with &quot;-inc&quot; and then we only include non-repaired sstables. But I guess I can commit it to 2.1 for correctness etc&lt;/p&gt;</comment>
                            <comment id="15158490" author="blambov" created="Tue, 23 Feb 2016 07:48:28 +0000"  >&lt;p&gt;Wouldn&apos;t it also hang with a 10x smaller stress size and &lt;tt&gt;sstable_size_in_mb&lt;/tt&gt;?&lt;/p&gt;</comment>
                            <comment id="15158492" author="krummas" created="Tue, 23 Feb 2016 07:51:52 +0000"  >&lt;p&gt;I will try&lt;/p&gt;</comment>
                            <comment id="15158636" author="krummas" created="Tue, 23 Feb 2016 09:50:06 +0000"  >&lt;p&gt;pushed an updated dtest which finishes in 300s with the patch and never without the patch&lt;/p&gt;</comment>
                            <comment id="15158646" author="blambov" created="Tue, 23 Feb 2016 10:00:19 +0000"  >&lt;p&gt;Thank you, +1 on the patch.&lt;/p&gt;</comment>
                            <comment id="15158666" author="krummas" created="Tue, 23 Feb 2016 10:18:55 +0000"  >&lt;p&gt;Committed, thanks&lt;/p&gt;</comment>
                            <comment id="15168435" author="marco.zattoo" created="Fri, 26 Feb 2016 04:50:36 +0000"  >&lt;p&gt;We are seeing this issue on multiple nodes and it brings down our cassandra cluster. Is there some way to mitigate the issue until 3.4 is out?&lt;/p&gt;</comment>
                            <comment id="15168526" author="krummas" created="Fri, 26 Feb 2016 06:25:39 +0000"  >&lt;p&gt;yes, don&apos;t do &lt;tt&gt;-full&lt;/tt&gt; repairs&lt;/p&gt;</comment>
                            <comment id="15168706" author="marco.zattoo" created="Fri, 26 Feb 2016 09:21:13 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=krummas&quot; class=&quot;user-hover&quot; rel=&quot;krummas&quot;&gt;krummas&lt;/a&gt; Ok I guess that is to prevent it from occurring but we&apos;ve already done this. Is there a way to fix the issue afterwards e.g. would crub&apos;ing the tables bring something?&lt;/p&gt;</comment>
                            <comment id="15168895" author="krummas" created="Fri, 26 Feb 2016 12:29:57 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=marco.zattoo&quot; class=&quot;user-hover&quot; rel=&quot;marco.zattoo&quot;&gt;marco.zattoo&lt;/a&gt; just restart the affected nodes and it is fixed&lt;/p&gt;</comment>
                            <comment id="15168934" author="marco.zattoo" created="Fri, 26 Feb 2016 12:51:52 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=krummas&quot; class=&quot;user-hover&quot; rel=&quot;krummas&quot;&gt;krummas&lt;/a&gt; I&apos;ve restarted nodes many times and the issue just comes up again. Does this mean that it is not related to the fix you&apos;ve done? The issue happens during normal compactions on just restarted node after some time (I think after it tries to do the first compaction) with the result that the system.log starts get spammed with the infinite amount to the messages.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;INFO  [CompactionExecutor:5] 2016-02-26 05:45:56,479 LeveledManifest.java:438 - Adding high-level (L3) BigTableReader(path=&lt;span class=&quot;code-quote&quot;&gt;&apos;/&lt;span class=&quot;code-keyword&quot;&gt;var&lt;/span&gt;/lib/cassandra/data2/ham/raw_sessions-417de7c0bb4711e4972d05e7bd5b0c2f/ma-45159-big-Data.db&apos;&lt;/span&gt;) to candidates
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="15168938" author="marco.zattoo" created="Fri, 26 Feb 2016 12:55:07 +0000"  >&lt;p&gt;Unfortunately I can&apos;t provide any exception trace from before the issue starts because all the 20 zip logs are already full with the log line above. I also started a &lt;tt&gt;nodetool scrub ham raw_sessions&lt;/tt&gt; but I&apos;m wondering whether this will do any good and there is lot&apos;s data so it might take a while until it hits the sstables causing the issue.&lt;/p&gt;</comment>
                            <comment id="15168939" author="krummas" created="Fri, 26 Feb 2016 12:55:19 +0000"  >&lt;p&gt;no, it should fix itself on restart, you sure you are not running repairs at all?&lt;/p&gt;</comment>
                            <comment id="15168954" author="marco.zattoo" created="Fri, 26 Feb 2016 13:09:49 +0000"  >&lt;p&gt;No I didn&apos;t start any repair after restarting the nodes. Actually on one node I just restarted and will try to catch the exception happening in the thread doing the compaction. I hope that helps to figure out the root cause.&lt;/p&gt;</comment>
                            <comment id="15168960" author="marco.zattoo" created="Fri, 26 Feb 2016 13:14:20 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=krummas&quot; class=&quot;user-hover&quot; rel=&quot;krummas&quot;&gt;krummas&lt;/a&gt; I&apos;ve added nodetool tpstats output. Would you like to see some other output from nodetool?&lt;/p&gt;</comment>
                            <comment id="15169049" author="marco.zattoo" created="Fri, 26 Feb 2016 13:58:44 +0000"  >&lt;p&gt;I&apos;ve hit the bug again without doing any repair. Again the logs are so quickly filled with the message that I was unable to get any message prior the LCS message.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;root@cassandra1:/&lt;span class=&quot;code-keyword&quot;&gt;var&lt;/span&gt;/log/cassandra# nodetool compactionstats
pending tasks: 41
- ham.raw_sessions: 41
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="15169058" author="marco.zattoo" created="Fri, 26 Feb 2016 14:08:27 +0000"  >&lt;p&gt;Here is the exception what happens prior the log spamming starts&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;ERROR [CompactionExecutor:5] 2016-02-26 14:05:26,622 CassandraDaemon.java:195 - Exception in thread &lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;[CompactionExecutor:5,1,main]
java.lang.AssertionError: &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;
        at org.apache.cassandra.db.rows.BufferCell.&amp;lt;init&amp;gt;(BufferCell.java:49) ~[apache-cassandra-3.3.0.jar:3.3.0]
        at org.apache.cassandra.db.rows.BufferCell.tombstone(BufferCell.java:88) ~[apache-cassandra-3.3.0.jar:3.3.0]
        at org.apache.cassandra.db.rows.BufferCell.tombstone(BufferCell.java:83) ~[apache-cassandra-3.3.0.jar:3.3.0]
        at org.apache.cassandra.db.rows.BufferCell.purge(BufferCell.java:175) ~[apache-cassandra-3.3.0.jar:3.3.0]
        at org.apache.cassandra.db.rows.ComplexColumnData.lambda$purge$107(ComplexColumnData.java:165) ~[apache-cassandra-3.3.0.jar:3.3.0]
        at org.apache.cassandra.db.rows.ComplexColumnData$$Lambda$126/379481423.apply(Unknown Source) ~[na:na]
        at org.apache.cassandra.utils.btree.BTree$FiltrationTracker.apply(BTree.java:650) ~[apache-cassandra-3.3.0.jar:3.3.0]
        at org.apache.cassandra.utils.btree.BTree.transformAndFilter(BTree.java:693) ~[apache-cassandra-3.3.0.jar:3.3.0]
        at org.apache.cassandra.utils.btree.BTree.transformAndFilter(BTree.java:668) ~[apache-cassandra-3.3.0.jar:3.3.0]
        at org.apache.cassandra.db.rows.ComplexColumnData.transformAndFilter(ComplexColumnData.java:170) ~[apache-cassandra-3.3.0.jar:3.3.0]
        at org.apache.cassandra.db.rows.ComplexColumnData.purge(ComplexColumnData.java:165) ~[apache-cassandra-3.3.0.jar:3.3.0]
        at org.apache.cassandra.db.rows.ComplexColumnData.purge(ComplexColumnData.java:43) ~[apache-cassandra-3.3.0.jar:3.3.0]
        at org.apache.cassandra.db.rows.BTreeRow.lambda$purge$102(BTreeRow.java:333) ~[apache-cassandra-3.3.0.jar:3.3.0]
        at org.apache.cassandra.db.rows.BTreeRow$$Lambda$125/1572342504.apply(Unknown Source) ~[na:na]
        at org.apache.cassandra.utils.btree.BTree$FiltrationTracker.apply(BTree.java:650) ~[apache-cassandra-3.3.0.jar:3.3.0]
        at org.apache.cassandra.utils.btree.BTree.transformAndFilter(BTree.java:693) ~[apache-cassandra-3.3.0.jar:3.3.0]
        at org.apache.cassandra.utils.btree.BTree.transformAndFilter(BTree.java:668) ~[apache-cassandra-3.3.0.jar:3.3.0]
        at org.apache.cassandra.db.rows.BTreeRow.transformAndFilter(BTreeRow.java:338) ~[apache-cassandra-3.3.0.jar:3.3.0]
        at org.apache.cassandra.db.rows.BTreeRow.purge(BTreeRow.java:333) ~[apache-cassandra-3.3.0.jar:3.3.0]
        at org.apache.cassandra.db.partitions.PurgeFunction.applyToRow(PurgeFunction.java:88) ~[apache-cassandra-3.3.0.jar:3.3.0]
        at org.apache.cassandra.db.transform.BaseRows.hasNext(BaseRows.java:116) ~[apache-cassandra-3.3.0.jar:3.3.0]
        at org.apache.cassandra.db.ColumnIndex$Builder.build(ColumnIndex.java:120) ~[apache-cassandra-3.3.0.jar:3.3.0]
        at org.apache.cassandra.db.ColumnIndex.writeAndBuildIndex(ColumnIndex.java:57) ~[apache-cassandra-3.3.0.jar:3.3.0]
        at org.apache.cassandra.io.sstable.format.big.BigTableWriter.append(BigTableWriter.java:153) ~[apache-cassandra-3.3.0.jar:3.3.0]
        at org.apache.cassandra.io.sstable.SSTableRewriter.append(SSTableRewriter.java:118) ~[apache-cassandra-3.3.0.jar:3.3.0]
        at org.apache.cassandra.db.compaction.writers.MaxSSTableSizeWriter.realAppend(MaxSSTableSizeWriter.java:74) ~[apache-cassandra-3.3.0.jar:3.3.0]
        at org.apache.cassandra.db.compaction.writers.CompactionAwareWriter.append(CompactionAwareWriter.java:132) ~[apache-cassandra-3.3.0.jar:3.3.0]
        at org.apache.cassandra.db.compaction.CompactionTask.runMayThrow(CompactionTask.java:182) ~[apache-cassandra-3.3.0.jar:3.3.0]
        at org.apache.cassandra.utils.WrappedRunnable.run(WrappedRunnable.java:28) ~[apache-cassandra-3.3.0.jar:3.3.0]
        at org.apache.cassandra.db.compaction.CompactionTask.executeInternal(CompactionTask.java:78) ~[apache-cassandra-3.3.0.jar:3.3.0]
        at org.apache.cassandra.db.compaction.AbstractCompactionTask.execute(AbstractCompactionTask.java:60) ~[apache-cassandra-3.3.0.jar:3.3.0]
        at org.apache.cassandra.db.compaction.CompactionManager$BackgroundCompactionCandidate.run(CompactionManager.java:264) ~[apache-cassandra-3.3.0.jar:3.3.0]
        at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511) ~[na:1.8.0_45]
        at java.util.concurrent.FutureTask.run(FutureTask.java:266) ~[na:1.8.0_45]
        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1142) ~[na:1.8.0_45]
        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:617) [na:1.8.0_45]
        at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:745) [na:1.8.0_45]
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="15171829" author="krummas" created="Mon, 29 Feb 2016 12:53:13 +0000"  >&lt;p&gt;If that is the cause, then it is another bug (I will have a look)&lt;/p&gt;

&lt;p&gt;Unless you have already fixed this, could you try an offline scrub before you start?&lt;/p&gt;</comment>
                            <comment id="15173441" author="marco.zattoo" created="Tue, 1 Mar 2016 08:25:05 +0000"  >&lt;p&gt;I had to bring the cluster into a healthy state and deleted the whole keyspace which was affected. Node that to me it seemed that the problem somehow spread from first only occurring on one node and then spread to other nodes. Also I guess rate limiting the amount of how many times this log message gets logged would be nice in order to be able to debug issues. &lt;/p&gt;

&lt;p&gt;Since the deletion of the whole keyspace I haven&apos;t seen any issues.&lt;/p&gt;</comment>
                            <comment id="15208474" author="krummas" created="Wed, 23 Mar 2016 14:22:25 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=marco.zattoo&quot; class=&quot;user-hover&quot; rel=&quot;marco.zattoo&quot;&gt;marco.zattoo&lt;/a&gt; I think your problem will be fixed with &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-11373&quot; title=&quot;Cancelled compaction leading to infinite loop in compaction strategy getNextBackgroundTask&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-11373&quot;&gt;&lt;del&gt;CASSANDRA-11373&lt;/del&gt;&lt;/a&gt; - the exception you see will abort the compaction and cause the issues mentioned there&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12788165" name="beep.txt" size="3930040" author="_wsh" created="Wed, 17 Feb 2016 04:15:17 +0000"/>
                            <attachment id="12790125" name="tpstats.txt" size="2621" author="marco.zattoo" created="Fri, 26 Feb 2016 13:15:09 +0000"/>
                            <attachment id="12788190" name="tpstats_compaction.txt" size="2512" author="_wsh" created="Wed, 17 Feb 2016 08:07:09 +0000"/>
                            <attachment id="12788192" name="trapped_in_compaction.txt" size="375953" author="_wsh" created="Wed, 17 Feb 2016 08:07:09 +0000"/>
                            <attachment id="12788191" name="trapped_in_compaction_mixed.txt" size="82655" author="_wsh" created="Wed, 17 Feb 2016 08:07:09 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>5.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[marcuse]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 34 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2sv1j:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12311421" key="com.atlassian.jira.plugin.system.customfieldtypes:multiversion">
                        <customfieldname>Reproduced In</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="12334272">2.2.5</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>blambov</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[blambov]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12962"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>