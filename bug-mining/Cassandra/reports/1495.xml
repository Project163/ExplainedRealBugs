<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 22:29:40 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-3797] StorageProxy static initialization not triggered until thrift requests come in</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-3797</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;While plugging in the metrics library for &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-3671&quot; title=&quot;provide JMX counters for unavailables/timeouts for reads and writes&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-3671&quot;&gt;&lt;del&gt;CASSANDRA-3671&lt;/del&gt;&lt;/a&gt; I realized (because the metrics library was trying to add a shutdown hook on metric creation) that starting cassandra and simply shutting it down, causes StorageProxy to not be initialized until the drain shutdown hook.&lt;/p&gt;

&lt;p&gt;Effects:&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;StorageProxy mbean missing in visualvm/jconsole after initial startup (seriously, I thought I was going nuts &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/wink.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;)&lt;/li&gt;
	&lt;li&gt;And in general anything that makes assumptions about running early, or at least not during JVM shutdown, such as the metrics library, will be problematic&lt;/li&gt;
&lt;/ul&gt;
</description>
                <environment></environment>
        <key id="12540003">CASSANDRA-3797</key>
            <summary>StorageProxy static initialization not triggered until thrift requests come in</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10003" iconUrl="https://issues.apache.org/jira/images/icons/priorities/trivial.svg">Low</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="scode">Peter Schuller</assignee>
                                    <reporter username="scode">Peter Schuller</reporter>
                        <labels>
                    </labels>
                <created>Fri, 27 Jan 2012 06:37:40 +0000</created>
                <updated>Tue, 16 Apr 2019 09:32:41 +0000</updated>
                            <resolved>Wed, 29 Feb 2012 04:36:00 +0000</resolved>
                                        <fixVersion>1.1.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                                                                <comments>
                            <comment id="13194527" author="scode" created="Fri, 27 Jan 2012 07:32:10 +0000"  >&lt;p&gt;Attaching patch that has StorageService call a NOOP method on StorageProxy during start-up if not in client mode.&lt;/p&gt;

&lt;p&gt;This feels unclean to me, but barring a &quot;bigger&quot; change to avoid the subtle static initialization order problem properly it was the easiest/cleanest fix I could think of.&lt;/p&gt;</comment>
                            <comment id="13194531" author="scode" created="Fri, 27 Jan 2012 08:04:34 +0000"  >&lt;p&gt;Maybe a Class.forName() is cleaner (a Class klass = StorageProxy.class does not (necessarily) cause it to be loaded).&lt;/p&gt;</comment>
                            <comment id="13194929" author="jbellis" created="Fri, 27 Jan 2012 17:22:40 +0000"  >&lt;p&gt;Hmm.  Neither this nor the forName approach (attached) is sufficient to o.a.c.service.StorageProxy show up in jconsole for me.&lt;/p&gt;</comment>
                            <comment id="13195011" author="scode" created="Fri, 27 Jan 2012 18:54:11 +0000"  >&lt;p&gt;Really? That&apos;s strange. I just re-tried again to double-check (ant clean and everything) and the patch seems to make a difference here.&lt;/p&gt;

&lt;p&gt;In the case of Class.forName() I cannot believe that is not supposed to be guaranteed. Are you &lt;b&gt;sure&lt;/b&gt; it&apos;s not working? I would have to assume static initialization must by definition happen for Class.forName() to fullfil its contract (even if I could possibly buy slightly more easily that the staticallyInitialize() NOOP didn&apos;t, but even that seems like a stretch).&lt;/p&gt;

&lt;p&gt;I am just building and &lt;tt&gt;./bin/cassandra -f&lt;/tt&gt; and immediately attaching with visualvm.&lt;/p&gt;</comment>
                            <comment id="13217491" author="scode" created="Mon, 27 Feb 2012 20:09:04 +0000"  >&lt;p&gt;Looks like &lt;tt&gt;3797-forname.txt&lt;/tt&gt; is the same file as the original patch. In any case, suppose we just go for Class.forName() to avoid introducing that annoying method, and assuming it makes the metrics from &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-3671&quot; title=&quot;provide JMX counters for unavailables/timeouts for reads and writes&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-3671&quot;&gt;&lt;del&gt;CASSANDRA-3671&lt;/del&gt;&lt;/a&gt; work, can I get a +1?&lt;/p&gt;</comment>
                            <comment id="13217580" author="brandon.williams" created="Mon, 27 Feb 2012 21:30:07 +0000"  >&lt;p&gt;I tested this with &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-3671&quot; title=&quot;provide JMX counters for unavailables/timeouts for reads and writes&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-3671&quot;&gt;&lt;del&gt;CASSANDRA-3671&lt;/del&gt;&lt;/a&gt; and everything worked.&lt;/p&gt;</comment>
                            <comment id="13217590" author="jbellis" created="Mon, 27 Feb 2012 21:42:39 +0000"  >&lt;p&gt;correct forname patch attached.&lt;/p&gt;

&lt;p&gt;figured out my problem from last time: I was looking for StorageProxy under the old location in o.a.c.service, instead of o.a.c.db.  It appears correctly on startup in o.a.c.db with this patch.&lt;/p&gt;</comment>
                            <comment id="13218902" author="scode" created="Wed, 29 Feb 2012 04:36:00 +0000"  >&lt;p&gt;Committed.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12516218" name="3797-forname-this-time-for-sure.txt" size="910" author="jbellis" created="Mon, 27 Feb 2012 21:42:39 +0000"/>
                            <attachment id="12512192" name="3797-forname.txt" size="1419" author="jbellis" created="Fri, 27 Jan 2012 17:22:40 +0000"/>
                            <attachment id="12512088" name="CASSANDRA-3797-trunk-v1.txt" size="1620" author="scode" created="Fri, 27 Jan 2012 07:32:09 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[scode]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>225506</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            13 years, 38 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0gocn:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>95375</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>jbellis</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[jbellis]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12961"><![CDATA[Low]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>