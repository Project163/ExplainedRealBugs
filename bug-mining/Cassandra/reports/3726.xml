<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 22:55:51 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-9606] this query is not supported in new version</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-9606</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;Background:&lt;/p&gt;

&lt;p&gt;1&#12289;create a table:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;CREATE TABLE test (
    a &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;,
    b &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;,
    c &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;,
	d &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;,
    PRIMARY KEY (a, b, c)
);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;2&#12289;query by a=1 and b&amp;lt;6&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;select * from test where a=1 and b&amp;lt;6;

 a | b | c | d
---+---+---+---
 1 | 3 | 1 | 2
 1 | 3 | 2 | 2
 1 | 3 | 4 | 2
 1 | 3 | 5 | 2
 1 | 4 | 4 | 2
 1 | 5 | 5 | 2

(6 rows)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;3&#12289;query by page&lt;br/&gt;
first page&#65306;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;select * from test where a=1 and b&amp;lt;6 limit 2;
 a | b | c | d
---+---+---+---
 1 | 3 | 1 | 2
 1 | 3 | 2 | 2

(2 rows)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;second page&#65306;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;select * from test where a=1 and b&amp;lt;6 and (b,c) &amp;gt; (3,2) limit 2;
 a | b | c | d
---+---+---+---
 1 | 3 | 4 | 2
 1 | 3 | 5 | 2

(2 rows)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;last page&#65306;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;select * from test where a=1 and b&amp;lt;6 and (b,c) &amp;gt; (3,5) limit 2;
 a | b | c | d
---+---+---+---
 1 | 4 | 4 | 2
 1 | 5 | 5 | 2

(2 rows)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;question:&lt;br/&gt;
this query by page is ok when cassandra 2.0.8.&lt;br/&gt;
but is not supported in the latest version 2.1.6&lt;/p&gt;

&lt;p&gt;when execute&#65306;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;select * from test where a=1 and b&amp;lt;6 and (b,c) &amp;gt; (3,2) limit 2;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;get one error message&#65306;&lt;/p&gt;

&lt;p&gt;InvalidRequest: code=2200 &lt;span class=&quot;error&quot;&gt;&amp;#91;Invalid query&amp;#93;&lt;/span&gt; message=&quot;Column &quot;b&quot; cannot have both tuple-notation inequalities and single-column inequalities: (b, c) &amp;gt; (3, 2)&quot;&lt;/p&gt;</description>
                <environment>&lt;p&gt;cassandra 2.1.6&lt;br/&gt;
jdk 1.7.0_55&lt;/p&gt;</environment>
        <key id="12838360">CASSANDRA-9606</key>
            <summary>this query is not supported in new version</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10002" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Normal</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="blerer">Benjamin Lerer</assignee>
                                    <reporter username="zhaoyan">zhaoyan</reporter>
                        <labels>
                    </labels>
                <created>Wed, 17 Jun 2015 01:48:29 +0000</created>
                <updated>Tue, 16 Apr 2019 09:31:07 +0000</updated>
                            <resolved>Mon, 10 Aug 2015 13:17:29 +0000</resolved>
                                                        <component>Legacy/CQL</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="14589723" author="blerer" created="Wed, 17 Jun 2015 12:42:46 +0000"  >&lt;p&gt;The query should be invalid in 2.0. &lt;/p&gt;

&lt;p&gt;Cassandra does not allow multi-column restrictions and single-column restrictions on the same column. What it allow is:&lt;br/&gt;
&lt;tt&gt;select * from test where a=1 and (b)&amp;lt;(6) and (b,c) &amp;gt; (3,2) limit 2;&lt;/tt&gt;. Which will give you exactly what you want.&lt;/p&gt;

&lt;p&gt;Be aware that mixing multi and single column restrictions has only been properly fixed in 2.0.15 and 2.1.5 by &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-8613&quot; title=&quot;Regression in mixed single and multi-column relation support&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-8613&quot;&gt;&lt;del&gt;CASSANDRA-8613&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;If what you want to do is paging, I advise you to check if the latest version of the driver that you use is not supporting manual paging like the java driver: &lt;a href=&quot;http://datastax.github.io/java-driver/2.0.10/features/paging/#manual-paging&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://datastax.github.io/java-driver/2.0.10/features/paging/#manual-paging&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14589727" author="slebresne" created="Wed, 17 Jun 2015 12:46:57 +0000"  >&lt;p&gt;&lt;tt&gt;(b)&amp;lt;(6)&lt;/tt&gt; should be absolutely equivalent &lt;tt&gt;b&amp;lt;6&lt;/tt&gt; or it&apos;s a bug.&lt;/p&gt;</comment>
                            <comment id="14592863" author="zhaoyan" created="Fri, 19 Jun 2015 01:46:56 +0000"  >&lt;p&gt;thanks for your advice&#12290;&lt;/p&gt;

&lt;p&gt;but the paging you advice is in one request.&lt;br/&gt;
i want one request is one page.&lt;/p&gt;</comment>
                            <comment id="14592865" author="zhaoyan" created="Fri, 19 Jun 2015 01:47:52 +0000"  >&lt;p&gt;It confuses me.&lt;/p&gt;</comment>
                            <comment id="14593172" author="blerer" created="Fri, 19 Jun 2015 08:12:24 +0000"  >&lt;p&gt;We discussed it offline with Sylvain and it is clear that it is confusing. I will make them equivalent.&lt;/p&gt;</comment>
                            <comment id="14605246" author="blerer" created="Mon, 29 Jun 2015 08:03:03 +0000"  >&lt;p&gt;The patches allow single-column slice restrictions to be merged with multi-columns slice restrictions.&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;unit tests results for &lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/blerer/job/blerer-9606-testall/lastCompletedBuild/testReport/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;2.0&lt;/a&gt;&lt;/li&gt;
	&lt;li&gt;dtests results for &lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/blerer/job/blerer-9606-dtest/lastCompletedBuild/testReport/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;2.0&lt;/a&gt;&lt;/li&gt;
	&lt;li&gt;unit tests results for &lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/blerer/job/blerer-9606-2.1-testall/lastCompletedBuild/testReport/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;2.1&lt;/a&gt;&lt;/li&gt;
	&lt;li&gt;dtests results for &lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/blerer/job/blerer-9606-2.1-dtest/lastCompletedBuild/testReport/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;2.1&lt;/a&gt;&lt;/li&gt;
	&lt;li&gt;unit tests results for &lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/blerer/job/blerer-9606-2.1-testall/lastCompletedBuild/testReport/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;2.2&lt;/a&gt;&lt;/li&gt;
	&lt;li&gt;dtests results for &lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/blerer/job/blerer-9606-2.2-dtest/lastCompletedBuild/testReport/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;2.2&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="14605555" author="blerer" created="Mon, 29 Jun 2015 12:48:19 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=thobbs&quot; class=&quot;user-hover&quot; rel=&quot;thobbs&quot;&gt;thobbs&lt;/a&gt; could you review?&lt;/p&gt;</comment>
                            <comment id="14648872" author="zhaoyan" created="Fri, 31 Jul 2015 07:33:52 +0000"  >&lt;p&gt;hello~  what&apos;s the Fix Version?&lt;/p&gt;</comment>
                            <comment id="14648884" author="beobal" created="Fri, 31 Jul 2015 07:47:43 +0000"  >&lt;p&gt;Sorry, this is still waiting for review. I&apos;ll try and get to it in the next few days so it will probably make it into the next release on each target branch (2.0.17, 2.1.9, 2.2.1).&lt;/p&gt;</comment>
                            <comment id="14653664" author="beobal" created="Tue, 4 Aug 2015 13:49:27 +0000"  >&lt;p&gt;Sorry this review has taken so long, it fell behind a couple of other tasks in my backlog and then this is a particularly esoteric corner of the code (though thankfully it does get clearer in later branches). I just have a few remarks:&lt;/p&gt;

&lt;p&gt;In all three patches, there are changes to how partition key restrictions are handled; explictly in the 2.0 &amp;amp; 2.1 patches in &lt;tt&gt;SelectStatement#updateRestrictionsForRelation&lt;/tt&gt; and implicitly (I think) in 2.2, but there aren&apos;t any new or updated tests that cover a change in behaviour. Is it possible to add some? &lt;/p&gt;

&lt;p&gt;In the 2.0 and 2.1 patches, &lt;tt&gt;SelectStatement#updateSingleColumnRestriction&lt;/tt&gt; had me scratching my head for a while, maybe a comment on the new check at line 1945/1953 might help clarify what&apos;s going on there.&lt;/p&gt;

&lt;p&gt;Nits (can be fixed on commit)&lt;br/&gt;
In the 2.1 patch, there&apos;s an unused import in &lt;tt&gt;Restriction&lt;/tt&gt; (it isn&apos;t new, but may as well remove it)&lt;br/&gt;
In the 2.2 patch indentation error in &lt;tt&gt;MultiColumnRestriction.Slice&lt;/tt&gt; where the private modifier has been removed&lt;/p&gt;

&lt;p&gt;The merge from 2.2 to trunk after applying the 2.2 patch generates a few conflicts, but they&apos;re reasonably straightforward to resolve so I don&apos;t think there&apos;s any need for a 3.0 specific patch.&lt;/p&gt;</comment>
                            <comment id="14659755" author="blerer" created="Thu, 6 Aug 2015 09:42:52 +0000"  >&lt;p&gt;Thanks for the review.&lt;/p&gt;

&lt;p&gt;The new patch for 2.0 is &lt;a href=&quot;https://github.com/apache/cassandra/compare/trunk...blerer:9606&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;here&lt;/a&gt;&lt;br/&gt;
The new patch for 2.1 is &lt;a href=&quot;https://github.com/apache/cassandra/compare/trunk...blerer:9606-2.1&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;here&lt;/a&gt;&lt;br/&gt;
The new patch for 2.2 is &lt;a href=&quot;https://github.com/apache/cassandra/compare/trunk...blerer:9606-2.2&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;here&lt;/a&gt;&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;In all three patches, there are changes to how partition key restrictions are handled; explictly in the 2.0 &amp;amp; 2.1 patches in SelectStatement#updateRestrictionsForRelation and implicitly (I think) in 2.2, but there aren&apos;t any new or updated tests that cover a change in behaviour. Is it possible to add some? &lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;As slice restrictions and multi-column restrictions are not allowed on partition key columns, I added some tests to make sure that the errors thrown were the good ones.&lt;/p&gt;
</comment>
                            <comment id="14661498" author="beobal" created="Fri, 7 Aug 2015 08:27:32 +0000"  >&lt;p&gt;+1 lgtm&lt;/p&gt;</comment>
                            <comment id="14680090" author="blerer" created="Mon, 10 Aug 2015 13:17:29 +0000"  >&lt;p&gt;commit: c8d163f73cad4cb61c12c6871e26489b52094d17&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12742471" name="9606-2.0.txt" size="19204" author="blerer" created="Mon, 29 Jun 2015 08:03:03 +0000"/>
                            <attachment id="12742472" name="9606-2.1.txt" size="21651" author="blerer" created="Mon, 29 Jun 2015 08:03:03 +0000"/>
                            <attachment id="12742473" name="9606-2.2.txt" size="19240" author="blerer" created="Mon, 29 Jun 2015 08:03:03 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[blerer]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 15 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2g4wv:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>samt</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[samt]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12962"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12311420" key="com.atlassian.jira.plugin.system.customfieldtypes:version">
                        <customfieldname>Since Version</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="12332265">2.1.6</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>