<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 22:22:56 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-3166] Rolling upgrades from 0.7 to 0.8 not possible</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-3166</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;We are in the progress of upgrading to 0.8 and we need to do a rolling upgrade, this fails miserably and it is reproducible;&lt;/p&gt;

&lt;p&gt;1. set up a 3 node cluster with 0.7.9 and rf=3, read and write, QUORUM&lt;br/&gt;
2. upgrade one of the nodes (i upped a seednode, not sure if that is important)&lt;br/&gt;
3. continue reading/writing&lt;br/&gt;
4. see logs on the 0.7 node fill up with: INFO 12:36:08,240 Received connection from newer protocol version. Ignorning message.&lt;/p&gt;


&lt;p&gt;it does work if i start the 0.7.9 nodes &lt;b&gt;after&lt;/b&gt; the 0.8.4 node which makes me think that it matters if it is the 0.8 node connecting to the 0.7 nodes or the other way round.&lt;/p&gt;

&lt;p&gt;Debug logging on the 0.8 node shows:&lt;br/&gt;
/var/log/cassandra/system.log.9:DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;pool-2-thread-82&amp;#93;&lt;/span&gt; 2011-09-09 11:55:06,067 StorageProxy.java (line 178) Write timeout java.util.concurrent.TimeoutException for one (or more) of: &lt;br/&gt;
/var/log/cassandra/system.log.9:DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;pool-2-thread-76&amp;#93;&lt;/span&gt; 2011-09-09 11:55:06,067 StorageProxy.java (line 584) Read timeout: java.util.concurrent.TimeoutException: Operation timed out - received only 1 responses from /193.182.3.92,  .&lt;/p&gt;

&lt;p&gt;nothing except for the &quot;newer protocol version...&quot; in the 0.7-logs&lt;/p&gt;

&lt;p&gt;i will continue to look at this issue but if anyone has a quick patch, let me know&lt;/p&gt;
</description>
                <environment></environment>
        <key id="12522418">CASSANDRA-3166</key>
            <summary>Rolling upgrades from 0.7 to 0.8 not possible</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10002" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Normal</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="marcuse">Marcus Eriksson</reporter>
                        <labels>
                    </labels>
                <created>Fri, 9 Sep 2011 12:45:30 +0000</created>
                <updated>Tue, 16 Apr 2019 09:32:51 +0000</updated>
                            <resolved>Mon, 12 Sep 2011 16:50:06 +0000</resolved>
                                        <fixVersion>0.8.6</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="13101181" author="krummas" created="Fri, 9 Sep 2011 12:48:45 +0000"  >&lt;p&gt;oh, note that it fails all the way to the client as well, timeouts in hector&lt;/p&gt;</comment>
                            <comment id="13101208" author="scode" created="Fri, 9 Sep 2011 13:42:57 +0000"  >&lt;p&gt;Are you seeing any &quot;Version for $IP is $VERSION&quot; output when running in debug mode? IncomingTcpConnection.run() should be logging that.&lt;/p&gt;</comment>
                            <comment id="13101214" author="scode" created="Fri, 9 Sep 2011 13:59:36 +0000"  >&lt;p&gt;Currently suspecting 6eb154ba5616e0df3ce4f11c88dbb1c92d317465 which adds the version reset on disconnection.&lt;/p&gt;</comment>
                            <comment id="13101223" author="scode" created="Fri, 9 Sep 2011 14:09:32 +0000"  >&lt;p&gt;And that commit was due to &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-2818&quot; title=&quot;0.8.0 is unable to participate with nodes using a _newer_ protocol version&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-2818&quot;&gt;&lt;del&gt;CASSANDRA-2818&lt;/del&gt;&lt;/a&gt; and &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-2860&quot; title=&quot;Versioning works *too* well&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-2860&quot;&gt;&lt;del&gt;CASSANDRA-2860&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="13101259" author="scode" created="Fri, 9 Sep 2011 15:04:13 +0000"  >&lt;p&gt;Removing the resetVersion() did not help. I added some logging to IncomingTcpConnection and it seems that when the 0.8 node goes up first, the 0.7 node never tries to make an outgoing connection to it.&lt;/p&gt;

&lt;p&gt;If my understanding is correct, from reading &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-2818&quot; title=&quot;0.8.0 is unable to participate with nodes using a _newer_ protocol version&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-2818&quot;&gt;&lt;del&gt;CASSANDRA-2818&lt;/del&gt;&lt;/a&gt; and looking at the code, I think the intent is that we discover the version of the other guy whenever that guy connects to &lt;b&gt;us&lt;/b&gt;; we can never find out that the other side has a mis-matched version based on activity on the outbound connection.&lt;/p&gt;

&lt;p&gt;So, incoming connections would be a necessity in order for the 0.8 node to ever adjust it&apos;s lingo.&lt;/p&gt;</comment>
                            <comment id="13101264" author="jbellis" created="Fri, 9 Sep 2011 15:10:26 +0000"  >&lt;p&gt;That&apos;s right.  This is why when we do get a message from a newer-version host we make sure to add it to gossiper so we connect back to it.&lt;/p&gt;

&lt;p&gt;Not sure if that fix got applied to 0.7 &amp;#8211; if not, making the 0.8 node a seed should work around it.&lt;/p&gt;</comment>
                            <comment id="13101286" author="scode" created="Fri, 9 Sep 2011 15:46:31 +0000"  >&lt;p&gt;Sorry, epic fail on my part. Removing the version reset does have an effect, and the 0.7 node is in fact connecting. I made a boo-boo involving running from the wrong working copy...&lt;/p&gt;</comment>
                            <comment id="13101327" author="scode" created="Fri, 9 Sep 2011 16:51:46 +0000"  >&lt;p&gt;I&apos;m having difficulty coming up with a clean yet simple fix here. Reverting &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-2860&quot; title=&quot;Versioning works *too* well&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-2860&quot;&gt;&lt;del&gt;CASSANDRA-2860&lt;/del&gt;&lt;/a&gt; certainly fixes this problem, but re-introduces &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-2860&quot; title=&quot;Versioning works *too* well&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-2860&quot;&gt;&lt;del&gt;CASSANDRA-2860&lt;/del&gt;&lt;/a&gt; instead.&lt;/p&gt;

&lt;p&gt;I could imagine an environment variable/config option to disable the support for pretending you are older than you are, which could be used in a second round of rolling restarts after upgrading all nodes of a cluster to 0.8. A JMX tweakable setting would be nice, but upon changing it you&apos;d want to tear down all the TCP connections to re-initiate versioning negotiation so maybe it&apos;s okay to leave it with an extra round of restarts required.&lt;/p&gt;

&lt;p&gt;Alternatively, I think (not tested) things will tend to sort itself out incrementally every time you restart a 0.8 node since it will tend to initiate connections to other nodes immediately, but documenting for users that they need to restart nodes all over the place until everyone seems to have gotten it seems like a poor solution.&lt;/p&gt;

&lt;p&gt;Adding some new kind of message that says &quot;i really am this other version&quot; or similar isn&apos;t clean.&lt;/p&gt;

&lt;p&gt;Am I missing a much simpler and cleaner fix here?&lt;/p&gt;</comment>
                            <comment id="13102254" author="krummas" created="Sun, 11 Sep 2011 09:54:29 +0000"  >&lt;p&gt;Minimal patch attached&lt;/p&gt;

&lt;p&gt;Clear version in IncomingTcpConnection instead since that is the one setting it;&lt;br/&gt;
before we could end up in a state where the outgoing connections got closed, but the incoming one was still up, meaning the version was reset and it was never possible to get the version set again.&lt;/p&gt;

&lt;p&gt;Now it is the IncomingTcpConnections responsibility to keep track of versions, if that one is closed, we are bound to get a new incoming connection and therefor set the version correctly&lt;/p&gt;
</comment>
                            <comment id="13102255" author="krummas" created="Sun, 11 Sep 2011 09:55:33 +0000"  >&lt;p&gt;Make IncomingTcpConnection responsible for version handling&lt;/p&gt;</comment>
                            <comment id="13102257" author="scode" created="Sun, 11 Sep 2011 10:33:57 +0000"  >&lt;p&gt;+1 on my end. That&apos;s a very simple solution that I wasn&apos;t seeing. Can&apos;t figure out a way it will break anything.&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;0.7 &amp;lt;-&amp;gt; 0.7: No version mismatch ever, no reset ever happens. All is well.&lt;/li&gt;
	&lt;li&gt;0.8 &amp;lt;-&amp;gt; 0.8: Same.&lt;/li&gt;
	&lt;li&gt;0.7 &amp;lt;-&amp;gt; 0.8: 0.8 -&amp;gt; 0.7 will be killed (streaming) or retained but messages ignored (messaging). 0.7 -&amp;gt; 0.8 will work, and 0.8 will know the version of 0.7. Future outgoing will use correct version, and the pre-existing messaging connection starts sending messages at a version that isn&apos;t ignored.&lt;/li&gt;
	&lt;li&gt;0.7 node restarted and upgraded to 0.8 talking to 0.8: Both incoming/outgoing go down, so version reset, then equivalent of 0.8 &amp;lt;-&amp;gt; 0.8.&lt;/li&gt;
	&lt;li&gt;0.7 node restarted and upgraded to 0.8 talking to 0.7: Both incoming/outgoing go down, so version reset, then equivalent of 0.7 &amp;lt;-&amp;gt; 0.8.&lt;/li&gt;
&lt;/ul&gt;

</comment>
                            <comment id="13102792" author="brandon.williams" created="Mon, 12 Sep 2011 16:50:06 +0000"  >&lt;p&gt;Committed, with minor changes: logs pushed to debug, if logic around logging removed since interpolation of {} automatically does that.&lt;/p&gt;</comment>
                            <comment id="13102845" author="hudson" created="Mon, 12 Sep 2011 17:48:01 +0000"  >&lt;p&gt;Integrated in Cassandra-0.8 #322 (See &lt;a href=&quot;https://builds.apache.org/job/Cassandra-0.8/322/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/Cassandra-0.8/322/&lt;/a&gt;)&lt;br/&gt;
    Make IncomingTcpConnection responsible for version handling.&lt;br/&gt;
Patch by Marcus Erikkson, reviewed by Peter Schuller and brandonwilliams&lt;br/&gt;
for &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-3166&quot; title=&quot;Rolling upgrades from 0.7 to 0.8 not possible&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-3166&quot;&gt;&lt;del&gt;CASSANDRA-3166&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;brandonwilliams : &lt;a href=&quot;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1169823&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1169823&lt;/a&gt;&lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/cassandra/branches/cassandra-0.8/src/java/org/apache/cassandra/gms/Gossiper.java&lt;/li&gt;
	&lt;li&gt;/cassandra/branches/cassandra-0.8/src/java/org/apache/cassandra/net/IncomingTcpConnection.java&lt;/li&gt;
	&lt;li&gt;/cassandra/branches/cassandra-0.8/src/java/org/apache/cassandra/net/OutboundTcpConnection.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12512897">CASSANDRA-2860</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12733119">CASSANDRA-7734</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12493952" name="3166.txt" size="2057" author="marcuse" created="Sun, 11 Sep 2011 09:55:33 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>4048</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            14 years, 11 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0gglz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>94121</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>brandon.williams</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[brandon.williams]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12962"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>