<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 22:51:16 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-8832] SSTableRewriter.abort() should be more robust to failure</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-8832</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;This fixes a bug introduced in &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-8124&quot; title=&quot;Stopping a node during compaction can make already written files stay around&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-8124&quot;&gt;&lt;del&gt;CASSANDRA-8124&lt;/del&gt;&lt;/a&gt; that attempts to open early during abort, introducing a failure risk. This patch further preempts &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-8690&quot; title=&quot;Ensure all error handling code that may itself throw an exception utilises addSuppressed&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-8690&quot;&gt;&lt;del&gt;CASSANDRA-8690&lt;/del&gt;&lt;/a&gt; to wrap every rollback action in a try/catch block, so that any internal assertion checks do not actually worsen the state.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12776122">CASSANDRA-8832</key>
            <summary>SSTableRewriter.abort() should be more robust to failure</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10002" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Normal</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="benedict">Benedict Elliott Smith</assignee>
                                    <reporter username="benedict">Benedict Elliott Smith</reporter>
                        <labels>
                    </labels>
                <created>Thu, 19 Feb 2015 10:38:14 +0000</created>
                <updated>Tue, 16 Apr 2019 09:31:20 +0000</updated>
                            <resolved>Wed, 4 Mar 2015 15:19:42 +0000</resolved>
                                        <fixVersion>2.1.5</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="14327235" author="benedict" created="Thu, 19 Feb 2015 10:41:06 +0000"  >&lt;p&gt;Patch available &lt;a href=&quot;https://github.com/belliottsmith/cassandra/tree/8832&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;here&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14327270" author="benedict" created="Thu, 19 Feb 2015 11:23:59 +0000"  >&lt;p&gt;It looks like I already tried to address this in the whirlwind of recent updates (see &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-8699&quot; title=&quot;SSTableRewriter.abort() can throw an exception when closing the open writer&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-8699&quot;&gt;&lt;del&gt;CASSANDRA-8699&lt;/del&gt;&lt;/a&gt; and &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-7705&quot; title=&quot;Safer Resource Management&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-7705&quot;&gt;&lt;del&gt;CASSANDRA-7705&lt;/del&gt;&lt;/a&gt;), but an incorrect version of the fix went in (or the final version got lost somewhere). Not sure exactly.&lt;/p&gt;</comment>
                            <comment id="14329877" author="aboudreault" created="Sat, 21 Feb 2015 01:02:44 +0000"  >&lt;p&gt;With latest branch cassandra-2.1, I was getting this error:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;Aborted cleaning up atleast one column family in keyspace r1, check server logs &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; more information.
...
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I confirm that this patch fixes my issue. Thanks!&lt;/p&gt;</comment>
                            <comment id="14345460" author="blambov" created="Tue, 3 Mar 2015 18:33:52 +0000"  >&lt;p&gt;AFAICS the actual fix for the problem was committed &lt;a href=&quot;https://github.com/apache/cassandra/commit/c75ee4160cb8fcdf47c90bfce8bf0d861f32d268#diff-426d04d201a410848604b55984d1b370R291&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;as part of 7705&lt;/a&gt; and this patch only adds continued processing after exceptions. Can you confirm this?&lt;/p&gt;

&lt;p&gt;A couple of comments on the patch:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;&lt;tt&gt;replaceWithFinishedReaders&lt;/tt&gt; can also throw (e.g. due to a reference counting bug), hiding any earlier errors. It should also be wrapped in a try/merge block.&lt;/li&gt;
	&lt;li&gt;The static &lt;tt&gt;merge&lt;/tt&gt; of throwables will probably be needed in many other places. Could we move it to a more generic location?&lt;/li&gt;
	&lt;li&gt;Is it possible to include a regression test for the bug?&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="14345648" author="benedict" created="Tue, 3 Mar 2015 20:09:09 +0000"  >&lt;blockquote&gt;&lt;p&gt;AFAICS the actual fix for the problem was committed as part of 7705 and this patch only adds continued processing after exceptions. Can you confirm this?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Regrettably, no. This was broken &lt;em&gt;by&lt;/em&gt; 7705 unfortunately. I&apos;ve included a regression that demonstrates the problem. In the event that currentlyOpenedEarly != null, and we abort, we do not close (or unmark compacting) the early opened file.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;replaceWithFinishedReaders can also throw (e.g. due to a reference counting bug), hiding any earlier errors. It should also be wrapped in a try/merge block.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I wasn&apos;t too sure about this when I wrote it, since it both shouldn&apos;t fail in the same way (has to be programmer error rather than other problems), and it itself leaves the program in a problematic state if it doesn&apos;t complete successfully. A lot of code paths need reworking to be resilient to this, and I didn&apos;t want to scope creep. However since you raise it, I&apos;ve opted to fix this latter problem and also wrap it in its own try/catch as you suggest.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;The static merge of throwables will probably be needed in many other places. Could we move it to a more generic location?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Again, I was torn on writing it since I can&apos;t think of a good place to group it. I&apos;ve created our own Throwables utility class, which contains only this for now. If you have a better idea for where to put it, pipe up.&lt;/p&gt;
</comment>
                            <comment id="14346832" author="blambov" created="Wed, 4 Mar 2015 12:33:16 +0000"  >&lt;p&gt;Thank you. I see the updated test, but I&apos;m not seeing the other two changes. Can you let me know when you have uploaded them so I can +1 the patch?&lt;/p&gt;</comment>
                            <comment id="14346837" author="benedict" created="Wed, 4 Mar 2015 12:38:08 +0000"  >&lt;p&gt;Apparently I didn&apos;t push the last changes. They&apos;re up now.&lt;/p&gt;</comment>
                            <comment id="14346841" author="blambov" created="Wed, 4 Mar 2015 12:43:57 +0000"  >&lt;p&gt;+1&lt;/p&gt;</comment>
                            <comment id="14347010" author="benedict" created="Wed, 4 Mar 2015 15:19:42 +0000"  >&lt;p&gt;Committed&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310050">
                    <name>Regression</name>
                                                                <inwardlinks description="is broken by">
                                        <issuelink>
            <issuekey id="12703231">CASSANDRA-6916</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[benedict]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 37 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i25sxj:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>blambov</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[blambov]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12962"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311124" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Tester</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>aboudreault</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>