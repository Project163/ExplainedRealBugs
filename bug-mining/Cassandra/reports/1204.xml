<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 22:24:21 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-2863] NPE when writing SSTable generated via repair</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-2863</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;A NPE is generated during repair when closing an sstable generated via SSTable build. It doesn&apos;t happen always. The node had been scrubbed and compacted before calling repair.&lt;/p&gt;

&lt;p&gt; INFO &lt;span class=&quot;error&quot;&gt;&amp;#91;CompactionExecutor:2&amp;#93;&lt;/span&gt; 2011-07-06 11:11:32,640 SSTableReader.java (line 158) Opening /d2/cassandra/data/sbs/walf-g-730&lt;br/&gt;
ERROR &lt;span class=&quot;error&quot;&gt;&amp;#91;CompactionExecutor:2&amp;#93;&lt;/span&gt; 2011-07-06 11:11:34,327 AbstractCassandraDaemon.java (line 113) Fatal exception in thread Thread&lt;span class=&quot;error&quot;&gt;&amp;#91;CompactionExecutor:2,1,main&amp;#93;&lt;/span&gt; &lt;br/&gt;
java.lang.NullPointerException&lt;br/&gt;
	at org.apache.cassandra.io.sstable.SSTableWriter$RowIndexer.close(SSTableWriter.java:382)&lt;br/&gt;
	at org.apache.cassandra.io.sstable.SSTableWriter$RowIndexer.index(SSTableWriter.java:370)&lt;br/&gt;
	at org.apache.cassandra.io.sstable.SSTableWriter$Builder.build(SSTableWriter.java:315)&lt;br/&gt;
	at org.apache.cassandra.db.compaction.CompactionManager$9.call(CompactionManager.java:1103)&lt;br/&gt;
	at org.apache.cassandra.db.compaction.CompactionManager$9.call(CompactionManager.java:1094)&lt;br/&gt;
	at java.util.concurrent.FutureTask$Sync.innerRun(FutureTask.java:303)&lt;br/&gt;
	at java.util.concurrent.FutureTask.run(FutureTask.java:138)&lt;br/&gt;
	at java.util.concurrent.ThreadPoolExecutor$Worker.runTask(ThreadPoolExecutor.java:886)&lt;br/&gt;
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:908)&lt;br/&gt;
	at java.lang.Thread.run(Thread.java:662)&lt;/p&gt;</description>
                <environment></environment>
        <key id="12512969">CASSANDRA-2863</key>
            <summary>NPE when writing SSTable generated via repair</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10002" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Normal</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="slebresne">Sylvain Lebresne</assignee>
                                    <reporter username="hector">H&#233;ctor Izquierdo</reporter>
                        <labels>
                    </labels>
                <created>Wed, 6 Jul 2011 11:32:18 +0000</created>
                <updated>Tue, 16 Apr 2019 09:32:56 +0000</updated>
                            <resolved>Mon, 10 Oct 2011 13:58:31 +0000</resolved>
                                        <fixVersion>0.8.8</fixVersion>
                                        <due></due>
                            <votes>1</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="13062191" author="hector" created="Fri, 8 Jul 2011 21:22:52 +0000"  >&lt;p&gt;I don&apos;t now if it&apos;s the same one, buy I got another during repair on another node:&lt;/p&gt;

&lt;p&gt;ERROR &lt;span class=&quot;error&quot;&gt;&amp;#91;Thread-1710&amp;#93;&lt;/span&gt; 2011-07-08 21:21:00,514 AbstractCassandraDaemon.java (line 113) Fatal exception in thread Thread&lt;span class=&quot;error&quot;&gt;&amp;#91;Thread-1710,5,main&amp;#93;&lt;/span&gt;&lt;br/&gt;
java.lang.RuntimeException: java.util.concurrent.ExecutionException: java.lang.NullPointerException&lt;br/&gt;
	at org.apache.cassandra.streaming.StreamInSession.closeIfFinished(StreamInSession.java:154)&lt;br/&gt;
	at org.apache.cassandra.streaming.IncomingStreamReader.read(IncomingStreamReader.java:63)&lt;br/&gt;
	at org.apache.cassandra.net.IncomingTcpConnection.stream(IncomingTcpConnection.java:162)&lt;br/&gt;
	at org.apache.cassandra.net.IncomingTcpConnection.run(IncomingTcpConnection.java:95)&lt;br/&gt;
Caused by: java.util.concurrent.ExecutionException: java.lang.NullPointerException&lt;br/&gt;
	at java.util.concurrent.FutureTask$Sync.innerGet(FutureTask.java:222)&lt;br/&gt;
	at java.util.concurrent.FutureTask.get(FutureTask.java:83)&lt;br/&gt;
	at org.apache.cassandra.streaming.StreamInSession.closeIfFinished(StreamInSession.java:138)&lt;br/&gt;
	... 3 more&lt;br/&gt;
Caused by: java.lang.NullPointerException&lt;br/&gt;
	at org.apache.cassandra.io.sstable.SSTableWriter$RowIndexer.close(SSTableWriter.java:382)&lt;br/&gt;
	at org.apache.cassandra.io.sstable.SSTableWriter$RowIndexer.index(SSTableWriter.java:370)&lt;br/&gt;
	at org.apache.cassandra.io.sstable.SSTableWriter$Builder.build(SSTableWriter.java:315)&lt;br/&gt;
	at org.apache.cassandra.db.compaction.CompactionManager$9.call(CompactionManager.java:1103)&lt;br/&gt;
	at org.apache.cassandra.db.compaction.CompactionManager$9.call(CompactionManager.java:1094)&lt;br/&gt;
	at java.util.concurrent.FutureTask$Sync.innerRun(FutureTask.java:303)&lt;br/&gt;
	at java.util.concurrent.FutureTask.run(FutureTask.java:138)&lt;br/&gt;
	at java.util.concurrent.ThreadPoolExecutor$Worker.runTask(ThreadPoolExecutor.java:886)&lt;br/&gt;
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:908)&lt;br/&gt;
	at java.lang.Thread.run(Thread.java:662)&lt;/p&gt;</comment>
                            <comment id="13068951" author="slebresne" created="Thu, 21 Jul 2011 12:28:09 +0000"  >&lt;p&gt;I&apos;m a little bit baffled by that one. Trusting the stack trace, apparently when SSTW.RowIndexer.close() is called, the iwriter field is null. But iwriter is set in prepareIndexing() that is called the line before index() in SSTW.Builder. Thus if an exception happens in prepareIndexing, we shouldn&apos;t arrive to the index() method (which is the one triggering the close()). And looking at the use of iwriter, no other line set it (so it can&apos;t be set back to null after prepareIndexing()).&lt;/p&gt;

&lt;p&gt;So I mean we can add a &lt;tt&gt;if (iwriter != null)&lt;/tt&gt; before calling the close, but the truth is I have no clue how it could ever be null at that point.&lt;/p&gt;

&lt;p&gt;H&#233;ctor: are you positive that you are using stock 0.8.1 ?&lt;/p&gt;</comment>
                            <comment id="13068956" author="hector.izquierdo" created="Thu, 21 Jul 2011 12:35:30 +0000"  >&lt;p&gt;I have a patch from &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-2818&quot; title=&quot;0.8.0 is unable to participate with nodes using a _newer_ protocol version&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-2818&quot;&gt;&lt;del&gt;CASSANDRA-2818&lt;/del&gt;&lt;/a&gt; (2818-v4) applied, if that&apos;s of any help. The patch only touches messaging classes though.&lt;/p&gt;</comment>
                            <comment id="13069178" author="jbellis" created="Thu, 21 Jul 2011 20:13:00 +0000"  >&lt;p&gt;Doesn&apos;t make any sense to me, either.  The only place close() is called is from index() &lt;span class=&quot;error&quot;&gt;&amp;#91;as seen in the stacktrace here&amp;#93;&lt;/span&gt; and the only place index() is called is after prepareIndexing, which sets iwriter to non-null:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;            &lt;span class=&quot;code-object&quot;&gt;long&lt;/span&gt; estimatedRows = indexer.prepareIndexing();

            &lt;span class=&quot;code-comment&quot;&gt;// build the index and filter
&lt;/span&gt;            &lt;span class=&quot;code-object&quot;&gt;long&lt;/span&gt; rows = indexer.index();
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="13109079" author="cce" created="Tue, 20 Sep 2011 23:19:45 +0000"  >&lt;p&gt;I just got a similar-looking NPE stack trace.  The node that raised the exception was receiving streams from a node being decommissioned (with &quot;nodetool decommission&quot;).  Both nodes were running 0.8.6; both had been upgraded a few hours earlier from 0.8.4.&lt;/p&gt;

&lt;p&gt;The first:  &lt;/p&gt;

&lt;p&gt;ERROR &lt;span class=&quot;error&quot;&gt;&amp;#91;CompactionExecutor:72&amp;#93;&lt;/span&gt; 2011-09-20 22:34:20,892 AbstractCassandraDaemon.java (line 139) Fatal exception in thread Thread&lt;span class=&quot;error&quot;&gt;&amp;#91;CompactionExecutor:72,1,main&amp;#93;&lt;/span&gt;&lt;br/&gt;
java.lang.NullPointerException&lt;br/&gt;
        at org.apache.cassandra.io.sstable.SSTableWriter$RowIndexer.close(SSTableWriter.java:382)&lt;br/&gt;
        at org.apache.cassandra.io.sstable.SSTableWriter$RowIndexer.index(SSTableWriter.java:370)&lt;br/&gt;
        at org.apache.cassandra.io.sstable.SSTableWriter$Builder.build(SSTableWriter.java:315)&lt;br/&gt;
        at org.apache.cassandra.db.compaction.CompactionManager$9.call(CompactionManager.java:1108)&lt;br/&gt;
        at org.apache.cassandra.db.compaction.CompactionManager$9.call(CompactionManager.java:1099)&lt;br/&gt;
        at java.util.concurrent.FutureTask$Sync.innerRun(FutureTask.java:303)&lt;br/&gt;
        at java.util.concurrent.FutureTask.run(FutureTask.java:138)&lt;br/&gt;
        at java.util.concurrent.ThreadPoolExecutor$Worker.runTask(ThreadPoolExecutor.java:886)&lt;br/&gt;
        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:908)&lt;br/&gt;
        at java.lang.Thread.run(Thread.java:662)&lt;/p&gt;

&lt;p&gt;Then half a minute later:&lt;/p&gt;

&lt;p&gt; INFO &lt;span class=&quot;error&quot;&gt;&amp;#91;CompactionExecutor:72&amp;#93;&lt;/span&gt; 2011-09-20 22:34:46,923 SSTableReader.java (line 162) Opening /mnt/cassandra/data/Keyspace/CF1-g-1536&lt;br/&gt;
ERROR &lt;span class=&quot;error&quot;&gt;&amp;#91;Thread-785&amp;#93;&lt;/span&gt; 2011-09-20 22:34:52,054 AbstractCassandraDaemon.java (line 139) Fatal exception in thread Thread&lt;span class=&quot;error&quot;&gt;&amp;#91;Thread-785,5,main&amp;#93;&lt;/span&gt;&lt;br/&gt;
java.lang.RuntimeException: java.util.concurrent.ExecutionException: java.lang.NullPointerException&lt;br/&gt;
        at org.apache.cassandra.streaming.StreamInSession.closeIfFinished(StreamInSession.java:154)&lt;br/&gt;
        at org.apache.cassandra.streaming.IncomingStreamReader.read(IncomingStreamReader.java:63)&lt;br/&gt;
        at org.apache.cassandra.net.IncomingTcpConnection.stream(IncomingTcpConnection.java:189)&lt;br/&gt;
        at org.apache.cassandra.net.IncomingTcpConnection.run(IncomingTcpConnection.java:117)&lt;br/&gt;
Caused by: java.util.concurrent.ExecutionException: java.lang.NullPointerException&lt;br/&gt;
        at java.util.concurrent.FutureTask$Sync.innerGet(FutureTask.java:222)&lt;br/&gt;
        at java.util.concurrent.FutureTask.get(FutureTask.java:83)&lt;br/&gt;
        at org.apache.cassandra.streaming.StreamInSession.closeIfFinished(StreamInSession.java:138)&lt;br/&gt;
        ... 3 more&lt;br/&gt;
Caused by: java.lang.NullPointerException&lt;br/&gt;
        at org.apache.cassandra.io.sstable.SSTableWriter$RowIndexer.close(SSTableWriter.java:382)&lt;br/&gt;
        at org.apache.cassandra.io.sstable.SSTableWriter$RowIndexer.index(SSTableWriter.java:370)&lt;br/&gt;
        at org.apache.cassandra.io.sstable.SSTableWriter$Builder.build(SSTableWriter.java:315)&lt;br/&gt;
        at org.apache.cassandra.db.compaction.CompactionManager$9.call(CompactionManager.java:1108)&lt;br/&gt;
        at org.apache.cassandra.db.compaction.CompactionManager$9.call(CompactionManager.java:1099)&lt;br/&gt;
        at java.util.concurrent.FutureTask$Sync.innerRun(FutureTask.java:303)&lt;br/&gt;
        at java.util.concurrent.FutureTask.run(FutureTask.java:138)&lt;br/&gt;
        at java.util.concurrent.ThreadPoolExecutor$Worker.runTask(ThreadPoolExecutor.java:886)&lt;br/&gt;
        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:908)&lt;br/&gt;
        at java.lang.Thread.run(Thread.java:662)&lt;/p&gt;</comment>
                            <comment id="13109550" author="cce" created="Wed, 21 Sep 2011 14:58:23 +0000"  >&lt;p&gt;So I restarted the node making the NPE above and ran the decommission again (on the other node) and it successfully finished decommissioning.  A few hours later I tried to decommission another node and received this error, on a separate node from the two mentioned before, which is a new node running 0.8.6 for just about a day now.&lt;/p&gt;

&lt;p&gt;INFO &lt;span class=&quot;error&quot;&gt;&amp;#91;COMMIT-LOG-WRITER&amp;#93;&lt;/span&gt; 2011-09-21 05:12:46,361 CommitLogSegment.java (line 58) Creating new commitlog segment /raid0/cassandra/commitlog/CommitLog-1316581966361.log&lt;br/&gt;
ERROR &lt;span class=&quot;error&quot;&gt;&amp;#91;Thread-224&amp;#93;&lt;/span&gt; 2011-09-21 05:12:52,738 AbstractCassandraDaemon.java (line 139) Fatal exception in thread Thread&lt;span class=&quot;error&quot;&gt;&amp;#91;Thread-224,5,main&amp;#93;&lt;/span&gt;&lt;br/&gt;
java.lang.RuntimeException: java.util.concurrent.ExecutionException: java.lang.NullPointerException&lt;br/&gt;
        at org.apache.cassandra.streaming.StreamInSession.closeIfFinished(StreamInSession.java:154)&lt;br/&gt;
        at org.apache.cassandra.streaming.IncomingStreamReader.read(IncomingStreamReader.java:63)&lt;br/&gt;
        at org.apache.cassandra.net.IncomingTcpConnection.stream(IncomingTcpConnection.java:189)&lt;br/&gt;
        at org.apache.cassandra.net.IncomingTcpConnection.run(IncomingTcpConnection.java:117)&lt;br/&gt;
Caused by: java.util.concurrent.ExecutionException: java.lang.NullPointerException&lt;br/&gt;
        at java.util.concurrent.FutureTask$Sync.innerGet(FutureTask.java:222)&lt;br/&gt;
        at java.util.concurrent.FutureTask.get(FutureTask.java:83)&lt;br/&gt;
        at org.apache.cassandra.streaming.StreamInSession.closeIfFinished(StreamInSession.java:138)&lt;br/&gt;
        ... 3 more&lt;br/&gt;
Caused by: java.lang.NullPointerException&lt;br/&gt;
        at org.apache.cassandra.io.sstable.SSTableWriter$RowIndexer.close(SSTableWriter.java:382)&lt;br/&gt;
        at org.apache.cassandra.io.sstable.SSTableWriter$RowIndexer.index(SSTableWriter.java:370)&lt;br/&gt;
        at org.apache.cassandra.io.sstable.SSTableWriter$Builder.build(SSTableWriter.java:315)&lt;br/&gt;
        at org.apache.cassandra.db.compaction.CompactionManager$9.call(CompactionManager.java:1108)&lt;br/&gt;
        at org.apache.cassandra.db.compaction.CompactionManager$9.call(CompactionManager.java:1099)&lt;br/&gt;
        at java.util.concurrent.FutureTask$Sync.innerRun(FutureTask.java:303)&lt;br/&gt;
        at java.util.concurrent.FutureTask.run(FutureTask.java:138)&lt;br/&gt;
        at java.util.concurrent.ThreadPoolExecutor$Worker.runTask(ThreadPoolExecutor.java:886)&lt;br/&gt;
        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:908)&lt;br/&gt;
        at java.lang.Thread.run(Thread.java:662)&lt;/p&gt;</comment>
                            <comment id="13113501" author="cce" created="Fri, 23 Sep 2011 15:17:58 +0000"  >&lt;p&gt;Since my last two comments, I increased my RF and started a rolling repair on my nodes.  This has caused this NPE to pop up on all the boxes over the last couple of days as they process SSTables.  Again, all the nodes are fresh 0.8.6 installs from a few days ago using the ComboAMI.  I&apos;ve seen backtraces like the one below appear at least a couple of times on each node in my cluster as I was repairing..&lt;/p&gt;

&lt;p&gt; INFO &lt;span class=&quot;error&quot;&gt;&amp;#91;CompactionExecutor:648&amp;#93;&lt;/span&gt; 2011-09-22 04:35:51,086 SSTableReader.java (line 162) Opening /raid0/cassandra/data/Keyspace/CF1-g-535&lt;br/&gt;
 INFO &lt;span class=&quot;error&quot;&gt;&amp;#91;CompactionExecutor:648&amp;#93;&lt;/span&gt; 2011-09-22 04:35:51,172 SSTableReader.java (line 162) Opening /raid0/cassandra/data/Keyspace/CF2-g-350&lt;br/&gt;
 INFO &lt;span class=&quot;error&quot;&gt;&amp;#91;CompactionExecutor:648&amp;#93;&lt;/span&gt; 2011-09-22 04:36:01,721 SSTableReader.java (line 162) Opening /raid0/cassandra/data/Keyspace/CF3-g-456&lt;br/&gt;
ERROR &lt;span class=&quot;error&quot;&gt;&amp;#91;Thread-3658&amp;#93;&lt;/span&gt; 2011-09-22 04:36:04,821 AbstractCassandraDaemon.java (line 139) Fatal exception in thread Thread&lt;span class=&quot;error&quot;&gt;&amp;#91;Thread-3658,5,main&amp;#93;&lt;/span&gt;&lt;br/&gt;
java.lang.RuntimeException: java.util.concurrent.ExecutionException: java.lang.NullPointerException&lt;br/&gt;
        at org.apache.cassandra.streaming.StreamInSession.closeIfFinished(StreamInSession.java:154)&lt;br/&gt;
        at org.apache.cassandra.streaming.IncomingStreamReader.read(IncomingStreamReader.java:63)&lt;br/&gt;
        at org.apache.cassandra.net.IncomingTcpConnection.stream(IncomingTcpConnection.java:189)&lt;br/&gt;
        at org.apache.cassandra.net.IncomingTcpConnection.run(IncomingTcpConnection.java:117)&lt;br/&gt;
Caused by: java.util.concurrent.ExecutionException: java.lang.NullPointerException&lt;br/&gt;
        at java.util.concurrent.FutureTask$Sync.innerGet(FutureTask.java:222)&lt;br/&gt;
        at java.util.concurrent.FutureTask.get(FutureTask.java:83)&lt;br/&gt;
        at org.apache.cassandra.streaming.StreamInSession.closeIfFinished(StreamInSession.java:138)&lt;br/&gt;
        ... 3 more&lt;br/&gt;
Caused by: java.lang.NullPointerException&lt;br/&gt;
        at org.apache.cassandra.io.sstable.SSTableWriter$RowIndexer.close(SSTableWriter.java:382)&lt;br/&gt;
        at org.apache.cassandra.io.sstable.SSTableWriter$RowIndexer.index(SSTableWriter.java:370)&lt;br/&gt;
        at org.apache.cassandra.io.sstable.SSTableWriter$Builder.build(SSTableWriter.java:315)&lt;br/&gt;
        at org.apache.cassandra.db.compaction.CompactionManager$9.call(CompactionManager.java:1108)&lt;br/&gt;
        at org.apache.cassandra.db.compaction.CompactionManager$9.call(CompactionManager.java:1099)&lt;br/&gt;
        at java.util.concurrent.FutureTask$Sync.innerRun(FutureTask.java:303)&lt;br/&gt;
        at java.util.concurrent.FutureTask.run(FutureTask.java:138)&lt;br/&gt;
        at java.util.concurrent.ThreadPoolExecutor$Worker.runTask(ThreadPoolExecutor.java:886)&lt;br/&gt;
        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:908)&lt;br/&gt;
        at java.lang.Thread.run(Thread.java:662)&lt;br/&gt;
ERROR &lt;span class=&quot;error&quot;&gt;&amp;#91;CompactionExecutor:648&amp;#93;&lt;/span&gt; 2011-09-22 04:36:04,823 AbstractCassandraDaemon.java (line 139) Fatal exception in thread Thread&lt;span class=&quot;error&quot;&gt;&amp;#91;CompactionExecutor:648,1,main&amp;#93;&lt;/span&gt;&lt;br/&gt;
java.lang.NullPointerException&lt;br/&gt;
        at org.apache.cassandra.io.sstable.SSTableWriter$RowIndexer.close(SSTableWriter.java:382)&lt;br/&gt;
        at org.apache.cassandra.io.sstable.SSTableWriter$RowIndexer.index(SSTableWriter.java:370)&lt;br/&gt;
        at org.apache.cassandra.io.sstable.SSTableWriter$Builder.build(SSTableWriter.java:315)&lt;br/&gt;
        at org.apache.cassandra.db.compaction.CompactionManager$9.call(CompactionManager.java:1108)&lt;br/&gt;
        at org.apache.cassandra.db.compaction.CompactionManager$9.call(CompactionManager.java:1099)&lt;br/&gt;
        at java.util.concurrent.FutureTask$Sync.innerRun(FutureTask.java:303)&lt;br/&gt;
        at java.util.concurrent.FutureTask.run(FutureTask.java:138)&lt;br/&gt;
        at java.util.concurrent.ThreadPoolExecutor$Worker.runTask(ThreadPoolExecutor.java:886)&lt;br/&gt;
        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:908)&lt;br/&gt;
        at java.lang.Thread.run(Thread.java:662)&lt;/p&gt;</comment>
                            <comment id="13113503" author="cce" created="Fri, 23 Sep 2011 15:20:42 +0000"  >&lt;p&gt;Here&apos;s another from a node that was streaming out:&lt;/p&gt;


&lt;p&gt; INFO &lt;span class=&quot;error&quot;&gt;&amp;#91;AntiEntropyStage:1&amp;#93;&lt;/span&gt; 2011-09-22 17:56:33,737 StreamOut.java (line 181) Stream context metadata [/raid0/cassandra/data/Keyspace/CF1-g-315-Data.db sections=1073 progress=0/358&lt;br/&gt;
 INFO &lt;span class=&quot;error&quot;&gt;&amp;#91;AntiEntropyStage:1&amp;#93;&lt;/span&gt; 2011-09-22 17:56:33,738 StreamOutSession.java (line 174) Streaming to /10.207.38.196&lt;br/&gt;
 INFO &lt;span class=&quot;error&quot;&gt;&amp;#91;ValidationExecutor:14&amp;#93;&lt;/span&gt; 2011-09-22 17:56:33,740 ColumnFamilyStore.java (line 1128) Enqueuing flush of Memtable-CF4@516894197(9505947/21294113 serialized/live bytes, 5684 ops)&lt;br/&gt;
 INFO &lt;span class=&quot;error&quot;&gt;&amp;#91;FlushWriter:621&amp;#93;&lt;/span&gt; 2011-09-22 17:56:33,743 Memtable.java (line 237) Writing Memtable-CF4@516894197(9505947/21294113 serialized/live bytes, 5684 ops)&lt;br/&gt;
 INFO &lt;span class=&quot;error&quot;&gt;&amp;#91;FlushWriter:621&amp;#93;&lt;/span&gt; 2011-09-22 17:56:33,880 Memtable.java (line 254) Completed flushing /raid0/cassandra/data/Keyspace/CF4-g-434-Data.db (9914202 bytes)&lt;br/&gt;
 INFO &lt;span class=&quot;error&quot;&gt;&amp;#91;CompactionExecutor:884&amp;#93;&lt;/span&gt; 2011-09-22 17:56:45,912 CompactionManager.java (line 608) Compacted to /raid0/cassandra/data/Keyspace/CF4-tmp-g-332-Data.db.  32,824,572,147 to 18,506,0&lt;br/&gt;
ERROR &lt;span class=&quot;error&quot;&gt;&amp;#91;CompactionExecutor:884&amp;#93;&lt;/span&gt; 2011-09-22 17:56:46,134 AbstractCassandraDaemon.java (line 139) Fatal exception in thread Thread&lt;span class=&quot;error&quot;&gt;&amp;#91;CompactionExecutor:884,1,main&amp;#93;&lt;/span&gt;&lt;br/&gt;
java.lang.NullPointerException&lt;br/&gt;
        at org.apache.cassandra.io.sstable.SSTableWriter$RowIndexer.close(SSTableWriter.java:382)&lt;br/&gt;
        at org.apache.cassandra.io.sstable.SSTableWriter$RowIndexer.index(SSTableWriter.java:370)&lt;br/&gt;
        at org.apache.cassandra.io.sstable.SSTableWriter$Builder.build(SSTableWriter.java:315)&lt;br/&gt;
        at org.apache.cassandra.db.compaction.CompactionManager$9.call(CompactionManager.java:1108)&lt;br/&gt;
        at org.apache.cassandra.db.compaction.CompactionManager$9.call(CompactionManager.java:1099)&lt;br/&gt;
        at java.util.concurrent.FutureTask$Sync.innerRun(FutureTask.java:303)&lt;br/&gt;
        at java.util.concurrent.FutureTask.run(FutureTask.java:138)&lt;br/&gt;
        at java.util.concurrent.ThreadPoolExecutor$Worker.runTask(ThreadPoolExecutor.java:886)&lt;br/&gt;
        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:908)&lt;br/&gt;
        at java.lang.Thread.run(Thread.java:662)&lt;/p&gt;</comment>
                            <comment id="13113771" author="alienth" created="Fri, 23 Sep 2011 21:12:26 +0000"  >&lt;p&gt;Getting the following after trying to &apos;move&apos; on 0.8.5:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;ERROR [CompactionExecutor:213] 2011-09-23 14:02:26,571
AbstractCassandraDaemon.java (line 139) Fatal exception in thread
&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;[CompactionExecutor:213,1,main]
java.lang.NullPointerException
       at org.apache.cassandra.io.sstable.SSTableWriter$RowIndexer.close(SSTableWriter.java:382)
       at org.apache.cassandra.io.sstable.SSTableWriter$RowIndexer.index(SSTableWriter.java:370)
       at org.apache.cassandra.io.sstable.SSTableWriter$Builder.build(SSTableWriter.java:315)
       at org.apache.cassandra.db.compaction.CompactionManager$9.call(CompactionManager.java:1108)
       at org.apache.cassandra.db.compaction.CompactionManager$9.call(CompactionManager.java:1099)
       at java.util.concurrent.FutureTask$Sync.innerRun(FutureTask.java:303)
       at java.util.concurrent.FutureTask.run(FutureTask.java:138)
       at java.util.concurrent.ThreadPoolExecutor$Worker.runTask(ThreadPoolExecutor.java:886)
       at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:908)
       at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:662)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="13113896" author="alienth" created="Sat, 24 Sep 2011 05:25:56 +0000"  >&lt;p&gt;Also got the same NPE when doing a repair on a different node. This time, the NPE was preceded by a different NPE:&lt;/p&gt;


&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;java.lang.RuntimeException: java.util.concurrent.ExecutionException: java.lang.NullPointerException
        at org.apache.cassandra.streaming.StreamInSession.closeIfFinished(StreamInSession.java:154)
        at org.apache.cassandra.streaming.IncomingStreamReader.read(IncomingStreamReader.java:63)
        at org.apache.cassandra.net.IncomingTcpConnection.stream(IncomingTcpConnection.java:177)
        at org.apache.cassandra.net.IncomingTcpConnection.run(IncomingTcpConnection.java:114)
Caused by: java.util.concurrent.ExecutionException: java.lang.NullPointerException
        at java.util.concurrent.FutureTask$Sync.innerGet(FutureTask.java:222)
        at java.util.concurrent.FutureTask.get(FutureTask.java:83)
        at org.apache.cassandra.streaming.StreamInSession.closeIfFinished(StreamInSession.java:138)
        ... 3 more
Caused by: java.lang.NullPointerException
        at org.apache.cassandra.io.sstable.SSTableWriter$RowIndexer.close(SSTableWriter.java:382)
        at org.apache.cassandra.io.sstable.SSTableWriter$RowIndexer.index(SSTableWriter.java:370)
        at org.apache.cassandra.io.sstable.SSTableWriter$Builder.build(SSTableWriter.java:315)
        at org.apache.cassandra.db.compaction.CompactionManager$9.call(CompactionManager.java:1108)
        at org.apache.cassandra.db.compaction.CompactionManager$9.call(CompactionManager.java:1099)
        at java.util.concurrent.FutureTask$Sync.innerRun(FutureTask.java:303)
        at java.util.concurrent.FutureTask.run(FutureTask.java:138)
        at java.util.concurrent.ThreadPoolExecutor$Worker.runTask(ThreadPoolExecutor.java:886)
        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:908)
        at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:662)

&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="13122984" author="j.casares" created="Fri, 7 Oct 2011 17:40:08 +0000"  >&lt;p&gt;We&apos;ve seen the same error via autobootstrap.&lt;/p&gt;</comment>
                            <comment id="13123007" author="jbellis" created="Fri, 7 Oct 2011 18:01:11 +0000"  >&lt;p&gt;Joaquin, can you give steps to reproduce?&lt;/p&gt;</comment>
                            <comment id="13123999" author="slebresne" created="Mon, 10 Oct 2011 11:07:16 +0000"  >&lt;p&gt;Alright, I&apos;ve tried boostrapping nodes a few times and I&apos;m still not able to reproduce, so  it&apos;s likely a race of something.&lt;/p&gt;

&lt;p&gt;That being said, I still have no clue how the iwriter field in SSTableWriter.RowIndexer can be null where the stack indicates it to be null. The assignment happens before the access, there is no other assignment of that field and the assignment/access are in the same thread.&lt;/p&gt;

&lt;p&gt;Anyway, what we can easily do is to make iwrite being final and assign it in the constructor. If that doesn&apos;t make that field being non-null, I don&apos;t know what will. Patch attached to make that change.&lt;/p&gt;</comment>
                            <comment id="13124063" author="slebresne" created="Mon, 10 Oct 2011 13:07:11 +0000"  >&lt;p&gt;First patch was buggy in that it was now creating the index file &lt;b&gt;before&lt;/b&gt; we assert that this file doesn&apos;t exist.&lt;/p&gt;

&lt;p&gt;v2 just moves the maybeOpenIndexer call after the asserts.&lt;/p&gt;</comment>
                            <comment id="13124068" author="jbellis" created="Mon, 10 Oct 2011 13:12:54 +0000"  >&lt;p&gt;+1 v2&lt;/p&gt;</comment>
                            <comment id="13124114" author="slebresne" created="Mon, 10 Oct 2011 13:59:13 +0000"  >&lt;p&gt;Committed and marking resolved for now. If that errors come up in another form, we&apos;ll see then.&lt;/p&gt;</comment>
                            <comment id="13124125" author="hudson" created="Mon, 10 Oct 2011 14:26:54 +0000"  >&lt;p&gt;Integrated in Cassandra-0.8 #366 (See &lt;a href=&quot;https://builds.apache.org/job/Cassandra-0.8/366/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/Cassandra-0.8/366/&lt;/a&gt;)&lt;br/&gt;
    Make SSTW.RowIndexer.iwriter a final field to avoid NPE&lt;br/&gt;
patch by slebresne; reviewed by jbellis for &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-2863&quot; title=&quot;NPE when writing SSTable generated via repair&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-2863&quot;&gt;&lt;del&gt;CASSANDRA-2863&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;slebresne : &lt;a href=&quot;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1180958&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1180958&lt;/a&gt;&lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/cassandra/branches/cassandra-0.8/CHANGES.txt&lt;/li&gt;
	&lt;li&gt;/cassandra/branches/cassandra-0.8/src/java/org/apache/cassandra/io/sstable/SSTableWriter.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                    </comments>
                    <attachments>
                            <attachment id="12498418" name="2863-v2.patch" size="2770" author="slebresne" created="Mon, 10 Oct 2011 13:07:11 +0000"/>
                            <attachment id="12498412" name="2863.patch" size="2467" author="slebresne" created="Mon, 10 Oct 2011 11:07:16 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[slebresne]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>20870</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            14 years, 7 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0gdx3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>93685</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>jbellis</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[jbellis]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12962"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>