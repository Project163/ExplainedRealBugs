<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 22:49:25 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-8028] Unable to compute when histogram overflowed</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-8028</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;It seems like with 2.1.0 histograms can&apos;t be computed most of the times:&lt;/p&gt;

&lt;p&gt;$ nodetool cfhistograms draios top_files_by_agent1&lt;br/&gt;
nodetool: Unable to compute when histogram overflowed&lt;br/&gt;
See &apos;nodetool help&apos; or &apos;nodetool help &amp;lt;command&amp;gt;&apos;.&lt;/p&gt;

&lt;p&gt;I can probably find a way to attach a .cql script to reproduce it, but I suspect it must be obvious to replicate it as it happens on more than 50% of my column families.&lt;/p&gt;</description>
                <environment>&lt;p&gt;Linux&lt;/p&gt;</environment>
        <key id="12745013">CASSANDRA-8028</key>
            <summary>Unable to compute when histogram overflowed</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10002" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Normal</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="carlyeks">Carl Yeksigian</assignee>
                                    <reporter username="gianlucaborello">Gianluca Borello</reporter>
                        <labels>
                    </labels>
                <created>Tue, 30 Sep 2014 18:01:51 +0000</created>
                <updated>Wed, 15 Oct 2025 09:49:05 +0000</updated>
                            <resolved>Thu, 6 Nov 2014 16:21:41 +0000</resolved>
                                        <fixVersion>2.1.3</fixVersion>
                                    <component>Legacy/Tools</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>10</watches>
                                                                                                                <comments>
                            <comment id="14156616" author="carlyeks" created="Thu, 2 Oct 2014 14:32:22 +0000"  >&lt;p&gt;This overflow is persisted in the sstable metadata that you have produced. There are probably very large partitions which are overflowing our histogram.&lt;/p&gt;

&lt;p&gt;In order to get around this, we&apos;ll need to increase the amount of data that is persisted and break compatibility of nodetool, so it will have to wait for 3.0.&lt;/p&gt;

&lt;p&gt;I have attached a check so that the other information can be gathered, except for the metric that has overflowed.&lt;/p&gt;</comment>
                            <comment id="14156648" author="jbellis" created="Thu, 2 Oct 2014 15:06:33 +0000"  >&lt;p&gt;Does nodetool hardcode the EstimatedHistogram size it expects?&lt;/p&gt;</comment>
                            <comment id="14156649" author="carlyeks" created="Thu, 2 Oct 2014 15:07:59 +0000"  >&lt;p&gt;Yes, it uses the default of 90, so we can&apos;t just up the size and have nodetool understand it.&lt;/p&gt;</comment>
                            <comment id="14156737" author="gianlucaborello" created="Thu, 2 Oct 2014 16:47:53 +0000"  >&lt;p&gt;How &quot;large&quot; partitions are we talking about here?&lt;/p&gt;

&lt;p&gt;The worrisome thing is that the command fails on a column family, and then, a few seconds later, it works, again on that same column family:&lt;/p&gt;

&lt;p&gt;First attempt:&lt;/p&gt;

&lt;p&gt;$ nodetool cfhistograms draios protobuf1&lt;br/&gt;
nodetool: Unable to compute when histogram overflowed&lt;br/&gt;
See &apos;nodetool help&apos; or &apos;nodetool help &amp;lt;command&amp;gt;&apos;.&lt;/p&gt;

&lt;p&gt;Second attempt (after about 30 seconds):&lt;/p&gt;

&lt;p&gt;$ nodetool cfhistograms draios protobuf1&lt;br/&gt;
draios/protobuf1 histograms&lt;br/&gt;
Percentile  SSTables     Write Latency      Read Latency    Partition Size        Cell Count&lt;br/&gt;
                              (micros)          (micros)           (bytes)&lt;br/&gt;
50%             0.00             18.60            159.55           1955666              1597&lt;br/&gt;
75%             1.00             21.77            364.55           4055269              3973&lt;br/&gt;
95%             1.00             33.11          10789.18           7007506             61214&lt;br/&gt;
98%             3.00             53.04          56822.90           8409007             61214&lt;br/&gt;
99%             4.00            155.01          77205.61           8409007             61214&lt;br/&gt;
Min             0.00              7.11             58.23            105779                87&lt;br/&gt;
Max             5.00          85449.58         189451.45          17436917             61214&lt;/p&gt;

&lt;p&gt;There were no deletions in between, and the partitions don&apos;t seem that big to me, we try to keep them always under a few MBs.&lt;/p&gt;</comment>
                            <comment id="14158454" author="carlyeks" created="Fri, 3 Oct 2014 20:07:37 +0000"  >&lt;p&gt;These metrics are captured per-sstable, it is possible that the change in behaviour is down to a compaction.&lt;/p&gt;

&lt;p&gt;The max partition size is already right at the boundary of not being representable by the histograms, so any difference in the sstables could be enough to change whether the histogram is overflowed or not.&lt;/p&gt;</comment>
                            <comment id="14158457" author="gianlucaborello" created="Fri, 3 Oct 2014 20:11:01 +0000"  >&lt;p&gt;I know it&apos;s absolutely OT and I can perhaps post this to the mailing list instead, but I really have to ask: are we doing something wrong then? Should we make partitions much smaller?&lt;/p&gt;

&lt;p&gt;I&apos;ve read from various different sources that having rows &quot;up to a few megabytes&quot; is totally acceptable, so that has become our rule of thumb when designing sharding keys for the partitions.&lt;/p&gt;</comment>
                            <comment id="14158502" author="carlyeks" created="Fri, 3 Oct 2014 20:44:27 +0000"  >&lt;p&gt;As long as it isn&apos;t a single cell, this is fine. The issue you&apos;re running into is just that we haven&apos;t updated the histogram code to handle those bigger partitions yet.&lt;/p&gt;</comment>
                            <comment id="14174385" author="cameron hatfield" created="Thu, 16 Oct 2014 22:42:01 +0000"  >&lt;p&gt;Looks like this doesn&apos;t fully resolve the issue. According to running sstablemetadata on a 2.1.0 sstable file, as well as MetadataCollector.java: &lt;a href=&quot;https://github.com/apache/cassandra/blob/8d8fed52242c34b477d0384ba1d1ce3978efbbe8/src/java/org/apache/cassandra/io/sstable/metadata/MetadataCollector.java#L59&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/cassandra/blob/8d8fed52242c34b477d0384ba1d1ce3978efbbe8/src/java/org/apache/cassandra/io/sstable/metadata/MetadataCollector.java#L59&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;the sstable metadata persisted for these histograms are actually stored with a larger number of buckets then 90. The issue seems to be both the nodetool, &lt;a href=&quot;https://github.com/apache/cassandra/blob/810c2d5fe64333c0bcfe0b2ed3ea2c8f6aaf89b7/src/java/org/apache/cassandra/tools/NodeTool.java#L892&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/cassandra/blob/810c2d5fe64333c0bcfe0b2ed3ea2c8f6aaf89b7/src/java/org/apache/cassandra/tools/NodeTool.java#L892&lt;/a&gt;, as well as ColumnFamilyMetrics &lt;a href=&quot;https://github.com/apache/cassandra/blob/ed1f39480606c95ff6595aad0aad9c1af7460f74/src/java/org/apache/cassandra/metrics/ColumnFamilyMetrics.java#L220&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/cassandra/blob/ed1f39480606c95ff6595aad0aad9c1af7460f74/src/java/org/apache/cassandra/metrics/ColumnFamilyMetrics.java#L220&lt;/a&gt; have a hardcoded value of 90. If that was raised, then we would be able to display the non-overflowed histograms stored in the metadata.&lt;/p&gt;

&lt;p&gt;Example output from sstablemetadata (notice that number of rows is 115 and 150, not 90 and 90) :&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;cameron@cass-db01 &amp;lt;removed&amp;gt;&amp;#93;&lt;/span&gt;$ sstablemetadata &amp;lt;removed&amp;gt;-&amp;lt;removed&amp;gt;-ka-33-Data.db&lt;br/&gt;
SSTable: ./&amp;lt;removed&amp;gt;-&amp;lt;removed&amp;gt;-ka-33&lt;br/&gt;
Partitioner: org.apache.cassandra.dht.Murmur3Partitioner&lt;br/&gt;
Bloom Filter FP chance: 0.010000&lt;br/&gt;
Minimum timestamp: 1413408134518716&lt;br/&gt;
Maximum timestamp: 1413410874004562&lt;br/&gt;
SSTable max local deletion time: 2147483647&lt;br/&gt;
Compression ratio: 0.2157516194949938&lt;br/&gt;
Estimated droppable tombstones: 0.026257982293749805&lt;br/&gt;
SSTable Level: 0&lt;br/&gt;
Repaired at: 0&lt;br/&gt;
ReplayPosition(segmentId=1413409259260, position=15051162)&lt;br/&gt;
Estimated tombstone drop times:%n&lt;br/&gt;
1413408139:      1647&lt;br/&gt;
1413408151:      2451&lt;br/&gt;
1413408165:      3151&lt;br/&gt;
1413408180:      3400&lt;br/&gt;
1413408199:      3027&lt;br/&gt;
1413408214:      2769&lt;br/&gt;
1413408228:      2064&lt;br/&gt;
1413408244:      1779&lt;br/&gt;
1413408261:      3817&lt;br/&gt;
1413408280:      7265&lt;br/&gt;
1413408302:      1911&lt;br/&gt;
1413408319:      1512&lt;br/&gt;
1413408337:      1582&lt;br/&gt;
1413408354:      1712&lt;br/&gt;
1413408375:      1577&lt;br/&gt;
1413408393:      2507&lt;br/&gt;
1413408411:      1410&lt;br/&gt;
1413408431:       761&lt;br/&gt;
1413408447:       507&lt;br/&gt;
1413408466:      2593&lt;br/&gt;
1413408483:      3840&lt;br/&gt;
1413408503:      1557&lt;br/&gt;
1413408523:       819&lt;br/&gt;
1413409632:       742&lt;br/&gt;
1413409646:       641&lt;br/&gt;
1413409662:       473&lt;br/&gt;
1413409684:       704&lt;br/&gt;
1413409700:       762&lt;br/&gt;
1413409716:       601&lt;br/&gt;
1413409728:       125&lt;br/&gt;
1413409744:      1190&lt;br/&gt;
1413409763:      1181&lt;br/&gt;
1413409783:      1768&lt;br/&gt;
1413409800:      1730&lt;br/&gt;
1413409820:      1326&lt;br/&gt;
1413409837:      1273&lt;br/&gt;
1413409856:      1299&lt;br/&gt;
1413409871:      2663&lt;br/&gt;
1413409887:      2197&lt;br/&gt;
1413409901:      1776&lt;br/&gt;
1413409917:       871&lt;br/&gt;
1413409934:      1449&lt;br/&gt;
1413409952:      1700&lt;br/&gt;
1413409969:      1301&lt;br/&gt;
1413409984:      2100&lt;br/&gt;
1413410002:      2103&lt;br/&gt;
1413410021:      1208&lt;br/&gt;
1413410039:       923&lt;br/&gt;
1413410052:      1425&lt;br/&gt;
1413410068:      1796&lt;br/&gt;
1413410081:      2263&lt;br/&gt;
1413410095:      2664&lt;br/&gt;
1413410110:      3019&lt;br/&gt;
1413410128:      2823&lt;br/&gt;
1413410146:      3801&lt;br/&gt;
1413410160:      3864&lt;br/&gt;
1413410175:      3252&lt;br/&gt;
1413410188:      8337&lt;br/&gt;
1413410204:      9375&lt;br/&gt;
1413410219:      6125&lt;br/&gt;
1413410235:      7954&lt;br/&gt;
1413410254:     11019&lt;br/&gt;
1413410271:     12703&lt;br/&gt;
1413410287:     12274&lt;br/&gt;
1413410303:     12199&lt;br/&gt;
1413410317:     10751&lt;br/&gt;
1413410330:     11369&lt;br/&gt;
1413410343:     10552&lt;br/&gt;
1413410355:      8157&lt;br/&gt;
1413410369:      8776&lt;br/&gt;
1413410384:      7504&lt;br/&gt;
1413410400:      7312&lt;br/&gt;
1413410418:      7472&lt;br/&gt;
1413410434:      7032&lt;br/&gt;
1413410448:      6338&lt;br/&gt;
1413410465:      5335&lt;br/&gt;
1413410484:      6427&lt;br/&gt;
1413410504:      7897&lt;br/&gt;
1413410523:      8515&lt;br/&gt;
1413410539:      4886&lt;br/&gt;
1413410557:      4847&lt;br/&gt;
1413410576:      4987&lt;br/&gt;
1413410591:      7630&lt;br/&gt;
1413410611:      8553&lt;br/&gt;
1413410628:     12157&lt;br/&gt;
1413410645:     12740&lt;br/&gt;
1413410663:     13756&lt;br/&gt;
1413410679:     19249&lt;br/&gt;
1413410695:     19374&lt;br/&gt;
1413410713:     15390&lt;br/&gt;
1413410732:     13493&lt;br/&gt;
1413410746:     13793&lt;br/&gt;
1413410760:     16937&lt;br/&gt;
1413410775:     19841&lt;br/&gt;
1413410791:     16595&lt;br/&gt;
1413410808:     19050&lt;br/&gt;
1413410823:     18450&lt;br/&gt;
1413410840:     22497&lt;br/&gt;
1413410861:     34027&lt;br/&gt;
1413410872:        16&lt;br/&gt;
Count               Row Size        Cell Count&lt;br/&gt;
1                          0                 0&lt;br/&gt;
2                          0                 0&lt;br/&gt;
3                          0                 0&lt;br/&gt;
4                          0                16&lt;br/&gt;
5                          0                 0&lt;br/&gt;
6                          0                 0&lt;br/&gt;
7                          0                 0&lt;br/&gt;
8                          0                35&lt;br/&gt;
10                         0                 0&lt;br/&gt;
12                         0                17&lt;br/&gt;
14                         0                 0&lt;br/&gt;
17                         0                29&lt;br/&gt;
20                         0                14&lt;br/&gt;
24                         0                21&lt;br/&gt;
29                         0                12&lt;br/&gt;
35                         0                13&lt;br/&gt;
42                         0                40&lt;br/&gt;
50                         0                19&lt;br/&gt;
60                         0                30&lt;br/&gt;
72                         0                32&lt;br/&gt;
86                         0                39&lt;br/&gt;
103                        0                32&lt;br/&gt;
124                        0                53&lt;br/&gt;
149                        0                40&lt;br/&gt;
179                        0                55&lt;br/&gt;
215                        0                62&lt;br/&gt;
258                        0                71&lt;br/&gt;
310                        0               107&lt;br/&gt;
372                        0               148&lt;br/&gt;
446                        5               185&lt;br/&gt;
535                        4               211&lt;br/&gt;
642                        2               182&lt;br/&gt;
770                        0               130&lt;br/&gt;
924                       12               180&lt;br/&gt;
1109                       4               201&lt;br/&gt;
1331                      14               172&lt;br/&gt;
1597                       9               201&lt;br/&gt;
1916                      15               182&lt;br/&gt;
2299                      30               204&lt;br/&gt;
2759                      12               197&lt;br/&gt;
3311                      14               315&lt;br/&gt;
3973                      20               203&lt;br/&gt;
4768                      24               122&lt;br/&gt;
5722                      13               155&lt;br/&gt;
6866                      18               197&lt;br/&gt;
8239                      23               115&lt;br/&gt;
9887                      30               133&lt;br/&gt;
11864                     22               102&lt;br/&gt;
14237                     40                59&lt;br/&gt;
17084                     39                62&lt;br/&gt;
20501                     51                78&lt;br/&gt;
24601                     32                49&lt;br/&gt;
29521                     55                46&lt;br/&gt;
35425                     67                58&lt;br/&gt;
42510                     87                27&lt;br/&gt;
51012                    166                26&lt;br/&gt;
61214                    140                11&lt;br/&gt;
73457                    127                 9&lt;br/&gt;
88148                    124                 0&lt;br/&gt;
105778                   125                 0&lt;br/&gt;
126934                   173                 0&lt;br/&gt;
152321                   225                 0&lt;br/&gt;
182785                   174                 0&lt;br/&gt;
219342                   200                 0&lt;br/&gt;
263210                   215                 0&lt;br/&gt;
315852                   216                 0&lt;br/&gt;
379022                   204                 0&lt;br/&gt;
454826                   206                 0&lt;br/&gt;
545791                   181                 0&lt;br/&gt;
654949                   187                 0&lt;br/&gt;
785939                   230                 0&lt;br/&gt;
943127                   184                 0&lt;br/&gt;
1131752                  122                 0&lt;br/&gt;
1358102                  103                 0&lt;br/&gt;
1629722                  135                 0&lt;br/&gt;
1955666                   53                 0&lt;br/&gt;
2346799                   83                 0&lt;br/&gt;
2816159                   45                 0&lt;br/&gt;
3379391                   67                 0&lt;br/&gt;
4055269                   56                 0&lt;br/&gt;
4866323                   60                 0&lt;br/&gt;
5839588                   67                 0&lt;br/&gt;
7007506                   36                 0&lt;br/&gt;
8409007                   60                 0&lt;br/&gt;
10090808                  38                 0&lt;br/&gt;
12108970                  28                 0&lt;br/&gt;
14530764                  14                 0&lt;br/&gt;
17436917                   7                 0&lt;br/&gt;
20924300                   4                 0&lt;br/&gt;
25109160                   0                 0&lt;br/&gt;
30130992                   0                 0&lt;br/&gt;
36157190                   0                 0&lt;br/&gt;
43388628                   0                 0&lt;br/&gt;
52066354                   0                 0&lt;br/&gt;
62479625                   0                 0&lt;br/&gt;
74975550                   0                 0&lt;br/&gt;
89970660                   0                 0&lt;br/&gt;
107964792                  0                 0&lt;br/&gt;
129557750                  0                 0&lt;br/&gt;
155469300                  0                 0&lt;br/&gt;
186563160                  0                 0&lt;br/&gt;
223875792                  0                 0&lt;br/&gt;
268650950                  0                 0&lt;br/&gt;
322381140                  0                 0&lt;br/&gt;
386857368                  0                 0&lt;br/&gt;
464228842                  0                 0&lt;br/&gt;
557074610                  0                 0&lt;br/&gt;
668489532                  0                 0&lt;br/&gt;
802187438                  0                 0&lt;br/&gt;
962624926                  0                 0&lt;br/&gt;
1155149911                 0                 0&lt;br/&gt;
1386179893                 0                 0&lt;br/&gt;
1663415872                 0                 0&lt;br/&gt;
1996099046                 0                 0&lt;br/&gt;
2395318855                 0                 0&lt;br/&gt;
2874382626                 0&lt;br/&gt;
3449259151                 0&lt;br/&gt;
4139110981                 0&lt;br/&gt;
4966933177                 0&lt;br/&gt;
5960319812                 0&lt;br/&gt;
7152383774                 0&lt;br/&gt;
8582860529                 0&lt;br/&gt;
10299432635                 0&lt;br/&gt;
12359319162                 0&lt;br/&gt;
14831182994                 0&lt;br/&gt;
17797419593                 0&lt;br/&gt;
21356903512                 0&lt;br/&gt;
25628284214                 0&lt;br/&gt;
30753941057                 0&lt;br/&gt;
36904729268                 0&lt;br/&gt;
44285675122                 0&lt;br/&gt;
53142810146                 0&lt;br/&gt;
63771372175                 0&lt;br/&gt;
76525646610                 0&lt;br/&gt;
91830775932                 0&lt;br/&gt;
110196931118                 0&lt;br/&gt;
132236317342                 0&lt;br/&gt;
158683580810                 0&lt;br/&gt;
190420296972                 0&lt;br/&gt;
228504356366                 0&lt;br/&gt;
274205227639                 0&lt;br/&gt;
329046273167                 0&lt;br/&gt;
394855527800                 0&lt;br/&gt;
473826633360                 0&lt;br/&gt;
568591960032                 0&lt;br/&gt;
682310352038                 0&lt;br/&gt;
818772422446                 0&lt;br/&gt;
982526906935                 0&lt;br/&gt;
1179032288322                 0&lt;br/&gt;
1414838745986                 0&lt;br/&gt;
Ancestors: &lt;span class=&quot;error&quot;&gt;&amp;#91;237, 222, 227, 201, 243, 174&amp;#93;&lt;/span&gt;&lt;br/&gt;
Estimated cardinality: 4696&lt;/p&gt;</comment>
                            <comment id="14181857" author="carlyeks" created="Thu, 23 Oct 2014 20:02:51 +0000"  >&lt;p&gt;Good catch, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=Cameron+Hatfield&quot; class=&quot;user-hover&quot; rel=&quot;Cameron Hatfield&quot;&gt;Cameron Hatfield&lt;/a&gt;. I don&apos;t know how I missed that before. &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;This will still be a breaking change which should wait until 3.0. nodetool currently expects the size of the buckets to always be 90, and will fail an assertion if we make changes on the server to send the full histogram to the client.&lt;/p&gt;

&lt;p&gt;I&apos;ve attached a patch against trunk that does send the full histogram as it is persisted.&lt;/p&gt;</comment>
                            <comment id="14181904" author="brandon.williams" created="Thu, 23 Oct 2014 20:31:33 +0000"  >&lt;blockquote&gt;&lt;p&gt;This will still be a breaking change which should wait until 3.0. nodetool currently expects the size of the buckets to always be 90, and will fail an assertion if we make changes on the server to send the full histogram to the client.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;But we don&apos;t need to allow mixing an older nodetool with a newer server or vice versa, so can&apos;t we change them both in 2.1?&lt;/p&gt;</comment>
                            <comment id="14181950" author="carlyeks" created="Thu, 23 Oct 2014 20:57:12 +0000"  >&lt;p&gt;That works for me then. The patch also applies to 2.1 cleanly.&lt;/p&gt;</comment>
                            <comment id="14185674" author="jmckenzie" created="Mon, 27 Oct 2014 19:36:55 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=carlyeks&quot; class=&quot;user-hover&quot; rel=&quot;carlyeks&quot;&gt;carlyeks&lt;/a&gt;: do you have a stress syntax handy that&apos;ll reproduce the problem?&lt;/p&gt;</comment>
                            <comment id="14185685" author="jmckenzie" created="Mon, 27 Oct 2014 19:47:01 +0000"  >&lt;p&gt;Also - 8028-trunk isn&apos;t applying cleanly to 2.1 or trunk for me nor to trunk on the commit just prior to its creation.&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;error: patch failed: src/java/org/apache/cassandra/tools/NodeTool.java:908&lt;/p&gt;&lt;/blockquote&gt;</comment>
                            <comment id="14190806" author="carlyeks" created="Thu, 30 Oct 2014 20:47:34 +0000"  >&lt;p&gt;I&apos;ve attached a rebased patch, and the sstable that I used to make sure that the overflow was fixed.&lt;/p&gt;

&lt;p&gt;The schema is:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;CREATE TABLE sstable.histogrambuster (name text, id bigint, PRIMARY KEY (name, id))
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="14199482" author="jmckenzie" created="Thu, 6 Nov 2014 00:50:12 +0000"  >&lt;p&gt;It looks like if rowSizeHist or columnCountHist overflow this skips populating the percentiles of both regardless of whether the other was in bounds.  Is there a reason we clobber the other even if it didn&apos;t overflow?&lt;/p&gt;

&lt;p&gt;Other than that, LGTM.&lt;/p&gt;</comment>
                            <comment id="14200344" author="carlyeks" created="Thu, 6 Nov 2014 15:42:50 +0000"  >&lt;p&gt;The intent was to allow one to be set without the other, just didn&apos;t do it correctly. Thanks for catching; I&apos;ve addressed it in the latest patch.&lt;/p&gt;</comment>
                            <comment id="14200383" author="jmckenzie" created="Thu, 6 Nov 2014 16:21:41 +0000"  >&lt;p&gt;committed v2.  &lt;/p&gt;</comment>
                            <comment id="15113715" author="nnishant" created="Sat, 23 Jan 2016 12:35:28 +0000"  >&lt;p&gt;Hi All,&lt;/p&gt;

&lt;p&gt;We are getting similar issue while autocompaction is running on few of our nodes. Following is the error being logged, can someone please suggest what is causing this and how to resolve it? We use Cassandra 2.1.9. Please let me know if further information is required.&lt;/p&gt;

&lt;p&gt;Error:&lt;/p&gt;

&lt;p&gt;ERROR &lt;span class=&quot;error&quot;&gt;&amp;#91;CompactionExecutor:3&amp;#93;&lt;/span&gt; 2016-01-23 11:54:50,198 CassandraDaemon.java:223 - Exception in thread Thread&lt;span class=&quot;error&quot;&gt;&amp;#91;CompactionExecutor:3,1,main&amp;#93;&lt;/span&gt;&lt;br/&gt;
java.lang.IllegalStateException: Unable to compute ceiling for max when histogram overflowed&lt;br/&gt;
        at org.apache.cassandra.utils.EstimatedHistogram.mean(EstimatedHistogram.java:203) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;apache-cassandra-2.1.9.jar:2.1.9&amp;#93;&lt;/span&gt;&lt;br/&gt;
        at org.apache.cassandra.io.sstable.metadata.StatsMetadata.getEstimatedDroppableTombstoneRatio(StatsMetadata.java:98) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;apache-cassandra-2.1.9.jar:2.1.9&amp;#93;&lt;/span&gt;&lt;br/&gt;
        at org.apache.cassandra.io.sstable.SSTableReader.getEstimatedDroppableTombstoneRatio(SSTableReader.java:1987) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;apache-cassandra-2.1.9.jar:2.1.9&amp;#93;&lt;/span&gt;&lt;br/&gt;
        at org.apache.cassandra.db.compaction.AbstractCompactionStrategy.worthDroppingTombstones(AbstractCompactionStrategy.java:370) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;apache-cassandra-2.1.9.jar:2.1.9&amp;#93;&lt;/span&gt;&lt;br/&gt;
        at org.apache.cassandra.db.compaction.SizeTieredCompactionStrategy.getNextBackgroundSSTables(SizeTieredCompactionStrategy.java:96) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;apache-cassandra-2.1.9.jar:2.1.9&amp;#93;&lt;/span&gt;&lt;br/&gt;
        at org.apache.cassandra.db.compaction.SizeTieredCompactionStrategy.getNextBackgroundTask(SizeTieredCompactionStrategy.java:179) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;apache-cassandra-2.1.9.jar:2.1.9&amp;#93;&lt;/span&gt;&lt;br/&gt;
        at org.apache.cassandra.db.compaction.WrappingCompactionStrategy.getNextBackgroundTask(WrappingCompactionStrategy.java:84) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;apache-cassandra-2.1.9.jar:2.1.9&amp;#93;&lt;/span&gt;&lt;br/&gt;
        at org.apache.cassandra.db.compaction.CompactionManager$BackgroundCompactionCandidate.run(CompactionManager.java:230) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;apache-cassandra-2.1.9.jar:2.1.9&amp;#93;&lt;/span&gt;&lt;br/&gt;
        at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:471) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;na:1.7.0_51&amp;#93;&lt;/span&gt;&lt;br/&gt;
        at java.util.concurrent.FutureTask.run(FutureTask.java:262) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;na:1.7.0_51&amp;#93;&lt;/span&gt;&lt;br/&gt;
        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1145) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;na:1.7.0_51&amp;#93;&lt;/span&gt;&lt;br/&gt;
        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:615) &lt;span class=&quot;error&quot;&gt;&amp;#91;na:1.7.0_51&amp;#93;&lt;/span&gt;&lt;br/&gt;
        at java.lang.Thread.run(Thread.java:744) &lt;span class=&quot;error&quot;&gt;&amp;#91;na:1.7.0_51&amp;#93;&lt;/span&gt;&lt;/p&gt;</comment>
                            <comment id="15113748" author="nnishant" created="Sat, 23 Jan 2016 13:51:11 +0000"  >&lt;p&gt;I have created &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-11063&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/CASSANDRA-11063&lt;/a&gt; to track this issue.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                                                <inwardlinks description="is duplicated by">
                                        <issuelink>
            <issuekey id="12750090">CASSANDRA-8174</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12820535">CASSANDRA-9178</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12678300" name="8028-2.1-clean.txt" size="7770" author="carlyeks" created="Thu, 30 Oct 2014 20:47:34 +0000"/>
                            <attachment id="12679864" name="8028-2.1-v2.txt" size="7682" author="carlyeks" created="Thu, 6 Nov 2014 15:42:50 +0000"/>
                            <attachment id="12672551" name="8028-2.1.txt" size="2458" author="carlyeks" created="Thu, 2 Oct 2014 14:32:22 +0000"/>
                            <attachment id="12676695" name="8028-trunk.txt" size="7228" author="carlyeks" created="Thu, 23 Oct 2014 20:02:51 +0000"/>
                            <attachment id="12678301" name="sstable-histogrambuster.tar.bz2" size="8497334" author="carlyeks" created="Thu, 30 Oct 2014 20:47:34 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>5.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[carlyeks]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 43 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i20n8n:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12311421" key="com.atlassian.jira.plugin.system.customfieldtypes:multiversion">
                        <customfieldname>Reproduced In</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="12327256">2.1.0</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>joshuamckenzie</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[joshuamckenzie]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12962"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>