<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 22:19:44 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-2228] Race conditions when reinitialisating nodes (OOM + Nullpointer)</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-2228</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;I had a corrupt system table which wouldn&apos;t compact anymore and I deleted the files and restarted cassandra and let it take the same token/ip address.&lt;/p&gt;

&lt;p&gt;I experienced the same errors when I&apos;m adding a newly installed node under the same token/ip address before calling repair.&lt;/p&gt;

&lt;p&gt;1)&lt;br/&gt;
After a few seconds/minutes, I get a OOM error:&lt;/p&gt;


&lt;p&gt; INFO &lt;span class=&quot;error&quot;&gt;&amp;#91;FlushWriter:1&amp;#93;&lt;/span&gt; 2011-02-23 16:40:28,958 Memtable.java (line 164) Completed flushing /cassandra/data/system/Schema-f-15-Data.db (8037 bytes)&lt;br/&gt;
 INFO &lt;span class=&quot;error&quot;&gt;&amp;#91;MigrationStage:1&amp;#93;&lt;/span&gt; 2011-02-23 16:40:28,965 Migration.java (line 133) Applying migration 3e30e76b-1e3f-11e0-8369-5a9c1faed4ae Add keyspace: table_userentriesrep factor:3rep strategy:SimpleStrategy{org.apache.cassandra.config.CFMetaData@58925d9&lt;span class=&quot;error&quot;&gt;&amp;#91;cfId=1024,tableName=table_userentries,cfName=table_userentries,cfType=Standard,comparator=org.apache.cassandra.db.marshal.BytesType@b44dff0,subcolumncomparator=&amp;lt;null&amp;gt;,comment=,rowCacheSize=0.0,keyCacheSize=200000.0,readRepairChance=0.0,gcGraceSeconds=86400,defaultValidator=org.apache.cassandra.db.marshal.BytesType@b44dff0,minCompactionThreshold=4,maxCompactionThreshold=32,rowCacheSavePeriodInSeconds=0,keyCacheSavePeriodInSeconds=3600,memtableFlushAfterMins=60,memtableThroughputInMb=64,memtableOperationsInMillions=10.0,column_metadata={}&amp;#93;&lt;/span&gt;, org.apache.cassandra.config.CFMetaData@11ab7246&lt;span class=&quot;error&quot;&gt;&amp;#91;cfId=1025,tableName=table_userentries,cfName=table_userentries_meta,cfType=Standard,comparator=org.apache.cassandra.db.marshal.BytesType@b44dff0,subcolumncomparator=&amp;lt;null&amp;gt;,comment=,rowCacheSize=0.0,keyCacheSize=200000.0,readRepairChance=0.0,gcGraceSeconds=86400,defaultValidator=org.apache.cassandra.db.marshal.BytesType@b44dff0,minCompactionThreshold=4,maxCompactionThreshold=32,rowCacheSavePeriodInSeconds=0,keyCacheSavePeriodInSeconds=3600,memtableFlushAfterMins=60,memtableThroughputInMb=64,memtableOperationsInMillions=10.0,column_metadata={}&amp;#93;&lt;/span&gt;}&lt;br/&gt;
 INFO &lt;span class=&quot;error&quot;&gt;&amp;#91;MigrationStage:1&amp;#93;&lt;/span&gt; 2011-02-23 16:40:28,965 ColumnFamilyStore.java (line 666) switching in a fresh Memtable for Migrations at CommitLogContext(file=&apos;/cassandra/commitlog/CommitLog-1298475572022.log&apos;, position=226075)&lt;br/&gt;
 INFO &lt;span class=&quot;error&quot;&gt;&amp;#91;MigrationStage:1&amp;#93;&lt;/span&gt; 2011-02-23 16:40:28,966 ColumnFamilyStore.java (line 977) Enqueuing flush of Memtable-Migrations@2121008793(12529 bytes, 1 operations)&lt;br/&gt;
 INFO &lt;span class=&quot;error&quot;&gt;&amp;#91;FlushWriter:1&amp;#93;&lt;/span&gt; 2011-02-23 16:40:28,966 Memtable.java (line 157) Writing Memtable-Migrations@2121008793(12529 bytes, 1 operations)&lt;br/&gt;
 INFO &lt;span class=&quot;error&quot;&gt;&amp;#91;MigrationStage:1&amp;#93;&lt;/span&gt; 2011-02-23 16:40:28,966 ColumnFamilyStore.java (line 666) switching in a fresh Memtable for Schema at CommitLogContext(file=&apos;/cassandra/commitlog/CommitLog-1298475572022.log&apos;, position=226075)&lt;br/&gt;
 INFO &lt;span class=&quot;error&quot;&gt;&amp;#91;MigrationStage:1&amp;#93;&lt;/span&gt; 2011-02-23 16:40:28,967 ColumnFamilyStore.java (line 977) Enqueuing flush of Memtable-Schema@139610466(8370 bytes, 15 operations)&lt;br/&gt;
 INFO &lt;span class=&quot;error&quot;&gt;&amp;#91;ScheduledTasks:1&amp;#93;&lt;/span&gt; 2011-02-23 16:40:28,972 StatusLogger.java (line 89) table_sourcedetection.table_sourcedetection                 0,0                 0/0            0/200000&lt;br/&gt;
ERROR &lt;span class=&quot;error&quot;&gt;&amp;#91;FlushWriter:1&amp;#93;&lt;/span&gt; 2011-02-23 16:41:01,240 AbstractCassandraDaemon.java (line 114) Fatal exception in thread Thread&lt;span class=&quot;error&quot;&gt;&amp;#91;FlushWriter:1,5,main&amp;#93;&lt;/span&gt;&lt;br/&gt;
java.lang.OutOfMemoryError: Java heap space&lt;br/&gt;
        at java.nio.HeapByteBuffer.&amp;lt;init&amp;gt;(HeapByteBuffer.java:39)&lt;br/&gt;
        at java.nio.ByteBuffer.allocate(ByteBuffer.java:312)&lt;br/&gt;
        at org.apache.cassandra.io.util.BufferedRandomAccessFile.&amp;lt;init&amp;gt;(BufferedRandomAccessFile.java:126)&lt;br/&gt;
        at org.apache.cassandra.io.sstable.SSTableWriter.&amp;lt;init&amp;gt;(SSTableWriter.java:75)&lt;br/&gt;
        at org.apache.cassandra.db.Memtable.writeSortedContents(Memtable.java:158)&lt;br/&gt;
        at org.apache.cassandra.db.Memtable.access$000(Memtable.java:51)&lt;br/&gt;
        at org.apache.cassandra.db.Memtable$1.runMayThrow(Memtable.java:176)&lt;br/&gt;
        at org.apache.cassandra.utils.WrappedRunnable.run(WrappedRunnable.java:30)&lt;br/&gt;
        at java.util.concurrent.ThreadPoolExecutor$Worker.runTask(ThreadPoolExecutor.java:886)&lt;br/&gt;
        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:908)&lt;br/&gt;
        at java.lang.Thread.run(Thread.java:662)&lt;/p&gt;





&lt;p&gt;2) If I restart then, I&apos;m getting an Nullpointer exception. The OOM error will only appear once.&lt;/p&gt;

&lt;p&gt;ERROR &lt;span class=&quot;error&quot;&gt;&amp;#91;main&amp;#93;&lt;/span&gt; 2011-02-23 16:42:32,782 AbstractCassandraDaemon.java (line 333) Exception encountered during startup.&lt;br/&gt;
java.lang.NullPointerException&lt;br/&gt;
        at java.util.concurrent.ConcurrentHashMap.get(ConcurrentHashMap.java:768)&lt;br/&gt;
        at org.apache.cassandra.gms.Gossiper.addLocalApplicationState(Gossiper.java:925)&lt;br/&gt;
        at org.apache.cassandra.service.MigrationManager.passiveAnnounce(MigrationManager.java:105)&lt;br/&gt;
        at org.apache.cassandra.service.MigrationManager.applyMigrations(MigrationManager.java:161)&lt;br/&gt;
        at org.apache.cassandra.service.AbstractCassandraDaemon.setup(AbstractCassandraDaemon.java:185)&lt;br/&gt;
        at org.apache.cassandra.service.AbstractCassandraDaemon.activate(AbstractCassandraDaemon.java:316)&lt;br/&gt;
        at org.apache.cassandra.thrift.CassandraDaemon.main(CassandraDaemon.java:79)&lt;/p&gt;


&lt;p&gt;Killing and restarting the node multiple times will eventually &quot;fix&quot; these errors.&lt;/p&gt;


&lt;p&gt;Steps to reproduce. Remove complete data directory and restart node with same token/ip.&lt;/p&gt;
</description>
                <environment></environment>
        <key id="12499491">CASSANDRA-2228</key>
            <summary>Race conditions when reinitialisating nodes (OOM + Nullpointer)</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10002" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Normal</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="gdusbabek">Gary Dusbabek</assignee>
                                    <reporter username="tbritz">Thibaut</reporter>
                        <labels>
                    </labels>
                <created>Wed, 23 Feb 2011 15:50:49 +0000</created>
                <updated>Tue, 16 Apr 2019 09:33:05 +0000</updated>
                            <resolved>Thu, 3 Mar 2011 22:59:53 +0000</resolved>
                                        <fixVersion>0.7.4</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                                                                <comments>
                            <comment id="12998422" author="tbritz" created="Wed, 23 Feb 2011 15:56:28 +0000"  >&lt;p&gt;The normal heap usage of the node is about half of the allocated heap:&lt;/p&gt;

&lt;p&gt;Gossip active    : true&lt;br/&gt;
Load             : 30.99 GB&lt;br/&gt;
Generation No    : 1298476238&lt;br/&gt;
Uptime (seconds) : 308&lt;br/&gt;
Heap Memory (MB) : 1544.41 / 2493.38&lt;/p&gt;</comment>
                            <comment id="12998449" author="jbellis" created="Wed, 23 Feb 2011 16:58:19 +0000"  >&lt;p&gt;The OOM is because flushing allocates a buffer the size of in_memory_compaction_limit.  Sounds like you need to lower that.&lt;/p&gt;

&lt;p&gt;The NPE looks like a bug.&lt;/p&gt;</comment>
                            <comment id="13001630" author="gdusbabek" created="Wed, 2 Mar 2011 20:58:13 +0000"  >&lt;p&gt;What is listen_address in cassandra.yaml?  I&apos;m having a hard time conceiving of a way for FBUtilities.getLocalAddress() to return null.&lt;/p&gt;</comment>
                            <comment id="13001633" author="thibaut.britz@trendiction.com" created="Wed, 2 Mar 2011 20:59:37 +0000"  >&lt;p&gt;Hi,&lt;/p&gt;

&lt;p&gt;I&apos;m on vacation until March 14th.&lt;/p&gt;

&lt;p&gt;For urgent matters, please contact:&lt;br/&gt;
Christophe Folschette (christophe.folschette@trendiction.com)&lt;br/&gt;
+352 20 33 35 32&lt;/p&gt;</comment>
                            <comment id="13002037" author="jbellis" created="Thu, 3 Mar 2011 16:09:55 +0000"  >&lt;p&gt;It looks like we&apos;re doing Migration stuff before Gossiper.start is called.&lt;/p&gt;

&lt;p&gt;One possible solution: initialize Gossiper.localEndpoint in constructor instead of in start.&lt;/p&gt;</comment>
                            <comment id="13002080" author="gdusbabek" created="Thu, 3 Mar 2011 17:14:23 +0000"  >&lt;p&gt;CHM throws NPE when the key is null.  To me, then, the bug is that FBU.getLocalAddress() is somehow returning null.  &lt;/p&gt;

&lt;p&gt;I checked yesterday: even if local_address is unspecified, it ends up returning localhost.&lt;/p&gt;</comment>
                            <comment id="13002084" author="jbellis" created="Thu, 3 Mar 2011 17:18:21 +0000"  >&lt;p&gt;My point was that we can call put before initializing localEndpoint_ to FBU.gLA, so it&apos;s naturally going to be null.&lt;/p&gt;</comment>
                            <comment id="13002197" author="gdusbabek" created="Thu, 3 Mar 2011 20:46:54 +0000"  >&lt;p&gt;aha. I was looking in the trunk code (no chance of null).  I see the problem in the 0.7 branch.&lt;/p&gt;</comment>
                            <comment id="13002268" author="jbellis" created="Thu, 3 Mar 2011 22:03:04 +0000"  >&lt;p&gt;+1&lt;/p&gt;</comment>
                            <comment id="13002300" author="gdusbabek" created="Thu, 3 Mar 2011 22:59:53 +0000"  >&lt;p&gt;committed&lt;/p&gt;</comment>
                            <comment id="13002323" author="hudson" created="Thu, 3 Mar 2011 23:32:31 +0000"  >&lt;p&gt;Integrated in Cassandra-0.7 #344 (See &lt;a href=&quot;https://hudson.apache.org/hudson/job/Cassandra-0.7/344/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://hudson.apache.org/hudson/job/Cassandra-0.7/344/&lt;/a&gt;)&lt;br/&gt;
    initialize localendpoint in gossiper earlier. patch by gdusbabek, reviewed by jbellis. &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-2228&quot; title=&quot;Race conditions when reinitialisating nodes (OOM + Nullpointer)&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-2228&quot;&gt;&lt;del&gt;CASSANDRA-2228&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12472612" name="ASF.LICENSE.NOT.GRANTED--v1-0001-initialize-localEndpoint_.txt" size="5373" author="gdusbabek" created="Thu, 3 Mar 2011 21:32:44 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[gdusbabek]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>20516</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            14 years, 38 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0ga47:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>93069</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12962"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>