<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 22:16:54 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-1527] ensure compaction thresholds are sane</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-1527</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;make sure min &amp;lt;= max and neither is negative.&lt;/p&gt;

&lt;p&gt;also make sure that min=max=0 works (this is &quot;no compaction&quot;)&lt;/p&gt;</description>
                <environment></environment>
        <key id="12474746">CASSANDRA-1527</key>
            <summary>ensure compaction thresholds are sane</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10003" iconUrl="https://issues.apache.org/jira/images/icons/priorities/trivial.svg">Low</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="jhermes">Jon Hermes</assignee>
                                    <reporter username="jbellis">Jonathan Ellis</reporter>
                        <labels>
                    </labels>
                <created>Tue, 21 Sep 2010 19:45:56 +0000</created>
                <updated>Tue, 16 Apr 2019 09:33:16 +0000</updated>
                            <resolved>Mon, 27 Sep 2010 22:10:44 +0000</resolved>
                                        <fixVersion>0.7 beta 2</fixVersion>
                                    <component>Legacy/CQL</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                                                                <comments>
                            <comment id="12913822" author="jhermes" created="Wed, 22 Sep 2010 22:33:57 +0000"  >&lt;p&gt;Because there are now too many ways to invalidate a metadata, I&apos;m going to enumerate them.&lt;/p&gt;

&lt;p&gt;1) Creation:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;First and foremost, catching these boundaries on the constructor fixes the case where the config is invalid. The config is read and DD.readTablesFromYaml() creates a CFMD for each CF.&lt;/li&gt;
	&lt;li&gt;This also catches &apos;schematool import&apos;, which hits SS.loadSchemasFromYaml() which hits DD.readTablesFromYaml() in the same way.&lt;/li&gt;
	&lt;li&gt;This also catches creation of an avro CfDef and loading it (generally, this is because we serialized it incorrectly). Calling CFMD.inflate(avro cfdef) will hit the constructor as well.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;2) Modification:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Throwing a runtime exception on the JMX CFS.setMin/MaxCompactionThreshold() methods will suffice to stop this invalidation point. This could be done a bit more kindly.&lt;/li&gt;
	&lt;li&gt;Catching these boundaries on CFMD.apply(avro/thrift def) limits the case where someone makes a def and then pushes it in. This is ALSO caught by the constructor.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Now, bad things. A constructor throwing a ConfigurationException is not the nicest thing in the world. These would be internal errors, as thrift/avro aren&apos;t always involved.&lt;/p&gt;</comment>
                            <comment id="12914651" author="jhermes" created="Fri, 24 Sep 2010 21:19:53 +0000"  >&lt;p&gt;Can&apos;t deal with the constructor throwing an exception, it&apos;s just too ugly.&lt;/p&gt;

&lt;p&gt;Current patch:&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;Adding validation to readTablesFromYaml()/loadSchemas() is pretty, and catches the erroneous config. This is necessarily different than the same validation for add/update API calls, as this is parsed and deflated immediately.&lt;/li&gt;
	&lt;li&gt;Explode on invalid JMX poking. To counter this, made disableAutoCompaction() pokeable (previously internal). This should help avoid the case where one goes to disable via JMX, sets max = 0 &amp;lt; min, and kills the node.&lt;/li&gt;
	&lt;li&gt;Leave inflate alone. If we deflate it incorrectly, then 1) was wrong.&lt;/li&gt;
	&lt;li&gt;CFMetaData has a validateMinMaxCTs() for both avro and thrift. When updating a CF, the method is called in CFMetaData.apply(). When adding a CF, the method is called in CassandraServer.convertToCFMetaData(). (This is duplicated based on protocol because there is no interface for &quot;a CfDef&quot; to deal with both avro and thrift at the same time, much in same way all the other methods in CFMetaData are duplicated.)&lt;/li&gt;
	&lt;li&gt;Check that apply validates correctly in DefsTest.&lt;/li&gt;
&lt;/ol&gt;
</comment>
                            <comment id="12914657" author="jhermes" created="Fri, 24 Sep 2010 21:33:43 +0000"  >&lt;p&gt;Now, for min=max=0, estimating the compactions &lt;em&gt;will currently&lt;/em&gt; explode if min == max.&lt;/p&gt;

&lt;p&gt;Estimated compactions are the sum of all (1 + size_i / thresholdrange) for i in SSTables with size &amp;gt; min. What do we want the estimated compactions to be when min == max (or thresholdrange=0)?&lt;br/&gt;
Furthermore, do we want to be estimating compactions when minor compactions are disabled?&lt;/p&gt;</comment>
                            <comment id="12915457" author="jbellis" created="Mon, 27 Sep 2010 20:06:56 +0000"  >&lt;blockquote&gt;&lt;p&gt;Estimated compactions are the sum of all (1 + size_i / thresholdrange) for i in SSTables with size &amp;gt; min&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;that looks buggy to me.  doesn&apos;t estimate of&lt;/p&gt;

&lt;p&gt;                n += Math.ceil((double)sstables.size() / maxct);&lt;/p&gt;

&lt;p&gt;make more sense?&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;do we want to be estimating compactions when minor compactions are disabled&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;no&lt;/p&gt;</comment>
                            <comment id="12915467" author="jhermes" created="Mon, 27 Sep 2010 20:29:15 +0000"  >&lt;p&gt;min=max is fine, min=0 || max=0 is fine.&lt;/p&gt;</comment>
                            <comment id="12915479" author="jhermes" created="Mon, 27 Sep 2010 21:07:37 +0000"  >&lt;p&gt;Patch error caused loss of code. That was unfortunate.&lt;/p&gt;</comment>
                            <comment id="12915480" author="jbellis" created="Mon, 27 Sep 2010 21:09:17 +0000"  >&lt;p&gt;can you add unit or system tests demonstrating rejection of invalid configurations?&lt;/p&gt;</comment>
                            <comment id="12915483" author="jbellis" created="Mon, 27 Sep 2010 21:12:57 +0000"  >&lt;p&gt;nvm, I see it in DefsTest.&lt;/p&gt;

&lt;p&gt;what is the commented-out code for in DD?  is that a todo that should be cleaned up?&lt;/p&gt;</comment>
                            <comment id="12915489" author="jhermes" created="Mon, 27 Sep 2010 21:24:25 +0000"  >&lt;p&gt;Oh, missed one!&lt;br/&gt;
The comments should be removed, the rest is valid.&lt;/p&gt;</comment>
                            <comment id="12915511" author="jbellis" created="Mon, 27 Sep 2010 22:10:44 +0000"  >&lt;p&gt;committed&lt;/p&gt;</comment>
                            <comment id="12915736" author="hudson" created="Tue, 28 Sep 2010 13:31:31 +0000"  >&lt;p&gt;Integrated in Cassandra #549 (See &lt;a href=&quot;https://hudson.apache.org/hudson/job/Cassandra/549/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://hudson.apache.org/hudson/job/Cassandra/549/&lt;/a&gt;)&lt;br/&gt;
    sanity checks for compaction thresholds.  &lt;br/&gt;
patch by jhermes; reviewed by jbellis for &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-1527&quot; title=&quot;ensure compaction thresholds are sane&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-1527&quot;&gt;&lt;del&gt;CASSANDRA-1527&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12455751" name="1527-unoopsed.txt" size="17419" author="jhermes" created="Mon, 27 Sep 2010 21:07:37 +0000"/>
                            <attachment id="12455748" name="1527.txt" size="11195" author="jhermes" created="Mon, 27 Sep 2010 20:29:15 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[jhermes]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>20179</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            15 years, 9 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0g5rb:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>92363</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12961"><![CDATA[Low]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>