<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 22:47:33 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-7585] cassandra sstableloader connection refused with inter_node_encryption</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-7585</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;cassandra sstableloader connection refused with inter_node_encryption&lt;/p&gt;

&lt;p&gt;When using sstableloader to import tables  (cassandra 2.0.5) with inter-node encryption and client encryption enabled, I get a connection refused error&lt;/p&gt;

&lt;p&gt;I am using&lt;/p&gt;

&lt;p&gt;sstableloader -d $myhost -p 9160 -u cassandra -pw cassandra -ciphers TLS_RSA_WITH_AES_128_CBC_SHA,TLS_DHE_RSA_WITH_AES_128_CBC_SHA,TLS_ECDHE_RSA_WITH_AES_128_CBC_SHA -st JKS  -tf org.apache.cassandra.thrift.SSLTransportFactory -ts /path/to/truststore  -tspw &amp;lt;passwd&amp;gt; $fullpath/$table&lt;/p&gt;

&lt;p&gt;Errors out with&lt;/p&gt;

&lt;p&gt;Streaming session ID: 1bc395c0-fbb2-11e3-9812-73da15121373&lt;br/&gt;
 WARN 17:13:34,147 Failed attempt 1 to connect to&lt;/p&gt;

&lt;p&gt;Similar problem reported in cassandra 2.0.8 by another user&lt;br/&gt;
&lt;a href=&quot;http://stackoverflow.com/questions/24390604/cassandra-sstableloader-connection-refused-with-inter-node-encryption&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://stackoverflow.com/questions/24390604/cassandra-sstableloader-connection-refused-with-inter-node-encryption&lt;/a&gt;&lt;br/&gt;
==================&lt;br/&gt;
Relevant cassandra.yaml snippet (with obfuscation)&lt;/p&gt;

&lt;p&gt;server_encryption_options:                                                                                              &lt;br/&gt;
    internode_encryption: all                                                                                          &lt;br/&gt;
    keystore:/path/to/keystore                                                                       &lt;br/&gt;
    keystore_password: &amp;lt;passwd&amp;gt;                                                                                        &lt;br/&gt;
    truststore:/path/to/truststore                                                                     &lt;br/&gt;
    truststore_password:&amp;lt;passwd&amp;gt;                                                                                     &lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;More advanced defaults below:&lt;br/&gt;
    protocol: TLS                                                                                                       &lt;br/&gt;
    algorithm: SunX509                                                                                                  &lt;br/&gt;
    store_type: JKS                                                                                                     &lt;br/&gt;
    cipher_suites: &lt;span class=&quot;error&quot;&gt;&amp;#91;TLS_RSA_WITH_AES_128_CBC_SHA,TLS_DHE_RSA_WITH_AES_128_CBC_SHA,TLS_ECDHE_RSA_WITH_AES_128_CBC_SHA&amp;#93;&lt;/span&gt;   &lt;br/&gt;
    require_client_auth: true                                                                                           &lt;/li&gt;
&lt;/ol&gt;


&lt;ol&gt;
	&lt;li&gt;enable or disable client/server encryption.&lt;br/&gt;
client_encryption_options:                                                                                              &lt;br/&gt;
    enabled: true                                                                                                       &lt;br/&gt;
    keystore: /path/to/keystore                                                                                &lt;br/&gt;
    keystore_password: &amp;lt;truststorepasswd&amp;gt;                                                                                        &lt;br/&gt;
    #require_client_auth: true                                                                                          &lt;/li&gt;
	&lt;li&gt;Set trustore and truststore_password if require_client_auth is true&lt;br/&gt;
    truststore:/path/to/truststore                                                                &lt;br/&gt;
    truststore_password: &amp;lt;truststorepasswd&amp;gt;                                                                                      &lt;/li&gt;
	&lt;li&gt;More advanced defaults below:&lt;br/&gt;
    protocol: TLS                                                                                                       &lt;br/&gt;
    algorithm: SunX509                                                                                                  &lt;br/&gt;
    store_type: JKS                                                                                                     &lt;br/&gt;
    cipher_suites: &lt;span class=&quot;error&quot;&gt;&amp;#91;TLS_RSA_WITH_AES_128_CBC_SHA,TLS_DHE_RSA_WITH_AES_128_CBC_SHA,TLS_ECDHE_RSA_WITH_AES_128_CBC_SHA&amp;#93;&lt;/span&gt; &lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;======================&lt;/p&gt;

&lt;p&gt;Note that by setting inter-node encryption to &quot;none&quot; sstableloader works.. but setting it to &quot;all&quot; fails... It seems like sstableloader uses 7000 is my guess instead of using the ssl port 7001 for streaming/gossip.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12728867">CASSANDRA-7585</key>
            <summary>cassandra sstableloader connection refused with inter_node_encryption</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10002" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Normal</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="yukim">Yuki Morishita</assignee>
                                    <reporter username="samnor">Samphel Norden</reporter>
                        <labels>
                    </labels>
                <created>Tue, 22 Jul 2014 14:28:23 +0000</created>
                <updated>Tue, 16 Apr 2019 09:31:39 +0000</updated>
                            <resolved>Fri, 15 Aug 2014 18:27:20 +0000</resolved>
                                        <fixVersion>2.0.10</fixVersion>
                    <fixVersion>2.1.1</fixVersion>
                                    <component>Legacy/Tools</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="14070446" author="yukim" created="Tue, 22 Jul 2014 16:18:15 +0000"  >&lt;p&gt;hmm, streaming determines whether to use secure connection based on settings in cassandra.yaml, which sstableloader does not require/load.&lt;br/&gt;
So it always connects none secure port.&lt;/p&gt;

&lt;p&gt;I think loading cassandra.yaml is not a noption since it does load unnecessary things that sometimes cause trouble on tools.&lt;br/&gt;
Maybe write custom config loader that just use part of cassandra.yaml is the way to go.&lt;/p&gt;</comment>
                            <comment id="14070463" author="samnor" created="Tue, 22 Jul 2014 16:29:08 +0000"  >&lt;p&gt;sstableloader always fails with connection refused, if internode encryption is on... The naive explanation (at least to me) is that it is somehow causing some activity on port 7000 between nodes (whether streaming is the reason is unknown) which is not the port on which nodes talk to each other when internode encryption is enabled... As I said above, sstableloader works correctly if only client to server encryption is enabled (that was a bug fixed in 2.0.4 IIRC). &lt;/p&gt;

&lt;p&gt;I think in both cases it is using the default ports 9160 and 7000. The client encryption part works fine since it also uses the default 9160 port even if client-to-server encryption is enabled.. The problem I think is that sstableloader is using 7000 (for unknown reasons) and the nodes no longer listen on 7000 when we have inter-node encryption enabled. Thats my speculative thinking. Whatever the reason might be, this is a critical bug for us since we have to enable encryption in enterprise deployments and need sstableloader to work for backup restores.&lt;/p&gt;
</comment>
                            <comment id="14070481" author="brandon.williams" created="Tue, 22 Jul 2014 16:41:15 +0000"  >&lt;blockquote&gt;&lt;p&gt;Maybe write custom config loader that just use part of cassandra.yaml is the way to go.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Couldn&apos;t we just add an option to specify the storage port?  IIRC, the main reason we had to avoid yaml loading was the static init caused all kinds of other problems.&lt;/p&gt;</comment>
                            <comment id="14071696" author="yukim" created="Wed, 23 Jul 2014 13:16:49 +0000"  >&lt;p&gt;This is not easy to fix since sstableloader is not topology-aware and server side encyption can be configured for just dc/rack.&lt;/p&gt;

&lt;p&gt;Possible work around for now is to use JMX bulkload which can be accessed through StorageService MBean and let Cassandra bulkload files. (You have to place your SSTables somewhere in that cassandra node first.)&lt;br/&gt;
It works the same as sstableloader.&lt;/p&gt;</comment>
                            <comment id="14088773" author="yukim" created="Thu, 7 Aug 2014 03:42:26 +0000"  >&lt;p&gt;Attaching patch against 2.0-HEAD.&lt;/p&gt;

&lt;p&gt;Patch introduces:&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;ConnectionFactory interface so that sstableloader tool can create necessary secure socket outside of DatabaseDescriptor.&lt;/li&gt;
	&lt;li&gt;Ability to load (subset of) cassandra.yaml for easily configure server_encryption_option plus other options like throughput and client_encryption_option through new -f &amp;lt;path/to/yaml&amp;gt; command line option.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Since sstableloader does not know any topology it&apos;s connecting, the tool will try to connect to secure port when server_encryption_options&apos; internode_encryption is either &apos;all&apos;, &apos;dc&apos; or &apos;rack&apos;.&lt;/p&gt;</comment>
                            <comment id="14089310" author="jbellis" created="Thu, 7 Aug 2014 15:02:04 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=krummas&quot; class=&quot;user-hover&quot; rel=&quot;krummas&quot;&gt;krummas&lt;/a&gt; to review (when he&apos;s back from vacation), unless someone else wants to tackle it first&lt;/p&gt;</comment>
                            <comment id="14089321" author="samnor" created="Thu, 7 Aug 2014 15:07:22 +0000"  >&lt;p&gt;Thanks for the patch.  After its been reviewed/verified of course...any chance this can be back ported to 2.0.5 since we are not using custom builds in our deployment. i.e.&lt;/p&gt;</comment>
                            <comment id="14089358" author="jbellis" created="Thu, 7 Aug 2014 15:47:04 +0000"  >&lt;p&gt;2.0.5 + 7585 would &lt;b&gt;be&lt;/b&gt; a custom build.  You should plan on running the stable release that this is committed to.&lt;/p&gt;</comment>
                            <comment id="14089367" author="yukim" created="Thu, 7 Aug 2014 15:54:09 +0000"  >&lt;p&gt;I haven&apos;t tried yet, but streaming protocol haven&apos;t changed in 2.0.5 to 2.0-head, so in theory, you can use latest (or patched) version of sstableloader to your 2.0.5 cassandra cluster.&lt;/p&gt;</comment>
                            <comment id="14089369" author="samnor" created="Thu, 7 Aug 2014 15:55:43 +0000"  >&lt;p&gt;Great. Looking forward to the patch getting into stable release...&lt;/p&gt;</comment>
                            <comment id="14095317" author="krummas" created="Wed, 13 Aug 2014 09:34:32 +0000"  >&lt;p&gt;Small comments;&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;Could we make it possible to state the server_encryption_options on the command line as well as via the config? The command will look horrible, but i think it makes it easier for people to script stuff instead of having to ship a .yaml file.&lt;/li&gt;
	&lt;li&gt;Perhaps highlight in the &apos;help&apos;-output what the difference is between the two encryption settings&lt;/li&gt;
	&lt;li&gt;We can remove the &apos;peer&apos;-parameter in StreamSession.createConnection (we are creating a connection for the session, and session knows the peer already)&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;other than that, +1&lt;/p&gt;</comment>
                            <comment id="14097146" author="yukim" created="Thu, 14 Aug 2014 16:05:36 +0000"  >&lt;blockquote&gt;&lt;p&gt;Could we make it possible to state the server_encryption_options on the command line as well as via the config? The command will look horrible...&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;That&apos;s why I added option to load yaml file. I could add 8 more command line options for server encryption but it seems redundant. I&apos;d rather deprecate the current way of setting client encryption options.&lt;br/&gt;
I think I can highlight this more in help string.&lt;/p&gt;

&lt;p&gt;Will update with other nits fixed.&lt;/p&gt;</comment>
                            <comment id="14097799" author="yukim" created="Thu, 14 Aug 2014 22:23:09 +0000"  >&lt;p&gt;Attaching updated patch with new usage doc. Added footer note describing config file.&lt;br/&gt;
&lt;tt&gt;sstableloader -h&lt;/tt&gt; output is also attached.&lt;/p&gt;</comment>
                            <comment id="14098550" author="krummas" created="Fri, 15 Aug 2014 13:44:28 +0000"  >&lt;p&gt;ok, +1&lt;/p&gt;</comment>
                            <comment id="14098887" author="yukim" created="Fri, 15 Aug 2014 18:27:20 +0000"  >&lt;p&gt;Committed, thanks!&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="13082746">CASSANDRA-13639</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12661910" name="7585-2.0-v2.txt" size="38456" author="yukim" created="Thu, 14 Aug 2014 22:23:09 +0000"/>
                            <attachment id="12660313" name="7585-2.0.txt" size="33119" author="yukim" created="Thu, 7 Aug 2014 03:42:26 +0000"/>
                            <attachment id="12661911" name="sstableloader-help.txt" size="3657" author="yukim" created="Thu, 14 Aug 2014 22:23:09 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[yukim]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>406941</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            11 years, 14 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1y0zb:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>406960</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>marcuse</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[marcuse]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12962"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>