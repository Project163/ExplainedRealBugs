<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 23:31:31 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-20084] WaitQueue.Signal.awaitUninterruptibly() may stuck forever if the invoking thread is interrupted</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-20084</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;The issue is reported based on an analysis done in &quot;Unexplained stuck memtable flush&quot; mail thread from Cassandra User/Dev groups.&lt;/p&gt;

&lt;p&gt;e2e observations: a Cassandra 4.1.1 cluster experiencing memtable flushes getting stuck in pending as shown in &lt;b&gt;StatusLogger&lt;/b&gt; logs. as a consequence all writes to memtables are stuck as well due to lack of memory in a memory pool. Eventually, it triggers an OOM. This problem has occurred randomly on different nodes within the same cluster.&#160;&lt;/p&gt;

&lt;p&gt;Based on the analysis of thread dump ( &lt;span class=&quot;nobr&quot;&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/13072864/13072864_cass_threads.txt.gz&quot; title=&quot;cass_threads.txt.gz attached to CASSANDRA-20084&quot;&gt;cass_threads.txt.gz&lt;sup&gt;&lt;img class=&quot;rendericon&quot; src=&quot;https://issues.apache.org/jira/images/icons/link_attachment_7.gif&quot; height=&quot;7&quot; width=&quot;7&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/sup&gt;&lt;/a&gt;&lt;/span&gt; ) and heap dump the following cause has been identified:&lt;br/&gt;
We have the following stacktrace for &quot;read-hotness-tracker:1&quot; thread&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-quote&quot;&gt;&quot;read-hotness-tracker:1&quot;&lt;/span&gt; daemon prio=5 tid=93 WAITING
    at jdk.internal.misc.Unsafe.park(Native Method)
    at java.util.concurrent.locks.LockSupport.park(LockSupport.java:323)
    at org.apache.cassandra.utils.concurrent.WaitQueue$Standard$AbstractSignal.await(WaitQueue.java:289)
       local variable: org.apache.cassandra.utils.concurrent.WaitQueue$Standard$SignalWithListener#2086139
    at org.apache.cassandra.utils.concurrent.WaitQueue$Standard$AbstractSignal.await(WaitQueue.java:282)
       local variable: org.apache.cassandra.utils.concurrent.WaitQueue$Standard$SignalWithListener#2086139
    at org.apache.cassandra.utils.concurrent.Awaitable$Defaults.awaitUninterruptibly(Awaitable.java:186)
       local variable: org.apache.cassandra.utils.concurrent.WaitQueue$Standard$SignalWithListener#2086139
    at org.apache.cassandra.utils.concurrent.Awaitable$AbstractAwaitable.awaitUninterruptibly(Awaitable.java:259)
    at org.apache.cassandra.db.commitlog.AbstractCommitLogService.awaitSyncAt(AbstractCommitLogService.java:324)
       local variable: org.apache.cassandra.db.commitlog.PeriodicCommitLogService#1
       local variable: com.codahale.metrics.Timer$Context#2086795
    at org.apache.cassandra.db.commitlog.PeriodicCommitLogService.maybeWaitForSync(PeriodicCommitLogService.java:42)
       local variable: org.apache.cassandra.db.commitlog.PeriodicCommitLogService#1
    at org.apache.cassandra.db.commitlog.AbstractCommitLogService.finishWriteFor(AbstractCommitLogService.java:284)
       local variable: org.apache.cassandra.db.commitlog.PeriodicCommitLogService#1
    at org.apache.cassandra.db.commitlog.CommitLog.add(CommitLog.java:307)
       local variable: org.apache.cassandra.db.commitlog.CommitLog#1
       local variable: org.apache.cassandra.io.util.DataOutputBuffer$1$1#61
       local variable: org.apache.cassandra.db.commitlog.CommitLogSegment$Allocation#1
    at org.apache.cassandra.db.CassandraKeyspaceWriteHandler.addToCommitLog(CassandraKeyspaceWriteHandler.java:100)
    at org.apache.cassandra.db.CassandraKeyspaceWriteHandler.beginWrite(CassandraKeyspaceWriteHandler.java:54)
       local variable: org.apache.cassandra.utils.concurrent.OpOrder$Group#8162
    at org.apache.cassandra.db.Keyspace.applyInternal(Keyspace.java:628)
       local variable: org.apache.cassandra.db.Keyspace#8
       local variable: org.apache.cassandra.db.Mutation#54491
    at org.apache.cassandra.db.Keyspace.apply(Keyspace.java:512)
    at org.apache.cassandra.db.Mutation.apply(Mutation.java:228)
    at org.apache.cassandra.db.Mutation.apply(Mutation.java:248)
    at org.apache.cassandra.cql3.statements.ModificationStatement.executeInternalWithoutCondition(ModificationStatement.java:675)
    at org.apache.cassandra.cql3.statements.ModificationStatement.executeLocally(ModificationStatement.java:666)
    at org.apache.cassandra.cql3.QueryProcessor.executeInternal(QueryProcessor.java:447)
    at org.apache.cassandra.db.SystemKeyspace.persistSSTableReadMeter(SystemKeyspace.java:1488)
       local variable: java.lang.&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;#42806
       local variable: java.lang.&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;#47659
       local variable: org.apache.cassandra.io.sstable.UUIDBasedSSTableId#1389
       local variable: org.apache.cassandra.metrics.RestorableMeter#752
    at org.apache.cassandra.io.sstable.format.SSTableReader$GlobalTidy$1.run(SSTableReader.java:2170)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;where we are waiting in the await() method of WaitQueue$Standard$SignalWithListener#2086139 object.&lt;/p&gt;

&lt;p&gt;another input from a heap dump: WaitQueue$Standard$SignalWithListener#2086139 has the following field values based on the heap dump screenshots:&lt;br/&gt;
state = -1 (it means CANCELLED: org.apache.cassandra.utils.concurrent.WaitQueue.Standard#CANCELLED = -1)&lt;br/&gt;
thread = null&lt;/p&gt;

&lt;p&gt;According to the code in WaitQueue.java such combination of values only possible if we invoked cancel() on this SignalWithListener object but we didn&apos;t do it in our code, it is in another branch of AbstractCommitLogService.awaitSyncAt&lt;/p&gt;

&lt;p&gt;but let&apos;s check the await() logic more carefully:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; Signal await() &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; InterruptedException
{
    &lt;span class=&quot;code-keyword&quot;&gt;while&lt;/span&gt; (!isSignalled())
    {
        checkInterrupted();
        LockSupport.park(); &amp;lt;--- we are here
    }
    checkAndClear();
    &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;;
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;and inspect unassuming checkInterrupted() method&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; void checkInterrupted() &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; InterruptedException
{
    &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.interrupted())
    {
        cancel();
        &lt;span class=&quot;code-keyword&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; InterruptedException();
    }
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;here we see that if the currently awaiting thread is interrupted then SignalWithListener cancels itself.&lt;br/&gt;
but we throw new InterruptedException() here, so the execution should fail with it.&lt;br/&gt;
Checking the thread stack trace and see that AbstractSignal.await() is invoked from org.apache.cassandra.utils.concurrent.Awaitable$AbstractAwaitable.awaitUninterruptibly(Awaitable.java:259)&lt;/p&gt;

&lt;p&gt;how it looks inside:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; &amp;lt;A &lt;span class=&quot;code-keyword&quot;&gt;extends&lt;/span&gt; Awaitable&amp;gt; A awaitUninterruptibly(A await)
{
    &lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt; interrupted = &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;;
    &lt;span class=&quot;code-keyword&quot;&gt;while&lt;/span&gt; (&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;)
    {
        &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt;
        {
            await.await();
            &lt;span class=&quot;code-keyword&quot;&gt;break&lt;/span&gt;;
        }
        &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt; (InterruptedException e)
        {
            interrupted = &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;;
        }
    }
    &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (interrupted)
        &lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.currentThread().interrupt();
    &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; await;
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Here we have a loop, if the current thread is interrupted - we have InterruptedException thrown by await.await(), we catch it here and try await.await() again. But in the previous invocation of await.await() we have cancelled our Signal object, so the condition inside await() method:&lt;br/&gt;
isSignalled(): state == SIGNALLED is always false now plus if another thread will invoke notifyAll - nothing will happen, because as a part of cancellation our Signal object unregister itself from the queue and the notifying thread will not able to find it to notify.&lt;br/&gt;
I have reproduced the case with a simple unit test.&lt;/p&gt;

&lt;p&gt;The last element of the puzzle - why is the thread interrupted? To understand it - let&apos;s check there &quot;read-hotness-tracker:1&quot; thread execution started. It is a background periodical runnable in org.apache.cassandra.io.sstable.format.SSTableReader.GlobalTidy&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
readMeterSyncFuture = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; WeakReference&amp;lt;&amp;gt;(syncExecutor.scheduleAtFixedRate(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;Runnable&lt;/span&gt;()
{
    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void run()
    {
        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (obsoletion == &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;)
        {
            meterSyncThrottle.acquire();
            SystemKeyspace.persistSSTableReadMeter(desc.ksname, desc.cfname, desc.id, readMeter);
        }
    }
}, 1, 5, TimeUnit.MINUTES));
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;let&apos;s check how we deal with readMeterSyncFuture ref and we see our interruption:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; void stopReadMeterPersistence()
{
    ScheduledFuture&amp;lt;?&amp;gt; readMeterSyncFutureLocal = readMeterSyncFuture.get();
    &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (readMeterSyncFutureLocal != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;)
    {
        readMeterSyncFutureLocal.cancel(&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;); &amp;lt;========= here we can interrupt the thread
        readMeterSyncFuture = NULL;
    }
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;stopReadMeterPersistence() is invoked by one of the following branches of logic when an SSTable is not in use anymore:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
org.apache.cassandra.io.sstable.format.SSTableReader#markObsolete
&#160; org.apache.cassandra.db.lifecycle.Helpers#markObsolete
&#160; &#160; org.apache.cassandra.db.lifecycle.Tracker#dropSSTables(...)
&#160; &#160; org.apache.cassandra.db.lifecycle.LifecycleTransaction#doCommit
&#160; &#160; org.apache.cassandra.db.lifecycle.LifecycleTransaction#doAbort
 &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;So,the issue is caused by a combination of events with a right timing:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;an SSTable which was become obsolete at the middle of persistSSTableReadMeter background job execution for this SSTable, so we interrupted the job&lt;/li&gt;
	&lt;li&gt;persistSSTableReadMeter was at that moment in the middle of write operation, at commit log append step&lt;/li&gt;
	&lt;li&gt;and the commit log append step was stuck due to a delay in commit log sync (lastSyncedAt &amp;lt; syncTime condition in AbstractCommitLogService), so we started to wait for it using await&lt;/li&gt;
&lt;/ul&gt;
</description>
                <environment></environment>
        <key id="13598910">CASSANDRA-20084</key>
            <summary>WaitQueue.Signal.awaitUninterruptibly() may stuck forever if the invoking thread is interrupted</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10002" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Normal</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="dnk">Dmitry Konstantinov</assignee>
                                    <reporter username="dnk">Dmitry Konstantinov</reporter>
                        <labels>
                    </labels>
                <created>Fri, 15 Nov 2024 11:33:46 +0000</created>
                <updated>Thu, 12 Jun 2025 19:53:04 +0000</updated>
                            <resolved>Mon, 3 Feb 2025 16:08:48 +0000</resolved>
                                        <fixVersion>4.1.9</fixVersion>
                    <fixVersion>5.0.4</fixVersion>
                    <fixVersion>5.1</fixVersion>
                                    <component>Legacy/Core</component>
                    <component>Local/Commit Log</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>7</watches>
                                                    <progress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                            <timeestimate seconds="0">0h</timeestimate>
                            <timespent seconds="3000">50m</timespent>
                                <comments>
                            <comment id="17898595" author="dnk" created="Fri, 15 Nov 2024 11:56:51 +0000"  >&lt;p&gt;The issue is introduced as a part of changes from &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-16924&quot; title=&quot;Blocking Concurrency Primitives&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-16924&quot;&gt;&lt;del&gt;CASSANDRA-16924&lt;/del&gt;&lt;/a&gt;, 4.1 version (commit: &lt;a href=&quot;https://github.com/apache/cassandra/commit/e5b92e108851d2be81c43cbf982564f92d28aa6b&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;e5b92e1&lt;/a&gt;) when a wrapping logic was introduced in Awaitable:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; &amp;lt;A &lt;span class=&quot;code-keyword&quot;&gt;extends&lt;/span&gt; Awaitable&amp;gt; A awaitUninterruptibly(A await)
    {
        &lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt; interrupted = &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;;
        &lt;span class=&quot;code-keyword&quot;&gt;while&lt;/span&gt; (&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;)
        {
            &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt;
            {
                await.await();
                &lt;span class=&quot;code-keyword&quot;&gt;break&lt;/span&gt;;
            }
            &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt; (InterruptedException e)
            {
                interrupted = &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;;
            }
        }
        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (interrupted)
            &lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.currentThread().interrupt();
        &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; await;
    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;and cancel was added as a reaction to interrupt in AbstractSignal.checkInterrupted()&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; void checkInterrupted() &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; InterruptedException
{
    &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.interrupted())
    {
        cancel();
        &lt;span class=&quot;code-keyword&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; InterruptedException();
    }
} &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;instead of a direct interrupt check within as we had before in WaitQueue$AbstractSignal:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void awaitUninterruptibly()
{
    &lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt; interrupted = &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;;
    &lt;span class=&quot;code-keyword&quot;&gt;while&lt;/span&gt; (!isSignalled())
    {
        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.interrupted())
            interrupted = &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;;
        LockSupport.park();
    }
    &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (interrupted)
        &lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.currentThread().interrupt();
    checkAndClear();
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="17898601" author="dnk" created="Fri, 15 Nov 2024 12:06:13 +0000"  >&lt;p&gt;A unit test to reproduce the issue:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;WaitQueueInterruptTest
{
    &lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; WaitQueue waitQueue = newWaitQueue();

    @Test(timeout = 5000)
    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void test() &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; InterruptedException
    {
        &lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt; writerAwaitThread = createThread(() -&amp;gt; {
            &lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.currentThread().interrupt();

            WaitQueue.Signal signal = waitQueue.register();
            signal.awaitUninterruptibly();

        }, &lt;span class=&quot;code-quote&quot;&gt;&quot;writer.await&quot;&lt;/span&gt;);

        writerAwaitThread.start();

        &lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.sleep(1000); &lt;span class=&quot;code-comment&quot;&gt;// to enter signal.awaitUninterruptibly()
&lt;/span&gt;        waitQueue.signalAll();

        writerAwaitThread.join();

    }

    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt; createThread(&lt;span class=&quot;code-object&quot;&gt;Runnable&lt;/span&gt; job, &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; name)
    {
        &lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt; thread = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;(() -&amp;gt; {
            &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.out.println(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.currentThread().getName() + &lt;span class=&quot;code-quote&quot;&gt;&quot; started&quot;&lt;/span&gt;);
            job.run();
            &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.out.println(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.currentThread().getName() + &lt;span class=&quot;code-quote&quot;&gt;&quot; done&quot;&lt;/span&gt;);
        }, name);
        thread.setDaemon(&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;);
        &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; thread;
    }
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="17903102" author="dnk" created="Wed, 4 Dec 2024 19:55:58 +0000"  >&lt;p&gt;MR for 4.1 branch: &lt;a href=&quot;https://github.com/apache/cassandra/pull/3724&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/cassandra/pull/3724&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17903196" author="dnk" created="Thu, 5 Dec 2024 06:55:07 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=benedict&quot; class=&quot;user-hover&quot; rel=&quot;benedict&quot;&gt;benedict&lt;/a&gt; could you please help with a review if you have time.&lt;/p&gt;</comment>
                            <comment id="17909288" author="dnk" created="Thu, 2 Jan 2025 11:34:41 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=benedict&quot; class=&quot;user-hover&quot; rel=&quot;benedict&quot;&gt;benedict&lt;/a&gt; , sorry for the annoyance, could you please take a look or recommend someone else who knows this logic?&lt;/p&gt;</comment>
                            <comment id="17909291" author="benedict" created="Thu, 2 Jan 2025 11:46:58 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=dnk&quot; class=&quot;user-hover&quot; rel=&quot;dnk&quot;&gt;dnk&lt;/a&gt; thanks for finding and debugging this problem. I think the simplest fix is to change the loop guard in &lt;tt&gt;AbstractSignal.await()&lt;/tt&gt; to test &lt;tt&gt;!isSet()&lt;/tt&gt;. WDYT? &lt;/p&gt;

&lt;p&gt;I think the same change should be made to &lt;tt&gt;AbstractSignal.awaitUntil&lt;/tt&gt;.&lt;/p&gt;

&lt;p&gt;It looks like this is in part due to the name clash with &lt;tt&gt;Awaitable.isSignalled&lt;/tt&gt; which has different meaning to &lt;tt&gt;AbstractSignal.isSignalled&lt;/tt&gt;, and perhaps we should consider renaming these methods to avoid the name clash.&lt;/p&gt;
</comment>
                            <comment id="17909308" author="dnk" created="Thu, 2 Jan 2025 13:26:50 +0000"  >&lt;p&gt;Yes, it was my initial idea too but I was not sure about this option because it can be considered as a change of semantics for: Signal.awaitUninterruptibly() contract. Javadoc for it says &quot;Await indefinitely, &lt;ins&gt;ignoring&lt;/ins&gt; interrupts (but maintaining the interrupt flag on exit). No spurious wakeups&quot; but we with isSet option an interrupt cancels a signal, so the interrupt is not fully ignored and has an impact on the result. At the same time the contract can be interpreted in a different way as well.&#160;&lt;/p&gt;

&lt;p&gt;Another thought: org.apache.cassandra.utils.concurrent.Future implements Awaitable as well and awaitUninterruptibly() waits for a result (but Future re-declares the method in his interface).&lt;/p&gt;

&lt;p&gt;In total, I see arguments for both options and cannot find a clear winner and your option is simpler, so I will follow your guidance + add a javadoc for awaitUninterruptibly in Signal to document the behaviour.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="17909319" author="dnk" created="Thu, 2 Jan 2025 14:59:39 +0000"  >&lt;p&gt;I have updated the MR (&lt;a href=&quot;https://github.com/apache/cassandra/pull/3724&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/cassandra/pull/3724&lt;/a&gt;).&lt;/p&gt;

&lt;p&gt;Regarding renaming - do you have some ideas? It looks like logically it is better to avoid using of &quot;signal&quot; term in Awaitable (while it of course affects more code compared to changing Signal). &quot;notify&quot; is already used by Object and can confuse too, other synonyms are: inform/announce ..&lt;/p&gt;</comment>
                            <comment id="17909394" author="benedict" created="Thu, 2 Jan 2025 18:31:25 +0000"  >&lt;p&gt;No, you&apos;re right. This is a deeper problem with trying to share implementation details between uninterruptible and non-interruptible variations for `AbstractSignal` specifically.&lt;/p&gt;

&lt;p&gt;The problem is that we invoke `cancel` inside `checkInterrupt` which is there to ensure we don&apos;t lose a signal for the regular `await` method (ensuring any signal that we may have received is then forwarded to another waiter). But, this is the wrong behaviour entirely for `awaitUninterruptibly`, as once we are cancelled we &lt;em&gt;cannot&lt;/em&gt; be signalled, so we&apos;re waiting pointlessly if we wait anymore.&lt;/p&gt;

&lt;p&gt;Probably the most straightforward thing to do for `AbstractSignal` is to rollback to the `awaitUninterruptibly` implementation (and a corresponding `awaitUntilUninterruptibly`) from before the patch that refactored this to share code (the other `Awaitable` classes can safely share code as they do not require these propagating semantics for lost signals).&lt;/p&gt;</comment>
                            <comment id="17909404" author="dnk" created="Thu, 2 Jan 2025 19:12:15 +0000"  >&lt;p&gt;yes, it is tricky, ok, I am returning back to the first version&lt;/p&gt;</comment>
                            <comment id="17909408" author="dnk" created="Thu, 2 Jan 2025 19:31:21 +0000"  >&lt;p&gt;&lt;a href=&quot;https://github.com/apache/cassandra/pull/3724&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/cassandra/pull/3724&lt;/a&gt; updated&lt;/p&gt;

&lt;p&gt;I have preserved isSet() usage too, it looks more correct and safer in case of an potential incorrect API usage&lt;/p&gt;</comment>
                            <comment id="17909794" author="benedict" created="Sat, 4 Jan 2025 20:37:37 +0000"  >&lt;p&gt;Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=dnk&quot; class=&quot;user-hover&quot; rel=&quot;dnk&quot;&gt;dnk&lt;/a&gt;. I am not sure it helps to share &lt;tt&gt;checkInterrupted&lt;/tt&gt; anymore though, and throwing and catching the &lt;tt&gt;InterruptedException&lt;/tt&gt; is more hoops than we need. The earlier version of &lt;tt&gt;awaitUninterruptibly&lt;/tt&gt; was I think clearer:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
        &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void awaitUninterruptibly()
        {
            &lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt; interrupted = &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;;
            &lt;span class=&quot;code-keyword&quot;&gt;while&lt;/span&gt; (!isSignalled())
            {
                &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.interrupted())
                    interrupted = &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;;
                LockSupport.park();
            }
            &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (interrupted)
                &lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.currentThread().interrupt();
            checkAndClear();
        }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I think &lt;tt&gt;checkInterrupted()&lt;/tt&gt; makes sense for the throwing methods, and simply assigning &lt;tt&gt;interrupted |= Thread.interrupted;&lt;/tt&gt; on each loop for the &lt;tt&gt;Uninterruptible&lt;/tt&gt; variants is sufficient. WDYT?&lt;/p&gt;
</comment>
                            <comment id="17909887" author="dnk" created="Sun, 5 Jan 2025 14:31:39 +0000"  >&lt;p&gt;Yes, I think it is more straightforward/easier to understand, I will apply the changes.&lt;/p&gt;

&lt;p&gt;Should it be actually like this? I have replaced isSignalled() with isSet() and removed checkAndClear() check (for awaitUntil it is still needed, of course).&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
        &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void awaitUninterruptibly()
        {
            &lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt; interrupted = &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;;
            &lt;span class=&quot;code-keyword&quot;&gt;while&lt;/span&gt; (!isSet())
            {
                &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.interrupted())
                    interrupted = &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;;
                LockSupport.park();
            }
            &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (interrupted)
                &lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.currentThread().interrupt();
            checkAndClear();
        } &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;update: checkAndClear cannot be removed as it is public and overridden in sub-class&lt;/p&gt;</comment>
                            <comment id="17909889" author="dnk" created="Sun, 5 Jan 2025 14:42:56 +0000"  >&lt;p&gt;Updated version: &lt;a href=&quot;https://github.com/apache/cassandra/pull/3724/files&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/cassandra/pull/3724/files&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17913314" author="dnk" created="Wed, 15 Jan 2025 13:33:19 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=benedict&quot; class=&quot;user-hover&quot; rel=&quot;benedict&quot;&gt;benedict&lt;/a&gt; , does the current version look ok for you?&lt;/p&gt;</comment>
                            <comment id="17915863" author="dnk" created="Tue, 21 Jan 2025 23:10:10 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=benedict&quot; class=&quot;user-hover&quot; rel=&quot;benedict&quot;&gt;benedict&lt;/a&gt;, sorry to disrupt you, I know, you are busy. If you can recommend somebody else to help with this review - it would be nice.&lt;/p&gt;</comment>
                            <comment id="17921743" author="brandon.williams" created="Tue, 28 Jan 2025 14:00:13 +0000"  >&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;Branch&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;CI&lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/driftx/cassandra/tree/CASSANDRA-20084-4.1&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;4.1&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://app.circleci.com/pipelines/github/driftx/cassandra/1829/workflows/e0080933-e666-498d-b6ab-39525f645c4d&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;j8&lt;/a&gt;, &lt;a href=&quot;https://app.circleci.com/pipelines/github/driftx/cassandra/1829/workflows/7a885f84-2c97-4582-a352-d154cfc1fb40&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;j11&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/driftx/cassandra/tree/CASSANDRA-20084-5.0&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;5.0&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://app.circleci.com/pipelines/github/driftx/cassandra/1828/workflows/74282f2e-3154-442b-8e5b-3e91d6e32c39&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;j11&lt;/a&gt;, &lt;a href=&quot;https://app.circleci.com/pipelines/github/driftx/cassandra/1828/workflows/9c6a921d-a0a4-4c1b-9070-bf99f72c4f72&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;j17&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/driftx/cassandra/tree/CASSANDRA-20084-trunk&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;trunk&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://app.circleci.com/pipelines/github/driftx/cassandra/1830/workflows/ee6f4000-38b1-455f-9e9e-07ac5d79ee4d&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;j11&lt;/a&gt;, &lt;a href=&quot;https://app.circleci.com/pipelines/github/driftx/cassandra/1830/workflows/cca70ca0-c0c4-4fe1-b77b-e9eab497370f&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;j17&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;
</comment>
                            <comment id="17922072" author="dnk" created="Wed, 29 Jan 2025 11:40:28 +0000"  >&lt;p&gt;CI runs check:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;&#160;4.1
	&lt;ul&gt;
		&lt;li&gt;j8 - no test failures for the completed part&lt;/li&gt;
		&lt;li&gt;j11 - no test failures for the completed part&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
	&lt;li&gt;5.0
	&lt;ul&gt;
		&lt;li&gt;j11
		&lt;ul&gt;
			&lt;li&gt;bootstrap_test.TestBootstrap.test_shutdown_wiped_node_cannot_join - flaky, present in Butler&lt;/li&gt;
			&lt;li&gt;bootstrap_test.TestBootstrap.test_decommissioned_wiped_node_can_join - flaky, present in Butler&lt;/li&gt;
			&lt;li&gt;bootstrap_test.TestBootstrap.test_read_from_bootstrapped_node - flaky, present in Butler&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
		&lt;li&gt;j17
		&lt;ul&gt;
			&lt;li&gt;bootstrap_test.TestBootstrap.test_killed_wiped_node_cannot_join - flaky, present in Butler&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;trunk
	&lt;ul&gt;
		&lt;li&gt;j11
		&lt;ul&gt;
			&lt;li&gt;read_repair_test.TestSpeculativeReadRepair.test_speculative_data_request - an existing test issue: &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-20194&quot; title=&quot;Test failure: read_repair_test.py::TestSpeculativeReadRepair&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-20194&quot;&gt;&lt;del&gt;CASSANDRA-20194&lt;/del&gt;&lt;/a&gt;&lt;/li&gt;
			&lt;li&gt;read_repair_test.TestSpeculativeReadRepair.test_failed_read_repair - an existing test issue: &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-20194&quot; title=&quot;Test failure: read_repair_test.py::TestSpeculativeReadRepair&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-20194&quot;&gt;&lt;del&gt;CASSANDRA-20194&lt;/del&gt;&lt;/a&gt;&lt;/li&gt;
			&lt;li&gt;read_repair_test.TestSpeculativeReadRepair.test_quorum_requirement_on_speculated_read - an existing test issue: &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-20194&quot; title=&quot;Test failure: read_repair_test.py::TestSpeculativeReadRepair&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-20194&quot;&gt;&lt;del&gt;CASSANDRA-20194&lt;/del&gt;&lt;/a&gt;&lt;/li&gt;
			&lt;li&gt;org.apache.cassandra.fuzz.sai.MultiNodeSAITest-_jdk11 - &lt;a href=&quot;https://app.circleci.com/pipelines/github/driftx/cassandra/1830/workflows/ee6f4000-38b1-455f-9e9e-07ac5d79ee4d/jobs/112053/parallel-runs/4?filterBy=FAILED&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;test execution stuck&lt;/a&gt; (&quot;too long with no output (exceeded 15m0s): context deadline exceeded&quot;)&lt;/li&gt;
			&lt;li&gt;org.apache.cassandra.simulator.test.ShortPaxosSimulationTest - &quot;Forked Java VM exited abnormally.&quot;, &lt;a href=&quot;https://app.circleci.com/pipelines/github/driftx/cassandra/1830/workflows/ee6f4000-38b1-455f-9e9e-07ac5d79ee4d/jobs/112022?invite=true#step-104-4141_98&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;link&lt;/a&gt;&lt;/li&gt;
			&lt;li&gt;topology_test.TestTopology.test_resumable_decommission - flaky (&lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-19542&quot; title=&quot;Test Failure: test_resumable_decommission&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-19542&quot;&gt;CASSANDRA-19542&lt;/a&gt;)&lt;/li&gt;
			&lt;li&gt;&lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/help_16.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; org.apache.cassandra.fuzz.sai.MultiNodeSAITest.basicSaiTest-cassandra.testtag_IS_UNDEFINED - Timeout occurred, &lt;a href=&quot;https://app.circleci.com/pipelines/github/driftx/cassandra/1830/workflows/ee6f4000-38b1-455f-9e9e-07ac5d79ee4d/jobs/112038/parallel-runs/4?invite=true#step-104-59650_151&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;link&lt;/a&gt;, reported as timed out as well in &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-19966&quot; title=&quot;CREATE TABLE LIKE for table with UDT&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-19966&quot;&gt;&lt;del&gt;CASSANDRA-19966&lt;/del&gt;&lt;/a&gt;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;
	&lt;ul&gt;
		&lt;li&gt;j17
		&lt;ul&gt;
			&lt;li&gt;read_repair_test.TestSpeculativeReadRepair.test_quorum_requirement&#160;- an existing test issue: &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-20194&quot; title=&quot;Test failure: read_repair_test.py::TestSpeculativeReadRepair&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-20194&quot;&gt;&lt;del&gt;CASSANDRA-20194&lt;/del&gt;&lt;/a&gt;&lt;/li&gt;
			&lt;li&gt;read_repair_test.TestSpeculativeReadRepair.test_speculative_write&#160;- an existing test issue: &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-20194&quot; title=&quot;Test failure: read_repair_test.py::TestSpeculativeReadRepair&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-20194&quot;&gt;&lt;del&gt;CASSANDRA-20194&lt;/del&gt;&lt;/a&gt;&lt;/li&gt;
			&lt;li&gt;&lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/help_16.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; org.apache.cassandra.fuzz.sai.MultiNodeSAITest.basicSaiTest-cassandra.testtag_IS_UNDEFINED - Timeout occurred, &lt;a href=&quot;https://app.circleci.com/pipelines/github/driftx/cassandra/1830/workflows/cca70ca0-c0c4-4fe1-b77b-e9eab497370f/jobs/111980/parallel-runs/4?invite=true#step-104-55550_113&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;link&lt;/a&gt;, reported as timed out as well in &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-19966&quot; title=&quot;CREATE TABLE LIKE for table with UDT&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-19966&quot;&gt;&lt;del&gt;CASSANDRA-19966&lt;/del&gt;&lt;/a&gt;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="17922095" author="smiklosovic" created="Wed, 29 Jan 2025 14:07:20 +0000"  >&lt;p&gt;Just FYI, we need the second explicit +1 from somebody (Benedict&apos;s approval on PR counts as the first one). &quot;needs committer&quot; status of this ticket reflects that.&lt;/p&gt;</comment>
                            <comment id="17922523" author="jmckenzie" created="Thu, 30 Jan 2025 20:20:22 +0000"  >&lt;p&gt;+1 from me w/one nit on numbering in modified class doc header.&lt;/p&gt;</comment>
                            <comment id="17922524" author="dnk" created="Thu, 30 Jan 2025 20:25:22 +0000"  >&lt;p&gt;Thank you, the numbering is fixed&lt;/p&gt;</comment>
                            <comment id="17923354" author="jmckenzie" created="Mon, 3 Feb 2025 16:08:48 +0000"  >&lt;p&gt;Committed to 4.1 and merged up. Thanks for the patch Dmitry!&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310560">
                    <name>Problem/Incident</name>
                                                                <inwardlinks description="is caused by">
                                        <issuelink>
            <issuekey id="13400061">CASSANDRA-16924</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="13072864" name="cass_threads.txt.gz" size="40450" author="dnk" created="Fri, 15 Nov 2024 11:38:42 +0000"/>
                            <attachment id="13072865" name="heap_dump_vars_state.png" size="97787" author="dnk" created="Fri, 15 Nov 2024 11:39:20 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[dnk]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12313825" key="com.atlassian.jira.plugin.system.customfieldtypes:cascadingselect">
                        <customfieldname>Bug Category</customfieldname>
                        <customfieldvalues>
                                                    <customfieldvalue key="12983" cascade-level=""><![CDATA[Availability]]></customfieldvalue>
                                <customfieldvalue key="12994" cascade-level="1"><![CDATA[Unavailable]]></customfieldvalue>
            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12313821" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Complexity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12965"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313822" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Discovered By</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12969"><![CDATA[User Report]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12313922" key="jira.plugin.projectspecificselectfield.jpssf:multicftype">
                        <customfieldname>Impacts</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="13100"><![CDATA[None]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            40 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12313921" key="jira.plugin.projectspecificselectfield.jpssf:multicftype">
                        <customfieldname>Platform</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="13076"><![CDATA[All]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z1skyg:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[benedict]]></customfieldvalue>
        <customfieldvalue><![CDATA[jmckenzie]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12962"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12311420" key="com.atlassian.jira.plugin.system.customfieldtypes:version">
                        <customfieldname>Since Version</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="12352689">4.1.0</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313924" key="com.atlassian.jira.plugin.system.customfieldtypes:textfield">
                        <customfieldname>Source Control Link</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>&lt;p&gt;&lt;a href=&quot;https://github.com/apache/cassandra/commit/68b74253329dc95a4b15dd23531caa2f5c439a7f&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/cassandra/commit/68b74253329dc95a4b15dd23531caa2f5c439a7f&lt;/a&gt;&lt;/p&gt;</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313823" key="com.atlassian.jira.plugin.system.customfieldtypes:textarea">
                        <customfieldname>Test and Documentation Plan</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>&lt;p&gt;a unit test is added for the failing use case&lt;/p&gt;</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>