<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 22:57:54 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-10277] Empty BATCH throws exception in Cassandra</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-10277</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;Connect to Cassandra with cqlsh and perform empty BATCH statement:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;BEGIN BATCH  APPLY BATCH;&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Following exception is thrown and logged&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;ERROR 14:02:07 Unexpected exception during request
java.lang.IndexOutOfBoundsException: Index: 0, Size: 0
	at java.util.ArrayList.rangeCheck(ArrayList.java:653) ~[na:1.8.0_45]
	at java.util.ArrayList.get(ArrayList.java:429) ~[na:1.8.0_45]
	at org.apache.cassandra.cql3.statements.BatchStatement$Parsed.prepare(BatchStatement.java:514) ~[main/:na]
...........................
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;It&apos;s caused because of access to batch statement list, even if it&apos;s empty.&lt;br/&gt;
Proposed patch (for 2.2.0) is attached.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12862229">CASSANDRA-10277</key>
            <summary>Empty BATCH throws exception in Cassandra</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10003" iconUrl="https://issues.apache.org/jira/images/icons/priorities/trivial.svg">Low</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="vovodroid">Vovodroid</reporter>
                        <labels>
                    </labels>
                <created>Mon, 7 Sep 2015 14:19:36 +0000</created>
                <updated>Tue, 16 Apr 2019 09:30:57 +0000</updated>
                            <resolved>Thu, 17 Sep 2015 19:54:25 +0000</resolved>
                                        <fixVersion>2.2.2</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="14739321" author="mshuler" created="Thu, 10 Sep 2015 18:36:48 +0000"  >&lt;p&gt;lgtm.&lt;br/&gt;
pre-patch:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;$ cqlsh 
Connected to Test Cluster at 127.0.0.1:9042.
[cqlsh 5.0.1 | Cassandra 2.2.1-SNAPSHOT | CQL spec 3.3.0 | Native protocol v4]
Use HELP for help.
cassandra@cqlsh&amp;gt; BEGIN BATCH  APPLY BATCH;
ServerError: &amp;lt;ErrorMessage code=0000 [Server error] message=&quot;java.lang.IndexOutOfBoundsException: Index: 0, Size: 0&quot;&amp;gt;
cassandra@cqlsh&amp;gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;post-patch (no logged exception any longer, either):&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;$ cqlsh 
Connected to Test Cluster at 127.0.0.1:9042.
[cqlsh 5.0.1 | Cassandra 2.2.1-SNAPSHOT | CQL spec 3.3.0 | Native protocol v4]
Use HELP for help.
cassandra@cqlsh&amp;gt; BEGIN BATCH  APPLY BATCH;
cassandra@cqlsh&amp;gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="14739329" author="mshuler" created="Thu, 10 Sep 2015 18:39:30 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=vovodroid&quot; class=&quot;user-hover&quot; rel=&quot;vovodroid&quot;&gt;vovodroid&lt;/a&gt; would you be willing to take a stab at adding a unit test for empty batch calls and posting an updated patch?&lt;/p&gt;</comment>
                            <comment id="14739353" author="vovodroid" created="Thu, 10 Sep 2015 18:53:38 +0000"  >&lt;p&gt;OK, I just need to learn how to do this. Can you point me to some direction?&lt;br/&gt;
Thanks.&lt;/p&gt;</comment>
                            <comment id="14739690" author="mshuler" created="Thu, 10 Sep 2015 21:59:45 +0000"  >&lt;p&gt;This has some batch validation tests and it looks like it might be a good place to add one for an empty statement:  &lt;tt&gt;test/unit/org/apache/cassandra/cql3/validation/operations/BatchTest.java&lt;/tt&gt;&lt;/p&gt;</comment>
                            <comment id="14741181" author="vovodroid" created="Fri, 11 Sep 2015 17:22:33 +0000"  >&lt;p&gt;emptytest.patch - test method testBatchEmpty in BatchTest class&lt;/p&gt;</comment>
                            <comment id="14741245" author="mshuler" created="Fri, 11 Sep 2015 17:56:30 +0000"  >&lt;p&gt;Thanks!&lt;br/&gt;
pre-patch fails as expected:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;$ ant test -Dtest.name=BatchTest
    [junit] Tests run: 5, Failures: 0, Errors: 1, Skipped: 0, Time elapsed: 1.749 sec
    [junit]
    [junit] Testcase: testBatchEmpty(org.apache.cassandra.cql3.validation.operations.BatchTest):        Caused an ERROR
    [junit] Index: 0, Size: 0
    [junit] java.lang.IndexOutOfBoundsException: Index: 0, Size: 0
    [junit]     at java.util.ArrayList.rangeCheck(ArrayList.java:653)
    [junit]     at java.util.ArrayList.get(ArrayList.java:429)
    [junit]     at org.apache.cassandra.cql3.statements.BatchStatement$Parsed.prepare(BatchStatement.java:514)
    [junit]     at org.apache.cassandra.cql3.QueryProcessor.getStatement(QueryProcessor.java:498)
    [junit]     at org.apache.cassandra.cql3.QueryProcessor.parseStatement(QueryProcessor.java:261)
    [junit]     at org.apache.cassandra.cql3.QueryProcessor.executeOnceInternal(QueryProcessor.java:333)
    [junit]     at org.apache.cassandra.cql3.CQLTester.execute(CQLTester.java:574)
    [junit]     at org.apache.cassandra.cql3.validation.operations.BatchTest.testBatchEmpty(BatchTest.java:110)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;..and passes when patched.&lt;/p&gt;</comment>
                            <comment id="14741250" author="mshuler" created="Fri, 11 Sep 2015 17:58:55 +0000"  >&lt;p&gt;10277.txt combined patch attached.&lt;/p&gt;</comment>
                            <comment id="14741315" author="jbellis" created="Fri, 11 Sep 2015 18:36:07 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=blerer&quot; class=&quot;user-hover&quot; rel=&quot;blerer&quot;&gt;blerer&lt;/a&gt; to review&lt;/p&gt;</comment>
                            <comment id="14747158" author="blerer" created="Wed, 16 Sep 2015 08:48:00 +0000"  >&lt;p&gt;It is looking good to me.&lt;br/&gt;
Waiting for the CI results.&lt;/p&gt;</comment>
                            <comment id="14790989" author="blerer" created="Wed, 16 Sep 2015 19:20:49 +0000"  >&lt;ul&gt;
	&lt;li&gt;the unit test results for 2.2 are &lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/blerer/job/blerer-10277-2.2-testall/1/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;here&lt;/a&gt;&lt;/li&gt;
	&lt;li&gt;the dtest results for 2.2 are &lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/blerer/job/blerer-10277-2.2-dtest/1/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;here&lt;/a&gt;&lt;/li&gt;
	&lt;li&gt;the unit test results for 3.0 are &lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/blerer/job/blerer-10277-3.0-dtest/2/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;here&lt;/a&gt;&lt;/li&gt;
	&lt;li&gt;the dtest results for 3.0 are &lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/blerer/job/blerer-10277-3.0-testall/2/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;here&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;+1&lt;/p&gt;

&lt;p&gt;Thanks for patch&lt;/p&gt;</comment>
                            <comment id="14804358" author="blerer" created="Thu, 17 Sep 2015 19:54:25 +0000"  >&lt;p&gt;commit: 1a2a1d2c24b777d4c9ea9106e0e7199c7b91fa29&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12755458" name="10277.txt" size="1618" author="mshuler" created="Fri, 11 Sep 2015 17:58:55 +0000"/>
                            <attachment id="12754499" name="emptybatch.patch" size="1013" author="vovodroid" created="Mon, 7 Sep 2015 14:19:36 +0000"/>
                            <attachment id="12755449" name="emptytest.patch" size="605" author="vovodroid" created="Fri, 11 Sep 2015 17:33:10 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 9 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2juw7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12311421" key="com.atlassian.jira.plugin.system.customfieldtypes:multiversion">
                        <customfieldname>Reproduced In</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="12333319">2.2.2</customfieldvalue>
    <customfieldvalue id="12332955">3.0.0 rc1</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>blerer</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[blerer]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12961"><![CDATA[Low]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>