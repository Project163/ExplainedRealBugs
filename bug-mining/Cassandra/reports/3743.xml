<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 22:56:07 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-9462] ViewTest.sstableInBounds is failing</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-9462</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-8568&quot; title=&quot;Extend Transactional API to sstable lifecycle management&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-8568&quot;&gt;&lt;del&gt;CASSANDRA-8568&lt;/del&gt;&lt;/a&gt; introduced new tests to cover what was DataTracker functionality in 2.1, and is now covered by the lifecycle package. This particular test indicates this method does not fulfil the expected contract, namely that more sstables are returned than should be.&lt;/p&gt;

&lt;p&gt;However while looking into it I noticed it also likely has a bug (which I have not updated the test to cover) wherein a wrapped range will only yield the portion at the end of the token range, not the beginning. It looks like we may have call sites using this function that do not realise this, so it could be a serious bug, especially for repair.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12832268">CASSANDRA-9462</key>
            <summary>ViewTest.sstableInBounds is failing</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10002" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Normal</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="aweisberg">Ariel Weisberg</assignee>
                                    <reporter username="benedict">Benedict Elliott Smith</reporter>
                        <labels>
                    </labels>
                <created>Fri, 22 May 2015 21:05:50 +0000</created>
                <updated>Tue, 16 Apr 2019 09:31:09 +0000</updated>
                            <resolved>Fri, 14 Aug 2015 18:29:14 +0000</resolved>
                                        <fixVersion>2.2.1</fixVersion>
                    <fixVersion>3.0 beta 1</fixVersion>
                                    <component>Legacy/Local Write-Read Paths</component>
                    <component>Legacy/Streaming and Messaging</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>6</watches>
                                                                                                                <comments>
                            <comment id="14570376" author="benedict" created="Wed, 3 Jun 2015 06:50:42 +0000"  >&lt;p&gt;I&apos;ve pushed a branch &lt;a href=&quot;https://github.com/belliottsmith/cassandra/tree/9516&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;here&lt;/a&gt; to attempt to deal with this, since I had a half-completed implementation from &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-8568&quot; title=&quot;Extend Transactional API to sstable lifecycle management&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-8568&quot;&gt;&lt;del&gt;CASSANDRA-8568&lt;/del&gt;&lt;/a&gt; (that when I realised the scale of the problem, I decided was out of scope for that ticket). &lt;/p&gt;

&lt;p&gt;In doing so, I noticed some more problems / inconsistencies: AbstractBounds provides an unwrap() method, but it is a no-op unless the bound is a Range. This isn&apos;t at all clear, and I suspect we have been using AB with the assumption they could also wrap. I&apos;ve inserted an assertion in bounds construction to ensure we never create a bound that wraps that is not a Range. This branch, as a result, is exploratory: whether or not CI breaks, we should probably remove the assertions and implement the unwrap() method, as introducing assertions like those could cause currently broken functionality not caught in tests to fail hard in the field.&lt;/p&gt;

&lt;p&gt;Ultimately, I think I would prefer that we flatten the different AbstractBounds classes into one Bounds implementation for this ticket. Which probably means different patches for 2.1/2.2 and 3.0.&lt;/p&gt;</comment>
                            <comment id="14570403" author="benedict" created="Wed, 3 Jun 2015 07:13:57 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=slebresne&quot; class=&quot;user-hover&quot; rel=&quot;slebresne&quot;&gt;slebresne&lt;/a&gt;: do you have any thoughts to this restructure, any input on the history of this class, and, particularly, on if implementing unwrap() for all versions of AbstractBounds is illadvised for some reason?&lt;/p&gt;</comment>
                            <comment id="14574757" author="slebresne" created="Fri, 5 Jun 2015 16:13:47 +0000"  >&lt;blockquote&gt;&lt;p&gt;I&apos;ve inserted an assertion in bounds construction to ensure we never create a bound that wraps that is not a Range.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;This is already asserted in the actual implementations ctors (Bounds, IncludingExcludingBounds and ExcludingBounds).&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;any input on the history of this class&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;What I can tell you is that we used to only have the &lt;tt&gt;Range&lt;/tt&gt; class, which is the one that is the most used since our token ranges are really &lt;tt&gt;Range&lt;/tt&gt;). That&apos;s also why &lt;tt&gt;Range&lt;/tt&gt; has some methods the other don&apos;t have like &lt;tt&gt;normalize&lt;/tt&gt; and &lt;tt&gt;deoverlap&lt;/tt&gt; (we never bothered generalizing those methods to the other implementation because we haven&apos;t had a need for it). That&apos;s also why the other version are not allowed to wrap: we hadn&apos;t needed it so far so that was simpler.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;if implementing unwrap() for all versions of AbstractBounds is illadvised for some reason?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Well, as said above, the other versions can&apos;t wrap by construction so their &lt;tt&gt;unwrap&lt;/tt&gt; is properly implemented.&lt;/p&gt;


&lt;p&gt;I haven&apos;t really look at the test failure though, so I don&apos;t understand yet what the problem is and why you think &lt;tt&gt;AbstractBounds&lt;/tt&gt; is to be blame (if you could clarify, that would be awesome). I&apos;m not particularly in love with the current AbstractBound classes implementation so I have sympathy for the idea of cleaning them up a bit, but I think we still need to understand what problem we&apos;re trying to solve and which risks/benefits there is before rushing into it.&lt;/p&gt;</comment>
                            <comment id="14575216" author="aweisberg" created="Fri, 5 Jun 2015 21:01:54 +0000"  >&lt;p&gt;I have something for this. It&apos;s not done. At the very least I want to add tests for the additional and involved functionality in this ticket I a still getting a handle on what the correct behavior for these things is.&lt;/p&gt;

&lt;p&gt;I need to take a look at unwrap to see if it is supposed to work differently for different kinds of inclusive/exclusive combinations.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/apache/cassandra/compare/trunk...aweisberg:C-9462?expand=1&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/cassandra/compare/trunk...aweisberg:C-9462?expand=1&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14579869" author="mshuler" created="Wed, 10 Jun 2015 02:13:26 +0000"  >&lt;p&gt;The dtest for this dev branch has run for long periods on two occasions and has needed to be killed. Builds #1 and #5. Just a little info &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="14580560" author="aweisberg" created="Wed, 10 Jun 2015 14:12:54 +0000"  >&lt;p&gt;Minor changes ended up having a knock-on effect and I can&apos;t really tell if what I did was an improvement or not. Implementations of several things that used to consist of some fairly compact comapareTos now has to do a bunch of isMinimum checking.&lt;/p&gt;

&lt;p&gt;My understanding is that min() on the RHS is max() and does not wrap. The existing code seemed inconsistent about this and when I made it consistent it broke implementations of various functions until I fixed them.&lt;/p&gt;

&lt;p&gt;I also found things that seemed inconsistent WRT to handling left/right inclusive/exclusive and making that accurate exposed some unhappiness.&lt;/p&gt;

&lt;p&gt;The output from this test changed slightly, but still looks mostly the same and I can&apos;t tell if the new output is correct.&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/cassandra/compare/trunk...aweisberg:C-9462#diff-ec7f7df91e07f7bac10771e53e47d5f9R178&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/cassandra/compare/trunk...aweisberg:C-9462#diff-ec7f7df91e07f7bac10771e53e47d5f9R178&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;In BigTableScanner this predicate seemed wrong since the LHS is not inclusive for Ranges.&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/cassandra/compare/trunk...aweisberg:C-9462#diff-48eb42c4ff781629d891a7ff2e878f6bL138&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/cassandra/compare/trunk...aweisberg:C-9462#diff-48eb42c4ff781629d891a7ff2e878f6bL138&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;The rest of the changes are internal to AbstractBounds and implementations and &quot;all the tests pass&quot; and for the things I changed I tried to add tests to express their behaviors so those will be good fodder for review. If we can get the tests right it&apos;s easy to get the behavior to match.&lt;/p&gt;

&lt;p&gt;After review I can remove the legacy functions that I kept for tests or move them into the test class.&lt;/p&gt;</comment>
                            <comment id="14580564" author="slebresne" created="Wed, 10 Jun 2015 14:19:34 +0000"  >&lt;blockquote&gt;&lt;p&gt;I haven&apos;t really look at the test failure though, so I don&apos;t understand yet what the problem is and why you think AbstractBounds is to be blame (if you could clarify, that would be awesome).&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I would still appreciate some clarification on this.&lt;/p&gt;</comment>
                            <comment id="14580749" author="aweisberg" created="Wed, 10 Jun 2015 16:28:04 +0000"  >&lt;p&gt;JIRA just ate my response which really really sucks.&lt;/p&gt;

&lt;p&gt;IntervalTree for (0, 0), (1,1) search for IncludingExcludingBound (0,1) returns a wrong answer. Benedict tried to fix it for SSTableIntervalTree by overriding search. I then tried to make all the tests pass with that implementation which lead to writing tests for the inconsistent (or maybe not, hard to tell) implementation of methods inside AbstractBounds and Range, making them consistent, and then fixing the fallout from that.&lt;/p&gt;

&lt;p&gt;I am going to try again and see if I can just fix IntervalTree. I didn&apos;t expect to spend a week getting the tests passing on the original fix, but it was probably necessary anyways just to understand what is going on. AFAIK existing code works around the inconsistencies and higher level modules have some tests that maybe validate that they are using AbstractBounds and family correctly.&lt;/p&gt;

&lt;p&gt;It&apos;s also possible the entire thing was a waste and we should just make IntervalTree reject IncludingExcludingBounds? This is kind of why I want someone with more context to review.&lt;/p&gt;
</comment>
                            <comment id="14580894" author="aweisberg" created="Wed, 10 Jun 2015 18:06:10 +0000"  >&lt;p&gt;I found out why Benedict had to implement search for SSTableIntervalTree. IntervalTree relies on comparable for the bounds and nothing else so it doesn&apos;t know if the bounds are inclusive/exclusive.&lt;/p&gt;

&lt;p&gt;Now whether SSTableIntervalTree needs to handle all the different kinds of bounds? Maybe that is a question still worth asking.&lt;/p&gt;

&lt;p&gt;If that is the case, then the changes are basically fall out from me &quot;fixing&quot; the original SSTableIntervalTree search and adding tests for the methods and then making them consistent.&lt;/p&gt;</comment>
                            <comment id="14580901" author="aweisberg" created="Wed, 10 Jun 2015 18:15:37 +0000"  >&lt;p&gt;I took the tests from the branch and ran them on trunk just to see the difference in what I implemented. On trunk in RangeTest these two assertions fail. On the branch I operated under the assumption that min() on the right is max() and thus it can&apos;t wrap.&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;assertFalse(makeRange(MIN, MIN).isWrapAround());
assertFalse(makeRange(3, MIN).isWrapAround());
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;There are also failures for isEmpty(). These all pass on the branch but fail on trunk.&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;assertFalse(AbstractBounds.isEmpty(bound(1, false), bound(1, true)));
assertFalse(AbstractBounds.isEmpty(bound(1, true), bound(MIN, false)));
assertFalse(AbstractBounds.isEmpty(bound(1, false), bound(MIN, false)));
assertFalse(AbstractBounds.isEmpty(bound(1, false), bound(MIN, true)));
assertFalse(AbstractBounds.isEmpty(bound(1, true), bound(MIN, true)));
assertFalse(AbstractBounds.isEmpty(bound(MIN, true), bound(MIN, false)));
assertFalse(AbstractBounds.isEmpty(bound(MIN, false), bound(MIN, false)));
assertFalse(AbstractBounds.isEmpty(bound(MIN, false), bound(MIN, true)));
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I would say that this disagreement is what prompts a lot of the changes.&lt;/p&gt;</comment>
                            <comment id="14581200" author="benedict" created="Wed, 10 Jun 2015 23:05:16 +0000"  >&lt;blockquote&gt;&lt;p&gt;However while looking into it I noticed it &lt;b&gt;also&lt;/b&gt; likely has a bug (&lt;b&gt;which I have not updated the test to cover&lt;/b&gt;) wherein a wrapped range will only yield the portion at the end of the token range, not the beginning. It looks like we may have call sites using this function that do not realise this, so it could be a serious bug, especially for repair.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;This is actually the most serious problem that caused me to consider this a really important bug to fix, and I discovered it while trying to fix the more minor bug that ViewTest.sstableInBounds located. It looks like its semantics don&apos;t work at least as I would expect for Range objects, since it ignores any wrap-around portion. Whether or not this constitutes an actual bug in use is, not clear to me, but I could not convince myself it wasn&apos;t.&lt;/p&gt;

&lt;p&gt;Fixing this other bug turned out to be surprisingly challenging and error prone, though, largely down to the inconsistencies of the current class hierarchy, and the confusion around semantics as Ariel points out. As you said on IRC, &quot;it&apos;s a shit show, for sure&quot; - I&apos;m probably the second-most-eminent expert on these classes now, and given how much I mess up with them, it&apos;s evident I don&apos;t really understand them very well at all. So it was &lt;em&gt;my &lt;b&gt;view&lt;/b&gt;&lt;/em&gt; that for the benefit of a majority of the project, we should take this opportunity to fix the hierarchy as well as fixing these issues, since &lt;em&gt;really&lt;/em&gt; their semantics should be tremendously simple to understand.&lt;/p&gt;</comment>
                            <comment id="14611785" author="slebresne" created="Thu, 2 Jul 2015 10:39:45 +0000"  >&lt;p&gt;I&apos;m honestly not entirely sure I understand from all the comments above what problems we have identified exactly and what exactly the branch to review aims to fix, so I&apos;m gonna lay out what I understand and what I would suggest we do and you can comment on what I&apos;ve missed, what I misunderstood and where you disagree.&lt;/p&gt;

&lt;p&gt;The first problem we have, the one that I think this ticket is about, is that &lt;tt&gt;ViewTest.sstableInBounds&lt;/tt&gt; is failing. My understanding of that failure is that &lt;tt&gt;View.sstableInBounds&lt;/tt&gt; pretends (through its signature) returning sstables for any type of &lt;tt&gt;AbstractBounds&lt;/tt&gt; (so with any permutation of inclusive/exclusive start and end) but it transform a bound into an &lt;tt&gt;Interval&lt;/tt&gt; which is always inclusive so it always acts as if &lt;tt&gt;AbstractBounds&lt;/tt&gt; was actually a &lt;tt&gt;Bound&lt;/tt&gt;.&lt;/p&gt;

&lt;p&gt;Now, is that an actual problem for the code? I don&apos;t think it is for 2 reasons:&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;the use of the interval tree is an optimization in the first place and having a sstable returned that has no actual data for our range isn&apos;t a problem. And given how incredibly unlikely it is in practice that a sstable is returned unnecessarily due an exclusive bound being treated as inclusive, it&apos;s not even a concrete performance issue.&lt;/li&gt;
	&lt;li&gt;it&apos;s more anecdotal but at least some of the bounds passed to &lt;tt&gt;sstableInBounds&lt;/tt&gt; comes from a call to (the now misnamed) &lt;tt&gt;Range.makeRowRange&lt;/tt&gt;, which uses &lt;tt&gt;Token.maxKeyBound()&lt;/tt&gt; which returns a &lt;tt&gt;PartitionPosition&lt;/tt&gt; that cannot be any real &lt;tt&gt;DecoratedKey&lt;/tt&gt; (it&apos;s by design bigger than any key having the original token). It follows that it doesn&apos;t matter what type of &lt;tt&gt;AbstractBounds&lt;/tt&gt; is returned by &lt;tt&gt;Range.makeRowRange&lt;/tt&gt;, it will always select the same keys. Therefore passing its result to &lt;tt&gt;sstableInBounds&lt;/tt&gt; ends up being fine.&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;A second problem, which if I understand correctly is the &quot;most serious&quot; one &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=benedict&quot; class=&quot;user-hover&quot; rel=&quot;benedict&quot;&gt;benedict&lt;/a&gt; is referring to, is that there is a number of places where we pass an &lt;tt&gt;AbstractBounds&lt;/tt&gt; and the code silently assumes it is not wrapped (please correct me if I misunderstood that). And it would indeed do the wrong thing if we mistakenly passed a wrapping range. It&apos;s hard to say for sure that we never make that mistake since it&apos;s hard to exhaustively list all the places where we make those silent assertions, but at first glance I think we&apos;re good because:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;For reads, we unwrap stuff pretty early (in &lt;tt&gt;StorageProxy.getRestrictedRanges&lt;/tt&gt;).&lt;/li&gt;
	&lt;li&gt;For streaming, we also clearly unwraps stuff in &lt;tt&gt;StreamSession.addTransferRanges&lt;/tt&gt;.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;So sum up, my initial take away is that:&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;The test failure does not expose a true bug in the code (at least not one with user-visible consequence).&lt;/li&gt;
	&lt;li&gt;The code make silent assertions regarding &lt;tt&gt;AbstractBounds&lt;/tt&gt; in a number of places making it easy to mess up, even though to the best of my knowledge there is no evidence that we do mess up.&lt;/li&gt;
	&lt;li&gt;The underlying cause of this is that the &lt;tt&gt;AbstractBounds&lt;/tt&gt; API is confusing, messy and makes mistake easy.&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;So, as I&apos;ve said before, I&apos;m all for rethinking the &lt;tt&gt;AbstractBounds&lt;/tt&gt; API, but&lt;br/&gt;
that&apos;s not a minor undertaking and a different ticket. I&apos;ve actually opened &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-9711&quot; title=&quot;Refactor AbstractBounds hierarchy&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-9711&quot;&gt;CASSANDRA-9711&lt;/a&gt; since I don&apos;t think we had one?.&lt;/p&gt;

&lt;p&gt;Now in the short term, what I would suggest for this ticket is to add concrete assertions in the place we&apos;ve identified where there is silent assertions. I&apos;ve pushed a suggestion for this &lt;a href=&quot;https://github.com/pcmanus/cassandra/commits/9462&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;here&lt;/a&gt;. It&apos;s obviously a band-aid, but it&apos;s simple enough that I think we can commit this in 2.1+ (it&apos;s mostly stating assertions more clearly). That patch will force us to modify the failing test so it only test inclusive bounds, thus fixing it, but my patch is against 2.1 so the test changes are not included).&lt;/p&gt;

&lt;p&gt;Now, there seems to be a third problem pointed by &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=aweisberg&quot; class=&quot;user-hover&quot; rel=&quot;aweisberg&quot;&gt;aweisberg&lt;/a&gt; regarding some of the behaviors of &lt;tt&gt;AbstractBounds&lt;/tt&gt; methods: &lt;tt&gt;isWrapAround&lt;/tt&gt; and &lt;tt&gt;isEmpty&lt;/tt&gt; more specifically.&lt;/p&gt;

&lt;p&gt;Regarding &lt;tt&gt;Range.isWrapAround&lt;/tt&gt;, it&apos;s definitively true that the existing semantic is a weird and inconsistent regarding the min value. That said, and unless we can identify actual bugs due to this semantic, I would prefer leaving to &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-9711&quot; title=&quot;Refactor AbstractBounds hierarchy&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-9711&quot;&gt;CASSANDRA-9711&lt;/a&gt; the task of fixing it since changing it is a lot of risk for little and short-lived gains if we agree that we should do &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-9711&quot; title=&quot;Refactor AbstractBounds hierarchy&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-9711&quot;&gt;CASSANDRA-9711&lt;/a&gt; anyway. &lt;/p&gt;

&lt;p&gt;For &lt;tt&gt;isEmpty&lt;/tt&gt;, to have &lt;tt&gt;isEmpty(bound(1, false), bound(1, true)) == true&lt;/tt&gt; actually feels right to me (alternatively, we could make isEmpty bitch because that range is nonsensical). The behaviors with &lt;tt&gt;MIN&lt;/tt&gt; are more obviously broken, though the method is only called by &lt;tt&gt;SSTableScanner&lt;/tt&gt; that, I think, never pass it &lt;tt&gt;MIN&lt;/tt&gt;. So one option could be to simply assert that in the method (again, knowing that we&apos;ll change all this with &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-9711&quot; title=&quot;Refactor AbstractBounds hierarchy&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-9711&quot;&gt;CASSANDRA-9711&lt;/a&gt;). That said, if you prefer fixing the method to work with &lt;tt&gt;MIN&lt;/tt&gt;, I don&apos;t mind, but let&apos;s open a separate ticket focused on that alone since as far as I can tell it&apos;s not related to the &lt;tt&gt;ViewTest&lt;/tt&gt; failure in any way.&lt;/p&gt;</comment>
                            <comment id="14611854" author="slebresne" created="Thu, 2 Jul 2015 12:04:32 +0000"  >&lt;p&gt;I&apos;ll note that the new assertions of my patch have actually found what I think is a genuine bug in &lt;tt&gt;SizeEstimatesRecorder&lt;/tt&gt; where it wasn&apos;t unwrapping the range (making it count only the size for the upper part of a wrapped range). I&apos;ve pushed the simple fix on &lt;a href=&quot;https://github.com/pcmanus/cassandra/commits/9462&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;the branch&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="14611861" author="benedict" created="Thu, 2 Jul 2015 12:10:50 +0000"  >&lt;p&gt;Just to confirm that it generally sounds like we&apos;re on the same page, i.e. that you&apos;ve correctly interpreted my statements, and that I&apos;m on board with your approach. The minutiae of &lt;tt&gt;isEmpty&lt;/tt&gt; (and other) semantics I&apos;ve not got a particular interest in, so long as they are consistent and well documented.&lt;/p&gt;</comment>
                            <comment id="14639610" author="aweisberg" created="Thu, 23 Jul 2015 22:24:07 +0000"  >&lt;p&gt;Tests look good. I just rebased from trunk to get current tests.&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/cassandra/compare/apache:trunk...aweisberg:C-9462-2?expand=1&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/cassandra/compare/apache:trunk...aweisberg:C-9462-2?expand=1&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14695203" author="iamaleksey" created="Thu, 13 Aug 2015 13:20:14 +0000"  >&lt;p&gt;2.2 patch LGTM, and I agree w/ pushing the rest to &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-9711&quot; title=&quot;Refactor AbstractBounds hierarchy&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-9711&quot;&gt;CASSANDRA-9711&lt;/a&gt;. Couldn&apos;t get 3.0 version to apply, though.&lt;/p&gt;

&lt;p&gt;Need that, and proof of cassci happiness, to commit.&lt;/p&gt;</comment>
                            <comment id="14695805" author="aweisberg" created="Thu, 13 Aug 2015 19:23:05 +0000"  >&lt;p&gt;I rebased. That merge did not go quietly into the night. &lt;/p&gt;

&lt;p&gt;I think it conflicted with &lt;a href=&quot;https://github.com/apache/cassandra/commit/ad8cad7c4d05fd5dea68fb274c81a102533ebe36#diff-b397cc5438b1a4be20f026c9ec9ecd6e&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/cassandra/commit/ad8cad7c4d05fd5dea68fb274c81a102533ebe36#diff-b397cc5438b1a4be20f026c9ec9ecd6e&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Some of the resolution was straightforward. I think I got StreamSession right, and viewFilter from ColumnFamily store went away and became select() in View so I moved the comments there.&lt;/p&gt;

&lt;p&gt;Tests need to run again.&lt;/p&gt;</comment>
                            <comment id="14697504" author="iamaleksey" created="Fri, 14 Aug 2015 18:28:50 +0000"  >&lt;p&gt;Committed as &lt;a href=&quot;https://github.com/apache/cassandra/commit/3aa7308e8f86969158c8d919c3f77658ae7c4fc3&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;3aa7308e8f86969158c8d919c3f77658ae7c4fc3&lt;/a&gt; and merged with cassandra-3.0 and trunk, thanks.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                                                <inwardlinks description="is duplicated by">
                                        <issuelink>
            <issuekey id="12833870">CASSANDRA-9516</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12972422">CASSANDRA-11886</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[aweisberg]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 14 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2f4if:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>aleksey</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[aleksey]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12962"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>