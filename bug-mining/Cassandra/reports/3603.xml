<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 22:54:32 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-9451] Startup message response for unsupported protocol versions is incorrect</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-9451</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;The response to a STARTUP request with protocol v4 on a C* 2.1 host is an error with an incorrect error code (0). &lt;/p&gt;

&lt;p&gt;Instead of the error code being &quot;Protocol error&quot; (&lt;tt&gt;0x000A&lt;/tt&gt;) it has error code 0 and message (wrapped by netty): &lt;br/&gt;
&lt;tt&gt;&quot;io.netty.handler.codec.DecoderException: org.apache.cassandra.transport.ProtocolException: Invalid or unsupported protocol version: 4&quot;&lt;/tt&gt;&lt;/p&gt;</description>
                <environment>&lt;p&gt;OS X 10.9&lt;br/&gt;
Cassandra 2.1.5 &lt;/p&gt;</environment>
        <key id="12831740">CASSANDRA-9451</key>
            <summary>Startup message response for unsupported protocol versions is incorrect</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10002" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Normal</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="stefania">Stefania Alborghetti</assignee>
                                    <reporter username="jorgebg">Jorge Bay</reporter>
                        <labels>
                    </labels>
                <created>Thu, 21 May 2015 14:07:04 +0000</created>
                <updated>Wed, 6 Nov 2019 21:58:12 +0000</updated>
                            <resolved>Mon, 19 Oct 2015 08:44:29 +0000</resolved>
                                        <fixVersion>2.1.6</fixVersion>
                    <fixVersion>2.2.0 rc1</fixVersion>
                                    <component>Legacy/CQL</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="14556726" author="thobbs" created="Fri, 22 May 2015 19:51:23 +0000"  >&lt;p&gt;The attached patch (and &lt;a href=&quot;https://github.com/thobbs/cassandra/tree/CASSANDRA-9451&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;branch&lt;/a&gt;) fixes the handling of unsupported protocol versions and adds a unit test.&lt;/p&gt;

&lt;p&gt;Pending cassci jobs:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/thobbs/job/thobbs-CASSANDRA-9451-dtest/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://cassci.datastax.com/view/Dev/view/thobbs/job/thobbs-CASSANDRA-9451-dtest/&lt;/a&gt;&lt;/li&gt;
	&lt;li&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/thobbs/job/thobbs-CASSANDRA-9451-testall/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://cassci.datastax.com/view/Dev/view/thobbs/job/thobbs-CASSANDRA-9451-testall/&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="14572220" author="stefania" created="Thu, 4 Jun 2015 06:01:43 +0000"  >&lt;p&gt;LGTM, +1 &lt;/p&gt;

&lt;p&gt;Sorry for late reply, I missed the initial notification!&lt;/p&gt;</comment>
                            <comment id="14572968" author="thobbs" created="Thu, 4 Jun 2015 15:22:16 +0000"  >&lt;p&gt;Thanks, committed as &lt;tt&gt;b3177f15aed1d60ec3cc6166133102f86a795844&lt;/tt&gt; in 2.1 and merged to 2.2 and trunk.&lt;/p&gt;</comment>
                            <comment id="14635669" author="zstlaw" created="Tue, 21 Jul 2015 19:24:57 +0000"  >&lt;p&gt;There may be a regression.  Testing with 2.1.7 and 2.1.8 I get the following:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&amp;gt; cqlsh_to_2_1_server.sh
[cqlsh 5.0.1 | Cassandra 2.1.4 | CQL spec 3.2.0 | Native protocol v3]
Use HELP &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; help.&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;When I upgrade to 2.2.0 client I immediately get the problem occurring again.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&amp;gt; sudo apt-get install cassandra=2.2.0
Unpacking cassandra (2.2.0) over (2.1.8) ...

&amp;gt; cqlsh_to_2_1_server.sh
Connection error: (&lt;span class=&quot;code-quote&quot;&gt;&apos;Unable to connect to any servers&apos;&lt;/span&gt;, {&lt;span class=&quot;code-quote&quot;&gt;&apos;sqa-cassandra01&apos;&lt;/span&gt;: ConnectionException(u&lt;span class=&quot;code-quote&quot;&gt;&apos;Did not get expected SupportedMessage response; instead, got: &amp;lt;ErrorMessage code=0000 [Server error] message=&lt;span class=&quot;code-quote&quot;&gt;&quot;io.netty.handler.codec.DecoderException: org.apache.cassandra.transport.ProtocolException: Invalid or unsupported protocol version: 4&quot;&lt;/span&gt;&amp;gt;&apos;&lt;/span&gt;,)})&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Edit: simplified example&lt;/p&gt;</comment>
                            <comment id="14654461" author="thobbs" created="Tue, 4 Aug 2015 22:21:48 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=zstlaw&quot; class=&quot;user-hover&quot; rel=&quot;zstlaw&quot;&gt;zstlaw&lt;/a&gt; thanks for letting us know.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=Stefania&quot; class=&quot;user-hover&quot; rel=&quot;stefania&quot;&gt;Stefania&lt;/a&gt; can you look into this? It seems like the unit test should have caught this problem in 2.2, but cassci doesn&apos;t show any failures.&lt;/p&gt;</comment>
                            <comment id="14724857" author="stefania" created="Tue, 1 Sep 2015 06:20:32 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=zstlaw&quot; class=&quot;user-hover&quot; rel=&quot;zstlaw&quot;&gt;zstlaw&lt;/a&gt;, sorry for the delay.  &lt;/p&gt;

&lt;p&gt;Could you attach &lt;tt&gt;cqlsh_to_2_1_server.sh&lt;/tt&gt; and specify which 2.2.0 version you are reproducing the problem with?&lt;/p&gt;

&lt;p&gt;What happens when I increase the protocol version in cqlsh is that the python driver automatically downgrades it and everything works fine, on the latest branches for 2.1 or 2.2. &lt;/p&gt;

&lt;p&gt;So I tried connecting from a 2.2 cqlsh to a running 2.1 node and got:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;Connection error: (&lt;span class=&quot;code-quote&quot;&gt;&apos;Unable to connect to any servers&apos;&lt;/span&gt;, {&lt;span class=&quot;code-quote&quot;&gt;&apos;127.0.0.1&apos;&lt;/span&gt;: ProtocolError(&lt;span class=&quot;code-quote&quot;&gt;&quot;cql_version &lt;span class=&quot;code-quote&quot;&gt;&apos;3.3.0&apos;&lt;/span&gt; is not supported by remote (w/ &lt;span class=&quot;code-keyword&quot;&gt;native&lt;/span&gt; protocol). Supported versions: [u&lt;span class=&quot;code-quote&quot;&gt;&apos;3.2.0&apos;&lt;/span&gt;]&quot;&lt;/span&gt;,)})
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;However &lt;tt&gt;./cqlsh --cqlversion=3.2.0&lt;/tt&gt; works fine as the driver once again downgrades the protocol version.&lt;/p&gt;

&lt;p&gt;The driver downgrades the version only when receiving &lt;tt&gt;ProtocolVersionUnsupported&lt;/tt&gt;, which leads me to believe this patch is working as expected.&lt;/p&gt;

&lt;p&gt;I wonder if the 2.2.0 version you used was older than 2.2.0 rc1 or if I am doing something wrong to reproduce this?&lt;/p&gt;</comment>
                            <comment id="14745625" author="zstlaw" created="Tue, 15 Sep 2015 15:46:05 +0000"  >&lt;p&gt;Sorry was on vacation.  When I got back to the office I reinstalled latest and tested. The problem is in using a newer version of cassandra to connect to an older server example ~ 2.1.4.&lt;/p&gt;

&lt;p&gt;First let me demonstrate that configuration works in general for older versions.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&amp;gt; apt-get install cassandra=2.1.9
Setting up cassandra (2.1.9)

&amp;gt; SSL_CERTFILE=~/qa_ssl_ca/qa_ca.pem cqlsh -k example -C -u sampleuser -p samplepassword cassandra.sqanet.com 9042 --ssl
Connected to cassandra.sqanet.com at sqa-cassandra.sqanet.com:9042.
[cqlsh 5.0.1 | Cassandra 2.1.4 | CQL spec 3.2.0 | Native protocol v3]
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;compare this to latest stable bundle.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&amp;gt; apt-get install cassandra
Setting up cassandra (2.2.1)

&amp;gt; cqlsh --version
cqlsh 5.0.1

&amp;gt; SSL_CERTFILE=~/qa_ssl_ca/qa_ca.pem cqlsh --cqlversion=3.2.0 -k example -C -u sampleuser -p samplepassword cassandra.sqanet.com 9042 --ssl
Connection error: (&lt;span class=&quot;code-quote&quot;&gt;&apos;Unable to connect to any servers&apos;&lt;/span&gt;, {&lt;span class=&quot;code-quote&quot;&gt;&apos;cassandra.sqanet.com&apos;&lt;/span&gt;: ConnectionException(u&lt;span class=&quot;code-quote&quot;&gt;&apos;Did not get expected SupportedMessage response; instead, got: &amp;lt;ErrorMessage code=0000 [Server error] message=&lt;span class=&quot;code-quote&quot;&gt;&quot;io.netty.handler.codec.DecoderException: org.apache.cassandra.transport.ProtocolException: Invalid or unsupported protocol version: 4&quot;&lt;/span&gt;&amp;gt;&apos;&lt;/span&gt;,)})
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="14791766" author="stefania" created="Thu, 17 Sep 2015 08:17:29 +0000"  >&lt;p&gt;I hope you had a nice vacation. So the server running is version 2.1.4 in both cases above?&lt;/p&gt;

&lt;p&gt;If so, you need to upgrade it to 2.1.6+.  Sorry I was not clear previously, it&apos;s the version of the node running that needs to be up-to-date, the bug was in the server code, not cqlsh.&lt;/p&gt;</comment>
                            <comment id="14957051" author="slebresne" created="Wed, 14 Oct 2015 15:00:22 +0000"  >&lt;p&gt;My understanding of &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=zstlaw&quot; class=&quot;user-hover&quot; rel=&quot;zstlaw&quot;&gt;zstlaw&lt;/a&gt; example is that he is using cqlsh 5.0.1 to connect to both 2.1.9 and 2.2.1, but while the former works, the latter triggers an error. Not sure to which version of Cassandra cqlsh 5.0.1 corresponds to, so we should check and try to reproduce. But if we cannot reproduce easily, let&apos;s close this ticket (since it has been committed) and open a separate ticket with more clear reproduction steps.&lt;/p&gt;</comment>
                            <comment id="14962983" author="stefania" created="Mon, 19 Oct 2015 08:42:10 +0000"  >&lt;p&gt;cqlsh version 5.0.1 hasn&apos;t changed for some time and it is the same from 2.1.4+ till 2.2 HEAD so it doesn&apos;t help much. The way I understood it is that the examples use either 2.1.9 or 2.2.1 cqlsh to connect to another host running cassandra 2.1.4. I&apos;m quite sure this is the case at least in the example that works since in &lt;tt&gt;[cqlsh 5.0.1 | Cassandra 2.1.4 | CQL spec 3.2.0 | Native protocol v3]&lt;/tt&gt; the version after Cassandra is the &lt;tt&gt;release_version&lt;/tt&gt; from &lt;tt&gt;system.local&lt;/tt&gt;.&lt;/p&gt;

&lt;p&gt;Regardless, I verified that cqlsh 2.1 HEAD and 2.2 HEAD can connect to a 2.1 HEAD server using the following command:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;SSL_VALIDATE=&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt; SSL_CERTFILE=/home/stefania/git/cstar/cassandra/conf/ca.cert ./bin/cqlsh --cqlversion=3.2.1 --ssl
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="14962986" author="stefania" created="Mon, 19 Oct 2015 08:44:29 +0000"  >&lt;p&gt;Closing this ticket, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=zstlaw&quot; class=&quot;user-hover&quot; rel=&quot;zstlaw&quot;&gt;zstlaw&lt;/a&gt; if you still have problems with servers running 2.1.6+ please open a new ticket with steps on how to reproduce.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12734914" name="9451.txt" size="5336" author="thobbs" created="Fri, 22 May 2015 19:51:23 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[stefania]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12313922" key="jira.plugin.projectspecificselectfield.jpssf:multicftype">
                        <customfieldname>Impacts</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="13101"><![CDATA[Clients]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 5 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2f1sf:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12311421" key="com.atlassian.jira.plugin.system.customfieldtypes:multiversion">
                        <customfieldname>Reproduced In</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="12329874">2.1.5</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>stefania</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[stefania]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12962"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>