<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 22:59:04 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-10584] reads with EACH_QUORUM  on keyspace with SimpleTopologyStrategy throw a ClassCastException</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-10584</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;I think this may be a regression introduced w/ &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-9602&quot; title=&quot;EACH_QUORUM READ support needed&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-9602&quot;&gt;&lt;del&gt;CASSANDRA-9602&lt;/del&gt;&lt;/a&gt;.  Starting with C* 3.0.0-rc2 an error is returned when querying a keyspace with &lt;tt&gt;SimpleTopologyStrategy&lt;/tt&gt; using EACH_QUORUM CL:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;cqlsh&amp;gt; create keyspace test with replication = {&apos;class&apos;: &apos;SimpleStrategy&apos;, &apos;replication_factor&apos;: 1};
cqlsh&amp;gt; create table test.test (k int PRIMARY KEY, i int);
cqlsh&amp;gt; consistency EACH_QUORUM;
Consistency level set to EACH_QUORUM.
cqlsh&amp;gt; select * from test.test;
ServerError: &amp;lt;ErrorMessage code=0000 [Server error] message=&quot;java.lang.ClassCastException: org.apache.cassandra.locator.SimpleStrategy cannot be cast to org.apache.cassandra.locator.NetworkTopologyStrategy&quot;&amp;gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The exception yielded in the system logs:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;ERROR [SharedPool-Worker-1] 2015-10-23 13:02:15,405 ErrorMessage.java:336 - Unexpected exception during request
java.lang.ClassCastException: org.apache.cassandra.locator.SimpleStrategy cannot be cast to org.apache.cassandra.locator.NetworkTopologyStrategy
        at org.apache.cassandra.db.ConsistencyLevel.filterForEachQuorum(ConsistencyLevel.java:227) ~[main/:na]
        at org.apache.cassandra.db.ConsistencyLevel.filterForQuery(ConsistencyLevel.java:188) ~[main/:na]
        at org.apache.cassandra.db.ConsistencyLevel.filterForQuery(ConsistencyLevel.java:180) ~[main/:na]
        at org.apache.cassandra.service.StorageProxy$RangeIterator.computeNext(StorageProxy.java:1795) ~[main/:na]
        at org.apache.cassandra.service.StorageProxy$RangeIterator.computeNext(StorageProxy.java:1762) ~[main/:na]
        at org.apache.cassandra.utils.AbstractIterator.hasNext(AbstractIterator.java:47) ~[main/:na]
        at com.google.common.collect.Iterators$PeekingImpl.hasNext(Iterators.java:1149) ~[guava-18.0.jar:na]
        at org.apache.cassandra.service.StorageProxy$RangeMerger.computeNext(StorageProxy.java:1814) ~[main/:na]
        at org.apache.cassandra.service.StorageProxy$RangeMerger.computeNext(StorageProxy.java:1799) ~[main/:na]
        at org.apache.cassandra.utils.AbstractIterator.hasNext(AbstractIterator.java:47) ~[main/:na]
        at org.apache.cassandra.service.StorageProxy$RangeCommandIterator.computeNext(StorageProxy.java:1925) ~[main/:na]
        at org.apache.cassandra.service.StorageProxy$RangeCommandIterator.computeNext(StorageProxy.java:1892) ~[main/:na]
        at org.apache.cassandra.utils.AbstractIterator.hasNext(AbstractIterator.java:47) ~[main/:na]
        at org.apache.cassandra.db.partitions.WrappingPartitionIterator.hasNext(WrappingPartitionIterator.java:33) ~[main/:na]
        at org.apache.cassandra.db.partitions.CountingPartitionIterator.hasNext(CountingPartitionIterator.java:49) ~[main/:na]
        at org.apache.cassandra.db.partitions.WrappingPartitionIterator.hasNext(WrappingPartitionIterator.java:33) ~[main/:na]
        at org.apache.cassandra.db.partitions.CountingPartitionIterator.hasNext(CountingPartitionIterator.java:49) ~[main/:na]
        at org.apache.cassandra.service.pager.AbstractQueryPager$PagerIterator.hasNext(AbstractQueryPager.java:99) ~[main/:na]
        at org.apache.cassandra.cql3.statements.SelectStatement.process(SelectStatement.java:610) ~[main/:na]
        at org.apache.cassandra.cql3.statements.SelectStatement.processResults(SelectStatement.java:371) ~[main/:na]
        at org.apache.cassandra.cql3.statements.SelectStatement.execute(SelectStatement.java:327) ~[main/:na]
        at org.apache.cassandra.cql3.statements.SelectStatement.execute(SelectStatement.java:213) ~[main/:na]
        at org.apache.cassandra.cql3.statements.SelectStatement.execute(SelectStatement.java:76) ~[main/:na]
        at org.apache.cassandra.cql3.QueryProcessor.processStatement(QueryProcessor.java:205) ~[main/:na]
        at org.apache.cassandra.cql3.QueryProcessor.process(QueryProcessor.java:236) ~[main/:na]
        at org.apache.cassandra.cql3.QueryProcessor.process(QueryProcessor.java:221) ~[main/:na]
        at org.apache.cassandra.transport.messages.QueryMessage.execute(QueryMessage.java:115) ~[main/:na]
        at org.apache.cassandra.transport.Message$Dispatcher.channelRead0(Message.java:507) [main/:na]
        at org.apache.cassandra.transport.Message$Dispatcher.channelRead0(Message.java:401) [main/:na]
        at io.netty.channel.SimpleChannelInboundHandler.channelRead(SimpleChannelInboundHandler.java:105) [netty-all-4.0.23.Final.jar:4.0.23.Final]
        at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:333) [netty-all-4.0.23.Final.jar:4.0.23.Final]
        at io.netty.channel.AbstractChannelHandlerContext.access$700(AbstractChannelHandlerContext.java:32) [netty-all-4.0.23.Final.jar:4.0.23.Final]
        at io.netty.channel.AbstractChannelHandlerContext$8.run(AbstractChannelHandlerContext.java:324) [netty-all-4.0.23.Final.jar:4.0.23.Final]
        at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511) [na:1.8.0_60]
        at org.apache.cassandra.concurrent.AbstractTracingAwareExecutorService$FutureTask.run(AbstractTracingAwareExecutorService.java:164) [main/:na]
        at org.apache.cassandra.concurrent.SEPWorker.run(SEPWorker.java:105) [main/:na]
        at java.lang.Thread.run(Thread.java:745) [na:1.8.0_60]
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;On 3.0.0-rc1 we get an invalid query error back instead (as expected with prior to &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-9602&quot; title=&quot;EACH_QUORUM READ support needed&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-9602&quot;&gt;&lt;del&gt;CASSANDRA-9602&lt;/del&gt;&lt;/a&gt;):&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;InvalidRequest: code=2200 [Invalid query] message=&quot;EACH_QUORUM ConsistencyLevel is only supported for writes&quot;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="12907496">CASSANDRA-10584</key>
            <summary>reads with EACH_QUORUM  on keyspace with SimpleTopologyStrategy throw a ClassCastException</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10003" iconUrl="https://issues.apache.org/jira/images/icons/priorities/trivial.svg">Low</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="carlyeks">Carl Yeksigian</assignee>
                                    <reporter username="andrew.tolbert">Andy Tolbert</reporter>
                        <labels>
                    </labels>
                <created>Fri, 23 Oct 2015 18:07:26 +0000</created>
                <updated>Tue, 16 Apr 2019 09:30:52 +0000</updated>
                            <resolved>Thu, 5 Nov 2015 23:29:19 +0000</resolved>
                                        <fixVersion>3.0.0</fixVersion>
                                    <component>Legacy/CQL</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="14987442" author="carlyeks" created="Tue, 3 Nov 2015 15:17:15 +0000"  >&lt;p&gt;Fixed it to use that logic only if we are using the &lt;tt&gt;NetworkTopologyStrategy&lt;/tt&gt;; otherwise it will use a simple quorum.&lt;/p&gt;

&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;3.0&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;trunk&lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/carlyeks/cassandra/tree/ticket/10584/3.0&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;branch&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/carlyeks/cassandra/tree/ticket/10584/trunk&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;branch&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/carlyeks/job/carlyeks-ticket-10584-3.0-testall/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;utest&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/carlyeks/job/carlyeks-ticket-10584-trunk-testall/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;utest&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/carlyeks/job/carlyeks-ticket-10584-3.0-dtest/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;dtest&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/carlyeks/job/carlyeks-ticket-10584-trunk-dtest/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;dtest&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;
</comment>
                            <comment id="14988085" author="aweisberg" created="Tue, 3 Nov 2015 20:46:28 +0000"  >&lt;p&gt;Doh! That is an obvious issue.&lt;/p&gt;

&lt;p&gt;Can you add this to the consistency_test dtest?&lt;/p&gt;</comment>
                            <comment id="14990371" author="aweisberg" created="Wed, 4 Nov 2015 20:40:55 +0000"  >&lt;p&gt;Yikes... the pull request for &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-9602&quot; title=&quot;EACH_QUORUM READ support needed&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-9602&quot;&gt;&lt;del&gt;CASSANDRA-9602&lt;/del&gt;&lt;/a&gt; was never merged.&lt;/p&gt;</comment>
                            <comment id="14991367" author="slebresne" created="Thu, 5 Nov 2015 09:08:07 +0000"  >&lt;blockquote&gt;&lt;p&gt;Yikes... the pull request for &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-9602&quot; title=&quot;EACH_QUORUM READ support needed&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-9602&quot;&gt;&lt;del&gt;CASSANDRA-9602&lt;/del&gt;&lt;/a&gt; was never merged.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Has it been now? If not, can you point to which PR you&apos;re talking about so we can merge it?&lt;/p&gt;</comment>
                            <comment id="14991837" author="aweisberg" created="Thu, 5 Nov 2015 15:39:52 +0000"  >&lt;p&gt;The feedback from test eng hasn&apos;t been incorporated yet.&lt;br/&gt;
&lt;a href=&quot;https://github.com/riptano/cassandra-dtest/pull/606&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/riptano/cassandra-dtest/pull/606&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14991872" author="slebresne" created="Thu, 5 Nov 2015 16:01:54 +0000"  >&lt;p&gt;Looks like test eng was waiting on feedback from Carl. &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=carlyeks&quot; class=&quot;user-hover&quot; rel=&quot;carlyeks&quot;&gt;carlyeks&lt;/a&gt; can you have a look?&lt;/p&gt;</comment>
                            <comment id="14991900" author="carlyeks" created="Thu, 5 Nov 2015 16:16:14 +0000"  >&lt;p&gt;Yeah, I didn&apos;t notice that there was feedback on the dtest; my fault. I&apos;ll make sure to address.&lt;/p&gt;</comment>
                            <comment id="14992332" author="carlyeks" created="Thu, 5 Nov 2015 19:43:34 +0000"  >&lt;p&gt;I&apos;ve updated &lt;a href=&quot;https://github.com/riptano/cassandra-dtest/pull/606&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/riptano/cassandra-dtest/pull/606&lt;/a&gt; to also include tests for this patch, which pass.&lt;/p&gt;</comment>
                            <comment id="14992707" author="iamaleksey" created="Thu, 5 Nov 2015 23:29:08 +0000"  >&lt;p&gt;Committed as &lt;a href=&quot;https://github.com/apache/cassandra/commit/f3eb4ce40b3a57768c6368546ed0ca16d8634f54&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;f3eb4ce40b3a57768c6368546ed0ca16d8634f54&lt;/a&gt; to 3.0 and merged with trunk, thanks.&lt;/p&gt;

&lt;p&gt;Merged dtest PR, too.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                                                <inwardlinks description="is duplicated by">
                                        <issuelink>
            <issuekey id="12684808">CASSANDRA-6489</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12838142">CASSANDRA-9602</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[carlyeks]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 2 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2ng9b:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>aweisberg</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[aweisberg]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12961"><![CDATA[Low]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12311420" key="com.atlassian.jira.plugin.system.customfieldtypes:version">
                        <customfieldname>Since Version</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="12333634">3.0.0 rc2</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>