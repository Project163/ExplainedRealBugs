<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 23:23:03 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-17136] FQL: Enabling via nodetool can trigger disk_failure_mode</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-17136</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;When enabling fullquerylog via nodetool, if there is a non empty directory present under the location specified via --path which would trigger an java.nio.file.AccessDeniedException during cleaning, the node will trigger the disk_failure_policy which by default is stop. This is a fairly easy way to offline a cluster if someone executes this in parallel. I don&apos;t that think the behavior is desirable for enabling via nodetool.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;Repro (1 node cluster already up):&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-bash&quot;&gt;
mkdir /some/path/dir
touch /some/path/dir/file
chown -R user: /some/path/dir &lt;span class=&quot;code-comment&quot;&gt;# Non Cassandra process user
&lt;/span&gt;chmod 700 /some/path/dir
nodetool enablefullquerylog --path /some/path
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Nodetool will give back this error:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
error: /some/path/dir/file
-- StackTrace --
java.nio.file.AccessDeniedException: /some/path/dir/file
	at sun.nio.fs.UnixException.translateToIOException(UnixException.java:84)
	at sun.nio.fs.UnixException.rethrowAsIOException(UnixException.java:102)
	at sun.nio.fs.UnixException.rethrowAsIOException(UnixException.java:107)
	at sun.nio.fs.UnixFileSystemProvider.implDelete(UnixFileSystemProvider.java:244)
	at sun.nio.fs.AbstractFileSystemProvider.delete(AbstractFileSystemProvider.java:103)
	at java.nio.file.Files.delete(Files.java:1126)
	at org.apache.cassandra.io.util.FileUtils.deleteWithConfirm(FileUtils.java:250)
	at org.apache.cassandra.io.util.FileUtils.deleteWithConfirm(FileUtils.java:237)
	at org.apache.cassandra.utils.binlog.BinLog.deleteRecursively(BinLog.java:492)
	at org.apache.cassandra.utils.binlog.BinLog.cleanDirectory(BinLog.java:477)
	at org.apache.cassandra.utils.binlog.BinLog$Builder.build(BinLog.java:436)
	at org.apache.cassandra.fql.FullQueryLogger.enable(FullQueryLogger.java:106)
	at org.apache.cassandra.service.StorageService.enableFullQueryLogger(StorageService.java:5915)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at sun.reflect.misc.Trampoline.invoke(MethodUtil.java:72)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at sun.reflect.misc.MethodUtil.invoke(MethodUtil.java:276)
	at com.sun.jmx.mbeanserver.StandardMBeanIntrospector.invokeM2(StandardMBeanIntrospector.java:112)
	at com.sun.jmx.mbeanserver.StandardMBeanIntrospector.invokeM2(StandardMBeanIntrospector.java:46)
	at com.sun.jmx.mbeanserver.MBeanIntrospector.invokeM(MBeanIntrospector.java:237)
	at com.sun.jmx.mbeanserver.PerInterface.invoke(PerInterface.java:138)
	at com.sun.jmx.mbeanserver.MBeanSupport.invoke(MBeanSupport.java:252)
	at com.sun.jmx.interceptor.DefaultMBeanServerInterceptor.invoke(DefaultMBeanServerInterceptor.java:819)
	at com.sun.jmx.mbeanserver.JmxMBeanServer.invoke(JmxMBeanServer.java:801)
	at javax.management.remote.rmi.RMIConnectionImpl.doOperation(RMIConnectionImpl.java:1468)
	at javax.management.remote.rmi.RMIConnectionImpl.access$300(RMIConnectionImpl.java:76)
	at javax.management.remote.rmi.RMIConnectionImpl$PrivilegedOperation.run(RMIConnectionImpl.java:1309)
	at javax.management.remote.rmi.RMIConnectionImpl.doPrivilegedOperation(RMIConnectionImpl.java:1401)
	at javax.management.remote.rmi.RMIConnectionImpl.invoke(RMIConnectionImpl.java:829)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at sun.rmi.server.UnicastServerRef.dispatch(UnicastServerRef.java:357)
	at sun.rmi.transport.Transport$1.run(Transport.java:200)
	at sun.rmi.transport.Transport$1.run(Transport.java:197)
	at java.security.AccessController.doPrivileged(Native Method)
	at sun.rmi.transport.Transport.serviceCall(Transport.java:196)
	at sun.rmi.transport.tcp.TCPTransport.handleMessages(TCPTransport.java:573)
	at sun.rmi.transport.tcp.TCPTransport$ConnectionHandler.run0(TCPTransport.java:834)
	at sun.rmi.transport.tcp.TCPTransport$ConnectionHandler.lambda$run$0(TCPTransport.java:688)
	at java.security.AccessController.doPrivileged(Native Method)
	at sun.rmi.transport.tcp.TCPTransport$ConnectionHandler.run(TCPTransport.java:687)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:748)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;On the Cassandra side, we see the following:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
INFO  [RMI TCP Connection(2)-10.101.33.87] 2021-11-11 00:55:40,716 BinLog.java:420 - Attempting to configure bin log: Path: /some/path Roll cycle: HOURLY Blocking: &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt; Max queue weight: 268435456 Max log size:17179869184 Archive command:
INFO  [RMI TCP Connection(2)-10.101.33.87] 2021-11-11 00:55:40,720 BinLog.java:433 - Cleaning directory: /some/path as requested
ERROR [RMI TCP Connection(2)-10.101.33.87] 2021-11-11 00:55:40,724 DefaultFSErrorHandler.java:64 - Stopping transports as disk_failure_policy is stop
ERROR [RMI TCP Connection(2)-10.101.33.87] 2021-11-11 00:55:40,725 StorageService.java:453 - Stopping &lt;span class=&quot;code-keyword&quot;&gt;native&lt;/span&gt; transport
INFO  [RMI TCP Connection(2)-10.101.33.87] 2021-11-11 00:55:40,730 Server.java:171 - Stop listening &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; CQL clients
ERROR [RMI TCP Connection(2)-10.101.33.87] 2021-11-11 00:55:40,730 StorageService.java:458 - Stopping gossiper
WARN  [RMI TCP Connection(2)-10.101.33.87] 2021-11-11 00:55:40,731 StorageService.java:357 - Stopping gossip by &lt;span class=&quot;code-keyword&quot;&gt;operator&lt;/span&gt; request
INFO  [RMI TCP Connection(2)-10.101.33.87] 2021-11-11 00:55:40,731 Gossiper.java:1984 - Announcing shutdown
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="13411163">CASSANDRA-17136</key>
            <summary>FQL: Enabling via nodetool can trigger disk_failure_mode</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10002" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Normal</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="brandon.williams">Brandon Williams</assignee>
                                    <reporter username="bcicchi">Brendan Cicchi</reporter>
                        <labels>
                    </labels>
                <created>Thu, 11 Nov 2021 01:06:56 +0000</created>
                <updated>Thu, 9 Dec 2021 22:10:29 +0000</updated>
                            <resolved>Thu, 9 Dec 2021 22:10:29 +0000</resolved>
                                        <fixVersion>4.0.2</fixVersion>
                                    <component>Tool/fql</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="17442053" author="brandon.williams" created="Thu, 11 Nov 2021 02:54:41 +0000"  >&lt;p&gt;This sounds fairly serious from the description, setting the severity accordingly.&lt;/p&gt;</comment>
                            <comment id="17442443" author="brandon.williams" created="Thu, 11 Nov 2021 20:25:20 +0000"  >&lt;p&gt;Hmm, it seems there is some other element to this, as I can&apos;t repro with the steps provided:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;$ bin/nodetool  enablefullquerylog --path /tmp/test
error: null
-- StackTrace --
java.lang.NullPointerException
        at org.apache.cassandra.utils.binlog.BinLog.deleteRecursively(BinLog.java:490)
        at org.apache.cassandra.utils.binlog.BinLog.cleanDirectory(BinLog.java:477)
        at org.apache.cassandra.utils.binlog.BinLog$Builder.build(BinLog.java:436)
        at org.apache.cassandra.fql.FullQueryLogger.enable(FullQueryLogger.java:106)
        at org.apache.cassandra.service.StorageService.enableFullQueryLogger(StorageService.java:5929)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;But the solution is likely the same: &lt;a href=&quot;https://github.com/driftx/cassandra/tree/CASSANDRA-17136&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;branch&lt;/a&gt;, &lt;a href=&quot;https://app.circleci.com/pipelines/github/driftx/cassandra?branch=CASSANDRA-17136&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;CI&lt;/a&gt;.  I&apos;d still like to reproduce and also check the audit log for the same issue.&lt;/p&gt;</comment>
                            <comment id="17442767" author="bcicchi" created="Fri, 12 Nov 2021 14:20:13 +0000"  >&lt;p&gt;Okay here are the exact commands that repro the issue for me on 4.0.1 (checked centos and ubuntu just in case). All commands run as root:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
mkdir -p /tmp/dir/
chown cassandra:cassandra /tmp/dir
mkdir /tmp/dir/sub
touch /tmp/dir/sub/file
nodetool enablefullquerylog --path /tmp/dir &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Let me know if that does not work. Here are the permissions:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
/tmp/dir:
total 12
drwxr-xr-x &#160;3 cassandra cassandra 4096 Nov 12 14:18 .
drwxrwxrwt 16 root &#160; &#160; &#160;root &#160; &#160; &#160;4096 Nov 12 14:18 ..
drwxr-xr-x &#160;2 root &#160; &#160; &#160;root &#160; &#160; &#160;4096 Nov 12 14:18 sub

/tmp/dir/sub:
total 8
drwxr-xr-x 2 root &#160; &#160; &#160;root &#160; &#160; &#160;4096 Nov 12 14:18 .
drwxr-xr-x 3 cassandra cassandra 4096 Nov 12 14:18 ..
-rw-r--r-- 1 root &#160; &#160; &#160;root &#160; &#160; &#160; &#160; 0 Nov 12 14:18 file &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="17444654" author="brandon.williams" created="Tue, 16 Nov 2021 16:44:59 +0000"  >&lt;p&gt;Thanks, that works.  This is a fairly rare and specific set of circumstances, and the policy is triggered by deleteWithConfirm, which I assume was chosen intentionally in this situation, so I&apos;m not sure we should fix this, though it would be nice to not have it triggered via JMX. &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=marcuse&quot; class=&quot;user-hover&quot; rel=&quot;marcuse&quot;&gt;marcuse&lt;/a&gt; wdyt?&lt;/p&gt;</comment>
                            <comment id="17444903" author="bcicchi" created="Wed, 17 Nov 2021 02:38:37 +0000"  >&lt;p&gt;So the thing that got me to uncover this was that &lt;tt&gt;fqltool dump&lt;/tt&gt;&#160;command can very conveniently create a directory layout just like the one above. So an example scenario would only have to be this:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
mkdir /tmp/dir
chown cassandra:cassandra /tmp/dir
cd /tmp/dir
fqltool dump # ... whoops, that was accidental (copy paste, bash history line, or just general badness, etc..)
nodetool enablefullquerylog --path /tmp/dir # Node is now down&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Directory structure:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
/tmp/dir:
total 12
drwxr-xr-x &#160;3 cassandra cassandra 4096 Nov 17 02:18 .
drwxrwxrwt 15 root &#160; &#160; &#160;root &#160; &#160; &#160;4096 Nov 17 02:18 ..
drwxr-xr-x &#160;2 root &#160; &#160; &#160;root &#160; &#160; &#160;4096 Nov 17 02:18 cassandra.logdir_IS_UNDEFINED/tmp/dir/cassandra.logdir_IS_UNDEFINED:
total 8
drwxr-xr-x 2 root &#160; &#160; &#160;root &#160; &#160; &#160;4096 Nov 17 02:18 .
drwxr-xr-x 3 cassandra cassandra 4096 Nov 17 02:18 ..
-rw-r--r-- 1 root &#160; &#160; &#160;root &#160; &#160; &#160; &#160; 0 Nov 17 02:18 debug.log
-rw-r--r-- 1 root &#160; &#160; &#160;root &#160; &#160; &#160; &#160; 0 Nov 17 02:18 system.log &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;I personally don&apos;t think the path to hit this is all that difficult to do for an operator.&lt;/p&gt;</comment>
                            <comment id="17444973" author="krummas" created="Wed, 17 Nov 2021 07:13:01 +0000"  >&lt;p&gt;This sounds like a bug to me, looks like we only &lt;tt&gt;cleanDirectory&lt;/tt&gt; when enabling FQL via JMX, so we can probably just catch the exception and let the user know.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=brandon.williams&quot; class=&quot;user-hover&quot; rel=&quot;brandon.williams&quot;&gt;brandon.williams&lt;/a&gt; feel free to reassign this to me&lt;/p&gt;
</comment>
                            <comment id="17445415" author="brandon.williams" created="Wed, 17 Nov 2021 17:58:10 +0000"  >&lt;blockquote&gt;&lt;p&gt;So the thing that got me to uncover this was that fqltool dump command can very conveniently create a directory layout just like the one above.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Aha, I see.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;looks like we only cleanDirectory when enabling FQL via JMX, so we can probably just catch the exception and let the user know.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;cleanDirectory is what calls the JVMStabilityInspector, so instead I disabled it when called via JMX.&lt;/p&gt;

&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;Branch&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;CI&lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/driftx/cassandra/tree/CASSANDRA-17136&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;4.0&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://app.circleci.com/pipelines/github/driftx/cassandra?branch=CASSANDRA-17136&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;circle&lt;/a&gt;, &lt;a href=&quot;https://ci-cassandra.apache.org/blue/organizations/jenkins/Cassandra-devbranch/detail/Cassandra-devbranch/1285/pipeline&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;&lt;span class=&quot;image-wrap&quot; style=&quot;&quot;&gt;&lt;img src=&quot;https://ci-cassandra.apache.org/job/Cassandra-devbranch/1285/badge/icon&quot; style=&quot;border: 0px solid black&quot; /&gt;&lt;/span&gt;&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/driftx/cassandra/tree/CASSANDRA-17136&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;trunk&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://app.circleci.com/pipelines/github/driftx/cassandra?branch=CASSANDRA-17136-trunk&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;circle&lt;/a&gt;, &lt;a href=&quot;https://ci-cassandra.apache.org/blue/organizations/jenkins/Cassandra-devbranch/detail/Cassandra-devbranch/1286/pipeline&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;&lt;span class=&quot;image-wrap&quot; style=&quot;&quot;&gt;&lt;img src=&quot;https://ci-cassandra.apache.org/job/Cassandra-devbranch/1285/badge/icon&quot; style=&quot;border: 0px solid black&quot; /&gt;&lt;/span&gt;&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;
</comment>
                            <comment id="17445510" author="brandon.williams" created="Wed, 17 Nov 2021 22:21:45 +0000"  >&lt;p&gt;This broke some FullQueryLoggerTests I&apos;ll look into.&lt;/p&gt;</comment>
                            <comment id="17446053" author="brandon.williams" created="Thu, 18 Nov 2021 17:13:41 +0000"  >&lt;p&gt;I created an enableWithoutClean method for JMX to use.&lt;/p&gt;

&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;Branch&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;CI&lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/driftx/cassandra/tree/CASSANDRA-17136&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;4.0&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://app.circleci.com/pipelines/github/driftx/cassandra?branch=CASSANDRA-17136&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;circle&lt;/a&gt;, &lt;a href=&quot;https://ci-cassandra.apache.org/blue/organizations/jenkins/Cassandra-devbranch/detail/Cassandra-devbranch/1287/pipeline&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;&lt;span class=&quot;image-wrap&quot; style=&quot;&quot;&gt;&lt;img src=&quot;https://ci-cassandra.apache.org/job/Cassandra-devbranch/1287/badge/icon&quot; style=&quot;border: 0px solid black&quot; /&gt;&lt;/span&gt;&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/driftx/cassandra/tree/CASSANDRA-17136&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;trunk&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://app.circleci.com/pipelines/github/driftx/cassandra?branch=CASSANDRA-17136-trunk&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;circle&lt;/a&gt;, &lt;a href=&quot;https://ci-cassandra.apache.org/blue/organizations/jenkins/Cassandra-devbranch/detail/Cassandra-devbranch/1288/pipeline&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;&lt;span class=&quot;image-wrap&quot; style=&quot;&quot;&gt;&lt;img src=&quot;https://ci-cassandra.apache.org/job/Cassandra-devbranch/1288/badge/icon&quot; style=&quot;border: 0px solid black&quot; /&gt;&lt;/span&gt;&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;
</comment>
                            <comment id="17447251" author="bereng" created="Mon, 22 Nov 2021 08:39:54 +0000"  >&lt;p&gt;Couldn&apos;t we add a quick test at least checking the folder was/wasn&apos;t cleaned?&lt;/p&gt;</comment>
                            <comment id="17454201" author="brandon.williams" created="Mon, 6 Dec 2021 19:23:32 +0000"  >&lt;p&gt;We can&apos;t reproduce exactly the same error without being able to become another unix user, but I added a dtest &lt;a href=&quot;https://github.com/driftx/cassandra-dtest/tree/CASSANDRA-17136&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;here&lt;/a&gt; that reproduces the NPE by reducing permissions.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://ci-cassandra.apache.org/blue/organizations/jenkins/Cassandra-devbranch/detail/Cassandra-devbranch/1309/pipeline&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;&lt;span class=&quot;image-wrap&quot; style=&quot;&quot;&gt;&lt;img src=&quot;https://ci-cassandra.apache.org/job/Cassandra-devbranch/1309/badge/icon&quot; style=&quot;border: 0px solid black&quot; /&gt;&lt;/span&gt;&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17456174" author="bereng" created="Thu, 9 Dec 2021 06:56:49 +0000"  >&lt;p&gt;^ lgtm. I would add a comment in the test explaining why the file and permissions change, otherwise it&apos;s difficult to grasp without the context of the ticket. ^This is only the 4.0 CI run so +1 conditioned to a successful trunk CI.&lt;/p&gt;</comment>
                            <comment id="17456498" author="brandon.williams" created="Thu, 9 Dec 2021 15:21:38 +0000"  >&lt;p&gt;&lt;a href=&quot;https://app.circleci.com/pipelines/github/driftx/cassandra?branch=CASSANDRA-17136-trunk&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;circle for trunk&lt;/a&gt;. I&apos;ll check back later to commit if that&apos;s good.&lt;/p&gt;</comment>
                            <comment id="17456591" author="brandon.williams" created="Thu, 9 Dec 2021 17:33:37 +0000"  >&lt;p&gt;Heh, circle fails the teardown with this test:&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;PermissionError: &lt;span class=&quot;error&quot;&gt;&amp;#91;Errno 13&amp;#93;&lt;/span&gt; Permission denied: &apos;baddir&apos;&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I&apos;ve updated the test to change the permissions back afterward, circle is &lt;a href=&quot;https://app.circleci.com/pipelines/github/driftx/cassandra?branch=CASSANDRA-17136-trunk&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;running&lt;/a&gt; again.&lt;/p&gt;</comment>
                            <comment id="17456769" author="brandon.williams" created="Thu, 9 Dec 2021 22:10:29 +0000"  >&lt;p&gt;Test run looks good now, committed.  Thanks!&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[brandon.williams]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12313825" key="com.atlassian.jira.plugin.system.customfieldtypes:cascadingselect">
                        <customfieldname>Bug Category</customfieldname>
                        <customfieldvalues>
                                                    <customfieldvalue key="12983" cascade-level=""><![CDATA[Availability]]></customfieldvalue>
                                <customfieldvalue key="12991" cascade-level="1"><![CDATA[Response Crash]]></customfieldvalue>
            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12313821" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Complexity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12965"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313822" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Discovered By</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12969"><![CDATA[User Report]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12313922" key="jira.plugin.projectspecificselectfield.jpssf:multicftype">
                        <customfieldname>Impacts</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="13100"><![CDATA[None]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            3 years, 48 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12313921" key="jira.plugin.projectspecificselectfield.jpssf:multicftype">
                        <customfieldname>Platform</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="13076"><![CDATA[All]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0wmp4:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[bereng]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12963"><![CDATA[Critical]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12311420" key="com.atlassian.jira.plugin.system.customfieldtypes:version">
                        <customfieldname>Since Version</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="12350367">4.0.0</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313924" key="com.atlassian.jira.plugin.system.customfieldtypes:textfield">
                        <customfieldname>Source Control Link</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>&lt;p&gt;&lt;a href=&quot;https://github.com/apache/cassandra/commit/aa82e3e4277397dbf630c7b805c5aaca22d660ad&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/cassandra/commit/aa82e3e4277397dbf630c7b805c5aaca22d660ad&lt;/a&gt;&lt;/p&gt;</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313823" key="com.atlassian.jira.plugin.system.customfieldtypes:textarea">
                        <customfieldname>Test and Documentation Plan</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>&lt;p&gt;Run CI&lt;/p&gt;</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>