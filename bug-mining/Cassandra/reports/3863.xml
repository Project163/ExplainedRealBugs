<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 22:58:20 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-10478] Seek position is not within mmap segment</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-10478</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;After upgrading to 2.2.2 we started seeing timeouts accompanied by the following error in the log. Disabling mmap (by using &quot;disk_access_mode: standard&quot;) completely solves the problem.&lt;/p&gt;

&lt;p&gt;We did not experience this problem in 2.2.1.&lt;br/&gt;
The change to src/java/org/apache/cassandra/io/util/ByteBufferDataInput.java in the following commit seems interesting as it changes the calculation of the mmap boundaries (and moves from &amp;lt;= to &amp;lt;) &lt;a href=&quot;https://github.com/apache/cassandra/commit/25de92e321604626d6c098233082904832c07814&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/cassandra/commit/25de92e321604626d6c098233082904832c07814&lt;/a&gt; &lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;WARN  [SharedPool-Worker-1] 2015-10-07 03:40:39,771 AbstractTracingAwareExecutorService.java:169 - Uncaught exception on thread Thread[SharedPool-Worker-1,5,main]: {}
java.lang.RuntimeException: org.apache.cassandra.io.sstable.CorruptSSTableException: java.io.IOException: Seek position 717680 is not within mmap segment (seg offs: 0, length: 717680)
	at org.apache.cassandra.service.StorageProxy$DroppableRunnable.run(StorageProxy.java:2187) ~[apache-cassandra-2.2.2.jar:2.2.2]
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511) ~[na:1.8.0_60]
	at org.apache.cassandra.concurrent.AbstractTracingAwareExecutorService$FutureTask.run(AbstractTracingAwareExecutorService.java:164) ~[apache-cassandra-2.2.2.jar:2.2.2]
	at org.apache.cassandra.concurrent.SEPWorker.run(SEPWorker.java:105) [apache-cassandra-2.2.2.jar:2.2.2]
	at java.lang.Thread.run(Thread.java:745) [na:1.8.0_60]
Caused by: org.apache.cassandra.io.sstable.CorruptSSTableException: java.io.IOException: Seek position 717680 is not within mmap segment (seg offs: 0, length: 717680)
	at org.apache.cassandra.io.sstable.format.big.BigTableReader.getPosition(BigTableReader.java:250) ~[apache-cassandra-2.2.2.jar:2.2.2]
	at org.apache.cassandra.io.sstable.format.SSTableReader.getPosition(SSTableReader.java:1558) ~[apache-cassandra-2.2.2.jar:2.2.2]
	at org.apache.cassandra.io.sstable.format.big.SSTableSliceIterator.&amp;lt;init&amp;gt;(SSTableSliceIterator.java:42) ~[apache-cassandra-2.2.2.jar:2.2.2]
	at org.apache.cassandra.io.sstable.format.big.BigTableReader.iterator(BigTableReader.java:75) ~[apache-cassandra-2.2.2.jar:2.2.2]
	at org.apache.cassandra.db.filter.SliceQueryFilter.getSSTableColumnIterator(SliceQueryFilter.java:246) ~[apache-cassandra-2.2.2.jar:2.2.2]
	at org.apache.cassandra.db.filter.QueryFilter.getSSTableColumnIterator(QueryFilter.java:62) ~[apache-cassandra-2.2.2.jar:2.2.2]
	at org.apache.cassandra.db.CollationController.collectAllData(CollationController.java:270) ~[apache-cassandra-2.2.2.jar:2.2.2]
	at org.apache.cassandra.db.CollationController.getTopLevelColumns(CollationController.java:64) ~[apache-cassandra-2.2.2.jar:2.2.2]
	at org.apache.cassandra.db.ColumnFamilyStore.getTopLevelColumns(ColumnFamilyStore.java:2004) ~[apache-cassandra-2.2.2.jar:2.2.2]
	at org.apache.cassandra.db.ColumnFamilyStore.getColumnFamily(ColumnFamilyStore.java:1808) ~[apache-cassandra-2.2.2.jar:2.2.2]
	at org.apache.cassandra.db.Keyspace.getRow(Keyspace.java:360) ~[apache-cassandra-2.2.2.jar:2.2.2]
	at org.apache.cassandra.db.SliceFromReadCommand.getRow(SliceFromReadCommand.java:85) ~[apache-cassandra-2.2.2.jar:2.2.2]
	at org.apache.cassandra.service.StorageProxy$LocalReadRunnable.runMayThrow(StorageProxy.java:1537) ~[apache-cassandra-2.2.2.jar:2.2.2]
	at org.apache.cassandra.service.StorageProxy$DroppableRunnable.run(StorageProxy.java:2183) ~[apache-cassandra-2.2.2.jar:2.2.2]
	... 4 common frames omitted
Caused by: java.io.IOException: Seek position 717680 is not within mmap segment (seg offs: 0, length: 717680)
	at org.apache.cassandra.io.util.ByteBufferDataInput.seek(ByteBufferDataInput.java:47) ~[apache-cassandra-2.2.2.jar:2.2.2]
	at org.apache.cassandra.io.util.AbstractDataInput.skipBytes(AbstractDataInput.java:33) ~[apache-cassandra-2.2.2.jar:2.2.2]
	at org.apache.cassandra.io.util.FileUtils.skipBytesFully(FileUtils.java:405) ~[apache-cassandra-2.2.2.jar:2.2.2]
	at org.apache.cassandra.db.RowIndexEntry$Serializer.skipPromotedIndex(RowIndexEntry.java:164) ~[apache-cassandra-2.2.2.jar:2.2.2]
	at org.apache.cassandra.db.RowIndexEntry$Serializer.skip(RowIndexEntry.java:155) ~[apache-cassandra-2.2.2.jar:2.2.2]
	at org.apache.cassandra.io.sstable.format.big.BigTableReader.getPosition(BigTableReader.java:244) ~[apache-cassandra-2.2.2.jar:2.2.2]
	... 17 common frames omitted
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment>&lt;p&gt;Cassandra 2.2.2 &lt;br/&gt;
Java 1.8.0.60&lt;/p&gt;</environment>
        <key id="12903331">CASSANDRA-10478</key>
            <summary>Seek position is not within mmap segment</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10000" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Urgent</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="benedict">Benedict Elliott Smith</assignee>
                                    <reporter username="mroi">Omri Iluz</reporter>
                        <labels>
                    </labels>
                <created>Thu, 8 Oct 2015 11:33:07 +0000</created>
                <updated>Tue, 16 Apr 2019 09:30:53 +0000</updated>
                            <resolved>Mon, 12 Oct 2015 07:40:52 +0000</resolved>
                                        <fixVersion>2.1.11</fixVersion>
                    <fixVersion>2.2.3</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>9</watches>
                                                                                                                <comments>
                            <comment id="14948822" author="philipthompson" created="Thu, 8 Oct 2015 15:18:27 +0000"  >&lt;p&gt;Could you attach a full system.log from an affected node. &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=benedict&quot; class=&quot;user-hover&quot; rel=&quot;benedict&quot;&gt;benedict&lt;/a&gt;, you&apos;re the mmap expert, do you want to look into this?&lt;/p&gt;</comment>
                            <comment id="14948866" author="benedict" created="Thu, 8 Oct 2015 15:41:21 +0000"  >&lt;p&gt;Patch available &lt;a href=&quot;https://github.com/belliottsmith/cassandra/tree/10478&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;here&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14948948" author="philipthompson" created="Thu, 8 Oct 2015 16:29:25 +0000"  >&lt;p&gt;Should I look for a reviewer, or should we wait until &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mroi&quot; class=&quot;user-hover&quot; rel=&quot;mroi&quot;&gt;mroi&lt;/a&gt; has a chance to try out the patch?&lt;/p&gt;</comment>
                            <comment id="14950022" author="mroi" created="Fri, 9 Oct 2015 07:29:15 +0000"  >&lt;p&gt;I can confirm that the patch solved the issue, thank you.&lt;/p&gt;</comment>
                            <comment id="14950081" author="benedict" created="Fri, 9 Oct 2015 08:40:26 +0000"  >&lt;p&gt;This bug is ironic, and perhaps urgent. It was introduced by a change not intended to be included in the patch for &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-10357&quot; title=&quot;mmap file boundary selection is broken for some large files&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-10357&quot;&gt;&lt;del&gt;CASSANDRA-10357&lt;/del&gt;&lt;/a&gt; (as the approach did not require it). Despite adding pretty thorough tests for the intended changes, there were unfortunately no tests covering this unintended change. I have updated this patch to rectify that by introducing unit tests for this class that would catch this bug, and by rolling back the change to this class entirely. &lt;/p&gt;

&lt;p&gt;The tests also demonstrated that &lt;tt&gt;markSupported&lt;/tt&gt; returns false, when in fact marks are supported, however I have opted not to fix that in this change, since it isn&apos;t required.&lt;/p&gt;

&lt;p&gt;We should strongly consider re-releasing 2.1 and 2.2, as this &lt;em&gt;could&lt;/em&gt; be a very prevalent bug, despite being a small and stupid one.&lt;/p&gt;</comment>
                            <comment id="14950091" author="slebresne" created="Fri, 9 Oct 2015 08:54:18 +0000"  >&lt;p&gt;Assigning &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tjake&quot; class=&quot;user-hover&quot; rel=&quot;tjake&quot;&gt;tjake&lt;/a&gt; as reviewer since he reviewed &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-10357&quot; title=&quot;mmap file boundary selection is broken for some large files&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-10357&quot;&gt;&lt;del&gt;CASSANDRA-10357&lt;/del&gt;&lt;/a&gt; initially. I tend to agree that this sound important enough to probably warrant a release once it&apos;s committed.&lt;/p&gt;</comment>
                            <comment id="14950348" author="tjake" created="Fri, 9 Oct 2015 13:07:05 +0000"  >&lt;p&gt;+1&lt;/p&gt;

&lt;p&gt;Thankfully this isn&apos;t a bug in the updating of the boundaries themselves.&lt;/p&gt;

&lt;p&gt;Once committed I&apos;ll cut new 2.1 and 2.2 releases&lt;/p&gt;</comment>
                            <comment id="14952758" author="benedict" created="Mon, 12 Oct 2015 07:40:52 +0000"  >&lt;p&gt;Committed as f87e34ed3c82a7b0b73178a6ce565a1227a7457b&lt;/p&gt;</comment>
                            <comment id="14952919" author="jippignu" created="Mon, 12 Oct 2015 10:54:41 +0000"  >&lt;p&gt;when will this be released as a binary ? we are hitting the same issue currently&lt;/p&gt;

&lt;p&gt;is there any workaround I can apply configuration wise?&lt;/p&gt;</comment>
                            <comment id="14952924" author="benedict" created="Mon, 12 Oct 2015 10:59:53 +0000"  >&lt;p&gt;It will be released very soon. Most likely in 2-3 days.&lt;/p&gt;

&lt;p&gt;You could switch to standard disk access mode until then. The problems being: this may result in lower throughput, and will also result in a rebuild of the summary files of all of your data on restart (and again when you flip back), which could be costly (i.e. startup will be slow). Strictly this could be avoided, with the same approach as &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-10357&quot; title=&quot;mmap file boundary selection is broken for some large files&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-10357&quot;&gt;&lt;del&gt;CASSANDRA-10357&lt;/del&gt;&lt;/a&gt;, but this would take longer to deliver than just the new release.&lt;/p&gt;</comment>
                            <comment id="14953025" author="jippignu" created="Mon, 12 Oct 2015 11:50:04 +0000"  >&lt;p&gt;okay, I changed to standard disk mode, my dataset is just a few TB, so went pretty fast with rebuilding the summary files&lt;/p&gt;

&lt;p&gt;will the next release be 2.2.3 ?&lt;/p&gt;</comment>
                            <comment id="14953028" author="benedict" created="Mon, 12 Oct 2015 11:51:22 +0000"  >&lt;blockquote&gt;&lt;p&gt;will the next release be 2.2.3 ?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Yes&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                                                <inwardlinks description="is duplicated by">
                                        <issuelink>
            <issuekey id="12903577">CASSANDRA-10493</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[benedict]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 6 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2mqwv:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12311421" key="com.atlassian.jira.plugin.system.customfieldtypes:multiversion">
                        <customfieldname>Reproduced In</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="12333319">2.2.2</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>tjake</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[tjake]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12963"><![CDATA[Critical]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12311420" key="com.atlassian.jira.plugin.system.customfieldtypes:version">
                        <customfieldname>Since Version</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="12333319">2.2.2</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>