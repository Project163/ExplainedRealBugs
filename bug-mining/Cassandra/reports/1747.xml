<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 22:34:48 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-4533] Multithreaded cache saving can skip caches</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-4533</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;Cassandra flushes the key and row cache to disk periodically. It also uses a atomic flag in flushInProgress to enforce single cache writer at any time.&lt;/p&gt;

&lt;p&gt;However, the cache saving task could be submitted to CompactionManager concurrently, as long as the number of worker thread in CompactionManager is larger than 1. &lt;/p&gt;

&lt;p&gt;Due to the effect of above atomic flag, only one cache will be written out to disk. Other writer are cancelled when the flag is true.&lt;/p&gt;

&lt;p&gt;I observe the situation in Cassandra 1.0. If nothing is changed, the problem should remain in Cassandra 1.1, either.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12603184">CASSANDRA-4533</key>
            <summary>Multithreaded cache saving can skip caches</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10003" iconUrl="https://issues.apache.org/jira/images/icons/priorities/trivial.svg">Low</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="yukim">Yuki Morishita</assignee>
                                    <reporter username="hanzhu">Zhu Han</reporter>
                        <labels>
                    </labels>
                <created>Mon, 13 Aug 2012 06:40:40 +0000</created>
                <updated>Tue, 16 Apr 2019 09:32:29 +0000</updated>
                            <resolved>Wed, 22 Aug 2012 14:01:47 +0000</resolved>
                                        <fixVersion>1.1.5</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="13434462" author="jbellis" created="Tue, 14 Aug 2012 20:15:45 +0000"  >&lt;p&gt;Looks like we should switch to a ConcurrentSet like we did in Memtable.meteringInProgress.&lt;/p&gt;</comment>
                            <comment id="13434830" author="hanzhu" created="Wed, 15 Aug 2012 06:15:13 +0000"  >&lt;p&gt;Is it possible to fix it also in 1.0?&lt;/p&gt;</comment>
                            <comment id="13435116" author="jbellis" created="Wed, 15 Aug 2012 13:50:54 +0000"  >&lt;p&gt;No, it&apos;s not worth risking regressions over in 1.0.x. &lt;/p&gt;

&lt;p&gt;The good news is that 1.1.4+ look pretty stable.&lt;/p&gt;</comment>
                            <comment id="13435198" author="hanzhu" created="Wed, 15 Aug 2012 15:19:32 +0000"  >&lt;p&gt;Looks like we have to maintain our own fork, as we can not keep up with the upgrade cycle... &lt;/p&gt;</comment>
                            <comment id="13438177" author="yukim" created="Mon, 20 Aug 2012 20:33:25 +0000"  >&lt;p&gt;Attaching patch against 1.1 branch.&lt;br/&gt;
Caches are grobal since 1.1, so I used CacheType as key for flushInProgerss concurrent set.&lt;/p&gt;</comment>
                            <comment id="13438996" author="jbellis" created="Tue, 21 Aug 2012 20:08:40 +0000"  >&lt;p&gt;Hmm, I don&apos;t think this quite works because it still means we can skip saving cache for CF X when CF Y is being flushed.&lt;/p&gt;

&lt;p&gt;I think the problem this code is trying to solve, over a basic executor + queue, is multiple tasks for X getting queued up while (say) compaction is sucking a lot of i/o, then firing off those cache-save tasks for X faster than the defined saving period when it speeds up.&lt;/p&gt;

&lt;p&gt;I guess we could make it a Pair&amp;lt;CF, CacheType&amp;gt;?&lt;/p&gt;

&lt;p&gt;TBH this is probably premature optimization, if your cache period is so frequent that multiple queued tasks is a problem, then you should just fix that.  I&apos;d be okay with just ripping this out.  Alternatively, we could have the task check to see if the last-saved cache is older than M minutes before overwriting it, similar to how normal background compaction submissions are a no-op if it turns out there&apos;s nothing to do by the time we execute the task.&lt;/p&gt;</comment>
                            <comment id="13439199" author="yukim" created="Wed, 22 Aug 2012 01:05:42 +0000"  >&lt;blockquote&gt;&lt;p&gt;Hmm, I don&apos;t think this quite works because it still means we can skip saving cache for CF X when CF Y is being flushed.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;In my understanding, since 1.1, C* stores key and row caches globally, those are saved at once for every CF for each cache type.&lt;br/&gt;
AutoSavingCache$Writer writes all CF for certain CacheType in one execution.&lt;/p&gt;</comment>
                            <comment id="13439231" author="jbellis" created="Wed, 22 Aug 2012 02:24:09 +0000"  >&lt;p&gt;You&apos;re right, my mistake.  +1&lt;/p&gt;</comment>
                            <comment id="13439541" author="yukim" created="Wed, 22 Aug 2012 14:01:47 +0000"  >&lt;p&gt;Committed, thanks!&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12541641" name="4533-1.1.txt" size="2693" author="yukim" created="Mon, 20 Aug 2012 20:33:25 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[yukim]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>256223</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            13 years, 13 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0gwtj:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>96747</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>jbellis</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[jbellis]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12961"><![CDATA[Low]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>