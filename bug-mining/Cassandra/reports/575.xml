<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 22:17:53 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-1715] More schema migration race conditions</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-1715</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;Related to &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-1631&quot; title=&quot;dropping column families and keyspaces races with compaction and flushing&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-1631&quot;&gt;&lt;del&gt;CASSANDRA-1631&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;This is still a bug with schema updates to an existing CF, since reloadCf is doing a unload/init cycle. So flushing + compaction is an issue there as well. Here is a stacktrace from during an index creation where it stubbed its toe on an incomplete sstable from an in-progress compaction (path names anonymized):&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;INFO [CompactionExecutor:1] 2010-11-02 16:31:00,553 CompactionManager.java (line 224) Compacting [org.apache.cassandra.io.sstable.SSTableReader(path=&lt;span class=&quot;code-quote&quot;&gt;&apos;Standard1-e-6-Data.db&apos;&lt;/span&gt;),org.apache.cassandra.io.sstable.SSTableReader(path=&lt;span class=&quot;code-quote&quot;&gt;&apos;Standard1-e-7-Data.db&apos;&lt;/span&gt;),org.apache.cassandra.io.sstable.SSTableReader(path=&lt;span class=&quot;code-quote&quot;&gt;&apos;Standard1-e-8-Data.db&apos;&lt;/span&gt;),org.apache.cassandra.io.sstable.SSTableReader(path=&lt;span class=&quot;code-quote&quot;&gt;&apos;Standard1-e-9-Data.db&apos;&lt;/span&gt;)]
...
ERROR [MigrationStage:1] 2010-11-02 16:31:10,939 ColumnFamilyStore.java (line 244) Corrupt sstable Standard1-tmp-e-10-&amp;lt;&amp;gt;=[Data.db, Index.db]; skipped
java.io.EOFException
        at org.apache.cassandra.utils.FBUtilities.skipShortByteArray(FBUtilities.java:308)
        at org.apache.cassandra.io.sstable.SSTable.estimateRowsFromIndex(SSTable.java:231)
        at org.apache.cassandra.io.sstable.SSTableReader.load(SSTableReader.java:286)
        at org.apache.cassandra.io.sstable.SSTableReader.open(SSTableReader.java:202)
        at org.apache.cassandra.db.ColumnFamilyStore.&amp;lt;init&amp;gt;(ColumnFamilyStore.java:235)
        at org.apache.cassandra.db.ColumnFamilyStore.createColumnFamilyStore(ColumnFamilyStore.java:443)
        at org.apache.cassandra.db.ColumnFamilyStore.createColumnFamilyStore(ColumnFamilyStore.java:431)
        at org.apache.cassandra.db.Table.initCf(Table.java:335)
        at org.apache.cassandra.db.Table.reloadCf(Table.java:343)
        at org.apache.cassandra.db.migration.UpdateColumnFamily.applyModels(UpdateColumnFamily.java:89)
        at org.apache.cassandra.db.migration.Migration.apply(Migration.java:158)
        at org.apache.cassandra.thrift.CassandraServer$2.call(CassandraServer.java:672)
        at java.util.concurrent.FutureTask$Sync.innerRun(FutureTask.java:303)
        at java.util.concurrent.FutureTask.run(FutureTask.java:138)
        at java.util.concurrent.ThreadPoolExecutor$Worker.runTask(ThreadPoolExecutor.java:886)
        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:908)
        at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:619)
...
 INFO [CompactionExecutor:1] 2010-11-02 16:31:31,970 CompactionManager.java (line 303) Compacted to Standard1-tmp-e-10-Data.db.  213,657,983 to 213,657,983 (~100% of original) bytes &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; 626,563 keys.  Time: 31,416ms.
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;There is also a race between schema modification and streaming.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12479261">CASSANDRA-1715</key>
            <summary>More schema migration race conditions</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10000" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Urgent</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="gdusbabek">Gary Dusbabek</assignee>
                                    <reporter username="jbellis">Jonathan Ellis</reporter>
                        <labels>
                    </labels>
                <created>Fri, 5 Nov 2010 21:12:28 +0000</created>
                <updated>Tue, 16 Apr 2019 09:33:13 +0000</updated>
                            <resolved>Fri, 19 Nov 2010 17:04:38 +0000</resolved>
                                        <fixVersion>0.7.0 rc 1</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                                                                <comments>
                            <comment id="12929811" author="gdusbabek" created="Mon, 8 Nov 2010 23:25:56 +0000"  >&lt;p&gt;Be prepared to throw up a little.&lt;/p&gt;

&lt;p&gt;This approach puts a lock around CompactionManager. Migrations have to acquire it and Table.flushLock before proceeding.  Special care had to be taking when reloading a CFS since it places blocking jobs on the compaction manager.  This patch should handle the streaming race as well (when the directory specified in a Descriptor is no longer valid).&lt;/p&gt;</comment>
                            <comment id="12929815" author="jbellis" created="Mon, 8 Nov 2010 23:33:05 +0000"  >&lt;p&gt;Also, out of curiosity, what were the main complications w/ mutable CFS.metadata?&lt;/p&gt;</comment>
                            <comment id="12929825" author="gdusbabek" created="Mon, 8 Nov 2010 23:48:08 +0000"  >&lt;blockquote&gt;&lt;p&gt;what were the main complications w/ mutable CFS.metadata?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;There were a couple things. A new memtable would need to know about the updated meta settings for thresholds.  The timing here is tricky because of flushing (chances are you would have just flushed and have an empty memtable in anyway, but one can&apos;t be too sure).  Other things... Make sure secondary indexes are dealt with properly on updates (e.g.: not reloaded needlessly).  Efficiently dealing with SSTableReader instances--certain classes up updates wouldn&apos;t require messing with them at all, but others would (when files move).  Ideally, it would be nice to repoint a few instances of SSTable at new data files and have all caches, stats, etc. remain intact.&lt;/p&gt;</comment>
                            <comment id="12929889" author="jbellis" created="Tue, 9 Nov 2010 02:02:17 +0000"  >&lt;p&gt;UpdateColumnFamily doesn&apos;t acquireLocks().  (Shouldn&apos;t Migration do that so the subclasses don&apos;t have to?)&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;A new memtable would need to know about the updated meta settings for thresholds. The timing here is tricky because of flushing (chances are you would have just flushed and have an empty memtable in anyway, but one can&apos;t be too sure).&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;This gets a little messy code-wise (because we allow overriding memtable settings at runtime) but not too bad.  At worst we just set the CFS values to the new migration values during application.  I don&apos;t see any timing issues (Memtable.isThresholdViolated checks w/ the CFS each time, it doesn&apos;t cache locally).&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;Make sure secondary indexes are dealt with properly on updates (e.g.: not reloaded needlessly).&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Writing code to detect when indexes are added/dropped is a pain compared to just rebuilding it from scratch, but efficiency-wise it seems like a win. At least mutating you can avoid redoing the index sampling every time.  Stopping updates in their tracks while we reload, to change read_repair_chance, is really brutal.  (If UpdateCF doesn&apos;t actually need to acquireLocks then never mind, but I think it does.)&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;Efficiently dealing with SSTableReader instances--certain classes up updates wouldn&apos;t require messing with them at all, but others would (when files move). &lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;What is making files move here?&lt;/p&gt;</comment>
                            <comment id="12929893" author="gdusbabek" created="Tue, 9 Nov 2010 02:10:25 +0000"  >&lt;blockquote&gt;&lt;p&gt;What is making files move here?&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Renaming. Sorry.  I know we&apos;ll need to implement it eventually, so I can&apos;t stop thinking about it. That one doesn&apos;t matter in this context.&lt;/p&gt;</comment>
                            <comment id="12930123" author="gdusbabek" created="Tue, 9 Nov 2010 14:03:28 +0000"  >&lt;blockquote&gt;&lt;p&gt;UpdateColumnFamily doesn&apos;t acquireLocks().&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;It does on line 82 in my checkout.&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;Shouldn&apos;t Migration do that so the subclasses don&apos;t have to?&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;It doesn&apos;t make sense to lock on the Add* methods, but I agree it might be easier just to do the locking in the superclass. What do you think?&lt;/p&gt;</comment>
                            <comment id="12930639" author="gdusbabek" created="Wed, 10 Nov 2010 16:21:29 +0000"  >&lt;p&gt;v2 shows what the CFS/CFM reload approach would probably look like for UpdateColumnFamily.  Unfortunately it touches a lot of code and might not be warranted at this late stage in the beta cycle.  &lt;/p&gt;

&lt;p&gt;If left for 0.7.1, I need to explain that it changes the serialization format for Migrations in a non-backwards compatible way, which is not desirable.  The same kind of work would have to be done for the other Migration subclasses.&lt;/p&gt;

&lt;p&gt;This is mainly a demonstration, but one thing I&apos;d definitely change is to use the avro CfDef in the UpdateColumnFamily constructor instead of the thrift version.&lt;/p&gt;</comment>
                            <comment id="12931890" author="jbellis" created="Sun, 14 Nov 2010 21:25:35 +0000"  >&lt;p&gt;The v2 approach looks great.  I think the main improvement we need is to not do blocking flushes while the locks are held.  For the purposes of creating a new memtable a nonblocking flush is fine.  For creating indexes we&apos;ll need to set up a callback to do the index building after the flush completes.  (We used to have code that took a callback arg as part of the flush call, I think I took it out but it should be relatively easy to resurrect.)  I agree that it touches a lot of code, but the core changes (i.e. not one-line things like encapsulating gcgraceseconds that are messy but not dangerous) aren&apos;t much larger than v1.  The huge improvement over waiting to re-sample indexes after UpdateCF is worth it imo.&lt;/p&gt;

&lt;p&gt;I&apos;m also fine with saying that changing the CFS will blow away any JMX-applied changes and reset values to what the new CFM says the should be.  But if you are happy with the Default* approach I am too.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;If left for 0.7.1, I need to explain that it changes the serialization format for Migrations in a non-backwards compatible way, which is not desirable&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Is this saying that we&apos;d need to tell beta3 users to rebuild their schemas if this goes in?  I am fine with that, I just want to make sure I understand.&lt;/p&gt;</comment>
                            <comment id="12932052" author="gdusbabek" created="Mon, 15 Nov 2010 13:35:38 +0000"  >&lt;blockquote&gt;&lt;p&gt;Is this saying that we&apos;d need to tell beta3 users to rebuild their schemas if this goes in? I am fine with that, I just want to make sure I understand.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Yes, exactly.&lt;/p&gt;

&lt;p&gt;I&apos;ll go ahead and finish this patch in the v2 direction.&lt;/p&gt;</comment>
                            <comment id="12932255" author="gdusbabek" created="Mon, 15 Nov 2010 23:27:27 +0000"  >&lt;p&gt;0008 addresses the flushes-within-locks brought up by jonathan.  0009 and 0010 are cleanup.&lt;/p&gt;</comment>
                            <comment id="12933379" author="jbellis" created="Thu, 18 Nov 2010 10:08:31 +0000"  >&lt;p&gt;new version of 06 to rebase.&lt;/p&gt;

&lt;p&gt;11 makes addIndex asynchronous which unclogs the post-flush executor (which is single-threaded for safety, so a long index build would mean we don&apos;t clean up any commitlogs until it&apos;s done) and also makes restarting when a new index is not yet complete friendlier.&lt;/p&gt;

&lt;p&gt;I don&apos;t think we need the locks on Update anymore since we&apos;re keeping the same Tracker and so forth so 12 removes that.  locks are still needed for Drop.&lt;/p&gt;

&lt;p&gt;What do you think?&lt;/p&gt;</comment>
                            <comment id="12933544" author="gdusbabek" created="Thu, 18 Nov 2010 19:49:05 +0000"  >&lt;p&gt;I think update still needs to acquire the locks for the case when secondary indexes are dropped.  The locking could conceivably be pushed down to the point in CFS when the indexes are dropped though, at which point we&apos;d need to remove the assert from the beginning of CFS.reload() and make the members that get reset in reload() volatile (minCompactionThreshold, maxCompactionThreshold, etc.).&lt;/p&gt;</comment>
                            <comment id="12933550" author="gdusbabek" created="Thu, 18 Nov 2010 19:59:31 +0000"  >&lt;p&gt;0012 causes several unit tests to fail.  You might want to take a closer look at it.&lt;/p&gt;</comment>
                            <comment id="12933812" author="jbellis" created="Fri, 19 Nov 2010 14:23:35 +0000"  >&lt;p&gt;new 0012.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;the locking could conceivably be pushed down to the point in CFS when the indexes are dropped &lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;right, this is what 0011 does.  more accurately, it uses CSLM to avoid an explicit lock.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;at which point we&apos;d need to remove the assert from the beginning of CFS.reload() and make the members that get reset in reload() volatile (minCompactionThreshold, maxCompactionThreshold, etc.). &lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;done.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;0012 causes several unit tests to fail&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;one was the assert, one was an unrelated commitlog bug that got exposed by something unrelated.  fixed.&lt;/p&gt;</comment>
                            <comment id="12933827" author="gdusbabek" created="Fri, 19 Nov 2010 14:57:40 +0000"  >&lt;blockquote&gt;&lt;p&gt;right, this is what 0011 does. more accurately, it uses CSLM to avoid an explicit lock.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;My argument was that it wasn&apos;t safe to call indexCfs.removeAllSSTables() without the flush lock, but it looks like SSTableTracker is properly synchronized to avoid any problems with flushing.  No problem here.&lt;/p&gt;

&lt;p&gt;+1 I&apos;ll commit this shortly.&lt;/p&gt;</comment>
                            <comment id="12933866" author="gdusbabek" created="Fri, 19 Nov 2010 17:04:38 +0000"  >&lt;p&gt;committed.&lt;/p&gt;</comment>
                            <comment id="12933946" author="hudson" created="Fri, 19 Nov 2010 20:05:41 +0000"  >&lt;p&gt;Integrated in Cassandra-0.7 #19 (See &lt;a href=&quot;https://hudson.apache.org/hudson/job/Cassandra-0.7/19/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://hudson.apache.org/hudson/job/Cassandra-0.7/19/&lt;/a&gt;)&lt;/p&gt;
</comment>
                            <comment id="12934135" author="hudson" created="Sat, 20 Nov 2010 12:48:25 +0000"  >&lt;p&gt;Integrated in Cassandra #602 (See &lt;a href=&quot;https://hudson.apache.org/hudson/job/Cassandra/602/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://hudson.apache.org/hudson/job/Cassandra/602/&lt;/a&gt;)&lt;br/&gt;
    remove locks from UpdateColumnFamily. patch by jbellis, reviewed by gdusbabek. &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-1715&quot; title=&quot;More schema migration race conditions&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-1715&quot;&gt;&lt;del&gt;CASSANDRA-1715&lt;/del&gt;&lt;/a&gt;&lt;br/&gt;
make addIndex asynchronous and race proof. patch by jbellis, reviewed by gdusbabek. &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-1715&quot; title=&quot;More schema migration race conditions&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-1715&quot;&gt;&lt;del&gt;CASSANDRA-1715&lt;/del&gt;&lt;/a&gt;&lt;br/&gt;
remove unused fields in DropColumnFamily, DropKeyspace. patch by gdusbabek, reviewe by jbellis. &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-1715&quot; title=&quot;More schema migration race conditions&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-1715&quot;&gt;&lt;del&gt;CASSANDRA-1715&lt;/del&gt;&lt;/a&gt;&lt;br/&gt;
use avro structures inside UpdateColumnFamily. patch by gdusbabek, reviewe by jbellis. &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-1715&quot; title=&quot;More schema migration race conditions&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-1715&quot;&gt;&lt;del&gt;CASSANDRA-1715&lt;/del&gt;&lt;/a&gt;&lt;br/&gt;
perform index maintenance outside of migration locks during CF update. patch by gdusbabek, reviewe by jbellis. &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-1715&quot; title=&quot;More schema migration race conditions&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-1715&quot;&gt;&lt;del&gt;CASSANDRA-1715&lt;/del&gt;&lt;/a&gt;&lt;br/&gt;
updateColumnFamily uses reload, remove unneccesary structures, fix bugs. patch by gdusbabek, reviewe by jbellis. &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-1715&quot; title=&quot;More schema migration race conditions&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-1715&quot;&gt;&lt;del&gt;CASSANDRA-1715&lt;/del&gt;&lt;/a&gt;&lt;br/&gt;
replace modifiable CFM members with private fields and public getters. patch by gdusbabek, reviewe by jbellis. &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-1715&quot; title=&quot;More schema migration race conditions&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-1715&quot;&gt;&lt;del&gt;CASSANDRA-1715&lt;/del&gt;&lt;/a&gt;&lt;br/&gt;
CFS.reload() assumes metadata is mutable. patch by gdusbabek, reviewe by jbellis. &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-1715&quot; title=&quot;More schema migration race conditions&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-1715&quot;&gt;&lt;del&gt;CASSANDRA-1715&lt;/del&gt;&lt;/a&gt;&lt;br/&gt;
handle moved/dropped CF prior to pending compaction/streams. patch by gdusbabek, reviewe by jbellis. &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-1715&quot; title=&quot;More schema migration race conditions&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-1715&quot;&gt;&lt;del&gt;CASSANDRA-1715&lt;/del&gt;&lt;/a&gt;&lt;br/&gt;
migration uses locks. patch by gdusbabek, reviewe by jbellis. &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-1715&quot; title=&quot;More schema migration race conditions&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-1715&quot;&gt;&lt;del&gt;CASSANDRA-1715&lt;/del&gt;&lt;/a&gt;&lt;br/&gt;
compaction lock. patch by gdusbabek, reviewe by jbellis. &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-1715&quot; title=&quot;More schema migration race conditions&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-1715&quot;&gt;&lt;del&gt;CASSANDRA-1715&lt;/del&gt;&lt;/a&gt;&lt;br/&gt;
take drop off CompactionManager. patch by gdusbabek, reviewe by jbellis. &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-1715&quot; title=&quot;More schema migration race conditions&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-1715&quot;&gt;&lt;del&gt;CASSANDRA-1715&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="12934689" author="tjake" created="Tue, 23 Nov 2010 01:32:42 +0000"  >&lt;p&gt;During testing I hit this section of code:&lt;/p&gt;

&lt;p&gt;CFMetaData.java:662 &lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;  &lt;span class=&quot;code-comment&quot;&gt;// remove the ones leaving.
&lt;/span&gt;        &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; (ByteBuffer indexName : toRemove)
            column_metadata.remove(indexName);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;but column_metadata is defined as:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;        &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.column_metadata = Collections.unmodifiableMap(column_metadata);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;So remove() will throw an exception.&lt;/p&gt;</comment>
                            <comment id="12934704" author="jbellis" created="Tue, 23 Nov 2010 02:07:56 +0000"  >&lt;p&gt;can you open a new ticket for that?&lt;/p&gt;</comment>
                            <comment id="12934706" author="tjake" created="Tue, 23 Nov 2010 02:15:03 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-1768&quot; title=&quot;UnsupportedOperationException in system_update_column_family&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-1768&quot;&gt;&lt;del&gt;CASSANDRA-1768&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12459653" name="ASF.LICENSE.NOT.GRANTED--v3-0001-take-drop-off-CompactionManager.txt" size="6382" author="gdusbabek" created="Mon, 15 Nov 2010 23:25:57 +0000"/>
                            <attachment id="12459654" name="ASF.LICENSE.NOT.GRANTED--v3-0002-compaction-lock.txt" size="12200" author="gdusbabek" created="Mon, 15 Nov 2010 23:25:57 +0000"/>
                            <attachment id="12459655" name="ASF.LICENSE.NOT.GRANTED--v3-0003-migration-uses-locks.txt" size="10026" author="gdusbabek" created="Mon, 15 Nov 2010 23:25:57 +0000"/>
                            <attachment id="12459656" name="ASF.LICENSE.NOT.GRANTED--v3-0004-handle-moved-dropped-CF-prior-to-pending-compaction-st.txt" size="6870" author="gdusbabek" created="Mon, 15 Nov 2010 23:25:57 +0000"/>
                            <attachment id="12459657" name="ASF.LICENSE.NOT.GRANTED--v3-0005-CFS.reload-assumes-metadata-is-mutable.txt" size="11968" author="gdusbabek" created="Mon, 15 Nov 2010 23:25:57 +0000"/>
                            <attachment id="12459659" name="ASF.LICENSE.NOT.GRANTED--v3-0007-updateColumnFamily-uses-reload-remove-unneccesary-stru.txt" size="33502" author="gdusbabek" created="Mon, 15 Nov 2010 23:25:57 +0000"/>
                            <attachment id="12459660" name="ASF.LICENSE.NOT.GRANTED--v3-0008-perform-index-maintenance-outside-of-migration-locks-d.txt" size="7315" author="gdusbabek" created="Mon, 15 Nov 2010 23:25:58 +0000"/>
                            <attachment id="12459661" name="ASF.LICENSE.NOT.GRANTED--v3-0009-use-avro-structures-inside-UpdateColumnFamily.txt" size="21888" author="gdusbabek" created="Mon, 15 Nov 2010 23:25:58 +0000"/>
                            <attachment id="12459662" name="ASF.LICENSE.NOT.GRANTED--v3-0010-remove-unused-fields-in-DropColumnFamily-DropKeyspace.txt" size="8659" author="gdusbabek" created="Mon, 15 Nov 2010 23:25:58 +0000"/>
                            <attachment id="12459906" name="v3-0006-replace-modifiable-CFM-members-with-private-fields-a.patch" size="28283" author="jbellis" created="Thu, 18 Nov 2010 10:05:47 +0000"/>
                            <attachment id="12459907" name="v3-0011-make-addIndex-asynchronous-and-race-proof.patch" size="9992" author="jbellis" created="Thu, 18 Nov 2010 10:06:05 +0000"/>
                            <attachment id="12460004" name="v3-0012-remove-locks-from-UpdateColumnFamily.patch" size="3901" author="jbellis" created="Fri, 19 Nov 2010 14:23:35 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>12.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[gdusbabek]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>20269</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            15 years, 1 week ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0g6xz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>92555</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12963"><![CDATA[Critical]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>