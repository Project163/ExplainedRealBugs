<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 23:16:43 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-15976] Incorrect parsing of the timestamp with less than 3 digits in the milliseconds</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-15976</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;(tested on 4.0-beta1, but should be in all versions)&lt;/p&gt;

&lt;p&gt;Right now, Cassandra incorrectly handles timestamps with less than 3 digits in the milliseconds part.  Timestamps (valid from the Java point of view (see below output in Scala) are either rejected (if we have 1 digit only), or incorrectly parsed when 2 digits are specified:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;cqlsh&amp;gt; create table test.tm (id int primary key, tm timestamp);
cqlsh&amp;gt; insert into test.tm(id, tm) values (2, &apos;2020-07-24T10:00:01.2Z&apos;);
InvalidRequest: Error from server: code=2200 [Invalid query] message=&quot;Unable to coerce &apos;2020-07-24T10:00:01.2Z&apos; to a formatted date (long)&quot;
cqlsh&amp;gt; insert into test.tm(id, tm) values (1, &apos;2020-07-24T10:00:01.12Z&apos;);
cqlsh&amp;gt; select * from test.tm;

 id | tm
----+---------------------------------
  1 | 2020-07-24 10:00:01.012000+0000

(1 rows)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Checking with Instant:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;scala&amp;gt; java.time.Instant.parse(&quot;2020-07-24T10:00:01.12Z&quot;)
res0: java.time.Instant = 2020-07-24T10:00:01.120Z
scala&amp;gt; java.time.Instant.parse(&quot;2020-07-24T10:00:01.2Z&quot;)
res1: java.time.Instant = 2020-07-24T10:00:01.200Z
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Imho it should be fixed (Cc: &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=aholmber&quot; class=&quot;user-hover&quot; rel=&quot;aholmber&quot;&gt;aholmber&lt;/a&gt;)&lt;/p&gt;</description>
                <environment></environment>
        <key id="13319100">CASSANDRA-15976</key>
            <summary>Incorrect parsing of the timestamp with less than 3 digits in the milliseconds</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10002" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Normal</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="aholmber">Adam Holmberg</assignee>
                                    <reporter username="alexott">Alex Ott</reporter>
                        <labels>
                    </labels>
                <created>Fri, 24 Jul 2020 06:26:24 +0000</created>
                <updated>Wed, 23 Mar 2022 14:33:33 +0000</updated>
                            <resolved>Thu, 13 Aug 2020 21:20:50 +0000</resolved>
                                        <fixVersion>4.0-beta2</fixVersion>
                    <fixVersion>4.0</fixVersion>
                                    <component>CQL/Interpreter</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="17175843" author="aholmber" created="Tue, 11 Aug 2020 21:14:56 +0000"  >&lt;p&gt;The the bug seems to be with DateUtils.parseStrictly &lt;a href=&quot;#L159]&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;here&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;There is no format pattern for single digit precision, which is why parsing fails. Confusingly there is also no pattern for two digits, but parsing succeeds with the &lt;a href=&quot;#L79]&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;three digit pattern&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Even with one- and two-digit patterns added, the parsing &quot;succeeds&quot; but comes back with the incorrect value as shown in the description.&lt;/p&gt;</comment>
                            <comment id="17175849" author="aholmber" created="Tue, 11 Aug 2020 21:29:43 +0000"  >&lt;p&gt;&lt;a href=&quot;https://github.com/apache/cassandra/compare/trunk...aholmberg:CASSANDRA-15976&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;potential solution&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;I first expanded unit tests to characterize existing parsing, and also to actually validate parsed values.&lt;br/&gt;
The patch introduces DateTimeFormatter for parsing internally. I verified with some basic local microbenchmarks that this parsing is also much faster &#8211; up to 10x depending on the inputs.&lt;/p&gt;</comment>
                            <comment id="17176501" author="brandon.williams" created="Wed, 12 Aug 2020 17:20:31 +0000"  >&lt;p&gt;I like this solution, but it broke a few tests (the tests are now at fault, I imagine): &lt;a href=&quot;https://ci-cassandra.apache.org/job/Cassandra-devbranch/237/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://ci-cassandra.apache.org/job/Cassandra-devbranch/237/&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17176580" author="aholmber" created="Wed, 12 Aug 2020 20:15:08 +0000"  >&lt;p&gt;Thanks for running that. I triggered Circle but didn&apos;t have time to go look for results.&lt;br/&gt;
I&apos;ll look into the failing tests some time this week.&lt;/p&gt;</comment>
                            <comment id="17177117" author="aholmber" created="Thu, 13 Aug 2020 16:01:52 +0000"  >&lt;p&gt;Some of these are because I changed an error message slightly, but there is also this instance failing to parse &quot;&quot;2017-012-03 04:05+0000&quot;. Note the extra zero in the month field. Do you think that was intentional? Do we want to accept malformed dates like that?&lt;/p&gt;</comment>
                            <comment id="17177135" author="brandon.williams" created="Thu, 13 Aug 2020 16:30:48 +0000"  >&lt;p&gt;Way back in 2f2b2ae607b2531836c805da913ca2e545162275 I recall fixing some wonky dates, though not specifically the three digit month.  I don&apos;t know why we&apos;d support that, and I&apos;m fine with saying we don&apos;t support that in 4.0 in case anyone is actually doing that for some strange reason.&lt;/p&gt;</comment>
                            <comment id="17177223" author="aholmber" created="Thu, 13 Aug 2020 17:54:51 +0000"  >&lt;p&gt;ok. Sorry for the false start on this.&lt;/p&gt;

&lt;p&gt;The branch linked above is updated with test tweaks on one code fix.&lt;/p&gt;

&lt;p&gt;There is also a &lt;a href=&quot;https://github.com/apache/cassandra-dtest/compare/master...aholmberg:CASSANDRA-15976?expand=1&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;dtest branch&lt;/a&gt; removing some oddly formatted dates.&lt;/p&gt;</comment>
                            <comment id="17177325" author="brandon.williams" created="Thu, 13 Aug 2020 21:21:15 +0000"  >&lt;p&gt;CI looks good now: &lt;a href=&quot;https://ci-cassandra.apache.org/job/Cassandra-devbranch/242/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://ci-cassandra.apache.org/job/Cassandra-devbranch/242/&lt;/a&gt; (with your dtest branch)&lt;/p&gt;

&lt;p&gt;Committed, thanks!&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310360">
                    <name>Dependent</name>
                                                                <inwardlinks description="Dependent">
                                        <issuelink>
            <issuekey id="13194683">CASSANDRA-14853</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                            <issuelinktype id="12310050">
                    <name>Regression</name>
                                            <outwardlinks description="breaks">
                                        <issuelink>
            <issuekey id="13434980">CASSANDRA-17467</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[aholmber]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12313825" key="com.atlassian.jira.plugin.system.customfieldtypes:cascadingselect">
                        <customfieldname>Bug Category</customfieldname>
                        <customfieldvalues>
                                                    <customfieldvalue key="12982" cascade-level=""><![CDATA[Correctness]]></customfieldvalue>
                                <customfieldvalue key="12988" cascade-level="1"><![CDATA[API / Semantic Implementation]]></customfieldvalue>
            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12313821" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Complexity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12965"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313822" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Discovered By</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12969"><![CDATA[User Report]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12313922" key="jira.plugin.projectspecificselectfield.jpssf:multicftype">
                        <customfieldname>Impacts</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="13102"><![CDATA[Docs]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            5 years, 13 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12313921" key="jira.plugin.projectspecificselectfield.jpssf:multicftype">
                        <customfieldname>Platform</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="13076"><![CDATA[All]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0h5mo:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[brandon.williams]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12962"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12311420" key="com.atlassian.jira.plugin.system.customfieldtypes:version">
                        <customfieldname>Since Version</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="12332983">2.2.0</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313924" key="com.atlassian.jira.plugin.system.customfieldtypes:textfield">
                        <customfieldname>Source Control Link</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>&lt;p&gt;&lt;a href=&quot;https://github.com/apache/cassandra/commit/517d3ecceee737dffa46c47c351a43092fd4a7ba&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/cassandra/commit/517d3ecceee737dffa46c47c351a43092fd4a7ba&lt;/a&gt;&lt;/p&gt;</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313823" key="com.atlassian.jira.plugin.system.customfieldtypes:textarea">
                        <customfieldname>Test and Documentation Plan</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>&lt;p&gt;Unit tests were expanded and made more rigorous.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;Doc: may need to visit CQL timestamp discussion and see if there is any mention of this limitation.&lt;/p&gt;</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>