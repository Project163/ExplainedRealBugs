<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 22:56:15 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-10073] Counter mutation serialization bug</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-10073</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>

&lt;p&gt;reproduced in dtest super_counter_test:TestSuperCounterClusterRestart.functional_test_2&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;- Unexpected error deserializing mutation; saved to /tmp/mutation181379301016027337dat and ignored.  This may be caused by replaying a mutation against a table with the same name but incompatible schema.  Exception follows:  org.apache.cassandra.serializers.MarshalException: Expected 8 or 0 &lt;span class=&quot;code-object&quot;&gt;byte&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;long&lt;/span&gt; (36) \tat org.apache.cassandra.serializers.LongSerializer.validate(LongSerializer.java:42) ~[main/:na] \tat org.apache.cassandra.db.marshal.AbstractType.validate(AbstractType.java:122) ~[main/:na] \tat org.apache.cassandra.db.marshal.CollectionType.validateCellValue(CollectionType.java:130) ~[main/:na] \tat org.apache.cassandra.config.ColumnDefinition.validateCellValue(ColumnDefinition.java:444) ~[main/:na] \tat org.apache.cassandra.db.rows.AbstractCell.validate(AbstractCell.java:56) ~[main/:na] \tat org.apache.cassandra.db.rows.ComplexColumnData.validate(ComplexColumnData.java:125) ~[main/:na] \tat org.apache.cassandra.db.partitions.PartitionUpdate.validate(PartitionUpdate.java:518) ~[main/:na] \tat org.apache.cassandra.db.commitlog.CommitLogReplayer.replayMutation(CommitLogReplayer.java:485) [main/:na] \tat org.apache.cassandra.db.commitlog.CommitLogReplayer.replaySyncSection(CommitLogReplayer.java:465) [main/:na] \tat org.apache.cassandra.db.commitlog.CommitLogReplayer.recover(CommitLogReplayer.java:371) [main/:na] \tat org.apache.cassandra.db.commitlog.CommitLogReplayer.recover(CommitLogReplayer.java:146) [main/:na] \tat org.apache.cassandra.db.commitlog.CommitLog.recover(CommitLog.java:181) [main/:na] \tat org.apache.cassandra.db.commitlog.CommitLog.recover(CommitLog.java:161) [main/:na] \tat org.apache.cassandra.service.CassandraDaemon.setup(CassandraDaemon.java:272) [main/:na] \tat org.apache.cassandra.service.CassandraDaemon.activate(CassandraDaemon.java:512) [main/:na] \tat org.apache.cassandra.service.CassandraDaemon.main(CassandraDaemon.java:618) [main/:na] ERROR [main] 2015-08-12 17:36:38,247 CommitLogReplayer.java:513
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="12856185">CASSANDRA-10073</key>
            <summary>Counter mutation serialization bug</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10000" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Urgent</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="slebresne">Sylvain Lebresne</assignee>
                                    <reporter username="tjake">T Jake Luciani</reporter>
                        <labels>
                    </labels>
                <created>Fri, 14 Aug 2015 15:07:02 +0000</created>
                <updated>Tue, 16 Apr 2019 09:31:00 +0000</updated>
                            <resolved>Mon, 17 Aug 2015 13:07:22 +0000</resolved>
                                        <fixVersion>3.0 beta 1</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="14698744" author="slebresne" created="Sun, 16 Aug 2015 16:32:21 +0000"  >&lt;p&gt;Pushed branch with the fixes &lt;a href=&quot;https://github.com/pcmanus/cassandra/commits/10073&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;here&lt;/a&gt; (I&apos;ll update with links to CI results once/if the branch is picked up by cassci).&lt;/p&gt;

&lt;p&gt;The reason for the exception is that &lt;tt&gt;CollectionType.validateCellValue&lt;/tt&gt; is not calling the proper validation method for it&apos;s values (it should call their &lt;tt&gt;validateCellValue&lt;/tt&gt;). This is not a particularly new bug, but the only types for which &lt;tt&gt;validate&lt;/tt&gt; and &lt;tt&gt;validateCellValue&lt;/tt&gt; differs are collections (but we don&apos;t support nested collections) and counters (for which, prior to &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-8099&quot; title=&quot;Refactor and modernize the storage engine&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-8099&quot;&gt;&lt;del&gt;CASSANDRA-8099&lt;/del&gt;&lt;/a&gt; were never part of collections &amp;#8211; they can be now if counters are used in thrift super columns). The first commit fixes that.&lt;/p&gt;

&lt;p&gt;Once that was fixed, the test was still failing due to some pretty clear typo in &lt;tt&gt;ColumnSubselection&lt;/tt&gt; serialization code, so a 2nd commit fixes that too.&lt;/p&gt;</comment>
                            <comment id="14698811" author="slebresne" created="Sun, 16 Aug 2015 18:37:11 +0000"  >&lt;p&gt;CI results: &lt;a href=&quot;http://cassci.datastax.com/job/pcmanus-10073-testall/1/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;utests&lt;/a&gt; and &lt;a href=&quot;http://cassci.datastax.com/job/pcmanus-10073-dtest/1/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;dtests&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;Compared to the last results on the cassandra-3.0 branch:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;for the unit tests, there is a failure of &lt;tt&gt;org.apache.cassandra.cql3.MaterializedViewLongTest.testConflictResolution&lt;/tt&gt; but I can&apos;t really imagine how the patch here could in any way influence that test so I strongly suspect a flaky test.&lt;/li&gt;
	&lt;li&gt;for the dtests, it fixes the test of the description as expected (in fact, the run has only 27 failures compared to 33 on the last cassandra-3.0 run, but the rest is probably flaky tests for which the run got lucky).&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="14699215" author="iamaleksey" created="Mon, 17 Aug 2015 08:52:59 +0000"  >&lt;p&gt;+1&lt;/p&gt;</comment>
                            <comment id="14699500" author="slebresne" created="Mon, 17 Aug 2015 13:07:22 +0000"  >&lt;p&gt;Committed, thanks&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[slebresne]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 14 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2ixkv:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>aleksey</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[aleksey]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12963"><![CDATA[Critical]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>