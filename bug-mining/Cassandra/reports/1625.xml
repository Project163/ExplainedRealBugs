<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 22:32:51 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-4115] UNREACHABLE schema after decommissioning a non-seed node</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-4115</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;decommission a non-seed node, sleep 30 seconds, then use thrift to check the schema. UNREACHABLE is listed:&lt;/p&gt;

{&apos;75dc4c07-3c1a-3013-ad7d-11fb34208465&apos;: [&apos;127.0.0.1&apos;],
 &apos;UNREACHABLE&apos;: [&apos;127.0.0.2&apos;]}</description>
                <environment>&lt;p&gt;ccm using the following unavailable_schema_test.py dtest.&lt;/p&gt;</environment>
        <key id="12549543">CASSANDRA-4115</key>
            <summary>UNREACHABLE schema after decommissioning a non-seed node</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10000" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Urgent</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="brandon.williams">Brandon Williams</assignee>
                                    <reporter username="tpatterson">Tyler Patterson</reporter>
                        <labels>
                    </labels>
                <created>Wed, 4 Apr 2012 17:43:12 +0000</created>
                <updated>Tue, 16 Apr 2019 09:32:36 +0000</updated>
                            <resolved>Tue, 22 May 2012 16:29:31 +0000</resolved>
                                        <fixVersion>1.1.1</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                                                                <comments>
                            <comment id="13246508" author="jbellis" created="Wed, 4 Apr 2012 17:47:46 +0000"  >&lt;p&gt;Tyler, what version(s) did you observer this against?&lt;/p&gt;</comment>
                            <comment id="13246509" author="jbellis" created="Wed, 4 Apr 2012 17:48:13 +0000"  >&lt;p&gt;Also, did you mean to attach unavailable_schema_test.py somewhere?&lt;/p&gt;</comment>
                            <comment id="13246921" author="tpatterson" created="Thu, 5 Apr 2012 01:13:54 +0000"  >&lt;p&gt;I tested and got it on branch 1.0.9-tentative and release 1.0.8.&lt;/p&gt;

&lt;p&gt;I added unavailable_schema_test.py to the master branch of dtest.&lt;/p&gt;</comment>
                            <comment id="13248779" author="brandon.williams" created="Fri, 6 Apr 2012 21:13:13 +0000"  >&lt;p&gt;The only way I can see this happening on 1.0 is if ring delay is set to something lower than the gossip interval *2, otherwise it might not actually send the &apos;left&apos; message.  That would result in the node being stuck in a &apos;leaving&apos; and down state keeping it in the unreachable map.&lt;/p&gt;

&lt;p&gt;For 1.1 and trunk, this is caused by &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-3936&quot; title=&quot;Gossip should have a &amp;#39;goodbye&amp;#39; command to indicate shutdown&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-3936&quot;&gt;&lt;del&gt;CASSANDRA-3936&lt;/del&gt;&lt;/a&gt;, forcing a conviction when the decom node shuts the gossiper down, after the others have already removed it.  Instead, markAlive and markDead should have a dead state check and thus ignore it, since it&apos;s never valid to do either with a dead state.&lt;/p&gt;</comment>
                            <comment id="13248882" author="jbellis" created="Fri, 6 Apr 2012 21:28:02 +0000"  >&lt;blockquote&gt;&lt;p&gt;The only way I can see this happening on 1.0 is if ring delay is set to something lower than the gossip interval *2&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Pretty sure Tyler didn&apos;t mess with ring delay.&lt;/p&gt;</comment>
                            <comment id="13248890" author="tpatterson" created="Fri, 6 Apr 2012 21:35:20 +0000"  >&lt;p&gt;After testing a little more I found the following:&lt;/p&gt;

&lt;p&gt;On 1.0.9 I get the following schema when sleeping 30 seconds after the decommission:&lt;/p&gt;
{&apos;00000000-0000-1000-0000-000000000000&apos;: [&apos;127.0.0.1&apos;],
 &apos;UNREACHABLE&apos;: [&apos;127.0.0.2&apos;]}

&lt;p&gt;On 1.1, this is the schema 30 seconds after the decommission:&lt;/p&gt;
{&apos;59adb24e-f3cd-3e02-97f0-5b395827453f&apos;: [&apos;127.0.0.1&apos;],
 &apos;UNREACHABLE&apos;: [&apos;127.0.0.2&apos;]}

&lt;p&gt;If I increase the sleep after decommissioning from 30 to 90 seconds, then 1.0.9 now returns only one schema, while 1.1 still fails with the UNREACHABLE schema. &lt;/p&gt;

&lt;p&gt;None of these tests were done with the recent patch.&lt;/p&gt;</comment>
                            <comment id="13252550" author="brandon.williams" created="Thu, 12 Apr 2012 16:36:42 +0000"  >&lt;p&gt;This must be something with the environment, on 1.0 I see the node removed as soon as the decom node begins to announce it has left (before it has completed announcing, and thus before nodetool would even return) and it never reappears.&lt;/p&gt;</comment>
                            <comment id="13252554" author="brandon.williams" created="Thu, 12 Apr 2012 16:37:46 +0000"  >&lt;p&gt;What does strike me as odd though is that your 1.0 test has no schema at all, hence the 00000000-0000-1000-0000-000000000000 uuid.&lt;/p&gt;</comment>
                            <comment id="13266103" author="brandon.williams" created="Tue, 1 May 2012 21:06:50 +0000"  >&lt;p&gt;Setting this as blocker for 1.1.1 so it doesn&apos;t slip by, we definitely need this patch in 1.1.&lt;/p&gt;</comment>
                            <comment id="13280559" author="vijay2win@yahoo.com" created="Mon, 21 May 2012 22:24:27 +0000"  >&lt;p&gt;I think we will have a problem in handleMajorStateChange&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (!isDeadState(epState))
            markAlive(ep, epState);
        &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt;
        {
            logger.debug(&lt;span class=&quot;code-quote&quot;&gt;&quot;Not marking &quot;&lt;/span&gt; + ep + &lt;span class=&quot;code-quote&quot;&gt;&quot; alive due to dead state&quot;&lt;/span&gt;);
            markDead(ep, epState);
        }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;but in markDead we have the following so it will never be marked dead.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (isDeadState(localState))
            &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt;;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="13281022" author="brandon.williams" created="Tue, 22 May 2012 15:07:18 +0000"  >&lt;p&gt;Hmm, you&apos;re right.  v2 instead filters dead states out of convict()&lt;/p&gt;</comment>
                            <comment id="13281076" author="vijay2win@yahoo.com" created="Tue, 22 May 2012 16:23:05 +0000"  >&lt;p&gt;+1&lt;/p&gt;</comment>
                            <comment id="13281083" author="brandon.williams" created="Tue, 22 May 2012 16:29:31 +0000"  >&lt;p&gt;Committed; resolving since I can&apos;t repro on 1.0.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12528602" name="4115-v2.txt" size="1610" author="brandon.williams" created="Tue, 22 May 2012 15:07:18 +0000"/>
                            <attachment id="12521734" name="4115.txt" size="1954" author="brandon.williams" created="Fri, 6 Apr 2012 21:13:12 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[brandon.williams]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>234534</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            13 years, 27 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0gs5z:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>95993</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>vijay2win@yahoo.com</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[vijay2win@yahoo.com]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12963"><![CDATA[Critical]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>