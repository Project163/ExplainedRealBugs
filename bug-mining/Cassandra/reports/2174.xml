<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 22:38:29 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-5488] CassandraStorage throws NullPointerException (NPE) when widerows is set to &apos;true&apos;</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-5488</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;CassandraStorage throws NPE when widerows is set to &apos;true&apos;. &lt;/p&gt;

&lt;p&gt;2 problems in getNextWide:&lt;br/&gt;
1. Creation of tuple without specifying size&lt;br/&gt;
2. Calling addKeyToTuple on lastKey instead of key&lt;/p&gt;

&lt;p&gt;java.lang.NullPointerException&lt;br/&gt;
    at org.apache.cassandra.utils.ByteBufferUtil.string(ByteBufferUtil.java:167)&lt;br/&gt;
    at org.apache.cassandra.utils.ByteBufferUtil.string(ByteBufferUtil.java:124)&lt;br/&gt;
    at org.apache.cassandra.cql.jdbc.JdbcUTF8.getString(JdbcUTF8.java:73)&lt;br/&gt;
    at org.apache.cassandra.cql.jdbc.JdbcUTF8.compose(JdbcUTF8.java:93)&lt;br/&gt;
    at org.apache.cassandra.db.marshal.UTF8Type.compose(UTF8Type.java:34)&lt;br/&gt;
    at org.apache.cassandra.db.marshal.UTF8Type.compose(UTF8Type.java:26)&lt;br/&gt;
    at org.apache.cassandra.hadoop.pig.CassandraStorage.addKeyToTuple(CassandraStorage.java:313)&lt;br/&gt;
    at org.apache.cassandra.hadoop.pig.CassandraStorage.getNextWide(CassandraStorage.java:196)&lt;br/&gt;
    at org.apache.cassandra.hadoop.pig.CassandraStorage.getNext(CassandraStorage.java:224)&lt;br/&gt;
    at org.apache.pig.backend.hadoop.executionengine.mapReduceLayer.PigRecordReader.nextKeyValue(PigRecordReader.java:194)&lt;br/&gt;
    at org.apache.hadoop.mapred.MapTask$NewTrackingRecordReader.nextKeyValue(MapTask.java:532)&lt;br/&gt;
    at org.apache.hadoop.mapreduce.MapContext.nextKeyValue(MapContext.java:67)&lt;br/&gt;
    at org.apache.hadoop.mapreduce.Mapper.run(Mapper.java:143)&lt;br/&gt;
    at org.apache.hadoop.mapred.MapTask.runNewMapper(MapTask.java:764)&lt;br/&gt;
    at org.apache.hadoop.mapred.MapTask.run(MapTask.java:370)&lt;br/&gt;
    at org.apache.hadoop.mapred.Child$4.run(Child.java:255)&lt;br/&gt;
    at java.security.AccessController.doPrivileged(Native Method)&lt;br/&gt;
    at javax.security.auth.Subject.doAs(Subject.java:415)&lt;br/&gt;
    at org.apache.hadoop.security.UserGroupInformation.doAs(UserGroupInformation.java:1121)&lt;br/&gt;
    at org.apache.hadoop.mapred.Child.main(Child.java:249)&lt;br/&gt;
2013-04-16 12:28:03,671 INFO org.apache.hadoop.mapred.Task: Runnning cleanup for the task&lt;/p&gt;</description>
                <environment>&lt;p&gt;Ubuntu 12.04.1 x64, Cassandra 1.2.4&lt;/p&gt;</environment>
        <key id="12643010">CASSANDRA-5488</key>
            <summary>CassandraStorage throws NullPointerException (NPE) when widerows is set to &apos;true&apos;</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10003" iconUrl="https://issues.apache.org/jira/images/icons/priorities/trivial.svg">Low</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="sgosrani">Sheetal Gosrani</assignee>
                                    <reporter username="sgosrani">Sheetal Gosrani</reporter>
                        <labels>
                            <label>cassandra</label>
                            <label>hadoop</label>
                            <label>pig</label>
                    </labels>
                <created>Wed, 17 Apr 2013 19:51:45 +0000</created>
                <updated>Tue, 16 Apr 2019 09:32:14 +0000</updated>
                            <resolved>Wed, 22 May 2013 16:21:42 +0000</resolved>
                                        <fixVersion>1.1.12</fixVersion>
                    <fixVersion>1.2.6</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="13634368" author="sgosrani" created="Wed, 17 Apr 2013 20:04:55 +0000"  >&lt;p&gt;This patch (5488.txt) fixes the issue.&lt;/p&gt;</comment>
                            <comment id="13646531" author="brandon.williams" created="Wed, 1 May 2013 12:29:30 +0000"  >&lt;p&gt;Can you add a test to examples/pig/test/test_storage.pig that demonstrates the problem?&lt;/p&gt;</comment>
                            <comment id="13660736" author="jeromatron" created="Fri, 17 May 2013 13:58:36 +0000"  >&lt;p&gt;I&apos;ve reproduced this with 1.1.9 as well.&lt;/p&gt;</comment>
                            <comment id="13660828" author="jeromatron" created="Fri, 17 May 2013 16:16:13 +0000"  >&lt;p&gt;Looks like it&apos;s from &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-5098&quot; title=&quot;CassandraStorage doesn&amp;#39;t decode name in widerow mode&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-5098&quot;&gt;&lt;del&gt;CASSANDRA-5098&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13663077" author="jeromatron" created="Tue, 21 May 2013 16:11:23 +0000"  >&lt;p&gt;An alternative way to do it with consolidating the two methods and checking for null in that method.&lt;/p&gt;</comment>
                            <comment id="13663080" author="brandon.williams" created="Tue, 21 May 2013 16:15:27 +0000"  >&lt;p&gt;Committed v2, and also flipped the copy test to use widerow mode as a smoke test.&lt;/p&gt;</comment>
                            <comment id="13663993" author="jeromatron" created="Wed, 22 May 2013 10:45:26 +0000"  >&lt;p&gt;There ended up being a secondary problem that was hidden by the first NPE.  It seems to be related to getting the AbstractType.  The NPE was for this line: &lt;a href=&quot;https://github.com/apache/cassandra/blob/cassandra-1.1/src/java/org/apache/cassandra/hadoop/pig/CassandraStorage.java#L307&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/cassandra/blob/cassandra-1.1/src/java/org/apache/cassandra/hadoop/pig/CassandraStorage.java#L307&lt;/a&gt; which I decomposed to find out what it was NPEing on, and got this:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;            List&amp;lt;AbstractType&amp;gt; atList = getDefaultMarshallers(cfDef);
            AbstractType at = atList.get(2);
            &lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt; o = at.compose(key); &lt;span class=&quot;code-comment&quot;&gt;//NPE from &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; line
&lt;/span&gt;            setTupleValue(tuple, 0, o);
            &lt;span class=&quot;code-comment&quot;&gt;//setTupleValue(tuple, 0, getDefaultMarshallers(cfDef).get(2).compose(key));&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;So it seems unrelated to the original NPE, but still matches the description of this ticket.&lt;/p&gt;

&lt;p&gt;To reproduce, here is my schema:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;CREATE KEYSPACE circus
with placement_strategy = &lt;span class=&quot;code-quote&quot;&gt;&apos;SimpleStrategy&apos;&lt;/span&gt;
and strategy_options = {replication_factor:1};

use circus;

CREATE COLUMN FAMILY acrobats
WITH comparator = UTF8Type
AND key_validation_class=UTF8Type
AND default_validation_class = UTF8Type;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Here is a pycassa script to create the data:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;from pycassa.pool &lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; ConnectionPool
from pycassa.columnfamily &lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; ColumnFamily

pool = ConnectionPool(&lt;span class=&quot;code-quote&quot;&gt;&apos;circus&apos;&lt;/span&gt;)
col_fam = pycassa.ColumnFamily(pool, &lt;span class=&quot;code-quote&quot;&gt;&apos;acrobats&apos;&lt;/span&gt;)

&lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; i in range(1, 10):
    &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; j in range(1, 200000):
        col_fam.insert(&lt;span class=&quot;code-quote&quot;&gt;&apos;row_key&apos;&lt;/span&gt; + str(i), {str(j): &lt;span class=&quot;code-quote&quot;&gt;&apos;val&apos;&lt;/span&gt;})
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Here is the pig (0.9.2) that I&apos;m running in local mode:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;rows = LOAD &lt;span class=&quot;code-quote&quot;&gt;&apos;cassandra:&lt;span class=&quot;code-comment&quot;&gt;//circus/acrobats?widerows=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&amp;amp;limit=200000&apos;&lt;/span&gt; USING CassandraStorage();
&lt;/span&gt;filtered = filter rows by key == &lt;span class=&quot;code-quote&quot;&gt;&apos;row_key1&apos;&lt;/span&gt;;
columns = foreach filtered generate flatten(columns);
counted = foreach (group columns all) generate COUNT($1);
dump counted;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="13664226" author="brandon.williams" created="Wed, 22 May 2013 16:21:42 +0000"  >&lt;p&gt;v2 was a little too aggressive in function consolidation.  I reverted it and applied v1.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12584029" name="5488-2.txt" size="4266" author="jeromatron" created="Tue, 21 May 2013 16:11:23 +0000"/>
                            <attachment id="12579212" name="5488.txt" size="3328" author="sgosrani" created="Wed, 17 Apr 2013 22:08:42 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[sgosrani]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>323420</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            12 years, 26 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1jstj:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>323765</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>brandon.williams</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[brandon.williams]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12961"><![CDATA[Low]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>