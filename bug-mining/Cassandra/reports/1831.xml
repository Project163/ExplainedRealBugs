<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 22:35:33 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-4771] Setting TTL to Integer.MAX causes columns to not be persisted.</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-4771</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;When inserting columns via batch mutation, we have an edge case where columns will be set to Integer.MAX.  When setting the column expiration time to Integer.MAX, the columns do not appear to be persisted.&lt;/p&gt;

&lt;p&gt;Fails:&lt;/p&gt;

&lt;p&gt;Integer.MAX_VALUE &lt;br/&gt;
Integer.MAX_VALUE/2&lt;/p&gt;

&lt;p&gt;Works:&lt;br/&gt;
Integer.MAX_VALUE/3&lt;/p&gt;
</description>
                <environment></environment>
        <key id="12610619">CASSANDRA-4771</key>
            <summary>Setting TTL to Integer.MAX causes columns to not be persisted.</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10002" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Normal</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="dbrosius@apache.org">Dave Brosius</assignee>
                                    <reporter username="tnine">Todd Nine</reporter>
                        <labels>
                    </labels>
                <created>Fri, 5 Oct 2012 19:34:22 +0000</created>
                <updated>Tue, 16 Apr 2019 09:32:26 +0000</updated>
                            <resolved>Wed, 24 Jan 2018 16:49:18 +0000</resolved>
                                        <fixVersion>1.1.6</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>6</watches>
                                                                                                                <comments>
                            <comment id="13471224" author="dbrosius@apache.org" created="Sun, 7 Oct 2012 13:00:45 +0000"  >&lt;p&gt;The value written is delta-ed from the current time as&lt;/p&gt;

&lt;p&gt;(System.currentTimeMillis() / 1000) + timeToLive&lt;/p&gt;

&lt;p&gt;which causes the written ttl to go negative&lt;/p&gt;

&lt;p&gt;the error back to the client could be better, and perhaps pre-flighted.&lt;/p&gt;</comment>
                            <comment id="13471231" author="dbrosius@apache.org" created="Sun, 7 Oct 2012 13:15:29 +0000"  >&lt;p&gt;fix preflighting to catch ttl too large problems. 4771.txt&lt;/p&gt;</comment>
                            <comment id="13471560" author="slebresne" created="Mon, 8 Oct 2012 14:02:30 +0000"  >&lt;p&gt;I think we&apos;ll want to fix that for CQL too (in ModificationStatement.validate(); and yes, that would be nice to not have duplication of the validation code but ...). Also, the patch is against trunk, we should push that to 1.1. Last thing: just returning &quot;ttl too large&quot; doesn&apos;t really help to know why it is too large, and it can be hard to check in the application that your ttl won&apos;t be too large. Maybe it would be simpler to pick a fixed max TTL value, like say 20 years (which would give us something like 16 years to lift that limitation)?&lt;/p&gt;</comment>
                            <comment id="13472098" author="dbrosius@apache.org" created="Tue, 9 Oct 2012 03:15:20 +0000"  >&lt;p&gt;makes sense&lt;/p&gt;

&lt;p&gt;1) patch against 1.1&lt;br/&gt;
2) limit to 20 years&lt;br/&gt;
3) exception contains requested vs max limit&lt;br/&gt;
4) added to cql&lt;/p&gt;</comment>
                            <comment id="13472187" author="slebresne" created="Tue, 9 Oct 2012 06:58:00 +0000"  >&lt;p&gt;nit: I would have put MAX_TTL in ExpiringColumn rather than IColumn.&lt;/p&gt;

&lt;p&gt;But +1 in any case.&lt;/p&gt;</comment>
                            <comment id="13472930" author="dbrosius@apache.org" created="Wed, 10 Oct 2012 02:00:35 +0000"  >&lt;p&gt;committed to 1.1 as 46fc843bbd39bf6b007fb6d1c8e823f8b3ba2425&lt;/p&gt;</comment>
                            <comment id="13933572" author="rbfblk" created="Thu, 13 Mar 2014 17:21:16 +0000"  >&lt;p&gt;Isn&apos;t this going to break again in less than 4 years when (now + 20 years) &amp;gt; 2038-01-19?&lt;/p&gt;</comment>
                            <comment id="16337548" author="christianmovi" created="Wed, 24 Jan 2018 12:54:38 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rbfblk&quot; class=&quot;user-hover&quot; rel=&quot;rbfblk&quot;&gt;rbfblk&lt;/a&gt;: You are a smart guy. It indeed broke 4 years later &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;Edit: I will buy you a beer, should we ever meet &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/wink.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="16337586" author="christianmovi" created="Wed, 24 Jan 2018 13:30:53 +0000"  >&lt;p&gt;Can&apos;t&#160;we get another 68 years if we cast to long instead&#160;of int?&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;Class&#160;SerializationHeader:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; readLocalDeletionTime(DataInputPlus in) &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; IOException
{
&lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; (&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;)in.readUnsignedVInt() + stats.minLocalDeletionTime;
}&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="16337805" author="rbfblk" created="Wed, 24 Jan 2018 16:00:19 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=christianmovi&quot; class=&quot;user-hover&quot; rel=&quot;christianmovi&quot;&gt;christianmovi&lt;/a&gt;: I forgot about this! I just tried on a 2.1 cluster and have also confirmed it is broken. I get an AssertionError back when doing an insert with ttl 630720000&#160;(20 years). Are you on Cassandra 3+? I was hoping this was fixed as part of&#160;&lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-8099&quot; title=&quot;Refactor and modernize the storage engine&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-8099&quot;&gt;&lt;del&gt;CASSANDRA-8099&lt;/del&gt;&lt;/a&gt;, but&#160;from that snippet I guess not.&lt;/p&gt;

&lt;p&gt;It looks like expiration time is encoded per cell as an offset in seconds from the minimum deletion time in the SSTable. If I&apos;m reading it right the offset is serialized as a variable length integer, so reading it into a long would give a very large range of offsets that would be more than sufficient. However it looks to me like the minimum deletion time at the SSTable metadata level is saved as a fixed-size 4-byte signed integer. Without changing the serialization format we could change the interpretation of that metadata field to assume it is an unsigned integer (and de-serialize it also into a long variable) which should indeed give us another 68 years. A better fix would probably be to also change the serialization format of the minLocalDeletionTime to an 8 byte integer or a variable size integer so it could hold values in the far far future. Changing the SSTable format might be a 4.0+ thing though. This probably needs a new ticket.&lt;/p&gt;

&lt;p&gt;I would gladly accept that beer!&#160;But I probably deserve negative points for not following up on my comment several years ago...&lt;/p&gt;</comment>
                            <comment id="16337826" author="christianmovi" created="Wed, 24 Jan 2018 16:11:33 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rbfblk&quot; class=&quot;user-hover&quot; rel=&quot;rbfblk&quot;&gt;rbfblk&lt;/a&gt;: Nop, it seems it was not fixed with the refactoring.&lt;/p&gt;

&lt;p&gt;For now changing the typecast to signed int would be a big improvement already.&lt;/p&gt;

&lt;p&gt;&#160;Edit: It happened in C* 3.0.15&lt;/p&gt;</comment>
                            <comment id="16337879" author="pauloricardomg" created="Wed, 24 Jan 2018 16:49:18 +0000"  >&lt;p&gt;Normally we don&apos;t reopen issues which were already released, the idea is to open a new issue if there is a regression of a previous defect. Since there is &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-14092&quot; title=&quot;Max ttl of 20 years will overflow localDeletionTime&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-14092&quot;&gt;&lt;del&gt;CASSANDRA-14092&lt;/del&gt;&lt;/a&gt; for the reappearance of this issue I will close this and add a link to this on that ticket. Thanks&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="13122467">CASSANDRA-14092</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12548161" name="4771.txt" size="2508" author="dbrosius@apache.org" created="Sun, 7 Oct 2012 13:15:29 +0000"/>
                            <attachment id="12548355" name="4771_b.txt" size="4838" author="dbrosius@apache.org" created="Tue, 9 Oct 2012 03:15:20 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[dbrosius@apache.org]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>244052</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 42 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i05fkn:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>29620</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>slebresne</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[slebresne]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12962"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>