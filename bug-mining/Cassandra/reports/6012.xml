<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 23:24:39 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-16843] List snapshots of dropped tables</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-16843</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;Auto snapshots from dropped tables don&apos;t seem to show up in &lt;tt&gt;nodetool listsnapshots&lt;/tt&gt; (even though they do get cleared by &lt;tt&gt;nodetool clearsnapshot&lt;/tt&gt;). This makes them kind of annoying to clean up, since you need to muck about in the data directory to find them.&lt;/p&gt;

&lt;p&gt;Erick on the mailing list said that this seems to be an oversight and that clearsnapshot was fixed by &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-6418&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;CASSANDRA-6418&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;I reproduced this both on 3.11.11 and 4.0.0.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13394563">CASSANDRA-16843</key>
            <summary>List snapshots of dropped tables</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10002" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Normal</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="paulo">Paulo Motta</assignee>
                                    <reporter username="jbrownEP">James Brown</reporter>
                        <labels>
                    </labels>
                <created>Wed, 11 Aug 2021 06:21:11 +0000</created>
                <updated>Fri, 27 May 2022 19:25:02 +0000</updated>
                            <resolved>Fri, 29 Apr 2022 22:03:38 +0000</resolved>
                                        <fixVersion>4.1-alpha1</fixVersion>
                    <fixVersion>4.1</fixVersion>
                                    <component>Local/Snapshots</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>7</watches>
                                                    <progress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                            <timeestimate seconds="0">0h</timeestimate>
                            <timespent seconds="19200">5h 20m</timespent>
                                <comments>
                            <comment id="17397094" author="flightc" created="Wed, 11 Aug 2021 06:29:10 +0000"  >&lt;p&gt;I don&apos;t have any insight on why &lt;tt&gt;listsnapshots&lt;/tt&gt; doesn&apos;t mirror what &lt;tt&gt;clearsnapshot&lt;/tt&gt; does but it makes total sense to me that it should.&#160;&lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/thumbs_up.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="17397097" author="manmagic3" created="Wed, 11 Aug 2021 06:42:23 +0000"  >&lt;p&gt;Looks okay to me. List snapshot should only show snapshot of live tables. As per clearsnapshot, once table is dropped no point in keeping its backup. Any use case which requires clearsnapshot to not clear snapshot of dropped tables. For example if I have dropped a table x, then its old snapshot does not come in list snapshot which is correct in my opinion. For clearsnapshot if old snapshots are getting cleared, I dont find any reason not to clear them (Space gets created and old snapshots are not of any use as such). I think functionality is correct.&lt;/p&gt;</comment>
                            <comment id="17397107" author="flightc" created="Wed, 11 Aug 2021 07:09:18 +0000"  >&lt;blockquote&gt;&lt;p&gt;As per clearsnapshot, once table is dropped no point in keeping its backup.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;&#160;That&apos;s the point &#8211; &lt;tt&gt;clearsnapshot&lt;/tt&gt; correctly identifies that there&apos;s are snapshots for dropped tables and are deleting them off the disk.&lt;/p&gt;

&lt;p&gt;But I don&apos;t understand what you mean by this:&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;Any usecase which requires clearsnapshot to not clear snapshot of dropped tables.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Could you please elaborate?&#160;&lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="17397129" author="flightc" created="Wed, 11 Aug 2021 07:31:41 +0000"  >&lt;blockquote&gt;&lt;p&gt;For example if I have dropped a table x, then its old snapshot does not come in list snapshot which is correct in my opinion.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Personally, I think that kind of behaviour is confusing for an ordinary operator. Most would expect that &lt;tt&gt;listsnapshot&lt;/tt&gt; would list all snapshots regardless of whether they&apos;re for existing or dropped tables. To me it&apos;s more intuitive.&#160;&lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="17397349" author="brandon.williams" created="Wed, 11 Aug 2021 13:19:36 +0000"  >&lt;p&gt;I agree this is a bug, it doesn&apos;t make sense to have some snapshots listed and others not, regardless of their creation method.&lt;/p&gt;</comment>
                            <comment id="17397615" author="brandon.williams" created="Wed, 11 Aug 2021 20:27:52 +0000"  >&lt;p&gt;This is actually a regression from &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-6821&quot; title=&quot;Cassandra can&amp;#39;t delete snapshots for keyspaces that no longer exist.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-6821&quot;&gt;&lt;del&gt;CASSANDRA-6821&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="17400400" author="brandon.williams" created="Tue, 17 Aug 2021 13:40:02 +0000"  >&lt;p&gt;This unfortunately is not a simple thing to fix in an elegant manner.  We have a habit of assuming the lifetimes of snapshots will always be contained by their respective CFs.  It is that assumption that got us into both &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-6418&quot; title=&quot;auto_snapshots are not removable via &amp;#39;nodetool clearsnapshot&amp;#39;&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-6418&quot;&gt;&lt;del&gt;CASSANDRA-6418&lt;/del&gt;&lt;/a&gt; and &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-6821&quot; title=&quot;Cassandra can&amp;#39;t delete snapshots for keyspaces that no longer exist.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-6821&quot;&gt;&lt;del&gt;CASSANDRA-6821&lt;/del&gt;&lt;/a&gt;, and now this ticket as well.  Most of the code that handles snapshots is in instance methods of Directories.java, which is instantiated with CFMetatadata, and ultimately StorageService is accessing information through them from the ColumnFamilyStore... which won&apos;t exist for dropped tables.&lt;/p&gt;

&lt;p&gt;For trunk I think we should probably refactor snapshot handling altogether to dissolve the marriage between CFs and snapshots a bit, but for existing versions I&apos;m not sure what the least invasive way of reworking this is yet. &lt;/p&gt;</comment>
                            <comment id="17400404" author="stefan.miklosovic" created="Tue, 17 Aug 2021 13:49:24 +0000"  >&lt;p&gt;FYI we are working on this &lt;a href=&quot;https://github.com/apache/cassandra/pull/1046/files&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/cassandra/pull/1046/files&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;We plan to merge it basically this week (right &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=paulo&quot; class=&quot;user-hover&quot; rel=&quot;paulo&quot;&gt;paulo&lt;/a&gt;?) We might try to get back to this afterwards to see if anything changed in that regard.&lt;/p&gt;</comment>
                            <comment id="17400406" author="brandon.williams" created="Tue, 17 Aug 2021 13:51:53 +0000"  >&lt;p&gt;I&apos;m aware of it.  It&apos;s another wrinkle to this problem that can&apos;t really be dealt with before the existing issues, but I&apos;ll take another look when it lands.&lt;/p&gt;</comment>
                            <comment id="17400409" author="stefan.miklosovic" created="Tue, 17 Aug 2021 13:52:59 +0000"  >&lt;p&gt;We plan to overhaul snapshots a lot in a forseeable future so one might expect improvements and refactoring which would enable what you need.&lt;/p&gt;</comment>
                            <comment id="17400410" author="paulo" created="Tue, 17 Aug 2021 13:53:20 +0000"  >&lt;blockquote&gt;&lt;p&gt;For trunk I think we should probably refactor snapshot handling altogether to dissolve the marriage between CFs and snapshots a bit, but for existing versions I&apos;m not sure what the least invasive way of reworking this is yet.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;We&apos;ve been going towards this direction on &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-16451&quot; title=&quot;Add ability to ttl snapshots&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-16451&quot;&gt;CASSANDRA-16451&lt;/a&gt; by centralizing snapshot management on a `SnapshotManager` module decoupled from CFS, but so far restricted to snapshots created with TTL. Myself and &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=stefan.miklosovic&quot; class=&quot;user-hover&quot; rel=&quot;stefan.miklosovic&quot;&gt;stefan.miklosovic&lt;/a&gt; plan to extend this to &quot;legacy&quot; snapshots after that work is finished which will make it easier to solve this issue on trunk/4.1. &lt;/p&gt;</comment>
                            <comment id="17400413" author="brandon.williams" created="Tue, 17 Aug 2021 14:00:07 +0000"  >&lt;blockquote&gt;&lt;p&gt;centralizing snapshot management on a `SnapshotManager` module decoupled from CFS&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;You have read my mind on where I&apos;d like to see things go!  If only that didn&apos;t seem a bit too heavy handed for point releases...&lt;/p&gt;</comment>
                            <comment id="17440088" author="paulo" created="Sun, 7 Nov 2021 21:01:30 +0000"  >&lt;p&gt;Added an initial trunk patch &lt;a href=&quot;https://github.com/apache/cassandra/pull/1305&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;on this PR&lt;/a&gt; decoupling snapshot loading logic from &lt;tt&gt;ColumnFamilyStore&lt;/tt&gt; which enables listing snapshots of dropped tables.&lt;/p&gt;

&lt;p&gt;The basic idea is to search all data file locations for snapshot directories matching &lt;tt&gt;${data_dir}/${ks_name}/${table_name}-${table_uuid}/snapshots/{tag&lt;/tt&gt;}, optionally with a json manifest (&lt;tt&gt;manifest.json&lt;/tt&gt;) and feed these to &lt;tt&gt;SnapshotManager&lt;/tt&gt; which will keep track of live snapshots listed by &lt;tt&gt;nodetool listsnapshots&lt;/tt&gt;.&lt;/p&gt;

&lt;p&gt;One potential issue is handling legacy data directories (2.x series iirc) which do not contain the UUID part. I&apos;m not sure if these are still supported, if so we may need to handle these.&lt;/p&gt;

&lt;p&gt;The snapshot searching logic is done by &lt;tt&gt;SnapshotFinder&lt;/tt&gt; on &lt;a href=&quot;https://github.com/pauloricardomg/cassandra/commit/6b104afed5cd190ab43e97bad622feda5db5d2df&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;this commit&lt;/a&gt; (with a few tests).&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/pauloricardomg/cassandra/commit/ec53e8a5cec9dd58f574663c4ab48780de7feb4a&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;This commit&lt;/a&gt; updates &lt;tt&gt;SnapshotManager&lt;/tt&gt; initialization logic to use &lt;tt&gt;SnapshotFinder&lt;/tt&gt; instead of &lt;tt&gt;Keyspace/ColumnFamilyStore&lt;/tt&gt; to load snapshots into memory during startup.&lt;/p&gt;

&lt;p&gt;The &lt;tt&gt;SnapshotManager&lt;/tt&gt; class originally stored only expiring snapshots (added by &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-16789&quot; title=&quot;Add TTL support to nodetool snapshots&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-16789&quot;&gt;&lt;del&gt;CASSANDRA-16789&lt;/del&gt;&lt;/a&gt;), but after this patch it keeps an in-memory view of all live snapshots (expiring and non-expiring). As new snapshots are created they are registered on this class by &lt;tt&gt;ColumnFamilyStore&lt;/tt&gt; via &lt;tt&gt;SnapshotManager.addSnapshot&lt;/tt&gt;. In the future I want move snapshot creation logic completely out of &lt;tt&gt;ColumnFamilyStore&lt;/tt&gt; leaving there only sstable hardlinking logic.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/pauloricardomg/cassandra/commit/c614f88b817145e83237f61975e0e8a1b4b71cff&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;This commit&lt;/a&gt; makes snapshot listing use &lt;tt&gt;SnapshotManager.getSnapshots&lt;/tt&gt;. This enables listing of dropped snapshots which is tested by the test &lt;a href=&quot;https://github.com/pauloricardomg/cassandra/commit/1fb024e6ab726da5c42f7937a8e97540d43fd7fd&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;added on this commit&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;The previous change broke &lt;tt&gt;org.apache.cassandra.distributed.test.SnapshotsTest.testManualSnapshotCleanup&lt;/tt&gt; because cleared snapshots were not removed from &lt;tt&gt;SnapshotManager&lt;/tt&gt;. &lt;a href=&quot;https://github.com/pauloricardomg/cassandra/commit/2b1ec31885908b1199a93127668b2a4fd422a2c6&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;This commit&lt;/a&gt; fixes this by moving snapshot cleanup logic to &lt;tt&gt;SnapshotManager&lt;/tt&gt;.&lt;/p&gt;

&lt;p&gt;Finally &lt;a href=&quot;https://github.com/pauloricardomg/cassandra/commit/6edb90ac025690566a7a1ebc138a6198bb8a9c28&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;this commit&lt;/a&gt; fixes an NPE when computing the true size disk bytes of snapshots since these are not currently computed for snapshots loaded via &lt;tt&gt;SnapshotFinder&lt;/tt&gt;. I will create a fix to this by moving this logic which is dependent of &lt;tt&gt;ColumnFamilyStore&lt;/tt&gt; out of the &lt;tt&gt;TableSnapshot&lt;/tt&gt; class.&lt;/p&gt;

&lt;p&gt;I wanted to hear your initial feedback on the approach before addressing todos, working on edge cases (ie. secondary indexes, dropped tables with same names, snapshot tag uniqueness) and cleanup (ie. remove dead snapshot handling code).&lt;/p&gt;

&lt;p&gt;Can you take a look &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=brandon.williams&quot; class=&quot;user-hover&quot; rel=&quot;brandon.williams&quot;&gt;brandon.williams&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=stefan.miklosovic&quot; class=&quot;user-hover&quot; rel=&quot;stefan.miklosovic&quot;&gt;stefan.miklosovic&lt;/a&gt; ?&lt;/p&gt;</comment>
                            <comment id="17441848" author="brandon.williams" created="Wed, 10 Nov 2021 17:13:45 +0000"  >&lt;p&gt;This all makes sense and looks good so far to me.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;One potential issue is handling legacy data directories (2.x series iirc) which do not contain the UUID part. I&apos;m not sure if these are still supported, if so we may need to handle these.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I don&apos;t think this should be an issue, at least not in trunk.&lt;/p&gt;</comment>
                            <comment id="17469440" author="brandon.williams" created="Wed, 5 Jan 2022 17:10:10 +0000"  >&lt;blockquote&gt;&lt;p&gt;I will create a fix to this by moving this logic which is dependent of ColumnFamilyStore out of the TableSnapshot class.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I&apos;m +1 on this especially, as I recall it being problematic when I looked at this earlier.&lt;/p&gt;</comment>
                            <comment id="17528209" author="paulo" created="Tue, 26 Apr 2022 14:31:24 +0000"  >&lt;p&gt;Submitted CI with intermediate patch to gather initial results: &lt;a href=&quot;https://ci-cassandra.apache.org/view/patches/job/Cassandra-devbranch/1631/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://ci-cassandra.apache.org/view/patches/job/Cassandra-devbranch/1631/&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17529036" author="smiklosovic" created="Wed, 27 Apr 2022 20:22:37 +0000"  >&lt;p&gt;Is this ready to be reviewed? I am not sure if this is still indeed in &quot;in progress&quot;.&lt;/p&gt;</comment>
                            <comment id="17529043" author="paulo" created="Wed, 27 Apr 2022 20:27:45 +0000"  >&lt;p&gt;It&apos;s in progress, not ready for review yet.&lt;/p&gt;</comment>
                            <comment id="17529609" author="paulo" created="Thu, 28 Apr 2022 19:41:35 +0000"  >&lt;p&gt;To provide some contextualization and recap before going into the implementation details, please find a little summary of what end-user changes will be made visible by this patch.&lt;/p&gt;

&lt;p&gt;This is the current output of &lt;tt&gt;nodetool listsnapshots&lt;/tt&gt; before this patch:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Snapshot Details:
Snapshot name Keyspace name Column family name True size Size on disk Creation time            Expiration time
test          ks            indexed_table      9.83 KiB  21.22 KiB    2022-04-26T19:13:20.102Z
test          ks            my_table           9.83 KiB  10.76 KiB    2022-04-26T19:13:20.102Z

Total TrueDiskSpaceUsed: 19.65 KiB
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&lt;b&gt;The main problem being solved by this patch is that snapshots from dropped tables are omitted from this output.&lt;/b&gt;&lt;/p&gt;

&lt;p&gt;In addition to this, there are 2 additional issues with the previous output:&lt;br/&gt;
1) Snapshot &quot;true size&quot; column does not include &lt;tt&gt;manifest.json&lt;/tt&gt; and &lt;tt&gt;schema.cql&lt;/tt&gt; file sizes. This can be observed by the mismatching numbers in the &quot;true size&quot; (9.83 KiB) and &quot;size on disk&quot; (10.76 KiB) columns of &lt;tt&gt;my_table&lt;/tt&gt;.&lt;br/&gt;
2) Snapshot &quot;true size&quot; of table with secondary index (&lt;tt&gt;indexed_table&lt;/tt&gt;) does not include secondary index files (&lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-17357&quot; title=&quot;Snapshot true size computation does not include secondary indexes&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-17357&quot;&gt;&lt;del&gt;CASSANDRA-17357&lt;/del&gt;&lt;/a&gt;). This can be observed by the &quot;true size&quot; being 9.83 KiB while the &quot;size on disk&quot; is 21.22 KiB.&lt;/p&gt;

&lt;p&gt;After this patch, the following output is displayed for the same data:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Snapshot Details:
Snapshot name                  Keyspace name Column family name True size Size on disk Creation time            Expiration time
test                           ks            indexed_table      21.22 KiB 21.22 KiB    2022-04-26T19:13:20.102Z
test                           ks            my_table           10.76 KiB 10.76 KiB    2022-04-26T19:13:20.102Z
dropped-1650997415751-my_table ks            my_table           989 bytes 989 bytes    2022-04-26T18:23:35.751Z

Total TrueDiskSpaceUsed: 32.95 KiB
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;The new output after this patch shows the snapshot &quot;true size&quot; equal to the &quot;size on disk&quot; when there are no live sstables.&lt;/p&gt;

&lt;p&gt;(will follow-up with implementation details on next comment)&lt;/p&gt;</comment>
                            <comment id="17529680" author="paulo" created="Thu, 28 Apr 2022 22:45:02 +0000"  >&lt;p&gt;The reason why snapshots of &quot;dropped tables&quot; are omitted from the &quot;nodetool listsnapshots&quot; output above is because the prior implementation relied on the mechanics of &lt;a href=&quot;https://github.com/apache/cassandra/blob/trunk/src/java/org/apache/cassandra/db/ColumnFamilyStore.java#L2240=&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;ColumnFamilyStore&lt;/a&gt; and &lt;a href=&quot;https://github.com/apache/cassandra/blob/trunk/src/java/org/apache/cassandra/db/Directories.java#L964=&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;Directories&lt;/a&gt; to list snapshots.&lt;/p&gt;

&lt;p&gt;Since dropped tables no longer have an associated &lt;tt&gt;ColumnFamilyStore&lt;/tt&gt; object, it&apos;s not possible to list snapshots of dropped tables in the current implementation.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/apache/cassandra/pull/1595&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;This patch&lt;/a&gt; re-architects the snapshot listing logic to be fully decoupled from &lt;tt&gt;ColumnFamilyStore&lt;/tt&gt;/&lt;tt&gt;Directories&lt;/tt&gt; and rely solely on the snapshot directory structure, which currently has this format:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;&lt;tt&gt;$data_dir/$ks_name/$table_name-$table_uuid/snapshots/$tag&lt;/tt&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;The new snapshot discovery logic is mostly contained in the &lt;a href=&quot;https://github.com/apache/cassandra/blob/993190ada5b65b79c5b7ca707d436a6ceff7abcf/src/java/org/apache/cassandra/service/snapshot/SnapshotLoader.java&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;SnapshotLoader&lt;/a&gt; class, which traverses the data directory &lt;a href=&quot;https://github.com/apache/cassandra/blob/993190ada5b65b79c5b7ca707d436a6ceff7abcf/src/java/org/apache/cassandra/service/snapshot/SnapshotLoader.java#L102=&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;looking for snapshot directories matching the pattern above&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;I updated &lt;a href=&quot;https://github.com/apache/cassandra/pull/1595/files#diff-9bf2c26bc294ef9085e16bf287490223665eaa2eb8ec24bcf5bd8653c713644bR4131&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;StorageService.getSnapshotDetails&lt;/a&gt; which is used by &lt;tt&gt;nodetool listsnapshots&lt;/tt&gt; to use new &lt;tt&gt;SnapshotLoader&lt;/tt&gt; class to list snapshots.&lt;/p&gt;

&lt;p&gt;The snapshot true size computation was previously dependent on logic from &lt;a href=&quot;https://github.com/apache/cassandra/blob/bb3749f2bb8282f67375c67712d8e3ca1f085879/src/java/org/apache/cassandra/db/Directories.java#L1153&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;Directories&lt;/a&gt;, so in order to fully decouple snapshot listing from &lt;tt&gt;Directories&lt;/tt&gt;, I &lt;a href=&quot;https://github.com/apache/cassandra/blob/993190ada5b65b79c5b7ca707d436a6ceff7abcf/src/java/org/apache/cassandra/service/snapshot/TableSnapshot.java#L282&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;simplified the computation of snapshot true size&lt;/a&gt; to only include files which do not have a corresponding &quot;live&quot; file on &lt;tt&gt;$data_dir/$ks_name/$table_name-$table_uuid&lt;/tt&gt;.&lt;/p&gt;

&lt;p&gt;This simplification to the snapshot true size computation fixed two additional issues with the previous implementation (illustrated with examples in the previous comment):&lt;br/&gt;
1) Snapshot true size did not include &quot;schema.cql&quot; and &quot;manifest.json&quot; sizes&lt;br/&gt;
2) Snapshot true size did not include secondary indexes (&lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-17357&quot; title=&quot;Snapshot true size computation does not include secondary indexes&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-17357&quot;&gt;&lt;del&gt;CASSANDRA-17357&lt;/del&gt;&lt;/a&gt;)&lt;/p&gt;

&lt;p&gt;I performed other simplifications and refactorings along the way, but given the proximity to the 4.1 freeze, I prepared a leaner version of the original patch to facilitate review.&lt;/p&gt;

&lt;p&gt;After this is merged I will prepare another set of follow-up patches (for next release) with refactorings and simplifications in the snapshot management module that will be enabled by this change.&lt;/p&gt;

&lt;p&gt;Testing:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;&lt;a href=&quot;https://github.com/apache/cassandra/blob/993190ada5b65b79c5b7ca707d436a6ceff7abcf/test/distributed/org/apache/cassandra/distributed/test/SnapshotsTest.java#L195=&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;dtest to check if snapshot of dropped tables are included on listsnapshots&lt;/a&gt;&lt;/li&gt;
	&lt;li&gt;&lt;a href=&quot;https://github.com/apache/cassandra/blob/e3fd12ab2a112dad5cdba7cda226aab12f0c2c04/test/unit/org/apache/cassandra/service/snapshot/SnapshotLoaderTest.java&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;SnapshotLoaderTest&lt;/a&gt;&lt;/li&gt;
	&lt;li&gt;&lt;a href=&quot;https://github.com/apache/cassandra/blob/e3fd12ab2a112dad5cdba7cda226aab12f0c2c04/test/unit/org/apache/cassandra/db/ColumnFamilyStoreTest.java#L266=&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;Test to check that manifest and schema file sizes are included in true size computation&lt;/a&gt;&lt;/li&gt;
	&lt;li&gt;&lt;a href=&quot;https://github.com/apache/cassandra/blob/e3fd12ab2a112dad5cdba7cda226aab12f0c2c04/test/unit/org/apache/cassandra/db/DirectoriesTest.java#L420=&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;Update DirectoriesTest.testSecondaryIndexDirectories to include 2i on true size computation&lt;/a&gt;&lt;/li&gt;
	&lt;li&gt;&lt;a href=&quot;https://github.com/apache/cassandra/blob/993190ada5b65b79c5b7ca707d436a6ceff7abcf/test/unit/org/apache/cassandra/service/snapshot/TableSnapshotTest.java#L233=&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;testGetLiveFileFromSnapshotFile (used by new true size computation)&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="17529681" author="paulo" created="Thu, 28 Apr 2022 22:50:07 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=brandon.williams&quot; class=&quot;user-hover&quot; rel=&quot;brandon.williams&quot;&gt;brandon.williams&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=smiklosovic&quot; class=&quot;user-hover&quot; rel=&quot;smiklosovic&quot;&gt;smiklosovic&lt;/a&gt; This is finally ready for a final round of review and I apologize for the delay. Please check the 2 previous comments for context.&lt;/p&gt;


&lt;p&gt;Even though I&apos;d like to get this in, I will understand if you&apos;re not able to get to this before the 4.1 freeze.&lt;/p&gt;


&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/apache/cassandra/pull/1595&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;trunk&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://ci-cassandra.apache.org/view/patches/job/Cassandra-devbranch/1645/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;tests&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;
</comment>
                            <comment id="17529955" author="smiklosovic" created="Fri, 29 Apr 2022 12:16:52 +0000"  >&lt;p&gt;I reviewed it and put my comments there. I ll return to this in the late evening today CEST time to see if there was some progress. I do not mind if we merge this now but the proximity of the freeze makes me uncomfortable a bit. However, if we find there are some minor issues with this during freeze, we can still fix it there as well.&lt;/p&gt;</comment>
                            <comment id="17530032" author="paulo" created="Fri, 29 Apr 2022 14:45:23 +0000"  >&lt;blockquote&gt;&lt;p&gt;I do not mind if we merge this now but the proximity of the freeze makes me uncomfortable a bit.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;This patch in its current state is fairly low risk, since it only updates the implementation of &quot;nodetool listsnapshots&quot; without touching other components. Furthermore this area is pretty well covered by unit tests and dtests.&lt;/p&gt;

&lt;p&gt;I realized the original larger patch had a higher risk as it was also touching other areas like snapshot cleanup and ephemeral snapshots, so I decided to split the original patch to only contain the minimum viable set. I will create tickets for follow-up work for 4.2.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;I reviewed it and put my comments there. &lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Thanks for the prompt review. Addressed comments &lt;a href=&quot;https://github.com/apache/cassandra/pull/1595/commits/d1834c88c362f3804f9817e6d2cd80c6fd0e8d4b&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;on this commit&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://ci-cassandra.apache.org/view/patches/job/Cassandra-devbranch/1645/testReport/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;CI failures&lt;/a&gt; look unrelated.&lt;/p&gt;

&lt;p&gt;I will squash + rebase and re-submit CI shortly.&lt;/p&gt;</comment>
                            <comment id="17530042" author="paulo" created="Fri, 29 Apr 2022 15:07:13 +0000"  >&lt;p&gt;Squashed and rebased patch after review comments, prepared for commit:&lt;/p&gt;
&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/apache/cassandra/commit/01a7d1e1fcb63f1413e5e9dd96f3ca2bbb829f3d&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;squashed commit&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://ci-cassandra.apache.org/view/patches/job/Cassandra-devbranch/1646/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;tests&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;


&lt;p&gt;Feel free to take a sanity check look if you have cycles &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=brandon.williams&quot; class=&quot;user-hover&quot; rel=&quot;brandon.williams&quot;&gt;brandon.williams&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="17530045" author="brandon.williams" created="Fri, 29 Apr 2022 15:10:39 +0000"  >&lt;p&gt;Was just looking and it looks good to me after the latest commit. I&apos;ll check CI when it&apos;s complete but I&apos;m +1 if that doesn&apos;t have any new failures.&lt;/p&gt;</comment>
                            <comment id="17530236" author="smiklosovic" created="Fri, 29 Apr 2022 20:40:41 +0000"  >&lt;p&gt;I think I hit few bugs:&lt;/p&gt;

&lt;p&gt;1) listsnapshots gives me &quot;Total TrueDiskSpaceUsed: 0 bytes&quot; irrelevant how many snapshots I have&lt;/p&gt;

&lt;p&gt;2) Not sure if it is a bug but it is weird - when I list snapshots, it gives me some values in True Size / Size on Disk but when I drop that table and I list snapshots again, these sizes are different.&lt;/p&gt;

&lt;p&gt;I am -1 on this as it is in the current state, unfortunately. We can still merge this if these problems are addressed before the freeze. I will be online occasionaly during weekend too.&lt;/p&gt;

&lt;p&gt;EDIT: I was thinking I hit a bug with not deleting expired snapshots for dropped table but I think that I was wrong on my side, I just have not waited long enough.&lt;/p&gt;</comment>
                            <comment id="17530239" author="paulo" created="Fri, 29 Apr 2022 20:50:27 +0000"  >&lt;p&gt;Can you paste the full output for the &quot;listsnapshots&quot; value that you&apos;re observing? this would help debug.&lt;/p&gt;

&lt;p&gt;I remember testing before submitting and it was working as expected. Let me try again.&lt;/p&gt;</comment>
                            <comment id="17530240" author="paulo" created="Fri, 29 Apr 2022 20:52:59 +0000"  >&lt;blockquote&gt;&lt;p&gt;Not sure if it is a bug but it is weird - when I list snapshots, it gives me some values in True Size / Size on Disk but when I drop that table and I list snapshots again, these sizes are different.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;This is not a bug. The true size should be very small when the table is live, because live sstables are skipped and the true size only accounts for the manifest and schema file sizes.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;When the table is dropped the true size is equal to the size on disk because no sstables are live.&lt;/p&gt;</comment>
                            <comment id="17530243" author="paulo" created="Fri, 29 Apr 2022 20:58:47 +0000"  >&lt;blockquote&gt;&lt;p&gt;listsnapshots gives me &quot;Total TrueDiskSpaceUsed: 0 bytes&quot; irrelevant how many snapshots I have&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;&lt;b&gt;Total&lt;/b&gt; true disk space (which is different from &quot;true disk space&quot; of individual snapshots) is zero because all sstables are live, so snapshots are not taking any extra space.&lt;/p&gt;

&lt;p&gt;This is working as expected. It&apos;s the current behavior on trunk and it is not changed by this patch.&lt;/p&gt;

&lt;p&gt;However there is another bug there, because &quot;Total TrueDiskSpaceUsed&quot; should include sizes of schema and manifest files.&lt;/p&gt;

&lt;p&gt;I do not touch the code path that is responsible for computing &quot;&lt;b&gt;Total&lt;/b&gt; TrueDiskSpaceUsed&quot; on this patch. The true disk space should also include manifest and schema files, but fixing that requires a reworking of how the &lt;b&gt;total&lt;/b&gt; true size is computed, and is out of the scope of this patch.&lt;/p&gt;

&lt;p&gt;I fixed this on the extended version of this patch that will be posted later.&lt;/p&gt;</comment>
                            <comment id="17530249" author="smiklosovic" created="Fri, 29 Apr 2022 21:10:44 +0000"  >&lt;p&gt;&lt;em&gt;When the table is dropped the true size is equal to the size on disk because no sstables are live.&lt;/em&gt; &lt;/p&gt;

&lt;p&gt;Right ... Ok I think this explains it.&lt;/p&gt;

&lt;p&gt;&lt;em&gt;True disk space is zero because all sstables are live, so snapshots are not taking any extra space.&lt;/em&gt;&lt;/p&gt;

&lt;p&gt;Ok, I compacted the table and took a snapshot again and it started to be non-zero.&lt;/p&gt;

&lt;p&gt;Ok so it seems we are good after all, minus that bug you mentioned.&lt;/p&gt;

&lt;p&gt;So what is your strategy, you want to merge this and in the freeze you take care of the bugs? In that case I think that might fly.&lt;/p&gt;</comment>
                            <comment id="17530251" author="paulo" created="Fri, 29 Apr 2022 21:12:30 +0000"  >&lt;p&gt;In order to make things easier to understand, since this is indeed a bit confusing:&lt;/p&gt;

&lt;p&gt;Each individual snapshot has two attributes:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;&lt;b&gt;Size on disk&lt;/b&gt;: the amount of disk space used by a specific snapshot.&lt;/li&gt;
	&lt;li&gt;&lt;b&gt;TrueDiskSpaceUsed:&lt;/b&gt; the amount of &lt;b&gt;extra&lt;/b&gt; disk space used by a snapshot (snapshot_size - live_sstables)&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Before this patch, the &lt;b&gt;TrueDiskSpace&lt;/b&gt; metric was incorrectly calculated, because:&lt;br/&gt;
a) It did not include the size of manifest and schema files.&lt;br/&gt;
b) It did not include the size of secondary indexes.&lt;/p&gt;

&lt;p&gt;The behavior above was fixed by this patch.&lt;/p&gt;

&lt;p&gt;This means that when you create a snapshot on ccm:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;&lt;b&gt;Size on disk&lt;/b&gt; should be equal to the size of the snapshots&lt;/li&gt;
	&lt;li&gt;&lt;b&gt;TrueDiskSpaceUsed&lt;/b&gt; should only include the size of manifest+schema file, since there are live sstables, so the snapshot is not taking more space to store these sstables which are hard-linked.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;When you drop the table, the snapshot no longer has live data so &lt;b&gt;Size on disk&lt;/b&gt; = &lt;b&gt;TrueDiskSpaceUsed&lt;/b&gt; (this was not the case before this patch, because &lt;b&gt;TrueDiskSpaceUsed&lt;/b&gt; did not previously include the size of manifest and schema files, so &lt;b&gt;Size on disk&lt;/b&gt; &amp;gt; &lt;b&gt;TrueDiskSpaceUsed.&lt;/b&gt;&lt;/p&gt;

&lt;p&gt;In addition to that, the &lt;b&gt;Total TrueDiskSpaceUsed&lt;/b&gt; is computed by a different code path, and still has the following limitation:&lt;br/&gt;
a) It does not include the size of manifest and schema files.&lt;/p&gt;

&lt;p&gt;Fixing the &lt;b&gt;Total TrueDiskSpaceUsed&lt;/b&gt; metric is out of the scope of this patch because required additional changes. It will be fixed on a follow-up ticket.&lt;/p&gt;</comment>
                            <comment id="17530252" author="paulo" created="Fri, 29 Apr 2022 21:14:21 +0000"  >&lt;blockquote&gt;&lt;p&gt;So what is your strategy, you want to merge this and in the freeze you take care of the bugs? In that case I think that might fly.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;The minor bug on the &lt;b&gt;Total TrueDiskSpaceUsed&lt;/b&gt; computation was not introduced by this patch, it is like that on all versions below trunk. We can fix it whenever we want, but it probably shouldn&apos;t block this.&lt;/p&gt;</comment>
                            <comment id="17530254" author="smiklosovic" created="Fri, 29 Apr 2022 21:20:22 +0000"  >&lt;p&gt;Yes, that&apos;s how I understood it, probably not communicated properly, &quot;take care of the bugs&quot; not like &quot;remaining bugs in this ticket&quot; but &quot;other bugs related to this subsystem we just stumbled upon while discussing this.&quot;&lt;/p&gt;

&lt;p&gt;Let&apos;s ship this then on a reasonably clean build.&lt;/p&gt;</comment>
                            <comment id="17530256" author="paulo" created="Fri, 29 Apr 2022 21:26:56 +0000"  >&lt;p&gt;Created &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-17588&quot; title=&quot;&amp;quot;Total TrueDiskSpaceUsed&amp;quot; computation does not include manifest and schema files&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-17588&quot;&gt;&lt;del&gt;CASSANDRA-17588&lt;/del&gt;&lt;/a&gt; to address &lt;b&gt;Total TrueDiskSpaceUsed&lt;/b&gt; computation.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;Let&apos;s ship this then on a reasonably clean build.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;CI looks &lt;a href=&quot;https://ci-cassandra.apache.org/view/patches/job/Cassandra-devbranch/1646/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;good&lt;/a&gt;. Can we merge?&lt;/p&gt;</comment>
                            <comment id="17530261" author="paulo" created="Fri, 29 Apr 2022 22:02:24 +0000"  >&lt;p&gt;Since CI looks good, I merged this as &lt;a href=&quot;https://github.com/apache/cassandra/commit/31aa17a2a3b18bdda723123cad811f075287807d&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;31aa17a2a3b18bdda723123cad811f075287807d&lt;/a&gt; to trunk.&lt;/p&gt;

&lt;p&gt;Thanks all for the prompt reviews!&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10032">
                    <name>Blocker</name>
                                            <outwardlinks description="blocks">
                                        <issuelink>
            <issuekey id="13388190">CASSANDRA-16790</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                            <issuelinktype id="12310660">
                    <name>Completes</name>
                                            <outwardlinks description="fixes">
                                        <issuelink>
            <issuekey id="13427048">CASSANDRA-17357</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="13440772">CASSANDRA-17568</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="13056648">CASSANDRA-13338</issuekey>
        </issuelink>
                            </outwardlinks>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="13032021">CASSANDRA-13096</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="13427048">CASSANDRA-17357</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12681657">CASSANDRA-6418</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12699459">CASSANDRA-6821</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                            <issuelinktype id="12310760">
                    <name>Testing</name>
                                            <outwardlinks description="Testing discovered">
                                        <issuelink>
            <issuekey id="13423390">CASSANDRA-17267</issuekey>
        </issuelink>
                            </outwardlinks>
                                                                <inwardlinks description="Discovered while testing">
                                        <issuelink>
            <issuekey id="13442586">CASSANDRA-17588</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                            <issuelinktype id="10001">
                    <name>dependent</name>
                                            <outwardlinks description="depends upon">
                                        <issuelink>
            <issuekey id="13358724">CASSANDRA-16451</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[paulo]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12313825" key="com.atlassian.jira.plugin.system.customfieldtypes:cascadingselect">
                        <customfieldname>Bug Category</customfieldname>
                        <customfieldvalues>
                                                    <customfieldvalue key="12982" cascade-level=""><![CDATA[Correctness]]></customfieldvalue>
            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12313821" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Complexity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12965"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313822" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Discovered By</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12969"><![CDATA[User Report]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12313922" key="jira.plugin.projectspecificselectfield.jpssf:multicftype">
                        <customfieldname>Impacts</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="13100"><![CDATA[None]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            3 years, 28 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12313921" key="jira.plugin.projectspecificselectfield.jpssf:multicftype">
                        <customfieldname>Platform</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="13076"><![CDATA[All]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0tsg8:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[brandon.williams]]></customfieldvalue>
        <customfieldvalue><![CDATA[smiklosovic]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12961"><![CDATA[Low]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12311420" key="com.atlassian.jira.plugin.system.customfieldtypes:version">
                        <customfieldname>Since Version</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="12350145">4.1</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313924" key="com.atlassian.jira.plugin.system.customfieldtypes:textfield">
                        <customfieldname>Source Control Link</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>&lt;p&gt;&lt;a href=&quot;https://github.com/apache/cassandra/commit/31aa17a2a3b18bdda723123cad811f075287807d&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/cassandra/commit/31aa17a2a3b18bdda723123cad811f075287807d&lt;/a&gt;&lt;/p&gt;</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313823" key="com.atlassian.jira.plugin.system.customfieldtypes:textarea">
                        <customfieldname>Test and Documentation Plan</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>&lt;p&gt;added in-jvm dtests and unit tests - documentation will be release notes&lt;/p&gt;</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>