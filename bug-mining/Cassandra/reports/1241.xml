<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 22:25:08 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-3400] ConcurrentModificationException during nodetool repair</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-3400</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;When running a nodetool repair, the following exception can be thrown:&lt;/p&gt;


&lt;p&gt;ERROR &lt;span class=&quot;error&quot;&gt;&amp;#91;AntiEntropySessions:12&amp;#93;&lt;/span&gt; 2011-10-24 11:17:52,154 AbstractCassandraDaemon.java (line 139) Fatal exception in thread Thread&lt;span class=&quot;error&quot;&gt;&amp;#91;AntiEntropySessions:12,5,RMI Runtime&amp;#93;&lt;/span&gt;&lt;br/&gt;
java.lang.RuntimeException: java.util.ConcurrentModificationException&lt;br/&gt;
at org.apache.cassandra.utils.WrappedRunnable.run(WrappedRunnable.java:34)&lt;br/&gt;
at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:441)&lt;br/&gt;
at java.util.concurrent.FutureTask$Sync.innerRun(FutureTask.java:303)&lt;br/&gt;
at java.util.concurrent.FutureTask.run(FutureTask.java:138)&lt;br/&gt;
at java.util.concurrent.ThreadPoolExecutor$Worker.runTask(ThreadPoolExecutor.java:886)&lt;br/&gt;
at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:908)&lt;br/&gt;
at java.lang.Thread.run(Thread.java:619)&lt;br/&gt;
Caused by: java.util.ConcurrentModificationException&lt;br/&gt;
at java.util.HashMap$HashIterator.nextEntry(HashMap.java:793)&lt;br/&gt;
at java.util.HashMap$KeyIterator.next(HashMap.java:828)&lt;br/&gt;
at org.apache.cassandra.service.AntiEntropyService$RepairSession$RepairJob.sendTreeRequests(AntiEntropyService.java:784)&lt;br/&gt;
at org.apache.cassandra.service.AntiEntropyService$RepairSession.runMayThrow(AntiEntropyService.java:680)&lt;br/&gt;
at org.apache.cassandra.utils.WrappedRunnable.run(WrappedRunnable.java:30)&lt;br/&gt;
... 6 more&lt;/p&gt;</description>
                <environment>&lt;p&gt;Suse Enterprise linux 11.4&lt;/p&gt;</environment>
        <key id="12528521">CASSANDRA-3400</key>
            <summary>ConcurrentModificationException during nodetool repair</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10003" iconUrl="https://issues.apache.org/jira/images/icons/priorities/trivial.svg">Low</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="slebresne">Sylvain Lebresne</assignee>
                                    <reporter username="scottfines">Scott Fines</reporter>
                        <labels>
                    </labels>
                <created>Mon, 24 Oct 2011 16:41:14 +0000</created>
                <updated>Tue, 16 Apr 2019 09:32:47 +0000</updated>
                            <resolved>Tue, 25 Oct 2011 15:52:29 +0000</resolved>
                                        <fixVersion>0.8.8</fixVersion>
                    <fixVersion>1.0.1</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                                                                <comments>
                            <comment id="13134228" author="scottfines" created="Mon, 24 Oct 2011 16:48:53 +0000"  >&lt;p&gt;A few notes as I discover them:&lt;/p&gt;

&lt;p&gt;This error occurs every time the nodetool runs repair--repair effectively does not work on this node now.&lt;/p&gt;
</comment>
                            <comment id="13134840" author="slebresne" created="Tue, 25 Oct 2011 08:47:42 +0000"  >&lt;p&gt;There is a race between when we send requests and when start handling their result, i.e if a response comes before all the requests have been sent. It&apos;s fairly unlikely to happen imho but given than one request is local, if there is no and barely any data to build the merkle tree from, I suppose it&apos;s possible the local response comes quickly enough.&lt;/p&gt;

&lt;p&gt;Patch attached to resolve the issue. &lt;/p&gt;</comment>
                            <comment id="13135071" author="jbellis" created="Tue, 25 Oct 2011 14:05:07 +0000"  >&lt;p&gt;+1&lt;/p&gt;

&lt;p&gt;nit: we never use thread.interrupt() so custom is to throw AssertionError for InterruptedException&lt;/p&gt;</comment>
                            <comment id="13135165" author="slebresne" created="Tue, 25 Oct 2011 15:52:29 +0000"  >&lt;p&gt;Committed (with the AssertionError change)&lt;/p&gt;</comment>
                            <comment id="13135297" author="hudson" created="Tue, 25 Oct 2011 18:07:07 +0000"  >&lt;p&gt;Integrated in Cassandra-0.8 #388 (See &lt;a href=&quot;https://builds.apache.org/job/Cassandra-0.8/388/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/Cassandra-0.8/388/&lt;/a&gt;)&lt;br/&gt;
    Fix race in AntiEntropyService&lt;br/&gt;
patch by slebresne; reviewed by jbellis for &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-3400&quot; title=&quot;ConcurrentModificationException during nodetool repair&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-3400&quot;&gt;&lt;del&gt;CASSANDRA-3400&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;slebresne : &lt;a href=&quot;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1188740&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1188740&lt;/a&gt;&lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/cassandra/branches/cassandra-0.8/CHANGES.txt&lt;/li&gt;
	&lt;li&gt;/cassandra/branches/cassandra-0.8/src/java/org/apache/cassandra/service/AntiEntropyService.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                    </comments>
                    <attachments>
                            <attachment id="12500632" name="3400.patch" size="2332" author="slebresne" created="Tue, 25 Oct 2011 08:47:41 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[slebresne]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>214381</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            14 years, 5 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0gjfj:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>94578</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>jbellis</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[jbellis]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12961"><![CDATA[Low]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>