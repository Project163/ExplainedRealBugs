<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 22:34:41 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-4411] Assertion with LCS compaction</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-4411</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;As instructed in &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-4321&quot; title=&quot;stackoverflow building interval tree &amp;amp; possible sstable corruptions&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-4321&quot;&gt;&lt;del&gt;CASSANDRA-4321&lt;/del&gt;&lt;/a&gt; I have raised this issue as a continuation of that issue as it appears the problem still exists.&lt;/p&gt;

&lt;p&gt;I have repeatedly run sstablescrub across all my nodes after the 1.1.2 upgrade until sstablescrub shows no errors.  The exceptions described in &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-4321&quot; title=&quot;stackoverflow building interval tree &amp;amp; possible sstable corruptions&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-4321&quot;&gt;&lt;del&gt;CASSANDRA-4321&lt;/del&gt;&lt;/a&gt; do not occur as frequently now but the integrity check still throws exceptions on a number of nodes.  Once those exceptions occur compactionstats shows a large number of pending tasks with no progression afterwards.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;ERROR [CompactionExecutor:150] 2012-07-05 04:26:15,570 AbstractCassandraDaemon.java (line 134) Exception in thread &lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;[CompactionExecutor:150,1,main]
java.lang.AssertionError
        at org.apache.cassandra.db.compaction.LeveledManifest.promote(LeveledManifest.java:214)
        at org.apache.cassandra.db.compaction.LeveledCompactionStrategy.handleNotification(LeveledCompactionStrategy.java:158)
        at org.apache.cassandra.db.DataTracker.notifySSTablesChanged(DataTracker.java:531)
        at org.apache.cassandra.db.DataTracker.replaceCompactedSSTables(DataTracker.java:254)
        at org.apache.cassandra.db.ColumnFamilyStore.replaceCompactedSSTables(ColumnFamilyStore.java:978)
        at org.apache.cassandra.db.compaction.CompactionTask.execute(CompactionTask.java:200)
        at org.apache.cassandra.db.compaction.LeveledCompactionTask.execute(LeveledCompactionTask.java:50)
        at org.apache.cassandra.db.compaction.CompactionManager$1.runMayThrow(CompactionManager.java:150)
        at org.apache.cassandra.utils.WrappedRunnable.run(WrappedRunnable.java:30)
        at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:471)
        at java.util.concurrent.FutureTask$Sync.innerRun(FutureTask.java:334)
        at java.util.concurrent.FutureTask.run(FutureTask.java:166)
        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1110)
        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:603)
        at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:636)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="12597524">CASSANDRA-4411</key>
            <summary>Assertion with LCS compaction</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10002" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Normal</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="slebresne">Sylvain Lebresne</assignee>
                                    <reporter username="awinter">Anton Winter</reporter>
                        <labels>
                            <label>lcs</label>
                    </labels>
                <created>Thu, 5 Jul 2012 04:52:18 +0000</created>
                <updated>Tue, 16 Apr 2019 09:32:31 +0000</updated>
                            <resolved>Mon, 16 Jul 2012 15:33:08 +0000</resolved>
                                        <fixVersion>1.1.3</fixVersion>
                    <fixVersion>1.1.4</fixVersion>
                                        <due></due>
                            <votes>2</votes>
                                    <watches>10</watches>
                                                                                                                <comments>
                            <comment id="13410084" author="schnidrig" created="Tue, 10 Jul 2012 06:24:17 +0000"  >&lt;p&gt;I got the same AssertionError on a 1.1.2 version cluster which I did not upgrade from an earlier version.&lt;/p&gt;</comment>
                            <comment id="13410366" author="slebresne" created="Tue, 10 Jul 2012 14:10:22 +0000"  >&lt;p&gt;Would one of your guys have the log leading to that exception? If you have it at DEBUG, even better.&lt;/p&gt;</comment>
                            <comment id="13411423" author="rvanderleeden" created="Wed, 11 Jul 2012 11:42:17 +0000"  >&lt;p&gt;I could reproduce the problem on a 3-node testcluster with 1.1.2 and LCS.&lt;br/&gt;
Replication factor is 3 and number of total keys is 24m.&lt;br/&gt;
I added SSTables from a previous backup to node1.&lt;br/&gt;
Then running on node1:  nodetool repair -pr &lt;br/&gt;
Result: &lt;/p&gt;

&lt;p&gt; INFO &lt;span class=&quot;error&quot;&gt;&amp;#91;CompactionExecutor:7&amp;#93;&lt;/span&gt; 2012-07-11 10:06:57,632 CompactionTask.java (line 109) Compacting &lt;span class=&quot;error&quot;&gt;&amp;#91;SSTableReader(path=&amp;#39;/mnt/cassandra/data/highscores/highscore/highscores-highscore-hd-4937-Data.db&amp;#39;)&amp;#93;&lt;/span&gt;&lt;br/&gt;
 INFO &lt;span class=&quot;error&quot;&gt;&amp;#91;CompactionExecutor:7&amp;#93;&lt;/span&gt; 2012-07-11 10:06:58,601 CompactionTask.java (line 221) Compacted to &lt;span class=&quot;error&quot;&gt;&amp;#91;/mnt/cassandra/data/highscores/highscore/highscores-highscore-hd-5591-Data.db,&amp;#93;&lt;/span&gt;.  5,252,617 to 5,252,617 (~100% of original) bytes for 51,419 keys at 5.174882MB/s.  Time: 968ms.&lt;br/&gt;
 INFO &lt;span class=&quot;error&quot;&gt;&amp;#91;CompactionExecutor:6&amp;#93;&lt;/span&gt; 2012-07-11 10:06:58,602 CompactionTask.java (line 109) Compacting &lt;span class=&quot;error&quot;&gt;&amp;#91;SSTableReader(path=&amp;#39;/mnt/cassandra/data/highscores/highscore/highscores-highscore-hd-5590-Data.db&amp;#39;), SSTableReader(path=&amp;#39;/mnt/cassandra/data/highscores/highscore/highscores-highscore-hd-5571-Data.db&amp;#39;)&amp;#93;&lt;/span&gt;&lt;br/&gt;
ERROR &lt;span class=&quot;error&quot;&gt;&amp;#91;CompactionExecutor:6&amp;#93;&lt;/span&gt; 2012-07-11 10:06:59,655 AbstractCassandraDaemon.java (line 134) Exception in thread Thread&lt;span class=&quot;error&quot;&gt;&amp;#91;CompactionExecutor:6,1,main&amp;#93;&lt;/span&gt;&lt;br/&gt;
java.lang.AssertionError&lt;br/&gt;
	at org.apache.cassandra.db.compaction.LeveledManifest.promote(LeveledManifest.java:214)&lt;br/&gt;
	at org.apache.cassandra.db.compaction.LeveledCompactionStrategy.handleNotification(LeveledCompactionStrategy.java:158)&lt;br/&gt;
	at org.apache.cassandra.db.DataTracker.notifySSTablesChanged(DataTracker.java:531)&lt;br/&gt;
	at org.apache.cassandra.db.DataTracker.replaceCompactedSSTables(DataTracker.java:254)&lt;br/&gt;
	at org.apache.cassandra.db.ColumnFamilyStore.replaceCompactedSSTables(ColumnFamilyStore.java:978)&lt;br/&gt;
	at org.apache.cassandra.db.compaction.CompactionTask.execute(CompactionTask.java:200)&lt;br/&gt;
	at org.apache.cassandra.db.compaction.LeveledCompactionTask.execute(LeveledCompactionTask.java:50)&lt;br/&gt;
	at org.apache.cassandra.db.compaction.CompactionManager$1.runMayThrow(CompactionManager.java:150)&lt;br/&gt;
	at org.apache.cassandra.utils.WrappedRunnable.run(WrappedRunnable.java:30)&lt;br/&gt;
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:471)&lt;br/&gt;
	at java.util.concurrent.FutureTask$Sync.innerRun(FutureTask.java:334)&lt;br/&gt;
	at java.util.concurrent.FutureTask.run(FutureTask.java:166)&lt;br/&gt;
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1110)&lt;br/&gt;
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:603)&lt;br/&gt;
	at java.lang.Thread.run(Thread.java:636)&lt;/p&gt;


&lt;p&gt;The next repair command throws the following assertion:&lt;/p&gt;

&lt;p&gt;ERROR &lt;span class=&quot;error&quot;&gt;&amp;#91;ValidationExecutor:2&amp;#93;&lt;/span&gt; 2012-07-11 10:31:28,020 AbstractCassandraDaemon.java (line 134) Exception in thread Thread&lt;span class=&quot;error&quot;&gt;&amp;#91;ValidationExecutor:2,1,main&amp;#93;&lt;/span&gt;&lt;br/&gt;
java.lang.AssertionError: row DecoratedKey(162957119114255422766928006879345246467, c9e91cfb77634f32b9399dd4ad6b784e93dec9d0b11f431dad58a35e9f623de9) received out of order wrt DecoratedKey(165755005851296361665897424577644629314, ac63200da3fb452ca0b57a648b90c8a427a3d45b2d2146e089c6d04b959bb207)&lt;br/&gt;
	at org.apache.cassandra.service.AntiEntropyService$Validator.add(AntiEntropyService.java:349)&lt;br/&gt;
	at org.apache.cassandra.db.compaction.CompactionManager.doValidationCompaction(CompactionManager.java:712)&lt;br/&gt;
         ...etc...&lt;/p&gt;

&lt;p&gt;Let me know if you need more from the log.&lt;br/&gt;
Thanks, -Rudolf.&lt;/p&gt;

</comment>
                            <comment id="13411442" author="schnidrig" created="Wed, 11 Jul 2012 12:44:31 +0000"  >&lt;p&gt;Didn&apos;t have the old log, but I created a new keyspace and started using it until I hit the error. See attached file.&lt;/p&gt;
</comment>
                            <comment id="13411607" author="omid" created="Wed, 11 Jul 2012 15:03:27 +0000"  >&lt;p&gt;I could also reproduce it from the data I had:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;DEBUG 12:47:37,353 adding /home/omid/data/KSP/CF/KSP-CF-hd-121136 to list of files tracked &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; KSP.CF
DEBUG 12:47:37,354 adding /home/omid/data/KSP/CF/KSP-CF-hd-121137 to list of files tracked &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; KSP.CF
DEBUG 12:47:37,354 adding /home/omid/data/KSP/CF/KSP-CF-hd-121138 to list of files tracked &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; KSP.CF
DEBUG 12:47:37,354 adding /home/omid/data/KSP/CF/KSP-CF-hd-121139 to list of files tracked &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; KSP.CF
DEBUG 12:47:37,354 adding /home/omid/data/KSP/CF/KSP-CF-hd-121140 to list of files tracked &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; KSP.CF
DEBUG 12:47:37,354 adding /home/omid/data/KSP/CF/KSP-CF-hd-121141 to list of files tracked &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; KSP.CF
DEBUG 12:47:37,354 adding /home/omid/data/KSP/CF/KSP-CF-hd-121142 to list of files tracked &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; KSP.CF
DEBUG 12:47:37,355 adding /home/omid/data/KSP/CF/KSP-CF-hd-121143 to list of files tracked &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; KSP.CF
DEBUG 12:47:37,355 adding /home/omid/data/KSP/CF/KSP-CF-hd-121144 to list of files tracked &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; KSP.CF
DEBUG 12:47:37,355 adding /home/omid/data/KSP/CF/KSP-CF-hd-121145 to list of files tracked &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; KSP.CF
DEBUG 12:47:37,355 adding /home/omid/data/KSP/CF/KSP-CF-hd-121146 to list of files tracked &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; KSP.CF
DEBUG 12:47:37,355 adding /home/omid/data/KSP/CF/KSP-CF-hd-121147 to list of files tracked &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; KSP.CF
DEBUG 12:47:37,355 adding /home/omid/data/KSP/CF/KSP-CF-hd-121148 to list of files tracked &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; KSP.CF
DEBUG 12:47:37,355 adding /home/omid/data/KSP/CF/KSP-CF-hd-121149 to list of files tracked &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; KSP.CF
DEBUG 12:47:37,356 adding /home/omid/data/KSP/CF/KSP-CF-hd-121150 to list of files tracked &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; KSP.CF
DEBUG 12:47:37,356 adding /home/omid/data/KSP/CF/KSP-CF-hd-121151 to list of files tracked &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; KSP.CF
DEBUG 12:47:37,356 adding /home/omid/data/KSP/CF/KSP-CF-hd-121152 to list of files tracked &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; KSP.CF
DEBUG 12:47:37,356 adding /home/omid/data/KSP/CF/KSP-CF-hd-121153 to list of files tracked &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; KSP.CF
DEBUG 12:47:37,356 adding /home/omid/data/KSP/CF/KSP-CF-hd-121154 to list of files tracked &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; KSP.CF
DEBUG 12:47:37,356 adding /home/omid/data/KSP/CF/KSP-CF-hd-121155 to list of files tracked &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; KSP.CF
DEBUG 12:47:37,356 adding /home/omid/data/KSP/CF/KSP-CF-hd-121156 to list of files tracked &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; KSP.CF
DEBUG 12:47:37,357 adding /home/omid/data/KSP/CF/KSP-CF-hd-121157 to list of files tracked &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; KSP.CF
DEBUG 12:47:37,357 adding /home/omid/data/KSP/CF/KSP-CF-hd-121158 to list of files tracked &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; KSP.CF
DEBUG 12:47:37,357 adding /home/omid/data/KSP/CF/KSP-CF-hd-121159 to list of files tracked &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; KSP.CF
DEBUG 12:47:37,357 adding /home/omid/data/KSP/CF/KSP-CF-hd-121160 to list of files tracked &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; KSP.CF
DEBUG 12:47:37,357 adding /home/omid/data/KSP/CF/KSP-CF-hd-121161 to list of files tracked &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; KSP.CF
DEBUG 12:47:37,357 GC &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; ParNew: 14 ms &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; 1 collections, 5438330152 used; max is 8506048512
DEBUG 12:47:37,357 adding /home/omid/data/KSP/CF/KSP-CF-hd-121162 to list of files tracked &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; KSP.CF
DEBUG 12:47:37,358 adding /home/omid/data/KSP/CF/KSP-CF-hd-121163 to list of files tracked &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; KSP.CF
DEBUG 12:47:37,358 adding /home/omid/data/KSP/CF/KSP-CF-hd-121164 to list of files tracked &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; KSP.CF
DEBUG 12:47:37,358 adding /home/omid/data/KSP/CF/KSP-CF-hd-121165 to list of files tracked &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; KSP.CF
DEBUG 12:47:37,358 adding /home/omid/data/KSP/CF/KSP-CF-hd-121166 to list of files tracked &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; KSP.CF
DEBUG 12:47:37,358 adding /home/omid/data/KSP/CF/KSP-CF-hd-121167 to list of files tracked &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; KSP.CF
DEBUG 12:47:37,358 adding /home/omid/data/KSP/CF/KSP-CF-hd-121168 to list of files tracked &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; KSP.CF
DEBUG 12:47:37,358 adding /home/omid/data/KSP/CF/KSP-CF-hd-121169 to list of files tracked &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; KSP.CF
DEBUG 12:47:37,359 adding /home/omid/data/KSP/CF/KSP-CF-hd-121170 to list of files tracked &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; KSP.CF
DEBUG 12:47:37,359 adding /home/omid/data/KSP/CF/KSP-CF-hd-121171 to list of files tracked &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; KSP.CF
DEBUG 12:47:37,359 adding /home/omid/data/KSP/CF/KSP-CF-hd-121172 to list of files tracked &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; KSP.CF
DEBUG 12:47:37,359 adding /home/omid/data/KSP/CF/KSP-CF-hd-121173 to list of files tracked &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; KSP.CF
DEBUG 12:47:37,359 adding /home/omid/data/KSP/CF/KSP-CF-hd-121174 to list of files tracked &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; KSP.CF
DEBUG 12:47:37,359 adding /home/omid/data/KSP/CF/KSP-CF-hd-121175 to list of files tracked &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; KSP.CF
DEBUG 12:47:37,359 removing /home/omid/data/KSP/CF/KSP-CF-hd-121068 from list of files tracked &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; KSP.CF
DEBUG 12:47:37,360 Marking /home/omid/data/KSP/CF/KSP-CF-hd-121068-Data.db compacted
DEBUG 12:47:37,360 All segments have been unmapped successfully
DEBUG 12:47:37,360 removing /home/omid/data/KSP/CF/KSP-CF-hd-120844 from list of files tracked &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; KSP.CF
DEBUG 12:47:37,360 Marking /home/omid/data/KSP/CF/KSP-CF-hd-120844-Data.db compacted
DEBUG 12:47:37,360 All segments have been unmapped successfully
DEBUG 12:47:37,360 removing /home/omid/data/KSP/CF/KSP-CF-hd-121051 from list of files tracked &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; KSP.CF
DEBUG 12:47:37,361 Marking /home/omid/data/KSP/CF/KSP-CF-hd-121051-Data.db compacted
DEBUG 12:47:37,361 All segments have been unmapped successfully
DEBUG 12:47:37,361 removing /home/omid/data/KSP/CF/KSP-CF-hd-120830 from list of files tracked &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; KSP.CF
DEBUG 12:47:37,361 Marking /home/omid/data/KSP/CF/KSP-CF-hd-120830-Data.db compacted
DEBUG 12:47:37,361 All segments have been unmapped successfully
DEBUG 12:47:37,361 removing /home/omid/data/KSP/CF/KSP-CF-hd-121050 from list of files tracked &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; KSP.CF
DEBUG 12:47:37,362 Marking /home/omid/data/KSP/CF/KSP-CF-hd-121050-Data.db compacted
DEBUG 12:47:37,362 All segments have been unmapped successfully
DEBUG 12:47:37,362 removing /home/omid/data/KSP/CF/KSP-CF-hd-120843 from list of files tracked &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; KSP.CF
DEBUG 12:47:37,362 Marking /home/omid/data/KSP/CF/KSP-CF-hd-120843-Data.db compacted
DEBUG 12:47:37,362 All segments have been unmapped successfully
DEBUG 12:47:37,362 removing /home/omid/data/KSP/CF/KSP-CF-hd-120847 from list of files tracked &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; KSP.CF
DEBUG 12:47:37,362 Marking /home/omid/data/KSP/CF/KSP-CF-hd-120847-Data.db compacted
DEBUG 12:47:37,363 Deleting KSP-CF-hd-121068-CompressionInfo.db
DEBUG 12:47:37,363 All segments have been unmapped successfully
DEBUG 12:47:37,363 Deleting KSP-CF-hd-121068-Statistics.db
DEBUG 12:47:37,363 removing /home/omid/data/KSP/CF/KSP-CF-hd-120834 from list of files tracked &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; KSP.CF
DEBUG 12:47:37,363 Deleting KSP-CF-hd-121068-Index.db
DEBUG 12:47:37,363 Marking /home/omid/data/KSP/CF/KSP-CF-hd-120834-Data.db compacted
DEBUG 12:47:37,363 Deleting KSP-CF-hd-121068-Filter.db
DEBUG 12:47:37,363 All segments have been unmapped successfully
DEBUG 12:47:37,363 Deleted /home/omid/data/KSP/CF/KSP-CF-hd-121068
DEBUG 12:47:37,364 removing /home/omid/data/KSP/CF/KSP-CF-hd-120840 from list of files tracked &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; KSP.CF
DEBUG 12:47:37,364 Marking /home/omid/data/KSP/CF/KSP-CF-hd-120840-Data.db compacted
DEBUG 12:47:37,364 All segments have been unmapped successfully
DEBUG 12:47:37,364 removing /home/omid/data/KSP/CF/KSP-CF-hd-121047 from list of files tracked &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; KSP.CF
DEBUG 12:47:37,364 Marking /home/omid/data/KSP/CF/KSP-CF-hd-121047-Data.db compacted
DEBUG 12:47:37,364 All segments have been unmapped successfully
DEBUG 12:47:37,364 removing /home/omid/data/KSP/CF/KSP-CF-hd-120816 from list of files tracked &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; KSP.CF
DEBUG 12:47:37,365 Marking /home/omid/data/KSP/CF/KSP-CF-hd-120816-Data.db compacted
DEBUG 12:47:37,365 All segments have been unmapped successfully
DEBUG 12:47:37,365 removing /home/omid/data/KSP/CF/KSP-CF-hd-121133 from list of files tracked &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; KSP.CF
DEBUG 12:47:37,365 Marking /home/omid/data/KSP/CF/KSP-CF-hd-121133-Data.db compacted
DEBUG 12:47:37,365 All segments have been unmapped successfully
DEBUG 12:47:37,365 removing /home/omid/data/KSP/CF/KSP-CF-hd-120821 from list of files tracked &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; KSP.CF
DEBUG 12:47:37,366 Marking /home/omid/data/KSP/CF/KSP-CF-hd-120821-Data.db compacted
DEBUG 12:47:37,366 All segments have been unmapped successfully
DEBUG 12:47:37,366 Deleting KSP-CF-hd-120844-CompressionInfo.db
DEBUG 12:47:37,366 removing /home/omid/data/KSP/CF/KSP-CF-hd-120831 from list of files tracked &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; KSP.CF
DEBUG 12:47:37,366 Deleting KSP-CF-hd-120844-Statistics.db
DEBUG 12:47:37,366 Marking /home/omid/data/KSP/CF/KSP-CF-hd-120831-Data.db compacted
DEBUG 12:47:37,366 Deleting KSP-CF-hd-120844-Index.db
DEBUG 12:47:37,366 All segments have been unmapped successfully
DEBUG 12:47:37,366 Deleting KSP-CF-hd-120844-Filter.db
DEBUG 12:47:37,367 removing /home/omid/data/KSP/CF/KSP-CF-hd-120856 from list of files tracked &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; KSP.CF
DEBUG 12:47:37,367 Deleted /home/omid/data/KSP/CF/KSP-CF-hd-120844
DEBUG 12:47:37,367 Marking /home/omid/data/KSP/CF/KSP-CF-hd-120856-Data.db compacted
DEBUG 12:47:37,367 All segments have been unmapped successfully
DEBUG 12:47:37,367 removing /home/omid/data/KSP/CF/KSP-CF-hd-120842 from list of files tracked &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; KSP.CF
DEBUG 12:47:37,367 Marking /home/omid/data/KSP/CF/KSP-CF-hd-120842-Data.db compacted
DEBUG 12:47:37,367 All segments have been unmapped successfully
DEBUG 12:47:37,368 removing /home/omid/data/KSP/CF/KSP-CF-hd-120849 from list of files tracked &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; KSP.CF
DEBUG 12:47:37,368 Marking /home/omid/data/KSP/CF/KSP-CF-hd-120849-Data.db compacted
DEBUG 12:47:37,368 All segments have been unmapped successfully
DEBUG 12:47:37,368 Deleting KSP-CF-hd-121051-CompressionInfo.db
DEBUG 12:47:37,368 removing /home/omid/data/KSP/CF/KSP-CF-hd-120848 from list of files tracked &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; KSP.CF
DEBUG 12:47:37,368 Deleting KSP-CF-hd-121051-Statistics.db
DEBUG 12:47:37,368 Marking /home/omid/data/KSP/CF/KSP-CF-hd-120848-Data.db compacted
DEBUG 12:47:37,368 Deleting KSP-CF-hd-121051-Index.db
DEBUG 12:47:37,369 All segments have been unmapped successfully
DEBUG 12:47:37,369 Deleting KSP-CF-hd-121051-Filter.db
DEBUG 12:47:37,369 removing /home/omid/data/KSP/CF/KSP-CF-hd-120851 from list of files tracked &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; KSP.CF
DEBUG 12:47:37,369 Deleted /home/omid/data/KSP/CF/KSP-CF-hd-121051
DEBUG 12:47:37,369 Marking /home/omid/data/KSP/CF/KSP-CF-hd-120851-Data.db compacted
DEBUG 12:47:37,369 All segments have been unmapped successfully
DEBUG 12:47:37,369 removing /home/omid/data/KSP/CF/KSP-CF-hd-120855 from list of files tracked &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; KSP.CF
DEBUG 12:47:37,369 Marking /home/omid/data/KSP/CF/KSP-CF-hd-120855-Data.db compacted
DEBUG 12:47:37,370 All segments have been unmapped successfully
DEBUG 12:47:37,370 removing /home/omid/data/KSP/CF/KSP-CF-hd-120815 from list of files tracked &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; KSP.CF
DEBUG 12:47:37,370 Marking /home/omid/data/KSP/CF/KSP-CF-hd-120815-Data.db compacted
DEBUG 12:47:37,370 All segments have been unmapped successfully
DEBUG 12:47:37,370 removing /home/omid/data/KSP/CF/KSP-CF-hd-120836 from list of files tracked &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; KSP.CF
DEBUG 12:47:37,370 Marking /home/omid/data/KSP/CF/KSP-CF-hd-120836-Data.db compacted
DEBUG 12:47:37,371 All segments have been unmapped successfully
DEBUG 12:47:37,371 removing /home/omid/data/KSP/CF/KSP-CF-hd-120841 from list of files tracked &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; KSP.CF
DEBUG 12:47:37,371 Marking /home/omid/data/KSP/CF/KSP-CF-hd-120841-Data.db compacted
DEBUG 12:47:37,371 All segments have been unmapped successfully
DEBUG 12:47:37,371 removing /home/omid/data/KSP/CF/KSP-CF-hd-120814 from list of files tracked &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; KSP.CF
DEBUG 12:47:37,371 Deleting KSP-CF-hd-120830-CompressionInfo.db
DEBUG 12:47:37,371 Marking /home/omid/data/KSP/CF/KSP-CF-hd-120814-Data.db compacted
DEBUG 12:47:37,371 Deleting KSP-CF-hd-120830-Statistics.db
DEBUG 12:47:37,372 All segments have been unmapped successfully
DEBUG 12:47:37,372 Deleting KSP-CF-hd-120830-Index.db
DEBUG 12:47:37,372 removing /home/omid/data/KSP/CF/KSP-CF-hd-120819 from list of files tracked &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; KSP.CF
DEBUG 12:47:37,372 Deleting KSP-CF-hd-120830-Filter.db
DEBUG 12:47:37,372 Marking /home/omid/data/KSP/CF/KSP-CF-hd-120819-Data.db compacted
DEBUG 12:47:37,372 Deleted /home/omid/data/KSP/CF/KSP-CF-hd-120830
DEBUG 12:47:37,372 All segments have been unmapped successfully
DEBUG 12:47:37,372 removing /home/omid/data/KSP/CF/KSP-CF-hd-121048 from list of files tracked &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; KSP.CF
DEBUG 12:47:37,372 Marking /home/omid/data/KSP/CF/KSP-CF-hd-121048-Data.db compacted
DEBUG 12:47:37,373 All segments have been unmapped successfully
DEBUG 12:47:37,373 removing /home/omid/data/KSP/CF/KSP-CF-hd-120860 from list of files tracked &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; KSP.CF
DEBUG 12:47:37,373 Marking /home/omid/data/KSP/CF/KSP-CF-hd-120860-Data.db compacted
DEBUG 12:47:37,373 All segments have been unmapped successfully
DEBUG 12:47:37,373 removing /home/omid/data/KSP/CF/KSP-CF-hd-120818 from list of files tracked &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; KSP.CF
DEBUG 12:47:37,373 Marking /home/omid/data/KSP/CF/KSP-CF-hd-120818-Data.db compacted
DEBUG 12:47:37,374 All segments have been unmapped successfully
DEBUG 12:47:37,374 removing /home/omid/data/KSP/CF/KSP-CF-hd-120832 from list of files tracked &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; KSP.CF
DEBUG 12:47:37,374 Marking /home/omid/data/KSP/CF/KSP-CF-hd-120832-Data.db compacted
DEBUG 12:47:37,374 All segments have been unmapped successfully
DEBUG 12:47:37,374 removing /home/omid/data/KSP/CF/KSP-CF-hd-120846 from list of files tracked &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; KSP.CF
DEBUG 12:47:37,374 Marking /home/omid/data/KSP/CF/KSP-CF-hd-120846-Data.db compacted
DEBUG 12:47:37,374 Deleting KSP-CF-hd-121050-CompressionInfo.db
DEBUG 12:47:37,374 All segments have been unmapped successfully
DEBUG 12:47:37,375 Deleting KSP-CF-hd-121050-Statistics.db
DEBUG 12:47:37,375 removing /home/omid/data/KSP/CF/KSP-CF-hd-120853 from list of files tracked &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; KSP.CF
DEBUG 12:47:37,375 Deleting KSP-CF-hd-121050-Index.db
DEBUG 12:47:37,375 Marking /home/omid/data/KSP/CF/KSP-CF-hd-120853-Data.db compacted
DEBUG 12:47:37,375 Deleting KSP-CF-hd-121050-Filter.db
DEBUG 12:47:37,375 All segments have been unmapped successfully
DEBUG 12:47:37,375 Deleted /home/omid/data/KSP/CF/KSP-CF-hd-121050
DEBUG 12:47:37,375 removing /home/omid/data/KSP/CF/KSP-CF-hd-120857 from list of files tracked &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; KSP.CF
DEBUG 12:47:37,376 Marking /home/omid/data/KSP/CF/KSP-CF-hd-120857-Data.db compacted
DEBUG 12:47:37,376 All segments have been unmapped successfully
DEBUG 12:47:37,376 removing /home/omid/data/KSP/CF/KSP-CF-hd-120854 from list of files tracked &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; KSP.CF
DEBUG 12:47:37,376 Marking /home/omid/data/KSP/CF/KSP-CF-hd-120854-Data.db compacted
DEBUG 12:47:37,376 All segments have been unmapped successfully
DEBUG 12:47:37,376 removing /home/omid/data/KSP/CF/KSP-CF-hd-120850 from list of files tracked &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; KSP.CF
DEBUG 12:47:37,376 Marking /home/omid/data/KSP/CF/KSP-CF-hd-120850-Data.db compacted
DEBUG 12:47:37,377 All segments have been unmapped successfully
DEBUG 12:47:37,377 removing /home/omid/data/KSP/CF/KSP-CF-hd-120820 from list of files tracked &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; KSP.CF
DEBUG 12:47:37,377 Marking /home/omid/data/KSP/CF/KSP-CF-hd-120820-Data.db compacted
DEBUG 12:47:37,377 All segments have been unmapped successfully
DEBUG 12:47:37,377 removing /home/omid/data/KSP/CF/KSP-CF-hd-121049 from list of files tracked &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; KSP.CF
DEBUG 12:47:37,377 Marking /home/omid/data/KSP/CF/KSP-CF-hd-121049-Data.db compacted
DEBUG 12:47:37,377 All segments have been unmapped successfully
DEBUG 12:47:37,378 removing /home/omid/data/KSP/CF/KSP-CF-hd-120817 from list of files tracked &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; KSP.CF
DEBUG 12:47:37,378 Deleting KSP-CF-hd-120843-CompressionInfo.db
DEBUG 12:47:37,378 Marking /home/omid/data/KSP/CF/KSP-CF-hd-120817-Data.db compacted
DEBUG 12:47:37,378 Deleting KSP-CF-hd-120843-Statistics.db
DEBUG 12:47:37,378 All segments have been unmapped successfully
DEBUG 12:47:37,378 Deleting KSP-CF-hd-120843-Index.db
DEBUG 12:47:37,378 removing /home/omid/data/KSP/CF/KSP-CF-hd-121123 from list of files tracked &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; KSP.CF
DEBUG 12:47:37,378 Deleting KSP-CF-hd-120843-Filter.db
DEBUG 12:47:37,378 Marking /home/omid/data/KSP/CF/KSP-CF-hd-121123-Data.db compacted
DEBUG 12:47:37,379 Deleted /home/omid/data/KSP/CF/KSP-CF-hd-120843
DEBUG 12:47:37,379 All segments have been unmapped successfully
DEBUG 12:47:37,379 removing /home/omid/data/KSP/CF/KSP-CF-hd-120845 from list of files tracked &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; KSP.CF
DEBUG 12:47:37,379 Marking /home/omid/data/KSP/CF/KSP-CF-hd-120845-Data.db compacted
DEBUG 12:47:37,379 All segments have been unmapped successfully
DEBUG 12:47:37,379 removing /home/omid/data/KSP/CF/KSP-CF-hd-120823 from list of files tracked &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; KSP.CF
DEBUG 12:47:37,379 Marking /home/omid/data/KSP/CF/KSP-CF-hd-120823-Data.db compacted
DEBUG 12:47:37,380 All segments have been unmapped successfully
DEBUG 12:47:37,380 removing /home/omid/data/KSP/CF/KSP-CF-hd-120838 from list of files tracked &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; KSP.CF
DEBUG 12:47:37,380 Marking /home/omid/data/KSP/CF/KSP-CF-hd-120838-Data.db compacted
DEBUG 12:47:37,380 All segments have been unmapped successfully
DEBUG 12:47:37,381 L0 contains 6413 SSTables (12319161290 bytes) in Manifest@1395029065
DEBUG 12:47:37,381 Deleting KSP-CF-hd-120847-CompressionInfo.db
DEBUG 12:47:37,381 L1 contains 15 SSTables (145544851 bytes) in Manifest@1395029065
DEBUG 12:47:37,381 Deleting KSP-CF-hd-120847-Statistics.db
DEBUG 12:47:37,381 L2 contains 108 SSTables (1045242822 bytes) in Manifest@1395029065
DEBUG 12:47:37,381 Deleting KSP-CF-hd-120847-Index.db
DEBUG 12:47:37,381 L3 contains 212 SSTables (2066259940 bytes) in Manifest@1395029065
DEBUG 12:47:37,382 Replacing [CF-121068(L2), CF-120844(L2), CF-121051(L2), CF-120830(L2), CF-121050(L2), CF-120843(L2), CF-120847(L2), CF-120834(L2), CF-120840(L2), CF-121047(L2), CF-120816(L2), CF-121133(L2), CF-120821(L2), CF-120831(L2), CF-120856(L2), CF-120842(L2), CF-120849(L2), CF-120848(L2), CF-120851(L2), CF-120855(L2), CF-120815(L2), CF-120836(L2), CF-120841(L2), CF-120814(L2), CF-120819(L2), CF-121048(L2), CF-120860(L2), CF-120818(L2), CF-120832(L2), CF-120846(L2), CF-120853(L2), CF-120857(L2), CF-120854(L2), CF-120850(L2), CF-120820(L2), CF-121049(L2), CF-120817(L2), CF-121123(L1), CF-120845(L2), CF-120823(L2), CF-120838(L2), ]
DEBUG 12:47:37,382 Deleting KSP-CF-hd-120847-Filter.db
DEBUG 12:47:37,382 Adding [CF-121136(L-1), CF-121137(L-1), CF-121138(L-1), CF-121139(L-1), CF-121140(L-1), CF-121141(L-1), CF-121142(L-1), CF-121143(L-1), CF-121144(L-1), CF-121145(L-1), CF-121146(L-1), CF-121147(L-1), CF-121148(L-1), CF-121149(L-1), CF-121150(L-1), CF-121151(L-1), CF-121152(L-1), CF-121153(L-1), CF-121154(L-1), CF-121155(L-1), CF-121156(L-1), CF-121157(L-1), CF-121158(L-1), CF-121159(L-1), CF-121160(L-1), CF-121161(L-1), CF-121162(L-1), CF-121163(L-1), CF-121164(L-1), CF-121165(L-1), CF-121166(L-1), CF-121167(L-1), CF-121168(L-1), CF-121169(L-1), CF-121170(L-1), CF-121171(L-1), CF-121172(L-1), CF-121173(L-1), CF-121174(L-1), CF-121175(L-1), ] at L2
DEBUG 12:47:37,382 Deleted /home/omid/data/KSP/CF/KSP-CF-hd-120847
ERROR 12:47:37,383 Exception in thread &lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;[CompactionExecutor:577,1,main]
java.lang.AssertionError
	at org.apache.cassandra.db.compaction.LeveledManifest.promote(LeveledManifest.java:214)
	at org.apache.cassandra.db.compaction.LeveledCompactionStrategy.handleNotification(LeveledCompactionStrategy.java:158)
	at org.apache.cassandra.db.DataTracker.notifySSTablesChanged(DataTracker.java:531)
	at org.apache.cassandra.db.DataTracker.replaceCompactedSSTables(DataTracker.java:254)
	at org.apache.cassandra.db.ColumnFamilyStore.replaceCompactedSSTables(ColumnFamilyStore.java:978)
	at org.apache.cassandra.db.compaction.CompactionTask.execute(CompactionTask.java:200)
	at org.apache.cassandra.db.compaction.LeveledCompactionTask.execute(LeveledCompactionTask.java:50)
	at org.apache.cassandra.db.compaction.CompactionManager$1.runMayThrow(CompactionManager.java:150)
	at org.apache.cassandra.utils.WrappedRunnable.run(WrappedRunnable.java:30)
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:441)
	at java.util.concurrent.FutureTask$Sync.innerRun(FutureTask.java:303)
	at java.util.concurrent.FutureTask.run(FutureTask.java:138)
	at java.util.concurrent.ThreadPoolExecutor$Worker.runTask(ThreadPoolExecutor.java:886)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:908)
	at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:662)
DEBUG 12:47:37,384 Deleting KSP-CF-hd-120834-CompressionInfo.db
DEBUG 12:47:37,385 Deleting KSP-CF-hd-120834-Statistics.db
DEBUG 12:47:37,385 Deleting KSP-CF-hd-120834-Index.db
DEBUG 12:47:37,386 Deleting KSP-CF-hd-120834-Filter.db
DEBUG 12:47:37,386 Deleted /home/omid/data/KSP/CF/KSP-CF-hd-120834
DEBUG 12:47:37,388 Deleting KSP-CF-hd-120840-CompressionInfo.db
DEBUG 12:47:37,388 Deleting KSP-CF-hd-120840-Statistics.db
DEBUG 12:47:37,388 Deleting KSP-CF-hd-120840-Index.db
DEBUG 12:47:37,389 Deleting KSP-CF-hd-120840-Filter.db
DEBUG 12:47:37,389 Deleted /home/omid/data/KSP/CF/KSP-CF-hd-120840
DEBUG 12:47:37,391 Deleting KSP-CF-hd-121047-CompressionInfo.db
DEBUG 12:47:37,391 Deleting KSP-CF-hd-121047-Statistics.db
DEBUG 12:47:37,392 Deleting KSP-CF-hd-121047-Index.db
DEBUG 12:47:37,392 Deleting KSP-CF-hd-121047-Filter.db
DEBUG 12:47:37,392 Deleted /home/omid/data/KSP/CF/KSP-CF-hd-121047
DEBUG 12:47:37,394 Deleting KSP-CF-hd-120816-CompressionInfo.db
DEBUG 12:47:37,395 Deleting KSP-CF-hd-120816-Statistics.db
DEBUG 12:47:37,395 Deleting KSP-CF-hd-120816-Index.db
DEBUG 12:47:37,395 Deleting KSP-CF-hd-120816-Filter.db
DEBUG 12:47:37,395 Deleted /home/omid/data/KSP/CF/KSP-CF-hd-120816
DEBUG 12:47:37,395 Deleting KSP-CF-hd-121133-CompressionInfo.db
DEBUG 12:47:37,396 Deleting KSP-CF-hd-121133-Statistics.db
DEBUG 12:47:37,396 Deleting KSP-CF-hd-121133-Index.db
DEBUG 12:47:37,396 Deleting KSP-CF-hd-121133-Filter.db
DEBUG 12:47:37,396 Deleted /home/omid/data/KSP/CF/KSP-CF-hd-121133
DEBUG 12:47:37,399 Deleting KSP-CF-hd-120821-CompressionInfo.db
DEBUG 12:47:37,399 Deleting KSP-CF-hd-120821-Statistics.db
DEBUG 12:47:37,399 Deleting KSP-CF-hd-120821-Index.db
DEBUG 12:47:37,399 Deleting KSP-CF-hd-120821-Filter.db
DEBUG 12:47:37,399 Deleted /home/omid/data/KSP/CF/KSP-CF-hd-120821
DEBUG 12:47:37,402 Deleting KSP-CF-hd-120831-CompressionInfo.db
DEBUG 12:47:37,402 Deleting KSP-CF-hd-120831-Statistics.db
DEBUG 12:47:37,402 Deleting KSP-CF-hd-120831-Index.db
DEBUG 12:47:37,402 Deleting KSP-CF-hd-120831-Filter.db
DEBUG 12:47:37,402 Deleted /home/omid/data/KSP/CF/KSP-CF-hd-120831
DEBUG 12:47:37,405 Deleting KSP-CF-hd-120856-CompressionInfo.db
DEBUG 12:47:37,405 Deleting KSP-CF-hd-120856-Statistics.db
DEBUG 12:47:37,405 Deleting KSP-CF-hd-120856-Index.db
DEBUG 12:47:37,405 Deleting KSP-CF-hd-120856-Filter.db
DEBUG 12:47:37,406 Deleted /home/omid/data/KSP/CF/KSP-CF-hd-120856
DEBUG 12:47:37,408 Deleting KSP-CF-hd-120842-CompressionInfo.db
DEBUG 12:47:37,408 Deleting KSP-CF-hd-120842-Statistics.db
DEBUG 12:47:37,408 Deleting KSP-CF-hd-120842-Index.db
DEBUG 12:47:37,408 Deleting KSP-CF-hd-120842-Filter.db
DEBUG 12:47:37,409 Deleted /home/omid/data/KSP/CF/KSP-CF-hd-120842
DEBUG 12:47:37,411 Deleting KSP-CF-hd-120849-CompressionInfo.db
DEBUG 12:47:37,411 Deleting KSP-CF-hd-120849-Statistics.db
DEBUG 12:47:37,411 Deleting KSP-CF-hd-120849-Index.db
DEBUG 12:47:37,412 Deleting KSP-CF-hd-120849-Filter.db
DEBUG 12:47:37,412 Deleted /home/omid/data/KSP/CF/KSP-CF-hd-120849
DEBUG 12:47:37,414 Deleting KSP-CF-hd-120848-CompressionInfo.db
DEBUG 12:47:37,414 Deleting KSP-CF-hd-120848-Statistics.db
DEBUG 12:47:37,414 Deleting KSP-CF-hd-120848-Index.db
DEBUG 12:47:37,415 Deleting KSP-CF-hd-120848-Filter.db
DEBUG 12:47:37,415 Deleted /home/omid/data/KSP/CF/KSP-CF-hd-120848
DEBUG 12:47:37,417 Deleting KSP-CF-hd-120851-CompressionInfo.db
DEBUG 12:47:37,417 Deleting KSP-CF-hd-120851-Statistics.db
DEBUG 12:47:37,418 Deleting KSP-CF-hd-120851-Index.db
DEBUG 12:47:37,418 Deleting KSP-CF-hd-120851-Filter.db
DEBUG 12:47:37,418 Deleted /home/omid/data/KSP/CF/KSP-CF-hd-120851
DEBUG 12:47:37,420 Deleting KSP-CF-hd-120855-CompressionInfo.db
DEBUG 12:47:37,421 Deleting KSP-CF-hd-120855-Statistics.db
DEBUG 12:47:37,421 Deleting KSP-CF-hd-120855-Index.db
DEBUG 12:47:37,421 Deleting KSP-CF-hd-120855-Filter.db
DEBUG 12:47:37,421 Deleted /home/omid/data/KSP/CF/KSP-CF-hd-120855
DEBUG 12:47:37,424 Deleting KSP-CF-hd-120815-CompressionInfo.db
DEBUG 12:47:37,424 Deleting KSP-CF-hd-120815-Statistics.db
DEBUG 12:47:37,424 Deleting KSP-CF-hd-120815-Index.db
DEBUG 12:47:37,424 Deleting KSP-CF-hd-120815-Filter.db
DEBUG 12:47:37,424 Deleted /home/omid/data/KSP/CF/KSP-CF-hd-120815
DEBUG 12:47:37,427 Deleting KSP-CF-hd-120836-CompressionInfo.db
DEBUG 12:47:37,427 Deleting KSP-CF-hd-120836-Statistics.db
DEBUG 12:47:37,427 Deleting KSP-CF-hd-120836-Index.db
DEBUG 12:47:37,427 Deleting KSP-CF-hd-120836-Filter.db
DEBUG 12:47:37,427 Deleted /home/omid/data/KSP/CF/KSP-CF-hd-120836
DEBUG 12:47:37,430 Deleting KSP-CF-hd-120841-CompressionInfo.db
DEBUG 12:47:37,430 Deleting KSP-CF-hd-120841-Statistics.db
DEBUG 12:47:37,430 Deleting KSP-CF-hd-120841-Index.db
DEBUG 12:47:37,430 Deleting KSP-CF-hd-120841-Filter.db
DEBUG 12:47:37,430 Deleted /home/omid/data/KSP/CF/KSP-CF-hd-120841
DEBUG 12:47:37,433 Deleting KSP-CF-hd-120814-CompressionInfo.db
DEBUG 12:47:37,433 Deleting KSP-CF-hd-120814-Statistics.db
DEBUG 12:47:37,433 Deleting KSP-CF-hd-120814-Index.db
DEBUG 12:47:37,433 Deleting KSP-CF-hd-120814-Filter.db
DEBUG 12:47:37,433 Deleted /home/omid/data/KSP/CF/KSP-CF-hd-120814
DEBUG 12:47:37,436 Deleting KSP-CF-hd-120819-CompressionInfo.db
DEBUG 12:47:37,436 Deleting KSP-CF-hd-120819-Statistics.db
DEBUG 12:47:37,436 Deleting KSP-CF-hd-120819-Index.db
DEBUG 12:47:37,437 Deleting KSP-CF-hd-120819-Filter.db
DEBUG 12:47:37,437 Deleted /home/omid/data/KSP/CF/KSP-CF-hd-120819
DEBUG 12:47:37,439 Deleting KSP-CF-hd-121048-CompressionInfo.db
DEBUG 12:47:37,439 Deleting KSP-CF-hd-121048-Statistics.db
DEBUG 12:47:37,440 Deleting KSP-CF-hd-121048-Index.db
DEBUG 12:47:37,440 Deleting KSP-CF-hd-121048-Filter.db
DEBUG 12:47:37,440 Deleted /home/omid/data/KSP/CF/KSP-CF-hd-121048
DEBUG 12:47:37,442 Deleting KSP-CF-hd-120860-CompressionInfo.db
DEBUG 12:47:37,442 Deleting KSP-CF-hd-120860-Statistics.db
DEBUG 12:47:37,443 Deleting KSP-CF-hd-120860-Index.db
DEBUG 12:47:37,443 Deleting KSP-CF-hd-120860-Filter.db
DEBUG 12:47:37,443 Deleted /home/omid/data/KSP/CF/KSP-CF-hd-120860
DEBUG 12:47:37,445 Deleting KSP-CF-hd-120818-CompressionInfo.db
DEBUG 12:47:37,446 Deleting KSP-CF-hd-120818-Statistics.db
DEBUG 12:47:37,446 Deleting KSP-CF-hd-120818-Index.db
DEBUG 12:47:37,446 Deleting KSP-CF-hd-120818-Filter.db
DEBUG 12:47:37,446 Deleted /home/omid/data/KSP/CF/KSP-CF-hd-120818
DEBUG 12:47:37,448 Deleting KSP-CF-hd-120832-CompressionInfo.db
DEBUG 12:47:37,449 Deleting KSP-CF-hd-120832-Statistics.db
DEBUG 12:47:37,449 Deleting KSP-CF-hd-120832-Index.db
DEBUG 12:47:37,449 Deleting KSP-CF-hd-120832-Filter.db
DEBUG 12:47:37,449 Deleted /home/omid/data/KSP/CF/KSP-CF-hd-120832
DEBUG 12:47:37,452 Deleting KSP-CF-hd-120846-CompressionInfo.db
DEBUG 12:47:37,452 Deleting KSP-CF-hd-120846-Statistics.db
DEBUG 12:47:37,452 Deleting KSP-CF-hd-120846-Index.db
DEBUG 12:47:37,452 Deleting KSP-CF-hd-120846-Filter.db
DEBUG 12:47:37,452 Deleted /home/omid/data/KSP/CF/KSP-CF-hd-120846
DEBUG 12:47:37,455 Deleting KSP-CF-hd-120853-CompressionInfo.db
DEBUG 12:47:37,455 Deleting KSP-CF-hd-120853-Statistics.db
DEBUG 12:47:37,455 Deleting KSP-CF-hd-120853-Index.db
DEBUG 12:47:37,455 Deleting KSP-CF-hd-120853-Filter.db
DEBUG 12:47:37,456 Deleted /home/omid/data/KSP/CF/KSP-CF-hd-120853
DEBUG 12:47:37,458 Deleting KSP-CF-hd-120857-CompressionInfo.db
DEBUG 12:47:37,458 Deleting KSP-CF-hd-120857-Statistics.db
DEBUG 12:47:37,459 Deleting KSP-CF-hd-120857-Index.db
DEBUG 12:47:37,459 Deleting KSP-CF-hd-120857-Filter.db
DEBUG 12:47:37,459 Deleted /home/omid/data/KSP/CF/KSP-CF-hd-120857
DEBUG 12:47:37,461 Deleting KSP-CF-hd-120854-CompressionInfo.db
DEBUG 12:47:37,462 Deleting KSP-CF-hd-120854-Statistics.db
DEBUG 12:47:37,462 Deleting KSP-CF-hd-120854-Index.db
DEBUG 12:47:37,462 Deleting KSP-CF-hd-120854-Filter.db
DEBUG 12:47:37,462 Deleted /home/omid/data/KSP/CF/KSP-CF-hd-120854
DEBUG 12:47:37,465 Deleting KSP-CF-hd-120850-CompressionInfo.db
DEBUG 12:47:37,465 Deleting KSP-CF-hd-120850-Statistics.db
DEBUG 12:47:37,465 Deleting KSP-CF-hd-120850-Index.db
DEBUG 12:47:37,465 Deleting KSP-CF-hd-120850-Filter.db
DEBUG 12:47:37,465 Deleted /home/omid/data/KSP/CF/KSP-CF-hd-120850
DEBUG 12:47:37,468 Deleting KSP-CF-hd-120820-CompressionInfo.db
DEBUG 12:47:37,468 Deleting KSP-CF-hd-120820-Statistics.db
DEBUG 12:47:37,468 Deleting KSP-CF-hd-120820-Index.db
DEBUG 12:47:37,468 Deleting KSP-CF-hd-120820-Filter.db
DEBUG 12:47:37,469 Deleted /home/omid/data/KSP/CF/KSP-CF-hd-120820
DEBUG 12:47:37,471 Deleting KSP-CF-hd-121049-CompressionInfo.db
DEBUG 12:47:37,471 Deleting KSP-CF-hd-121049-Statistics.db
DEBUG 12:47:37,471 Deleting KSP-CF-hd-121049-Index.db
DEBUG 12:47:37,471 Deleting KSP-CF-hd-121049-Filter.db
DEBUG 12:47:37,472 Deleted /home/omid/data/KSP/CF/KSP-CF-hd-121049
DEBUG 12:47:37,474 Deleting KSP-CF-hd-120817-CompressionInfo.db
DEBUG 12:47:37,474 Deleting KSP-CF-hd-120817-Statistics.db
DEBUG 12:47:37,474 Deleting KSP-CF-hd-120817-Index.db
DEBUG 12:47:37,474 Deleting KSP-CF-hd-120817-Filter.db
DEBUG 12:47:37,475 Deleted /home/omid/data/KSP/CF/KSP-CF-hd-120817
DEBUG 12:47:37,477 Deleting KSP-CF-hd-121123-CompressionInfo.db
DEBUG 12:47:37,477 Deleting KSP-CF-hd-121123-Statistics.db
DEBUG 12:47:37,477 Deleting KSP-CF-hd-121123-Index.db
DEBUG 12:47:37,478 Deleting KSP-CF-hd-121123-Filter.db
DEBUG 12:47:37,478 Deleted /home/omid/data/KSP/CF/KSP-CF-hd-121123
DEBUG 12:47:37,480 Deleting KSP-CF-hd-120845-CompressionInfo.db
DEBUG 12:47:37,480 Deleting KSP-CF-hd-120845-Statistics.db
DEBUG 12:47:37,480 Deleting KSP-CF-hd-120845-Index.db
DEBUG 12:47:37,481 Deleting KSP-CF-hd-120845-Filter.db
DEBUG 12:47:37,481 Deleted /home/omid/data/KSP/CF/KSP-CF-hd-120845
DEBUG 12:47:37,483 Deleting KSP-CF-hd-120823-CompressionInfo.db
DEBUG 12:47:37,483 Deleting KSP-CF-hd-120823-Statistics.db
DEBUG 12:47:37,484 Deleting KSP-CF-hd-120823-Index.db
DEBUG 12:47:37,484 Deleting KSP-CF-hd-120823-Filter.db
DEBUG 12:47:37,484 Deleted /home/omid/data/KSP/CF/KSP-CF-hd-120823
DEBUG 12:47:37,487 Deleting KSP-CF-hd-120838-CompressionInfo.db
DEBUG 12:47:37,487 Deleting KSP-CF-hd-120838-Statistics.db
DEBUG 12:47:37,487 Deleting KSP-CF-hd-120838-Index.db
DEBUG 12:47:37,487 Deleting KSP-CF-hd-120838-Filter.db
DEBUG 12:47:37,487 Deleted /home/omid/data/KSP/CF/KSP-CF-hd-120838
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="13412683" author="rvanderleeden" created="Thu, 12 Jul 2012 10:50:50 +0000"  >&lt;p&gt;I attached the file assertion.system.log with DEBUG lines around the assertion ERROR.&lt;br/&gt;
This is just an excerpt from system.log which is much larger.&lt;/p&gt;</comment>
                            <comment id="13413708" author="slebresne" created="Fri, 13 Jul 2012 13:17:01 +0000"  >&lt;p&gt;Unfortunately the log doesn&apos;t give us much to chew on.&lt;/p&gt;

&lt;p&gt;I&apos;ve actually be able to reproduce this once (using stress). Unfortunately, I hadn&apos;t added more debugging yet and since I added more debug info I haven&apos;t been able to reproduce (despite having retried from scratch like 3 times letting it run for multiple hours each time).&lt;/p&gt;

&lt;p&gt;So I&apos;m attaching a simple patch that adds more debugging. If you guys can try applying the patch and see if you can reproduce. If so, the log file produced should be helpful. I&apos;ll note that it is preferable to &lt;b&gt;not&lt;/b&gt; turn DEBUG logging with this patch as this is not useful and would only generate awfully large logs.&lt;/p&gt;</comment>
                            <comment id="13414425" author="rvanderleeden" created="Sat, 14 Jul 2012 15:04:33 +0000"  >&lt;p&gt;includes extended INFO lines from using 0001 patch&lt;/p&gt;</comment>
                            <comment id="13414429" author="rvanderleeden" created="Sat, 14 Jul 2012 15:18:33 +0000"  >&lt;p&gt;The file assertion.moreinfo.system.log has been attached. &lt;/p&gt;

&lt;p&gt;The assertion ERROR could be reproduced by doing the following:&lt;br/&gt;
(1) Bulk load 200 SSTables from a snapshot into a new 3-node cluster&lt;br/&gt;
(2) Run nodetool compact and repair&lt;br/&gt;
(3) Add ~500 SSTables from the same snapshot&lt;br/&gt;
(4) Run nodetool repair&lt;/p&gt;

&lt;p&gt;RESULT: &lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;we see immediately a StackOverflowError (from the repair command)&lt;/li&gt;
	&lt;li&gt;after 2 minutes compaction starts&lt;/li&gt;
	&lt;li&gt;after 11 minutes there is the AssertionError&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13414631" author="omid" created="Sun, 15 Jul 2012 13:51:07 +0000"  >&lt;p&gt;Attached the log (assertion-w-more-debugging-info-omid.log) with more debugging info that leads to AssertionError on LeveledManifest.promote.&lt;/p&gt;</comment>
                            <comment id="13415012" author="slebresne" created="Mon, 16 Jul 2012 11:27:23 +0000"  >&lt;p&gt;Thanks a lot for the logs everyone.&lt;/p&gt;

&lt;p&gt;The problem was with the handling of sstables having the same first and last token. More precisely, Bounds.contains uses Range.contains(), but while the Range (a, a] selects the whole ring, the Bounds &lt;span class=&quot;error&quot;&gt;&amp;#91;a,a&amp;#93;&lt;/span&gt; only selects a. This means sstable with the same first and last on level N+1 were included in compaction of any sstable of level N even when there wasn&apos;t any intersection.&lt;/p&gt;

&lt;p&gt;Attaching simple patch to fix.&lt;/p&gt;</comment>
                            <comment id="13415060" author="jbellis" created="Mon, 16 Jul 2012 12:33:14 +0000"  >&lt;p&gt;+1&lt;/p&gt;</comment>
                            <comment id="13415105" author="slebresne" created="Mon, 16 Jul 2012 13:35:42 +0000"  >&lt;p&gt;Committed, thanks.&lt;/p&gt;</comment>
                            <comment id="13415212" author="slebresne" created="Mon, 16 Jul 2012 15:15:56 +0000"  >&lt;p&gt;Alright, the patch did fix the issue but also introduce a small bug in that the Bounds.contains does not handle correctly the special Bounds(min, min) that should include everything (rather than nothing). Patch attached to fix that.&lt;/p&gt;</comment>
                            <comment id="13415214" author="jbellis" created="Mon, 16 Jul 2012 15:23:14 +0000"  >&lt;p&gt;+1&lt;/p&gt;</comment>
                            <comment id="13415224" author="slebresne" created="Mon, 16 Jul 2012 15:33:08 +0000"  >&lt;p&gt;Alright, committed, thanks.&lt;/p&gt;</comment>
                            <comment id="13417024" author="omid" created="Wed, 18 Jul 2012 12:14:00 +0000"  >&lt;p&gt;Awesome. Thanks for the patch. Tested it and it works.&lt;/p&gt;

&lt;p&gt;Sylvain, regarding your earlier comment on &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-4321&quot; title=&quot;stackoverflow building interval tree &amp;amp; possible sstable corruptions&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-4321&quot;&gt;&lt;del&gt;CASSANDRA-4321&lt;/del&gt;&lt;/a&gt;:&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt; This is not really a new bug, but I believe that prior to &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-4142&quot; title=&quot;OOM Exception during repair session with LeveledCompactionStrategy&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-4142&quot;&gt;&lt;del&gt;CASSANDRA-4142&lt;/del&gt;&lt;/a&gt;, this had less consequences. &lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Does it mean LC-compacted SSTables created by 1.1.0 or earlier are as well affected and need to be scrubbed?&lt;/p&gt;</comment>
                            <comment id="13417234" author="slebresne" created="Wed, 18 Jul 2012 16:42:23 +0000"  >&lt;blockquote&gt;&lt;p&gt;Does it mean LC-compacted SSTables created by 1.1.0 or earlier are as well affected and need to be scrubbed?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Potentially, yes, unfortunately.&lt;/p&gt;</comment>
                            <comment id="13420835" author="minaguib" created="Mon, 23 Jul 2012 18:14:02 +0000"  >&lt;p&gt;Hi&lt;/p&gt;

&lt;p&gt;I&apos;m running cassandra 1.1.2 + the 2 patches in this ticket applied.&lt;/p&gt;

&lt;p&gt;On one node in my cluster I just got the same assertion error - shortly after the node started up and a compaction was attempted:&lt;/p&gt;

&lt;p&gt;    ERROR &lt;span class=&quot;error&quot;&gt;&amp;#91;CompactionExecutor:19&amp;#93;&lt;/span&gt; 2012-07-23 14:05:43,312 AbstractCassandraDaemon.java (line 134) Exception in thread Thread&lt;span class=&quot;error&quot;&gt;&amp;#91;CompactionExecutor:19,1,main&amp;#93;&lt;/span&gt;&lt;br/&gt;
    java.lang.AssertionError&lt;br/&gt;
            at org.apache.cassandra.db.compaction.LeveledManifest.promote(LeveledManifest.java:214)&lt;br/&gt;
            at org.apache.cassandra.db.compaction.LeveledCompactionStrategy.handleNotification(LeveledCompactionStrategy.java:158)&lt;br/&gt;
            at org.apache.cassandra.db.DataTracker.notifySSTablesChanged(DataTracker.java:531)&lt;br/&gt;
            at org.apache.cassandra.db.DataTracker.replaceCompactedSSTables(DataTracker.java:254)&lt;br/&gt;
            at org.apache.cassandra.db.ColumnFamilyStore.replaceCompactedSSTables(ColumnFamilyStore.java:978)&lt;br/&gt;
            at org.apache.cassandra.db.compaction.CompactionTask.execute(CompactionTask.java:200)&lt;br/&gt;
            at org.apache.cassandra.db.compaction.LeveledCompactionTask.execute(LeveledCompactionTask.java:50)&lt;br/&gt;
            at org.apache.cassandra.db.compaction.CompactionManager$1.runMayThrow(CompactionManager.java:150)&lt;br/&gt;
            at org.apache.cassandra.utils.WrappedRunnable.run(WrappedRunnable.java:30)&lt;br/&gt;
            at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:441)&lt;br/&gt;
            at java.util.concurrent.FutureTask$Sync.innerRun(FutureTask.java:303)&lt;br/&gt;
            at java.util.concurrent.FutureTask.run(FutureTask.java:138)&lt;br/&gt;
            at java.util.concurrent.ThreadPoolExecutor$Worker.runTask(ThreadPoolExecutor.java:886)&lt;br/&gt;
            at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:908)&lt;br/&gt;
            at java.lang.Thread.run(Thread.java:662)&lt;/p&gt;


&lt;p&gt;Does this indicate a problem with a bad sstable that&apos;s fixable with scrubbing ?  Or does this ticket + patches deserve a second look ?&lt;/p&gt;</comment>
                            <comment id="13420838" author="jbellis" created="Mon, 23 Jul 2012 18:18:03 +0000"  >&lt;p&gt;The former.&lt;/p&gt;</comment>
                            <comment id="13421049" author="minaguib" created="Tue, 24 Jul 2012 00:14:49 +0000"  >
&lt;p&gt;Unfortunately the problem did not go away after scrubbing.&lt;/p&gt;

&lt;p&gt;I scrubbed 2 of the problematic nodes.  Immediately after the scrub (5 hours) finished, a compaction was attempted and again failed:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;ERROR [CompactionExecutor:47] 2012-07-23 19:48:52,500 AbstractCassandraDaemon.java (line 134) Exception in thread &lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;[CompactionExecutor:47,1,main]
java.lang.AssertionError
        at org.apache.cassandra.db.compaction.LeveledManifest.promote(LeveledManifest.java:214)
        at org.apache.cassandra.db.compaction.LeveledCompactionStrategy.handleNotification(LeveledCompactionStrategy.java:158)
        at org.apache.cassandra.db.DataTracker.notifySSTablesChanged(DataTracker.java:531)
        at org.apache.cassandra.db.DataTracker.replaceCompactedSSTables(DataTracker.java:254)
        at org.apache.cassandra.db.ColumnFamilyStore.replaceCompactedSSTables(ColumnFamilyStore.java:978)
        at org.apache.cassandra.db.compaction.CompactionTask.execute(CompactionTask.java:200)
        at org.apache.cassandra.db.compaction.LeveledCompactionTask.execute(LeveledCompactionTask.java:50)
        at org.apache.cassandra.db.compaction.CompactionManager$1.runMayThrow(CompactionManager.java:150)
        at org.apache.cassandra.utils.WrappedRunnable.run(WrappedRunnable.java:30)
        at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:441)
        at java.util.concurrent.FutureTask$Sync.innerRun(FutureTask.java:303)
        at java.util.concurrent.FutureTask.run(FutureTask.java:138)
        at java.util.concurrent.ThreadPoolExecutor$Worker.runTask(ThreadPoolExecutor.java:886)
        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:908)
        at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:662)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I&apos;ve verified (using ls and the timestamps of *-Data.db sstables) that there are no old sstables and all of the sstables in the CF are the ones generated during the 5 hours of scrubbing.&lt;/p&gt;

&lt;p&gt;I&apos;ve also stopped and restarted one of these nodes, and again shortly after restart the compaction failed with a different stack trace:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;java.lang.RuntimeException: Last written key DecoratedKey(225595347341523546110318866012608496, 64313635626665302d333764372d313165302d393933622d303032366239333763386531) &amp;gt;= current key DecoratedKey(221078382620949716286900834756484795, 37303538643361662d616362662d343030312d313565382d633662303030303030336131) writing into /&lt;span class=&quot;code-keyword&quot;&gt;var&lt;/span&gt;/lib/cassandra/data/MYKS/MYCF/MYKS-MYCF-tmp-hd-520277-Data.db
        at org.apache.cassandra.io.sstable.SSTableWriter.beforeAppend(SSTableWriter.java:134)
        at org.apache.cassandra.io.sstable.SSTableWriter.append(SSTableWriter.java:153)
        at org.apache.cassandra.db.compaction.CompactionTask.execute(CompactionTask.java:159)
        at org.apache.cassandra.db.compaction.LeveledCompactionTask.execute(LeveledCompactionTask.java:50)
        at org.apache.cassandra.db.compaction.CompactionManager$1.runMayThrow(CompactionManager.java:150)
        at org.apache.cassandra.utils.WrappedRunnable.run(WrappedRunnable.java:30)
        at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:441)
        at java.util.concurrent.FutureTask$Sync.innerRun(FutureTask.java:303)
        at java.util.concurrent.FutureTask.run(FutureTask.java:138)
        at java.util.concurrent.ThreadPoolExecutor$Worker.runTask(ThreadPoolExecutor.java:886)
        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:908)
        at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:662)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Is the fix for this ticket contained in some other code beyond the 2 posted patches (4411.txt, 4411-followup.txt) ?  That&apos;s what I&apos;m running with on top of 1.1.2.&lt;/p&gt;</comment>
                            <comment id="13421061" author="awinter" created="Tue, 24 Jul 2012 00:37:45 +0000"  >&lt;p&gt;I can also confirm that after multiple offline sstablescrubs across all nodes that I still had several nodes (but not all) spread across multiple DC&apos;s still exhibiting this problem as described above by Mina.  &lt;/p&gt;

&lt;p&gt;In an attempt to work around the problem I shut down the affected instances, deleted all data and re-bootstrapped them as if they were dead nodes.  Since doing so I haven&apos;t had the problem return however it is still early days.&lt;/p&gt;</comment>
                            <comment id="13421233" author="slebresne" created="Tue, 24 Jul 2012 07:14:35 +0000"  >&lt;p&gt;@Mina Did you run the offline scrub introduced with &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-4321&quot; title=&quot;stackoverflow building interval tree &amp;amp; possible sstable corruptions&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-4321&quot;&gt;&lt;del&gt;CASSANDRA-4321&lt;/del&gt;&lt;/a&gt;. Otherwise, it won&apos;t fix the problem. So you need to 1) shut down the node (this is important before running the offline scrub) and 2) run ./bin/sstablescrub. That last step should print some lines indicating having corrected some problems (otherwise, something is wrong with the scrubbing).&lt;/p&gt;

&lt;p&gt;If after that you still get an exception, it might be helpful if you could run with 0001-Add-debugging-info-for-LCS.txt applied.&lt;/p&gt;</comment>
                            <comment id="13421350" author="minaguib" created="Tue, 24 Jul 2012 12:20:59 +0000"  >&lt;p&gt;I ran the scrub in online mode.&lt;/p&gt;

&lt;p&gt;I just took down a node and am now running it in offline mode.  Will report back.&lt;/p&gt;

&lt;p&gt;BTW, the default &quot;sstablescrub&quot; does not respect the memory limits set in cassandra.in.sh, so it failed for me with:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;Exception in thread &lt;span class=&quot;code-quote&quot;&gt;&quot;main&quot;&lt;/span&gt; java.lang.OutOfMemoryError: Java heap space
        at sun.security.provider.DigestBase.engineDigest(DigestBase.java:146)
        at java.security.MessageDigest$Delegate.engineDigest(MessageDigest.java:546)
        at java.security.MessageDigest.digest(MessageDigest.java:323)
        at org.apache.cassandra.utils.FBUtilities.hash(FBUtilities.java:229)
        at org.apache.cassandra.utils.FBUtilities.hashToBigInteger(FBUtilities.java:213)
        at org.apache.cassandra.dht.RandomPartitioner.getToken(RandomPartitioner.java:154)
        at org.apache.cassandra.dht.RandomPartitioner.decorateKey(RandomPartitioner.java:47)
        at org.apache.cassandra.cache.AutoSavingCache.readSaved(AutoSavingCache.java:118)
        at org.apache.cassandra.db.ColumnFamilyStore.&amp;lt;init&amp;gt;(ColumnFamilyStore.java:230)
        at org.apache.cassandra.db.ColumnFamilyStore.createColumnFamilyStore(ColumnFamilyStore.java:341)
        at org.apache.cassandra.db.ColumnFamilyStore.createColumnFamilyStore(ColumnFamilyStore.java:313)
        at org.apache.cassandra.db.Table.initCf(Table.java:371)
        at org.apache.cassandra.db.Table.&amp;lt;init&amp;gt;(Table.java:304)
        at org.apache.cassandra.db.Table.open(Table.java:119)
        at org.apache.cassandra.db.Table.openWithoutSSTables(Table.java:102)
        at org.apache.cassandra.tools.StandaloneScrubber.main(StandaloneScrubber.java:65)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I edited it to update the hardocded limit of 256MB to a more reasonable value (the same as my cassandra.in.sh) to allow it to run without crashing.&lt;/p&gt;
</comment>
                            <comment id="13421487" author="minaguib" created="Tue, 24 Jul 2012 15:43:08 +0000"  >&lt;p&gt;Things appear better after an offline scrub.  While the scrubbing itself was uneventful, at the very end it did &quot;Checking leveled manifest&quot;, found 14 sstables in level 3 and level 4 that were problematic and moved them back to level 0.&lt;/p&gt;

&lt;p&gt;I started the node back up and all (+/- 10) compactions ran successfully.&lt;/p&gt;

&lt;p&gt;I&apos;ll keep an eye on it and if it stays well I&apos;ll do the same to the other nodes.  Perhaps I&apos;ll try my luck with sstablescrub --manifest-check to see if I can keep the downtime to a minimum.&lt;/p&gt;</comment>
                            <comment id="13423108" author="minaguib" created="Thu, 26 Jul 2012 14:33:10 +0000"  >&lt;p&gt;Quick follow-up&lt;/p&gt;

&lt;p&gt;All the problematic nodes have been offline scrubbed (successfully using --manifest-check to speed things up).  There are no more compaction errors / pending compactions.&lt;/p&gt;

&lt;p&gt;Like Anton, I&apos;m a bit weary and keeping an eye on things - but so far so good.&lt;/p&gt;

&lt;p&gt;On a tangent, it occurred to me that the amount of time it takes to run ( sstablescrub --manifest-check ) is mostly reading the sstables - the check itself and demoting the bad sstables to L0 appears very cheap - would it be a good idea to perform that check automatically on cassandra startup (after the sstables have been read) ?  It &lt;b&gt;may&lt;/b&gt; be a quick fix for 1.1.3 to help people out who have been bitten by this but don&apos;t know it yet.&lt;/p&gt;
</comment>
                            <comment id="13429257" author="omid" created="Mon, 6 Aug 2012 16:55:08 +0000"  >&lt;p&gt;@Mina were the sstables created after &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-4321&quot; title=&quot;stackoverflow building interval tree &amp;amp; possible sstable corruptions&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-4321&quot;&gt;&lt;del&gt;CASSANDRA-4321&lt;/del&gt;&lt;/a&gt; patch? Otherwise offline-scrub with --manifest-check is unlikely to solve the problem (or at least I don&apos;t understand how) since there would still be out-of-order sstables existing.&lt;/p&gt;</comment>
                            <comment id="13431275" author="omid" created="Wed, 8 Aug 2012 18:31:59 +0000"  >&lt;p&gt;I can confirm that the problem is still there. I offline-scrubbed using 1.1.3 (sstables were generated by 1.1.0) , but the scrubber did not report any out-of-order sstables, but sent some sstables back to L0. On compaction though, I get the exception:&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;2012-08-08_18:15:41.85260 java.lang.RuntimeException: Last written key DecoratedKey(135076574692378869287086649376333921820, SOME_KEY_1) &amp;gt;= current key DecoratedKey(135076574692378869287086649376333921820, SOME_KEY_1) writing into /var/lib/cassandra/abcd/data/KSP/CF1/KSP-CF1-tmp-he-178793-Data.db&lt;br/&gt;
2012-08-08_18:15:41.85303 	at org.apache.cassandra.io.sstable.SSTableWriter.beforeAppend(SSTableWriter.java:134)&lt;br/&gt;
2012-08-08_18:15:41.85314 	at org.apache.cassandra.io.sstable.SSTableWriter.append(SSTableWriter.java:153)&lt;br/&gt;
2012-08-08_18:15:41.85326 	at org.apache.cassandra.db.compaction.CompactionTask.execute(CompactionTask.java:159)&lt;br/&gt;
2012-08-08_18:15:41.85338 	at org.apache.cassandra.db.compaction.LeveledCompactionTask.execute(LeveledCompactionTask.java:50)&lt;br/&gt;
2012-08-08_18:15:41.85351 	at org.apache.cassandra.db.compaction.CompactionManager$6.runMayThrow(CompactionManager.java:288)&lt;br/&gt;
2012-08-08_18:15:41.85364 	at org.apache.cassandra.utils.WrappedRunnable.run(WrappedRunnable.java:30)&lt;br/&gt;
2012-08-08_18:15:41.85375 	at java.util.concurrent.Executors$RunnableAdapter.call(Unknown Source)&lt;br/&gt;
2012-08-08_18:15:41.85385 	at java.util.concurrent.FutureTask$Sync.innerRun(Unknown Source)&lt;br/&gt;
2012-08-08_18:15:41.85395 	at java.util.concurrent.FutureTask.run(Unknown Source)&lt;br/&gt;
2012-08-08_18:15:41.85403 	at java.util.concurrent.ThreadPoolExecutor$Worker.runTask(Unknown Source)&lt;br/&gt;
2012-08-08_18:15:41.85414 	at java.util.concurrent.ThreadPoolExecutor$Worker.run(Unknown Source)&lt;br/&gt;
2012-08-08_18:15:41.85424 	at java.lang.Thread.run(Unknown Source)&lt;/p&gt;&lt;/blockquote&gt;
</comment>
                            <comment id="13431295" author="omid" created="Wed, 8 Aug 2012 18:56:57 +0000"  >&lt;p&gt;Not sure, but from the fact that the two keys are identical and the &quot;Last written key&quot;-check checks for greater-or-equal, shouldn&apos;t the &quot;&amp;gt;&quot; be &quot;&amp;gt;=&quot; in:&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/apache/cassandra/blob/cassandra-1.1/src/java/org/apache/cassandra/db/compaction/Scrubber.java#L178&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/cassandra/blob/cassandra-1.1/src/java/org/apache/cassandra/db/compaction/Scrubber.java#L178&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;?&lt;/p&gt;</comment>
                            <comment id="13431431" author="jbellis" created="Wed, 8 Aug 2012 21:53:17 +0000"  >&lt;p&gt;I think you&apos;re right.  I&apos;ll push a fix for that shortly.&lt;/p&gt;</comment>
                            <comment id="13431857" author="jbellis" created="Thu, 9 Aug 2012 14:43:51 +0000"  >&lt;p&gt;done in 115f380a86912e5918f534db2ec2935253909fad&lt;/p&gt;</comment>
                            <comment id="13431956" author="omid" created="Thu, 9 Aug 2012 16:27:48 +0000"  >&lt;p&gt;Thanks!&lt;/p&gt;

&lt;p&gt;There are two more off-by-ones. &lt;/p&gt;

&lt;p&gt;One is the Scrubber to detect out-of-order keys (similar to the one already patched). &lt;/p&gt;

&lt;p&gt;The other one is in manifestCheck to send overlapping sstables back to L0 (which has causes assertion errors in LeveledManifest::promote)&lt;/p&gt;

&lt;p&gt;Patch is attached.&lt;/p&gt;</comment>
                            <comment id="13431964" author="jbellis" created="Thu, 9 Aug 2012 16:40:32 +0000"  >&lt;p&gt;committed, thanks!&lt;/p&gt;</comment>
                            <comment id="13443282" author="jbellis" created="Tue, 28 Aug 2012 17:09:49 +0000"  >&lt;p&gt;Updating to note that this was &quot;mostly&quot; fixed in 1.1.3, with Omid&apos;s extra &amp;gt;= fixes in 1.1.4.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12536382" name="0001-Add-debugging-info-for-LCS.txt" size="2268" author="slebresne" created="Fri, 13 Jul 2012 13:17:01 +0000"/>
                            <attachment id="12540058" name="0001-Fix-off-by-one-for-out-of-order-and-overlapping-ssta.patch" size="2117" author="omid" created="Thu, 9 Aug 2012 16:27:48 +0000"/>
                            <attachment id="12536645" name="4411-followup.txt" size="1458" author="slebresne" created="Mon, 16 Jul 2012 15:15:56 +0000"/>
                            <attachment id="12536617" name="4411.txt" size="1155" author="slebresne" created="Mon, 16 Jul 2012 11:27:23 +0000"/>
                            <attachment id="12536552" name="assertion-w-more-debugging-info-omid.log" size="1422958" author="omid" created="Sun, 15 Jul 2012 13:51:07 +0000"/>
                            <attachment id="12536509" name="assertion.moreinfo.system.log" size="599921" author="rvanderleeden" created="Sat, 14 Jul 2012 15:04:33 +0000"/>
                            <attachment id="12536021" name="system.log" size="54930" author="schnidrig" created="Wed, 11 Jul 2012 12:44:31 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>7.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[slebresne]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>249306</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            13 years, 13 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0a6qn:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>57365</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>jbellis</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[jbellis]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12962"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>