<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 22:48:17 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-7566] DROP TABLE should also drop prepared statements associated to</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-7566</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;An integration test suite that drops and creates the same column family 3 times causes the following error in the server log:&lt;/p&gt;

&lt;p&gt;INFO  15:40:34 Initializing gocql_test.wiki_page&lt;br/&gt;
ERROR 15:40:34 Attempted to write commit log entry for unrecognized column family: b0e167e0-0dc8-11e4-9cbb-29a4872887f2&lt;br/&gt;
ERROR 15:40:34 Attempting to mutate non-existant column family b0e167e0-0dc8-11e4-9cbb-29a4872887f2&lt;br/&gt;
ERROR 15:40:34 Attempted to write commit log entry for unrecognized column family: b0e167e0-0dc8-11e4-9cbb-29a4872887f2&lt;br/&gt;
ERROR 15:40:34 Attempting to mutate non-existant column family b0e167e0-0dc8-11e4-9cbb-29a4872887f2&lt;/p&gt;

&lt;p&gt;The test that reproduces this issue is here:&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/gocql/gocql/blob/master/wiki_test.go&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/gocql/gocql/blob/master/wiki_test.go&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Interestingly this issue only occurs after the common table is dropped/created for the 3rd time. If only one of the tests is run on its own, this issue does not arise.&lt;/p&gt;</description>
                <environment>&lt;p&gt;OSX 10.9.4 / JDK 1.8.0_05&lt;/p&gt;</environment>
        <key id="12727960">CASSANDRA-7566</key>
            <summary>DROP TABLE should also drop prepared statements associated to</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10002" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Normal</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="viju">Viju Kothuvatiparambil</assignee>
                                    <reporter username="0x6e6562">Ben Hood</reporter>
                        <labels>
                            <label>bootcamp</label>
                            <label>cql3</label>
                    </labels>
                <created>Thu, 17 Jul 2014 16:12:25 +0000</created>
                <updated>Tue, 16 Apr 2019 09:31:40 +0000</updated>
                            <resolved>Wed, 17 Sep 2014 01:24:08 +0000</resolved>
                                        <fixVersion>2.1.1</fixVersion>
                                        <due></due>
                            <votes>1</votes>
                                    <watches>6</watches>
                                                                                                                <comments>
                            <comment id="14065065" author="brandon.williams" created="Thu, 17 Jul 2014 16:19:43 +0000"  >&lt;p&gt;The short answer is don&apos;t do this before 2.1.&lt;/p&gt;</comment>
                            <comment id="14065067" author="brandon.williams" created="Thu, 17 Jul 2014 16:21:00 +0000"  >&lt;p&gt;Oops, missed the repro version.&lt;/p&gt;</comment>
                            <comment id="14065075" author="0x6e6562" created="Thu, 17 Jul 2014 16:27:33 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-5202&quot; title=&quot;CFs should have globally and temporally unique CF IDs to prevent &amp;quot;reusing&amp;quot; data from earlier incarnation of same CF name&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-5202&quot;&gt;&lt;del&gt;CASSANDRA-5202&lt;/del&gt;&lt;/a&gt; appears to have been fixed in 2.1 beta1, but the version I&apos;m using is 2.1-rc3. Is 2.1 beta 1 a newer release than 2.1-rc3? &lt;/p&gt;</comment>
                            <comment id="14065081" author="yukim" created="Thu, 17 Jul 2014 16:32:58 +0000"  >&lt;p&gt;CommitLog just writes log in ERROR when it detects dropped CF(&lt;a href=&quot;https://github.com/apache/cassandra/blob/cassandra-2.1.0-rc3/src/java/org/apache/cassandra/db/commitlog/CommitLogSegment.java#L439&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/cassandra/blob/cassandra-2.1.0-rc3/src/java/org/apache/cassandra/db/commitlog/CommitLogSegment.java#L439&lt;/a&gt;).&lt;br/&gt;
Should it be changed to WARN or INFO?&lt;/p&gt;</comment>
                            <comment id="14065089" author="brandon.williams" created="Thu, 17 Jul 2014 16:36:22 +0000"  >&lt;blockquote&gt;&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-5202&quot; title=&quot;CFs should have globally and temporally unique CF IDs to prevent &amp;quot;reusing&amp;quot; data from earlier incarnation of same CF name&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-5202&quot;&gt;&lt;del&gt;CASSANDRA-5202&lt;/del&gt;&lt;/a&gt; appears to have been fixed in 2.1 beta1, but the version I&apos;m using is 2.1-rc3. Is 2.1 beta 1 a newer release than 2.1-rc3?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;No; my mistake.  Sorry.&lt;/p&gt;</comment>
                            <comment id="14065090" author="0x6e6562" created="Thu, 17 Jul 2014 16:36:37 +0000"  >&lt;p&gt;The CQL that is submitted in this test is:&lt;/p&gt;

&lt;p&gt;DROP TABLE IF EXISTS wiki_page;&lt;/p&gt;

&lt;p&gt;followed by&lt;/p&gt;

&lt;p&gt;CREATE TABLE wiki_page (...);&lt;/p&gt;

&lt;p&gt;So I&apos;m not seeing why this should result in a server error.&lt;/p&gt;

&lt;p&gt;Also, this is not just an entry in the server log file, it causes a test to fail that passes on our Travis run for the 2.0.6 and 2.0.7 releases.&lt;/p&gt;</comment>
                            <comment id="14065136" author="yukim" created="Thu, 17 Jul 2014 17:02:38 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=0x6e6562&quot; class=&quot;user-hover&quot; rel=&quot;0x6e6562&quot;&gt;0x6e6562&lt;/a&gt;, does gocql use prepared statement?&lt;br/&gt;
I&apos;m guessing we need to drop prepared statement too when dropping columnfamily.&lt;/p&gt;</comment>
                            <comment id="14065343" author="0x6e6562" created="Thu, 17 Jul 2014 18:45:22 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=yukim&quot; class=&quot;user-hover&quot; rel=&quot;yukim&quot;&gt;yukim&lt;/a&gt; Yes, gocql does prepare all statements by default. I could see if I can disable this behavior in the gocql driver and see if that has an effect.&lt;/p&gt;</comment>
                            <comment id="14065376" author="0x6e6562" created="Thu, 17 Jul 2014 19:02:19 +0000"  >&lt;p&gt;OK, so the plot thickens.&lt;/p&gt;

&lt;p&gt;By disabling statement preparation in the driver, I was able to workaround this issue (see this patch for a workaround for this particular test case).&lt;/p&gt;

&lt;p&gt;That said, I have noticed that another test fails for a different reason. Now the test called TestReprepareStatement (&lt;a href=&quot;https://github.com/gocql/gocql/blob/master/cassandra_test.go#L582&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/gocql/gocql/blob/master/cassandra_test.go#L582&lt;/a&gt;) which tests the handling of statement re-preparation now fails with this server error:&lt;/p&gt;


&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;INFO  18:56:03 Initializing gocql_test.test_reprepare_statement
ERROR 18:56:03 Unexpected exception during request
java.lang.NullPointerException: null
	at org.apache.cassandra.transport.messages.ExecuteMessage.execute(ExecuteMessage.java:105) ~[apache-cassandra-2.1.0-rc3.jar:2.1.0-rc3]
	at org.apache.cassandra.transport.Message$Dispatcher.channelRead0(Message.java:421) [apache-cassandra-2.1.0-rc3.jar:2.1.0-rc3]
	at org.apache.cassandra.transport.Message$Dispatcher.channelRead0(Message.java:318) [apache-cassandra-2.1.0-rc3.jar:2.1.0-rc3]
	at io.netty.channel.SimpleChannelInboundHandler.channelRead(SimpleChannelInboundHandler.java:103) [netty-all-4.0.20.Final.jar:4.0.20.Final]
	at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:332) [netty-all-4.0.20.Final.jar:4.0.20.Final]
	at io.netty.channel.AbstractChannelHandlerContext.access$700(AbstractChannelHandlerContext.java:31) [netty-all-4.0.20.Final.jar:4.0.20.Final]
	at io.netty.channel.AbstractChannelHandlerContext$8.run(AbstractChannelHandlerContext.java:323) [netty-all-4.0.20.Final.jar:4.0.20.Final]
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511) [na:1.8.0_05]
	at org.apache.cassandra.concurrent.AbstractTracingAwareExecutorService$FutureTask.run(AbstractTracingAwareExecutorService.java:162) [apache-cassandra-2.1.0-rc3.jar:2.1.0-rc3]
	at org.apache.cassandra.concurrent.SEPWorker.run(SEPWorker.java:103) [apache-cassandra-2.1.0-rc3.jar:2.1.0-rc3]
	at java.lang.Thread.run(Thread.java:745) [na:1.8.0_05]
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This looks like two different bugs and potentially should be handled by two separate bug reports?&lt;/p&gt;</comment>
                            <comment id="14065383" author="0x6e6562" created="Thu, 17 Jul 2014 19:05:45 +0000"  >&lt;p&gt;For anybody coming across this issue via Google, the original pull request to gocql that provokes this error is here: &lt;a href=&quot;https://github.com/gocql/gocql/pull/198&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/gocql/gocql/pull/198&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14065459" author="thobbs" created="Thu, 17 Jul 2014 19:54:52 +0000"  >&lt;p&gt;The NPE in ExecuteMessage is &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-7454&quot; title=&quot;NPE When Prepared Statement ID is not Found&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-7454&quot;&gt;&lt;del&gt;CASSANDRA-7454&lt;/del&gt;&lt;/a&gt;.  That was supposed to be fixed in rc3, but it looks like it got committed for 2.1.1 instead.  I&apos;ll commit that to 2.1.0 and update the ticket.&lt;/p&gt;</comment>
                            <comment id="14065617" author="yukim" created="Thu, 17 Jul 2014 21:47:55 +0000"  >&lt;p&gt;Updated summary to reflect the problem.&lt;/p&gt;</comment>
                            <comment id="14133309" author="vijuk" created="Sun, 14 Sep 2014 17:59:59 +0000"  >&lt;p&gt;A patch to this issue is attached along with a test class. The QueryProcessor class now listens to the changes to schema, and cleanups prepared statements on drop keyspace and drop table events.  This is done by implementing IMigrationListener inside QueryProcessor and registering the listener with MigrationManager. This patch can be enhanced to fix the related issues, but this being my first contribution to Cassandra, I would like the experts to comment on it before I work on the others.  (My sincere thanks to Tylor Hobbs, Aleksey Yeschenko, Brandon Williams, Joshua McKenzie and Marcus Eriksson for helping me out at the Cassandra developer Bootcamp)&lt;/p&gt;</comment>
                            <comment id="14136423" author="thobbs" created="Tue, 16 Sep 2014 22:52:43 +0000"  >&lt;p&gt;Thanks, Viju!  Committed with some code-style changes.&lt;/p&gt;

&lt;p&gt;In the future, try to watch for the following:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;Curly braces should always go on a new line&lt;/li&gt;
	&lt;li&gt;Use spaces, not tabs&lt;/li&gt;
	&lt;li&gt;Single-line if statements don&apos;t need curly braces&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="14136599" author="mshuler" created="Wed, 17 Sep 2014 01:01:17 +0000"  >&lt;p&gt;The merge of this patch to trunk causes a build failure on trunk.  Seems to build OK for me on the cassandra-2.1 branch.&lt;br/&gt;
&lt;a href=&quot;http://cassci.datastax.com/job/trunk/1069/console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://cassci.datastax.com/job/trunk/1069/console&lt;/a&gt;&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;    [javac] /home/mshuler/git/cassandra/src/java/org/apache/cassandra/cql3/QueryProcessor.java:515: error: MigrationSubscriber is not abstract and does not override abstract method onDropFunction(String,String) in IMigrationListener
    [javac]     private static class MigrationSubscriber implements IMigrationListener
    [javac]                    ^
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="14136693" author="dbrosius" created="Wed, 17 Sep 2014 02:49:31 +0000"  >&lt;p&gt;QueryProcessor.MigrationSubscriber.shouldInvalidate seems odd&lt;/p&gt;

&lt;p&gt;it fetches the column family name from the statement, but then just uses the column family passed as a parameter. &lt;/p&gt;

&lt;p&gt;Are these always the same? if so, probably should just remove &apos;statementCfName&apos;&lt;/p&gt;</comment>
                            <comment id="14137524" author="thobbs" created="Wed, 17 Sep 2014 16:45:28 +0000"  >&lt;blockquote&gt;&lt;p&gt;it fetches the column family name from the statement, but then just uses the column family passed as a parameter. Are these always the same? if so, probably should just remove &apos;statementCfName&apos;&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;The method parameters are the ks and cf that was dropped.  The statement we&apos;re looking at is the cached prepared statement.  We&apos;re just checking that the ks and cf (if a table was dropped) match the statement&apos;s.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                                                <inwardlinks description="is duplicated by">
                                        <issuelink>
            <issuekey id="12749349">CASSANDRA-8153</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12740711">CASSANDRA-7910</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12668665" name="trunk-7566.txt" size="8654" author="vijuk" created="Sun, 14 Sep 2014 17:59:59 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[viju]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>406065</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            11 years, 9 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1xvmn:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>406085</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12311421" key="com.atlassian.jira.plugin.system.customfieldtypes:multiversion">
                        <customfieldname>Reproduced In</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="12324159">2.1 rc3</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>thobbs</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[thobbs]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12962"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>