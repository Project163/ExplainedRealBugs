<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 22:20:30 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-2283] Streaming Old Format Data Fails in 0.7.3 after upgrade from 0.6.8</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-2283</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;After successfully upgrading a 0.6.8 ring to 0.7.3, we needed to bootstrap in a new node relatively quickly. When starting the new node with an assigned token in auto bootstrap mode, we see the following exceptions on the new node:&lt;/p&gt;

&lt;p&gt;INFO &lt;span class=&quot;error&quot;&gt;&amp;#91;main&amp;#93;&lt;/span&gt; 2011-03-07 10:37:32,671 StorageService.java (line 505) Joining: sleeping 30000 ms for pending range setup&lt;br/&gt;
 INFO &lt;span class=&quot;error&quot;&gt;&amp;#91;main&amp;#93;&lt;/span&gt; 2011-03-07 10:38:02,679 StorageService.java (line 505) Bootstrapping&lt;br/&gt;
 INFO &lt;span class=&quot;error&quot;&gt;&amp;#91;HintedHandoff:1&amp;#93;&lt;/span&gt; 2011-03-07 10:38:02,899 HintedHandOffManager.java (line 304) Started hinted handoff for endpoint /10.211.14.200&lt;br/&gt;
 INFO &lt;span class=&quot;error&quot;&gt;&amp;#91;HintedHandoff:1&amp;#93;&lt;/span&gt; 2011-03-07 10:38:02,900 HintedHandOffManager.java (line 360) Finished hinted handoff of 0 rows to endpoint /10.211.14.200&lt;br/&gt;
 INFO &lt;span class=&quot;error&quot;&gt;&amp;#91;CompactionExecutor:1&amp;#93;&lt;/span&gt; 2011-03-07 10:38:04,924 SSTableReader.java (line 154) Opening /mnt/services/cassandra/var/data/0.7.3/data/Stuff/stuff-f-1&lt;br/&gt;
 INFO &lt;span class=&quot;error&quot;&gt;&amp;#91;CompactionExecutor:1&amp;#93;&lt;/span&gt; 2011-03-07 10:38:05,390 SSTableReader.java (line 154) Opening /mnt/services/cassandra/var/data/0.7.3/data/Stuff/stuff-f-2&lt;br/&gt;
 INFO &lt;span class=&quot;error&quot;&gt;&amp;#91;CompactionExecutor:1&amp;#93;&lt;/span&gt; 2011-03-07 10:38:05,768 SSTableReader.java (line 154) Opening /mnt/services/cassandra/var/data/0.7.3/data/Stuff/stuffid-f-1&lt;br/&gt;
 INFO &lt;span class=&quot;error&quot;&gt;&amp;#91;CompactionExecutor:1&amp;#93;&lt;/span&gt; 2011-03-07 10:38:06,389 SSTableReader.java (line 154) Opening /mnt/services/cassandra/var/data/0.7.3/data/Stuff/stuffid-f-2&lt;br/&gt;
 INFO &lt;span class=&quot;error&quot;&gt;&amp;#91;CompactionExecutor:1&amp;#93;&lt;/span&gt; 2011-03-07 10:38:06,581 SSTableReader.java (line 154) Opening /mnt/services/cassandra/var/data/0.7.3/data/Stuff/stuffid-f-3&lt;br/&gt;
ERROR &lt;span class=&quot;error&quot;&gt;&amp;#91;CompactionExecutor:1&amp;#93;&lt;/span&gt; 2011-03-07 10:38:07,056 AbstractCassandraDaemon.java (line 114) Fatal exception in thread Thread&lt;span class=&quot;error&quot;&gt;&amp;#91;CompactionExecutor:1,1,main&amp;#93;&lt;/span&gt;&lt;br/&gt;
java.io.EOFException&lt;br/&gt;
        at org.apache.cassandra.io.sstable.IndexHelper.skipIndex(IndexHelper.java:65)&lt;br/&gt;
        at org.apache.cassandra.io.sstable.SSTableWriter$Builder.build(SSTableWriter.java:303)&lt;br/&gt;
        at org.apache.cassandra.db.CompactionManager$9.call(CompactionManager.java:923)&lt;br/&gt;
        at org.apache.cassandra.db.CompactionManager$9.call(CompactionManager.java:916)&lt;br/&gt;
        at java.util.concurrent.FutureTask$Sync.innerRun(FutureTask.java:303)&lt;br/&gt;
        at java.util.concurrent.FutureTask.run(FutureTask.java:138)&lt;br/&gt;
        at java.util.concurrent.ThreadPoolExecutor$Worker.runTask(ThreadPoolExecutor.java:886)&lt;br/&gt;
        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:908)&lt;br/&gt;
        at java.lang.Thread.run(Thread.java:662)&lt;br/&gt;
 INFO &lt;span class=&quot;error&quot;&gt;&amp;#91;CompactionExecutor:1&amp;#93;&lt;/span&gt; 2011-03-07 10:38:08,480 SSTableReader.java (line 154) Opening /mnt/services/cassandra/var/data/0.7.3/data/Stuff/stuffid-f-5&lt;br/&gt;
 INFO &lt;span class=&quot;error&quot;&gt;&amp;#91;CompactionExecutor:1&amp;#93;&lt;/span&gt; 2011-03-07 10:38:08,582 SSTableReader.java (line 154) Opening /mnt/services/cassandra/var/data/0.7.3/data/Stuff/stuffid_reg_idx-f-1&lt;br/&gt;
ERROR &lt;span class=&quot;error&quot;&gt;&amp;#91;CompactionExecutor:1&amp;#93;&lt;/span&gt; 2011-03-07 10:38:08,635 AbstractCassandraDaemon.java (line 114) Fatal exception in thread Thread&lt;span class=&quot;error&quot;&gt;&amp;#91;CompactionExecutor:1,1,main&amp;#93;&lt;/span&gt;&lt;br/&gt;
java.io.EOFException&lt;br/&gt;
        at org.apache.cassandra.io.sstable.IndexHelper.skipIndex(IndexHelper.java:65)&lt;br/&gt;
        at org.apache.cassandra.io.sstable.SSTableWriter$Builder.build(SSTableWriter.java:303)&lt;br/&gt;
        at org.apache.cassandra.db.CompactionManager$9.call(CompactionManager.java:923)&lt;br/&gt;
        at org.apache.cassandra.db.CompactionManager$9.call(CompactionManager.java:916)&lt;br/&gt;
        at java.util.concurrent.FutureTask$Sync.innerRun(FutureTask.java:303)&lt;br/&gt;
        at java.util.concurrent.FutureTask.run(FutureTask.java:138)&lt;br/&gt;
        at java.util.concurrent.ThreadPoolExecutor$Worker.runTask(ThreadPoolExecutor.java:886)&lt;br/&gt;
        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:908)&lt;br/&gt;
        at java.lang.Thread.run(Thread.java:662)&lt;br/&gt;
ERROR &lt;span class=&quot;error&quot;&gt;&amp;#91;CompactionExecutor:1&amp;#93;&lt;/span&gt; 2011-03-07 10:38:08,666 AbstractCassandraDaemon.java (line 114) Fatal exception in thread Thread&lt;span class=&quot;error&quot;&gt;&amp;#91;CompactionExecutor:1,1,main&amp;#93;&lt;/span&gt;&lt;br/&gt;
java.io.EOFException&lt;br/&gt;
        at org.apache.cassandra.io.sstable.IndexHelper.skipIndex(IndexHelper.java:65)&lt;br/&gt;
        at org.apache.cassandra.io.sstable.SSTableWriter$Builder.build(SSTableWriter.java:303)&lt;br/&gt;
        at org.apache.cassandra.db.CompactionManager$9.call(CompactionManager.java:923)&lt;br/&gt;
        at org.apache.cassandra.db.CompactionManager$9.call(CompactionManager.java:916)&lt;br/&gt;
        at java.util.concurrent.FutureTask$Sync.innerRun(FutureTask.java:303)&lt;br/&gt;
        at java.util.concurrent.FutureTask.run(FutureTask.java:138)&lt;br/&gt;
        at java.util.concurrent.ThreadPoolExecutor$Worker.runTask(ThreadPoolExecutor.java:886)&lt;br/&gt;
        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:908)&lt;br/&gt;
        at java.lang.Thread.run(Thread.java:662)&lt;br/&gt;
 INFO &lt;span class=&quot;error&quot;&gt;&amp;#91;CompactionExecutor:1&amp;#93;&lt;/span&gt; 2011-03-07 10:38:08,855 SSTableReader.java (line 154) Opening /mnt/services/cassandra/var/data/0.7.3/data/Stuff/stuffid_reg_idx-f-4&lt;/p&gt;

&lt;p&gt;Two attempts to bootstrap in the new node both exhibited this behavior. On the node owning the tokens being migrated, stream activity is visible but doesn&apos;t update any progress I think due to the issues on the receiving host.&lt;/p&gt;







&lt;p&gt;Lastly, just case it&apos;s relevant, we had an EC2 node die underneath us during the upgrade so not all nodes were drained. This didn&apos;t affect the upgrade but I wanted to note it her to be thorough.&lt;/p&gt;</description>
                <environment>&lt;p&gt;0.7.3 upgraded from 0.6.8, Linux Java HotSpot(TM) 64-Bit Server VM (build 17.1-b03, mixed mode)&lt;/p&gt;</environment>
        <key id="12500677">CASSANDRA-2283</key>
            <summary>Streaming Old Format Data Fails in 0.7.3 after upgrade from 0.6.8</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10002" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Normal</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="jbellis">Jonathan Ellis</assignee>
                                    <reporter username="eonnen">Erik Onnen</reporter>
                        <labels>
                    </labels>
                <created>Mon, 7 Mar 2011 21:00:31 +0000</created>
                <updated>Tue, 16 Apr 2019 09:33:05 +0000</updated>
                            <resolved>Mon, 18 Apr 2011 21:58:51 +0000</resolved>
                                        <fixVersion>0.7.5</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="13004580" author="jbellis" created="Wed, 9 Mar 2011 14:52:01 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-2296&quot; title=&quot;Scrub resulting in &amp;quot;bloom filter claims to be longer than entire row size&amp;quot; error&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-2296&quot;&gt;&lt;del&gt;CASSANDRA-2296&lt;/del&gt;&lt;/a&gt; is going to cause streaming trouble too. In other words: scrub won&apos;t fix this unless run w/ a build that has 2296 applied.&lt;/p&gt;</comment>
                            <comment id="13004658" author="jbellis" created="Wed, 9 Mar 2011 17:10:21 +0000"  >&lt;blockquote&gt;&lt;p&gt;scrub won&apos;t fix this&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;that is, for sstables containing expired tombstones&lt;/p&gt;</comment>
                            <comment id="13006090" author="stuhood" created="Sat, 12 Mar 2011 20:31:08 +0000"  >&lt;p&gt;While not ideal, this is actually supposed to throw an exception in SSTableWriter.createBuilder, but that is dependent on a correctly versioned Descriptor being created on the destination side. I expect that streaming is dropping the source version when it creates the destination descriptor.&lt;/p&gt;</comment>
                            <comment id="13010916" author="eonnen" created="Thu, 24 Mar 2011 20:54:17 +0000"  >&lt;p&gt;Ok, I can confirm that after upgrading to 0.7.4 where 2296 was applied, and after performing a scrub, we were able to bootstrap in new nodes again.&lt;/p&gt;</comment>
                            <comment id="13011360" author="jbellis" created="Fri, 25 Mar 2011 19:03:36 +0000"  >&lt;p&gt;IMO the right thing to do here is to deserialize enough of the data sent during stream to (a) rewrite it to latest format and (b) write bloom filter and row index &amp;#8211; currently this is done in a second pass post-stream.&lt;/p&gt;</comment>
                            <comment id="13011597" author="stuhood" created="Sat, 26 Mar 2011 09:51:01 +0000"  >&lt;p&gt;&amp;gt; (a) rewrite it to latest format and (b) write bloom filter and row index&lt;br/&gt;
I was hoping that we could get away with just doing (b) in order to avoid having to re-write the data file, but it certainly simplifies things to re-write in the current format.&lt;/p&gt;

&lt;p&gt;EDIT: &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-2336&quot; title=&quot;Extract SSTable.Builder/IndexWriter&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-2336&quot;&gt;&lt;del&gt;CASSANDRA-2336&lt;/del&gt;&lt;/a&gt; took a step toward allowing rebuilding and index writing to be version specific, in order to implement (b). I&apos;m most of the way through an implementation of &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-2319&quot; title=&quot;Promote row index&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-2319&quot;&gt;&lt;del&gt;CASSANDRA-2319&lt;/del&gt;&lt;/a&gt; on top of it, but I don&apos;t see a clear answer for a/b/a+b.&lt;/p&gt;</comment>
                            <comment id="13012077" author="jbellis" created="Mon, 28 Mar 2011 14:34:16 +0000"  >&lt;p&gt;You&apos;re right, making it one-pass isn&apos;t feasible without writing the streamed row out to a temporary file first, since we don&apos;t have a way to rebuild the row-level bloom filter + block index.  In other words, not really any more one-pass than the existing approach.&lt;/p&gt;</comment>
                            <comment id="13012082" author="jbellis" created="Mon, 28 Mar 2011 14:36:50 +0000"  >&lt;p&gt;Patch to preserve version across streams. Also removes obsolete component field from PendingFile (we only stream Component.DATA).&lt;/p&gt;</comment>
                            <comment id="13019085" author="stuhood" created="Tue, 12 Apr 2011 22:13:16 +0000"  >&lt;p&gt;Looks good: only comment is that BootstrapTest should probably purposely use an old version and check that it is preserved.&lt;/p&gt;</comment>
                            <comment id="13021297" author="jbellis" created="Mon, 18 Apr 2011 21:58:51 +0000"  >&lt;p&gt;added version check to BootstrapTest.&lt;/p&gt;

&lt;p&gt;committed w/ just the version changes &amp;#8211; left PendingFile alone. (&lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-2438&quot; title=&quot;expose the table building (build primary/secondary indexes, bloom filters) as a remote call so that pre-serialized tables can be added to a running node&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-2438&quot;&gt;&lt;del&gt;CASSANDRA-2438&lt;/del&gt;&lt;/a&gt; suggests we might want to stream fully-formed sstables for bulk load.)&lt;/p&gt;</comment>
                            <comment id="13021315" author="hudson" created="Mon, 18 Apr 2011 22:21:41 +0000"  >&lt;p&gt;Integrated in Cassandra-0.7 #442 (See &lt;a href=&quot;https://hudson.apache.org/hudson/job/Cassandra-0.7/442/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://hudson.apache.org/hudson/job/Cassandra-0.7/442/&lt;/a&gt;)&lt;br/&gt;
    preserve version when streaming data from old sstables&lt;br/&gt;
patch by jbellis; reviewed by Stu Hood for &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-2283&quot; title=&quot;Streaming Old Format Data Fails in 0.7.3 after upgrade from 0.6.8&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-2283&quot;&gt;&lt;del&gt;CASSANDRA-2283&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12474779" name="2283.txt" size="12147" author="jbellis" created="Mon, 28 Mar 2011 14:36:50 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[jbellis]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>20539</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            14 years, 32 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0gagf:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>93124</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>stuhood</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[stuhood]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12962"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>