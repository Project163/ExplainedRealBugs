<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 23:02:50 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-10962] Cassandra should not create snapshot at restart for compactions_in_progress</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-10962</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;If auto_snapshot is set to true in cassandra.yaml, each time you restart Cassandra, a snapshot is created for system.compactions_in_progress as the table is truncated at cassandra start.&lt;/p&gt;

&lt;p&gt;However as datas in this table are temporary, Cassandra should not create snapshot for this table (or maybe even for system.* tables). This will be coherent with the fact that &quot;nodetool listsnapshots&quot; doesn&apos;t even list this table.&lt;/p&gt;

&lt;p&gt;Exemple:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;$ nodetool listsnapshots | grep compactions
$ ls -lh system/compactions_in_progress-55080ab05d9c388690a4acb25fe1f77b/snapshots/
total 16K
drwxr-xr-x 2 cassandra cassandra 4.0K Nov 30 13:12 1448885530280-compactions_in_progress
drwxr-xr-x 2 cassandra cassandra 4.0K Dec  7 15:36 1449498977181-compactions_in_progress
drwxr-xr-x 2 cassandra cassandra 4.0K Dec 14 18:20 1450113621506-compactions_in_progress
drwxr-xr-x 2 cassandra cassandra 4.0K Jan  4 12:53 1451908396364-compactions_in_progress
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment>&lt;p&gt;Ubuntu 14.04.3 LTS&lt;/p&gt;</environment>
        <key id="12926970">CASSANDRA-10962</key>
            <summary>Cassandra should not create snapshot at restart for compactions_in_progress</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10003" iconUrl="https://issues.apache.org/jira/images/icons/priorities/trivial.svg">Low</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="ifesdjeen">Alex Petrov</assignee>
                                    <reporter username="fabrice.facorat">FACORAT</reporter>
                        <labels>
                    </labels>
                <created>Mon, 4 Jan 2016 13:00:18 +0000</created>
                <updated>Wed, 15 Oct 2025 09:49:01 +0000</updated>
                            <resolved>Thu, 5 May 2016 22:05:32 +0000</resolved>
                                        <fixVersion>2.2.7</fixVersion>
                                    <component>Local/Startup and Shutdown</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="15134875" author="anubhavk" created="Fri, 5 Feb 2016 20:06:14 +0000"  >&lt;p&gt;This does not repro on latest bits. &lt;/p&gt;

&lt;p&gt;Also, listsnapshots does not list any system table snapshots by design:&lt;/p&gt;

&lt;p&gt;From StorageService.getSnapshotDetails&lt;/p&gt;

&lt;p&gt;for (Keyspace keyspace : Keyspace.all())&lt;br/&gt;
        {&lt;br/&gt;
            if (Schema.isSystemKeyspace(keyspace.getName()))&lt;br/&gt;
                continue;&lt;/p&gt;</comment>
                            <comment id="15134960" author="brandon.williams" created="Fri, 5 Feb 2016 20:53:04 +0000"  >&lt;p&gt;I think you&apos;re going to have to tell us how to reproduce or find the spot in the code that is doing the snapshot, because I don&apos;t see this behavior at all.&lt;/p&gt;</comment>
                            <comment id="15136275" author="fabrice.facorat" created="Sun, 7 Feb 2016 14:43:46 +0000"  >&lt;p&gt;OK, first to reproduce this you need to activate auto_snapshot in cassandra.yaml&lt;br/&gt;
&lt;a href=&quot;http://docs.datastax.com/en/cassandra/2.2/cassandra/configuration/configCassandra_yaml.html?scroll=configCassandra_yaml__auto_snapshot&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://docs.datastax.com/en/cassandra/2.2/cassandra/configuration/configCassandra_yaml.html?scroll=configCassandra_yaml__auto_snapshot&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Then if you look at CassandraDaemon.java, you will note that at startup it will discard compaction_in_progress: &lt;a href=&quot;https://github.com/apache/cassandra/blob/cassandra-2.2/src/java/org/apache/cassandra/service/CassandraDaemon.java#L220&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/cassandra/blob/cassandra-2.2/src/java/org/apache/cassandra/service/CassandraDaemon.java#L220&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;SystemKeyspace.discardCompactionsInProgress() means truncating the system.compactions_in_progress table: &lt;a href=&quot;https://github.com/apache/cassandra/blob/cassandra-2.2/src/java/org/apache/cassandra/db/SystemKeyspace.java#L402&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/cassandra/blob/cassandra-2.2/src/java/org/apache/cassandra/db/SystemKeyspace.java#L402&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;So you end up with a snaphot in data_dir/system/compactions_in_progress/, but you can&apos;t see it with &quot;nodetool listsnaphots&quot; which is filtering out system keyspaces. However as this is temporary files, there&apos;s no need to snapshot system.compactions_in_progress when doing a truncate on it IMHO.&lt;/p&gt;

&lt;p&gt;Please note that &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-7066&quot; title=&quot;Simplify (and unify) cleanup of compaction leftovers&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-7066&quot;&gt;&lt;del&gt;CASSANDRA-7066&lt;/del&gt;&lt;/a&gt; should fix this behavior in 3.0&lt;/p&gt;</comment>
                            <comment id="15262219" author="ifesdjeen" created="Thu, 28 Apr 2016 14:23:20 +0000"  >&lt;p&gt;This happens because &lt;tt&gt;SystemKeyspace::discardCompactionsInProgress&lt;/tt&gt; calls &lt;tt&gt;ColumnFamilyStore::truncateBlocking&lt;/tt&gt; on &lt;tt&gt;compactions_in_progress&lt;/tt&gt;.&lt;/p&gt;

&lt;p&gt;I&apos;ve prepared a patch that would skip snapshot creation for this particular case, as in the rest of cases we rely on &lt;tt&gt;auto_snapshot&lt;/tt&gt; property, and override it only here (btw, &lt;tt&gt;auto_snapshot&lt;/tt&gt; is &lt;tt&gt;true&lt;/tt&gt; by default).&lt;/p&gt;

&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/ifesdjeen/cassandra/tree/10962-2.2&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;2.2&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://cassci.datastax.com/view/Dev/view/ifesdjeen/job/ifesdjeen-10962-2.2-testall/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;utest&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://cassci.datastax.com/view/Dev/view/ifesdjeen/job/ifesdjeen-10962-2.2-dtest/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;dtest&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;
</comment>
                            <comment id="15267586" author="jkni" created="Mon, 2 May 2016 21:59:20 +0000"  >&lt;p&gt;CI looks good - logic in the patch looks good to me. It seems that the comment for {[truncateBlocking}} has the parameter descriptions switched; false means to skip the snapshot, and true means to take it. Another nit: the commit message would be more accurate as &quot;Avoid creating...&quot; as opposed to &quot;Avoid re-creating...&quot;.&lt;/p&gt;</comment>
                            <comment id="15270665" author="ifesdjeen" created="Wed, 4 May 2016 13:57:07 +0000"  >&lt;p&gt;true, my initial patch was to add &lt;tt&gt;skipSnapshot&lt;/tt&gt;, although logic there was getting tricky, so I simplified it. &lt;/p&gt;

&lt;p&gt;Just to give heads up, in 3.0+ this problem does not appear as &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=fabrice.facorat&quot; class=&quot;user-hover&quot; rel=&quot;fabrice.facorat&quot;&gt;fabrice.facorat&lt;/a&gt; mentioned due to &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-7066&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;7066&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;I&apos;ve checked the failing dtests locally, both are passing. With unit tests, it&apos;s same. Same with utests...&lt;/p&gt;


&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/ifesdjeen/cassandra/tree/10962-2.2&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;2.2&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://cassci.datastax.com/view/Dev/view/ifesdjeen/job/ifesdjeen-10962-2.2-testall/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;utest&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://cassci.datastax.com/view/Dev/view/ifesdjeen/job/ifesdjeen-10962-2.2-dtest/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;dtest&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;
</comment>
                            <comment id="15271088" author="jkni" created="Wed, 4 May 2016 17:58:32 +0000"  >&lt;p&gt;+1, LGTM. CI is clean relative to upstream.&lt;/p&gt;

&lt;p&gt;As &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ifesdjeen&quot; class=&quot;user-hover&quot; rel=&quot;ifesdjeen&quot;&gt;ifesdjeen&lt;/a&gt; noted, this should only go to 2.2, since the related subsystem was rewritten in 3.0.&lt;/p&gt;</comment>
                            <comment id="15273193" author="jmckenzie" created="Thu, 5 May 2016 22:05:32 +0000"  >&lt;p&gt;&lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=cassandra.git;a=commit;h=5a923f65c2c02d08b687874dc8ac45d2d032b811&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;Committed&lt;/a&gt;.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[ifesdjeen]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 28 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2qr4v:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12311421" key="com.atlassian.jira.plugin.system.customfieldtypes:multiversion">
                        <customfieldname>Reproduced In</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="12327164">2.0.10</customfieldvalue>
    <customfieldvalue id="12333872">2.1.12</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>jkni</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[jkni]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12961"><![CDATA[Low]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12311420" key="com.atlassian.jira.plugin.system.customfieldtypes:version">
                        <customfieldname>Since Version</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="12324629">2.0.0</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>