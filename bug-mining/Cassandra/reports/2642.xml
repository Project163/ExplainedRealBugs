<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 22:43:13 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-6791] CompressedSequentialWriter can write zero-length segments during scrub</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-6791</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;This results in errors like this:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;java.lang.IllegalArgumentException
	at java.nio.Buffer.limit(Buffer.java:267)
	at org.apache.cassandra.io.compress.CompressedRandomAccessReader.decompressChunk(CompressedRandomAccessReader.java:108)
	at org.apache.cassandra.io.compress.CompressedRandomAccessReader.reBuffer(CompressedRandomAccessReader.java:87)
	at org.apache.cassandra.io.util.RandomAccessReader.seek(RandomAccessReader.java:280)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;(Because a zero-length chunk actually turns into a length of -4 in the &lt;tt&gt;compressed.limit(chunk.length)&lt;/tt&gt; call, since no checksum is written either.)&lt;/p&gt;

&lt;p&gt;I thought this would be from two bad rows in a row, but it&apos;s not; the source file that resulted in scrub creating this, did not have any of those.  (But it does have several instances of bad-good-bad, i.e. separated by exactly one row, that is not large enough to force a new compressed chunk.)&lt;/p&gt;</description>
                <environment></environment>
        <key id="12698154">CASSANDRA-6791</key>
            <summary>CompressedSequentialWriter can write zero-length segments during scrub</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10003" iconUrl="https://issues.apache.org/jira/images/icons/priorities/trivial.svg">Low</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="kvaster">Viktor Kuzmin</assignee>
                                    <reporter username="jbellis">Jonathan Ellis</reporter>
                        <labels>
                    </labels>
                <created>Sun, 2 Mar 2014 02:18:20 +0000</created>
                <updated>Tue, 16 Apr 2019 09:31:52 +0000</updated>
                            <resolved>Mon, 3 Mar 2014 13:31:00 +0000</resolved>
                                        <fixVersion>1.2.16</fixVersion>
                    <fixVersion>2.0.6</fixVersion>
                    <fixVersion>2.1 beta2</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="13917269" author="jbellis" created="Sun, 2 Mar 2014 02:18:33 +0000"  >&lt;p&gt;Brandon has a copy of the data that can reproduce this, via &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=kvaster&quot; class=&quot;user-hover&quot; rel=&quot;kvaster&quot;&gt;kvaster&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="13917270" author="jbellis" created="Sun, 2 Mar 2014 02:18:59 +0000"  >&lt;p&gt;In the meantime, one workaround is disabling compression on the source CF.  (Remember that if no options are specified, compression is on by default in 1.1+.)&lt;/p&gt;</comment>
                            <comment id="13917863" author="kvaster" created="Mon, 3 Mar 2014 09:14:47 +0000"  >&lt;p&gt;Metadata info is truncated in wrong way. Attached patch.&lt;/p&gt;</comment>
                            <comment id="13917866" author="kvaster" created="Mon, 3 Mar 2014 09:16:44 +0000"  >&lt;p&gt;Metadta info is tuncated in wrong way.&lt;/p&gt;

&lt;p&gt;Here goes patch:&lt;/p&gt;

&lt;p&gt;diff -r 452d640f07c0 src/java/org/apache/cassandra/io/compress/CompressedSequentialWriter.java&lt;br/&gt;
&amp;#8212; a/src/java/org/apache/cassandra/io/compress/CompressedSequentialWriter.java Mon Mar 03 12:11:44 2014 +0300&lt;br/&gt;
+++ b/src/java/org/apache/cassandra/io/compress/CompressedSequentialWriter.java Mon Mar 03 12:13:18 2014 +0300&lt;br/&gt;
@@ -231,7 +231,7 @@&lt;/p&gt;

&lt;p&gt;         // truncate data and index file&lt;br/&gt;
         truncate(chunkOffset);&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;metadataWriter.resetAndTruncate(realMark.nextChunkIndex);&lt;br/&gt;
+        metadataWriter.resetAndTruncate(realMark.nextChunkIndex - 1);&lt;br/&gt;
     }&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;     /**&lt;/p&gt;</comment>
                            <comment id="13918046" author="krummas" created="Mon, 3 Mar 2014 13:31:00 +0000"  >&lt;p&gt;committed with a unit test&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[kvaster]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>376623</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            11 years, 38 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1swdj:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>376918</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12311421" key="com.atlassian.jira.plugin.system.customfieldtypes:multiversion">
                        <customfieldname>Reproduced In</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="12325761">2.0.5</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>marcuse</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[marcuse]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12961"><![CDATA[Low]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>