<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 22:38:07 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-5474] failure when passing null parameter to prepared statement</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-5474</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;I have a failure when passing a null parameter to the prepared statement bellow when going through the cql 3 bin protocol:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;Exec: CREATE KEYSPACE Tests WITH replication = {&lt;span class=&quot;code-quote&quot;&gt;&apos;class&apos;&lt;/span&gt;: &lt;span class=&quot;code-quote&quot;&gt;&apos;SimpleStrategy&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;replication_factor&apos;&lt;/span&gt; : 1}

Exec: CREATE TABLE Tests.AllTypes (a &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;, b &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;, primary key (a))

Prepare: insert into Tests.AllTypes (a, b) values (?, ?)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Passing a=1 and b=null cause the following error:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;DEBUG 23:07:23,315 Responding: RESULT PREPARED 59b3d6baed67d5c0a3ced29ebb4277c5 [a(tests, alltypes), org.apache.cassandra.db.marshal.Int32Type][b(tests, alltypes), org.apache.cassandra.db.marshal.Int32Type]
DEBUG 23:07:23,292 Compaction buckets are []
DEBUG 23:07:23,336 Received: EXECUTE 59b3d6baed67d5c0a3ced29ebb4277c5 with 2 values at consistency QUORUM
ERROR 23:07:23,338 Unexpected exception during request
java.lang.NullPointerException
        at org.apache.cassandra.db.marshal.Int32Type.validate(Int32Type.java:95)
        at org.apache.cassandra.cql3.Constants$Marker.bindAndGet(Constants.java:257)
        at org.apache.cassandra.cql3.Constants$Setter.execute(Constants.java:282)
        at org.apache.cassandra.cql3.statements.UpdateStatement.mutationForKey(UpdateStatement.java:250)
        at org.apache.cassandra.cql3.statements.UpdateStatement.getMutations(UpdateStatement.java:133)
        at org.apache.cassandra.cql3.statements.ModificationStatement.execute(ModificationStatement.java:92)
        at org.apache.cassandra.cql3.QueryProcessor.processStatement(QueryProcessor.java:132)
        at org.apache.cassandra.cql3.QueryProcessor.processPrepared(QueryProcessor.java:254)
        at org.apache.cassandra.transport.messages.ExecuteMessage.execute(ExecuteMessage.java:122)
        at org.apache.cassandra.transport.Message$Dispatcher.messageReceived(Message.java:287)
        at org.jboss.netty.channel.SimpleChannelUpstreamHandler.handleUpstream(SimpleChannelUpstreamHandler.java:75)
        at org.jboss.netty.channel.DefaultChannelPipeline.sendUpstream(DefaultChannelPipeline.java:565)
        at org.jboss.netty.channel.DefaultChannelPipeline$DefaultChannelHandlerContext.sendUpstream(DefaultChannelPipeline.java:793)
        at org.jboss.netty.handler.execution.ChannelUpstreamEventRunnable.doRun(ChannelUpstreamEventRunnable.java:45)
        at org.jboss.netty.handler.execution.ChannelEventRunnable.run(ChannelEventRunnable.java:69)
        at java.util.concurrent.ThreadPoolExecutor.runWorker(Unknown Source)
        at java.util.concurrent.ThreadPoolExecutor$Worker.run(Unknown Source)
        at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(Unknown Source)
DEBUG 23:07:23,337 No tasks available
DEBUG 23:07:23,341 request complete
DEBUG 23:07:23,343 Responding: ERROR SERVER_ERROR: java.lang.NullPointerException
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;When serializing value for b, a bytes array of len -1 is transmitted (accordingly to the spec):&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;[bytes] A [&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;] n, followed by n bytes &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; n &amp;gt;= 0. If n &amp;lt; 0,
        no &lt;span class=&quot;code-object&quot;&gt;byte&lt;/span&gt; should follow and the value represented is `&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;`.
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-5081&quot; title=&quot;Support null values in PreparedStatements parameters&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-5081&quot;&gt;&lt;del&gt;CASSANDRA-5081&lt;/del&gt;&lt;/a&gt; added support for null params. Am I doing something wrong there ? Thanks.&lt;/p&gt;</description>
                <environment>&lt;p&gt;windows 8 x64, 1.7.0_11-b21 x64&lt;/p&gt;</environment>
        <key id="12642615">CASSANDRA-5474</key>
            <summary>failure when passing null parameter to prepared statement</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10002" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Normal</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="6">Invalid</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="pchalamet">Pierre Chalamet</reporter>
                        <labels>
                    </labels>
                <created>Mon, 15 Apr 2013 21:19:07 +0000</created>
                <updated>Tue, 16 Apr 2019 09:32:14 +0000</updated>
                            <resolved>Tue, 16 Apr 2013 01:24:05 +0000</resolved>
                                                            <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="13632466" author="iamaleksey" created="Tue, 16 Apr 2013 01:24:05 +0000"  >&lt;p&gt;You are doing something wrong.&lt;br/&gt;
Just tested the same scenario and was able to insert null successfully (also binary protocol). And my client serializes null as signed int32 -1 &lt;span class=&quot;error&quot;&gt;&amp;#91;0xff,0xff,0xff,0xff&amp;#93;&lt;/span&gt;. You probably got your null-serialization code wrong.&lt;/p&gt;</comment>
                            <comment id="13632636" author="pchalamet" created="Tue, 16 Apr 2013 07:08:20 +0000"  >&lt;p&gt;Really not sure.&lt;/p&gt;

&lt;p&gt;Here is the frame I&apos;m sending, and this fails.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-comment&quot;&gt;// header
&lt;/span&gt;1, 0, 125, 10

&lt;span class=&quot;code-comment&quot;&gt;// len
&lt;/span&gt;0, 0, 0, 34

&lt;span class=&quot;code-comment&quot;&gt;// body
&lt;/span&gt;
&lt;span class=&quot;code-comment&quot;&gt;// requestId
&lt;/span&gt;0, 16, 
89, 179, 214, 186, 237, 103, 213, 192, 163, 206, 210, 158, 187, 66, 119, 197

&lt;span class=&quot;code-comment&quot;&gt;// nb columns
&lt;/span&gt;0, 2, 

&lt;span class=&quot;code-comment&quot;&gt;// a = 1
&lt;/span&gt;0, 0, 0, 4
0, 0, 0, 1

&lt;span class=&quot;code-comment&quot;&gt;// b = &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;
&lt;/span&gt;255, 255, 255, 255

&lt;span class=&quot;code-comment&quot;&gt;// CL
&lt;/span&gt;0, 4
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="13632867" author="iamaleksey" created="Tue, 16 Apr 2013 14:26:36 +0000"  >&lt;p&gt;Interesting. The frame indeed looks correct, and an analogous one seems to work all right for me (1.2.4 and latest cassandra-1.2 branch both).&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;&amp;lt;&amp;lt;1,0,0,10,
  0,0,0,34,
  0,16,228,43,12,34,120,160,113,48,251,103,244,149,202,119,0,103,
  0,2,
  0,0,0,4,0,0,0,1,
  255,255,255,255,
  0,4&amp;gt;&amp;gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Frame id and query id are different, but other than that the two frames are identical.&lt;/p&gt;</comment>
                            <comment id="13632878" author="iamaleksey" created="Tue, 16 Apr 2013 14:34:12 +0000"  >&lt;p&gt;Judging by your stack trace, you don&apos;t really have 1.2.4, or so it seems. I suggest you check out cassandra-1.2.4 tag or pull the latest cassandra-1.2 branch and build it yourself, then see if you still have the issue (you shouldn&apos;t).&lt;/p&gt;</comment>
                            <comment id="13633406" author="pchalamet" created="Tue, 16 Apr 2013 21:40:04 +0000"  >&lt;p&gt;You are totally right. Seems I did a huge mistake after applying patch &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-5468&quot; title=&quot;Prepared statements from default keyspace are broken&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-5468&quot;&gt;&lt;del&gt;CASSANDRA-5468&lt;/del&gt;&lt;/a&gt;. Copied the wrong jar &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/sad.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;br/&gt;
Thanks for your patience!&lt;/p&gt;</comment>
                            <comment id="13633413" author="iamaleksey" created="Tue, 16 Apr 2013 21:44:33 +0000"  >&lt;p&gt;That happens. Thanks for opening the issue anyway (and for &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-5468&quot; title=&quot;Prepared statements from default keyspace are broken&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-5468&quot;&gt;&lt;del&gt;CASSANDRA-5468&lt;/del&gt;&lt;/a&gt;, too).&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>323029</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            12 years, 32 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1jqen:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>323374</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12962"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>