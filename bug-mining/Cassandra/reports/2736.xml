<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 22:44:04 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-6912] SSTableReader.isReplaced does not allow for safe resource cleanup</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-6912</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;There are a number of possible race conditions on resource cleanup from the use of cloneWithNewSummarySamplingLevel, because the replacement sstable can be itself replaced/obsoleted while the prior sstable is still referenced (this is actually quite easy with compaction, but can happen in other circumstances less commonly).&lt;/p&gt;</description>
                <environment></environment>
        <key id="12703162">CASSANDRA-6912</key>
            <summary>SSTableReader.isReplaced does not allow for safe resource cleanup</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10002" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Normal</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="benedict">Benedict Elliott Smith</assignee>
                                    <reporter username="benedict">Benedict Elliott Smith</reporter>
                        <labels>
                    </labels>
                <created>Mon, 24 Mar 2014 09:49:14 +0000</created>
                <updated>Tue, 16 Apr 2019 09:31:50 +0000</updated>
                            <resolved>Fri, 4 Apr 2014 20:40:48 +0000</resolved>
                                        <fixVersion>2.1 beta2</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                                                                <comments>
                            <comment id="13944873" author="benedict" created="Mon, 24 Mar 2014 09:51:09 +0000"  >&lt;p&gt;Patch available &lt;a href=&quot;https://github.com/belliottsmith/cassandra/tree/6912-fix.sstablereader.cloneWith&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;here&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Also fixes size maintenance in DataTracker, which was almost certainly not actually accounting for the reduction in disk utilisation, as the calculation looks at the files on disk which have been replaced by then.&lt;/p&gt;</comment>
                            <comment id="13947921" author="jbellis" created="Wed, 26 Mar 2014 13:54:52 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=thobbs&quot; class=&quot;user-hover&quot; rel=&quot;thobbs&quot;&gt;thobbs&lt;/a&gt;] to review&lt;/p&gt;</comment>
                            <comment id="13955236" author="jbellis" created="Mon, 31 Mar 2014 14:43:20 +0000"  >&lt;p&gt;Can you summarize the changes in SSTR?&lt;/p&gt;</comment>
                            <comment id="13955313" author="benedict" created="Mon, 31 Mar 2014 15:44:52 +0000"  >&lt;p&gt;Sure: basically instead of a boolean isReplaced flag, we build a linked-list chain of replacement, which we synchronise using a shared object to make maintenance of the list across multiple threads simple. Then on close we check if any of the closeable resources differ between any chains either side of us, and any that are in neither of the adjacent links (if any) are closed. It&apos;s worth pointing out that as of this patch only one of those resources can possibly differ, but I think it is more correct to test all of them even knowing this, since it is not expensive and is future proof. Once we&apos;ve made this decision we remove ourselves from the linked list, so that anybody behind/ahead will compare against only other still opened resources.&lt;/p&gt;

&lt;p&gt;I&apos;ve also folded the close() and releaseReferences() tidying up into one tidy() method with a boolean flag for the kind of release we&apos;re doing, as this seemed more explicit to me.&lt;/p&gt;</comment>
                            <comment id="13957076" author="thobbs" created="Tue, 1 Apr 2014 22:16:18 +0000"  >&lt;p&gt;Overall this looks good.  The only part I&apos;m not sure about is running the SSTableDeletingTask and deleting the data/index files directly in tidy().  Instead of calling deletingTask.run() directly, deletingTask.schedule() should be used to properly handle failures.  I believe there&apos;s a similar problem with calling deleteWithConfirm() directly on the files; see the comment near the top of SSTableDeletingTask.&lt;/p&gt;

&lt;p&gt;Adding a comment to tidy() with your summary would also be good.&lt;/p&gt;</comment>
                            <comment id="13957094" author="benedict" created="Tue, 1 Apr 2014 22:28:07 +0000"  >&lt;p&gt;Dagnabit. Good catch - I originally had this bundled up with two other patches, and in separating them I was apparently not as careful as I had thought. The whole of tidy() was scheduled, and I thought I didn&apos;t need that after I extracted this (for reasons I won&apos;t get into). I&apos;ll reintroduce it.&lt;/p&gt;</comment>
                            <comment id="13957521" author="benedict" created="Wed, 2 Apr 2014 10:26:54 +0000"  >&lt;p&gt;I simply modified the deleting task back to schedule and dropped the deleteFile test, as this is really not necessary with this patch - I&apos;ll reintroduce it in &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-6916&quot; title=&quot;Preemptive opening of compaction result&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-6916&quot;&gt;&lt;del&gt;CASSANDRA-6916&lt;/del&gt;&lt;/a&gt;, and possibly make &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-6916&quot; title=&quot;Preemptive opening of compaction result&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-6916&quot;&gt;&lt;del&gt;CASSANDRA-6916&lt;/del&gt;&lt;/a&gt; depend on &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-6919&quot; title=&quot;Use OpOrder to guard sstable references for reads, instead of acquiring/releasing references&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-6919&quot;&gt;&lt;del&gt;CASSANDRA-6919&lt;/del&gt;&lt;/a&gt; (which is the reason for moving all of these tasks into a scheduled operation). Possibly I&apos;ll then flatten the SSTableDeletingTask and this scheduled tidying up into one concept.&lt;/p&gt;

&lt;p&gt;The repository has been updated&lt;/p&gt;</comment>
                            <comment id="13960397" author="thobbs" created="Fri, 4 Apr 2014 20:40:48 +0000"  >&lt;p&gt;+1, committed.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310050">
                    <name>Regression</name>
                                            <outwardlinks description="breaks">
                                        <issuelink>
            <issuekey id="12707210">CASSANDRA-7000</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                            <issuelinktype id="10001">
                    <name>dependent</name>
                                                                <inwardlinks description="is depended upon by">
                                        <issuelink>
            <issuekey id="12703231">CASSANDRA-6916</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12703293">CASSANDRA-6919</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[benedict]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>381500</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            11 years, 33 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1tq8n:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>381775</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>thobbs</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[thobbs]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12962"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12311420" key="com.atlassian.jira.plugin.system.customfieldtypes:version">
                        <customfieldname>Since Version</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="12326275">2.1 beta1</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>