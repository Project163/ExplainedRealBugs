<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 22:43:14 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-6777] 2.1 w/java-driver 2.0 and stress write using thrift results in ArithmeticException / by zero errors</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-6777</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;Running stress write (thrift) on 2.1 branch is resulting in the following.&lt;/p&gt;

&lt;p&gt;Note: this is after working around &lt;a href=&quot;https://datastax-oss.atlassian.net/browse/JAVA-276&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;JAVA-276&lt;/a&gt; causing stress to fail to connect to 2.1.&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;$ ./tools/bin/cassandra-stress write n=5000000

Unable to create stress keyspace: Keyspace names must be case-insensitively unique (&quot;Keyspace1&quot; conflicts with &quot;Keyspace1&quot;)
Warming up WRITE with 50000 iterations...
Connected to cluster: Test Cluster
Datatacenter: datacenter1; Host: localhost/127.0.0.1; Rack: rack1
java.lang.ArithmeticException: / by zero
java.lang.ArithmeticException: / by zero
java.lang.ArithmeticException: / by zero
java.lang.ArithmeticException: / by zero
...
java.lang.Arithmjava.io.IOException: Operation [220] x10 key 00000000DD Error executing: (ArithmeticException): / by zero
eticException: / by zero

java.lang.ArithmeticException: / by zero
	at org.apache.cassandra.stress.Operation.error(Operation.java:237)
java.lang.ArithmeticException: / by zero	at org.apache.cassandra.stress.Operation.timeWithRetry(Operation.java:216)

	at org.apache.cassandra.stress.operations.ThriftInserter.run(ThriftInserter.java:72)
	at org.apache.cassandra.stress.StressAction$Consumer.run(StressAction.java:302)java.lang.ArithmeticException: / by zero

java.lang.ArithmeticException: / by zero
java.io.IOException: Operation [200] x10 key 00000000C9 Error executing: (ArithmeticException): / by zero

	at org.apache.cassandra.stress.Operation.error(Operation.java:237)
java.lang.ArithmeticException: / by zero	at org.apache.cassandra.stress.Operation.timeWithRetry(Operation.java:216)

java.lang.ArithmeticException: / by zero	at org.apache.cassandra.stress.operations.ThriftInserter.run(ThriftInserter.java:72)

	at org.apache.cassandra.stress.StressAction$Consumer.run(StressAction.java:302)
...
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Seems to be just a thrift issue, as running stress write using the native protocol works:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;$ ./tools/bin/cassandra-stress write n=5000000 -mode native cql3

Unable to create stress keyspace: Keyspace names must be case-insensitively unique (&quot;Keyspace1&quot; conflicts with &quot;Keyspace1&quot;)
Warming up WRITE with 50000 iterations...
Connected to cluster: Test Cluster
Datatacenter: datacenter1; Host: localhost/127.0.0.1; Rack: rack1
Sleeping 2s...
Running WRITE with 50 threads  for 5000000 iterations
ops       ,    op/s,adj op/s,   key/s,    mean,     med,     .95,     .99,    .999,     max,   time,   stderr
29342     ,   29340,   30903,   29340,     1.7,     1.4,     3.1,     5.7,    51.5,    54.4,    1.0,  0.00000
56353     ,   26968,   28523,   26968,     1.8,     1.5,     3.6,     7.0,    56.5,    57.2,    2.0,  0.00000
...
5000000   ,   29358,   29358,   29358,     1.7,     1.3,     3.6,     8.4,    10.1,    11.6,  168.8,  0.00828


Results:
real op rate              : 29620
adjusted op rate          : 29629
adjusted op rate stderr   : 0
key rate                  : 29620
latency mean              : 1.7
latency median            : 1.4
latency 95th percentile   : 3.0
latency 99th percentile   : 5.4
latency 99.9th percentile : 56.5
latency max               : 305.7
Total operation time      : 00:02:48
END

&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Attaching stress write and system logs as well.&lt;/p&gt;</description>
                <environment>&lt;p&gt;Mac OSX, java 1.7.0_51&lt;/p&gt;</environment>
        <key id="12697588">CASSANDRA-6777</key>
            <summary>2.1 w/java-driver 2.0 and stress write using thrift results in ArithmeticException / by zero errors</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10003" iconUrl="https://issues.apache.org/jira/images/icons/priorities/trivial.svg">Low</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="djatnieks">dan jatnieks</assignee>
                                    <reporter username="djatnieks">dan jatnieks</reporter>
                        <labels>
                            <label>stress</label>
                    </labels>
                <created>Thu, 27 Feb 2014 03:43:21 +0000</created>
                <updated>Tue, 16 Apr 2019 09:31:52 +0000</updated>
                            <resolved>Tue, 4 Mar 2014 11:10:33 +0000</resolved>
                                        <fixVersion>2.1 rc2</fixVersion>
                                    <component>Legacy/Tools</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="13914083" author="djatnieks" created="Thu, 27 Feb 2014 05:08:36 +0000"  >&lt;p&gt;Ah. To get around JAVA-276, I had dropped in a modified java driver that could parse the Cassandra version &quot;2.1.0-beta1-SNAPSHOT&quot;. However doing that on the head of the java driver 2.0 branch is somehow causing these ArithmeticException / by zero errors. &lt;/p&gt;

&lt;p&gt;Restoring the &lt;tt&gt;cassandra-driver-core-2.0.0-rc3-SNAPSHOT.jar&lt;/tt&gt; in tools/lib and instead building C* with &lt;tt&gt;ant -Dbase.version=2.1.0&lt;/tt&gt; works around JAVA-276 and doesn&apos;t cause any problems for stress.&lt;/p&gt;

&lt;p&gt;So closing this issue as it seems to be caused by java-driver.&lt;/p&gt;</comment>
                            <comment id="13914117" author="djatnieks" created="Thu, 27 Feb 2014 06:04:31 +0000"  >&lt;p&gt;A recent change to java-driver (revision f6a179d, for &lt;a href=&quot;https://datastax-oss.atlassian.net/browse/JAVA-269&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;JAVA-269&lt;/a&gt;) caused this.&lt;/p&gt;

&lt;p&gt;In stress, &lt;tt&gt;SmartThriftClient#get()&lt;/tt&gt; gets a set of hosts by calling &lt;tt&gt;metadata.getReplicas(keyspace, pk)&lt;/tt&gt;.&lt;/p&gt;

&lt;p&gt;However, in java-driver, &lt;tt&gt;Metadata#getReplicas&lt;/tt&gt; has changed and now calls &lt;tt&gt;handleId(keyspace)&lt;/tt&gt; which essentially forces values to lowercase unless they are quoted.&lt;/p&gt;

&lt;p&gt;This likely means the caller of &lt;tt&gt;Metadata#getReplicas&lt;/tt&gt; is responsible to first quote case-sensitive keyspace names, such as the default &quot;Keyspace1&quot; used by stress, e.g. &lt;tt&gt;metadata.getReplicas(metadata.quote(keyspace), pk)&lt;/tt&gt;&lt;/p&gt;</comment>
                            <comment id="13914122" author="djatnieks" created="Thu, 27 Feb 2014 06:21:02 +0000"  >&lt;p&gt;Re-opening as there does appear to be something to fix in stress to make it work with java-driver 2.0.&lt;/p&gt;

&lt;p&gt;At the moment the 2.1 branch is using &lt;tt&gt;cassandra-driver-core-2.0.0-rc3&lt;/tt&gt; but I think when this is updated to the release version of 2.0 this error will occur.&lt;/p&gt;

&lt;p&gt;See my previous comment for the proposed stress fix to quote the keyspace name when calling java-driver &lt;tt&gt;Metadata#getReplicas&lt;/tt&gt;.&lt;/p&gt;</comment>
                            <comment id="13915193" author="djatnieks" created="Thu, 27 Feb 2014 23:23:15 +0000"  >&lt;p&gt;Attaching patch that should work with released version of java-driver 2.0.&lt;/p&gt;

&lt;p&gt;Note: this also fixes a minor issue with using the &lt;tt&gt;&amp;#45;schema ks=&lt;/tt&gt; option.&lt;/p&gt;</comment>
                            <comment id="13919262" author="slebresne" created="Tue, 4 Mar 2014 11:10:33 +0000"  >&lt;p&gt;Patch lgtm, committed along with an update of the java driver jar from rc3 to 2.0 final.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                                                <inwardlinks description="is duplicated by">
                                        <issuelink>
            <issuekey id="12698045">CASSANDRA-6786</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12631620" name="Quote_keyspace_name.patch" size="2550" author="djatnieks" created="Thu, 27 Feb 2014 23:23:15 +0000"/>
                            <attachment id="12631447" name="logs.tar.gz" size="18193" author="djatnieks" created="Thu, 27 Feb 2014 03:43:21 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[djatnieks]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>376062</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            11 years, 38 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1ssxj:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>376358</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>slebresne</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[slebresne]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12961"><![CDATA[Low]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12311420" key="com.atlassian.jira.plugin.system.customfieldtypes:version">
                        <customfieldname>Since Version</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="12324159">2.1 rc3</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>