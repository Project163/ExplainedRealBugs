<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 23:03:28 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-11820] Altering a column&apos;s type causes EOF</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-11820</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;While working on &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-10309&quot; title=&quot;Avoid always looking up column type&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-10309&quot;&gt;CASSANDRA-10309&lt;/a&gt;, I was testing altering columns&apos; types. This series of operations fails:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;CREATE TABLE test (a &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; PRIMARY KEY, b &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;)
INSERT INTO test (a, b) VALUES (1, 1)
ALTER TABLE test ALTER b TYPE BLOB
SELECT * FROM test WHERE a = 1
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Tried this on 3.0 and trunk, both fail.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12970542">CASSANDRA-11820</key>
            <summary>Altering a column&apos;s type causes EOF</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10002" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Normal</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="slebresne">Sylvain Lebresne</assignee>
                                    <reporter username="carlyeks">Carl Yeksigian</reporter>
                        <labels>
                    </labels>
                <created>Tue, 17 May 2016 21:20:25 +0000</created>
                <updated>Wed, 15 Oct 2025 09:49:02 +0000</updated>
                            <resolved>Thu, 30 Jun 2016 09:32:22 +0000</resolved>
                                        <fixVersion>3.0.9</fixVersion>
                    <fixVersion>3.8</fixVersion>
                                    <component>Legacy/Local Write-Read Paths</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="15287603" author="thobbs" created="Tue, 17 May 2016 21:23:56 +0000"  >&lt;p&gt;I bet the problem is that we no longer store a length prefix for fixed-length types, so after converting to a blob, we try to read a non-length value as the length.&lt;/p&gt;

&lt;p&gt;I suppose we&apos;ll need to disallow converting fixed-length types to blobs.&lt;/p&gt;</comment>
                            <comment id="15288575" author="slebresne" created="Wed, 18 May 2016 07:50:50 +0000"  >&lt;p&gt;Let&apos;s double check it&apos;s the actual problem though before disallowing stuff blindly, because that kind of things is supposed to be handled (which doesn&apos;t mean it isn&apos;t broken, but I want to understand why). Also, disallowing things that previously weren&apos;t is strictly speaking a breaking change.&lt;/p&gt;

&lt;p&gt;I&apos;ll note however that the description is low in details: if this was done on a multi-node cluster without waiting for schema agreement between the &lt;tt&gt;ALTER&lt;/tt&gt; and the &lt;tt&gt;SELECT&lt;/tt&gt;, then yes, that could be the problem as the storage engine does assume you will wait for the schema change to be propagated before querying.&lt;/p&gt;</comment>
                            <comment id="15289120" author="carlyeks" created="Wed, 18 May 2016 15:06:47 +0000"  >&lt;p&gt;This was on a single-node cluster, so there was no schema agreement issue in the cluster.&lt;/p&gt;

&lt;p&gt;From &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-10309&quot; title=&quot;Avoid always looking up column type&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-10309&quot;&gt;CASSANDRA-10309&lt;/a&gt;, I know that the intention was for this to work, since that is what made it more complicated.&lt;/p&gt;</comment>
                            <comment id="15293538" author="jmckenzie" created="Fri, 20 May 2016 15:23:19 +0000"  >&lt;p&gt;What&apos;s the context of the EOF? Is the node left in a bad state into perpetuity from this operation or does it just cause problems w/the current session?&lt;/p&gt;</comment>
                            <comment id="15293810" author="carlyeks" created="Fri, 20 May 2016 17:37:57 +0000"  >&lt;p&gt;The EOF is because we are reading more data from the file than is there, since we interpret the data as part of the length (and start reading the next column). When I add another column, it will continue to read and not be able to interpret the next columns data (I get an ArrayOutOfBoundsException).&lt;/p&gt;

&lt;p&gt;After killing C*, it was in a bad state reading the mutation that was written to the commitlog, so I had to remove the data; if I had left it long enough to reclaim the commitlog, it could have restarted, even if we could not recover that data.&lt;/p&gt;</comment>
                            <comment id="15346152" author="slebresne" created="Thu, 23 Jun 2016 09:25:20 +0000"  >&lt;p&gt;Had a look. The reason this happen is that when deserializing from the sstable, we use the proper type, but create the deserialized cell using a &lt;tt&gt;ColumnDefinition&lt;/tt&gt; that has that old type, so when we re-serialize later for intra-node communication, the wrong type is used and it breaks during deserialization.&lt;/p&gt;

&lt;p&gt;The good news is, nothing is corrupted, it just fails during the processing of the query (and not even when reading the sstable).&lt;/p&gt;

&lt;p&gt;I&apos;ll wrote a patch to fix it, but it&apos;ll probably be only early next week as I have a few other stuffs I want to finish this week (I&apos;ll make sure this gets in 3.0.8/3.8 in any case).&lt;/p&gt;</comment>
                            <comment id="15351145" author="slebresne" created="Mon, 27 Jun 2016 14:31:13 +0000"  >&lt;p&gt;Attaching patch for this below. All it does is making sure we use the &quot;current&quot; version of a ColumnDefinition when serializing a cell. That said, I&apos;m not absolutely satisfied with this: while it&apos;s simple on principle, it&apos;s not all that easy to follow why the definition of the cell itself may not be up-to-date, and that make things probably a bit error prone (which, btw, is not particularly new to this patch).&lt;/p&gt;

&lt;p&gt;Not sure what is a better alternative though right now, we probably need a cleaner handling of metadata changes in general. But it&apos;s not worth leaving that bug in while we thing this through, so I suggest the patch below is good enough for now.&lt;/p&gt;

&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt; &lt;a href=&quot;https://github.com/pcmanus/cassandra/commits/11820-3.0&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;3.0&lt;/a&gt; &lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt; &lt;a href=&quot;http://cassci.datastax.com/job/pcmanus-11820-3.0-testall/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;utests&lt;/a&gt; &lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt; &lt;a href=&quot;http://cassci.datastax.com/job/pcmanus-11820-3.0-dtest/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;dtests&lt;/a&gt; &lt;/th&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;


&lt;p&gt;(I&apos;ll push a trunk branch on CI later, but waiting on making sure tests passes on 3.0 first. Besides, I think it&apos;ll merge cleanly)&lt;/p&gt;</comment>
                            <comment id="15353751" author="thobbs" created="Tue, 28 Jun 2016 21:35:41 +0000"  >&lt;p&gt;+1 on the patch in general, but it looks like &lt;tt&gt;createAlterKeyspaceTest&lt;/tt&gt; is sensitive to schema changes in other test methods, so adding a new test is causing it to fail.  Can you fix that as part of your changes and rerun the 3.0 unit tests?  Don&apos;t forget to run the trunk test suites as well.&lt;/p&gt;</comment>
                            <comment id="15356816" author="slebresne" created="Thu, 30 Jun 2016 09:32:22 +0000"  >&lt;p&gt;Fixed the test logic and re-ran CI on both 3.0 and 3.9 branch (skipped trunk because it&apos;s == to 3.9 at this point):&lt;/p&gt;

&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;a href=&quot;https://github.com/pcmanus/cassandra/commits/11820-3.0&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;11820-3.0&lt;/a&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;a href=&quot;http://cassci.datastax.com/job/pcmanus-11820-3.0-testall&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;utests&lt;/a&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;a href=&quot;http://cassci.datastax.com/job/pcmanus-11820-3.0-dtest&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;dtests&lt;/a&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;a href=&quot;https://github.com/pcmanus/cassandra/commits/11820-3.9&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;11820-3.9&lt;/a&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;a href=&quot;http://cassci.datastax.com/job/pcmanus-11820-3.9-testall&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;utests&lt;/a&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;a href=&quot;http://cassci.datastax.com/job/pcmanus-11820-3.9-dtest&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;dtests&lt;/a&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;


&lt;p&gt;Doesn&apos;t seem to have any failure related to the patch, so committed. Thanks.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10032">
                    <name>Blocker</name>
                                            <outwardlinks description="blocks">
                                        <issuelink>
            <issuekey id="12863537">CASSANDRA-10309</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12995269">CASSANDRA-12397</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[slebresne]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 20 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2y3wv:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>thobbs</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[thobbs]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12962"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>