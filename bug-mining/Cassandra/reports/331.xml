<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 22:13:08 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-952] DC Quorum broken @ trunk</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-952</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;Currently DCQuorum is broken in trunk, Suggesting the following fix... &lt;/p&gt;

&lt;p&gt;Write to DC&apos;s&lt;br/&gt;
1) Move determineBlockFor(int expandedTargets, ConsistencyLevel consistency_level) to AbstractEndpointSnitch&lt;br/&gt;
2) Add the same to support DC Quorum in DatacenterShardStategy&lt;/p&gt;

&lt;p&gt;Read to DC&apos;s&lt;br/&gt;
1) find suitable nodes was a list which was returning a list of local DC&apos;s earlier but now it is just one node and MD is been sent by other nodes. Need to have an option to even avoid MD from other DC&apos;s?&lt;/p&gt;</description>
                <environment>&lt;p&gt;Linux, Cassandra&lt;/p&gt;</environment>
        <key id="12461108">CASSANDRA-952</key>
            <summary>DC Quorum broken @ trunk</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10003" iconUrl="https://issues.apache.org/jira/images/icons/priorities/trivial.svg">Low</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="vijay2win@yahoo.com">Vijay</assignee>
                                    <reporter username="vijay2win@yahoo.com">Vijay</reporter>
                        <labels>
                    </labels>
                <created>Sun, 4 Apr 2010 05:43:18 +0000</created>
                <updated>Tue, 16 Apr 2019 09:33:25 +0000</updated>
                            <resolved>Tue, 18 May 2010 17:16:21 +0000</resolved>
                                        <fixVersion>0.7 beta 1</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="12854010" author="jbellis" created="Tue, 6 Apr 2010 14:47:30 +0000"  >&lt;p&gt;The fundamental problem here is that an int count of replicas to block for is not sufficient to represent the DC strategy wants: we want to SEND to all replicas, but only count replicas in the CURRENT DC towards success.  Allowing other DC replicas will mostly work, since they will typically be slower to arrive than local ones, but if there are failure conditions locally then it could succeed where it should not, which would violate its contract to readers.&lt;/p&gt;

&lt;p&gt;I think you will need to push the concept of what to block for into the WriteResponseHandler, and similarly for reads.&lt;/p&gt;
</comment>
                            <comment id="12855276" author="vijay2win@yahoo.com" created="Fri, 9 Apr 2010 05:31:17 +0000"  >&lt;p&gt;Made Changes as suggested&lt;/p&gt;</comment>
                            <comment id="12861491" author="jbellis" created="Tue, 27 Apr 2010 18:49:13 +0000"  >&lt;p&gt;Finally ready to get this in (now that &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-994&quot; title=&quot;re-organize endpointsnitch implementations&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-994&quot;&gt;&lt;del&gt;CASSANDRA-994&lt;/del&gt;&lt;/a&gt; is done).  Can you rebase?  Sorry, it&apos;s going to be a bit messy.&lt;/p&gt;</comment>
                            <comment id="12861690" author="vijay2win@yahoo.com" created="Wed, 28 Apr 2010 06:31:20 +0000"  >&lt;p&gt;this patch works in my environment, and i think we need couple of methods to be added to RackInferringSnitch which is getReplicationFactor and getDatacenters to make it work with the DCSS. Let me know if you dont agree with the changes, i have renamed the DCEPS to XMLFileSnitch. there is a lot of changes in these classes.... &lt;/p&gt;</comment>
                            <comment id="12861806" author="jbellis" created="Wed, 28 Apr 2010 13:50:14 +0000"  >&lt;p&gt;We&apos;re not adding DCEPS/XMLFileSnitch back, and we shouldn&apos;t need to make any changes to the Snitch classes.  It should be able to run against any RackAwareSnitch, since it gets the per-DC settings from DCSS/datacenters.properties now.&lt;/p&gt;</comment>
                            <comment id="12862280" author="vijay2win@yahoo.com" created="Thu, 29 Apr 2010 17:42:55 +0000"  >&lt;p&gt;Attached is the modified version, please note that XMLFileSnitch included in this patch, uses a different logic than PFS to read the hosts, if you choose not to include that thats fine too.&lt;/p&gt;</comment>
                            <comment id="12862750" author="jbellis" created="Fri, 30 Apr 2010 17:11:07 +0000"  >&lt;p&gt;It looks like this is mixing code from &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-967&quot; title=&quot;Implement Read Repair on Range Queries&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-967&quot;&gt;CASSANDRA-967&lt;/a&gt; in.  Let&apos;s do these one at a time, or we&apos;re more likely to introduce bugs.&lt;/p&gt;</comment>
                            <comment id="12863053" author="vijay2win@yahoo.com" created="Sat, 1 May 2010 20:55:15 +0000"  >&lt;p&gt;I have attached the changes, Please note that we have to change a bit of logic in rangeslice in order to remove blockFor for from the SP, IF you think it is unnecessary, i put blockFor for now and add a depreciated annotation on it (by doing this i can leave the rangeslice untouched).&lt;/p&gt;</comment>
                            <comment id="12866753" author="jbellis" created="Wed, 12 May 2010 21:55:13 +0000"  >&lt;p&gt;patch 01 cleans out callback purging from WriteResponseHandler (leaving ExpiringMap to clean it out automatically).&lt;/p&gt;

&lt;p&gt;02 adds the dcquorum changes, extracting AbstractWRH so the DQSyncRH doesn&apos;t have to subclass WRH which is a poor fit, and cleans up the WRH heirarchy.&lt;/p&gt;</comment>
                            <comment id="12867174" author="jeromatron" created="Thu, 13 May 2010 16:49:37 +0000"  >&lt;p&gt;Reviewing part of it and I know this wasn&apos;t part of the change - but in RackAwareStrategy couldn&apos;t we save some instruction execution by moving the check for whether we already have found another datacenter/rack outside of the checks?  Like so:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;Token t = iter.next();

&lt;span class=&quot;code-comment&quot;&gt;// First &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; to find one in a different data center
&lt;/span&gt;&lt;span class=&quot;code-comment&quot;&gt;// If we have already found something in a diff datacenter no need to find another
&lt;/span&gt;&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (!bDataCenter)
{
    &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (!snitch.getDatacenter(metadata.getEndpoint(primaryToken)).equals(snitch.getDatacenter(metadata.getEndpoint(t))))
    {
        endpoints.add(metadata.getEndpoint(t));
        bDataCenter = &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;;
        &lt;span class=&quot;code-keyword&quot;&gt;continue&lt;/span&gt;;
    }
}

&lt;span class=&quot;code-comment&quot;&gt;// Now  &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; to find one on a different rack
&lt;/span&gt;&lt;span class=&quot;code-comment&quot;&gt;// If we have already found something in a diff rack no need to find another
&lt;/span&gt;&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (!bOtherRack)
{
    &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (!snitch.getRack(metadata.getEndpoint(primaryToken)).equals(snitch.getRack(metadata.getEndpoint(t))) &amp;amp;&amp;amp;
        snitch.getDatacenter(metadata.getEndpoint(primaryToken)).equals(snitch.getDatacenter(metadata.getEndpoint(t))))
    {
        endpoints.add(metadata.getEndpoint(t));
        bOtherRack = &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;;
        &lt;span class=&quot;code-keyword&quot;&gt;continue&lt;/span&gt;;
    }
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;not that big of a deal, but since it&apos;s done on every write, might be helpful.  Maybe I&apos;m missing something there though...&lt;/p&gt;</comment>
                            <comment id="12867177" author="vijay2win@yahoo.com" created="Thu, 13 May 2010 17:01:23 +0000"  >&lt;p&gt;Jeremy, Thanks... different datacenter is physically a different rack.... I dont think we need additional check for that....&lt;/p&gt;</comment>
                            <comment id="12867191" author="jeromatron" created="Thu, 13 May 2010 17:36:40 +0000"  >&lt;p&gt;Vijay - okay - I wasn&apos;t thinking of doing an additional check, I was just thinking of bringing the check for bDatacenter and bOtherRack outside of the block they were in, in RackAwareStrategy.&lt;/p&gt;</comment>
                            <comment id="12867192" author="jeromatron" created="Thu, 13 May 2010 17:38:36 +0000"  >&lt;p&gt;Jonathan - in your 0002 patch, the DatacenterShardStrategy changes - you refactored forLoopReturn into endpoints.  I&apos;m not sure that you want to do that.  forLoopReturn is re-initialized on every loop iteration to include all of the replicas needed for that particular datacenter.  Endpoints includes all replicas regardless of datacenter.&lt;/p&gt;</comment>
                            <comment id="12867234" author="jeromatron" created="Thu, 13 May 2010 20:05:20 +0000"  >&lt;p&gt;Jonathan - Also it looks like you&apos;re doing the datacenter replication factor per keyspace now, which is what we&apos;re hoping to have for multi-tenants.  However, in StorageService, I was under the impression that the replication strategy is handled as though it was per keyspace but in reality it is a quasi singleton.  So all keyspaces will share the same RS of that type.  Is that not true now?  I didn&apos;t see any change to that in your patches.  Just wanted to make sure that doesn&apos;t cause odd problems - if all of the keyspaces are sharing the same DatacenterShardStrategy instance which is only meant for one of those keyspaces.&lt;/p&gt;</comment>
                            <comment id="12867601" author="vijay2win@yahoo.com" created="Fri, 14 May 2010 17:59:10 +0000"  >&lt;p&gt;Jeremy, &lt;br/&gt;
For 002 i am submitting the update for the patch... Thanks!&lt;br/&gt;
replication strategy - Yes currently thats the case, but DSS can handle all the required levels it will just forward the requests to AbstractReplicationStrategy if other than DCQuorum or DCQuorumSync.&lt;/p&gt;</comment>
                            <comment id="12867651" author="jeromatron" created="Fri, 14 May 2010 19:59:33 +0000"  >&lt;p&gt;Cool - yeah - looking at it again, DSS contains DC RF information for all keyspaces, so it really wouldn&apos;t matter if it was a singleton for all keyspaces.&lt;/p&gt;

&lt;p&gt;Btw, I was mostly just reviewing the getNaturalEndpointsInternal method of DSS - Jonathan had asked me to take a look at it in IRC.  Just so you know I wasn&apos;t reviewing the entire patch.  I don&apos;t know if that matters too much, but thought I would clarify.&lt;/p&gt;</comment>
                            <comment id="12867742" author="vijay2win@yahoo.com" created="Fri, 14 May 2010 23:55:24 +0000"  >&lt;p&gt;Attached is the fix and along with it i have a testcase, so we dont miss this in future.&lt;/p&gt;

&lt;p&gt;Thanks&lt;br/&gt;
Vijay&lt;/p&gt;</comment>
                            <comment id="12868237" author="jbellis" created="Mon, 17 May 2010 14:29:48 +0000"  >&lt;p&gt;v3 attached is the same as v2 w/ (unintentional?) breakages to TruncateResponseHandler reverted and formatting fixed.&lt;/p&gt;

&lt;p&gt;the new test needs to work with normal propertyfilesnitch, XMLFS is not going back in.&lt;/p&gt;</comment>
                            <comment id="12868342" author="vijay2win@yahoo.com" created="Mon, 17 May 2010 18:49:43 +0000"  >&lt;p&gt;Yes that was unintentional... This has updates to the test and also fix to the PEPS. And Hope it works... &lt;/p&gt;</comment>
                            <comment id="12868642" author="hudson" created="Tue, 18 May 2010 13:31:38 +0000"  >&lt;p&gt;Integrated in Cassandra #439 (See &lt;a href=&quot;http://hudson.zones.apache.org/hudson/job/Cassandra/439/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://hudson.zones.apache.org/hudson/job/Cassandra/439/&lt;/a&gt;)&lt;br/&gt;
    make DCQUORUM CLs actually wait for the nodes per DC rather than attempting a purely count-based approach that didn&apos;t really work as advertised.  patch by Vijay Parthasarathy and jbellis; reviewed by Jeremy Hanna for &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-952&quot; title=&quot;DC Quorum broken @ trunk&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-952&quot;&gt;&lt;del&gt;CASSANDRA-952&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="12868743" author="jbellis" created="Tue, 18 May 2010 17:16:20 +0000"  >&lt;p&gt;committed v4.&lt;/p&gt;

&lt;p&gt;there is still a minor issue w/ replica placement but I have opened &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-1103&quot; title=&quot;DSS rack-awareness doesn&amp;#39;t really work&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-1103&quot;&gt;&lt;del&gt;CASSANDRA-1103&lt;/del&gt;&lt;/a&gt; instead of round-tripping this again.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12444546" name="0002-dcquorum-fixes-v2.txt" size="81265" author="vijay2win@yahoo.com" created="Fri, 14 May 2010 23:55:24 +0000"/>
                            <attachment id="12441264" name="952-Canges_To_Stategy_V002.txt" size="21810" author="vijay2win@yahoo.com" created="Fri, 9 Apr 2010 05:31:17 +0000"/>
                            <attachment id="12440777" name="952-Change_BlockFor.txt" size="4325" author="vijay2win@yahoo.com" created="Mon, 5 Apr 2010 17:07:35 +0000"/>
                            <attachment id="12441265" name="952-Changes_To_ResponseHandler_v002.txt" size="38401" author="vijay2win@yahoo.com" created="Fri, 9 Apr 2010 05:31:17 +0000"/>
                            <attachment id="12440820" name="952-Fix_Refactor_DCStatergy.txt" size="16042" author="vijay2win@yahoo.com" created="Tue, 6 Apr 2010 01:16:58 +0000"/>
                            <attachment id="12444683" name="952-v3.txt" size="79659" author="jbellis" created="Mon, 17 May 2010 14:29:48 +0000"/>
                            <attachment id="12443042" name="952-v3.txt" size="70160" author="vijay2win@yahoo.com" created="Wed, 28 Apr 2010 06:31:20 +0000"/>
                            <attachment id="12444724" name="952-v4.txt" size="78294" author="vijay2win@yahoo.com" created="Mon, 17 May 2010 18:49:43 +0000"/>
                            <attachment id="12443208" name="952-v4.txt" size="69794" author="vijay2win@yahoo.com" created="Thu, 29 Apr 2010 17:42:55 +0000"/>
                            <attachment id="12443389" name="952-v5.txt" size="67556" author="vijay2win@yahoo.com" created="Sat, 1 May 2010 20:55:15 +0000"/>
                            <attachment id="12444346" name="ASF.LICENSE.NOT.GRANTED--0001-clean-out-callback-purging-from-truncate-writerh.txt" size="12598" author="jbellis" created="Wed, 12 May 2010 21:48:53 +0000"/>
                            <attachment id="12444347" name="ASF.LICENSE.NOT.GRANTED--0002-dcquorum-fixes.txt" size="68588" author="jbellis" created="Wed, 12 May 2010 21:48:53 +0000"/>
                            <attachment id="12443390" name="DC-Config.xml" size="927" author="vijay2win@yahoo.com" created="Sat, 1 May 2010 20:55:15 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>13.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[vijay2win@yahoo.com]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>19935</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            15 years, 28 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0g23b:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>91769</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12961"><![CDATA[Low]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>