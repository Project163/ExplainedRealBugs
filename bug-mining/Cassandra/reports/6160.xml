<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 23:26:24 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-18032] When generate.sh fails its rc=0</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-18032</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
$ ./generate.sh -a
Generating &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; config.yml file with low resources and LOWRES/MIDRES/HIGHRES templates from config-2_1.yml
./generate.sh: line 171: circleci: command not found
patching file ./config-2_1.yml
Hunk #4 succeeded at 1511 (offset 9 lines).
Hunk #5 succeeded at 1525 (offset 9 lines).
Hunk #6 succeeded at 1540 (offset 9 lines).
Hunk #7 succeeded at 1554 (offset 9 lines).
Hunk #8 succeeded at 1569 (offset 9 lines).
Hunk #9 succeeded at 1583 (offset 9 lines).
Hunk #10 succeeded at 1598 (offset 9 lines).
Hunk #11 succeeded at 1616 (offset 9 lines).
Hunk #12 succeeded at 1631 (offset 9 lines).
Hunk #13 succeeded at 1649 (offset 9 lines).
Hunk #14 succeeded at 1664 (offset 9 lines).
Hunk #15 succeeded at 1682 (offset 9 lines).
Hunk #16 succeeded at 1697 (offset 9 lines).
./generate.sh: line 177: circleci: command not found
patching file ./config-2_1.yml
./generate.sh: line 183: circleci: command not found
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="13500945">CASSANDRA-18032</key>
            <summary>When generate.sh fails its rc=0</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10002" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Normal</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="bereng">Berenguer Blasi</assignee>
                                    <reporter username="dcapwell">David Capwell</reporter>
                        <labels>
                    </labels>
                <created>Thu, 10 Nov 2022 17:45:23 +0000</created>
                <updated>Fri, 10 Oct 2025 08:47:44 +0000</updated>
                            <resolved>Mon, 16 Jan 2023 06:15:58 +0000</resolved>
                                        <fixVersion>3.0.29</fixVersion>
                    <fixVersion>3.11.15</fixVersion>
                    <fixVersion>4.0.8</fixVersion>
                    <fixVersion>4.1.1</fixVersion>
                    <fixVersion>5.0-alpha1</fixVersion>
                    <fixVersion>5.0</fixVersion>
                                    <component>CI</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="17631812" author="brandon.williams" created="Thu, 10 Nov 2022 17:46:45 +0000"  >&lt;p&gt;//cc &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=adelapena&quot; class=&quot;user-hover&quot; rel=&quot;adelapena&quot;&gt;adelapena&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17631854" author="adelapena" created="Thu, 10 Nov 2022 18:41:06 +0000"  >&lt;p&gt;Indeed we should immediately fail if &lt;a href=&quot;https://circleci.com/docs/local-cli/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;CircleCI local CLI&lt;/a&gt; is not installed. That tool is &lt;a href=&quot;https://github.com/apache/cassandra/blob/trunk/.circleci/readme.md#updating-the-config&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;needed by the &lt;tt&gt;-a&lt;/tt&gt; option&lt;/a&gt;, and &lt;a href=&quot;https://github.com/apache/cassandra/blob/trunk/.circleci/readme.md#switching-to-higher-resource-settings&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;also by &lt;tt&gt;-l&lt;/tt&gt;, &lt;tt&gt;-m&lt;/tt&gt; and &lt;tt&gt;-h&lt;/tt&gt;&lt;/a&gt;. Possibly just use&#160;&lt;tt&gt;set -e&lt;/tt&gt;.&lt;/p&gt;</comment>
                            <comment id="17632175" author="bereng" created="Fri, 11 Nov 2022 09:02:36 +0000"  >&lt;p&gt;Tested locally. If we&apos;re happy with the approach I will put up the rest of the PRs&lt;/p&gt;</comment>
                            <comment id="17632271" author="adelapena" created="Fri, 11 Nov 2022 11:42:21 +0000"  >&lt;p&gt;The PR adds that &lt;tt&gt;set -e&lt;/tt&gt; option and also a check to verify that &lt;tt&gt;circleci&lt;/tt&gt; is available.&lt;/p&gt;

&lt;p&gt;As mentioned above, &lt;tt&gt;circleci&lt;/tt&gt; command is only &lt;a href=&quot;https://github.com/apache/cassandra/blob/trunk/.circleci/readme.md#updating-the-config&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;needed by the &lt;tt&gt;-a&lt;/tt&gt; option&lt;/a&gt;, and &lt;a href=&quot;https://github.com/apache/cassandra/blob/trunk/.circleci/readme.md#switching-to-higher-resource-settings&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;also by &lt;tt&gt;-l&lt;/tt&gt;, &lt;tt&gt;-m&lt;/tt&gt; and &lt;tt&gt;-h&lt;/tt&gt;&lt;/a&gt;. However, the proposed check doesn&apos;t verify which flags are run, so it prevents users from exclusively detecting tests and/or setting environment vars with, for example, &lt;tt&gt;.circleci/generate.sh -e REPEATED_UTESTS_COUNT=10&lt;/tt&gt;.&lt;/p&gt;

&lt;p&gt;I think we should do that check if any of the flags requiring &lt;tt&gt;circleci&lt;/tt&gt; tool is present. That would be in practice almost identical to using &lt;tt&gt;set -e&lt;/tt&gt; alone, just replacing the printed message.&lt;/p&gt;</comment>
                            <comment id="17632287" author="edimitrova" created="Fri, 11 Nov 2022 12:05:55 +0000"  >&lt;p&gt;Thanks for handling this, can we wait not to commit it until we are done with the last 4.1 blockers, please?&#160;&lt;/p&gt;</comment>
                            <comment id="17632318" author="bereng" created="Fri, 11 Nov 2022 12:43:45 +0000"  >&lt;p&gt;Thx for the feedback. Yes I added a explicit check for the existence of circle so we could print a nice message. Also it appeared to me if you don&apos;t have it you wouldn&apos;t be using generate.sh at all. But I can change it and I can wait sure.&lt;/p&gt;</comment>
                            <comment id="17656025" author="bereng" created="Mon, 9 Jan 2023 10:32:58 +0000"  >&lt;p&gt;I changed the PR to stick to a simple `set -e` to address &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=adelapena&quot; class=&quot;user-hover&quot; rel=&quot;adelapena&quot;&gt;adelapena&lt;/a&gt; comments. If it looks ok and sbdy can +1 then I&apos;ll push the other PRs.&lt;/p&gt;</comment>
                            <comment id="17656034" author="adelapena" created="Mon, 9 Jan 2023 11:12:41 +0000"  >&lt;p&gt;Looks good to me, +1&lt;/p&gt;</comment>
                            <comment id="17656596" author="bereng" created="Tue, 10 Jan 2023 11:22:18 +0000"  >&lt;p&gt;Added the rest of the PRs and tested manually on all of them that on a missing circleci executable it fails properly.&lt;/p&gt;</comment>
                            <comment id="17675579" author="adelapena" created="Wed, 11 Jan 2023 13:51:51 +0000"  >&lt;p&gt;+1&lt;/p&gt;</comment>
                            <comment id="17675825" author="bereng" created="Thu, 12 Jan 2023 06:17:42 +0000"  >&lt;p&gt;Thx for the reviews!&lt;/p&gt;</comment>
                            <comment id="17676243" author="adelapena" created="Thu, 12 Jan 2023 16:02:13 +0000"  >&lt;p&gt;I&apos;m afraid that, as reported by &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=stefan.miklosovic&quot; class=&quot;user-hover&quot; rel=&quot;stefan.miklosovic&quot;&gt;stefan.miklosovic&lt;/a&gt;, the&#160;&lt;tt&gt;set -e&lt;/tt&gt; is breaking the writing of env vars, including those used for test multiplexer. For example, if you run:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
.circleci/generate.sh -l -e REPEATED_JVM_DTESTS=org.apache.cassandra.distributed.test.AuthTest
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;The &lt;tt&gt;REPEATED_JVM_DTESTS&lt;/tt&gt; is not written:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
Generating &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; config.yml file with low resources from config-2_1.yml

Detecting &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; or modified tests with git diff --diff-filter=AMR trunk...HEAD:
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;I suspect that &lt;a href=&quot;https://github.com/apache/cassandra/blob/trunk/.circleci/generate.sh#L206-L211&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;this subshell&lt;/a&gt; is producing a not-zero output that immediately stops execution. That happens after the resource config has been written, but the automatic test detection fails and the writing of env vars is skipped.&lt;/p&gt;</comment>
                            <comment id="17676248" author="brandon.williams" created="Thu, 12 Jan 2023 16:18:44 +0000"  >&lt;p&gt;A non-zero error code is definitely being returned even upon success now.&lt;/p&gt;</comment>
                            <comment id="17676274" author="adelapena" created="Thu, 12 Jan 2023 17:28:21 +0000"  >&lt;p&gt;&lt;a href=&quot;https://github.com/apache/cassandra/compare/trunk...adelapena:18032-trunk-followup&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;Here&lt;/a&gt; is a possible fix. &lt;/p&gt;

&lt;p&gt;The problem was that &lt;a href=&quot;https://github.com/apache/cassandra/blob/trunk/.circleci/generate.sh#L206-L211&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;the calls to grep inside this subshell&lt;/a&gt; were returning 1 (not found) when the diff is empty, and the new &lt;tt&gt;set -e&lt;/tt&gt; was interrupting the execution due to that not-zero return code. The solution is just suppressing that code, which can be done in multiple ways.&lt;/p&gt;</comment>
                            <comment id="17676470" author="bereng" created="Fri, 13 Jan 2023 06:08:44 +0000"  >&lt;p&gt;Ah that&apos;s not nice. I tested a few things manually but not this one. New PRs:&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;&lt;a href=&quot;https://github.com/apache/cassandra/pull/2089&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;3.0&lt;/a&gt;&lt;/li&gt;
	&lt;li&gt;&lt;a href=&quot;https://github.com/apache/cassandra/pull/2090&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;3.11&lt;/a&gt;&lt;/li&gt;
	&lt;li&gt;&lt;a href=&quot;https://github.com/apache/cassandra/pull/2091&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;4.0&lt;/a&gt;&lt;/li&gt;
	&lt;li&gt;&lt;a href=&quot;https://github.com/apache/cassandra/pull/2092&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;4.1&lt;/a&gt;&lt;/li&gt;
	&lt;li&gt;&lt;a href=&quot;https://github.com/apache/cassandra/pull/2093&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;trunk&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;I tested manually you can set an env var on all branches. Thx &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=adelapena&quot; class=&quot;user-hover&quot; rel=&quot;adelapena&quot;&gt;adelapena&lt;/a&gt; for the suggested fix.&lt;/p&gt;</comment>
                            <comment id="17676611" author="adelapena" created="Fri, 13 Jan 2023 12:41:32 +0000"  >&lt;p&gt;Thanks for preparing the patches for the other branches, they seem identical as expected. I have tested them:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;Without manually specified env vars nor new tests to be automatically detected.&lt;/li&gt;
	&lt;li&gt;With manually specified env vars and without new tests to be automatically detected.&lt;/li&gt;
	&lt;li&gt;Without manually specified env vars and with new tests to be automatically detected.&lt;/li&gt;
	&lt;li&gt;With manually specified env vars and with new tests to be automatically detected.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;In all cases the written env vars are correct and the return code is zero, so let&apos;s commit the proposed fix.&lt;/p&gt;</comment>
                            <comment id="17677168" author="bereng" created="Mon, 16 Jan 2023 06:15:38 +0000"  >&lt;p&gt;Take 2 committed: &lt;a href=&quot;https://github.com/apache/cassandra/commit/f384e694825a2cd0a95debf30accb153f00e80b0&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/cassandra/commit/f384e694825a2cd0a95debf30accb153f00e80b0&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310760">
                    <name>Testing</name>
                                                                <inwardlinks description="Discovered while testing">
                                        <issuelink>
            <issuekey id="13414586">CASSANDRA-17178</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[bereng]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12313821" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Complexity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12964"><![CDATA[Low Hanging Fruit]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313822" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Discovered By</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12969"><![CDATA[User Report]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12311120" key="com.pyxis.greenhopper.jira:gh-epic-link">
                        <customfieldname>Epic Link</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>CASSANDRA-18007</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12313922" key="jira.plugin.projectspecificselectfield.jpssf:multicftype">
                        <customfieldname>Impacts</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="13100"><![CDATA[None]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            2 years, 43 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12313921" key="jira.plugin.projectspecificselectfield.jpssf:multicftype">
                        <customfieldname>Platform</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="13076"><![CDATA[All]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z1bvi0:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[adelapena]]></customfieldvalue>
        <customfieldvalue><![CDATA[bereng]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12961"><![CDATA[Low]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12311420" key="com.atlassian.jira.plugin.system.customfieldtypes:version">
                        <customfieldname>Since Version</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="12352689">4.1.0</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313924" key="com.atlassian.jira.plugin.system.customfieldtypes:textfield">
                        <customfieldname>Source Control Link</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>&lt;p&gt;&lt;a href=&quot;https://github.com/apache/cassandra/commit/69dfed3671144c019fb69793e3152b5a71d76421&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/cassandra/commit/69dfed3671144c019fb69793e3152b5a71d76421&lt;/a&gt;&lt;/p&gt;</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313823" key="com.atlassian.jira.plugin.system.customfieldtypes:textarea">
                        <customfieldname>Test and Documentation Plan</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>&lt;p&gt;See comments&lt;/p&gt;</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>