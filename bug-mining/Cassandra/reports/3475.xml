<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 22:52:02 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-9019] GCInspector detected GC before ThreadPools are initialized</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-9019</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;While running the dtest &lt;tt&gt;one_all_test (consistency_test.TestConsistency)&lt;/tt&gt;, I ran into the following exception:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;

java.lang.RuntimeException: Error reading: org.apache.cassandra.metrics:type=ThreadPools,path=request,scope=ReadStage,name=ActiveTasks
        at org.apache.cassandra.metrics.ThreadPoolMetrics.getJmxMetric(ThreadPoolMetrics.java:134)
        at org.apache.cassandra.utils.StatusLogger.log(StatusLogger.java:55)
        at org.apache.cassandra.service.GCInspector.handleNotification(GCInspector.java:147)
        at com.sun.jmx.interceptor.DefaultMBeanServerInterceptor$ListenerWrapper.handleNotification(DefaultMBeanServerInterceptor.java:1754)
        at sun.management.NotificationEmitterSupport.sendNotification(NotificationEmitterSupport.java:156)
        at sun.management.GarbageCollectorImpl.createGCNotification(GarbageCollectorImpl.java:150)
Caused by: java.lang.reflect.UndeclaredThrowableException
        at com.sun.proxy.$Proxy3.getValue(Unknown Source)
        at org.apache.cassandra.metrics.ThreadPoolMetrics.getJmxMetric(ThreadPoolMetrics.java:123)
        ... 5 more
Caused by: javax.management.InstanceNotFoundException: org.apache.cassandra.metrics:type=ThreadPools,path=request,scope=ReadStage,name=ActiveTasks
        at com.sun.jmx.interceptor.DefaultMBeanServerInterceptor.getMBean(DefaultMBeanServerInterceptor.java:1095)
        at com.sun.jmx.interceptor.DefaultMBeanServerInterceptor.getAttribute(DefaultMBeanServerInterceptor.java:643)
        at com.sun.jmx.mbeanserver.JmxMBeanServer.getAttribute(JmxMBeanServer.java:678)
        at javax.management.MBeanServerInvocationHandler.invoke(MBeanServerInvocationHandler.java:267)
        ... 7 more
    

&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Dtest didn&apos;t preserve the logs, which implies that this wasn&apos;t in the system.log, but printed to stderr somehow, it&apos;s unclear with all the piping dtest and ccm do. I have yet to reproduce the issue.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12784870">CASSANDRA-9019</key>
            <summary>GCInspector detected GC before ThreadPools are initialized</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10002" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Normal</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="yukim">Yuki Morishita</assignee>
                                    <reporter username="philipthompson">Philip Thompson</reporter>
                        <labels>
                    </labels>
                <created>Mon, 23 Mar 2015 16:42:33 +0000</created>
                <updated>Tue, 16 Apr 2019 09:31:17 +0000</updated>
                            <resolved>Mon, 6 Apr 2015 22:34:56 +0000</resolved>
                                        <fixVersion>2.2.0 beta 1</fixVersion>
                                    <component>Legacy/Tools</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="14376205" author="yukim" created="Mon, 23 Mar 2015 17:07:22 +0000"  >&lt;p&gt;My guess is that GCInspector detected long GC before StageManager initialized stages in its static initializer.&lt;/p&gt;

&lt;p&gt;Possible solution is to defer &lt;tt&gt;GCInspector.register()&lt;/tt&gt; after &lt;tt&gt;StorageService.instance.initServer()&lt;/tt&gt; or do explicit StageManger static initialization before registering GCInspector in &lt;tt&gt;CassandraDaemon#setup()&lt;/tt&gt;.&lt;/p&gt;

&lt;p&gt;I wonder why it was not logged in system.log, since we added default exception handler before registering GCInspector.&lt;/p&gt;</comment>
                            <comment id="14376217" author="philipthompson" created="Mon, 23 Mar 2015 17:12:04 +0000"  >&lt;p&gt;It&apos;s possible it was just an error in dtest, and it really was in system.log. &lt;/p&gt;</comment>
                            <comment id="14376221" author="philipthompson" created="Mon, 23 Mar 2015 17:13:37 +0000"  >&lt;p&gt;If you look at the recent trunk dtests on jenkins, &lt;a href=&quot;http://cassci.datastax.com/job/CTOOL_trunk_dtest/11/console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://cassci.datastax.com/job/CTOOL_trunk_dtest/11/console&lt;/a&gt; , it appears this is occurring MUCH more frequently there.&lt;/p&gt;</comment>
                            <comment id="14376320" author="yukim" created="Mon, 23 Mar 2015 18:17:07 +0000"  >&lt;p&gt;In this case, I think it&apos;s better to return string &quot;N/A&quot; (not available) rather than throwing RuntimeException when Stages are not initialized and JMX instances are not ready, so that we still can display it in StatusLogger output.&lt;/p&gt;

&lt;p&gt;I cannot reproduce with GC, but I used &lt;tt&gt;nodetool tpstats&lt;/tt&gt; because it uses the same method in ThreadPoolMetrics. If you do &lt;tt&gt;nodetool tpstats&lt;/tt&gt; right after the node starts, you get similar error as follows:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;$ bin/nodetool -p 7100 tpstats
Pool Name                    Active   Pending      Completed   Blocked  All time blocked
error: org.apache.cassandra.metrics:type=ThreadPools,path=request,scope=ReadStage,name=ActiveTasks
-- StackTrace --
javax.management.InstanceNotFoundException: org.apache.cassandra.metrics:type=ThreadPools,path=request,scope=ReadStage,name=ActiveTasks
        at com.sun.jmx.interceptor.DefaultMBeanServerInterceptor.getMBean(DefaultMBeanServerInterceptor.java:1095)
        at com.sun.jmx.interceptor.DefaultMBeanServerInterceptor.getAttribute(DefaultMBeanServerInterceptor.java:643)
        at com.sun.jmx.mbeanserver.JmxMBeanServer.getAttribute(JmxMBeanServer.java:678)
        at javax.management.remote.rmi.RMIConnectionImpl.doOperation(RMIConnectionImpl.java:1464)
        at javax.management.remote.rmi.RMIConnectionImpl.access$300(RMIConnectionImpl.java:97)
        -- snip --
        at org.apache.cassandra.metrics.ThreadPoolMetrics.getJmxMetric(ThreadPoolMetrics.java:123)
        at org.apache.cassandra.tools.NodeProbe.getThreadPoolMetric(NodeProbe.java:1000)
        at org.apache.cassandra.tools.NodeTool$TpStats.execute(NodeTool.java:2630)
        at org.apache.cassandra.tools.NodeTool$NodeToolCmd.run(NodeTool.java:256)
        at org.apache.cassandra.tools.NodeTool.main(NodeTool.java:170)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;After the patch, it shows &quot;N/A&quot; for not yet ready thread pools.&lt;/p&gt;</comment>
                            <comment id="14376696" author="aweisberg" created="Mon, 23 Mar 2015 21:35:48 +0000"  >&lt;p&gt;My only concern is that the string returned suppresses information about the exception. The return value may not be a great place to barf an exception anyways. Logging to the log at info level also might be too verbose. This is where having a rate limited logger can be nice.&lt;/p&gt;

&lt;p&gt;I here there is one coming as part of &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-8584&quot; title=&quot;Add rate limited logging of failed trySkipCache calls and commit log lag&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-8584&quot;&gt;&lt;del&gt;CASSANDRA-8584&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="14377922" author="philipthompson" created="Tue, 24 Mar 2015 14:24:11 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=aweisberg&quot; class=&quot;user-hover&quot; rel=&quot;aweisberg&quot;&gt;aweisberg&lt;/a&gt;, you want to be reviewer?&lt;/p&gt;</comment>
                            <comment id="14378645" author="aweisberg" created="Tue, 24 Mar 2015 21:20:06 +0000"  >&lt;p&gt;I am +1 on returning the string N/A. I am -1 on not logging the exception somewhere.&lt;/p&gt;

&lt;p&gt;It looks like the caller should supply a logger since we access this from NodeProbe and StatusLogger.&lt;/p&gt;

&lt;p&gt;So they would get their expected output along with the error output according to their logging configuration. It looks like StatusLogger is logging some statements to stdout and others to a logging framework? Is that intentional?&lt;/p&gt;</comment>
                            <comment id="14378662" author="yukim" created="Tue, 24 Mar 2015 21:26:56 +0000"  >&lt;blockquote&gt;&lt;p&gt;It looks like StatusLogger is logging some statements to stdout and others to a logging framework?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Hah, I didn&apos;t notice this. It should use logger.&lt;br/&gt;
Will update the patch including this one.&lt;/p&gt;</comment>
                            <comment id="14384812" author="yukim" created="Fri, 27 Mar 2015 22:31:55 +0000"  >&lt;p&gt;Attached v2.&lt;br/&gt;
This version checks if MBean is registered before getting attributes.&lt;br/&gt;
When MBean is not there, return string &quot;N/A&quot;.&lt;/p&gt;

&lt;p&gt;Other exception is just thrown as runtime Error(or RuntimeException) and is logged by default error handler.&lt;/p&gt;

&lt;p&gt;Also fixed StatusLogger to use logger instead of System.out.&lt;/p&gt;</comment>
                            <comment id="14481436" author="aweisberg" created="Mon, 6 Apr 2015 17:07:29 +0000"  >&lt;p&gt;OK I am +1 these changes.&lt;/p&gt;</comment>
                            <comment id="14482097" author="yukim" created="Mon, 6 Apr 2015 22:34:56 +0000"  >&lt;p&gt;Committed, thanks!&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12653470">CASSANDRA-5657</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12707898" name="9019-v2.txt" size="2324" author="yukim" created="Fri, 27 Mar 2015 22:31:55 +0000"/>
                            <attachment id="12706667" name="9019.txt" size="566" author="yukim" created="Mon, 23 Mar 2015 18:17:07 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[yukim]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 33 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i278gf:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12311421" key="com.atlassian.jira.plugin.system.customfieldtypes:multiversion">
                        <customfieldname>Reproduced In</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="12324945">2.2.0 beta 1</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>aweisberg</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[aweisberg]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12962"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>