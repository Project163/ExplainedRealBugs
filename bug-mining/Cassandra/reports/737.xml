<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 22:19:31 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-2104] IndexOutOfBoundsException during lazy row compaction of supercolumns</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-2104</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;I ran into an exception when lazily compacting wide rows of TimeUUID columns.&lt;br/&gt;
It seems to trigger when a row is larger than &lt;tt&gt;in_memory_compaction_limit_in_mb&lt;/tt&gt;.&lt;/p&gt;

&lt;p&gt;Traceback:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt; INFO [CompactionExecutor:1] 2011-02-03 10:59:59,262 CompactionIterator.java (line 135) Compacting large row XXXXXXXXXXXXX (76999384 bytes) incrementally
 ERROR [CompactionExecutor:1] 2011-02-03 10:59:59,266 AbstractCassandraDaemon.java (line 114) Fatal exception in thread T
 hread[CompactionExecutor:1,1,main]
 java.lang.IndexOutOfBoundsException
         at java.nio.Buffer.checkIndex(Buffer.java:514)
         at java.nio.HeapByteBuffer.get(HeapByteBuffer.java:121)
         at org.apache.cassandra.db.marshal.TimeUUIDType.compareTimestampBytes(TimeUUIDType.java:56)
         at org.apache.cassandra.db.marshal.TimeUUIDType.compare(TimeUUIDType.java:45)
         at org.apache.cassandra.db.marshal.TimeUUIDType.compare(TimeUUIDType.java:29)
         at java.util.concurrent.ConcurrentSkipListMap$ComparableUsingComparator.compareTo(ConcurrentSkipListMap.java:606
 )
         at java.util.concurrent.ConcurrentSkipListMap.findPredecessor(ConcurrentSkipListMap.java:685)
         at java.util.concurrent.ConcurrentSkipListMap.doPut(ConcurrentSkipListMap.java:864)
         at java.util.concurrent.ConcurrentSkipListMap.putIfAbsent(ConcurrentSkipListMap.java:1893)
         at org.apache.cassandra.db.SuperColumn.addColumn(SuperColumn.java:170)
         at org.apache.cassandra.db.SuperColumn.putColumn(SuperColumn.java:195)
         at org.apache.cassandra.db.ColumnFamily.addColumn(ColumnFamily.java:221)
         at org.apache.cassandra.io.LazilyCompactedRow$LazyColumnIterator.reduce(LazilyCompactedRow.java:204)
         at org.apache.cassandra.io.LazilyCompactedRow$LazyColumnIterator.reduce(LazilyCompactedRow.java:185)
         at org.apache.cassandra.utils.ReducingIterator.computeNext(ReducingIterator.java:62)
         at com.google.common.collect.AbstractIterator.tryToComputeNext(AbstractIterator.java:136)
         at com.google.common.collect.AbstractIterator.hasNext(AbstractIterator.java:131)
         at com.google.common.collect.Iterators$7.computeNext(Iterators.java:604)
         at com.google.common.collect.AbstractIterator.tryToComputeNext(AbstractIterator.java:136)
         at com.google.common.collect.AbstractIterator.hasNext(AbstractIterator.java:131)
         at org.apache.cassandra.db.ColumnIndexer.serializeInternal(ColumnIndexer.java:76)
         at org.apache.cassandra.db.ColumnIndexer.serialize(ColumnIndexer.java:50)
         at org.apache.cassandra.io.LazilyCompactedRow.&amp;lt;init&amp;gt;(LazilyCompactedRow.java:88)
         at org.apache.cassandra.io.CompactionIterator.getCompactedRow(CompactionIterator.java:137)
         at org.apache.cassandra.io.CompactionIterator.getReduced(CompactionIterator.java:108)
         at org.apache.cassandra.io.CompactionIterator.getReduced(CompactionIterator.java:43)
         at org.apache.cassandra.utils.ReducingIterator.computeNext(ReducingIterator.java:73)
         at com.google.common.collect.AbstractIterator.tryToComputeNext(AbstractIterator.java:136)
         at com.google.common.collect.AbstractIterator.hasNext(AbstractIterator.java:131)
         at org.apache.commons.collections.iterators.FilterIterator.setNextObject(FilterIterator.java:183)
         at org.apache.commons.collections.iterators.FilterIterator.hasNext(FilterIterator.java:94)
         at org.apache.cassandra.db.CompactionManager.doCompaction(CompactionManager.java:426)
         at org.apache.cassandra.db.CompactionManager$1.call(CompactionManager.java:122)
         at org.apache.cassandra.db.CompactionManager$1.call(CompactionManager.java:92)
         at java.util.concurrent.FutureTask$Sync.innerRun(FutureTask.java:303)
         at java.util.concurrent.FutureTask.run(FutureTask.java:138)
         at java.util.concurrent.ThreadPoolExecutor$Worker.runTask(ThreadPoolExecutor.java:886)
         at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:908)
         at java.lang.Thread.run(Thread.java:662)

&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="12497548">CASSANDRA-2104</key>
            <summary>IndexOutOfBoundsException during lazy row compaction of supercolumns</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10002" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Normal</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="slebresne">Sylvain Lebresne</assignee>
                                    <reporter username="dln">Daniel Lundin</reporter>
                        <labels>
                    </labels>
                <created>Thu, 3 Feb 2011 10:08:28 +0000</created>
                <updated>Tue, 16 Apr 2019 09:33:07 +0000</updated>
                            <resolved>Thu, 24 Feb 2011 19:09:55 +0000</resolved>
                                        <fixVersion>0.7.3</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                    <workratio workratioPercent="0"/>
                                    <progress percentage="0">
                                    <originalProgress>
                                                    <row percentage="100" backgroundColor="#89afd7"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="0" backgroundColor="#51a825"/>
                                                    <row percentage="100" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="0">
                                    <originalProgress>
                                                    <row percentage="100" backgroundColor="#89afd7"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="0" backgroundColor="#51a825"/>
                                                    <row percentage="100" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                    <timeoriginalestimate seconds="28800">8h</timeoriginalestimate>
                            <timeestimate seconds="28800">8h</timeestimate>
                                        <comments>
                            <comment id="12990166" author="jbellis" created="Thu, 3 Feb 2011 16:41:22 +0000"  >&lt;p&gt;I believe you mentioned on the ML that you have data that compacts fine if you increase the in_memory limit, but not with lazy mode?&lt;/p&gt;

&lt;p&gt;If so, can you get me a copy of that sstable to test with?  I can set up a place for you to upload it privately if you can&apos;t make it public.&lt;/p&gt;</comment>
                            <comment id="12990528" author="dln" created="Fri, 4 Feb 2011 11:22:54 +0000"  >&lt;p&gt;Unfortunately, I&apos;m not at liberty to share that data, sorry. But I&apos;m working on seeing if I can reproduce it with non-sensitive data...&lt;/p&gt;

&lt;p&gt;These are timeuuid cols, wide rows (100k or so cols, with a few multi-mb columns but mostly &amp;lt;1k sizes). No validators.&lt;/p&gt;

&lt;p&gt;The instance in question had small memtable thresholds (32MB), a pretty low heap (6GB) but nothing out of the ordinary.&lt;/p&gt;</comment>
                            <comment id="12995124" author="jbellis" created="Wed, 16 Feb 2011 02:51:25 +0000"  >&lt;p&gt;Any luck reproducing?&lt;/p&gt;</comment>
                            <comment id="12998386" author="dln" created="Wed, 23 Feb 2011 14:30:30 +0000"  >&lt;p&gt;Nope, never managed to trigger it again.&lt;br/&gt;
Closing this issue for now.&lt;/p&gt;</comment>
                            <comment id="12998395" author="jborgstrom" created="Wed, 23 Feb 2011 14:56:03 +0000"  >&lt;p&gt;Hi Jonathan,&lt;/p&gt;

&lt;p&gt;I now have a python script that seems to be able to reproduce this after a few runs (it does not seem to always happen)&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://jonas.borgstrom.se/cassandra/CASSANDRA-2104.txt&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://jonas.borgstrom.se/cassandra/CASSANDRA-2104.txt&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;I&apos;ve tested this on an empty single node 0.7.2 cluster and default cassandra.yaml, except for in_memory_compaction_limit_in_mb=32 hoping that would make it easier to reproduce.&lt;/p&gt;

&lt;p&gt;A complete copy of the data directory (and config) after running the script a couple of times can be downloaded here:&lt;br/&gt;
&lt;a href=&quot;http://jonas.borgstrom.se/cassandra/CASSANDRA-2104.tar.gz&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://jonas.borgstrom.se/cassandra/CASSANDRA-2104.tar.gz&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;And a copy of system.log from booting cassandra using this data directory:&lt;br/&gt;
&lt;a href=&quot;http://jonas.borgstrom.se/cassandra/CASSANDRA-2104-system.log&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://jonas.borgstrom.se/cassandra/CASSANDRA-2104-system.log&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Let me know if you need any more details.&lt;/p&gt;</comment>
                            <comment id="12998407" author="jbellis" created="Wed, 23 Feb 2011 15:14:10 +0000"  >&lt;p&gt;Jonas, are you also seeing the error only on rows larger than in_memory_compaction_limit then?&lt;/p&gt;</comment>
                            <comment id="12998430" author="jborgstrom" created="Wed, 23 Feb 2011 16:14:36 +0000"  >&lt;p&gt;Jonathan, yes that seems to be the case. For me key 3139 (19) seems to be the one triggering this. So increasing in_memory_compaction_limit enough to cover that key seems to do the trick. Even if some other keys are compacted incrementally.&lt;/p&gt;</comment>
                            <comment id="12998808" author="jborgstrom" created="Thu, 24 Feb 2011 11:42:49 +0000"  >&lt;p&gt;I&apos;ve done some more testing now and I&apos;m ONLY able to reproduce this when using both super columns and the TimeUUIDType column comparator.&lt;/p&gt;

&lt;p&gt;After looking at the code TimeUUIDType seems to be the only marshaller that would actually notice (throw an exception) if its compare() method was called with a partial value (1-15 bytes in the case of UUIDs).&lt;/p&gt;

&lt;p&gt;So to me it looks like the incremental compactor sometimes sends corrupted/partial data to the marshaller, at least for super column families. This corrupted/partial data is silently ignored unless the TimeUUIDType marshaller is used.&lt;/p&gt;</comment>
                            <comment id="12998848" author="slebresne" created="Thu, 24 Feb 2011 13:46:46 +0000"  >&lt;p&gt;I have a hard time reproducing (using your script). Do you use TimeUUIDType for the column or the super column names ? (I&apos;ve tried both though).&lt;/p&gt;

&lt;p&gt;I&apos;ll continue trying. However, if you happen to have some SSTables that directly triggers it and that is smaller that the ones you added above, that would be awesome (I&apos;m struggling making enough room on my laptop for the ones you attached above &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;).&lt;/p&gt;

&lt;p&gt;Anyway, thanks for taking time on this, I&apos;ll continue to try.&lt;/p&gt;</comment>
                            <comment id="12998872" author="jborgstrom" created="Thu, 24 Feb 2011 14:47:49 +0000"  >&lt;p&gt;Hi Sylvain,&lt;/p&gt;

&lt;p&gt;The last time I reproduce it I used &quot;create column family bar with column_type=Super and comparator=TimeUUIDType and subcomparator=UTF8Type;&quot; and had to run the test case twice.&lt;/p&gt;

&lt;p&gt;Anyway here&apos;s a new data directory with only a subset of the sstables from the last dump. I get an exception in the log within seconds after issuing a &quot;compact&quot; command.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://jonas.borgstrom.se/cassandra/CASSANDRA-2104-v2.tar.gz&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://jonas.borgstrom.se/cassandra/CASSANDRA-2104-v2.tar.gz&lt;/a&gt; (153kB compressed and 127MB uncompressed)&lt;/p&gt;</comment>
                            <comment id="12998925" author="slebresne" created="Thu, 24 Feb 2011 16:36:26 +0000"  >&lt;p&gt;Thanks a lot Jonas, those new sstables were most useful.&lt;/p&gt;

&lt;p&gt;Turns out the problem was that we were using the wrong comparator when deserializing, so we were comparing the column using TimeUUIDType (instead of UTF8Type).&lt;/p&gt;

&lt;p&gt;Sadly, it could be that we were generating wrongly sorted on-disk superColumns. However any compaction with the attached patch should fix that anyway.&lt;/p&gt;</comment>
                            <comment id="12998978" author="slebresne" created="Thu, 24 Feb 2011 18:16:16 +0000"  >&lt;p&gt;Attaching a unit test that exposes the bug (and confirm the fix)&lt;/p&gt;</comment>
                            <comment id="12998995" author="jbellis" created="Thu, 24 Feb 2011 19:09:55 +0000"  >&lt;p&gt;committed&lt;/p&gt;</comment>
                            <comment id="12999401" author="hudson" created="Fri, 25 Feb 2011 15:15:13 +0000"  >&lt;p&gt;Integrated in Cassandra-0.7 #321 (See &lt;a href=&quot;https://hudson.apache.org/hudson/job/Cassandra-0.7/321/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://hudson.apache.org/hudson/job/Cassandra-0.7/321/&lt;/a&gt;)&lt;/p&gt;
</comment>
                            <comment id="13004902" author="akaris" created="Thu, 10 Mar 2011 00:47:15 +0000"  >&lt;p&gt;Hi,&lt;/p&gt;

&lt;p&gt;I&apos;m also getting an IndexOutOfBounds exception when compacting.&lt;/p&gt;

&lt;p&gt;Here&apos;s the detailed error I get on screen when running &quot;nodetool -h 10.3.133.10 compact&quot;:&lt;/p&gt;

&lt;p&gt;Error occured while compacting keyspace test&lt;br/&gt;
java.util.concurrent.ExecutionException: java.lang.IndexOutOfBoundsException&lt;br/&gt;
    at java.util.concurrent.FutureTask$Sync.innerGet(Unknown Source)&lt;br/&gt;
    at java.util.concurrent.FutureTask.get(Unknown Source)&lt;br/&gt;
    at org.apache.cassandra.db.CompactionManager.performMajor(CompactionManager.java:186)&lt;br/&gt;
    at org.apache.cassandra.db.ColumnFamilyStore.forceMajorCompaction(ColumnFamilyStore.java:1678)&lt;br/&gt;
    at org.apache.cassandra.service.StorageService.forceTableCompaction(StorageService.java:1248)&lt;br/&gt;
    at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)&lt;br/&gt;
    at sun.reflect.NativeMethodAccessorImpl.invoke(Unknown Source)&lt;br/&gt;
    at sun.reflect.DelegatingMethodAccessorImpl.invoke(Unknown Source)&lt;br/&gt;
    at java.lang.reflect.Method.invoke(Unknown Source)&lt;br/&gt;
    at com.sun.jmx.mbeanserver.StandardMBeanIntrospector.invokeM2(Unknown Source)&lt;br/&gt;
    at com.sun.jmx.mbeanserver.StandardMBeanIntrospector.invokeM2(Unknown Source)&lt;br/&gt;
    at com.sun.jmx.mbeanserver.MBeanIntrospector.invokeM(Unknown Source)&lt;br/&gt;
    at com.sun.jmx.mbeanserver.PerInterface.invoke(Unknown Source)&lt;br/&gt;
    at com.sun.jmx.mbeanserver.MBeanSupport.invoke(Unknown Source)&lt;br/&gt;
    at com.sun.jmx.interceptor.DefaultMBeanServerInterceptor.invoke(Unknown Source)&lt;br/&gt;
    at com.sun.jmx.mbeanserver.JmxMBeanServer.invoke(Unknown Source)&lt;br/&gt;
    at javax.management.remote.rmi.RMIConnectionImpl.doOperation(Unknown Source)&lt;br/&gt;
    at javax.management.remote.rmi.RMIConnectionImpl.access$200(Unknown Source)&lt;br/&gt;
    at javax.management.remote.rmi.RMIConnectionImpl$PrivilegedOperation.run(Unknown Source)&lt;br/&gt;
    at javax.management.remote.rmi.RMIConnectionImpl.doPrivilegedOperation(Unknown Source)&lt;br/&gt;
    at javax.management.remote.rmi.RMIConnectionImpl.invoke(Unknown Source)&lt;br/&gt;
    at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)&lt;br/&gt;
    at sun.reflect.NativeMethodAccessorImpl.invoke(Unknown Source)&lt;br/&gt;
    at sun.reflect.DelegatingMethodAccessorImpl.invoke(Unknown Source)&lt;br/&gt;
    at java.lang.reflect.Method.invoke(Unknown Source)&lt;br/&gt;
    at sun.rmi.server.UnicastServerRef.dispatch(Unknown Source)&lt;br/&gt;
    at sun.rmi.transport.Transport$1.run(Unknown Source)&lt;br/&gt;
    at java.security.AccessController.doPrivileged(Native Method)&lt;br/&gt;
    at sun.rmi.transport.Transport.serviceCall(Unknown Source)&lt;br/&gt;
    at sun.rmi.transport.tcp.TCPTransport.handleMessages(Unknown Source)&lt;br/&gt;
    at sun.rmi.transport.tcp.TCPTransport$ConnectionHandler.run0(Unknown Source)&lt;br/&gt;
    at sun.rmi.transport.tcp.TCPTransport$ConnectionHandler.run(Unknown Source)&lt;br/&gt;
    at java.util.concurrent.ThreadPoolExecutor$Worker.runTask(Unknown Source)&lt;br/&gt;
    at java.util.concurrent.ThreadPoolExecutor$Worker.run(Unknown Source)&lt;br/&gt;
    at java.lang.Thread.run(Unknown Source)&lt;br/&gt;
Caused by: java.lang.IndexOutOfBoundsException&lt;br/&gt;
    at java.nio.Buffer.checkIndex(Unknown Source)&lt;br/&gt;
    at java.nio.HeapByteBuffer.getInt(Unknown Source)&lt;br/&gt;
    at org.apache.cassandra.db.DeletedColumn.getLocalDeletionTime(DeletedColumn.java:57)&lt;br/&gt;
    at org.apache.cassandra.db.ColumnFamilyStore.removeDeletedStandard(ColumnFamilyStore.java:822)&lt;br/&gt;
    at org.apache.cassandra.db.ColumnFamilyStore.removeDeletedColumnsOnly(ColumnFamilyStore.java:809)&lt;br/&gt;
    at org.apache.cassandra.db.ColumnFamilyStore.removeDeleted(ColumnFamilyStore.java:800)&lt;br/&gt;
    at org.apache.cassandra.io.PrecompactedRow.&amp;lt;init&amp;gt;(PrecompactedRow.java:94)&lt;br/&gt;
    at org.apache.cassandra.io.CompactionIterator.getCompactedRow(CompactionIterator.java:139)&lt;br/&gt;
    at org.apache.cassandra.io.CompactionIterator.getReduced(CompactionIterator.java:108)&lt;br/&gt;
    at org.apache.cassandra.io.CompactionIterator.getReduced(CompactionIterator.java:43)&lt;br/&gt;
    at org.apache.cassandra.utils.ReducingIterator.computeNext(ReducingIterator.java:73)&lt;br/&gt;
    at com.google.common.collect.AbstractIterator.tryToComputeNext(AbstractIterator.java:136)&lt;br/&gt;
    at com.google.common.collect.AbstractIterator.hasNext(AbstractIterator.java:131)&lt;br/&gt;
    at org.apache.commons.collections.iterators.FilterIterator.setNextObject(FilterIterator.java:183)&lt;br/&gt;
    at org.apache.commons.collections.iterators.FilterIterator.hasNext(FilterIterator.java:94)&lt;br/&gt;
    at org.apache.cassandra.db.CompactionManager.doCompaction(CompactionManager.java:427)&lt;br/&gt;
    at org.apache.cassandra.db.CompactionManager$3.call(CompactionManager.java:217)&lt;br/&gt;
    at java.util.concurrent.FutureTask$Sync.innerRun(Unknown Source)&lt;br/&gt;
    at java.util.concurrent.FutureTask.run(Unknown Source)&lt;br/&gt;
    ... 3 more&lt;/p&gt;

&lt;p&gt;And here&apos;s the error I&apos;m getting in my log file:&lt;/p&gt;

&lt;p&gt;ERROR &lt;span class=&quot;error&quot;&gt;&amp;#91;CompactionExecutor:1&amp;#93;&lt;/span&gt; 2011-03-09 19:16:52,299 AbstractCassandraDaemon.java (line 114) Fatal exception in thread Thread&lt;span class=&quot;error&quot;&gt;&amp;#91;CompactionExecutor:1,1,main&amp;#93;&lt;/span&gt;&lt;br/&gt;
java.lang.IndexOutOfBoundsException&lt;br/&gt;
    at java.nio.Buffer.checkIndex(Unknown Source)&lt;br/&gt;
    at java.nio.HeapByteBuffer.getInt(Unknown Source)&lt;br/&gt;
    at org.apache.cassandra.db.DeletedColumn.getLocalDeletionTime(DeletedColumn.java:57)&lt;br/&gt;
    at org.apache.cassandra.db.ColumnFamilyStore.removeDeletedStandard(ColumnFamilyStore.java:822)&lt;br/&gt;
    at org.apache.cassandra.db.ColumnFamilyStore.removeDeletedColumnsOnly(ColumnFamilyStore.java:809)&lt;br/&gt;
    at org.apache.cassandra.db.ColumnFamilyStore.removeDeleted(ColumnFamilyStore.java:800)&lt;br/&gt;
    at org.apache.cassandra.io.PrecompactedRow.&amp;lt;init&amp;gt;(PrecompactedRow.java:94)&lt;br/&gt;
    at org.apache.cassandra.io.CompactionIterator.getCompactedRow(CompactionIterator.java:139)&lt;br/&gt;
    at org.apache.cassandra.io.CompactionIterator.getReduced(CompactionIterator.java:108)&lt;br/&gt;
    at org.apache.cassandra.io.CompactionIterator.getReduced(CompactionIterator.java:43)&lt;br/&gt;
    at org.apache.cassandra.utils.ReducingIterator.computeNext(ReducingIterator.java:73)&lt;br/&gt;
    at com.google.common.collect.AbstractIterator.tryToComputeNext(AbstractIterator.java:136)&lt;br/&gt;
    at com.google.common.collect.AbstractIterator.hasNext(AbstractIterator.java:131)&lt;br/&gt;
    at org.apache.commons.collections.iterators.FilterIterator.setNextObject(FilterIterator.java:183)&lt;br/&gt;
    at org.apache.commons.collections.iterators.FilterIterator.hasNext(FilterIterator.java:94)&lt;br/&gt;
    at org.apache.cassandra.db.CompactionManager.doCompaction(CompactionManager.java:427)&lt;br/&gt;
    at org.apache.cassandra.db.CompactionManager$3.call(CompactionManager.java:217)&lt;br/&gt;
    at java.util.concurrent.FutureTask$Sync.innerRun(Unknown Source)&lt;br/&gt;
    at java.util.concurrent.FutureTask.run(Unknown Source)&lt;br/&gt;
    at java.util.concurrent.ThreadPoolExecutor$Worker.runTask(Unknown Source)&lt;br/&gt;
    at java.util.concurrent.ThreadPoolExecutor$Worker.run(Unknown Source)&lt;br/&gt;
    at java.lang.Thread.run(Unknown Source)&lt;/p&gt;

&lt;p&gt;I run Cassandra 0.7.2. We have 8 machines in the cluster, the error happens only on one machine. I&apos;m not sure it&apos;s the same issue than this ticket but it&apos;s the only reference I found about compacting and IndexOutOfBounds. We&apos;re not inserting any SuperColumn in that database.&lt;/p&gt;

&lt;p&gt;Thanks for the help.&lt;/p&gt;</comment>
                            <comment id="13004918" author="akaris" created="Thu, 10 Mar 2011 01:09:50 +0000"  >&lt;p&gt;We upgraded to 0.7.3 and we still have the same error, so I guess it&apos;s a different problem &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/sad.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="13005015" author="slebresne" created="Thu, 10 Mar 2011 10:04:36 +0000"  >&lt;p&gt;Can you open a new ticket with the description of the problem then. If you&apos;re at liberty to attach an bad sstable to reproduce the problem, that would clearly help.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12471850" name="0001-Use-the-right-comparator-when-deserializing-superCol.patch" size="1015" author="slebresne" created="Thu, 24 Feb 2011 16:32:52 +0000"/>
                            <attachment id="12471857" name="Unit-test.patch" size="2731" author="slebresne" created="Thu, 24 Feb 2011 18:16:16 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[slebresne]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>20445</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            14 years, 37 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0g9c7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>92943</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>jbellis</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[jbellis]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12962"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>