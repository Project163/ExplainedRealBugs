<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 22:47:59 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-7145] FileNotFoundException during compaction</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-7145</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;I can&apos;t finish any compaction because my nodes always throw a &quot;FileNotFoundException&quot;. I&apos;ve already tried the following but nothing helped:&lt;/p&gt;

&lt;p&gt;1. nodetool flush&lt;br/&gt;
2. nodetool repair (ends with RuntimeException; see attachment)&lt;br/&gt;
3. node restart (via dse cassandra-stop)&lt;/p&gt;

&lt;p&gt;Whenever I restart the nodes, another type of exception is logged (see attachment) somewhere near the end of startup process. This particular exception doesn&apos;t seem to be critical because the nodes still manage to finish the startup and become online.&lt;/p&gt;

&lt;p&gt;I don&apos;t have specific steps to reproduce the problem that I&apos;m experiencing with compaction and repair. I&apos;m in the middle of migrating 4.8 billion rows from MySQL via SSTableLoader. &lt;/p&gt;

&lt;p&gt;Some things that may or may not be relevant:&lt;br/&gt;
1. I didn&apos;t drop and recreate the keyspace (so probably not related to &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-4857&quot; title=&quot;FileNotFoundException after create-drop-create keyspace&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-4857&quot;&gt;&lt;del&gt;CASSANDRA-4857&lt;/del&gt;&lt;/a&gt;)&lt;br/&gt;
2. I do the bulk-loading in batches of 1 to 20 millions rows. When a batch reaches 100% total progress (i.e. starts to build secondary index), I kill the sstableloader process and cancel the index build&lt;br/&gt;
3. I restart the nodes occasionally. It&apos;s possible that there is an on-going compaction during one of those restarts.&lt;/p&gt;

&lt;p&gt;Related StackOverflow question (mine): &lt;a href=&quot;http://stackoverflow.com/questions/23435847/filenotfoundexception-during-compaction&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://stackoverflow.com/questions/23435847/filenotfoundexception-during-compaction&lt;/a&gt;&lt;/p&gt;</description>
                <environment>&lt;p&gt;CentOS 6.3, Datastax Enterprise 4.0.1 (Cassandra 2.0.5), Java 1.7.0_55&lt;/p&gt;</environment>
        <key id="12712119">CASSANDRA-7145</key>
            <summary>FileNotFoundException during compaction</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10002" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Normal</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="marcuse">Marcus Eriksson</assignee>
                                    <reporter username="pjc08">PJ</reporter>
                        <labels>
                    </labels>
                <created>Sat, 3 May 2014 14:16:55 +0000</created>
                <updated>Tue, 16 Apr 2019 09:31:46 +0000</updated>
                            <resolved>Mon, 1 Sep 2014 13:52:35 +0000</resolved>
                                        <fixVersion>1.2.19</fixVersion>
                    <fixVersion>2.0.11</fixVersion>
                    <fixVersion>2.1.0</fixVersion>
                                    <component>Local/Compaction</component>
                        <due></due>
                            <votes>1</votes>
                                    <watches>8</watches>
                                                                                                                <comments>
                            <comment id="14042763" author="jbellis" created="Tue, 24 Jun 2014 22:04:19 +0000"  >&lt;p&gt;I&apos;m really going to need more to troubleshoot this effectively.&lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;How did your cluster get into this state?&lt;/li&gt;
	&lt;li&gt;Can you reproduce starting from a non-broken state?&lt;/li&gt;
	&lt;li&gt;Does it still happen on 2.0.8?&lt;/li&gt;
&lt;/ol&gt;
</comment>
                            <comment id="14086556" author="maxim.zakharenkov" created="Tue, 5 Aug 2014 18:02:37 +0000"  >&lt;p&gt;Today I had same problem on my local machine with one cassandra node, default configuration (2.0.8 and 2.0.9 versions). It was quite easily repeatable. I just executed quite heavy benchmark which writes new data as fast as it can into a single table. When it was running, I execute &quot;nodetool compact&quot; for that table. First time I got the issue immediately. After some 2 or 3 attempts I got the issue issue. Then later it was quite hard to repeat (maybe due to some file system caching, have no idea)&lt;/p&gt;</comment>
                            <comment id="14106709" author="krummas" created="Fri, 22 Aug 2014 10:46:37 +0000"  >&lt;p&gt;If we have a situation where this happens (in sequence);&lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;We ask LeveledManifest for a new CompactionCandidate&lt;/li&gt;
	&lt;li&gt;LCS returns a CompactionCandidate containing sstables marked as compacting (a bug)&lt;/li&gt;
	&lt;li&gt;The compaction that held one of the sstables we marked in #2 finishes and removes the files that were included in the compaction&lt;/li&gt;
	&lt;li&gt;We successfully mark the compacted sstable as compacting (it is no longer marked as compacting in the View)&lt;/li&gt;
	&lt;li&gt;FileNotFoundException once we start trying to compact&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;Attached patch &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;removes a case in LCS where we could return compacting sstables in a CompactionCandidate&lt;/li&gt;
	&lt;li&gt;makes sure we can&apos;t mark compacted sstables as compacting&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;It would be much appreciated if anyone that can reproduce this could try with the attached patch to see if the problem goes away.&lt;/p&gt;</comment>
                            <comment id="14110981" author="yukim" created="Tue, 26 Aug 2014 17:25:10 +0000"  >&lt;p&gt;I have seen the log indicating that L0 compacting with overlapping L1 SSTable that is already compacting and causes FNFE.&lt;br/&gt;
So I think your fix will work for that case.&lt;/p&gt;

&lt;p&gt;Nit for the patch: compactingL1 added to LeveledManifest is unused.&lt;/p&gt;</comment>
                            <comment id="14117439" author="krummas" created="Mon, 1 Sep 2014 13:52:35 +0000"  >&lt;p&gt;committed&lt;/p&gt;</comment>
                            <comment id="14127646" author="peter-librato" created="Tue, 9 Sep 2014 22:10:16 +0000"  >&lt;p&gt;This is listed in the 2.0 CHANGES.txt as present in 2.0.10 but &quot;Fix Versions&quot; shows 2.0.11.&lt;/p&gt;</comment>
                            <comment id="14128632" author="krummas" created="Wed, 10 Sep 2014 15:55:09 +0000"  >&lt;p&gt;it should be 2.0.11 in CHANGES as well - probably a merge issue, will fix&lt;/p&gt;</comment>
                            <comment id="14585644" author="jasonstack" created="Mon, 15 Jun 2015 08:43:10 +0000"  >&lt;p&gt;encounter the same problem:  nodetool compact failed.&lt;/p&gt;

&lt;p&gt;log: ERROR 08:38:42 Exception in thread Thread&lt;span class=&quot;error&quot;&gt;&amp;#91;CompactionExecutor:1,1,main&amp;#93;&lt;/span&gt;&lt;br/&gt;
java.lang.RuntimeException: java.io.FileNotFoundException: /home/zhaoyang/program/cassandra-2.1.1/./bin/../data/data/ycsb/usertable-4fb3447310e211e5a5c2f18cd916802f/ycsb-usertable-ka-6440-Data.db (Too many open files)&lt;/p&gt;

&lt;p&gt;at org.apache.cassandra.io.compress.CompressedThrottledReader.open(CompressedThrottledReader.java:52) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;apache-cassandra-2.1.1.jar:2.1.1&amp;#93;&lt;/span&gt;&lt;br/&gt;
	at org.apache.cassandra.io.sstable.SSTableReader.openDataReader(SSTableReader.java:1888) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;apache-cassandra-2.1.1.jar:2.1.1&amp;#93;&lt;/span&gt;&lt;br/&gt;
	at org.apache.cassandra.io.sstable.SSTableScanner.&amp;lt;init&amp;gt;(SSTableScanner.java:67) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;apache-cassandra-2.1.1.jar:2.1.1&amp;#93;&lt;/span&gt;&lt;br/&gt;
	at org.apache.cassandra.io.sstable.SSTableReader.getScanner(SSTableReader.java:1674) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;apache-cassandra-2.1.1.jar:2.1.1&amp;#93;&lt;/span&gt;&lt;br/&gt;
	at org.apache.cassandra.io.sstable.SSTableReader.getScanner(SSTableReader.java:1686) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;apache-cassandra-2.1.1.jar:2.1.1&amp;#93;&lt;/span&gt;&lt;br/&gt;
	at org.apache.cassandra.db.compaction.AbstractCompactionStrategy.getScanners(AbstractCompactionStrategy.java:275) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;apache-cassandra-2.1.1.jar:2.1.1&amp;#93;&lt;/span&gt;&lt;br/&gt;
	at org.apache.cassandra.db.compaction.AbstractCompactionStrategy.getScanners(AbstractCompactionStrategy.java:324) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;apache-cassandra-2.1.1.jar:2.1.1&amp;#93;&lt;/span&gt;&lt;br/&gt;
	at org.apache.cassandra.db.compaction.CompactionTask.runWith(CompactionTask.java:151) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;apache-cassandra-2.1.1.jar:2.1.1&amp;#93;&lt;/span&gt;&lt;br/&gt;
	at org.apache.cassandra.io.util.DiskAwareRunnable.runMayThrow(DiskAwareRunnable.java:48) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;apache-cassandra-2.1.1.jar:2.1.1&amp;#93;&lt;/span&gt;&lt;br/&gt;
	at org.apache.cassandra.utils.WrappedRunnable.run(WrappedRunnable.java:28) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;apache-cassandra-2.1.1.jar:2.1.1&amp;#93;&lt;/span&gt;&lt;br/&gt;
	at org.apache.cassandra.db.compaction.CompactionTask.executeInternal(CompactionTask.java:75) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;apache-cassandra-2.1.1.jar:2.1.1&amp;#93;&lt;/span&gt;&lt;br/&gt;
	at org.apache.cassandra.db.compaction.AbstractCompactionTask.execute(AbstractCompactionTask.java:59) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;apache-cassandra-2.1.1.jar:2.1.1&amp;#93;&lt;/span&gt;&lt;br/&gt;
	at org.apache.cassandra.db.compaction.CompactionManager$7.runMayThrow(CompactionManager.java:465) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;apache-cassandra-2.1.1.jar:2.1.1&amp;#93;&lt;/span&gt;&lt;br/&gt;
	at org.apache.cassandra.utils.WrappedRunnable.run(WrappedRunnable.java:28) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;apache-cassandra-2.1.1.jar:2.1.1&amp;#93;&lt;/span&gt;&lt;br/&gt;
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;na:1.8.0_20&amp;#93;&lt;/span&gt;&lt;br/&gt;
	at java.util.concurrent.FutureTask.run(FutureTask.java:266) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;na:1.8.0_20&amp;#93;&lt;/span&gt;&lt;br/&gt;
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1142) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;na:1.8.0_20&amp;#93;&lt;/span&gt;&lt;br/&gt;
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:617) &lt;span class=&quot;error&quot;&gt;&amp;#91;na:1.8.0_20&amp;#93;&lt;/span&gt;&lt;br/&gt;
	at java.lang.Thread.run(Thread.java:745) &lt;span class=&quot;error&quot;&gt;&amp;#91;na:1.8.0_20&amp;#93;&lt;/span&gt;&lt;/p&gt;


&lt;p&gt;I was doing YCSB testing. &lt;/p&gt;

&lt;p&gt;Setup: C* 2.1.1, Ubuntu 14.04 LTS, 24GB Ram, 256 ssd. &lt;/p&gt;</comment>
                            <comment id="14586228" author="yukim" created="Mon, 15 Jun 2015 15:49:30 +0000"  >&lt;p&gt;The error says &quot;Too many open files&quot;.&lt;br/&gt;
Maybe check your ulimit?&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                                                <inwardlinks description="is duplicated by">
                                        <issuelink>
            <issuekey id="12734481">CASSANDRA-7780</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12663642" name="0001-avoid-marking-compacted-sstables-as-compacting.patch" size="3546" author="marcuse" created="Fri, 22 Aug 2014 10:46:37 +0000"/>
                            <attachment id="12643198" name="compaction - FileNotFoundException.txt" size="6261" author="pjc08" created="Sat, 3 May 2014 14:16:55 +0000"/>
                            <attachment id="12643199" name="repair - RuntimeException.txt" size="1116" author="pjc08" created="Sat, 3 May 2014 14:16:55 +0000"/>
                            <attachment id="12643200" name="startup - AssertionError.txt" size="2144" author="pjc08" created="Sat, 3 May 2014 14:16:55 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>4.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[marcuse]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>390438</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 23 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1v93r:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>390691</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>yukim</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[yukim]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12962"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>