<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 23:14:00 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-15365] Add primary key liveness info when skipping illegal cells</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-15365</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;In &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-15086&quot; title=&quot;Illegal column names make legacy sstables unreadable in 3.0/3.x&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-15086&quot;&gt;&lt;del&gt;CASSANDRA-15086&lt;/del&gt;&lt;/a&gt;/&lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-15178&quot; title=&quot;Skipping illegal legacy cells can break reverse iteration of indexed partitions&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-15178&quot;&gt;&lt;del&gt;CASSANDRA-15178&lt;/del&gt;&lt;/a&gt; we started skipping the illegal legacy cells, problem is that if the row only contains illegal cells, we return a totally empty row which breaks stats collection: &lt;a href=&quot;https://github.com/apache/cassandra/blob/93815db9853cb592edf13d82e91dc2e9d172f01f/src/java/org/apache/cassandra/db/rows/Rows.java#L70&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/cassandra/blob/93815db9853cb592edf13d82e91dc2e9d172f01f/src/java/org/apache/cassandra/db/rows/Rows.java#L70&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;If the row only has these invalid cells, we should add a primary key liveness info to it to match the 2.1 behaviour.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13263092">CASSANDRA-15365</key>
            <summary>Add primary key liveness info when skipping illegal cells</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10002" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Normal</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="marcuse">Marcus Eriksson</assignee>
                                    <reporter username="marcuse">Marcus Eriksson</reporter>
                        <labels>
                    </labels>
                <created>Fri, 18 Oct 2019 12:18:09 +0000</created>
                <updated>Wed, 30 Oct 2019 14:18:43 +0000</updated>
                            <resolved>Wed, 30 Oct 2019 14:18:43 +0000</resolved>
                                        <fixVersion>3.0.20</fixVersion>
                    <fixVersion>3.11.6</fixVersion>
                                    <component>Local/SSTable</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="16954547" author="krummas" created="Fri, 18 Oct 2019 12:22:03 +0000"  >&lt;p&gt;&lt;a href=&quot;https://github.com/krummas/cassandra/commits/marcuse/15365&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;patch&lt;/a&gt; which keeps track of whether the row only contains invalid cells, if so, we add the primary key liveness.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://circleci.com/gh/krummas/workflows/cassandra/tree/marcuse%2F15365&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;circle&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16956917" author="beobal" created="Tue, 22 Oct 2019 10:25:47 +0000"  >&lt;p&gt;LGTM (just needs the JIRA # adding to the comment at &lt;tt&gt;LegacyLayout#1294&lt;/tt&gt;)&lt;/p&gt;</comment>
                            <comment id="16958926" author="benedict" created="Thu, 24 Oct 2019 14:21:26 +0000"  >&lt;p&gt;I&apos;ve pushed a branch &lt;a href=&quot;https://github.com/belliottsmith/cassandra/tree/15365-suggest&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;here&lt;/a&gt; with&#160;a suggested comment.&lt;/p&gt;

&lt;p&gt;Patch LGTM, however there&apos;s a remaining edge case that I don&apos;t know if we care to address or not.  Specifically, the case where we &lt;em&gt;currently&lt;/em&gt; have data in the row but &lt;em&gt;will not&lt;/em&gt; in future, but where the invalid data would have remained at that future point in time.&lt;/p&gt;

&lt;p&gt;For instance, either TTL&apos;d data or tombstones that have not yet been dropped.  If the invalid data is not TTL&apos;d, or is TTL&apos;d for a later date, then we would later stop returning the empty row in our CQL results.&lt;/p&gt;

&lt;p&gt;I think we have three options:&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;Carry on without worrying about this - it&apos;s already unclear what the correct response is to this invalid data after all&lt;/li&gt;
	&lt;li&gt;Always update the row liveness info with the invalid cell liveness we collect, if it supersedes any other liveness info&lt;/li&gt;
	&lt;li&gt;Ignore tombstone cells (and perhaps TTL&apos;d cells) when deciding if the row is empty before adding our invalid cell liveness info, if it supersedes&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;I think any of these options is acceptable in this weird edge case, where we are presumably repairing data that has been erroneously written by the user via external tooling.&lt;/p&gt;</comment>
                            <comment id="16961184" author="krummas" created="Mon, 28 Oct 2019 15:54:50 +0000"  >&lt;p&gt;so, in 2.1 these invalid cells act as a kind of permanent row markers, for example:&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;&lt;tt&gt;create table %s (pk int, c1 text, c2 text, v1 text, primary key (pk, c1, c2))&lt;/tt&gt;&lt;/li&gt;
	&lt;li&gt;insert an invalid cell, select * now returns: &lt;tt&gt;3, a, aa, null&lt;/tt&gt;&lt;/li&gt;
	&lt;li&gt;do an insert with a ttl for the whole row: &lt;tt&gt;insert into %s (pk, c1, c2, v1) values (3, &apos;a&apos;, &apos;aa&apos;, &apos;vaaalue&apos;) using ttl 2&lt;/tt&gt;&lt;/li&gt;
	&lt;li&gt;select * before ttl: &lt;tt&gt;3, a, aa, vaaalue&lt;/tt&gt;&lt;/li&gt;
	&lt;li&gt;select * after ttl expires: &lt;tt&gt;3, a, aa, null&lt;/tt&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;If the invalid cell didn&apos;t exist, the select would have returned nothing&lt;/p&gt;

&lt;p&gt;Translating this to 3.0 including this patch, we would translate the whole-row-insert row marker to the PKLI and ignore the invalid cell, and after ttl expires we would return nothing.&lt;/p&gt;

&lt;p&gt;We can&apos;t really fully translate the 2.1 behaviour to 3.0 using only the PKLI - for example if we in the example above set the PKLI to the timestamp of the invalid cell and later overwrote that row with a ttl row, we would fully purge it after ttl expires, while in the 2.1 case we would still keep the invalid cell&lt;/p&gt;

&lt;p&gt;I vote we keep the current patch behaviour, wdyt &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=samt&quot; class=&quot;user-hover&quot; rel=&quot;samt&quot;&gt;samt&lt;/a&gt; &amp;amp; &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=benedict&quot; class=&quot;user-hover&quot; rel=&quot;benedict&quot;&gt;benedict&lt;/a&gt;?&lt;/p&gt;</comment>
                            <comment id="16961189" author="benedict" created="Mon, 28 Oct 2019 15:58:51 +0000"  >&lt;p&gt;WFM&lt;/p&gt;</comment>
                            <comment id="16961245" author="beobal" created="Mon, 28 Oct 2019 16:54:00 +0000"  >&lt;p&gt;+1 &lt;/p&gt;</comment>
                            <comment id="16963049" author="krummas" created="Wed, 30 Oct 2019 14:18:43 +0000"  >&lt;p&gt;and committed to 3.0 and merged to 3.11, thanks&lt;/p&gt;

&lt;p&gt;test runs: &lt;a href=&quot;https://circleci.com/workflow-run/0c910638-db5f-494b-ba47-cc728a4d2eb6&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;3.0&lt;/a&gt; &lt;a href=&quot;https://circleci.com/workflow-run/da2cd137-ae9e-45bf-9c4d-1b98a006e08a&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;3.11&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[marcuse]]></customfieldvalue>
        <customfieldvalue><![CDATA[samt]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12313825" key="com.atlassian.jira.plugin.system.customfieldtypes:cascadingselect">
                        <customfieldname>Bug Category</customfieldname>
                        <customfieldvalues>
                                                    <customfieldvalue key="12982" cascade-level=""><![CDATA[Correctness]]></customfieldvalue>
                                <customfieldvalue key="12986" cascade-level="1"><![CDATA[Recoverable Corruption / Loss]]></customfieldvalue>
            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12313821" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Complexity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12965"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313822" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Discovered By</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12977"><![CDATA[Adhoc Test]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12313922" key="jira.plugin.projectspecificselectfield.jpssf:multicftype">
                        <customfieldname>Impacts</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="13100"><![CDATA[None]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            6 years, 2 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12313921" key="jira.plugin.projectspecificselectfield.jpssf:multicftype">
                        <customfieldname>Platform</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="13076"><![CDATA[All]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z07qaw:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[benedict]]></customfieldvalue>
        <customfieldvalue><![CDATA[samt]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12961"><![CDATA[Low]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12311420" key="com.atlassian.jira.plugin.system.customfieldtypes:version">
                        <customfieldname>Since Version</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="12332361">3.0 alpha 1</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313924" key="com.atlassian.jira.plugin.system.customfieldtypes:textfield">
                        <customfieldname>Source Control Link</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>&lt;p&gt;&lt;a href=&quot;https://github.com/apache/cassandra/commit/767a68cd00050298abf7bbfd8b322e5663439c23&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/cassandra/commit/767a68cd00050298abf7bbfd8b322e5663439c23&lt;/a&gt;&lt;/p&gt;</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313823" key="com.atlassian.jira.plugin.system.customfieldtypes:textarea">
                        <customfieldname>Test and Documentation Plan</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>&lt;p&gt;new LegacySSTableTest added&lt;/p&gt;</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>