<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 22:21:31 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-2752] repair fails with java.io.EOFException</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-2752</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;Issuing repair on node 1  (1.10.42.81) in a cluster quickly fails with&lt;br/&gt;
INFO &lt;span class=&quot;error&quot;&gt;&amp;#91;AntiEntropyStage:1&amp;#93;&lt;/span&gt; 2011-06-09 19:02:47,999 AntiEntropyService.java (line 234) Queueing comparison #&amp;lt;Differencer #&amp;lt;TreeRequest manual-repair-0c17c5f9-583f-4a31-a6d4-a9e7306fb46e, /1&lt;br/&gt;
.10.42.82, (JP,XXX), (Token(bytes&lt;span class=&quot;error&quot;&gt;&amp;#91;6e&amp;#93;&lt;/span&gt;),Token(bytes&lt;span class=&quot;error&quot;&gt;&amp;#91;313039&amp;#93;&lt;/span&gt;)]&amp;gt;&amp;gt;&lt;br/&gt;
 INFO &lt;span class=&quot;error&quot;&gt;&amp;#91;AntiEntropyStage:1&amp;#93;&lt;/span&gt; 2011-06-09 19:02:48,026 AntiEntropyService.java (line 468) Endpoints somewhere/1.10.42.81 and /1.10.42.82 have 2 range(s) out of sync for (JP,XXX) on (Token(bytes&lt;span class=&quot;error&quot;&gt;&amp;#91;6e&amp;#93;&lt;/span&gt;),Token(bytes&lt;span class=&quot;error&quot;&gt;&amp;#91;313039&amp;#93;&lt;/span&gt;)]&lt;br/&gt;
 INFO &lt;span class=&quot;error&quot;&gt;&amp;#91;AntiEntropyStage:1&amp;#93;&lt;/span&gt; 2011-06-09 19:02:48,026 AntiEntropyService.java (line 485) Performing streaming repair of 2 ranges for #&amp;lt;TreeRequest manual-repair-0c17c5f9-583f-4a31-a6d4-a9e7306&lt;br/&gt;
fb46e, /1.10.42.82, (JP,XXX), (Token(bytes&lt;span class=&quot;error&quot;&gt;&amp;#91;6e&amp;#93;&lt;/span&gt;),Token(bytes&lt;span class=&quot;error&quot;&gt;&amp;#91;313039&amp;#93;&lt;/span&gt;)]&amp;gt;&lt;br/&gt;
 INFO &lt;span class=&quot;error&quot;&gt;&amp;#91;AntiEntropyStage:1&amp;#93;&lt;/span&gt; 2011-06-09 19:02:48,030 StreamOut.java (line 173) Stream context metadata &lt;span class=&quot;error&quot;&gt;&amp;#91;/data/cassandra/node0/data/JP/XXX-g-3-Data.db sections=1 progress=0/36592 - 0%&amp;#93;&lt;/span&gt;, 1 sstables.&lt;br/&gt;
 INFO &lt;span class=&quot;error&quot;&gt;&amp;#91;AntiEntropyStage:1&amp;#93;&lt;/span&gt; 2011-06-09 19:02:48,031 StreamOutSession.java (line 174) Streaming to /1.10.42.82&lt;br/&gt;
ERROR &lt;span class=&quot;error&quot;&gt;&amp;#91;CompactionExecutor:9&amp;#93;&lt;/span&gt; 2011-06-09 19:02:48,970 AbstractCassandraDaemon.java (line 113) Fatal exception in thread Thread&lt;span class=&quot;error&quot;&gt;&amp;#91;CompactionExecutor:9,1,main&amp;#93;&lt;/span&gt;&lt;br/&gt;
java.io.EOFException&lt;br/&gt;
        at java.io.RandomAccessFile.readInt(RandomAccessFile.java:725)&lt;br/&gt;
        at org.apache.cassandra.io.sstable.SSTableWriter$RowIndexer.doIndexing(SSTableWriter.java:457)&lt;br/&gt;
        at org.apache.cassandra.io.sstable.SSTableWriter$RowIndexer.index(SSTableWriter.java:364)&lt;br/&gt;
        at org.apache.cassandra.io.sstable.SSTableWriter$Builder.build(SSTableWriter.java:315)&lt;br/&gt;
        at org.apache.cassandra.db.CompactionManager$9.call(CompactionManager.java:1099)&lt;br/&gt;
        at org.apache.cassandra.db.CompactionManager$9.call(CompactionManager.java:1090)&lt;br/&gt;
        at java.util.concurrent.FutureTask$Sync.innerRun(FutureTask.java:303)&lt;br/&gt;
        at java.util.concurrent.FutureTask.run(FutureTask.java:138)&lt;br/&gt;
        at java.util.concurrent.ThreadPoolExecutor$Worker.runTask(ThreadPoolExecutor.java:886)&lt;br/&gt;
        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:908)&lt;br/&gt;
        at java.lang.Thread.run(Thread.java:662)&lt;/p&gt;


&lt;p&gt;On .82&lt;br/&gt;
ERROR &lt;span class=&quot;error&quot;&gt;&amp;#91;CompactionExecutor:12&amp;#93;&lt;/span&gt; 2011-06-09 19:02:48,051 AbstractCassandraDaemon.java (line 113) Fatal exception in thread Thread&lt;span class=&quot;error&quot;&gt;&amp;#91;CompactionExecutor:12,1,main&amp;#93;&lt;/span&gt;&lt;br/&gt;
java.io.EOFException&lt;br/&gt;
        at java.io.RandomAccessFile.readInt(RandomAccessFile.java:725)&lt;br/&gt;
        at org.apache.cassandra.io.sstable.SSTableWriter$RowIndexer.doIndexing(SSTableWriter.java:457)&lt;br/&gt;
        at org.apache.cassandra.io.sstable.SSTableWriter$RowIndexer.index(SSTableWriter.java:364)&lt;br/&gt;
        at org.apache.cassandra.io.sstable.SSTableWriter$Builder.build(SSTableWriter.java:315)&lt;br/&gt;
        at org.apache.cassandra.db.CompactionManager$9.call(CompactionManager.java:1099)&lt;br/&gt;
        at org.apache.cassandra.db.CompactionManager$9.call(CompactionManager.java:1090)&lt;br/&gt;
        at java.util.concurrent.FutureTask$Sync.innerRun(FutureTask.java:303)&lt;br/&gt;
        at java.util.concurrent.FutureTask.run(FutureTask.java:138)&lt;br/&gt;
        at java.util.concurrent.ThreadPoolExecutor$Worker.runTask(ThreadPoolExecutor.java:886)&lt;br/&gt;
        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:908)&lt;br/&gt;
        at java.lang.Thread.run(Thread.java:662)&lt;br/&gt;
ERROR &lt;span class=&quot;error&quot;&gt;&amp;#91;Thread-132&amp;#93;&lt;/span&gt; 2011-06-09 19:02:48,051 AbstractCassandraDaemon.java (line 113) Fatal exception in thread Thread&lt;span class=&quot;error&quot;&gt;&amp;#91;Thread-132,5,main&amp;#93;&lt;/span&gt;&lt;br/&gt;
java.lang.RuntimeException: java.util.concurrent.ExecutionException: java.io.EOFException&lt;br/&gt;
        at org.apache.cassandra.streaming.StreamInSession.closeIfFinished(StreamInSession.java:152)&lt;br/&gt;
        at org.apache.cassandra.streaming.IncomingStreamReader.read(IncomingStreamReader.java:63)&lt;br/&gt;
        at org.apache.cassandra.net.IncomingTcpConnection.stream(IncomingTcpConnection.java:155)&lt;br/&gt;
        at org.apache.cassandra.net.IncomingTcpConnection.run(IncomingTcpConnection.java:93)&lt;br/&gt;
Caused by: java.util.concurrent.ExecutionException: java.io.EOFException&lt;br/&gt;
        at java.util.concurrent.FutureTask$Sync.innerGet(FutureTask.java:222)&lt;br/&gt;
        at java.util.concurrent.FutureTask.get(FutureTask.java:83)&lt;br/&gt;
        at org.apache.cassandra.streaming.StreamInSession.closeIfFinished(StreamInSession.java:136)&lt;br/&gt;
        ... 3 more&lt;br/&gt;
Caused by: java.io.EOFException&lt;br/&gt;
        at java.io.RandomAccessFile.readInt(RandomAccessFile.java:725)&lt;br/&gt;
        at org.apache.cassandra.io.sstable.SSTableWriter$RowIndexer.doIndexing(SSTableWriter.java:457)&lt;br/&gt;
        at org.apache.cassandra.io.sstable.SSTableWriter$RowIndexer.index(SSTableWriter.java:364)&lt;br/&gt;
        at org.apache.cassandra.io.sstable.SSTableWriter$Builder.build(SSTableWriter.java:315)&lt;br/&gt;
        at org.apache.cassandra.db.CompactionManager$9.call(CompactionManager.java:1099)&lt;br/&gt;
        at org.apache.cassandra.db.CompactionManager$9.call(CompactionManager.java:1090)&lt;br/&gt;
        at java.util.concurrent.FutureTask$Sync.innerRun(FutureTask.java:303)&lt;br/&gt;
        at java.util.concurrent.FutureTask.run(FutureTask.java:138)&lt;br/&gt;
        at java.util.concurrent.ThreadPoolExecutor$Worker.runTask(ThreadPoolExecutor.java:886)&lt;br/&gt;
        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:908)&lt;br/&gt;
        at java.lang.Thread.run(Thread.java:662)&lt;/p&gt;

&lt;p&gt;Looks to me like the receiving side fails first.&lt;/p&gt;
</description>
                <environment></environment>
        <key id="12509699">CASSANDRA-2752</key>
            <summary>repair fails with java.io.EOFException</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10000" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Urgent</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="jbellis">Jonathan Ellis</assignee>
                                    <reporter username="terjem">Terje Marthinussen</reporter>
                        <labels>
                    </labels>
                <created>Thu, 9 Jun 2011 11:24:46 +0000</created>
                <updated>Tue, 16 Apr 2019 09:32:57 +0000</updated>
                            <resolved>Tue, 14 Jun 2011 07:56:40 +0000</resolved>
                                        <fixVersion>0.8.1</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="13046509" author="terjem" created="Thu, 9 Jun 2011 12:49:45 +0000"  >&lt;p&gt;Need to test a bit more, but quite likely this is related to repair on CFs with secondary indexes.&lt;/p&gt;</comment>
                            <comment id="13046586" author="terjem" created="Thu, 9 Jun 2011 14:45:47 +0000"  >&lt;p&gt;Seems confirmed, only able to reproduce this on a CF with secondary indexes.&lt;/p&gt;</comment>
                            <comment id="13046606" author="jbellis" created="Thu, 9 Jun 2011 15:17:43 +0000"  >&lt;p&gt;Is this data from 0.7 that got upgraded?&lt;/p&gt;</comment>
                            <comment id="13046628" author="terjem" created="Thu, 9 Jun 2011 15:45:47 +0000"  >&lt;p&gt;Fresh 0.8 data.&lt;/p&gt;

&lt;p&gt;Just as a side test since the &quot;compactionexecutor&quot; is involved, we issued a full compaction of that CF and it completed without any error so the source SSTables seems good.&lt;/p&gt;

&lt;p&gt;I was trying to reproduce this locally on my desktop before leaving office to get it in a debugger. Quickly generated 10k random inserts into a CF with secondary index, but then I experienced that repair got stuck eating 100% on both nodes instead...&lt;/p&gt;

&lt;p&gt;I did not have time to figure out if it was due to some config issue or related to the same issue though.&lt;/p&gt;
</comment>
                            <comment id="13046897" author="lenn0x" created="Thu, 9 Jun 2011 22:57:22 +0000"  >&lt;p&gt;I am trying to track down a similar issue. Instead was bootstrapping a new node in my case.&lt;/p&gt;</comment>
                            <comment id="13046984" author="muga_nishizawa" created="Fri, 10 Jun 2011 03:50:39 +0000"  >&lt;p&gt;It seems tmp files (e.g. XXX-tmp-XXX-Data.db) that receiver node creates during repair process are broken.  EOFException occurs while RowIndexer is reading the broken files.  &lt;/p&gt;

&lt;p&gt;According to result of scrub command, data files on sender nodes are not broken.  &lt;/p&gt;</comment>
                            <comment id="13047211" author="terjem" created="Fri, 10 Jun 2011 14:18:16 +0000"  >&lt;p&gt;Chris: Same as the &quot;compactionexecutor&quot; or the infinite loop? (made &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-2758&quot; title=&quot;nodetool repair never finishes. Loops forever through merkle trees?&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-2758&quot;&gt;&lt;del&gt;CASSANDRA-2758&lt;/del&gt;&lt;/a&gt; for that just now).&lt;/p&gt;

&lt;p&gt;Seems like the sstables here has been truncated for some reason.&lt;br/&gt;
Rowindexer iterates through a bunch of rows just fine.&lt;br/&gt;
Then it reaches the problem row.&lt;/p&gt;

&lt;p&gt;For this row, it can get the key, it jumps pass the bloomfilter etc and when it is about to read the column count, it fails and is trying to read at an offset which equals the length of the file..&lt;br/&gt;
So far, all the stacktraces I have seen are all are on the column count read. &lt;/p&gt;

&lt;p&gt;A wild guess may be that it has failed to write the actual content (columns) of the last row that was stream?&lt;/p&gt;

&lt;p&gt;Unfortunately it does not to happen all the time, but it does only happen on the CF with secondary indexes.&lt;/p&gt;


</comment>
                            <comment id="13047266" author="terjem" created="Fri, 10 Jun 2011 16:06:46 +0000"  >&lt;p&gt;Also struck me on the way home from work today that the CF with secondary indexes also happen to be the only CF in this system which, I think, on a regular basis may actually update all columns for a key.&lt;/p&gt;

&lt;p&gt;That is, sstables will on a regular basis have keys where no columns is valid anymore.&lt;/p&gt;

&lt;p&gt;Not sure if that could for instance trigger something odd in the streaming?&lt;/p&gt;

</comment>
                            <comment id="13048637" author="muga_nishizawa" created="Mon, 13 Jun 2011 16:33:46 +0000"  >&lt;p&gt;It seems like timing issue.  The exception doesn&apos;t always occur even with use of same data.  &lt;/p&gt;</comment>
                            <comment id="13048655" author="terjem" created="Mon, 13 Jun 2011 17:00:10 +0000"  >&lt;p&gt;SSTableWriter.java:&lt;br/&gt;
                ColumnFamily.serializer().deserializeFromSSTableNoColumns(ColumnFamily.create(cfs.metadata), dfile);&lt;/p&gt;

&lt;p&gt;                // don&apos;t move that statement around, it expects the dfile to be before the columns&lt;br/&gt;
                updateCache(key, dataSize, null);&lt;/p&gt;

&lt;p&gt;                rowSizes.add(dataSize);&lt;br/&gt;
                columnCounts.add(dfile.readInt());&lt;/p&gt;


&lt;p&gt;I believe the problem is in updateCache.&lt;br/&gt;
If rowcache is enabled (and it is in this case) and the row needs to be updated in cache, this will read (deserialize) the row.&lt;/p&gt;

&lt;p&gt;However, after all the columns is read, the offset in the file is not reset back to the location where the  column count is stored and things go bad.&lt;/p&gt;

&lt;p&gt;I haven&apos;t actually tried to change the code to test, but I tried to disable the row cache, and so far, repair seems to work fine when it is disabled.&lt;/p&gt;</comment>
                            <comment id="13048728" author="jbellis" created="Mon, 13 Jun 2011 19:26:48 +0000"  >&lt;p&gt;patch to seek back after deserializing a row to update cache with&lt;/p&gt;</comment>
                            <comment id="13049045" author="slebresne" created="Tue, 14 Jun 2011 07:56:14 +0000"  >&lt;p&gt;Good catch. +1 (committed).&lt;br/&gt;
Thanks Terje.&lt;/p&gt;</comment>
                            <comment id="13049271" author="hudson" created="Tue, 14 Jun 2011 17:02:36 +0000"  >&lt;p&gt;Integrated in Cassandra-0.8 #170 (See &lt;a href=&quot;https://builds.apache.org/job/Cassandra-0.8/170/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/Cassandra-0.8/170/&lt;/a&gt;)&lt;/p&gt;
</comment>
                    </comments>
                    <attachments>
                            <attachment id="12482364" name="2752.txt" size="863" author="jbellis" created="Mon, 13 Jun 2011 19:26:48 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[jbellis]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>20806</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            14 years, 24 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0gd8n:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>93575</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>slebresne</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[slebresne]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12963"><![CDATA[Critical]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>