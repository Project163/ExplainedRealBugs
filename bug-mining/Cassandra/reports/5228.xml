<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 23:13:58 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-15169] SASI does not compare strings correctly</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-15169</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;In our scenario, we need to query with &apos;&amp;gt;&apos; conditions on string columns. So I created index with&#160; is_literal = false. like the following:&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
CREATE TABLE test (id &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; primary key, t text);

CREATE CUSTOM INDEX ON test (t) USING &lt;span class=&quot;code-quote&quot;&gt;&apos;org.apache.cassandra.index.sasi.SASIIndex&apos;&lt;/span&gt; WITH OPTIONS = {&lt;span class=&quot;code-quote&quot;&gt;&apos;is_literal&apos;&lt;/span&gt;: &lt;span class=&quot;code-quote&quot;&gt;&apos;&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;&apos;&lt;/span&gt;};
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;I also inserted some records and query:&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
insert into test(id,t) values(1,&lt;span class=&quot;code-quote&quot;&gt;&apos;abc&apos;&lt;/span&gt;);
select * from test where t &amp;gt; &lt;span class=&quot;code-quote&quot;&gt;&apos;ab&apos;&lt;/span&gt;;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;At first ,it worked. But after flush, the query returned none record.&lt;/p&gt;

&lt;p&gt;I have read the code of SASIIndex and found that it is because in the&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
Expression.isLowerSatisfiedBy&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;function,&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
term.compareTo&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;was called with parameter&#160;checkFully=false, which cause the string &apos;abc&apos; was only compared with its first 2&#160;characters( length of expression value).&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;I have wrote a UT for this case and fixed it.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13240232">CASSANDRA-15169</key>
            <summary>SASI does not compare strings correctly</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10002" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Normal</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="mazhenlin">mazhenlin</assignee>
                                    <reporter username="mazhenlin">mazhenlin</reporter>
                        <labels>
                    </labels>
                <created>Tue, 18 Jun 2019 15:58:53 +0000</created>
                <updated>Fri, 15 May 2020 08:54:24 +0000</updated>
                            <resolved>Thu, 17 Oct 2019 06:11:27 +0000</resolved>
                                        <fixVersion>3.11.5</fixVersion>
                    <fixVersion>4.0-alpha2</fixVersion>
                    <fixVersion>4.0</fixVersion>
                                    <component>Feature/SASI</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="16866787" author="mazhenlin" created="Tue, 18 Jun 2019 16:03:12 +0000"  >&lt;p&gt;The&#160;isUpperSatisfiedBy function has the same problem. But since column value will be checked later in Operation.localSatisfiedBy , it would not lead to wrong query result. So I did not modify it.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="16946951" author="michaelsembwever" created="Tue, 8 Oct 2019 14:46:58 +0000"  >&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;branch&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;circleci&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;asf jenkins testall&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;asf jenkins dtests&lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/apache/cassandra/compare/trunk...thelastpickle:mck/cassandra-3.11_15169&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;mck/cassandra-3.11_15169&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://circleci.com/gh/thelastpickle/workflows/cassandra/tree/mck%2Fcassandra-3.11_15169&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;circleci&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://builds.apache.org/view/A-D/view/Cassandra/job/Cassandra-devbranch-testall/52/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;&lt;span class=&quot;image-wrap&quot; style=&quot;&quot;&gt;&lt;img src=&quot;https://builds.apache.org/view/A-D/view/Cassandra/job/Cassandra-devbranch-testall/52//badge/icon&quot; style=&quot;border: 0px solid black&quot; /&gt;&lt;/span&gt;&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://builds.apache.org/view/A-D/view/Cassandra/job/Cassandra-devbranch-dtest/687&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;&lt;span class=&quot;image-wrap&quot; style=&quot;&quot;&gt;&lt;img src=&quot;https://builds.apache.org/view/A-D/view/Cassandra/job/Cassandra-devbranch-dtest/687//badge/icon&quot; style=&quot;border: 0px solid black&quot; /&gt;&lt;/span&gt;&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/apache/cassandra/compare/trunk...thelastpickle:mck/trunk_15169&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;mck/trunk_15169&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://circleci.com/gh/thelastpickle/workflows/cassandra/tree/mck%2Ftrunk_15169&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;circleci&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://builds.apache.org/view/A-D/view/Cassandra/job/Cassandra-devbranch-testall/53/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;&lt;span class=&quot;image-wrap&quot; style=&quot;&quot;&gt;&lt;img src=&quot;https://builds.apache.org/view/A-D/view/Cassandra/job/Cassandra-devbranch-testall/53//badge/icon&quot; style=&quot;border: 0px solid black&quot; /&gt;&lt;/span&gt;&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://builds.apache.org/view/A-D/view/Cassandra/job/Cassandra-devbranch-dtest/688&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;&lt;span class=&quot;image-wrap&quot; style=&quot;&quot;&gt;&lt;img src=&quot;https://builds.apache.org/view/A-D/view/Cassandra/job/Cassandra-devbranch-dtest/688//badge/icon&quot; style=&quot;border: 0px solid black&quot; /&gt;&lt;/span&gt;&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;

</comment>
                            <comment id="16946989" author="michaelsembwever" created="Tue, 8 Oct 2019 15:40:39 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mazhenlin&quot; class=&quot;user-hover&quot; rel=&quot;mazhenlin&quot;&gt;mazhenlin&lt;/a&gt;, against &lt;tt&gt;cassandra-3.11&lt;/tt&gt; have you seen the unit test failure in &lt;tt&gt;OnDiskIndexTest.testNotEqualsQueryForStrings&lt;/tt&gt; ?&lt;/p&gt;

&lt;p&gt;ref:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;&lt;a href=&quot;https://builds.apache.org/view/A-D/view/Cassandra/job/Cassandra-devbranch-testall/52/testReport/junit/org.apache.cassandra.index.sasi.disk/OnDiskIndexTest/testNotEqualsQueryForStrings/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/view/A-D/view/Cassandra/job/Cassandra-devbranch-testall/52/testReport/junit/org.apache.cassandra.index.sasi.disk/OnDiskIndexTest/testNotEqualsQueryForStrings/&lt;/a&gt;&lt;/li&gt;
	&lt;li&gt;&lt;a href=&quot;https://circleci.com/gh/thelastpickle/cassandra/511#tests/containers/3&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://circleci.com/gh/thelastpickle/cassandra/511#tests/containers/3&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="16947599" author="mazhenlin" created="Wed, 9 Oct 2019 12:03:34 +0000"  >&lt;p&gt;Yes, I have seen the failure . The OnDiskIndexTest.testNotEqualsQueryForStrings test case shows that using &apos;=&apos; for prefix matching seems to be a feature other than a bug .&#160; However,&#160; the inconsistent behavior between MemIndex and OnDiskIndex (when is_literal = true ) still need to be fixed. Comparison for&#160;&#160;blob type is also incorrect .&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;We have two choices:&lt;/p&gt;

&lt;p&gt;1 Do not use = for prefix match since &apos;like&apos; is already supported.&lt;/p&gt;

&lt;p&gt;2 Use &apos;=&apos; for prefix matching only when is_literal = true.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;Personally I like 1, but 2 may be&#160; better considering that someone might have already used this feature. Which do you prefer ? &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mck&quot; class=&quot;user-hover&quot; rel=&quot;mck&quot;&gt;mck&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16947856" author="michaelsembwever" created="Wed, 9 Oct 2019 17:07:57 +0000"  >&lt;p&gt;It makes sense that &lt;tt&gt;OnDiskIndex&lt;/tt&gt;&apos;s behaviour matches &lt;tt&gt;TrieMemIndex&lt;/tt&gt;&apos;s (&lt;tt&gt;is_literal&lt;/tt&gt;) behaviour.&lt;br/&gt;
But, if &lt;tt&gt;checkFully=false&lt;/tt&gt; is also not actually required in &lt;tt&gt;isUpperSatisfiedBy&lt;/tt&gt;, then why does the `&lt;tt&gt;Term.compareTo(..,checkFully)&lt;/tt&gt;` method exist at all?&lt;/p&gt;</comment>
                            <comment id="16948391" author="mazhenlin" created="Thu, 10 Oct 2019 10:27:04 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mck&quot; class=&quot;user-hover&quot; rel=&quot;mck&quot;&gt;mck&lt;/a&gt; Thank you for your comments. I went deeper and found that I had made some mistakes before.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;Since isSatisfiedBy will be called for every record in term later, it is&#160;acceptable to incorrectly include a term by isUpperSatisfiedBy/isLowerSatisfiedBy, but omitting a term incorrectly is not acceptable.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;I was wrong about&#160;isUpperSatisfiedBy. The checkFully=false is required for the LIKE_PREFIX operator because otherwise term could be omitted by&#160;isUpperSatisfiedBy&#160;incorrectly. But for the GT&#160;operator,&#160;checkFully need to be true in isLowerSatisfiedBy and&#160;isUpperSatisfiedBy( for ReversedType ).&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;The OnDiskIndexTest.testNotEqualsQueryForStrings failed because it uses NEQ as &quot;not like prefix&quot;&#160;semantic.&#160;&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;So I think it should work to set checkFully=true only for RANGE operators and only when&#160;is_literal=false( to retain the &quot;not like prefix&quot; semantic of NEQ) .&lt;/p&gt;</comment>
                            <comment id="16948722" author="mazhenlin" created="Thu, 10 Oct 2019 15:59:06 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mck&quot; class=&quot;user-hover&quot; rel=&quot;mck&quot;&gt;mck&lt;/a&gt;&#160;I hava uploaded a new patch that sets&#160;checkFully=true only for RANGE operators and only when&#160;is_literal=false. Also , new test cases are added for blob comparison and string prefix matching. Please review.&lt;/p&gt;</comment>
                            <comment id="16951321" author="michaelsembwever" created="Mon, 14 Oct 2019 20:22:05 +0000"  >&lt;p&gt;Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mazhenlin&quot; class=&quot;user-hover&quot; rel=&quot;mazhenlin&quot;&gt;mazhenlin&lt;/a&gt;. I added one test method to your patch, not particularly critical to the fix at hand, but an obvious compliment to the unit testing. LMK WDYT.&lt;/p&gt;

&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;branch&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;circleci&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;asf jenkins testall&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;asf jenkins dtests&lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/apache/cassandra/compare/trunk...thelastpickle:mck/cassandra-3.11_15169&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;mck/cassandra-3.11_15169&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://circleci.com/gh/thelastpickle/workflows/cassandra/tree/mck%2Fcassandra-3.11_15169&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;circleci&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://builds.apache.org/view/A-D/view/Cassandra/job/Cassandra-devbranch-testall/55/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;&lt;span class=&quot;image-wrap&quot; style=&quot;&quot;&gt;&lt;img src=&quot;https://builds.apache.org/view/A-D/view/Cassandra/job/Cassandra-devbranch-testall/55//badge/icon&quot; style=&quot;border: 0px solid black&quot; /&gt;&lt;/span&gt;&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://builds.apache.org/view/A-D/view/Cassandra/job/Cassandra-devbranch-dtest/690&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;&lt;span class=&quot;image-wrap&quot; style=&quot;&quot;&gt;&lt;img src=&quot;https://builds.apache.org/view/A-D/view/Cassandra/job/Cassandra-devbranch-dtest/690//badge/icon&quot; style=&quot;border: 0px solid black&quot; /&gt;&lt;/span&gt;&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/apache/cassandra/compare/trunk...thelastpickle:mck/trunk_15169&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;mck/trunk_15169&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://circleci.com/gh/thelastpickle/workflows/cassandra/tree/mck%2Ftrunk_15169&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;circleci&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://builds.apache.org/view/A-D/view/Cassandra/job/Cassandra-devbranch-testall/56/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;&lt;span class=&quot;image-wrap&quot; style=&quot;&quot;&gt;&lt;img src=&quot;https://builds.apache.org/view/A-D/view/Cassandra/job/Cassandra-devbranch-testall/56//badge/icon&quot; style=&quot;border: 0px solid black&quot; /&gt;&lt;/span&gt;&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://builds.apache.org/view/A-D/view/Cassandra/job/Cassandra-devbranch-dtest/691&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;&lt;span class=&quot;image-wrap&quot; style=&quot;&quot;&gt;&lt;img src=&quot;https://builds.apache.org/view/A-D/view/Cassandra/job/Cassandra-devbranch-dtest/691//badge/icon&quot; style=&quot;border: 0px solid black&quot; /&gt;&lt;/span&gt;&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;

</comment>
                            <comment id="16951778" author="mazhenlin" created="Tue, 15 Oct 2019 09:46:52 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mck&quot; class=&quot;user-hover&quot; rel=&quot;mck&quot;&gt;mck&lt;/a&gt;&#160;, since there are many restrictions in the code&#160;for not applying RANGE on literal indexes(e.g. ColumnIndex.supports), I have never considered the operation in your new case. Now if we want to remove these restrictions for PREFIX mode, the followings need to be done:&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;1 The expected results of OnDiskIndexTest.testNotEqualsQueryForStrings need to be changed because it is conflicted between the common &apos;&amp;gt;&apos; semantic and using NEQ as &quot;not-like-prefix&quot;.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;2 Make OnDiskIndex behaves correctly&#160; in comparison. This can be done easily.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;3 Support RANGE for MemIndex. This might be a little complicated. Since the TrieMemIndex does not support RANGE&#160; ,we need to either implement our new radix-tree&#160; class to support RANGE operation , or use SkipListMemIndex for PREFIX mode and treat &quot;a like b% &quot; as &quot; a &amp;gt; b and a &amp;lt; bytes(b)+1 &quot;.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;Besides,&#160; obviously RANGE operations are meaningful only for untokenized indexes. We need to think about whether these changes are worthwhile, and whether they will confuse users.&lt;/p&gt;</comment>
                            <comment id="16952124" author="michaelsembwever" created="Tue, 15 Oct 2019 17:08:37 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mazhenlin&quot; class=&quot;user-hover&quot; rel=&quot;mazhenlin&quot;&gt;mazhenlin&lt;/a&gt;, if you look through the docs at &lt;a href=&quot;https://github.com/apache/cassandra/blob/trunk/doc/SASI.md&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/cassandra/blob/trunk/doc/SASI.md&lt;/a&gt; you see a few different use-cases.&lt;/p&gt;

&lt;p&gt;I&apos;ve updated the unit tests to go through more of these use-cases.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;there are many restrictions in the code for not applying RANGE on literal indexes(e.g. ColumnIndex.supports)&#8230;&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;thanks for pointing that out. agreed, using &quot;ALLOW FILTERING&quot; isn&apos;t exactly testing the index, but the at least it&apos;s testing that the index doesn&apos;t do that query and the results that will be returned otherwise. nonetheless, i&apos;ve updated the tests (my branches listed above) to verify when the index will work (and won&apos;t).&lt;/p&gt;


&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;branch&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;circleci&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;asf jenkins testall&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;asf jenkins dtests&lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/apache/cassandra/compare/trunk...thelastpickle:mck/cassandra-3.11_15169&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;mck/cassandra-3.11_15169&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://circleci.com/gh/thelastpickle/workflows/cassandra/tree/mck%2Fcassandra-3.11_15169&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;circleci&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://builds.apache.org/view/A-D/view/Cassandra/job/Cassandra-devbranch-testall/57/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;&lt;span class=&quot;image-wrap&quot; style=&quot;&quot;&gt;&lt;img src=&quot;https://builds.apache.org/view/A-D/view/Cassandra/job/Cassandra-devbranch-testall/57//badge/icon&quot; style=&quot;border: 0px solid black&quot; /&gt;&lt;/span&gt;&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://builds.apache.org/view/A-D/view/Cassandra/job/Cassandra-devbranch-dtest/692&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;&lt;span class=&quot;image-wrap&quot; style=&quot;&quot;&gt;&lt;img src=&quot;https://builds.apache.org/view/A-D/view/Cassandra/job/Cassandra-devbranch-dtest/692//badge/icon&quot; style=&quot;border: 0px solid black&quot; /&gt;&lt;/span&gt;&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/apache/cassandra/compare/trunk...thelastpickle:mck/trunk_15169&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;mck/trunk_15169&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://circleci.com/gh/thelastpickle/workflows/cassandra/tree/mck%2Ftrunk_15169&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;circleci&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://builds.apache.org/view/A-D/view/Cassandra/job/Cassandra-devbranch-testall/58/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;&lt;span class=&quot;image-wrap&quot; style=&quot;&quot;&gt;&lt;img src=&quot;https://builds.apache.org/view/A-D/view/Cassandra/job/Cassandra-devbranch-testall/58//badge/icon&quot; style=&quot;border: 0px solid black&quot; /&gt;&lt;/span&gt;&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://builds.apache.org/view/A-D/view/Cassandra/job/Cassandra-devbranch-dtest/693&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;&lt;span class=&quot;image-wrap&quot; style=&quot;&quot;&gt;&lt;img src=&quot;https://builds.apache.org/view/A-D/view/Cassandra/job/Cassandra-devbranch-dtest/693//badge/icon&quot; style=&quot;border: 0px solid black&quot; /&gt;&lt;/span&gt;&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;

</comment>
                            <comment id="16952989" author="mazhenlin" created="Wed, 16 Oct 2019 16:46:47 +0000"  >&lt;p&gt;The failed tests are unrelated.&#160;&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;&#160;if you look through the docs at&#160;&lt;a href=&quot;https://github.com/apache/cassandra/blob/trunk/doc/SASI.md&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/cassandra/blob/trunk/doc/SASI.md&lt;/a&gt;&#160;you see a few different use-cases.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;I am not quite sure what you mean. I have run the demo queries in the doc and found these queries do not work as  described (the &quot;Text Analysis&quot; section):&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
SELECT * FROM sasi WHERE bio LIKE &lt;span class=&quot;code-quote&quot;&gt;&apos;they argued&apos;&lt;/span&gt;;
SELECT * FROM sasi WHERE bio LIKE &lt;span class=&quot;code-quote&quot;&gt;&apos;working at the company&apos;&lt;/span&gt;;
SELECT * FROM sasi WHERE bio LIKE &lt;span class=&quot;code-quote&quot;&gt;&apos;soft eng&apos;&lt;/span&gt;;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;All of them return 0 rows. The same happens at trunk. Maybe we can fix them in a new ticket.&lt;/p&gt;</comment>
                            <comment id="16953037" author="michaelsembwever" created="Wed, 16 Oct 2019 17:34:46 +0000"  >&lt;blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;if you look through the docs at &lt;a href=&quot;https://github.com/apache/cassandra/blob/trunk/doc/SASI.md&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/cassandra/blob/trunk/doc/SASI.md&lt;/a&gt; you see a few different use-cases.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;I am not quite sure what you mean.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I was only referring to the fact there was a few more variables that could be considered, and tested, eg the modes: &lt;tt&gt;PREFIX&lt;/tt&gt;, &lt;tt&gt;CONTAINS&lt;/tt&gt;, and &lt;tt&gt;SPARSE&lt;/tt&gt;; as well as the &lt;tt&gt;is_literal&lt;/tt&gt; option. There&apos;s more too, like the tokenisation stuff, but have left that out for now.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;I have run the demo queries in the doc and found these queries do not work as described (the &quot;Text Analysis&quot; section).&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;A new ticket indeed, please. This &lt;tt&gt;SASI.md&lt;/tt&gt; doc page should also be moved into the doc &lt;tt&gt;source/&lt;/tt&gt; tree so that it becomes part of the docs published on the website (but again a separate ticket).&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mazhenlin&quot; class=&quot;user-hover&quot; rel=&quot;mazhenlin&quot;&gt;mazhenlin&lt;/a&gt;, are you comfortable with the patch now? I will merge it once i get the ok from you.&lt;/p&gt;</comment>
                            <comment id="16953256" author="mazhenlin" created="Wed, 16 Oct 2019 23:03:44 +0000"  >&lt;p&gt;Yes , I am ok with that. Thank you again for all the comments . I have learned a lot during the discussion.&lt;/p&gt;</comment>
                            <comment id="16953426" author="michaelsembwever" created="Thu, 17 Oct 2019 06:01:16 +0000"  >&lt;blockquote&gt;&lt;p&gt;I have learned a lot during the discussion.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Same &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mazhenlin&quot; class=&quot;user-hover&quot; rel=&quot;mazhenlin&quot;&gt;mazhenlin&lt;/a&gt;. Thanks for finding and fixing the bug.&lt;/p&gt;</comment>
                            <comment id="16953432" author="michaelsembwever" created="Thu, 17 Oct 2019 06:11:27 +0000"  >&lt;p&gt;Committed as b20daee68d96cca7e23f5c2e83f687ba2f3b1852&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12972113" name="CASSANDRA-15169-v1.patch" size="2061" author="mazhenlin" created="Tue, 18 Jun 2019 16:00:21 +0000"/>
                            <attachment id="12982700" name="CASSANDRA-15169-v2.patch" size="4719" author="mazhenlin" created="Thu, 10 Oct 2019 15:51:14 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[mazhenlin]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12313825" key="com.atlassian.jira.plugin.system.customfieldtypes:cascadingselect">
                        <customfieldname>Bug Category</customfieldname>
                        <customfieldvalues>
                                                    <customfieldvalue key="12982" cascade-level=""><![CDATA[Correctness]]></customfieldvalue>
                                <customfieldvalue key="12988" cascade-level="1"><![CDATA[API / Semantic Implementation]]></customfieldvalue>
            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12313821" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Complexity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12965"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313822" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Discovered By</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12969"><![CDATA[User Report]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12313922" key="jira.plugin.projectspecificselectfield.jpssf:multicftype">
                        <customfieldname>Impacts</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="13100"><![CDATA[None]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            6 years, 4 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12313921" key="jira.plugin.projectspecificselectfield.jpssf:multicftype">
                        <customfieldname>Platform</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="13076"><![CDATA[All]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z03vaw:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[mck]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12962"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12311420" key="com.atlassian.jira.plugin.system.customfieldtypes:version">
                        <customfieldname>Since Version</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="12334622">3.4</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313924" key="com.atlassian.jira.plugin.system.customfieldtypes:textfield">
                        <customfieldname>Source Control Link</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>&lt;p&gt;&lt;a href=&quot;https://github.com/apache/cassandra/commit/b20daee68d96cca7e23f5c2e83f687ba2f3b1852&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/cassandra/commit/b20daee68d96cca7e23f5c2e83f687ba2f3b1852&lt;/a&gt;&lt;/p&gt;</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313823" key="com.atlassian.jira.plugin.system.customfieldtypes:textarea">
                        <customfieldname>Test and Documentation Plan</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>&lt;p&gt;unit test&lt;/p&gt;</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>