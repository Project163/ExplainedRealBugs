<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 22:41:24 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-6140] Cassandra-cli backward compatibility issue with Cassandra 2.0.1</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-6140</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;Currently we are using Cassandra 1.2.6 and we want to migrate to 2.0.1.&lt;/p&gt;

&lt;p&gt; We still use Thrift for some column families (migration to CQL3 is not done yet for them). We have cassandra-cli script to drop/create fresh keyspace, re-create column families and populate referential data:&lt;/p&gt;

&lt;p&gt;&lt;b&gt;Schema creation script&lt;/b&gt;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;drop keyspace xxx;
create keyspace xxx with placement_strategy ...

create column family offers with 
key_validation_class = UTF8Type and
comparator = &lt;span class=&quot;code-quote&quot;&gt;&apos;CompositeType(UTF8Type)&apos;&lt;/span&gt;  and 
default_validation_class = UTF8Type;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;b&gt;Data insertion script&lt;/b&gt;:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;set offers[&lt;span class=&quot;code-quote&quot;&gt;&apos;OFFER1&apos;&lt;/span&gt;][PRODUCT1&lt;span class=&quot;code-quote&quot;&gt;&apos;]=&apos;&lt;/span&gt;test_product&apos;;
...
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt; When executing the data insertion script with Cassandra 2.0.1, we have the following stack trace:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;Invalid cell &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; CQL3 table offers. The CQL3 column component (COL1) does not correspond to a defined CQL3 column
InvalidRequestException(why:Invalid cell &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; CQL3 table offers. The CQL3 column component (COL1) does not correspond to a defined CQL3 column)
	at org.apache.cassandra.thrift.Cassandra$insert_result$insert_resultStandardScheme.read(Cassandra.java:21447)
	at org.apache.cassandra.thrift.Cassandra$insert_result$insert_resultStandardScheme.read(Cassandra.java:21433)
	at org.apache.cassandra.thrift.Cassandra$insert_result.read(Cassandra.java:21367)
	at org.apache.thrift.TServiceClient.receiveBase(TServiceClient.java:78)
	at org.apache.cassandra.thrift.Cassandra$Client.recv_insert(Cassandra.java:898)
	at org.apache.cassandra.thrift.Cassandra$Client.insert(Cassandra.java:882)
	at org.apache.cassandra.cli.CliClient.executeSet(CliClient.java:987)
	at org.apache.cassandra.cli.CliClient.executeCLIStatement(CliClient.java:231)
	at org.apache.cassandra.cli.CliMain.processStatementInteractive(CliMain.java:201)
	at org.apache.cassandra.cli.CliMain.main(CliMain.java:327)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt; This data insertion script works pecfectly with Cassandra 1.2.6.&lt;/p&gt;

&lt;p&gt; We face the same issue with Cassandra 2.0.0. It looks like the cassandra-cli commands no longer works with Cassandra 2.0.0...&lt;/p&gt;


</description>
                <environment>&lt;p&gt;Linux Ubuntu, Cassandra 2.0.0&lt;/p&gt;</environment>
        <key id="12672150">CASSANDRA-6140</key>
            <summary>Cassandra-cli backward compatibility issue with Cassandra 2.0.1</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10002" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Normal</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="slebresne">Sylvain Lebresne</assignee>
                                    <reporter username="doanduyhai">DuyHai Doan</reporter>
                        <labels>
                    </labels>
                <created>Thu, 3 Oct 2013 14:59:31 +0000</created>
                <updated>Tue, 16 Apr 2019 09:32:03 +0000</updated>
                            <resolved>Tue, 5 Nov 2013 18:18:47 +0000</resolved>
                                        <fixVersion>2.0.3</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="13800743" author="jbellis" created="Mon, 21 Oct 2013 15:39:32 +0000"  >&lt;p&gt;Can you try 2.0 HEAD?&lt;/p&gt;</comment>
                            <comment id="13811922" author="doanduyhai" created="Sat, 2 Nov 2013 09:34:22 +0000"  >&lt;p&gt;I just pull Cassandra from github and tried with trunk (cassandra-2.1-SNAPSHOT) and also with branch cassandra-2.0, same result.&lt;/p&gt;

&lt;p&gt; The stack trace is the same&lt;/p&gt;</comment>
                            <comment id="13812271" author="dbrosius" created="Sun, 3 Nov 2013 05:42:42 +0000"  >&lt;p&gt;Validation code thinks the table is a cql table, given this test&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt; isCQL3Table = metadata.hasCompositeComparator() &amp;amp;&amp;amp; !metadata.isDense() &amp;amp;&amp;amp; !metadata.isSuper();
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;and then fails, because there are no column names in the meta data&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;ColumnIdentifier columnId = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; ColumnIdentifier(CQL3ColumnName, composite.types.get(columnIndex));
&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (metadata.getColumnDefinition(columnId) == &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;)
     &lt;span class=&quot;code-keyword&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; org.apache.cassandra.exceptions.InvalidRequestException(&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;.format(&lt;span class=&quot;code-quote&quot;&gt;&quot;Invalid cell &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; CQL3 table %s. The CQL3 column component (%s) does not correspond to a defined CQL3 column&quot;&lt;/span&gt;, metadata.cfName, columnId));
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="13812275" author="dbrosius" created="Sun, 3 Nov 2013 05:58:26 +0000"  >&lt;p&gt;As an aside, is there a reason to allow a single component composite, as above:&lt;/p&gt;

&lt;p&gt;CompositeType(UTF8Type)&lt;/p&gt;</comment>
                            <comment id="13812302" author="doanduyhai" created="Sun, 3 Nov 2013 09:24:30 +0000"  >&lt;p&gt;&quot;As an aside, is there a reason to allow a single component composite&quot;&lt;/p&gt;

&lt;p&gt; Yes, we want to be able to query with strict inequality on &apos;PRODUCT&apos;, they are ordered by name&lt;/p&gt;</comment>
                            <comment id="13814021" author="slebresne" created="Tue, 5 Nov 2013 16:33:48 +0000"  >&lt;p&gt;The problem is that there is no definitive marker for a &quot;CQL3 table&quot; (in hindsight, adding a new CQL3 ColumnFamilyType for CQL3 table would have made things a lot easier, but it&apos;s possibly a bit late now). So we &quot;guess&quot; more than anything else if a table is really a CQL3 one and in that case we&apos;re wrong.  More precisely, the reason the code thinks it&apos;s a CQL3 table is because it looks exactly like the table that would have been defined by: &lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;CREATE TABLE (
  key text,
  column1 text,
  PRIMARY KEY (key, column1)
)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Anyway, I guess the simpler fix here is to only do validation on the thrift side when we&apos;re sure that the table can&apos;t have been created from thrift. That will be good enough in almost all cases, the case of tables having only a PRIMARY KEY and no other columns being the exception. Simple patch attached.&lt;/p&gt;</comment>
                            <comment id="13814042" author="iamaleksey" created="Tue, 5 Nov 2013 16:58:44 +0000"  >&lt;p&gt;+1&lt;/p&gt;</comment>
                            <comment id="13814091" author="slebresne" created="Tue, 5 Nov 2013 18:18:47 +0000"  >&lt;p&gt;Committed, thanks&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12612202" name="6140.txt" size="1069" author="slebresne" created="Tue, 5 Nov 2013 16:33:48 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[slebresne]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>351776</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            12 years, 3 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1ongn:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>352064</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12311421" key="com.atlassian.jira.plugin.system.customfieldtypes:multiversion">
                        <customfieldname>Reproduced In</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="12324542">2.0.1</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>aleksey</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[aleksey]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12962"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12311420" key="com.atlassian.jira.plugin.system.customfieldtypes:version">
                        <customfieldname>Since Version</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="12324629">2.0.0</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>