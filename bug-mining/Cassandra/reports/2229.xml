<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 22:39:10 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-5342] ancestors are not cleared in SSTableMetadata after compactions are done and old SSTables are removed</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-5342</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;We are using LCS and have total of 38000 SSTables for one CF. During LCS, there could be over a thousand SSTable involved. All those SSTable IDs are stored in ancestors field of SSTableMetatdata for the new table. In our case, it consumes more than 1G of heap memory for those field. Put it in perspective, the ancestors consume 2 - 3 times more memory than bloomfilter (fp = 0.1 by default) in LCS. &lt;br/&gt;
We should remove those ancestors from SSTableMetadata after the compaction is finished and the old SSTable is removed. It  might be a big deal for Sized Compaction since there are small number of SSTable involved. But it consumes a lot of memory for LCS. &lt;br/&gt;
At least, we shouldn&apos;t load those ancestors to the memory during startup if the files are removed. &lt;br/&gt;
I would love to contribute and provide patch. Please let me know how to start. &lt;/p&gt;</description>
                <environment></environment>
        <key id="12636841">CASSANDRA-5342</key>
            <summary>ancestors are not cleared in SSTableMetadata after compactions are done and old SSTables are removed</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10002" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Normal</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="marcuse">Marcus Eriksson</assignee>
                                    <reporter username="weizhu">Wei Zhu</reporter>
                        <labels>
                            <label>lcs</label>
                    </labels>
                <created>Wed, 13 Mar 2013 19:02:09 +0000</created>
                <updated>Tue, 16 Apr 2019 09:32:16 +0000</updated>
                            <resolved>Mon, 8 Jul 2013 10:10:29 +0000</resolved>
                                        <fixVersion>1.2.7</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="13601546" author="yukim" created="Wed, 13 Mar 2013 19:48:21 +0000"  >&lt;p&gt;Ancestors are used to track compaction leftovers. We are implementing better way to achieve that in &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-5151&quot; title=&quot;Implement better way of eliminating compaction left overs.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-5151&quot;&gt;&lt;del&gt;CASSANDRA-5151&lt;/del&gt;&lt;/a&gt; using system table.&lt;/p&gt;</comment>
                            <comment id="13666384" author="jbellis" created="Fri, 24 May 2013 15:03:42 +0000"  >&lt;p&gt;(Setting affects-version to 1.1.3, where it was introduced by &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-4436&quot; title=&quot;Counters in columns don&amp;#39;t preserve correct values after cluster restart&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-4436&quot;&gt;&lt;del&gt;CASSANDRA-4436&lt;/del&gt;&lt;/a&gt;.)&lt;/p&gt;</comment>
                            <comment id="13666386" author="jbellis" created="Fri, 24 May 2013 15:06:19 +0000"  >&lt;p&gt;WDYT &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=krummas&quot; class=&quot;user-hover&quot; rel=&quot;krummas&quot;&gt;krummas&lt;/a&gt;?&lt;/p&gt;</comment>
                            <comment id="13667085" author="krummas" created="Sat, 25 May 2013 14:25:47 +0000"  >&lt;p&gt;have not really followed #5151 so these is my quite out-of-context thoughts:&lt;/p&gt;

&lt;p&gt;as far as i can see they are only read during startup, maybe we could not keep a reference to them after flushing the metadata, and then reading them on startup only to be able to remove the compaction leftovers? and then clear them out the same way we mutate sstable level?&lt;/p&gt;

&lt;p&gt;i could have a go&lt;/p&gt;</comment>
                            <comment id="13667130" author="jbellis" created="Sat, 25 May 2013 16:31:02 +0000"  >&lt;p&gt;Yeah, it sounds easy enough in principle, but it might get messy in practice since we&apos;ve had this &quot;immutable SSTableMetadata&quot; concept.&lt;/p&gt;</comment>
                            <comment id="13689031" author="krummas" created="Thu, 20 Jun 2013 08:56:05 +0000"  >&lt;p&gt;removes ancestors from SSTableMetadata and instead makes deserialize(..) return a Pair&amp;lt;SSTM, Set&amp;lt;Integer&amp;gt;&amp;gt; so that the caller can decide if the ancestors are needed. This allows us to keep SSTM as immutable as possible.&lt;/p&gt;

&lt;p&gt;this forces us to re-deserialize the metadata when trying to figure out ancestors during compaction&lt;/p&gt;

&lt;p&gt;opted not to mutate the ancestors on-disk since it makes my skin crawl&lt;/p&gt;</comment>
                            <comment id="13689282" author="krummas" created="Thu, 20 Jun 2013 14:35:21 +0000"  >&lt;p&gt;use Pair.create...&lt;/p&gt;</comment>
                            <comment id="13701217" author="jbellis" created="Sat, 6 Jul 2013 01:10:13 +0000"  >&lt;p&gt;LGTM.&lt;/p&gt;

&lt;p&gt;Nit: since we only ever use either the metadata, or the anscestors, it may be cleaner to split deserializeAncestors into a separate method.  OTOH that might make it easier to make mistakes in compatibility.  I&apos;m fine either way.&lt;/p&gt;</comment>
                            <comment id="13701912" author="krummas" created="Mon, 8 Jul 2013 10:10:15 +0000"  >&lt;p&gt;thanks, committed as 83b75754ff143d4d77b01ef76a813da47779c6f4&lt;/p&gt;

&lt;p&gt;opted to leave the Pair in, no strong feelings either&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12588846" name="0001-CASSANDRA-5342-wip-v2.patch" size="11998" author="marcuse" created="Thu, 20 Jun 2013 14:35:21 +0000"/>
                            <attachment id="12588796" name="0001-CASSANDRA-5342-wip.patch" size="12283" author="marcuse" created="Thu, 20 Jun 2013 08:56:05 +0000"/>
                            <attachment id="12573558" name="Screen Shot 2013-03-13 at 12.05.08 PM.png" size="230029" author="weizhu" created="Wed, 13 Mar 2013 19:17:22 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[marcuse]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>317333</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            12 years, 20 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1ir8n:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>317674</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12962"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>