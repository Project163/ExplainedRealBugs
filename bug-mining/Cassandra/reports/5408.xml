<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 23:16:12 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-15863] Bootstrap resume and TestReplaceAddress fixes</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-15863</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;This has been &lt;a href=&quot;https://ci-cassandra.apache.org/job/Cassandra-trunk/159/testReport/dtest-large.replace_address_test/TestReplaceAddress/test_restart_failed_replace/history/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;broken&lt;/a&gt; for ages&lt;/p&gt;</description>
                <environment></environment>
        <key id="13310172">CASSANDRA-15863</key>
            <summary>Bootstrap resume and TestReplaceAddress fixes</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10002" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Normal</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="bereng">Berenguer Blasi</assignee>
                                    <reporter username="bereng">Berenguer Blasi</reporter>
                        <labels>
                    </labels>
                <created>Mon, 8 Jun 2020 15:37:03 +0000</created>
                <updated>Sun, 3 Jan 2021 17:03:44 +0000</updated>
                            <resolved>Tue, 16 Jun 2020 17:45:28 +0000</resolved>
                                        <fixVersion>3.0.21</fixVersion>
                    <fixVersion>3.11.7</fixVersion>
                    <fixVersion>4.0-beta1</fixVersion>
                    <fixVersion>4.0</fixVersion>
                                    <component>Consistency/Bootstrap and Decommission</component>
                    <component>Test/dtest/python</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                    <progress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                            <timeestimate seconds="0">0h</timeestimate>
                            <timespent seconds="1200">20m</timespent>
                                <comments>
                            <comment id="17129285" author="bereng" created="Tue, 9 Jun 2020 13:43:51 +0000"  >&lt;p&gt;This seems to be both a test problem and a legit C* problem, so  moving to alpha&lt;/p&gt;</comment>
                            <comment id="17133115" author="bereng" created="Thu, 11 Jun 2020 10:03:34 +0000"  >&lt;p&gt;This ticket fixes a number of failures so here&apos;s some direction for reviewers:&lt;/p&gt;

&lt;p&gt;&lt;b&gt;test_resume_failed_replace, test_restart_failed_replace_with_reset_resume_state &amp;amp; test_resume_failed_replace&lt;/b&gt;&lt;/p&gt;

&lt;p&gt;This test fails waiting for &lt;a href=&quot;https://github.com/apache/cassandra/blob/trunk/src/java/org/apache/cassandra/transport/Server.java#L164&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;this&lt;/a&gt; log trace. This is never reached bc on the test we are failing bootstrap and thus it is being marked IN_PROGRESS. Hence the daemon won&apos;t go that far, we &lt;a href=&quot;https://github.com/apache/cassandra/blob/trunk/src/java/org/apache/cassandra/service/CassandraDaemon.java#L568&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;exit&lt;/a&gt; before we reach that point.&lt;/p&gt;

&lt;p&gt;The solution is to replace the nodes &lt;a href=&quot;https://github.com/apache/cassandra-dtest/pull/76/files#diff-271eb822afe096c34193f9071884d8beR482&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;without&lt;/a&gt; waiting for that log trace and checking in an &lt;a href=&quot;https://github.com/apache/cassandra-dtest/pull/76/files#diff-271eb822afe096c34193f9071884d8beR485&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;alternative&lt;/a&gt; way the bootstrap status.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&lt;b&gt;test_resume_failed_replace&lt;/b&gt;&lt;/p&gt;

&lt;p&gt;Once the above was fixed we would never hit the resume complete &lt;a href=&quot;https://github.com/apache/cassandra-dtest/pull/76/files#diff-271eb822afe096c34193f9071884d8beR507&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;log&lt;/a&gt;. This is bc &lt;tt&gt;StorageService#resumeBoostrap&lt;/tt&gt; &lt;a href=&quot;https://github.com/apache/cassandra/pull/622/files#diff-b76a607445d53f18a98c9df14323c7ddR1625&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;here&lt;/a&gt; would throw an exception starting the daemon. That exception was being swallowed, now it is getting logged. Also I had to add a native transport &lt;a href=&quot;https://github.com/apache/cassandra/pull/622/files#diff-b76a607445d53f18a98c9df14323c7ddR1623&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;init&lt;/a&gt; to avoid said exception and the daemon to start correctly. I am worried about any side effects of this extra native transport init, so sbdy with a broader knowledge of the codebase should chime in.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&lt;b&gt;test_replace_nonexistent_node, test_replace_first_boot, test_replace_shutdown_node &amp;amp; test_replace_stopped_node&lt;/b&gt;&lt;/p&gt;

&lt;p&gt;These in the end turned out to be failures based on the logging messages having changed throughout versions.&lt;/p&gt;</comment>
                            <comment id="17137790" author="brandon.williams" created="Tue, 16 Jun 2020 17:45:28 +0000"  >&lt;p&gt;Thanks, committed.  I will note though that your 3.11 branch and beyond would not compile because your call to finishJoiningRing did not include the boolean (which 3.0 does not have.)  I added that on commit.&lt;/p&gt;</comment>
                            <comment id="17138215" author="bereng" created="Wed, 17 Jun 2020 08:01:19 +0000"  >&lt;p&gt;Whaaat? impossible &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; I had to compile all the branches locally many times to run the dtests locally. I just &lt;tt&gt;git clean -xfd&lt;/tt&gt; and it compiles perfectly for me. Also i.e. the 4.0 PR has the &lt;a href=&quot;https://github.com/apache/cassandra/pull/622/files#diff-b76a607445d53f18a98c9df14323c7ddR1620&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;right boolean&lt;/a&gt; if I am following you correctly.&lt;/p&gt;

&lt;p&gt;Might this be a GH bug? The boolean is present in the &lt;a href=&quot;https://github.com/apache/cassandra/pull/622/commits/2d451c68e280ea8ba2e5580ce780d1079e19dfd0#diff-b76a607445d53f18a98c9df14323c7ddR1620&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;commit&lt;/a&gt; but not in that commit&apos;s &lt;a href=&quot;https://github.com/apache/cassandra/commit/2d451c68e280ea8ba2e5580ce780d1079e19dfd0.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;patch&lt;/a&gt;! :mindblown: and scary!&lt;/p&gt;</comment>
                            <comment id="17138606" author="brandon.williams" created="Wed, 17 Jun 2020 16:04:01 +0000"  >&lt;p&gt;And indeed, I grabbed the patch.  Also, I don&apos;t see it here: &lt;a href=&quot;https://github.com/apache/cassandra/pull/622/commits/c6b87ee779e3e1e6d74b80eafe48b99175a7af1a#diff-b76a607445d53f18a98c9df14323c7ddR1331&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/cassandra/pull/622/commits/c6b87ee779e3e1e6d74b80eafe48b99175a7af1a#diff-b76a607445d53f18a98c9df14323c7ddR1331&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Scary and strange, indeed.&lt;/p&gt;</comment>
                            <comment id="17139173" author="bereng" created="Thu, 18 Jun 2020 07:37:57 +0000"  >&lt;p&gt;Ok so after some investigation by a git master friend of mine... That is a merge commit. When you click on GH on the commit if shows you the &lt;em&gt;diff&lt;/em&gt; with the topmost parent, hence we get the right code. When you append &apos;.patch&apos; you get the patch for that &lt;em&gt;commit&lt;/em&gt;, not for the &lt;em&gt;diff&lt;/em&gt; as you were seeing before. So... not nice GH, not nice...&lt;/p&gt;</comment>
                            <comment id="17141986" author="adelapena" created="Mon, 22 Jun 2020 12:25:14 +0000"  >&lt;p&gt;It seems that 3.0 doesn&apos;t merge cleanly into 3.11 after this, there are conflicts in that call to &lt;tt&gt;StorageService#finishJoiningRing&lt;/tt&gt;&#160;and in &lt;tt&gt;CHANGES.txt&lt;/tt&gt;.&lt;/p&gt;</comment>
                            <comment id="17142020" author="bereng" created="Mon, 22 Jun 2020 13:02:56 +0000"  >&lt;p&gt;Probably the GH foxing we found. &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=brandon.williams&quot; class=&quot;user-hover&quot; rel=&quot;brandon.williams&quot;&gt;brandon.williams&lt;/a&gt; anything I can help with let me know as I&apos;m not a committer.&lt;/p&gt;</comment>
                            <comment id="17142062" author="brandon.williams" created="Mon, 22 Jun 2020 14:01:07 +0000"  >&lt;p&gt;I merged everything up.&lt;/p&gt;</comment>
                            <comment id="17142101" author="adelapena" created="Mon, 22 Jun 2020 14:29:55 +0000"  >&lt;p&gt;Great, thanks&#160;&lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/thumbs_up.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[bereng]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12313825" key="com.atlassian.jira.plugin.system.customfieldtypes:cascadingselect">
                        <customfieldname>Bug Category</customfieldname>
                        <customfieldvalues>
                                                    <customfieldvalue key="12982" cascade-level=""><![CDATA[Correctness]]></customfieldvalue>
                                <customfieldvalue key="12990" cascade-level="1"><![CDATA[Test Failure]]></customfieldvalue>
            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12313821" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Complexity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12965"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313822" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Discovered By</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12970"><![CDATA[Unit Test]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12313922" key="jira.plugin.projectspecificselectfield.jpssf:multicftype">
                        <customfieldname>Impacts</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="13100"><![CDATA[None]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            5 years, 21 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12313921" key="jira.plugin.projectspecificselectfield.jpssf:multicftype">
                        <customfieldname>Platform</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="13076"><![CDATA[All]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0fmtk:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[brandon.williams]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12962"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12311420" key="com.atlassian.jira.plugin.system.customfieldtypes:version">
                        <customfieldname>Since Version</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="12333891">3.0.0</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313924" key="com.atlassian.jira.plugin.system.customfieldtypes:textfield">
                        <customfieldname>Source Control Link</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>&lt;p&gt;&lt;a href=&quot;https://github.com/apache/cassandra/commit/eacdfc4978547b8e7be06c9ba9611c29963e6cc2&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/cassandra/commit/eacdfc4978547b8e7be06c9ba9611c29963e6cc2&lt;/a&gt;&lt;/p&gt;</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313823" key="com.atlassian.jira.plugin.system.customfieldtypes:textarea">
                        <customfieldname>Test and Documentation Plan</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>&lt;p&gt;See PR&lt;/p&gt;</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>