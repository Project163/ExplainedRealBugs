<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 22:14:24 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-1310] Disallow KS definition with RF &gt; # of nodes</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-1310</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;Cassandra 0.7 allows user to create Keyspaces with Replication Factor &amp;gt;  number of endpoints causing in java.lang.IllegalStateException: replication factor (2) exceeds number of endpoints (1) exception in nodetool and Internal Errors on Thrift making the node useless.&lt;/p&gt;

&lt;p&gt;Steps to Reproduce:&lt;/p&gt;

&lt;p&gt;From a clean setup of Cassandra:&lt;br/&gt;
1. Start a single node out of cluster of 3. This means my configuration has the other two nodes in the seeds list, but have not restarted them yet;&lt;br/&gt;
2. Use Thrift API (I am using PHP) and create a Keyspace with replication factor 2;&lt;br/&gt;
3. The command executes with no exception or error;&lt;br/&gt;
4. Now try writing to it, you will get TException with Internal Error message;&lt;br/&gt;
5. Try nodetool ring and you will get Exception:&lt;/p&gt;

&lt;p&gt;Exception in thread &quot;main&quot; java.lang.IllegalStateException: replication factor (2) exceeds number of endpoints (1)&lt;br/&gt;
	at org.apache.cassandra.locator.RackUnawareStrategy.calculateNaturalEndpoints(RackUnawareStrategy.java:61)&lt;br/&gt;
	at org.apache.cassandra.locator.AbstractReplicationStrategy.getNaturalEndpoints(AbstractReplicationStrategy.java:87)&lt;br/&gt;
	at org.apache.cassandra.service.StorageService.constructRangeToEndpointMap(StorageService.java:536)&lt;br/&gt;
	at org.apache.cassandra.service.StorageService.getRangeToAddressMap(StorageService.java:522)&lt;br/&gt;
	at org.apache.cassandra.service.StorageService.getRangeToEndpointMap(StorageService.java:496)&lt;br/&gt;
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)&lt;br/&gt;
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:57)&lt;br/&gt;
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)&lt;br/&gt;
	at java.lang.reflect.Method.invoke(Method.java:616)&lt;br/&gt;
	at com.sun.jmx.mbeanserver.StandardMBeanIntrospector.invokeM2(StandardMBeanIntrospector.java:111)&lt;br/&gt;
	at com.sun.jmx.mbeanserver.StandardMBeanIntrospector.invokeM2(StandardMBeanIntrospector.java:45)&lt;br/&gt;
	at com.sun.jmx.mbeanserver.MBeanIntrospector.invokeM(MBeanIntrospector.java:226)&lt;br/&gt;
	at com.sun.jmx.mbeanserver.PerInterface.invoke(PerInterface.java:138)&lt;br/&gt;
	at com.sun.jmx.mbeanserver.MBeanSupport.invoke(MBeanSupport.java:251)&lt;br/&gt;
	at com.sun.jmx.interceptor.DefaultMBeanServerInterceptor.invoke(DefaultMBeanServerInterceptor.java:857)&lt;br/&gt;
	at com.sun.jmx.mbeanserver.JmxMBeanServer.invoke(JmxMBeanServer.java:795)&lt;br/&gt;
	at javax.management.remote.rmi.RMIConnectionImpl.doOperation(RMIConnectionImpl.java:1449)&lt;br/&gt;
	at javax.management.remote.rmi.RMIConnectionImpl.access$200(RMIConnectionImpl.java:90)&lt;br/&gt;
	at javax.management.remote.rmi.RMIConnectionImpl$PrivilegedOperation.run(RMIConnectionImpl.java:1284)&lt;br/&gt;
	at javax.management.remote.rmi.RMIConnectionImpl.doPrivilegedOperation(RMIConnectionImpl.java:1382)&lt;br/&gt;
	at javax.management.remote.rmi.RMIConnectionImpl.invoke(RMIConnectionImpl.java:807)&lt;br/&gt;
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)&lt;br/&gt;
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:57)&lt;br/&gt;
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)&lt;br/&gt;
	at java.lang.reflect.Method.invoke(Method.java:616)&lt;br/&gt;
	at sun.rmi.server.UnicastServerRef.dispatch(UnicastServerRef.java:322)&lt;br/&gt;
	at sun.rmi.transport.Transport$1.run(Transport.java:177)&lt;br/&gt;
	at java.security.AccessController.doPrivileged(Native Method)&lt;br/&gt;
	at sun.rmi.transport.Transport.serviceCall(Transport.java:173)&lt;br/&gt;
	at sun.rmi.transport.tcp.TCPTransport.handleMessages(TCPTransport.java:553)&lt;br/&gt;
	at sun.rmi.transport.tcp.TCPTransport$ConnectionHandler.run0(TCPTransport.java:808)&lt;br/&gt;
	at sun.rmi.transport.tcp.TCPTransport$ConnectionHandler.run(TCPTransport.java:667)&lt;br/&gt;
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1110)&lt;br/&gt;
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:603)&lt;br/&gt;
	at java.lang.Thread.run(Thread.java:636)&lt;/p&gt;

&lt;p&gt;Expected:&lt;/p&gt;

&lt;p&gt;1. Either step 3 should not let you create the KS with RF 2 and 1 node in ring, or there should be a peaceful way for Cassandra to recover from IllegalStateException and replicate once other nodes become available.&lt;/p&gt;</description>
                <environment>&lt;p&gt;CentOS 5.1&lt;br/&gt;
Trunc July 22nd&lt;/p&gt;</environment>
        <key id="12469974">CASSANDRA-1310</key>
            <summary>Disallow KS definition with RF &gt; # of nodes</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10002" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Normal</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="zznate">Nate McCall</assignee>
                                    <reporter username="arya">Arya Goudarzi</reporter>
                        <labels>
                    </labels>
                <created>Fri, 23 Jul 2010 01:15:44 +0000</created>
                <updated>Tue, 16 Apr 2019 09:33:20 +0000</updated>
                            <resolved>Thu, 29 Jul 2010 15:59:43 +0000</resolved>
                                        <fixVersion>0.7 beta 1</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                                                                <comments>
                            <comment id="12892213" author="zznate" created="Mon, 26 Jul 2010 08:34:29 +0000"  >&lt;p&gt;Patch validates on RF being less than the number of nodes and that the KsDef.name and CsDef.keyspace match when providing a KsDef to system_add_keyspace on CassandraServer&lt;/p&gt;</comment>
                            <comment id="12892395" author="zznate" created="Mon, 26 Jul 2010 18:02:51 +0000"  >&lt;p&gt;Removed thrift validation method as nothing else really needs to validate on KsDef &lt;/p&gt;</comment>
                            <comment id="12892802" author="gdusbabek" created="Tue, 27 Jul 2010 14:48:59 +0000"  >&lt;p&gt;I think we should allow the creation of keyspaces even when there aren&apos;t enough nodes to support the specified replication factor.  For example, it should be allowable for an operator to bring up a single node in a new cluster, define all the keyspaces and then start bringing up new nodes to populate the cluster.&lt;/p&gt;

&lt;p&gt;Throwing IllegalStateException is a special case that should probably be handled in NodeTool (gently output the error string and die).&lt;/p&gt;</comment>
                            <comment id="12892839" author="zznate" created="Tue, 27 Jul 2010 16:32:35 +0000"  >&lt;p&gt;That makes sense to me. I would like to have a check on CsDef.keyspace = KsDef.name though. I hit that in a test case and it cause a really obtuse NPE. &lt;/p&gt;</comment>
                            <comment id="12893367" author="gdusbabek" created="Wed, 28 Jul 2010 21:14:02 +0000"  >&lt;p&gt;Nate: feel free to resubmit the patch for keyspace checks.  Also, having nodetool print just the error (not the whole stack trace) might be more user-friendly.&lt;/p&gt;</comment>
                            <comment id="12893407" author="zznate" created="Wed, 28 Jul 2010 22:49:32 +0000"  >&lt;p&gt;Just validates CsDef vs. KsDef have the same keyspace. Includes NodeCmd patch that prints an error msg instead of the stack trace.&lt;/p&gt;</comment>
                            <comment id="12893676" author="gdusbabek" created="Thu, 29 Jul 2010 15:59:43 +0000"  >&lt;p&gt;committed.&lt;/p&gt;</comment>
                            <comment id="12894039" author="hudson" created="Fri, 30 Jul 2010 13:37:48 +0000"  >&lt;p&gt;Integrated in Cassandra #504 (See &lt;a href=&quot;http://hudson.zones.apache.org/hudson/job/Cassandra/504/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://hudson.zones.apache.org/hudson/job/Cassandra/504/&lt;/a&gt;)&lt;br/&gt;
    print a more friendly error when printRing gets IllegalState. Patch by Nate McCall, reviewed by Gary Dusbabek. &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-1310&quot; title=&quot;Disallow KS definition with RF &amp;gt; # of nodes&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-1310&quot;&gt;&lt;del&gt;CASSANDRA-1310&lt;/del&gt;&lt;/a&gt;&lt;br/&gt;
check for ks/cf keyspace name agreement. Patch by Nate McCall, reviewed by Gary Dusbabek. &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-1310&quot; title=&quot;Disallow KS definition with RF &amp;gt; # of nodes&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-1310&quot;&gt;&lt;del&gt;CASSANDRA-1310&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12450765" name="1310-v2.txt" size="2298" author="zznate" created="Wed, 28 Jul 2010 22:49:32 +0000"/>
                            <attachment id="12450497" name="trunk-1310.txt" size="1752" author="zznate" created="Mon, 26 Jul 2010 18:02:51 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[zznate]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>20074</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            15 years, 17 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0g4a7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>92124</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12962"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>