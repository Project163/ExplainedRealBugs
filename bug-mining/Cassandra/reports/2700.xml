<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 22:43:46 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-6857] SELECT DISTINCT with a LIMIT is broken by paging</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-6857</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;The paging for RangeSliceCommand only support the case where we count CQL3 rows . However, in the case of SELECT DISTINCT, we do actually want to use the &quot;count partitions, not CQL3 row&quot; path and that&apos;s currently broken when the paging commands are used (this was first reported on the &lt;a href=&quot;https://datastax-oss.atlassian.net/browse/JAVA-288&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;Java driver JIRA&lt;/a&gt; and there is a reproduction script there).&lt;/p&gt;</description>
                <environment></environment>
        <key id="12701500">CASSANDRA-6857</key>
            <summary>SELECT DISTINCT with a LIMIT is broken by paging</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10002" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Normal</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="slebresne">Sylvain Lebresne</assignee>
                                    <reporter username="slebresne">Sylvain Lebresne</reporter>
                        <labels>
                    </labels>
                <created>Fri, 14 Mar 2014 15:47:38 +0000</created>
                <updated>Tue, 16 Apr 2019 09:31:51 +0000</updated>
                            <resolved>Fri, 21 Mar 2014 18:09:30 +0000</resolved>
                                        <fixVersion>2.0.7</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="13935182" author="slebresne" created="Fri, 14 Mar 2014 16:01:14 +0000"  >&lt;p&gt;In theory, the problem is that PagedRangeCommand doesn&apos;t preserve the countCQ3Rows parameter of the original RangeSliceCommand. However, on 2.0, we can&apos;t add it as this is a breaking messaging protocol change. Fortunately, we can work around that easily enough, see the attached patch. I still attach a patch for 2.1 that &quot;does the right thing&quot; because that&apos;s less of a hack on the long run. Note that the QueryPagers change is a minor optimization that is not entirely related to the fix of this issue, but that&apos;s easy enough.&lt;/p&gt;</comment>
                            <comment id="13942298" author="thobbs" created="Thu, 20 Mar 2014 21:22:36 +0000"  >&lt;p&gt;The patches do seem to work (it was a little confusing that the 2.1 patch assumed the 2.0 patch was applied).&lt;/p&gt;

&lt;p&gt;I have a question, though.  You said the QueryPagers change was an optimization, but it appears to affect the correctness.  Without the QueryPagers change, the old behavior is still observed.  I&apos;m not 100% clear on why that is.  Can you explain?&lt;/p&gt;</comment>
                            <comment id="13943067" author="slebresne" created="Fri, 21 Mar 2014 14:01:47 +0000"  >&lt;blockquote&gt;&lt;p&gt;it was a little confusing that the 2.1 patch assumed the 2.0 patch was applied&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Sorry about that, that was not intentional tbh.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;You said the QueryPagers change was an optimization, but it appears to affect the correctness.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Yeah, but that&apos;s because I forgot something in the initial patch. I modified PagedRangeCommand.countCQL3Rows(), but the executeLocally() of the same class was ignoring it, having it hardcoded to true basically. Attaching v2 with that fixed (only of 2.0, provided we agree on the 2.1 version, I&apos;ll just make sure to have this including during the merge).&lt;/p&gt;

&lt;p&gt;Regarding QueryPagers, the change is in the mayNeedPaging() method. The method itself is an optimization, we use it to avoid using the paging code when we know we don&apos;t have because that&apos;s slightly faster, but truly, whether or not this method return true should never change correctness, otherwise that means we just have a bug in paging (as is the case and my first version wasn&apos;t complete) and this is hidding it.&lt;/p&gt;</comment>
                            <comment id="13943295" author="thobbs" created="Fri, 21 Mar 2014 17:46:03 +0000"  >&lt;p&gt;Thanks.  I thought something might be missing; that makes sense.&lt;/p&gt;

&lt;p&gt;It looks like some a ColumnFamilyStoreTest method needs to be updated for the 2.0 patch to compile (you just need to add the countCQL3Rows argument to two makeExtendedFilter() calls).  Other than that, +1.&lt;/p&gt;</comment>
                            <comment id="13943329" author="slebresne" created="Fri, 21 Mar 2014 18:09:30 +0000"  >&lt;p&gt;Committed (with the test compilation fixed), thanks&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12636022" name="6857-2.0-v2.txt" size="4655" author="slebresne" created="Fri, 21 Mar 2014 14:01:47 +0000"/>
                            <attachment id="12634735" name="6857-2.0.txt" size="2977" author="slebresne" created="Fri, 14 Mar 2014 16:01:14 +0000"/>
                            <attachment id="12634736" name="6857-2.1.txt" size="5852" author="slebresne" created="Fri, 14 Mar 2014 16:01:14 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[slebresne]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>379846</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            11 years, 35 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1tg5r:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>380131</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>thobbs</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[thobbs]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12962"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12311420" key="com.atlassian.jira.plugin.system.customfieldtypes:version">
                        <customfieldname>Since Version</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="12324629">2.0.0</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>