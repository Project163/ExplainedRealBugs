<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 22:56:25 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-9749] CommitLogReplayer continues startup after encountering errors</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-9749</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;There are a few places where the commit log recovery method either skips sections or just returns when it encounters errors.&lt;/p&gt;

&lt;p&gt;Specifically if it can&apos;t read the header here: &lt;a href=&quot;https://github.com/apache/cassandra/blob/trunk/src/java/org/apache/cassandra/db/commitlog/CommitLogReplayer.java#L298&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/cassandra/blob/trunk/src/java/org/apache/cassandra/db/commitlog/CommitLogReplayer.java#L298&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Or if there are compressor problems here: &lt;a href=&quot;https://github.com/apache/cassandra/blob/trunk/src/java/org/apache/cassandra/db/commitlog/CommitLogReplayer.java#L314&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/cassandra/blob/trunk/src/java/org/apache/cassandra/db/commitlog/CommitLogReplayer.java#L314&lt;/a&gt; and here: &lt;a href=&quot;https://github.com/apache/cassandra/blob/trunk/src/java/org/apache/cassandra/db/commitlog/CommitLogReplayer.java#L366&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/cassandra/blob/trunk/src/java/org/apache/cassandra/db/commitlog/CommitLogReplayer.java#L366&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Whether these are user-fixable or not, I think we should require more direct user intervention (ie: fix what&apos;s wrong, or remove the bad file and restart) since we&apos;re basically losing data.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12843239">CASSANDRA-9749</key>
            <summary>CommitLogReplayer continues startup after encountering errors</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10002" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Normal</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="dnk">Dmitry Konstantinov</assignee>
                                    <reporter username="bdeggleston">Blake Eggleston</reporter>
                        <labels>
                    </labels>
                <created>Tue, 7 Jul 2015 17:20:58 +0000</created>
                <updated>Wed, 15 Oct 2025 09:48:59 +0000</updated>
                            <resolved>Thu, 20 Aug 2015 18:33:10 +0000</resolved>
                                        <fixVersion>2.2.1</fixVersion>
                    <fixVersion>3.0 beta 1</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>12</watches>
                                                                                                                <comments>
                            <comment id="14618793" author="tjake" created="Wed, 8 Jul 2015 15:48:59 +0000"  >&lt;p&gt;We should be respecting the setting in the yaml commit_failure_policy&lt;/p&gt;</comment>
                            <comment id="14618999" author="mshuler" created="Wed, 8 Jul 2015 17:31:50 +0000"  >&lt;p&gt;Is this something that can be reproduced for testing?&lt;/p&gt;</comment>
                            <comment id="14619563" author="bdeggleston" created="Wed, 8 Jul 2015 23:18:08 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mshuler&quot; class=&quot;user-hover&quot; rel=&quot;mshuler&quot;&gt;mshuler&lt;/a&gt; here&apos;s a dtest PR demonstrating it: &lt;a href=&quot;https://github.com/riptano/cassandra-dtest/pull/375&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/riptano/cassandra-dtest/pull/375&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14620342" author="benedict" created="Thu, 9 Jul 2015 11:24:26 +0000"  >&lt;p&gt;See discussion on &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-7125&quot; title=&quot;Fail to start by default if Commit Log fails to validate any messages&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-7125&quot;&gt;CASSANDRA-7125&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14620457" author="tjake" created="Thu, 9 Jul 2015 12:56:45 +0000"  >&lt;blockquote&gt;&lt;p&gt;See discussion on &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-7125&quot; title=&quot;Fail to start by default if Commit Log fails to validate any messages&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-7125&quot;&gt;CASSANDRA-7125&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;It seems like the underlying issue is dealing with things like &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-7582&quot; title=&quot;2.1 multi-dc upgrade errors&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-7582&quot;&gt;&lt;del&gt;CASSANDRA-7582&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;My suggestion is we adhere to the commit_failure_policy.  For disk_failure_policy we respect it for both reads and writes. &lt;/p&gt;

&lt;p&gt;This seems like a issue in 2.1 not just 2.2 so perhaps we should fix it there first?  &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jbellis&quot; class=&quot;user-hover&quot; rel=&quot;jbellis&quot;&gt;jbellis&lt;/a&gt; do you have any input?&lt;/p&gt;</comment>
                            <comment id="14620509" author="blambov" created="Thu, 9 Jul 2015 13:38:41 +0000"  >&lt;p&gt;There are several more things to consider here:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;In a node powered off while flushing section to disk there will be a read or decompression error. This will be a very normal, frequently occurring situation. Do we stop/die for it?&lt;/li&gt;
	&lt;li&gt;Supposing there&apos;s bit rot and the operator does want to recover data in the other log sections in the same segment, he is now supposed to change commit log policy to &quot;ignore&quot; and boot up the cluster with that setting. Do we want to run the (quite substantial) risk the operator will not restart it again and the node stays in unintended &quot;ignore&quot; commit log policy?&lt;/li&gt;
	&lt;li&gt;As mentioned in &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-7125&quot; title=&quot;Fail to start by default if Commit Log fails to validate any messages&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-7125&quot;&gt;CASSANDRA-7125&lt;/a&gt;, how do we know a table is unknown rather than dropped?&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="14620536" author="jbellis" created="Thu, 9 Jul 2015 13:58:54 +0000"  >&lt;p&gt;We had a discussion about this a while ago on another ticket &amp;#8211; basically, there&apos;s absolutely nothing the user can do about it so there is not much point in refusing to continue.&lt;/p&gt;

&lt;p&gt;I don&apos;t think blurring the disk_failure_policy/commit_failure_policy mission statements is a good idea either.  These are supposed to be for IOException/IOError hardware failures of &quot;I couldn&apos;t read/write the data at all&quot; not &quot;I could read the data but it wasn&apos;t what I wanted.&quot;&lt;/p&gt;</comment>
                            <comment id="14620558" author="tjake" created="Thu, 9 Jul 2015 14:18:18 +0000"  >&lt;blockquote&gt;&lt;p&gt;here&apos;s absolutely nothing the user can do about it so there is not much point in refusing to continue.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Is there any precedence for this in other databases? Seems like a pretty serious choice for a database to make.  &lt;/p&gt;

&lt;p&gt;While we discuss this bigger issue can we at least log these as an error &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=blambov&quot; class=&quot;user-hover&quot; rel=&quot;blambov&quot;&gt;blambov&lt;/a&gt; ?&lt;/p&gt;</comment>
                            <comment id="14620567" author="JIRAUSER308715" created="Thu, 9 Jul 2015 14:22:14 +0000"  >&lt;p&gt;In the case of the compression type there is something the user can do, go find the jar file they forgot to put back after upgrading or something.  So at the very least if we see something compressed with a class we don&apos;t know about we should abort startup and tell the user to fix it.&lt;/p&gt;</comment>
                            <comment id="14620569" author="JIRAUSER308715" created="Thu, 9 Jul 2015 14:24:17 +0000"  >&lt;p&gt;Also there is something the user can do.  Wipe the node and re-bootstrap it.  This is the same choice we give people for reading corrupt sstables, they should have that choice for corrupt commit log as well.&lt;/p&gt;</comment>
                            <comment id="14620588" author="benedict" created="Thu, 9 Jul 2015 14:33:16 +0000"  >&lt;p&gt;Or they could just run repair for the node. But they need to first know there was a problem. As said on &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-7125&quot; title=&quot;Fail to start by default if Commit Log fails to validate any messages&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-7125&quot;&gt;CASSANDRA-7125&lt;/a&gt;, I do feel the &lt;em&gt;default&lt;/em&gt; behaviour for a database should be to fail to startup if there are CL errors - except, perhaps, for the very last portion of the last CL segment, which may not have been fully written to disk.&lt;/p&gt;</comment>
                            <comment id="14620843" author="bdeggleston" created="Thu, 9 Jul 2015 17:02:03 +0000"  >&lt;p&gt;I agree with &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=benedict&quot; class=&quot;user-hover&quot; rel=&quot;benedict&quot;&gt;benedict&lt;/a&gt;. If the CL has errors, I think the right thing to do would be to refuse to startup and instruct the operator to remove the bad segment, restart, then run a repair. Technically, the recovering node shouldn&apos;t participate in any paxos rounds until the repair is complete either.&lt;/p&gt;</comment>
                            <comment id="14621086" author="jbellis" created="Thu, 9 Jul 2015 19:04:54 +0000"  >&lt;p&gt;All right, let&apos;s go ahead and apply commit_failure_policy to this type of error.  Except the unsynced part of the last segment, as Benedict points out.&lt;/p&gt;</comment>
                            <comment id="14621114" author="benedict" created="Thu, 9 Jul 2015 19:24:42 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=blambov&quot; class=&quot;user-hover&quot; rel=&quot;blambov&quot;&gt;blambov&lt;/a&gt;: as suggested by Sylvain on &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-7125&quot; title=&quot;Fail to start by default if Commit Log fails to validate any messages&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-7125&quot;&gt;CASSANDRA-7125&lt;/a&gt;, it may be best to provide a command line override (that we can inform users of in the error message) for overriding the policy for replay only. So that your legitimate concern about a temporary override affecting production stability can avoided.&lt;/p&gt;</comment>
                            <comment id="14662335" author="blambov" created="Fri, 7 Aug 2015 19:59:07 +0000"  >&lt;p&gt;Patch uploaded &lt;a href=&quot;https://github.com/blambov/cassandra/tree/9749-2.2&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;here&lt;/a&gt;. Sends commit log errors through &lt;tt&gt;CommitLog.handleCommitError&lt;/tt&gt;. If the error is in the last segment (last sync section in the case of compressed logs), it is treated as one caused by incomplete flush and ignored. Also introduces a flag for ignoring replay errors without affecting the log failure policy. Any ignored problems are now logged as errors.&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;http://cassci.datastax.com/job/blambov-9749-2.2-testall/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;testall&lt;/a&gt; &lt;a href=&quot;http://cassci.datastax.com/job/blambov-9749-2.2-dtest/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;dtest&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="14682187" author="jbellis" created="Tue, 11 Aug 2015 18:06:54 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=aweisberg&quot; class=&quot;user-hover&quot; rel=&quot;aweisberg&quot;&gt;aweisberg&lt;/a&gt; to review&lt;/p&gt;</comment>
                            <comment id="14692326" author="aweisberg" created="Tue, 11 Aug 2015 21:57:11 +0000"  >&lt;p&gt;Boolean.getBoolean() can check the system property&lt;br/&gt;
&lt;a href=&quot;https://github.com/blambov/cassandra/commit/6311fe1c4e66a73f9035a6463686a5d87cf7577c#diff-348a1347dacf897385fb0a97116a1b5eR615&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/blambov/cassandra/commit/6311fe1c4e66a73f9035a6463686a5d87cf7577c#diff-348a1347dacf897385fb0a97116a1b5eR615&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;What is the motivation for changing this to warn? Is it going to cause operators concern that is unwarranted?&lt;br/&gt;
&lt;a href=&quot;https://github.com/blambov/cassandra/commit/6311fe1c4e66a73f9035a6463686a5d87cf7577c#diff-348a1347dacf897385fb0a97116a1b5eR154&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/blambov/cassandra/commit/6311fe1c4e66a73f9035a6463686a5d87cf7577c#diff-348a1347dacf897385fb0a97116a1b5eR154&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Do you have to make all those object arrays for handleReplayError? varargs won&apos;t handle it correctly?&lt;/p&gt;

&lt;p&gt;The changes look reasonable. Some of the error conditions that now are supposed to throw don&apos;t have unit test coverage. They weren&apos;t tested before either, but this an opportunity to make sure the errors work.&lt;/p&gt;</comment>
                            <comment id="14693685" author="blambov" created="Wed, 12 Aug 2015 15:32:15 +0000"  >&lt;p&gt;&lt;a href=&quot;https://github.com/blambov/cassandra/tree/9749-2.2&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;Branch&lt;/a&gt; updated.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;Boolean.getBoolean() can check the system property&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Done.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;What is the motivation for changing this to warn? Is it going to cause operators concern that is unwarranted?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;The patch includes a general heightening of the message severity for replay problems (what was warnings before are now errors, even when they are ignored). Let me know if you prefer to keep it as info.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;Do you have to make all those object arrays for handleReplayError? varargs won&apos;t handle it correctly?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Apparently eclipse does this when you ask it to inline a method with varargs. Fixed, apologies for not noticing it myself.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;Some of the error conditions that now are supposed to throw don&apos;t have unit test coverage. They weren&apos;t tested before either, but this an opportunity to make sure the errors work.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Fixed the existing tests which were only hitting the invalid descriptor path and added tests for the newer log formats that include a descriptor.&lt;/p&gt;</comment>
                            <comment id="14694039" author="aweisberg" created="Wed, 12 Aug 2015 19:21:13 +0000"  >&lt;p&gt;New code uses a lambda so it doesn&apos;t build in 2.2.&lt;/p&gt;</comment>
                            <comment id="14694971" author="blambov" created="Thu, 13 Aug 2015 09:50:14 +0000"  >&lt;p&gt;Fixed. &lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/blambov/job/blambov-9749-2.2-testall/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;testall&lt;/a&gt; &lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/blambov/job/blambov-9749-2.2-dtest/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;dtest&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14697382" author="aweisberg" created="Fri, 14 Aug 2015 17:03:30 +0000"  >&lt;p&gt;I am struggling here with where to draw the line for testing the code you worked on. I created CASANDRA-10080 for the missing coverage. I don&apos;t think code review and JIRA is the right venue for deciding whether you should go fill in more test coverage or not.&lt;/p&gt;

&lt;p&gt;There are instances of handleReplayError &lt;a href=&quot;https://github.com/apache/cassandra/compare/cassandra-2.2...blambov:9749-2.2#diff-348a1347dacf897385fb0a97116a1b5eR183&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;like this one&lt;/a&gt; that throw instead of logging or returning a value. I feel like even when trying to constrain scope those are things that need to be tested for the change to be done.&lt;/p&gt;

&lt;p&gt;So if you are super saturated with 3.0 work that has to be in (no opportunity to constrain scope) then this is +1. If you could legitimately spend more time on it and make sure the cases that throw that didn&apos;t used to are tested then do that first.&lt;/p&gt;</comment>
                            <comment id="14697484" author="blambov" created="Fri, 14 Aug 2015 18:15:31 +0000"  >&lt;blockquote&gt;&lt;p&gt;There are instances of handleReplayError like this one that throw instead of logging or returning a value. I feel like even when trying to constrain scope those are things that need to be tested for the change to be done.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;This path &lt;em&gt;is&lt;/em&gt; tested (e.g. &lt;tt&gt;testRecoveryWithBadSizeChecksum&lt;/tt&gt;, second &lt;tt&gt;runExpecting&lt;/tt&gt; call), as well as every other &lt;tt&gt;handleReplayError&lt;/tt&gt; callsite except &lt;a href=&quot;https://github.com/apache/cassandra/compare/trunk...blambov:9749-2.2#diff-348a1347dacf897385fb0a97116a1b5eR543&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;this&lt;/a&gt; which is not easily reachable. Most are tested by &lt;tt&gt;CommitLogTest&lt;/tt&gt;, the compression-specific ones are exercised by &lt;tt&gt;CommitLogUpgradeTest&lt;/tt&gt;.&lt;/p&gt;</comment>
                            <comment id="14697514" author="aweisberg" created="Fri, 14 Aug 2015 18:33:49 +0000"  >&lt;p&gt;Do I need to run the tests with specific settings to hit a compression path? I ran the tests and merged the results and it didn&apos;t make it all the way in.&lt;/p&gt;

&lt;p&gt;I attached the HTML coverage report I get. I don&apos;t have a better way to do this yet.&lt;/p&gt;

&lt;p&gt;Looking at the tests, it seems like they don&apos;t actually run. Some are missing the @Test annotation.&lt;/p&gt;</comment>
                            <comment id="14697541" author="blambov" created="Fri, 14 Aug 2015 18:48:53 +0000"  >&lt;p&gt;I have no idea why the coverage tool is lying. I was having the same problem and started looking at the logs; you can easily find the exceptions in the &lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/blambov/job/blambov-9749-2.2-testall/lastCompletedBuild/consoleText&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;cassci testall log&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="14697553" author="aweisberg" created="Fri, 14 Aug 2015 18:55:23 +0000"  >&lt;p&gt;Should &lt;a href=&quot;https://github.com/apache/cassandra/compare/cassandra-2.2...blambov:9749-2.2#diff-238274682889110497be5a5cb1eca986R143&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;this&lt;/a&gt; and &lt;a href=&quot;https://github.com/apache/cassandra/compare/cassandra-2.2...blambov:9749-2.2#diff-238274682889110497be5a5cb1eca986R153&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;this&lt;/a&gt; have an @Test annotation?&lt;/p&gt;

&lt;p&gt;You are correct about the coverage being wrong. I ran it in the debugger and it stops there. That&apos;s really unfortunate. I&apos;ll take a look at possible reasons why emma can get confused. &lt;/p&gt;

&lt;p&gt;If you work out the annotation issue then I am +1.&lt;/p&gt;</comment>
                            <comment id="14697558" author="blambov" created="Fri, 14 Aug 2015 19:02:41 +0000"  >&lt;p&gt;Done.&lt;/p&gt;</comment>
                            <comment id="14697565" author="aweisberg" created="Fri, 14 Aug 2015 19:09:39 +0000"  >&lt;p&gt;+1, sorry for the code coverage confusion.&lt;/p&gt;</comment>
                            <comment id="14697813" author="jbellis" created="Fri, 14 Aug 2015 21:40:37 +0000"  >&lt;p&gt;Merging to 2.2 sees a conflict in CommitLogTest, can you rebase?&lt;/p&gt;

&lt;p&gt;Edit: just a conflict of imports, I will fix on commit.&lt;/p&gt;</comment>
                            <comment id="14697830" author="jbellis" created="Fri, 14 Aug 2015 21:49:41 +0000"  >&lt;p&gt;... more conflicts merging to 3.0, not just to imports.  Can you provide a version for 3.0 as well?&lt;/p&gt;</comment>
                            <comment id="14699663" author="blambov" created="Mon, 17 Aug 2015 15:15:40 +0000"  >&lt;p&gt;Due to &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-8515&quot; title=&quot;Commit log stop policy not enforced correctly during startup&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-8515&quot;&gt;&lt;del&gt;CASSANDRA-8515&lt;/del&gt;&lt;/a&gt;, the effective commit log failure policy in 3.0+ at time of replay is always &apos;die&apos;. Changed the tests to reflect this and pushed &lt;a href=&quot;https://github.com/blambov/cassandra/tree/9749-3.0&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;a 3.0 version of the branch&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/blambov/job/blambov-9749-3.0-testall/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;testall&lt;/a&gt; &lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/blambov/job/blambov-9749-3.0-dtest/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;dtest&lt;/a&gt;.&lt;/p&gt;
</comment>
                            <comment id="14699667" author="aweisberg" created="Mon, 17 Aug 2015 15:18:47 +0000"  >&lt;p&gt;&lt;del&gt;That github link didn&apos;t work for me.&lt;/del&gt;&lt;br/&gt;
I lied, it works, but not from the email I got.&lt;/p&gt;</comment>
                            <comment id="14699695" author="aweisberg" created="Mon, 17 Aug 2015 15:36:52 +0000"  >&lt;p&gt;+1&lt;/p&gt;

&lt;p&gt;For observers, commit log replay errors can still be ignored using the property -Dcassandra.commitlog.ignorereplayerrors=true and the existence of the property is logged on failure so it isn&apos;t hard to chase down. We now just have fail fast always be the default no matter what user settings are.&lt;/p&gt;</comment>
                            <comment id="14699778" author="jbellis" created="Mon, 17 Aug 2015 16:25:27 +0000"  >&lt;blockquote&gt;&lt;p&gt;Due to &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-8515&quot; title=&quot;Commit log stop policy not enforced correctly during startup&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-8515&quot;&gt;&lt;del&gt;CASSANDRA-8515&lt;/del&gt;&lt;/a&gt;, the effective commit log failure policy in 3.0+ at time of replay is always &apos;die&apos;.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Hmm, was that intended? /cc &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=pauloricardomg&quot; class=&quot;user-hover&quot; rel=&quot;pauloricardomg&quot;&gt;pauloricardomg&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=benedict&quot; class=&quot;user-hover&quot; rel=&quot;benedict&quot;&gt;benedict&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14699803" author="benedict" created="Mon, 17 Aug 2015 16:46:51 +0000"  >&lt;p&gt;I cannot find where the conversation happened, so perhaps it was on IRC, but the consensus had shifted since we last discussed this over a year ago. There was wide support for failing on startup if the commit log is corrupted, and printing an error message for the user to opt into continuing in the face of those errors. iirc, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=aweisberg&quot; class=&quot;user-hover&quot; rel=&quot;aweisberg&quot;&gt;aweisberg&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=bdeggleston&quot; class=&quot;user-hover&quot; rel=&quot;bdeggleston&quot;&gt;bdeggleston&lt;/a&gt; and &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jjordan&quot; class=&quot;user-hover&quot; rel=&quot;jjordan&quot;&gt;jjordan&lt;/a&gt; were participants, amongst others, so perhaps they can corroborate this since I cannot find a reference.&lt;/p&gt;</comment>
                            <comment id="14699822" author="aweisberg" created="Mon, 17 Aug 2015 17:03:42 +0000"  >&lt;p&gt;I remember that conversation as well. Part of that was making an effort to distinguish between expected failures (end of log) and unexpected ones. I think there is going to be some pain there because it&apos;s really hard to tell the two apart.&lt;/p&gt;

&lt;p&gt;I am not dead set against stop as a default behavior for replay, I just don&apos;t think linking the two settings together &lt;del&gt;isn&apos;t&lt;/del&gt; is a good idea.&lt;/p&gt;

&lt;p&gt;Extra negatives were not intentional.&lt;/p&gt;</comment>
                            <comment id="14699826" author="benedict" created="Mon, 17 Aug 2015 17:05:21 +0000"  >&lt;blockquote&gt;&lt;p&gt;I just don&apos;t think linking the two settings together isn&apos;t a good idea.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;That was too many negatives for me to parse (and be confident you&apos;d typed correctly) &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;I&apos;ll note FTR I don&apos;t (and didn&apos;t) have a strong position on this.&lt;/p&gt;</comment>
                            <comment id="14700124" author="bdeggleston" created="Mon, 17 Aug 2015 19:53:26 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=benedict&quot; class=&quot;user-hover&quot; rel=&quot;benedict&quot;&gt;benedict&lt;/a&gt; I think most of that discussion occurred in the first 10 or so comments on this ticket. At least I don&apos;t remember there being another discussion outside of it.&lt;/p&gt;</comment>
                            <comment id="14701021" author="blambov" created="Tue, 18 Aug 2015 09:57:31 +0000"  >&lt;p&gt;Let me try to rephrase and simplify Jonathan&apos;s question:&lt;/p&gt;

&lt;p&gt;The original idea of this ticket was to let the commit log failure policy dictate what is done in the case of replay failures. Now that &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-8515&quot; title=&quot;Commit log stop policy not enforced correctly during startup&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-8515&quot;&gt;&lt;del&gt;CASSANDRA-8515&lt;/del&gt;&lt;/a&gt; is in place, this means that regardless of the failure policy the node will always refuse to start in the case of replay failures (unless they are in the last section of the last segment). This can be overridded using the &lt;tt&gt;cassandra.commitlog.ignorereplayerrors&lt;/tt&gt; flag.&lt;/p&gt;

&lt;p&gt;The question now is whether this is a good or sufficient solution, or should I invest time to override the &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-8515&quot; title=&quot;Commit log stop policy not enforced correctly during startup&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-8515&quot;&gt;&lt;del&gt;CASSANDRA-8515&lt;/del&gt;&lt;/a&gt; override so that the original failure policy can apply?&lt;/p&gt;

&lt;p&gt;My personal opinion is that it &lt;em&gt;is&lt;/em&gt; a proper solution. Any scenario I could imagine benefiting from e.g. the &apos;stop&apos; policy at log replay would also be better served by the same policy at log startup.&lt;/p&gt;</comment>
                            <comment id="14702267" author="jbellis" created="Wed, 19 Aug 2015 01:17:11 +0000"  >&lt;p&gt;SGTM, committed&lt;/p&gt;</comment>
                            <comment id="14703250" author="jmckenzie" created="Wed, 19 Aug 2015 16:10:26 +0000"  >&lt;p&gt;This commit breaks CommitLogTest on both Windows and Linux.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://cassci.datastax.com/view/cassandra-2.2/job/cassandra-2.2_utest/lastCompletedBuild/testReport/org.apache.cassandra.db.commitlog/CommitLogTest/testRecoveryWithIdMismatch/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;Error example&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;A revert of this commit fixes that. Did we not confirm with CI on this before committing?&lt;/p&gt;</comment>
                            <comment id="14703266" author="aweisberg" created="Wed, 19 Aug 2015 16:17:32 +0000"  >&lt;p&gt;We did. &lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/blambov/job/blambov-9749-2.2-testall/5/#showFailuresLink&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://cassci.datastax.com/view/Dev/view/blambov/job/blambov-9749-2.2-testall/5/#showFailuresLink&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Not sure what the story is. Maybe something changed in between?&lt;/p&gt;</comment>
                            <comment id="14703274" author="blambov" created="Wed, 19 Aug 2015 16:23:17 +0000"  >&lt;p&gt;The failures are caused by the change of behaviour from &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-8515&quot; title=&quot;Commit log stop policy not enforced correctly during startup&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-8515&quot;&gt;&lt;del&gt;CASSANDRA-8515&lt;/del&gt;&lt;/a&gt;. I will make a patch that fixes the test expectations shortly.&lt;/p&gt;</comment>
                            <comment id="14704365" author="blambov" created="Thu, 20 Aug 2015 06:24:49 +0000"  >&lt;p&gt;Test fix for 2.2 pushed &lt;a href=&quot;https://github.com/blambov/cassandra/tree/9749-2.2-testfix&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;here&lt;/a&gt;. &lt;a href=&quot;http://cassci.datastax.com/job/blambov-9749-2.2-testfix-testall/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;testall&lt;/a&gt; &lt;a href=&quot;http://cassci.datastax.com/job/blambov-9749-2.2-testfix-dtest/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;dtest&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14705125" author="iamaleksey" created="Thu, 20 Aug 2015 15:30:01 +0000"  >&lt;p&gt;3.0 is not affected right now, correct?&lt;/p&gt;</comment>
                            <comment id="14705382" author="aweisberg" created="Thu, 20 Aug 2015 17:39:35 +0000"  >&lt;p&gt;3.0 is not effected because the updated expectations were done when rebasing the change for 3.0.&lt;/p&gt;

&lt;p&gt;I think we are coming back now and updating the expectations in 2.2.&lt;/p&gt;

&lt;p&gt;The changes look good. This is just removing the tests that depended on the policy having an impact (which they don&apos;t anymore). Also some test refactoring. Cassci seems OK with it.&lt;/p&gt;

&lt;p&gt;+1&lt;/p&gt;</comment>
                            <comment id="14705514" author="iamaleksey" created="Thu, 20 Aug 2015 18:32:55 +0000"  >&lt;p&gt;Committed to cassandra-2.2 as &lt;a href=&quot;https://github.com/apache/cassandra/commit/7a85c8b8fbf753858c4334c4249475e6bb1a24e4&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;7a85c8b8fbf753858c4334c4249475e6bb1a24e4&lt;/a&gt; and merged --ours with 3.0 and trunk. Thanks.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12679572">CASSANDRA-6364</issuekey>
        </issuelink>
                            </outwardlinks>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12711580">CASSANDRA-7125</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12750573" name="9749-coverage.tgz" size="1271295" author="aweisberg" created="Fri, 14 Aug 2015 18:33:49 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[dnk]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 13 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2gy3z:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>aweisberg</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[aweisberg]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12962"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>