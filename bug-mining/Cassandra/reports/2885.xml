<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 22:45:43 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-7268] Secondary Index can miss data without an error</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-7268</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;Seeing issues with secondary indexes after upgrading from 1.1-&amp;gt;1.2.  Using the same thrift code from 1.1, every once in a while a row is inserted that does not show up in the secondary index on a text column.&lt;/p&gt;

&lt;p&gt;Using sstable2json we can see the row in the regular sstables on every node, but not in the secondary index sstables (even after flushing/taking a snapshot).&lt;/p&gt;

&lt;p&gt;If we move the snapshot to a test node and rebuild the secondary index, it gets populated correctly and returns the data.&lt;/p&gt;

&lt;p&gt;Sanitized create statement:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;create column family test2i 
with column_type = &apos;Standard&apos; 
and comparator = &apos;UTF8Type&apos; 
and default_validation_class = &apos;UTF8Type&apos; 
and key_validation_class = &apos;UTF8Type&apos; 
and read_repair_chance = 1.0 
and dclocal_read_repair_chance = 0.0 
and populate_io_cache_on_flush = false 
and gc_grace = 0 
and min_compaction_threshold = 4 
and max_compaction_threshold = 32 
and replicate_on_write = false 
and compaction_strategy = &apos;org.apache.cassandra.db.compaction.LeveledCompactionStrategy&apos; 
and caching = &apos;KEYS_ONLY&apos; 
and column_metadata = [ 
{column_name : &apos;second&apos;, 
validation_class : UTF8Type, 
index_name : &apos;test2i_second_idx&apos;, 
index_type : 0}, 
{column_name : &apos;A&apos;, 
validation_class : UTF8Type}, 
{column_name : &apos;B&apos;, 
validation_class : UTF8Type}, 
{column_name : &apos;C&apos;, 
validation_class : UTF8Type}, 
{column_name : &apos;D&apos;, 
validation_class : UTF8Type}, 
{column_name : &apos;E&apos;, 
validation_class : UTF8Type}, 
{column_name : &apos;F&apos;, 
validation_class : UTF8Type}, 
{column_name : &apos;G&apos;, 
validation_class : UTF8Type}, 
{column_name : &apos;H&apos;, 
validation_class : UTF8Type}, 
{column_name : &apos;I&apos;, 
validation_class : UTF8Type}, 
{column_name : &apos;J&apos;, 
validation_class : UTF8Type}, 
{column_name : &apos;K&apos;, 
validation_class : UTF8Type}, 
{column_name : &apos;L&apos;, 
validation_class : UTF8Type}, 
{column_name : &apos;M&apos;, 
validation_class : UTF8Type}] 
and compression_options = {&apos;sstable_compression&apos; : &apos;org.apache.cassandra.io.compress.SnappyCompressor&apos;};
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="12715321">CASSANDRA-7268</key>
            <summary>Secondary Index can miss data without an error</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10002" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Normal</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="samt">Sam Tunnicliffe</assignee>
                                    <reporter username="jeremiah">Jeremiah Jordan</reporter>
                        <labels>
                    </labels>
                <created>Mon, 19 May 2014 23:23:13 +0000</created>
                <updated>Tue, 14 Oct 2025 12:13:56 +0000</updated>
                            <resolved>Wed, 18 Jun 2014 00:43:56 +0000</resolved>
                                        <fixVersion>1.2.17</fixVersion>
                    <fixVersion>2.0.9</fixVersion>
                    <fixVersion>2.1 rc2</fixVersion>
                                    <component>Feature/2i Index</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>7</watches>
                                                                                                                <comments>
                            <comment id="14019564" author="JIRAUSER308715" created="Fri, 6 Jun 2014 04:32:01 +0000"  >&lt;p&gt;Simple reproduction:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;CREATE KEYSPACE test WITH replication = {&apos;class&apos;: &apos;SimpleStrategy&apos;, &apos;replication_factor&apos;: 1};
USE test;
CREATE COLUMNFAMILY cf5 ( a text PRIMARY KEY, b text, c text, d text ) WITH COMPACT STORAGE;
CREATE INDEX c5idx ON cf5 (c);
INSERT INTO cf5 (a, b, c, d) VALUES ( &apos;3&apos;, &apos;2&apos;, &apos;3&apos;, &apos;4&apos;) USING TTL 84960 AND TIMESTAMP 1402027485644050;
#PAUSE for a sec
INSERT INTO cf5 (a, b, c, d) VALUES ( &apos;3&apos;, &apos;2&apos;, &apos;3&apos;, &apos;4&apos;) USING TTL 84960 AND TIMESTAMP 1402027485644050;
select * from cf5 where c=&apos;3&apos;;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This seems fixed by something in 2.1, but is broken in 1.2 and 2.0 branches.&lt;/p&gt;</comment>
                            <comment id="14032847" author="beobal" created="Mon, 16 Jun 2014 19:52:07 +0000"  >&lt;p&gt;The problem here is that we have two expiring columns which differ only in localExpiryTime values and which are not considered equal (correctly). When an overwrite like this occurs it leads to the insertion of a tombstone which having the same timestamp as both the new and old columns, effectively hides the indexed value.&lt;/p&gt;

&lt;p&gt;This isn&apos;t a problem in 2.1 because the reconcilliation logic there is reversed. So in this case, the old value is retained and the index update never happens. While this masks the problem described here, it causes its own problems - see &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-7403&quot; title=&quot;Reconciliation doesn&amp;#39;t consider fields specific to expiring cells&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-7403&quot;&gt;&lt;del&gt;CASSANDRA-7403&lt;/del&gt;&lt;/a&gt; &lt;/p&gt;

&lt;p&gt;I&apos;ve attached patches to add some additional checks before inserting the index tombstone (unfortunately there are a number of incompatibilities between 1.2/2.0/2.1 in this area of the code, so there&apos;s a patch per-branch). I&apos;ve also added a unit test for the overwrite behaviour and run this through some manual testing of compactions &amp;amp; everything seems to be working ok. &lt;/p&gt;</comment>
                            <comment id="14032857" author="jbellis" created="Mon, 16 Jun 2014 19:58:44 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=iamaleksey&quot; class=&quot;user-hover&quot; rel=&quot;iamaleksey&quot;&gt;iamaleksey&lt;/a&gt; to review&lt;/p&gt;</comment>
                            <comment id="14034666" author="iamaleksey" created="Wed, 18 Jun 2014 00:43:56 +0000"  >&lt;p&gt;Committed w/ minor bikeshedding applied, thanks.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12650633" name="7268-1.2.txt" size="6712" author="samt" created="Mon, 16 Jun 2014 19:52:07 +0000"/>
                            <attachment id="12650635" name="7268-2.0.txt" size="6725" author="samt" created="Mon, 16 Jun 2014 19:52:07 +0000"/>
                            <attachment id="12650634" name="7268-2.1.txt" size="6717" author="samt" created="Mon, 16 Jun 2014 19:52:07 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[samt]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>393607</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            11 years, 22 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1vrzz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>393767</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12311421" key="com.atlassian.jira.plugin.system.customfieldtypes:multiversion">
                        <customfieldname>Reproduced In</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="12325272">1.2.12</customfieldvalue>
    <customfieldvalue id="12326169">1.2.15</customfieldvalue>
    <customfieldvalue id="12326712">2.0.8</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>aleksey</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[aleksey]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12962"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>