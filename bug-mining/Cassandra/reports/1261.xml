<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 22:26:17 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-3421] Can create a table with DecimalType comparator but CQL explodes trying to actually use it.</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-3421</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;CREATE KEYSPACE CassandraCQLTestKeyspace WITH strategy_class=&apos;org.apache.cassandra.locator.SimpleStrategy&apos; AND strategy_options:replication_factor=1&lt;/p&gt;

&lt;p&gt;USE CassandraCQLTestKeyspace&lt;/p&gt;

&lt;p&gt;CREATE COLUMNFAMILY comparator_cf_decimal (id text PRIMARY KEY) WITH comparator=&apos;DecimalType&apos;&lt;/p&gt;

&lt;p&gt;INSERT INTO comparator_cf_decimal (id, 15.333) VALUES (&apos;test&apos;, &apos;test&apos;)&lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;This leads to failure&lt;br/&gt;
SELECT 15.333 FROM comparator_cf_decimal WHERE id = &apos;test&apos; &lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;ERROR 12:22:56,909 Internal error processing execute_cql_query&lt;br/&gt;
java.nio.BufferUnderflowException&lt;br/&gt;
	at java.nio.Buffer.nextGetIndex(Buffer.java:480)&lt;br/&gt;
	at java.nio.HeapByteBuffer.getInt(HeapByteBuffer.java:336)&lt;br/&gt;
	at org.apache.cassandra.cql.jdbc.JdbcDecimal.compose(JdbcDecimal.java:90)&lt;br/&gt;
	at org.apache.cassandra.db.marshal.DecimalType.compose(DecimalType.java:43)&lt;br/&gt;
	at org.apache.cassandra.db.marshal.DecimalType.compare(DecimalType.java:38)&lt;br/&gt;
	at org.apache.cassandra.db.marshal.DecimalType.compare(DecimalType.java:30)&lt;br/&gt;
	at java.util.TreeMap.getEntryUsingComparator(TreeMap.java:351)&lt;br/&gt;
	at java.util.TreeMap.getEntry(TreeMap.java:322)&lt;br/&gt;
	at java.util.TreeMap.get(TreeMap.java:255)&lt;br/&gt;
	at org.apache.cassandra.db.TreeMapBackedSortedColumns.getColumn(TreeMapBackedSortedColumns.java:138)&lt;br/&gt;
	at org.apache.cassandra.db.AbstractColumnContainer.getColumn(AbstractColumnContainer.java:128)&lt;br/&gt;
	at org.apache.cassandra.cql.QueryProcessor.process(QueryProcessor.java:627)&lt;br/&gt;
	at org.apache.cassandra.thrift.CassandraServer.execute_cql_query(CassandraServer.java:1236)&lt;br/&gt;
	at org.apache.cassandra.thrift.Cassandra$Processor$execute_cql_query.process(Cassandra.java:4072)&lt;br/&gt;
	at org.apache.cassandra.thrift.Cassandra$Processor.process(Cassandra.java:2889)&lt;br/&gt;
	at org.apache.cassandra.thrift.CustomTThreadPoolServer$WorkerProcess.run(CustomTThreadPoolServer.java:187)&lt;br/&gt;
	at java.util.concurrent.ThreadPoolExecutor$Worker.runTask(ThreadPoolExecutor.java:886)&lt;br/&gt;
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:908)&lt;br/&gt;
	at java.lang.Thread.run(Thread.java:680)&lt;/p&gt;</description>
                <environment></environment>
        <key id="12529365">CASSANDRA-3421</key>
            <summary>Can create a table with DecimalType comparator but CQL explodes trying to actually use it.</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10002" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Normal</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="ardot">Rick Shaw</assignee>
                                    <reporter username="kreynolds">Kelley Reynolds</reporter>
                        <labels>
                            <label>cql</label>
                    </labels>
                <created>Sat, 29 Oct 2011 16:25:23 +0000</created>
                <updated>Tue, 16 Apr 2019 09:32:47 +0000</updated>
                            <resolved>Thu, 3 Nov 2011 04:53:32 +0000</resolved>
                                        <fixVersion>1.0.2</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                                                                <comments>
                            <comment id="13139354" author="kreynolds" created="Sat, 29 Oct 2011 16:32:07 +0000"  >&lt;p&gt;FYI, this is the only Type that does this, every other type appears to function properly including Float and Double&lt;/p&gt;</comment>
                            <comment id="13141178" author="ardot" created="Tue, 1 Nov 2011 13:49:01 +0000"  >&lt;p&gt;This occurs because the &lt;tt&gt;compose&lt;/tt&gt; method in &lt;tt&gt;DecimalType&lt;/tt&gt; does not protect itself  by checking for an empty &lt;tt&gt;ByteBuffer&lt;/tt&gt; argument which is what occurs if a single item is in the CF.&lt;/p&gt;</comment>
                            <comment id="13141197" author="jbellis" created="Tue, 1 Nov 2011 14:21:08 +0000"  >&lt;p&gt;Can you include a unit test for the problem?&lt;/p&gt;</comment>
                            <comment id="13141213" author="ardot" created="Tue, 1 Nov 2011 14:53:31 +0000"  >&lt;p&gt;Sure. Are you looking for a unit test for &lt;tt&gt;DecimalType&lt;/tt&gt;, or for the problem as stated? I can see where there are various unit tests for data types, but there does not seem to be a package in &lt;tt&gt;test/unit&lt;/tt&gt; for CQL unit tests? Did I miss it?&lt;/p&gt;</comment>
                            <comment id="13141216" author="jbellis" created="Tue, 1 Nov 2011 14:56:00 +0000"  >&lt;p&gt;Just for DecimalType.&lt;/p&gt;

&lt;p&gt;(We don&apos;t have any CQL unit tests in C* since we moved all the drivers out of tree.)&lt;/p&gt;</comment>
                            <comment id="13142409" author="ardot" created="Wed, 2 Nov 2011 18:50:07 +0000"  >&lt;p&gt;V2 contains fix and unit test&lt;/p&gt;</comment>
                            <comment id="13142837" author="jbellis" created="Thu, 3 Nov 2011 04:53:32 +0000"  >&lt;p&gt;Thanks, Rick!&lt;/p&gt;

&lt;p&gt;Committed with a minor change: switched from mark/reset to duplicate as a &quot;don&apos;t modify the original buffer&quot; approach.  mark/modify/reset can cause problems if another thread also tries to use the buffer in between.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12502010" name="3421-v2.txt" size="5816" author="ardot" created="Wed, 2 Nov 2011 18:50:07 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[ardot]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>215225</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            14 years, 3 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0gjov:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>94620</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>jbellis</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[jbellis]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12962"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>