<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 22:32:52 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-4227] StorageProxy throws NPEs for when there&apos;s no hostids for a target</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-4227</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;On trunk...&lt;/p&gt;

&lt;p&gt;if there is no host id due to an old node, an info log is generated, but the code continues to use the null host id causing NPEs in decompose... Should this bypass this code, or perhaps can the plain ip address be used in this case? don&apos;t know.&lt;/p&gt;

&lt;p&gt;as follows...&lt;/p&gt;



&lt;p&gt;                    UUID hostId = StorageService.instance.getTokenMetadata().getHostId(target);&lt;br/&gt;
                    if ((hostId == null) &amp;amp;&amp;amp; (Gossiper.instance.getVersion(target) &amp;lt; MessagingService.VERSION_12))&lt;br/&gt;
                        logger.info(&quot;Unable to store hint for host with missing ID, {} (old node?)&quot;, target.toString());&lt;br/&gt;
                    RowMutation hintedMutation = RowMutation.hintFor(mutation, ByteBuffer.wrap(UUIDGen.decompose(hostId)));&lt;br/&gt;
                    hintedMutation.apply();&lt;/p&gt;</description>
                <environment></environment>
        <key id="12554426">CASSANDRA-4227</key>
            <summary>StorageProxy throws NPEs for when there&apos;s no hostids for a target</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10003" iconUrl="https://issues.apache.org/jira/images/icons/priorities/trivial.svg">Low</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="urandom">Eric Evans</assignee>
                                    <reporter username="dbrosius@apache.org">Dave Brosius</reporter>
                        <labels>
                    </labels>
                <created>Wed, 9 May 2012 04:04:40 +0000</created>
                <updated>Tue, 16 Apr 2019 09:32:34 +0000</updated>
                            <resolved>Wed, 23 May 2012 20:58:48 +0000</resolved>
                                        <fixVersion>1.2.0 beta 1</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="13271448" author="brandon.williams" created="Wed, 9 May 2012 14:28:39 +0000"  >&lt;p&gt;We should just drop the hint in this case, see &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-4120&quot; title=&quot;Gossip identifies hosts by UUID&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-4120&quot;&gt;&lt;del&gt;CASSANDRA-4120&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13280647" author="dbrosius@apache.org" created="Tue, 22 May 2012 00:30:09 +0000"  >&lt;p&gt;against trunk&lt;/p&gt;</comment>
                            <comment id="13281030" author="jbellis" created="Tue, 22 May 2012 15:24:47 +0000"  >&lt;p&gt;So the situation is, I&apos;ve upgraded to 1.2 so I&apos;m supposed to have node IDs, but one of the nodes starts slower than the others (for instance) so it hasn&apos;t broadcast its nodeid to the rest of the cluster yet?&lt;/p&gt;</comment>
                            <comment id="13281049" author="brandon.williams" created="Tue, 22 May 2012 15:47:58 +0000"  >&lt;p&gt;I believe the more common situation is you&apos;re in the process of upgrading to 1.2 and have a mixed cluster, but need to generate a hint for an older version that hasn&apos;t generated a nodeid yet.&lt;/p&gt;</comment>
                            <comment id="13281237" author="urandom" created="Tue, 22 May 2012 21:46:58 +0000"  >&lt;blockquote&gt;&lt;p&gt;We should just drop the hint in this case, see &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-4120&quot; title=&quot;Gossip identifies hosts by UUID&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-4120&quot;&gt;&lt;del&gt;CASSANDRA-4120&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Yeah, I think this is a straightforward brainfart and that it was supposed to have returned after logging &quot;cannot store hint&quot;, instead of you know, trying to store it. &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;See attached.&lt;/p&gt;</comment>
                            <comment id="13281249" author="jbellis" created="Tue, 22 May 2012 22:16:21 +0000"  >&lt;p&gt;Hints are supposed to be reliable now, which I expect will lead more people to turn off read repair.  Which is a long way of saying I think we should&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;log the message at WARN&lt;/li&gt;
	&lt;li&gt;add a note to NEWS that you should upgrade when all nodes are up to minimize this&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;+1 otherwise.&lt;/p&gt;</comment>
                            <comment id="13281323" author="dbrosius@apache.org" created="Tue, 22 May 2012 23:52:34 +0000"  >&lt;p&gt;committed as bd32d4f0b9f0f88fed97e8ddf2ee41b5b048d31d&lt;/p&gt;</comment>
                            <comment id="13281336" author="urandom" created="Wed, 23 May 2012 00:45:20 +0000"  >&lt;p&gt;I reverted this.&lt;/p&gt;

&lt;p&gt;I&apos;m not sure which patch Jonathan was +1&apos;ing, but the what was committed here wasn&apos;t from either.&lt;/p&gt;

&lt;p&gt;I don&apos;t think the test for version &amp;lt; VERSION_12 should be removed.  A null hostid is &quot;normal&quot; when the node is pre-1.2 (as would be the case during a rolling upgrade).  I can&apos;t foresee a reason that it would be null otherwise, it would represent a much more serious error and shouldn&apos;t be swept away with a WARN message.&lt;/p&gt;

&lt;p&gt;Also, Jonathan wanted to see something added to NEWS.  The second bullet point under &quot;Upgrading&quot; for 1.2 already mentions this, but it would probably be better to strengthen that wording with a recommendation to only upgrade when all nodes are up.&lt;/p&gt;</comment>
                            <comment id="13281351" author="dbrosius@apache.org" created="Wed, 23 May 2012 01:49:20 +0000"  >&lt;p&gt;ok, but what ever the reason for a null host id, it&apos;s going to NPE.&lt;/p&gt;</comment>
                            <comment id="13281382" author="jbellis" created="Wed, 23 May 2012 03:23:28 +0000"  >&lt;p&gt;Sorry for the confusion, I was +1ing the 2nd patch.&lt;/p&gt;

&lt;p&gt;I&apos;m okay with NPEing if we have a null host on version 12, since that&apos;s Not Supposed To Happen.  (Alternatively, we could add an assert to make that explicit.)&lt;/p&gt;</comment>
                            <comment id="13281907" author="urandom" created="Wed, 23 May 2012 20:58:48 +0000"  >&lt;p&gt;committed with assertion and additional NEWS.txt recommendation.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12528656" name="4227_drop_hints.txt" size="961" author="urandom" created="Tue, 22 May 2012 21:47:21 +0000"/>
                            <attachment id="12528538" name="4227_guard_against_npes_for_old_gossip_versions.diff" size="1901" author="dbrosius@apache.org" created="Tue, 22 May 2012 00:30:09 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[urandom]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>238668</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            13 years, 26 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0gth3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>96205</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>jbellis</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[jbellis]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12961"><![CDATA[Low]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>