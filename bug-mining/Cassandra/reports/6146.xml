<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 23:26:15 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-17928] Test Failure: org.apache.cassandra.db.commitlog.CommitLogInitWithExceptionTest.testCommitLogInitWithException-compression</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-17928</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;&lt;a href=&quot;https://ci-cassandra.apache.org/job/Cassandra-4.1/169/testReport/org.apache.cassandra.db.commitlog/CommitLogInitWithExceptionTest/testCommitLogInitWithException_compression/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;Link&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Failed 1 times in the last 14 runs. Flakiness: 7%, Stability: 92%&lt;/p&gt;

&lt;p&gt;Stacktrace&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
java.lang.NullPointerException
	at org.apache.cassandra.db.commitlog.CommitLogInitWithExceptionTest.testCommitLogInitWithException(CommitLogInitWithExceptionTest.java:93)
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.base/java.util.concurrent.FutureTask.run(FutureTask.java:264)
	at java.base/java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:829)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;



&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
Standard Output
INFO  [main] 2022-09-25 11:43:16,512 Reflections.java:219 - Reflections took 1221 ms to scan 8 urls, producing 1756 keys and 6922 values
INFO  [main] 2022-09-25 11:43:17,480 Reflections.java:219 - Reflections took 907 ms to scan 8 urls, producing 1756 keys and 6922 values
INFO  [main] 2022-09-25 11:43:17,573 YamlConfigurationLoader.java:104 - Configuration location: file:&lt;span class=&quot;code-comment&quot;&gt;////home/cassandra/cassandra/build/test/cassandra.compressed.yaml
&lt;/span&gt;DEBUG [main] 2022-09-25 11:43:17,574 YamlConfigurationLoader
...[truncated 35568 chars]...
.apache.cassandra.db.commitlog.CommitLogInitWithExceptionTest$MockCommitLogSegmentMgr.createSegment(CommitLogInitWithExceptionTest.java:106)
	at org.apache.cassandra.db.commitlog.AbstractCommitLogSegmentManager$AllocatorRunnable.run(AbstractCommitLogSegmentManager.java:155)
	at org.apache.cassandra.concurrent.InfiniteLoopExecutor.loop(InfiniteLoopExecutor.java:121)
	at io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)
	at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:748)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="13483481">CASSANDRA-17928</key>
            <summary>Test Failure: org.apache.cassandra.db.commitlog.CommitLogInitWithExceptionTest.testCommitLogInitWithException-compression</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10002" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Normal</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="brandon.williams">Brandon Williams</assignee>
                                    <reporter username="jmckenzie">Josh McKenzie</reporter>
                        <labels>
                    </labels>
                <created>Tue, 27 Sep 2022 15:20:43 +0000</created>
                <updated>Fri, 10 Oct 2025 08:47:57 +0000</updated>
                            <resolved>Wed, 9 Nov 2022 18:03:02 +0000</resolved>
                                        <fixVersion>4.0.8</fixVersion>
                    <fixVersion>4.1-rc1</fixVersion>
                    <fixVersion>4.1</fixVersion>
                    <fixVersion>5.0-alpha1</fixVersion>
                    <fixVersion>5.0</fixVersion>
                                    <component>Test/unit</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>7</watches>
                                                                                                                <comments>
                            <comment id="17610283" author="edimitrova" created="Tue, 27 Sep 2022 22:55:34 +0000"  >&lt;p&gt;As the test exists in 4.0, I tried to reproduce the failure in both 4.0 and 4.1&lt;br/&gt;
Managed to reproduce it when run with compression twice in 5000 times:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;&lt;a href=&quot;https://app.circleci.com/pipelines/github/ekaterinadimitrova2/cassandra/1964/workflows/de6b4aa9-0a50-4488-b8fd-5e0da2718507/jobs/15521/tests#failed-test-0&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://app.circleci.com/pipelines/github/ekaterinadimitrova2/cassandra/1964/workflows/de6b4aa9-0a50-4488-b8fd-5e0da2718507/jobs/15521/tests#failed-test-0&lt;/a&gt;&lt;br/&gt;
But I didn&apos;t manage in 10 000 runs on 4.0 - &lt;a href=&quot;https://app.circleci.com/pipelines/github/ekaterinadimitrova2/cassandra/1966/workflows/d616e242-28f3-46d0-b345-30faf2f3ec24&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;j8&lt;/a&gt;, &lt;a href=&quot;https://app.circleci.com/pipelines/github/ekaterinadimitrova2/cassandra/1966/workflows/38a3ca64-97fe-4477-a05d-3aed705131b1&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;j11&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Just with the regular &lt;em&gt;ant testsome&lt;/em&gt; target I didn&apos;t manage to reproduce it 5000 times on both branches.&#160;&lt;/p&gt;</comment>
                            <comment id="17616867" author="bereng" created="Thu, 13 Oct 2022 08:20:54 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=e.dimitrova&quot; class=&quot;user-hover&quot; rel=&quot;e.dimitrova&quot;&gt;e.dimitrova&lt;/a&gt; I&apos;ve looked at all static inits and everything looks fine iiuc. The test can be ran locally with the &lt;tt&gt;RepeatableRunner&lt;/tt&gt; but it won&apos;t repro and I didn&apos;t either by trying several things. All things considered I think this is probably some test env corner case and we can send it to RC and move it out of Beta imo. Wdyt?&lt;/p&gt;</comment>
                            <comment id="17616927" author="bereng" created="Thu, 13 Oct 2022 10:23:28 +0000"  >&lt;p&gt;I did try a 5K run with a few added asserts and test-compression and it didn&apos;t repro &lt;a href=&quot;https://app.circleci.com/pipelines/github/bereng/cassandra/794/workflows/d643f1c8-e5b8-4e59-bfbf-63551e7018af/jobs/7228/parallel-runs/21?filterBy=ALL&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://app.circleci.com/pipelines/github/bereng/cassandra/794/workflows/d643f1c8-e5b8-4e59-bfbf-63551e7018af/jobs/7228/parallel-runs/21?filterBy=ALL&lt;/a&gt; #justfyi&lt;/p&gt;</comment>
                            <comment id="17616958" author="adelapena" created="Thu, 13 Oct 2022 11:11:40 +0000"  >&lt;p&gt;I did manage to reproduce the issue on 4.1 with Java 11 and without compression: &lt;a href=&quot;https://app.circleci.com/pipelines/github/adelapena/cassandra/2210/workflows/e2b62218-cfa4-4003-a946-c1823931bf64/jobs/22360&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://app.circleci.com/pipelines/github/adelapena/cassandra/2210/workflows/e2b62218-cfa4-4003-a946-c1823931bf64/jobs/22360&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;There are two hits in 10K iterations:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
.circleci/generate.sh -m \
  -e REPEATED_UTEST_TARGET=testsome \
  -e REPEATED_UTEST_COUNT=10000 \
  -e REPEATED_UTEST_CLASS=org.apache.cassandra.db.commitlog.CommitLogInitWithExceptionTest
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;So it seems that compression isn&apos;t the issue, and probably we will need more iterations to be sure of hitting it.&lt;/p&gt;</comment>
                            <comment id="17619799" author="edimitrova" created="Tue, 18 Oct 2022 21:24:31 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=bereng&quot; class=&quot;user-hover&quot; rel=&quot;bereng&quot;&gt;bereng&lt;/a&gt;&#160;I didn&apos;t have the chance to work on this one, I only pushed repeated runs before I went off so we can see on which branches it fails, whether it is regression, etc. That is why I also didn&apos;t assign it as I am not actively working on it or familiar with the test.&lt;/p&gt;

&lt;p&gt;With that said I wouldn&apos;t advocate for closing it as environmental issue without explanation just because it is hard to reproduce. We have a bunch of examples of legitimate bugs fixed from tests that were super rarely failing. But as I said, I don&apos;t know the details in this case so I will leave the decision to whoever assigns it and spends the time to figure out the details.&lt;/p&gt;

&lt;p&gt;Whether this is a beta/rc blocker I don&apos;t know. I think it was Josh assigning version here when opening the ticket.&lt;/p&gt;</comment>
                            <comment id="17619817" author="brandon.williams" created="Tue, 18 Oct 2022 22:01:42 +0000"  >&lt;blockquote&gt;&lt;p&gt;Whether this is a beta/rc blocker I don&apos;t know.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;This was one of the tickets excepted on the ML with a waiver, given that it was fixed in the next release, so blocking RC on this.&lt;/p&gt;</comment>
                            <comment id="17619886" author="edimitrova" created="Tue, 18 Oct 2022 23:00:24 +0000"  >&lt;blockquote&gt;&lt;p&gt;This was one of the tickets excepted on the ML with a waiver, given that it was fixed in the next release, so blocking RC on this.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;You are right as usual &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&#160;Thanks!&lt;/p&gt;</comment>
                            <comment id="17620277" author="bereng" created="Wed, 19 Oct 2022 11:51:57 +0000"  >&lt;p&gt;I did run it &lt;a href=&quot;https://app.circleci.com/pipelines/github/bereng/cassandra/796/workflows/be470790-e5bc-4fe7-97bc-bc2aaff554d1&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;today&lt;/a&gt; 5K times on circle but I had decorated the test with the RepeatableRunner with 5K runs. So that is 5K*5K runs trying to assert where the null in &lt;tt&gt;CommitLog.instance.segmentManager.executor.isTerminated()&lt;/tt&gt; exactly was an it didn&apos;t fail meh...&lt;/p&gt;</comment>
                            <comment id="17620375" author="edimitrova" created="Wed, 19 Oct 2022 13:58:27 +0000"  >&lt;p&gt;The good news are that &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=adelapena&quot; class=&quot;user-hover&quot; rel=&quot;adelapena&quot;&gt;adelapena&lt;/a&gt;&#160;reproduced it and the logs are available in CircleCI&lt;/p&gt;</comment>
                            <comment id="17620623" author="brandon.williams" created="Wed, 19 Oct 2022 21:59:14 +0000"  >&lt;p&gt;I caught one in &lt;a href=&quot;https://app.circleci.com/pipelines/github/driftx/cassandra/673/workflows/6235dcf9-6a8e-4308-adfa-7b60299bb72f/jobs/7492&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;this run&lt;/a&gt; with &lt;a href=&quot;https://github.com/driftx/cassandra/commit/52bbf68c55d8eb2ea2eb8eb47ca07d96a72389c8&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;this patch&lt;/a&gt; which indicates the executor is what is null... perhaps it&apos;s already gone.&lt;/p&gt;</comment>
                            <comment id="17620730" author="bereng" created="Thu, 20 Oct 2022 04:54:29 +0000"  >&lt;blockquote&gt;&lt;p&gt;I caught one in this run with this patch which indicates the executor is what is null... perhaps it&apos;s already gone.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Ah good this is what I was trying to get&lt;/p&gt;</comment>
                            <comment id="17623903" author="brandon.williams" created="Tue, 25 Oct 2022 15:36:14 +0000"  >&lt;p&gt;I removed the 1000ms sleep in favor of awaiting termination on the executor &lt;a href=&quot;https://github.com/driftx/cassandra/commit/6d7b2aff20c8b3113fef72b186f2caadd39b3aeb&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;here&lt;/a&gt;.&lt;/p&gt;

&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;Branch&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;CI&lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/driftx/cassandra/tree/CASSANDRA-17928&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;4.1&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://app.circleci.com/pipelines/github/driftx/cassandra/679/workflows/45d0f69d-e99d-4f2b-b69c-af4ad7f8be18/jobs/7504&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;circle 10k&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/driftx/cassandra/tree/CASSANDRA-17928-trunk&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;trunk&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://app.circleci.com/pipelines/github/driftx/cassandra/680/workflows/51868e19-35d1-46fc-af02-9ec6f85bddd0/jobs/7506&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;circle 10k&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;

</comment>
                            <comment id="17623922" author="adelapena" created="Tue, 25 Oct 2022 16:24:28 +0000"  >&lt;p&gt;The patch looks good to me. I have started another pair of repeated runs for &lt;a href=&quot;https://app.circleci.com/pipelines/github/adelapena/cassandra/2328/workflows/50f33d9b-c7c6-4aa9-bac9-22ac78ad6b8c&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;4.1&lt;/a&gt;&#160; and &lt;a href=&quot;https://app.circleci.com/pipelines/github/adelapena/cassandra/2327/workflows/aa732ff3-304b-4f0d-ab3c-4662f0a9ebe2&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;trunk&lt;/a&gt; since this one is hard to reproduce.&lt;/p&gt;

&lt;p&gt;I think that &lt;a href=&quot;https://github.com/apache/cassandra/blob/cassandra-4.0/test/unit/org/apache/cassandra/db/commitlog/CommitLogInitWithExceptionTest.java#L84-L93&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;the test also exists in 4.0&lt;/a&gt;, although in that branch the thread is not wrapped. Should we port the fix, or the test doesn&apos;t fail in that branch?&lt;/p&gt;</comment>
                            <comment id="17623923" author="brandon.williams" created="Tue, 25 Oct 2022 16:29:36 +0000"  >&lt;p&gt;I don&apos;t think it fails on 4.0, but we can see when it finishes &lt;a href=&quot;https://app.circleci.com/pipelines/github/driftx/cassandra/682/workflows/69d0d7ac-52bc-4f81-b7cd-fdfe7a75c2b7&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;here&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="17623947" author="adelapena" created="Tue, 25 Oct 2022 17:31:23 +0000"  >&lt;p&gt;It seems that the run for 4.1 has hit a NPE: &lt;a href=&quot;https://app.circleci.com/pipelines/github/adelapena/cassandra/2328/workflows/50f33d9b-c7c6-4aa9-bac9-22ac78ad6b8c/jobs/23224&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://app.circleci.com/pipelines/github/adelapena/cassandra/2328/workflows/50f33d9b-c7c6-4aa9-bac9-22ac78ad6b8c/jobs/23224&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17623981" author="adelapena" created="Tue, 25 Oct 2022 18:38:30 +0000"  >&lt;p&gt;The run for 4.0 also hits a failure, but this time not a NPE but an assertion error, probably due to a slow run: &lt;a href=&quot;https://app.circleci.com/pipelines/github/driftx/cassandra/682/workflows/69d0d7ac-52bc-4f81-b7cd-fdfe7a75c2b7/jobs/7508/tests&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://app.circleci.com/pipelines/github/driftx/cassandra/682/workflows/69d0d7ac-52bc-4f81-b7cd-fdfe7a75c2b7/jobs/7508/tests&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17623983" author="brandon.williams" created="Tue, 25 Oct 2022 18:42:39 +0000"  >&lt;blockquote&gt;&lt;p&gt;The run for 4.0 also hits a failure, but this time not a NPE but an assertion error, probably due to a slow run&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Incidentally the await patch should solve this, but we&apos;re still left with the mysterious NPE in 4.1.&lt;/p&gt;</comment>
                            <comment id="17623990" author="edimitrova" created="Tue, 25 Oct 2022 19:03:40 +0000"  >&lt;p&gt;That might explain why I hit it easier in 4.1 than 4.0 &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/sad.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="17624193" author="bereng" created="Wed, 26 Oct 2022 05:34:31 +0000"  >&lt;p&gt;Yep I had tried that approach to no avail as well. I am at a loss here as following the code, even trying to follow futures execution, etc I can&apos;t see where the hole is...&lt;/p&gt;</comment>
                            <comment id="17624337" author="bereng" created="Wed, 26 Oct 2022 10:02:52 +0000"  >&lt;p&gt;Ohhhh we&apos;re accessing CommitLog init in a multi-threaded way mixing static and non-static monitors. Hence data visibility and reordering are not warrantied. I pushed a proposal to see if that theory is right &lt;a href=&quot;https://github.com/bereng/cassandra/commit/718f831e6de0b0b88802018d5112fb7d3fe2cf40&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;here&lt;/a&gt; with &lt;a href=&quot;https://app.circleci.com/pipelines/github/bereng/cassandra/800/workflows/5dd074e9-051a-4cd0-bf28-00d84257cb67&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;10K CI&lt;/a&gt; running.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=adelapena&quot; class=&quot;user-hover&quot; rel=&quot;adelapena&quot;&gt;adelapena&lt;/a&gt; it might be my fault or me being an idiot but&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;I run generate.sh and it barfs all tests. We don&apos;t seem to have a simple way to bring up the help/usage instructions&lt;/li&gt;
	&lt;li&gt;I run it with -m and it barfs all tests&lt;/li&gt;
	&lt;li&gt;I run &lt;tt&gt;./generate.sh -m -e REPEATED_ANT_TEST_TARGET=test -e REPEATED_ANT_TEST_CLASS=CommitLogInitWithExceptionTest -e REPEATED_ANT_TEST_COUNT=10000 -e REPEATED_TESTS_STOP_ON_FAILURE=true&lt;/tt&gt; and the config went empty but for the header of comments&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="17624366" author="adelapena" created="Wed, 26 Oct 2022 10:59:25 +0000"  >&lt;p&gt;That command,&#160;&lt;tt&gt;./generate.sh -m -e REPEATED_ANT_TEST_TARGET=test -e REPEATED_ANT_TEST_CLASS=CommitLogInitWithExceptionTest -e REPEATED_ANT_TEST_COUNT=10000 -e REPEATED_TESTS_STOP_ON_FAILURE=true&lt;/tt&gt;, works for me.&lt;/p&gt;

&lt;p&gt;Did you had any previous changes in &lt;tt&gt;config-2_1.yml&lt;/tt&gt; that could have confused the script? What&apos;s is the output of that command? What version on &lt;tt&gt;circleci&lt;/tt&gt; CLI tool are you using?&lt;/p&gt;

&lt;p&gt;By the way, you can also use:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
./generate.sh -m \
  -e REPEATED_UTESTS=org.apache.cassandra.db.commitlog.CommitLogInitWithExceptionTest \
  -e REPEATED_UTESTS_COUNT=10000 \
  -e REPEATED_TESTS_STOP_ON_FAILURE=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;That should create separate jobs for running the test with default config, compression, tries and system keyspace directories.&lt;/p&gt;</comment>
                            <comment id="17624373" author="bereng" created="Wed, 26 Oct 2022 11:11:22 +0000"  >&lt;p&gt;I&apos;ll try update the circleci when I have a gap...&lt;/p&gt;</comment>
                            <comment id="17624375" author="adelapena" created="Wed, 26 Oct 2022 11:15:35 +0000"  >&lt;blockquote&gt;&lt;p&gt;I run generate.sh and it barfs all tests. We don&apos;t seem to have a simple way to bring up the help/usage instructions&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;That&apos;s a bug, calling the script without options should print the help and exit without doing anything else. I&apos;ll open a ticket to fix it.&lt;/p&gt;</comment>
                            <comment id="17624383" author="adelapena" created="Wed, 26 Oct 2022 11:23:55 +0000"  >&lt;p&gt;Opened &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-17995&quot; title=&quot;CircleCI: generate.sh without options modifies config&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-17995&quot;&gt;&lt;del&gt;CASSANDRA-17995&lt;/del&gt;&lt;/a&gt; for fixing the issue when calling without options.&lt;/p&gt;</comment>
                            <comment id="17625008" author="bereng" created="Thu, 27 Oct 2022 10:10:03 +0000"  >&lt;p&gt;Well &lt;a href=&quot;https://github.com/apache/cassandra/compare/trunk...bereng:cassandra:CASSANDRA-17928-4.1&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;this&lt;/a&gt; passes &lt;a href=&quot;https://app.circleci.com/pipelines/github/bereng/cassandra/801/workflows/67a01d5c-5000-485a-9499-30565122afa1&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;10K&lt;/a&gt;. If we add the previous 10K runs that is 20K runs without a NPE.&lt;/p&gt;

&lt;p&gt;The problem is that the static init on exit and the Thread.join should both warranty a happens-before with a memory barrier that should make all properly visible across threads. The only exception would be another class loader triggering the static init a second time. So I still don&apos;t understand who is shuffling things under our feet for the executor to be null.&lt;/p&gt;</comment>
                            <comment id="17625166" author="brandon.williams" created="Thu, 27 Oct 2022 14:55:59 +0000"  >&lt;p&gt;I think this is still going to fail due to the awaitTermination call, where mine NPE&apos;d ultimately in that same spot, but we shouldn&apos;t need that or the sleep if we spin wait.&lt;br/&gt;
Like &lt;a href=&quot;https://github.com/driftx/cassandra/commit/2d8c09678cb1f18c8103cabce1c07073dd435980&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;this&lt;/a&gt; which is running 30k &lt;a href=&quot;https://app.circleci.com/pipelines/github/driftx/cassandra/684/workflows/7de84fef-0c04-49ee-9239-bdf88ddefd47/jobs/7510&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;here&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="17625284" author="brandon.williams" created="Thu, 27 Oct 2022 19:45:18 +0000"  >&lt;p&gt;The spin wait timed out on 8 of those runs. &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/sad.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="17625470" author="bereng" created="Fri, 28 Oct 2022 06:49:47 +0000"  >&lt;p&gt;The spin wait timing out makes no sense as the exception should have terminated it. But neither does the NPE. Hence my suspicion sbd is shuffling things under our feet. Ofc I just added some debug and now everything passes :facepalm:&lt;/p&gt;</comment>
                            <comment id="17626824" author="brandon.williams" created="Mon, 31 Oct 2022 20:18:12 +0000"  >&lt;blockquote&gt;&lt;p&gt;Incidentally the await patch should solve this&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Let&apos;s prove this out to make sure we understand everything on the 4.0 side.  We don&apos;t have the await method there but we can spin wait instead, which I did &lt;a href=&quot;https://github.com/driftx/cassandra/commit/cd2b04386fe4f22c0aff8ee32766df0b3200cb99&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;here&lt;/a&gt;.  Indeed, this passed &lt;a href=&quot;https://app.circleci.com/pipelines/github/driftx/cassandra/686/workflows/3bc04364-b829-48ca-9e33-246899546db2/jobs/7514&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;30k runs&lt;/a&gt;, where the equivalent in 4.1 previously did not.  The only commit against the test since 4.0 is &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-16925&quot; title=&quot;Task Execution&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-16925&quot;&gt;&lt;del&gt;CASSANDRA-16925&lt;/del&gt;&lt;/a&gt;, which is in line with the nature of the problem.&lt;/p&gt;</comment>
                            <comment id="17628250" author="adelapena" created="Thu, 3 Nov 2022 10:37:11 +0000"  >&lt;p&gt;Some archaeology shows that:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;The test consistently passed right before &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-16924&quot; title=&quot;Blocking Concurrency Primitives&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-16924&quot;&gt;&lt;del&gt;CASSANDRA-16924&lt;/del&gt;&lt;/a&gt;, at commit &lt;a href=&quot;https://github.com/apache/cassandra/commit/2e2db4dc40c4935305b9a2d5d271580e96dabe42&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;2e2db4dc40c4935305b9a2d5d271580e96dabe42&lt;/a&gt;. CI &lt;a href=&quot;https://app.circleci.com/pipelines/github/adelapena/cassandra/2388/workflows/3f5e6b23-9e7c-46fc-bc15-88492e06bd02&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;here&lt;/a&gt;.&lt;/li&gt;
	&lt;li&gt;The test started to fail with a timeout at the call to &lt;tt&gt;initThread.join()&lt;/tt&gt; after &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-16924&quot; title=&quot;Blocking Concurrency Primitives&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-16924&quot;&gt;&lt;del&gt;CASSANDRA-16924&lt;/del&gt;&lt;/a&gt;. However, the NPE wasn&apos;t hit back then. CI &lt;a href=&quot;https://app.circleci.com/pipelines/github/adelapena/cassandra/2387/workflows/6a003922-6bdc-4591-8e36-244982511b89&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;here&lt;/a&gt;.&lt;/li&gt;
	&lt;li&gt;The NPE started to appear with &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-16925&quot; title=&quot;Task Execution&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-16925&quot;&gt;&lt;del&gt;CASSANDRA-16925&lt;/del&gt;&lt;/a&gt;, together with the same timeout in &lt;tt&gt;initThread.join()&lt;/tt&gt;. That was committed immediately after &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-16924&quot; title=&quot;Blocking Concurrency Primitives&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-16924&quot;&gt;&lt;del&gt;CASSANDRA-16924&lt;/del&gt;&lt;/a&gt;. CI &lt;a href=&quot;https://app.circleci.com/pipelines/github/adelapena/cassandra/2389/workflows/7a5fa11b-a79b-428b-a8d0-5e5439c5b979&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;here&lt;/a&gt;.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;So it seems that both &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-16924&quot; title=&quot;Blocking Concurrency Primitives&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-16924&quot;&gt;&lt;del&gt;CASSANDRA-16924&lt;/del&gt;&lt;/a&gt; and &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-16925&quot; title=&quot;Task Execution&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-16925&quot;&gt;&lt;del&gt;CASSANDRA-16925&lt;/del&gt;&lt;/a&gt; broke the test, and the NPE comes from the latter.&lt;/p&gt;

&lt;p&gt;Maybe &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=benedict&quot; class=&quot;user-hover&quot; rel=&quot;benedict&quot;&gt;benedict&lt;/a&gt; or &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=samt&quot; class=&quot;user-hover&quot; rel=&quot;samt&quot;&gt;samt&lt;/a&gt; can give some insights on this.&lt;/p&gt;</comment>
                            <comment id="17628273" author="benedict" created="Thu, 3 Nov 2022 11:23:49 +0000"  >&lt;p&gt;It looks like the problem is that the &lt;tt&gt;CommitLogSegmentManager&lt;/tt&gt; assigns its &lt;tt&gt;executor&lt;/tt&gt; variable after &lt;tt&gt;InfiniteLoopExecutor&lt;/tt&gt; starts its thread, which may therefore process the exception immediately (i.e. before the executor is made visible via &lt;tt&gt;executor&lt;/tt&gt;). Since the custom JVMKiller kills the thread that is starting the commit log, and this causes abnormal termination of the thread, this can prevent the field from being assigned entirely.&lt;/p&gt;

&lt;p&gt;Why is this thread being killed here, though? This is not semantically equivalent to any execution that is possible in a normal system.&lt;/p&gt;

&lt;p&gt;Who authored the test, perhaps their insight can be sought as to what the intention was?&lt;/p&gt;</comment>
                            <comment id="17628277" author="brandon.williams" created="Thu, 3 Nov 2022 11:32:45 +0000"  >&lt;p&gt;This test was added in &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-15295&quot; title=&quot;Running into deadlock when do CommitLog initialization&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-15295&quot;&gt;&lt;del&gt;CASSANDRA-15295&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="17628296" author="benedict" created="Thu, 3 Nov 2022 12:14:00 +0000"  >&lt;p&gt;So it is not expressly discussed in that ticket, but AFAICT there is no reason to invoke &lt;tt&gt;Thread.stop&lt;/tt&gt; in the JVMKiller. Since the real JVMKiller does not invoke Thread.stop this cannot be a critical part of the test. So a simple condition that is signalled by the JVMKiller, that the test waits on for some predetermined period (perhaps 10s) to confirm the JVMKiller has been invoked seems sufficient.&lt;/p&gt;

&lt;p&gt;However, it might be nice to confirm with the original authors &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=gzh1992n&quot; class=&quot;user-hover&quot; rel=&quot;gzh1992n&quot;&gt;gzh1992n&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=djoshi&quot; class=&quot;user-hover&quot; rel=&quot;djoshi&quot;&gt;djoshi&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jwest&quot; class=&quot;user-hover&quot; rel=&quot;jwest&quot;&gt;jwest&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17629967" author="jrwest" created="Mon, 7 Nov 2022 18:58:56 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=benedict&quot; class=&quot;user-hover&quot; rel=&quot;benedict&quot;&gt;benedict&lt;/a&gt; unfortunately its been long enough I&apos;ve lost the context. Giving it a quick read it seems like the goal is the clean up a resource the test created (I suppose it could also do this by marking the thread as a daemon instead)&lt;/p&gt;</comment>
                            <comment id="17630094" author="brandon.williams" created="Tue, 8 Nov 2022 00:13:48 +0000"  >&lt;blockquote&gt;&lt;p&gt;So a simple condition that is signalled by the JVMKiller, that the test waits on for some predetermined period (perhaps 10s) to confirm the JVMKiller has been invoked seems sufficient.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;About like &lt;a href=&quot;https://github.com/driftx/cassandra/commit/6b448fa9ccef58d9116d39a48444afb37594fa20&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;this?&lt;/a&gt;  Circle &lt;a href=&quot;https://app.circleci.com/pipelines/github/driftx/cassandra/692/workflows/28d800ad-9f19-4853-a8d8-88c2c20dbb6e/jobs/7522&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;passes 30k&lt;/a&gt; iterations.&lt;/p&gt;</comment>
                            <comment id="17630267" author="bereng" created="Tue, 8 Nov 2022 08:23:45 +0000"  >&lt;p&gt;^Mmmm I like it&lt;/p&gt;</comment>
                            <comment id="17630449" author="brandon.williams" created="Tue, 8 Nov 2022 14:26:00 +0000"  >&lt;p&gt;I ported this to 4.0 as well.  CI is still running.&lt;/p&gt;

&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;Branch&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;CI&lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/driftx/cassandra/tree/CASSANDRA-17928-4.0&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;4.0&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://app.circleci.com/pipelines/github/driftx/cassandra/696/workflows/97f32020-fc41-45ce-b8d4-a0e4cdfed84d&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;j8&lt;/a&gt;, &lt;a href=&quot;https://app.circleci.com/pipelines/github/driftx/cassandra/696/workflows/0b4f6404-3cb0-41ef-878b-0def1b845d2f&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;j11&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/driftx/cassandra/tree/CASSANDRA-17928&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;4.1&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://app.circleci.com/pipelines/github/driftx/cassandra/701/workflows/a1093b26-9c80-455a-871c-da9493642571&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;j8&lt;/a&gt;, &lt;a href=&quot;https://app.circleci.com/pipelines/github/driftx/cassandra/692/workflows/7029bce2-ed30-4b93-831e-1efd831fc00f&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;j11&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/driftx/cassandra/tree/CASSANDRA-17928-trunk&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;trunk&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://app.circleci.com/pipelines/github/driftx/cassandra/698/workflows/a65d9619-106f-449d-8cd3-1e4b9eba423e&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;j8&lt;/a&gt;, &lt;a href=&quot;https://app.circleci.com/pipelines/github/driftx/cassandra/697/workflows/13882701-c4ac-48a1-bff7-27dc7d9c58f8&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;j11&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;
</comment>
                            <comment id="17630539" author="adelapena" created="Tue, 8 Nov 2022 17:30:52 +0000"  >&lt;p&gt;The workaround looks good, +1 if it survives the run.&lt;/p&gt;

&lt;p&gt;Nit: &lt;tt&gt;initThread&lt;/tt&gt; can be a local variable now that is not used in &lt;tt&gt;setUp&lt;/tt&gt; anymore.&lt;/p&gt;

&lt;p&gt;Tip: For trunk or any other additional run, if you rebase the branches you can benefit from &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-18000&quot; title=&quot;CircleCI: Skip checkstyle in the Ant-based repeated tests&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-18000&quot;&gt;&lt;del&gt;CASSANDRA-18000&lt;/del&gt;&lt;/a&gt; to get faster repeated runs.&lt;/p&gt;</comment>
                            <comment id="17630759" author="bereng" created="Wed, 9 Nov 2022 05:40:11 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=brandon.williams&quot; class=&quot;user-hover&quot; rel=&quot;brandon.williams&quot;&gt;brandon.williams&lt;/a&gt; sthg went south in circle bc we have 30K runs on 4.0 where it was already passing. The 4.1 run only has 500 repeats which is not enough and trunk has no repeats at all. I would suggest rebasing for &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-18000&quot; title=&quot;CircleCI: Skip checkstyle in the Ant-based repeated tests&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-18000&quot;&gt;&lt;del&gt;CASSANDRA-18000&lt;/del&gt;&lt;/a&gt; as well and do 30K repeats for 4.1 and trunk. Did I miss anything?&lt;/p&gt;</comment>
                            <comment id="17630988" author="adelapena" created="Wed, 9 Nov 2022 10:52:09 +0000"  >&lt;p&gt;I&apos;ve rebased the patches and started new runs:&lt;/p&gt;
&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;Branch&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;CI&lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/adelapena/cassandra/tree/17928-4.1-review&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;4.1 &lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://app.circleci.com/pipelines/github/adelapena/cassandra/2478/workflows/b1f45dd7-6f5b-45f5-806c-8d1e3ed907ae&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;j8&lt;/a&gt; &lt;a href=&quot;https://app.circleci.com/pipelines/github/adelapena/cassandra/2478/workflows/64e494ba-c496-40f1-9cf5-cf3e54869b7f&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;j11&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/adelapena/cassandra/tree/17928-trunk-review&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;trunk&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://app.circleci.com/pipelines/github/adelapena/cassandra/2479/workflows/1876a5e6-5d4b-4f63-b8db-37abe426c9b6&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;j8&lt;/a&gt; &lt;a href=&quot;https://app.circleci.com/pipelines/github/adelapena/cassandra/2479/workflows/e2701326-7fe8-4929-85b0-ccc84e35b0af&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;j11&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;


&lt;p&gt;The config is generated with:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
.circleci/generate.sh -m -e REPEATED_UTESTS_COUNT=30000
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;I have also taken the liberty of increasing the spin timeout to 30s instead of 10s, since I am afraid that with so many iterations we could hit an unusually long execution.&lt;/p&gt;</comment>
                            <comment id="17631076" author="bereng" created="Wed, 9 Nov 2022 13:34:24 +0000"  >&lt;p&gt;Looks like we hit that unusual long execution even at 30s&lt;/p&gt;</comment>
                            <comment id="17631107" author="adelapena" created="Wed, 9 Nov 2022 14:37:18 +0000"  >&lt;p&gt;Trying with a higher timeout &lt;a href=&quot;https://app.circleci.com/pipelines/github/adelapena/cassandra/2484/workflows/7db9a37e-9866-4d6b-9445-3c5e1e751047&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;here&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="17631167" author="brandon.williams" created="Wed, 9 Nov 2022 16:58:15 +0000"  >&lt;p&gt;That passed, should we go ahead with that timeout?&lt;/p&gt;</comment>
                            <comment id="17631176" author="adelapena" created="Wed, 9 Nov 2022 17:21:40 +0000"  >&lt;p&gt;Yes, I think we can go ahead with the 2min timeout.&lt;/p&gt;

&lt;p&gt;I&apos;ve also run j11 and trunk with the increased timeout and all of them pass:&lt;/p&gt;
&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;Branch&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;CI&lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/adelapena/cassandra/tree/17928-4.1-review&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;4.1 &lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://app.circleci.com/pipelines/github/adelapena/cassandra/2484/workflows/7db9a37e-9866-4d6b-9445-3c5e1e751047&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;j8&lt;/a&gt; &lt;a href=&quot;https://app.circleci.com/pipelines/github/adelapena/cassandra/2484/workflows/4cc51390-8680-4638-a27c-81feb36b73e7&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;j11&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/adelapena/cassandra/tree/17928-trunk-review&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;trunk&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://app.circleci.com/pipelines/github/adelapena/cassandra/2486/workflows/3796fc67-ecfd-4e06-90cc-0751768cec25&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;j8&lt;/a&gt; &lt;a href=&quot;https://app.circleci.com/pipelines/github/adelapena/cassandra/2486/workflows/77e044a2-dde3-47ef-ac69-a36c4aca2153&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;j11&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;


&lt;p&gt;30K iterations per config and branch is a lot of iterations. That increases our chances of hitting both timeouts and races. I guess that seeing that the test doesn&apos;t fail anymore when we increase the max wait time discards the possibility of an unknown race. I suspect that most tests using &lt;tt&gt;spinAssertEquals&lt;/tt&gt; with a shorter timeout would also fail if we run them with such a high number of iterations.&lt;/p&gt;</comment>
                            <comment id="17631192" author="brandon.williams" created="Wed, 9 Nov 2022 18:01:51 +0000"  >&lt;blockquote&gt;&lt;p&gt;30K iterations per config and branch is a lot of iterations&lt;/p&gt;&lt;/blockquote&gt;

&lt;blockquote&gt;&lt;p&gt;I suspect that most tests using spinAssertEquals with a shorter timeout would also fail if we run them with such a high number of iterations.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I suspect so too, but that may just be the point where you are statistically bound to get bitten by an environmental problem.&lt;/p&gt;

&lt;p&gt;Committed with the timeout changed to 120s.&lt;/p&gt;
</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310560">
                    <name>Problem/Incident</name>
                                                                <inwardlinks description="is caused by">
                                        <issuelink>
            <issuekey id="13400061">CASSANDRA-16924</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="13400062">CASSANDRA-16925</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                            <issuelinktype id="12310760">
                    <name>Testing</name>
                                            <outwardlinks description="Testing discovered">
                                        <issuelink>
            <issuekey id="13491744">CASSANDRA-17995</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[brandon.williams]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12313825" key="com.atlassian.jira.plugin.system.customfieldtypes:cascadingselect">
                        <customfieldname>Bug Category</customfieldname>
                        <customfieldvalues>
                                                    <customfieldvalue key="12982" cascade-level=""><![CDATA[Correctness]]></customfieldvalue>
                                <customfieldvalue key="12990" cascade-level="1"><![CDATA[Test Failure]]></customfieldvalue>
            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12313821" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Complexity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12965"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313822" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Discovered By</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12970"><![CDATA[Unit Test]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12313922" key="jira.plugin.projectspecificselectfield.jpssf:multicftype">
                        <customfieldname>Impacts</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="13100"><![CDATA[None]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            3 years, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12313921" key="jira.plugin.projectspecificselectfield.jpssf:multicftype">
                        <customfieldname>Platform</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="13076"><![CDATA[All]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z18w00:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[adelapena]]></customfieldvalue>
        <customfieldvalue><![CDATA[bereng]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12962"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12311420" key="com.atlassian.jira.plugin.system.customfieldtypes:version">
                        <customfieldname>Since Version</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="12348283">4.0-alpha3</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313924" key="com.atlassian.jira.plugin.system.customfieldtypes:textfield">
                        <customfieldname>Source Control Link</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>&lt;p&gt;&lt;a href=&quot;https://github.com/apache/cassandra/commit/70478a1578fe4facb0f59fcb40529e0a4040ac81&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/cassandra/commit/70478a1578fe4facb0f59fcb40529e0a4040ac81&lt;/a&gt;&lt;/p&gt;</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313823" key="com.atlassian.jira.plugin.system.customfieldtypes:textarea">
                        <customfieldname>Test and Documentation Plan</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>&lt;p&gt;run CI&lt;/p&gt;</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>