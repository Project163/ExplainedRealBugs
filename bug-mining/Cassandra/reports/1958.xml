<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 22:36:37 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-4753] Timeout reporter writes hints for the local node</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-4753</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;MessagingService.java:330 calls StorageProxy.scheduleLocalHint() without checking if the local node is the target. This causes StorageProxy.scheduleLocalHint to throw AssertionError sometimes.&lt;/p&gt;

&lt;p&gt;Got this error when some batches are timed out. This can happen because even local batches now go through StorageProxy.sendMessages and aren&apos;t just rm.apply()&apos;d.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12610089">CASSANDRA-4753</key>
            <summary>Timeout reporter writes hints for the local node</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10003" iconUrl="https://issues.apache.org/jira/images/icons/priorities/trivial.svg">Low</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="jbellis">Jonathan Ellis</assignee>
                                    <reporter username="aleksey">Aleksey Yeschenko</reporter>
                        <labels>
                    </labels>
                <created>Wed, 3 Oct 2012 15:47:49 +0000</created>
                <updated>Tue, 16 Apr 2019 09:32:26 +0000</updated>
                            <resolved>Wed, 19 Dec 2012 20:56:53 +0000</resolved>
                                        <fixVersion>1.2.1</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="13468628" author="iamaleksey" created="Wed, 3 Oct 2012 15:51:39 +0000"  >&lt;p&gt;See &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-4542?focusedCommentId=13451479&amp;amp;page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13451479&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/CASSANDRA-4542?focusedCommentId=13451479&amp;amp;page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13451479&lt;/a&gt;&lt;br/&gt;
and &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-4542?focusedCommentId=13451486&amp;amp;page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13451486&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/CASSANDRA-4542?focusedCommentId=13451486&amp;amp;page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13451486&lt;/a&gt;&lt;/p&gt;
</comment>
                            <comment id="13468631" author="iamaleksey" created="Wed, 3 Oct 2012 15:54:26 +0000"  >&lt;p&gt;Special-casing for local inserts might be worth it now that abm is the default and we went even futher with &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-4738&quot; title=&quot;Improve CQL3 batchlog support&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-4738&quot;&gt;&lt;del&gt;CASSANDRA-4738&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="13468632" author="jbellis" created="Wed, 3 Oct 2012 15:54:38 +0000"  >&lt;p&gt;Sounds like the right solution is to add a local-only apply the way we do for normal Mutations.&lt;/p&gt;</comment>
                            <comment id="13499999" author="iamaleksey" created="Mon, 19 Nov 2012 03:17:48 +0000"  >&lt;p&gt;That particular error has been fixed some time ago (same issue that was causing batchlog timeouts in beta1). So there is really no need to special-case timeout-reporter for local node - such cases just should not happen.&lt;/p&gt;

&lt;p&gt;However, I added a check for local node to StorageProxy.shouldHint so that no issue like this one pops in the future.&lt;/p&gt;</comment>
                            <comment id="13500099" author="jbellis" created="Mon, 19 Nov 2012 09:00:41 +0000"  >&lt;p&gt;It&apos;s valid for local writes to timeout, but we don&apos;t want to just drop them on the floor if they do.  v2 attached.&lt;/p&gt;</comment>
                            <comment id="13500136" author="iamaleksey" created="Mon, 19 Nov 2012 10:48:05 +0000"  >&lt;p&gt;You are right. There is still the option of special-casing local endpoint for syncWriteToBatchlog and asyncRemoveFromBatchlog. I know single-node clusters are not a pirority, but still. That would also make this issue go away.&lt;/p&gt;</comment>
                            <comment id="13500146" author="iamaleksey" created="Mon, 19 Nov 2012 11:03:16 +0000"  >&lt;p&gt;Something like v3.&lt;/p&gt;</comment>
                            <comment id="13500301" author="jbellis" created="Mon, 19 Nov 2012 15:19:24 +0000"  >&lt;p&gt;Hmm.  We actually have a couple problems here.&lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;We do allow local writes to be dropped, but&lt;/li&gt;
	&lt;li&gt;Nobody writes hints for dropped local writes&lt;/li&gt;
	&lt;li&gt;If local hints were attempted, they would error out (what v2 was trying to fix)&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;We actually do want to hint batchlog inserts to maintain the contract of &quot;timed out means it&apos;s in progress, you do not have to retry.&quot;&lt;/p&gt;

&lt;p&gt;I&apos;m not sure what the best way to add hinting (actually, retry-on-hint-stage) code for insertLocal is though.  One option would be to just make local writes non-droppable, but then we lose our backpressure mechanism of a full hint stage causing OverloadedException, and a poorly behaving client could OOM the coordinator with a lot of local writes.&lt;/p&gt;</comment>
                            <comment id="13501483" author="jbellis" created="Tue, 20 Nov 2012 21:23:10 +0000"  >&lt;p&gt;Here is one solution: &lt;a href=&quot;http://github.com/jbellis/cassandra/branches/4753-5&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://github.com/jbellis/cassandra/branches/4753-5&lt;/a&gt;&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Created LocalMutationRunnable that retries with hint backpressure if it gets dropped&lt;/li&gt;
	&lt;li&gt;Added an updated v3, with an additional assert to make sure we don&apos;t introduce a bug if we decide to allow using the coordinator as a batchlog member in non-single-node clusters&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13536417" author="iamaleksey" created="Wed, 19 Dec 2012 20:45:57 +0000"  >&lt;p&gt;+1&lt;/p&gt;</comment>
                            <comment id="13536422" author="jbellis" created="Wed, 19 Dec 2012 20:56:54 +0000"  >&lt;p&gt;committed&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12554140" name="4753-v2.txt" size="1762" author="jbellis" created="Mon, 19 Nov 2012 09:00:41 +0000"/>
                            <attachment id="12554154" name="4753-v3.txt" size="1621" author="aleksey" created="Mon, 19 Nov 2012 11:03:00 +0000"/>
                            <attachment id="12554108" name="4753.txt" size="801" author="aleksey" created="Mon, 19 Nov 2012 03:15:04 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[jbellis]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>250367</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            12 years, 48 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0axxb:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>61769</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>aleksey</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[aleksey]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12961"><![CDATA[Low]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>