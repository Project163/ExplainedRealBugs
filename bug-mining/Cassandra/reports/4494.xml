<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 23:05:10 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-11534] cqlsh fails to format collections when using aliases</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-11534</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;Given is a simple table. Selecting the columns without an alias works fine. However, if the map is selected using an alias, cqlsh fails to format the value.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;create keyspace foo WITH replication = {&lt;span class=&quot;code-quote&quot;&gt;&apos;class&apos;&lt;/span&gt;: &lt;span class=&quot;code-quote&quot;&gt;&apos;SimpleStrategy&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;replication_factor&apos;&lt;/span&gt;: 1};
CREATE TABLE foo.foo (id &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; primary key, m map&amp;lt;&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;, text&amp;gt;);
insert into foo.foo (id, m) VALUES ( 1, {1: &lt;span class=&quot;code-quote&quot;&gt;&apos;one&apos;&lt;/span&gt;, 2: &lt;span class=&quot;code-quote&quot;&gt;&apos;two&apos;&lt;/span&gt;, 3:&lt;span class=&quot;code-quote&quot;&gt;&apos;three&apos;&lt;/span&gt;});
insert into foo.foo (id, m) VALUES ( 2, {1: &lt;span class=&quot;code-quote&quot;&gt;&apos;1one&apos;&lt;/span&gt;, 2: &lt;span class=&quot;code-quote&quot;&gt;&apos;2two&apos;&lt;/span&gt;, 3:&lt;span class=&quot;code-quote&quot;&gt;&apos;3three&apos;&lt;/span&gt;});

cqlsh&amp;gt; select id, m from foo.foo;

 id | m
----+-------------------------------------
  1 |    {1: &lt;span class=&quot;code-quote&quot;&gt;&apos;one&apos;&lt;/span&gt;, 2: &lt;span class=&quot;code-quote&quot;&gt;&apos;two&apos;&lt;/span&gt;, 3: &lt;span class=&quot;code-quote&quot;&gt;&apos;three&apos;&lt;/span&gt;}
  2 | {1: &lt;span class=&quot;code-quote&quot;&gt;&apos;1one&apos;&lt;/span&gt;, 2: &lt;span class=&quot;code-quote&quot;&gt;&apos;2two&apos;&lt;/span&gt;, 3: &lt;span class=&quot;code-quote&quot;&gt;&apos;3three&apos;&lt;/span&gt;}

(2 rows)
cqlsh&amp;gt; select id, m as &lt;span class=&quot;code-quote&quot;&gt;&quot;weofjkewopf&quot;&lt;/span&gt; from foo.foo;

 id | weofjkewopf
----+-----------------------------------------------------------------------
  1 |    OrderedMapSerializedKey([(1, u&lt;span class=&quot;code-quote&quot;&gt;&apos;one&apos;&lt;/span&gt;), (2, u&lt;span class=&quot;code-quote&quot;&gt;&apos;two&apos;&lt;/span&gt;), (3, u&lt;span class=&quot;code-quote&quot;&gt;&apos;three&apos;&lt;/span&gt;)])
  2 | OrderedMapSerializedKey([(1, u&lt;span class=&quot;code-quote&quot;&gt;&apos;1one&apos;&lt;/span&gt;), (2, u&lt;span class=&quot;code-quote&quot;&gt;&apos;2two&apos;&lt;/span&gt;), (3, u&lt;span class=&quot;code-quote&quot;&gt;&apos;3three&apos;&lt;/span&gt;)])

(2 rows)
Failed to format value OrderedMapSerializedKey([(1, u&lt;span class=&quot;code-quote&quot;&gt;&apos;one&apos;&lt;/span&gt;), (2, u&lt;span class=&quot;code-quote&quot;&gt;&apos;two&apos;&lt;/span&gt;), (3, u&lt;span class=&quot;code-quote&quot;&gt;&apos;three&apos;&lt;/span&gt;)]) : &lt;span class=&quot;code-quote&quot;&gt;&apos;NoneType&apos;&lt;/span&gt; object has no attribute &lt;span class=&quot;code-quote&quot;&gt;&apos;sub_types&apos;&lt;/span&gt;
Failed to format value OrderedMapSerializedKey([(1, u&lt;span class=&quot;code-quote&quot;&gt;&apos;1one&apos;&lt;/span&gt;), (2, u&lt;span class=&quot;code-quote&quot;&gt;&apos;2two&apos;&lt;/span&gt;), (3, u&lt;span class=&quot;code-quote&quot;&gt;&apos;3three&apos;&lt;/span&gt;)]) : &lt;span class=&quot;code-quote&quot;&gt;&apos;NoneType&apos;&lt;/span&gt; object has no attribute &lt;span class=&quot;code-quote&quot;&gt;&apos;sub_types&apos;&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="12957218">CASSANDRA-11534</key>
            <summary>cqlsh fails to format collections when using aliases</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10003" iconUrl="https://issues.apache.org/jira/images/icons/priorities/trivial.svg">Low</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="stefania">Stefania Alborghetti</assignee>
                                    <reporter username="snazy">Robert Stupp</reporter>
                        <labels>
                            <label>cqlsh</label>
                    </labels>
                <created>Fri, 8 Apr 2016 14:09:24 +0000</created>
                <updated>Tue, 16 Apr 2019 09:30:36 +0000</updated>
                            <resolved>Thu, 13 Oct 2016 01:29:10 +0000</resolved>
                                        <fixVersion>3.10</fixVersion>
                                    <component>Legacy/Tools</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>6</watches>
                                                                                                                <comments>
                            <comment id="15426021" author="arunkumar" created="Thu, 18 Aug 2016 07:25:23 +0000"  >&lt;p&gt;This is because while formatting the row values the corresponding &quot;cql_types&quot; (ex: list&lt;span class=&quot;error&quot;&gt;&amp;#91;text&amp;#93;&lt;/span&gt;, text) are None for all the aliases.&lt;/p&gt;

&lt;p&gt;In the line /bin/cqlsh.py#L1339&lt;br/&gt;
 cql_types = [CqlType(table_meta.columns&lt;span class=&quot;error&quot;&gt;&amp;#91;c&amp;#93;&lt;/span&gt;.cql_type, ks_meta)&lt;br/&gt;
                           if c in table_meta.columns else None for c in column_names]&lt;br/&gt;
formatted_values = &lt;span class=&quot;error&quot;&gt;&amp;#91;map(self.myformat_value, row.values(), cql_types) for row in rows&amp;#93;&lt;/span&gt;&lt;/p&gt;


&lt;p&gt;&quot;table_meta.columns&quot; contains the actual column names but &quot;column_names&quot; from result query contains the aliases so the cql_types list contains None for the aliases.&lt;/p&gt;

&lt;p&gt;Related ticket: &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-11274&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/CASSANDRA-11274&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15432293" author="mikand" created="Tue, 23 Aug 2016 07:26:36 +0000"  >&lt;p&gt;This seems to be the case for UDA/UDF that attempts to format the result into a collection as well. &lt;/p&gt;</comment>
                            <comment id="15436772" author="vibushanan" created="Thu, 25 Aug 2016 12:43:09 +0000"  >&lt;p&gt;this happens when we attempt to format the result to a collection from a table/UDA/UDF&lt;/p&gt;</comment>
                            <comment id="15483402" author="stefania" created="Mon, 12 Sep 2016 07:50:27 +0000"  >&lt;p&gt;Thank you for your analysis &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=arunkumar&quot; class=&quot;user-hover&quot; rel=&quot;arunkumar&quot;&gt;arunkumar&lt;/a&gt;. It is correct, the problem was introduced by &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-11274&quot; title=&quot;cqlsh: interpret CQL type for formatting blob types&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-11274&quot;&gt;&lt;del&gt;CASSANDRA-11274&lt;/del&gt;&lt;/a&gt; and it only affects trunk (versions 3.6+).&lt;/p&gt;

&lt;p&gt;As far as I could see, there is no way to map a column alias to the original column name once the result set is received. So the only way to fix this, short of reverting 11274, is to add the CQL types to the result set, for which we need to change the python driver. Here is a &lt;a href=&quot;https://github.com/stef1927/python-driver/commits/11534&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;patch&lt;/a&gt; for the driver, I can create a pull request if you agree &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=aholmber&quot; class=&quot;user-hover&quot; rel=&quot;aholmber&quot;&gt;aholmber&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;Once the bundled driver is updated, we can then apply this patch to cqlsh:&lt;/p&gt;

&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/stef1927/cassandra/commits/11534-cqlsh&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;patch&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/stef1927/job/stef1927-11534-cqlsh-cqlsh-tests/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;cqlsh tests&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;
</comment>
                            <comment id="15486613" author="stefania" created="Tue, 13 Sep 2016 08:12:28 +0000"  >&lt;p&gt;There&apos;s a problem with the cqlsh copy tests, they hang pretty much every time. It seems child processes do not report the status back to the parent process for some chunks. &lt;/p&gt;</comment>
                            <comment id="15489275" author="stefania" created="Wed, 14 Sep 2016 03:36:50 +0000"  >&lt;p&gt;The tests are fine now. To fix them I had to rebase my driver patch from the &lt;em&gt;cassandra-test&lt;/em&gt; branch to the 3.6.0 release tag, so something on that branch is causing some insert requests not to be acknowledged, possibly due to errors, this in turn causes the tests to hang. It may be related to the recent protocol version 5 changes.&lt;/p&gt;</comment>
                            <comment id="15490588" author="aholmber" created="Wed, 14 Sep 2016 14:37:23 +0000"  >&lt;p&gt;This approach seems good &amp;#8211; thanks for the patch. We welcome a PR, but since we just released the core driver, we may need to just roll from an intermediate commit. Will also need to apply to cassandra-test.&lt;/p&gt;</comment>
                            <comment id="15491917" author="stefania" created="Thu, 15 Sep 2016 00:39:44 +0000"  >&lt;p&gt;Rolling from an intermediate commit is fine. I&apos;ve created a PR against master &lt;a href=&quot;https://github.com/datastax/python-driver/pull/665&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;here&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="15553950" author="stefania" created="Fri, 7 Oct 2016 03:06:28 +0000"  >&lt;p&gt;The driver &lt;a href=&quot;https://github.com/datastax/python-driver/pull/665&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;pull request&lt;/a&gt; is still not merged, ping &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=aholmber&quot; class=&quot;user-hover&quot; rel=&quot;aholmber&quot;&gt;aholmber&lt;/a&gt;. &lt;/p&gt;</comment>
                            <comment id="15568033" author="stefania" created="Wed, 12 Oct 2016 08:28:14 +0000"  >&lt;p&gt;The driver pull request has been merged. I&apos;ve updated the cqlsh driver and relaunched the tests:&lt;/p&gt;

&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;3.X&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;trunk&lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/stef1927/cassandra/commits/11534-cqlsh-3.X&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;patch&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/stef1927/cassandra/commits/11534-cqlsh&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;patch&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/stef1927/job/stef1927-11534-cqlsh-3.X-cqlsh-tests/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;dtest&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/stef1927/job/stef1927-11534-cqlsh-cqlsh-tests/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;dtest&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;
</comment>
                            <comment id="15568060" author="snazy" created="Wed, 12 Oct 2016 08:40:59 +0000"  >&lt;p&gt;Alright - will do the review later today (sorry for the delay).&lt;/p&gt;</comment>
                            <comment id="15568144" author="snazy" created="Wed, 12 Oct 2016 09:14:36 +0000"  >&lt;p&gt;+1 (cqlsh-tests pending)&lt;/p&gt;</comment>
                            <comment id="15570478" author="stefania" created="Thu, 13 Oct 2016 01:28:51 +0000"  >&lt;p&gt;Thank you for the review. CI results are clean, committed to 3.X as a0419085d58403557c81f4c9b784aaa7cf019314 and merged into trunk.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310050">
                    <name>Regression</name>
                                            <outwardlinks description="breaks">
                                        <issuelink>
            <issuekey id="13013732">CASSANDRA-12815</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[stefania]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 5 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2vuf3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12311421" key="com.atlassian.jira.plugin.system.customfieldtypes:multiversion">
                        <customfieldname>Reproduced In</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="12335055">3.6</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>snazy</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[snazy]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12961"><![CDATA[Low]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>