<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 22:58:06 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-10052] Misleading down-node push notifications when rpc_address is shared</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-10052</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;When a node goes down, the other nodes learn that through the gossip.&lt;/p&gt;

&lt;p&gt;And I do see the log from (Gossiper.java):&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; void markDead(InetAddress addr, EndpointState localState)
   {
       &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (logger.isTraceEnabled())
           logger.trace(&lt;span class=&quot;code-quote&quot;&gt;&quot;marking as down {}&quot;&lt;/span&gt;, addr);
       localState.markDead();
       liveEndpoints.remove(addr);
       unreachableEndpoints.put(addr, &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.nanoTime());
       logger.info(&lt;span class=&quot;code-quote&quot;&gt;&quot;InetAddress {} is now DOWN&quot;&lt;/span&gt;, addr);
       &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; (IEndpointStateChangeSubscriber subscriber : subscribers)
           subscriber.onDead(addr, localState);
       &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (logger.isTraceEnabled())
           logger.trace(&lt;span class=&quot;code-quote&quot;&gt;&quot;Notified &quot;&lt;/span&gt; + subscribers);
   }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Saying: &quot;InetAddress 192.168.101.1 is now Down&quot;, in the Cassandra&apos;s system log.&lt;/p&gt;

&lt;p&gt;Now on all the other nodes the client side (java driver) says, &quot; Cannot connect to any host, scheduling retry in 1000 milliseconds&quot;. They eventually do reconnect but some queries fail during this intermediate period.&lt;/p&gt;

&lt;p&gt;To me it seems like when the server pushes the nodeDown event, it call the getRpcAddress(endpoint), and thus sends localhost as the argument in the nodeDown event.  &lt;/p&gt;

&lt;p&gt;As in org.apache.cassandra.transport.Server.java&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;  &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void onDown(InetAddress endpoint)
       {      
           server.connectionTracker.send(Event.StatusChange.nodeDown(getRpcAddress(endpoint), server.socket.getPort()));
       }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;the getRpcAddress returns localhost for any endpoint if the cassandra.yaml is using localhost as the configuration for rpc_address (which by the way is the default).&lt;/p&gt;</description>
                <environment></environment>
        <key id="12855474">CASSANDRA-10052</key>
            <summary>Misleading down-node push notifications when rpc_address is shared</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10002" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Normal</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="stefania">Stefania Alborghetti</assignee>
                                    <reporter username="sharvanath">Sharvanath Pathak</reporter>
                        <labels>
                    </labels>
                <created>Wed, 12 Aug 2015 07:20:22 +0000</created>
                <updated>Wed, 6 Nov 2019 21:58:05 +0000</updated>
                            <resolved>Wed, 30 Sep 2015 15:53:22 +0000</resolved>
                                        <fixVersion>2.1.10</fixVersion>
                    <fixVersion>2.2.2</fixVersion>
                    <fixVersion>3.0.0 rc2</fixVersion>
                                    <component>Legacy/CQL</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>10</watches>
                                                                                                                <comments>
                            <comment id="14693539" author="jbellis" created="Wed, 12 Aug 2015 14:13:53 +0000"  >&lt;p&gt;How do you have clients connecting to non-localhost, if you&apos;ve configured it to listen on localhost?&lt;/p&gt;</comment>
                            <comment id="14693892" author="sharvanath" created="Wed, 12 Aug 2015 17:28:50 +0000"  >&lt;p&gt;The clients are only connected to the localhost, but this event is coming even if some other node fails. I think not sending these uninteresting events could be a right fix, but right now it seems like it is upto the client to ignore them. Moreover, in this case the argument of the event is localhost, so the client can&apos;t do anything.&lt;/p&gt;

&lt;p&gt;Disclaimer: I&apos;m using 2.0.9, but on a quick inspection it seems that the code for this part has not changed since.&lt;/p&gt;</comment>
                            <comment id="14694014" author="jbellis" created="Wed, 12 Aug 2015 19:01:00 +0000"  >&lt;p&gt;I see.  Sounds like we should just special-case it and not send anything from onDown if a peer listening on localhost goes down.&lt;/p&gt;</comment>
                            <comment id="14695016" author="omichallat" created="Thu, 13 Aug 2015 10:11:58 +0000"  >&lt;p&gt;Yes, I agree with that fix.&lt;br/&gt;
It&apos;s safe to not send the notification, because the only client that would be interested in it has lost its control connection anyway. It will find out by itself when the connections get closed.&lt;br/&gt;
We should even extend that to other notifications, otherwise the client will get &quot;fake&quot; ADD, UP or REMOVED events.&lt;/p&gt;

&lt;p&gt;That&apos;s an interesting setup because drivers use rpc_address to uniquely identify nodes, but here all nodes use the same address so each client thinks there is only one node.&lt;/p&gt;</comment>
                            <comment id="14725082" author="stefania" created="Tue, 1 Sep 2015 09:43:45 +0000"  >&lt;p&gt;Our strategy for testing pushed notifications relies mostly on distributed tests (dtests), where we start multiple nodes on the same box by overriding &lt;tt&gt;rpc_address&lt;/tt&gt; to 127.0.01, 127.0.0.2 and so forth. Therefore this problem went undetected. I managed to create a &lt;a href=&quot;https://github.com/stef1927/cassandra-dtest/commits/10052&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;dtest&lt;/a&gt; reproducing this problem nonetheless, albeit in a slightly contrived way as I had to create 3 nodes, make sure the node on 127.0.0.1 is stopped, then change the address of 127.0.0.3 to localhost (which clashes with 127.0.0.1) and check the notifications sent by 127.0.0.2 about 127.0.0.3.&lt;/p&gt;

&lt;p&gt;I&apos;m not sure why we should skip notifications altogether rather than still sending them using the Gossip endpoint address, in a similar way to what &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-5899&quot; title=&quot;Sends all interface in native protocol notification when rpc_address=0.0.0.0&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-5899&quot;&gt;&lt;del&gt;CASSANDRA-5899&lt;/del&gt;&lt;/a&gt; does when &lt;tt&gt;rcp_address&lt;/tt&gt; is set to 0.0.0.0? &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=thobbs&quot; class=&quot;user-hover&quot; rel=&quot;thobbs&quot;&gt;thobbs&lt;/a&gt; any thoughts?&lt;/p&gt;

&lt;p&gt;Here is a tentative &lt;a href=&quot;https://github.com/stef1927/cassandra/commits/10052-2.1&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;2.1 patch&lt;/a&gt;. We change the address to the endpoint address but we could just as easily suppress the notifications.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jbellis&quot; class=&quot;user-hover&quot; rel=&quot;jbellis&quot;&gt;jbellis&lt;/a&gt; is this required for 2.0?&lt;/p&gt;</comment>
                            <comment id="14725327" author="jbellis" created="Tue, 1 Sep 2015 12:37:01 +0000"  >&lt;p&gt;2.1+&lt;/p&gt;</comment>
                            <comment id="14725534" author="thobbs" created="Tue, 1 Sep 2015 15:14:19 +0000"  >&lt;blockquote&gt;&lt;p&gt;I&apos;m not sure why we should skip notifications altogether rather than still sending them using the Gossip endpoint address, in a similar way to what &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-5899&quot; title=&quot;Sends all interface in native protocol notification when rpc_address=0.0.0.0&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-5899&quot;&gt;&lt;del&gt;CASSANDRA-5899&lt;/del&gt;&lt;/a&gt; does when rcp_address is set to 0.0.0.0? Tyler Hobbs any thoughts?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;The python driver uniquely identifies nodes by their &lt;tt&gt;rpc_address&lt;/tt&gt; (or &lt;tt&gt;broadcast_rpc_address&lt;/tt&gt;).  I&apos;m looking into what the other drivers do, but I&apos;m guessing it&apos;s the same (EDIT: they are the same).  If we send a notification with the &lt;tt&gt;listen&lt;/tt&gt;/&lt;tt&gt;broadcast_address&lt;/tt&gt;, the drivers are likely to ignore it because the address won&apos;t be recognized.&lt;/p&gt;

&lt;p&gt;Ultimately, I think the drivers may need to move to uniquely representing hosts by their &lt;tt&gt;broadcast_address&lt;/tt&gt; to handle this kind of setup better.  That&apos;s a little tricky, because the initial contact points and load balancing policies all currently work on rpc addresses.  To help support this on the C* side, we should consider sending both the &lt;tt&gt;rpc_address&lt;/tt&gt; and &lt;tt&gt;broadcast_address&lt;/tt&gt; in push notifications.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;I see. Sounds like we should just special-case it and not send anything from onDown if a peer listening on localhost goes down.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I think this would work okay if we change the condition a bit.  Instead, don&apos;t send anything from &lt;tt&gt;onDown&lt;/tt&gt; if a peer with the same (&lt;tt&gt;broadcast_&lt;/tt&gt;)&lt;tt&gt;rpc_address&lt;/tt&gt; that we have goes down.  That &lt;em&gt;should&lt;/em&gt; only happen when the cluster is set up like this, but will still allow setups like ccm&apos;s to work normally.&lt;/p&gt;</comment>
                            <comment id="14726830" author="stefania" created="Wed, 2 Sep 2015 06:25:44 +0000"  >&lt;p&gt;Thanks for your suggestion &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=thobbs&quot; class=&quot;user-hover&quot; rel=&quot;thobbs&quot;&gt;thobbs&lt;/a&gt;. So what I did is to suppress the status change (UP/DOWN) and topology change (MOVE/JOIN/LEAVE) notifications if the endpoint broadcast rpc address is the same as our &lt;tt&gt;broadcast_rpc_address&lt;/tt&gt; and yet the endpoint is not the local node. There is no need to check &lt;tt&gt;rpc_address&lt;/tt&gt; as well because the broadcast rpc address is set to the rpc address when the user does not specify it and it is the broadcast rpc address that is sent over Gossip. Relevant code in &lt;tt&gt;SS.getRpcAddress()&lt;/tt&gt;.&lt;/p&gt;

&lt;p&gt;The code looks something like this:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (!endpoint.equals(FBUtilities.getBroadcastAddress()) &amp;amp;&amp;amp;
    event.nodeAddress().equals(DatabaseDescriptor.getBroadcastRpcAddress()))
    &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt;;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;where &lt;tt&gt;event.nodeAddress()&lt;/tt&gt; is the rpc broadcast address of the endpoint, as returned by &lt;tt&gt;Server.getRpcAddress(endpoint)&lt;/tt&gt;, which is unchanged.&lt;/p&gt;

&lt;p&gt;CI results for 2.1. will appear here:&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://cassci.datastax.com/job/stef1927-10052-2.1-testall/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://cassci.datastax.com/job/stef1927-10052-2.1-testall/&lt;/a&gt;&lt;br/&gt;
&lt;a href=&quot;http://cassci.datastax.com/job/stef1927-10052-2.1-dtest/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://cassci.datastax.com/job/stef1927-10052-2.1-dtest/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Do you have time to review or would you like to suggest someone else?&lt;/p&gt;

&lt;p&gt;If this solution is OK I will then merge into the 2.2+ branches to run CI there.&lt;/p&gt;</comment>
                            <comment id="14729707" author="thobbs" created="Thu, 3 Sep 2015 20:21:00 +0000"  >&lt;p&gt;The code changes and tests look good to me.  Go ahead and setup the 2.2+ branches and CI and I&apos;ll commit once those look good.&lt;/p&gt;</comment>
                            <comment id="14730230" author="stefania" created="Fri, 4 Sep 2015 02:52:53 +0000"  >&lt;p&gt;Thanks. &lt;/p&gt;

&lt;p&gt;There was an existing problem in 2.2: topology change events were not sent if restarting a host more than once. I fixed it in a separate commit.&lt;/p&gt;


&lt;h3&gt;&lt;a name=&quot;2.2&quot;&gt;&lt;/a&gt;2.2&lt;/h3&gt;
&lt;p&gt;&lt;a href=&quot;https://github.com/stef1927/cassandra/commits/10052-2.2&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/stef1927/cassandra/commits/10052-2.2&lt;/a&gt;&lt;br/&gt;
&lt;a href=&quot;http://cassci.datastax.com/job/stef1927-10052-2.2-testall/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://cassci.datastax.com/job/stef1927-10052-2.2-testall/&lt;/a&gt;&lt;br/&gt;
&lt;a href=&quot;http://cassci.datastax.com/job/stef1927-10052-2.2-dtest/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://cassci.datastax.com/job/stef1927-10052-2.2-dtest/&lt;/a&gt;&lt;/p&gt;

&lt;h3&gt;&lt;a name=&quot;3.0&quot;&gt;&lt;/a&gt;3.0&lt;/h3&gt;
&lt;p&gt;&lt;a href=&quot;https://github.com/stef1927/cassandra/commits/10052-3.0&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/stef1927/cassandra/commits/10052-3.0&lt;/a&gt;&lt;br/&gt;
&lt;a href=&quot;http://cassci.datastax.com/job/stef1927-10052-3.0-testall/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://cassci.datastax.com/job/stef1927-10052-3.0-testall/&lt;/a&gt;&lt;br/&gt;
&lt;a href=&quot;http://cassci.datastax.com/job/stef1927-10052-3.0-dtest/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://cassci.datastax.com/job/stef1927-10052-3.0-dtest/&lt;/a&gt;&lt;/p&gt;

&lt;h3&gt;&lt;a name=&quot;trunk&quot;&gt;&lt;/a&gt;trunk&lt;/h3&gt;
&lt;p&gt;&lt;a href=&quot;https://github.com/stef1927/cassandra/commits/10052&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/stef1927/cassandra/commits/10052&lt;/a&gt;&lt;br/&gt;
&lt;a href=&quot;http://cassci.datastax.com/job/stef1927-10052-testall/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://cassci.datastax.com/job/stef1927-10052-testall/&lt;/a&gt;&lt;br/&gt;
&lt;a href=&quot;http://cassci.datastax.com/job/stef1927-10052-dtest/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://cassci.datastax.com/job/stef1927-10052-dtest/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Dtest pull request: &lt;a href=&quot;https://github.com/riptano/cassandra-dtest/pull/532&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/riptano/cassandra-dtest/pull/532&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14935901" author="sharvanath" created="Tue, 29 Sep 2015 21:28:57 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=Stefania&quot; class=&quot;user-hover&quot; rel=&quot;stefania&quot;&gt;Stefania&lt;/a&gt; Do you have an idea as to when this will be pushed to 2.1? We would like to use this in our systems.&lt;/p&gt;

&lt;p&gt;Thanks a lot for writing the diff.&lt;/p&gt;</comment>
                            <comment id="14935964" author="mshuler" created="Tue, 29 Sep 2015 21:52:29 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=sharvanath&quot; class=&quot;user-hover&quot; rel=&quot;sharvanath&quot;&gt;sharvanath&lt;/a&gt; when this JIRA ticket shows it has been completed, it will be closed as resolved, usually with a commit comment. You could certainly build a custom jar with the patch, if you need to - just check out the latest git release tag, patch, and build.&lt;/p&gt;</comment>
                            <comment id="14936028" author="stefania" created="Tue, 29 Sep 2015 22:27:54 +0000"  >&lt;p&gt;Checked with &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=omichallat&quot; class=&quot;user-hover&quot; rel=&quot;omichallat&quot;&gt;omichallat&lt;/a&gt;, he can help with testing but we need another reviewer.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=thobbs&quot; class=&quot;user-hover&quot; rel=&quot;thobbs&quot;&gt;thobbs&lt;/a&gt; would you be able to review the remaining part of the patch or shall we find someone else?&lt;/p&gt;</comment>
                            <comment id="14936033" author="jaingaurav" created="Tue, 29 Sep 2015 22:31:10 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mshuler&quot; class=&quot;user-hover&quot; rel=&quot;mshuler&quot;&gt;mshuler&lt;/a&gt; Thanks for the tip. What would be the process to get this patch included in official 2.1.10 release? Also it seems this bug has not yet moved to the resolved state.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=Stefania&quot; class=&quot;user-hover&quot; rel=&quot;stefania&quot;&gt;Stefania&lt;/a&gt; thanks again for putting up this patch. Since it seems the testing was already done for 2.1, would it be possible for you or &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=thobbs&quot; class=&quot;user-hover&quot; rel=&quot;thobbs&quot;&gt;thobbs&lt;/a&gt; to pull this into the 2.1 branches as well as the others?&lt;/p&gt;</comment>
                            <comment id="14936039" author="stefania" created="Tue, 29 Sep 2015 22:36:39 +0000"  >&lt;p&gt;Once it has been reviewed it will be committed on all branches starting with 2.1.&lt;/p&gt;</comment>
                            <comment id="14936071" author="jaingaurav" created="Tue, 29 Sep 2015 23:07:43 +0000"  >&lt;p&gt;Thanks for the clarification &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=Stefania&quot; class=&quot;user-hover&quot; rel=&quot;stefania&quot;&gt;Stefania&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14936187" author="thobbs" created="Wed, 30 Sep 2015 00:58:27 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=Stefania&quot; class=&quot;user-hover&quot; rel=&quot;stefania&quot;&gt;Stefania&lt;/a&gt; sure, I can review this tomorrow.&lt;/p&gt;</comment>
                            <comment id="14936416" author="omichallat" created="Wed, 30 Sep 2015 06:11:54 +0000"  >&lt;p&gt;I&apos;ve tested the fix with with the Java driver.&lt;/p&gt;

&lt;p&gt;Set up a Cassandra cluster on two local VMs with the configuration described in the initial report:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;set listen_address to the public address&lt;/li&gt;
	&lt;li&gt;keep rpc_address to localhost&lt;/li&gt;
	&lt;li&gt;set node0 as seed on both sides&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Deployed a Java client on both VMs: Java driver 2.1.7.1, merely logs the state changes (by registering a &lt;tt&gt;Host.StateListener&lt;/tt&gt; at startup).&lt;/p&gt;

&lt;p&gt;Kill Cassandra on node0.&lt;/p&gt;

&lt;p&gt;Before the fix (cassandra-2.1 branch): &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;node0 logs &quot;127.0.0.1 down&quot; (as expected)&lt;/li&gt;
	&lt;li&gt;node1 logs &quot;127.0.0.1 down&quot; then 1 second after &quot;127.0.0.1 up&quot; (bug)&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;After the fix (stef1927/10052-2.1 branch):&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;node0 logs &quot;127.0.0.1 down&quot; (as expected)&lt;/li&gt;
	&lt;li&gt;node1 logs nothing (as expected)&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Also reviewed the patch and it looks OK to me.&lt;/p&gt;</comment>
                            <comment id="14937040" author="thobbs" created="Wed, 30 Sep 2015 15:53:22 +0000"  >&lt;p&gt;+1, committed as &lt;tt&gt;f6cab37d5ee42313c7a5618c5d0694f312c9c194&lt;/tt&gt; to 2.1 and merged to 2.2 (with the extra fix) and upwards.&lt;/p&gt;</comment>
                            <comment id="14939109" author="stefania" created="Thu, 1 Oct 2015 00:34:33 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=thobbs&quot; class=&quot;user-hover&quot; rel=&quot;thobbs&quot;&gt;thobbs&lt;/a&gt; and &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=omichallat&quot; class=&quot;user-hover&quot; rel=&quot;omichallat&quot;&gt;omichallat&lt;/a&gt;: thank you so much for your work on this!&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[stefania]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12313922" key="jira.plugin.projectspecificselectfield.jpssf:multicftype">
                        <customfieldname>Impacts</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="13101"><![CDATA[Clients]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 7 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2it7r:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>omichallat</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[omichallat]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12962"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>