<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 22:37:00 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-5175] Unbounded (?) thread growth connecting to an removed node</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-5175</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;The following lines started repeating every minute in the log file&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt; INFO [GossipStage:1] 2013-01-19 19:35:43,929 Gossiper.java (line 831) InetAddress /10.238.x.y is now dead.
 INFO [GossipStage:1] 2013-01-19 19:35:43,930 StorageService.java (line 1291) Removing token 170141183460469231731687303715884105718 for /10.238.x.y
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Also, I got about 3000 threads which all look like this:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Name: WRITE-/10.238.x.y
State: WAITING on java.util.concurrent.locks.AbstractQueuedSynchronizer$ConditionObject@1bb65c0f
Total blocked: 0  Total waited: 3

Stack trace: 
 sun.misc.Unsafe.park(Native Method)
java.util.concurrent.locks.LockSupport.park(LockSupport.java:186)
java.util.concurrent.locks.AbstractQueuedSynchronizer$ConditionObject.await(AbstractQueuedSynchronizer.java:2043)
java.util.concurrent.LinkedBlockingQueue.take(LinkedBlockingQueue.java:442)
org.apache.cassandra.net.OutboundTcpConnection.run(OutboundTcpConnection.java:104)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;A new thread seems to be created every minute, and they never go away.&lt;/p&gt;

&lt;p&gt;The endpoint in question had been a part of the cluster weeks ago, and the node exhibiting the thread growth was added yesterday.&lt;/p&gt;

&lt;p&gt;Anyway, assassinating the endpoint in question stopped thread growth (but kept the existing threads running), so this isn&apos;t a huge issue.  But I don&apos;t think the thread count is supposed to be increasing like this...&lt;/p&gt;</description>
                <environment>&lt;p&gt;EC2, JDK 7u9, Ubuntu 12.04.1 LTS&lt;/p&gt;</environment>
        <key id="12628423">CASSANDRA-5175</key>
            <summary>Unbounded (?) thread growth connecting to an removed node</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10003" iconUrl="https://issues.apache.org/jira/images/icons/priorities/trivial.svg">Low</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="vijay2win@yahoo.com">Vijay</assignee>
                                    <reporter username="jalkanen">Janne Jalkanen</reporter>
                        <labels>
                    </labels>
                <created>Sat, 19 Jan 2013 19:52:59 +0000</created>
                <updated>Tue, 16 Apr 2019 09:32:19 +0000</updated>
                            <resolved>Wed, 23 Jan 2013 06:48:03 +0000</resolved>
                                        <fixVersion>1.1.10</fixVersion>
                    <fixVersion>1.2.1</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="13558124" author="brandon.williams" created="Sat, 19 Jan 2013 23:43:34 +0000"  >&lt;p&gt;Can you take a look, Vijay?&lt;/p&gt;</comment>
                            <comment id="13558162" author="vijay2win@yahoo.com" created="Sun, 20 Jan 2013 04:28:18 +0000"  >&lt;p&gt;I think the problem is that when we close the connection the thread will not be ended. Attached patch solves thread leak problem.&lt;/p&gt;</comment>
                            <comment id="13559896" author="brandon.williams" created="Tue, 22 Jan 2013 19:06:55 +0000"  >&lt;p&gt;Hard to know for certain if this is truly the cause, but it sounds plausible. +1&lt;/p&gt;</comment>
                            <comment id="13560430" author="vijay2win@yahoo.com" created="Wed, 23 Jan 2013 06:48:03 +0000"  >&lt;p&gt;Committed to trunk, 1.1 and 1.2. Thanks!&lt;/p&gt;</comment>
                            <comment id="13560455" author="vijay2win@yahoo.com" created="Wed, 23 Jan 2013 07:46:50 +0000"  >&lt;p&gt;Also added a commit db8705294ba96fe2b746fea4f26a919538653ebd for test failure (dtest), basically we should not close the thread because we convicted the node. Thanks!&lt;/p&gt;</comment>
                            <comment id="13721091" author="timiblossom" created="Fri, 26 Jul 2013 19:11:33 +0000"  >&lt;p&gt;Hi Vijay,&lt;/p&gt;

&lt;p&gt;I am using your commit db8705294ba96fe2b746fea4f26a919538653ebd but I think the logic in this commit is not the same as the attached patch.  Please take a look.&lt;/p&gt;

&lt;p&gt;if (m == CLOSE_SENTINEL)&lt;/p&gt;
             {
                 disconnect();
+                if (!isStopped)
+                    break;
                 continue;
             }


&lt;p&gt;I think it should be :&lt;/p&gt;

&lt;p&gt;       if (isStopped)&lt;br/&gt;
           break;&lt;/p&gt;

&lt;p&gt;Thanks.&lt;/p&gt;</comment>
                            <comment id="13721497" author="vijay2win@yahoo.com" created="Sat, 27 Jul 2013 02:12:01 +0000"  >&lt;p&gt;Yes there was another commit on top the attached patch to fix the test cases, yes the logic has changed since calling close() is the only time we need to stop the thread.&lt;/p&gt;

&lt;p&gt;Current code in the repo&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;            &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (m == CLOSE_SENTINEL)
            {
                disconnect();
                &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (isStopped)
                    &lt;span class=&quot;code-keyword&quot;&gt;break&lt;/span&gt;;
                &lt;span class=&quot;code-keyword&quot;&gt;continue&lt;/span&gt;;
            }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12565729" name="0001-CASSANDRA-5175.patch" size="1526" author="vijay2win@yahoo.com" created="Mon, 21 Jan 2013 04:07:38 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[vijay2win@yahoo.com]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>305577</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            12 years, 17 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i18ffr:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>257303</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>brandon.williams</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[brandon.williams]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12961"><![CDATA[Low]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>