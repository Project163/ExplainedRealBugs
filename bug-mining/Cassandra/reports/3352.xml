<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 22:50:38 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-8635] STCS cold sstable omission does not handle overwrites without reads</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-8635</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;In 2.1, STCS may omit cold SSTables from compaction (&lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-6109&quot; title=&quot;Consider coldness in STCS compaction&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-6109&quot;&gt;&lt;del&gt;CASSANDRA-6109&lt;/del&gt;&lt;/a&gt;).  If data is regularly overwritten or deleted (but not enough to trigger a single-sstable tombstone purging compaction), data size on disk may continuously grow if:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;The table receives very few reads&lt;/li&gt;
	&lt;li&gt;The reads only touch the newest SSTables&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Basically, if the overwritten data is never read and there aren&apos;t many tombstones, STCS has no incentive to compact the sstables.  We should take sstable overlap into consideration as well as coldness to address this case.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12767891">CASSANDRA-8635</key>
            <summary>STCS cold sstable omission does not handle overwrites without reads</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10000" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Urgent</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="marcuse">Marcus Eriksson</assignee>
                                    <reporter username="thobbs">Tom Hobbs</reporter>
                        <labels>
                    </labels>
                <created>Fri, 16 Jan 2015 00:43:50 +0000</created>
                <updated>Tue, 16 Apr 2019 09:31:23 +0000</updated>
                            <resolved>Wed, 28 Jan 2015 13:06:19 +0000</resolved>
                                        <fixVersion>2.1.3</fixVersion>
                                    <component>Local/Compaction</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>7</watches>
                                                                                                                <comments>
                            <comment id="14284602" author="tjake" created="Tue, 20 Jan 2015 23:04:03 +0000"  >&lt;p&gt;Will this fix take many days? if so we might want to wait till 2.1.4 since there is a workaround&lt;/p&gt;</comment>
                            <comment id="14284610" author="thobbs" created="Tue, 20 Jan 2015 23:10:08 +0000"  >&lt;p&gt;If we have to release 2.1.3 without a proper fix, I suggest disabling this behavior unless a &lt;tt&gt;-D&lt;/tt&gt; flag is present.  We could re-enable it in 2.1.4.&lt;/p&gt;

&lt;p&gt;Also, for any affected users, this is also a valid workaround:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;ALTER TABLE &amp;lt;tablename&amp;gt; WITH compaction = {&apos;class&apos;: &apos;SizeTieredCompactionStrategy&apos;, &apos;min_threshold&apos;: &apos;4&apos;, &apos;max_threshold&apos;: &apos;32&apos;, &apos;cold_reads_to_omit&apos;: 0.0};
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="14285278" author="krummas" created="Wed, 21 Jan 2015 07:14:57 +0000"  >&lt;p&gt;Started this yesterday, I&apos;ll most likely have a patch ready for review today&lt;/p&gt;</comment>
                            <comment id="14285536" author="krummas" created="Wed, 21 Jan 2015 11:48:02 +0000"  >&lt;p&gt;Attaching patch that will check how much the cold sstables overlap the hot ones that will be compacted, if they overlap more than 80% (magic number..) and have some columns in common (ie, they intersect based on max/min column names), they are added to the compaction.&lt;/p&gt;</comment>
                            <comment id="14286481" author="thobbs" created="Wed, 21 Jan 2015 22:58:17 +0000"  >&lt;p&gt;This definitely seems like it will help many cases, but it seems like there are still a couple of problematic scenarios:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;What if the cold sstables overlap with each other but not with any hot sstables?&lt;/li&gt;
	&lt;li&gt;What if they all overlap by 75% and thus fall below the threshold?&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;If we go with this strategy, it seems like we still need a safety mechanism to ensure that number of sstables never blows up, such as a max number of sstables.&lt;/p&gt;

&lt;p&gt;After thinking about this for a while, I&apos;m also tempted to scrap the whole don&apos;t-compact-cold-sstables in STCS approach in favor of using DTCS.  (This was implemented prior to DTCS being proposed.)  Since STCS somewhat randomly mixes data within sstables, the only pattern that is likely to generate &quot;cold&quot; sstables is when old data is read infrequently, and DTCS addresses many of those patterns more effectively.  Are there any opinions on this?&lt;/p&gt;</comment>
                            <comment id="14287107" author="krummas" created="Thu, 22 Jan 2015 08:26:10 +0000"  >&lt;p&gt;Hmm, yeah, this is probably the wrong approach - compacting cold data with hot data is likely to always be a bad solution. Maybe we should just do a standard compaction of any overlapping cold data if there are no &apos;hot&apos; compactions to do? Ie, if hot sstables are empty, just return the most overlapping cold ones?&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;scrap the whole don&apos;t-compact-cold-sstables in STCS&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Not all data models fit DTCS though and this gives users atleast a small benefit without remodelling their data. Do we expose any metrics on how many sstables we consider being cold?&lt;/p&gt;</comment>
                            <comment id="14287390" author="krummas" created="Thu, 22 Jan 2015 13:09:34 +0000"  >&lt;p&gt;attaching v2 which checks if there are any overlapping cold sstables to compact together&lt;/p&gt;

&lt;p&gt;uses ICardinality to estimate how many keys overlap between the sstables&lt;/p&gt;</comment>
                            <comment id="14293890" author="carlyeks" created="Tue, 27 Jan 2015 18:05:18 +0000"  >&lt;p&gt;Small nit: remove the unused params from the javadocs. Otherwise, +1&lt;/p&gt;</comment>
                            <comment id="14295116" author="krummas" created="Wed, 28 Jan 2015 13:06:19 +0000"  >&lt;p&gt;thanks, committed (realized we needed a null check - we don&apos;t have cardinality in 2.0, so for upgrades we would have thrown NPEs)&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12777272">CASSANDRA-8860</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12693572" name="0001-Include-cold-sstables-in-compactions-if-they-overlap.patch" size="12374" author="marcuse" created="Wed, 21 Jan 2015 11:48:13 +0000"/>
                            <attachment id="12693880" name="8635-v2.patch" size="16438" author="marcuse" created="Thu, 22 Jan 2015 13:09:34 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[marcuse]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 42 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i24fr3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>carlyeks</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[carlyeks]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12963"><![CDATA[Critical]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>