<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 22:29:55 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-4000] Division by zero on get_slice</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-4000</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;We have a column family with String row keys and Long column keys.&lt;/p&gt;

&lt;p&gt;Our WideEntityService is trying to get the first column in the range from 0 to Long.MAX. It&apos;s a batch operation performed for every row in the CF (rows count is approximately tens of thousands and each row contains from 0 to 1000 columns). &lt;/p&gt;

&lt;p&gt;After processing each row we are removing some of the columns we have queried. Also, at the same time we are writing in this CF in another threads but somewhat less intensive.&lt;/p&gt;

&lt;p&gt;An error rises approximately for a one of 100 rows.&lt;/p&gt;


&lt;p&gt;Exception itself:&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;05-Mar-2012 18:47:25,247&amp;#93;&lt;/span&gt; ERROR &lt;span class=&quot;error&quot;&gt;&amp;#91;http-8095-1 WideEntityServiceImpl.java:142&amp;#93;&lt;/span&gt; - get: key1 - &lt;/p&gt;
{type=RANGE, start=0, end=9223372036854775807, orderDesc=false, limit=1}
&lt;p&gt;me.prettyprint.hector.api.exceptions.HCassandraInternalException: Cassandra encountered an internal error processing this request: TApplicationError type: 6 message:Internal error processing get_slice&lt;br/&gt;
        at me.prettyprint.cassandra.service.ExceptionsTranslatorImpl.translate(ExceptionsTranslatorImpl.java:31)&lt;br/&gt;
        at me.prettyprint.cassandra.service.KeyspaceServiceImpl$7.execute(KeyspaceServiceImpl.java:285)&lt;br/&gt;
        at me.prettyprint.cassandra.service.KeyspaceServiceImpl$7.execute(KeyspaceServiceImpl.java:268)&lt;br/&gt;
        at me.prettyprint.cassandra.service.Operation.executeAndSetResult(Operation.java:101)&lt;br/&gt;
        at me.prettyprint.cassandra.connection.HConnectionManager.operateWithFailover(HConnectionManager.java:233)&lt;br/&gt;
        at me.prettyprint.cassandra.service.KeyspaceServiceImpl.operateWithFailover(KeyspaceServiceImpl.java:131)&lt;br/&gt;
        at me.prettyprint.cassandra.service.KeyspaceServiceImpl.getSlice(KeyspaceServiceImpl.java:289)&lt;br/&gt;
        at me.prettyprint.cassandra.model.thrift.ThriftSliceQuery$1.doInKeyspace(ThriftSliceQuery.java:53)&lt;br/&gt;
        at me.prettyprint.cassandra.model.thrift.ThriftSliceQuery$1.doInKeyspace(ThriftSliceQuery.java:49)&lt;br/&gt;
        at me.prettyprint.cassandra.model.KeyspaceOperationCallback.doInKeyspaceAndMeasure(KeyspaceOperationCallback.java:20)&lt;br/&gt;
        at me.prettyprint.cassandra.model.ExecutingKeyspace.doExecute(ExecutingKeyspace.java:85)&lt;br/&gt;
        at me.prettyprint.cassandra.model.thrift.ThriftSliceQuery.execute(ThriftSliceQuery.java:48)&lt;/p&gt;</description>
                <environment>&lt;p&gt;We start getting this exception after upgrading from 1.0.1 -&amp;gt; 1.0.8.&lt;/p&gt;

&lt;p&gt;4 nodes cluster on Cassandra v1.0.8. RF = 3. &lt;br/&gt;
Hector v0.8.0-3.&lt;/p&gt;</environment>
        <key id="12545192">CASSANDRA-4000</key>
            <summary>Division by zero on get_slice</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10002" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Normal</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="slebresne">Sylvain Lebresne</assignee>
                                    <reporter username="vanger">Sergey B</reporter>
                        <labels>
                    </labels>
                <created>Mon, 5 Mar 2012 15:45:47 +0000</created>
                <updated>Tue, 16 Apr 2019 09:32:38 +0000</updated>
                            <resolved>Wed, 7 Mar 2012 10:14:17 +0000</resolved>
                                        <fixVersion>1.0.9</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                                                                <comments>
                            <comment id="13222466" author="amorton" created="Mon, 5 Mar 2012 17:39:11 +0000"  >&lt;p&gt;What was the error in the server log ?&lt;/p&gt;</comment>
                            <comment id="13223033" author="vanger" created="Tue, 6 Mar 2012 06:41:26 +0000"  >&lt;p&gt;ERROR &lt;span class=&quot;error&quot;&gt;&amp;#91;Thrift:104&amp;#93;&lt;/span&gt; 2012-03-01 20:19:57,332 Cassandra.java (line 3041) Internal error processing get_slice&lt;br/&gt;
java.lang.ArithmeticException: / by zero&lt;br/&gt;
        at org.apache.cassandra.db.SliceFromReadCommand.maybeGenerateRetryCommand(SliceFromReadCommand.java:87)&lt;br/&gt;
        at org.apache.cassandra.service.StorageProxy.fetchRows(StorageProxy.java:724)&lt;br/&gt;
        at org.apache.cassandra.service.StorageProxy.read(StorageProxy.java:564)&lt;br/&gt;
        at org.apache.cassandra.thrift.CassandraServer.readColumnFamily(CassandraServer.java:128)&lt;br/&gt;
        at org.apache.cassandra.thrift.CassandraServer.getSlice(CassandraServer.java:283)&lt;br/&gt;
        at org.apache.cassandra.thrift.CassandraServer.multigetSliceInternal(CassandraServer.java:365)&lt;br/&gt;
        at org.apache.cassandra.thrift.CassandraServer.get_slice(CassandraServer.java:326)&lt;br/&gt;
        at org.apache.cassandra.thrift.Cassandra$Processor$get_slice.process(Cassandra.java:3033)&lt;br/&gt;
        at org.apache.cassandra.thrift.Cassandra$Processor.process(Cassandra.java:2889)&lt;br/&gt;
        at org.apache.cassandra.thrift.CustomTThreadPoolServer$WorkerProcess.run(CustomTThreadPoolServer.java:187)&lt;br/&gt;
        at java.util.concurrent.ThreadPoolExecutor$Worker.runTask(ThreadPoolExecutor.java:886)&lt;br/&gt;
        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:908)&lt;br/&gt;
        at java.lang.Thread.run(Thread.java:662)&lt;/p&gt;</comment>
                            <comment id="13223147" author="slebresne" created="Tue, 6 Mar 2012 10:32:16 +0000"  >&lt;p&gt;Slightly stupid bug introduced by &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-3934&quot; title=&quot;Short read protection is broken&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-3934&quot;&gt;&lt;del&gt;CASSANDRA-3934&lt;/del&gt;&lt;/a&gt;. Fix attached&lt;/p&gt;</comment>
                            <comment id="13223373" author="jbellis" created="Tue, 6 Mar 2012 16:18:17 +0000"  >&lt;p&gt;Can we add a test to catch this regression?&lt;/p&gt;</comment>
                            <comment id="13223392" author="slebresne" created="Tue, 6 Mar 2012 16:37:34 +0000"  >&lt;p&gt;I&apos;ve just pushed a dtest to reproduce (and checked the patch does fix). It&apos;s during short reads, so not sure there&apos;s an easy way to test that with a unit test.&lt;/p&gt;</comment>
                            <comment id="13223481" author="jbellis" created="Tue, 6 Mar 2012 18:04:50 +0000"  >&lt;p&gt;+1, although we might want to query for 2*count instead of count+1 in the no-live-columns case, since if all count columns were dead the odds seem pretty good that just one more column won&apos;t help.&lt;/p&gt;</comment>
                            <comment id="13223526" author="slebresne" created="Tue, 6 Mar 2012 18:40:20 +0000"  >&lt;p&gt;I hesitate on that one, but in fact I think that this case can realistically happen when:&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;either the user requested 1 or 2 columns (like in this ticket). Asking for +1 or *2 doesn&apos;t change much.&lt;/li&gt;
	&lt;li&gt;the row has been deleted but one node didn&apos;t got the tombstone yet (or at all). In that case, you mostly want for the RR to send the missed tombstone to the node missing it. However, we can&apos;t be sure the retry will arrive after the RR (i.e. we may need a third retry if we&apos;re unlucky), and so asking for twice more data from that one node may be less efficient.&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;I mean, clearly there is no need to over-think this and I&apos;m good with either +1 and *2 but I&apos;m not really convinced one will be better (nor really worse) than the other in general.&lt;/p&gt;</comment>
                            <comment id="13223543" author="jbellis" created="Tue, 6 Mar 2012 19:00:11 +0000"  >&lt;p&gt;Either one works for me.&lt;/p&gt;</comment>
                            <comment id="13224192" author="slebresne" created="Wed, 7 Mar 2012 10:14:17 +0000"  >&lt;p&gt;Committed, thanks&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12517216" name="4000.txt" size="1250" author="slebresne" created="Tue, 6 Mar 2012 10:32:16 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[slebresne]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>230378</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            13 years, 37 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0gqsn:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>95771</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>jbellis</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[jbellis]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12962"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>