<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 23:00:38 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-9465] No client warning on tombstone threshold</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-9465</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;It appears that a client warning is not coming back for the tombstone threshold case. The batch warning works.&lt;/p&gt;

&lt;p&gt;Repro:&lt;br/&gt;
Create a data condition with tombstone_warn_threshold &amp;lt; tombstones &amp;lt; tombstone_failure_threshold&lt;br/&gt;
Query the row&lt;/p&gt;

&lt;p&gt;Expected:&lt;br/&gt;
Warning in server log, warning returned to client&lt;/p&gt;

&lt;p&gt;I&apos;m basing this expectation on what I see &lt;a href=&quot;https://github.com/apache/cassandra/blob/68722e7e594d228b4bf14c8cd8cbee19b50835ec/src/java/org/apache/cassandra/db/filter/SliceQueryFilter.java#L235-L247&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;here&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Observed:&lt;br/&gt;
Warning in server log, no warning flag in response message.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12832289">CASSANDRA-9465</key>
            <summary>No client warning on tombstone threshold</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10003" iconUrl="https://issues.apache.org/jira/images/icons/priorities/trivial.svg">Low</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="carlyeks">Carl Yeksigian</assignee>
                                    <reporter username="aholmber">Adam Holmberg</reporter>
                        <labels>
                    </labels>
                <created>Fri, 22 May 2015 22:38:59 +0000</created>
                <updated>Wed, 15 Oct 2025 09:49:06 +0000</updated>
                            <resolved>Wed, 13 Jan 2016 19:50:53 +0000</resolved>
                                        <fixVersion>2.2.5</fixVersion>
                    <fixVersion>3.0.3</fixVersion>
                    <fixVersion>3.3</fixVersion>
                                    <component>Legacy/Observability</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="14727353" author="carlyeks" created="Wed, 2 Sep 2015 13:42:06 +0000"  >&lt;p&gt;I&apos;ve pushed a &lt;a href=&quot;https://github.com/carlyeks/cassandra/tree/ticket/9465/2.2&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;branch&lt;/a&gt; &amp;#8211; it changes the TracingAwareExecutor to allow for including other thread local state to be passed onto the task being run, currently just &lt;tt&gt;Tracing&lt;/tt&gt; and &lt;tt&gt;ClientWarn&lt;/tt&gt;.&lt;/p&gt;

&lt;p&gt;This change doesn&apos;t address remote warnings, so if the coordinator is not also the replica, we still won&apos;t get the messages. That requires a change to the internode protocol to add warnings, so it wouldn&apos;t be included in 2.2.&lt;/p&gt;</comment>
                            <comment id="14727553" author="jbellis" created="Wed, 2 Sep 2015 16:06:29 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=JoshuaMcKenzie&quot; class=&quot;user-hover&quot; rel=&quot;JoshuaMcKenzie&quot;&gt;JoshuaMcKenzie&lt;/a&gt; to review&lt;/p&gt;</comment>
                            <comment id="15011803" author="jmckenzie" created="Wed, 18 Nov 2015 19:45:49 +0000"  >&lt;p&gt;First off - sorry for the delay on review.&lt;/p&gt;

&lt;p&gt;Feedback:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;Update comment on DebuggableThreadPoolExecutor.LocalSessionWrapper&lt;/li&gt;
	&lt;li&gt;I&apos;m concerned about null check in ExecutorLocals:
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeHeader panelHeader&quot; style=&quot;border-bottom-width: 1px;&quot;&gt;&lt;b&gt;ExecutorLocals.create&lt;/b&gt;&lt;/div&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (traceState == &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; &amp;amp;&amp;amp; clientWarnState == &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;)
    &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;;
&lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt;
    &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; ExecutorLocals(traceState, clientWarnState);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;That&apos;s propagated into the thread local w/ExecutorLocals.set, so we&apos;re expecting all users of the ExecutorLocals to always check for null before accessing either of these? While I see us doing that with TraceState, I don&apos;t see the same for ClientWarn.State. If the relationship is &quot;Both are set or both are null&quot;, the code in ExecutorLocals.create should reflect that relationship.&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Also: I could be missing something here so feel free to clue me in; assigning and passing around ThreadLocal state between threads in an executor service isn&apos;t the clearest thing I&apos;ve ever reviewed.&lt;/p&gt;</comment>
                            <comment id="15089613" author="carlyeks" created="Fri, 8 Jan 2016 17:59:56 +0000"  >&lt;p&gt;I pushed an update with comments.&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;That&apos;s propagated into the thread local w/ExecutorLocals.set, so we&apos;re expecting all users of the ExecutorLocals to always check for null before accessing either of these? While I see us doing that with TraceState, I don&apos;t see the same for ClientWarn.State. If the relationship is &quot;Both are set or both are null&quot;, the code in ExecutorLocals.create should reflect that relationship.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;The use of ExecutorLocals as &lt;tt&gt;null&lt;/tt&gt; is a way of not creating a new object when neither the trace state nor the client warn state is initialized. Only one of them needs to be set, but not both.&lt;br/&gt;
The &lt;tt&gt;ClientWarn.State&lt;/tt&gt; checks happen at the access point for &lt;a href=&quot;https://github.com/carlyeks/cassandra/blob/ticket/9465/2.2/src/java/org/apache/cassandra/service/ClientWarn.java#L47&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;&lt;tt&gt;ClientWarn&lt;/tt&gt;&lt;/a&gt;; we don&apos;t use &lt;tt&gt;ClientWarn.get&lt;/tt&gt; directly other than for the &lt;tt&gt;ExecutorLocal&lt;/tt&gt; interface.&lt;/p&gt;</comment>
                            <comment id="15096702" author="jmckenzie" created="Wed, 13 Jan 2016 18:05:50 +0000"  >&lt;p&gt;The comments definitely help clarify and prevent future regressions.&lt;/p&gt;

&lt;p&gt;+1.&lt;/p&gt;</comment>
                            <comment id="15096875" author="carlyeks" created="Wed, 13 Jan 2016 19:50:53 +0000"  >&lt;p&gt;Committed as &lt;a href=&quot;https://git1-us-west.apache.org/repos/asf?p=cassandra.git;a=commit;h=dbf6e62c382d62f9c1727ecf5afb90d131a81775&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;&lt;tt&gt;dbf6e62&lt;/tt&gt;&lt;/a&gt;.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[carlyeks]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 44 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2f4m7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12311421" key="com.atlassian.jira.plugin.system.customfieldtypes:multiversion">
                        <customfieldname>Reproduced In</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="12324945">2.2.0 beta 1</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>joshuamckenzie</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[joshuamckenzie]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12961"><![CDATA[Low]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>