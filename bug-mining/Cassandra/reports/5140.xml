<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 23:12:39 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-14525] streaming failure during bootstrap makes new node into inconsistent state</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-14525</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;If bootstrap fails for newly joining node (most common reason is due to streaming failure) then Cassandra state remains in &lt;tt&gt;joining&lt;/tt&gt; state which is fine but Cassandra also enables Native transport which makes overall state inconsistent. This further creates NullPointer exception if auth is enabled on the new node, please find reproducible steps here:&lt;/p&gt;

&lt;p&gt;For example if bootstrap fails due to streaming errors like&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;java.util.concurrent.ExecutionException: org.apache.cassandra.streaming.StreamException: Stream failed&lt;br/&gt;
 at com.google.common.util.concurrent.AbstractFuture$Sync.getValue(AbstractFuture.java:299) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;guava-18.0.jar:na&amp;#93;&lt;/span&gt;&lt;br/&gt;
 at com.google.common.util.concurrent.AbstractFuture$Sync.get(AbstractFuture.java:286) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;guava-18.0.jar:na&amp;#93;&lt;/span&gt;&lt;br/&gt;
 at com.google.common.util.concurrent.AbstractFuture.get(AbstractFuture.java:116) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;guava-18.0.jar:na&amp;#93;&lt;/span&gt;&lt;br/&gt;
 at org.apache.cassandra.service.StorageService.bootstrap(StorageService.java:1256) &lt;span class=&quot;error&quot;&gt;&amp;#91;apache-cassandra-3.0.16.jar:3.0.16&amp;#93;&lt;/span&gt;&lt;br/&gt;
 at org.apache.cassandra.service.StorageService.joinTokenRing(StorageService.java:894) &lt;span class=&quot;error&quot;&gt;&amp;#91;apache-cassandra-3.0.16.jar:3.0.16&amp;#93;&lt;/span&gt;&lt;br/&gt;
 at org.apache.cassandra.service.StorageService.initServer(StorageService.java:660) &lt;span class=&quot;error&quot;&gt;&amp;#91;apache-cassandra-3.0.16.jar:3.0.16&amp;#93;&lt;/span&gt;&lt;br/&gt;
 at org.apache.cassandra.service.StorageService.initServer(StorageService.java:573) &lt;span class=&quot;error&quot;&gt;&amp;#91;apache-cassandra-3.0.16.jar:3.0.16&amp;#93;&lt;/span&gt;&lt;br/&gt;
 at org.apache.cassandra.service.CassandraDaemon.setup(CassandraDaemon.java:330) &lt;span class=&quot;error&quot;&gt;&amp;#91;apache-cassandra-3.0.16.jar:3.0.16&amp;#93;&lt;/span&gt;&lt;br/&gt;
 at org.apache.cassandra.service.CassandraDaemon.activate(CassandraDaemon.java:567) &lt;span class=&quot;error&quot;&gt;&amp;#91;apache-cassandra-3.0.16.jar:3.0.16&amp;#93;&lt;/span&gt;&lt;br/&gt;
 at org.apache.cassandra.service.CassandraDaemon.main(CassandraDaemon.java:695) &lt;span class=&quot;error&quot;&gt;&amp;#91;apache-cassandra-3.0.16.jar:3.0.16&amp;#93;&lt;/span&gt;&lt;br/&gt;
 Caused by: org.apache.cassandra.streaming.StreamException: Stream failed&lt;br/&gt;
 at org.apache.cassandra.streaming.management.StreamEventJMXNotifier.onFailure(StreamEventJMXNotifier.java:85) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;apache-cassandra-3.0.16.jar:3.0.16&amp;#93;&lt;/span&gt;&lt;br/&gt;
 at com.google.common.util.concurrent.Futures$6.run(Futures.java:1310) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;guava-18.0.jar:na&amp;#93;&lt;/span&gt;&lt;br/&gt;
 at com.google.common.util.concurrent.MoreExecutors$DirectExecutor.execute(MoreExecutors.java:457) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;guava-18.0.jar:na&amp;#93;&lt;/span&gt;&lt;br/&gt;
 at com.google.common.util.concurrent.ExecutionList.executeListener(ExecutionList.java:156) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;guava-18.0.jar:na&amp;#93;&lt;/span&gt;&lt;br/&gt;
 at com.google.common.util.concurrent.ExecutionList.execute(ExecutionList.java:145) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;guava-18.0.jar:na&amp;#93;&lt;/span&gt;&lt;br/&gt;
 at com.google.common.util.concurrent.AbstractFuture.setException(AbstractFuture.java:202) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;guava-18.0.jar:na&amp;#93;&lt;/span&gt;&lt;br/&gt;
 at org.apache.cassandra.streaming.StreamResultFuture.maybeComplete(StreamResultFuture.java:211) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;apache-cassandra-3.0.16.jar:3.0.16&amp;#93;&lt;/span&gt;&lt;br/&gt;
 at org.apache.cassandra.streaming.StreamResultFuture.handleSessionComplete(StreamResultFuture.java:187) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;apache-cassandra-3.0.16.jar:3.0.16&amp;#93;&lt;/span&gt;&lt;br/&gt;
 at org.apache.cassandra.streaming.StreamSession.closeSession(StreamSession.java:440) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;apache-cassandra-3.0.16.jar:3.0.16&amp;#93;&lt;/span&gt;&lt;br/&gt;
 at org.apache.cassandra.streaming.StreamSession.onError(StreamSession.java:540) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;apache-cassandra-3.0.16.jar:3.0.16&amp;#93;&lt;/span&gt;&lt;br/&gt;
 at org.apache.cassandra.streaming.ConnectionHandler$IncomingMessageHandler.run(ConnectionHandler.java:307) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;apache-cassandra-3.0.16.jar:3.0.16&amp;#93;&lt;/span&gt;&lt;br/&gt;
 at org.apache.cassandra.concurrent.NamedThreadFactory.lambda$threadLocalDeallocator$0(NamedThreadFactory.java:79) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;apache-cassandra-3.0.16.jar:3.0.16&amp;#93;&lt;/span&gt;&lt;br/&gt;
 at java.lang.Thread.run(Thread.java:745) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;na:1.8.0_121&amp;#93;&lt;/span&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;then variable &lt;a href=&quot;https://github.com/apache/cassandra/blob/cassandra-3.0/src/java/org/apache/cassandra/service/StorageService.java#L892&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;StorageService.java::dataAvailable &lt;/a&gt; will be &lt;tt&gt;false&lt;/tt&gt;. Since &lt;tt&gt;dataAvailable&lt;/tt&gt; is &lt;tt&gt;false&lt;/tt&gt; hence it will not call &lt;a href=&quot;https://github.com/apache/cassandra/blob/cassandra-3.0/src/java/org/apache/cassandra/service/StorageService.java#L933&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;StorageService.java::finishJoiningRing &lt;/a&gt; and as a result &lt;a href=&quot;https://github.com/apache/cassandra/blob/cassandra-3.0/src/java/org/apache/cassandra/service/StorageService.java#L999&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;StorageService.java::doAuthSetup&lt;/a&gt; will not be invoked.&lt;/p&gt;

&lt;p&gt;API &lt;a href=&quot;https://github.com/apache/cassandra/blob/cassandra-3.0/src/java/org/apache/cassandra/service/StorageService.java#L763&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;StorageService.java::joinTokenRing &lt;/a&gt; returns without any problem. After this &lt;a href=&quot;https://github.com/apache/cassandra/blob/cassandra-3.0/src/java/org/apache/cassandra/service/CassandraDaemon.java#L584&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;CassandraDaemon.java::start&lt;/a&gt; is invoked which starts native transport at &lt;br/&gt;
 &lt;a href=&quot;https://github.com/apache/cassandra/blob/cassandra-3.0/src/java/org/apache/cassandra/service/CassandraDaemon.java#L478&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;CassandraDaemon.java::startNativeTransport &lt;/a&gt;&lt;/p&gt;

&lt;p&gt;At this point daemon&#8217;s bootstrap is still not finished and transport is enabled. So client will connect to the node and will encounter &lt;tt&gt;java.lang.NullPointerException&lt;/tt&gt; as following:&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;ERROR &lt;span class=&quot;error&quot;&gt;&amp;#91;SharedPool-Worker-2&amp;#93;&lt;/span&gt; Message.java:647 - Unexpected exception during request; channel = &lt;span class=&quot;error&quot;&gt;&amp;#91;id: 0x412a26b3, L:/a.b.c.d:9042 - R:/p.q.r.s:20121&amp;#93;&lt;/span&gt;&lt;br/&gt;
 java.lang.NullPointerException: null&lt;br/&gt;
 at org.apache.cassandra.auth.PasswordAuthenticator.doAuthenticate(PasswordAuthenticator.java:160) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;apache-cassandra-3.0.16.jar:3.0.16&amp;#93;&lt;/span&gt;&lt;br/&gt;
 at org.apache.cassandra.auth.PasswordAuthenticator.authenticate(PasswordAuthenticator.java:82) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;apache-cassandra-3.0.16.jar:3.0.16&amp;#93;&lt;/span&gt;&lt;br/&gt;
 at org.apache.cassandra.auth.PasswordAuthenticator.access$100(PasswordAuthenticator.java:54) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;apache-cassandra-3.0.16.jar:3.0.16&amp;#93;&lt;/span&gt;&lt;br/&gt;
 at org.apache.cassandra.auth.PasswordAuthenticator$PlainTextSaslAuthenticator.getAuthenticatedUser(PasswordAuthenticator.java:198) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;apache-cassandra-3.0.16.jar:3.0.16&amp;#93;&lt;/span&gt;&lt;br/&gt;
 at org.apache.cassandra.transport.messages.AuthResponse.execute(AuthResponse.java:78) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;apache-cassandra-3.0.16.jar:3.0.16&amp;#93;&lt;/span&gt;&lt;br/&gt;
 at org.apache.cassandra.transport.Message$Dispatcher.channelRead0(Message.java:535) &lt;span class=&quot;error&quot;&gt;&amp;#91;apache-cassandra-3.0.16.jar:3.0.16&amp;#93;&lt;/span&gt;&lt;br/&gt;
 at org.apache.cassandra.transport.Message$Dispatcher.channelRead0(Message.java:429) &lt;span class=&quot;error&quot;&gt;&amp;#91;apache-cassandra-3.0.16.jar:3.0.16&amp;#93;&lt;/span&gt;&lt;br/&gt;
 at io.netty.channel.SimpleChannelInboundHandler.channelRead(SimpleChannelInboundHandler.java:105) &lt;span class=&quot;error&quot;&gt;&amp;#91;netty-all-4.1.0.CR6.jar:4.1.0.CR6&amp;#93;&lt;/span&gt;&lt;br/&gt;
 at io.netty.channel.ChannelHandlerInvokerUtil.invokeChannelReadNow(ChannelHandlerInvokerUtil.java:83) &lt;span class=&quot;error&quot;&gt;&amp;#91;netty-all-4.1.0.CR6.jar:4.1.0.CR6&amp;#93;&lt;/span&gt;&lt;br/&gt;
 at io.netty.channel.DefaultChannelHandlerInvoker$7.run(DefaultChannelHandlerInvoker.java:159) &lt;span class=&quot;error&quot;&gt;&amp;#91;netty-all-4.1.0.CR6.jar:4.1.0.CR6&amp;#93;&lt;/span&gt;&lt;br/&gt;
 at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511) &lt;span class=&quot;error&quot;&gt;&amp;#91;na:1.8.0_121&amp;#93;&lt;/span&gt;&lt;br/&gt;
 at org.apache.cassandra.concurrent.AbstractLocalAwareExecutorService$FutureTask.run(AbstractLocalAwareExecutorService.java:164) &lt;span class=&quot;error&quot;&gt;&amp;#91;apache-cassandra-3.0.16.jar:3.0.16&amp;#93;&lt;/span&gt;&lt;br/&gt;
 at org.apache.cassandra.concurrent.SEPWorker.run(SEPWorker.java:105) &lt;span class=&quot;error&quot;&gt;&amp;#91;apache-cassandra-3.0.16.jar:3.0.16&amp;#93;&lt;/span&gt;&lt;br/&gt;
 at java.lang.Thread.run(Thread.java:745) &lt;span class=&quot;error&quot;&gt;&amp;#91;na:1.8.0_121&amp;#93;&lt;/span&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;At this point if we run &lt;tt&gt;nodetool status&lt;/tt&gt; then it will show this new node in &lt;tt&gt;UJ&lt;/tt&gt; state, however clients can connect to this node over &lt;tt&gt;CQL&lt;/tt&gt; and will receive &lt;tt&gt;java.lang.NullPointerException&lt;/tt&gt;&lt;/p&gt;</description>
                <environment></environment>
        <key id="13166262">CASSANDRA-14525</key>
            <summary>streaming failure during bootstrap makes new node into inconsistent state</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10002" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Normal</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="chovatia.jaydeep@gmail.com">Jaydeepkumar Chovatia</assignee>
                                    <reporter username="chovatia.jaydeep@gmail.com">Jaydeepkumar Chovatia</reporter>
                        <labels>
                    </labels>
                <created>Fri, 15 Jun 2018 04:42:07 +0000</created>
                <updated>Thu, 16 Jul 2020 18:16:13 +0000</updated>
                            <resolved>Mon, 31 Dec 2018 06:19:00 +0000</resolved>
                                        <fixVersion>2.2.14</fixVersion>
                    <fixVersion>3.0.18</fixVersion>
                    <fixVersion>3.11.4</fixVersion>
                    <fixVersion>4.0-alpha1</fixVersion>
                    <fixVersion>4.0</fixVersion>
                                    <component>Legacy/Core</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>7</watches>
                                                                                                                                                            <comments>
                            <comment id="16513350" author="chovatia.jaydeep@gmail.com" created="Fri, 15 Jun 2018 05:11:22 +0000"  >&lt;p&gt;In my opinion daemon should&#160;enable native transport only after successful bootstrap to avoid inconsistent state.&lt;/p&gt;

&lt;p&gt;Please find patch with the fix here:&lt;/p&gt;
&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;trunk&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;3.0&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;2.x&lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://circleci.com/gh/jaydeepkumar1984/cassandra/76&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;&lt;span class=&quot;image-wrap&quot; style=&quot;&quot;&gt;&lt;img src=&quot;https://circleci.com/gh/jaydeepkumar1984/cassandra/tree/14525-trunk.svg?style=svg&quot; style=&quot;border: 0px solid black&quot; /&gt;&lt;/span&gt; &lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://circleci.com/gh/jaydeepkumar1984/cassandra/73&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;&lt;span class=&quot;image-wrap&quot; style=&quot;&quot;&gt;&lt;img src=&quot;https://circleci.com/gh/jaydeepkumar1984/cassandra/tree/14525-3.0.svg?style=svg&quot; style=&quot;border: 0px solid black&quot; /&gt;&lt;/span&gt; &lt;/a&gt;&#160;&#160;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&#160; &lt;a href=&quot;https://circleci.com/gh/jaydeepkumar1984/cassandra/74&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;&lt;span class=&quot;image-wrap&quot; style=&quot;&quot;&gt;&lt;img src=&quot;https://circleci.com/gh/jaydeepkumar1984/cassandra/tree/14525-2.2.svg?style=svg&quot; style=&quot;border: 0px solid black&quot; /&gt;&lt;/span&gt; &lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/apache/cassandra/compare/trunk...jaydeepkumar1984:14525-trunk&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;patch &lt;/a&gt;&#160;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/apache/cassandra/compare/trunk...jaydeepkumar1984:14525-3.0&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;patch&lt;/a&gt;&#160;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/apache/cassandra/compare/trunk...jaydeepkumar1984:14525-2.2&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;patch &lt;/a&gt;&#160;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;


&lt;p&gt;Please review it and let me know your opinion.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="16513687" author="jasobrown" created="Fri, 15 Jun 2018 11:38:34 +0000"  >&lt;p&gt;This is not a review, but you should have some dtests to validate your patch.&lt;/p&gt;</comment>
                            <comment id="16513692" author="chovatia.jaydeep@gmail.com" created="Fri, 15 Jun 2018 11:45:52 +0000"  >&lt;p&gt;Sure &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jasobrown&quot; class=&quot;user-hover&quot; rel=&quot;jasobrown&quot;&gt;jasobrown&lt;/a&gt;&#160;I will add a&#160;dTest, created sub-task&#160;&lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-14526&quot; title=&quot;dtest to validate Cassandra state post failed/successful bootstrap&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-14526&quot;&gt;&lt;del&gt;CASSANDRA-14526&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16515354" author="chovatia.jaydeep@gmail.com" created="Mon, 18 Jun 2018 05:07:48 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jasobrown&quot; class=&quot;user-hover&quot; rel=&quot;jasobrown&quot;&gt;jasobrown&lt;/a&gt;&#160;I&apos;ve added a dtest for this which passes with this fix and fails on current trunk,&#160;please find dtest here:&lt;/p&gt;
&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;dtest&lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/apache/cassandra-dtest/compare/master...jaydeepkumar1984:14526-trunk&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;patch &lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;


&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="16515592" author="kurtg" created="Mon, 18 Jun 2018 11:15:00 +0000"  >&lt;p&gt;We&apos;ve already had a ticket (and a &lt;em&gt;very&lt;/em&gt; similar patch) for this since November last year...&#160;&lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-14063&quot; title=&quot;Cassandra will start listening for clients without initialising system_auth after a failed bootstrap&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-14063&quot;&gt;CASSANDRA-14063&lt;/a&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="16515904" author="chovatia.jaydeep@gmail.com" created="Mon, 18 Jun 2018 15:43:04 +0000"  >&lt;p&gt;I see &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=KurtG&quot; class=&quot;user-hover&quot; rel=&quot;KurtG&quot;&gt;KurtG&lt;/a&gt;, sorry I missed it.&#160;In my opinion this is a bug and needs to be fixed (&lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-14063&quot; title=&quot;Cassandra will start listening for clients without initialising system_auth after a failed bootstrap&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-14063&quot;&gt;CASSANDRA-14063&lt;/a&gt;&#160;should be considered&#160;as per FCFS priority).&#160;We also need to fix dtest along with this so&#160;&lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-14526&quot; title=&quot;dtest to validate Cassandra state post failed/successful bootstrap&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-14526&quot;&gt;&lt;del&gt;CASSANDRA-14526&lt;/del&gt;&lt;/a&gt; also needs to be landed.&lt;/p&gt;</comment>
                            <comment id="16516669" author="kurtg" created="Tue, 19 Jun 2018 05:20:51 +0000"  >&lt;p&gt;Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=chovatia.jaydeep%40gmail.com&quot; class=&quot;user-hover&quot; rel=&quot;chovatia.jaydeep@gmail.com&quot;&gt;chovatia.jaydeep@gmail.com&lt;/a&gt;, I agree. No fault on your part, more a problem with the consistent lack of reviewers we have who can prioritise review work. Just unfortunate that it&apos;s wasted more time than necessary for everyone. I think &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=VincentWhite&quot; class=&quot;user-hover&quot; rel=&quot;VincentWhite&quot;&gt;VincentWhite&lt;/a&gt; would appreciate the acknowledgement (especially after such a long time) so FCFS makes sense to me, but there&apos;s no use doing the work twice, just take into account the two patches slight discrepancies when reviewing I guess.&lt;/p&gt;</comment>
                            <comment id="16517407" author="chovatia.jaydeep@gmail.com" created="Tue, 19 Jun 2018 18:33:09 +0000"  >&lt;p&gt;I agree there are few discrepancy between two patches as following:&lt;br/&gt;
 My patch:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;It was missing check before starting RPC server. I&apos;ve incorporated this and my latest patch has this.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=VincentWhite&quot; class=&quot;user-hover&quot; rel=&quot;VincentWhite&quot;&gt;VincentWhite&lt;/a&gt;&apos;s patch:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Missing to start &lt;tt&gt;cql&lt;/tt&gt; post successful &lt;tt&gt;bootstrap&lt;/tt&gt;&lt;/li&gt;
	&lt;li&gt;Not sure if we need to use separate variable &lt;tt&gt;streamingSuccessful&lt;/tt&gt; as we can directly use &lt;tt&gt;SystemKeyspace.bootstrapComplete()&lt;/tt&gt;&lt;/li&gt;
	&lt;li&gt;We should have consistent error message &lt;em&gt;&lt;tt&gt;node is not yet bootstraped completely. Use nodetool to check bootstrap state and resume. For more, see nodetool help bootstrap&lt;/tt&gt;&lt;/em&gt;&lt;/li&gt;
	&lt;li&gt;We should make &lt;tt&gt;isSurveyMode&lt;/tt&gt; volatile as it is being updated by different thread&lt;/li&gt;
	&lt;li&gt;Need to make sure we get patches for all branches and verify &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-14526&quot; title=&quot;dtest to validate Cassandra state post failed/successful bootstrap&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-14526&quot;&gt;&lt;del&gt;CASSANDRA-14526&lt;/del&gt;&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=VincentWhite&quot; class=&quot;user-hover&quot; rel=&quot;VincentWhite&quot;&gt;VincentWhite&lt;/a&gt; Do you want to make a complete patch by incorporating above items?&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=KurtG&quot; class=&quot;user-hover&quot; rel=&quot;KurtG&quot;&gt;KurtG&lt;/a&gt; Does this sound ok to you?&lt;/p&gt;</comment>
                            <comment id="16520613" author="chovatia.jaydeep@gmail.com" created="Fri, 22 Jun 2018 17:34:06 +0000"  >&lt;p&gt;Hi&#160;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=KurtG&quot; class=&quot;user-hover&quot; rel=&quot;KurtG&quot;&gt;KurtG&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;It seems &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=VincentWhite&quot; class=&quot;user-hover&quot; rel=&quot;VincentWhite&quot;&gt;VincentWhite&lt;/a&gt; is not responding, could&#160;you please review patch from this ticket?&lt;/p&gt;

&lt;p&gt;Jaydeep&lt;/p&gt;</comment>
                            <comment id="16521843" author="kurtg" created="Mon, 25 Jun 2018 04:38:02 +0000"  >&lt;p&gt;Sorry about that, we had a pretty busy week last week and Vince probably won&apos;t have time. I&apos;ll review.&lt;/p&gt;</comment>
                            <comment id="16523222" author="kurtg" created="Tue, 26 Jun 2018 05:27:24 +0000"  >&lt;p&gt;A few things:&lt;br/&gt;
 If we fail streaming and &lt;tt&gt;isSurveyMode&lt;/tt&gt;&#160;is true we still get the NPE if auth is enabled when trying to connect to C* on that node. Not much we can do about this because auth isn&apos;t initialised until we join the ring, but I&apos;m not sure why we should handle this situation differently, and also it&apos;s currently kind of broken. At the moment if you resume bootstrap after a streaming failure &lt;em&gt;while in write survey mode&lt;/em&gt;, you will leave write survey mode on completion of bootstrapping (ouch).&lt;/p&gt;


&lt;p&gt; I think we should handle write survey bootstrapping the same as normal bootstrap, where if we get an error during streaming we don&apos;t start transports. Then, on resume, handle survey mode so that we &lt;em&gt;don&apos;t&lt;/em&gt; join the ring on completion of bootstrapping, but we do still start transports.&lt;/p&gt;


&lt;p&gt; On top of that, seeing as we&apos;re in this code anyway, I think it would be reasonable if we could look at handling the auth case a bit better&#160;when&#160;write survey is enabled as well. Ideally, if auth is required I see no point in starting the transports seeing as you&apos;ll always get an NPE, so maybe we can add a check for that in &lt;tt&gt;CassandraDaemon#start()?&lt;/tt&gt;&lt;/p&gt;

&lt;p&gt;&lt;tt&gt;DatabaseDescriptor.getAuthenticator().requireAuthentication()&lt;/tt&gt; should be enough here I think.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;Some things regarding the error message:&lt;br/&gt;
 We&apos;ve got repeated information in our error:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
WARN  [main] 2018-06-25 09:13:24,136 StorageService.java:935 - Some data streaming failed. Use nodetool to check bootstrap state and resume. For more, see `nodetool help bootstrap`. IN_PROGRESS
ERROR [main] 2018-06-25 09:13:32,190 CassandraDaemon.java:445 - Node is not yet bootstraped hence not enabling &lt;span class=&quot;code-keyword&quot;&gt;native&lt;/span&gt; transport. Use nodetool to check bootstrap state and resume. For more, see `nodetool help    bootstrap`
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;I think our new message should either be INFO or WARN (INFO is in line with other messages in &lt;tt&gt;start()&lt;/tt&gt;, and I think it would make more sense if the original message in &lt;tt&gt;StorageService&lt;/tt&gt; was ERROR. We could change the message in CassandraDaemon to:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
Not starting client transports as bootstrap has not completed.&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;or something similar, to be more in line with the other info messages.&lt;/p&gt;

&lt;p&gt;Finally, with your patch if we resume bootstrap we don&apos;t start thrift. As per Vince&apos;s patch, daemon.start() is desirable here over startNativeTransport so that we always start thrift and CQL.&lt;/p&gt;</comment>
                            <comment id="16524338" author="chovatia.jaydeep@gmail.com" created="Tue, 26 Jun 2018 23:33:49 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=KurtG&quot; class=&quot;user-hover&quot; rel=&quot;KurtG&quot;&gt;KurtG&lt;/a&gt; Thanks for your review comments. I&apos;ve made patch simple by not allowing transport if bootstrap is not complete irrespective of &lt;tt&gt;survey&lt;/tt&gt; mode. Also incorporated other comments, please find updated patch here:&lt;/p&gt;

&lt;p&gt;Please find patch with the fix here:&lt;/p&gt;
&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;trunk&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;3.0&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;2.x&lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://circleci.com/gh/jaydeepkumar1984/cassandra/76&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;&lt;span class=&quot;image-wrap&quot; style=&quot;&quot;&gt;&lt;img src=&quot;https://circleci.com/gh/jaydeepkumar1984/cassandra/tree/14525-trunk.svg?style=svg&quot; style=&quot;border: 0px solid black&quot; /&gt;&lt;/span&gt; &lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://circleci.com/gh/jaydeepkumar1984/cassandra/73&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;&lt;span class=&quot;image-wrap&quot; style=&quot;&quot;&gt;&lt;img src=&quot;https://circleci.com/gh/jaydeepkumar1984/cassandra/tree/14525-3.0.svg?style=svg&quot; style=&quot;border: 0px solid black&quot; /&gt;&lt;/span&gt; &lt;/a&gt;&#160;&#160;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&#160; &lt;a href=&quot;https://circleci.com/gh/jaydeepkumar1984/cassandra/74&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;&lt;span class=&quot;image-wrap&quot; style=&quot;&quot;&gt;&lt;img src=&quot;https://circleci.com/gh/jaydeepkumar1984/cassandra/tree/14525-2.2.svg?style=svg&quot; style=&quot;border: 0px solid black&quot; /&gt;&lt;/span&gt; &lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/apache/cassandra/compare/trunk...jaydeepkumar1984:14525-trunk&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;patch &lt;/a&gt;&#160;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/apache/cassandra/compare/trunk...jaydeepkumar1984:14525-3.0&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;patch&lt;/a&gt;&#160;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/apache/cassandra/compare/trunk...jaydeepkumar1984:14525-2.2&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;patch &lt;/a&gt;&#160;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;
</comment>
                            <comment id="16524862" author="kurtg" created="Wed, 27 Jun 2018 10:07:41 +0000"  >&lt;p&gt;Mostly looks good, however we&apos;re still leaving write_survey mode after a resume bootstrap completes when we were started in write survey mode. Also just noticed but as we hackily re-use isSurveyMode when resuming a bootstrap we always log the following message regardless of if we were in write survey mode originally or not.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;Leaving write survey mode and joining ring at &lt;span class=&quot;code-keyword&quot;&gt;operator&lt;/span&gt; request&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;I think at this point we could solve these 2 problems by simply calling &lt;tt&gt;finishJoiningRing&lt;/tt&gt; explicitly when we successfully bootstrap after a resume in &lt;tt&gt;resumeBootstrap&lt;/tt&gt;, rather than indirectly through {{joinRing}, and also handle write_survey in the same place.&lt;/p&gt;

&lt;p&gt;Also, another small nit, can we change the spelling of &lt;tt&gt;bootstraped&lt;/tt&gt; to &lt;tt&gt;bootstrapped&lt;/tt&gt; in the exception messages?&lt;/p&gt;</comment>
                            <comment id="16525850" author="chovatia.jaydeep@gmail.com" created="Thu, 28 Jun 2018 02:55:02 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=KurtG&quot; class=&quot;user-hover&quot; rel=&quot;KurtG&quot;&gt;KurtG&lt;/a&gt;&#160;I think there was a bug in my previous patch in which it will not start native transport in normal scenario if &lt;tt&gt;isSurveyMode&lt;/tt&gt; is &lt;tt&gt;true&lt;/tt&gt;. &lt;br/&gt;
 Also I&apos;ve discovered another bug exists in current open source code in which if &lt;tt&gt;isSurveyMode&lt;/tt&gt; is &lt;tt&gt;true&lt;/tt&gt; and streaming fails (i.e. &lt;tt&gt;isBootstrapMode&lt;/tt&gt; is &lt;tt&gt;true&lt;/tt&gt;) then also one&#160;can call &lt;tt&gt;nodetool join&lt;/tt&gt; without &lt;tt&gt;nodetool bootstrap resume&lt;/tt&gt; and have that node join the ring.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;I&apos;ve taken care of this bug and your review comments,please find updated patch here:&lt;/p&gt;
&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;trunk&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;3.0&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;2.x&lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://circleci.com/gh/jaydeepkumar1984/cassandra/76&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;&lt;span class=&quot;image-wrap&quot; style=&quot;&quot;&gt;&lt;img src=&quot;https://circleci.com/gh/jaydeepkumar1984/cassandra/tree/14525-trunk.svg?style=svg&quot; style=&quot;border: 0px solid black&quot; /&gt;&lt;/span&gt; &lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://circleci.com/gh/jaydeepkumar1984/cassandra/73&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;&lt;span class=&quot;image-wrap&quot; style=&quot;&quot;&gt;&lt;img src=&quot;https://circleci.com/gh/jaydeepkumar1984/cassandra/tree/14525-3.0.svg?style=svg&quot; style=&quot;border: 0px solid black&quot; /&gt;&lt;/span&gt; &lt;/a&gt;&#160;&#160;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&#160; &lt;a href=&quot;https://circleci.com/gh/jaydeepkumar1984/cassandra/74&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;&lt;span class=&quot;image-wrap&quot; style=&quot;&quot;&gt;&lt;img src=&quot;https://circleci.com/gh/jaydeepkumar1984/cassandra/tree/14525-2.2.svg?style=svg&quot; style=&quot;border: 0px solid black&quot; /&gt;&lt;/span&gt; &lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/apache/cassandra/compare/trunk...jaydeepkumar1984:14525-trunk&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;patch &lt;/a&gt;&#160;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/apache/cassandra/compare/trunk...jaydeepkumar1984:14525-3.0&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;patch&lt;/a&gt;&#160;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/apache/cassandra/compare/trunk...jaydeepkumar1984:14525-2.2&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;patch &lt;/a&gt;&#160;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;
</comment>
                            <comment id="16529525" author="kurtg" created="Mon, 2 Jul 2018 08:22:33 +0000"  >&lt;blockquote&gt;&lt;p&gt;Also I&apos;ve discovered another bug exists in current open source code in which if isSurveyMode is true and streaming fails (i.e. isBootstrapMode is true) then also one can call nodetool join without nodetool bootstrap resume and have that node join the ring.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Great catch.&#160;I found a couple more small issue w.r.t &lt;tt&gt;nodetool join&lt;/tt&gt; as well while I was testing this.&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;If in write_survey and you join the ring after bootstrap, transports won&apos;t be enabled. can we call &lt;tt&gt;CassandraDaemon#start()&lt;/tt&gt; here?&lt;/li&gt;
	&lt;li&gt;nodetool join fails silently if write_survey is true and we haven&apos;t completed bootstrapping, but server log prints the following
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
WARN [RMI TCP Connection(5)-127.0.0.1] 2018-06-29 12:39:49,735 StorageService.java:1008 - Some data streaming failed. Use nodetool to check bootstrap state and resume. For more, see `nodetool help bootstrap`. IN_PROGRESS
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;nodetool join should say something along the lines of &quot;&lt;tt&gt;Can&apos;t join the ring because in write_survey mode and bootstrap hasn&apos;t completed&lt;/tt&gt;&quot;&lt;/p&gt;&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;Also another minor nit w.r.t logging; you can get the following log message after successfully bootstrapping if you were in write survey mode:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
INFO [main] 2018-06-29 12:12:39,071 CassandraDaemon.java:479 - Not starting client transports as bootstrap has not completed
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Probably better to split CassandraDaemon.start() if block so that we print &quot;&lt;tt&gt;Not starting client transports as write_survey mode is enabled.&lt;/tt&gt;&quot;&lt;/p&gt;

&lt;p&gt;And finally, there&apos;s still 2 occurences of &quot;bootstraped&quot; in the exception messages in &lt;tt&gt;startNativeTransport&lt;/tt&gt; and &lt;tt&gt;startRPCServer&lt;/tt&gt;.&lt;/p&gt;</comment>
                            <comment id="16530498" author="chovatia.jaydeep@gmail.com" created="Mon, 2 Jul 2018 22:18:06 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=KurtG&quot; class=&quot;user-hover&quot; rel=&quot;KurtG&quot;&gt;KurtG&lt;/a&gt; Please find updated review with all of the review comments incorporated.&lt;/p&gt;
&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;trunk&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;3.0&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;2.x&lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://circleci.com/gh/jaydeepkumar1984/cassandra/76&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;&lt;span class=&quot;image-wrap&quot; style=&quot;&quot;&gt;&lt;img src=&quot;https://circleci.com/gh/jaydeepkumar1984/cassandra/tree/14525-trunk.svg?style=svg&quot; style=&quot;border: 0px solid black&quot; /&gt;&lt;/span&gt; &lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://circleci.com/gh/jaydeepkumar1984/cassandra/73&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;&lt;span class=&quot;image-wrap&quot; style=&quot;&quot;&gt;&lt;img src=&quot;https://circleci.com/gh/jaydeepkumar1984/cassandra/tree/14525-3.0.svg?style=svg&quot; style=&quot;border: 0px solid black&quot; /&gt;&lt;/span&gt; &lt;/a&gt;&#160;&#160;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&#160; &lt;a href=&quot;https://circleci.com/gh/jaydeepkumar1984/cassandra/74&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;&lt;span class=&quot;image-wrap&quot; style=&quot;&quot;&gt;&lt;img src=&quot;https://circleci.com/gh/jaydeepkumar1984/cassandra/tree/14525-2.2.svg?style=svg&quot; style=&quot;border: 0px solid black&quot; /&gt;&lt;/span&gt; &lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/apache/cassandra/compare/trunk...jaydeepkumar1984:14525-trunk&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;patch &lt;/a&gt;&#160;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/apache/cassandra/compare/trunk...jaydeepkumar1984:14525-3.0&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;patch&lt;/a&gt;&#160;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/apache/cassandra/compare/trunk...jaydeepkumar1984:14525-2.2&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;patch &lt;/a&gt;&#160;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;
</comment>
                            <comment id="16533547" author="kurtg" created="Thu, 5 Jul 2018 11:31:49 +0000"  >&lt;p&gt;Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=chovatia.jaydeep%40gmail.com&quot; class=&quot;user-hover&quot; rel=&quot;chovatia.jaydeep@gmail.com&quot;&gt;chovatia.jaydeep@gmail.com&lt;/a&gt;. I figured it was unfair making you do all the work so I made some changes myself. Basically we were still silently failing with &lt;tt&gt;nodetool join&lt;/tt&gt;, so I&apos;ve added &lt;tt&gt;isBootstrapMode()&lt;/tt&gt; to &lt;tt&gt;StorageServiceMBean&lt;/tt&gt; and &lt;tt&gt;NodeProbe&lt;/tt&gt; and added a check for it in &lt;tt&gt;Join.java&lt;/tt&gt;. I&apos;ve also tried to simplify some of the if statements (edge cases are killing me) and added a bit of documentation. I also created a 3.11 branch from our changes as there were a few conflicts from 3.0.&lt;/p&gt;

&lt;p&gt;Finally, I extended your dtest from &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-14526&quot; title=&quot;dtest to validate Cassandra state post failed/successful bootstrap&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-14526&quot;&gt;&lt;del&gt;CASSANDRA-14526&lt;/del&gt;&lt;/a&gt; to cover the write_survey, join and resume cases to be in line with the changes we&apos;ve made, and also changed the byteman rule to trigger on &lt;tt&gt;maybeCompleted()&lt;/tt&gt; as it wasn&apos;t consistently triggering on &lt;tt&gt;startStreamingFiles()&lt;/tt&gt;&lt;/p&gt;

&lt;p&gt;Now I think we&apos;re pretty much ready to go, but if you want to give my changes a once over to make sure I haven&apos;t missed anything as I&apos;m sure you&apos;re aware the startup code is an absolute nightmare.&lt;/p&gt;

&lt;p&gt;Also, I haven&apos;t run the whole dtest suite, but I&apos;ve at least run all the bootstrap dtests and they are all passing, so I&apos;m taking that as a good sign.&lt;/p&gt;
&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;2.2&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;3.0&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;3.11&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;trunk&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;dtests&lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/apache/cassandra/compare/cassandra-2.2...kgreav:14525-2.2&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;branch&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/apache/cassandra/compare/cassandra-3.0...kgreav:14525-3.0&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;branch&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/apache/cassandra/compare/cassandra-3.11...kgreav:14525-3.11&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;branch&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/apache/cassandra/compare/trunk...kgreav:14525-trunk&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;branch&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/apache/cassandra-dtest/compare/master...kgreav:14526-trunk-k&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;branch&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://circleci.com/gh/kgreav/cassandra/178&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;&lt;span class=&quot;image-wrap&quot; style=&quot;&quot;&gt;&lt;img src=&quot;https://circleci.com/gh/kgreav/cassandra/tree/14525-2.2.svg?style=svg&quot; style=&quot;border: 0px solid black&quot; /&gt;&lt;/span&gt; &lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://circleci.com/gh/kgreav/cassandra/181&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;&lt;span class=&quot;image-wrap&quot; style=&quot;&quot;&gt;&lt;img src=&quot;https://circleci.com/gh/kgreav/cassandra/tree/14525-3.0.svg?style=svg&quot; style=&quot;border: 0px solid black&quot; /&gt;&lt;/span&gt; &lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://circleci.com/gh/kgreav/cassandra/180&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;&lt;span class=&quot;image-wrap&quot; style=&quot;&quot;&gt;&lt;img src=&quot;https://circleci.com/gh/kgreav/cassandra/tree/14525-3.11.svg?style=svg&quot; style=&quot;border: 0px solid black&quot; /&gt;&lt;/span&gt; &lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://circleci.com/gh/kgreav/cassandra/183&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;&lt;span class=&quot;image-wrap&quot; style=&quot;&quot;&gt;&lt;img src=&quot;https://circleci.com/gh/kgreav/cassandra/tree/14525-trunk.svg?style=svg&quot; style=&quot;border: 0px solid black&quot; /&gt;&lt;/span&gt; &lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;
</comment>
                            <comment id="16533961" author="chovatia.jaydeep@gmail.com" created="Thu, 5 Jul 2018 17:47:51 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=KurtG&quot; class=&quot;user-hover&quot; rel=&quot;KurtG&quot;&gt;KurtG&lt;/a&gt; Thanks for making the changes!&#160;&lt;/p&gt;

&lt;p&gt;Latest code changes looks good to me.&lt;/p&gt;</comment>
                            <comment id="16544176" author="kurtg" created="Sat, 14 Jul 2018 11:01:09 +0000"  >&lt;p&gt;So I messed up a merge to 3.11 and upon doing further dtests found some issues and inefficiencies. These have all been fixed up now and branches above should be all up to date and passing tests so going to mark this as ready to commit.&lt;/p&gt;
&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;2.2&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;3.0&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;3.11&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;trunk&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;dtests&lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/apache/cassandra/compare/cassandra-2.2...kgreav:14525-2.2&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;branch&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/apache/cassandra/compare/cassandra-3.0...kgreav:14525-3.0&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;branch&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/apache/cassandra/compare/cassandra-3.11...kgreav:14525-3.11&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;branch&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/apache/cassandra/compare/trunk...kgreav:14525-trunk&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;branch&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/apache/cassandra-dtest/compare/master...kgreav:14526-trunk&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;branch&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://circleci.com/gh/kgreav/cassandra/202&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;&lt;span class=&quot;image-wrap&quot; style=&quot;&quot;&gt;&lt;img src=&quot;https://circleci.com/gh/kgreav/cassandra/tree/14525-2.2.svg?style=svg&quot; style=&quot;border: 0px solid black&quot; /&gt;&lt;/span&gt; &lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://circleci.com/gh/kgreav/cassandra/199&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;&lt;span class=&quot;image-wrap&quot; style=&quot;&quot;&gt;&lt;img src=&quot;https://circleci.com/gh/kgreav/cassandra/tree/14525-3.0.svg?style=svg&quot; style=&quot;border: 0px solid black&quot; /&gt;&lt;/span&gt; &lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://circleci.com/gh/kgreav/cassandra/201&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;&lt;span class=&quot;image-wrap&quot; style=&quot;&quot;&gt;&lt;img src=&quot;https://circleci.com/gh/kgreav/cassandra/tree/14525-3.11.svg?style=svg&quot; style=&quot;border: 0px solid black&quot; /&gt;&lt;/span&gt; &lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://circleci.com/gh/kgreav/cassandra/200&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;&lt;span class=&quot;image-wrap&quot; style=&quot;&quot;&gt;&lt;img src=&quot;https://circleci.com/gh/kgreav/cassandra/tree/14525-trunk.svg?style=svg&quot; style=&quot;border: 0px solid black&quot; /&gt;&lt;/span&gt; &lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;
</comment>
                            <comment id="16550004" author="djoshi3" created="Thu, 19 Jul 2018 23:21:47 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=KurtG&quot; class=&quot;user-hover&quot; rel=&quot;KurtG&quot;&gt;KurtG&lt;/a&gt; - I pulled your branch and have run the dtests with some failures. See &lt;a href=&quot;https://circleci.com/workflow-run/035dca04-5b2b-4fb2-aebe-3089d876f995&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;here.&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16550237" author="kurtg" created="Fri, 20 Jul 2018 04:45:25 +0000"  >&lt;p&gt;Thanks heaps &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=djoshi3&quot; class=&quot;user-hover&quot; rel=&quot;djoshi3&quot;&gt;djoshi3&lt;/a&gt;, I&apos;ll look into it.&lt;/p&gt;</comment>
                            <comment id="16594635" author="chovatia.jaydeep@gmail.com" created="Tue, 28 Aug 2018 07:12:06 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=KurtG&quot; class=&quot;user-hover&quot; rel=&quot;KurtG&quot;&gt;KurtG&lt;/a&gt; I did analyze&#160;all the 9 failing dtests&#160;from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=djoshi3&quot; class=&quot;user-hover&quot; rel=&quot;djoshi3&quot;&gt;djoshi3&lt;/a&gt;&apos;s run and found that they all expect CQL up and running&#160;w/o bootstrap, and as per our new design in this ticket, it is simply not&#160;allowed.&lt;/p&gt;

&lt;p&gt;So I believe we simply have to remove those 9 dtests. Please check and let me know if you need my help anywhere.&lt;/p&gt;

&lt;p&gt;Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=djoshi3&quot; class=&quot;user-hover&quot; rel=&quot;djoshi3&quot;&gt;djoshi3&lt;/a&gt; for doing a dtest run for us!&lt;/p&gt;</comment>
                            <comment id="16594895" author="kurtg" created="Tue, 28 Aug 2018 12:15:06 +0000"  >&lt;p&gt;Thanks so much. I have been meaning to get back to this but since we missed the boat on 3.11.3 I figured this could wait until Sept 1st. If you want you can go ahead and fix the tests, otherwise if not I&apos;ll have a look next week &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="16595954" author="chovatia.jaydeep@gmail.com" created="Wed, 29 Aug 2018 05:26:07 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=KurtG&quot; class=&quot;user-hover&quot; rel=&quot;KurtG&quot;&gt;KurtG&lt;/a&gt;&#160;I&apos;ve fixed the failing dtests by changing some part in Cassandra and some part in dtests. Please review them&#160;whenever you get a chance. Thank You!&lt;/p&gt;
&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;2.2&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;3.0&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;3.11&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;trunk&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;dtests&lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/apache/cassandra/compare/trunk...jaydeepkumar1984:14525-2.2&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;branch &lt;/a&gt;&#160;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/apache/cassandra/compare/trunk...jaydeepkumar1984:14525-3.0&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;branch &lt;/a&gt;&#160;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/apache/cassandra/compare/trunk...jaydeepkumar1984:14525-3.11&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;branch &lt;/a&gt;&#160;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/apache/cassandra/compare/trunk...jaydeepkumar1984:14525-trunk&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;branch &lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/apache/cassandra-dtest/compare/master...jaydeepkumar1984:14526-trunk&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;branch &lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://circleci.com/gh/jaydeepkumar1984/cassandra/=132&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;&lt;span class=&quot;image-wrap&quot; style=&quot;&quot;&gt;&lt;img src=&quot;https://circleci.com/gh/jaydeepkumar1984/cassandra/tree/14525-2.2.svg?style=svg&quot; style=&quot;border: 0px solid black&quot; /&gt;&lt;/span&gt; &lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://circleci.com/gh/jaydeepkumar1984/cassandra/=133&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;&lt;span class=&quot;image-wrap&quot; style=&quot;&quot;&gt;&lt;img src=&quot;https://circleci.com/gh/jaydeepkumar1984/cassandra/tree/14525-3.0.svg?style=svg&quot; style=&quot;border: 0px solid black&quot; /&gt;&lt;/span&gt; &lt;/a&gt;&#160;&#160;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&#160; &lt;a href=&quot;https://circleci.com/gh/jaydeepkumar1984/cassandra/=128&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;&lt;span class=&quot;image-wrap&quot; style=&quot;&quot;&gt;&lt;img src=&quot;https://circleci.com/gh/jaydeepkumar1984/cassandra/tree/14525-3.11.svg?style=svg&quot; style=&quot;border: 0px solid black&quot; /&gt;&lt;/span&gt; &lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://circleci.com/gh/jaydeepkumar1984/cassandra/=129&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;&lt;span class=&quot;image-wrap&quot; style=&quot;&quot;&gt;&lt;img src=&quot;https://circleci.com/gh/jaydeepkumar1984/cassandra/tree/14525-trunk.svg?style=svg&quot; style=&quot;border: 0px solid black&quot; /&gt;&lt;/span&gt; &lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;
</comment>
                            <comment id="16620099" author="kurtg" created="Wed, 19 Sep 2018 04:45:50 +0000"  >&lt;p&gt;Looks good to me. Probably need another run of the dtests though :/&lt;/p&gt;</comment>
                            <comment id="16665770" author="chovatia.jaydeep@gmail.com" created="Fri, 26 Oct 2018 23:42:26 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jay.zhuang&quot; class=&quot;user-hover&quot; rel=&quot;jay.zhuang&quot;&gt;jay.zhuang&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=djoshi3&quot; class=&quot;user-hover&quot; rel=&quot;djoshi3&quot;&gt;djoshi3&lt;/a&gt; Can one of you please help run a final round of dtest so that this ticket can be committed and closed? &lt;/p&gt;</comment>
                            <comment id="16666220" author="jay.zhuang" created="Sat, 27 Oct 2018 21:03:05 +0000"  >&lt;p&gt;Sure, I&apos;ll kick off the tests.&lt;/p&gt;</comment>
                            <comment id="16669640" author="djoshi3" created="Wed, 31 Oct 2018 05:48:30 +0000"  >&lt;p&gt;Sorry, did not see your comment earlier. I think we should update the dtests rather than removing them. &lt;/p&gt;</comment>
                            <comment id="16727118" author="jay.zhuang" created="Fri, 21 Dec 2018 22:43:11 +0000"  >&lt;p&gt;Rebased the code and started the tests:&lt;/p&gt;
&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; Branch &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; uTest &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; dTest &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;a href=&quot;https://github.com/cooldoger/cassandra/tree/14525-2.2&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;14525-2.2&lt;/a&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;a href=&quot;https://circleci.com/gh/cooldoger/cassandra/tree/14525-2.2&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;&lt;span class=&quot;image-wrap&quot; style=&quot;&quot;&gt;&lt;img src=&quot;https://circleci.com/gh/cooldoger/cassandra/tree/14525-2.2.svg?style=svg&quot; style=&quot;border: 0px solid black&quot; /&gt;&lt;/span&gt;&lt;/a&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;a href=&quot;https://builds.apache.org/view/A-D/view/Cassandra/job/Cassandra-devbranch-dtest/664/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;&lt;span class=&quot;image-wrap&quot; style=&quot;&quot;&gt;&lt;img src=&quot;https://builds.apache.org/view/A-D/view/Cassandra/job/Cassandra-devbranch-dtest/664/badge/icon&quot; style=&quot;border: 0px solid black&quot; /&gt;&lt;/span&gt;&lt;/a&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;a href=&quot;https://github.com/cooldoger/cassandra/tree/14525-3.0&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;14525-3.0&lt;/a&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;a href=&quot;https://circleci.com/gh/cooldoger/cassandra/tree/14525-3.0&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;&lt;span class=&quot;image-wrap&quot; style=&quot;&quot;&gt;&lt;img src=&quot;https://circleci.com/gh/cooldoger/cassandra/tree/14525-3.0.svg?style=svg&quot; style=&quot;border: 0px solid black&quot; /&gt;&lt;/span&gt;&lt;/a&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;a href=&quot;https://builds.apache.org/view/A-D/view/Cassandra/job/Cassandra-devbranch-dtest/665/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;&lt;span class=&quot;image-wrap&quot; style=&quot;&quot;&gt;&lt;img src=&quot;https://builds.apache.org/view/A-D/view/Cassandra/job/Cassandra-devbranch-dtest/665/badge/icon&quot; style=&quot;border: 0px solid black&quot; /&gt;&lt;/span&gt;&lt;/a&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;a href=&quot;https://github.com/cooldoger/cassandra/tree/14525-3.11&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;14525-3.11&lt;/a&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;a href=&quot;https://circleci.com/gh/cooldoger/cassandra/tree/14525-3.11&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;&lt;span class=&quot;image-wrap&quot; style=&quot;&quot;&gt;&lt;img src=&quot;https://circleci.com/gh/cooldoger/cassandra/tree/14525-3.11.svg?style=svg&quot; style=&quot;border: 0px solid black&quot; /&gt;&lt;/span&gt;&lt;/a&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;a href=&quot;https://builds.apache.org/view/A-D/view/Cassandra/job/Cassandra-devbranch-dtest/666/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;&lt;span class=&quot;image-wrap&quot; style=&quot;&quot;&gt;&lt;img src=&quot;https://builds.apache.org/view/A-D/view/Cassandra/job/Cassandra-devbranch-dtest/666/badge/icon&quot; style=&quot;border: 0px solid black&quot; /&gt;&lt;/span&gt;&lt;/a&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;a href=&quot;https://github.com/cooldoger/cassandra/tree/14525-trunk&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;14525-trunk&lt;/a&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;a href=&quot;https://circleci.com/gh/cooldoger/cassandra/tree/14525-trunk&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;&lt;span class=&quot;image-wrap&quot; style=&quot;&quot;&gt;&lt;img src=&quot;https://circleci.com/gh/cooldoger/cassandra/tree/14525-trunk.svg?style=svg&quot; style=&quot;border: 0px solid black&quot; /&gt;&lt;/span&gt;&lt;/a&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;a href=&quot;https://builds.apache.org/view/A-D/view/Cassandra/job/Cassandra-devbranch-dtest/667/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;&lt;span class=&quot;image-wrap&quot; style=&quot;&quot;&gt;&lt;img src=&quot;https://builds.apache.org/view/A-D/view/Cassandra/job/Cassandra-devbranch-dtest/667/badge/icon&quot; style=&quot;border: 0px solid black&quot; /&gt;&lt;/span&gt;&lt;/a&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;
</comment>
                            <comment id="16730460" author="jay.zhuang" created="Fri, 28 Dec 2018 20:04:17 +0000"  >&lt;p&gt;The uTest failure is because &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-14946&quot; title=&quot;DistributedReadWritePathTest fails in circleci&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-14946&quot;&gt;&lt;del&gt;CASSANDRA-14946&lt;/del&gt;&lt;/a&gt;. The check conditions are hard to read, how about switching it from:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;        // We only start transports if bootstrap has completed and we&apos;re not in survey mode, OR if we are in
        // survey mode and streaming has completed but we&apos;re not using auth.
        // OR if we have not joined the ring yet.
        if (StorageService.instance.hasJoined() &amp;amp;&amp;amp;
                ((!StorageService.instance.isSurveyMode() &amp;amp;&amp;amp; !SystemKeyspace.bootstrapComplete()) ||
                (StorageService.instance.isSurveyMode() &amp;amp;&amp;amp; StorageService.instance.isBootstrapMode())))
        {
            logger.info(&quot;Not starting client transports as bootstrap has not completed&quot;);
            return;
        }
        else if (StorageService.instance.hasJoined() &amp;amp;&amp;amp;  StorageService.instance.isSurveyMode() &amp;amp;&amp;amp;
                DatabaseDescriptor.getAuthenticator().requireAuthentication())
        {
            // Auth isn&apos;t initialised until we join the ring, so if we&apos;re in survey mode auth will always fail.
            logger.info(&quot;Not starting client transports as write_survey mode and authentication is enabled&quot;);
            return;
        }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;to:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;        // Do not start the transports if we already joined the ring AND
        // if we are in survey mode, streaming has not completed or auth is enabled
        // if we are not in survey mode, bootstrap has not completed
        if (StorageService.instance.hasJoined())
        {
            if (StorageService.instance.isSurveyMode())
            {
                if (StorageService.instance.isBootstrapMode() ||
                    DatabaseDescriptor.getAuthenticator().requireAuthentication())
                {
                    logger.info(&quot;Not starting client transports in write_survey mode as it&apos;s bootstrapping or auth is enabled&quot;);
                    return;
                }
            }
            else
            {
                if (!SystemKeyspace.bootstrapComplete()) {
                    logger.info(&quot;Not starting client transports as bootstrap has not completed&quot;);
                    return;
                }
            }
        }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="16730509" author="chovatia.jaydeep@gmail.com" created="Sat, 29 Dec 2018 00:07:53 +0000"  >&lt;p&gt;Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jay.zhuang&quot; class=&quot;user-hover&quot; rel=&quot;jay.zhuang&quot;&gt;jay.zhuang&lt;/a&gt; for the review, I&apos;ve incorporated the changes. Please find latest patch details here:&lt;/p&gt;
&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;Branch &lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;uTest &lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/apache/cassandra/compare/cassandra-2.2...jaydeepkumar1984:14525-2.2?expand=1&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;2.2&lt;/a&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://circleci.com/gh/jaydeepkumar1984/cassandra/161&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;&lt;span class=&quot;image-wrap&quot; style=&quot;&quot;&gt;&lt;img src=&quot;https://circleci.com/gh/jaydeepkumar1984/cassandra/tree/bqr.svg?style=svg&quot; style=&quot;border: 0px solid black&quot; /&gt;&lt;/span&gt; &lt;/a&gt;  &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/apache/cassandra/compare/cassandra-3.0...jaydeepkumar1984:14525-3.0?expand=1&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;3.0&lt;/a&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://circleci.com/gh/jaydeepkumar1984/cassandra/160&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;&lt;span class=&quot;image-wrap&quot; style=&quot;&quot;&gt;&lt;img src=&quot;https://circleci.com/gh/jaydeepkumar1984/cassandra/tree/bqr.svg?style=svg&quot; style=&quot;border: 0px solid black&quot; /&gt;&lt;/span&gt; &lt;/a&gt;  &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/apache/cassandra/compare/cassandra-3.11...jaydeepkumar1984:14525-3.11?expand=1&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;3.11&lt;/a&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://circleci.com/gh/jaydeepkumar1984/cassandra/162&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;&lt;span class=&quot;image-wrap&quot; style=&quot;&quot;&gt;&lt;img src=&quot;https://circleci.com/gh/jaydeepkumar1984/cassandra/tree/bqr.svg?style=svg&quot; style=&quot;border: 0px solid black&quot; /&gt;&lt;/span&gt; &lt;/a&gt;  &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/apache/cassandra/compare/trunk...jaydeepkumar1984:14525-trunk?expand=1&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;trunk&lt;/a&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://circleci.com/gh/jaydeepkumar1984/cassandra/164&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;&lt;span class=&quot;image-wrap&quot; style=&quot;&quot;&gt;&lt;img src=&quot;https://circleci.com/gh/jaydeepkumar1984/cassandra/tree/bqr.svg?style=svg&quot; style=&quot;border: 0px solid black&quot; /&gt;&lt;/span&gt; &lt;/a&gt;  &lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;
</comment>
                            <comment id="16730522" author="jay.zhuang" created="Sat, 29 Dec 2018 01:41:59 +0000"  >&lt;p&gt;Hi, just a question : &lt;tt&gt;SystemKeyspace.bootstrapComplete()&lt;/tt&gt; is checked here: &lt;a href=&quot;https://github.com/apache/cassandra/commit/9c3fb65e697d810321936e06504de4b2f7cf633f#diff-b76a607445d53f18a98c9df14323c7ddR392&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/cassandra/commit/9c3fb65e697d810321936e06504de4b2f7cf633f#diff-b76a607445d53f18a98c9df14323c7ddR392&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;But not here: &lt;a href=&quot;https://github.com/apache/cassandra/commit/9c3fb65e697d810321936e06504de4b2f7cf633f#diff-b76a607445d53f18a98c9df14323c7ddR351&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/cassandra/commit/9c3fb65e697d810321936e06504de4b2f7cf633f#diff-b76a607445d53f18a98c9df14323c7ddR351&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Is that expected?&lt;/p&gt;</comment>
                            <comment id="16731090" author="chovatia.jaydeep@gmail.com" created="Sun, 30 Dec 2018 22:14:20 +0000"  >&lt;p&gt;Yes &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jay.zhuang&quot; class=&quot;user-hover&quot; rel=&quot;jay.zhuang&quot;&gt;jay.zhuang&lt;/a&gt; that is expected, because &lt;tt&gt;isSurveyMode=true&lt;/tt&gt; mode and &lt;tt&gt;SystemKeyspace.bootstrapComplete()=true&lt;/tt&gt; does not co-exist&lt;/p&gt;

&lt;p&gt;e.g.&#160;&lt;br/&gt;
 &lt;a href=&quot;https://github.com/apache/cassandra/blob/cassandra-3.0/src/java/org/apache/cassandra/service/StorageService.java#L929&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;If in survey mode then bootstrap will not be COMPLETE &lt;/a&gt;&lt;br/&gt;
 &lt;a href=&quot;https://github.com/apache/cassandra/blob/cassandra-3.0/src/java/org/apache/cassandra/service/StorageService.java#L985&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;If we give-up survey mode then bootstrap will be COMPLETE &lt;/a&gt;&lt;/p&gt;

&lt;p&gt;So this check &lt;tt&gt;!SystemKeyspace.bootstrapComplete()&lt;/tt&gt; at &lt;a href=&quot;https://github.com/apache/cassandra/commit/9c3fb65e697d810321936e06504de4b2f7cf633f#diff-b76a607445d53f18a98c9df14323c7ddR392&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;this line&lt;/a&gt;&#160;was&#160;redundant which is been&#160;removed in the latest diffs.&lt;/p&gt;</comment>
                            <comment id="16731200" author="jay.zhuang" created="Mon, 31 Dec 2018 06:17:05 +0000"  >&lt;p&gt;Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=chovatia.jaydeep%40gmail.com&quot; class=&quot;user-hover&quot; rel=&quot;chovatia.jaydeep@gmail.com&quot;&gt;chovatia.jaydeep@gmail.com&lt;/a&gt; and &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=KurtG&quot; class=&quot;user-hover&quot; rel=&quot;KurtG&quot;&gt;KurtG&lt;/a&gt;. Committed as &lt;a href=&quot;https://github.com/apache/cassandra/commit/a6196a3a79b67dc6577747e591456328e57c314f&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;&lt;tt&gt;a6196a3&lt;/tt&gt;&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="16731429" author="chovatia.jaydeep@gmail.com" created="Mon, 31 Dec 2018 19:11:23 +0000"  >&lt;p&gt;Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jay.zhuang&quot; class=&quot;user-hover&quot; rel=&quot;jay.zhuang&quot;&gt;jay.zhuang&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=KurtG&quot; class=&quot;user-hover&quot; rel=&quot;KurtG&quot;&gt;KurtG&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=djoshi3&quot; class=&quot;user-hover&quot; rel=&quot;djoshi3&quot;&gt;djoshi3&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16737556" author="aweisberg" created="Tue, 8 Jan 2019 21:49:13 +0000"  >&lt;p&gt;This breaks bootstrap_test.py:TestBootstrap.test_resumable_bootstrap. The test expects the cluster to start the native interface when bootstrap fails.&lt;/p&gt;</comment>
                            <comment id="16737561" author="aweisberg" created="Tue, 8 Jan 2019 21:52:34 +0000"  >&lt;p&gt;I think test_resume secondary_indexes_test.py:TestPreJoinCallback.test_resume has the same issue.&lt;/p&gt;</comment>
                            <comment id="16737608" author="chovatia.jaydeep@gmail.com" created="Tue, 8 Jan 2019 22:48:09 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=aweisberg&quot; class=&quot;user-hover&quot; rel=&quot;aweisberg&quot;&gt;aweisberg&lt;/a&gt; I&apos;ve already taken care of dests as part of &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-14526&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/CASSANDRA-14526&lt;/a&gt;, here is the &lt;a href=&quot;https://github.com/apache/cassandra-dtest/compare/master...jaydeepkumar1984:14526-trunk&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;patch for dtest&lt;/a&gt;. Not sure if &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jay.zhuang&quot; class=&quot;user-hover&quot; rel=&quot;jay.zhuang&quot;&gt;jay.zhuang&lt;/a&gt; got a chance to fire dtest, if possible could you please help me start dtest with this patch?&lt;/p&gt;</comment>
                            <comment id="16738426" author="aweisberg" created="Wed, 9 Jan 2019 16:47:18 +0000"  >&lt;p&gt;OK, it&apos;s better to avoid committing any dtest breakage. If there are 10 developers occasionally committing dtest breakage then each of them has to look at the current set of breakage and figure out if it was their changes that are causing issues or some other set of changes.&lt;/p&gt;

&lt;p&gt;And I am very aware I am in a glass house when I say this!&lt;/p&gt;

&lt;p&gt;If you want to break things into multiple JIRAs or commits it&apos;s fine, but it&apos;s less disruptive if you wait until everything is complete before landing any piece of it.&lt;/p&gt;

&lt;p&gt;If Jay is reviewing the dtest changes I&apos;ll kick it off a dtest run, but let him finish the review.&lt;/p&gt;</comment>
                            <comment id="16738913" author="chovatia.jaydeep@gmail.com" created="Thu, 10 Jan 2019 02:21:04 +0000"  >&lt;p&gt;Apologize for not having&#160;both the fixes landed at the same time, will take utmost care in the future.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jay.zhuang&quot; class=&quot;user-hover&quot; rel=&quot;jay.zhuang&quot;&gt;jay.zhuang&lt;/a&gt; If you have sometime then could you please validate the dtest and land it if it looks fine?&lt;/p&gt;</comment>
                            <comment id="16739100" author="jay.zhuang" created="Thu, 10 Jan 2019 06:14:26 +0000"  >&lt;p&gt;I&apos;m sorry for not committing the dtest change. Will do that ASAP (I&apos;m still trying to confirm a few flaky tests are not introduced by the changes).&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310560">
                    <name>Problem/Incident</name>
                                            <outwardlinks description="causes">
                                        <issuelink>
            <issuekey id="13317225">CASSANDRA-15952</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                            <subtask id="13166334">CASSANDRA-14526</subtask>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[chovatia.jaydeep@gmail.com]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12313825" key="com.atlassian.jira.plugin.system.customfieldtypes:cascadingselect">
                        <customfieldname>Bug Category</customfieldname>
                        <customfieldvalues>
                                                    <customfieldvalue key="12983" cascade-level=""><![CDATA[Availability]]></customfieldvalue>
                                <customfieldvalue key="12994" cascade-level="1"><![CDATA[Unavailable]]></customfieldvalue>
            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            6 years, 44 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3uwav:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>KurtG</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[KurtG]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12962"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>