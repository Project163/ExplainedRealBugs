<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 22:28:43 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-3736] -Dreplace_token leaves old node (IP) in the gossip with the token.</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-3736</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-957&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/CASSANDRA-957&lt;/a&gt; introduce a -Dreplace_token,&lt;/p&gt;

&lt;p&gt;however, the replaced IP keeps on showing up in the Gossiper when starting the replacement node:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt; INFO [Thread-2] 2012-01-12 23:59:35,162 CassandraDaemon.java (line 213) Listening for thrift clients...
 INFO [GossipStage:1] 2012-01-12 23:59:35,173 Gossiper.java (line 836) Node /50.56.59.68 has restarted, now UP
 INFO [GossipStage:1] 2012-01-12 23:59:35,174 Gossiper.java (line 804) InetAddress /50.56.59.68 is now UP
 INFO [GossipStage:1] 2012-01-12 23:59:35,175 StorageService.java (line 988) Node /50.56.59.68 state jump to normal
 INFO [GossipStage:1] 2012-01-12 23:59:35,176 Gossiper.java (line 836) Node /50.56.58.55 has restarted, now UP
 INFO [GossipStage:1] 2012-01-12 23:59:35,176 Gossiper.java (line 804) InetAddress /50.56.58.55 is now UP
 INFO [GossipStage:1] 2012-01-12 23:59:35,177 StorageService.java (line 1016) Nodes /50.56.58.55 and action-quick2/50.56.31.186 have the same token 85070591730234615865843651857942052864.  Ignoring /50.56.58.55
 INFO [GossipTasks:1] 2012-01-12 23:59:45,048 Gossiper.java (line 818) InetAddress /50.56.58.55 is now dead.
 INFO [GossipTasks:1] 2012-01-13 00:00:06,062 Gossiper.java (line 632) FatClient /50.56.58.55 has been silent for 30000ms, removing from gossip
 INFO [GossipStage:1] 2012-01-13 00:01:06,320 Gossiper.java (line 838) Node /50.56.58.55 is now part of the cluster
 INFO [GossipStage:1] 2012-01-13 00:01:06,320 Gossiper.java (line 804) InetAddress /50.56.58.55 is now UP
 INFO [GossipStage:1] 2012-01-13 00:01:06,321 StorageService.java (line 1016) Nodes /50.56.58.55 and action-quick2/50.56.31.186 have the same token 85070591730234615865843651857942052864.  Ignoring /50.56.58.55
 INFO [GossipTasks:1] 2012-01-13 00:01:16,106 Gossiper.java (line 818) InetAddress /50.56.58.55 is now dead.
 INFO [GossipTasks:1] 2012-01-13 00:01:37,121 Gossiper.java (line 632) FatClient /50.56.58.55 has been silent for 30000ms, removing from gossip
 INFO [GossipStage:1] 2012-01-13 00:02:37,352 Gossiper.java (line 838) Node /50.56.58.55 is now part of the cluster
 INFO [GossipStage:1] 2012-01-13 00:02:37,353 Gossiper.java (line 804) InetAddress /50.56.58.55 is now UP
 INFO [GossipStage:1] 2012-01-13 00:02:37,353 StorageService.java (line 1016) Nodes /50.56.58.55 and action-quick2/50.56.31.186 have the same token 85070591730234615865843651857942052864.  Ignoring /50.56.58.55
 INFO [GossipTasks:1] 2012-01-13 00:02:47,158 Gossiper.java (line 818) InetAddress /50.56.58.55 is now dead.
 INFO [GossipStage:1] 2012-01-13 00:02:50,162 Gossiper.java (line 818) InetAddress /50.56.58.55 is now dead.
 INFO [GossipStage:1] 2012-01-13 00:02:50,163 StorageService.java (line 1156) Removing token 122029383590318827259508597176866581733 for /50.56.58.55
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;in the above, /50.56.58.55 was the replaced IP.&lt;/p&gt;

&lt;p&gt;tried adding the &quot;Gossiper.instance.removeEndpoint(endpoint);&quot; in the StorageService.java where the message &apos;Nodes %s and %s have the same token %s.  Ignoring %s&quot;,&apos; seems only have fixed this temporary. Here is a ring output:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;riptano@action-quick:~/work/cassandra$ ./bin/nodetool -h localhost ring
Address         DC          Rack        Status State   Load            Owns    Token                                       
                                                                               85070591730234615865843651857942052864      
50.56.59.68     datacenter1 rack1       Up     Normal  6.67 KB         85.56%  60502102442797279294142560823234402248      
50.56.31.186    datacenter1 rack1       Up     Normal  11.12 KB        14.44%  85070591730234615865843651857942052864 
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;gossipinfo:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;$ ./bin/nodetool -h localhost gossipinfo
/50.56.58.55
  LOAD:6835.0
  SCHEMA:00000000-0000-1000-0000-000000000000
  RPC_ADDRESS:50.56.58.55
  STATUS:NORMAL,85070591730234615865843651857942052864
  RELEASE_VERSION:1.0.7-SNAPSHOT
/50.56.59.68
  LOAD:6835.0
  SCHEMA:00000000-0000-1000-0000-000000000000
  RPC_ADDRESS:50.56.59.68
  STATUS:NORMAL,60502102442797279294142560823234402248
  RELEASE_VERSION:1.0.7-SNAPSHOT
action-quick2/50.56.31.186
  LOAD:11387.0
  SCHEMA:00000000-0000-1000-0000-000000000000
  RPC_ADDRESS:50.56.31.186
  STATUS:NORMAL,85070591730234615865843651857942052864
  RELEASE_VERSION:1.0.7-SNAPSHOT
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Note that at 1 point earlier it seems to have been removed:&lt;/p&gt;

&lt;p&gt;$ ./bin/nodetool -h localhost gossipinfo&lt;br/&gt;
/50.56.59.68&lt;br/&gt;
  LOAD:13815.0&lt;br/&gt;
  SCHEMA:00000000-0000-1000-0000-000000000000&lt;br/&gt;
  RPC_ADDRESS:50.56.59.68&lt;br/&gt;
  STATUS:NORMAL,60502102442797279294142560823234402248&lt;br/&gt;
  RELEASE_VERSION:1.0.7-SNAPSHOT&lt;br/&gt;
action-quick2/50.56.31.186&lt;br/&gt;
  LOAD:13725.0&lt;br/&gt;
  SCHEMA:00000000-0000-1000-0000-000000000000&lt;br/&gt;
  RPC_ADDRESS:50.56.31.186&lt;br/&gt;
  STATUS:NORMAL,85070591730234615865843651857942052864&lt;br/&gt;
  RELEASE_VERSION:1.0.7-SNAPSHOT&lt;/p&gt;

&lt;p&gt;riptano@action-quick2:~/work/cassandra$  INFO &lt;span class=&quot;error&quot;&gt;&amp;#91;GossipStage:1&amp;#93;&lt;/span&gt; 2012-01-13 01:03:30,073 Gossiper.java (line 838) Node /50.56.58.55 is now part of the cluster&lt;/p&gt;

&lt;p&gt; INFO &lt;span class=&quot;error&quot;&gt;&amp;#91;GossipStage:1&amp;#93;&lt;/span&gt; 2012-01-13 01:03:30,073 Gossiper.java (line 804) InetAddress /50.56.58.55 is now UP&lt;/p&gt;

&lt;p&gt; INFO &lt;span class=&quot;error&quot;&gt;&amp;#91;GossipStage:1&amp;#93;&lt;/span&gt; 2012-01-13 01:03:30,074 StorageService.java (line 1017) Nodes /50.56.58.55 and action-quick2/50.56.31.186 have the same token 85070591730234615865843651857942052864.  Ignoring /50.56.58.55&lt;/p&gt;</description>
                <environment></environment>
        <key id="12538279">CASSANDRA-3736</key>
            <summary>-Dreplace_token leaves old node (IP) in the gossip with the token.</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10002" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Normal</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="vijay2win@yahoo.com">Vijay</assignee>
                                    <reporter username="cywjackson">Jackson Chung</reporter>
                        <labels>
                    </labels>
                <created>Fri, 13 Jan 2012 01:13:21 +0000</created>
                <updated>Tue, 16 Apr 2019 09:32:42 +0000</updated>
                            <resolved>Thu, 19 Jan 2012 21:08:38 +0000</resolved>
                                        <fixVersion>1.0.8</fixVersion>
                    <fixVersion>1.1.0</fixVersion>
                                        <due></due>
                            <votes>1</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="13185379" author="vijay2win@yahoo.com" created="Fri, 13 Jan 2012 01:37:45 +0000"  >&lt;p&gt;Hi Jackson, Just a clarification is 50.56.58.55 up and cassandra is running?&lt;/p&gt;

&lt;p&gt; INFO &lt;span class=&quot;error&quot;&gt;&amp;#91;GossipStage:1&amp;#93;&lt;/span&gt; 2012-01-12 23:59:35,177 StorageService.java (line 1016) Nodes /50.56.58.55 and action-quick2/50.56.31.186 have the same token 85070591730234615865843651857942052864.  Ignoring /50.56.58.55&lt;/p&gt;

&lt;p&gt;This happens when the replaced node is running or resurrected. &lt;/p&gt;</comment>
                            <comment id="13185385" author="davidstrauss" created="Fri, 13 Jan 2012 01:50:56 +0000"  >&lt;p&gt;Hi Vijay,&lt;/p&gt;

&lt;p&gt;I filed the ticket with DataStax that prompted this issue. I&apos;m not 100% certain whether the node we replaced was fully and consistently offline from the point we performed the replacement. I &lt;b&gt;believe&lt;/b&gt; it was, especially because the -Dreplace_token refuses to work if the node being replaced is online &amp;#8212; and we took no further action to bring the replaced node back (its VM wasn&apos;t initializing any network interfaces other than &quot;lo&quot;).&lt;/p&gt;

&lt;p&gt;Even if the replaced node comes back, it shouldn&apos;t be allowed to re-join the ring with a token already owned by an &quot;Up&quot; node. It should be subjected to the same condition -Dreplace_token is, where the token being used by the new ring member must be owned by a &quot;Down&quot; node.&lt;/p&gt;

&lt;p&gt;David&lt;/p&gt;</comment>
                            <comment id="13185388" author="davidstrauss" created="Fri, 13 Jan 2012 01:59:49 +0000"  >&lt;p&gt;Alternatively, it would be good for Cassandra to provide a convenient (nodetool) way to drop the &quot;Down&quot; IP when a token is simultaneously occupied by one &quot;Up&quot; IP and at least one &quot;Down&quot; IP.&lt;/p&gt;</comment>
                            <comment id="13185389" author="brandon.williams" created="Fri, 13 Jan 2012 02:03:16 +0000"  >&lt;blockquote&gt;&lt;p&gt;Alternatively, it would be good for Cassandra to provide a convenient (nodetool) way to drop the &quot;Down&quot; IP when a token is simultaneously occupied by one &quot;Up&quot; IP and at least one &quot;Down&quot; IP.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-3337&quot; title=&quot;Create a way to obliterate nodes from the ring&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-3337&quot;&gt;&lt;del&gt;CASSANDRA-3337&lt;/del&gt;&lt;/a&gt; is designed to handle these kinds of situations (where gossip is not doing the right thing naturally)&lt;/p&gt;</comment>
                            <comment id="13185398" author="cywjackson" created="Fri, 13 Jan 2012 02:29:47 +0000"  >&lt;blockquote&gt;&lt;p&gt;is 50.56.58.55 up and cassandra is running?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;no. the Cassandra on 50.56.58.55 was not UP/had shutdown. But the IP is available, though i don&apos;t think that matters.&lt;/p&gt;

&lt;p&gt;so my test case was simply:&lt;br/&gt;
1) start 2 nodes (A , B).  With A being the seed, B bootstrap into it (by specifying a token)&lt;br/&gt;
2) stop B (after B had successfully joined)&lt;br/&gt;
3) start C with -Dcassandra.replace_token=&amp;lt;B&apos;s token&amp;gt;&lt;/p&gt;

&lt;p&gt;continuing restarting C (without the replace_token param) could observe the behavior.&lt;/p&gt;</comment>
                            <comment id="13185413" author="vijay2win@yahoo.com" created="Fri, 13 Jan 2012 03:43:13 +0000"  >&lt;p&gt;Simple patch to remove from SYSTEM_TABLE/RING_KEY when token is replaced.&lt;/p&gt;</comment>
                            <comment id="13185879" author="cywjackson" created="Fri, 13 Jan 2012 21:39:32 +0000"  >&lt;p&gt;fix no good.&lt;/p&gt;

&lt;p&gt;and to ensure fix is deployed, checked the compiled class:&lt;/p&gt;

&lt;p&gt;$ javap -c -private -classpath ./build/classes/main/ org.apache.cassandra.db.SystemTable | grep &quot;updateToken(java.net.Inet&quot; -A10&lt;br/&gt;
public static synchronized void updateToken(java.net.InetAddress, org.apache.cassandra.dht.Token);&lt;br/&gt;
  Code:&lt;br/&gt;
   0:   aload_0&lt;br/&gt;
   1:   invokestatic    #51; //Method org/apache/cassandra/utils/FBUtilities.getLocalAddress&lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/sad.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;)Ljava/net/InetAddress;&lt;br/&gt;
   4:   if_acmpne       12&lt;br/&gt;
   7:   aload_1&lt;br/&gt;
   8:   invokestatic    #52; //Method removeToken:(Lorg/apache/cassandra/dht/Token;)V&lt;br/&gt;
   11:  return&lt;/p&gt;

&lt;p&gt;to ensure removeToken is added (per the patch)&lt;/p&gt;

&lt;p&gt;and the classpath of the jvm is using it:&lt;/p&gt;

&lt;p&gt; INFO 20:32:57,083 Classpath: ./bin/../conf:./bin/&lt;b&gt;../build/classes/main&lt;/b&gt;:./bin/../build/classes/thrift:./bin/../lib/antlr-3.2.jar:./bin/../lib/avro-1.4.0-fixes.jar:./bin/../lib/avro-1.4.0-sources-fixes.jar:./bin/../lib/commons-cli-1.1.jar:./bin/../lib/commons-codec-1.2.jar:./bin/../lib/commons-lang-2.4.jar:./bin/../lib/compress-lzf-0.8.4.jar:./bin/../lib/concurrentlinkedhashmap-lru-1.2.jar:./bin/../lib/guava-r08.jar:./bin/../lib/high-scale-lib-1.1.2.jar:./bin/../lib/jackson-core-asl-1.4.0.jar:./bin/../lib/jackson-mapper-asl-1.4.0.jar:./bin/../lib/jamm-0.2.5.jar:./bin/../lib/jline-0.9.94.jar:./bin/../lib/json-simple-1.1.jar:./bin/../lib/libthrift-0.6.jar:./bin/../lib/log4j-1.2.16.jar:./bin/../lib/servlet-api-2.5-20081211.jar:./bin/../lib/slf4j-api-1.6.1.jar:./bin/../lib/slf4j-log4j12-1.6.1.jar:./bin/../lib/snakeyaml-1.6.jar:./bin/../lib/snappy-java-1.0.4.1.jar:./bin/../lib/jamm-0.2.5.jar&lt;/p&gt;

&lt;p&gt;log from the replacement node:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt; INFO 20:34:27,856 Listening for thrift clients...
 INFO 20:35:28,750 Node /50.56.58.55 is now part of the cluster
 INFO 20:35:28,750 InetAddress /50.56.58.55 is now UP
 INFO 20:35:28,751 Nodes /50.56.58.55 and action-quick2/50.56.31.186 have the same token 85070591730234615865843651857942052864.  Ignoring /50.56.58.55
 INFO 20:35:38,841 InetAddress /50.56.58.55 is now dead.
 INFO 20:35:58,852 FatClient /50.56.58.55 has been silent for 30000ms, removing from gossip
 INFO 20:36:59,786 Node /50.56.58.55 is now part of the cluster
 INFO 20:36:59,787 InetAddress /50.56.58.55 is now UP
 INFO 20:36:59,787 Nodes /50.56.58.55 and action-quick2/50.56.31.186 have the same token 85070591730234615865843651857942052864.  Ignoring /50.56.58.55
 INFO 20:37:09,887 InetAddress /50.56.58.55 is now dead.
 INFO 20:37:29,898 FatClient /50.56.58.55 has been silent for 30000ms, removing from gossip
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
</comment>
                            <comment id="13185899" author="brandon.williams" created="Fri, 13 Jan 2012 22:00:43 +0000"  >&lt;p&gt;I suspect we have the same issue as I outlined in &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-3737&quot; title=&quot;Its impossible to removetoken joining down node&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-3737&quot;&gt;&lt;del&gt;CASSANDRA-3737&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13188817" author="cywjackson" created="Wed, 18 Jan 2012 23:53:29 +0000"  >&lt;p&gt;looks like fix from &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-3747&quot; title=&quot;Remove EndpointState.hasToken&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-3747&quot;&gt;&lt;del&gt;CASSANDRA-3747&lt;/del&gt;&lt;/a&gt; got the fix.&lt;/p&gt;

&lt;p&gt;the replacement node would still get this once:&lt;br/&gt;
 INFO &lt;span class=&quot;error&quot;&gt;&amp;#91;GossipStage:1&amp;#93;&lt;/span&gt; 2012-01-18 23:45:56,412 Gossiper.java (line 834) Node /50.56.58.55 is now part of the cluster&lt;br/&gt;
 INFO &lt;span class=&quot;error&quot;&gt;&amp;#91;GossipStage:1&amp;#93;&lt;/span&gt; 2012-01-18 23:45:56,412 Gossiper.java (line 800) InetAddress /50.56.58.55 is now UP&lt;br/&gt;
 INFO &lt;span class=&quot;error&quot;&gt;&amp;#91;GossipStage:1&amp;#93;&lt;/span&gt; 2012-01-18 23:45:56,413 StorageService.java (line 1016) Nodes /50.56.58.55 and action-quick2/50.56.31.186 have the same token 85070591730234615865843651857942052864.  Ignoring /50.56.58.55&lt;br/&gt;
 INFO &lt;span class=&quot;error&quot;&gt;&amp;#91;GossipTasks:1&amp;#93;&lt;/span&gt; 2012-01-18 23:46:05,805 Gossiper.java (line 814) InetAddress /50.56.58.55 is now dead.&lt;br/&gt;
 INFO &lt;span class=&quot;error&quot;&gt;&amp;#91;GossipTasks:1&amp;#93;&lt;/span&gt; 2012-01-18 23:46:26,819 Gossiper.java (line 628) FatClient /50.56.58.55 has been silent for 30000ms, removing from gossip&lt;/p&gt;

&lt;p&gt;but its quiet after that.&lt;/p&gt;

&lt;p&gt;the other node would receive the same info also:&lt;/p&gt;

&lt;p&gt; INFO &lt;span class=&quot;error&quot;&gt;&amp;#91;GossipTasks:1&amp;#93;&lt;/span&gt; 2012-01-18 23:45:57,486 Gossiper.java (line 628) FatClient /50.56.58.55 has been silent for 30000ms, removing from gossip&lt;/p&gt;

&lt;p&gt;and the gossipinfo of those nodes are the matching:&lt;/p&gt;


&lt;p&gt;$ ./bin/nodetool -h 50.56.31.186 gossipinfo&lt;br/&gt;
/50.56.59.68&lt;br/&gt;
  RELEASE_VERSION:1.0.7-SNAPSHOT&lt;br/&gt;
  LOAD:6820.0&lt;br/&gt;
  RPC_ADDRESS:50.56.59.68&lt;br/&gt;
  STATUS:NORMAL,0&lt;br/&gt;
  SCHEMA:00000000-0000-1000-0000-000000000000&lt;br/&gt;
action-quick2/50.56.31.186&lt;br/&gt;
  RELEASE_VERSION:1.0.7-SNAPSHOT&lt;br/&gt;
  RPC_ADDRESS:50.56.31.186&lt;br/&gt;
  STATUS:NORMAL,85070591730234615865843651857942052864&lt;br/&gt;
  LOAD:11372.0&lt;br/&gt;
  SCHEMA:00000000-0000-1000-0000-000000000000&lt;/p&gt;

&lt;p&gt;$ ./bin/nodetool -h 50.56.59.68 gossipinfo&lt;br/&gt;
action-quick/50.56.59.68&lt;br/&gt;
  SCHEMA:00000000-0000-1000-0000-000000000000&lt;br/&gt;
  RELEASE_VERSION:1.0.7-SNAPSHOT&lt;br/&gt;
  LOAD:6820.0&lt;br/&gt;
  RPC_ADDRESS:50.56.59.68&lt;br/&gt;
  STATUS:NORMAL,0&lt;br/&gt;
/50.56.31.186&lt;br/&gt;
  SCHEMA:00000000-0000-1000-0000-000000000000&lt;br/&gt;
  RELEASE_VERSION:1.0.7-SNAPSHOT&lt;br/&gt;
  LOAD:11372.0&lt;br/&gt;
  RPC_ADDRESS:50.56.31.186&lt;br/&gt;
  STATUS:NORMAL,85070591730234615865843651857942052864&lt;/p&gt;</comment>
                            <comment id="13188911" author="vijay2win@yahoo.com" created="Thu, 19 Jan 2012 04:33:36 +0000"  >&lt;p&gt;Yes and the fix attached with this ticket will also remove the node from the System table, while replacing hence you wont even see the following message...&lt;/p&gt;

&lt;p&gt;&amp;gt;&amp;gt;&amp;gt; INFO &lt;span class=&quot;error&quot;&gt;&amp;#91;GossipStage:1&amp;#93;&lt;/span&gt; 2012-01-18 23:45:56,412 Gossiper.java (line 800) InetAddress /50.56.58.55 is now UP&lt;/p&gt;

&lt;p&gt;The problem is that we remove the node after 30 seconds.... Meanwhile the gossip will make the other node know about .55 and hence the message in the other node. &lt;br/&gt;
The patch will fix this by removing the information from the System table in the first place instead of restart which triggering it to reappear. Can you try redoing the test? it doesn&apos;t appear back in my tests.&lt;/p&gt;</comment>
                            <comment id="13189302" author="brandon.williams" created="Thu, 19 Jan 2012 19:11:04 +0000"  >&lt;p&gt;If &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-3747&quot; title=&quot;Remove EndpointState.hasToken&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-3747&quot;&gt;&lt;del&gt;CASSANDRA-3747&lt;/del&gt;&lt;/a&gt; solved this, then I don&apos;t think there&apos;s any full solution here worth applying, since this is mostly just a cosmetic problem and not worth introducing a possibly destabilizing change over.  Anyone running into this can use &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-3337&quot; title=&quot;Create a way to obliterate nodes from the ring&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-3337&quot;&gt;&lt;del&gt;CASSANDRA-3337&lt;/del&gt;&lt;/a&gt; to remove it, or avoid replacing tokens.&lt;/p&gt;

&lt;p&gt;+1 to this patch for 1.0 and trunk, though.&lt;/p&gt;</comment>
                            <comment id="13189379" author="vijay2win@yahoo.com" created="Thu, 19 Jan 2012 21:08:38 +0000"  >&lt;p&gt;Committed both in 1.0 and trunk. Thanks!&lt;/p&gt;</comment>
                            <comment id="13496136" author="tamarfraenkel" created="Tue, 13 Nov 2012 12:16:49 +0000"  >&lt;p&gt;I have the same issue with Cassandra 1.0.11 (used DataStax AMI).&lt;br/&gt;
I thought it was supposed to be solved already.&lt;br/&gt;
I see those messages on the node that was started using -Dcassandra.replace_token=&amp;lt;token&amp;gt;.&lt;/p&gt;

&lt;p&gt;From time to time I also see &lt;br/&gt;
&lt;font color=&quot;blue&quot;&gt; &lt;br/&gt;
 INFO &lt;span class=&quot;error&quot;&gt;&amp;#91;GossipTasks:1&amp;#93;&lt;/span&gt; 2012-11-13 12:26:38,195 Gossiper.java (line 818) InetAddress /&amp;lt;dead_node_ip&amp;gt; is now dead.&lt;br/&gt;
 INFO &lt;span class=&quot;error&quot;&gt;&amp;#91;GossipTasks:1&amp;#93;&lt;/span&gt; 2012-11-13 12:26:58,203 Gossiper.java (line 632) FatClient /&amp;lt;dead_node_ip&amp;gt; has been silent for 30000ms, removing from gossip&lt;br/&gt;
 INFO &lt;span class=&quot;error&quot;&gt;&amp;#91;GossipStage:1&amp;#93;&lt;/span&gt; 2012-11-13 12:27:59,210 Gossiper.java (line 838) Node /&amp;lt;dead_node_ip&amp;gt; is now part of the cluster&lt;br/&gt;
 INFO &lt;span class=&quot;error&quot;&gt;&amp;#91;GossipStage:1&amp;#93;&lt;/span&gt; 2012-11-13 12:27:59,210 Gossiper.java (line 804) InetAddress /&amp;lt;dead_node_ip&amp;gt; is now UP&lt;br/&gt;
 INFO &lt;span class=&quot;error&quot;&gt;&amp;#91;GossipStage:1&amp;#93;&lt;/span&gt; 2012-11-13 12:27:59,210 StorageService.java (line 1017) Nodes /&amp;lt;dead_node_ip&amp;gt; and /&amp;lt;replacing_node_ip&amp;gt; have the same token 113427455640312821154458202477256070484.  Ignoring /&amp;lt;dead_node_ip&amp;gt;&lt;br/&gt;
&lt;/font&gt;&lt;/p&gt;
</comment>
                    </comments>
                    <attachments>
                            <attachment id="12510456" name="0001-CASSANDRA-3736.patch" size="1107" author="vijay2win@yahoo.com" created="Fri, 13 Jan 2012 03:43:12 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[vijay2win@yahoo.com]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>223785</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            13 years, 2 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0gnlz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>95255</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>brandon.williams</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[brandon.williams]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12962"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>