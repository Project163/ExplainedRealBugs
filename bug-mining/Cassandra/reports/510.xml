<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 22:17:07 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-1623] BUG: secondaryIndexes AND multiple index expressions can cause timesouts</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-1623</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;1. Given this Column Family definition&lt;/p&gt;

&lt;p&gt;    Column Family Name: Requests&lt;br/&gt;
      Column Family Type: Standard&lt;br/&gt;
      Column Sorted By: org.apache.cassandra.db.marshal.UTF8Type&lt;br/&gt;
      Column Metadata:&lt;br/&gt;
        Column Name: requested&lt;br/&gt;
          Validation Class: org.apache.cassandra.db.marshal.UTF8Type&lt;br/&gt;
          Index Type: KEYS&lt;br/&gt;
        Column Name: requestor&lt;br/&gt;
          Validation Class: org.apache.cassandra.db.marshal.UTF8Type&lt;br/&gt;
          Index Type: KEYS&lt;/p&gt;

&lt;p&gt;If I have an entry that has the following column/value pairs:&lt;/p&gt;

&lt;p&gt;&quot;request-uuid1&quot; : [  &lt;/p&gt;
{ &quot;requested&quot;,&quot;person-uuid1&quot; }
&lt;p&gt;, &lt;/p&gt;
{ &quot;requestor&quot;,&quot;person-uuid2&quot;}
&lt;p&gt;, &lt;/p&gt;
{ &quot;is_confirmed&quot;,&quot;true&quot; }
&lt;p&gt; ]&lt;/p&gt;

&lt;p&gt;If I do an index lookup (pseudo coded) :&lt;/p&gt;

&lt;p&gt;get_index_slices( Connection,&lt;br/&gt;
                                 ColumnParent.column_family=&quot;Requests&quot;,&lt;br/&gt;
                                 [ &lt;/p&gt;
{ &quot;requested&quot;,&quot;eq&quot;, &quot;person-uuid1&quot; }
&lt;p&gt;, &lt;/p&gt;
{ &quot;is_confirmed&quot;,&quot;eq&quot;, &quot;false&quot; }
&lt;p&gt; ],      % Index Expressions&lt;br/&gt;
                                 &quot;&quot;,100,   % StartKey, KeyCount&lt;br/&gt;
                                 &quot;&quot;,&quot;&quot;,false,100   % StartCol, EndCol, Reversed, ColCount )&lt;/p&gt;

&lt;p&gt;for &quot;requested&quot; = &quot;person-uuid1&quot; and &quot;is_confirmed&quot; = false &lt;/p&gt;

&lt;p&gt;then I get the following entries in my log and the request times out along with all other requests on all clients.&lt;/p&gt;

&lt;p&gt;DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;pool-1-thread-10&amp;#93;&lt;/span&gt; 2010-10-15 19:00:27,878 CassandraServer.java (line 531) scan&lt;br/&gt;
DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;pool-1-thread-10&amp;#93;&lt;/span&gt; 2010-10-15 19:00:27,897 StorageProxy.java (line 563) restricted single token match for query &lt;span class=&quot;error&quot;&gt;&amp;#91;0,0&amp;#93;&lt;/span&gt;&lt;br/&gt;
DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;pool-1-thread-10&amp;#93;&lt;/span&gt; 2010-10-15 19:00:27,897 StorageProxy.java (line 649) scan ranges are &lt;span class=&quot;error&quot;&gt;&amp;#91;0,0&amp;#93;&lt;/span&gt;&lt;br/&gt;
DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;pool-1-thread-10&amp;#93;&lt;/span&gt; 2010-10-15 19:00:27,925 StorageProxy.java (line 669) reading org.apache.cassandra.db.IndexScanCommand@42a6eb from 52@localhost/127.0.0.1&lt;br/&gt;
DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;ReadStage:2&amp;#93;&lt;/span&gt; 2010-10-15 19:00:27,931 SliceQueryFilter.java (line 121) collecting 0 of 1: null:false:0@1287103291&lt;br/&gt;
DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;ReadStage:2&amp;#93;&lt;/span&gt; 2010-10-15 19:00:27,933 SliceQueryFilter.java (line 121) collecting 0 of 2147483647: is_confirmed:false:4@1287103291&lt;br/&gt;
DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;ReadStage:2&amp;#93;&lt;/span&gt; 2010-10-15 19:00:27,934 SliceQueryFilter.java (line 121) collecting 1 of 2147483647: request_type:false:6@1287103291&lt;br/&gt;
DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;ReadStage:2&amp;#93;&lt;/span&gt; 2010-10-15 19:00:27,935 SliceQueryFilter.java (line 121) collecting 2 of 2147483647: requested:false:58@1287103291&lt;br/&gt;
DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;ReadStage:2&amp;#93;&lt;/span&gt; 2010-10-15 19:00:27,935 SliceQueryFilter.java (line 121) collecting 3 of 2147483647: requested_network:false:57@1287103291&lt;br/&gt;
DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;ReadStage:2&amp;#93;&lt;/span&gt; 2010-10-15 19:00:27,936 SliceQueryFilter.java (line 121) collecting 4 of 2147483647: requestor:false:58@1287103291&lt;br/&gt;
DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;ReadStage:2&amp;#93;&lt;/span&gt; 2010-10-15 19:00:27,937 SliceQueryFilter.java (line 121) collecting 5 of 2147483647: requestor_network:false:57@1287103291&lt;br/&gt;
DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;ReadStage:2&amp;#93;&lt;/span&gt; 2010-10-15 19:00:27,942 SliceQueryFilter.java (line 121) collecting 0 of 1: null:false:0@1287103291&lt;br/&gt;
DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;ReadStage:2&amp;#93;&lt;/span&gt; 2010-10-15 19:00:27,943 SliceQueryFilter.java (line 121) collecting 0 of 1: null:false:0@1287103291&lt;br/&gt;
DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;ReadStage:2&amp;#93;&lt;/span&gt; 2010-10-15 19:00:27,945 SliceQueryFilter.java (line 121) collecting 0 of 1: null:false:0@1287103291&lt;br/&gt;
DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;ReadStage:2&amp;#93;&lt;/span&gt; 2010-10-15 19:00:27,946 SliceQueryFilter.java (line 121) collecting 0 of 1: null:false:0@1287103291&lt;br/&gt;
 this last line repeats forever until I stop the server.&lt;/p&gt;

&lt;p&gt;If instead I do the lookup where both terms match or just the last term matches then nothing goes wrong, I get a valid (empty or otherwise) result set.&lt;/p&gt;

&lt;p&gt;It only seems to happen if the 2nd expression does not match.&lt;/p&gt;

&lt;p&gt;I am using the very latest code from trunk.&lt;/p&gt;


&lt;p&gt;Jason&lt;/p&gt;
</description>
                <environment>&lt;p&gt;centos 5.5&lt;/p&gt;</environment>
        <key id="12477501">CASSANDRA-1623</key>
            <summary>BUG: secondaryIndexes AND multiple index expressions can cause timesouts</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10002" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Normal</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="jbellis">Jonathan Ellis</assignee>
                                    <reporter username="jasontanner">Jason Tanner</reporter>
                        <labels>
                    </labels>
                <created>Fri, 15 Oct 2010 19:59:18 +0000</created>
                <updated>Tue, 16 Apr 2019 09:33:15 +0000</updated>
                            <resolved>Mon, 18 Oct 2010 20:42:01 +0000</resolved>
                                        <fixVersion>0.7 beta 3</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                                                                <comments>
                            <comment id="12922098" author="jbellis" created="Mon, 18 Oct 2010 15:05:14 +0000"  >&lt;p&gt;Patch attached with fix and unit test demonstrating the problem.&lt;/p&gt;</comment>
                            <comment id="12922237" author="jasontanner" created="Mon, 18 Oct 2010 20:26:46 +0000"  >&lt;p&gt;Patch tested on my install and it resolved my issue.&lt;/p&gt;</comment>
                            <comment id="12922245" author="jbellis" created="Mon, 18 Oct 2010 20:42:01 +0000"  >&lt;p&gt;committed&lt;/p&gt;</comment>
                            <comment id="12922568" author="hudson" created="Tue, 19 Oct 2010 14:15:04 +0000"  >&lt;p&gt;Integrated in Cassandra #570 (See &lt;a href=&quot;https://hudson.apache.org/hudson/job/Cassandra/570/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://hudson.apache.org/hudson/job/Cassandra/570/&lt;/a&gt;)&lt;br/&gt;
    fix potential infinite loop in 2ary index queries&lt;br/&gt;
patch by jbellis; tested by Jason Tanner for &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-1623&quot; title=&quot;BUG: secondaryIndexes AND multiple index expressions can cause timesouts&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-1623&quot;&gt;&lt;del&gt;CASSANDRA-1623&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12457452" name="1623.txt" size="2577" author="jbellis" created="Mon, 18 Oct 2010 15:05:14 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[jbellis]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>20221</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            15 years, 6 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0g6db:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>92462</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>jasontanner</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[jasontanner]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12962"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>