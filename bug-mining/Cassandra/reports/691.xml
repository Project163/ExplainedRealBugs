<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 22:19:01 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-2039] LazilyCompactedRow doesn&apos;t add CFInfo to digest</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-2039</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;LazilyCompactedRow.update doesn&apos;t add the CFInfo or columnCount to the digest, so the hash value in the Merkle tree does not include this data.  However, PrecompactedRow does include this.  Two consequences of this are:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;Row-level tombstones are not compared when using LazilyCompactedRow so could remain inconsistent&lt;/li&gt;
	&lt;li&gt;LazilyCompactedRow and PrecompactedRow produce different hashes of the same row, so if two nodes have differing in_memory_compaction_limit_in_mb values, rows of size in between the two limits will have different hashes so will always be repaired even when they are the same.&lt;/li&gt;
&lt;/ul&gt;
</description>
                <environment></environment>
        <key id="12496518">CASSANDRA-2039</key>
            <summary>LazilyCompactedRow doesn&apos;t add CFInfo to digest</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10003" iconUrl="https://issues.apache.org/jira/images/icons/priorities/trivial.svg">Low</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="richardlow">Richard Low</assignee>
                                    <reporter username="richardlow">Richard Low</reporter>
                        <labels>
                    </labels>
                <created>Mon, 24 Jan 2011 10:59:37 +0000</created>
                <updated>Tue, 16 Apr 2019 09:33:08 +0000</updated>
                            <resolved>Fri, 8 Apr 2011 21:39:26 +0000</resolved>
                                        <fixVersion>0.8 beta 1</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                                                                <comments>
                            <comment id="12986655" author="jbellis" created="Tue, 25 Jan 2011 20:05:34 +0000"  >&lt;p&gt;this looks okay eyeballing it, but can you add a check to LazilyCompactedRowTest similar to assertBytes to make sure this stays fixed?&lt;/p&gt;</comment>
                            <comment id="12986984" author="richardlow" created="Wed, 26 Jan 2011 12:37:21 +0000"  >&lt;p&gt;I added assertDigest (see the patch trunk-2038-LazilyCompactedRowTest.txt), but it currently fails in testManyRows.  The reason is that the Bloom filters have different sizes, because getEstimatedColumnCount returns a value too large in LazilyCompactedRow.  There is probably no way round this without doing another pass on the data.&lt;/p&gt;

&lt;p&gt;However, it isn&apos;t necessary to add the Bloom filter or indeed the index to the digest - they are determined by the data that comes later.  So could the header be excluded from the digest?&lt;/p&gt;</comment>
                            <comment id="12987025" author="jbellis" created="Wed, 26 Jan 2011 14:41:53 +0000"  >&lt;p&gt;That sounds good.  Let&apos;s do that in trunk to avoid breaking compatibility in 0.7.&lt;/p&gt;</comment>
                            <comment id="12987149" author="richardlow" created="Wed, 26 Jan 2011 18:39:14 +0000"  >&lt;p&gt;The v2 patch does this (and supersedes the other two patches).  Now the updated LazilyCompactedRowTest passes, as do the other tests.&lt;/p&gt;

&lt;p&gt;It now might be possible to compute the digest for LazilyCompactedRow in just one pass through the data - the first pass is now just used to calculate columnCount.  columnCount could be excluded from the digest (I added it just because it was there in PrecompactedRow).  However, it&apos;s used by isEmpty - what would be the impact of using estimatedColumnCount here instead?  Is estimatedColumnCount zero if and only if columnCount is zero?  Or does it matter is isEmpty sometimes returns false when it&apos;s true?&lt;/p&gt;</comment>
                            <comment id="12991050" author="jbellis" created="Sat, 5 Feb 2011 20:38:35 +0000"  >&lt;p&gt;Committed v2.  Thanks!&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;what would be the impact of using estimatedColumnCount here instead&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;It would break the part of CompactionIterator that leaves out rows with no columns from the new SSTable.  &quot;estimated&quot; is the maximum possible number of columns in the new row, so it&apos;s ok to use it in the bloom filter, but not in the &quot;is this row empty post-merge&quot; check.&lt;/p&gt;</comment>
                            <comment id="12991066" author="hudson" created="Sat, 5 Feb 2011 21:37:53 +0000"  >&lt;p&gt;Integrated in Cassandra #710 (See &lt;a href=&quot;https://hudson.apache.org/hudson/job/Cassandra/710/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://hudson.apache.org/hudson/job/Cassandra/710/&lt;/a&gt;)&lt;br/&gt;
    make PreCompactedRow and LazyCompactedRow digest computations match&lt;br/&gt;
patch by Richard Low and jbellis for &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-2039&quot; title=&quot;LazilyCompactedRow doesn&amp;#39;t add CFInfo to digest&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-2039&quot;&gt;&lt;del&gt;CASSANDRA-2039&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12469416" name="trunk-2038-LazilyCompactedRowTest.txt" size="3268" author="richardlow" created="Wed, 26 Jan 2011 12:29:21 +0000"/>
                            <attachment id="12469454" name="trunk-2038-v2.txt" size="6772" author="richardlow" created="Wed, 26 Jan 2011 18:24:12 +0000"/>
                            <attachment id="12469140" name="trunk-2038.txt" size="983" author="richardlow" created="Mon, 24 Jan 2011 11:03:38 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[richardlow]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>20410</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            14 years, 42 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0g8y7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>92880</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>jbellis</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[jbellis]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12961"><![CDATA[Low]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>