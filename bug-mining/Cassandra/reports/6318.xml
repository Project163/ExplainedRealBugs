<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 23:28:12 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-18848] GCInspector &quot;Error accessing field of java.nio.Bits&quot; under java17</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-18848</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;Running under java17, &lt;tt&gt;GCInspector&lt;/tt&gt; throws the following exception:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;DEBUG [main] 2023-09-13 09:35:28,031 GCInspector.java:85 - Error accessing field of java.nio.Bits
java.lang.reflect.InaccessibleObjectException: Unable to make field private static final java.util.concurrent.atomic.AtomicLong java.nio.Bits.TOTAL_CAPACITY accessible: module java.base does not &quot;opens java.nio&quot; to unnamed module @503d687a
&#160; &#160; &#160; &#160; at java.base/java.lang.reflect.AccessibleObject.checkCanSetAccessible(AccessibleObject.java:354)
&#160; &#160; &#160; &#160; at java.base/java.lang.reflect.AccessibleObject.checkCanSetAccessible(AccessibleObject.java:297)
&#160; &#160; &#160; &#160; at java.base/java.lang.reflect.Field.checkCanSetAccessible(Field.java:178)
&#160; &#160; &#160; &#160; at java.base/java.lang.reflect.Field.setAccessible(Field.java:172)
&#160; &#160; &#160; &#160; at org.apache.cassandra.service.GCInspector.&amp;lt;clinit&amp;gt;(GCInspector.java:80)
&#160; &#160; &#160; &#160; at org.apache.cassandra.service.CassandraDaemon.setup(CassandraDaemon.java:328)
&#160; &#160; &#160; &#160; at org.apache.cassandra.service.CassandraDaemon.activate(CassandraDaemon.java:729)
&#160; &#160; &#160; &#160; at org.apache.cassandra.service.CassandraDaemon.main(CassandraDaemon.java:853)
INFO&#160; [main] 2023-09-13 09:35:28,039 PaxosUncommittedTracker.java:236 - enabling PaxosUncommittedTracker &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;This is because &lt;tt&gt;GCInspector&lt;/tt&gt; uses reflection to read the &lt;tt&gt;TOTAL_CAPACITY&lt;/tt&gt; from &lt;tt&gt;java.nio.Bits&lt;/tt&gt;. Access was restricted somewhere between 11 and 17.&lt;/p&gt;

&lt;p&gt;Note: this is a rather harmless error, as we only look at &lt;tt&gt;Bits.totalCapacity&lt;/tt&gt; for metrics collection on how much direct memory is being used by {{ByteBuffer}}s. If we fail to read the field, we simply return -1 for the metric value.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13550539">CASSANDRA-18848</key>
            <summary>GCInspector &quot;Error accessing field of java.nio.Bits&quot; under java17</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10003" iconUrl="https://issues.apache.org/jira/images/icons/priorities/trivial.svg">Low</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="edimitrova">Ekaterina Dimitrova</assignee>
                                    <reporter username="edimitrova">Ekaterina Dimitrova</reporter>
                        <labels>
                    </labels>
                <created>Wed, 13 Sep 2023 13:47:45 +0000</created>
                <updated>Fri, 10 Oct 2025 08:47:48 +0000</updated>
                            <resolved>Thu, 14 Sep 2023 17:33:17 +0000</resolved>
                                        <fixVersion>5.0-alpha2</fixVersion>
                    <fixVersion>5.0</fixVersion>
                    <fixVersion>5.1</fixVersion>
                                    <component>Observability/Metrics</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="17764733" author="edimitrova" created="Wed, 13 Sep 2023 14:55:04 +0000"  >&lt;p&gt;5.0 Patch PR: &lt;a href=&quot;https://github.com/apache/cassandra/pull/2683&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/cassandra/pull/2683&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;5.0 JDK17 green CI run: &lt;a href=&quot;https://app.circleci.com/pipelines/github/ekaterinadimitrova2/cassandra/2512/workflows/450638d5-873e-4257-824b-0db189236615&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://app.circleci.com/pipelines/github/ekaterinadimitrova2/cassandra/2512/workflows/450638d5-873e-4257-824b-0db189236615&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Also, tested locally and verified the debug log, no more exceptions are thrown. I believe we can safely propagate the patch to trunk and do only local check, saving on resources for full CI run.&lt;/p&gt;

&lt;p&gt;I also used the opportunity to clean a few lines of dead code JDK8 related. TOTAL_CAPACITY had a different name in JDK8 so we were checking for that one in case we are on JDK8, but we dropped it already for 5.0+.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mck&quot; class=&quot;user-hover&quot; rel=&quot;mck&quot;&gt;mck&lt;/a&gt;&#160;, do. you mind to review this one? Seems like you worked on TOTAL_CAPACITY issue when we were upgrading to JDK11. (&lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-14757&quot; title=&quot;GCInspector &amp;quot;Error accessing field of java.nio.Bits&amp;quot; under java11&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-14757&quot;&gt;&lt;del&gt;CASSANDRA-14757&lt;/del&gt;&lt;/a&gt;&#160;)&lt;/p&gt;</comment>
                            <comment id="17764755" author="smiklosovic" created="Wed, 13 Sep 2023 15:42:56 +0000"  >&lt;p&gt;I verified that it does not throw that exception anymore on Java 17 so I am +1 in that regard. TOTAL_CAPACITY change makes sense to me as well.&lt;/p&gt;</comment>
                            <comment id="17765093" author="michaelsembwever" created="Thu, 14 Sep 2023 10:31:52 +0000"  >&lt;p&gt;Nice work, +1&lt;/p&gt;

&lt;p&gt;Make sure to test on ci-cassandra.a.o , just the artifacts job as it does the deb/rpm packaging.&lt;/p&gt;</comment>
                            <comment id="17765210" author="edimitrova" created="Thu, 14 Sep 2023 14:44:43 +0000"  >&lt;p&gt;Thank you both for the reviews!&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;Make sure to test on ci-cassandra.a.o , just the artifacts job as it does the deb/rpm packaging.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Pushed the artifacts dev job here - &lt;a href=&quot;https://ci-cassandra.apache.org/job/Cassandra-devbranch-artifacts/2632/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://ci-cassandra.apache.org/job/Cassandra-devbranch-artifacts/2632/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;JDK 8 expected to fail, JDK11 is still running&lt;/p&gt;</comment>
                            <comment id="17765228" author="edimitrova" created="Thu, 14 Sep 2023 15:20:59 +0000"  >&lt;p&gt;The JDK11 jobs were completed successfully. Starting commit soon&#160;&lt;/p&gt;</comment>
                            <comment id="17765293" author="edimitrova" created="Thu, 14 Sep 2023 17:32:24 +0000"  >&lt;p&gt;Committed to &lt;a href=&quot;https://github.com/apache/cassandra.git&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/cassandra.git&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&#160;&#160; 6708499e4c..2b23fc58aa&#160; cassandra-5.0 -&amp;gt; cassandra-5.0&lt;/p&gt;

&lt;p&gt;&#160;&#160; 830f88d4ab..89065ffa21&#160; trunk -&amp;gt; trunk&lt;/p&gt;</comment>
                            <comment id="17765296" author="edimitrova" created="Thu, 14 Sep 2023 17:35:11 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=smiklosovic&quot; class=&quot;user-hover&quot; rel=&quot;smiklosovic&quot;&gt;smiklosovic&lt;/a&gt;, I have to apologize to you! There is a typo in your name in the commit message, and I did not notice it before committing it. &quot;I&quot; and &quot;o&quot; are next to each other on the keyboard...&#160;&lt;/p&gt;

&lt;p&gt;I will be more careful in the future!&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[edimitrova]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12313821" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Complexity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12965"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313822" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Discovered By</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12969"><![CDATA[User Report]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12311120" key="com.pyxis.greenhopper.jira:gh-epic-link">
                        <customfieldname>Epic Link</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>CASSANDRA-16895</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            2 years, 8 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z1kc2w:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[mck]]></customfieldvalue>
        <customfieldvalue><![CDATA[smiklosovic]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12961"><![CDATA[Low]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12311420" key="com.atlassian.jira.plugin.system.customfieldtypes:version">
                        <customfieldname>Since Version</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="12353513">5.0-alpha1</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313924" key="com.atlassian.jira.plugin.system.customfieldtypes:textfield">
                        <customfieldname>Source Control Link</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>&lt;p&gt;&lt;a href=&quot;https://github.com/apache/cassandra/commit/2b23fc58aa86a1cd0c98f97ddcf43305869d041e&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/cassandra/commit/2b23fc58aa86a1cd0c98f97ddcf43305869d041e&lt;/a&gt; &lt;a href=&quot;https://github.com/apache/cassandra/commit/89065ffa2189861c0437fd1f1a5748df006e8907&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/cassandra/commit/89065ffa2189861c0437fd1f1a5748df006e8907&lt;/a&gt;&lt;/p&gt;</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313823" key="com.atlassian.jira.plugin.system.customfieldtypes:textarea">
                        <customfieldname>Test and Documentation Plan</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>&lt;p&gt;5.0 Patch PR: &lt;a href=&quot;https://github.com/apache/cassandra/pull/2683&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/cassandra/pull/2683&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;5.0 JDK17 green CI run: &lt;a href=&quot;https://app.circleci.com/pipelines/github/ekaterinadimitrova2/cassandra/2512/workflows/450638d5-873e-4257-824b-0db189236615&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://app.circleci.com/pipelines/github/ekaterinadimitrova2/cassandra/2512/workflows/450638d5-873e-4257-824b-0db189236615&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Also, tested locally and verified the debug log, no more exceptions are thrown. I believe we can safely propagate the patch to trunk and do only local check, saving on resources for full CI run.&lt;/p&gt;

&lt;p&gt;I also used the opportunity to clean a few lines of dead code JDK8 related. TOTAL_CAPACITY had a different name in JDK8 so we were checking for that one in case we are on JDK8, but we dropped it already for 5.0+.&lt;/p&gt;</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>