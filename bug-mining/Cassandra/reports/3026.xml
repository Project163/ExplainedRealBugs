<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 22:47:18 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-6612] Query failing due to AssertionError</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-6612</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;I am trying out Cassandra for the first time and running it locally for simple session management db. &lt;span class=&quot;error&quot;&gt;&amp;#91;Cassandra-2.0.4, CQL3, datastax driver 2.0.0-rc2&amp;#93;&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;The following count query works fine when there is no data in the table:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;select count(*) from session_data where app_name=? and account=? and last_access &amp;gt; ?
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;But after even a single row is inserted into the table, the query fails with the following error:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;    java.lang.AssertionError
	at org.apache.cassandra.db.filter.ExtendedFilter$WithClauses.getExtraFilter(ExtendedFilter.java:258)
	at org.apache.cassandra.db.ColumnFamilyStore.filter(ColumnFamilyStore.java:1719)
	at org.apache.cassandra.db.ColumnFamilyStore.getRangeSlice(ColumnFamilyStore.java:1674)
	at org.apache.cassandra.db.PagedRangeCommand.executeLocally(PagedRangeCommand.java:111)
	at org.apache.cassandra.service.StorageProxy$LocalRangeSliceRunnable.runMayThrow(StorageProxy.java:1418)
	at org.apache.cassandra.service.StorageProxy$DroppableRunnable.run(StorageProxy.java:1931)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1145)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:615)
	at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:744)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Here is the schema I am using:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;    CREATE KEYSPACE session WITH replication= {&lt;span class=&quot;code-quote&quot;&gt;&apos;class&apos;&lt;/span&gt;: &lt;span class=&quot;code-quote&quot;&gt;&apos;SimpleStrategy&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;replication_factor&apos;&lt;/span&gt;: 1};

    CREATE TABLE session_data (
    username text,
    session_id text,
    app_name text,
    account text,
    last_access timestamp,
    created_on timestamp,
    PRIMARY KEY (username, session_id, app_name, account)
    );

    create index sessionIndex ON session_data (session_id);
    create index sessionAppName ON session_data (app_name);
    create index lastAccessIndex ON session_data (last_access);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment>&lt;p&gt;Cassandra-2.0.4, CQL3, datastax driver 2.0.0-rc2&lt;/p&gt;</environment>
        <key id="12690431">CASSANDRA-6612</key>
            <summary>Query failing due to AssertionError</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10002" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Normal</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="slebresne">Sylvain Lebresne</assignee>
                                    <reporter username="ateesh@gmail.com">A Verma</reporter>
                        <labels>
                    </labels>
                <created>Wed, 22 Jan 2014 23:20:18 +0000</created>
                <updated>Tue, 16 Apr 2019 09:31:55 +0000</updated>
                            <resolved>Thu, 7 Aug 2014 16:37:00 +0000</resolved>
                                        <fixVersion>2.0.10</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>7</watches>
                                                                                                                <comments>
                            <comment id="13887773" author="cgavin" created="Fri, 31 Jan 2014 14:07:38 +0000"  >&lt;p&gt;There seem to be some issues with indexing on fields that are part of your primary key (see also &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-6470&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/CASSANDRA-6470&lt;/a&gt;).  You may want to try revising your schema and/or query to remove the need to index key columns.&lt;/p&gt;

&lt;p&gt;I was also able to reproduce this error in cassandra 2.0.1 and 2.0.4 using cqlsh or the java driver (I tried two versions of the 2.0.0rc, reproduction code below).&lt;/p&gt;

&lt;p&gt;public static void main(String[] args) {&lt;br/&gt;
	com.datastax.driver.core.Session session = null;&lt;br/&gt;
	try {&lt;br/&gt;
		String address = &quot;localhost&quot;;&lt;br/&gt;
		session = new com.datastax.driver.core.Cluster.Builder().addContactPoint(address).build().connect();&lt;br/&gt;
		//create keyspace, table, and indices&lt;br/&gt;
		session.execute(&quot;create keyspace if not exists testing  with replication = &lt;/p&gt;
{ &apos;class&apos;:&apos;SimpleStrategy&apos;, &apos;replication_factor&apos;:1 }
&lt;p&gt;&quot;);&lt;br/&gt;
		session.execute(&quot;drop table if exists testing.timerangetest&quot;);&lt;br/&gt;
		// testing queries by time range as described in &lt;a href=&quot;https://stackoverflow.com/questions/4667040/storing-time-ranges-in-cassandra&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://stackoverflow.com/questions/4667040/storing-time-ranges-in-cassandra&lt;/a&gt;&lt;br/&gt;
		//creating the table using &quot;i_end&quot; as a partition key reproduces &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-6612&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/CASSANDRA-6612&lt;/a&gt;&lt;br/&gt;
		session.execute(&quot;create table if not exists testing.timerangetest (id text, end timestamp, i_eq_dummy blob, i_start timestamp, i_end timestamp, primary key ((id, end)))&quot;);&lt;br/&gt;
		//creating the table using &quot;i_end&quot; as a cluster key reproduces &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-6470&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/CASSANDRA-6470&lt;/a&gt;&lt;br/&gt;
		//session.execute(&quot;create table if not exists testing.timerangetest (id text, i_eq_dummy blob, i_start timestamp, i_end timestamp, primary key (id, i_end))&quot;);&lt;/p&gt;

&lt;p&gt;		session.execute(&quot;create index if not exists on testing.timerangetest (i_start)&quot;);&lt;br/&gt;
		session.execute(&quot;create index if not exists on testing.timerangetest (i_end)&quot;);&lt;br/&gt;
		session.execute(&quot;create index if not exists on testing.timerangetest (i_eq_dummy)&quot;);&lt;br/&gt;
		//insert some values&lt;br/&gt;
		session.execute(&quot;insert into testing.timerangetest (id, end, i_eq_dummy, i_start, i_end) values (&apos;row1&apos;, 5, 0x00, 1, 5)&quot;);&lt;br/&gt;
		session.execute(&quot;insert into testing.timerangetest (id, end, i_eq_dummy, i_start, i_end) values (&apos;row2&apos;, 13, 0x00, 3, 13)&quot;);&lt;br/&gt;
		session.execute(&quot;insert into testing.timerangetest (id, end, i_eq_dummy, i_start, i_end) values (&apos;row3&apos;, 17, 0x00, 12, 17)&quot;);&lt;br/&gt;
		session.execute(&quot;insert into testing.timerangetest (id, end, i_eq_dummy, i_start, i_end) values (&apos;row4&apos;, 22, 0x00, 16, 22)&quot;);&lt;br/&gt;
		session.execute(&quot;insert into testing.timerangetest (id, end, i_eq_dummy, i_start, i_end) values (&apos;row5&apos;, 24, 0x00, 21, 24)&quot;);&lt;br/&gt;
		session.execute(&quot;insert into testing.timerangetest (id, end, i_eq_dummy, i_start, i_end) values (&apos;row6&apos;, 23, 0x00, 4, 23)&quot;);&lt;br/&gt;
		//query for everything&lt;br/&gt;
		System.out.println(&quot;all records:&quot;);&lt;br/&gt;
		for (com.datastax.driver.core.Row r : session.execute(&quot;select * from testing.timerangetest&quot;).all()) &lt;/p&gt;
{
			System.out.println(&quot;  &quot; + r.getString(&quot;id&quot;) + &quot; @ &quot; + r.getDate(&quot;i_start&quot;).getTime() + &quot;-&quot; + r.getDate(&quot;i_end&quot;).getTime());
		}&lt;br/&gt;
		//query for records that were active between 10 and 20&lt;br/&gt;
		System.out.println(&quot;active records from 10-20:&quot;);&lt;br/&gt;
		for (com.datastax.driver.core.Row r : session.execute(&quot;select * from testing.timerangetest where i_eq_dummy=0x00 and i_end &amp;gt;= 10 and i_start &amp;lt;= 20 allow filtering&quot;).all()) {			System.out.println(&quot;  &quot; + r.getString(&quot;id&quot;) + &quot; @ &quot; + r.getDate(&quot;i_start&quot;).getTime() + &quot;-&quot; + r.getDate(&quot;i_end&quot;).getTime());		}
&lt;p&gt;		//query for records that were active between 10 and 20 where id=&apos;row2&apos;&lt;br/&gt;
		System.out.println(&quot;active records from 10-20 where id=&apos;row2&apos; and end=13:&quot;);&lt;br/&gt;
		for (com.datastax.driver.core.Row r : session.execute(&quot;select * from testing.timerangetest where id=&apos;row2&apos; and end=13 and i_eq_dummy=0x00 and i_end &amp;gt;= 10 and i_start &amp;lt;= 20 allow filtering&quot;).all()) &lt;/p&gt;
{
			System.out.println(&quot;  &quot; + r.getString(&quot;id&quot;) + &quot; @ &quot; + r.getDate(&quot;i_start&quot;).getTime() + &quot;-&quot; + r.getDate(&quot;i_end&quot;).getTime());
		}
&lt;p&gt;	} finally {&lt;br/&gt;
		if (session != null) &lt;/p&gt;
{
			com.datastax.driver.core.Cluster c = session.getCluster();
			session.close();
			c.close();
		}
&lt;p&gt;	}&lt;br/&gt;
}&lt;/p&gt;</comment>
                            <comment id="14078400" author="mshuler" created="Tue, 29 Jul 2014 21:27:15 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=enigmacurry&quot; class=&quot;user-hover&quot; rel=&quot;enigmacurry&quot;&gt;enigmacurry&lt;/a&gt; let&apos;s see if we can reproduce this in 2.0/2.1 HEAD with cqlsh and the latest java-driver, as above.&lt;/p&gt;</comment>
                            <comment id="14082656" author="philipthompson" created="Fri, 1 Aug 2014 18:12:16 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mshuler&quot; class=&quot;user-hover&quot; rel=&quot;mshuler&quot;&gt;mshuler&lt;/a&gt; I do not see this error on 2.0 HEAD with cqlsh, but the query instead hangs forever, even with only one row of data inserted/&lt;/p&gt;</comment>
                            <comment id="14086365" author="slebresne" created="Tue, 5 Aug 2014 15:21:54 +0000"  >&lt;p&gt;I do am able to reproduce with the example of the description (which I&apos;ve pushed as a dtest).&lt;/p&gt;

&lt;p&gt;There is actually two small problem in SecondaryIndexManager. The first one is in the &lt;tt&gt;hasIndexFor&lt;/tt&gt; that clearly have a bogus logic when there is more than one searcher. It&apos;s this error that made the code take the wrong path and trigger the assertion. That said, once fixed, we still have a problem: the &lt;tt&gt;search&lt;/tt&gt; is unhappy because we have more than one searcher. And indeed, we&apos;ve never supported more than one searcher because even if we have multiple indexes, we should still have only one searcher for all of them (though we may have other searcher for custom indexes). That &quot;grouping&quot; of indexes is done by &lt;tt&gt;getIndexSearchersForQuery&lt;/tt&gt;. However, that method was grouping using the class name, which didn&apos;t result in all internal index sharing the same searcher since we have different concrete implementation depending on whether the index is on a partition key column, clustering key one or regular one. Anyway, attaching a slightly hackish but simple solution that just make sure we group all internal indexes properly in &lt;tt&gt;getIndexSearchersForQuery&lt;/tt&gt; as we should. We should probably overhaul the &lt;tt&gt;SecondaryIndexManager&lt;/tt&gt; class at some point because it&apos;s pretty confusing imo but that&apos;s not for this ticket.&lt;/p&gt;</comment>
                            <comment id="14086756" author="jbellis" created="Tue, 5 Aug 2014 21:01:38 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=beobal&quot; class=&quot;user-hover&quot; rel=&quot;beobal&quot;&gt;beobal&lt;/a&gt; to review&lt;/p&gt;</comment>
                            <comment id="14089324" author="beobal" created="Thu, 7 Aug 2014 15:11:26 +0000"  >&lt;p&gt;I agree that SIM is in dire need of an overhaul and because of that this is a slightly hackish solution. That aside, the patch looks good to me. Just one thing to note,  the bogus logic in SIM.hasIndexFor is already fixed in 2.1 by &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-7525&quot; title=&quot;Querying by multiple secondary indexes gives java.lang.IllegalArgumentException on some cases&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-7525&quot;&gt;&lt;del&gt;CASSANDRA-7525&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14089423" author="slebresne" created="Thu, 7 Aug 2014 16:37:00 +0000"  >&lt;p&gt;Committed, thanks&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                                                <inwardlinks description="is duplicated by">
                                        <issuelink>
            <issuekey id="12733783">CASSANDRA-7762</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12659897" name="6612.txt" size="3799" author="slebresne" created="Tue, 5 Aug 2014 15:21:54 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[slebresne]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>369383</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            11 years, 15 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1rnz3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>369686</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12311421" key="com.atlassian.jira.plugin.system.customfieldtypes:multiversion">
                        <customfieldname>Reproduced In</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="12325644">2.0.4</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>samt</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[samt]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12962"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>