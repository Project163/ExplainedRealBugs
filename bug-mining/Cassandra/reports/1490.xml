<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 22:29:38 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-3962] CassandraStorage can&apos;t cast fields from a CF correctly</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-3962</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;Included scripts demonstrate the problem.  Regardless of whether the key is cast as a chararray or not, the Pig scripts fail with &lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;java.lang.ClassCastException: org.apache.pig.data.DataByteArray cannot be &lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt; to java.lang.&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;
	at org.apache.pig.backend.hadoop.HDataType.getWritableComparableTypes(HDataType.java:72)
	at org.apache.pig.backend.hadoop.executionengine.mapReduceLayer.PigGenericMapReduce$Map.collect(PigGenericMapReduce.java:117)
	at org.apache.pig.backend.hadoop.executionengine.mapReduceLayer.PigGenericMapBase.runPipeline(PigGenericMapBase.java:269)
	at org.apache.pig.backend.hadoop.executionengine.mapReduceLayer.PigGenericMapBase.map(PigGenericMapBase.java:262)
	at org.apache.pig.backend.hadoop.executionengine.mapReduceLayer.PigGenericMapBase.map(PigGenericMapBase.java:64)
	at org.apache.hadoop.mapreduce.Mapper.run(Mapper.java:144)
	at org.apache.hadoop.mapred.MapTask.runNewMapper(MapTask.java:764)
	at org.apache.hadoop.mapred.MapTask.run(MapTask.java:370)
	at org.apache.hadoop.mapred.LocalJobRunner$Job.run(LocalJobRunner.java:212)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
</description>
                <environment>&lt;p&gt;OSX 10.6.latest, Pig 0.9.2.&lt;/p&gt;</environment>
        <key id="12544197">CASSANDRA-3962</key>
            <summary>CassandraStorage can&apos;t cast fields from a CF correctly</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10002" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Normal</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="brandon.williams">Brandon Williams</assignee>
                                    <reporter username="jalkanen">Janne Jalkanen</reporter>
                        <labels>
                            <label>hadoop</label>
                            <label>pig</label>
                    </labels>
                <created>Sun, 26 Feb 2012 20:51:08 +0000</created>
                <updated>Tue, 16 Apr 2019 09:32:38 +0000</updated>
                            <resolved>Mon, 27 Feb 2012 17:04:36 +0000</resolved>
                                        <fixVersion>1.0.9</fixVersion>
                    <fixVersion>1.1.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                                                                <comments>
                            <comment id="13216831" author="jalkanen" created="Sun, 26 Feb 2012 20:51:56 +0000"  >&lt;p&gt;Generate the test CFs.&lt;/p&gt;</comment>
                            <comment id="13216833" author="jalkanen" created="Sun, 26 Feb 2012 20:54:02 +0000"  >&lt;p&gt;The test pig script for both cases, you might want to comment out the &quot;dump a&quot; to let it continue.&lt;/p&gt;</comment>
                            <comment id="13216834" author="jalkanen" created="Sun, 26 Feb 2012 20:55:53 +0000"  >&lt;p&gt;Relevant IRC log from #cassandra&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;[22:26] driftx: hmm, I think &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; is the udfcontext signature reuse problem
[22:26] driftx: jeromatron: what&apos;s the workaround &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; that again?
[22:26] Ecyrd: Is there an open bug?
[22:28] driftx: #2869, but we fixed it. hmm.
[22:28] CassBotJr: https:&lt;span class=&quot;code-comment&quot;&gt;//issues.apache.org/jira/browse/CASSANDRA-2869 : CassandraStorage does not function properly when used multiple times in a single pig script due to UDFContext sharing issues
&lt;/span&gt;[22:34] driftx:         &lt;span class=&quot;code-keyword&quot;&gt;case&lt;/span&gt; DataType.CHARARRAY:
[22:34] driftx:             &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; NullableText((&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;)o);
[22:34] driftx: so it thinks it has a chararray, but it still has a bytearray
[22:42] driftx: I think we have to implement a LoadCaster to get around &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;
[22:43] Ecyrd: So I&apos;m not insane, &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; is a real bug 
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="13216836" author="brandon.williams" created="Sun, 26 Feb 2012 20:59:11 +0000"  >&lt;p&gt;I think implementing LoadCaster will fix this, but it&apos;s strange to me that pig doesn&apos;t allow going to the other way, casting a chararray to a bytearray since that&apos;s the only thing guaranteed to work here, in case the Bytes CF has keys that won&apos;t map to UTF8.&lt;/p&gt;</comment>
                            <comment id="13216948" author="brandon.williams" created="Sun, 26 Feb 2012 22:01:41 +0000"  >&lt;p&gt;Patch to add a LoadCaster.  It does get used and converts the byte[] to String, but the join still fails with the same error &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/sad.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="13217161" author="jalkanen" created="Mon, 27 Feb 2012 12:09:52 +0000"  >&lt;p&gt;Could the fact that these are row keys, not columns, have something to do with the issue? Looking at CassandraStorage.getNext(), there&apos;s a line&lt;/p&gt;

&lt;p&gt;    // set the key&lt;br/&gt;
    tuple.append(new DataByteArray(ByteBufferUtil.getArray(key)));&lt;/p&gt;

&lt;p&gt;So it looks to me like the key is &lt;b&gt;always&lt;/b&gt; added as a DataByteArray, regardless of it&apos;s actual type? getSchema() does seem to read the value from CfDef correctly tho&apos;.&lt;/p&gt;</comment>
                            <comment id="13217230" author="brandon.williams" created="Mon, 27 Feb 2012 15:46:08 +0000"  >&lt;p&gt;You&apos;re totally right.  It wasn&apos;t a problem casting the key from Bytes, but trying to use the one from U8.  Patch to compose the key from the marshaller.&lt;/p&gt;</comment>
                            <comment id="13217271" author="xedin" created="Mon, 27 Feb 2012 16:46:13 +0000"  >&lt;p&gt;+1&lt;/p&gt;</comment>
                            <comment id="13217295" author="brandon.williams" created="Mon, 27 Feb 2012 17:04:36 +0000"  >&lt;p&gt;Committed 0002, and also incorporated Janne&apos;s test into the existing tests.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12516124" name="0001-Add-LoadCaster-to-CassandraStorage.txt" size="4578" author="brandon.williams" created="Sun, 26 Feb 2012 22:01:41 +0000"/>
                            <attachment id="12516167" name="0002-Compose-key-from-marshaller.txt" size="1685" author="brandon.williams" created="Mon, 27 Feb 2012 15:46:07 +0000"/>
                            <attachment id="12516115" name="test.cli" size="448" author="jalkanen" created="Sun, 26 Feb 2012 20:51:56 +0000"/>
                            <attachment id="12516116" name="test.pig" size="417" author="jalkanen" created="Sun, 26 Feb 2012 20:54:02 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>4.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[brandon.williams]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>229434</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            13 years, 39 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0gqcf:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>95698</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>xedin</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[xedin]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12962"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>