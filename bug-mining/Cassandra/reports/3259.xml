<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 22:49:43 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-8018] Cassandra seems to insert twice in custom PerColumnSecondaryIndex</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-8018</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;When inserting data into Cassandra 2.1.0 into table with custom secondary index, the Cell is inserted twice, if inserting new entry into row with same rowId, but different cluster index columns. &lt;/p&gt;

&lt;p&gt;====&lt;/p&gt;

&lt;p&gt;CREATE KEYSPACE fulltext WITH replication = &lt;/p&gt;
{&apos;class&apos;: &apos;SimpleStrategy&apos;,  &apos;replication_factor&apos; : 1}
&lt;p&gt;;&lt;/p&gt;

&lt;p&gt;CREATE TABLE fulltext.test ( id uuid, name text, name2 text, json varchar, lucene text, primary key ( id , name));&lt;/p&gt;

&lt;p&gt;s&quot;CREATE CUSTOM INDEX lucene_idx on fulltext.test(lucene) using &apos;com.spinoco.fulltext.cassandra.TestIndex&apos;; &quot;&lt;/p&gt;

&lt;p&gt;// this causes only one insert&lt;br/&gt;
 insertInto(&quot;fulltext&quot;,&quot;test&quot;)&lt;br/&gt;
      .value(&quot;id&quot;, id1.uuid)&lt;br/&gt;
      .value(&quot;name&quot;, &quot;goosh1&quot;) &lt;br/&gt;
      .value(&quot;json&quot;, TestContent.message1.asJson)&lt;/p&gt;

&lt;p&gt;// this causes 2 inserts to be done &lt;br/&gt;
 insertInto(&quot;fulltext&quot;,&quot;test&quot;)&lt;br/&gt;
        .value(&quot;id&quot;, id1.uuid)&lt;br/&gt;
        .value(&quot;name&quot;, &quot;goosh2&quot;)&lt;br/&gt;
        .value(&quot;json&quot;, TestContent.message2.asJson)&lt;/p&gt;


&lt;p&gt;/// stacktraces for inserts (always same, for 1st and 2nd insert)&lt;/p&gt;

&lt;p&gt;&amp;lt;custom indexer stacktraces&amp;gt; and then&lt;br/&gt;
	at org.apache.cassandra.db.index.SecondaryIndexManager$StandardUpdater.insert(SecondaryIndexManager.java:707)&lt;br/&gt;
	at org.apache.cassandra.db.AtomicBTreeColumns$ColumnUpdater.apply(AtomicBTreeColumns.java:344)&lt;br/&gt;
	at org.apache.cassandra.db.AtomicBTreeColumns$ColumnUpdater.apply(AtomicBTreeColumns.java:319)&lt;br/&gt;
	at org.apache.cassandra.utils.btree.NodeBuilder.addNewKey(NodeBuilder.java:323)&lt;br/&gt;
	at org.apache.cassandra.utils.btree.NodeBuilder.update(NodeBuilder.java:191)&lt;br/&gt;
	at org.apache.cassandra.utils.btree.Builder.update(Builder.java:74)&lt;br/&gt;
	at org.apache.cassandra.utils.btree.BTree.update(BTree.java:186)&lt;br/&gt;
	at org.apache.cassandra.db.AtomicBTreeColumns.addAllWithSizeDelta(AtomicBTreeColumns.java:189)&lt;br/&gt;
	at org.apache.cassandra.db.Memtable.put(Memtable.java:194)&lt;br/&gt;
	at org.apache.cassandra.db.ColumnFamilyStore.apply(ColumnFamilyStore.java:1142)&lt;br/&gt;
	at org.apache.cassandra.db.Keyspace.apply(Keyspace.java:394)&lt;br/&gt;
	at org.apache.cassandra.db.Keyspace.apply(Keyspace.java:351)&lt;br/&gt;
	at org.apache.cassandra.db.Mutation.apply(Mutation.java:214)&lt;br/&gt;
	at org.apache.cassandra.service.StorageProxy$7.runMayThrow(StorageProxy.java:970)&lt;br/&gt;
	at org.apache.cassandra.service.StorageProxy$LocalMutationRunnable.run(StorageProxy.java:2080)&lt;br/&gt;
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:471)&lt;br/&gt;
	at org.apache.cassandra.concurrent.AbstractTracingAwareExecutorService$FutureTask.run(AbstractTracingAwareExecutorService.java:163)&lt;br/&gt;
	at org.apache.cassandra.concurrent.SEPWorker.run(SEPWorker.java:103)&lt;br/&gt;
	at java.lang.Thread.run(Thread.java:744)&lt;/p&gt;


&lt;p&gt;//// Note that cell, rowkey and Group in public abstract void insert(ByteBuffer rowKey, Cell col, OpOrder.Group opGroup); are having for both successive calls same identity &lt;/p&gt;</description>
                <environment></environment>
        <key id="12744706">CASSANDRA-8018</key>
            <summary>Cassandra seems to insert twice in custom PerColumnSecondaryIndex</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10002" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Normal</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="blerer">Benjamin Lerer</assignee>
                                    <reporter username="pavel.chlupacek@spinoco.com">Pavel Chlupacek</reporter>
                        <labels>
                    </labels>
                <created>Mon, 29 Sep 2014 16:08:00 +0000</created>
                <updated>Tue, 16 Apr 2019 09:31:33 +0000</updated>
                            <resolved>Tue, 2 Dec 2014 17:19:43 +0000</resolved>
                                        <fixVersion>2.1.3</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="14230439" author="blerer" created="Mon, 1 Dec 2014 20:55:22 +0000"  >&lt;p&gt;The problem came from the fact that &lt;tt&gt;NodeBuilder&lt;/tt&gt; was performing 2 calls to &lt;tt&gt;UpdateFunction.apply&lt;/tt&gt;. &lt;br/&gt;
The patch removes one of this call and add some unit tests to verify the behavior.&lt;/p&gt;</comment>
                            <comment id="14231249" author="benedict" created="Tue, 2 Dec 2014 10:04:07 +0000"  >&lt;p&gt;Good catch. A few nits on the patch, but I&apos;ll make them and commit:&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;&quot;iff&quot; is never a typo, it means &quot;if and only if&quot;&lt;/li&gt;
	&lt;li&gt;we should remove the call from inside addNewKey, rather than outside it, as that is the call that was originally meant to be removed. this way all of the calls happen in the same logical unit of code&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="14231768" author="benedict" created="Tue, 2 Dec 2014 17:19:43 +0000"  >&lt;p&gt;Committed with nits&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                                                <inwardlinks description="is duplicated by">
                                        <issuelink>
            <issuekey id="12758994">CASSANDRA-8409</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12764365">CASSANDRA-8549</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12684473" name="CASSANDRA-8018.txt" size="7139" author="blerer" created="Mon, 1 Dec 2014 20:55:22 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[blerer]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 51 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i20ld3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>benedict</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[benedict]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12962"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>