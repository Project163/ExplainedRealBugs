<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 22:22:38 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-3051] On Disk Compression breaks SSL Encryption</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-3051</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;Encryption depends on FileStreamTask.write &lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt; protected member to be called because the SSLFileStreamTask.write overrides this to write back to the server.&lt;/p&gt;

&lt;p&gt;When enabled, compression circumvents the call and the client does not communicate using an SSL socket back to the server.&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt;&lt;br/&gt;
protected long write(FileChannel fc, Pair&amp;lt;Long, Long&amp;gt; section, long length, long bytesTransferred) throws IOException&lt;/p&gt;
</description>
                <environment>&lt;p&gt;Trunk&lt;/p&gt;</environment>
        <key id="12519195">CASSANDRA-3051</key>
            <summary>On Disk Compression breaks SSL Encryption</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10002" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Normal</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="xedin">Pavel Yaskevich</assignee>
                                    <reporter username="bcoverston">Benjamin Coverston</reporter>
                        <labels>
                    </labels>
                <created>Wed, 17 Aug 2011 22:06:47 +0000</created>
                <updated>Tue, 16 Apr 2019 09:32:53 +0000</updated>
                            <resolved>Tue, 30 Aug 2011 13:50:29 +0000</resolved>
                                        <fixVersion>1.0.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                                                                <comments>
                            <comment id="13092893" author="xedin" created="Mon, 29 Aug 2011 15:05:38 +0000"  >&lt;p&gt;Removed SSLFileStreamTask and added EncryptionOptions to the constructor of the FileStreamTask.&lt;/p&gt;

&lt;p&gt;Rebased with latest trunk (last commit 0a4b1667bee674f7c0a22057cbdab97e368a20d1)&lt;/p&gt;</comment>
                            <comment id="13092911" author="jbellis" created="Mon, 29 Aug 2011 15:27:10 +0000"  >&lt;p&gt;lgtm, +1 if it actually works &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="13092915" author="xedin" created="Mon, 29 Aug 2011 15:34:05 +0000"  >&lt;p&gt;I don&apos;t see anh reason why it won&apos;t &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; but can&apos;t write a test because SSL is treacky with it&apos;s stores...&lt;/p&gt;</comment>
                            <comment id="13092921" author="gdusbabek" created="Mon, 29 Aug 2011 15:43:37 +0000"  >&lt;p&gt;wait, you tested it locally first, right?  It&apos;s not difficult to set up a streaming environment locally.&lt;/p&gt;</comment>
                            <comment id="13092924" author="jbellis" created="Mon, 29 Aug 2011 15:48:54 +0000"  >&lt;p&gt;do we have a &quot;ssl howto&quot; somewhere?  I was hoping it would be in cassandra.yaml by encryption_options but no.  Or at least, not sufficiently &quot;for dummies&quot; for me.&lt;/p&gt;</comment>
                            <comment id="13092929" author="xedin" created="Mon, 29 Aug 2011 15:55:13 +0000"  >&lt;p&gt;No, unfortunately I haven&apos;t found any info about how to do that so you are welcome to test if you can...&lt;/p&gt;</comment>
                            <comment id="13092930" author="gdusbabek" created="Mon, 29 Aug 2011 15:58:09 +0000"  >&lt;p&gt;Not that I know of.  If someone wants to write one it would flesh out these basic steps:&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;follow the steps for generating a keystore and a trust store here: &lt;a href=&quot;http://download.oracle.com/javase/6/docs/technotes/guides/security/jsse/JSSERefGuide.html#CreateKeystore&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://download.oracle.com/javase/6/docs/technotes/guides/security/jsse/JSSERefGuide.html#CreateKeystore&lt;/a&gt;&lt;/li&gt;
	&lt;li&gt;plug those files into encryption_options in cassandra.yaml&lt;/li&gt;
	&lt;li&gt;make sure encryption_options.internode_encryption = all in the yaml.&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;I was mostly raising a voice of caution against committing code backed up by statements like &quot;I don&apos;t see anh reason why it won&apos;t...&quot;  This is usually a prelude to something like &quot;we need to quickly release a new version because XYZ broke streaming.&quot;  Just sayin&apos;.&lt;/p&gt;</comment>
                            <comment id="13092951" author="xedin" created="Mon, 29 Aug 2011 16:20:21 +0000"  >&lt;p&gt;Following your logic - person who was working on ssl should&apos;ve done that at first place, there is no guarantee that it works in the current state. I&apos;m not pushing things forward just wondering why testing wasn&apos;t done before.&lt;/p&gt;</comment>
                            <comment id="13092957" author="gdusbabek" created="Mon, 29 Aug 2011 16:25:40 +0000"  >&lt;p&gt;Pavel, I tested SSL prior to committing the feature.&lt;/p&gt;

&lt;p&gt;I was under the impression that this ticket exists because compression, when enabled, breaks SSL.  The implication is that it was working prior, else the ticket would be something more like &quot;SSL is broken.&quot;&lt;/p&gt;</comment>
                            <comment id="13092967" author="xedin" created="Mon, 29 Aug 2011 16:48:30 +0000"  >&lt;p&gt;You misunderstood that, it is not breaking SSL it was just special cased in FileStreamTask so it wasn&apos;t using ssl socket. This patch removes special casing for SSL streaming by creating ssl socket directly in FileStreamTask if encryption options were set.&lt;/p&gt;</comment>
                            <comment id="13093010" author="jbellis" created="Mon, 29 Aug 2011 17:51:42 +0000"  >&lt;p&gt;Pavel, can you try to set up local SSL w/ a ccm cluster based on Gary&apos;s instructions to verify?&lt;/p&gt;</comment>
                            <comment id="13093037" author="xedin" created="Mon, 29 Aug 2011 18:09:21 +0000"  >&lt;p&gt;Sure&lt;/p&gt;</comment>
                            <comment id="13093230" author="xedin" created="Mon, 29 Aug 2011 21:38:12 +0000"  >&lt;p&gt;I figured out the problem - SSLSocket always returns null on getChannel even on current code, I will refactor FileStreamingTask to support DataOutputStream instead of SocketChannel to unify normal and SSL transfers.&lt;/p&gt;</comment>
                            <comment id="13093269" author="xedin" created="Mon, 29 Aug 2011 22:32:07 +0000"  >&lt;p&gt;CompressedRandomAccessReader.transfer method was removed with special casing for compressed files, SocketChannel based transfer changed to DataOuputStream based to unify SSL and normal modes. SSLFileStreamTask removed as unused.&lt;/p&gt;</comment>
                            <comment id="13093373" author="jbellis" created="Tue, 30 Aug 2011 02:12:15 +0000"  >&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;feels like we lose more than we gain by making writeHeader/write separate methods.  they aren&apos;t really self-contained so you have to keep the context they were called in, around mentally.  and if they were in-line, it would be obvious that you don&apos;t need to re-seek for each call to write().&lt;/li&gt;
	&lt;li&gt;comments in write() don&apos;t really add much to what the code says, imo&lt;/li&gt;
	&lt;li&gt;is flushing with each chunk necessary?  seems like that would harm performance&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13093569" author="xedin" created="Tue, 30 Aug 2011 09:17:35 +0000"  >&lt;p&gt;removed writeHeader method, seek and flush are done once per section.&lt;/p&gt;</comment>
                            <comment id="13093719" author="jbellis" created="Tue, 30 Aug 2011 13:31:10 +0000"  >&lt;p&gt;+1&lt;/p&gt;</comment>
                            <comment id="13093732" author="xedin" created="Tue, 30 Aug 2011 13:50:29 +0000"  >&lt;p&gt;Committed.&lt;/p&gt;</comment>
                            <comment id="13093765" author="hudson" created="Tue, 30 Aug 2011 14:24:23 +0000"  >&lt;p&gt;Integrated in Cassandra #1056 (See &lt;a href=&quot;https://builds.apache.org/job/Cassandra/1056/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/Cassandra/1056/&lt;/a&gt;)&lt;br/&gt;
    Fix streaming over SSL when compressed SSTable involved&lt;br/&gt;
patch by Pavel Yaskevich; reviewed by Jonathan Ellis for &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-3051&quot; title=&quot;On Disk Compression breaks SSL Encryption&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-3051&quot;&gt;&lt;del&gt;CASSANDRA-3051&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;xedin : &lt;a href=&quot;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1163207&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1163207&lt;/a&gt;&lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/cassandra/trunk/CHANGES.txt&lt;/li&gt;
	&lt;li&gt;/cassandra/trunk/src/java/org/apache/cassandra/io/compress/CompressedRandomAccessReader.java&lt;/li&gt;
	&lt;li&gt;/cassandra/trunk/src/java/org/apache/cassandra/net/MessagingService.java&lt;/li&gt;
	&lt;li&gt;/cassandra/trunk/src/java/org/apache/cassandra/security/streaming/SSLFileStreamTask.java&lt;/li&gt;
	&lt;li&gt;/cassandra/trunk/src/java/org/apache/cassandra/streaming/FileStreamTask.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                    </comments>
                    <attachments>
                            <attachment id="12492216" name="CASSANDRA-3051-v2.patch" size="16070" author="xedin" created="Tue, 30 Aug 2011 09:17:35 +0000"/>
                            <attachment id="12492154" name="CASSANDRA-3051.patch" size="14836" author="xedin" created="Mon, 29 Aug 2011 22:32:07 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[xedin]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>20949</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            14 years, 13 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0gf3z:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>93878</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>jbellis</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[jbellis]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12962"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>