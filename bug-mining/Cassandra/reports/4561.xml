<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 23:05:43 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-12868] Reject default_time_to_live option when creating or altering MVs</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-12868</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;Hi,&lt;/p&gt;

&lt;p&gt;By default, materialized views are using the TTL of primary table, irrespective of the configured value provided in materialized view creation.&lt;/p&gt;

&lt;p&gt;For eg:&lt;/p&gt;

&lt;p&gt;table:&lt;/p&gt;

&lt;p&gt;CREATE TABLE test2(id text, date text, col1 text,col2 text, PRIMARY KEY(id,date)) WITH default_time_to_live = 60 AND CLUSTERING ORDER BY (date DESC);&lt;/p&gt;

&lt;p&gt;CREATE MATERIALIZED VIEW test3_view AS&lt;br/&gt;
SELECT id, date, col1&lt;br/&gt;
FROM test3 &lt;br/&gt;
WHERE id IS NOT NULL AND date IS NOT NULL&lt;br/&gt;
PRIMARY KEY(id,date) WITH default_time_to_live = 30;&lt;/p&gt;

&lt;p&gt;The queries are accepted in CQL. As per the detail, it should use 30 seconds for Materialized view and 60 seconds for parent table.&lt;br/&gt;
But, it is always 60 seconds (as the parent table)&lt;/p&gt;

&lt;p&gt;case 1: &lt;br/&gt;
parent table and materialized view with different TTL&lt;br/&gt;
MV will always have the TTL of parent.&lt;/p&gt;

&lt;p&gt;case 2:&lt;br/&gt;
Parent table without TTL but materialized view with TTL&lt;br/&gt;
MV does not have the TTL even though the configuration has been accepted in the table creation.&lt;/p&gt;

&lt;p&gt;Expected:&lt;br/&gt;
Either the TTL configuration should not be accepted in the materialized view creation, if it is of no value.&lt;/p&gt;

&lt;p&gt;Or&lt;/p&gt;

&lt;p&gt;TTL has to be applied differently for both Materialized View and Table if the configuration is added.&lt;/p&gt;

&lt;p&gt;If no configuration, TTL has to be taken from the parent table. &lt;/p&gt;
</description>
                <environment></environment>
        <key id="13017053">CASSANDRA-12868</key>
            <summary>Reject default_time_to_live option when creating or altering MVs</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10003" iconUrl="https://issues.apache.org/jira/images/icons/priorities/trivial.svg">Low</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="krishnasun">Sundar Srinivasan</assignee>
                                    <reporter username="srini.daruna">Srinivasarao Daruna</reporter>
                        <labels>
                            <label>lhf</label>
                    </labels>
                <created>Wed, 2 Nov 2016 00:42:50 +0000</created>
                <updated>Wed, 26 Feb 2020 18:50:10 +0000</updated>
                            <resolved>Mon, 5 Dec 2016 11:14:24 +0000</resolved>
                                        <fixVersion>3.0.11</fixVersion>
                    <fixVersion>3.10</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="15629142" author="slebresne" created="Wed, 2 Nov 2016 14:33:25 +0000"  >&lt;blockquote&gt;&lt;p&gt;Either the TTL configuration should not be accepted in the materialized view creation&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;That. I agree that accepting the parameters but ignoring them is confusing and we should fix that. That&apos;s why I&apos;m going to actually promote that as a bug and rephrase the description if you don&apos;t mind.&lt;/p&gt;

&lt;p&gt;Accepting different TTL settings for views and the base has never been the intent, and that would kind of break the idea that the view is a view of the base table. Even if we were fine with that, it&apos;s a can of worms: if you allow the base table to expire more quickly, you might lose the ability to properly update some view entries for instance. Without saying we should never ever consider the option, suffice to say that we have more important things to do on MVs before considering that, and so let&apos;s focus on fixing the lack of validation for now.&lt;/p&gt;</comment>
                            <comment id="15629144" author="slebresne" created="Wed, 2 Nov 2016 14:33:44 +0000"  >&lt;blockquote&gt;&lt;p&gt;Either the TTL configuration should not be accepted in the materialized view creation&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;That. I agree that accepting the parameters but ignoring them is confusing and we should fix that. That&apos;s why I&apos;m going to actually promote that as a bug and rephrase the description if you don&apos;t mind.&lt;/p&gt;

&lt;p&gt;Accepting different TTL settings for views and the base has never been the intent, and that would kind of break the idea that the view is a view of the base table. Even if we were fine with that, it&apos;s a can of worms: if you allow the base table to expire more quickly, you might lose the ability to properly update some view entries for instance. Without saying we should never ever consider the option, suffice to say that we have more important things to do on MVs before considering that, and so let&apos;s focus on fixing the lack of validation for now.&lt;/p&gt;</comment>
                            <comment id="15654751" author="krishnasun" created="Thu, 10 Nov 2016 18:23:36 +0000"  >&lt;p&gt;I am new to Cassandra, although I have some experience developing proprietary distributed systems. When I used Cassandra, I liked it. When I started reading its architecture and code, I loved it. I am trying to fix this one by disallowing TTL for creation of materialized views and get my hands dirty with the code. &lt;/p&gt;

&lt;p&gt;Just to get some direction, is this the correct place where the fix should be? CreateViewStatement::announceMigration()&lt;/p&gt;

&lt;p&gt;I generally use Emacs for coding. Do you guys have any instruction manual on how to start a JDB session for this? Like JVM argument etc.&lt;/p&gt;</comment>
                            <comment id="15668660" author="krishnasun" created="Tue, 15 Nov 2016 23:01:35 +0000"  >&lt;p&gt;Disallowing default_time_to_live parameter for materialized view creation and alteration&lt;/p&gt;</comment>
                            <comment id="15668662" author="krishnasun" created="Tue, 15 Nov 2016 23:02:13 +0000"  >&lt;p&gt;Patch&lt;/p&gt;</comment>
                            <comment id="15683898" author="slebresne" created="Mon, 21 Nov 2016 15:44:24 +0000"  >&lt;p&gt;Thanks for the patch, which lgtm, though there is no reason not to commit this to 3.0 onwards so took the liberty to rebase and run the test below (slightly amended the error message fyi):&lt;/p&gt;
&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;a href=&quot;https://github.com/pcmanus/cassandra/commits/12868-3.0&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;12868-3.0&lt;/a&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;a href=&quot;http://cassci.datastax.com/job/pcmanus-12868-3.0-testall&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;utests&lt;/a&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;a href=&quot;http://cassci.datastax.com/job/pcmanus-12868-3.0-dtest&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;dtests&lt;/a&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;a href=&quot;https://github.com/pcmanus/cassandra/commits/12868-3.X&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;12868-3.X&lt;/a&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;a href=&quot;http://cassci.datastax.com/job/pcmanus-12868-3.X-testall&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;utests&lt;/a&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;a href=&quot;http://cassci.datastax.com/job/pcmanus-12868-3.X-dtest&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;dtests&lt;/a&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;


&lt;p&gt;I&apos;ll commit once the test result are in (unless they show a problem obviously).&lt;/p&gt;</comment>
                            <comment id="15687498" author="krishnasun" created="Tue, 22 Nov 2016 18:29:31 +0000"  >&lt;p&gt;Thanks, Sylvain!&lt;/p&gt;</comment>
                            <comment id="15721995" author="slebresne" created="Mon, 5 Dec 2016 11:14:24 +0000"  >&lt;p&gt;Sorry this kind of slipped. The tests were ok so committed now, thanks.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310560">
                    <name>Problem/Incident</name>
                                            <outwardlinks description="causes">
                                        <issuelink>
            <issuekey id="13287823">CASSANDRA-15604</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12839078" name="12868-trunk.txt" size="7314" author="krishnasun" created="Tue, 15 Nov 2016 23:02:13 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[krishnasun]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 50 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i35p6n:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12311421" key="com.atlassian.jira.plugin.system.customfieldtypes:multiversion">
                        <customfieldname>Reproduced In</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="12337344">3.9</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>slebresne</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[slebresne]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12961"><![CDATA[Low]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>