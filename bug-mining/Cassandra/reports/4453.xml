<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 23:04:45 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-12423] Cells missing from compact storage table after upgrading from 2.1.9 to 3.7</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-12423</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;Schema:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;create table ks1.test ( id &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;, c1 text, c2 text, v &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;, primary key (id, c1, c2)) with compact storage and compression = {&lt;span class=&quot;code-quote&quot;&gt;&apos;sstable_compression&apos;&lt;/span&gt;: &apos;&apos;};
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;sstable2json before upgrading:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;[
{&lt;span class=&quot;code-quote&quot;&gt;&quot;key&quot;&lt;/span&gt;: &lt;span class=&quot;code-quote&quot;&gt;&quot;1&quot;&lt;/span&gt;,
 &lt;span class=&quot;code-quote&quot;&gt;&quot;cells&quot;&lt;/span&gt;: [[&lt;span class=&quot;code-quote&quot;&gt;&quot;&quot;,&quot;&lt;/span&gt;0&quot;,1470761440040513],
           [&lt;span class=&quot;code-quote&quot;&gt;&quot;a&quot;&lt;/span&gt;,&lt;span class=&quot;code-quote&quot;&gt;&quot;asd&quot;&lt;/span&gt;,2470761440040513,&lt;span class=&quot;code-quote&quot;&gt;&quot;t&quot;&lt;/span&gt;,1470764842],
           [&lt;span class=&quot;code-quote&quot;&gt;&quot;asd:&quot;&lt;/span&gt;,&lt;span class=&quot;code-quote&quot;&gt;&quot;0&quot;&lt;/span&gt;,1470761451368658],
           [&lt;span class=&quot;code-quote&quot;&gt;&quot;asd:asd&quot;&lt;/span&gt;,&lt;span class=&quot;code-quote&quot;&gt;&quot;0&quot;&lt;/span&gt;,1470761449416613]]}
]
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Query result with 2.1.9:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;cqlsh&amp;gt; select * from ks1.test;

 id | c1  | c2   | v
----+-----+------+---
  1 |     | &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; | 0
  1 | asd |      | 0
  1 | asd |  asd | 0

(3 rows)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Query result with 3.7:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;cqlsh&amp;gt; select * from ks1.test;

 id | 6331 | 6332 | v
----+------+------+---
  1 |      | &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; | 0

(1 rows)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="12996190">CASSANDRA-12423</key>
            <summary>Cells missing from compact storage table after upgrading from 2.1.9 to 3.7</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10002" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Normal</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="stefania">Stefania Alborghetti</assignee>
                                    <reporter username="tgrabiec@gmail.com">Tomasz Grabiec</reporter>
                        <labels>
                    </labels>
                <created>Wed, 10 Aug 2016 08:27:28 +0000</created>
                <updated>Tue, 16 Apr 2019 09:30:23 +0000</updated>
                            <resolved>Mon, 12 Sep 2016 09:03:49 +0000</resolved>
                                        <fixVersion>3.0.9</fixVersion>
                    <fixVersion>3.10</fixVersion>
                                    <component>Legacy/Local Write-Read Paths</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>10</watches>
                                                                                                                <comments>
                            <comment id="15414919" author="tgrabiec@gmail.com" created="Wed, 10 Aug 2016 08:40:33 +0000"  >&lt;p&gt;The problem could be that org.apache.cassandra.db.LegacyLayout#decodeBound decodes upper bound of the range tombstone with eoc=0 the same as eoc=1 (INCL_END_BOUND) and both will cover all cells which are prefixed by the short key. Whereas in 2.1.9, composite ordering orders eoc=0 bound before the cells prefixed by it.&lt;/p&gt;</comment>
                            <comment id="15418548" author="stefania" created="Fri, 12 Aug 2016 09:00:28 +0000"  >&lt;p&gt;I&apos;m trying to create an sstable to reproduce the problem but I don&apos;t understand how we can create a range tombstone with EOC=0.&lt;/p&gt;

&lt;p&gt;The CQL delete statement uses &lt;tt&gt;AbstractComposite.slice()&lt;/tt&gt;, which ensures that the start has &lt;tt&gt;EOC=-1&lt;/tt&gt; and the end has &lt;tt&gt;EOC=1&lt;/tt&gt;. Alternatively it uses a deleted cell. From what I could gather cassandra-cli also uses a deleted cell for compact storage but I am really not familiar with Thrift so perhaps there is a way to create a range tombstone with EOC=0 using cassandra-cli.&lt;/p&gt;

&lt;p&gt;Do you still have the steps to create an sstable with this problem?&lt;/p&gt;</comment>
                            <comment id="15418636" author="tgrabiec@gmail.com" created="Fri, 12 Aug 2016 10:25:41 +0000"  >&lt;p&gt;The range delete was generated using Thrift API&apos;s SlicePredicate:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;    def composite(item1, item2=None, eoc=&lt;span class=&quot;code-quote&quot;&gt;&apos;\x00&apos;&lt;/span&gt;):
        packed = _i16(len(item1)) + item1 + eoc
        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; item2 is not None:
            packed += _i16(len(item2)) + item2
            packed += eoc
        &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; packed

    def range_delete(self):
        _set_keyspace(&lt;span class=&quot;code-quote&quot;&gt;&apos;ks1&apos;&lt;/span&gt;)

        mutations = [Mutation(deletion=Deletion(2470761440040513,
                                                predicate=SlicePredicate(slice_range=SliceRange(start=composite(&lt;span class=&quot;code-quote&quot;&gt;&apos;a&apos;&lt;/span&gt;, eoc=&lt;span class=&quot;code-quote&quot;&gt;&apos;\x00&apos;&lt;/span&gt;), finish=composite(&lt;span class=&quot;code-quote&quot;&gt;&apos;asd&apos;&lt;/span&gt;, eoc=&lt;span class=&quot;code-quote&quot;&gt;&apos;\x00&apos;&lt;/span&gt;)))))]

        keyed_mutations = {
            _i32(1): {
                &lt;span class=&quot;code-quote&quot;&gt;&apos;test&apos;&lt;/span&gt;: mutations
            }
        }

        client.batch_mutate(keyed_mutations, ConsistencyLevel.ONE)

&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I executed above as part of thrift_tests.py from C* dtest.&lt;/p&gt;</comment>
                            <comment id="15420740" author="stefania" created="Mon, 15 Aug 2016 08:58:21 +0000"  >&lt;p&gt;Thank you for the details. I&apos;ve created 2 new tests &lt;a href=&quot;https://github.com/stef1927/cassandra-dtest/commits/12423&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;here&lt;/a&gt;, one for upgrading sstables from 2.1.9 to 3.0+ and one that just creates a range tombstone with EOC=0. I&apos;ve reproduced the problem in both cases.&lt;/p&gt;

&lt;p&gt;The patch is in &lt;tt&gt;LegacyLayout&lt;/tt&gt; as indicated above:&lt;/p&gt;

&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;3.0&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;3.9&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;trunk&lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/stef1927/cassandra/commits/12423-3.0&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;patch&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/stef1927/cassandra/commits/12423-3.9&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;patch&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/stef1927/cassandra/commits/12423&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;patch&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/stef1927/job/stef1927-12423-3.0-testall/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;testall&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/stef1927/job/stef1927-12423-3.9-testall/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;testall&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/stef1927/job/stef1927-12423-testall/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;testall&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/stef1927/job/stef1927-12423-3.0-dtest/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;dtest&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/stef1927/job/stef1927-12423-3.9-dtest/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;dtest&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/stef1927/job/stef1927-12423-dtest/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;dtest&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;


&lt;p&gt;Aside from this issue, there is then the problem that the clustering column names &quot;c1&quot; and &quot;c2&quot; are converted into their hex bytes &quot;6331&quot; and &quot;6332&quot;. I&apos;ve traced this to this code in &lt;tt&gt;LegacySchemaMigrator&lt;/tt&gt;:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;        &lt;span class=&quot;code-comment&quot;&gt;// Note: we save the column name as string, but we should not assume that it is an UTF8 name, we
&lt;/span&gt;        &lt;span class=&quot;code-comment&quot;&gt;// we need to use the comparator fromString method
&lt;/span&gt;        AbstractType&amp;lt;?&amp;gt; comparator = isCQLTable
                                     ? UTF8Type.instance
                                     : CompactTables.columnDefinitionComparator(rawKind, isSuper, rawComparator, rawSubComparator);
        ColumnIdentifier name = ColumnIdentifier.getInterned(comparator.fromString(row.getString(&lt;span class=&quot;code-quote&quot;&gt;&quot;column_name&quot;&lt;/span&gt;)), comparator);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The problem is that there is another table, &lt;tt&gt;Standard3&lt;/tt&gt; created by thrift_test.py, and in this case we create an interned column identifier with comparator set to &lt;tt&gt;BytesType&lt;/tt&gt;, which means the column name ends up being the hex bytes corresponding to &quot;c1&quot;: &quot;6331&quot;, and similar for &quot;c2&quot;. This by itself seems wrong but maybe it is a known thrift limitation. Then, when we create the identifier for our test table, even though the comparator here is correctly set to UTF8, &lt;tt&gt;ColumnIdentifier.internedInstances&lt;/tt&gt; ensures that we pick up the same incorrect value because the UTF-8 encoding of &quot;c1&quot; or &quot;c2&quot; has the same bytes. &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=iamaleksey&quot; class=&quot;user-hover&quot; rel=&quot;iamaleksey&quot;&gt;iamaleksey&lt;/a&gt; is this something you are aware of or does it need fixing? And if so, how can we ever rely on &lt;tt&gt;ColumnIdentifier.internedInstances&lt;/tt&gt; if we use non UTF8 comparators? My guess is that &lt;tt&gt;CompactTables.columnDefinitionComparator&lt;/tt&gt; is returning the wrong comparator for &lt;tt&gt;Standard3&lt;/tt&gt; but I&apos;m not 100% sure.&lt;/p&gt;

&lt;p&gt;I&apos;ve attached the sstables generated with 2.1, &lt;span class=&quot;nobr&quot;&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12823661/12823661_12423.tar.gz&quot; title=&quot;12423.tar.gz attached to CASSANDRA-12423&quot;&gt;12423.tar.gz&lt;sup&gt;&lt;img class=&quot;rendericon&quot; src=&quot;https://issues.apache.org/jira/images/icons/link_attachment_7.gif&quot; height=&quot;7&quot; width=&quot;7&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/sup&gt;&lt;/a&gt;&lt;/span&gt;,  if you want to reproduce it quickly, just start 3.0 with these sstables after setting the partitioner and cluster name to &lt;tt&gt;ByteOrderedPartitioner&lt;/tt&gt; and &lt;tt&gt;test&lt;/tt&gt; respectively.&lt;/p&gt;
</comment>
                            <comment id="15422003" author="stefania" created="Tue, 16 Aug 2016 01:26:20 +0000"  >&lt;p&gt;Some existing thrift tests &lt;a href=&quot;http://cassci.datastax.com/job/stef1927-12423-3.0-dtest/1/testReport/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;failed&lt;/a&gt;, resuming progress.&lt;/p&gt;</comment>
                            <comment id="15425798" author="stefania" created="Thu, 18 Aug 2016 02:04:26 +0000"  >&lt;p&gt;The tests look better now, I&apos;ve restarted the unit and dtests for trunk and the dtests for 3.0 to shake off some unrelated failures that have been fixed in the last couple of days.&lt;/p&gt;

&lt;p&gt;I changed the initial approach and I&apos;ve added a new legacy bound kind that behaves like &lt;tt&gt;Composites.EOC.NONE&lt;/tt&gt; does in 2.1: an inclusive END but it compares before clustering values. This patch is ready for review, the issue with the clustering column names is probably better dealt with in a separate ticket if it needs fixing, ping &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=iamaleksey&quot; class=&quot;user-hover&quot; rel=&quot;iamaleksey&quot;&gt;iamaleksey&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="15430701" author="iamaleksey" created="Mon, 22 Aug 2016 12:57:03 +0000"  >&lt;p&gt;Looking into it. That said, there have been some changes to &lt;tt&gt;CompactTables.columnDefinitionComparator()&lt;/tt&gt; method recently in 3.0/trunk. Only &lt;tt&gt;regular&lt;/tt&gt; column names should use the comparator to decode/encode the column name, never clustering columns.&lt;/p&gt;</comment>
                            <comment id="15430720" author="iamaleksey" created="Mon, 22 Aug 2016 13:03:10 +0000"  >&lt;p&gt;As for &lt;tt&gt;ColumnIdentifier.getInterned()&lt;/tt&gt; use, I still haven&apos;t looked at the exact issue you are facing here, so it may or may not be related. &lt;b&gt;But&lt;/b&gt; overall this is definitely a potential problem. It&apos;s been broken since forever, and should be fixed in 2.1 upwards. The bytebuffer name does not unambiguously represent a column identifier, the type should be part of the key.&lt;/p&gt;</comment>
                            <comment id="15430784" author="iamaleksey" created="Mon, 22 Aug 2016 13:50:13 +0000"  >&lt;p&gt;Looked into it more, together with Stefania. To sum it up, in no particular order:&lt;/p&gt;

&lt;p&gt;1. &lt;tt&gt;DESCRIBE&lt;/tt&gt; output is broken. Sparse compact tables (with regular columns defined) that have non-text comparators should be filtered out from &lt;tt&gt;DESCRIBE&lt;/tt&gt; output, as they cannot currently be represented via CQL &lt;tt&gt;CREATE TABLE&lt;/tt&gt;. &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=aholmber&quot; class=&quot;user-hover&quot; rel=&quot;aholmber&quot;&gt;aholmber&lt;/a&gt; I&apos;ve raised this issue privately, do you remember if there is a python-driver JIRA open for it already? (also for filtering out supers). &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ifesdjeen&quot; class=&quot;user-hover&quot; rel=&quot;ifesdjeen&quot;&gt;ifesdjeen&lt;/a&gt; same goes for a follow-up JIRA to &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-7190&quot; title=&quot;Add schema to snapshot manifest&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-7190&quot;&gt;&lt;del&gt;CASSANDRA-7190&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;2. The column names for &lt;tt&gt;Keyspace1.Standard3&lt;/tt&gt; in schema tables in 2.1 and 3.0 are both correct. Should be using &lt;tt&gt;BytesType&lt;/tt&gt; for regulars in 2.1 (statics in 3.0) given the &lt;tt&gt;BytesType&lt;/tt&gt; comparator.&lt;/p&gt;

&lt;p&gt;3. Yup, you are pretty much right about &lt;tt&gt;ColumnIdentifier.getInterned()&lt;/tt&gt; being relied on incorrectly. We should fix this in 2.1 and upwards. I&apos;ll open a separate JIRA (assign to you, if you don&apos;t mind it), and link to this one, to either make the type part of the key in the interned map, or just limit its use.&lt;/p&gt;</comment>
                            <comment id="15430959" author="aholmber" created="Mon, 22 Aug 2016 15:12:33 +0000"  >&lt;p&gt;We have &lt;a href=&quot;https://datastax-oss.atlassian.net/browse/PYTHON-213&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;PYTHON-213&lt;/a&gt; open. I believe I addressed what we discussed to the extent possible. There is a gist linked there for your review if you&apos;re willing to take a look.&lt;/p&gt;</comment>
                            <comment id="15433801" author="thobbs" created="Tue, 23 Aug 2016 22:52:16 +0000"  >&lt;p&gt;Regarding the patch, it took me a while to convince myself this was the correct behavior, so I&apos;ll write out some comments for posterity.&lt;/p&gt;

&lt;p&gt;In the 2.x world, a range tombstone with a final EOC of 0 results in a exclusive deletion &lt;em&gt;except&lt;/em&gt; for cells that exactly match the tombstone bound.  I made a &lt;a href=&quot;https://github.com/thobbs/cassandra-dtest/commit/e76250a4471a81a1ece93cc954f42d4a61aa8c2d&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;dtest&lt;/a&gt; to double check this (which we should commit, I guess).  This is why we can&apos;t just use &lt;tt&gt;EXCL_END_BOUND&lt;/tt&gt; in 3.0 &amp;#8211; in the case where the range tombstone bound exactly matches a &lt;tt&gt;ClusteringPrefix&lt;/tt&gt;, we want that to be included in the deletion.&lt;/p&gt;

&lt;p&gt;I think we should change the new enum name from &lt;tt&gt;INCL_END_BOUND_EOC_0&lt;/tt&gt; to &lt;tt&gt;END_BOUND_EOC_0&lt;/tt&gt; for clarity.  It&apos;s sort of both inclusive and exclusive, so having either one in the name is confusing, I think.  Regarding the code comment:&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;This value compares as an inclusive end bound but before any clustering values. It can be removed once support for thrift and legacy sstables is removed.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I find the first half of that confusing.  Maybe rephrase it as &quot;This value is inclusive of any exact matches, but does not include any clusterings that it is merely a prefix of.&quot;  I believe the second half of the comment is incorrect, as we&apos;ll need to continue treating those range tombstones correctly as long as they exist.  Furthermore, once we&apos;ve serialized tombstones with that enum value, we&apos;ll always need it for deserialization.&lt;/p&gt;

&lt;p&gt;My last concern is around compatibility in a mixed-version cluster.  It seems like there could be problems if you did something like this:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;Have a 2.x cluster with range tombstones with an eoc=0 end bound&lt;/li&gt;
	&lt;li&gt;Upgrade to some 3.x that doesn&apos;t include this fix&lt;/li&gt;
	&lt;li&gt;Then, upgrade some nodes to a 3.y that &lt;em&gt;does&lt;/em&gt; include this fix while there are still legacy sstables&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;It seems like the 3.y nodes could send results with the new enum value to the 3.x nodes which would then error while deserializing the results.  I&apos;m not sure what to do about that yet.  We could require all sstables to be upgraded before upgrading to 3.10 from 3.x, but that would also force any remaining legacy tombstones like this to be permanently treated incorrectly, which kind of sucks.&lt;/p&gt;</comment>
                            <comment id="15434242" author="stefania" created="Wed, 24 Aug 2016 06:17:12 +0000"  >&lt;p&gt;Thanks for the review! &lt;/p&gt;

&lt;p&gt;I&apos;ve renamed &lt;tt&gt;INCL_END_BOUND_EOC_0&lt;/tt&gt; to &lt;tt&gt;END_BOUND_EOC_0&lt;/tt&gt; and I&apos;ve updated the comment as you suggested. I appreciate your explanation and your test as the exact behavior wasn&apos;t 100% clear to me as well.&lt;/p&gt;

&lt;p&gt;I&apos;ve picked up your test in &lt;a href=&quot;https://github.com/stef1927/cassandra-dtest/commits/12423&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;this branch&lt;/a&gt; and I will create a pull request shortly after resolving this ticket.&lt;/p&gt;

&lt;p&gt;In terms of mixed-version clusters, I don&apos;t think we can risk deserialization exceptions and the second option is not ideal, plus it&apos;s risky to trust people to do the right thing. What we want is to ideally detect a rolling upgrade with other 3.0.x or 3.x hosts without the fix and disable this fix until the rolling upgrade is completed. If range tombstones with EOC=0 are uncommon amongst the majority of users, we could simply put the fix behind a flag and tell people who have EOC=0 range tombstones to enable the flag after the rolling upgrade is complete but before upgrading sstables. This would make it safer to deploy this in 3.0.x as well as 3.x. The price is inconvenience for the users affected, but given this is a thrift issue, I would expect those users to be experienced enough to cope, provided we document it well in NEWS.TXT. What do you think?&lt;/p&gt;</comment>
                            <comment id="15435201" author="thobbs" created="Wed, 24 Aug 2016 16:22:52 +0000"  >&lt;p&gt;I think the idea of a flag is good.  How about something like this: without the flag enabled, we treat eoc=0 bounds as &lt;tt&gt;EXCL_END_BOUND&lt;/tt&gt; (since that&apos;s the closest to the correct behavior) and log a warning that explains what&apos;s going on and mentions the flag.  The NEWS.txt entry could also suggest disabling autocompaction until the flag has been enabled to avoid permanently converting those bounds to something slightly incorrect.&lt;/p&gt;

&lt;p&gt;That&apos;s not an amazing solution, but I do agree that this case should be very rare in the real world.&lt;/p&gt;</comment>
                            <comment id="15436588" author="stefania" created="Thu, 25 Aug 2016 09:50:51 +0000"  >&lt;p&gt;Using &lt;tt&gt;EXCL_END_BOUND&lt;/tt&gt; breaks the existing thrift slice query tests because they expect an inclusive end bound with eoc=0, but I&apos;ve applied the same idea with &lt;tt&gt;INCL_END_BOUND&lt;/tt&gt; instead. See the &lt;a href=&quot;https://github.com/stef1927/cassandra/commit/50964cc8fcce94911ddc057f111445e5b95618dd&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;latest commit&lt;/a&gt;.  I&apos;ve also restarted the CI tests.&lt;/p&gt;

&lt;p&gt;Just to avoid confusion, this should be committed in both 3.0.x and 3.x, right?&lt;/p&gt;</comment>
                            <comment id="15437418" author="thobbs" created="Thu, 25 Aug 2016 18:33:52 +0000"  >&lt;blockquote&gt;&lt;p&gt;Just to avoid confusion, this should be committed in both 3.0.x and 3.x, right?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Yes.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;Using EXCL_END_BOUND breaks the existing thrift slice query tests because they expect an inclusive end bound with eoc=0, but I&apos;ve applied the same idea with INCL_END_BOUND instead&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Hmm, I think we may want to change the Thrift tests instead.  The reason that I prefer &lt;tt&gt;EXCL_END_BOUND&lt;/tt&gt; is that it can affect at most one cell, and that cell will be incorrectly left alive (which means it can be deleted later, if necessary).  In contrast, &lt;tt&gt;INCL_END_BOUND&lt;/tt&gt; can erroneously delete an unbounded number of cells, and there is no operator recourse for this.&lt;/p&gt;</comment>
                            <comment id="15438394" author="stefania" created="Fri, 26 Aug 2016 03:17:17 +0000"  >&lt;p&gt;I agree that &lt;tt&gt;INCL_END_BOUND&lt;/tt&gt; is much safer than &lt;tt&gt;EXCL_END_BOUND&lt;/tt&gt; but my problem was not so much the tests (they can be fixed by simply adding the flag) but that now Thrift users may end up with slice queries missing the final cell unless they enable the flag. &lt;/p&gt;

&lt;p&gt;Anyway, I think you are correct in that it is too dangerous to leave &lt;tt&gt;EXCL_END_BOUND&lt;/tt&gt; and so I&apos;ve amended the latest commit and tried to explain best I could in NEWS.txt. Repeating the links here for convenience:&lt;/p&gt;

&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;3.0&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;trunk&lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/stef1927/cassandra/commits/12423-3.0&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;patch&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/stef1927/cassandra/commits/12423&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;patch&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/stef1927/job/stef1927-12423-3.0-testall/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;testall&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/stef1927/job/stef1927-12423-testall/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;testall&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/stef1927/job/stef1927-12423-3.0-dtest/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;dtest&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/stef1927/job/stef1927-12423-dtest/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;dtest&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;


&lt;p&gt;CI pending.&lt;/p&gt;</comment>
                            <comment id="15445679" author="slebresne" created="Mon, 29 Aug 2016 12:10:58 +0000"  >&lt;p&gt;I&apos;m not sure about the solution of this patch. First, I&apos;m bothered with &quot;polluting&quot; the storage engine just for this; I fear we&apos;ll have to drag that on for a long time if we do so and that&apos;s annoying. Second, I think this imply really complex upgrade instructions and not a very good user experience.&lt;/p&gt;

&lt;p&gt;And I believe there is a simpler fix.&lt;/p&gt;

&lt;p&gt;The problem is when a end bound is composite, has only a prefix of all the components and the EOC is 0. In that case, it means the tombstone (or slice) goes up to the prefix, including it, but not further. In other words, anything with that prefix but other component is excluded. We can get that easily by making an exlusive end until the prefix &lt;b&gt;plus&lt;/b&gt; a empty component after it.&lt;/p&gt;

&lt;p&gt;To take an example, say I use the syntax &lt;tt&gt;&amp;lt;x&amp;gt;&amp;lt;y&amp;gt;[0]&lt;/tt&gt; to denote a 2 component composite with a 0 EOC. The end range tombstone of Tomasz above is &lt;tt&gt;&amp;lt;&apos;asd&apos;&amp;gt;[0]&lt;/tt&gt;, but it would be equivalent to use &lt;tt&gt;&amp;lt;&apos;asd&apos;&amp;gt;&amp;lt;&amp;gt;[-1]&lt;/tt&gt; instead (that is, adding an empty component as 2nd component instead of not having one at all, but excluding that exact &quot;full&quot; clustering). It&apos;s equivalent because &lt;tt&gt;&amp;lt;&apos;asd&apos;&amp;gt;&amp;lt;&amp;gt;&lt;/tt&gt; is the very next item ordering after &lt;tt&gt;&amp;lt;&apos;asd&apos;&amp;gt;&lt;/tt&gt;, and so going up until the latter one inclusive is the same than going up to the former exclusive.&lt;/p&gt;

&lt;p&gt;And we can easily represent that &lt;tt&gt;&amp;lt;&apos;asd&apos;&amp;gt;&amp;lt;&amp;gt;[-1]&lt;/tt&gt; composite in 3.0 (it just uses &lt;tt&gt;EXCL_END_BOUND&lt;/tt&gt;), so I think that&apos;s what we should return from &lt;tt&gt;LegacyLayout.decodeBound()&lt;/tt&gt; in that case.&lt;/p&gt;</comment>
                            <comment id="15448448" author="stefania" created="Tue, 30 Aug 2016 08:36:26 +0000"  >&lt;p&gt;This is awesome, I had no idea we could achieve the same behavior by adding an empty component and changing the bound type, thank you so much &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=slebresne&quot; class=&quot;user-hover&quot; rel=&quot;slebresne&quot;&gt;slebresne&lt;/a&gt;!&lt;/p&gt;

&lt;p&gt;Here is the new patch, CI still pending:&lt;/p&gt;

&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;3.0&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;trunk&lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/stef1927/cassandra/commits/12423-3.0-b&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;patch&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/stef1927/cassandra/commits/12423-b&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;patch&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/stef1927/job/stef1927-12423-3.0-b-testall/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;testall&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/stef1927/job/stef1927-12423-b-testall/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;testall&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/stef1927/job/stef1927-12423-3.0-b-dtest/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;dtest&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/stef1927/job/stef1927-12423-b-dtest/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;dtest&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;
</comment>
                            <comment id="15449539" author="thobbs" created="Tue, 30 Aug 2016 17:08:16 +0000"  >&lt;p&gt;Using an extra empty component is definitely a clever idea.  Nice job, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=slebresne&quot; class=&quot;user-hover&quot; rel=&quot;slebresne&quot;&gt;slebresne&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;It looks like the dtests are having some problems at the test-runner level, so I&apos;ve restarted both of them.&lt;/p&gt;</comment>
                            <comment id="15451011" author="stefania" created="Wed, 31 Aug 2016 03:59:32 +0000"  >&lt;p&gt;Thanks for restarting the dtests. &lt;/p&gt;

&lt;p&gt;There is one failing dtest for both branches, it is a new dtest that was added yesterday. It passed locally but only after rebasing. There is also a utest failing for 3.0, that too passes locally. The utest failing for trunk is instead a known issue that fails on unpatched trunk too.&lt;/p&gt;

&lt;p&gt;I&apos;ve relaunched both utests and dtests but only for 3.0.&lt;/p&gt;</comment>
                            <comment id="15451523" author="stefania" created="Wed, 31 Aug 2016 08:06:25 +0000"  >&lt;p&gt;CI for 3.0 completed with no failures, so from my analysis above CI on trunk should be fine as well, but I can relaunch it on trunk if there are concerns.&lt;/p&gt;</comment>
                            <comment id="15451634" author="slebresne" created="Wed, 31 Aug 2016 08:55:31 +0000"  >&lt;p&gt;The patch lgtm logic-wise, but the nit I&apos;d have is that this somewhat specialize the &lt;tt&gt;CompositeType.deconstruct()&lt;/tt&gt; method for this backward compatibility problem (granted it&apos;s only use in &lt;tt&gt;LegacyLayout&lt;/tt&gt;, but before this patch, the method somewhat made sense as a &lt;tt&gt;CompositeType&lt;/tt&gt; generic method. not so much anymore). So I&apos;d suggest moving the logic out of &lt;tt&gt;deconstruct()&lt;/tt&gt; (actually, we could fairly easily ditch &lt;tt&gt;deconstruct()&lt;/tt&gt; and &lt;tt&gt;CompositeComponent&lt;/tt&gt; altogether since you can achieve the same results using &lt;tt&gt;CompositeType.splitName&lt;/tt&gt; and &lt;tt&gt;CompositeType.lastEOC&lt;/tt&gt; easily, but I&apos;m fine not bothering with that).&lt;/p&gt;</comment>
                            <comment id="15454204" author="stefania" created="Thu, 1 Sep 2016 03:47:28 +0000"  >&lt;p&gt;I&apos;ve moved the logic of the patch to &lt;tt&gt;decodeBound&lt;/tt&gt; and removed &lt;tt&gt;CompositeComponent&lt;/tt&gt; in the &lt;a href=&quot;https://github.com/stef1927/cassandra/commits/12423-3.0-b&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;3.0 patch&lt;/a&gt;, see if it looks better now &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=slebresne&quot; class=&quot;user-hover&quot; rel=&quot;slebresne&quot;&gt;slebresne&lt;/a&gt;. &lt;/p&gt;

&lt;p&gt;I think we should also split out a new method to decode the bound kind, I did not do it yet because it makes comparing harder.&lt;/p&gt;</comment>
                            <comment id="15454222" author="stefania" created="Thu, 1 Sep 2016 03:56:27 +0000"  >&lt;p&gt;I&apos;ve created a dtest pull request &lt;a href=&quot;https://github.com/riptano/cassandra-dtest/pull/1297&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;here&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="15455359" author="slebresne" created="Thu, 1 Sep 2016 13:19:56 +0000"  >&lt;p&gt;The changes looks good, but the method feels a bit harder to read than it really should so I took the liberty to reorganize it a bit below (it&apos;s equivalent logic-wise though, hopefully at least).&lt;/p&gt;

&lt;p&gt;I&apos;m nitpicking the shit out of this though so let me know if you think that&apos;s more readable or not really and we&apos;ll just go with whatever you prefer.&lt;/p&gt;

&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;a href=&quot;https://github.com/pcmanus/cassandra/commits/12423-3.0&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;12423-3.0&lt;/a&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;a href=&quot;http://cassci.datastax.com/job/pcmanus-12423-3.0-testall&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;utests&lt;/a&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;a href=&quot;http://cassci.datastax.com/job/pcmanus-12423-3.0-dtest&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;dtests&lt;/a&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;
</comment>
                            <comment id="15457293" author="stefania" created="Fri, 2 Sep 2016 02:35:06 +0000"  >&lt;p&gt;As far as I could see it is equivalent indeed and I think it&apos;s easier to read like this. I merely removed &lt;tt&gt;prefixValues&lt;/tt&gt;, which was no longer required, and fixed a typo in my original comment. Rebased, squashed, and cherry-picked for trunk (with conflicts):&lt;/p&gt;

&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;3.0&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;trunk&lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/stef1927/cassandra/commits/12423-3.0-b&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;patch&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/stef1927/cassandra/commits/12423-b&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;patch&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/stef1927/job/stef1927-12423-3.0-b-testall/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;testall&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/stef1927/job/stef1927-12423-b-testall/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;testall&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/stef1927/job/stef1927-12423-3.0-b-dtest/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;dtest&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/stef1927/job/stef1927-12423-b-dtest/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;dtest&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;

</comment>
                            <comment id="15457807" author="slebresne" created="Fri, 2 Sep 2016 07:37:32 +0000"  >&lt;blockquote&gt;&lt;p&gt;. I merely removed &lt;tt&gt;prefixValues&lt;/tt&gt;, which was no longer required&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Sorry for forgetting that one.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;Rebased, squashed, and cherry-picked for trunk.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Thanks. With that, I&apos;m personally +1 on the patches as is once we have green CI. On that front, the dtests are still running but the 3.0 testall run has 3 weird failures. They pretty clearly seems unrelated to this issue but it could be nice re-running the job to make sure it&apos;s not a persistent problem with that branch.&lt;/p&gt;</comment>
                            <comment id="15457835" author="stefania" created="Fri, 2 Sep 2016 07:50:04 +0000"  >&lt;p&gt;Both dtest jobs were aborted (they timed out when collecting the artifacts) and so I restarted them about an hour ago.  I&apos;ve just restarted the utests for 3.0 as well.&lt;/p&gt;

&lt;p&gt;Thanks for the review and for improving the patch, I&apos;ll take care of committing once CI is green, or post another update in case of issues.&lt;/p&gt;</comment>
                            <comment id="15482685" author="stefania" created="Mon, 12 Sep 2016 00:58:09 +0000"  >&lt;p&gt;utests for 3.0 are OK now: 1 timeout and 1 known failure. dtest for 3.0 completed without failures but on trunk the build is still timing out on &lt;tt&gt;tar czvf jenkins-stef1927-12423-b-dtest-7_logs.tar.gz &amp;#45;&amp;#45;ignore-failed-read logs/ /mnt/tmp/dtest-&lt;b&gt;/&lt;/b&gt;/node*/logs&lt;/tt&gt;. I&apos;ve recreated the branch to pick up the latest fixes for the CI build and relaunched. &lt;/p&gt;</comment>
                            <comment id="15483567" author="stefania" created="Mon, 12 Sep 2016 09:03:14 +0000"  >&lt;p&gt;The latest run of dtests on trunk was good: the only failure was a cqlsh failure that occasionally occurs on the unpatched version of trunk as well.&lt;/p&gt;

&lt;p&gt;Committed to 3.0 as d600f51ee1a3eb7b30ce3c409129567b70c22012 and merged into trunk.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12998898">CASSANDRA-12516</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12823661" name="12423.tar.gz" size="38150" author="stefania" created="Mon, 15 Aug 2016 08:46:48 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[stefania]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 10 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i324p3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12311421" key="com.atlassian.jira.plugin.system.customfieldtypes:multiversion">
                        <customfieldname>Reproduced In</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="12335693">3.7</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>thobbs</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[thobbs]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12962"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>