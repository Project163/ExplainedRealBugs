<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 22:35:27 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-4675] NPE in NTS when using LQ against a node (DC) that doesn&apos;t have replica</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-4675</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;in a NetworkTopologyStrategy where there are 2 DC:&lt;/p&gt;

&lt;div class=&quot;panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;panelContent&quot;&gt;
&lt;p&gt;Address         DC          Rack        Status State   Load            Owns    Token                                       &lt;br/&gt;
                                                                               85070591730234615865843651857942052864      &lt;br/&gt;
127.0.0.1       dc1         r1          Up     Normal  115.78 KB       50.00%  0                                           &lt;br/&gt;
127.0.0.2       dc2         r1          Up     Normal  129.3 KB        50.00%  85070591730234615865843651857942052864  &lt;/p&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;I have a KS that has replica is 1 of the dc (dc1):&lt;/p&gt;

&lt;div class=&quot;panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;panelContent&quot;&gt;
&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;default@unknown&amp;#93;&lt;/span&gt; describe Keyspace3;                                                                                                                     &lt;br/&gt;
Keyspace: Keyspace3:&lt;br/&gt;
  Replication Strategy: org.apache.cassandra.locator.NetworkTopologyStrategy&lt;br/&gt;
  Durable Writes: true&lt;br/&gt;
    Options: &lt;span class=&quot;error&quot;&gt;&amp;#91;dc1:1&amp;#93;&lt;/span&gt;&lt;br/&gt;
  Column Families:&lt;br/&gt;
    ColumnFamily: testcf&lt;/p&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;But if I connect to a node in dc2, using LOCAL_QUORUM, I get NPE in the Cassandra node&apos;s log:&lt;/p&gt;

&lt;div class=&quot;panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;panelContent&quot;&gt;
&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;default@unknown&amp;#93;&lt;/span&gt; consistencylevel as LOCAL_QUORUM;                       &lt;br/&gt;
Consistency level is set to &apos;LOCAL_QUORUM&apos;.&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;default@unknown&amp;#93;&lt;/span&gt; use Keyspace3;                                          &lt;br/&gt;
Authenticated to keyspace: Keyspace3&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;default@Keyspace3&amp;#93;&lt;/span&gt; get testcf&lt;span class=&quot;error&quot;&gt;&amp;#91;utf8(&amp;#39;k1&amp;#39;)&amp;#93;&lt;/span&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;utf8(&amp;#39;c1&amp;#39;)&amp;#93;&lt;/span&gt;;                     &lt;br/&gt;
Internal error processing get&lt;br/&gt;
org.apache.thrift.TApplicationException: Internal error processing get&lt;br/&gt;
        at org.apache.thrift.TApplicationException.read(TApplicationException.java:108)&lt;br/&gt;
        at org.apache.cassandra.thrift.Cassandra$Client.recv_get(Cassandra.java:511)&lt;br/&gt;
        at org.apache.cassandra.thrift.Cassandra$Client.get(Cassandra.java:492)&lt;br/&gt;
        at org.apache.cassandra.cli.CliClient.executeGet(CliClient.java:648)&lt;br/&gt;
        at org.apache.cassandra.cli.CliClient.executeCLIStatement(CliClient.java:209)&lt;br/&gt;
        at org.apache.cassandra.cli.CliMain.processStatementInteractive(CliMain.java:220)&lt;br/&gt;
        at org.apache.cassandra.cli.CliMain.main(CliMain.java:348)&lt;/p&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;node2&apos;s log:&lt;/p&gt;
&lt;div class=&quot;panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;panelContent&quot;&gt;
&lt;p&gt;ERROR &lt;span class=&quot;error&quot;&gt;&amp;#91;Thrift:3&amp;#93;&lt;/span&gt; 2012-09-17 18:15:16,868 Cassandra.java (line 2999) Internal error processing get&lt;br/&gt;
java.lang.NullPointerException&lt;br/&gt;
        at org.apache.cassandra.locator.NetworkTopologyStrategy.getReplicationFactor(NetworkTopologyStrategy.java:142)&lt;br/&gt;
        at org.apache.cassandra.service.DatacenterReadCallback.determineBlockFor(DatacenterReadCallback.java:90)&lt;br/&gt;
        at org.apache.cassandra.service.ReadCallback.&amp;lt;init&amp;gt;(ReadCallback.java:67)&lt;br/&gt;
        at org.apache.cassandra.service.DatacenterReadCallback.&amp;lt;init&amp;gt;(DatacenterReadCallback.java:63)&lt;br/&gt;
        at org.apache.cassandra.service.StorageProxy.getReadCallback(StorageProxy.java:775)&lt;br/&gt;
        at org.apache.cassandra.service.StorageProxy.fetchRows(StorageProxy.java:609)&lt;br/&gt;
        at org.apache.cassandra.service.StorageProxy.read(StorageProxy.java:564)&lt;br/&gt;
        at org.apache.cassandra.thrift.CassandraServer.readColumnFamily(CassandraServer.java:128)&lt;br/&gt;
        at org.apache.cassandra.thrift.CassandraServer.internal_get(CassandraServer.java:383)&lt;br/&gt;
        at org.apache.cassandra.thrift.CassandraServer.get(CassandraServer.java:401)&lt;br/&gt;
        at org.apache.cassandra.thrift.Cassandra$Processor$get.process(Cassandra.java:2989)&lt;br/&gt;
        at org.apache.cassandra.thrift.Cassandra$Processor.process(Cassandra.java:2889)&lt;br/&gt;
        at org.apache.cassandra.thrift.CustomTThreadPoolServer$WorkerProcess.run(CustomTThreadPoolServer.java:187)&lt;br/&gt;
        at java.util.concurrent.ThreadPoolExecutor$Worker.runTask(ThreadPoolExecutor.java:886)&lt;br/&gt;
        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:908)&lt;/p&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I could workaround it by adding dc2:0 to the option:&lt;/p&gt;

&lt;div class=&quot;panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;panelContent&quot;&gt;
&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;default@Keyspace3&amp;#93;&lt;/span&gt; describe Keyspace3;                                           &lt;br/&gt;
Keyspace: Keyspace3:&lt;br/&gt;
  Replication Strategy: org.apache.cassandra.locator.NetworkTopologyStrategy&lt;br/&gt;
  Durable Writes: true&lt;br/&gt;
    Options: &lt;span class=&quot;error&quot;&gt;&amp;#91;dc2:0, dc1:1&amp;#93;&lt;/span&gt;&lt;br/&gt;
  Column Families:&lt;br/&gt;
    ColumnFamily: testcf&lt;/p&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Now you get UA:&lt;/p&gt;

&lt;div class=&quot;panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;panelContent&quot;&gt;
&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;default@Keyspace3&amp;#93;&lt;/span&gt; get testcf&lt;span class=&quot;error&quot;&gt;&amp;#91;utf8(&amp;#39;k1&amp;#39;)&amp;#93;&lt;/span&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;utf8(&amp;#39;c1&amp;#39;)&amp;#93;&lt;/span&gt;;                           &lt;br/&gt;
null&lt;br/&gt;
UnavailableException()&lt;br/&gt;
        at org.apache.cassandra.thrift.Cassandra$get_result.read(Cassandra.java:6506)&lt;br/&gt;
        at org.apache.cassandra.thrift.Cassandra$Client.recv_get(Cassandra.java:519)&lt;br/&gt;
        at org.apache.cassandra.thrift.Cassandra$Client.get(Cassandra.java:492)&lt;br/&gt;
        at org.apache.cassandra.cli.CliClient.executeGet(CliClient.java:648)&lt;br/&gt;
        at org.apache.cassandra.cli.CliClient.executeCLIStatement(CliClient.java:209)&lt;br/&gt;
        at org.apache.cassandra.cli.CliMain.processStatementInteractive(CliMain.java:220)&lt;br/&gt;
        at org.apache.cassandra.cli.CliMain.main(CliMain.java:348)&lt;/p&gt;
&lt;/div&gt;&lt;/div&gt;


&lt;p&gt;On a side note, is there a thought on having a CL.LOCAL_ONE? Ie if local node (wrt the dc) does not have replica, on a LOCAL_ONE, it won&apos;t try to go across DC to try to get it. It would be similar to LOCAL_QUORUM.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12607993">CASSANDRA-4675</key>
            <summary>NPE in NTS when using LQ against a node (DC) that doesn&apos;t have replica</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10003" iconUrl="https://issues.apache.org/jira/images/icons/priorities/trivial.svg">Low</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="jbellis">Jonathan Ellis</assignee>
                                    <reporter username="cywjackson">Jackson Chung</reporter>
                        <labels>
                    </labels>
                <created>Tue, 18 Sep 2012 01:23:46 +0000</created>
                <updated>Tue, 16 Apr 2019 09:32:27 +0000</updated>
                            <resolved>Thu, 27 Sep 2012 14:31:01 +0000</resolved>
                                        <fixVersion>1.1.6</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="13457883" author="jbellis" created="Tue, 18 Sep 2012 15:14:49 +0000"  >&lt;p&gt;Not sure what version this stacktrace is supposed to be against.  Doesn&apos;t appear to be against a recent 1.0 or 1.1.&lt;/p&gt;</comment>
                            <comment id="13458244" author="cywjackson" created="Tue, 18 Sep 2012 22:21:58 +0000"  >&lt;p&gt;1.0.10&lt;/p&gt;</comment>
                            <comment id="13464260" author="jbellis" created="Wed, 26 Sep 2012 22:47:52 +0000"  >&lt;p&gt;Following &quot;explicit is better than implicit&quot; convention, I was inclined to make it raise an InvalidRequestException instead of failing with NPE.  But the request isn&apos;t invalid; it&apos;s a configuration problem.&lt;/p&gt;

&lt;p&gt;After discussion on IRC, decided the best thing to do is just default undefined DC to zero replicas.  Patch attached to do that.&lt;/p&gt;</comment>
                            <comment id="13464292" author="brandon.williams" created="Wed, 26 Sep 2012 23:37:36 +0000"  >&lt;p&gt;+1&lt;/p&gt;</comment>
                            <comment id="13464775" author="jbellis" created="Thu, 27 Sep 2012 14:31:01 +0000"  >&lt;p&gt;committed&lt;/p&gt;</comment>
                            <comment id="13467247" author="cywjackson" created="Mon, 1 Oct 2012 22:12:57 +0000"  >&lt;p&gt;+1 thx&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12546768" name="4675.txt" size="660" author="jbellis" created="Wed, 26 Sep 2012 22:47:52 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[jbellis]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>256332</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            13 years, 8 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0gycn:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>96995</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>brandon.williams</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[brandon.williams]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12961"><![CDATA[Low]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>