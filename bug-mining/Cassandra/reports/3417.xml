<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 22:51:22 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-8544] Cassandra could not start with NPE in ColumnFamilyStore.removeUnfinishedCompactionLeftovers</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-8544</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;It happens sometimes after restarts caused by undeletable files under Windows.&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;Caused by: java.lang.NullPointerException&lt;br/&gt;
    at org.apache.cassandra.db.ColumnFamilyStore.removeUnfinishedCompactionLeftovers(ColumnFamilyStore.java:579)&lt;br/&gt;
    at org.apache.cassandra.service.CassandraDaemon.setup(CassandraDaemon.java:232)&lt;br/&gt;
    at org.apache.cassandra.service.CassandraDaemon.init(CassandraDaemon.java:377)&lt;br/&gt;
    at com.jetbrains.cassandra.service.CassandraServiceMain.start(CassandraServiceMain.java:81)&lt;br/&gt;
    ... 6 more&lt;/p&gt;&lt;/blockquote&gt;</description>
                <environment>&lt;p&gt;Windows&lt;/p&gt;</environment>
        <key id="12764043">CASSANDRA-8544</key>
            <summary>Cassandra could not start with NPE in ColumnFamilyStore.removeUnfinishedCompactionLeftovers</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10003" iconUrl="https://issues.apache.org/jira/images/icons/priorities/trivial.svg">Low</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="jmckenzie">Josh McKenzie</assignee>
                                    <reporter username="shalupov">Leonid Shalupov</reporter>
                        <labels>
                            <label>windows</label>
                    </labels>
                <created>Mon, 29 Dec 2014 16:29:27 +0000</created>
                <updated>Wed, 15 Oct 2025 09:49:07 +0000</updated>
                            <resolved>Mon, 9 Mar 2015 17:36:35 +0000</resolved>
                                        <fixVersion>2.1.5</fixVersion>
                                    <component>Local/Startup and Shutdown</component>
                        <due></due>
                            <votes>1</votes>
                                    <watches>6</watches>
                                                                                                                <comments>
                            <comment id="14261276" author="jmckenzie" created="Tue, 30 Dec 2014 17:32:20 +0000"  >&lt;p&gt;Some questions:&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;It happens sometimes after restarts caused by undeletable files under Windows.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;How frequently is &quot;sometimes&quot;?&lt;br/&gt;
What files are undeletable?&lt;br/&gt;
How are you resolving / working around this?  Does it work after another attempt to restart?&lt;br/&gt;
Do you have steps to reproduce this?&lt;/p&gt;

&lt;p&gt;Attaching a patch that should print out some more details on the NPE if you can reproduce it consistently.&lt;/p&gt;</comment>
                            <comment id="14264804" author="shalupov" created="Mon, 5 Jan 2015 17:35:00 +0000"  >&lt;p&gt;I&apos;ve seen it two times locally, one time it was reported by the customer of JetBrains Upsource.&lt;/p&gt;

&lt;p&gt;It always with compactions_in_progress files, see exception below:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;14:16:38.232 &lt;span class=&quot;error&quot;&gt;&amp;#91;MemtableFlushWriter:4&amp;#93;&lt;/span&gt; ERROR o.a.c.service.CassandraDaemon - Exception in thread Thread&lt;span class=&quot;error&quot;&gt;&amp;#91;MemtableFlushWriter:4,5,main&amp;#93;&lt;/span&gt;&lt;br/&gt;
org.apache.cassandra.io.FSWriteError: java.nio.file.FileSystemException: C:\Tools\Upsource\data\cassandra\data\system\compactions_in_progress-55080a&lt;br/&gt;
b05d9c388690a4acb25fe1f77b\system-compactions_in_progress-tmp-ka-13253-Statistics.db: Der Prozess kann nicht auf die Datei zugreifen, da sie von ein&lt;br/&gt;
em anderen Prozess verwendet wird.&lt;/p&gt;

&lt;p&gt;        at org.apache.cassandra.io.util.FileUtils.deleteWithConfirm(FileUtils.java:135) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;cassandra-all-2.1.1.jar:2.1.1&amp;#93;&lt;/span&gt;&lt;br/&gt;
        at org.apache.cassandra.io.util.FileUtils.deleteWithConfirm(FileUtils.java:121) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;cassandra-all-2.1.1.jar:2.1.1&amp;#93;&lt;/span&gt;&lt;br/&gt;
        at org.apache.cassandra.io.sstable.SSTable.delete(SSTable.java:113) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;cassandra-all-2.1.1.jar:2.1.1&amp;#93;&lt;/span&gt;&lt;br/&gt;
        at org.apache.cassandra.io.sstable.SSTableWriter.abort(SSTableWriter.java:355) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;cassandra-all-2.1.1.jar:2.1.1&amp;#93;&lt;/span&gt;&lt;br/&gt;
        at org.apache.cassandra.io.sstable.SSTableWriter.abort(SSTableWriter.java:333) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;cassandra-all-2.1.1.jar:2.1.1&amp;#93;&lt;/span&gt;&lt;br/&gt;
        at org.apache.cassandra.db.Memtable$FlushRunnable.writeSortedContents(Memtable.java:381) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;cassandra-all-2.1.1.jar:2.1.1&amp;#93;&lt;/span&gt;&lt;br/&gt;
        at org.apache.cassandra.db.Memtable$FlushRunnable.runWith(Memtable.java:312) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;cassandra-all-2.1.1.jar:2.1.1&amp;#93;&lt;/span&gt;&lt;br/&gt;
        at org.apache.cassandra.io.util.DiskAwareRunnable.runMayThrow(DiskAwareRunnable.java:48) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;cassandra-all-2.1.1.jar:2.1.1&amp;#93;&lt;/span&gt;&lt;br/&gt;
        at org.apache.cassandra.utils.WrappedRunnable.run(WrappedRunnable.java:28) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;cassandra-all-2.1.1.jar:2.1.1&amp;#93;&lt;/span&gt;&lt;br/&gt;
        at com.google.common.util.concurrent.MoreExecutors$SameThreadExecutorService.execute(MoreExecutors.java:297) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;guava-16.0.jar:na&amp;#93;&lt;/span&gt;&lt;br/&gt;
        at org.apache.cassandra.db.ColumnFamilyStore$Flush.run(ColumnFamilyStore.java:1053) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;cassandra-all-2.1.1.jar:2.1.1&amp;#93;&lt;/span&gt;&lt;br/&gt;
        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1145) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;na:1.7.0_71&amp;#93;&lt;/span&gt;&lt;br/&gt;
        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:615) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;na:1.7.0_71&amp;#93;&lt;/span&gt;&lt;br/&gt;
        at java.lang.Thread.run(Thread.java:745) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;na:1.7.0_71&amp;#93;&lt;/span&gt;&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;This particular exception seems to be fixed by turning off AV and Windows Search, but it&apos;s no good to fail on the next start.&lt;/p&gt;

&lt;p&gt;&amp;gt; How are you resolving / working around this? Does it work after another attempt to restart?&lt;br/&gt;
No workarounds attempted. It doesn&apos;t work after another restart.&lt;/p&gt;

&lt;p&gt;&amp;gt; Attaching a patch that should print out some more details on the NPE if you can reproduce it consistently.&lt;br/&gt;
Unfortunately I can&apos;t reproduce it consistently, so no luck here.&lt;/p&gt;</comment>
                            <comment id="14268175" author="jmckenzie" created="Wed, 7 Jan 2015 20:36:15 +0000"  >&lt;p&gt;If turning off AV and Windows Search consistently fixes this I consider this an external/environment problem and not a problem with our code-base w/regards to stopping.  Pre 3.0 (and w/memory-mapped I/O when we go back down that route), file sharing violations like this from outside programs are, by default, a problem we&apos;re going to stop the database for rather than allowing failed deletions to potentially fill a drive on a node.  If you&apos;d prefer to allow the system to continue you can reference the following: &lt;a href=&quot;http://www.datastax.com/documentation/cassandra/2.0/cassandra/configuration/configCassandra_yaml_r.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;one&lt;/a&gt; - &lt;a href=&quot;http://www.datastax.com/dev/blog/handling-disk-failures-in-cassandra-1-2&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;two&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;At the very least, you need to exclude your cassandra data and logs folder from AV scanning and also &lt;a href=&quot;http://windows.microsoft.com/en-us/windows/improve-windows-searches-using-index-faq#1TC=windows-7&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;remove it from indexing&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;Attaching a v1 that wraps the NPE and instead throws an FSReadError and points to log file for more information, since our original NPE error isn&apos;t terribly useful.&lt;/p&gt;</comment>
                            <comment id="14349999" author="iamaleksey" created="Fri, 6 Mar 2015 05:46:03 +0000"  >&lt;p&gt;+1&lt;/p&gt;</comment>
                            <comment id="14353243" author="jmckenzie" created="Mon, 9 Mar 2015 17:36:35 +0000"  >&lt;p&gt;Committed.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12769144">CASSANDRA-8665</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12689534" name="8544_show_npe.txt" size="926" author="joshuamckenzie" created="Tue, 30 Dec 2014 17:32:20 +0000"/>
                            <attachment id="12690608" name="8544_v1.txt" size="822" author="joshuamckenzie" created="Wed, 7 Jan 2015 20:36:15 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[jmckenzie]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 37 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i23tmf:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12311421" key="com.atlassian.jira.plugin.system.customfieldtypes:multiversion">
                        <customfieldname>Reproduced In</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="12326774">2.1.1</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>aleksey</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[aleksey]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12961"><![CDATA[Low]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>