<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 23:13:15 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-15019] Repaired data tracking isn&apos;t working for range queries</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-15019</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-14145&quot; title=&quot; Detecting data resurrection during read&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-14145&quot;&gt;&lt;del&gt;CASSANDRA-14145&lt;/del&gt;&lt;/a&gt; introduced optional tracking of the repaired dataset used to construct a read response. If enabled, each replica computes a digest for the repaired portion of the data, which the coordinator compares in order to detect divergence between replicas. This isn&apos;t working correctly for range reads, as the ReadCommand instance that the DataResolver is intialized with does not have the tracking flag set. This has been undetected up until now as the dtest which should verify it&#160;also has a bug in that when the relevant range query is issued the test expectations are being incorrectly set.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13215274">CASSANDRA-15019</key>
            <summary>Repaired data tracking isn&apos;t working for range queries</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10002" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Normal</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="samt">Sam Tunnicliffe</assignee>
                                    <reporter username="samt">Sam Tunnicliffe</reporter>
                        <labels>
                    </labels>
                <created>Tue, 12 Feb 2019 15:23:52 +0000</created>
                <updated>Fri, 15 May 2020 08:00:22 +0000</updated>
                            <resolved>Fri, 31 May 2019 17:15:12 +0000</resolved>
                                        <fixVersion>4.0-alpha1</fixVersion>
                    <fixVersion>4.0</fixVersion>
                                    <component>Consistency/Coordination</component>
                    <component>Consistency/Repair</component>
                    <component>Test/dtest/python</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="16766161" author="beobal" created="Tue, 12 Feb 2019 15:39:19 +0000"  >&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/beobal/cassandra/tree/15019-trunk&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;trunk&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/apache/cassandra-dtest/pull/43&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;dtest PR&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://circleci.com/workflow-run/8dec0886-5b8d-48e3-a4a9-c35723582aeb&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;CI (with patched dtest branch)&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;
</comment>
                            <comment id="16792936" author="jrwest" created="Thu, 14 Mar 2019 18:16:16 +0000"  >&lt;p&gt;This looks like the simplest patch to fix this but I wonder if we would be better served in the future by fixing the functions that copy &lt;tt&gt;ReadCommand&lt;/tt&gt;&#160;to correctly copy the tracking flag. The patch would be a bit bigger for sure (needing to modify each function and potentially the constructor) but it would be more likely &#160;prevent this mistake in the future and would clarify the disabling of the flag for transient replicas.&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;Happy to +1 it as is but wanted to toss that out there first.&#160;&lt;/p&gt;</comment>
                            <comment id="16793030" author="jrwest" created="Thu, 14 Mar 2019 20:09:38 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=beobal&quot; class=&quot;user-hover&quot; rel=&quot;beobal&quot;&gt;beobal&lt;/a&gt; also shouldn&apos;t&#160;&lt;a href=&quot;https://github.com/beobal/cassandra/commit/c92b9dea14e128f2063dca01526c3afcd5559d51#diff-71f06c193f5b5e270cf8ac695164f43aR2052&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;this&lt;/a&gt;&#160;call be to &lt;tt&gt;DatabaseDescriptor.getRepairedDataTrackingForRangeReadsEnabled&lt;/tt&gt;. Just noticing this now. It existed before the patch.&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;EDIT: I&apos;ve uploaded a test that illustrates the bug (uncomment line 51 to make the test pass but it shouldn&apos;t be necessary). The test also shows how we could convert the dtest to an in-jvm distributed test.&#160;&lt;/p&gt;</comment>
                            <comment id="16797165" author="beobal" created="Wed, 20 Mar 2019 13:28:42 +0000"  >&lt;p&gt;Thanks for the review and for adding the in-jvm dtest. I&apos;ve included that in the final patch along with checking the correct config setting and committed to trunk in &lt;tt&gt;99ce007c5beb7988ce83fb1443a1e0ca259264cc&lt;/tt&gt;&lt;/p&gt;

&lt;p&gt;Re: the copy methods &amp;amp; constructor. I agree that doing something more radical is probably justified now that transient replication has landed (it hadn&apos;t when the original patch was written). I believe though that the removal of the &lt;tt&gt;REPAIRED_DATA_TRACKING&lt;/tt&gt; header is imminent via another in-flight patch so I&apos;ve made a note to revisit this if/when that lands.&lt;/p&gt;</comment>
                            <comment id="16853229" author="jeromatron" created="Fri, 31 May 2019 17:15:12 +0000"  >&lt;p&gt;Re-resolving as fixed.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12962544" name="RepairDigestTrackingTest.java" size="6613" author="jwest" created="Thu, 14 Mar 2019 21:27:40 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[samt]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12313825" key="com.atlassian.jira.plugin.system.customfieldtypes:cascadingselect">
                        <customfieldname>Bug Category</customfieldname>
                        <customfieldvalues>
                                                    <customfieldvalue key="12982" cascade-level=""><![CDATA[Correctness]]></customfieldvalue>
                                <customfieldvalue key="12989" cascade-level="1"><![CDATA[Consistency]]></customfieldvalue>
            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            6 years, 24 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|yi0wio:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[jwest]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12962"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12311420" key="com.atlassian.jira.plugin.system.customfieldtypes:version">
                        <customfieldname>Since Version</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="12336842">4.0</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>