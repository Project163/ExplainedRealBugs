<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 22:41:30 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-6327] select with &quot;in&quot; clause wrongly returns empty result</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-6327</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;This query returns no result:&lt;/p&gt;

&lt;p&gt;cqlsh:tick_data&amp;gt; select syd from current_prices where shard = 1 and syd in (1, 556129);&lt;/p&gt;

&lt;p&gt;(0 rows)&lt;/p&gt;

&lt;p&gt;However this query does return a result, showing that the previous query was wrong to return no result:&lt;/p&gt;

&lt;p&gt;cqlsh:tick_data&amp;gt; select syd from current_prices where shard = 1 and syd in (556129);&lt;/p&gt;

&lt;p&gt; syd&lt;br/&gt;
--------&lt;br/&gt;
 556129&lt;/p&gt;

&lt;p&gt;(1 rows)&lt;/p&gt;

&lt;p&gt;This can be reproduced as follows:&lt;/p&gt;

&lt;p&gt;(a) Create a keyspace tick_data:&lt;/p&gt;

&lt;p&gt;create keyspace tick_data WITH replication = &lt;/p&gt;
{&apos;class&apos;: &apos;SimpleStrategy&apos;, &apos;replication_factor&apos;: 1}
&lt;p&gt;;&lt;/p&gt;

&lt;p&gt;(b) Create a table current_prices:&lt;/p&gt;

&lt;p&gt;CREATE TABLE current_prices (&lt;br/&gt;
  shard int,&lt;br/&gt;
  syd int,&lt;br/&gt;
  ask decimal,&lt;br/&gt;
  bid decimal,&lt;br/&gt;
  currency ascii,&lt;br/&gt;
  when timeuuid,&lt;br/&gt;
  PRIMARY KEY (shard, syd)&lt;br/&gt;
);&lt;/p&gt;

&lt;p&gt;(c) Stop Cassandra and untar the attached tar file in /var/lib/cassandra/data/tick_data/.  It populates the current_prices table.&lt;/p&gt;

&lt;p&gt;(d) Restart Cassandra and perform the above selects.&lt;/p&gt;</description>
                <environment>&lt;p&gt;Cassandra 2.0.2, x86-64 Ubuntu 13.10&lt;/p&gt;</environment>
        <key id="12678465">CASSANDRA-6327</key>
            <summary>select with &quot;in&quot; clause wrongly returns empty result</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10002" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Normal</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="slebresne">Sylvain Lebresne</assignee>
                                    <reporter username="baldrick">Duncan Sands</reporter>
                        <labels>
                    </labels>
                <created>Sun, 10 Nov 2013 17:42:39 +0000</created>
                <updated>Tue, 16 Apr 2019 09:32:00 +0000</updated>
                            <resolved>Thu, 14 Nov 2013 08:33:21 +0000</resolved>
                                        <fixVersion>2.0.3</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>6</watches>
                                                                                                                <comments>
                            <comment id="13818500" author="baldrick" created="Sun, 10 Nov 2013 17:44:01 +0000"  >&lt;p&gt;Untar this file to populate the current_prices table.&lt;/p&gt;</comment>
                            <comment id="13819958" author="slebresne" created="Tue, 12 Nov 2013 09:38:15 +0000"  >&lt;p&gt;This is a bug in the column slice intersection logic from &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-5514&quot; title=&quot;Track min/max clustered values per sstable to optimize reads&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-5514&quot;&gt;&lt;del&gt;CASSANDRA-5514&lt;/del&gt;&lt;/a&gt;. More precisely, when there was multiple column slices, the logic was returning no intersection as soon as one of the slice was not intersecting, but it should do the exact reverse, it should consider it an intersection as one as any of the slice intersect but wait to have test all slices before saying it doesn&apos;t intersect.&lt;/p&gt;

&lt;p&gt;Attaching simple patch to fix.&lt;/p&gt;</comment>
                            <comment id="13819959" author="slebresne" created="Tue, 12 Nov 2013 09:38:49 +0000"  >&lt;p&gt;PS: I&apos;ve pushed a dtests for this.&lt;/p&gt;</comment>
                            <comment id="13820143" author="iamaleksey" created="Tue, 12 Nov 2013 14:49:21 +0000"  >&lt;p&gt;+1&lt;/p&gt;</comment>
                            <comment id="13820305" author="slebresne" created="Tue, 12 Nov 2013 18:23:43 +0000"  >&lt;p&gt;Committed, thanks&lt;/p&gt;</comment>
                            <comment id="13821805" author="krummas" created="Wed, 13 Nov 2013 20:40:24 +0000"  >&lt;p&gt;the fix broke KeyspaceTest#testLimitSSTablesComposites&lt;/p&gt;

&lt;p&gt;this patch tests all slices, but keeps old intersection logic - all components of the composite need to intersect&lt;/p&gt;</comment>
                            <comment id="13821837" author="mshuler" created="Wed, 13 Nov 2013 21:08:18 +0000"  >&lt;p&gt;0001-check-if-any-of-the-slices-intersects.patch fixes KeyspaceTest for me on current cassandra-2.0 branch (1d3a4dd).  This is the only test I have run, at the moment &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;    &lt;span class=&quot;error&quot;&gt;&amp;#91;junit&amp;#93;&lt;/span&gt; Testsuite: org.apache.cassandra.db.KeyspaceTest&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;junit&amp;#93;&lt;/span&gt; Tests run: 12, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 23.567 sec&lt;/p&gt;</comment>
                            <comment id="13821856" author="iamaleksey" created="Wed, 13 Nov 2013 21:23:18 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=krummas&quot; class=&quot;user-hover&quot; rel=&quot;krummas&quot;&gt;krummas&lt;/a&gt; Oh. Right. Makes sense.Go ahead.&lt;/p&gt;</comment>
                            <comment id="13822249" author="slebresne" created="Thu, 14 Nov 2013 08:33:15 +0000"  >&lt;p&gt;Correct (more precisely the new version is correct in term of behavior but not as efficient as can be in terms of avoiding sstables).&lt;br/&gt;
Committed a slight variation of Markus fixup: there is no need to continue testing a given slice when we know it doesn&apos;t intersect.&lt;/p&gt;</comment>
                            <comment id="13831886" author="cowardlydragon" created="Mon, 25 Nov 2013 20:38:29 +0000"  >&lt;p&gt;Does this fix &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-6137&quot; title=&quot;CQL3 SELECT IN CLAUSE inconsistent&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-6137&quot;&gt;&lt;del&gt;CASSANDRA-6137&lt;/del&gt;&lt;/a&gt;?&lt;/p&gt;

&lt;p&gt;Nevermind, you put in a comment saying it probably was... &lt;/p&gt;

&lt;p&gt;I have an audit job looking for this, so if we see it come up, we&apos;ll let you know once we move prod to 2.0.3&lt;/p&gt;

&lt;p&gt;Any idea why compaction run right after schema creation seemed to fix this?&lt;/p&gt;</comment>
                            <comment id="13831890" author="krummas" created="Mon, 25 Nov 2013 20:45:42 +0000"  >&lt;p&gt;there is logic in 2.0 to be able to skip sstables on the read path, a (major) compaction means there is only one sstable, and it wont be skipped since atleast one of slices will intersect it&lt;/p&gt;</comment>
                            <comment id="14025107" author="recastrodiaz" created="Mon, 9 Jun 2014 13:06:21 +0000"  >&lt;p&gt;I noticed this bug on Cassandra version 1.X. Then we upgraded to 2.0.3 which solved this issue. It seems, however, to have come back in version 2.0.7.&lt;br/&gt;
Should I open a new issue?&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12613679" name="0001-check-if-any-of-the-slices-intersects.patch" size="1838" author="marcuse" created="Wed, 13 Nov 2013 20:40:24 +0000"/>
                            <attachment id="12613348" name="6327.txt" size="1333" author="slebresne" created="Tue, 12 Nov 2013 09:38:15 +0000"/>
                            <attachment id="12613056" name="current_prices.tar" size="133120" author="baldrick" created="Sun, 10 Nov 2013 17:44:01 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[slebresne]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>357840</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            11 years, 24 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1porj:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>358130</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>aleksey</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[aleksey]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12962"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12311420" key="com.atlassian.jira.plugin.system.customfieldtypes:version">
                        <customfieldname>Since Version</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="12324629">2.0.0</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>