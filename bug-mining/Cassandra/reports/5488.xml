<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 23:17:06 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-15965] Fix flaky test StreamingInboundHandlerTest channelRead_Normal</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-15965</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;channelRead_Normal - org.apache.cassandra.streaming.async.StreamingInboundHandlerTest&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
junit.framework.AssertionFailedError: expected:&amp;lt;8&amp;gt; but was:&amp;lt;0&amp;gt;
	at org.apache.cassandra.streaming.async.StreamingInboundHandlerTest.channelRead_Normal(StreamingInboundHandlerTest.java:98)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Failed build: &lt;a href=&quot;https://app.circleci.com/pipelines/github/dcapwell/cassandra/298/workflows/e3296f33-2289-401c-8fc8-a7f786e3692a/jobs/1445&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://app.circleci.com/pipelines/github/dcapwell/cassandra/298/workflows/e3296f33-2289-401c-8fc8-a7f786e3692a/jobs/1445&lt;/a&gt;&lt;/p&gt;</description>
                <environment></environment>
        <key id="13318551">CASSANDRA-15965</key>
            <summary>Fix flaky test StreamingInboundHandlerTest channelRead_Normal</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10002" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Normal</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="aholmber">Adam Holmberg</assignee>
                                    <reporter username="dcapwell">David Capwell</reporter>
                        <labels>
                    </labels>
                <created>Tue, 21 Jul 2020 19:28:06 +0000</created>
                <updated>Sun, 3 Jan 2021 17:03:40 +0000</updated>
                            <resolved>Wed, 16 Sep 2020 21:35:21 +0000</resolved>
                                        <fixVersion>4.0-beta3</fixVersion>
                    <fixVersion>4.0</fixVersion>
                                    <component>Test/unit</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="17168000" author="brandon.williams" created="Thu, 30 Jul 2020 15:20:02 +0000"  >&lt;p&gt;I was able to reproduce this in only 59 runs the first time, but after adding some debug logging in AsyncStreamingInputPlus.unsafeAvailable, I&apos;m unable to repro in thousands of runs. There is clearly some kind of timing issue here, but I&apos;m not familiar enough with Netty to know exactly where.&lt;/p&gt;</comment>
                            <comment id="17196569" author="aholmber" created="Tue, 15 Sep 2020 21:44:36 +0000"  >&lt;p&gt;&lt;a href=&quot;https://github.com/apache/cassandra/blob/07f8db31ae10a3883c06194642354feb711e361c/test/unit/org/apache/cassandra/streaming/async/StreamingInboundHandlerTest.java#L98&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;This&lt;/a&gt; &quot;unsafe&quot; assertion is racing with &lt;a href=&quot;https://github.com/apache/cassandra/blob/07f8db31ae10a3883c06194642354feb711e361c/src/java/org/apache/cassandra/streaming/async/StreamingInboundHandler.java#L164-L172&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;this&lt;/a&gt; background read.&lt;/p&gt;

&lt;p&gt;My recommendation is to remove the test. It&apos;s testing so very little (we can queue a message), and so fundamental &amp;#8211; I believe we have quite a bit of coverage for this elsewhere.&lt;/p&gt;

&lt;p&gt;While looking at this I discovered a possible NPE in StreamMessage type lookups. The lookup table had a null value in the zero index. I&apos;m including a potential fix for that.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/apache/cassandra/compare/trunk...aholmberg:CASSANDRA-15965&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;Patch&lt;/a&gt;&lt;br/&gt;
&lt;a href=&quot;https://app.circleci.com/pipelines/github/aholmberg/cassandra?branch=CASSANDRA-15965&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;ci&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17197027" author="brandon.williams" created="Wed, 16 Sep 2020 14:56:12 +0000"  >&lt;p&gt;I&apos;m fine with removing the test,  but for the NPE can we add one?&lt;/p&gt;</comment>
                            <comment id="17197085" author="aholmber" created="Wed, 16 Sep 2020 16:19:48 +0000"  >&lt;p&gt;Yes. And frankly I&apos;m embarrassed the first PR didn&apos;t include one. I think I had it in my head that I was just tidying existing functionality. I&apos;ll update today.&lt;/p&gt;</comment>
                            <comment id="17197139" author="aholmber" created="Wed, 16 Sep 2020 17:38:59 +0000"  >&lt;p&gt;&lt;a href=&quot;https://github.com/aholmberg/cassandra/commit/4fa6db0277eee6a28b38ab61d2ac23e55756a018&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;added&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Presently trying to figure out why circleci won&apos;t create a workflow for this commit.&lt;/p&gt;</comment>
                            <comment id="17197141" author="brandon.williams" created="Wed, 16 Sep 2020 17:43:40 +0000"  >&lt;p&gt;&lt;a href=&quot;https://ci-cassandra.apache.org/job/Cassandra-devbranch/22/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;CI&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17197158" author="yifanc" created="Wed, 16 Sep 2020 17:59:59 +0000"  >&lt;p&gt;If it is a timing issue in&#160;the &lt;tt&gt;channelRead_Normal&lt;/tt&gt; test,&#160;&lt;tt&gt;Util#spinAssertEquals&lt;/tt&gt; could be an alternative, and&#160;the test can be kept.&#160;&lt;/p&gt;

&lt;p&gt;Do we want to open a new ticket for fixing the NPE? A bit of trouble, but the new ticket can better describe the goal of the patch. This one just reports a flaky test.&#160;&lt;/p&gt;</comment>
                            <comment id="17197165" author="aholmber" created="Wed, 16 Sep 2020 18:13:22 +0000"  >&lt;p&gt;&amp;gt; Util#spinAssertEquals could be an alternative, and the test can be kept. &lt;br/&gt;
It&apos;s not a matter of the test thread getting there too early &amp;#8211; it gets there too late and the condition will never be true. By then the buffer has been read.&lt;/p&gt;

&lt;p&gt;&amp;gt;Do we want to open a new ticket for fixing the NPE?&lt;br/&gt;
In the past we&apos;ve included production code changes in the flaky test ticket that discovered them. I will open a new ticket if that&apos;s needed. lmk. &lt;/p&gt;</comment>
                            <comment id="17197170" author="brandon.williams" created="Wed, 16 Sep 2020 18:16:59 +0000"  >&lt;p&gt;I don&apos;t have much preference on new ticket or not; we don&apos;t mention test fixes in the changelog, but I&apos;ll appropriately put an entry about the NPE fix and we can even rename the ticket.&#160; Or just make another one, whichever.&lt;/p&gt;</comment>
                            <comment id="17197188" author="yifanc" created="Wed, 16 Sep 2020 18:46:46 +0000"  >&lt;blockquote&gt;&lt;p&gt;it gets there too late and the condition will never be true.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Thanks for the clarification. Yeah. Spin assert won&apos;t help in this case. &lt;/p&gt;


&lt;p&gt;The fix will go into the change log. So either change both the ticket title and description (which seems messy), or just create a new ticket and link to this one, so the context is not lost. &lt;/p&gt;</comment>
                            <comment id="17197246" author="brandon.williams" created="Wed, 16 Sep 2020 21:35:21 +0000"  >&lt;p&gt;Committed the test removal.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="13327923">CASSANDRA-16131</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[aholmber]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12313825" key="com.atlassian.jira.plugin.system.customfieldtypes:cascadingselect">
                        <customfieldname>Bug Category</customfieldname>
                        <customfieldvalues>
                                                    <customfieldvalue key="12982" cascade-level=""><![CDATA[Correctness]]></customfieldvalue>
                                <customfieldvalue key="12990" cascade-level="1"><![CDATA[Test Failure]]></customfieldvalue>
            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12313821" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Complexity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12965"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313822" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Discovered By</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12970"><![CDATA[Unit Test]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12313922" key="jira.plugin.projectspecificselectfield.jpssf:multicftype">
                        <customfieldname>Impacts</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="13100"><![CDATA[None]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            5 years, 8 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12313921" key="jira.plugin.projectspecificselectfield.jpssf:multicftype">
                        <customfieldname>Platform</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="13076"><![CDATA[All]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0h294:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[brandon.williams]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12962"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12311420" key="com.atlassian.jira.plugin.system.customfieldtypes:version">
                        <customfieldname>Since Version</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="12333891">3.0.0</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313924" key="com.atlassian.jira.plugin.system.customfieldtypes:textfield">
                        <customfieldname>Source Control Link</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>&lt;p&gt;&lt;a href=&quot;https://github.com/apache/cassandra/commit/68aca1064be12697e5ff7f56b50e6808f5d5d020&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/cassandra/commit/68aca1064be12697e5ff7f56b50e6808f5d5d020&lt;/a&gt;&lt;/p&gt;</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313823" key="com.atlassian.jira.plugin.system.customfieldtypes:textarea">
                        <customfieldname>Test and Documentation Plan</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>&lt;p&gt;Flaky test is removed.&lt;/p&gt;</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>