<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 22:22:12 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-2960] replication_factor &gt; 1 always causes cassandra to return null</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-2960</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;On a brand new cluster:&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;default@SimpleTest&amp;#93;&lt;/span&gt; create keyspace SimpleTest2 with strategy_options = [&lt;/p&gt;
{replication_factor:3}
&lt;p&gt;];              &lt;br/&gt;
16babc60-b886-11e0-0000-c9ff69cb2dfb&lt;br/&gt;
Waiting for schema agreement...&lt;br/&gt;
... schemas agree across the cluster&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;default@SimpleTest&amp;#93;&lt;/span&gt; use SimpleTest2;&lt;br/&gt;
Authenticated to keyspace: SimpleTest2&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;default@SimpleTest2&amp;#93;&lt;/span&gt; create column family CFTest with comparator=UTF8Type and default_validation_class=UTF8Type;&lt;br/&gt;
1f108660-b886-11e0-0000-c9ff69cb2dfb&lt;br/&gt;
Waiting for schema agreement...&lt;br/&gt;
... schemas agree across the cluster&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;default@SimpleTest2&amp;#93;&lt;/span&gt; set CFTest&lt;span class=&quot;error&quot;&gt;&amp;#91;&amp;#39;1&amp;#39;&amp;#93;&lt;/span&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;&amp;#39;text&amp;#39;&amp;#93;&lt;/span&gt; = &apos;test&apos;;&lt;br/&gt;
null&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;default@SimpleTest2&amp;#93;&lt;/span&gt; get CFTest&lt;span class=&quot;error&quot;&gt;&amp;#91;&amp;#39;1&amp;#39;&amp;#93;&lt;/span&gt;;&lt;br/&gt;
null&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;default@SimpleTest2&amp;#93;&lt;/span&gt; list CFTest;&lt;br/&gt;
Using default limit of 100&lt;br/&gt;
null&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;default@SimpleTest2&amp;#93;&lt;/span&gt; describe cluster;&lt;br/&gt;
Cluster Information:&lt;br/&gt;
   Snitch: org.apache.cassandra.locator.SimpleSnitch&lt;br/&gt;
   Partitioner: org.apache.cassandra.dht.RandomPartitioner&lt;br/&gt;
   Schema versions: &lt;br/&gt;
	1f108660-b886-11e0-0000-c9ff69cb2dfb: &lt;span class=&quot;error&quot;&gt;&amp;#91;10.60.98.20, 10.60.98.24, 10.60.98.26&amp;#93;&lt;/span&gt;&lt;/p&gt;</description>
                <environment>&lt;p&gt;Ubuntu 11.04&lt;/p&gt;</environment>
        <key id="12515563">CASSANDRA-2960</key>
            <summary>replication_factor &gt; 1 always causes cassandra to return null</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10003" iconUrl="https://issues.apache.org/jira/images/icons/priorities/trivial.svg">Low</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="jbellis">Jonathan Ellis</assignee>
                                    <reporter username="stevecorona">Steve Corona</reporter>
                        <labels>
                    </labels>
                <created>Wed, 27 Jul 2011 19:37:18 +0000</created>
                <updated>Tue, 16 Apr 2019 09:32:54 +0000</updated>
                            <resolved>Mon, 1 Aug 2011 18:42:21 +0000</resolved>
                                        <fixVersion>0.8.3</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                                                                <comments>
                            <comment id="13071940" author="stevecorona" created="Wed, 27 Jul 2011 19:38:11 +0000"  >&lt;p&gt;No errors are being reported in the logs and all nodes are up w/ the same schema version.&lt;/p&gt;</comment>
                            <comment id="13071952" author="jbellis" created="Wed, 27 Jul 2011 19:58:44 +0000"  >&lt;p&gt;i assume you do actually have &amp;gt;= 3 nodes?&lt;/p&gt;

&lt;p&gt;what is the full exception from the cli when you run it with --debug?&lt;/p&gt;</comment>
                            <comment id="13071959" author="stevecorona" created="Wed, 27 Jul 2011 20:03:16 +0000"  >&lt;p&gt;Yes, running with 3 nodes. Same exact thing happens if I set replication_factor to 2 nodes. replication_factor=1 works as expected, however.&lt;/p&gt;

&lt;p&gt;Here is the exception:&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;default@SimpleTest2&amp;#93;&lt;/span&gt; get CFTest&lt;span class=&quot;error&quot;&gt;&amp;#91;&amp;#39;1&amp;#39;&amp;#93;&lt;/span&gt;;&lt;br/&gt;
null&lt;br/&gt;
java.lang.RuntimeException&lt;br/&gt;
	at org.apache.cassandra.cli.CliClient.executeCLIStatement(CliClient.java:302)&lt;br/&gt;
	at org.apache.cassandra.cli.CliMain.processStatement(CliMain.java:217)&lt;br/&gt;
	at org.apache.cassandra.cli.CliMain.main(CliMain.java:345)&lt;br/&gt;
Caused by: UnavailableException()&lt;br/&gt;
	at org.apache.cassandra.thrift.Cassandra$get_slice_result.read(Cassandra.java:7652)&lt;br/&gt;
	at org.apache.cassandra.thrift.Cassandra$Client.recv_get_slice(Cassandra.java:570)&lt;br/&gt;
	at org.apache.cassandra.thrift.Cassandra$Client.get_slice(Cassandra.java:542)&lt;br/&gt;
	at org.apache.cassandra.cli.CliClient.doSlice(CliClient.java:468)&lt;br/&gt;
	at org.apache.cassandra.cli.CliClient.executeGet(CliClient.java:603)&lt;br/&gt;
	at org.apache.cassandra.cli.CliClient.executeCLIStatement(CliClient.java:200)&lt;br/&gt;
	... 2 more&lt;/p&gt;</comment>
                            <comment id="13071962" author="jbellis" created="Wed, 27 Jul 2011 20:06:25 +0000"  >&lt;p&gt;do all the nodes&apos; &quot;nodetool ring&quot; show everyone up?&lt;/p&gt;

&lt;p&gt;what does the server log at debug level?  (should include which hosts it thinks are unavailable)&lt;/p&gt;</comment>
                            <comment id="13071967" author="stevecorona" created="Wed, 27 Jul 2011 20:11:30 +0000"  >&lt;p&gt;root@cassandra01:~# nodetool ring -h 10.60.98.26&lt;br/&gt;
Address         DC          Rack        Status State   Load            Owns    Token                                       &lt;br/&gt;
                                                                               113427455640312814857969558651062452224     &lt;br/&gt;
10.60.98.26     datacenter1 rack1       Up     Normal  59.21 KB        33.33%  0                                           &lt;br/&gt;
10.60.98.24     datacenter1 rack1       Up     Normal  67.87 KB        33.33%  56713727820156407428984779325531226112      &lt;br/&gt;
10.60.98.20     datacenter1 rack1       Up     Normal  67.87 KB        33.33%  113427455640312814857969558651062452224&lt;/p&gt;

&lt;p&gt;Will turn on debug server logs now and follow up. &lt;/p&gt;</comment>
                            <comment id="13071979" author="stevecorona" created="Wed, 27 Jul 2011 20:30:39 +0000"  >&lt;p&gt;Okay- this is what I am seeing:&lt;/p&gt;

&lt;p&gt;When I do a read:&lt;/p&gt;

&lt;p&gt;==&amp;gt; system.log &amp;lt;==&lt;br/&gt;
DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;pool-2-thread-11&amp;#93;&lt;/span&gt; 2011-07-27 15:26:28,641 CassandraServer.java (line 303) get_slice&lt;/p&gt;

&lt;p&gt;==&amp;gt; output.log &amp;lt;==&lt;br/&gt;
DEBUG 15:26:28,646 Command/ConsistencyLevel is SliceFromReadCommand(table=&apos;SimpleTest2&apos;, key=&apos;01&apos;, column_parent=&apos;QueryPath(columnFamilyName=&apos;CFTest&apos;, superColumnName=&apos;null&apos;, columnName=&apos;null&apos;)&apos;, start=&apos;&apos;, finish=&apos;&apos;, reversed=false, count=1000000)/ONE&lt;/p&gt;

&lt;p&gt;==&amp;gt; system.log &amp;lt;==&lt;br/&gt;
DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;pool-2-thread-11&amp;#93;&lt;/span&gt; 2011-07-27 15:26:28,646 StorageProxy.java (line 509) Command/ConsistencyLevel is SliceFromReadCommand(table=&apos;SimpleTest2&apos;, key=&apos;01&apos;, column_parent=&apos;QueryPath(columnFamilyName=&apos;CFTest&apos;, superColumnName=&apos;null&apos;, columnName=&apos;null&apos;)&apos;, start=&apos;&apos;, finish=&apos;&apos;, reversed=false, count=1000000)/ONE&lt;/p&gt;

&lt;p&gt;==&amp;gt; output.log &amp;lt;==&lt;br/&gt;
DEBUG 15:26:28,650 Blockfor/repair is 1/true; setting up requests to &lt;/p&gt;

&lt;p&gt;==&amp;gt; system.log &amp;lt;==&lt;br/&gt;
DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;pool-2-thread-11&amp;#93;&lt;/span&gt; 2011-07-27 15:26:28,650 ReadCallback.java (line 84) Blockfor/repair is 1/true; setting up requests to &lt;/p&gt;

&lt;p&gt;==&amp;gt; output.log &amp;lt;==&lt;br/&gt;
DEBUG 15:26:28,650 Live nodes  do not satisfy ConsistencyLevel (1 required)&lt;/p&gt;

&lt;p&gt;==&amp;gt; system.log &amp;lt;==&lt;br/&gt;
DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;pool-2-thread-11&amp;#93;&lt;/span&gt; 2011-07-27 15:26:28,650 ReadCallback.java (line 211) Live nodes  do not satisfy ConsistencyLevel (1 required)&lt;/p&gt;</comment>
                            <comment id="13071995" author="jbellis" created="Wed, 27 Jul 2011 20:44:45 +0000"  >&lt;p&gt;Is it possible it defaulted to NTS?&lt;/p&gt;</comment>
                            <comment id="13072013" author="stevecorona" created="Wed, 27 Jul 2011 21:12:50 +0000"  >&lt;p&gt;Bingo, that&apos;s it- looks like on creating a new keyspace with replication_factor it&apos;s defaulting to NTS.&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;default@unknown&amp;#93;&lt;/span&gt; create keyspace SimpleTest12 with strategy_options = [&lt;/p&gt;
{&apos;replication_factor&apos;:&apos;2&apos;}
&lt;p&gt;];&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;default@SimpleTest12&amp;#93;&lt;/span&gt; describe keyspace;&lt;br/&gt;
Keyspace: SimpleTest12:&lt;br/&gt;
  Replication Strategy: org.apache.cassandra.locator.NetworkTopologyStrategy&lt;/p&gt;</comment>
                            <comment id="13072075" author="jbellis" created="Wed, 27 Jul 2011 22:39:40 +0000"  >&lt;p&gt;ah, so then it&apos;s treating your options as &quot;I want 2 replicas in datacenter &apos;replication_factor&apos;&quot; but all your nodes are in &apos;datacenter1&apos;.&lt;/p&gt;

&lt;p&gt;I thought we had logic to disallow naming a dc that to prevent this confusion but apparently not.  I&apos;ll look into that.&lt;/p&gt;</comment>
                            <comment id="13073313" author="jbellis" created="Sun, 31 Jul 2011 03:57:28 +0000"  >&lt;p&gt;patch to raise an exception instead of ignoring replication_factor option in NTS.&lt;/p&gt;</comment>
                            <comment id="13073622" author="slebresne" created="Mon, 1 Aug 2011 17:36:18 +0000"  >&lt;p&gt;+1&lt;/p&gt;</comment>
                            <comment id="13073654" author="jbellis" created="Mon, 1 Aug 2011 18:42:21 +0000"  >&lt;p&gt;committed&lt;/p&gt;</comment>
                            <comment id="13073672" author="hudson" created="Mon, 1 Aug 2011 19:14:54 +0000"  >&lt;p&gt;Integrated in Cassandra-0.8 #250 (See &lt;a href=&quot;https://builds.apache.org/job/Cassandra-0.8/250/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/Cassandra-0.8/250/&lt;/a&gt;)&lt;br/&gt;
    throw exception when NTS is given replication_factoras an option&lt;br/&gt;
patch by jbellis; reviewed by slebresne for &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-2960&quot; title=&quot;replication_factor &amp;gt; 1 always causes cassandra to return null&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-2960&quot;&gt;&lt;del&gt;CASSANDRA-2960&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;jbellis : &lt;a href=&quot;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1152890&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1152890&lt;/a&gt;&lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/cassandra/branches/cassandra-0.8/CHANGES.txt&lt;/li&gt;
	&lt;li&gt;/cassandra/branches/cassandra-0.8/src/java/org/apache/cassandra/locator/NetworkTopologyStrategy.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13159159" author="guizhang" created="Tue, 29 Nov 2011 08:49:42 +0000"  >&lt;p&gt;we are running 0.84, looks still have this problem.&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;default@unknown&amp;#93;&lt;/span&gt; create keyspace Gui3;&lt;br/&gt;
9deaddb0-1a4b-11e1-0000-21e4216050ff&lt;br/&gt;
Waiting for schema agreement...&lt;br/&gt;
... schemas agree across the cluster&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;default@unknown&amp;#93;&lt;/span&gt; use Gui3;                      &lt;br/&gt;
Authenticated to keyspace: Gui3&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;default@Gui3&amp;#93;&lt;/span&gt; create column family gui_test3;&lt;br/&gt;
a997c1f0-1a4b-11e1-0000-21e4216050ff&lt;br/&gt;
Waiting for schema agreement...&lt;br/&gt;
... schemas agree across the cluster&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;default@Gui3&amp;#93;&lt;/span&gt; set gui_test3&lt;span class=&quot;error&quot;&gt;&amp;#91;&amp;#39;jsmith&amp;#39;&amp;#93;&lt;/span&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;&amp;#39;first&amp;#39;&amp;#93;&lt;/span&gt; = &apos;John&apos;;&lt;br/&gt;
Null&lt;/p&gt;

&lt;p&gt;if we use below script&lt;br/&gt;
 create keyspace Gui2 with placement_strategy = &apos;org.apache.cassandra.locator.SimpleStrategy&apos; and strategy_options = [&lt;/p&gt;
{replication_factor:3}
&lt;p&gt;];&lt;br/&gt;
it works fine.&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;guzhang@slcdbx5001-01 bin&amp;#93;&lt;/span&gt;$ /opt/cassandra/bin/nodetool -host localhost version&lt;br/&gt;
ReleaseVersion: 0.8.4&lt;/p&gt;</comment>
                            <comment id="13159280" author="jbellis" created="Tue, 29 Nov 2011 14:14:06 +0000"  >&lt;p&gt;&quot;on creating a new keyspace ... it&apos;s defaulting to &lt;span class=&quot;error&quot;&gt;&amp;#91;NetworkTopologyStrategy&amp;#93;&lt;/span&gt;.&quot;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12488338" name="2960.txt" size="794" author="jbellis" created="Sun, 31 Jul 2011 03:57:28 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[jbellis]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>20914</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            14 years ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0geiv:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>93783</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>slebresne</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[slebresne]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12961"><![CDATA[Low]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>