<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 23:30:00 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-19477] Do not go to disk to get HintsStore.getTotalFileSize</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-19477</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;When testing a cluster with more requests than it could handle, I noticed significant CPU time (25%) spent in HintsStore.getTotalFileSize.&#160; Here&apos;s what I&apos;m seeing from profiling:&lt;/p&gt;

&lt;p&gt;10% of CPU time spent in HintsDescriptor.fileName which only does this:&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;return String.format(&quot;%s-%s-%s.hints&quot;, hostId, timestamp, version);&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;At a bare minimum here we should create this string up front with the host and version and eliminate 2 of the 3 substitutions, but I think it&apos;s probably faster to use a StringBuilder and avoid the underlying regular expression altogether.&lt;/p&gt;

&lt;p&gt;12% of the time is spent in org.apache.cassandra.io.util.File.length.&#160; It looks like this is called once for each hint file on disk for each host we&apos;re hinting to.&#160; In the case of an overloaded cluster, this is significant.&#160; It would be better if we were to track the file size in memory for each hint file and reference that rather than go to the filesystem.&lt;/p&gt;

&lt;p&gt;These fairly small changes should make Cassandra more reliable when under load spikes.&lt;/p&gt;

&lt;p&gt;CPU Flame graph attached.&lt;/p&gt;

&lt;p&gt;I only tested this in 4.1 but it looks like this is present up to trunk.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</description>
                <environment></environment>
        <key id="13572133">CASSANDRA-19477</key>
            <summary>Do not go to disk to get HintsStore.getTotalFileSize</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10002" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Normal</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="smiklosovic">Stefan Miklosovic</assignee>
                                    <reporter username="rustyrazorblade">Jon Haddad</reporter>
                        <labels>
                    </labels>
                <created>Sat, 16 Mar 2024 20:30:17 +0000</created>
                <updated>Thu, 11 Jul 2024 17:45:46 +0000</updated>
                            <resolved>Mon, 25 Mar 2024 13:35:31 +0000</resolved>
                                        <fixVersion>4.1.5</fixVersion>
                    <fixVersion>5.0-rc1</fixVersion>
                    <fixVersion>5.0</fixVersion>
                    <fixVersion>5.1-alpha1</fixVersion>
                                    <component>Consistency/Hints</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                    <progress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                            <timeestimate seconds="0">0h</timeestimate>
                            <timespent seconds="16800">4h 40m</timespent>
                                <comments>
                            <comment id="17829583" author="smiklosovic" created="Thu, 21 Mar 2024 14:33:52 +0000"  >&lt;p&gt;the work and reviews are done, I just need to test this and Jon should perf-test it. Ideally this should be committed very early next week.&lt;/p&gt;</comment>
                            <comment id="17829791" author="smiklosovic" created="Fri, 22 Mar 2024 08:44:07 +0000"  >&lt;p&gt;&lt;a href=&quot;https://github.com/instaclustr/cassandra/tree/CASSANDRA-19477-4.1&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;CASSANDRA-19477-4.1&lt;/a&gt;&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;java11_pre-commit_tests                         
  &#10003; j11_build                                        1m 30s
  &#10003; j11_cqlsh_dtests_py3                             5m 28s
  &#10003; j11_cqlsh_dtests_py311                           5m 47s
  &#10003; j11_cqlsh_dtests_py311_vnode                      6m 4s
  &#10003; j11_cqlsh_dtests_py38                            5m 53s
  &#10003; j11_cqlsh_dtests_py38_vnode                       6m 2s
  &#10003; j11_cqlsh_dtests_py3_vnode                       5m 53s
  &#10003; j11_cqlshlib_cython_tests                         9m 1s
  &#10003; j11_cqlshlib_tests                                8m 6s
  &#10003; j11_dtests                                      33m 38s
  &#10003; j11_dtests_vnode                                 36m 1s
  &#10003; j11_jvm_dtests                                  15m 44s
  &#10003; j11_jvm_dtests_repeat                           38m 12s
  &#10003; j11_jvm_dtests_vnode                            12m 39s
  &#10003; j11_jvm_dtests_vnode_repeat                     38m 46s
  &#10003; j11_unit_tests_repeat                            0m 32s
  &#10005; j11_unit_tests                                   8m 33s
      org.apache.cassandra.cql3.MemtableSizeTest testSize[skiplist]
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;a href=&quot;https://app.circleci.com/pipelines/github/instaclustr/cassandra/4064/workflows/88c6d9da-308c-43a7-849b-a2b1a6b30307&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;java11_pre-commit_tests&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17829945" author="smiklosovic" created="Fri, 22 Mar 2024 17:38:41 +0000"  >&lt;p&gt;&lt;a href=&quot;https://github.com/instaclustr/cassandra/tree/CASSANDRA-19477-5.0&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;CASSANDRA-19477-5.0&lt;/a&gt;&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;java17_pre-commit_tests                         
  &#10003; j17_build                                        3m 49s
  &#10003; j17_cqlsh_dtests_py311                            6m 4s
  &#10003; j17_cqlsh_dtests_py311_vnode                     6m 13s
  &#10003; j17_cqlsh_dtests_py38                             6m 3s
  &#10003; j17_cqlsh_dtests_py38_vnode                      6m 20s
  &#10003; j17_cqlshlib_cython_tests                        7m 25s
  &#10003; j17_cqlshlib_tests                               6m 27s
  &#10003; j17_dtests                                       32m 3s
  &#10003; j17_jvm_dtests                                  23m 21s
  &#10003; j17_jvm_dtests_latest_vnode                      14m 2s
  &#10003; j17_jvm_dtests_latest_vnode_repeat              40m 42s
  &#10003; j17_jvm_dtests_repeat                           39m 52s
  &#10003; j17_unit_tests                                  17m 44s
  &#10003; j17_unit_tests_repeat                            2m 28s
  &#10003; j17_utests_latest                               15m 45s
  &#10003; j17_utests_latest_repeat                         2m 34s
  &#10003; j17_utests_oa_repeat                             0m 13s
  &#10005; j17_dtests_latest                               34m 34s
      configuration_test.TestConfiguration test_change_durable_writes
  &#10005; j17_dtests_vnode                                 32m 7s
  &#10005; j17_utests_oa                                   15m 57s
      org.apache.cassandra.net.ConnectionTest testTimeout
java17_separate_tests                            
java11_pre-commit_tests                         
  &#10003; j11_build                                        6m 59s
  &#10003; j11_cqlsh_dtests_py311                           9m 42s
  &#10003; j11_cqlsh_dtests_py311_vnode                     7m 41s
  &#10003; j11_cqlsh_dtests_py38                            8m 20s
  &#10003; j11_cqlsh_dtests_py38_vnode                      7m 59s
  &#10003; j11_cqlshlib_cython_tests                       11m 40s
  &#10003; j11_cqlshlib_tests                               9m 16s
  &#10003; j11_dtests                                      38m 39s
  &#10003; j11_dtests_vnode                                35m 20s
  &#10003; j11_jvm_dtests                                  23m 29s
  &#10003; j11_jvm_dtests_latest_vnode                     14m 40s
  &#10003; j11_jvm_dtests_latest_vnode_repeat              47m 40s
  &#10003; j11_jvm_dtests_repeat                           41m 59s
  &#10003; j11_simulator_dtests                             5m 54s
  &#10003; j11_unit_tests                                  19m 38s
  &#10003; j11_unit_tests_repeat                            3m 26s
  &#10003; j11_utests_latest                               21m 24s
  &#10003; j11_utests_latest_repeat                         3m 46s
  &#10003; j11_utests_oa                                   21m 15s
  &#10003; j11_utests_oa_repeat                             8m 28s
  &#10003; j11_utests_system_keyspace_directory            16m 17s
  &#10003; j11_utests_system_keyspace_directory_repeat      3m 58s
  &#10003; j17_cqlsh_dtests_py311                           5m 56s
  &#10003; j17_cqlsh_dtests_py311_vnode                     6m 46s
  &#10003; j17_cqlsh_dtests_py38                             6m 9s
  &#10003; j17_cqlsh_dtests_py38_vnode                      6m 55s
  &#10003; j17_cqlshlib_cython_tests                        7m 32s
  &#10003; j17_cqlshlib_tests                               6m 27s
  &#10003; j17_dtests                                      33m 37s
  &#10003; j17_dtests_vnode                                32m 31s
  &#10003; j17_jvm_dtests                                  23m 16s
  &#10003; j17_jvm_dtests_latest_vnode                     13m 28s
  &#10003; j17_jvm_dtests_latest_vnode_repeat              40m 42s
  &#10003; j17_jvm_dtests_repeat                           41m 28s
  &#10003; j17_unit_tests                                  14m 40s
  &#10003; j17_unit_tests_repeat                            0m 16s
  &#10003; j17_utests_latest_repeat                         0m 14s
  &#10003; j17_utests_oa                                   15m 51s
  &#10003; j17_utests_oa_repeat                             7m 58s
  &#10005; j11_dtests_latest                                35m 2s
      configuration_test.TestConfiguration test_change_durable_writes
  &#10005; j17_dtests_latest                               33m 55s
      configuration_test.TestConfiguration test_change_durable_writes
  &#10005; j17_utests_latest                               16m 38s
      org.apache.cassandra.cql3.validation.operations.SelectTest testCreatingUDFWithSameNameAsBuiltin_PrefersCompatibleArgs
      org.apache.cassandra.cql3.validation.operations.SelectTest testCreatingUDFWithSameNameAsBuiltin_FullyQualifiedFunctionNameWorks
java11_separate_tests                            
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;a href=&quot;https://app.circleci.com/pipelines/github/instaclustr/cassandra/4063/workflows/15b9eab1-70d5-4490-836a-49cc9169c2aa&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;java17_pre-commit_tests&lt;/a&gt;&lt;br/&gt;
&lt;a href=&quot;https://app.circleci.com/pipelines/github/instaclustr/cassandra/4063/workflows/dfe8ff72-6036-497d-a520-7f68ef35ce43&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;java17_separate_tests&lt;/a&gt;&lt;br/&gt;
&lt;a href=&quot;https://app.circleci.com/pipelines/github/instaclustr/cassandra/4063/workflows/8ad3afe0-612f-4911-a07e-c874cfaed3b9&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;java11_pre-commit_tests&lt;/a&gt;&lt;br/&gt;
&lt;a href=&quot;https://app.circleci.com/pipelines/github/instaclustr/cassandra/4063/workflows/ddfc2765-f3d6-4244-8ee4-c07f2b413db6&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;java11_separate_tests&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17829991" author="rustyrazorblade" created="Fri, 22 Mar 2024 21:19:46 +0000"  >&lt;p&gt;Awesome.&#160; I&apos;ll fire up a test with the 4.1 branch, since that&apos;s what I tested before, and post my findings.&lt;/p&gt;</comment>
                            <comment id="17830036" author="smiklosovic" created="Sat, 23 Mar 2024 07:43:39 +0000"  >&lt;p&gt;&lt;a href=&quot;https://github.com/instaclustr/cassandra/tree/CASSANDRA-19477-4.1&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;CASSANDRA-19477-4.1&lt;/a&gt;&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;java8_pre-commit_tests                          
  &#10003; j8_build                                         3m 56s
  &#10003; j8_cqlsh_dtests_py3                              5m 12s
  &#10003; j8_cqlsh_dtests_py311                            8m 35s
  &#10003; j8_cqlsh_dtests_py311_vnode                       9m 4s
  &#10003; j8_cqlsh_dtests_py38                             6m 47s
  &#10003; j8_cqlsh_dtests_py38_vnode                        6m 8s
  &#10003; j8_cqlsh_dtests_py3_vnode                        9m 18s
  &#10003; j8_cqlshlib_cython_tests                        11m 55s
  &#10003; j8_cqlshlib_tests                                 8m 6s
  &#10003; j8_dtests                                       32m 16s
  &#10003; j8_dtests_vnode                                 36m 21s
  &#10003; j8_jvm_dtests                                   16m 18s
  &#10003; j8_jvm_dtests_repeat                            41m 32s
  &#10003; j8_jvm_dtests_vnode_repeat                      41m 13s
  &#10003; j8_simulator_dtests                              2m 49s
  &#10003; j8_unit_tests_repeat                             3m 59s
  &#10003; j8_utests_system_keyspace_directory_repeat       3m 45s
  &#10003; j11_unit_tests_repeat                            0m 31s
  &#10003; j11_jvm_dtests_vnode_repeat                     38m 49s
  &#10003; j11_jvm_dtests_vnode                            12m 37s
  &#10003; j11_jvm_dtests_repeat                            39m 0s
  &#10003; j11_jvm_dtests                                   16m 8s
  &#10003; j11_dtests_vnode                                35m 43s
  &#10003; j11_dtests                                      33m 55s
  &#10003; j11_cqlshlib_tests                               6m 15s
  &#10003; j11_cqlshlib_cython_tests                        7m 10s
  &#10003; j11_cqlsh_dtests_py3_vnode                       5m 37s
  &#10003; j11_cqlsh_dtests_py38_vnode                      6m 10s
  &#10003; j11_cqlsh_dtests_py38                            5m 26s
  &#10003; j11_cqlsh_dtests_py311_vnode                     5m 46s
  &#10003; j11_cqlsh_dtests_py311                           5m 29s
  &#10003; j11_cqlsh_dtests_py3                             5m 20s
  &#10005; j8_jvm_dtests_vnode                             16m 54s
      org.apache.cassandra.distributed.test.GossipTest nodeDownDuringMove
  &#10005; j8_unit_tests                                   11m 19s
      org.apache.cassandra.cql3.MemtableSizeTest testSize[skiplist]
  &#10005; j8_utests_system_keyspace_directory              9m 35s
      org.apache.cassandra.cql3.MemtableSizeTest testSize[skiplist]
  &#10005; j11_unit_tests                                    8m 6s
      org.apache.cassandra.db.compaction.DateTieredCompactionStrategyTest testDropExpiredSSTables
      org.apache.cassandra.db.compaction.DateTieredCompactionStrategyTest testFilterOldSSTables
      org.apache.cassandra.cql3.MemtableSizeTest testSize[skiplist]
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;a href=&quot;https://app.circleci.com/pipelines/github/instaclustr/cassandra/4065/workflows/3c368b8e-2cc7-4c78-afe3-62b45253e416&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;java8_pre-commit_tests&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17830306" author="rustyrazorblade" created="Mon, 25 Mar 2024 01:11:38 +0000"  >&lt;p&gt;I&apos;ve set up a 3 node cluster, loaded 15GB of data then took down a node and let hints accumulate.&#160; I switched one node to use the 4.1 patch branch above, and let the other node remain on release 4.1, then ran this:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;easy-cass-stress run RandomPartitionAccess --workload.rows=1000 --rate 5k -d 2h -t 4&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Here&apos;s the 4.1 release flame graph.&#160;&#160;&lt;span class=&quot;nobr&quot;&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/13067651/13067651_flame-cassandra0-release-2024-03-25_00-16-44.html&quot; title=&quot;flame-cassandra0-release-2024-03-25_00-16-44.html attached to CASSANDRA-19477&quot;&gt;flame-cassandra0-release-2024-03-25_00-16-44.html&lt;sup&gt;&lt;img class=&quot;rendericon&quot; src=&quot;https://issues.apache.org/jira/images/icons/link_attachment_7.gif&quot; height=&quot;7&quot; width=&quot;7&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/sup&gt;&lt;/a&gt;&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;StorageProxy.mutate is taking up 17% of CPU time, with shouldHint taking up almost 7% of CPU time.&lt;/p&gt;

&lt;p&gt;Here&apos;s the 4.1 + patch flame graph: &lt;span class=&quot;nobr&quot;&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/13067652/13067652_flame-cassandra0-patched-2024-03-25_00-40-47.html&quot; title=&quot;flame-cassandra0-patched-2024-03-25_00-40-47.html attached to CASSANDRA-19477&quot;&gt;flame-cassandra0-patched-2024-03-25_00-40-47.html&lt;sup&gt;&lt;img class=&quot;rendericon&quot; src=&quot;https://issues.apache.org/jira/images/icons/link_attachment_7.gif&quot; height=&quot;7&quot; width=&quot;7&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/sup&gt;&lt;/a&gt;&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;StorageProxy.mutate is only taking up 10% of CPU time now, with shouldHint taking up .26% of CPU time.&lt;/p&gt;

&lt;p&gt;You can see the below graph 172.31.36.176 is using less CPU overall.&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;image-wrap&quot; style=&quot;&quot;&gt;&lt;img src=&quot;https://issues.apache.org/jira/secure/attachment/13067653/13067653_image-2024-03-24-17-57-32-560.png&quot; height=&quot;270&quot; width=&quot;857&quot; style=&quot;border: 0px solid black&quot; /&gt;&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;Here&apos;s the same setup with additional load.&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;easy-cass-stress run RandomPartitionAccess --workload.rows=1000 --rate 30k -d 2h -t 4&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&lt;span class=&quot;image-wrap&quot; style=&quot;&quot;&gt;&lt;img src=&quot;https://issues.apache.org/jira/secure/attachment/13067654/13067654_image-2024-03-24-18-08-36-918.png&quot; height=&quot;302&quot; width=&quot;749&quot; style=&quot;border: 0px solid black&quot; /&gt;&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;The improvement in this patch is fantastic, really nice work &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=smiklosovic&quot; class=&quot;user-hover&quot; rel=&quot;smiklosovic&quot;&gt;smiklosovic&lt;/a&gt;.&#160; I&apos;m +1 with regard to performance, but deferring to &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=aleksey&quot; class=&quot;user-hover&quot; rel=&quot;aleksey&quot;&gt;aleksey&lt;/a&gt; to judge correctness.&lt;/p&gt;</comment>
                            <comment id="17830307" author="smiklosovic" created="Mon, 25 Mar 2024 01:15:38 +0000"  >&lt;p&gt;nice! It was all the joined effort really, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=aleksey&quot; class=&quot;user-hover&quot; rel=&quot;aleksey&quot;&gt;aleksey&lt;/a&gt; helped me to improve and polish the idea so big kudos to him!&lt;/p&gt;</comment>
                            <comment id="17830308" author="rustyrazorblade" created="Mon, 25 Mar 2024 01:20:21 +0000"  >&lt;p&gt;Here&apos;s some more fun graphs.&#160; Both read and write latency and load average, are significantly improved.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;image-wrap&quot; style=&quot;&quot;&gt;&lt;img src=&quot;https://issues.apache.org/jira/secure/attachment/13067655/13067655_image-2024-03-24-18-16-50-370.png&quot; height=&quot;205&quot; width=&quot;645&quot; style=&quot;border: 0px solid black&quot; /&gt;&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;image-wrap&quot; style=&quot;&quot;&gt;&lt;img src=&quot;https://issues.apache.org/jira/secure/attachment/13067657/13067657_image-2024-03-24-18-20-07-734.png&quot; height=&quot;229&quot; width=&quot;723&quot; style=&quot;border: 0px solid black&quot; /&gt;&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;image-wrap&quot; style=&quot;&quot;&gt;&lt;img src=&quot;https://issues.apache.org/jira/secure/attachment/13067656/13067656_image-2024-03-24-18-17-48-334.png&quot; height=&quot;210&quot; width=&quot;653&quot; style=&quot;border: 0px solid black&quot; /&gt;&lt;/span&gt;&lt;/p&gt;</comment>
                            <comment id="17830401" author="smiklosovic" created="Mon, 25 Mar 2024 09:03:39 +0000"  >&lt;p&gt;&lt;a href=&quot;https://github.com/instaclustr/cassandra/tree/CASSANDRA-19477-trunk&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;CASSANDRA-19477-trunk&lt;/a&gt;&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;java17_pre-commit_tests                         
  &#10003; j17_build                                        3m 57s
  &#10003; j17_cqlsh_dtests_py311                            7m 2s
  &#10003; j17_cqlsh_dtests_py311_vnode                     7m 32s
  &#10003; j17_cqlsh_dtests_py38                            6m 50s
  &#10003; j17_cqlsh_dtests_py38_vnode                      7m 16s
  &#10003; j17_cqlshlib_cython_tests                        7m 39s
  &#10003; j17_cqlshlib_tests                               6m 31s
  &#10003; j17_dtests                                      34m 33s
  &#10003; j17_dtests_vnode                                35m 10s
  &#10003; j17_jvm_dtests_latest_vnode_repeat              26m 31s
  &#10003; j17_jvm_dtests_repeat                            28m 7s
  &#10003; j17_unit_tests                                  16m 26s
  &#10003; j17_unit_tests_repeat                            0m 18s
  &#10003; j17_utests_latest                               13m 59s
  &#10003; j17_utests_latest_repeat                         0m 13s
  &#10003; j17_utests_oa_repeat                             0m 29s
  &#10005; j17_dtests_latest                               34m 36s
      offline_tools_test.TestOfflineTools test_sstablelevelreset
      offline_tools_test.TestOfflineTools test_sstableofflinerelevel
      configuration_test.TestConfiguration test_change_durable_writes
      configuration_test.TestConfiguration test_change_durable_writes
  &#10005; j17_jvm_dtests                                  27m 59s
      org.apache.cassandra.distributed.test.NativeTransportEncryptionOptionsTest testEndpointVerificationEnabledIpNotInSAN TIMEOUTED
  &#10005; j17_jvm_dtests_latest_vnode                     22m 44s
      junit.framework.TestSuite org.apache.cassandra.fuzz.harry.integration.model.InJVMTokenAwareExecutorTest TIMEOUTED
  &#10005; j17_utests_oa                                   13m 58s
      org.apache.cassandra.db.compaction.CompactionsBytemanTest testSSTableNotEnoughDiskSpaceForCompactionGetsDropped
java17_separate_tests                            
java11_pre-commit_tests                         
  &#10003; j11_build                                        7m 57s
  &#10003; j11_cqlsh_dtests_py311                            7m 7s
  &#10003; j11_cqlsh_dtests_py311_vnode                    10m 13s
  &#10003; j11_cqlsh_dtests_py38                             8m 1s
  &#10003; j11_cqlsh_dtests_py38_vnode                     10m 25s
  &#10003; j11_cqlshlib_cython_tests                        7m 28s
  &#10003; j11_cqlshlib_tests                               9m 40s
  &#10003; j11_dtests_vnode                                36m 58s
  &#10003; j11_jvm_dtests_latest_vnode                     25m 28s
  &#10003; j11_jvm_dtests_latest_vnode_repeat              29m 22s
  &#10003; j11_jvm_dtests_repeat                            28m 7s
  &#10003; j11_unit_tests                                  15m 17s
  &#10003; j11_unit_tests_repeat                            0m 30s
  &#10003; j11_utests_latest                               16m 56s
  &#10003; j11_utests_latest_repeat                         0m 34s
  &#10003; j11_utests_oa                                   13m 58s
  &#10003; j11_utests_oa_repeat                              1m 0s
  &#10003; j11_utests_system_keyspace_directory             18m 1s
  &#10003; j11_utests_system_keyspace_directory_repeat      3m 39s
  &#10003; j17_cqlsh_dtests_py311                            7m 6s
  &#10003; j17_cqlsh_dtests_py311_vnode                     7m 27s
  &#10003; j17_cqlsh_dtests_py38                            6m 51s
  &#10003; j17_cqlsh_dtests_py38_vnode                      7m 14s
  &#10003; j17_cqlshlib_cython_tests                        7m 38s
  &#10003; j17_cqlshlib_tests                               6m 57s
  &#10003; j17_dtests                                      32m 21s
  &#10003; j17_dtests_vnode                                34m 24s
  &#10003; j17_jvm_dtests_latest_vnode                     22m 45s
  &#10003; j17_jvm_dtests_latest_vnode_repeat              26m 32s
  &#10003; j17_jvm_dtests_repeat                           28m 21s
  &#10003; j17_unit_tests_repeat                            0m 16s
  &#10003; j17_utests_latest                               15m 34s
  &#10003; j17_utests_latest_repeat                         0m 36s
  &#10003; j17_utests_oa                                   13m 43s
  &#10003; j17_utests_oa_repeat                             0m 17s
  &#10005; j11_dtests                                      37m 26s
      pushed_notifications_test.TestPushedNotifications test_move_single_node_localhost
  &#10005; j11_dtests_latest                               40m 40s
      bootstrap_test.TestBootstrap test_bootstrap_with_reset_bootstrap_state
      offline_tools_test.TestOfflineTools test_sstablelevelreset
      offline_tools_test.TestOfflineTools test_sstableofflinerelevel
      configuration_test.TestConfiguration test_change_durable_writes
  &#10005; j11_jvm_dtests                                  27m 33s
      org.apache.cassandra.fuzz.ring.ConsistentBootstrapTest coordinatorIsBehindTest
  &#10005; j11_simulator_dtests                            10m 37s
      org.apache.cassandra.simulator.test.HarrySimulatorTest test
      org.apache.cassandra.simulator.test.ShortPaxosSimulationTest simulationTest
  &#10005; j17_dtests_latest                               36m 31s
      bootstrap_test.TestBootstrap test_bootstrap_with_reset_bootstrap_state
      offline_tools_test.TestOfflineTools test_sstablelevelreset
      offline_tools_test.TestOfflineTools test_sstableofflinerelevel
      configuration_test.TestConfiguration test_change_durable_writes
  &#10005; j17_jvm_dtests                                  26m 11s
      org.apache.cassandra.fuzz.ring.ConsistentBootstrapTest coordinatorIsBehindTest
      org.apache.cassandra.distributed.test.NativeTransportEncryptionOptionsTest testOptionalMtlsModeDoNotAllowNonSSLConnections
      org.apache.cassandra.distributed.test.NativeTransportEncryptionOptionsTest testEndpointVerificationEnabledIpNotInSAN
  &#10005; j17_unit_tests                                  14m 20s
      org.apache.cassandra.db.guardrails.GuardrailMaximumTimestampTest testEnabledWarn
java11_separate_tests                            
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;a href=&quot;https://app.circleci.com/pipelines/github/instaclustr/cassandra/4067/workflows/467f088d-2bb6-4e61-878b-5931043bc654&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;java17_pre-commit_tests&lt;/a&gt;&lt;br/&gt;
&lt;a href=&quot;https://app.circleci.com/pipelines/github/instaclustr/cassandra/4067/workflows/5f9cf2c6-369d-4257-8958-2288a70c7ed7&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;java17_separate_tests&lt;/a&gt;&lt;br/&gt;
&lt;a href=&quot;https://app.circleci.com/pipelines/github/instaclustr/cassandra/4067/workflows/78bfce10-f3d2-433c-bdc0-7841a7e46244&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;java11_pre-commit_tests&lt;/a&gt;&lt;br/&gt;
&lt;a href=&quot;https://app.circleci.com/pipelines/github/instaclustr/cassandra/4067/workflows/66a60733-9c8a-4c58-893f-e699bae36cda&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;java11_separate_tests&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17830429" author="iamaleksey" created="Mon, 25 Mar 2024 10:18:09 +0000"  >&lt;p&gt;+1, good stuff&lt;/p&gt;</comment>
                            <comment id="17865174" author="gilg" created="Thu, 11 Jul 2024 17:45:46 +0000"  >&lt;p&gt;I think I ran into this as well on 4.1.4, though my flame graph looks a bit different.&lt;br/&gt;
What led to this was packet loss between remote on-prem datacenters, but same level of packetloss never caused an issue pre 4.1.&#160;&lt;br/&gt;
Load on the servers was super high, and basiclly all the threads were doing was InternalResponseStage&lt;span class=&quot;nobr&quot;&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/13070099/13070099_flamegraph_20240711.html&quot; title=&quot;flamegraph_20240711.html attached to CASSANDRA-19477&quot;&gt;flamegraph_20240711.html&lt;sup&gt;&lt;img class=&quot;rendericon&quot; src=&quot;https://issues.apache.org/jira/images/icons/link_attachment_7.gif&quot; height=&quot;7&quot; width=&quot;7&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/sup&gt;&lt;/a&gt;&lt;/span&gt;&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310660">
                    <name>Completes</name>
                                            <outwardlinks description="fixes">
                                        <issuelink>
            <issuekey id="13572802">CASSANDRA-19485</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="13067652" name="flame-cassandra0-patched-2024-03-25_00-40-47.html" size="133214" author="rustyrazorblade" created="Mon, 25 Mar 2024 00:47:31 +0000"/>
                            <attachment id="13067651" name="flame-cassandra0-release-2024-03-25_00-16-44.html" size="139322" author="rustyrazorblade" created="Mon, 25 Mar 2024 00:47:23 +0000"/>
                            <attachment id="13067482" name="flamegraph.cpu.html" size="418335" author="rustyrazorblade" created="Sat, 16 Mar 2024 20:08:57 +0000"/>
                            <attachment id="13070099" name="flamegraph_20240711.html" size="4276839" author="gilg" created="Thu, 11 Jul 2024 17:45:45 +0000"/>
                            <attachment id="13067653" name="image-2024-03-24-17-57-32-560.png" size="197921" author="rustyrazorblade" created="Mon, 25 Mar 2024 00:57:33 +0000"/>
                            <attachment id="13067654" name="image-2024-03-24-18-08-36-918.png" size="152245" author="rustyrazorblade" created="Mon, 25 Mar 2024 01:08:38 +0000"/>
                            <attachment id="13067655" name="image-2024-03-24-18-16-50-370.png" size="117839" author="rustyrazorblade" created="Mon, 25 Mar 2024 01:16:51 +0000"/>
                            <attachment id="13067656" name="image-2024-03-24-18-17-48-334.png" size="124869" author="rustyrazorblade" created="Mon, 25 Mar 2024 01:17:48 +0000"/>
                            <attachment id="13067657" name="image-2024-03-24-18-20-07-734.png" size="196201" author="rustyrazorblade" created="Mon, 25 Mar 2024 01:20:08 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[smiklosovic]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12313825" key="com.atlassian.jira.plugin.system.customfieldtypes:cascadingselect">
                        <customfieldname>Bug Category</customfieldname>
                        <customfieldvalues>
                                                    <customfieldvalue key="13163" cascade-level=""><![CDATA[Code]]></customfieldvalue>
            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12313821" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Complexity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12965"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313822" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Discovered By</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12977"><![CDATA[Adhoc Test]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12313922" key="jira.plugin.projectspecificselectfield.jpssf:multicftype">
                        <customfieldname>Impacts</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="13100"><![CDATA[None]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            1 year, 17 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12313921" key="jira.plugin.projectspecificselectfield.jpssf:multicftype">
                        <customfieldname>Platform</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="13076"><![CDATA[All]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z1o0gw:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[aleksey]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12962"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12311420" key="com.atlassian.jira.plugin.system.customfieldtypes:version">
                        <customfieldname>Since Version</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="12351787">4.1-alpha1</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313924" key="com.atlassian.jira.plugin.system.customfieldtypes:textfield">
                        <customfieldname>Source Control Link</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>&lt;p&gt;&lt;a href=&quot;https://github.com/apache/cassandra/commit/38408938ccfe5b8c051e25c645bdcd71b45fa66e&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/cassandra/commit/38408938ccfe5b8c051e25c645bdcd71b45fa66e&lt;/a&gt;&lt;/p&gt;</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313823" key="com.atlassian.jira.plugin.system.customfieldtypes:textarea">
                        <customfieldname>Test and Documentation Plan</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>&lt;p&gt;ci&lt;/p&gt;</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>