<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 22:58:08 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-10347] Bulk Loader API could not tolerate even node failure</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-10347</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;When user uses CqlBulkOutputFormat, it tries to stream to all the nodes in the token range, which includes the dead nodes. Therefore, the stream failed. There was a design in C* API to allow stream() method to have a list of ignore hosts, but it was not utilized.&lt;/p&gt;

&lt;p&gt;The empty-argument stream() method is called in all existing versions of C*, i.e.&lt;br/&gt;
in v2.0.11, &lt;a href=&quot;https://github.com/apache/cassandra/blob/cassandra-2.0.11/src/java/org/apache/cassandra/hadoop/AbstractBulkRecordWriter.java#L122&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/cassandra/blob/cassandra-2.0.11/src/java/org/apache/cassandra/hadoop/AbstractBulkRecordWriter.java#L122&lt;/a&gt;&lt;br/&gt;
in v2.1.5, &lt;a href=&quot;https://github.com/apache/cassandra/blob/cassandra-2.1.5/src/java/org/apache/cassandra/hadoop/AbstractBulkRecordWriter.java#L122&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/cassandra/blob/cassandra-2.1.5/src/java/org/apache/cassandra/hadoop/AbstractBulkRecordWriter.java#L122&lt;/a&gt;&lt;br/&gt;
and current trunk branch &lt;a href=&quot;https://github.com/apache/cassandra/blob/trunk/src/java/org/apache/cassandra/hadoop/cql3/CqlBulkRecordWriter.java#L241&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/cassandra/blob/trunk/src/java/org/apache/cassandra/hadoop/cql3/CqlBulkRecordWriter.java#L241&lt;/a&gt;&lt;/p&gt;</description>
                <environment></environment>
        <key id="12864328">CASSANDRA-10347</key>
            <summary>Bulk Loader API could not tolerate even node failure</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10002" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Normal</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="pauloricardomg">Paulo Motta</assignee>
                                    <reporter username="wanshenghua">Shenghua Wan</reporter>
                        <labels>
                    </labels>
                <created>Tue, 15 Sep 2015 18:43:56 +0000</created>
                <updated>Tue, 14 Oct 2025 12:13:59 +0000</updated>
                            <resolved>Thu, 1 Oct 2015 12:21:15 +0000</resolved>
                                        <fixVersion>2.1.10</fixVersion>
                    <fixVersion>2.2.2</fixVersion>
                    <fixVersion>3.0.0 rc2</fixVersion>
                                    <component>Legacy/Tools</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>6</watches>
                                                                                                                <comments>
                            <comment id="14876665" author="pauloricardomg" created="Fri, 18 Sep 2015 23:13:31 +0000"  >&lt;p&gt;Unfortunately it&apos;s not trivial to tolerate node failures transparently, as this would require submitting hints or expecting clients to perform anti-entropy (repairs) after the node is back. In order to allow the client to ignore down nodes, I added option &lt;tt&gt;mapreduce.output.bulkoutputformat.ignorehosts&lt;/tt&gt; to allow blacklisting down nodes, so they would know in advance it needs to run repair after the down node is back. Also added helper methods to &lt;tt&gt;CqlBulkOutputFormat&lt;/tt&gt;: &lt;tt&gt;setIgnoreHosts&lt;/tt&gt; and &lt;tt&gt;getIgnoreHosts&lt;/tt&gt;.&lt;/p&gt;

&lt;p&gt;Attaching 2.1 and 2.2+ patches. Tests will be available below:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/paulomotta/job/pauloricardomg-2.1-10347-dtest/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;2.1 dtests&lt;/a&gt;&lt;/li&gt;
	&lt;li&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/paulomotta/job/pauloricardomg-2.1-10347-testall/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;2.1 testall&lt;/a&gt;&lt;/li&gt;
	&lt;li&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/paulomotta/job/pauloricardomg-2.2-10347-dtest/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;2.2 dtests&lt;/a&gt;&lt;/li&gt;
	&lt;li&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/paulomotta/job/pauloricardomg-2.2-10347-testall/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;2.2 testall&lt;/a&gt;&lt;/li&gt;
	&lt;li&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/paulomotta/job/pauloricardomg-3.0-10347-dtest/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;3.0 dtests&lt;/a&gt;&lt;/li&gt;
	&lt;li&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/paulomotta/job/pauloricardomg-3.0-10347-testall/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;3.0 testall&lt;/a&gt;&lt;/li&gt;
	&lt;li&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/paulomotta/job/pauloricardomg-trunk-10347-dtest/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;trunk dtests&lt;/a&gt;&lt;/li&gt;
	&lt;li&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/paulomotta/job/pauloricardomg-trunk-10347-testall/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;trunk testall&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="14906841" author="jbellis" created="Thu, 24 Sep 2015 19:05:09 +0000"  >&lt;p&gt;WDYT &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=pkolaczk&quot; class=&quot;user-hover&quot; rel=&quot;pkolaczk&quot;&gt;pkolaczk&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=brandon.williams&quot; class=&quot;user-hover&quot; rel=&quot;brandon.williams&quot;&gt;brandon.williams&lt;/a&gt;? Is this worth providing given the foot/gun potential?&lt;/p&gt;</comment>
                            <comment id="14906846" author="brandon.williams" created="Thu, 24 Sep 2015 19:08:18 +0000"  >&lt;p&gt;We have this in the standalone loader, so I don&apos;t see why we shouldn&apos;t have it here.&lt;/p&gt;</comment>
                            <comment id="14933716" author="JIRAUSER308715" created="Mon, 28 Sep 2015 18:22:19 +0000"  >&lt;p&gt;Isn&apos;t using mapreduce.output.bulkoutputformat.maxfailedhosts a better way to do this?  Does that not work for this use case?&lt;/p&gt;</comment>
                            <comment id="14933818" author="pauloricardomg" created="Mon, 28 Sep 2015 19:08:58 +0000"  >&lt;blockquote&gt;&lt;p&gt;Isn&apos;t using mapreduce.output.bulkoutputformat.maxfailedhosts a better way to do this? Does that not work for this use case?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Probably yes, but &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=wanshenghua&quot; class=&quot;user-hover&quot; rel=&quot;wanshenghua&quot;&gt;wanshenghua&lt;/a&gt; could tell better, did you try the &lt;tt&gt;mapreduce.output.bulkoutputformat.maxfailedhosts&lt;/tt&gt; property? &lt;/p&gt;

&lt;p&gt;Unfortunately I just discovered that property after implementing the new one, my bad. Anyway, I guess the parameters are not mutually exclusive, as you may want still want to blacklist nodes that are alive. Since it&apos;s already implemented and to be consistent with sstable loader, I think it&apos;s still valid to have an &lt;tt&gt;ignorehosts&lt;/tt&gt; property in addition to &lt;tt&gt;maxfailedhosts&lt;/tt&gt;.&lt;/p&gt;</comment>
                            <comment id="14933906" author="wanshenghua" created="Mon, 28 Sep 2015 20:13:29 +0000"  >&lt;p&gt;First thank you for looking into this issue.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=pauloricardomg&quot; class=&quot;user-hover&quot; rel=&quot;pauloricardomg&quot;&gt;pauloricardomg&lt;/a&gt; To you question, I have not tried mapreduce.output.bulkoutputformat.maxfailedhosts property. I have read the source code and thought this property only gave up when certain number of host connections failed. However, I still want the streaming continue if there exist some hosts alive, even exceeding the threshold. Therefore, to solve the problem of my use case (skip connecting to lost hosts), I have implemented something just like &quot;mapreduce.output.bulkoutputformat.ignorehosts&quot; property. You can find my implementation in the attached source code AbstractBulkRecordWriter.java Line 75 and Line 164-169, thanks to the existing API &lt;br/&gt;
SSTableLoader.StreamResultFuture stream(Set&amp;lt;InetAddress&amp;gt; toIgnore, StreamEventHandler... listeners).&lt;/p&gt;

&lt;p&gt;I intended to submit a patch via git but I am not able to do so for some reason. That&apos;s the maximum I can do at the moment.  &lt;/p&gt;
</comment>
                            <comment id="14936949" author="carlyeks" created="Wed, 30 Sep 2015 15:00:50 +0000"  >&lt;p&gt;It makes sense to add the option, if you already know which hosts are going to fail. That way you can specify both the hosts that don&apos;t need to be tried, and the max number of hosts which can fail.&lt;/p&gt;

&lt;p&gt;These options should be moved into &lt;tt&gt;ConfigHelper&lt;/tt&gt; instead of &lt;tt&gt;AbstractBulkOutputFormat&lt;/tt&gt;, with the rest of the Hadoop options. Otherwise, +1.&lt;/p&gt;</comment>
                            <comment id="14938264" author="pauloricardomg" created="Wed, 30 Sep 2015 18:52:00 +0000"  >&lt;blockquote&gt;&lt;p&gt;These options should be moved into &lt;tt&gt;ConfigHelper&lt;/tt&gt; instead of &lt;tt&gt;AbstractBulkOutputFormat&lt;/tt&gt;&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;The reason why the options are in AbstractBulkOutputFormat is that they&apos;re exclusive to *BulkOutputFormat (see CqlBulkOutputFormat, which also has exclusive options), so they&apos;re available via CqlBulkOutputFormat or BulkOutputFormat. On the 3.0 branch the option is only available on CqlBulkOutputFormat, along with other exclusive cql bulk output format options.&lt;/p&gt;</comment>
                            <comment id="14938283" author="carlyeks" created="Wed, 30 Sep 2015 19:00:14 +0000"  >&lt;p&gt;Makes sense. I&apos;m +1 on the patch as-is.&lt;/p&gt;</comment>
                            <comment id="14939369" author="pkolaczk" created="Thu, 1 Oct 2015 06:15:52 +0000"  >&lt;p&gt;+1 to having this function in BulkLoader API. That would let us improve bulk loading from Spark.&lt;/p&gt;</comment>
                            <comment id="14939748" author="snazy" created="Thu, 1 Oct 2015 12:21:15 +0000"  >&lt;p&gt;Committed as 31fc6d25fd5edeb1f6ed671076e94be72f9b8dc7&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12546328">CASSANDRA-4047</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12764086" name="AbstractBulkRecordWriter.java" size="11095" author="wanshenghua" created="Mon, 28 Sep 2015 20:14:54 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[pauloricardomg]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 7 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2k7on:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>carlyeks</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[carlyeks]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12962"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>