<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 23:11:26 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-14335] C* nodetool should report the lowest of the highest CQL protocol version supported by all clients connecting to it</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-14335</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;While upgrading C*, it makes it hard to tell whether any client will be affected if C* is upgraded. C* should internally store the highest protocol version of all clients connecting to it. The lowest supported version will help determining if any client will be adversely affected by the upgrade.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13147045">CASSANDRA-14335</key>
            <summary>C* nodetool should report the lowest of the highest CQL protocol version supported by all clients connecting to it</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10002" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Normal</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="djoshi">Dinesh Joshi</assignee>
                                    <reporter username="djoshi">Dinesh Joshi</reporter>
                        <labels>
                    </labels>
                <created>Thu, 22 Mar 2018 03:29:19 +0000</created>
                <updated>Fri, 15 May 2020 08:06:34 +0000</updated>
                            <resolved>Fri, 4 May 2018 18:50:48 +0000</resolved>
                                        <fixVersion>4.0-alpha1</fixVersion>
                    <fixVersion>4.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="16460233" author="djoshi3" created="Tue, 1 May 2018 22:29:32 +0000"  >&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;trunk&lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/dineshjoshi/cassandra/tree/14335-trunk&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;branch&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://circleci.com/gh/dineshjoshi/workflows/cassandra/tree/14335-trunk&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;utests &amp;amp; dtests&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;
</comment>
                            <comment id="16460378" author="zznate" created="Wed, 2 May 2018 01:35:10 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=djoshi3&quot; class=&quot;user-hover&quot; rel=&quot;djoshi3&quot;&gt;djoshi3&lt;/a&gt; You have some config changes to CircleCI as part of this branch - was that intentional? Can we put those in a separate ticket if so?&lt;/p&gt;</comment>
                            <comment id="16460397" author="jasobrown" created="Wed, 2 May 2018 01:54:22 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=zznate&quot; class=&quot;user-hover&quot; rel=&quot;zznate&quot;&gt;zznate&lt;/a&gt; the circleci changes are just for running the utests/dtests, and not part of the real commit. We make sure to not commit those.&lt;/p&gt;</comment>
                            <comment id="16460542" author="djoshi3" created="Wed, 2 May 2018 05:39:49 +0000"  >&lt;p&gt;Thank you &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jasobrown&quot; class=&quot;user-hover&quot; rel=&quot;jasobrown&quot;&gt;jasobrown&lt;/a&gt;. &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=zznate&quot; class=&quot;user-hover&quot; rel=&quot;zznate&quot;&gt;zznate&lt;/a&gt; just so you have more background, I have a paid CircleCI account that supports higher quotas. In order to use it, I need to update the settings. So my patches are typically two commits. You can cherry pick just the patch and ignore the CircleCI commit. If there is a better way to do this, I&apos;m happy to discuss it&#160;&lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="16460545" author="djoshi3" created="Wed, 2 May 2018 05:41:29 +0000"  >&lt;p&gt;I have fixed some minor issues with the patch that I spotted. I am not 100% certain that this class needs to be thread safe.&#160;Thoughts?&lt;/p&gt;</comment>
                            <comment id="16461026" author="jasobrown" created="Wed, 2 May 2018 13:27:38 +0000"  >&lt;p&gt;We already store the &lt;tt&gt;ProtocolVersion&lt;/tt&gt; along with the channel in &lt;tt&gt;Connection&lt;/tt&gt;. We also store a reference to the &lt;tt&gt;Connection&lt;/tt&gt; in the &lt;tt&gt;Channel&lt;/tt&gt;, as a channel attribute. Thus, it seems to me you could just add a method like this to &lt;tt&gt;Server.ConnectionTracker&lt;/tt&gt; (I changed the return type to make the example simpler):&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
        &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; Map&amp;lt;ProtocolVersion, Set&amp;lt;SocketAddress&amp;gt;&amp;gt; getClientsByProtocolVersion()
        {
            Map&amp;lt;ProtocolVersion, Set&amp;lt;SocketAddress&amp;gt;&amp;gt; result = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; EnumMap&amp;lt;&amp;gt;(ProtocolVersion.class);
            &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; (Channel c : allChannels)
            {
                Attribute&amp;lt;Connection&amp;gt; attrConn = c.attr(Connection.attributeKey);
                Connection connection = attrConn.get();
                &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (connection != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;)
                {
                    ProtocolVersion version = connection.getVersion();
                    SocketAddress addr = c.remoteAddress();
                    result.computeIfAbsent(version, protocolVersion -&amp;gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; HashSet&amp;lt;&amp;gt;());
                    result.get(version).add(addr);
                }
            }
            &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; result;
        }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;(Note: &lt;tt&gt;ConnectionTracker#allChannels&lt;/tt&gt; is a &lt;tt&gt;DefaultChannelGroup&lt;/tt&gt;, whose &lt;tt&gt;Iterator()&lt;/tt&gt; method wraps two &lt;tt&gt;ConcurrentHashMap&lt;/tt&gt; s, so I think you are safe concurrency-wise.) This gives you a snapshot of everything that is currently connected. Is this sufficient, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=djoshi3&quot; class=&quot;user-hover&quot; rel=&quot;djoshi3&quot;&gt;djoshi3&lt;/a&gt;?&lt;/p&gt;</comment>
                            <comment id="16461161" author="djoshi3" created="Wed, 2 May 2018 15:20:07 +0000"  >&lt;p&gt;This will just give me the currently connected clients. When the client connects and drops off we won&#8217;t have any idea of what protocol version it used. So, my patch keeps a history of last N Clients and their protocol versions. &lt;/p&gt;</comment>
                            <comment id="16463159" author="djoshi3" created="Thu, 3 May 2018 22:35:19 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jasobrown&quot; class=&quot;user-hover&quot; rel=&quot;jasobrown&quot;&gt;jasobrown&lt;/a&gt;&#160;I have updated my branch with an implementation that will be threadsafe as well as performant. As part of this change, I am introducing addition flags&#160;for &lt;tt&gt;nodetool clientstats&lt;/tt&gt; command. We can use &lt;tt&gt;nodetool clientstats --by-protocol&lt;/tt&gt; to give you the list last 100 clients that the C* process has seen for each protocol. I am deduping by IP address so you should see unique IPs. You can clear this list by running &lt;tt&gt;nodetool clientstats --clear-history&lt;/tt&gt; to clear the history of all clients.&lt;/p&gt;

&lt;p&gt;For posterity - &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jasobrown&quot; class=&quot;user-hover&quot; rel=&quot;jasobrown&quot;&gt;jasobrown&lt;/a&gt; and I had a conversation about the usefulness of having this information. Although the existing &lt;tt&gt;nodetool clientstats --all&lt;/tt&gt; is sufficient to tell you what clients are &lt;em&gt;currently&lt;/em&gt; connected to the C* process including the protocol version, this information is ephemeral. There are many situations where an operator may miss intermittently connecting clients for example - batch processes. Additionally, we can script around by periodically invoking &lt;tt&gt;nodetool clientstats --all&lt;/tt&gt; from external scripts but that is sub-optimal for a variety of reasons - you can still miss intermittent clients, you unnecessarily make calls over JMX. Storing this historical information in the C* process means you wont miss intermittently connecting clients and would be overall more efficient that going over JMX all the time.&lt;/p&gt;</comment>
                            <comment id="16464261" author="jasobrown" created="Fri, 4 May 2018 18:50:48 +0000"  >&lt;p&gt;+1, and committed with a few minor spacing/naming changes as sha &lt;tt&gt;a9ec46a613ae5602ced004935c9954638e83e735&lt;/tt&gt;&lt;/p&gt;</comment>
                            <comment id="16464329" author="jasobrown" created="Fri, 4 May 2018 19:58:19 +0000"  >&lt;p&gt;Ughh, forgot to commit my minor changes locally before pushing up. commited those changes as &lt;tt&gt;68605cf03bdfecb11cd69c6d5260a773e4e87300&lt;/tt&gt;&lt;/p&gt;</comment>
                            <comment id="16464426" author="djoshi3" created="Fri, 4 May 2018 21:40:02 +0000"  >&lt;p&gt;Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jasobrown&quot; class=&quot;user-hover&quot; rel=&quot;jasobrown&quot;&gt;jasobrown&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[djoshi]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 28 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3rmpr:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>jasobrown</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[jasobrown]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12962"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>