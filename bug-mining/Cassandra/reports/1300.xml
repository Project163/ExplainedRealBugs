<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 22:27:28 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-3521] sstableloader throwing exceptions when loading snapshot data from compressed CFs</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-3521</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;Loaded data from snapshot then enabled  `sstable_compression: org.apache.cassandra.io.compress.SnappyCompressor`&lt;br/&gt;
Then flush, scrub and compact. I can see actual CompressionRatio in JMX Console and access my data without problems..&lt;/p&gt;

&lt;p&gt;Now I snapshot compressed keyspace and when trying to load snapshot to another single node or different Keyspace (the same super CF structure with compression options enabled, even try to truncate snapshoted CFs.) I cant retrieve any records . &lt;/p&gt;


&lt;p&gt;sstableloader command with debug mode dont throw any errors and shows its streaming &lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;sstableloader-cassandra_2/bin/sstableloader --debug Impressions_compressed/&lt;/p&gt;&lt;/blockquote&gt;


&lt;p&gt;Node logs contains repeating the errors bellow.&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;ERROR &lt;span class=&quot;error&quot;&gt;&amp;#91;Thread-319&amp;#93;&lt;/span&gt; 2011-11-22 09:56:01,931 AbstractCassandraDaemon.java (line 133) Fatal exception in thread Thread&lt;span class=&quot;error&quot;&gt;&amp;#91;Thread-319,5,main&amp;#93;&lt;/span&gt;&lt;br/&gt;
java.lang.AssertionError: attempted to delete non-existing file HidSaid-tmp-hb-260-Data.db&lt;br/&gt;
        at org.apache.cassandra.io.util.FileUtils.deleteWithConfirm(FileUtils.java:49)&lt;br/&gt;
        at org.apache.cassandra.streaming.IncomingStreamReader.retry(IncomingStreamReader.java:170)&lt;br/&gt;
        at org.apache.cassandra.streaming.IncomingStreamReader.read(IncomingStreamReader.java:92)&lt;br/&gt;
        at org.apache.cassandra.net.IncomingTcpConnection.stream(IncomingTcpConnection.java:184)&lt;br/&gt;
        at org.apache.cassandra.net.IncomingTcpConnection.run(IncomingTcpConnection.java:81)&lt;br/&gt;
 INFO &lt;span class=&quot;error&quot;&gt;&amp;#91;Thread-320&amp;#93;&lt;/span&gt; 2011-11-22 09:56:02,492 StreamInSession.java (line 120) Streaming of file Impressions_compressed/HidSaid-hb-9-Data.db sections=1 progress=0/5616749 - 0% from org.apache.cassandra.streaming.StreamInSession@3cc62c07 failed: requesting a retry.&lt;br/&gt;
ERROR &lt;span class=&quot;error&quot;&gt;&amp;#91;Thread-320&amp;#93;&lt;/span&gt; 2011-11-22 09:56:02,493 AbstractCassandraDaemon.java (line 133) Fatal exception in thread Thread&lt;span class=&quot;error&quot;&gt;&amp;#91;Thread-320,5,main&amp;#93;&lt;/span&gt;&lt;br/&gt;
java.lang.AssertionError: attempted to delete non-existing file HidSaid-tmp-hb-261-Data.db&lt;br/&gt;
        at org.apache.cassandra.io.util.FileUtils.deleteWithConfirm(FileUtils.java:49)&lt;br/&gt;
        at org.apache.cassandra.streaming.IncomingStreamReader.retry(IncomingStreamReader.java:170)&lt;br/&gt;
        at org.apache.cassandra.streaming.IncomingStreamReader.read(IncomingStreamReader.java:92)&lt;br/&gt;
        at org.apache.cassandra.net.IncomingTcpConnection.stream(IncomingTcpConnection.java:184)&lt;br/&gt;
        at org.apache.cassandra.net.IncomingTcpConnection.run(IncomingTcpConnection.java:81)&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Hope its enough if you need more info just tell me what you need to reproduce this bug.&lt;/p&gt;</description>
                <environment>&lt;p&gt;One node cluster (same problem with 4 nodes ) and dedicated machine for sstable loader.&lt;br/&gt;
node and loader running jdk1.6.0_29 and cassandra-1.0.3&lt;/p&gt;</environment>
        <key id="12532297">CASSANDRA-3521</key>
            <summary>sstableloader throwing exceptions when loading snapshot data from compressed CFs</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10002" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Normal</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="yukim">Yuki Morishita</assignee>
                                    <reporter username="pvelas">Peter Velas</reporter>
                        <labels>
                            <label>compression</label>
                    </labels>
                <created>Tue, 22 Nov 2011 09:33:45 +0000</created>
                <updated>Tue, 16 Apr 2019 09:32:45 +0000</updated>
                            <resolved>Fri, 25 Nov 2011 09:20:19 +0000</resolved>
                                        <fixVersion>1.0.4</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                                                                <comments>
                            <comment id="13155224" author="jbellis" created="Tue, 22 Nov 2011 16:07:08 +0000"  >&lt;p&gt;If sstableloader says it&apos;s streaming, what does &quot;I can&apos;t load any data&quot; mean?&lt;/p&gt;</comment>
                            <comment id="13155282" author="pvelas" created="Tue, 22 Nov 2011 17:34:02 +0000"  >&lt;p&gt;progress line is updating and bitrate is changing but it never ends. And my CF is still empty.&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;sstableloader-cassandra_2/bin/sstableloader --debug Impressions_compressed
Starting client (and waiting 30 seconds for gossip) ...
Streaming revelant part of Impressions_compressed/Hid-hb-9-Data.db Impressions_compressed/Impression-hb-11-Data.db Impressions_compressed/HidSaid-hb-9-Data.db to [/10.20.30.135]

progress: [/10.20.30.135 0/3 (3851)] [total: 3851 - 7MB/s (avg: 6MB/s)]
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;[default@Impressions_compressed] list Impression;
Using default limit of 100

0 Row Returned.
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;



&lt;p&gt;When I tried to list files from OS point of view (loading only one CF right now)&lt;br/&gt;
Its looks like some loop . Streaming data to file and when it reach 200 MB start with new file and increase by 1.&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;[root@cass101 Impressions_compressed]# ls -sh1
total 193M
 28K Impression-tmp-hb-59-CompressionInfo.db
193M Impression-tmp-hb-59-Data.db
   0 Impression-tmp-hb-59-Index.db

[root@cass101 Impressions_compressed]# ls -sh1
total 2.0M
4.0K Impression-tmp-hb-60-CompressionInfo.db
2.0M Impression-tmp-hb-60-Data.db
   0 Impression-tmp-hb-60-Index.db
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Hope now its better described .&lt;/p&gt;</comment>
                            <comment id="13155344" author="pvelas" created="Tue, 22 Nov 2011 18:54:41 +0000"  >&lt;p&gt;Better formulation would be &quot;I cant retrieve any records with cassandra-cli.&quot;&lt;/p&gt;</comment>
                            <comment id="13156998" author="yukim" created="Fri, 25 Nov 2011 06:14:19 +0000"  >&lt;p&gt;Thanks for the detail, Peter.&lt;br/&gt;
Current version of sstableloader seems it does not pick up sstable&apos;s compression info before start streaming, and that causes receiver node handle streaming data incorrectly.&lt;br/&gt;
Attached patch let sstableloader to pick up compression information if available.&lt;/p&gt;</comment>
                            <comment id="13157044" author="slebresne" created="Fri, 25 Nov 2011 09:20:19 +0000"  >&lt;p&gt;+1, committed, thanks&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12505061" name="3521.txt" size="713" author="yukim" created="Fri, 25 Nov 2011 06:14:19 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[yukim]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>218030</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            14 years, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0gkxj:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>94821</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>slebresne</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[slebresne]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12962"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>