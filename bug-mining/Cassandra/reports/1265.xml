<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 22:26:34 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-3438] sstableloader fails</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-3438</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;Ticket at the request of driftx in IRC.  &lt;/p&gt;

&lt;p&gt;I&apos;ve attached the files I&apos;m attempting to load (this is fabricated test data for 100 keys).  I generated this using SSTableSimpleUnsortedWriter. I have four dedicated nodes (mine, not ec2 or other cloud host) that I&apos;m using, we&apos;ll call them A,B,C, and D.  I first start cassandra on node A and create the test keyspace and CF:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;create keyspace test
  with placement_strategy = &lt;span class=&quot;code-quote&quot;&gt;&apos;SimpleStrategy&apos;&lt;/span&gt;
  and strategy_options = {replication_factor : 1}
  and durable_writes = &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;;

use test;

create column family test
  with column_type = &lt;span class=&quot;code-quote&quot;&gt;&apos;Super&apos;&lt;/span&gt;
  and comparator = &lt;span class=&quot;code-quote&quot;&gt;&apos;UTF8Type&apos;&lt;/span&gt;
  and subcomparator = &lt;span class=&quot;code-quote&quot;&gt;&apos;UTF8Type&apos;&lt;/span&gt;
  and default_validation_class = &lt;span class=&quot;code-quote&quot;&gt;&apos;UTF8Type&apos;&lt;/span&gt;
  and key_validation_class = &lt;span class=&quot;code-quote&quot;&gt;&apos;UTF8Type&apos;&lt;/span&gt;
  and rows_cached = 0.0
  and row_cache_save_period = 0
  and row_cache_keys_to_save = 2147483647
  and keys_cached = 200000.0
  and key_cache_save_period = 14400
  and read_repair_chance = 1.0
  and gc_grace = 864000
  and min_compaction_threshold = 4
  and max_compaction_threshold = 32
  and replicate_on_write = &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;
  and row_cache_provider = &lt;span class=&quot;code-quote&quot;&gt;&apos;ConcurrentLinkedHashCacheProvider&apos;&lt;/span&gt;
  and compaction_strategy = &lt;span class=&quot;code-quote&quot;&gt;&apos;org.apache.cassandra.db.compaction.SizeTieredCompactionStrategy&apos;&lt;/span&gt;;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Then I perform a load using sstableloader from node D, which works fine with the following output:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;Starting client (and waiting 30 seconds &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; gossip) ...
 INFO 09:12:17,660 Loading settings from file:/opt/apache-cassandra-1.0.1/conf/cassandra.yaml
 INFO 09:12:17,761 DiskAccessMode &lt;span class=&quot;code-quote&quot;&gt;&apos;auto&apos;&lt;/span&gt; determined to be mmap, indexAccessMode is mmap
 INFO 09:12:17,771 Global memtable threshold is enabled at 75MB
 INFO 09:12:17,917 Starting up client gossip
 INFO 09:12:17,934 Starting Messaging Service on port 7000
 INFO 09:12:19,941 Node /172.21.31.244 is now part of the cluster
 INFO 09:12:19,941 InetAddress /172.21.31.244 is now UP
 INFO 09:12:48,003 Opening test/test-h-1 (2884 bytes)
 INFO 09:12:48,017 JNA not found. Native methods will be disabled.
Streaming revelant part of test/test-h-1-Data.db to [/172.21.31.244]
 INFO 09:12:48,052 Stream context metadata [test/test-h-1-Data.db sections=1 progress=0/2884 - 0%], 1 sstables.
 INFO 09:12:48,053 Streaming to /172.21.31.244

progress: [/172.21.31.244 0/1 (0)] [total: 0 - 0MB/s (avg: 0MB/s)] INFO 09:12:48,103 Shutting down MessageService...
 INFO 09:12:48,103 Waiting &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; in-progress requests to complete
 INFO 09:12:48,104 MessagingService shutting down server thread.
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Then I start over by shutting cassandra, deleting all of the data and commitlog dirs, starting cassandra on Node A and Node B and creating the same keyspace and CF.  When I run the loader against that, I get:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;Starting client (and waiting 30 seconds &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; gossip) ...
 INFO 09:15:09,316 Loading settings from file:/opt/apache-cassandra-1.0.1/conf/cassandra.yaml
 INFO 09:15:09,417 DiskAccessMode &lt;span class=&quot;code-quote&quot;&gt;&apos;auto&apos;&lt;/span&gt; determined to be mmap, indexAccessMode is mmap
 INFO 09:15:09,427 Global memtable threshold is enabled at 75MB
 INFO 09:15:09,572 Starting up client gossip
 INFO 09:15:09,591 Starting Messaging Service on port 7000
 INFO 09:15:10,777 Node /172.21.31.244 is now part of the cluster
 INFO 09:15:10,778 InetAddress /172.21.31.244 is now UP
 INFO 09:15:10,780 Node /172.21.31.245 is now part of the cluster
 INFO 09:15:10,781 InetAddress /172.21.31.245 is now UP
 INFO 09:15:39,664 Opening test/test-h-1 (2884 bytes)
 INFO 09:15:39,691 JNA not found. Native methods will be disabled.
Streaming revelant part of test/test-h-1-Data.db to [/172.21.31.244, /172.21.31.245]
 INFO 09:15:39,730 Stream context metadata [test/test-h-1-Data.db sections=1 progress=0/274 - 0%], 1 sstables.
 INFO 09:15:39,731 Streaming to /172.21.31.244
 INFO 09:15:39,743 Stream context metadata [test/test-h-1-Data.db sections=2 progress=0/2610 - 0%], 1 sstables.
 INFO 09:15:39,743 Streaming to /172.21.31.245

progress: [/172.21.31.244 0/1 (0)] [/172.21.31.245 0/1 (0)] [total: 0 - 0MB/s (avg: 0MB/s)]Exception in thread &lt;span class=&quot;code-quote&quot;&gt;&quot;MiscStage:1&quot;&lt;/span&gt; java.lang.AssertionError: Reference counter -1 &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; test/test-h-1-Data.db
	at org.apache.cassandra.io.sstable.SSTableReader.releaseReference(SSTableReader.java:715)
	at org.apache.cassandra.streaming.StreamOutSession.startNext(StreamOutSession.java:123)
	at org.apache.cassandra.streaming.StreamReplyVerbHandler.doVerb(StreamReplyVerbHandler.java:59)
	at org.apache.cassandra.net.MessageDeliveryTask.run(MessageDeliveryTask.java:59)
	at java.util.concurrent.ThreadPoolExecutor$Worker.runTask(ThreadPoolExecutor.java:885)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:907)
	at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:619)
Exception in thread &lt;span class=&quot;code-quote&quot;&gt;&quot;MiscStage:2&quot;&lt;/span&gt; java.lang.AssertionError: Reference counter -2 &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; test/test-h-1-Data.db
	at org.apache.cassandra.io.sstable.SSTableReader.releaseReference(SSTableReader.java:715)
	at org.apache.cassandra.streaming.StreamOutSession.close(StreamOutSession.java:150)
	at org.apache.cassandra.streaming.StreamOutSession.close(StreamOutSession.java:132)
	at org.apache.cassandra.streaming.StreamReplyVerbHandler.doVerb(StreamReplyVerbHandler.java:67)
	at org.apache.cassandra.net.MessageDeliveryTask.run(MessageDeliveryTask.java:59)
	at java.util.concurrent.ThreadPoolExecutor$Worker.runTask(ThreadPoolExecutor.java:885)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:907)
	at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:619)
progress: [/172.21.31.244 1/1 (100)] [/172.21.31.245 1/1 (100)] [total: 100 - 0MB/s (avg: 0MB/s)]
Waiting &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; targets to rebuild indexes ...
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;After that, it never exists.  There are on errors in the logs on the server side for either node.  Additional tests with larger inputs that show the same general error show slightly different behavior, specifically the progress on all but the first node gets past 1/N.  For example, this is the last line on a test of a real data set that had 16 sstables: &quot;progress: &lt;span class=&quot;error&quot;&gt;&amp;#91;/172.21.31.244 16/16 (100)&amp;#93;&lt;/span&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;/172.21.31.245 1/16 (6)&amp;#93;&lt;/span&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;total: 19 - 0MB/s (avg: 3MB/s)&amp;#93;&lt;/span&gt;]&quot;... and it never progresses from there, and avg drops to zero over time indicating nothing is happening.  &lt;/p&gt;

&lt;p&gt;I haven&apos;t replicated on any previous versions. &lt;/p&gt;</description>
                <environment></environment>
        <key id="12529656">CASSANDRA-3438</key>
            <summary>sstableloader fails</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10002" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Normal</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="slebresne">Sylvain Lebresne</assignee>
                                    <reporter username="jeremypinkham">Jeremy Pinkham</reporter>
                        <labels>
                    </labels>
                <created>Tue, 1 Nov 2011 13:35:18 +0000</created>
                <updated>Tue, 16 Apr 2019 09:32:47 +0000</updated>
                            <resolved>Fri, 4 Nov 2011 07:53:55 +0000</resolved>
                                        <fixVersion>1.0.2</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                                                                <comments>
                            <comment id="13143278" author="slebresne" created="Thu, 3 Nov 2011 16:21:06 +0000"  >&lt;p&gt;The sstableloader was just forgetting to acquire references. Patch attached to fix (the patch also attach a very minor cosmetic fix for the progress bar always looks like it did completed the transfer).&lt;/p&gt;</comment>
                            <comment id="13143356" author="jbellis" created="Thu, 3 Nov 2011 17:33:17 +0000"  >&lt;p&gt;is this something we could add a unit test for?&lt;/p&gt;</comment>
                            <comment id="13143524" author="slebresne" created="Thu, 3 Nov 2011 20:57:12 +0000"  >&lt;p&gt;Probably but painfully as everything that has to do with streaming. But I can have a look. In the meantime I would prefer committing this to be sure it makes 1.0.2 as I&apos;m sure that not acquire references was bad.&lt;/p&gt;</comment>
                            <comment id="13143646" author="jbellis" created="Fri, 4 Nov 2011 00:21:46 +0000"  >&lt;p&gt;+1 then&lt;/p&gt;</comment>
                            <comment id="13143811" author="slebresne" created="Fri, 4 Nov 2011 07:53:55 +0000"  >&lt;p&gt;Committed (writing the unit test is on my todo list &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;)&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12502173" name="3438.patch" size="2503" author="slebresne" created="Thu, 3 Nov 2011 16:21:06 +0000"/>
                            <attachment id="12501769" name="test-h-1-Data.db" size="2540" author="jeremypinkham" created="Tue, 1 Nov 2011 13:36:01 +0000"/>
                            <attachment id="12501770" name="test-h-1-Index.db" size="230" author="jeremypinkham" created="Tue, 1 Nov 2011 13:36:01 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[slebresne]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>215515</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            14 years, 3 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0gjwn:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>94655</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>jbellis</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[jbellis]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12962"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>