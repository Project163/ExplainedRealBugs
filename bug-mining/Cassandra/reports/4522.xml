<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 23:05:26 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-12791] MessageIn logic to determine if the message is cross-node is wrong</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-12791</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;&lt;tt&gt;MessageIn&lt;/tt&gt; has the following code to read the &apos;creation time&apos; of the message on the receiving side:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;public static ConstructionTime readTimestamp(InetAddress from, DataInputPlus input, long timestamp) throws IOException
{
    // make sure to readInt, even if cross_node_to is not enabled
    int partial = input.readInt();
    long crossNodeTimestamp = (timestamp &amp;amp; 0xFFFFFFFF00000000L) | (((partial &amp;amp; 0xFFFFFFFFL) &amp;lt;&amp;lt; 2) &amp;gt;&amp;gt; 2);
    if (timestamp &amp;gt; crossNodeTimestamp)
    {
        MessagingService.instance().metrics.addTimeTaken(from, timestamp - crossNodeTimestamp);
    }
    if(DatabaseDescriptor.hasCrossNodeTimeout())
    {
        return new ConstructionTime(crossNodeTimestamp, timestamp != crossNodeTimestamp);
    }
    else
    {
        return new ConstructionTime();
    }
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;where &lt;tt&gt;timestamp&lt;/tt&gt; is really the local time on the receiving node when calling that method.&lt;/p&gt;

&lt;p&gt;The incorrect part, I believe, is the &lt;tt&gt;timestamp != crossNodeTimestamp&lt;/tt&gt; used to set the &lt;tt&gt;isCrossNode&lt;/tt&gt; field of &lt;tt&gt;ConstructionTime&lt;/tt&gt;. A first problem is that this will basically always be &lt;tt&gt;true&lt;/tt&gt;: for it to be &lt;tt&gt;false&lt;/tt&gt;, we&apos;d need the low-bytes of the timestamp taken on the sending node to coincide exactly with the ones taken on the receiving side, which is &lt;em&gt;very&lt;/em&gt; unlikely. It is also a relatively meaningless test: having that test be &lt;tt&gt;false&lt;/tt&gt; basically means the lack of clock sync between the 2 nodes is exactly the time the 2 calls to &lt;tt&gt;System.currentTimeMillis()&lt;/tt&gt; (on sender and receiver), which is definitively not what we care about.&lt;/p&gt;

&lt;p&gt;What the result of this test is used for is to determine if the message was crossNode or local. It&apos;s used to increment different metrics (we separate metric local versus crossNode dropped messages) in &lt;tt&gt;MessagingService&lt;/tt&gt; for instance. And that&apos;s where this is kind of a bug: not only the &lt;tt&gt;timestamp != crossNodeTimestamp&lt;/tt&gt;, but if &lt;tt&gt;DatabaseDescriptor.hasCrossNodeTimeout()&lt;/tt&gt;, we &lt;b&gt;always&lt;/b&gt; have this &lt;tt&gt;isCrossNode&lt;/tt&gt; false, which means we&apos;ll never increment the &quot;cross-node dropped messages&quot; metric, which is imo unexpected.&lt;/p&gt;

&lt;p&gt;That is, it is true that if &lt;tt&gt;DatabaseDescriptor.hasCrossNodeTimeout() == false&lt;/tt&gt;, then we end using the receiver side timestamp to timeout messages, and so you end up only dropping messages that timeout locally. And &lt;em&gt;in that sense&lt;/em&gt;, always incrementing the &quot;locally&quot; dropped messages metric is not completely illogical. But I doubt most users are aware of those pretty specific nuance when looking at the related metrics, and I&apos;m relatively sure users expect a metrics named &lt;tt&gt;droppedCrossNodeTimeout&lt;/tt&gt; to actually count cross-node messages by default (keep in mind that &lt;tt&gt;DatabaseDescriptor.hasCrossNodeTimeout()&lt;/tt&gt; is actually false by default).&lt;/p&gt;

&lt;p&gt;Anyway, to sum it up I suggest that the following change should be done:&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;the &lt;tt&gt;timestamp != crossNodeTimestamp&lt;/tt&gt; test is definitively not what we want. We should at a minimum just replace it to &lt;tt&gt;true&lt;/tt&gt; as that&apos;s basically what it ends up being except for very rare and arguably random cases.&lt;/li&gt;
	&lt;li&gt;given how the &lt;tt&gt;ConstructionTime.isCrossNode&lt;/tt&gt; is used, I suggest that we really want it to mean if the message has shipped cross-node, not just be a synonymous of &lt;tt&gt;DatabaseDescriptor.hasCrossNodeTimeout()&lt;/tt&gt;. It should be whether the message shipped cross-node, i.e. whether &lt;tt&gt;from == BroadcastAdress()&lt;/tt&gt; or not.&lt;/li&gt;
&lt;/ol&gt;
</description>
                <environment></environment>
        <key id="13012388">CASSANDRA-12791</key>
            <summary>MessageIn logic to determine if the message is cross-node is wrong</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10003" iconUrl="https://issues.apache.org/jira/images/icons/priorities/trivial.svg">Low</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="slebresne">Sylvain Lebresne</assignee>
                                    <reporter username="slebresne">Sylvain Lebresne</reporter>
                        <labels>
                    </labels>
                <created>Fri, 14 Oct 2016 15:37:40 +0000</created>
                <updated>Tue, 16 Apr 2019 09:30:17 +0000</updated>
                            <resolved>Thu, 3 Nov 2016 08:11:49 +0000</resolved>
                                        <fixVersion>3.10</fixVersion>
                                    <component>Legacy/Observability</component>
                    <component>Legacy/Streaming and Messaging</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="15575693" author="slebresne" created="Fri, 14 Oct 2016 15:49:04 +0000"  >&lt;p&gt;I&apos;m attaching a patch with the changes described above:&lt;/p&gt;
&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;a href=&quot;https://github.com/pcmanus/cassandra/commits/12791-trunk&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;12791-trunk&lt;/a&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;a href=&quot;http://cassci.datastax.com/job/pcmanus-12791-trunk-testall&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;utests&lt;/a&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;a href=&quot;http://cassci.datastax.com/job/pcmanus-12791-trunk-dtest&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;dtests&lt;/a&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;


&lt;p&gt;The patch actually does 2 (less important) things on top of the points above:&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;it uses &lt;tt&gt;ApproximateTime.currentTimeMillis()&lt;/tt&gt; for anything related to the message &quot;construction time&quot; timestamp. This was currently a bit inconsistent in that the timestamp was set using &lt;tt&gt;System.currentTimeMillis()&lt;/tt&gt; but later compared to &lt;tt&gt;ApproximateTime.currentTimeMillis()&lt;/tt&gt;. This is not really a problem in practice but I&apos;m a stickler for consistency so that was bugging me.&lt;/li&gt;
	&lt;li&gt;the patch gets rid of the &lt;tt&gt;ConstructionTime&lt;/tt&gt; class. This is arguably a bit of a personal opinion here since the behavior of that class is still there, it&apos;s just somewhat &quot;inlined&quot; in &lt;tt&gt;MessageIn&lt;/tt&gt;/&lt;tt&gt;Monitorable&lt;/tt&gt;. The reason is that after this patch, grouping the 2 infos of that class (timestamp and isCrossNode boolean) together doesn&apos;t make sense to me: the &lt;tt&gt;isCrossNode&lt;/tt&gt; property is one of message/operation, not of the timestamp.&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;Also, the patch is currently against trunk. It&apos;s probably worth at least putting it 3.X though, so unless object to that I&apos;ll rebase to that branch once I have test results for trunk. I&apos;m not sure it&apos;s worth bothering with 3.0 though: as said in the description, I consider it kind of a bug in that not having &quot;crossNode&quot; metrics be incremented by default will almost surely surprise users, but it&apos;s also fairly minor and could be called a &quot;weird behavior&quot;.&lt;/p&gt;</comment>
                            <comment id="15581110" author="stefania" created="Mon, 17 Oct 2016 03:47:09 +0000"  >&lt;p&gt;The patch is fine, I&apos;m not opposed to removing &lt;tt&gt;ConstructionTime&lt;/tt&gt; given that the meaning of &lt;tt&gt;isCrossNode&lt;/tt&gt; now becomes a property of the message rather than the timestamp. Also, I think 3.X is reasonable for this patch because &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-10580&quot; title=&quot;Add latency metrics for dropped messages&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-10580&quot;&gt;&lt;del&gt;CASSANDRA-10580&lt;/del&gt;&lt;/a&gt; was added in 3.2, see below.&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;And that&apos;s where this is kind of a bug: not only the timestamp != crossNodeTimestamp, but if DatabaseDescriptor.hasCrossNodeTimeout(), we always have this isCrossNode false, which means we&apos;ll never increment the &quot;cross-node dropped messages&quot; metric, which is imo unexpected.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;The confusion is due to the fact that &lt;tt&gt;ConstructionTime.isCrossNode&lt;/tt&gt; was intended to be a property of the construction timestamp, as it indicates whether the timestamp originated at the sender or at the receiver, the intent was not to indicate that the message itself is cross node, although comparing the timestamps to determine this was incorrect. &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-10580&quot; title=&quot;Add latency metrics for dropped messages&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-10580&quot;&gt;&lt;del&gt;CASSANDRA-10580&lt;/del&gt;&lt;/a&gt; added the metrics in messaging service later on, and the comments in the code indicate that the metrics refer to the actual messages being local vs. cross node, but using &lt;tt&gt;isCrossNodeTimeout&lt;/tt&gt; in messaging service was not correct. &lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;Anyway, to sum it up I suggest that the following change should be done:&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;the timestamp != crossNodeTimestamp test is definitively not what we want. We should at a minimum just replace it to true as that&apos;s basically what it ends up being except for very rare and arguably random cases.&lt;/li&gt;
	&lt;li&gt;given how the ConstructionTime.isCrossNode is used, I suggest that we really want it to mean if the message has shipped cross-node, not just be a synonymous of DatabaseDescriptor.hasCrossNodeTimeout(). It should be whether the message shipped cross-node, i.e. whether from == BroadcastAdress() or not.&lt;/li&gt;
&lt;/ol&gt;
&lt;/blockquote&gt;

&lt;p&gt;&lt;tt&gt;timestamp != crossNodeTimestamp&lt;/tt&gt; orginates from this &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-9793?focusedCommentId=14635441&amp;amp;page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-14635441&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;comment&lt;/a&gt; from &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-9793&quot; title=&quot;Log when messages are dropped due to cross_node_timeout&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-9793&quot;&gt;&lt;del&gt;CASSANDRA-9793&lt;/del&gt;&lt;/a&gt;. It is not only used for the metrics in MessagingService but also for distinguishing messages dropped due to a cross node timeout vs. a local timeout in the logs. The intent is to help operators work out if messages are dropped because of clock skew. So, at this line &lt;a href=&quot;https://github.com/pcmanus/cassandra/commit/0f3d7f6318be11b095bbe21d0c848da6409d1a93#diff-af09288f448c37a525e831ee90ea49f9R1204&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;here&lt;/a&gt;, we need to also check &lt;tt&gt;DD.hasCrossNodeTimeout()&lt;/tt&gt;, a message originating cross node is not sufficient. &lt;/p&gt;

&lt;p&gt;&lt;tt&gt;isCrossNodeTimeout&lt;/tt&gt; is probably a misleading name now, and should become simply &lt;tt&gt;isCrossNode&lt;/tt&gt;.&lt;/p&gt;

&lt;p&gt;I would like to give a heads up to &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=brandon.williams&quot; class=&quot;user-hover&quot; rel=&quot;brandon.williams&quot;&gt;brandon.williams&lt;/a&gt; to make sure he agrees that it&apos;s OK, from an operator point of view, to classify a dropped message in the logs as dropped due to cross node timeout if:&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;the message originates from a different node&lt;/li&gt;
	&lt;li&gt;&lt;tt&gt;DD.hasCrossNodeTimeout()&lt;/tt&gt; is true&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;given that it is extremely rare for a message to be received in the same millisecond and have the machines perfectly synchronized and, if the machines are not synchronized, then we can still have an identical timestamp due to chance, so the best thing we can do is look at the yaml property.&lt;/p&gt;

&lt;p&gt;As for the rest of the patch:&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;There a typo at the end of this &lt;a href=&quot;https://github.com/pcmanus/cassandra/commit/0f3d7f6318be11b095bbe21d0c848da6409d1a93#diff-2578da7d6bbdd276157604856543cbecR43&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;line&lt;/a&gt;, the &lt;tt&gt;:&lt;/tt&gt; should be &lt;tt&gt;;&lt;/tt&gt;, this is the reason for the failures in &lt;tt&gt;MonitoringTaskTest&lt;/tt&gt; and all of the dtests.&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;Another typo &lt;a href=&quot;https://github.com/pcmanus/cassandra/commit/0f3d7f6318be11b095bbe21d0c848da6409d1a93#diff-70a9824fd63a5f3970840e376918da3eR137&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;here&lt;/a&gt; in the comments: &lt;tt&gt;lower&lt;/tt&gt; -&amp;gt; &lt;tt&gt;higher&lt;/tt&gt;.&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="15582483" author="brandon.williams" created="Mon, 17 Oct 2016 15:01:18 +0000"  >&lt;p&gt;Yep, that&apos;s totally fine by me, I&apos;ve never seen a case of this being misreported, and reporting it, but knowing if it was due to cross-node is fairly critical, troubleshooting this scenario before we distinguished was pretty hellacious.&lt;/p&gt;</comment>
                            <comment id="15610550" author="stefania" created="Thu, 27 Oct 2016 03:45:42 +0000"  >&lt;p&gt;Because &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=slebresne&quot; class=&quot;user-hover&quot; rel=&quot;slebresne&quot;&gt;slebresne&lt;/a&gt; is out, I&apos;ve rebased and applied the code review changes to these branches:&lt;/p&gt;

&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;3.X&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;trunk&lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/stef1927/cassandra/tree/12791-3.X&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;patch&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/stef1927/cassandra/tree/12791&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;patch&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/stef1927/job/stef1927-12791-3.X-testall/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;testall&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/stef1927/job/stef1927-12791-testall/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;testall&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/stef1927/job/stef1927-12791-3.X-dtest/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;dtest&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/stef1927/job/stef1927-12791-dtest/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;dtest&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;


&lt;p&gt;CI is still pending.&lt;/p&gt;</comment>
                            <comment id="15613928" author="stefania" created="Fri, 28 Oct 2016 01:32:50 +0000"  >&lt;p&gt;Ci is clean, we had a jackpot in fact, 4/4 jobs with no failures. Just waiting for Sylvain to take a final look at the code review changes before committing.&lt;/p&gt;</comment>
                            <comment id="15621787" author="slebresne" created="Mon, 31 Oct 2016 10:11:05 +0000"  >&lt;blockquote&gt;&lt;p&gt;The intent is to help operators work out if messages are dropped because of clock skew.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;we need to also check DD.hasCrossNodeTimeout(), a message originating cross node is not sufficient.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I don&apos;t I agree tbh. Adding the &lt;tt&gt;DD.hasCrossNodeTimeout()&lt;/tt&gt; check is losing information and creating a somewhat confusing metric, but I disagree it&apos;s really adding value. To quote Brandon on the original ticket, knowing if messages are dropped of clock skew &quot;is easily derived from the yaml&quot;. Namely, if you do see a lot of cross-node dropped message but no local/internal ones, then it&apos;s a fair sign this may be due to clock skew and you can then simply check if &lt;tt&gt;DD.hasCrossNodeTimeout()&lt;/tt&gt; is set or not to confirm.&lt;/p&gt;

&lt;p&gt;So adding the &lt;tt&gt;DD.hasCrossNodeTimeout()&lt;/tt&gt; check does not really add any information that you can&apos;t easily infer otherwise, but adding it does mean that when the option is &lt;tt&gt;false&lt;/tt&gt; (the default as it happens), then the cross-node metric will never-ever get incremented. And I can&apos;t shake the feeling that it&apos;s going to be confusing for most users.I mean, they see we have 2 different metrics, but only seeing lhe &quot;local&quot; one ever get incremented might make them think only locally delivered message are dropped for some weird reason.&lt;/p&gt;

&lt;p&gt;Anyway, I don&apos;t care tremendously about it (I was mostly bugged by the broken logic in &lt;tt&gt;MessageIn&lt;/tt&gt; after all) but I do think it&apos;s strictly better &lt;b&gt;without&lt;/b&gt; the check to &lt;tt&gt;DD.hasCrossNodeTimeout()&lt;/tt&gt; in &lt;tt&gt;MS.incrementDroppedMessage()&lt;/tt&gt;. I&apos;m good with the rest of the changes though.&lt;/p&gt;</comment>
                            <comment id="15624015" author="stefania" created="Tue, 1 Nov 2016 01:39:37 +0000"  >&lt;p&gt;I was trying to preserve the behavior of &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-9793&quot; title=&quot;Log when messages are dropped due to cross_node_timeout&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-9793&quot;&gt;&lt;del&gt;CASSANDRA-9793&lt;/del&gt;&lt;/a&gt;. However, it is true that knowing if cross-node-timeout is enabled can be easily derived from yaml, and I hadn&apos;t noticed that &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-10580&quot; title=&quot;Add latency metrics for dropped messages&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-10580&quot;&gt;&lt;del&gt;CASSANDRA-10580&lt;/del&gt;&lt;/a&gt; added the latency to the same log message. So I agree that it is better to have the number of dropped messages and latency match.&lt;/p&gt;

&lt;p&gt;I&apos;ve amended the log message in &lt;a href=&quot;https://github.com/stef1927/cassandra/commit/39168a3eb8e43815e4001521d2793d59c227f9ee&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;this commit&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;CI still pending.&lt;/p&gt;</comment>
                            <comment id="15628229" author="slebresne" created="Wed, 2 Nov 2016 08:41:09 +0000"  >&lt;p&gt;I&apos;m +1 with this last commit if CI is ok.&lt;/p&gt;</comment>
                            <comment id="15631199" author="stefania" created="Thu, 3 Nov 2016 01:53:27 +0000"  >&lt;p&gt;A dtest on trunk &lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/stef1927/job/stef1927-12791-dtest/lastCompletedBuild/testReport/materialized_views_test/TestMaterializedViews/drop_column_test_2/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;failed&lt;/a&gt; because the node did not start, it didn&apos;t even produce any logs. I think it&apos;s an unrelated test environment problem, but nonetheless I&apos;ve relaunched the dtests on trunk after squashing and rebasing.&lt;/p&gt;

&lt;p&gt;I am assuming the 3.10 vote is going to fail, so I&apos;ve put the patch under 3.10 in CHANGES.txt.&lt;/p&gt;

&lt;p&gt;I will commit if the dtests on trunk are fine.&lt;/p&gt;</comment>
                            <comment id="15632012" author="stefania" created="Thu, 3 Nov 2016 08:11:49 +0000"  >&lt;p&gt;Committed to 3.X as 9d9a1a12248eb37affd0cb131c8aa4f658c3bcc9 and merged into trunk.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[slebresne]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 2 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i34win:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>stefania</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[stefania]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12961"><![CDATA[Low]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>