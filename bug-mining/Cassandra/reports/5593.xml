<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 23:18:41 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-16358] Minor Flakiness in ProxyHandlerConnectionsTest#testExpireSomeFromBatch</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-16358</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;This seems only to be failing in ci-cassandra, but it fails across cdc, compression, and normal configurations there. The only failure recent enough to be retained is here:&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://ci-cassandra.apache.org/job/Cassandra-devbranch/268/testReport/org.apache.cassandra.net/ProxyHandlerConnectionsTest/testExpireSomeFromBatch_compression_2/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://ci-cassandra.apache.org/job/Cassandra-devbranch/268/testReport/org.apache.cassandra.net/ProxyHandlerConnectionsTest/testExpireSomeFromBatch_compression_2/&lt;/a&gt;&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;org.apache.cassandra.net.ProxyHandlerConnectionsTest.testExpireSomeFromBatch-compression (from org.apache.cassandra.net.ProxyHandlerConnectionsTest-compression)

Error Message

Expired: 8, Arrived: 10

Stacktrace

junit.framework.AssertionFailedError: Expired: 8, Arrived: 10
	at org.apache.cassandra.net.ProxyHandlerConnectionsTest.waitForCondition(ProxyHandlerConnectionsTest.java:285)
	at org.apache.cassandra.net.ProxyHandlerConnectionsTest.lambda$testExpireSomeFromBatch$23(ProxyHandlerConnectionsTest.java:210)
	at org.apache.cassandra.net.ProxyHandlerConnectionsTest.doTestManual(ProxyHandlerConnectionsTest.java:378)
	at org.apache.cassandra.net.ProxyHandlerConnectionsTest.testManual(ProxyHandlerConnectionsTest.java:337)
	at org.apache.cassandra.net.ProxyHandlerConnectionsTest.testExpireSomeFromBatch(ProxyHandlerConnectionsTest.java:169)
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)

Standard Output

DEBUG [main] 2020-12-15 20:36:43,018 InternalLoggerFactory.java:45 - Using SLF4J as the default logging framework
DEBUG [main] 2020-12-15 20:36:43,043 PlatformDependent0.java:417 - -Dio.netty.noUnsafe: false
DEBUG [main] 2020-12-15 20:36:43,044 PlatformDependent0.java:897 - Java version: 8
DEBUG [main] 2020-12-15 20:36:43,044 PlatformDependent0.java:130 - sun.misc.Unsafe.theUnsafe: available
DEBUG [main] 2020-12-15 20:36:43,045 PlatformDependent0.java:154 - sun.misc.Unsafe.copyMemory: available

...[truncated 394654 chars]...
ol$Initiate.maybeDecode(HandshakeProtocol.java:167)
	at org.apache.cassandra.net.InboundConnectionInitiator$Handler.initiate(InboundConnectionInitiator.java:242)
	at org.apache.cassandra.net.InboundConnectionInitiator$Handler.decode(InboundConnectionInitiator.java:235)
	at io.netty.handler.codec.ByteToMessageDecoder.decodeRemovalReentryProtection(ByteToMessageDecoder.java:501)
	at io.netty.handler.codec.ByteToMessageDecoder.callDecode(ByteToMessageDecoder.java:440)
	... 29 common frames omitted
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;There are a number of historical failures listed here, but the runs that produced them have not been retained:&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://ci-cassandra.apache.org/job/Cassandra-trunk/207/testReport/junit/org.apache.cassandra.net/ProxyHandlerConnectionsTest/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://ci-cassandra.apache.org/job/Cassandra-trunk/207/testReport/junit/org.apache.cassandra.net/ProxyHandlerConnectionsTest/&lt;/a&gt;&lt;/p&gt;</description>
                <environment></environment>
        <key id="13346423">CASSANDRA-16358</key>
            <summary>Minor Flakiness in ProxyHandlerConnectionsTest#testExpireSomeFromBatch</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10002" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Normal</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="brandon.williams">Brandon Williams</assignee>
                                    <reporter username="maedhroz">Caleb Rackliffe</reporter>
                        <labels>
                    </labels>
                <created>Wed, 16 Dec 2020 19:29:03 +0000</created>
                <updated>Fri, 10 Oct 2025 08:47:57 +0000</updated>
                            <resolved>Thu, 18 Feb 2021 23:20:37 +0000</resolved>
                                        <fixVersion>4.0-rc1</fixVersion>
                    <fixVersion>4.0</fixVersion>
                                    <component>Test/unit</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                    <progress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                            <timeestimate seconds="0">0h</timeestimate>
                            <timespent seconds="1800">0.5h</timespent>
                                <comments>
                            <comment id="17267119" author="bereng" created="Mon, 18 Jan 2021 09:24:57 +0000"  >&lt;p&gt;The test looks right. Most failures I could track down are half-way through completed the problem being it is a time sensitive test. That aligns to the flakiness that can be observed in heavily loaded envs such as ci-cass. I raised timeout for the time being. If that still causes issues then we&apos;d have to look into refactoring the whole test and remove the time sensitiveness.&lt;/p&gt;</comment>
                            <comment id="17267460" author="adelapena" created="Mon, 18 Jan 2021 18:39:09 +0000"  >&lt;p&gt;I haven&apos;t been able to reproduce the timeout neither locally nor in 100 runs of internal CI. Raising the timeout looks like a good solution to me, +1.&lt;/p&gt;</comment>
                            <comment id="17267814" author="blerer" created="Tue, 19 Jan 2021 10:34:42 +0000"  >&lt;p&gt;Committed into trunk at c0b58de334290590cb4d8d90751a6bd6c9139e33&lt;/p&gt;</comment>
                            <comment id="17269689" author="edimitrova" created="Thu, 21 Jan 2021 23:06:32 +0000"  >&lt;p&gt;Unfortunately, &#160;I saw it again in the latest build:&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://jenkins-cm4.apache.org/job/Cassandra-trunk/244/testReport/junit/org.apache.cassandra.net/ProxyHandlerConnectionsTest/testExpireSomeFromBatch/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://jenkins-cm4.apache.org/job/Cassandra-trunk/244/testReport/junit/org.apache.cassandra.net/ProxyHandlerConnectionsTest/testExpireSomeFromBatch/&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17271295" author="adelapena" created="Mon, 25 Jan 2021 12:56:15 +0000"  >&lt;p&gt;Indeed this is still failing with the same error, we should probably reopen this ticket. I&apos;m running the test method in the multiplexer again (&lt;a href=&quot;https://jenkins-dse.build.dsinternal.org/view/Parameterized/job/parameterized-testall/683/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;here&lt;/a&gt;),&#160;this time with 500 runs. I&apos;m also running the entire suite in the multiplexer (&lt;a href=&quot;https://jenkins-dse.build.dsinternal.org/view/Parameterized/job/parameterized-testall/684/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;here&lt;/a&gt;),&#160;to see if the reproduction depends on interactions.&lt;/p&gt;</comment>
                            <comment id="17271312" author="bereng" created="Mon, 25 Jan 2021 13:39:50 +0000"  >&lt;p&gt;Let&apos;s reopen then. I am deep in another mysterious ticket. I can look at this one next. Thx! &lt;/p&gt;</comment>
                            <comment id="17272067" author="adelapena" created="Tue, 26 Jan 2021 12:14:47 +0000"  >&lt;blockquote&gt;&lt;p&gt;I&apos;m running the test method in the multiplexer again (&lt;a href=&quot;https://jenkins-dse.build.dsinternal.org/view/Parameterized/job/parameterized-testall/683/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;here&lt;/a&gt;), this time with 500 runs. I&apos;m also running the entire suite in the multiplexer (&lt;a href=&quot;https://jenkins-dse.build.dsinternal.org/view/Parameterized/job/parameterized-testall/684/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;here&lt;/a&gt;), to see if the reproduction depends on interactions.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Of the aforementioned runs only the one running the entire &lt;tt&gt;ProxyHandlerConnectionsTest&lt;/tt&gt; suite 100 times has reproduced the error once.&lt;/p&gt;</comment>
                            <comment id="17272584" author="bereng" created="Wed, 27 Jan 2021 05:18:00 +0000"  >&lt;p&gt;Thanks for the info!&lt;/p&gt;</comment>
                            <comment id="17274559" author="rocco.varela" created="Fri, 29 Jan 2021 16:43:07 +0000"  >&lt;p&gt;I was also able to reproduce this issue on an m4.xlarge with 4 cpus with 2 runners (as shown in the example above). I saw 10 failures out of 500 runs. I also noticed with 1 runner on this same instance type the issue did not appear.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;With a m4.2xlarge with 8 cpus, running with 2 runners did not reproduce the issue.&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;I may be stating the obvious, but there appears to be some sensitivity between the number of runners used for parallelizing the tests and the number of cpus available on the host.&lt;/p&gt;</comment>
                            <comment id="17276340" author="edimitrova" created="Mon, 1 Feb 2021 14:00:16 +0000"  >&lt;p&gt;Rocco will not be working on this one more so I am moving it back to unassigned&lt;/p&gt;</comment>
                            <comment id="17286758" author="brandon.williams" created="Thu, 18 Feb 2021 22:52:25 +0000"  >&lt;p&gt;There are a couple problems with this test.  The first is that if messages are dropped, which can often be expected, it results in an NPE that complicates further debugging.  The timeout for this test itself does not actually matter, since it is manipulating timing windows that it later assert results upon.  These all work in a perfect world, but inside the JVM need some relaxing to allow for the real world to get in the way. Patch &lt;a href=&quot;https://github.com/driftx/cassandra/tree/CASSANDRA-16358&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;here&lt;/a&gt;, &lt;a href=&quot;https://ci-cassandra.apache.org/job/Cassandra-devbranch/388/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;CI here&lt;/a&gt;, that addresses both of these.  After being able to reproduce the issue within hundreds of runs, I&apos;ve had success in thousands with this.&lt;/p&gt;</comment>
                            <comment id="17286760" author="edimitrova" created="Thu, 18 Feb 2021 23:12:22 +0000"  >&lt;p&gt;I trust you that you ran it 1000 times(I mean I ran it only a few times locally successfully &#160;but I was not able to reproduce it before &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/sad.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&#160;), code-wise looks good to me. Thanks!&lt;/p&gt;</comment>
                            <comment id="17286764" author="brandon.williams" created="Thu, 18 Feb 2021 23:20:37 +0000"  >&lt;p&gt;Committed in dfdb6e3d8ebd797bbda8bbe5e47b5228a9281839&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[brandon.williams]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12313825" key="com.atlassian.jira.plugin.system.customfieldtypes:cascadingselect">
                        <customfieldname>Bug Category</customfieldname>
                        <customfieldvalues>
                                                    <customfieldvalue key="12982" cascade-level=""><![CDATA[Correctness]]></customfieldvalue>
                                <customfieldvalue key="12990" cascade-level="1"><![CDATA[Test Failure]]></customfieldvalue>
            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12313821" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Complexity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12965"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313822" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Discovered By</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12970"><![CDATA[Unit Test]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12313922" key="jira.plugin.projectspecificselectfield.jpssf:multicftype">
                        <customfieldname>Impacts</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="13100"><![CDATA[None]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            4 years, 38 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12313921" key="jira.plugin.projectspecificselectfield.jpssf:multicftype">
                        <customfieldname>Platform</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="13076"><![CDATA[All]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0lkzk:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[adelapena]]></customfieldvalue>
        <customfieldvalue><![CDATA[blerer]]></customfieldvalue>
        <customfieldvalue><![CDATA[e.dimitrova]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12961"><![CDATA[Low]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12311420" key="com.atlassian.jira.plugin.system.customfieldtypes:version">
                        <customfieldname>Since Version</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="12348281">4.0-alpha1</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313924" key="com.atlassian.jira.plugin.system.customfieldtypes:textfield">
                        <customfieldname>Source Control Link</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>&lt;p&gt;&lt;a href=&quot;https://github.com/apache/cassandra/commit/c0b58de334290590cb4d8d90751a6bd6c9139e33&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/cassandra/commit/c0b58de334290590cb4d8d90751a6bd6c9139e33&lt;/a&gt;&lt;/p&gt;</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313823" key="com.atlassian.jira.plugin.system.customfieldtypes:textarea">
                        <customfieldname>Test and Documentation Plan</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>&lt;p&gt;See PR&lt;/p&gt;</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>