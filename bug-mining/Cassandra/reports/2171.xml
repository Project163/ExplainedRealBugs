<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 22:38:28 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-5569] Every stream operation requires checking indexes in every SSTable</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-5569</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;It looks like there&apos;s a streaming performance issue when leveled compaction and vnodes get together. To get the candidate set of chunks to stream, the streaming system gets references to every SSTable for a CF. This is probably a perfectly reasonable assumption for non-vnode cases, because the data being streamed is likely distributed across the full SSTable set. This is also probably a perfectly reasonable assumption for size-tiered compaction, because the data is, again, likely distributed across the full SSTable set. However, for each vnode repair performed on LCS CF&apos;s, this scan across potentially tens of thousands of SSTables is wasteful considering that only a small percentage of them will actually have data for a given range.&lt;/p&gt;

&lt;p&gt;This manifested itself as &quot;hanging&quot; repair operations with tasks backing up on the MiscStage thread pool.&lt;/p&gt;

&lt;p&gt;The attached patch changes the streaming code so that for a given range, only SSTables for the requested range are checked to be included in streaming.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12647639">CASSANDRA-5569</key>
            <summary>Every stream operation requires checking indexes in every SSTable</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10003" iconUrl="https://issues.apache.org/jira/images/icons/priorities/trivial.svg">Low</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="rbranson">Rick Branson</assignee>
                                    <reporter username="rbranson">Rick Branson</reporter>
                        <labels>
                            <label>streaming</label>
                    </labels>
                <created>Tue, 14 May 2013 23:46:15 +0000</created>
                <updated>Tue, 16 Apr 2019 09:32:12 +0000</updated>
                            <resolved>Thu, 16 May 2013 16:46:08 +0000</resolved>
                                        <fixVersion>1.2.6</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="13657771" author="jbellis" created="Wed, 15 May 2013 00:58:28 +0000"  >&lt;p&gt;This could cause a lot of reference churn, can you make DataTracker.markReferenced take a list of Bounds objects instead so we can uniquify the set before acquiring references?&lt;/p&gt;</comment>
                            <comment id="13657788" author="rbranson" created="Wed, 15 May 2013 01:30:50 +0000"  >&lt;p&gt;How do you feel about the safety of refactoring the markReferenced(RowPosition start, RowPosition end) signature call the new markReferenced to cut down on the duplication between these methods?&lt;/p&gt;</comment>
                            <comment id="13657793" author="jbellis" created="Wed, 15 May 2013 01:35:00 +0000"  >&lt;p&gt;+1&lt;/p&gt;</comment>
                            <comment id="13657909" author="rbranson" created="Wed, 15 May 2013 04:57:35 +0000"  >&lt;p&gt;v2 patch attached.&lt;/p&gt;

&lt;p&gt;Decided not to rock the boat a bunch in terms of allocation &amp;amp; copying on the markReferenced() for the single range common case, which it looks like is the path for a bunch of read operations. This patch contains a refactor that DRYs up the markReferenced() calls.&lt;/p&gt;</comment>
                            <comment id="13658135" author="rbranson" created="Wed, 15 May 2013 07:17:45 +0000"  >&lt;p&gt;It looks like StreamingRepairTask is also suffering this problem. Going to work up a v3 to include that as well.&lt;/p&gt;</comment>
                            <comment id="13658440" author="rbranson" created="Wed, 15 May 2013 15:15:02 +0000"  >&lt;p&gt;&lt;a href=&quot;http://github.com/apache/cassandra/blob/cassandra-1.2/src/java/org/apache/cassandra/streaming/StreamingRepairTask.java#L133&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://github.com/apache/cassandra/blob/cassandra-1.2/src/java/org/apache/cassandra/streaming/StreamingRepairTask.java#L133&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;^^^ is there a good reason we&apos;re calling StreamOut.transferSSTables directly instead of StreamOut.transferRanges?&lt;/p&gt;</comment>
                            <comment id="13658456" author="yukim" created="Wed, 15 May 2013 15:28:07 +0000"  >&lt;p&gt;I think we can use transferRanges there even though we do blocking flush before streaming.&lt;/p&gt;</comment>
                            <comment id="13658468" author="rbranson" created="Wed, 15 May 2013 15:35:55 +0000"  >&lt;p&gt;What I&apos;m working with now is adding a second method signature with a &quot;flush&quot; boolean that allows the behavior to be turned off for StreamingRepairTask.&lt;/p&gt;</comment>
                            <comment id="13658492" author="rbranson" created="Wed, 15 May 2013 16:05:06 +0000"  >&lt;p&gt;v3 patch (rebased against current 1.2 branch).&lt;/p&gt;

&lt;p&gt;Adds the same optimization to StreamingRepairTask. Note that the only apparent difference is that StreamingRepairTask wasn&apos;t doing a blocking flush, so I made that behavior optional in StreamOut.transferRanges(). Also took the opportunity to run through and fix some naming irregularities from the v2 patch.&lt;/p&gt;</comment>
                            <comment id="13658887" author="rbranson" created="Wed, 15 May 2013 22:14:13 +0000"  >&lt;p&gt;FWIW &amp;#8211; we&apos;re running the v3 patch in production on our vnodes + LCS cluster, and repairs are something like 25x faster.&lt;/p&gt;</comment>
                            <comment id="13659695" author="yukim" created="Thu, 16 May 2013 16:46:08 +0000"  >&lt;p&gt;+1 and committed.&lt;br/&gt;
Thanks!&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12583280" name="5569-v2.txt" size="8012" author="rbranson" created="Wed, 15 May 2013 04:57:35 +0000"/>
                            <attachment id="12583333" name="5569-v3.txt" size="9841" author="rbranson" created="Wed, 15 May 2013 16:05:06 +0000"/>
                            <attachment id="12583242" name="5569.txt" size="2109" author="rbranson" created="Tue, 14 May 2013 23:46:48 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[rbranson]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>327995</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            12 years, 27 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1klav:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>328339</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>yukim</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[yukim]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12961"><![CDATA[Low]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>