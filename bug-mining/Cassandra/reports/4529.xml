<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 23:05:29 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-12184] incorrect compaction log information on totalSourceRows in C* pre-3.8 versions</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-12184</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;I was looking at some confusing compaction log information on C* 3.0.7 and realized that we have a bug that was trivially fixed in C* 3.8.&lt;br/&gt;
Basically here is the log entry in debug.log (as most of the compaction related log have been moved to debug.log due to adjustment in &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-10241&quot; title=&quot;Keep a separate production debug log for troubleshooting&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-10241&quot;&gt;&lt;del&gt;CASSANDRA-10241&lt;/del&gt;&lt;/a&gt;).&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;DEBUG [CompactionExecutor:6] 2016-07-12 15:38:28,471  CompactionTask.java:217 - Compacted (96aa1ba6-4846-11e6-adb7-17866fa8ddfd) 4 sstables to [/var/lib/cassandra/data/keyspace1/standard1-713f7920484411e6adb717866fa8ddfd/mb-5-big,] to level=0.  267,974,735 bytes to 78,187,400 (~29% of original) in 39,067ms = 1.908652MB/s.  0 total partitions merged to 332,904.  Partition merge counts were {1:9008, 2:34822, 3:74505, 4:214569, }
DEBUG [CompactionExecutor:4] 2016-07-12 20:51:56,578  CompactionTask.java:217 - Compacted (786cd9d0-4872-11e6-8755-79a37e6d8141) 4 sstables to [/var/lib/cassandra/data/system_schema/indexes-0feb57ac311f382fba6d9024d305702f/mb-25-big,] to level=0.  620 bytes to 498 (~80% of original) in 51ms = 0.009312MB/s.  0 total partitions merged to 6.  Partition merge counts were {1:4, 3:2, }
DEBUG [CompactionExecutor:4] 2016-07-12 20:51:58,345  CompactionTask.java:217 - Compacted (79771de0-4872-11e6-8755-79a37e6d8141) 4 sstables to [/var/lib/cassandra/data/system_schema/columns-24101c25a2ae3af787c1b40ee1aca33f/mb-65-big,] to level=0.  14,113 bytes to 9,553 (~67% of original) in 70ms = 0.130149MB/s.  0 total partitions merged to 16.  Partition merge counts were {1:13, 2:2, 3:1, }
DEBUG [CompactionExecutor:3] 2016-07-12 20:52:00,415  CompactionTask.java:217 - Compacted (7ab6a2c0-4872-11e6-8755-79a37e6d8141) 4 sstables to [/var/lib/cassandra/data/system_schema/keyspaces-abac5682dea631c5b535b3d6cffd0fb6/mb-85-big,] to level=0.  1,066 bytes to 611 (~57% of original) in 48ms = 0.012139MB/s.  0 total partitions merged to 16.  Partition merge counts were {1:13, 2:2, 4:1, }
DEBUG [CompactionExecutor:4] 2016-07-12 20:52:00,442  CompactionTask.java:217 - Compacted (7abae880-4872-11e6-8755-79a37e6d8141) 4 sstables to [/var/lib/cassandra/data/system_schema/tables-afddfb9dbc1e30688056eed6c302ba09/mb-77-big,] to level=0.  6,910 bytes to 4,396 (~63% of original) in 48ms = 0.087341MB/s.  0 total partitions merged to 16.  Partition merge counts were {1:13, 2:2, 3:1, }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Note no matter if it&apos;s system table or user table, it&apos;s always showing &quot;0 total partitions merged to xx&quot;, which is incorrect information due to this code segment &lt;a href=&quot;https://github.com/apache/cassandra/blob/cassandra-3.0.7/src/java/org/apache/cassandra/db/compaction/CompactionTask.java#L215-217&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/cassandra/blob/cassandra-3.0.7/src/java/org/apache/cassandra/db/compaction/CompactionTask.java#L215-217&lt;/a&gt;. Basically it only initialized the totalSourceRows value with 0 and never assigned a real calculated value to it. Looks like the latest &lt;a href=&quot;https://github.com/tjake/cassandra/blob/dc2951d1684777cf70aab401515d755699af99bc/src/java/org/apache/cassandra/db/compaction/CompactionTask.java#L225-226&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;commit&lt;/a&gt; from &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-12080&quot; title=&quot;More detailed compaction log&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-12080&quot;&gt;&lt;del&gt;CASSANDRA-12080&lt;/del&gt;&lt;/a&gt; fixed this problem, but it only got checked into 3.8 branch.&lt;/p&gt;

&lt;p&gt;Since this can make people doubt the accuracy of compaction related log entries, and the changes made in &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-12080&quot; title=&quot;More detailed compaction log&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-12080&quot;&gt;&lt;del&gt;CASSANDRA-12080&lt;/del&gt;&lt;/a&gt; are only log metrics related, low impact changes, I&apos;d advocate we backport the change from &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-12080&quot; title=&quot;More detailed compaction log&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-12080&quot;&gt;&lt;del&gt;CASSANDRA-12080&lt;/del&gt;&lt;/a&gt; into C*-3.0 branch as many people&apos;s production C*-3.0 version can benefit from the bug fix, along with better compaction log information in general. I realize that &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-12080&quot; title=&quot;More detailed compaction log&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-12080&quot;&gt;&lt;del&gt;CASSANDRA-12080&lt;/del&gt;&lt;/a&gt; may be based on the C*-3.6 changes in &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-10805&quot; title=&quot;Additional Compaction Logging&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-10805&quot;&gt;&lt;del&gt;CASSANDRA-10805&lt;/del&gt;&lt;/a&gt;, so this means we may have to bring in changes from &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-10805&quot; title=&quot;Additional Compaction Logging&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-10805&quot;&gt;&lt;del&gt;CASSANDRA-10805&lt;/del&gt;&lt;/a&gt; as well if &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-12080&quot; title=&quot;More detailed compaction log&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-12080&quot;&gt;&lt;del&gt;CASSANDRA-12080&lt;/del&gt;&lt;/a&gt; cannot be cleanly rebased on C*-3.0 branch, but both are going to benefit compaction observability in production on C*-3.0.x versions, so both should be welcomed changes in C*-3.0 branch.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12988926">CASSANDRA-12184</key>
            <summary>incorrect compaction log information on totalSourceRows in C* pre-3.8 versions</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10003" iconUrl="https://issues.apache.org/jira/images/icons/priorities/trivial.svg">Low</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="carlyeks">Carl Yeksigian</assignee>
                                    <reporter username="weideng">Wei Deng</reporter>
                        <labels>
                    </labels>
                <created>Tue, 12 Jul 2016 23:56:26 +0000</created>
                <updated>Tue, 16 Apr 2019 09:30:26 +0000</updated>
                            <resolved>Thu, 10 Nov 2016 15:02:36 +0000</resolved>
                                        <fixVersion>3.0.10</fixVersion>
                                    <component>Legacy/Observability</component>
                    <component>Local/Compaction</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>6</watches>
                                                                                                                <comments>
                            <comment id="15629622" author="carlyeks" created="Wed, 2 Nov 2016 17:04:47 +0000"  >&lt;p&gt;Was down to an issue with a refactoring.&lt;/p&gt;

&lt;p&gt;Just pushed a branch with a fix to capture that when merging the partition counts. Based off of how &lt;tt&gt;CompactionTask&lt;/tt&gt; looked before the commit in &lt;a href=&quot;https://github.com/apache/cassandra/commit/910170c9d10bb6a71922a529b2f070cf27891a10#diff-1e6aa904a845e633b3a7d9693fc6bee5L264&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;910170c&lt;/a&gt;.&lt;/p&gt;

&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;3.0&lt;/th&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/carlyeks/cassandra/tree/ticket/12184/3.0&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;branch&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/carlyeks/job/carlyeks-ticket-12184-3.0-testall/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;utest&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/carlyeks/job/carlyeks-ticket-12184-3.0-dtest/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;dtest&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;
</comment>
                            <comment id="15654215" author="krummas" created="Thu, 10 Nov 2016 14:39:45 +0000"  >&lt;p&gt;+1, I&apos;ll get it committed&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[carlyeks]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 1 week, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i30vvj:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12311421" key="com.atlassian.jira.plugin.system.customfieldtypes:multiversion">
                        <customfieldname>Reproduced In</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="12335694">3.0.7</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>marcuse</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[marcuse]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12961"><![CDATA[Low]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>