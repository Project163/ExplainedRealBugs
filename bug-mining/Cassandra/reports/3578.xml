<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 22:54:14 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-9132] resumable_bootstrap_test can hang</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-9132</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;The &lt;tt&gt;bootstrap_test.TestBootstrap.resumable_bootstrap_test&lt;/tt&gt; can hang sometimes.  It looks like the following line never completes:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;node3.watch_log_for(&quot;Listening for thrift clients...&quot;)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I&apos;m not familiar enough with the recent bootstrap changes to know why that&apos;s not happening.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12819114">CASSANDRA-9132</key>
            <summary>resumable_bootstrap_test can hang</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10002" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Normal</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="yukim">Yuki Morishita</assignee>
                                    <reporter username="thobbs">Tom Hobbs</reporter>
                        <labels>
                    </labels>
                <created>Tue, 7 Apr 2015 23:09:02 +0000</created>
                <updated>Wed, 15 Oct 2025 09:49:01 +0000</updated>
                            <resolved>Tue, 7 Jul 2015 15:48:59 +0000</resolved>
                                        <fixVersion>2.0.15</fixVersion>
                    <fixVersion>2.1.6</fixVersion>
                    <fixVersion>2.2.0 rc1</fixVersion>
                                    <component>Legacy/Testing</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>6</watches>
                                                                                                                <comments>
                            <comment id="14484562" author="philipthompson" created="Wed, 8 Apr 2015 02:15:01 +0000"  >&lt;p&gt;That should timeout after 5 minutes, if that line isn&apos;t found. I assume that isn&apos;t happening? May also be a ccm bug related to the lack of timeout, in addition to whatever is causing that log line not to appear.&lt;/p&gt;</comment>
                            <comment id="14485540" author="thobbs" created="Wed, 8 Apr 2015 17:03:40 +0000"  >&lt;p&gt;I&apos;m not 100% sure that it hung on that line because most of my debug output was being swallowed for some (unknown) reason.  I guessed that was where it was hanging based on the state of the node3 logs (which did not have that line).  &lt;/p&gt;</comment>
                            <comment id="14485887" author="thobbs" created="Wed, 8 Apr 2015 19:48:52 +0000"  >&lt;p&gt;While looking into failures on the similar &lt;tt&gt;replace_address_test.TestReplaceAddress.resumable_replace_test&lt;/tt&gt;, it looks like the problem is that after the stream breaks, a &lt;tt&gt;Retry&lt;/tt&gt; message is sent, but it fails and the failure is swallowed by &lt;tt&gt;OutboundTcpConnection&lt;/tt&gt;.  Here are the relevant debug-level logs from node4 (which is replacing node3; node1 is killed during streaming):&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;WARN  [STREAM-IN-/127.0.0.1] 2015-04-08 14:39:22,312 StreamSession.java: [Stream #f39354c0-de26-11e4-ae5c-6b09a6cc3d5a] Retrying for following error
java.io.IOError: java.io.IOException: EOF in 52430 byte (compressed) block: could only read 12647 bytes
    at org.apache.cassandra.db.AbstractCell$1.computeNext(AbstractCell.java:56) ~[main/:na]
    at org.apache.cassandra.db.AbstractCell$1.computeNext(AbstractCell.java:46) ~[main/:na]
    at com.google.common.collect.AbstractIterator.tryToComputeNext(AbstractIterator.java:143) ~[guava-16.0.jar:na]
    at com.google.common.collect.AbstractIterator.hasNext(AbstractIterator.java:138) ~[guava-16.0.jar:na]
    at org.apache.cassandra.io.sstable.format.big.BigTableWriter.appendFromStream(BigTableWriter.java:227) ~[main/:na]
    at org.apache.cassandra.streaming.StreamReader.writeRow(StreamReader.java:161) ~[main/:na]
    at org.apache.cassandra.streaming.StreamReader.read(StreamReader.java:104) ~[main/:na]
    at org.apache.cassandra.streaming.messages.IncomingFileMessage$1.deserialize(IncomingFileMessage.java:48) [main/:na]
    at org.apache.cassandra.streaming.messages.IncomingFileMessage$1.deserialize(IncomingFileMessage.java:38) [main/:na]
    at org.apache.cassandra.streaming.messages.StreamMessage.deserialize(StreamMessage.java:56) [main/:na]
    at org.apache.cassandra.streaming.ConnectionHandler$IncomingMessageHandler.run(ConnectionHandler.java:251) [main/:na]
    at java.lang.Thread.run(Thread.java:724) [na:1.7.0_40]
Caused by: java.io.IOException: EOF in 52430 byte (compressed) block: could only read 12647 bytes
    at com.ning.compress.lzf.LZFDecoder.readFully(LZFDecoder.java:394) ~[compress-lzf-0.8.4.jar:na]
    at com.ning.compress.lzf.LZFDecoder.decompressChunk(LZFDecoder.java:190) ~[compress-lzf-0.8.4.jar:na]
    at com.ning.compress.lzf.LZFInputStream.readyBuffer(LZFInputStream.java:254) ~[compress-lzf-0.8.4.jar:na]
    at com.ning.compress.lzf.LZFInputStream.read(LZFInputStream.java:129) ~[compress-lzf-0.8.4.jar:na]
    at java.io.DataInputStream.readFully(DataInputStream.java:195) ~[na:1.7.0_40]
    at java.io.DataInputStream.readFully(DataInputStream.java:169) ~[na:1.7.0_40]
    at org.apache.cassandra.utils.BytesReadTracker.readFully(BytesReadTracker.java:94) ~[main/:na]
    at org.apache.cassandra.utils.ByteBufferUtil.read(ByteBufferUtil.java:360) ~[main/:na]
    at org.apache.cassandra.utils.ByteBufferUtil.readWithLength(ByteBufferUtil.java:320) ~[main/:na]
    at org.apache.cassandra.db.ColumnSerializer.deserializeColumnBody(ColumnSerializer.java:132) ~[main/:na]
    at org.apache.cassandra.db.OnDiskAtom$Serializer.deserializeFromSSTable(OnDiskAtom.java:86) ~[main/:na]
    at org.apache.cassandra.db.AbstractCell$1.computeNext(AbstractCell.java:52) ~[main/:na]
    ... 11 common frames omitted
DEBUG [STREAM-OUT-/127.0.0.1] 2015-04-08 14:39:22,313 ConnectionHandler.java: [Stream #f39354c0-de26-11e4-ae5c-6b09a6cc3d5a] Sending Retry (a6c9e410-de26-11e4-a645-6b09a6cc3d5a, #0)
DEBUG [WRITE-/127.0.0.1] 2015-04-08 14:39:23,315 OutboundTcpConnection.java: error writing to /127.0.0.1
java.io.IOException: Broken pipe
    at sun.nio.ch.FileDispatcherImpl.write0(Native Method) ~[na:1.7.0_40]
    at sun.nio.ch.SocketDispatcher.write(SocketDispatcher.java:47) ~[na:1.7.0_40]
    at sun.nio.ch.IOUtil.writeFromNativeBuffer(IOUtil.java:93) ~[na:1.7.0_40]
    at sun.nio.ch.IOUtil.write(IOUtil.java:65) ~[na:1.7.0_40]
    at sun.nio.ch.SocketChannelImpl.write(SocketChannelImpl.java:487) ~[na:1.7.0_40]
    at java.nio.channels.Channels.writeFullyImpl(Channels.java:78) ~[na:1.7.0_40]
    at java.nio.channels.Channels.writeFully(Channels.java:98) ~[na:1.7.0_40]
    at java.nio.channels.Channels.access$000(Channels.java:61) ~[na:1.7.0_40]
    at java.nio.channels.Channels$1.write(Channels.java:174) ~[na:1.7.0_40]
    at net.jpountz.lz4.LZ4BlockOutputStream.flushBufferedData(LZ4BlockOutputStream.java:205) ~[lz4-1.3.0.jar:na]
    at net.jpountz.lz4.LZ4BlockOutputStream.flush(LZ4BlockOutputStream.java:223) ~[lz4-1.3.0.jar:na]
    at org.apache.cassandra.io.util.WrappedDataOutputStreamPlus.flush(WrappedDataOutputStreamPlus.java:66) ~[main/:na]
    at org.apache.cassandra.net.OutboundTcpConnection.writeConnected(OutboundTcpConnection.java:289) [main/:na]
    at org.apache.cassandra.net.OutboundTcpConnection.run(OutboundTcpConnection.java:219) [main/:na]
DEBUG [WRITE-/127.0.0.1] 2015-04-08 14:39:23,316 OutboundTcpConnection.java: attempting to connect to /127.0.0.1
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;After that, no more retry attempts are made.&lt;/p&gt;</comment>
                            <comment id="14492656" author="yukim" created="Mon, 13 Apr 2015 16:57:37 +0000"  >&lt;p&gt;Streaming can be stuck when trying to retry fetching file from downed node.&lt;br/&gt;
Patch attached not to retry when reading file from socket failed.&lt;br/&gt;
This goes back to 2.0, so attached patch is for cassandra-2.0 branch.&lt;/p&gt;</comment>
                            <comment id="14496615" author="jmckenzie" created="Wed, 15 Apr 2015 18:11:27 +0000"  >&lt;p&gt;Should we catch an EOFException rather than all IOException on that clause?&lt;/p&gt;</comment>
                            <comment id="14496688" author="yukim" created="Wed, 15 Apr 2015 18:48:27 +0000"  >&lt;p&gt;That was my first try, though LZFCompressor used in streaming uncompressed file can throw IOException (with indication of EOF).&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;java.io.IOException: EOF in 52543 &lt;span class=&quot;code-object&quot;&gt;byte&lt;/span&gt; (compressed) block: could only read 38094 bytes
    at com.ning.compress.lzf.LZFDecoder.readFully(LZFDecoder.java:394) ~[compress-lzf-0.8.4.jar:na]
    at com.ning.compress.lzf.LZFDecoder.decompressChunk(LZFDecoder.java:190) ~[compress-lzf-0.8.4.jar:na]
    at com.ning.compress.lzf.LZFInputStream.readyBuffer(LZFInputStream.java:254) ~[compress-lzf-0.8.4.jar:na]
    at com.ning.compress.lzf.LZFInputStream.read(LZFInputStream.java:111) ~[compress-lzf-0.8.4.jar:na]
    ...
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="14497001" author="jmckenzie" created="Wed, 15 Apr 2015 21:08:03 +0000"  >&lt;p&gt;Good call. +1.&lt;/p&gt;</comment>
                            <comment id="14524101" author="yukim" created="Fri, 1 May 2015 22:11:18 +0000"  >&lt;p&gt;Committed, thanks!&lt;/p&gt;</comment>
                            <comment id="14556036" author="yukim" created="Fri, 22 May 2015 12:05:56 +0000"  >&lt;p&gt;From &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-9444&quot; title=&quot;resumable_bootstrap_test dtest failures&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-9444&quot;&gt;&lt;del&gt;CASSANDRA-9444&lt;/del&gt;&lt;/a&gt;, there is another chance streaming will be stuck when thrown IOException is wrapped in IOError.&lt;br/&gt;
The previous patch didn&apos;t handle that case so attaching follow up.&lt;/p&gt;

&lt;p&gt;With the patch, 5 consecutive resumable_bootstrap_test runs without fail.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://cassci.datastax.com/job/yukim-9132-2-2.2-dtest/5/testReport/bootstrap_test/TestBootstrap/resumable_bootstrap_test/history/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://cassci.datastax.com/job/yukim-9132-2-2.2-dtest/5/testReport/bootstrap_test/TestBootstrap/resumable_bootstrap_test/history/&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14559250" author="jmckenzie" created="Tue, 26 May 2015 15:31:24 +0000"  >&lt;p&gt;+1&lt;/p&gt;</comment>
                            <comment id="14559433" author="yukim" created="Tue, 26 May 2015 17:21:21 +0000"  >&lt;p&gt;Committed, thanks!&lt;/p&gt;</comment>
                            <comment id="14593544" author="mambocab" created="Fri, 19 Jun 2015 15:47:46 +0000"  >&lt;p&gt;This still fails periodically on trunk while waiting for &lt;tt&gt;Starting listening for CQL clients&lt;/tt&gt; (&lt;a href=&quot;http://cassci.datastax.com/view/trunk/job/trunk_dtest/lastCompletedBuild/testReport/bootstrap_test/TestBootstrap/resumable_bootstrap_test/history/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;cassci&lt;/a&gt;). I can open a new ticket if you think this is a new bug, but for the moment I&apos;m reopening.&lt;/p&gt;</comment>
                            <comment id="14616880" author="iamaleksey" created="Tue, 7 Jul 2015 15:43:45 +0000"  >&lt;blockquote&gt;&lt;p&gt;I can open a new ticket if you think this is a new bug, but for the moment I&apos;m reopening.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;JIRA-wise, you should not reopen tickets with code that&apos;s already in a released C* version. Always open a new one.&lt;/p&gt;</comment>
                            <comment id="14616886" author="mambocab" created="Tue, 7 Jul 2015 15:49:14 +0000"  >&lt;p&gt;Thanks, I&apos;ll fix that.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                            <outwardlinks description="duplicates">
                                        <issuelink>
            <issuekey id="12831477">CASSANDRA-9444</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                            <issuelinktype id="12310010">
                    <name>Incorporates</name>
                                                                <inwardlinks description="is part of">
                                        <issuelink>
            <issuekey id="12783375">CASSANDRA-8996</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12724981" name="9132-2.0.txt" size="1001" author="yukim" created="Mon, 13 Apr 2015 16:57:37 +0000"/>
                            <attachment id="12734808" name="9132-followup-2.0.txt" size="982" author="yukim" created="Fri, 22 May 2015 12:05:56 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[yukim]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 20 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2cxt3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>joshuamckenzie</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[joshuamckenzie]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12962"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12311420" key="com.atlassian.jira.plugin.system.customfieldtypes:version">
                        <customfieldname>Since Version</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="12324629">2.0.0</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>