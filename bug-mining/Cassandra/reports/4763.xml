<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 23:07:39 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-12982] Customizable hint ttl has been removed</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-12982</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;The cassandra.maxHintTTL property added in &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-5988&quot; title=&quot;Make hint TTL customizable&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-5988&quot;&gt;&lt;del&gt;CASSANDRA-5988&lt;/del&gt;&lt;/a&gt; was removed in the hint system rewrite for 3.0.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13024853">CASSANDRA-12982</key>
            <summary>Customizable hint ttl has been removed</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10003" iconUrl="https://issues.apache.org/jira/images/icons/priorities/trivial.svg">Low</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="bdeggleston">Blake Eggleston</assignee>
                                    <reporter username="bdeggleston">Blake Eggleston</reporter>
                        <labels>
                    </labels>
                <created>Thu, 1 Dec 2016 18:54:44 +0000</created>
                <updated>Fri, 15 May 2020 07:59:51 +0000</updated>
                            <resolved>Tue, 16 May 2017 21:42:05 +0000</resolved>
                                        <fixVersion>4.0-alpha1</fixVersion>
                    <fixVersion>4.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="15712816" author="bdeggleston" created="Thu, 1 Dec 2016 19:17:55 +0000"  >&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;a href=&quot;https://github.com/bdeggleston/cassandra/tree/12982-3.0&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;3.0&lt;/a&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/bdeggleston/job/bdeggleston-12982-3.0-dtest/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;dtest&lt;/a&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/bdeggleston/job/bdeggleston-12982-3.0-testall/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;testall&lt;/a&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;a href=&quot;https://github.com/bdeggleston/cassandra/tree/12982-trunk&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;trunk&lt;/a&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/bdeggleston/job/bdeggleston-12982-trunk-dtest/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;dtest&lt;/a&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/bdeggleston/job/bdeggleston-12982-trunk-testall/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;testall&lt;/a&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;
</comment>
                            <comment id="15722822" author="iamaleksey" created="Mon, 5 Dec 2016 17:38:41 +0000"  >&lt;p&gt;I think the thought process back then was &quot;we don&apos;t use cells with TTL to store hints anymore, so this makes no sense to re-add&quot;.&lt;/p&gt;

&lt;p&gt;Except we kind of do have, in the form of gcgs vint. So I don&apos;t mind re-adding it.&lt;/p&gt;

&lt;p&gt;The patch is no bad, but I feel like we can do better:&lt;/p&gt;

&lt;p&gt;1. You&apos;ve added code poking into the buffer containing the hint to &lt;tt&gt;HintsReader&lt;/tt&gt;. Arguably, this code doesn&apos;t belong to &lt;tt&gt;HIntsReader&lt;/tt&gt; - it&apos;s not supposed to be aware of the underlying &lt;tt&gt;Hint&lt;/tt&gt; representation, only binary encoding of the log itself. That code should live in &lt;tt&gt;Hint.Serializer&lt;/tt&gt;. Besides breaking separation of concerns this duplication adds risk of forgetting to update deser code in both classes when we change it.&lt;/p&gt;

&lt;p&gt;2. It should be versioned.&lt;/p&gt;

&lt;p&gt;3. If we properly move it to &lt;tt&gt;Hint.Serializer&lt;/tt&gt;, we can take this further, and besides cutting some network I/O, also short-circuit hint/buffer reading after getting the first two fields. For verbatim buffer iterators it means we can skip allocating a &lt;tt&gt;ByteBuffer&lt;/tt&gt; with the containing mutation. For &lt;tt&gt;Hint&lt;/tt&gt; iterator this means we can avoid deserialising the whole mutation entirely if we can deduct from creation time, gcgs, and max ttl that the hint is no longer alive.&lt;/p&gt;

&lt;p&gt;4. There really is no need to call &lt;tt&gt;System.currentTimeMillis()&lt;/tt&gt; for every hint deserialisation (via &lt;tt&gt;isLive&lt;/tt&gt; check). This can be pretty expensive in certain virtualised environments depending on the configured time source. We can calculate it once on each iterator init (once per page), and still never overstream (if this is a normal dispatch, the hints are all still young; if it&apos;s a late dispatch - after a node being down for a while - the hints will likely be either all alive or all dead).&lt;/p&gt;

&lt;p&gt;Pushed a branch with suggestions &lt;a href=&quot;https://github.com/iamaleksey/cassandra/commits/12982-sketch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;here&lt;/a&gt;. Note: it has some unrelated code changes (which ended up as &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-12998&quot; title=&quot;Remove a silly hint.isLive() check in HintsService.write()&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-12998&quot;&gt;&lt;del&gt;CASSANDRA-12998&lt;/del&gt;&lt;/a&gt;), also doesn&apos;t necessarily work, or pass tests. Coded up while bored on Sunday at night, so there might be some room for improvement, too.&lt;/p&gt;

&lt;p&gt;Please let me know what you think.&lt;/p&gt;</comment>
                            <comment id="15722911" author="iamaleksey" created="Mon, 5 Dec 2016 18:08:04 +0000"  >&lt;p&gt;Also, would be nice to have an entry in conf/jvm.options, as is tradition (under STARTUP PARAMETERS section).&lt;/p&gt;</comment>
                            <comment id="15768194" author="bdeggleston" created="Wed, 21 Dec 2016 21:20:42 +0000"  >&lt;p&gt;I agree, Hint.Serializer is a better place for that logic to go. I&apos;ve pushed up commits addressing that, and your other points. I&apos;ve also reworked the getBufferIfLive method so it isn&apos;t re-encoding anything.&lt;/p&gt;</comment>
                            <comment id="15771576" author="iamaleksey" created="Fri, 23 Dec 2016 01:35:47 +0000"  >&lt;p&gt;Thanks.&lt;/p&gt;

&lt;p&gt;Re-encoding the vint here isn&apos;t really an issue, so no real need to avoid it.&lt;/p&gt;

&lt;p&gt;I&apos;m not a big fan, conceptually, of a conditional method with a name like &lt;tt&gt;deserializeIfLive&lt;/tt&gt; taking a &lt;tt&gt;force&lt;/tt&gt; argument that basically turns it into an unconditional deserializer (and making two or the arguments useless).&lt;/p&gt;

&lt;p&gt;I much rather prefer some minor duplication to increased complexity but DRY-ness.&lt;/p&gt;

&lt;p&gt;If you don&apos;t mind strongly, I&apos;d like to give it another go once back from vacation/bank holidays - to make it a bit simpler and conceptually right, also ideally in a way that would avoid having to pass &lt;tt&gt;size&lt;/tt&gt; to &lt;tt&gt;deserializeIfLive&lt;/tt&gt;.&lt;/p&gt;</comment>
                            <comment id="15795996" author="bdeggleston" created="Tue, 3 Jan 2017 19:43:08 +0000"  >&lt;blockquote&gt;&lt;p&gt;Re-encoding the vint here isn&apos;t really an issue, so no real need to avoid it.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;The name and usage of the method implies that it&#8217;s just reading some bytes out of an input, with some additional logic to bail out early if the encoded hint is dead. To me, the method actually recomputing some of the bytes it&apos;s returning seems very wrong. Someone reading HintsReader wouldn&#8217;t expect the method to behave that way, and there doesn&#8217;t seem to be any benefit to doing it that way. It&#8217;s slightly riskier, no faster, and approximately as understandable as just copying the bytes.&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;I&apos;m not a big fan, conceptually, of a conditional method with a name like deserializeIfLive taking a force argument that basically turns it into an unconditional deserializer (and making two or the arguments useless).&lt;/p&gt;

&lt;p&gt;I much rather prefer some minor duplication to increased complexity but DRY-ness.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;That&#8217;s reasonable, I&#8217;ve pushed up a commit changing that.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;If you don&apos;t mind strongly, I&apos;d like to give it another go once back from vacation/bank holidays - to make it a bit simpler and conceptually right, also ideally in a way that would avoid having to pass size to deserializeIfLive.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Sure, go for it. I&#8217;d also prefer not passing size to deserializeIfLive, but didn&#8217;t see a straightforward way of making that work.&lt;/p&gt;</comment>
                            <comment id="15957554" author="iamaleksey" created="Wed, 5 Apr 2017 20:03:33 +0000"  >&lt;blockquote&gt;&lt;p&gt;Someone reading HintsReader wouldn&#8217;t expect the method to behave that way, and there doesn&#8217;t seem to be any benefit to doing it that way. It&#8217;s slightly riskier, no faster, and approximately as understandable as just copying the bytes.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;It might not be faster (though I expect it is), but it does create less garbage (one extra array, one extra byte buffer, and one &lt;tt&gt;DataInputBuffer&lt;/tt&gt; in the original version) - and it is a regression for the common case (hint is live). If you reencode timestamp and gcgs, you are no worse than before, allocation-wise. I might open a JIRA later to address this, but I guess it&apos;ll do for now - hint replay is not on the hot path.&lt;/p&gt;

&lt;p&gt;I made some very minor cosmetic changes on top of you branch - which aren&apos;t really necessary, but if you don&apos;t mind, I&apos;ll be a tiny bit happier if they make it in. Links:&lt;/p&gt;

&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;branch&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;testall&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;dtest&lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/iamaleksey/cassandra/tree/12982-3.11&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;12982-3.11&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/iamaleksey/job/iamaleksey-12982-3.11-testall&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;testall&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/iamaleksey/job/iamaleksey-12982-3.11-dtest&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;dtest&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/iamaleksey/cassandra/tree/12982-trunk&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;12982-trunk&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/iamaleksey/job/iamaleksey-12982-trunk-testall&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;testall&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/iamaleksey/job/iamaleksey-12982-trunk-dtest&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;dtest&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;


&lt;p&gt;With or without these, LGTM.&lt;/p&gt;</comment>
                            <comment id="16013157" author="bdeggleston" created="Tue, 16 May 2017 21:42:05 +0000"  >&lt;p&gt;Committed to trunk as &lt;tt&gt;f8159ac5071d53e8bc9c28e3a1eaf3ba798ff287&lt;/tt&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[bdeggleston]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 27 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i371bb:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>aleksey</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[aleksey]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12961"><![CDATA[Low]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>