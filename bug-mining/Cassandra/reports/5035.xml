<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 23:11:30 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-14055] Index redistribution breaks SASI index</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-14055</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;During index redistribution process, a new view is created.&lt;br/&gt;
During this creation, old indexes should be released.&lt;/p&gt;

&lt;p&gt;But, new indexes are &quot;attached&quot; to the same SSTable as the old indexes.&lt;/p&gt;

&lt;p&gt;This leads to the deletion of the last SASI index file and breaks the index.&lt;/p&gt;

&lt;p&gt;The issue is in this function : &lt;a href=&quot;https://github.com/apache/cassandra/blob/9ee44db49b13d4b4c91c9d6332ce06a6e2abf944/src/java/org/apache/cassandra/index/sasi/conf/view/View.java#L62&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/cassandra/blob/9ee44db49b13d4b4c91c9d6332ce06a6e2abf944/src/java/org/apache/cassandra/index/sasi/conf/view/View.java#L62&lt;/a&gt;&lt;/p&gt;


</description>
                <environment></environment>
        <key id="13118958">CASSANDRA-14055</key>
            <summary>Index redistribution breaks SASI index</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10002" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Normal</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="jwest">Jordan West</assignee>
                                    <reporter username="lboutros">Ludovic Boutros</reporter>
                        <labels>
                            <label>patch</label>
                            <label>sasi</label>
                    </labels>
                <created>Thu, 16 Nov 2017 15:51:51 +0000</created>
                <updated>Wed, 16 Mar 2022 11:21:28 +0000</updated>
                            <resolved>Mon, 14 May 2018 19:48:24 +0000</resolved>
                                        <fixVersion>3.11.3</fixVersion>
                    <fixVersion>4.0-alpha1</fixVersion>
                    <fixVersion>4.0</fixVersion>
                                    <component>Feature/SASI</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>10</watches>
                                                    <progress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                            <timeestimate seconds="0">0h</timeestimate>
                            <timespent seconds="600">10m</timespent>
                                <comments>
                            <comment id="16255514" author="lboutros" created="Thu, 16 Nov 2017 15:56:51 +0000"  >&lt;p&gt;Here is a first little patch with a unit test and a simple fix.&lt;/p&gt;

&lt;p&gt;I have somme issues with the unit test &quot;SASIIndexTest.testIndexMemtableSwitching&quot;.&lt;br/&gt;
It works alone, but fails if the whole test is runned. &lt;/p&gt;

&lt;p&gt;Any help would be really appreciated.&lt;/p&gt;</comment>
                            <comment id="16257287" author="lboutros" created="Fri, 17 Nov 2017 17:36:41 +0000"  >&lt;p&gt;A new patch with unit tests fixed.&lt;/p&gt;</comment>
                            <comment id="16259303" author="githubbot" created="Mon, 20 Nov 2017 14:43:23 +0000"  >&lt;p&gt;GitHub user ludovic-boutros opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/cassandra/pull/174&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/cassandra/pull/174&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-14055&quot; title=&quot;Index redistribution breaks SASI index&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-14055&quot;&gt;&lt;del&gt;CASSANDRA-14055&lt;/del&gt;&lt;/a&gt;: Index redistribution breaks SASI index&lt;/p&gt;

&lt;p&gt;    During index redistribution process, a new view is created.&lt;br/&gt;
    During this creation, old indexes should be released.&lt;/p&gt;

&lt;p&gt;    But, new indexes are &quot;attached&quot; to the same SSTable as the old indexes.&lt;/p&gt;

&lt;p&gt;    This leads to the deletion of the last SASI index file and breaks the index.&lt;/p&gt;

&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/ludovic-boutros/cassandra&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/ludovic-boutros/cassandra&lt;/a&gt; fix/&lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-14055&quot; title=&quot;Index redistribution breaks SASI index&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-14055&quot;&gt;&lt;del&gt;CASSANDRA-14055&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/cassandra/pull/174.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/cassandra/pull/174.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #174&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit 532ed86090c27e51c745c57678cd19ff4b606a0c&lt;br/&gt;
Author: lboutros@flatironsjouve.com &amp;lt;lboutros@flatironsjouve.com&amp;gt;&lt;br/&gt;
Date:   2017-11-20T14:39:41Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-14055&quot; title=&quot;Index redistribution breaks SASI index&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-14055&quot;&gt;&lt;del&gt;CASSANDRA-14055&lt;/del&gt;&lt;/a&gt;: Index redistribution breaks SASI index&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="16262735" author="lboutros" created="Wed, 22 Nov 2017 14:52:10 +0000"  >&lt;p&gt;It seems to be a bit more complex.&lt;br/&gt;
There is a case that I&apos;m not able to reproduce in a unit test which breaks as well SASI index, but I&apos;m able to reproduce it in debug mode (and in production of course &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/sad.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; ).&lt;/p&gt;</comment>
                            <comment id="16264226" author="lboutros" created="Thu, 23 Nov 2017 11:46:57 +0000"  >&lt;p&gt;I&apos;ve updated the PR with a more complex unit test and a better fix.&lt;/p&gt;

&lt;p&gt;I will add another patch here for reference.&lt;/p&gt;</comment>
                            <comment id="16264396" author="githubbot" created="Thu, 23 Nov 2017 14:29:49 +0000"  >&lt;p&gt;Github user ludovic-boutros commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/cassandra/pull/174&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/cassandra/pull/174&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    I have added a flag in order to keep index files in the index release function.&lt;br/&gt;
    This way I can prevent deletions.&lt;/p&gt;

&lt;p&gt;    Any advise on the patch ?&lt;/p&gt;</comment>
                            <comment id="16273438" author="jjirsa" created="Thu, 30 Nov 2017 21:12:36 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ifesdjeen&quot; class=&quot;user-hover&quot; rel=&quot;ifesdjeen&quot;&gt;ifesdjeen&lt;/a&gt; are you still reviewing SASI patches or do we need to find someone else?&lt;/p&gt;</comment>
                            <comment id="16282160" author="lboutros" created="Thu, 7 Dec 2017 17:02:51 +0000"  >&lt;p&gt;Any news on this ? We are currently using the patch in production, but that would be better to use an official version of C* &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;. &lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ifesdjeen&quot; class=&quot;user-hover&quot; rel=&quot;ifesdjeen&quot;&gt;ifesdjeen&lt;/a&gt;, do you need some help ?&lt;/p&gt;</comment>
                            <comment id="16282493" author="ifesdjeen" created="Thu, 7 Dec 2017 20:34:57 +0000"  >&lt;p&gt;Sorry for not getting to it. I&apos;m currently a bit overloaded with other things, I hope to get to it next week. If anyone has capacity for it - just assign yourself as a reviewer!&lt;/p&gt;</comment>
                            <comment id="16346524" author="lboutros" created="Wed, 31 Jan 2018 10:05:56 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ifesdjeen&quot; class=&quot;user-hover&quot; rel=&quot;ifesdjeen&quot;&gt;ifesdjeen&lt;/a&gt; do you think you will have some time to review this patch soon ? I really would like to see it included in 3.11.2 &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/biggrin.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;Thx.&lt;/p&gt;</comment>
                            <comment id="16347781" author="jrwest" created="Wed, 31 Jan 2018 23:25:51 +0000"  >&lt;p&gt;Hi&#160;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=lboutros&quot; class=&quot;user-hover&quot; rel=&quot;lboutros&quot;&gt;lboutros&lt;/a&gt;,&lt;/p&gt;

&lt;p&gt;One of the original authors of SASI here. I&apos;ve been taking a look at this issue and your patch. Using the provided test against the &lt;tt&gt;cassandra-3.11&lt;/tt&gt; branch (fc3357a00e2b6e56d399f07c5b81a82780c1e143), I see three different failure cases &#8211; two related directly to this issue and one tangentially related. More details on those below. With respect to this issue in particular, the three scenarios cause the test to fail because &lt;tt&gt;IndexSummaryManager&lt;/tt&gt; ends up creating a new &lt;tt&gt;View&lt;/tt&gt; where &lt;tt&gt;oldSSTables&lt;/tt&gt; and &lt;tt&gt;newIndexes&lt;/tt&gt; have overlapping values. This occurs because the &lt;tt&gt;IndexSummaryManager&lt;/tt&gt; may &quot;update&quot; (re-open) an &lt;tt&gt;SSTableReader&lt;/tt&gt; for an index already in the view. I believe this is unique to &lt;tt&gt;IndexSummaryManager&lt;/tt&gt; and&#160;I am able to make your tests pass* without your patch by ensuring that there is no overlap between &lt;tt&gt;oldSStables&lt;/tt&gt; and &lt;tt&gt;newIndexes&lt;/tt&gt; (favoring &lt;tt&gt;newIndexes&lt;/tt&gt;). Your patch looks to do this as well, though the approach is a bit different.&lt;/p&gt;

&lt;p&gt;One thing I am curious about in your patch is the &lt;tt&gt;keepFile&lt;/tt&gt;&#160;changes to &lt;tt&gt;SSTableIndex#release&lt;/tt&gt;.&#160;Generally, this concerns me because it seems to be working around improper reference counting rather than correcting the reference counting itself. Also, while using the provided test, I am unable to hit a case where the condition &lt;tt&gt;obsolete.get() || sstableRef.globalCount() == 0&lt;/tt&gt; is true. I see the file missing in the &lt;tt&gt;View&lt;/tt&gt; but not on disk itself. Could you elaborate a bit more on the need for this change and your use of the &lt;tt&gt;keepFile&lt;/tt&gt; flag?&lt;/p&gt;

&lt;p&gt;The three failure scenarios I see using the provided test are:&lt;/p&gt;
&lt;h5&gt;&lt;a name=&quot;8keysreturnedsequentialcase&quot;&gt;&lt;/a&gt;8 keys returned - sequential case&lt;/h5&gt;

&lt;p&gt;In this scenario, at the time when the query that fails runs, the &lt;tt&gt;View&lt;/tt&gt;&#160;is missing the most recently flushed sstable. As mentioned previously, this is because&#160;the intersection of &lt;tt&gt;oldSSTables&lt;/tt&gt; and &lt;tt&gt;newIndexes&lt;/tt&gt; is non-empty. This can be fixed* by ensuring nothing in &lt;tt&gt;newIndexes&lt;/tt&gt; is in &lt;tt&gt;oldSSTables&lt;/tt&gt;. I call this the sequential case because the compaction that occurs during the test completes before the index summary redistribution begins to create a new &lt;tt&gt;View&lt;/tt&gt;. This is also addressed by your patch.&lt;/p&gt;
&lt;h5&gt;&lt;a name=&quot;8keysreturnedracecase&quot;&gt;&lt;/a&gt;8 keys returned - race case&lt;/h5&gt;

&lt;p&gt;This scenario is similar to the previous one but has the additional issue of triggering improper &lt;tt&gt;SSTableIndex&lt;/tt&gt; reference counting. From the perspective of the provided test, the failure scenario is the same and the fix* is as well. The issue occurs because of a race between compaction and index redistribution&apos;s creation of new &lt;tt&gt;View&lt;/tt&gt; instances. This causes redistribution to create two &lt;tt&gt;View&lt;/tt&gt; instances, the first of which is thrown away due to a failed compare and swap. The problem is the side-effects (calling &lt;tt&gt;SSTableIndex#release&lt;/tt&gt;) have occurred already inside the creation of the garbage &lt;tt&gt;View&lt;/tt&gt;, causing the reference count for the index to drop below 0. I see this issue as a separate one from this ticket and have filed &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-14207&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;CASSANDRA-14207&lt;/a&gt;. It is not fixed by the previously mentioned change and while I haven&apos;t checked in detail, I don&apos;t think&#160;the provided patch addresses this either.&lt;/p&gt;
&lt;h5&gt;&lt;a name=&quot;0keysreturned&quot;&gt;&lt;/a&gt;0 keys returned&lt;/h5&gt;

&lt;p&gt;This scenario is similar to the first but there are three threads involved in the race: the compaction, the flushing of the last memtable, and the index redistribution. In this case, the end result is an empty &lt;tt&gt;View&lt;/tt&gt;, which leads to no keys being returned since the system thinks there are no indexes to search. This is fixed* by what I mentioned previously and occurs because index redistribution re-opens both sstables in the original &lt;tt&gt;View&lt;/tt&gt; instead of just one. It&#160;is also addressed by your patch.&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;I am curious if you see any other failure scenarios besides these three and, in particular, if you can elaborate on and provide examples of the issues you see regarding the files being missing on disk and the need for the &lt;tt&gt;keepFile&lt;/tt&gt; change.&lt;/p&gt;

&lt;p&gt;&amp;#42; While this fix makes the provided test pass I am still verifying its correct from the reference counting perspective.&lt;/p&gt;</comment>
                            <comment id="16348404" author="lboutros" created="Thu, 1 Feb 2018 11:04:40 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jrwest&quot; class=&quot;user-hover&quot; rel=&quot;jrwest&quot;&gt;jrwest&lt;/a&gt;,&lt;/p&gt;

&lt;p&gt;first, thank you for reviewing this patch.&lt;br/&gt;
 I will try to give answers to your questions.&lt;/p&gt;

&lt;p&gt;Your global analysis is correct. The idea of this patch was to change as few things as possible.&lt;br/&gt;
 I do not see any other failure scenarios currently.&lt;br/&gt;
 We are using this patch in production with success since the end of november.&lt;/p&gt;

&lt;p&gt;Regarding the &lt;tt&gt;keepFile&lt;/tt&gt; change, with my last patch, I can reproduce the file deletion with the &lt;tt&gt;forceFlush&lt;/tt&gt; boolean set to &lt;tt&gt;true&lt;/tt&gt;.&lt;/p&gt;

&lt;p&gt;You can just add a conditional breakpoint with &lt;tt&gt;keepFile &amp;amp;&amp;amp; (obsolete.get() || sstableRef.globalCount() == 0)&lt;/tt&gt; in the &lt;tt&gt;release&lt;/tt&gt; function.&lt;br/&gt;
 It will stop on each attempt of index redistribution with &lt;tt&gt;forceFlush&lt;/tt&gt; active (second part of the test).&lt;/p&gt;

&lt;p&gt;With my limited knowledge of the global code, I did not see any issue in the reference counting process with my patch.&lt;br/&gt;
 But again, I&apos;m quite new with this code &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;.&lt;/p&gt;</comment>
                            <comment id="16358491" author="lboutros" created="Fri, 9 Feb 2018 14:51:23 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jrwest&quot; class=&quot;user-hover&quot; rel=&quot;jrwest&quot;&gt;jrwest&lt;/a&gt;,&lt;/p&gt;

&lt;p&gt;by any chance, did you have some time to work on this ? &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;Thx in advance.&lt;/p&gt;</comment>
                            <comment id="16358877" author="jrwest" created="Fri, 9 Feb 2018 19:55:36 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=lboutros&quot; class=&quot;user-hover&quot; rel=&quot;lboutros&quot;&gt;lboutros&lt;/a&gt;,&lt;/p&gt;

&lt;p&gt;My apologies for the delay. I am waiting on internal review of my version of the patch so you can take a look. I believe this patch accomplishes the same thing but with less changes and doesn&apos;t affect the reference counting in SSTableIndex. I hope to have it posted for your review and testing early next week.&lt;/p&gt;</comment>
                            <comment id="16360432" author="lboutros" created="Mon, 12 Feb 2018 08:30:38 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jrwest&quot; class=&quot;user-hover&quot; rel=&quot;jrwest&quot;&gt;jrwest&lt;/a&gt;,&lt;/p&gt;

&lt;p&gt;no problem. I would be glad to review your patch. It will be a good way to learn &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;.&lt;/p&gt;</comment>
                            <comment id="16361610" author="jrwest" created="Mon, 12 Feb 2018 23:54:54 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=lboutros&quot; class=&quot;user-hover&quot; rel=&quot;lboutros&quot;&gt;lboutros&lt;/a&gt;,&lt;/p&gt;

&lt;p&gt;Attached my patch for your review and testing. If you could verify this does the right thing in your environments that would be especially helpful since I have been unable to replicate the deleted file issue &#8211; I only see the sstables&#160;removed from the SASI View.&lt;/p&gt;

&lt;p&gt;The gist of the patch is to ensure the intersection of &lt;tt&gt;oldSStables&lt;/tt&gt; and &lt;tt&gt;newIndexes&lt;/tt&gt;&#160;is always empty. Your patch was doing the same by not checking &lt;tt&gt;oldSSTables&lt;/tt&gt; in the second for-loop, but this approach doesn&apos;t require the changes to &lt;tt&gt;SSTableIndex#release&lt;/tt&gt;.&lt;/p&gt;

&lt;p&gt;I re-used your test but removed the version that runs with the data entirely in-memory since that won&apos;t be affected by index redistribution.&lt;/p&gt;</comment>
                            <comment id="16362246" author="jasobrown" created="Tue, 13 Feb 2018 12:52:58 +0000"  >&lt;p&gt;For sanity sake, I&apos;m running the utests on &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jrwest&quot; class=&quot;user-hover&quot; rel=&quot;jrwest&quot;&gt;jrwest&lt;/a&gt;&apos;s patch:&lt;/p&gt;

&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;3.11&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;trunk&lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/jasobrown/cassandra/tree/14055-3.11&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;branch&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/jasobrown/cassandra/tree/14055-trunk&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;branch&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://circleci.com/gh/jasobrown/workflows/cassandra/tree/14055-3.11&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;utests &amp;amp; dtests&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://circleci.com/gh/jasobrown/workflows/cassandra/tree/14055-trunk&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;utests &amp;amp; dtests&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;
</comment>
                            <comment id="16362284" author="jasobrown" created="Tue, 13 Feb 2018 13:08:52 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jrwest&quot; class=&quot;user-hover&quot; rel=&quot;jrwest&quot;&gt;jrwest&lt;/a&gt; patch does not compile on trunk. can you take a look?&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;build-test:
    [javac] Compiling 587 source files to /orig/opt/dev/cassandra/build/test/classes
    [javac] /orig/opt/dev/cassandra/test/unit/org/apache/cassandra/index/sasi/SASIIndexTest.java:946: error: cannot find symbol
    [javac]         int minIndexInterval = store.metadata.params.minIndexInterval;
    [javac]                                              ^
    [javac]   symbol:   variable params
    [javac]   location: variable metadata of type TableMetadataRef
    [javac] /orig/opt/dev/cassandra/test/unit/org/apache/cassandra/index/sasi/SASIIndexTest.java:955: error: cannot find symbol
    [javac]             store.metadata.minIndexInterval(minIndexInterval);
    [javac]                           ^
    [javac]   symbol:   method minIndexInterval(int)
    [javac]   location: variable metadata of type TableMetadataRef
    [javac] /orig/opt/dev/cassandra/test/unit/org/apache/cassandra/index/sasi/SASIIndexTest.java:961: error: cannot find symbol
    [javac]         store.metadata.minIndexInterval(minIndexInterval);
    [javac]                       ^
    [javac]   symbol:   method minIndexInterval(int)
    [javac]   location: variable metadata of type TableMetadataRef
    [javac] Note: Some input files use or override a deprecated API.
    [javac] Note: Recompile with -Xlint:deprecation for details.
    [javac] Note: Some input files use unchecked or unsafe operations.
    [javac] Note: Recompile with -Xlint:unchecked for details.
    [javac] 3 errors
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="16362742" author="lboutros" created="Tue, 13 Feb 2018 17:57:48 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jrwest&quot; class=&quot;user-hover&quot; rel=&quot;jrwest&quot;&gt;jrwest&lt;/a&gt;,&lt;/p&gt;

&lt;p&gt;thx for your patch. The main difference between the two patches is that you do not release old &lt;tt&gt;SSTableIndex&lt;/tt&gt; objects at all.&lt;/p&gt;

&lt;p&gt;This way you do not remove the index file. On the other hand, don&apos;t you think you will have an issue in the reference count ? I&apos;m not sure but in my understanding, the global count will never go down to zero. But perhaps am I wrong.&lt;/p&gt;




&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="16364440" author="jrwest" created="Wed, 14 Feb 2018 17:06:30 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jasobrown&quot; class=&quot;user-hover&quot; rel=&quot;jasobrown&quot;&gt;jasobrown&lt;/a&gt;, sorry for the trunk issues. The way &lt;tt&gt;TableMetadata&lt;/tt&gt; is accessed/stored was changed and the test will need to be modified as a result. Will post a separate patch for trunk.&#160;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=lboutros&quot; class=&quot;user-hover&quot; rel=&quot;lboutros&quot;&gt;lboutros&lt;/a&gt;, In my testing, the primary issue I saw was that files were removed from the SASI &lt;tt&gt;View&lt;/tt&gt;&#160;that shouldn&apos;t be. The test writes 5 sstables (with sequence numbers&#160;1-4 &amp;amp; 6) and during the test a compaction typically happens (that generates a sstable with generation 5 from sstables 1-4). The final SASI &lt;tt&gt;View&lt;/tt&gt;&#160;when the queries are performed should contain either (1-4, 6) or (5, 6)*. The test fails by returning 8 keys instead of 10 when the SASI &lt;tt&gt;View&lt;/tt&gt;&#160;ends up containing only sstable 5 or by returning 0 keys instead of 10 when the SASI &lt;tt&gt;View&lt;/tt&gt; ends up empty.&#160;&lt;/p&gt;

&lt;p&gt;The issue occurs when index redistribution completes. Depending on the interleaving* of events (the memtable flush, compaction, and redistribution), redistribution re-opens sstable 6, and sometimes re-opens sstable 5. This results in an &lt;tt&gt;SSTableListChangedNotification&lt;/tt&gt;, which in turn results in the creation of a new &lt;tt&gt;View&lt;/tt&gt;,&#160; where &lt;tt&gt;added=&lt;span class=&quot;error&quot;&gt;&amp;#91;6&amp;#93;&lt;/span&gt;&lt;/tt&gt; (or &lt;tt&gt;added=&lt;span class=&quot;error&quot;&gt;&amp;#91;5,6&amp;#93;&lt;/span&gt;&lt;/tt&gt;) and &lt;tt&gt;removed=&lt;span class=&quot;error&quot;&gt;&amp;#91;6&amp;#93;&lt;/span&gt;&lt;/tt&gt; (or &lt;tt&gt;removed=&lt;span class=&quot;error&quot;&gt;&amp;#91;5,6&amp;#93;&lt;/span&gt;&lt;/tt&gt;). The SASI &lt;tt&gt;View&lt;/tt&gt; was written assuming these two sets were disjoint, which is why any reader&#160;in &lt;tt&gt;oldSSTables&lt;/tt&gt; caused the index to be closed. This is incorrect in both cases because sstables 5 and 6 are indeed the active data files (5 contains keys 0-8, and 6 contains keys 9 &amp;amp; 10).&#160;&lt;/p&gt;

&lt;p&gt;Regarding the ref counting, we want to maintain one reference to sstables 5 &amp;amp; 6 via their SSTableIndex instance but we&#8217;ve created a second reference and one needs to be closed. This is ensured by the &lt;tt&gt;newView.containsKey(sstable.descriptor)&lt;/tt&gt; part of the conditional (so we are still indeed calling &lt;tt&gt;#release()&lt;/tt&gt; on one instance). As I am writing this, however, I am realizing we want to keep a reference to the newer index, which references the newer SSTable instance and my patch does the opposite &#8212; keeping the old instance. I will post an updated patch along with my trunk patch for internal review, but the gist is to change the order we iterate over the old view and new indexes to favor new index instances.&lt;/p&gt;

&lt;p&gt;NOTE: I&apos;ve ignored &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-14207&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/CASSANDRA-14207&lt;/a&gt;&#160;above&lt;/p&gt;

&lt;p&gt;*I&apos;ve found a few other interleavings by using another machine, but the general issue is the same.&lt;/p&gt;</comment>
                            <comment id="16364486" author="lboutros" created="Wed, 14 Feb 2018 17:32:22 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jrwest&quot; class=&quot;user-hover&quot; rel=&quot;jrwest&quot;&gt;jrwest&lt;/a&gt;, &lt;/p&gt;

&lt;p&gt;&lt;cite&gt;As I am writing this, however, I am realizing we want to keep a reference to the newer index, which references the newer SSTable instance and my patch does the opposite &#8212; keeping the old instance. I will post an updated patch along with my trunk patch for internal review, but the gist is to change the order we iterate over the old view and new indexes to favor new index instances.&lt;/cite&gt;&lt;/p&gt;

&lt;p&gt;That was the point of my initial patch. But I aggree, if we can increment the global ref count with the new index before releasing the old one and therefore prevent the index file deletion, that would be better.&lt;/p&gt;</comment>
                            <comment id="16369601" author="jrwest" created="Mon, 19 Feb 2018 23:39:51 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=lboutros&quot; class=&quot;user-hover&quot; rel=&quot;lboutros&quot;&gt;lboutros&lt;/a&gt;/&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jasobrown&quot; class=&quot;user-hover&quot; rel=&quot;jasobrown&quot;&gt;jasobrown&lt;/a&gt;, some&#160;updates:&lt;/p&gt;

&lt;p&gt;&#160;&lt;br/&gt;
 I have attached two new patches. One for trunk and one of 3.11. Unfortunately, the test changes in trunk don&apos;t work well on 3.11 so we can&apos;t have one patch. The primary changes in this patch are to change the order we iterate over the indexes to ensure we retain the newer instance of &lt;tt&gt;SSTableIndex&lt;/tt&gt; and thus the newer&#160;&lt;tt&gt;SSTableReader&lt;/tt&gt;. I also changed the code to clone the &lt;tt&gt;oldSSTables&lt;/tt&gt; collection since its visible outside the &lt;tt&gt;View&lt;/tt&gt; constructor.&#160;&lt;/p&gt;
&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;3.11&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;Trunk&lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/jrwest/cassandra/tree/14055-jrwest-3.11&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;branch&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/jrwest/cassandra/tree/14055-jrwest-trunk&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;branch&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://circleci.com/gh/jrwest/cassandra/tree/14055-jrwest-3.11&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;utests&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://circleci.com/gh/jrwest/cassandra/tree/14055-jrwest-trunk&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;utests&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;


&lt;p&gt;NOTE: same utests are failing on &lt;a href=&quot;https://circleci.com/gh/jrwest/cassandra/25&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;trunk&lt;/a&gt;&#160;and I&apos;m still working on getting dtests running with my CircleCI setup.&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;Also, I spoke with some colleagues including &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=beobal&quot; class=&quot;user-hover&quot; rel=&quot;beobal&quot;&gt;beobal&lt;/a&gt; and &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=krummas&quot; class=&quot;user-hover&quot; rel=&quot;krummas&quot;&gt;krummas&lt;/a&gt; about the use of &lt;tt&gt;sstableRef.globalCount()&lt;/tt&gt; to determine when to delete the SASI index file. I&apos;ve come to the conclusion that its use at all is wrong because it&#160;represents the number of references to the instance, not globally. Given index summary redistribution, this isn&apos;t a safe assumption. Looking back at the original SASI patches, I am not sure why&#160;it got merged this way. The &lt;a href=&quot;https://github.com/xedin/sasi/blob/master/src/java/org/apache/cassandra/db/index/sasi/SSTableIndex.java#L120&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;patches&lt;/a&gt;&#160;used &lt;tt&gt;sstable.isMarkedCompacted()&lt;/tt&gt; but the &lt;a href=&quot;https://github.com/apache/cassandra/commit/72790dc8e34826b39ac696b03025ae6b7b6beb2b#diff-4873bb6fcef158ff18d221571ef2ec7cR124&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;merged code&lt;/a&gt;&#160;used &lt;tt&gt;sstableRef.globalCount()&lt;/tt&gt;. Fixing this is a larger undertaking, so I propose we split that work into a separate ticket and focus this one on SASI&apos;s failure to account for index redistribution in the &lt;tt&gt;View&lt;/tt&gt;. The work covered by the other ticket would entail either a) deleting the SASI index files as&#160;part of &lt;tt&gt;SSTableTidier&lt;/tt&gt; or by moving &lt;tt&gt;SSTableIndex&lt;/tt&gt; to use &lt;tt&gt;Ref&lt;/tt&gt; and implementing a tidier specific to it.&lt;/p&gt;</comment>
                            <comment id="16369818" author="lboutros" created="Tue, 20 Feb 2018 08:50:16 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jrwest&quot; class=&quot;user-hover&quot; rel=&quot;jrwest&quot;&gt;jrwest&lt;/a&gt;,&lt;/p&gt;

&lt;p&gt;I understand your changings and your explanations on the reference counting issue.&lt;br/&gt;
It looks good to me.&lt;/p&gt;

&lt;p&gt;Thank you.&lt;/p&gt;</comment>
                            <comment id="16371687" author="jrwest" created="Wed, 21 Feb 2018 17:12:26 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=lboutros&quot; class=&quot;user-hover&quot; rel=&quot;lboutros&quot;&gt;lboutros&lt;/a&gt; Great! Thanks for taking a look. I&apos;ve created &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-14248&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/CASSANDRA-14248&lt;/a&gt;.&#160;&lt;/p&gt;</comment>
                            <comment id="16373102" author="lboutros" created="Thu, 22 Feb 2018 17:19:42 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jrwest&quot; class=&quot;user-hover&quot; rel=&quot;jrwest&quot;&gt;jrwest&lt;/a&gt; do you have an idea when this will be committed ?&lt;/p&gt;</comment>
                            <comment id="16373192" author="jrwest" created="Thu, 22 Feb 2018 18:02:22 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=lboutros&quot; class=&quot;user-hover&quot; rel=&quot;lboutros&quot;&gt;lboutros&lt;/a&gt;&#160;its in &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jasobrown&quot; class=&quot;user-hover&quot; rel=&quot;jasobrown&quot;&gt;jasobrown&lt;/a&gt;&apos;s queue to give it one more review but I hope next week.&lt;/p&gt;</comment>
                            <comment id="16435231" author="lboutros" created="Thu, 12 Apr 2018 09:25:26 +0000"  >&lt;p&gt;Any news on this ? Thx.&lt;/p&gt;</comment>
                            <comment id="16474714" author="jasobrown" created="Mon, 14 May 2018 19:48:24 +0000"  >&lt;p&gt;Sorry for the delay in getting this reviewed. Patch lgtm, and committed as sha &lt;tt&gt;ab8348c578c0bb2d3baefaf387b4d9bc67f4c861&lt;/tt&gt;. Thanks, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=lboutros&quot; class=&quot;user-hover&quot; rel=&quot;lboutros&quot;&gt;lboutros&lt;/a&gt; and &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jrwest&quot; class=&quot;user-hover&quot; rel=&quot;jrwest&quot;&gt;jrwest&lt;/a&gt;!&lt;/p&gt;</comment>
                            <comment id="16480534" author="lboutros" created="Fri, 18 May 2018 11:53:51 +0000"  >&lt;p&gt;Thank you &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jasobrown&quot; class=&quot;user-hover&quot; rel=&quot;jasobrown&quot;&gt;jasobrown&lt;/a&gt;.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12911170" name="14055-jrwest-3.11.patch" size="6219" author="jwest" created="Mon, 19 Feb 2018 23:40:50 +0000"/>
                            <attachment id="12911171" name="14055-jrwest-trunk.patch" size="6413" author="jwest" created="Mon, 19 Feb 2018 23:40:50 +0000"/>
                            <attachment id="12910301" name="CASSANDRA-14055-jrwest.patch" size="5420" author="jwest" created="Mon, 12 Feb 2018 23:55:26 +0000"/>
                            <attachment id="12899051" name="CASSANDRA-14055.patch" size="10357" author="lboutros" created="Thu, 23 Nov 2017 11:49:05 +0000"/>
                            <attachment id="12898241" name="CASSANDRA-14055.patch" size="6861" author="lboutros" created="Fri, 17 Nov 2017 17:36:38 +0000"/>
                            <attachment id="12898006" name="CASSANDRA-14055.patch" size="7998" author="lboutros" created="Thu, 16 Nov 2017 15:57:13 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>6.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[jwest]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 26 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3mvrb:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12311421" key="com.atlassian.jira.plugin.system.customfieldtypes:multiversion">
                        <customfieldname>Reproduced In</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="12337348">3.10</customfieldvalue>
    <customfieldvalue id="12341002">3.11.1</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>jasobrown</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[jasobrown]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12962"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>