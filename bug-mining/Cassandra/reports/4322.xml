<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 23:03:17 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-9842] Inconsistent behavior for &apos;= null&apos; conditions on static columns</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-9842</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;Both inserting a row (in a non-existent partition) and updating a static column in the same LWT fails. Creating the partition before performing the LWT works.&lt;/p&gt;

&lt;h3&gt;&lt;a name=&quot;TableDefinition&quot;&gt;&lt;/a&gt;Table Definition&lt;/h3&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;create table txtable(pcol bigint, ccol bigint, scol bigint &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt;, ncol text, primary key((pcol), ccol));
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;h3&gt;&lt;a name=&quot;InsertingrowinnonexistentpartitionandupdatingstaticcolumninoneLWT&quot;&gt;&lt;/a&gt;Inserting row in non-existent partition and updating static column in one LWT&lt;/h3&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;begin batch
    insert into txtable (pcol, ccol, ncol) values (1, 1, &lt;span class=&quot;code-quote&quot;&gt;&apos;A&apos;&lt;/span&gt;);
    update txtable set scol = 1 where pcol = 1 &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; scol = &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;;
apply batch;

[applied]
-----------
     False
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;h3&gt;&lt;a name=&quot;CreatingpartitionbeforeLWT&quot;&gt;&lt;/a&gt;Creating partition before LWT&lt;/h3&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;insert into txtable (pcol, scol) values (1, &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; not exists;

begin batch
    insert into txtable (pcol, ccol, ncol) values (1, 1, &lt;span class=&quot;code-quote&quot;&gt;&apos;A&apos;&lt;/span&gt;);
    update txtable set scol = 1 where pcol = 1 &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; scol = &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;;
apply batch;

[applied]
-----------
     True
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment>&lt;p&gt;cassandra-2.1.8 on Ubuntu 15.04&lt;/p&gt;</environment>
        <key id="12846049">CASSANDRA-9842</key>
            <summary>Inconsistent behavior for &apos;= null&apos; conditions on static columns</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10002" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Normal</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="ifesdjeen">Alex Petrov</assignee>
                                    <reporter username="tuxychandru">Chandra Sekar</reporter>
                        <labels>
                    </labels>
                <created>Sat, 18 Jul 2015 03:39:20 +0000</created>
                <updated>Tue, 16 Apr 2019 09:31:03 +0000</updated>
                            <resolved>Tue, 21 Jun 2016 14:36:44 +0000</resolved>
                                        <fixVersion>2.1.15</fixVersion>
                    <fixVersion>2.2.7</fixVersion>
                    <fixVersion>3.0.8</fixVersion>
                    <fixVersion>3.8</fixVersion>
                                    <component>Legacy/CQL</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="14632246" author="jbellis" created="Sat, 18 Jul 2015 03:44:39 +0000"  >&lt;p&gt;Cassandra&apos;s behavior is correct, the partition not existing is not the same as existing with null value.&lt;/p&gt;</comment>
                            <comment id="14632247" author="tuxychandru" created="Sat, 18 Jul 2015 03:47:10 +0000"  >&lt;p&gt;Yes, but in the first example, the &quot;if&quot; clause does say &quot;if scol = null&quot; and yet the batch fails.&lt;/p&gt;</comment>
                            <comment id="14632248" author="jbellis" created="Sat, 18 Jul 2015 03:48:56 +0000"  >&lt;p&gt;The LWT clause is evaluated before the rest of the batch.  Statement order doesn&apos;t matter.&lt;/p&gt;</comment>
                            <comment id="14632507" author="tuxychandru" created="Sat, 18 Jul 2015 16:33:03 +0000"  >&lt;p&gt;&lt;b&gt;Deleting&lt;/b&gt; the &lt;b&gt;non-existent&lt;/b&gt; partition before performing the above batch also works! Is that intended behavior too?&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;delete from txtable where pcol = 1;

begin batch
    insert into txtable (pcol, ccol, ncol) values (1, 1, &lt;span class=&quot;code-quote&quot;&gt;&apos;A&apos;&lt;/span&gt;);
    update txtable set scol = 1 where pcol = 1 &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; scol = &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;;
apply batch;

 [applied]
-----------
     True
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="14633818" author="tuxychandru" created="Mon, 20 Jul 2015 16:47:49 +0000"  >&lt;p&gt;The behaviour seen in &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-9842?focusedCommentId=14632507&amp;amp;page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-14632507&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;my comment&lt;/a&gt;, contradicts the expected behaviour described in &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-9842?focusedCommentId=14632248&amp;amp;page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-14632248&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;Jonathan&apos;s comment&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="15066724" author="slebresne" created="Mon, 21 Dec 2015 17:16:04 +0000"  >&lt;p&gt;You&apos;re right, there is an inconsistency there.&lt;/p&gt;

&lt;p&gt;To sum it up, the problem is that if we update a static column &lt;tt&gt;sc&lt;/tt&gt; with a &lt;tt&gt;IF sc == null&lt;/tt&gt; condition, whether or not the condition is applied changes simply by the virtue of deleting a (already non existing) partition. That is, if a partition &lt;tt&gt;p&lt;/tt&gt; doesn&apos;t pre-exist,&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;UPDATE t SET scol = 0 WHERE p = 0 IF scol = null
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;is not applied, but&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;DELETE FROM t WHERE p = 0;
UPDATE t SET scol = 0 WHERE p = 0 IF scol = null
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;does apply, even though the initial deletion should be a no-op for all intent and purposes.&lt;/p&gt;

&lt;p&gt;The question could then be which of those answer is the right one. And that&apos;s probably the first response: we do want to make a difference between a partition that exists but has no value for a specific static column and one that doesn&apos;t exist at all. We do make that difference in &lt;tt&gt;SELECT&lt;/tt&gt; in particular so it would be inconsistent not to do it. I will note however that on 3.0, the result of those 2 examples is actually consistent, but it returns &lt;tt&gt;true&lt;/tt&gt; in both case (while, as I argue before we kind of want to return &lt;tt&gt;false&lt;/tt&gt; in both cases) and changing that will require a bit of special casing in the condition handling code.&lt;/p&gt;

&lt;p&gt;Lastly, I&apos;ll note that this problem is quite different from the initial problem for which the ticket was raised so I&apos;ll update the title to reflect that (as noted by Jonathan, the behavior in the ticket description is actually correct).&lt;/p&gt;</comment>
                            <comment id="15232315" author="ifesdjeen" created="Fri, 8 Apr 2016 15:14:00 +0000"  >&lt;p&gt;As discussed with &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=slebresne&quot; class=&quot;user-hover&quot; rel=&quot;slebresne&quot;&gt;slebresne&lt;/a&gt; offline, it was agreed that there&apos;s no distinction between the non-existing row and a static column containing &lt;tt&gt;null&lt;/tt&gt; value, so both an update to non-existing row and row with null in static column will succeed.&lt;/p&gt;

&lt;p&gt;Inconsistent behaviour is only in &lt;tt&gt;2.1&lt;/tt&gt; and &lt;tt&gt;2.2&lt;/tt&gt;, although I&apos;ve added same tests to &lt;tt&gt;3.0&lt;/tt&gt; and &lt;tt&gt;trunk&lt;/tt&gt;. &lt;/p&gt;

&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;&amp;nbsp;&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;2.1&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;2.2&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;3.0&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;trunk&lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;code&lt;/th&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/ifesdjeen/cassandra/tree/9842-2.1&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;2.1&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/ifesdjeen/cassandra/tree/9842-2.2&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;2.2&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/ifesdjeen/cassandra/tree/9842-3.0&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;3.0&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/ifesdjeen/cassandra/tree/9842-trunk&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;trunk&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;utest&lt;/th&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://cassci.datastax.com/view/Dev/view/ifesdjeen/job/ifesdjeen-9842-2.1-testall/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;2.1&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://cassci.datastax.com/view/Dev/view/ifesdjeen/job/ifesdjeen-9842-2.2-testall/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;2.2&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://cassci.datastax.com/view/Dev/view/ifesdjeen/job/ifesdjeen-9842-3.0-testall/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;3.0&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://cassci.datastax.com/view/Dev/view/ifesdjeen/job/ifesdjeen-9842-trunk-testall/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;trunk&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;dtest&lt;/th&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://cassci.datastax.com/view/Dev/view/ifesdjeen/job/ifesdjeen-9842-2.1-dtest/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;2.1&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://cassci.datastax.com/view/Dev/view/ifesdjeen/job/ifesdjeen-9842-2.2-dtest/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;2.2&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://cassci.datastax.com/view/Dev/view/ifesdjeen/job/ifesdjeen-9842-3.0-dtest/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;3.0&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://cassci.datastax.com/view/Dev/view/ifesdjeen/job/ifesdjeen-9842-trunk-dtest/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;trunk&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;
</comment>
                            <comment id="15273962" author="ifesdjeen" created="Fri, 6 May 2016 12:14:16 +0000"  >&lt;p&gt;As pointed out by &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=blerer&quot; class=&quot;user-hover&quot; rel=&quot;blerer&quot;&gt;blerer&lt;/a&gt;, the previous patch was working only for the local path. I&apos;ve added some &lt;a href=&quot;https://github.com/ifesdjeen/cassandra-dtest/tree/7826-trunk&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;dtests&lt;/a&gt; for the same behaviour and fixed the patch for the non-local path in &lt;tt&gt;CQL3CasRequest&lt;/tt&gt;. The null checks in conditions now became redundant. Although changes only in &lt;tt&gt;CQL3CasRequest&lt;/tt&gt; wouldn&apos;t be sufficient, as result of &lt;tt&gt;ModificationStatement::casInternal&lt;/tt&gt; relies on non-null value.&lt;/p&gt;


&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;&amp;nbsp;&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;2.1&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;2.2&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;3.0&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;trunk&lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;code&lt;/th&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/ifesdjeen/cassandra/tree/9842-2.1&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;2.1&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/ifesdjeen/cassandra/tree/9842-2.2&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;2.2&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/ifesdjeen/cassandra/tree/9842-3.0&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;3.0&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/ifesdjeen/cassandra/tree/9842-trunk&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;trunk&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;utest&lt;/th&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://cassci.datastax.com/view/Dev/view/ifesdjeen/job/ifesdjeen-9842-2.1-testall/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;2.1&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://cassci.datastax.com/view/Dev/view/ifesdjeen/job/ifesdjeen-9842-2.2-testall/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;2.2&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://cassci.datastax.com/view/Dev/view/ifesdjeen/job/ifesdjeen-9842-3.0-testall/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;3.0&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://cassci.datastax.com/view/Dev/view/ifesdjeen/job/ifesdjeen-9842-trunk-testall/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;trunk&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;dtest&lt;/th&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://cassci.datastax.com/view/Dev/view/ifesdjeen/job/ifesdjeen-9842-2.1-dtest/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;2.1&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://cassci.datastax.com/view/Dev/view/ifesdjeen/job/ifesdjeen-9842-2.2-dtest/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;2.2&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://cassci.datastax.com/view/Dev/view/ifesdjeen/job/ifesdjeen-9842-3.0-dtest/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;3.0&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://cassci.datastax.com/view/Dev/view/ifesdjeen/job/ifesdjeen-9842-trunk-dtest/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;trunk&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;
</comment>
                            <comment id="15277701" author="ifesdjeen" created="Tue, 10 May 2016 06:47:02 +0000"  >&lt;p&gt;I&apos;ve taken another look on my patch yesterday and made yet another change: isolated both code paths (for &lt;tt&gt;executeWithCondition&lt;/tt&gt; and via &lt;tt&gt;executeInternalWithCondition&lt;/tt&gt; within &lt;tt&gt;ModificationStatement&lt;/tt&gt;) as previous version would&apos;ve generated more garbage by creating an empty CF twice. I&apos;ve ran the tests, too. &lt;/p&gt;

&lt;p&gt;There&apos;s also a discussion on whether or not we need dtests for that. Technically, I could convert dtests into unit tests with `net`. Are there any preferences about such things? &lt;/p&gt;</comment>
                            <comment id="15277770" author="blerer" created="Tue, 10 May 2016 07:57:58 +0000"  >&lt;p&gt;The unit tests using the java driver test only a subset of what the DTest test due to the fact that they use only a single node. They do not test the inter-node communications and only test a part of the &lt;tt&gt;StorageProxy&lt;/tt&gt; logic. For something like LWT, DTests are for me mandatory. You should also provide some unit tests for testing the &lt;tt&gt;executeInternal&lt;/tt&gt; path. Adding some unit tests which use the java driver are not necessary from my point of view, so it is really up to you.&lt;/p&gt;</comment>
                            <comment id="15277777" author="ifesdjeen" created="Tue, 10 May 2016 08:06:48 +0000"  >&lt;p&gt;That was my understanding, too. Thank you for confirming.&lt;/p&gt;</comment>
                            <comment id="15289234" author="blerer" created="Wed, 18 May 2016 16:20:18 +0000"  >&lt;p&gt;The patch look good. It just seems to me that we should add more tests to check:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;when the updates should be rejected&lt;/li&gt;
	&lt;li&gt;other conditional operators (&lt;tt&gt;!=&lt;/tt&gt;, &lt;tt&gt;IN&lt;/tt&gt;, &lt;tt&gt;&amp;lt;&lt;/tt&gt;, &lt;tt&gt;&amp;lt;=&lt;/tt&gt;, &lt;tt&gt;&amp;gt;=&lt;/tt&gt; and &lt;tt&gt;&amp;gt;&lt;/tt&gt;)&lt;/li&gt;
	&lt;li&gt;conditional deletions&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Testing conditional deletion might be difficult due to &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-10532&quot; title=&quot;Allow LWT operation on static column with only partition keys&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-10532&quot;&gt;&lt;del&gt;CASSANDRA-10532&lt;/del&gt;&lt;/a&gt; so we might have to wait for it. &lt;/p&gt;</comment>
                            <comment id="15336284" author="ifesdjeen" created="Fri, 17 Jun 2016 15:16:06 +0000"  >&lt;p&gt;As &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-10532&quot; title=&quot;Allow LWT operation on static column with only partition keys&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-10532&quot;&gt;&lt;del&gt;CASSANDRA-10532&lt;/del&gt;&lt;/a&gt; is merged now, I&apos;ve updated the tests with conditional deletion (although only on &lt;tt&gt;NULL&lt;/tt&gt; static columns), both with and without batch.&lt;/p&gt;

&lt;p&gt;All branches are rebased:&lt;/p&gt;

&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;&amp;nbsp;&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;2.1&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;2.2&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;3.0&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;trunk&lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;code&lt;/th&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/ifesdjeen/cassandra/tree/9842-2.1&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;2.1&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/ifesdjeen/cassandra/tree/9842-2.2&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;2.2&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/ifesdjeen/cassandra/tree/9842-3.0&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;3.0&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/ifesdjeen/cassandra/tree/9842-trunk&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;trunk&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;utest&lt;/th&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://cassci.datastax.com/view/Dev/view/ifesdjeen/job/ifesdjeen-9842-2.1-testall/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;2.1&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://cassci.datastax.com/view/Dev/view/ifesdjeen/job/ifesdjeen-9842-2.2-testall/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;2.2&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://cassci.datastax.com/view/Dev/view/ifesdjeen/job/ifesdjeen-9842-3.0-testall/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;3.0&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://cassci.datastax.com/view/Dev/view/ifesdjeen/job/ifesdjeen-9842-trunk-testall/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;trunk&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;dtest&lt;/th&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://cassci.datastax.com/view/Dev/view/ifesdjeen/job/ifesdjeen-9842-2.1-dtest/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;2.1&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://cassci.datastax.com/view/Dev/view/ifesdjeen/job/ifesdjeen-9842-2.2-dtest/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;2.2&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://cassci.datastax.com/view/Dev/view/ifesdjeen/job/ifesdjeen-9842-3.0-dtest/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;3.0&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://cassci.datastax.com/view/Dev/view/ifesdjeen/job/ifesdjeen-9842-trunk-dtest/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;trunk&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;


&lt;p&gt;The test failures seem unrelated..&lt;br/&gt;
Note for committer: tests commits for &lt;tt&gt;2.1&lt;/tt&gt; and &lt;tt&gt;2.2&lt;/tt&gt; are different from ones to &lt;tt&gt;3.0&lt;/tt&gt; and &lt;tt&gt;trunk&lt;/tt&gt; (there&apos;s a subtle difference because of value being returned in &lt;tt&gt;2.x&lt;/tt&gt; together with &lt;tt&gt;applied&lt;/tt&gt; column) , and change commit itself is same for &lt;tt&gt;2.1&lt;/tt&gt; and &lt;tt&gt;2.2&lt;/tt&gt;, not required for &lt;tt&gt;3.0&lt;/tt&gt; and &lt;tt&gt;trunk&lt;/tt&gt;. &lt;/p&gt;</comment>
                            <comment id="15341776" author="blerer" created="Tue, 21 Jun 2016 13:41:12 +0000"  >&lt;p&gt;+1 &lt;br/&gt;
Thanks&lt;/p&gt;</comment>
                            <comment id="15341885" author="blerer" created="Tue, 21 Jun 2016 14:36:45 +0000"  >&lt;p&gt;Committed into 2.1 at 85f2bbfd1c6803977ecc1c2053527363078bce22 and merge into 2.2, 3.0 and trunk&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10001">
                    <name>dependent</name>
                                            <outwardlinks description="depends upon">
                                        <issuelink>
            <issuekey id="12905178">CASSANDRA-10532</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12812189" name="9842-2.1.txt" size="17235" author="blerer" created="Tue, 21 Jun 2016 14:37:07 +0000"/>
                            <attachment id="12812190" name="9842-3.0.txt" size="14445" author="blerer" created="Tue, 21 Jun 2016 14:37:07 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[ifesdjeen]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 22 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2hewn:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12311421" key="com.atlassian.jira.plugin.system.customfieldtypes:multiversion">
                        <customfieldname>Reproduced In</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="12332829">2.1.8</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>blerer</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[blerer]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12962"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>