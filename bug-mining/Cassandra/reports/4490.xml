<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 23:05:06 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-12705] Add column definition kind to system schema dropped columns</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-12705</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;Both regular and static columns can currently be dropped by users, but this information is currently not stored in &lt;tt&gt;SchemaKeyspace.DroppedColumns&lt;/tt&gt;. As a consequence, &lt;tt&gt;CFMetadata.getDroppedColumnDefinition&lt;/tt&gt; returns a regular column and this has caused problems such as &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-12582&quot; title=&quot;Removing static column results in ReadFailure due to CorruptSSTableException&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-12582&quot;&gt;&lt;del&gt;CASSANDRA-12582&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;We should add the column kind to &lt;tt&gt;SchemaKeyspace.DroppedColumns&lt;/tt&gt; so that &lt;tt&gt;CFMetadata.getDroppedColumnDefinition&lt;/tt&gt; can create the correct column definition. However, altering schema tables would cause inter-node communication failures during a rolling upgrade, see &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-12236&quot; title=&quot;RTE from new CDC column breaks in flight queries.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-12236&quot;&gt;&lt;del&gt;CASSANDRA-12236&lt;/del&gt;&lt;/a&gt;. Therefore we should wait for a full schema migration when upgrading to the next major version.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13007473">CASSANDRA-12705</key>
            <summary>Add column definition kind to system schema dropped columns</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10002" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Normal</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="stefania">Stefania Alborghetti</assignee>
                                    <reporter username="stefania">Stefania Alborghetti</reporter>
                        <labels>
                    </labels>
                <created>Mon, 26 Sep 2016 01:39:18 +0000</created>
                <updated>Fri, 15 May 2020 08:05:35 +0000</updated>
                            <resolved>Wed, 12 Oct 2016 01:31:04 +0000</resolved>
                                        <fixVersion>4.0-alpha1</fixVersion>
                    <fixVersion>4.0</fixVersion>
                                    <component>Legacy/Distributed Metadata</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="15521768" author="stefania" created="Mon, 26 Sep 2016 01:43:50 +0000"  >&lt;p&gt;An initial commit is available &lt;a href=&quot;https://github.com/stef1927/cassandra/commits/12705&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;here&lt;/a&gt;, based on the patch for &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-12582&quot; title=&quot;Removing static column results in ReadFailure due to CorruptSSTableException&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-12582&quot;&gt;&lt;del&gt;CASSANDRA-12582&lt;/del&gt;&lt;/a&gt;. The commit adds the column definition kind to &lt;tt&gt;SchemaKeyspace.DroppedColumns&lt;/tt&gt;, the handling of the schema migration during upgrade is missing.&lt;/p&gt;</comment>
                            <comment id="15528903" author="zznate" created="Wed, 28 Sep 2016 08:35:02 +0000"  >&lt;blockquote&gt;&lt;p&gt;the handling of the schema migration during upgrade is missing.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=Stefania&quot; class=&quot;user-hover&quot; rel=&quot;stefania&quot;&gt;Stefania&lt;/a&gt; Thanks for effort so far - should this be patch available, or are more changes coming?&lt;/p&gt;</comment>
                            <comment id="15528924" author="stefania" created="Wed, 28 Sep 2016 08:38:49 +0000"  >&lt;p&gt;I&apos;m not sure what needs to be done in order to handle changes to the schema tables during a major upgrade, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=iamaleksey&quot; class=&quot;user-hover&quot; rel=&quot;iamaleksey&quot;&gt;iamaleksey&lt;/a&gt;?&lt;/p&gt;</comment>
                            <comment id="15529160" author="iamaleksey" created="Wed, 28 Sep 2016 10:06:48 +0000"  >&lt;p&gt;For major upgrades we don&apos;t really care. Nodes with different messaging versions don&apos;t exchange schema between each other, in either direction. So unlike the cdc mess we had to live through (minor upgrade), here, all is &apos;easy&apos;.&lt;/p&gt;

&lt;p&gt;This will change &lt;b&gt;after&lt;/b&gt; 4.0 though, with new schema protocols. Not going to affect this ticket.&lt;/p&gt;</comment>
                            <comment id="15531398" author="stefania" created="Thu, 29 Sep 2016 00:45:17 +0000"  >&lt;p&gt;Thanks for the explanation. Then &lt;a href=&quot;https://github.com/stef1927/cassandra/commits/12705&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;this branch&lt;/a&gt; is ready for review.&lt;/p&gt;

&lt;p&gt;I will rebase and run CI once trunk is ready for 4.0.&lt;/p&gt;</comment>
                            <comment id="15532143" author="slebresne" created="Thu, 29 Sep 2016 08:23:03 +0000"  >&lt;p&gt;fyi, trunk is now 4.0 if you want to rebase.&lt;/p&gt;</comment>
                            <comment id="15534987" author="stefania" created="Fri, 30 Sep 2016 04:27:14 +0000"  >&lt;p&gt;Thanks, rebased, CI running:&lt;/p&gt;

&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/stef1927/cassandra/commits/12705&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;patch&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/stef1927/job/stef1927-12705-testall/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;testall&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/stef1927/job/stef1927-12705-dtest/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;dtest&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;
</comment>
                            <comment id="15555456" author="carlyeks" created="Fri, 7 Oct 2016 15:57:20 +0000"  >&lt;p&gt;This looks good, but we use the string of the kind enum when we are persisting the column definition; probably makes sense to keep that here as well.&lt;/p&gt;

&lt;p&gt;Also, the CI was so dirty, it&apos;s hard to tell if there is anything wrong.&lt;/p&gt;</comment>
                            <comment id="15561065" author="stefania" created="Mon, 10 Oct 2016 02:29:06 +0000"  >&lt;p&gt;Thanks for the review. I&apos;ve rebased, changed the serialization format of kind to text, and relaunched CI.&lt;/p&gt;</comment>
                            <comment id="15562782" author="iamaleksey" created="Mon, 10 Oct 2016 16:48:23 +0000"  >&lt;p&gt;Don&apos;t know what it looked like in the original version, but in &lt;tt&gt;system_schema.columns&lt;/tt&gt; we store the lowercase values of the enum names. Look at &lt;tt&gt;kind&lt;/tt&gt; and &lt;tt&gt;clustering_order&lt;/tt&gt; for examples. Would prefer it to be the same in &lt;tt&gt;system_schema.dropped_columns&lt;/tt&gt;, for consistency.&lt;/p&gt;

&lt;p&gt;Otherwise the patch LGTM.&lt;/p&gt;</comment>
                            <comment id="15564372" author="stefania" created="Tue, 11 Oct 2016 03:59:15 +0000"  >&lt;p&gt;Thank for the review.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;Don&apos;t know what it looked like in the original version, but in system_schema.columns we store the lowercase values of the enum names. Look at kind and clustering_order for examples. Would prefer it to be the same in system_schema.dropped_columns, for consistency.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I had noticed this behavior, but I preferred not to do the same because I could not understand why convert to lowercase before writing only to convert back to uppercase after reading. It seemed like a waste of CPU cycles, but thinking about it again, it must be for the benefit of humans reading the tables?&lt;/p&gt;

&lt;p&gt;Regardless, for the sake of consistency, I&apos;ve updated the patch to store lowercase values. I&apos;ve restarted CI and, unless objections or failures, I will commit once the results are available.&lt;/p&gt;</comment>
                            <comment id="15567215" author="stefania" created="Wed, 12 Oct 2016 01:31:04 +0000"  >&lt;p&gt;dtest results are clean, utests only have timeout failures, committed to trunk as 338b3e6438de321275122e09670c7567ea0c9820.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[stefania]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12313825" key="com.atlassian.jira.plugin.system.customfieldtypes:cascadingselect">
                        <customfieldname>Bug Category</customfieldname>
                        <customfieldvalues>
                                                    <customfieldvalue key="12983" cascade-level=""><![CDATA[Availability]]></customfieldvalue>
                                <customfieldvalue key="12994" cascade-level="1"><![CDATA[Unavailable]]></customfieldvalue>
            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 5 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3428f:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>aleksey</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[aleksey]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12962"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>