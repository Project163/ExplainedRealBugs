<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 23:01:05 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-11090] Avoid creating empty hint files</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-11090</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;After the hints executor finishes sending hints, another hints file is created for the same host, which is then processed on the next go around. This continues indefinitely. The new hint files are empty, so there shouldn&apos;t be any network traffic. However, there&apos;s still unnecessary hint activity, and the hint crc file isn&apos;t deleted in the 3.0 branch after hints are dispatched (but is in trunk), so any hint activity will trigger ~8640 files being created per day until the node is restarted. Restarting the node fixes the problem, after the existing hint files are processed. &lt;/p&gt;

&lt;p&gt;This can be duplicated on cassandra-3.0 to trunk with this script: &lt;a href=&quot;https://gist.github.com/bdeggleston/13fbb9e70c0c0bd277c7&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gist.github.com/bdeggleston/13fbb9e70c0c0bd277c7&lt;/a&gt;&lt;/p&gt;</description>
                <environment></environment>
        <key id="12934880">CASSANDRA-11090</key>
            <summary>Avoid creating empty hint files</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10003" iconUrl="https://issues.apache.org/jira/images/icons/priorities/trivial.svg">Low</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="aleksey">Aleksey Yeschenko</assignee>
                                    <reporter username="bdeggleston">Blake Eggleston</reporter>
                        <labels>
                    </labels>
                <created>Thu, 28 Jan 2016 18:51:08 +0000</created>
                <updated>Tue, 16 Apr 2019 09:30:43 +0000</updated>
                            <resolved>Tue, 9 Feb 2016 13:44:46 +0000</resolved>
                                        <fixVersion>3.0.4</fixVersion>
                    <fixVersion>3.4</fixVersion>
                                        <due></due>
                            <votes>1</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="15136934" author="iamaleksey" created="Mon, 8 Feb 2016 13:27:13 +0000"  >&lt;blockquote&gt;&lt;p&gt;the hint crc file isn&apos;t deleted in the 3.0 branch after hints are dispatched (but is in trunk)&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-10947&quot; title=&quot;Remained files in the hints folder&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-10947&quot;&gt;&lt;del&gt;CASSANDRA-10947&lt;/del&gt;&lt;/a&gt; is definitely there in both 3.0 and trunk (so 3.0.3, 3.3, future 3.4). Are you certain you&apos;ve tested with a recent cassandra-3.0 branch?&lt;/p&gt;</comment>
                            <comment id="15137155" author="bdeggleston" created="Mon, 8 Feb 2016 16:16:24 +0000"  >&lt;p&gt;Ok, looks like the crc problem is gone in the current 3.0 branch.&lt;/p&gt;

&lt;p&gt;The main issue I&apos;m seeing though, is that any hint activity starts an infinite loop of empty hint file creation / processing. In the script I linked in the description, some data is inserted while there&apos;s a node down, creating a hints file. When the node is brought up, the hints are transmitted, as you&apos;d expect. After that, every 10 seconds, another hints file (empty this time) is created for that node, and processed / deleted.&lt;/p&gt;

&lt;p&gt;It&apos;s less of an issue if the crc problem is fixed, but will still create a lot of noise in the logs for moderately sized clusters.&lt;/p&gt;</comment>
                            <comment id="15137343" author="iamaleksey" created="Mon, 8 Feb 2016 17:53:55 +0000"  >&lt;p&gt;Pushed a simple fix here - checking for iterator emptiness before proceeding to create a file.&lt;/p&gt;

&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;branch&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;testall&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;dtest&lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/iamaleksey/cassandra/tree/11090-3.0&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;11090-3.0&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/iamaleksey/job/iamaleksey-11090-3.0-testall&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;testall&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/iamaleksey/job/iamaleksey-11090-3.0-dtest&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;dtest&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/iamaleksey/cassandra/tree/11090-3.4&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;11090-3.4&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/iamaleksey/job/iamaleksey-11090-3.4-testall&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;testall&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/iamaleksey/job/iamaleksey-11090-3.4-dtest&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;dtest&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;
</comment>
                            <comment id="15138007" author="bdeggleston" created="Mon, 8 Feb 2016 23:36:39 +0000"  >&lt;p&gt;Functionally, this is fine, but could you&apos;re checking iterator.hasNext twice. Could you move the flushInternal call under the original hasNext check? So it looks like this:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (!iterator.hasNext())
    &lt;span class=&quot;code-keyword&quot;&gt;break&lt;/span&gt;;
flushInternal(iterator, store);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="15138023" author="iamaleksey" created="Mon, 8 Feb 2016 23:46:16 +0000"  >&lt;p&gt;I could, but it would change the semantics around closing the current writer. Right now we only close in &lt;tt&gt;flush()&lt;/tt&gt; if we are forced to switch the writer if it exceeds the max configured hint file size. With this change, we would do it unconditionally.&lt;/p&gt;</comment>
                            <comment id="15138157" author="bdeggleston" created="Tue, 9 Feb 2016 01:04:13 +0000"  >&lt;p&gt;ah I missed that. +1 then&lt;/p&gt;</comment>
                            <comment id="15138952" author="iamaleksey" created="Tue, 9 Feb 2016 13:44:18 +0000"  >&lt;p&gt;Committed as &lt;a href=&quot;https://github.com/apache/cassandra/commit/1f626087c8819b75f17fcbe757603fc0026d3cc1&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;1f626087c8819b75f17fcbe757603fc0026d3cc1&lt;/a&gt; to 3.0 and merged with trunk, thanks.&lt;/p&gt;</comment>
                            <comment id="15429960" author="cam1982" created="Mon, 22 Aug 2016 02:01:44 +0000"  >&lt;p&gt;In both 3.5 and 3.7 we seeing hinted handoff loop&lt;/p&gt;

&lt;p&gt;Aug 04 07:20:33 ip-10-222-104-29.ec2.internal cassandra&lt;span class=&quot;error&quot;&gt;&amp;#91;31062&amp;#93;&lt;/span&gt;: INFO  o.a.c.hints.HintsDispatchExecutor Finished hinted handoff of file 4566c9ad-69df-45fd-84d2-6386072d3efa-1470295200416-1.hints to endpoint 4566c9ad-69df-45fd-84d2-6386072d3efa&lt;br/&gt;
Aug 04 07:21:03 ip-10-222-104-29.ec2.internal cassandra&lt;span class=&quot;error&quot;&gt;&amp;#91;31062&amp;#93;&lt;/span&gt;: INFO  o.apache.cassandra.hints.HintsStore Deleted hint file 4566c9ad-69df-45fd-84d2-6386072d3efa-1470295230416-1.hints&lt;br/&gt;
Aug 04 07:21:03 ip-10-222-104-29.ec2.internal cassandra&lt;span class=&quot;error&quot;&gt;&amp;#91;31062&amp;#93;&lt;/span&gt;: INFO  o.a.c.hints.HintsDispatchExecutor Finished hinted handoff of file 4566c9ad-69df-45fd-84d2-6386072d3efa-1470295230416-1.hints to endpoint 4566c9ad-69df-45fd-84d2-6386072d3efa&lt;br/&gt;
Aug 04 07:21:33 ip-10-222-104-29.ec2.internal cassandra&lt;span class=&quot;error&quot;&gt;&amp;#91;31062&amp;#93;&lt;/span&gt;: INFO  o.apache.cassandra.hints.HintsStore Deleted hint file 4566c9ad-69df-45fd-84d2-6386072d3efa-1470295260416-1.hints&lt;/p&gt;

&lt;p&gt;and it just keeps repeating this. Have to rolling restart the cluster to resolve. Waiting for it to happen again to collect more information on the cause for this loop.&lt;/p&gt;</comment>
                            <comment id="15505264" author="iamaleksey" created="Tue, 20 Sep 2016 01:33:14 +0000"  >&lt;p&gt;That doesn&apos;t seem like a problem to me - that&apos;s the way it should work. The original issue was causing empty hint files to be created and deleted every 10 seconds, this seems to be processing non-empty hint files every minute, as intended.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="13121897">CASSANDRA-14080</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[aleksey]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 9 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2s3vr:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>bdeggleston</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[bdeggleston]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12961"><![CDATA[Low]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12311420" key="com.atlassian.jira.plugin.system.customfieldtypes:version">
                        <customfieldname>Since Version</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="12334152">3.0.1</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>