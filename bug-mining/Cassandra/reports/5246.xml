<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 23:14:07 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-13974] Bad prefix matching when figuring out data directory for an sstable</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-13974</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;We do a &quot;startsWith&quot; check when getting data directory for an sstable, we should match including File.separator&lt;/p&gt;</description>
                <environment></environment>
        <key id="13111678">CASSANDRA-13974</key>
            <summary>Bad prefix matching when figuring out data directory for an sstable</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10002" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Normal</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="marcuse">Marcus Eriksson</assignee>
                                    <reporter username="marcuse">Marcus Eriksson</reporter>
                        <labels>
                    </labels>
                <created>Tue, 24 Oct 2017 12:36:55 +0000</created>
                <updated>Fri, 15 May 2020 08:38:39 +0000</updated>
                            <resolved>Fri, 29 Nov 2019 09:17:41 +0000</resolved>
                                        <fixVersion>3.0.20</fixVersion>
                    <fixVersion>3.11.6</fixVersion>
                    <fixVersion>4.0-alpha3</fixVersion>
                    <fixVersion>4.0</fixVersion>
                                    <component>Legacy/Core</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="16216819" author="krummas" created="Tue, 24 Oct 2017 12:39:15 +0000"  >&lt;p&gt;&lt;a href=&quot;https://github.com/krummas/cassandra/commits/marcuse/13943&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/krummas/cassandra/commits/marcuse/13943&lt;/a&gt;&lt;br/&gt;
&lt;a href=&quot;https://builds.apache.org/view/A-D/view/Cassandra/job/Cassandra-devbranch-dtest/391/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/view/A-D/view/Cassandra/job/Cassandra-devbranch-dtest/391/&lt;/a&gt;&lt;br/&gt;
&lt;a href=&quot;https://circleci.com/gh/krummas/cassandra/tree/marcuse%2F13943&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://circleci.com/gh/krummas/cassandra/tree/marcuse%2F13943&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;(yes, branch name is bad, but it is the intended patch)&lt;/p&gt;</comment>
                            <comment id="16273465" author="jjirsa" created="Thu, 30 Nov 2017 21:20:44 +0000"  >&lt;p&gt;I&apos;ll take review on this, but it&apos;ll be a bit. If someone beats me to it, I won&apos;t mind (&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=stefania_alborghetti&quot; class=&quot;user-hover&quot; rel=&quot;stefania_alborghetti&quot;&gt;stefania_alborghetti&lt;/a&gt; or &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=bdeggleston&quot; class=&quot;user-hover&quot; rel=&quot;bdeggleston&quot;&gt;bdeggleston&lt;/a&gt; or &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=pauloricardomg&quot; class=&quot;user-hover&quot; rel=&quot;pauloricardomg&quot;&gt;pauloricardomg&lt;/a&gt;)&lt;/p&gt;</comment>
                            <comment id="16290157" author="jjirsa" created="Thu, 14 Dec 2017 00:42:34 +0000"  >&lt;p&gt;Code looks good to me, though it no longer applies to 3.11 (or trunk). Circle has some unrelated failures, and dtests have rolled over. I&apos;m good with committing, but would be great if we could get a relatively clean dtest run just to be safe.&lt;/p&gt;</comment>
                            <comment id="16602949" author="krummas" created="Tue, 4 Sep 2018 11:56:10 +0000"  >&lt;p&gt;seems I totally forgot about this, rebased branch: &lt;a href=&quot;https://github.com/krummas/cassandra/commits/marcuse/13974-2&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/krummas/cassandra/commits/marcuse/13974-2&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;tests: &lt;a href=&quot;https://circleci.com/gh/krummas/cassandra/tree/marcuse%2F13974-2&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://circleci.com/gh/krummas/cassandra/tree/marcuse%2F13974-2&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;this version also fixes an existing issue with &lt;tt&gt;FileUtils.isContained&lt;/tt&gt; as it also did prefix matching without a separator&lt;/p&gt;</comment>
                            <comment id="16602954" author="krummas" created="Tue, 4 Sep 2018 12:00:46 +0000"  >&lt;p&gt;the isContained fix should probably be committed to 3.0 as well, adding 3.0 to fix versions&lt;/p&gt;</comment>
                            <comment id="16690793" author="cscotta" created="Sun, 18 Nov 2018 04:15:24 +0000"  >&lt;p&gt;Related to &quot;&lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-14013&quot; title=&quot;Keyspace named &amp;quot;snapshots&amp;quot; is empty after service restart&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-14013&quot;&gt;&lt;del&gt;CASSANDRA-14013&lt;/del&gt;&lt;/a&gt;:&#160;Data loss in snapshots keyspace after service restart&quot;, in which a user reported data loss in a keyspace called &quot;snapshots&quot;&lt;/p&gt;</comment>
                            <comment id="16941656" author="krummas" created="Tue, 1 Oct 2019 09:10:30 +0000"  >&lt;p&gt;&lt;a href=&quot;https://github.com/krummas/cassandra/commits/marcuse/13974-3.0&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;3.0&lt;/a&gt;, &lt;a href=&quot;https://circleci.com/workflow-run/24d1823c-0fce-4fc8-83be-b0a9d9c72118&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;tests&lt;/a&gt; (only the FileUtils fix)&lt;br/&gt;
&lt;a href=&quot;https://github.com/krummas/cassandra/commits/marcuse/13974-3.11&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;3.11&lt;/a&gt;, &lt;a href=&quot;https://circleci.com/workflow-run/2c2b5c49-82bd-4495-b9df-2b16efeeb3f8&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;tests&lt;/a&gt;&lt;br/&gt;
&lt;a href=&quot;https://github.com/krummas/cassandra/commits/marcuse/13974-trunk&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;trunk&lt;/a&gt;, &lt;a href=&quot;https://circleci.com/workflow-run/843ec7b5-67ce-439a-b708-8dab9cfc3b9a&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;tests&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16942780" author="beobal" created="Wed, 2 Oct 2019 12:42:13 +0000"  >&lt;p&gt;Although most of the changes to 3.11+ aren&apos;t applicable to 3.0, the change to &lt;tt&gt;Directories::getLocationForDisk&lt;/tt&gt; is.&lt;/p&gt;

&lt;p&gt;In &lt;tt&gt;FileUtils::isContained&lt;/tt&gt;, have you considered using &lt;tt&gt;Path::startsWith&lt;/tt&gt; rather than string wrangling?&lt;br/&gt;
 Comparing the strings is probably faster/more efficient, but using paths is a bit clearer. e.g.:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
 Path folderPath = Paths.get(getCanonicalPath(folder));
 Path filePath = Paths.get(getCanonicalPath(file));
 &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; filePath.startsWith(folderPath);
 &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The difference isn&apos;t huge though, so I&apos;ll leave it to you to decide.&lt;/p&gt;</comment>
                            <comment id="16942804" author="krummas" created="Wed, 2 Oct 2019 13:19:02 +0000"  >&lt;p&gt;thanks, pushed fixes to the branches above, tests running here:&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://circleci.com/workflow-run/b588038a-dd03-45bb-bec8-a4ab7801ca1e&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;3.0&lt;/a&gt;&lt;br/&gt;
&lt;a href=&quot;https://circleci.com/workflow-run/dd658826-41c0-4d2e-b6c3-1cda1a935444&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;3.11&lt;/a&gt;&lt;br/&gt;
&lt;a href=&quot;https://circleci.com/workflow-run/7f922026-26f7-447a-9adb-7f7cf91c1543&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;trunk&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16942822" author="krummas" created="Wed, 2 Oct 2019 13:39:01 +0000"  >&lt;p&gt;though, it seems using canonical paths doesn&apos;t work: &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-5185&quot; title=&quot;symlinks to data directories are broken in 1.2.0&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-5185&quot;&gt;&lt;del&gt;CASSANDRA-5185&lt;/del&gt;&lt;/a&gt; - I&apos;ll investigate&lt;/p&gt;</comment>
                            <comment id="16963073" author="krummas" created="Wed, 30 Oct 2019 14:51:21 +0000"  >&lt;p&gt;Pushed a fix to the 3.11, trunk branches above which keeps a mapping of canonical data path to data directory - we then use this map when figuring out the data directory for an sstable. The directory in the descriptor is always canonical.&lt;/p&gt;</comment>
                            <comment id="16966693" author="beobal" created="Mon, 4 Nov 2019 14:23:53 +0000"  >&lt;p&gt;LGTM. There&apos;s 1 nit which you could ignore or fix on commit : in the &lt;tt&gt;Directories&lt;/tt&gt; constructor, the check for old format directories was inlined in the 3.11 branch but in the 4.0 version the &lt;tt&gt;olderDirectoryExists&lt;/tt&gt; is still there.&lt;/p&gt;

&lt;p&gt;There&apos;s also a couple of failing dtests against trunk, but I&apos;m having trouble even running those 2 tests locally, if they look ok to you I&apos;m +1. &lt;/p&gt;</comment>
                            <comment id="16984839" author="krummas" created="Fri, 29 Nov 2019 09:17:41 +0000"  >&lt;p&gt;thanks, committed - brought back the olderDirectoryExist boolean as it is slightly clearer&lt;/p&gt;

&lt;p&gt;tests: &lt;a href=&quot;https://circleci.com/workflow-run/ab2ba85d-f56b-4ccb-859b-57526b6bc0f5&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;trunk&lt;/a&gt; &lt;a href=&quot;https://circleci.com/workflow-run/c95beacd-55f7-49f8-bc69-ee9dc0d48ffb&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;3.11&lt;/a&gt; &lt;a href=&quot;https://circleci.com/workflow-run/7c3ad8c2-88de-462a-be94-0064a6cf413b&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;3.0&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[marcuse]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            5 years, 50 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3lmxr:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>jjirsa</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[samt]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12962"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12311420" key="com.atlassian.jira.plugin.system.customfieldtypes:version">
                        <customfieldname>Since Version</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="12332361">3.0 alpha 1</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313924" key="com.atlassian.jira.plugin.system.customfieldtypes:textfield">
                        <customfieldname>Source Control Link</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>&lt;p&gt;&lt;a href=&quot;https://github.com/apache/cassandra/commit/eda5db28e38c8652014cadd15ee49a8b8faacf21&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/cassandra/commit/eda5db28e38c8652014cadd15ee49a8b8faacf21&lt;/a&gt;&lt;/p&gt;</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313823" key="com.atlassian.jira.plugin.system.customfieldtypes:textarea">
                        <customfieldname>Test and Documentation Plan</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>&lt;p&gt;new tests, circleci runs&lt;/p&gt;</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>