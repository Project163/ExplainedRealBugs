<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 23:18:56 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-14793] Improve system table handling when losing a disk when using JBOD</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-14793</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;We should improve the way we handle disk failures when losing a disk in a JBOD setup&lt;/p&gt;

&lt;p&gt;&#160;One way could be to pin the system tables to a special data directory.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13187646">CASSANDRA-14793</key>
            <summary>Improve system table handling when losing a disk when using JBOD</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10002" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Normal</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="blerer">Benjamin Lerer</assignee>
                                    <reporter username="marcuse">Marcus Eriksson</reporter>
                        <labels>
                    </labels>
                <created>Wed, 26 Sep 2018 15:32:36 +0000</created>
                <updated>Wed, 16 Mar 2022 14:01:11 +0000</updated>
                            <resolved>Thu, 4 Feb 2021 14:14:55 +0000</resolved>
                                        <fixVersion>4.0-rc1</fixVersion>
                    <fixVersion>4.0</fixVersion>
                                    <component>Legacy/Core</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>12</watches>
                                                    <progress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                            <timeestimate seconds="0">0h</timeestimate>
                            <timespent seconds="24000">6h 40m</timespent>
                                <comments>
                            <comment id="16630172" author="kurtg" created="Thu, 27 Sep 2018 10:44:56 +0000"  >&lt;p&gt;IDK that pinning the system tables really fixes the issue as we&apos;ll still have the problem of losing one disk means a whole node replacement.&lt;br/&gt;
Theoretically it should be possible to rebuild the (important) system tables in the case they get corrupted. Most things currently should be able to be retrieved from gossip/other nodes. How about if there&apos;s something we currently can&apos;t retrieve we just store it in the peers table on all the nodes. I can&apos;t imagine the amount of info we&apos;d have to store would be very big. Then we can just provide a startup flag to indicate that a node should try and rebuild its system tables.&lt;/p&gt;</comment>
                            <comment id="16630407" author="urandom" created="Thu, 27 Sep 2018 13:24:54 +0000"  >&lt;p&gt;Awesome; I&apos;d been meaning to open this very ticket.&lt;/p&gt;

&lt;p&gt;I had planned to suggest what &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=krummas&quot; class=&quot;user-hover&quot; rel=&quot;krummas&quot;&gt;krummas&lt;/a&gt; did, that it be possible to put &lt;tt&gt;system&lt;/tt&gt; in a different data directory. At least if this were possible, &lt;tt&gt;system&lt;/tt&gt; could be put on a RAID.&#160; And, at least in our environments, if the expectation is that you can survive a single device failure, then the OS is likely already on RAID-1 or similar.&lt;/p&gt;

&lt;p&gt;Of course, if the tables in &lt;tt&gt;system&lt;/tt&gt; could be regenerated, that would be better still but I&apos;m not sure what that looks like complexity-wise versus pinning it.&lt;/p&gt;</comment>
                            <comment id="17119639" author="blerer" created="Fri, 29 May 2020 14:09:58 +0000"  >&lt;blockquote&gt;
&lt;p&gt;Of course, if the tables in system could be regenerated, that would be better still but I&apos;m not sure what that looks like complexity-wise versus pinning it.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Regenerating the system tables is far more complex that simply pinning the system tables to a given disk and by consequence more risky.&lt;/p&gt;

&lt;p&gt;I made an initial patch &lt;a href=&quot;https://github.com/apache/cassandra/compare/trunk...blerer:CASSANDRA-14793&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;here&lt;/a&gt;. The patch allow to configure a specific directory for storing system keyspaces data (local and replicated) through the &lt;tt&gt;system_keyspaces_data_file_directory&lt;/tt&gt; property in the cassandra.yaml file. This directory must be different from the other data directories to ensure that it cannot be filled by the data of the other keyspaces. If the &lt;tt&gt;system_keyspaces_data_file_directory&lt;/tt&gt; property was not set the behavior was the same as the one we currently have.&lt;/p&gt;

&lt;p&gt;Another approach suggested by &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=marcuse&quot; class=&quot;user-hover&quot; rel=&quot;marcuse&quot;&gt;marcuse&lt;/a&gt; would be to pin the system keyspaces data to the first of the of the &lt;tt&gt;data_file_directories&lt;/tt&gt;.&lt;/p&gt;

&lt;p&gt;For both solutions we would need to find a way for the user to easily migrates it systems tables data into the new directories if needed.&lt;/p&gt;

&lt;p&gt;I do not have a strong opinion on which solution is better and would like to get some feedback from people having more experience that me with large production clusters.&lt;/p&gt;</comment>
                            <comment id="17119674" author="benedict" created="Fri, 29 May 2020 14:41:53 +0000"  >&lt;p&gt;It would be possible to replicate the data across multiple disks, but only to compact one of these disks, and to replicate the result of compaction to the others?  This would create redundancy for the relatively cheaply-maintained system tables?&lt;/p&gt;

&lt;p&gt;Note that either way the Paxos table might need to be dealt with differently to other system tables, since it is potentially high traffic, and constraining it to one disk might be problematic.  I don&apos;t recall if we ever got round to introducing the range-aware compaction Marcus put together, but the Paxos table seems more suited to this approach.&lt;/p&gt;</comment>
                            <comment id="17155415" author="blerer" created="Fri, 10 Jul 2020 12:14:24 +0000"  >&lt;p&gt;The patch ensure that the data of the local system keyspaces is stored by default within the first data directory (at the exception of the paxos table) to allow the node to tolerate a failure of the disks associated with the other directories.&lt;br/&gt;
   The patch also allow users to configure a different directory for the system keyspaces. This would allow people to use a disk providing redundancy to support the lost of any of the disks used to store the data.&lt;br/&gt;
   On startup existing system keyspace data will be automatically migrated to support 4.0 upgrades or configuration changes (use of a separate disk for the system keyspaces). &lt;/p&gt;</comment>
                            <comment id="17203307" author="blerer" created="Mon, 28 Sep 2020 15:43:00 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=marcuse&quot; class=&quot;user-hover&quot; rel=&quot;marcuse&quot;&gt;marcuse&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=benedict&quot; class=&quot;user-hover&quot; rel=&quot;benedict&quot;&gt;benedict&lt;/a&gt; How do you think we should handle the case where the &lt;tt&gt;disk_failure_policy&lt;/tt&gt; is &lt;tt&gt;best_effort&lt;/tt&gt; and the disk containing the system data is marked as &lt;tt&gt;unreadable&lt;/tt&gt; or &lt;tt&gt;unwritable&lt;/tt&gt; ? &lt;/p&gt;</comment>
                            <comment id="17203377" author="benedict" created="Mon, 28 Sep 2020 17:07:11 +0000"  >&lt;p&gt;Perhaps shut the server down for all writers and compaction, and serve only reads? &#160;I&apos;ve not got a strong opinion about it though - hard to run safely in this context, so would seem fine to just admit defeat in this case. &#160;This does strengthen the argument for replication system keyspace data to multiple disks discussed above.&lt;/p&gt;</comment>
                            <comment id="17205588" author="blerer" created="Thu, 1 Oct 2020 15:00:57 +0000"  >&lt;p&gt;&lt;a href=&quot;https://github.com/apache/cassandra/pull/675&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;PR&lt;/a&gt; &lt;a href=&quot;https://app.circleci.com/pipelines/github/blerer/cassandra/34/workflows/34ff6aa9-2ee9-4d3e-8929-3c9f048ce357&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;CI&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17270137" author="blerer" created="Fri, 22 Jan 2021 13:49:32 +0000"  >&lt;p&gt;I pushed some extra commits to address the rewiev comments.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/apache/cassandra/pull/675&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;Casssandra PR&lt;/a&gt;, &lt;a href=&quot;https://github.com/apache/cassandra-dtest/pull/114&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;Cassandra-Dtest PR&lt;/a&gt;, &lt;a href=&quot;https://app.circleci.com/pipelines/github/blerer/cassandra/95/workflows/3eceedd1-e063-4eef-9336-8a49867fb7e9&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;Circle-ci j8&lt;/a&gt;, &lt;a href=&quot;https://app.circleci.com/pipelines/github/blerer/cassandra/95/workflows/c174d359-cfe5-4a21-a57b-dd5f67a0e3ad&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;Circle-ci j11&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17277987" author="krummas" created="Wed, 3 Feb 2021 13:06:31 +0000"  >&lt;p&gt;+1 (just a final small comment on the pr)&lt;/p&gt;</comment>
                            <comment id="17278086" author="adelapena" created="Wed, 3 Feb 2021 15:42:39 +0000"  >&lt;p&gt;Changes look good to me, +1&lt;/p&gt;</comment>
                            <comment id="17278857" author="blerer" created="Thu, 4 Feb 2021 14:14:55 +0000"  >&lt;p&gt;Cassandra patch committed into trunk at f69b11eee9605add3a006de46eedb773a984d90b&lt;br/&gt;
DTest patch committed into trunk at 28d0a668bf4f23d6b16ec47dc3f2ddab24769105&lt;/p&gt;</comment>
                            <comment id="17278858" author="blerer" created="Thu, 4 Feb 2021 14:15:28 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=adelapena&quot; class=&quot;user-hover&quot; rel=&quot;adelapena&quot;&gt;adelapena&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=marcuse&quot; class=&quot;user-hover&quot; rel=&quot;marcuse&quot;&gt;marcuse&lt;/a&gt; Thanks a lot for the deep reviews.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[blerer]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12313821" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Complexity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12965"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            4 years, 40 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3yiz3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[adelapena]]></customfieldvalue>
        <customfieldvalue><![CDATA[marcuse]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12962"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12311420" key="com.atlassian.jira.plugin.system.customfieldtypes:version">
                        <customfieldname>Since Version</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="12348835">NA</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313924" key="com.atlassian.jira.plugin.system.customfieldtypes:textfield">
                        <customfieldname>Source Control Link</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>&lt;p&gt;&lt;a href=&quot;https://github.com/apache/cassandra/commit/f69b11eee9605add3a006de46eedb773a984d90b&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/cassandra/commit/f69b11eee9605add3a006de46eedb773a984d90b&lt;/a&gt;&lt;/p&gt;</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313823" key="com.atlassian.jira.plugin.system.customfieldtypes:textarea">
                        <customfieldname>Test and Documentation Plan</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>&lt;ul&gt;
	&lt;li&gt;Run of JUnit tests with separate directory for local system keyspaces&lt;/li&gt;
	&lt;li&gt;New unit tests for some of the new code.&lt;/li&gt;
&lt;/ul&gt;
</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>