<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 23:06:08 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-12856] dtest failure in replication_test.SnitchConfigurationUpdateTest.test_cannot_restart_with_different_rack</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-12856</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;example failure:&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://cassci.datastax.com/job/cassandra-2.1_novnode_dtest/280/testReport/replication_test/SnitchConfigurationUpdateTest/test_cannot_restart_with_different_rack&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://cassci.datastax.com/job/cassandra-2.1_novnode_dtest/280/testReport/replication_test/SnitchConfigurationUpdateTest/test_cannot_restart_with_different_rack&lt;/a&gt;&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;Error Message

Problem stopping node node1
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;Stacktrace

  File &lt;span class=&quot;code-quote&quot;&gt;&quot;/usr/lib/python2.7/unittest/&lt;span class=&quot;code-keyword&quot;&gt;case&lt;/span&gt;.py&quot;&lt;/span&gt;, line 329, in run
    testMethod()
  File &lt;span class=&quot;code-quote&quot;&gt;&quot;/home/automaton/cassandra-dtest/replication_test.py&quot;&lt;/span&gt;, line 630, in test_cannot_restart_with_different_rack
    node1.stop(wait_other_notice=True)
  File &lt;span class=&quot;code-quote&quot;&gt;&quot;/usr/local/lib/python2.7/dist-packages/ccmlib/node.py&quot;&lt;/span&gt;, line 727, in stop
    raise NodeError(&lt;span class=&quot;code-quote&quot;&gt;&quot;Problem stopping node %s&quot;&lt;/span&gt; % self.name)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="13016172">CASSANDRA-12856</key>
            <summary>dtest failure in replication_test.SnitchConfigurationUpdateTest.test_cannot_restart_with_different_rack</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10002" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Normal</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="stefania">Stefania Alborghetti</assignee>
                                    <reporter username="sean.mccarthy">Sean McCarthy</reporter>
                        <labels>
                            <label>dtest</label>
                            <label>test-failure</label>
                    </labels>
                <created>Fri, 28 Oct 2016 14:24:59 +0000</created>
                <updated>Tue, 16 Apr 2019 09:30:16 +0000</updated>
                            <resolved>Wed, 11 Jan 2017 07:03:30 +0000</resolved>
                                        <fixVersion>2.1.17</fixVersion>
                    <fixVersion>2.2.9</fixVersion>
                    <fixVersion>3.0.11</fixVersion>
                    <fixVersion>3.10</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="15651901" author="philipthompson" created="Wed, 9 Nov 2016 20:02:21 +0000"  >&lt;p&gt;If we check the logs, it&apos;s just &lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;WARN  [&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;-2] 2016-10-27 19:28:01,236 CustomTThreadPoolServer.java:122 - Transport error occurred during acceptance of message.
org.apache.thrift.transport.TTransportException: No underlying server socket.
	at org.apache.cassandra.thrift.TCustomServerSocket.acceptImpl(TCustomServerSocket.java:96) ~[main/:na]
	at org.apache.cassandra.thrift.TCustomServerSocket.acceptImpl(TCustomServerSocket.java:36) ~[main/:na]
	at org.apache.thrift.transport.TServerTransport.accept(TServerTransport.java:60) ~[libthrift-0.9.2.jar:0.9.2]
	at org.apache.cassandra.thrift.CustomTThreadPoolServer.serve(CustomTThreadPoolServer.java:110) ~[main/:na]
	at org.apache.cassandra.thrift.ThriftServer$ThriftServerThread.run(ThriftServer.java:137) [main/:na]
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mshuler&quot; class=&quot;user-hover&quot; rel=&quot;mshuler&quot;&gt;mshuler&lt;/a&gt;, haven&apos;t we seen this before? Did we say it was a hardware problem?&lt;/p&gt;</comment>
                            <comment id="15651952" author="mshuler" created="Wed, 9 Nov 2016 20:23:15 +0000"  >&lt;p&gt;It&apos;s not fresh in my memory, but it is a possibility.&lt;/p&gt;</comment>
                            <comment id="15651955" author="mshuler" created="Wed, 9 Nov 2016 20:24:59 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/issues/?jql=project%20%3D%20CASSANDRA%20AND%20text%20~%20%22No%20underlying%20server%20socket%22&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/issues/?jql=project%20%3D%20CASSANDRA%20AND%20text%20~%20%22No%20underlying%20server%20socket%22&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;has a few interesting hits.&lt;/p&gt;</comment>
                            <comment id="15673123" author="stefania" created="Thu, 17 Nov 2016 08:23:36 +0000"  >&lt;p&gt;Multiplexing 150 times &lt;a href=&quot;https://cassci.datastax.com/view/Dev/view/stef1927/job/stef1927-dtest-multiplex/79/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;here&lt;/a&gt;, to see how easy it is to reproduce.&lt;/p&gt;</comment>
                            <comment id="15673201" author="stefania" created="Thu, 17 Nov 2016 09:11:46 +0000"  >&lt;p&gt;No failures. Multiplexing another 150 times &lt;a href=&quot;https://cassci.datastax.com/view/Dev/view/stef1927/job/stef1927-dtest-multiplex/80/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;here&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="15794639" author="stefania" created="Tue, 3 Jan 2017 09:41:38 +0000"  >&lt;p&gt;I&apos;m trying to reproduce the problem one more time &lt;a href=&quot;https://cassci.datastax.com/view/Dev/view/stef1927/job/stef1927-dtest-multiplex/95/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;here&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;Other than the exception above, there isn&apos;t anything else in the logs. Therefore, it&apos;s not possible to know for sure what caused the problem unless we can reproduce it but, from source code inspection, this &lt;a href=&quot;https://github.com/apache/cassandra/blob/cassandra-3.X/src/java/org/apache/cassandra/thrift/CustomTThreadPoolServer.java#L101&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;line&lt;/a&gt; would explain the problem, if  &lt;a href=&quot;https://github.com/apache/cassandra/blob/cassandra-3.X/src/java/org/apache/cassandra/thrift/CustomTThreadPoolServer.java#L159&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;&lt;tt&gt;stop()&lt;/tt&gt;&lt;/a&gt; is called before the thrift server thread has executed it. It doesn&apos;t look like it&apos;s needed either, since &lt;tt&gt;serve()&lt;/tt&gt; is only called once. The test that fails, starts and stops the node immediately, so this is a valid possibility.&lt;/p&gt;

&lt;p&gt;I&apos;ve prepared the patch for the following branches, I&apos;ve skipped trunk because Thirft was removed and 3.11 because it is very similar to 3.X:&lt;/p&gt;

&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;2.1&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;2.2&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;3.0&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;3.X&lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/stef1927/cassandra/tree/12856-2.1&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;patch&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/stef1927/cassandra/tree/12856-2.2&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;patch&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/stef1927/cassandra/tree/12856-3.0&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;patch&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/stef1927/cassandra/tree/12856-3.X&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;patch&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/stef1927/job/stef1927-12856-2.1-testall/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;testall&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/stef1927/job/stef1927-12856-2.2-testall/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;testall&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/stef1927/job/stef1927-12856-3.0-testall/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;testall&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/stef1927/job/stef1927-12856-3.X-testall/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;testall&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/stef1927/job/stef1927-12856-2.1-dtest/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;dtest&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/stef1927/job/stef1927-12856-2.2-dtest/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;dtest&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/stef1927/job/stef1927-12856-3.0-dtest/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;dtest&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/stef1927/job/stef1927-12856-3.X-dtest/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;dtest&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;


&lt;p&gt;The 2.1 patch applies cleanly on all branches, CI is currently running on 2.1 only. I&apos;m not sure which branches this patch should be committed to: the race is extremely rare but the consequences are quite bad (a thread looping forever).&lt;/p&gt;</comment>
                            <comment id="15794820" author="stefania" created="Tue, 3 Jan 2017 11:18:44 +0000"  >&lt;p&gt;Still cannot reproduce this failure even when multiplexing. Nonetheless, I think the analysis above provides a reasonable explanation, and in any case the existing code is unsafe, so moving to patch available.&lt;/p&gt;</comment>
                            <comment id="15813610" author="jkni" created="Tue, 10 Jan 2017 02:36:15 +0000"  >&lt;p&gt;Nice catch! I wasn&apos;t able to reproduce either, but I could easily induce the race. I also confirmed that all historical instances of this failure were on tests that start and then immediately stop a node. I started CI for 2.2, 3.0, and 3.X. All CI looks good.&lt;/p&gt;

&lt;p&gt;My main concern was that this new method doesn&apos;t allow a serve() again after stop(), but I confirmed this doesn&apos;t affect our usage since we recreate the object on enabling/disable Thrift. It also doesn&apos;t violate any Thrift implementation requirements.&lt;/p&gt;

&lt;p&gt;I wouldn&apos;t argue for this to go into 2.1; while the looping thread is unfortunate, it shouldn&apos;t cause data loss or cascading failures, and it should only affect instances were a server is started and immediately stopped, which already suggests an unusual situation. That said, the change is small enough that I wouldn&apos;t be concerned about it going into 2.1 either.&lt;/p&gt;

&lt;p&gt;+1&lt;/p&gt;</comment>
                            <comment id="15817452" author="stefania" created="Wed, 11 Jan 2017 07:03:30 +0000"  >&lt;p&gt;Thank you for the detailed review!&lt;/p&gt;

&lt;p&gt;I&apos;ve committed it to 2.1 (47f7d9c6aab694bf956fa2174fe0dd36702e01a6) and merged upwards. I chose 2.1 because it is safe and it fixes a test, which otherwise would continue failing.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12986872">CASSANDRA-12135</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12835811" name="node1.log" size="16988022" author="sean.mccarthy" created="Fri, 28 Oct 2016 14:24:59 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[stefania]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 44 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i35jr3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>jkni</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[jkni]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12962"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>