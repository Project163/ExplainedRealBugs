<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 23:14:01 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-15373] validate value sizes in LegacyLayout</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-15373</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;In 2.1, all values are serialized as variable length blobs, with a length prefix, followed by the actual value, even with fixed width types like int32. The 3.0 storage engine, on the other hand, omits the length prefix for fixed width types. Since the length of fixed width types are not validated on the 3.0 write path, writing data for a fixed width type from an incorrectly sized byte buffer will over or underflow the space allocated for it, corrupting the remainder of that partition or indexed region from being read. This is not discovered until we attempt to read the corrupted value. This patch updates LegacyLayout to throw a marshal exception if it encounters an unexpected value size for fixed size columns.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13264131">CASSANDRA-15373</key>
            <summary>validate value sizes in LegacyLayout</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10002" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Normal</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="bdeggleston">Blake Eggleston</assignee>
                                    <reporter username="bdeggleston">Blake Eggleston</reporter>
                        <labels>
                    </labels>
                <created>Wed, 23 Oct 2019 22:38:26 +0000</created>
                <updated>Fri, 15 May 2020 08:38:51 +0000</updated>
                            <resolved>Wed, 6 Nov 2019 20:14:19 +0000</resolved>
                                        <fixVersion>3.0.20</fixVersion>
                    <fixVersion>3.11.6</fixVersion>
                    <fixVersion>4.0-alpha3</fixVersion>
                    <fixVersion>4.0</fixVersion>
                                    <component>Legacy/Local Write-Read Paths</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="16958315" author="bdeggleston" created="Wed, 23 Oct 2019 22:43:25 +0000"  >&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/bdeggleston/cassandra/tree/15373-3.0&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;3.0&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://circleci.com/gh/bdeggleston/cassandra/tree/15373-3.0&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;tests&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/bdeggleston/cassandra/tree/15373-3.11&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;3.11&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://circleci.com/gh/bdeggleston/cassandra/tree/15373-3.11&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;tests&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;
</comment>
                            <comment id="16958789" author="benedict" created="Thu, 24 Oct 2019 10:32:20 +0000"  >&lt;p&gt;Patch looks good, only suggestion is that we should consider also performing this check for RTs in &lt;tt&gt;decodeBound&lt;/tt&gt;, and statics in &lt;tt&gt;extractStaticColumns&lt;/tt&gt;&lt;/p&gt;</comment>
                            <comment id="16959009" author="bdeggleston" created="Thu, 24 Oct 2019 16:22:25 +0000"  >&lt;p&gt;thanks, added checks to both methods&lt;/p&gt;</comment>
                            <comment id="16959815" author="beobal" created="Fri, 25 Oct 2019 14:36:09 +0000"  >&lt;p&gt;LGTM, with 2 minor comments:&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;In &lt;tt&gt;decodeBound&lt;/tt&gt;, shouldn&apos;t we also check in the non-compound case?&lt;/li&gt;
	&lt;li&gt;&lt;tt&gt;LegacyCellName(Clustering clustering, ColumnDefinition column, ByteBuffer collectionElement)&lt;/tt&gt; is only called from &lt;tt&gt;LegacyCellName create(Clustering clustering, ColumnDefinition column)&lt;/tt&gt; so you could just construct the &lt;tt&gt;LegacyCellName&lt;/tt&gt; directly there.&lt;/li&gt;
&lt;/ul&gt;

</comment>
                            <comment id="16959940" author="bdeggleston" created="Fri, 25 Oct 2019 17:29:52 +0000"  >&lt;p&gt;thanks, pushed up updated branches&lt;/p&gt;</comment>
                            <comment id="16961057" author="benedict" created="Mon, 28 Oct 2019 13:50:53 +0000"  >&lt;p&gt;I think there&apos;s one remaining missing check: in &lt;tt&gt;decodeCellName&lt;/tt&gt; we need to verify that the &lt;tt&gt;collectionElement&lt;/tt&gt; is valid, as it can be a fixed width type.&lt;/p&gt;</comment>
                            <comment id="16961190" author="bdeggleston" created="Mon, 28 Oct 2019 15:58:56 +0000"  >&lt;p&gt;good catch, fixed&lt;/p&gt;</comment>
                            <comment id="16961191" author="benedict" created="Mon, 28 Oct 2019 16:00:13 +0000"  >&lt;p&gt;+1 from me&lt;/p&gt;</comment>
                            <comment id="16961237" author="beobal" created="Mon, 28 Oct 2019 16:47:49 +0000"  >&lt;p&gt;+1 from me too - you just need to fix the newest tests on the 3.11 branch (e.g. &lt;tt&gt;s/new Clustering/Clustering.make/&lt;/tt&gt;)&lt;/p&gt;</comment>
                            <comment id="16961319" author="bdeggleston" created="Mon, 28 Oct 2019 18:12:36 +0000"  >&lt;p&gt;fixed, also made a small adjustment to unbreak a test for &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-14912&quot; title=&quot;LegacyLayout errors on collection tombstones from dropped columns&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-14912&quot;&gt;&lt;del&gt;CASSANDRA-14912&lt;/del&gt;&lt;/a&gt; (&lt;a href=&quot;https://circleci.com/gh/bdeggleston/cassandra/2537#tests/containers/94&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://circleci.com/gh/bdeggleston/cassandra/2537#tests/containers/94&lt;/a&gt;)&lt;/p&gt;</comment>
                            <comment id="16968662" author="bdeggleston" created="Wed, 6 Nov 2019 20:14:19 +0000"  >&lt;p&gt;thanks, committed as &lt;a href=&quot;https://github.com/apache/cassandra/commit/53f604dc1789a800dbcbc3c8aee77f8f36b8b5db&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;53f604dc1789a800dbcbc3c8aee77f8f36b8b5db&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16971375" author="ifesdjeen" created="Mon, 11 Nov 2019 08:14:50 +0000"  >&lt;p&gt;(Big thanks to &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=marcuse&quot; class=&quot;user-hover&quot; rel=&quot;marcuse&quot;&gt;marcuse&lt;/a&gt; for noticing I initially commented on the wrong jira)&lt;/p&gt;


&lt;p&gt;I&apos;ve noticed that the patch uses &lt;tt&gt;validateIfFixedSize&lt;/tt&gt;. Wanted to let you know that &lt;tt&gt;validateIfFixedSize&lt;/tt&gt; is not implemented for &lt;tt&gt;ByteType&lt;/tt&gt; and &lt;tt&gt;ShortType&lt;/tt&gt; even though they&apos;re fixed size. &lt;/p&gt;</comment>
                            <comment id="16971558" author="benedict" created="Mon, 11 Nov 2019 14:00:44 +0000"  >&lt;p&gt;So, while it might make sense to &lt;tt&gt;validateIfFixedSize&lt;/tt&gt; on these fields, in fact they are not &quot;fixed size&quot; according to the storage layer.  They clearly &lt;em&gt;are&lt;/em&gt; fixed size, but somebody forgot to mark them as such, so that for purposes of this patch the validation isn&apos;t important.&lt;/p&gt;

&lt;p&gt;But you&apos;re right that we might as well validate them too, and we could follow up with a simple modification.&lt;/p&gt;

&lt;p&gt;&lt;em&gt;If we do&lt;/em&gt; then, while we&apos;re there, I also notice we have &lt;tt&gt;valueLengthIfFixed&lt;/tt&gt; and &lt;tt&gt;validateIfFixedSize&lt;/tt&gt; and we should probably standardise on either &quot;fixed size&quot; or &quot;fixed length&quot; rather than mixing the two (sorry, should have spotted that during review first time around)&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="13302322">CASSANDRA-15778</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[bdeggleston]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12313825" key="com.atlassian.jira.plugin.system.customfieldtypes:cascadingselect">
                        <customfieldname>Bug Category</customfieldname>
                        <customfieldvalues>
                                                    <customfieldvalue key="12982" cascade-level=""><![CDATA[Correctness]]></customfieldvalue>
                                <customfieldvalue key="13161" cascade-level="1"><![CDATA[Unrecoverable Corruption / Loss]]></customfieldvalue>
            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12313821" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Complexity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12965"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313822" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Discovered By</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12969"><![CDATA[User Report]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12313922" key="jira.plugin.projectspecificselectfield.jpssf:multicftype">
                        <customfieldname>Impacts</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="13100"><![CDATA[None]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            6 years, 1 week, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12313921" key="jira.plugin.projectspecificselectfield.jpssf:multicftype">
                        <customfieldname>Platform</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="13076"><![CDATA[All]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z07w8o:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[benedict]]></customfieldvalue>
        <customfieldvalue><![CDATA[samt]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12962"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12311420" key="com.atlassian.jira.plugin.system.customfieldtypes:version">
                        <customfieldname>Since Version</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="12333891">3.0.0</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313924" key="com.atlassian.jira.plugin.system.customfieldtypes:textfield">
                        <customfieldname>Source Control Link</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>&lt;p&gt;&lt;a href=&quot;https://github.com/apache/cassandra/commit/53f604dc1789a800dbcbc3c8aee77f8f36b8b5db&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/cassandra/commit/53f604dc1789a800dbcbc3c8aee77f8f36b8b5db&lt;/a&gt;&lt;/p&gt;</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313823" key="com.atlassian.jira.plugin.system.customfieldtypes:textarea">
                        <customfieldname>Test and Documentation Plan</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>&lt;p&gt;circleci&lt;/p&gt;</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>