<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 22:59:13 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-10089] NullPointerException in Gossip handleStateNormal</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-10089</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;Whilst comparing dtests for &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-9970&quot; title=&quot;CQL 3.3 ordering in where clause produces different results when using &amp;quot;IN...ORDER BY&amp;quot;&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-9970&quot;&gt;&lt;del&gt;CASSANDRA-9970&lt;/del&gt;&lt;/a&gt; I found &lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/blerer/job/blerer-9970-dtest/lastCompletedBuild/testReport/consistency_test/TestConsistency/short_read_test/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;this failing dtest&lt;/a&gt; in 2.2:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;Unexpected error in node1 node log: [&lt;span class=&quot;code-quote&quot;&gt;&apos;ERROR [GossipStage:1] 2015-08-14 15:39:57,873 CassandraDaemon.java:183 - Exception in thread &lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;[GossipStage:1,5,main] java.lang.NullPointerException: &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; \tat org.apache.cassandra.service.StorageService.getApplicationStateValue(StorageService.java:1731) ~[main/:na] \tat org.apache.cassandra.service.StorageService.getTokensFor(StorageService.java:1804) ~[main/:na] \tat org.apache.cassandra.service.StorageService.handleStateNormal(StorageService.java:1857) ~[main/:na] \tat org.apache.cassandra.service.StorageService.onChange(StorageService.java:1629) ~[main/:na] \tat org.apache.cassandra.service.StorageService.onJoin(StorageService.java:2312) ~[main/:na] \tat org.apache.cassandra.gms.Gossiper.handleMajorStateChange(Gossiper.java:1025) ~[main/:na] \tat org.apache.cassandra.gms.Gossiper.applyStateLocally(Gossiper.java:1106) ~[main/:na] \tat org.apache.cassandra.gms.GossipDigestAck2VerbHandler.doVerb(GossipDigestAck2VerbHandler.java:49) ~[main/:na] \tat org.apache.cassandra.net.MessageDeliveryTask.run(MessageDeliveryTask.java:66) ~[main/:na] \tat java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1145) ~[na:1.7.0_80] \tat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:615) ~[na:1.7.0_80] \tat java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:745) ~[na:1.7.0_80]&apos;&lt;/span&gt;]
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I wasn&apos;t able to find it on unpatched branches  but it is clearly not related to &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-9970&quot; title=&quot;CQL 3.3 ordering in where clause produces different results when using &amp;quot;IN...ORDER BY&amp;quot;&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-9970&quot;&gt;&lt;del&gt;CASSANDRA-9970&lt;/del&gt;&lt;/a&gt;, if anything it could have been a side effect of &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-9871&quot; title=&quot;Cannot replace token does not exist - DN node removed as Fat Client&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-9871&quot;&gt;&lt;del&gt;CASSANDRA-9871&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12856486">CASSANDRA-10089</key>
            <summary>NullPointerException in Gossip handleStateNormal</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10002" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Normal</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="stefania">Stefania Alborghetti</assignee>
                                    <reporter username="stefania">Stefania Alborghetti</reporter>
                        <labels>
                    </labels>
                <created>Mon, 17 Aug 2015 00:46:59 +0000</created>
                <updated>Wed, 15 Oct 2025 09:49:03 +0000</updated>
                            <resolved>Wed, 11 Nov 2015 20:10:26 +0000</resolved>
                                        <fixVersion>2.1.12</fixVersion>
                    <fixVersion>2.2.4</fixVersion>
                    <fixVersion>3.0.1</fixVersion>
                    <fixVersion>3.1</fixVersion>
                                    <component>Legacy/Distributed Metadata</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="14700098" author="mambocab" created="Mon, 17 Aug 2015 19:37:20 +0000"  >&lt;p&gt;The NPE &lt;a href=&quot;http://cassci.datastax.com/view/trunk/job/trunk_dtest/lastCompletedBuild/testReport/junit/consistency_test/TestConsistency/short_read_reversed_test/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;here&lt;/a&gt; looks similar, so this likely affects trunk as well.&lt;/p&gt;</comment>
                            <comment id="14734214" author="stefania" created="Tue, 8 Sep 2015 04:14:48 +0000"  >&lt;p&gt;The NPE can be seen also in 2.1 &lt;a href=&quot;http://cassci.datastax.com/job/cassandra-2.1_dtest/241/testReport/consistency_test/TestConsistency/short_read_test/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;here&lt;/a&gt; so I will prepare a patch for 2.1+.&lt;/p&gt;</comment>
                            <comment id="14734288" author="stefania" created="Tue, 8 Sep 2015 06:05:09 +0000"  >&lt;p&gt;I&apos;ve attached a 2.1+ patch that prevents the NPE. I could not reproduce the problem locally despite running the offending dtests several times but I plan to run CI several times. The NPE should be definitely fixed, the question is whether having a node jumping to state normal with no tokens could cause issues.&lt;/p&gt;

&lt;h3&gt;&lt;a name=&quot;Patches%3A&quot;&gt;&lt;/a&gt;Patches:&lt;/h3&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/stef1927/cassandra/commits/10089-2.1&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/stef1927/cassandra/commits/10089-2.1&lt;/a&gt;&lt;br/&gt;
&lt;a href=&quot;https://github.com/stef1927/cassandra/commits/10089-2.2&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/stef1927/cassandra/commits/10089-2.2&lt;/a&gt;&lt;br/&gt;
&lt;a href=&quot;https://github.com/stef1927/cassandra/commits/10089-3.0&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/stef1927/cassandra/commits/10089-3.0&lt;/a&gt;&lt;/p&gt;

&lt;h3&gt;&lt;a name=&quot;CI%3A&quot;&gt;&lt;/a&gt;CI:&lt;/h3&gt;

&lt;p&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/stef1927/job/stef1927-10089-2.1-testall/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://cassci.datastax.com/view/Dev/view/stef1927/job/stef1927-10089-2.1-testall/&lt;/a&gt;&lt;br/&gt;
&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/stef1927/job/stef1927-10089-2.1-dtest/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://cassci.datastax.com/view/Dev/view/stef1927/job/stef1927-10089-2.1-dtest/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/stef1927/job/stef1927-10089-2.2-testall/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://cassci.datastax.com/view/Dev/view/stef1927/job/stef1927-10089-2.2-testall/&lt;/a&gt;&lt;br/&gt;
&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/stef1927/job/stef1927-10089-2.2-dtest/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://cassci.datastax.com/view/Dev/view/stef1927/job/stef1927-10089-2.2-dtest/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/stef1927/job/stef1927-10089-3.0-testall/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://cassci.datastax.com/view/Dev/view/stef1927/job/stef1927-10089-3.0-testall/&lt;/a&gt;&lt;br/&gt;
&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/stef1927/job/stef1927-10089-3.0-dtest/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://cassci.datastax.com/view/Dev/view/stef1927/job/stef1927-10089-3.0-dtest/&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14734783" author="jbellis" created="Tue, 8 Sep 2015 13:18:17 +0000"  >&lt;blockquote&gt;&lt;p&gt;the question is whether having a node jumping to state normal with no tokens could cause issues&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I do think that would cause problems.  But this should still prevent that, right?  You&apos;re just eliminating the potential race that they could &quot;disappear&quot; after the check.&lt;/p&gt;</comment>
                            <comment id="14735957" author="stefania" created="Wed, 9 Sep 2015 01:32:16 +0000"  >&lt;blockquote&gt;&lt;p&gt;You&apos;re just eliminating the potential race that they could &quot;disappear&quot; after the check.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Yes, we are just preventing the NPE caused by a potential race or simply because the tokens are removed when in state is shutdown. &lt;tt&gt;SS.handleStateNormal()&lt;/tt&gt; will still execute but with an empty collection of tokens. From code inspection this should not cause problems.&lt;/p&gt;

&lt;p&gt;The first CI run was successful, failing tests are inline with unpatched branches and I saw no NPEs. &lt;/p&gt;

&lt;p&gt;I rebased and relaunched CI again.&lt;/p&gt;</comment>
                            <comment id="14736868" author="jbellis" created="Wed, 9 Sep 2015 13:48:21 +0000"  >&lt;blockquote&gt;&lt;p&gt;the tokens are removed when in state is shutdown&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Why do we do that?  Superficially at least it doesn&apos;t make sense to me to remove tokens except for topology changes (decommission, replace, etc).&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;still execute but with an empty collection of tokens&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Maybe we should extend the user-level error to cover &quot;null or empty&quot; and not just null.&lt;/p&gt;</comment>
                            <comment id="14738061" author="stefania" created="Thu, 10 Sep 2015 02:57:57 +0000"  >&lt;p&gt;I spent some more time debugging GOSSIP updates when nodes are restarted by adding additional debug messages. It&apos;s not that &lt;em&gt;we remove tokens in status shutdown&lt;/em&gt;, rather when a node restarts there is a window where we have received a major Gossip update with no tokens, followed by delta updates also with no tokens or status, followed eventually by a delta or full update with status NORMAL and some tokens. My guess is that we mark the node as SHUTDOWN during this window when we have no tokens. Then the next time we get a delta without tokens, we crash because we are in status SHUTDOWN with no tokens.&lt;/p&gt;

&lt;p&gt;Locally on my box, the node is always marked as SHUTDOWN by the Gossip shutdown verb handler, so before the first major update with no tokens and therefore I cannot reproduce it. I am going to run on Jenkins a branch with these additional debug messages to see if I can gather some more information. &lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;Maybe we should extend the user-level error to cover &quot;null or empty&quot; and not just null.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;So we would log at ERROR level if &lt;tt&gt;handleStateNormal&lt;/tt&gt; is called with no tokens?&lt;/p&gt;</comment>
                            <comment id="14934356" author="stefania" created="Mon, 28 Sep 2015 23:45:35 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jbellis&quot; class=&quot;user-hover&quot; rel=&quot;jbellis&quot;&gt;jbellis&lt;/a&gt; can I have a reviewer for this patch? I was not able to reproduce the problem despite a few rounds of CI, so I am no 100% sure of what causes tokens to be missing during a &lt;tt&gt;handleStateNormal&lt;/tt&gt; but the patch will at least fix the NPE. &lt;/p&gt;</comment>
                            <comment id="14949105" author="jkni" created="Thu, 8 Oct 2015 18:30:32 +0000"  >&lt;p&gt;I&apos;m +1 on patch code quality and fixing the race condition.&lt;/p&gt;

&lt;p&gt;I&apos;d like to track down the cause of the missing &lt;tt&gt;handleStateNormal&lt;/tt&gt;, but like you, spent quite a while trying to reproduce and could not.&lt;/p&gt;

&lt;p&gt;At a minimum, I&apos;m in favor of logging at ERROR level if &lt;tt&gt;handleStateNormal&lt;/tt&gt; is called with no tokens; while I also can&apos;t find any consequences of a node with no tokens in NORMAL state, I&apos;m not certain there aren&apos;t any.&lt;/p&gt;

&lt;p&gt;This seems related to a set of issues around token metadata flushing and node startup (like &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-10293&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;10293&lt;/a&gt;). As part of such, I wonder if it doesn&apos;t make sense to force a blocking flush of the system keyspace in &lt;a href=&quot;https://github.com/apache/cassandra/blob/9515fca7692ed09aa0b3c6c12f038d6a459d87de/src/java/org/apache/cassandra/db/SystemKeyspace.java#L690&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;updateTokens&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;Anyway, I&apos;m +1 on this patch fixing the NPE but do wonder if we have a larger issue to solve here.&lt;/p&gt;</comment>
                            <comment id="14949775" author="stefania" created="Fri, 9 Oct 2015 02:12:53 +0000"  >&lt;p&gt;Thanks. I&apos;ve rebased all 3 versions of the patch and added a log message at ERROR level in &lt;tt&gt;handleStateNormal&lt;/tt&gt;. This error message should cause any dtests to fail on Jenkins if they hit &lt;tt&gt;handleStateNormal&lt;/tt&gt; with no tokens; so this will at least tell us if we still have an issue with missing tokens. We also log the full gossip state but chances are we will again not be able to tell what has happened just by looking at the state.&lt;/p&gt;

&lt;p&gt;As for forcing a blocking flush in &lt;tt&gt;updateTokens&lt;/tt&gt;, &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-10293&quot; title=&quot;Re-populate token metadata after commit log replay&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-10293&quot;&gt;&lt;del&gt;CASSANDRA-10293&lt;/del&gt;&lt;/a&gt; should ensure that we update the tokens after replaying the commit log so a blocking flush would only make sense if we need the tokens before replaying the commit log (cc &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=krummas&quot; class=&quot;user-hover&quot; rel=&quot;krummas&quot;&gt;krummas&lt;/a&gt; for &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-6696&quot; title=&quot;Partition sstables by token range&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-6696&quot;&gt;&lt;del&gt;CASSANDRA-6696&lt;/del&gt;&lt;/a&gt; / &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-9317&quot; title=&quot;Populate TokenMetadata earlier during startup&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-9317&quot;&gt;&lt;del&gt;CASSANDRA-9317&lt;/del&gt;&lt;/a&gt;) or if we are worried about crashing before a commit log sync to disk. I am not sure about any performance impact however.&lt;/p&gt;</comment>
                            <comment id="14949814" author="stefania" created="Fri, 9 Oct 2015 03:02:47 +0000"  >&lt;p&gt;Let&apos;s move the discussion on forcing a blocking flush in &lt;tt&gt;updateTokens&lt;/tt&gt; to &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-10231&quot; title=&quot;Null status entries on nodes that crash during decommission of a different node&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-10231&quot;&gt;&lt;del&gt;CASSANDRA-10231&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="14953192" author="jkni" created="Mon, 12 Oct 2015 14:51:01 +0000"  >&lt;p&gt;These updated patches look good.&lt;/p&gt;

&lt;p&gt;It looks like CassCI aborted several of the dtest/testall runs for these rebased branches. It is almost certainly environmental, but it&apos;d be great if you could kick those off one more time, so that we can get a clean CI bill of health.&lt;/p&gt;

&lt;p&gt;The blocking flush discussion was moved to &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-10231&quot; title=&quot;Null status entries on nodes that crash during decommission of a different node&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-10231&quot;&gt;&lt;del&gt;CASSANDRA-10231&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="14954739" author="stefania" created="Tue, 13 Oct 2015 10:05:15 +0000"  >&lt;p&gt;I&apos;ve rebased all 3 patches and triggered one more CI run for each one of them. Still pending though.&lt;/p&gt;</comment>
                            <comment id="14959718" author="jkni" created="Thu, 15 Oct 2015 22:05:07 +0000"  >&lt;p&gt;Unfortunately, it looks like whatever environmental issues affected the first run also hit the most recent run. &lt;/p&gt;

&lt;p&gt;Fortunately, looking at 2.1/2.2 dtest/testall runs recently, it seems to have been resolved.&lt;/p&gt;

&lt;p&gt;Can you trigger one more run? If that doesn&apos;t work, I&apos;ll evaluate tests locally as part of review.&lt;/p&gt;

&lt;p&gt;Sorry about this.&lt;/p&gt;</comment>
                            <comment id="14959758" author="mambocab" created="Thu, 15 Oct 2015 22:32:15 +0000"  >&lt;p&gt;Sorry to insert myself, but: you should be able to trigger the builds you want by just pulling down Stefania&apos;s branch and pushing it to GitHub.&lt;/p&gt;</comment>
                            <comment id="14959869" author="jkni" created="Thu, 15 Oct 2015 23:47:29 +0000"  >&lt;p&gt;I suppose Jim&apos;s suggestion is the sensible solution here. &lt;/p&gt;

&lt;p&gt;I&apos;ve pushed branches of the same name to my repo to get CI results. I&apos;ll update once those are in, and hopefully they&apos;ll be good and I can +1.&lt;/p&gt;</comment>
                            <comment id="14961373" author="jkni" created="Fri, 16 Oct 2015 21:17:33 +0000"  >&lt;p&gt;Unfortunately, latest CI runs don&apos;t look entirely clean yet.  In particular, on 2.2, &lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/jkni/job/jkni-10089-2.2-dtest/2/testReport/junit/incremental_repair_test/TestIncRepair/multiple_repair_test_2/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;incremental_repair_test.TestIncRepair.multiple_repair_test&lt;/a&gt; fails due to a state in normal with no tokens.&lt;/p&gt;

&lt;p&gt;I&apos;m trying to reproduce this failure locally with higher logging levels.&lt;/p&gt;</comment>
                            <comment id="14962849" author="stefania" created="Mon, 19 Oct 2015 05:21:29 +0000"  >&lt;p&gt;I&apos;ve rebased all 3 branches and started a new set of jobs to see if we can reproduce the 2.2 problem highlighted above. I spent a couple of hours trying to reproduce it locally but I could not. We need TRACE level, at least for Gossiper.&lt;/p&gt;

&lt;p&gt;I&apos;ve attached the &lt;em&gt;multiple_repair_test&lt;/em&gt; log files that are available on Jenkins. Despite having debug in their name they do not contain debug information unfortunately. It looks like node 1 and node 3 were more or less in the same stage of setting their Gossip tokens, which they had just randomly generated, right at the beginning after starting up. I could not deduce why however node 3 did not send its tokens to node 1, it&apos;s really difficult to say without Gossip trace information. From code inspection this should never happen.&lt;/p&gt;
</comment>
                            <comment id="14962964" author="stefania" created="Mon, 19 Oct 2015 07:35:09 +0000"  >&lt;p&gt;I&apos;ve added trace logging for &lt;tt&gt;o.a.c.gms&lt;/tt&gt; on the 2.2 branch, let&apos;s run the job a few more times to see if we can reproduce it. &lt;/p&gt;
</comment>
                            <comment id="14964380" author="stefania" created="Tue, 20 Oct 2015 01:59:45 +0000"  >&lt;p&gt;We managed to reproduce the issue of missing tokens in status normal again with &lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/stef1927/job/stef1927-10089-2.2-dtest/lastCompletedBuild/testReport/consistency_test/TestConsistency/short_read_reversed_test/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;this failed test&lt;/a&gt; and log information at TRACE level for Gossiper. I&apos;ve replaced the files attached to this ticket with the log files for this latest test. The ERROR occurs in node 1 because it gets status NORMAL but no tokens for node 2 from node 2, at around 09:31:16,086.&lt;/p&gt;

&lt;p&gt;The problem is the high scale lib &lt;tt&gt;NonBlockingHashMap&lt;/tt&gt; in &lt;tt&gt;EndpointState&lt;/tt&gt;. Even if we are careful to add the tokens before the status, sometimes the gossip thread gets status normal but no tokens. I&apos;ve reproduced this several times on my machine with &lt;a href=&quot;https://github.com/stef1927/cassandra/commit/275564fa568f47bb136c13e38ad918c4c4fcb944#diff-9c186d237f8b9eda310c20fc4a8c314bR41&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;this unit test&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;I&apos;m not so sure if it&apos;s OK to replace &lt;tt&gt;NonBlockingHashMap&lt;/tt&gt; with &lt;tt&gt;ConcurrentHashMap&lt;/tt&gt; since this would have performance impacts. Alternatively we could see if there is a later version of &lt;tt&gt;NonBlockingHashMap&lt;/tt&gt; or a different implementation of a hash map that is thread safe and that guarantees that if we see a value when iterating, then we see all values inserted or modified before this value. cc &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=brandon.williams&quot; class=&quot;user-hover&quot; rel=&quot;brandon.williams&quot;&gt;brandon.williams&lt;/a&gt; for his knowledge on Gossip and &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=benedict&quot; class=&quot;user-hover&quot; rel=&quot;benedict&quot;&gt;benedict&lt;/a&gt; for his knowledge on hash map implementations.&lt;/p&gt;</comment>
                            <comment id="14973556" author="stefania" created="Mon, 26 Oct 2015 02:05:18 +0000"  >&lt;p&gt;I&apos;ve verified that 1.0.6 is the latest version of &lt;tt&gt;NonBlockingHashMap&lt;/tt&gt; on Maven central. &lt;/p&gt;

&lt;p&gt;&lt;tt&gt;ConcurentHashMap&lt;/tt&gt; does not seem to have this problem since the unit test passes consistently. Therefore I&apos;ve replaced NBHM with CHM and restarted CI for all 3 branches. &lt;/p&gt;

&lt;p&gt;Let&apos;s wait for a few more days to see if there are concerns and if not let&apos;s go with CHM?&lt;/p&gt;</comment>
                            <comment id="14974379" author="jkni" created="Mon, 26 Oct 2015 15:25:11 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=Stefania&quot; class=&quot;user-hover&quot; rel=&quot;stefania&quot;&gt;Stefania&lt;/a&gt; This sounds like the right path forward to me.&lt;/p&gt;

&lt;p&gt;I&apos;ve spent some time looking for alternatives and didn&apos;t find any; I&apos;ve also reproduced the failure with as minimal a construction as possible using fences to ensure the calls to &lt;tt&gt;put&lt;/tt&gt; are ordered as expected.&lt;/p&gt;

&lt;p&gt;From the documentation, it is unclear to me if this behavior is intended to be forbidden by NBHM.&lt;/p&gt;
</comment>
                            <comment id="14978182" author="benedict" created="Wed, 28 Oct 2015 10:38:40 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=stefania&quot; class=&quot;user-hover&quot; rel=&quot;stefania&quot;&gt;stefania&lt;/a&gt;: unfortunately your unit test does not indicate a bug in NBHM. It suggests a bug in the way the map is accessed, and not one that will be alleviated by a change in implementation.&lt;/p&gt;
</comment>
                            <comment id="14978374" author="stefania" created="Wed, 28 Oct 2015 13:02:40 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=benedict&quot; class=&quot;user-hover&quot; rel=&quot;benedict&quot;&gt;benedict&lt;/a&gt;, thanks for looking into this.&lt;/p&gt;

&lt;p&gt;You mean to say that the &lt;em&gt;happens-before&lt;/em&gt; edge is not guaranteed across keys, not even with CHM? &lt;/p&gt;

&lt;p&gt;The unit test accesses the map in the same way as &lt;tt&gt;Gossiper.getStateForVersionBiggerThan()&lt;/tt&gt; does. At least that was the intention. It seems to reliably pass with CHM but maybe it is just luck. Is the only way around this problem a lock around the entire map or to give up on the map and pay O(N) for accessing states?&lt;/p&gt;</comment>
                            <comment id="14978389" author="benedict" created="Wed, 28 Oct 2015 13:15:06 +0000"  >&lt;p&gt;The happens before edge is guaranteed across keys. If you were to perform your lookups against the original map only, everything would be fine. However, iteration is not atomic, and the order is random. If your iteration has passed the position in the map for the first key &lt;em&gt;before&lt;/em&gt; it is added, you will not see it. However if the second key is then added, and occurs after the point you are at, you &lt;em&gt;will&lt;/em&gt; see it.&lt;/p&gt;

&lt;p&gt;I suspect CHM&apos;s hash simply guarantees the order of occurrence in the map &lt;em&gt;for this test only, by chance&lt;/em&gt; puts the second key first. Thus guaranteeing the test passes.&lt;/p&gt;</comment>
                            <comment id="14980993" author="pauloricardomg" created="Thu, 29 Oct 2015 18:29:59 +0000"  >&lt;p&gt;While writing a dtest for another issue I found a bizarre, and somewhat unlikely, but valid situation where the same exception is thrown:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;    def do_not_join_ring_test(self):
        cluster = self.cluster.populate(1)
        node1, = cluster.nodelist()
        node1.start(wait_for_binary_proto=True, join_ring=False) 
        node1.stop()
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;This tests fails with this exception when stopping the node:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;java.lang.NullPointerException: null
        at org.apache.cassandra.service.StorageService.getApplicationStateValue(StorageService.java:1624) ~[main/:na]
        at org.apache.cassandra.service.StorageService.getTokensFor(StorageService.java:1632) ~[main/:na]
        at org.apache.cassandra.service.StorageService.handleStateNormal(StorageService.java:1686) ~[main/:na]
        at org.apache.cassandra.service.StorageService.onChange(StorageService.java:1510) ~[main/:na]
        at org.apache.cassandra.gms.Gossiper.doOnChangeNotifications(Gossiper.java:1185) ~[main/:na]
        at org.apache.cassandra.gms.Gossiper.addLocalApplicationStateInternal(Gossiper.java:1415) ~[main/:na]
        at org.apache.cassandra.gms.Gossiper.addLocalApplicationStates(Gossiper.java:1430) ~[main/:na]
        at org.apache.cassandra.gms.Gossiper.addLocalApplicationState(Gossiper.java:1420) ~[main/:na]
        at org.apache.cassandra.gms.Gossiper.stop(Gossiper.java:1446) ~[main/:na]
        at org.apache.cassandra.service.StorageService$1.runMayThrow(StorageService.java:678) ~[main/:na]
        at org.apache.cassandra.utils.WrappedRunnable.run(WrappedRunnable.java:28) ~[main/:na]
        at java.lang.Thread.run(Thread.java:745) ~[na:1.8.0_45]
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I wonder if we should just leave it, or special case this situation where the local node has not joined the ring and does an orderly shutdown.&lt;/p&gt;</comment>
                            <comment id="14981722" author="stefania" created="Fri, 30 Oct 2015 02:05:52 +0000"  >&lt;p&gt;The problem reported by &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=pauloricardomg&quot; class=&quot;user-hover&quot; rel=&quot;pauloricardomg&quot;&gt;pauloricardomg&lt;/a&gt; is slightly different in that &lt;tt&gt;handleStateNormal&lt;/tt&gt; is called when transitioning into status &lt;tt&gt;SHUTDOWN&lt;/tt&gt;. This patch, when committed, will replace the NPE with an error. I think we should log the error only when we are in status &lt;tt&gt;NORMAL&lt;/tt&gt; and with no tokens, accepting that in status &lt;tt&gt;SHUTDOWN&lt;/tt&gt; it is OK not to have tokens.&lt;/p&gt;

&lt;p&gt;Regarding the race condition, following &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=benedict&quot; class=&quot;user-hover&quot; rel=&quot;benedict&quot;&gt;benedict&lt;/a&gt; explanation,  since it is not possible to get an atomic snapshot of a CHM or NBHM, a possible solution would be to use an atomic reference to &lt;tt&gt;applicationState&lt;/tt&gt; in &lt;tt&gt;EndpointState&lt;/tt&gt; and make a copy in &lt;tt&gt;addApplicationState()&lt;/tt&gt;. We need to introduce &lt;tt&gt;addApplicationStates()&lt;/tt&gt; to accept multiple states, but I reckon creating a copy on update is probably cheaper than locking on every iteration. WDYT &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jkni&quot; class=&quot;user-hover&quot; rel=&quot;jkni&quot;&gt;jkni&lt;/a&gt;?&lt;/p&gt;</comment>
                            <comment id="14983068" author="jkni" created="Fri, 30 Oct 2015 18:50:58 +0000"  >&lt;p&gt;I&apos;ve also checked and don&apos;t think the stacktrace posted by &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=pauloricardomg&quot; class=&quot;user-hover&quot; rel=&quot;pauloricardomg&quot;&gt;pauloricardomg&lt;/a&gt; is indicative of any particular problem, other than an unnecessary amount of work is being done in that situation, which shouldn&apos;t impact correctness. I think the earlier patch is a sufficient solution to this and agree that an error log is not necessary in that situation. I do suggest that the Shutdown state would be better handled by its own method for clarity, but that is an improvement handled in another ticket.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=Stefania&quot; class=&quot;user-hover&quot; rel=&quot;stefania&quot;&gt;Stefania&lt;/a&gt;, I agree with your proposed solution; I don&apos;t have any better ideas without a significant rework of gossip that would introduce too much risk.  I&apos;d say go ahead with that, and I&apos;ll be careful in keeping an eye out for performance impacts in review/testing.&lt;/p&gt;</comment>
                            <comment id="14996159" author="stefania" created="Mon, 9 Nov 2015 07:44:12 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jkni&quot; class=&quot;user-hover&quot; rel=&quot;jkni&quot;&gt;jkni&lt;/a&gt; sorry for the delay, I got side-tracked by another ticket.&lt;/p&gt;

&lt;p&gt;I&apos;ve implemented the proposed copy-on-write of the map using an atomic reference. I&apos;ve limited access to it best I could but we are still exposing the entry set for callers to iterate over it. Further, we no longer log an error if we have no tokens in status SHUTDOWN.&lt;/p&gt;

&lt;p&gt;CI is still running.&lt;/p&gt;</comment>
                            <comment id="14999388" author="jkni" created="Tue, 10 Nov 2015 21:39:57 +0000"  >&lt;p&gt;No apologies necessary; we&apos;ve all been a little busy. Thanks for sticking with this.&lt;/p&gt;

&lt;p&gt;CI runs are available here:&lt;/p&gt;

&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;2.1&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;2.2&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;3.0&lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/stef1927/job/stef1927-10089-2.1-dtest/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;dtest&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/stef1927/job/stef1927-10089-2.2-dtest/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;dtest&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/stef1927/job/stef1927-10089-3.0-dtest/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;dtest&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/stef1927/job/stef1927-10089-2.1-testall/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;testall&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/stef1927/job/stef1927-10089-2.2-testall/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;testall&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/stef1927/job/stef1927-10089-3.0-testall/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;testall&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;


&lt;p&gt;I&apos;ve checked latest dtest/testall runs against the relevant upstream branches and they look clean.&lt;/p&gt;

&lt;p&gt;I&apos;m +1 on code changes. The improved logging in &lt;tt&gt;handleStateNormal&lt;/tt&gt; will help with debugging, and the change to COW for the state map looks good to me.&lt;/p&gt;

&lt;p&gt;The branch referred to as 3.0 has only bug fixes so should be a part of 3.0.1/3.1.&lt;/p&gt;</comment>
                            <comment id="14999779" author="stefania" created="Wed, 11 Nov 2015 01:45:17 +0000"  >&lt;p&gt;Thank you &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jkni&quot; class=&quot;user-hover&quot; rel=&quot;jkni&quot;&gt;jkni&lt;/a&gt;!&lt;/p&gt;</comment>
                            <comment id="15000999" author="jmckenzie" created="Wed, 11 Nov 2015 20:10:27 +0000"  >&lt;p&gt;Committed to 2.1, 2.2, 3.0, 3.1, and trunk.&lt;/p&gt;</comment>
                            <comment id="15002948" author="jkni" created="Thu, 12 Nov 2015 21:17:02 +0000"  >&lt;p&gt;Sorry for missing this in review - it looks like the applied patch could result in a NPE (found by Coverity).&lt;/p&gt;

&lt;p&gt;On this line in &lt;a href=&quot;https://github.com/apache/cassandra/blob/7d6dbf897cd14e6c5811a0588f25e5c11385a9fd/src/java/org/apache/cassandra/gms/Gossiper.java&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;getStateForVersionBiggerThan&lt;/a&gt;, we try to put a list of new states in reqdEndpointState. In the event that we&apos;re getting state for an endpoint that has a lower local heartbeat version and no states for the endpoint/lower application states values for all values in the EndpointState&apos;s ApplicationState map, reqdEndpointState will be null.&lt;/p&gt;

&lt;p&gt;That said, in practice, &lt;tt&gt;getStateForVersionBiggerThan&lt;/tt&gt; is only called in &lt;tt&gt;GossipDigestAckVerbHandler&lt;/tt&gt; for endpoints corresponding to a &lt;tt&gt;GossipDigest&lt;/tt&gt; in the &lt;tt&gt;GossipDigestAck&lt;/tt&gt; message, and digests are only included in the &lt;tt&gt;GossipDigestAck&lt;/tt&gt; message if either the remote heartbeat version or some application state has a higher value than the provided version. Because of this, under no situation should reqdEndpointState be null at the time of adding application states.&lt;/p&gt;

&lt;p&gt;I&apos;m still in favor of guarding this with a null check, but a patch is not of critical importance. What do you think &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=Stefania&quot; class=&quot;user-hover&quot; rel=&quot;stefania&quot;&gt;Stefania&lt;/a&gt;?&lt;/p&gt;</comment>
                            <comment id="15003400" author="stefania" created="Fri, 13 Nov 2015 01:56:36 +0000"  >&lt;p&gt;Thank you for your analysis &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jkni&quot; class=&quot;user-hover&quot; rel=&quot;jkni&quot;&gt;jkni&lt;/a&gt;. We should definitely guard with a null check, here is the &lt;a href=&quot;https://github.com/stef1927/cassandra/tree/10089-cov-2.1&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;patch&lt;/a&gt;. It applies to 2.2+ without conflicts. Would you mind committing &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=JoshuaMcKenzie&quot; class=&quot;user-hover&quot; rel=&quot;JoshuaMcKenzie&quot;&gt;JoshuaMcKenzie&lt;/a&gt;?&lt;/p&gt;
</comment>
                            <comment id="15004028" author="jmckenzie" created="Fri, 13 Nov 2015 14:19:23 +0000"  >&lt;p&gt;Committed &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=cassandra.git;a=commit;h=582b66fbdfbedd8eb14b16c9f6522067ea921a13&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;followup&lt;/a&gt; and merged up.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                                                <inwardlinks description="is duplicated by">
                                        <issuelink>
            <issuekey id="12831854">CASSANDRA-9453</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12767513" name="node1_debug.log" size="3391448" author="stefania" created="Tue, 20 Oct 2015 01:46:46 +0000"/>
                            <attachment id="12767514" name="node2_debug.log" size="3474505" author="stefania" created="Tue, 20 Oct 2015 01:46:46 +0000"/>
                            <attachment id="12767515" name="node3_debug.log" size="3493432" author="stefania" created="Tue, 20 Oct 2015 01:46:46 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[stefania]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 1 week, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2izev:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12311421" key="com.atlassian.jira.plugin.system.customfieldtypes:multiversion">
                        <customfieldname>Reproduced In</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="12332360">2.2.x</customfieldvalue>
    <customfieldvalue id="12332541">3.0.x</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>jkni</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[jkni]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12962"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>