<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 22:30:07 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-3954] Exceptions during start up after schema disagreement</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-3954</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;Hi,&lt;br/&gt;
i`ve got schema disaggreement after dropping down keyspace,&lt;br/&gt;
i`ve switched off one nodes in cluster, after starting i`ve got bunch of these exceptions:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;ERROR [SSTableBatchOpen:1] 2012-02-24 14:21:00,759 AbstractCassandraDaemon.java (line 134) Fatal exception in thread &lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;[SSTableBatchOpen:1,5,main]
java.lang.ClassCastException: java.math.BigInteger cannot be &lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt; to java.nio.ByteBuffer
        at org.apache.cassandra.db.marshal.UTF8Type.compare(UTF8Type.java:27)
        at org.apache.cassandra.dht.LocalToken.compareTo(LocalToken.java:45)
        at org.apache.cassandra.db.DecoratedKey.compareTo(DecoratedKey.java:89)
        at org.apache.cassandra.db.DecoratedKey.compareTo(DecoratedKey.java:38)
        at java.util.TreeMap.getEntry(TreeMap.java:328)
        at java.util.TreeMap.containsKey(TreeMap.java:209)
        at java.util.TreeSet.contains(TreeSet.java:217)
        at org.apache.cassandra.io.sstable.SSTableReader.load(SSTableReader.java:393)
        at org.apache.cassandra.io.sstable.SSTableReader.open(SSTableReader.java:189)
        at org.apache.cassandra.io.sstable.SSTableReader$1.run(SSTableReader.java:227)
        at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:441)
        at java.util.concurrent.FutureTask$Sync.innerRun(FutureTask.java:303)
        at java.util.concurrent.FutureTask.run(FutureTask.java:138)
        at java.util.concurrent.ThreadPoolExecutor$Worker.runTask(ThreadPoolExecutor.java:886)
        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:908)
        at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:662)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;and this one on the end of start up:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;ERROR [MigrationStage:1] 2012-02-24 14:37:22,750 AbstractCassandraDaemon.java (line 134) Fatal exception in thread &lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;[MigrationStage:1,5,main]
java.lang.NullPointerException
        at org.apache.cassandra.db.migration.MigrationHelper.addColumnFamily(MigrationHelper.java:282)
        at org.apache.cassandra.db.migration.MigrationHelper.addColumnFamily(MigrationHelper.java:216)
        at org.apache.cassandra.db.DefsTable.mergeColumnFamilies(DefsTable.java:330)
        at org.apache.cassandra.db.DefsTable.mergeRemoteSchema(DefsTable.java:240)
        at org.apache.cassandra.service.MigrationManager$1.runMayThrow(MigrationManager.java:124)
        at org.apache.cassandra.utils.WrappedRunnable.run(WrappedRunnable.java:30)
        at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:441)
        at java.util.concurrent.FutureTask$Sync.innerRun(FutureTask.java:303)
        at java.util.concurrent.FutureTask.run(FutureTask.java:138)
        at java.util.concurrent.ThreadPoolExecutor$Worker.runTask(ThreadPoolExecutor.java:886)
        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:908)
        at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:662)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Any ideas why they`ve appeared?&lt;/p&gt;</description>
                <environment></environment>
        <key id="12543997">CASSANDRA-3954</key>
            <summary>Exceptions during start up after schema disagreement</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10002" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Normal</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="xedin">Pavel Yaskevich</assignee>
                                    <reporter username="mdymarek">Mariusz</reporter>
                        <labels>
                    </labels>
                <created>Fri, 24 Feb 2012 14:49:26 +0000</created>
                <updated>Tue, 16 Apr 2019 09:32:38 +0000</updated>
                            <resolved>Fri, 16 Mar 2012 11:04:09 +0000</resolved>
                                        <fixVersion>1.1.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                                                                <comments>
                            <comment id="13215653" author="jbellis" created="Fri, 24 Feb 2012 14:59:27 +0000"  >&lt;p&gt;Sounds like you changed your cluster&apos;s partitioner.  That&apos;s not supported.&lt;/p&gt;</comment>
                            <comment id="13215712" author="forsberg" created="Fri, 24 Feb 2012 16:04:01 +0000"  >&lt;p&gt;To change partitioner you would have to edit cassandra.yaml, right? There was no such change before this restart.&lt;/p&gt;</comment>
                            <comment id="13215718" author="jbellis" created="Fri, 24 Feb 2012 16:21:50 +0000"  >&lt;p&gt;Can you elaborate then on what exactly changed?&lt;/p&gt;

&lt;p&gt;Is this a 1.1 cluster or 1.0?&lt;/p&gt;</comment>
                            <comment id="13215740" author="forsberg" created="Fri, 24 Feb 2012 17:05:46 +0000"  >&lt;p&gt;We had a schema disagreement in this two-node cluster. Tried restarting one of the nodes, and these exceptions occured in log.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;Is this a 1.1 cluster or 1.0?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;You&apos;re not going to like this: It&apos;s a snapshot from cassandra-1.1 branch from about a week ago. I can find out the exact commit, but I don&apos;t have it readily available right now.&lt;/p&gt;</comment>
                            <comment id="13216041" author="jbellis" created="Fri, 24 Feb 2012 22:53:18 +0000"  >&lt;p&gt;Pavel fixed &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-3884&quot; title=&quot;Intermittent SchemaDisagreementException&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-3884&quot;&gt;&lt;del&gt;CASSANDRA-3884&lt;/del&gt;&lt;/a&gt; yesterday &amp;#8211; might be the same thing?&lt;/p&gt;</comment>
                            <comment id="13219013" author="mdymarek" created="Wed, 29 Feb 2012 09:12:49 +0000"  >&lt;p&gt;it might be,&lt;br/&gt;
I`ve installed new snapshot(made from commit 449e037195c3c504d7aca5088e8bc7bd5a50e7d0)&lt;br/&gt;
and second exception is not thrown any more,&lt;br/&gt;
First type of exception( aka java.lang.ClassCastException: java.math.BigInteger cannot be cast to java.nio.ByteBuffer)&lt;br/&gt;
is still thrown during startup, in fact i`ve got several of them in startup logs...&lt;br/&gt;
Note that node is starting up even that these exceptions are thrown...&lt;/p&gt;</comment>
                            <comment id="13228953" author="jbellis" created="Wed, 14 Mar 2012 04:23:49 +0000"  >&lt;p&gt;Been thinking about this for a while, and I now have a hypothesis: I bet it&apos;s some kind of confusion w/ the new unified key cache. Can you have a look, Pavel?&lt;/p&gt;</comment>
                            <comment id="13229133" author="xedin" created="Wed, 14 Mar 2012 11:16:36 +0000"  >&lt;p&gt;Mariusz, can you please provide additional information - do you use secondary indexes and what is the SSTable name it fails to open (it should be on top of the exception &quot;Opening &amp;lt;sstable-name&amp;gt; (&amp;lt;n&amp;gt; bytes)&quot;)?  My current guess is that it could be related to the secondary indexes.&lt;/p&gt;</comment>
                            <comment id="13229156" author="mdymarek" created="Wed, 14 Mar 2012 12:45:03 +0000"  >
&lt;p&gt;yep, we`re using secondary index a lot,&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt; INFO [SSTableBatchOpen:2] 2012-02-24 14:21:00,752 SSTableReader.java (line 156) Opening /cassandra/test_keyspace/test_cf/test_keyspace-test_cf.test_cf_test_column_with_index_idx-hc-2 (727 bytes)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;we have lost some secondary index information after restarting of cluster, we had to rebuild indexes after that...&lt;/p&gt;</comment>
                            <comment id="13229564" author="xedin" created="Wed, 14 Mar 2012 20:02:39 +0000"  >&lt;p&gt;We don&apos;t support secondary index caching with global caches so I have added condition to skip reading key cache for secondary index CFs.&lt;/p&gt;</comment>
                            <comment id="13230575" author="jbellis" created="Thu, 15 Mar 2012 21:28:23 +0000"  >&lt;p&gt;What if we just created the index CFMetadata with caching=NONE instead of adding a special flag?&lt;/p&gt;</comment>
                            <comment id="13230583" author="xedin" created="Thu, 15 Mar 2012 21:35:57 +0000"  >&lt;p&gt;That is a good idea, v2 implements that.&lt;/p&gt;</comment>
                            <comment id="13230597" author="jbellis" created="Thu, 15 Mar 2012 21:53:10 +0000"  >&lt;p&gt;better, but we should actually load key cache only for KEYS_ONLY or ALL, rather than !NONE (which would include ROWS ONLY).&lt;/p&gt;</comment>
                            <comment id="13230613" author="xedin" created="Thu, 15 Mar 2012 22:04:47 +0000"  >&lt;p&gt;updated v2 which skips key cache read if caching is NONE or ROWS_ONLY.&lt;/p&gt;</comment>
                            <comment id="13230873" author="jbellis" created="Fri, 16 Mar 2012 03:41:22 +0000"  >&lt;p&gt;+1&lt;/p&gt;

&lt;p&gt;nit: it&apos;s preferred to use == with enums&lt;/p&gt;</comment>
                            <comment id="13231058" author="xedin" created="Fri, 16 Mar 2012 11:04:09 +0000"  >&lt;p&gt;Committed with nit fixed.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12518555" name="CASSANDRA-3954-v2.patch" size="4712" author="xedin" created="Thu, 15 Mar 2012 22:04:47 +0000"/>
                            <attachment id="12518364" name="CASSANDRA-3954.patch" size="4718" author="xedin" created="Wed, 14 Mar 2012 20:02:38 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[xedin]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>229235</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            13 years, 36 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0gq87:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>95679</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>jbellis</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[jbellis]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12962"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>