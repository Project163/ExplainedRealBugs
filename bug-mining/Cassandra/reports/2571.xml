<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 22:42:26 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-6615] Changing the IP of a node on a live cluster leaves gossip infos and throws Exceptions</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-6615</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;Following this procedure : &lt;a href=&quot;https://engineering.eventbrite.com/changing-the-ip-address-of-a-cassandra-node-with-auto_bootstrapfalse/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://engineering.eventbrite.com/changing-the-ip-address-of-a-cassandra-node-with-auto_bootstrapfalse/&lt;/a&gt;  to change the IP of a node, we encountered an issue :&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;logs contains: &quot;java.lang.RuntimeException: Host ID collision between active endpoint /127.0.0.5 and /127.0.0.3&quot;&lt;/li&gt;
	&lt;li&gt;logs also indicate that the old IP is being removed of the cluster (FatClient timeout), then added again...&lt;/li&gt;
	&lt;li&gt;nodetool gossipinfo still list old IP (even a few hours after...)&lt;/li&gt;
	&lt;li&gt;the old IP is still seen as &quot;UP&quot; in the cluster... (according to the logs...)&lt;/li&gt;
&lt;/ul&gt;



&lt;p&gt;Below is a small shell script which allows to reproduce the scenario...&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;#! /bin/bash

CLUSTER=$1
ccm create $CLUSTER --cassandra-dir=.
ccm populate -n 2
ccm start

ccm add node3 -i 127.0.0.3 -j 7300 -b
ccm node3 start
ccm node3 ring
ccm node3 stop

sed -i &apos;s/127.0.0.3/127.0.0.5/g&apos; ~/.ccm/$CLUSTER/node3/node.conf 
sed -i &apos;s/127.0.0.3/127.0.0.5/g&apos; ~/.ccm/$CLUSTER/node3/conf/cassandra.yaml

ccm node3 start
sleep 3
nodetool --host 127.0.0.5 --port 7300 gossipinfo
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="12691049">CASSANDRA-6615</key>
            <summary>Changing the IP of a node on a live cluster leaves gossip infos and throws Exceptions</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10002" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Normal</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="brandon.williams">Brandon Williams</assignee>
                                    <reporter username="frousseau">Fabien Rousseau</reporter>
                        <labels>
                            <label>qa-resolved</label>
                    </labels>
                <created>Fri, 24 Jan 2014 14:56:39 +0000</created>
                <updated>Tue, 16 Apr 2019 09:31:55 +0000</updated>
                            <resolved>Wed, 29 Jan 2014 23:37:47 +0000</resolved>
                                        <fixVersion>1.2.14</fixVersion>
                    <fixVersion>2.0.5</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="13881090" author="brandon.williams" created="Fri, 24 Jan 2014 16:05:19 +0000"  >&lt;p&gt;What is happening is that the token moves correctly on the other nodes, but the node that moved gets the host ID collision adding the old ip which is still in gossip, with its own host ID.  Because of this, it never removes the old ip, and thus re-propagates it to the other nodes after their quarantine expires, causing them to now get the same collision.&lt;/p&gt;</comment>
                            <comment id="13884970" author="brandon.williams" created="Wed, 29 Jan 2014 03:53:42 +0000"  >&lt;p&gt;Host ID conflicts are roughly as important as token conflicts, and need to be handled the same way, decisively.  We can decide who has won a host id conflict, much like we do a token conflict.  Once the loser is removed from tMD we can just let the FD mark it dead and then it will be evicted as a fat client (which is how it worked before we added host IDs.)  However, post-4375 this will take quite a while, since the only sample the FD has is the seed value of 30s.  While this is actually ok as long as we&apos;ve removed it from tMD, we can do better, so we call removeEndpoint, which in turn removes it from the FD, but doesn&apos;t mark the epstate as dead.  isFatClient began checking if the epstate was dead in &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-5378&quot; title=&quot;Fat Client: No longer works in 1.2&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-5378&quot;&gt;&lt;del&gt;CASSANDRA-5378&lt;/del&gt;&lt;/a&gt;, but this doesn&apos;t seem necessary since the timestamp is updated if the node is actually alive, and the duration check will prevent it from being expired, so this patch removes it.&lt;/p&gt;

&lt;p&gt;One small bit of nuance here is that if the host IDs conflict and the loser is in tMD, then the token conflict check is basically useless, since we have to update the host ID before the tokens, and the token check relies on data in tMD.  This means if a host ID conflict occurs where the tokens are different, the loser&apos;s tokens may just vanish, but that&apos;s highly unlikely to occur without hand-editing the system table or crafting one specifically for this.&lt;/p&gt;</comment>
                            <comment id="13885179" author="frousseau" created="Wed, 29 Jan 2014 09:44:40 +0000"  >&lt;p&gt;Thanks Brandon for the detailed explanation. I think I&apos;ll be able to try the patch by the end of the week...&lt;/p&gt;</comment>
                            <comment id="13885795" author="mshuler" created="Wed, 29 Jan 2014 20:46:59 +0000"  >&lt;p&gt;Patch looks good to me.&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt; INFO [HANDSHAKE-/127.0.0.2] 2014-01-29 14:41:43,388 OutboundTcpConnection.java (line 418) Handshaking version with /127.0.0.2
 INFO [HANDSHAKE-/127.0.0.1] 2014-01-29 14:41:43,388 OutboundTcpConnection.java (line 418) Handshaking version with /127.0.0.1
 INFO [GossipStage:1] 2014-01-29 14:41:44,031 Gossiper.java (line 843) Node /127.0.0.3 is now part of the cluster
 INFO [GossipStage:1] 2014-01-29 14:41:44,033 Gossiper.java (line 809) InetAddress /127.0.0.3 is now UP
 WARN [GossipStage:1] 2014-01-29 14:41:44,038 StorageService.java (line 1481) Not updating host ID 2b3a79b1-0c16-402a-a0cb-fa36c391a7c6 for /127.0.0.3 because it&apos;s mine
 INFO [GossipStage:1] 2014-01-29 14:41:44,038 StorageService.java (line 1572) Nodes /127.0.0.3 and /127.0.0.5 have the same token 4611686018427387903.  Ignoring /127.0.0.3
 INFO [GossipStage:1] 2014-01-29 14:41:44,039 StorageService.java (line 1778) Removing endpoint /127.0.0.3
 INFO [main] 2014-01-29 14:41:47,700 TServerCustomFactory.java (line 47) Using synchronous/threadpool thrift server on 127.0.0.5 : 9160
 INFO [Thread-2] 2014-01-29 14:41:47,701 ThriftServer.java (line 110) Listening for thrift clients...
 INFO [GossipTasks:1] 2014-01-29 14:42:45,414 Gossiper.java (line 622) FatClient /127.0.0.3 has been silent for 30000ms, removing from gossip
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="13885821" author="brandon.williams" created="Wed, 29 Jan 2014 21:14:28 +0000"  >&lt;p&gt;I actually didn&apos;t mean for that &apos;removing endpoint&apos; info line to leak through (it&apos;s already logged at debug in the gossiper) but I&apos;ll remove it on commit.&lt;/p&gt;</comment>
                            <comment id="13885994" author="thobbs" created="Wed, 29 Jan 2014 23:27:30 +0000"  >&lt;p&gt;+1 from me&lt;/p&gt;</comment>
                            <comment id="13886004" author="brandon.williams" created="Wed, 29 Jan 2014 23:37:47 +0000"  >&lt;p&gt;Committed.&lt;/p&gt;</comment>
                            <comment id="13887640" author="frousseau" created="Fri, 31 Jan 2014 11:07:56 +0000"  >&lt;p&gt;Works like a charm. Thanks!&lt;/p&gt;</comment>
                            <comment id="13888353" author="rcoli" created="Sat, 1 Feb 2014 00:28:35 +0000"  >&lt;p&gt;per &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=brandon.williams&quot; class=&quot;user-hover&quot; rel=&quot;brandon.williams&quot;&gt;brandon.williams&lt;/a&gt; this was introduced in 1.2.0.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12679551">CASSANDRA-6362</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12625784" name="6615.txt" size="4461" author="brandon.williams" created="Wed, 29 Jan 2014 03:53:42 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[brandon.williams]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>369792</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            11 years, 42 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1rqh3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>370094</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12311421" key="com.atlassian.jira.plugin.system.customfieldtypes:multiversion">
                        <customfieldname>Reproduced In</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="12325602">1.2.13</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>thobbs</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[thobbs]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12962"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12311420" key="com.atlassian.jira.plugin.system.customfieldtypes:version">
                        <customfieldname>Since Version</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="12319262">1.2.0 beta 1</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12311124" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Tester</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>mshuler</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>