<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 23:20:28 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-14559] Check for endpoint collision with hibernating nodes </title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-14559</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;I ran across an edge case when replacing a node with the same address. This issue results in the node(and its tokens) being unsafely removed from gossip.&lt;/p&gt;

&lt;p&gt;Steps to replicate:&lt;/p&gt;

&lt;p&gt;1. Create 3 node cluster.&lt;br/&gt;
2. Stop a node&lt;br/&gt;
3. Replace the stopped node with a node using the same address using the replace_address flag&lt;br/&gt;
4. Stop the node before it finishes bootstrapping&lt;br/&gt;
5. Remove the replace_address flag and restart the node to resume bootstrapping (if the data dir is also cleared at this point the node will also generate new tokens when it starts)&lt;br/&gt;
6. Stop the node before it finishes bootstrapping again&lt;br/&gt;
7. 30 Seconds later the node will be removed from gossip because it now matches the check for a FatClient&lt;/p&gt;

&lt;p&gt;I think this is only an issue when replacing a node with the same address because other replacements now use STATUS_BOOTSTRAPPING_REPLACE and leave the dead node unchanged.&lt;/p&gt;

&lt;p&gt;I believe the simplest fix for this is to add a check that prevents a non-bootstrapped node (without the replaces_address flag) starting if there is a gossip entry for the same address in the hibernate state. &lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/apache/cassandra/compare/trunk...vincewhite:check_for_hibernate_on_start&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;3.11 PoC &lt;/a&gt;&lt;/p&gt;


&lt;p&gt;&#160;&lt;/p&gt;</description>
                <environment></environment>
        <key id="13170405">CASSANDRA-14559</key>
            <summary>Check for endpoint collision with hibernating nodes </summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10002" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Normal</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="stefan.miklosovic">Stefan Miklosovic</assignee>
                                    <reporter username="VincentWhite">Vincent White</reporter>
                        <labels>
                    </labels>
                <created>Fri, 6 Jul 2018 04:05:55 +0000</created>
                <updated>Fri, 10 Oct 2025 08:47:49 +0000</updated>
                            <resolved>Tue, 4 Aug 2020 22:48:54 +0000</resolved>
                                        <fixVersion>3.0.22</fixVersion>
                    <fixVersion>3.11.8</fixVersion>
                    <fixVersion>4.0-beta2</fixVersion>
                    <fixVersion>4.0</fixVersion>
                                    <component>Consistency/Bootstrap and Decommission</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>7</watches>
                                                    <progress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                            <timeestimate seconds="0">0h</timeestimate>
                            <timespent seconds="4200">1h 10m</timespent>
                                <comments>
                            <comment id="16561308" author="suess" created="Mon, 30 Jul 2018 00:22:11 +0000"  >&lt;p&gt;I have written a dtest for the POC ( &lt;a href=&quot;https://github.com/apache/cassandra/compare/trunk...vincewhite:check_for_hibernate_on_start&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/cassandra/compare/trunk...vincewhite:check_for_hibernate_on_start&lt;/a&gt;&#160;)&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/B0073D/cassandra-dtest/commit/1e4601ea230d9e8f20622efc2d47b0f9e6be002b&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/B0073D/cassandra-dtest/commit/1e4601ea230d9e8f20622efc2d47b0f9e6be002b&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17166360" author="stefan.miklosovic" created="Tue, 28 Jul 2020 11:40:50 +0000"  >&lt;p&gt;PRs for trunk and 3.11&lt;/p&gt;

&lt;p&gt;3.11:&#160;&lt;a href=&quot;https://github.com/apache/cassandra/pull/700/commits&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/cassandra/pull/700/commits&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;trunk:&#160;&lt;a href=&quot;https://github.com/apache/cassandra/pull/699&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/cassandra/pull/699&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;dtest PR:&#160;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/apache/cassandra-dtest/pull/87&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/cassandra-dtest/pull/87&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=dcapwell&quot; class=&quot;user-hover&quot; rel=&quot;dcapwell&quot;&gt;dcapwell&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=Bereng&quot; class=&quot;user-hover&quot; rel=&quot;bereng&quot;&gt;Bereng&lt;/a&gt;&#160;would any of you mind to go over this? thanks!&lt;/p&gt;</comment>
                            <comment id="17167025" author="stefan.miklosovic" created="Wed, 29 Jul 2020 07:53:01 +0000"  >&lt;p&gt;dtest&#160;&lt;a href=&quot;https://ci-cassandra.apache.org/blue/organizations/jenkins/Cassandra-devbranch/detail/Cassandra-devbranch/225/pipeline/256/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://ci-cassandra.apache.org/blue/organizations/jenkins/Cassandra-devbranch/detail/Cassandra-devbranch/225/pipeline/256/&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17167074" author="stefan.miklosovic" created="Wed, 29 Jul 2020 09:05:16 +0000"  >&lt;p&gt;failed dtests unrelated to this change:&#160;&lt;a href=&quot;https://ci-cassandra.apache.org/blue/organizations/jenkins/Cassandra-devbranch/detail/Cassandra-devbranch/225/tests&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://ci-cassandra.apache.org/blue/organizations/jenkins/Cassandra-devbranch/detail/Cassandra-devbranch/225/tests&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;dtests were executed against dtest PR / personal dtest respository.&lt;/p&gt;</comment>
                            <comment id="17167442" author="brandon.williams" created="Wed, 29 Jul 2020 18:36:32 +0000"  >&lt;p&gt;+1, but is there no reason to also fix this in all the lower branches as well?&lt;/p&gt;</comment>
                            <comment id="17167458" author="stefan.miklosovic" created="Wed, 29 Jul 2020 19:08:42 +0000"  >&lt;p&gt;I can check 3.0 but I am not sure if the logic is same. The original author of that patch was targetting only 3.11 and I found that the code is same in trunk but it might significantly differ in 3.0 though. Ill check.&lt;/p&gt;</comment>
                            <comment id="17169758" author="stefan.miklosovic" created="Mon, 3 Aug 2020 06:44:23 +0000"  >&lt;p&gt;PR for branch 3.0&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/apache/cassandra/pull/707&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/cassandra/pull/707&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;tests for branch 3.0&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://ci-cassandra.apache.org/blue/organizations/jenkins/Cassandra-devbranch/detail/Cassandra-devbranch/227/pipeline&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://ci-cassandra.apache.org/blue/organizations/jenkins/Cassandra-devbranch/detail/Cassandra-devbranch/227/pipeline&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17170987" author="brandon.williams" created="Tue, 4 Aug 2020 17:41:54 +0000"  >&lt;p&gt;+1&lt;/p&gt;</comment>
                            <comment id="17171176" author="brandon.williams" created="Tue, 4 Aug 2020 22:48:54 +0000"  >&lt;p&gt;Committed.&lt;/p&gt;</comment>
                            <comment id="17175114" author="edimitrova" created="Mon, 10 Aug 2020 23:54:02 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=brandon.williams&quot; class=&quot;user-hover&quot; rel=&quot;brandon.williams&quot;&gt;brandon.williams&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=stefan.miklosovic&quot; class=&quot;user-hover&quot; rel=&quot;stefan.miklosovic&quot;&gt;stefan.miklosovic&lt;/a&gt;&#160;this test fails on trunk, can you, please, check it?&lt;/p&gt;

&lt;p&gt;Ticket was raised for it -&#160;&lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-16030&quot; title=&quot;TestBootstrap::test_node_cannot_join_as_hibernating_node_without_replace_address failing on trunk&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-16030&quot;&gt;&lt;del&gt;CASSANDRA-16030&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17175263" author="stefan.miklosovic" created="Tue, 11 Aug 2020 06:05:24 +0000"  >&lt;p&gt;the test is flaky, I created an PR&#160;&lt;a href=&quot;https://github.com/apache/cassandra-dtest/pull/88&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/cassandra-dtest/pull/88&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="13377324">CASSANDRA-16662</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[stefan.miklosovic]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12313821" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Complexity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12965"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313822" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Discovered By</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12969"><![CDATA[User Report]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            5 years, 14 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12313921" key="jira.plugin.projectspecificselectfield.jpssf:multicftype">
                        <customfieldname>Platform</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="13076"><![CDATA[All]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3vllj:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12311421" key="com.atlassian.jira.plugin.system.customfieldtypes:multiversion">
                        <customfieldname>Reproduced In</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="12332541">3.0.x</customfieldvalue>
    <customfieldvalue id="12339541">3.11.x</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[brandon.williams]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12962"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12311420" key="com.atlassian.jira.plugin.system.customfieldtypes:version">
                        <customfieldname>Since Version</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="12316349">1.0.0</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313924" key="com.atlassian.jira.plugin.system.customfieldtypes:textfield">
                        <customfieldname>Source Control Link</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>&lt;p&gt;&lt;a href=&quot;https://github.com/apache/cassandra/commit/c94ececec0fcd87459858370396d6cd586853787&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/cassandra/commit/c94ececec0fcd87459858370396d6cd586853787&lt;/a&gt;&lt;/p&gt;</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>