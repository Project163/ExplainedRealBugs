<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 22:27:43 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-3540] Wrong check of partitioner for secondary indexes</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-3540</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-3407&quot; title=&quot;Changing partitioner causes interval tree build failure before the change can be detected&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-3407&quot;&gt;&lt;del&gt;CASSANDRA-3407&lt;/del&gt;&lt;/a&gt; doesn&apos;t handle the fact that secondary indexes have a specific partitioner (LocalPartitioner). This result in the following error when starting nodes in 1.0.4:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;java.lang.RuntimeException: Cannot open /var/lib/cassandra/data/Index/AttractionLocationCategoryDateIdx.AttractionLocationCategoryDateIdx_09partition_idx-h-1 because partitioner does not match org.apache.cassandra.dht.LocalPartitioner
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="12533155">CASSANDRA-3540</key>
            <summary>Wrong check of partitioner for secondary indexes</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10000" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Urgent</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="yukim">Yuki Morishita</assignee>
                                    <reporter username="slebresne">Sylvain Lebresne</reporter>
                        <labels>
                    </labels>
                <created>Tue, 29 Nov 2011 17:57:44 +0000</created>
                <updated>Tue, 16 Apr 2019 09:32:45 +0000</updated>
                            <resolved>Thu, 8 Dec 2011 12:06:20 +0000</resolved>
                                        <fixVersion>1.0.6</fixVersion>
                                    <component>Feature/2i Index</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                                                                <comments>
                            <comment id="13160723" author="yukim" created="Thu, 1 Dec 2011 08:25:50 +0000"  >&lt;p&gt;This bug is caused by SSTableMetadata providing node&apos;s partitioner when reading old version (prior hc) of sstable.&lt;/p&gt;

&lt;p&gt;Attached patch let SSTableMetadata to use empty string(&quot;&quot;) instead of DatabaseDescriptor.getPartitioner as default. When older version of sstable is read, SSTableMetadata provides empty string for partitioner, and check for partitioner is skipped.&lt;/p&gt;</comment>
                            <comment id="13160787" author="slebresne" created="Thu, 1 Dec 2011 10:03:12 +0000"  >&lt;p&gt;Some nits:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;We can give then partitioner as an argument to Collector.finalizeMetadata() instead of adding a new field.&lt;/li&gt;
	&lt;li&gt;I think I slightly prefer using null when there is no partitioner available. I understand that &quot;&quot; make SSTableMetadata slightly simpler but in fact we shouldn&apos;t ever write a SSTableMetadata with no partitioner (we can only read one). So we could simply assert that partitioner != null in the serialize method.&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13160975" author="jbellis" created="Thu, 1 Dec 2011 16:44:57 +0000"  >&lt;p&gt;I&apos;d also like to add a unit test (probably using clearUnsafe) to make sure we&apos;re exercising the logic and triggering the original 3407 bug.&lt;/p&gt;</comment>
                            <comment id="13163402" author="yukim" created="Tue, 6 Dec 2011 06:48:43 +0000"  >&lt;p&gt;Updated patch to give partitioner an arg to Collector#finalizeMetadata().&lt;br/&gt;
I also added test to SSTableReaderTest which fails when run against current 1.0 branch and  succeeds after this patch.&lt;/p&gt;</comment>
                            <comment id="13163577" author="slebresne" created="Tue, 6 Dec 2011 13:17:09 +0000"  >&lt;p&gt;The patch lgtm. Regarding the tests, I think it would be worth testing if we&apos;re correctly able to load old sstable, those without a saved partitioner, which I don&apos;t think the attached test does, does it (but the current test is good, we should keep it) ? Typically we could have a similar test than in the patch, but that nukes the statistics component of the sstables before reloading them . &lt;/p&gt;</comment>
                            <comment id="13165082" author="yukim" created="Thu, 8 Dec 2011 08:22:27 +0000"  >&lt;p&gt;Sylvain,&lt;/p&gt;

&lt;p&gt;I separate the patch into two parts.&lt;/p&gt;

&lt;p&gt;0001 just adds tests to reproduce &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-3407&quot; title=&quot;Changing partitioner causes interval tree build failure before the change can be detected&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-3407&quot;&gt;&lt;del&gt;CASSANDRA-3407&lt;/del&gt;&lt;/a&gt;, one test from previous patch (flush and open) and new test to simulate upgrading from previous version of SSTable. Patch generates Indexed1 SSTable which I created using v1.0.3 (SSTable version is &quot;hb&quot;) under test/data/legacy-sstables/hb.&lt;br/&gt;
When testing, those sstables are copied into unit test data location just like ScrubTest does.&lt;/p&gt;

&lt;p&gt;Note that it also generates Standard1 sstable in order to let LegacySSTableTest pass.&lt;/p&gt;

&lt;p&gt;0002 contains fix same as previously submitted patch.&lt;/p&gt;

&lt;p&gt;Only applying 0001 patch let SSTableReaderTest in current 1.0 branch fail, and you can see it success after applying 0002.&lt;/p&gt;</comment>
                            <comment id="13165172" author="slebresne" created="Thu, 8 Dec 2011 12:06:20 +0000"  >&lt;p&gt;I would have been fine with just nuking the metadata component &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; but that&apos;s great like that.&lt;/p&gt;

&lt;p&gt;+1, committed, thanks&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12506586" name="0001-Add-tests-for-opening-index-sstables.patch" size="43212" author="yukim" created="Thu, 8 Dec 2011 08:22:27 +0000"/>
                            <attachment id="12506587" name="0002-Fix-SSTableMetadata-to-write-correct-partitioner.patch" size="7152" author="yukim" created="Thu, 8 Dec 2011 08:22:27 +0000"/>
                            <attachment id="12506223" name="cassandra-1.0-3540-v2.txt" size="9655" author="yukim" created="Tue, 6 Dec 2011 06:48:43 +0000"/>
                            <attachment id="12505740" name="cassandra-1.0-3540.txt" size="7223" author="yukim" created="Thu, 1 Dec 2011 08:25:50 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>4.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[yukim]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>218883</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            13 years, 50 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0gl5z:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>94859</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>slebresne</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[slebresne]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12963"><![CDATA[Critical]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>