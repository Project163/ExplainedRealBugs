<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 22:48:42 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-8057] Record the real messaging version in all cases in OutboundTcpConnection</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-8057</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;Piotr&apos;s quote, from &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-6700&quot; title=&quot;Use real node messaging versions for schema exchange decisions&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-6700&quot;&gt;&lt;del&gt;CASSANDRA-6700&lt;/del&gt;&lt;/a&gt; description:&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;IncomingTcpConnection#handleModernVersion sets version to min(my version, version of the peer). This messes up schema pull/push.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Seems like we&apos;ve missed a similar, yet related, case in OutboundTcpConnection#connect():&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (targetVersion &amp;lt; maxTargetVersion &amp;amp;&amp;amp; targetVersion &amp;lt; MessagingService.current_version)
{
    logger.trace(&lt;span class=&quot;code-quote&quot;&gt;&quot;Detected higher max version {} (using {}); will reconnect when queued messages are done&quot;&lt;/span&gt;,
            maxTargetVersion, targetVersion);
    MessagingService.instance().setVersion(poolReference.endPoint(), &lt;span class=&quot;code-object&quot;&gt;Math&lt;/span&gt;.min(MessagingService.current_version, maxTargetVersion));
    softCloseSocket();
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Should really set the true version (maxTargetVersion), since MessagingService#getVersion() will return the min for us, anyway:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; getVersion(InetAddress endpoint)
{
    &lt;span class=&quot;code-object&quot;&gt;Integer&lt;/span&gt; v = versions.get(endpoint);
    &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (v == &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;)
    {
        &lt;span class=&quot;code-comment&quot;&gt;// we don&lt;span class=&quot;code-quote&quot;&gt;&apos;t know the version. assume current. we&apos;&lt;/span&gt;ll know soon enough &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; that was incorrect.
&lt;/span&gt;        logger.trace(&lt;span class=&quot;code-quote&quot;&gt;&quot;Assuming current protocol version &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; {}&quot;&lt;/span&gt;, endpoint);
        &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; MessagingService.current_version;
    }
    &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt;
        &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;Math&lt;/span&gt;.min(v, MessagingService.current_version);
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;But we need the true version for schema exchange decisions.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12745921">CASSANDRA-8057</key>
            <summary>Record the real messaging version in all cases in OutboundTcpConnection</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10003" iconUrl="https://issues.apache.org/jira/images/icons/priorities/trivial.svg">Low</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="aleksey">Aleksey Yeschenko</assignee>
                                    <reporter username="aleksey">Aleksey Yeschenko</reporter>
                        <labels>
                    </labels>
                <created>Sat, 4 Oct 2014 14:39:21 +0000</created>
                <updated>Tue, 16 Apr 2019 09:31:32 +0000</updated>
                            <resolved>Tue, 7 Oct 2014 15:46:08 +0000</resolved>
                                        <fixVersion>2.0.11</fixVersion>
                    <fixVersion>2.1.1</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="14161573" author="pkolaczk" created="Tue, 7 Oct 2014 07:15:17 +0000"  >&lt;p&gt;+1&lt;/p&gt;</comment>
                            <comment id="14162015" author="iamaleksey" created="Tue, 7 Oct 2014 15:46:08 +0000"  >&lt;p&gt;Committed, thanks!&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12695031">CASSANDRA-6700</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12733119">CASSANDRA-7734</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12672937" name="8057.txt" size="1500" author="aleksey" created="Sat, 4 Oct 2014 14:46:39 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[aleksey]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            11 years, 7 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i20sv3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>pkolaczk</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[pkolaczk]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12961"><![CDATA[Low]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>