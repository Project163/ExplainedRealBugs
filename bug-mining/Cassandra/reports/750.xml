<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 22:19:42 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-2240] nodetool scrub hangs or throws an exception</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-2240</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;trying to run nodetool scrub hung or (only happened one time) threw the following exception:&lt;/p&gt;

&lt;p&gt;ERROR &lt;span class=&quot;error&quot;&gt;&amp;#91;CompactionExecutor:1&amp;#93;&lt;/span&gt; 2011-02-28 10:26:26,620 AbstractCassandraDaemon.java (line 114) Fatal exception in thread Thread&lt;span class=&quot;error&quot;&gt;&amp;#91;CompactionExecutor:1,1,main&amp;#93;&lt;/span&gt;&lt;br/&gt;
java.lang.AssertionError&lt;br/&gt;
        at org.apache.cassandra.dht.RandomPartitioner.convertFromDiskFormat(RandomPartitioner.java:62)&lt;br/&gt;
        at org.apache.cassandra.io.sstable.SSTableReader.decodeKey(SSTableReader.java:627)&lt;br/&gt;
        at org.apache.cassandra.db.CompactionManager.doScrub(CompactionManager.java:538)&lt;br/&gt;
        at org.apache.cassandra.db.CompactionManager.access$600(CompactionManager.java:55)&lt;br/&gt;
        at org.apache.cassandra.db.CompactionManager$3.call(CompactionManager.java:194)&lt;br/&gt;
        at java.util.concurrent.FutureTask$Sync.innerRun(FutureTask.java:334)&lt;br/&gt;
        at java.util.concurrent.FutureTask.run(FutureTask.java:166)&lt;br/&gt;
        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1110)&lt;br/&gt;
        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:603)&lt;br/&gt;
        at java.lang.Thread.run(Thread.java:636)&lt;/p&gt;</description>
                <environment>&lt;p&gt;using build #314 from hudson&lt;/p&gt;</environment>
        <key id="12499601">CASSANDRA-2240</key>
            <summary>nodetool scrub hangs or throws an exception</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10002" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Normal</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="jbellis">Jonathan Ellis</assignee>
                                    <reporter username="kunda">Yaniv Kunda</reporter>
                        <labels>
                    </labels>
                <created>Thu, 24 Feb 2011 15:32:00 +0000</created>
                <updated>Tue, 16 Apr 2019 09:33:05 +0000</updated>
                            <resolved>Tue, 1 Mar 2011 16:10:31 +0000</resolved>
                                        <fixVersion>0.7.3</fixVersion>
                                    <component>Tool/nodetool</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                    <workratio workratioPercent="0"/>
                                    <progress percentage="0">
                                    <originalProgress>
                                                    <row percentage="100" backgroundColor="#89afd7"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="0" backgroundColor="#51a825"/>
                                                    <row percentage="100" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="0">
                                    <originalProgress>
                                                    <row percentage="100" backgroundColor="#89afd7"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="0" backgroundColor="#51a825"/>
                                                    <row percentage="100" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                    <timeoriginalestimate seconds="57600">16h</timeoriginalestimate>
                            <timeestimate seconds="57600">16h</timeestimate>
                                        <comments>
                            <comment id="12998900" author="jbellis" created="Thu, 24 Feb 2011 15:37:07 +0000"  >&lt;p&gt;what is going on in the compactionmanager when it&apos;s &quot;hung?&quot;  (use jstack)&lt;/p&gt;</comment>
                            <comment id="12998902" author="kunda" created="Thu, 24 Feb 2011 15:41:48 +0000"  >&lt;p&gt;attached the tables that can be used to reproduce the hang&lt;/p&gt;</comment>
                            <comment id="12998910" author="jbellis" created="Thu, 24 Feb 2011 16:03:08 +0000"  >&lt;p&gt;This is not a valid sstable.  It claims (from its lack of version string) that it contains encoded row keys, meaning &amp;lt;token&amp;gt;:&amp;lt;key&amp;gt;, but it actually does not.  scrub can&apos;t help you with that.&lt;/p&gt;</comment>
                            <comment id="12998915" author="jbellis" created="Thu, 24 Feb 2011 16:07:44 +0000"  >&lt;p&gt;... on closer inspection it does have colon-delimited keys, but scrub doesn&apos;t see them.  &lt;/p&gt;</comment>
                            <comment id="12998916" author="kunda" created="Thu, 24 Feb 2011 16:08:30 +0000"  >&lt;p&gt;Here&apos;s the trace I got (narrowed down):&lt;/p&gt;

&lt;p&gt;&quot;CompactionExecutor:1&quot; prio=10 tid=0x000000001eb67800 nid=0x7fdb runnable &lt;span class=&quot;error&quot;&gt;&amp;#91;0x0000000040dc4000&amp;#93;&lt;/span&gt;&lt;br/&gt;
   java.lang.Thread.State: RUNNABLE&lt;br/&gt;
        at java.io.DataInputStream.readFully(DataInputStream.java:195)&lt;br/&gt;
        at java.io.DataInputStream.readLong(DataInputStream.java:416)&lt;br/&gt;
        at org.apache.cassandra.utils.BloomFilterSerializer.deserialize(BloomFilterSerializer.java:51)&lt;br/&gt;
        at org.apache.cassandra.utils.BloomFilterSerializer.deserialize(BloomFilterSerializer.java:30)&lt;br/&gt;
        at org.apache.cassandra.io.sstable.IndexHelper.defreezeBloomFilter(IndexHelper.java:108)&lt;br/&gt;
        at org.apache.cassandra.io.sstable.SSTableIdentityIterator.&amp;lt;init&amp;gt;(SSTableIdentityIterator.java:86)&lt;br/&gt;
        at org.apache.cassandra.db.CompactionManager.doScrub(CompactionManager.java:549)&lt;br/&gt;
        at org.apache.cassandra.db.CompactionManager.access$600(CompactionManager.java:55)&lt;br/&gt;
        at org.apache.cassandra.db.CompactionManager$3.call(CompactionManager.java:194)&lt;br/&gt;
        at java.util.concurrent.FutureTask$Sync.innerRun(FutureTask.java:334)&lt;br/&gt;
        at java.util.concurrent.FutureTask.run(FutureTask.java:166)&lt;br/&gt;
        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1110)&lt;br/&gt;
        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:603)&lt;br/&gt;
        at java.lang.Thread.run(Thread.java:636)&lt;/p&gt;

&lt;p&gt;   Locked ownable synchronizers:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;&amp;lt;0x00002aaabd5f71c8&amp;gt; (a java.util.concurrent.ThreadPoolExecutor$Worker)&lt;/li&gt;
	&lt;li&gt;&amp;lt;0x00002aaabd6cd008&amp;gt; (a java.util.concurrent.locks.ReentrantLock$NonfairSync)&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="12999003" author="jbellis" created="Thu, 24 Feb 2011 19:37:39 +0000"  >&lt;p&gt;What do you see when you apply the patch for &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-2241&quot; title=&quot;BRAF read can loop infinitely instead of detecting EOF&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-2241&quot;&gt;&lt;del&gt;CASSANDRA-2241&lt;/del&gt;&lt;/a&gt;?&lt;/p&gt;

&lt;p&gt;What create column family statement should I give the cli, to create this userActionUtilsKey CF?&lt;/p&gt;</comment>
                            <comment id="12999005" author="jbellis" created="Thu, 24 Feb 2011 19:46:40 +0000"  >&lt;p&gt;also, can you attach the system.log from when you started cassandra?  we&apos;re trying to figure out why it&apos;s using the new-version BloomFilterSerializer, when it should be using LegacyBloomFilterSerializer.&lt;/p&gt;</comment>
                            <comment id="12999006" author="kunda" created="Thu, 24 Feb 2011 19:50:03 +0000"  >&lt;p&gt;I didn&apos;t have time to apply the patch yet - but I will next week.&lt;br/&gt;
Regarding the example CF - as &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=slebresne&quot; class=&quot;user-hover&quot; rel=&quot;slebresne&quot;&gt;slebresne&lt;/a&gt; commented in &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-2217&quot; title=&quot;nodetool scrub&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-2217&quot;&gt;&lt;del&gt;CASSANDRA-2217&lt;/del&gt;&lt;/a&gt;, it was indeed created in Cassandra 0.6.5 -&lt;br/&gt;
so the cli cannot be used to create it &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/wink.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;However, here is KS xml element that defined it in storage-conf.xml:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-xml&quot;&gt; 
    &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;Keyspace Name=&lt;span class=&quot;code-quote&quot;&gt;&quot;generalUtils&quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;
      &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;ColumnFamily Name=&lt;span class=&quot;code-quote&quot;&gt;&quot;userActionUtilsKey&quot;&lt;/span&gt; CompareWith=&lt;span class=&quot;code-quote&quot;&gt;&quot;UTF8Type&quot;&lt;/span&gt; /&amp;gt;&lt;/span&gt;
      &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;ColumnFamily Name=&lt;span class=&quot;code-quote&quot;&gt;&quot;facebookShowIds&quot;&lt;/span&gt; CompareWith=&lt;span class=&quot;code-quote&quot;&gt;&quot;UTF8Type&quot;&lt;/span&gt; /&amp;gt;&lt;/span&gt;

      &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;ReplicaPlacementStrategy&amp;gt;&lt;/span&gt;org.apache.cassandra.locator.RackUnawareStrategy&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/ReplicaPlacementStrategy&amp;gt;&lt;/span&gt;
      &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;ReplicationFactor&amp;gt;&lt;/span&gt;1&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/ReplicationFactor&amp;gt;&lt;/span&gt;
      &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;EndPointSnitch&amp;gt;&lt;/span&gt;org.apache.cassandra.locator.EndPointSnitch&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/EndPointSnitch&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/Keyspace&amp;gt;&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="12999007" author="jbellis" created="Thu, 24 Feb 2011 19:50:49 +0000"  >&lt;p&gt;When I create a keyspace and CF w/ default settings and scrub it, I get&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt; INFO 13:49:17,594 Scrubbing SSTableReader(path=&apos;/var/lib/cassandra/data/Keyspace1/userActionUtilsKey-9-Data.db&apos;)
 INFO 13:49:17,856 Scrub of SSTableReader(path=&apos;/var/lib/cassandra/data/Keyspace1/userActionUtilsKey-9-Data.db&apos;) complete
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="12999020" author="kunda" created="Thu, 24 Feb 2011 20:14:39 +0000"  >&lt;p&gt;I had to go back 26 x 20MiB logs consisting mostly of lines such as:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt; INFO [CompactionExecutor:1] 2011-02-24 11:18:10,262 SSTableIdentityIterator.java (line 90) Invalid bloom filter in SSTableReader(path=&lt;span class=&quot;code-quote&quot;&gt;&apos;/vm1/cassandraDB/data/Keyspace2/ruleGroup-f-243-Data.db&apos;&lt;/span&gt;); will rebuild it &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;which were preceded by a bunch of NegativeArraySizeExceptions, which were after the initialization log:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;INFO [main] 2011-02-24 11:08:43,595 AbstractCassandraDaemon.java (line 77) Logging initialized
 INFO [main] 2011-02-24 11:08:43,605 AbstractCassandraDaemon.java (line 97) Heap size: 8330936320/8331984896
 INFO [main] 2011-02-24 11:08:43,606 CLibrary.java (line 61) JNA not found. Native methods will be disabled.
 INFO [main] 2011-02-24 11:08:43,613 DatabaseDescriptor.java (line 121) Loading settings from file:/usr/local/apache-cassandra-2011-02-24_02-21-51/conf/cassandra.yaml
 INFO [main] 2011-02-24 11:08:43,821 DatabaseDescriptor.java (line 181) DiskAccessMode &lt;span class=&quot;code-quote&quot;&gt;&apos;auto&apos;&lt;/span&gt; determined to be mmap, indexAccessMode is mmap
 INFO [main] 2011-02-24 11:08:43,893 SSTable.java (line 147) Deleted /vm1/cassandraDB/data/system/LocationInfo-f-210
 INFO [main] 2011-02-24 11:08:43,894 SSTable.java (line 147) Deleted /vm1/cassandraDB/data/system/LocationInfo-f-212
 INFO [main] 2011-02-24 11:08:43,894 SSTable.java (line 147) Deleted /vm1/cassandraDB/data/system/LocationInfo-f-211
 INFO [main] 2011-02-24 11:08:43,894 SSTable.java (line 147) Deleted /vm1/cassandraDB/data/system/LocationInfo-f-209
 INFO [main] 2011-02-24 11:08:43,919 SSTableReader.java (line 154) Opening /vm1/cassandraDB/data/system/IndexInfo-f-5
 INFO [main] 2011-02-24 11:08:43,937 SSTableReader.java (line 154) Opening /vm1/cassandraDB/data/system/Schema-f-89
 INFO [main] 2011-02-24 11:08:43,945 SSTableReader.java (line 154) Opening /vm1/cassandraDB/data/system/Migrations-f-85
 INFO [main] 2011-02-24 11:08:43,947 SSTableReader.java (line 154) Opening /vm1/cassandraDB/data/system/Migrations-f-87
 INFO [main] 2011-02-24 11:08:43,948 SSTableReader.java (line 154) Opening /vm1/cassandraDB/data/system/Migrations-f-86
 INFO [main] 2011-02-24 11:08:43,951 SSTableReader.java (line 154) Opening /vm1/cassandraDB/data/system/LocationInfo-f-213
 INFO [main] 2011-02-24 11:08:43,953 SSTableReader.java (line 154) Opening /vm1/cassandraDB/data/system/LocationInfo-f-214
 INFO [main] 2011-02-24 11:08:43,982 DatabaseDescriptor.java (line 461) Loading schema version b6fdb590-3e9e-11e0-8d0e-34b74a661156
 WARN [main] 2011-02-24 11:08:44,128 DatabaseDescriptor.java (line 493) Schema definitions were defined both locally and in cassandra.yaml. Definitions in cassandra.yaml were ignored.
 INFO [main] 2011-02-24 11:08:44,188 SSTableReader.java (line 154) Opening /vm1/cassandraDB/data/Keyspace2/recommenders-f-176
 INFO [main] 2011-02-24 11:08:44,191 SSTableReader.java (line 154) Opening /vm1/cassandraDB/data/Keyspace2/recommenders-f-177
 INFO [main] 2011-02-24 11:08:44,192 SSTableReader.java (line 154) Opening /vm1/cassandraDB/data/Keyspace2/recommenders-f-178
 INFO [main] 2011-02-24 11:08:44,197 SSTableReader.java (line 154) Opening /vm1/cassandraDB/data/Keyspace2/businessRule-f-200
 INFO [main] 2011-02-24 11:08:44,204 SSTableReader.java (line 154) Opening /vm1/cassandraDB/data/Keyspace2/recommendTo-f-92
 INFO [main] 2011-02-24 11:08:44,205 SSTableReader.java (line 154) Opening /vm1/cassandraDB/data/Keyspace2/recommendTo-f-93
 INFO [main] 2011-02-24 11:08:44,209 SSTableReader.java (line 154) Opening /vm1/cassandraDB/data/Keyspace2/followers-f-175
 INFO [main] 2011-02-24 11:08:44,213 SSTableReader.java (line 154) Opening /vm1/cassandraDB/data/Keyspace2/names-f-165
 INFO [main] 2011-02-24 11:08:44,218 SSTableReader.java (line 154) Opening /vm1/cassandraDB/data/Keyspace2/ruleGroup-f-244
 INFO [main] 2011-02-24 11:08:44,218 SSTableReader.java (line 154) Opening /vm1/cassandraDB/data/Keyspace2/ruleGroup-f-243
 INFO [main] 2011-02-24 11:08:44,225 SSTableReader.java (line 154) Opening /vm1/cassandraDB/data/Keyspace2/recommendFrom-f-109
 INFO [main] 2011-02-24 11:08:44,233 SSTableReader.java (line 154) Opening /vm1/cassandraDB/data/Keyspace2/channels-f-2866
 INFO [main] 2011-02-24 11:08:44,262 SSTableReader.java (line 154) Opening /vm1/cassandraDB/data/Keyspace2/channels-f-2867
 INFO [main] 2011-02-24 11:08:44,286 SSTableReader.java (line 154) Opening /vm1/cassandraDB/data/Keyspace2/recommendAgain-f-1425
 INFO [main] 2011-02-24 11:08:44,293 SSTableReader.java (line 154) Opening /vm1/cassandraDB/data/Keyspace1/userProfile-f-816
 INFO [main] 2011-02-24 11:08:44,294 SSTableReader.java (line 154) Opening /vm1/cassandraDB/data/Keyspace1/userProfile-f-815
 INFO [main] 2011-02-24 11:08:44,301 SSTableReader.java (line 154) Opening /vm1/cassandraDB/data/Keyspace1/showData-f-6153
 INFO [main] 2011-02-24 11:08:44,302 SSTableReader.java (line 154) Opening /vm1/cassandraDB/data/Keyspace1/showData-f-6039
 INFO [main] 2011-02-24 11:08:44,443 SSTableReader.java (line 154) Opening /vm1/cassandraDB/data/Keyspace1/showData-f-6130
 INFO [main] 2011-02-24 11:08:44,498 SSTableReader.java (line 154) Opening /vm1/cassandraDB/data/Keyspace1/showData-f-6040
 INFO [main] 2011-02-24 11:08:44,591 SSTableReader.java (line 154) Opening /vm1/cassandraDB/data/Keyspace1/showData-f-6143
 INFO [main] 2011-02-24 11:08:44,608 SSTableReader.java (line 154) Opening /vm1/cassandraDB/data/Keyspace1/showData-f-6036
 INFO [main] 2011-02-24 11:08:44,676 SSTableReader.java (line 154) Opening /vm1/cassandraDB/data/Keyspace1/showData-f-6035
 INFO [main] 2011-02-24 11:08:44,852 SSTableReader.java (line 154) Opening /vm1/cassandraDB/data/Keyspace1/showData-f-6038
 INFO [main] 2011-02-24 11:08:44,953 SSTableReader.java (line 154) Opening /vm1/cassandraDB/data/Keyspace1/showData-f-6134
 INFO [main] 2011-02-24 11:08:44,960 SSTableReader.java (line 154) Opening /vm1/cassandraDB/data/Keyspace1/showData-f-6114
 INFO [main] 2011-02-24 11:08:44,976 SSTableReader.java (line 154) Opening /vm1/cassandraDB/data/Keyspace1/showData-f-6096
 INFO [main] 2011-02-24 11:08:45,040 SSTableReader.java (line 154) Opening /vm1/cassandraDB/data/Keyspace1/showData-f-6147
 INFO [main] 2011-02-24 11:08:45,048 SSTableReader.java (line 154) Opening /vm1/cassandraDB/data/Keyspace1/showData-f-6152
 INFO [main] 2011-02-24 11:08:45,062 SSTableReader.java (line 154) Opening /vm1/cassandraDB/data/Keyspace1/cloudData-f-5990
 INFO [main] 2011-02-24 11:08:45,087 SSTableReader.java (line 154) Opening /vm1/cassandraDB/data/Keyspace1/cloudData-f-6063
 INFO [main] 2011-02-24 11:08:45,109 SSTableReader.java (line 154) Opening /vm1/cassandraDB/data/Keyspace1/cloudData-f-6109
 INFO [main] 2011-02-24 11:08:45,110 SSTableReader.java (line 154) Opening /vm1/cassandraDB/data/Keyspace1/cloudData-f-5991
 INFO [main] 2011-02-24 11:08:45,136 SSTableReader.java (line 154) Opening /vm1/cassandraDB/data/Keyspace1/cloudData-f-6108
 INFO [main] 2011-02-24 11:08:45,154 SSTableReader.java (line 154) Opening /vm1/cassandraDB/data/Keyspace1/userChannelFilter-f-207
 INFO [main] 2011-02-24 11:08:45,154 SSTableReader.java (line 154) Opening /vm1/cassandraDB/data/Keyspace1/userChannelFilter-f-208
 INFO [main] 2011-02-24 11:08:45,162 SSTableReader.java (line 154) Opening /vm1/cassandraDB/data/Keyspace1/popularCloudIds-f-203
 INFO [main] 2011-02-24 11:08:45,166 SSTableReader.java (line 154) Opening /vm1/cassandraDB/data/Keyspace1/userActions-f-1160
 INFO [main] 2011-02-24 11:08:45,177 SSTableReader.java (line 154) Opening /vm1/cassandraDB/data/Keyspace1/headends-f-5793
 INFO [main] 2011-02-24 11:08:45,195 SSTableReader.java (line 154) Opening /vm1/cassandraDB/data/Keyspace1/headends-f-5801
 INFO [main] 2011-02-24 11:08:45,196 SSTableReader.java (line 154) Opening /vm1/cassandraDB/data/Keyspace1/headends-f-5761
 INFO [main] 2011-02-24 11:08:45,202 SSTableReader.java (line 154) Opening /vm1/cassandraDB/data/Keyspace1/headends-f-5800
 INFO [main] 2011-02-24 11:08:45,213 SSTableReader.java (line 154) Opening /vm1/cassandraDB/data/Keyspace1/userActionLikes-f-10
 INFO [main] 2011-02-24 11:08:45,218 SSTableReader.java (line 154) Opening /vm1/cassandraDB/data/Keyspace1/userAttributes-f-2517
 INFO [main] 2011-02-24 11:08:45,219 SSTableReader.java (line 154) Opening /vm1/cassandraDB/data/Keyspace1/userAttributes-f-2533
 INFO [main] 2011-02-24 11:08:45,221 SSTableReader.java (line 154) Opening /vm1/cassandraDB/data/Keyspace1/userAttributes-f-2532
 INFO [main] 2011-02-24 11:08:45,230 SSTableReader.java (line 154) Opening /vm1/cassandraDB/data/userSimilarity/signatureBuckets-102
 INFO [main] 2011-02-24 11:08:45,607 SSTableReader.java (line 154) Opening /vm1/cassandraDB/data/userSimilarity/signatureBuckets-103
 INFO [main] 2011-02-24 11:08:45,799 SSTableReader.java (line 154) Opening /vm1/cassandraDB/data/userSimilarity/signatureBuckets-88
 INFO [main] 2011-02-24 11:08:46,319 SSTableReader.java (line 154) Opening /vm1/cassandraDB/data/userSimilarity/signatureBuckets-93
 INFO [main] 2011-02-24 11:08:46,846 SSTableReader.java (line 154) Opening /vm1/cassandraDB/data/userSimilarity/signatureBuckets-63
 INFO [main] 2011-02-24 11:08:49,879 SSTableReader.java (line 154) Opening /vm1/cassandraDB/data/userSimilarity/signatureBuckets-83
 INFO [main] 2011-02-24 11:08:51,340 SSTableReader.java (line 154) Opening /vm1/cassandraDB/data/userSimilarity/userSignatures-22
 INFO [main] 2011-02-24 11:08:51,351 SSTableReader.java (line 154) Opening /vm1/cassandraDB/data/userSimilarity/userSignatures-23
 INFO [main] 2011-02-24 11:08:51,355 SSTableReader.java (line 154) Opening /vm1/cassandraDB/data/userSimilarity/userSignatures-17
 INFO [main] 2011-02-24 11:08:51,385 SSTableReader.java (line 154) Opening /vm1/cassandraDB/data/userSimilarity/userSignatures-24
 INFO [main] 2011-02-24 11:08:51,390 SSTableReader.java (line 154) Opening /vm1/cassandraDB/data/userSimilarity/signatureFunctions-5
 INFO [main] 2011-02-24 11:08:51,394 SSTableReader.java (line 154) Opening /vm1/cassandraDB/data/generalUtils/userActionUtilsKey-9
 INFO [main] 2011-02-24 11:08:51,396 SSTableReader.java (line 154) Opening /vm1/cassandraDB/data/generalUtils/facebookShowIds-f-37
 INFO [main] 2011-02-24 11:08:51,398 SSTableReader.java (line 154) Opening /vm1/cassandraDB/data/userSimilarity2/signatureBuckets-6
 INFO [main] 2011-02-24 11:08:51,527 SSTableReader.java (line 154) Opening /vm1/cassandraDB/data/userSimilarity2/signatureBuckets-5
 INFO [main] 2011-02-24 11:08:51,903 SSTableReader.java (line 154) Opening /vm1/cassandraDB/data/userSimilarity2/userSignatures-1
 INFO [main] 2011-02-24 11:08:52,006 SSTableReader.java (line 154) Opening /vm1/cassandraDB/data/userSimilarity2/userSignatures-e-3
 INFO [main] 2011-02-24 11:08:52,009 SSTableReader.java (line 154) Opening /vm1/cassandraDB/data/userSimilarity2/userSignatures-2
 INFO [main] 2011-02-24 11:08:52,013 SSTableReader.java (line 154) Opening /vm1/cassandraDB/data/userSimilarity2/signatureFunctions-2
 INFO [main] 2011-02-24 11:08:52,013 SSTableReader.java (line 154) Opening /vm1/cassandraDB/data/userSimilarity2/signatureFunctions-1
 INFO [main] 2011-02-24 11:08:52,014 SSTableReader.java (line 154) Opening /vm1/cassandraDB/data/userSimilarity2/signatureFunctions-e-3
 INFO [main] 2011-02-24 11:08:52,019 SSTableReader.java (line 154) Opening /vm1/cassandraDB/data/realTimeSocial/facebookActions-f-186
 INFO [main] 2011-02-24 11:08:52,019 SSTableReader.java (line 154) Opening /vm1/cassandraDB/data/realTimeSocial/facebookActions-f-185
 INFO [main] 2011-02-24 11:08:52,022 SSTableReader.java (line 154) Opening /vm1/cassandraDB/data/realTimeSocial/watchingUsers-f-477
 INFO [main] 2011-02-24 11:08:52,038 SSTableReader.java (line 154) Opening /vm1/cassandraDB/data/realTimeSocial/showState-e-35
 INFO [main] 2011-02-24 11:08:52,039 SSTableReader.java (line 154) Opening /vm1/cassandraDB/data/realTimeSocial/showState-e-37
 INFO [main] 2011-02-24 11:08:52,039 SSTableReader.java (line 154) Opening /vm1/cassandraDB/data/realTimeSocial/showState-e-36
 INFO [main] 2011-02-24 11:08:52,042 SSTableReader.java (line 154) Opening /vm1/cassandraDB/data/realTimeSocial/watchingUserHistory-f-462
 INFO [main] 2011-02-24 11:08:52,042 SSTableReader.java (line 154) Opening /vm1/cassandraDB/data/realTimeSocial/watchingUserHistory-f-461
 INFO [main] 2011-02-24 11:08:52,043 SSTableReader.java (line 154) Opening /vm1/cassandraDB/data/realTimeSocial/watchingUserHistory-f-463
 INFO [main] 2011-02-24 11:08:52,045 SSTableReader.java (line 154) Opening /vm1/cassandraDB/data/chats/chatUsers-f-129
 INFO [main] 2011-02-24 11:08:52,046 SSTableReader.java (line 154) Opening /vm1/cassandraDB/data/chats/chatHistory-f-129
 INFO [main] 2011-02-24 11:08:52,055 CommitLogSegment.java (line 50) Creating &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; commitlog segment /vm1/cassandraDB/commitlog/CommitLog-1298538532055.log
 INFO [main] 2011-02-24 11:08:52,061 CommitLog.java (line 155) Replaying /vm1/cassandraDB/commitlog/CommitLog-1298537386811.log
 INFO [main] 2011-02-24 11:08:52,073 CommitLog.java (line 311) Finished reading /vm1/cassandraDB/commitlog/CommitLog-1298537386811.log
 INFO [main] 2011-02-24 11:08:52,074 ColumnFamilyStore.java (line 666) switching in a fresh Memtable &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; recommendAgain at CommitLogContext(file=&lt;span class=&quot;code-quote&quot;&gt;&apos;/vm1/cassandraDB/commitlog/CommitLog-1298538532055.log&apos;&lt;/span&gt;, position=0)
 INFO [main] 2011-02-24 11:08:52,076 ColumnFamilyStore.java (line 977) Enqueuing flush of Memtable-recommendAgain@205025794(636 bytes, 7 operations)
 INFO [FlushWriter:1] 2011-02-24 11:08:52,077 Memtable.java (line 157) Writing Memtable-recommendAgain@205025794(636 bytes, 7 operations)
 INFO [FlushWriter:1] 2011-02-24 11:08:52,113 Memtable.java (line 164) Completed flushing /vm1/cassandraDB/data/Keyspace2/recommendAgain-f-1426-Data.db (859 bytes)
 INFO [main] 2011-02-24 11:08:52,118 CommitLog.java (line 163) Log replay complete
 INFO [main] 2011-02-24 11:08:52,131 StorageService.java (line 354) Cassandra version: 2011-02-24_02-21-51
 INFO [main] 2011-02-24 11:08:52,131 StorageService.java (line 355) Thrift API version: 19.4.0
 INFO [main] 2011-02-24 11:08:52,132 StorageService.java (line 368) Loading persisted ring state
 INFO [main] 2011-02-24 11:08:52,132 StorageService.java (line 404) Starting up server gossip
 INFO [main] 2011-02-24 11:08:52,137 ColumnFamilyStore.java (line 666) switching in a fresh Memtable &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; LocationInfo at CommitLogContext(file=&lt;span class=&quot;code-quote&quot;&gt;&apos;/vm1/cassandraDB/commitlog/CommitLog-1298538532055.log&apos;&lt;/span&gt;, position=148)
 INFO [main] 2011-02-24 11:08:52,137 ColumnFamilyStore.java (line 977) Enqueuing flush of Memtable-LocationInfo@1068086436(29 bytes, 1 operations)
 INFO [FlushWriter:1] 2011-02-24 11:08:52,138 Memtable.java (line 157) Writing Memtable-LocationInfo@1068086436(29 bytes, 1 operations)
 INFO [FlushWriter:1] 2011-02-24 11:08:52,178 Memtable.java (line 164) Completed flushing /vm1/cassandraDB/data/system/LocationInfo-f-215-Data.db (80 bytes)
 INFO [main] 2011-02-24 11:08:52,198 StorageService.java (line 468) Using saved token 51653040247566871911249877869558549493
 INFO [main] 2011-02-24 11:08:52,199 ColumnFamilyStore.java (line 666) switching in a fresh Memtable &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; LocationInfo at CommitLogContext(file=&lt;span class=&quot;code-quote&quot;&gt;&apos;/vm1/cassandraDB/commitlog/CommitLog-1298538532055.log&apos;&lt;/span&gt;, position=444)
 INFO [main] 2011-02-24 11:08:52,199 ColumnFamilyStore.java (line 977) Enqueuing flush of Memtable-LocationInfo@832074392(53 bytes, 2 operations)
 INFO [FlushWriter:1] 2011-02-24 11:08:52,199 Memtable.java (line 157) Writing Memtable-LocationInfo@832074392(53 bytes, 2 operations)
 INFO [FlushWriter:1] 2011-02-24 11:08:52,230 Memtable.java (line 164) Completed flushing /vm1/cassandraDB/data/system/LocationInfo-f-216-Data.db (163 bytes)
 INFO [CompactionExecutor:1] 2011-02-24 11:08:52,231 CompactionManager.java (line 395) Compacting [SSTableReader(path=&lt;span class=&quot;code-quote&quot;&gt;&apos;/vm1/cassandraDB/data/system/LocationInfo-f-213-Data.db&apos;&lt;/span&gt;),SSTableReader(path=&lt;span class=&quot;code-quote&quot;&gt;&apos;/vm1/cassandraDB/data/system/LocationInfo-f-214-Data.db&apos;&lt;/span&gt;),SSTableReader(path=&lt;span class=&quot;code-quote&quot;&gt;&apos;/vm1/cassandraDB/data/system/LocationInfo-f-215-Data.db&apos;&lt;/span&gt;),SSTableReader(path=&lt;span class=&quot;code-quote&quot;&gt;&apos;/vm1/cassandraDB/data/system/LocationInfo-f-216-Data.db&apos;&lt;/span&gt;)]
 INFO [main] 2011-02-24 11:08:52,233 Mx4jTool.java (line 72) Will not load MX4J, mx4j-tools.jar is not in the classpath
 INFO [CompactionExecutor:1] 2011-02-24 11:08:52,292 CompactionManager.java (line 482) Compacted to /vm1/cassandraDB/data/system/LocationInfo-tmp-f-217-Data.db.  851 to 445 (~52% of original) bytes &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; 3 keys.  Time: 61ms.
 INFO [main] 2011-02-24 11:08:52,296 CassandraDaemon.java (line 112) Binding thrift service to /0.0.0.0:9160
 INFO [main] 2011-02-24 11:08:52,298 CassandraDaemon.java (line 126) Using TFastFramedTransport with a max frame size of 15728640 bytes.
 INFO [&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;-3] 2011-02-24 11:08:52,300 CassandraDaemon.java (line 153) Listening &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; thrift clients...
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="12999021" author="kunda" created="Thu, 24 Feb 2011 20:17:42 +0000"  >&lt;p&gt;The previously mentioned tons of &quot;Invalid bloom filter in SSTableReader&quot; logs ended with a single stacktrace:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;ERROR [CompactionExecutor:1] 2011-02-24 11:36:19,268 AbstractCassandraDaemon.java (line 114) Fatal exception in thread &lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;[CompactionExecutor:1,1,main]
java.lang.AssertionError
	at org.apache.cassandra.dht.RandomPartitioner.convertFromDiskFormat(RandomPartitioner.java:62)
	at org.apache.cassandra.io.sstable.SSTableReader.decodeKey(SSTableReader.java:627)
	at org.apache.cassandra.db.CompactionManager.doScrub(CompactionManager.java:541)
	at org.apache.cassandra.db.CompactionManager.access$600(CompactionManager.java:55)
	at org.apache.cassandra.db.CompactionManager$3.call(CompactionManager.java:194)
	at java.util.concurrent.FutureTask$Sync.innerRun(FutureTask.java:334)
	at java.util.concurrent.FutureTask.run(FutureTask.java:166)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1110)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:603)
	at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:636)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;followed by what appears to be standard flushing/switching logs.&lt;/p&gt;</comment>
                            <comment id="12999022" author="kunda" created="Thu, 24 Feb 2011 20:20:13 +0000"  >&lt;p&gt;I now restarted the server again, and two things happened:&lt;br/&gt;
1) performing a scrub on the example CF and a bunch of other CFs succeeded without hanging&lt;br/&gt;
2) performing a scrub on a different CF resulting in the following stack trace (on different retries):&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;ERROR [CompactionExecutor:1] 2011-02-24 22:02:30,329 AbstractCassandraDaemon.java (line 114) Fatal exception in thread &lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;[CompactionExecutor:1,1,main]
java.io.IOError: java.io.EOFException
	at org.apache.cassandra.io.sstable.SSTableIdentityIterator.&amp;lt;init&amp;gt;(SSTableIdentityIterator.java:113)
	at org.apache.cassandra.db.CompactionManager.doScrub(CompactionManager.java:549)
	at org.apache.cassandra.db.CompactionManager.access$600(CompactionManager.java:55)
	at org.apache.cassandra.db.CompactionManager$3.call(CompactionManager.java:194)
	at java.util.concurrent.FutureTask$Sync.innerRun(FutureTask.java:334)
	at java.util.concurrent.FutureTask.run(FutureTask.java:166)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1110)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:603)
	at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:636)
Caused by: java.io.EOFException
	at java.io.RandomAccessFile.readInt(RandomAccessFile.java:776)
	at org.apache.cassandra.io.sstable.IndexHelper.skipBloomFilter(IndexHelper.java:47)
	at org.apache.cassandra.io.sstable.SSTableIdentityIterator.&amp;lt;init&amp;gt;(SSTableIdentityIterator.java:104)
	... 8 more
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;3) and on another CF:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;ERROR [CompactionExecutor:1] 2011-02-24 22:28:28,002 AbstractCassandraDaemon.java (line 114) Fatal exception in thread &lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;[CompactionExecutor:1,1,main]
java.lang.AssertionError
        at org.apache.cassandra.dht.RandomPartitioner.convertFromDiskFormat(RandomPartitioner.java:62)
        at org.apache.cassandra.io.sstable.SSTableReader.decodeKey(SSTableReader.java:627)
        at org.apache.cassandra.db.CompactionManager.doScrub(CompactionManager.java:541)
        at org.apache.cassandra.db.CompactionManager.access$600(CompactionManager.java:55)
        at org.apache.cassandra.db.CompactionManager$3.call(CompactionManager.java:194)
        at java.util.concurrent.FutureTask$Sync.innerRun(FutureTask.java:334)
        at java.util.concurrent.FutureTask.run(FutureTask.java:166)
        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1110)
        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:603)
        at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:636)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="12999038" author="jbellis" created="Thu, 24 Feb 2011 20:55:55 +0000"  >&lt;p&gt;I really can&apos;t help with just a stacktrace and none of the logs leading up to it.&lt;/p&gt;

&lt;p&gt;Remember that scrub snapshots before it does its thing, so it&apos;s easy to restore the pre-scrubbed versions and try again.&lt;/p&gt;</comment>
                            <comment id="12999429" author="jbellis" created="Fri, 25 Feb 2011 16:23:47 +0000"  >&lt;p&gt;Couldn&apos;t reproduce by scrubbing sstables produced by 0.6 stress.py&lt;/p&gt;</comment>
                            <comment id="12999921" author="kunda" created="Sun, 27 Feb 2011 10:28:08 +0000"  >&lt;p&gt;After performing more tests, I realized why the problem could not be reproduced - the scrub process hang on a different CF, and afterwards any scrub operation would hang, until the server is restarted.&lt;br/&gt;
I was able to narrow down the problem to a specific sstable - I will soon post it along the stack trace.&lt;/p&gt;</comment>
                            <comment id="12999923" author="kunda" created="Sun, 27 Feb 2011 10:34:29 +0000"  >&lt;p&gt;Here is the sstable that hangs the scrub process - ran on 0.7 build #325&lt;/p&gt;</comment>
                            <comment id="12999926" author="kunda" created="Sun, 27 Feb 2011 10:44:31 +0000"  >&lt;p&gt;And here is another sstable that doesn&apos;t hang but throws an exception&lt;/p&gt;</comment>
                            <comment id="12999933" author="kunda" created="Sun, 27 Feb 2011 11:23:15 +0000"  >&lt;p&gt;Update: restarted server and rerun scrub on the attached signatureBuckets CF, this time did not hung but gave the following error:&lt;br/&gt;
 INFO &lt;span class=&quot;error&quot;&gt;&amp;#91;CompactionExecutor:1&amp;#93;&lt;/span&gt; 2011-02-27 13:21:27,928 CompactionManager.java (line 511) Scrubbing SSTableReader(path=&apos;/vm1/cassandraDB/data/userSimilarity/signatureBuckets-f-104-Data.db&apos;)&lt;br/&gt;
 INFO &lt;span class=&quot;error&quot;&gt;&amp;#91;CompactionExecutor:1&amp;#93;&lt;/span&gt; 2011-02-27 13:21:28,430 SSTableIdentityIterator.java (line 90) Invalid bloom filter in SSTableReader(path=&apos;/vm1/cassandraDB/data/userSimilarity/signatureBuckets-f-104-Data.db&apos;); will rebuild it&lt;br/&gt;
 INFO &lt;span class=&quot;error&quot;&gt;&amp;#91;CompactionExecutor:1&amp;#93;&lt;/span&gt; 2011-02-27 13:21:28,430 SSTableIdentityIterator.java (line 99) Invalid row summary in SSTableReader(path=&apos;/vm1/cassandraDB/data/userSimilarity/signatureBuckets-f-104-Data.db&apos;); will rebuild it&lt;br/&gt;
ERROR &lt;span class=&quot;error&quot;&gt;&amp;#91;CompactionExecutor:1&amp;#93;&lt;/span&gt; 2011-02-27 13:21:28,434 AbstractCassandraDaemon.java (line 114) Fatal exception in thread Thread&lt;span class=&quot;error&quot;&gt;&amp;#91;CompactionExecutor:1,1,main&amp;#93;&lt;/span&gt;&lt;br/&gt;
java.io.IOError: java.io.EOFException: attempted to skip 758940931 bytes but only skipped 1400349&lt;br/&gt;
        at org.apache.cassandra.io.sstable.SSTableIdentityIterator.&amp;lt;init&amp;gt;(SSTableIdentityIterator.java:113)&lt;br/&gt;
        at org.apache.cassandra.db.CompactionManager.doScrub(CompactionManager.java:548)&lt;br/&gt;
        at org.apache.cassandra.db.CompactionManager.access$600(CompactionManager.java:55)&lt;br/&gt;
        at org.apache.cassandra.db.CompactionManager$3.call(CompactionManager.java:194)&lt;br/&gt;
        at java.util.concurrent.FutureTask$Sync.innerRun(FutureTask.java:334)&lt;br/&gt;
        at java.util.concurrent.FutureTask.run(FutureTask.java:166)&lt;br/&gt;
        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1110)&lt;br/&gt;
        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:603)&lt;br/&gt;
        at java.lang.Thread.run(Thread.java:636)&lt;br/&gt;
Caused by: java.io.EOFException: attempted to skip 758940931 bytes but only skipped 1400349&lt;br/&gt;
        at org.apache.cassandra.io.sstable.IndexHelper.skipBloomFilter(IndexHelper.java:51)&lt;br/&gt;
        at org.apache.cassandra.io.sstable.SSTableIdentityIterator.&amp;lt;init&amp;gt;(SSTableIdentityIterator.java:104)&lt;br/&gt;
        ... 8 more&lt;/p&gt;
</comment>
                            <comment id="12999943" author="kunda" created="Sun, 27 Feb 2011 12:05:16 +0000"  >&lt;p&gt;Repeating the process now results in a different failure on a different and very big (&amp;gt;500MB) sstable of the same signatureBuckets CF:&lt;/p&gt;

&lt;p&gt;ERROR &lt;span class=&quot;error&quot;&gt;&amp;#91;CompactionExecutor:1&amp;#93;&lt;/span&gt; 2011-02-27 13:26:01,307 AbstractCassandraDaemon.java (line 114) Fatal exception in thread Thread&lt;span class=&quot;error&quot;&gt;&amp;#91;CompactionExecutor:1,1,main&amp;#93;&lt;/span&gt;&lt;br/&gt;
java.lang.AssertionError&lt;br/&gt;
        at org.apache.cassandra.dht.RandomPartitioner.convertFromDiskFormat(RandomPartitioner.java:62)&lt;br/&gt;
        at org.apache.cassandra.io.sstable.SSTableReader.decodeKey(SSTableReader.java:627)&lt;br/&gt;
        at org.apache.cassandra.db.CompactionManager.doScrub(CompactionManager.java:538)&lt;br/&gt;
        at org.apache.cassandra.db.CompactionManager.access$600(CompactionManager.java:55)&lt;br/&gt;
        at org.apache.cassandra.db.CompactionManager$3.call(CompactionManager.java:194)&lt;br/&gt;
        at java.util.concurrent.FutureTask$Sync.innerRun(FutureTask.java:334)&lt;br/&gt;
        at java.util.concurrent.FutureTask.run(FutureTask.java:166)&lt;br/&gt;
        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1110)&lt;br/&gt;
        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:603)&lt;br/&gt;
        at java.lang.Thread.run(Thread.java:636)&lt;/p&gt;

&lt;p&gt;I think it has something to do with &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jbellis&quot; class=&quot;user-hover&quot; rel=&quot;jbellis&quot;&gt;jbellis&lt;/a&gt;&apos;s comment about missing colon delimiter -&lt;br/&gt;
if scrub cannot solve this, is there any way to fix this problem?&lt;/p&gt;</comment>
                            <comment id="13000048" author="wajam" created="Sun, 27 Feb 2011 21:53:52 +0000"  >&lt;p&gt;We are running into the same issue using #325 from Hudson. Exception everytime.&lt;/p&gt;

&lt;p&gt;Everything started when we upgraded from 0.6.8 to 0.7.2. One of the node (17 nodes total) started to be slow, we realized one CF wasn&apos;t compacting and throw exception (Error in ThreadPoolExecutor java.io.IOError: org.apache.cassandra.db.ColumnSerializer$CorruptColumnException: invalid column name length 0).&lt;/p&gt;

&lt;p&gt;So I gave the new scrub function a try and but looks like it doesnt work. We really need to have this fixed!&lt;/p&gt;

&lt;p&gt;Thank you!&lt;/p&gt;</comment>
                            <comment id="13000057" author="jbellis" created="Sun, 27 Feb 2011 22:45:34 +0000"  >&lt;p&gt;can someone post a log file from a failed scrub attempt?  ideally with log level debug but I&apos;ll take info if that&apos;s what you have.&lt;/p&gt;</comment>
                            <comment id="13000060" author="wajam" created="Sun, 27 Feb 2011 23:14:31 +0000"  >&lt;p&gt;I tried to activate debug log but since this is a live node, it seems there is WAY too much going on. Here is the INFO log:&lt;/p&gt;

&lt;p&gt;ERROR 23:10:35,105 Fatal exception in thread Thread&lt;span class=&quot;error&quot;&gt;&amp;#91;CompactionExecutor:1,1,main&amp;#93;&lt;/span&gt;&lt;br/&gt;
java.io.IOError: org.apache.cassandra.db.ColumnSerializer$CorruptColumnException: invalid column name length 0&lt;br/&gt;
        at org.apache.cassandra.io.util.ColumnIterator.deserializeNext(ColumnSortedMap.java:246)&lt;br/&gt;
        at org.apache.cassandra.io.util.ColumnIterator.next(ColumnSortedMap.java:262)&lt;br/&gt;
        at org.apache.cassandra.io.util.ColumnIterator.next(ColumnSortedMap.java:223)&lt;br/&gt;
        at java.util.concurrent.ConcurrentSkipListMap.buildFromSorted(ConcurrentSkipListMap.java:1521)&lt;br/&gt;
        at java.util.concurrent.ConcurrentSkipListMap.&amp;lt;init&amp;gt;(ConcurrentSkipListMap.java:1471)&lt;br/&gt;
        at org.apache.cassandra.db.SuperColumnSerializer.deserialize(SuperColumn.java:366)&lt;br/&gt;
        at org.apache.cassandra.db.SuperColumnSerializer.deserialize(SuperColumn.java:314)&lt;br/&gt;
        at org.apache.cassandra.db.ColumnFamilySerializer.deserializeColumns(ColumnFamilySerializer.java:129)&lt;br/&gt;
        at org.apache.cassandra.io.sstable.SSTableIdentityIterator.getColumnFamilyWithColumns(SSTableIdentityIterator.java:172)&lt;br/&gt;
        at org.apache.cassandra.io.PrecompactedRow.&amp;lt;init&amp;gt;(PrecompactedRow.java:78)&lt;br/&gt;
        at org.apache.cassandra.io.CompactionIterator.getCompactedRow(CompactionIterator.java:139)&lt;br/&gt;
        at org.apache.cassandra.io.CompactionIterator.getReduced(CompactionIterator.java:108)&lt;br/&gt;
        at org.apache.cassandra.io.CompactionIterator.getReduced(CompactionIterator.java:43)&lt;br/&gt;
        at org.apache.cassandra.utils.ReducingIterator.computeNext(ReducingIterator.java:73)&lt;br/&gt;
        at com.google.common.collect.AbstractIterator.tryToComputeNext(AbstractIterator.java:136)&lt;br/&gt;
        at com.google.common.collect.AbstractIterator.hasNext(AbstractIterator.java:131)&lt;br/&gt;
        at org.apache.commons.collections.iterators.FilterIterator.setNextObject(FilterIterator.java:183)&lt;br/&gt;
        at org.apache.commons.collections.iterators.FilterIterator.hasNext(FilterIterator.java:94)&lt;br/&gt;
        at org.apache.cassandra.db.CompactionManager.doCompaction(CompactionManager.java:448)&lt;br/&gt;
        at org.apache.cassandra.db.CompactionManager$1.call(CompactionManager.java:123)&lt;br/&gt;
        at org.apache.cassandra.db.CompactionManager$1.call(CompactionManager.java:93)&lt;br/&gt;
        at java.util.concurrent.FutureTask$Sync.innerRun(FutureTask.java:334)&lt;br/&gt;
        at java.util.concurrent.FutureTask.run(FutureTask.java:166)&lt;br/&gt;
        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1110)&lt;br/&gt;
        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:603)&lt;br/&gt;
        at java.lang.Thread.run(Thread.java:636)&lt;br/&gt;
Caused by: org.apache.cassandra.db.ColumnSerializer$CorruptColumnException: invalid column name length 0&lt;br/&gt;
        at org.apache.cassandra.db.ColumnSerializer.deserialize(ColumnSerializer.java:68)&lt;br/&gt;
        at org.apache.cassandra.io.util.ColumnIterator.deserializeNext(ColumnSortedMap.java:242)&lt;br/&gt;
        ... 25 more&lt;br/&gt;
 INFO 23:10:35,106 Scrubbing SSTableReader(path=&apos;/var/lib/cassandra/data/Wajam/Comment-f-710-Data.db&apos;)&lt;br/&gt;
ERROR 23:10:37,489 Fatal exception in thread Thread&lt;span class=&quot;error&quot;&gt;&amp;#91;CompactionExecutor:1,1,main&amp;#93;&lt;/span&gt;&lt;br/&gt;
java.io.EOFException&lt;br/&gt;
        at java.io.RandomAccessFile.readFully(RandomAccessFile.java:416)&lt;br/&gt;
        at java.io.RandomAccessFile.readFully(RandomAccessFile.java:394)&lt;br/&gt;
        at org.apache.cassandra.io.util.BufferedRandomAccessFile.readBytes(BufferedRandomAccessFile.java:268)&lt;br/&gt;
        at org.apache.cassandra.utils.ByteBufferUtil.read(ByteBufferUtil.java:310)&lt;br/&gt;
        at org.apache.cassandra.utils.ByteBufferUtil.readWithShortLength(ByteBufferUtil.java:284)&lt;br/&gt;
        at org.apache.cassandra.db.CompactionManager.doScrub(CompactionManager.java:540)&lt;br/&gt;
        at org.apache.cassandra.db.CompactionManager.access$600(CompactionManager.java:55)&lt;br/&gt;
        at org.apache.cassandra.db.CompactionManager$3.call(CompactionManager.java:194)&lt;br/&gt;
        at java.util.concurrent.FutureTask$Sync.innerRun(FutureTask.java:334)&lt;br/&gt;
        at java.util.concurrent.FutureTask.run(FutureTask.java:166)&lt;br/&gt;
        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1110)&lt;br/&gt;
        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:603)&lt;br/&gt;
        at java.lang.Thread.run(Thread.java:636)&lt;/p&gt;

&lt;p&gt;And the exception that is output by nodetool scrub:&lt;/p&gt;

&lt;p&gt;Error occured while scrubbing keyspace &amp;lt;keyspacename&amp;gt;&lt;br/&gt;
java.util.concurrent.ExecutionException: java.io.EOFException&lt;br/&gt;
        at java.util.concurrent.FutureTask$Sync.innerGet(FutureTask.java:252)&lt;br/&gt;
        at java.util.concurrent.FutureTask.get(FutureTask.java:111)&lt;br/&gt;
        at org.apache.cassandra.db.CompactionManager.performScrub(CompactionManager.java:203)&lt;br/&gt;
        at org.apache.cassandra.db.ColumnFamilyStore.scrub(ColumnFamilyStore.java:963)&lt;br/&gt;
        at org.apache.cassandra.service.StorageService.scrub(StorageService.java:1247)&lt;br/&gt;
        at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)&lt;br/&gt;
        at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:57)&lt;br/&gt;
        at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)&lt;br/&gt;
        at java.lang.reflect.Method.invoke(Method.java:616)&lt;br/&gt;
        at com.sun.jmx.mbeanserver.StandardMBeanIntrospector.invokeM2(StandardMBeanIntrospector.java:111)&lt;br/&gt;
        at com.sun.jmx.mbeanserver.StandardMBeanIntrospector.invokeM2(StandardMBeanIntrospector.java:45)&lt;br/&gt;
        at com.sun.jmx.mbeanserver.MBeanIntrospector.invokeM(MBeanIntrospector.java:226)&lt;br/&gt;
        at com.sun.jmx.mbeanserver.PerInterface.invoke(PerInterface.java:138)&lt;br/&gt;
        at com.sun.jmx.mbeanserver.MBeanSupport.invoke(MBeanSupport.java:251)&lt;br/&gt;
        at com.sun.jmx.interceptor.DefaultMBeanServerInterceptor.invoke(DefaultMBeanServerInterceptor.java:857)&lt;br/&gt;
        at com.sun.jmx.mbeanserver.JmxMBeanServer.invoke(JmxMBeanServer.java:795)&lt;br/&gt;
        at javax.management.remote.rmi.RMIConnectionImpl.doOperation(RMIConnectionImpl.java:1450)&lt;br/&gt;
        at javax.management.remote.rmi.RMIConnectionImpl.access$200(RMIConnectionImpl.java:90)&lt;br/&gt;
        at javax.management.remote.rmi.RMIConnectionImpl$PrivilegedOperation.run(RMIConnectionImpl.java:1285)&lt;br/&gt;
        at javax.management.remote.rmi.RMIConnectionImpl.doPrivilegedOperation(RMIConnectionImpl.java:1383)&lt;br/&gt;
        at javax.management.remote.rmi.RMIConnectionImpl.invoke(RMIConnectionImpl.java:807)&lt;br/&gt;
        at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)&lt;br/&gt;
        at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:57)&lt;br/&gt;
        at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)&lt;br/&gt;
        at java.lang.reflect.Method.invoke(Method.java:616)&lt;br/&gt;
        at sun.rmi.server.UnicastServerRef.dispatch(UnicastServerRef.java:322)&lt;br/&gt;
        at sun.rmi.transport.Transport$1.run(Transport.java:177)&lt;br/&gt;
        at java.security.AccessController.doPrivileged(Native Method)&lt;br/&gt;
        at sun.rmi.transport.Transport.serviceCall(Transport.java:173)&lt;br/&gt;
        at sun.rmi.transport.tcp.TCPTransport.handleMessages(TCPTransport.java:553)&lt;br/&gt;
        at sun.rmi.transport.tcp.TCPTransport$ConnectionHandler.run0(TCPTransport.java:808)&lt;br/&gt;
        at sun.rmi.transport.tcp.TCPTransport$ConnectionHandler.run(TCPTransport.java:667)&lt;br/&gt;
        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1110)&lt;br/&gt;
        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:603)&lt;br/&gt;
        at java.lang.Thread.run(Thread.java:636)&lt;br/&gt;
Caused by: java.io.EOFException&lt;br/&gt;
        at java.io.RandomAccessFile.readFully(RandomAccessFile.java:416)&lt;br/&gt;
        at java.io.RandomAccessFile.readFully(RandomAccessFile.java:394)&lt;br/&gt;
        at org.apache.cassandra.io.util.BufferedRandomAccessFile.readBytes(BufferedRandomAccessFile.java:268)&lt;br/&gt;
        at org.apache.cassandra.utils.ByteBufferUtil.read(ByteBufferUtil.java:310)&lt;br/&gt;
        at org.apache.cassandra.utils.ByteBufferUtil.readWithShortLength(ByteBufferUtil.java:284)&lt;br/&gt;
        at org.apache.cassandra.db.CompactionManager.doScrub(CompactionManager.java:540)&lt;br/&gt;
        at org.apache.cassandra.db.CompactionManager.access$600(CompactionManager.java:55)&lt;br/&gt;
        at org.apache.cassandra.db.CompactionManager$3.call(CompactionManager.java:194)&lt;br/&gt;
        at java.util.concurrent.FutureTask$Sync.innerRun(FutureTask.java:334)&lt;br/&gt;
        at java.util.concurrent.FutureTask.run(FutureTask.java:166)&lt;br/&gt;
        ... 3 more&lt;/p&gt;
</comment>
                            <comment id="13000162" author="kunda" created="Mon, 28 Feb 2011 08:01:16 +0000"  >&lt;p&gt;Attached a system log leading up to a &quot;java.io.EOFException: attempted to skip X bytes but only skipped Y&quot; error during a scrub of a very big (probably uncompactable) sstable&lt;/p&gt;</comment>
                            <comment id="13000166" author="kunda" created="Mon, 28 Feb 2011 08:07:13 +0000"  >&lt;p&gt;another system log, this time leading to a vanilla java.io.EOFException&lt;/p&gt;</comment>
                            <comment id="13000522" author="jbellis" created="Mon, 28 Feb 2011 21:25:41 +0000"  >&lt;p&gt;Looked at userChannelFilter-f-210.tar.gz.  Data file does not match index even a little.  Scrub can&apos;t help there.&lt;/p&gt;</comment>
                            <comment id="13000538" author="wajam" created="Mon, 28 Feb 2011 21:41:05 +0000"  >&lt;p&gt;I have a 71MB SS table that scrub fail to fix so maybe you would be interested in having it ? There is private data in there so I could upload it somewhere so only you can download it. Let me know how we can work together.&lt;/p&gt;

&lt;p&gt;Thank you!&lt;/p&gt;</comment>
                            <comment id="13000600" author="jbellis" created="Mon, 28 Feb 2011 23:16:57 +0000"  >&lt;p&gt;Patch to make scrub less crashy.  It still can&apos;t magically fix severely corrupted files like the exhibits here, though.&lt;/p&gt;</comment>
                            <comment id="13000602" author="jbellis" created="Mon, 28 Feb 2011 23:19:38 +0000"  >&lt;p&gt;Sebastien, go ahead and try scrub after rebuilding w/ the newest patch.&lt;/p&gt;

&lt;p&gt;But if your example is like the others, you&apos;re seeing something other than the &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-2211&quot; title=&quot;Cleanup can create sstables whose contents do not match their advertised version&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-2211&quot;&gt;&lt;del&gt;CASSANDRA-2211&lt;/del&gt;&lt;/a&gt;/&lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-2216&quot; title=&quot;Compaction can echo data which breaks upon sstable format changes&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-2216&quot;&gt;&lt;del&gt;CASSANDRA-2216&lt;/del&gt;&lt;/a&gt; corruption that scrub is intended to deal with.&lt;/p&gt;

&lt;p&gt;So far the only suggestion I have to track that down is to start over and run with snapshot_before_compaction turned on in cassandra.yaml, so when a corrupt sstable is generated we will know where it came from.&lt;/p&gt;</comment>
                            <comment id="13000635" author="wajam" created="Tue, 1 Mar 2011 00:57:27 +0000"  >&lt;p&gt;Jonathan,&lt;/p&gt;

&lt;p&gt;I&apos;m pretty positive I&apos;m running into &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-2216&quot; title=&quot;Compaction can echo data which breaks upon sstable format changes&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-2216&quot;&gt;&lt;del&gt;CASSANDRA-2216&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;Applied the patch and still having the same exception, maybe this is related to &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-2256&quot; title=&quot;BRAF assertion error&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-2256&quot;&gt;&lt;del&gt;CASSANDRA-2256&lt;/del&gt;&lt;/a&gt; ?&lt;/p&gt;

&lt;p&gt;ERROR 00:51:55,214 Fatal exception in thread Thread&lt;span class=&quot;error&quot;&gt;&amp;#91;CompactionExecutor:1,1,main&amp;#93;&lt;/span&gt;&lt;br/&gt;
java.io.EOFException&lt;br/&gt;
        at java.io.RandomAccessFile.readFully(RandomAccessFile.java:416)&lt;br/&gt;
        at java.io.RandomAccessFile.readFully(RandomAccessFile.java:394)&lt;br/&gt;
        at org.apache.cassandra.io.util.BufferedRandomAccessFile.readBytes(BufferedRandomAccessFile.java:268)&lt;br/&gt;
        at org.apache.cassandra.utils.ByteBufferUtil.read(ByteBufferUtil.java:310)&lt;br/&gt;
        at org.apache.cassandra.utils.ByteBufferUtil.readWithShortLength(ByteBufferUtil.java:284)&lt;br/&gt;
        at org.apache.cassandra.db.CompactionManager.doScrub(CompactionManager.java:541)&lt;br/&gt;
        at org.apache.cassandra.db.CompactionManager.access$600(CompactionManager.java:56)&lt;br/&gt;
        at org.apache.cassandra.db.CompactionManager$3.call(CompactionManager.java:195)&lt;br/&gt;
        at java.util.concurrent.FutureTask$Sync.innerRun(FutureTask.java:334)&lt;br/&gt;
        at java.util.concurrent.FutureTask.run(FutureTask.java:166)&lt;br/&gt;
        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1110)&lt;br/&gt;
        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:603)&lt;br/&gt;
        at java.lang.Thread.run(Thread.java:636)&lt;/p&gt;
</comment>
                            <comment id="13000671" author="jbellis" created="Tue, 1 Mar 2011 02:49:57 +0000"  >&lt;p&gt;2211/2216 would leave valid row keys written, which is where yours is corrupt.  That is why I think this is something else.&lt;/p&gt;

&lt;p&gt;Here is a v2 though that will catch the error and try the next row from the index.&lt;/p&gt;</comment>
                            <comment id="13000691" author="wajam" created="Tue, 1 Mar 2011 03:58:34 +0000"  >
&lt;p&gt;Now it seems to hang for a while on a 1.4GB sstable. Eventually I get this exception...&lt;/p&gt;

&lt;p&gt;ERROR 03:56:29,413 Fatal exception in thread Thread&lt;span class=&quot;error&quot;&gt;&amp;#91;CompactionExecutor:1,1,main&amp;#93;&lt;/span&gt;&lt;br/&gt;
java.lang.NullPointerException&lt;br/&gt;
        at org.apache.cassandra.db.CompactionManager.doScrub(CompactionManager.java:569)&lt;br/&gt;
        at org.apache.cassandra.db.CompactionManager.access$600(CompactionManager.java:56)&lt;br/&gt;
        at org.apache.cassandra.db.CompactionManager$3.call(CompactionManager.java:195)&lt;br/&gt;
        at java.util.concurrent.FutureTask$Sync.innerRun(FutureTask.java:334)&lt;br/&gt;
        at java.util.concurrent.FutureTask.run(FutureTask.java:166)&lt;br/&gt;
        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1110)&lt;br/&gt;
        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:603)&lt;br/&gt;
        at java.lang.Thread.run(Thread.java:636)&lt;/p&gt;</comment>
                            <comment id="13000696" author="wajam" created="Tue, 1 Mar 2011 04:18:29 +0000"  >&lt;p&gt;Looking at the data directory, it looks like it was working as excepted before the exception happened. The tmp SStable is 1.0GB... Looks like we are getting close!&lt;/p&gt;</comment>
                            <comment id="13000716" author="jbellis" created="Tue, 1 Mar 2011 04:45:19 +0000"  >&lt;p&gt;v3 adds support for the index file ending before the data file&lt;/p&gt;</comment>
                            <comment id="13000718" author="wajam" created="Tue, 1 Mar 2011 04:57:03 +0000"  >&lt;p&gt;I will try v3 soon and let you know. While looking at the patch, I found a typo:&lt;/p&gt;

&lt;p&gt;logger.warn(&quot;No valid rows found while scrubbing &quot; + sstable + &quot;; it is marked for deltion now. If you want to attempt manual recovery, you can find a copy in the pre-scrub snapshot&quot;);&lt;/p&gt;

&lt;p&gt;Should be &quot;deletion&quot; instead of &quot;deltion&quot;... no big deal &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="13000720" author="wajam" created="Tue, 1 Mar 2011 05:02:12 +0000"  >&lt;p&gt;Now I&apos;m getting this:&lt;/p&gt;

&lt;p&gt;ERROR 04:58:53,338 Error reading index file.  Scrub does not (yet) know how to recover from corrupt index files; you can try rebuilding it offline.  See &lt;a href=&quot;http://www.mail-archive.com/user@cassandra.apache.org/msg03325.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://www.mail-archive.com/user@cassandra.apache.org/msg03325.html&lt;/a&gt;&lt;br/&gt;
ERROR 04:58:53,338 Fatal exception in thread Thread&lt;span class=&quot;error&quot;&gt;&amp;#91;CompactionExecutor:1,1,main&amp;#93;&lt;/span&gt;&lt;br/&gt;
java.lang.RuntimeException: java.io.EOFException&lt;br/&gt;
        at org.apache.cassandra.db.CompactionManager.doScrub(CompactionManager.java:565)&lt;br/&gt;
        at org.apache.cassandra.db.CompactionManager.access$600(CompactionManager.java:56)&lt;br/&gt;
        at org.apache.cassandra.db.CompactionManager$3.call(CompactionManager.java:195)&lt;br/&gt;
        at java.util.concurrent.FutureTask$Sync.innerRun(FutureTask.java:334)&lt;br/&gt;
        at java.util.concurrent.FutureTask.run(FutureTask.java:166)&lt;br/&gt;
        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1110)&lt;br/&gt;
        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:603)&lt;br/&gt;
        at java.lang.Thread.run(Thread.java:636)&lt;br/&gt;
Caused by: java.io.EOFException&lt;br/&gt;
        at java.io.RandomAccessFile.readFully(RandomAccessFile.java:416)&lt;br/&gt;
        at java.io.RandomAccessFile.readFully(RandomAccessFile.java:394)&lt;br/&gt;
        at org.apache.cassandra.io.util.BufferedRandomAccessFile.readBytes(BufferedRandomAccessFile.java:268)&lt;br/&gt;
        at org.apache.cassandra.utils.ByteBufferUtil.read(ByteBufferUtil.java:310)&lt;br/&gt;
        at org.apache.cassandra.utils.ByteBufferUtil.readWithShortLength(ByteBufferUtil.java:284)&lt;br/&gt;
        at org.apache.cassandra.db.CompactionManager.doScrub(CompactionManager.java:559)&lt;br/&gt;
        ... 7 more&lt;/p&gt;

&lt;p&gt;And&lt;/p&gt;

&lt;p&gt;root@WajamCassandra12:/usr/share/cassandra# nodetool -h 127.0.0.1 scrub Wajam Wajam&lt;br/&gt;
Error occured while scrubbing keyspace Wajam&lt;br/&gt;
java.util.concurrent.ExecutionException: java.lang.RuntimeException: java.io.EOFException&lt;br/&gt;
        at java.util.concurrent.FutureTask$Sync.innerGet(FutureTask.java:252)&lt;br/&gt;
        at java.util.concurrent.FutureTask.get(FutureTask.java:111)&lt;br/&gt;
        at org.apache.cassandra.db.CompactionManager.performScrub(CompactionManager.java:204)&lt;br/&gt;
        at org.apache.cassandra.db.ColumnFamilyStore.scrub(ColumnFamilyStore.java:963)&lt;br/&gt;
        at org.apache.cassandra.service.StorageService.scrub(StorageService.java:1247)&lt;br/&gt;
        at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)&lt;br/&gt;
        at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:57)&lt;br/&gt;
        at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)&lt;br/&gt;
        at java.lang.reflect.Method.invoke(Method.java:616)&lt;br/&gt;
        at com.sun.jmx.mbeanserver.StandardMBeanIntrospector.invokeM2(StandardMBeanIntrospector.java:111)&lt;br/&gt;
        at com.sun.jmx.mbeanserver.StandardMBeanIntrospector.invokeM2(StandardMBeanIntrospector.java:45)&lt;br/&gt;
        at com.sun.jmx.mbeanserver.MBeanIntrospector.invokeM(MBeanIntrospector.java:226)&lt;br/&gt;
        at com.sun.jmx.mbeanserver.PerInterface.invoke(PerInterface.java:138)&lt;br/&gt;
        at com.sun.jmx.mbeanserver.MBeanSupport.invoke(MBeanSupport.java:251)&lt;br/&gt;
        at com.sun.jmx.interceptor.DefaultMBeanServerInterceptor.invoke(DefaultMBeanServerInterceptor.java:857)&lt;br/&gt;
        at com.sun.jmx.mbeanserver.JmxMBeanServer.invoke(JmxMBeanServer.java:795)&lt;br/&gt;
        at javax.management.remote.rmi.RMIConnectionImpl.doOperation(RMIConnectionImpl.java:1450)&lt;br/&gt;
        at javax.management.remote.rmi.RMIConnectionImpl.access$200(RMIConnectionImpl.java:90)&lt;br/&gt;
        at javax.management.remote.rmi.RMIConnectionImpl$PrivilegedOperation.run(RMIConnectionImpl.java:1285)&lt;br/&gt;
        at javax.management.remote.rmi.RMIConnectionImpl.doPrivilegedOperation(RMIConnectionImpl.java:1383)&lt;br/&gt;
        at javax.management.remote.rmi.RMIConnectionImpl.invoke(RMIConnectionImpl.java:807)&lt;br/&gt;
        at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)&lt;br/&gt;
        at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:57)&lt;br/&gt;
        at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)&lt;br/&gt;
        at java.lang.reflect.Method.invoke(Method.java:616)&lt;br/&gt;
        at sun.rmi.server.UnicastServerRef.dispatch(UnicastServerRef.java:322)&lt;br/&gt;
        at sun.rmi.transport.Transport$1.run(Transport.java:177)&lt;br/&gt;
        at java.security.AccessController.doPrivileged(Native Method)&lt;br/&gt;
        at sun.rmi.transport.Transport.serviceCall(Transport.java:173)&lt;br/&gt;
        at sun.rmi.transport.tcp.TCPTransport.handleMessages(TCPTransport.java:553)&lt;br/&gt;
        at sun.rmi.transport.tcp.TCPTransport$ConnectionHandler.run0(TCPTransport.java:808)&lt;br/&gt;
        at sun.rmi.transport.tcp.TCPTransport$ConnectionHandler.run(TCPTransport.java:667)&lt;br/&gt;
        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1110)&lt;br/&gt;
        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:603)&lt;br/&gt;
        at java.lang.Thread.run(Thread.java:636)&lt;br/&gt;
Caused by: java.lang.RuntimeException: java.io.EOFException&lt;br/&gt;
        at org.apache.cassandra.db.CompactionManager.doScrub(CompactionManager.java:565)&lt;br/&gt;
        at org.apache.cassandra.db.CompactionManager.access$600(CompactionManager.java:56)&lt;br/&gt;
        at org.apache.cassandra.db.CompactionManager$3.call(CompactionManager.java:195)&lt;br/&gt;
        at java.util.concurrent.FutureTask$Sync.innerRun(FutureTask.java:334)&lt;br/&gt;
        at java.util.concurrent.FutureTask.run(FutureTask.java:166)&lt;br/&gt;
        ... 3 more&lt;br/&gt;
Caused by: java.io.EOFException&lt;br/&gt;
        at java.io.RandomAccessFile.readFully(RandomAccessFile.java:416)&lt;br/&gt;
        at java.io.RandomAccessFile.readFully(RandomAccessFile.java:394)&lt;br/&gt;
        at org.apache.cassandra.io.util.BufferedRandomAccessFile.readBytes(BufferedRandomAccessFile.java:268)&lt;br/&gt;
        at org.apache.cassandra.utils.ByteBufferUtil.read(ByteBufferUtil.java:310)&lt;br/&gt;
        at org.apache.cassandra.utils.ByteBufferUtil.readWithShortLength(ByteBufferUtil.java:284)&lt;br/&gt;
        at org.apache.cassandra.db.CompactionManager.doScrub(CompactionManager.java:559)&lt;br/&gt;
        ... 7 more&lt;/p&gt;</comment>
                            <comment id="13000728" author="jbellis" created="Tue, 1 Mar 2011 05:30:34 +0000"  >&lt;p&gt;v4 attached.  (might be my last for the night; getting late here.  but I&apos;ll check back first thing in the morning)&lt;/p&gt;</comment>
                            <comment id="13000732" author="wajam" created="Tue, 1 Mar 2011 05:51:01 +0000"  >&lt;p&gt;Scrub is running with v4 right now, we will see what happen, no exception so far. There is these things being displayed about fifty millions time in the log tho&lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; :&lt;/p&gt;

&lt;p&gt; INFO 05:33:29,521 Invalid row summary in SSTableReader(path=&apos;/var/lib/cassandra/data/Wajam/WebsiteWajams-f-146-Data.db&apos;); will rebuild it&lt;br/&gt;
 INFO 05:33:29,548 Invalid bloom filter in SSTableReader(path=&apos;/var/lib/cassandra/data/Wajam/WebsiteWajams-f-146-Data.db&apos;); will rebuild it&lt;br/&gt;
 INFO 05:33:29,859 Invalid row summary in SSTableReader(path=&apos;/var/lib/cassandra/data/Wajam/WebsiteWajams-f-146-Data.db&apos;); will rebuild it&lt;br/&gt;
 INFO 05:33:29,882 Invalid bloom filter in SSTableReader(path=&apos;/var/lib/cassandra/data/Wajam/WebsiteWajams-f-146-Data.db&apos;); will rebuild it&lt;br/&gt;
 INFO 05:33:31,223 Invalid row summary in SSTableReader(path=&apos;/var/lib/cassandra/data/Wajam/WebsiteWajams-f-146-Data.db&apos;); will rebuild it&lt;br/&gt;
 INFO 05:33:31,249 Invalid bloom filter in SSTableReader(path=&apos;/var/lib/cassandra/data/Wajam/WebsiteWajams-f-146-Data.db&apos;); will rebuild it&lt;br/&gt;
 INFO 05:33:31,644 Invalid row summary in SSTableReader(path=&apos;/var/lib/cassandra/data/Wajam/WebsiteWajams-f-146-Data.db&apos;); will rebuild it&lt;br/&gt;
 INFO 05:33:31,678 Invalid bloom filter in SSTableReader(path=&apos;/var/lib/cassandra/data/Wajam/WebsiteWajams-f-146-Data.db&apos;); will rebuild it&lt;br/&gt;
 INFO 05:33:32,102 Invalid row summary in SSTableReader(path=&apos;/var/lib/cassandra/data/Wajam/WebsiteWajams-f-146-Data.db&apos;); will rebuild it&lt;br/&gt;
 INFO 05:33:32,129 Invalid bloom filter in SSTableReader(path=&apos;/var/lib/cassandra/data/Wajam/WebsiteWajams-f-146-Data.db&apos;); will rebuild it&lt;br/&gt;
 INFO 05:33:32,393 Invalid row summary in SSTableReader(path=&apos;/var/lib/cassandra/data/Wajam/WebsiteWajams-f-146-Data.db&apos;); will rebuild it&lt;br/&gt;
 INFO 05:33:32,425 Invalid bloom filter in SSTableReader(path=&apos;/var/lib/cassandra/data/Wajam/WebsiteWajams-f-146-Data.db&apos;); will rebuild it&lt;br/&gt;
 INFO 05:33:32,713 Invalid row summary in SSTableReader(path=&apos;/var/lib/cassandra/data/Wajam/WebsiteWajams-f-146-Data.db&apos;); will rebuild it&lt;br/&gt;
 INFO 05:33:32,734 Invalid bloom filter in SSTableReader(path=&apos;/var/lib/cassandra/data/Wajam/WebsiteWajams-f-146-Data.db&apos;); will rebuild it&lt;br/&gt;
 INFO 05:33:33,004 Invalid row summary in SSTableReader(path=&apos;/var/lib/cassandra/data/Wajam/WebsiteWajams-f-146-Data.db&apos;); will rebuild it&lt;br/&gt;
 INFO 05:33:33,031 Invalid bloom filter in SSTableReader(path=&apos;/var/lib/cassandra/data/Wajam/WebsiteWajams-f-146-Data.db&apos;); will rebuild it&lt;br/&gt;
 INFO 05:33:33,305 Invalid row summary in SSTableReader(path=&apos;/var/lib/cassandra/data/Wajam/WebsiteWajams-f-146-Data.db&apos;); will rebuild it&lt;br/&gt;
 INFO 05:33:33,331 Invalid bloom filter in SSTableReader(path=&apos;/var/lib/cassandra/data/Wajam/WebsiteWajams-f-146-Data.db&apos;); will rebuild it&lt;br/&gt;
 INFO 05:33:33,599 Invalid row summary in SSTableReader(path=&apos;/var/lib/cassandra/data/Wajam/WebsiteWajams-f-146-Data.db&apos;); will rebuild it&lt;br/&gt;
 INFO 05:33:33,623 Invalid bloom filter in SSTableReader(path=&apos;/var/lib/cassandra/data/Wajam/WebsiteWajams-f-146-Data.db&apos;); will rebuild it&lt;br/&gt;
 INFO 05:33:33,897 Invalid row summary in SSTableReader(path=&apos;/var/lib/cassandra/data/Wajam/WebsiteWajams-f-146-Data.db&apos;); will rebuild it&lt;br/&gt;
 INFO 05:33:33,917 Invalid bloom filter in SSTableReader(path=&apos;/var/lib/cassandra/data/Wajam/WebsiteWajams-f-146-Data.db&apos;); will rebuild it&lt;br/&gt;
 INFO 05:33:34,330 Invalid row summary in SSTableReader(path=&apos;/var/lib/cassandra/data/Wajam/WebsiteWajams-f-146-Data.db&apos;); will rebuild it&lt;br/&gt;
 INFO 05:33:34,375 Invalid bloom filter in SSTableReader(path=&apos;/var/lib/cassandra/data/Wajam/WebsiteWajams-f-146-Data.db&apos;); will rebuild it&lt;br/&gt;
 INFO 05:33:35,504 Invalid row summary in SSTableReader(path=&apos;/var/lib/cassandra/data/Wajam/WebsiteWajams-f-146-Data.db&apos;); will rebuild it&lt;br/&gt;
 INFO 05:33:35,525 Invalid bloom filter in SSTableReader(path=&apos;/var/lib/cassandra/data/Wajam/WebsiteWajams-f-146-Data.db&apos;); will rebuild it&lt;br/&gt;
 INFO 05:33:35,933 Invalid row summary in SSTableReader(path=&apos;/var/lib/cassandra/data/Wajam/WebsiteWajams-f-146-Data.db&apos;); will rebuild it&lt;/p&gt;

&lt;p&gt;Either way, as long as it fix my ss table I will be happy &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; I will let you know in the morning if there is any more issue&lt;/p&gt;

&lt;p&gt;Thank you!&lt;/p&gt;</comment>
                            <comment id="13000868" author="slebresne" created="Tue, 1 Mar 2011 13:22:16 +0000"  >&lt;p&gt;Stepping in while Jonathan takes some well deserved rest and attaching v5 (based on last version attached). This makes the following changes:&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;In doScrub(), move the first indexFile.readLong() out of the assert.&lt;/li&gt;
	&lt;li&gt;Fix computation of dataStartFromIndex (was missing th 4 or 8 bytes for the data size).&lt;/li&gt;
	&lt;li&gt;IndexHelper.defreezeBloomFilter don&apos;t leave the file pointer after the bloomFilter for new BF since it reads directly from the file (instead of reading the bytes at once and deserializing from that). Correct this.&lt;/li&gt;
	&lt;li&gt;Log if a row has been correctly read the first time but index start and size are different from data start and size (since index should then be manually rebuilt).&lt;/li&gt;
	&lt;li&gt;Do a retry if dataStart == dataStartFromIndex but dataSize != dataSizeFromIndex (in case the row size only has been corrupted).&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Lastly, a minor remarks: the patch removes a flush in BF.serialize(). Maybe this belongs to another ticket ?&lt;/p&gt;</comment>
                            <comment id="13000873" author="wajam" created="Tue, 1 Mar 2011 13:42:02 +0000"  >&lt;p&gt;Thank you Sylvain&lt;/p&gt;

&lt;p&gt;Unfortunatly, i&apos;m unable to apply v5 patch for some reason, is it a svn or git patch ?&lt;/p&gt;</comment>
                            <comment id="13000880" author="slebresne" created="Tue, 1 Mar 2011 13:57:13 +0000"  >&lt;p&gt;It&apos;s a git patch, git apply or &apos;patch -p1 -i 2240-v5.patch&apos; should do the trick (it does here). It&apos;s based on current cassandra-0.7 branch. &lt;/p&gt;</comment>
                            <comment id="13000893" author="jbellis" created="Tue, 1 Mar 2011 14:46:08 +0000"  >&lt;p&gt;v6 applies Sylvain&apos;s fixes to v4 (which mysteriously disappeared from jira)&lt;/p&gt;</comment>
                            <comment id="13000894" author="jbellis" created="Tue, 1 Mar 2011 14:46:52 +0000"  >&lt;p&gt;I also backed out the read-directly-from-file change in IndexHelper.  Will create a new ticket for that.&lt;/p&gt;</comment>
                            <comment id="13000895" author="wajam" created="Tue, 1 Mar 2011 14:47:07 +0000"  >&lt;p&gt;Yep, that worked. So it&apos;s currently running with your patch, and so far I get no output from scrub after running for like 5 mins, I usually get the &quot;Scrubbing SSTABLE&quot; in the first min so I&apos;m not sure if that&apos;s normal. There is the &quot;tmp&quot; files in the data directory but looks like they are stuck at 0 byte.&lt;/p&gt;

&lt;p&gt;Oh, looks like I will try v6 now then!&lt;/p&gt;

&lt;p&gt;Jonathan, v4 is there, you named it 2240.txt &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="13000898" author="jbellis" created="Tue, 1 Mar 2011 15:00:05 +0000"  >&lt;blockquote&gt;&lt;p&gt;v4 is there, you named it 2240.txt&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Oops &amp;#8211; that was the original patch, not actually v4.  Must have been tired.&lt;/p&gt;</comment>
                            <comment id="13000916" author="slebresne" created="Tue, 1 Mar 2011 15:28:51 +0000"  >&lt;p&gt;Alright, v6 looks good, +1. Though, we may want to wait to see if it works alright for Sebastien too.&lt;/p&gt;</comment>
                            <comment id="13000920" author="wajam" created="Tue, 1 Mar 2011 15:36:01 +0000"  >&lt;p&gt;I&apos;m testing it as we speak!&lt;/p&gt;

&lt;p&gt;Log are flooded with this:&lt;/p&gt;

&lt;p&gt; INFO 15:31:15,783 Invalid bloom filter in SSTableReader(path=&apos;/var/lib/cassandra/data/Wajam/WebsiteWajams-f-164-Data.db&apos;); will rebuild it&lt;br/&gt;
 INFO 15:31:15,783 Invalid bloom filter in SSTableReader(path=&apos;/var/lib/cassandra/data/Wajam/WebsiteWajams-f-164-Data.db&apos;); will rebuild it&lt;br/&gt;
 INFO 15:31:15,783 Invalid bloom filter in SSTableReader(path=&apos;/var/lib/cassandra/data/Wajam/WebsiteWajams-f-164-Data.db&apos;); will rebuild it&lt;br/&gt;
 INFO 15:31:15,783 Invalid bloom filter in SSTableReader(path=&apos;/var/lib/cassandra/data/Wajam/WebsiteWajams-f-164-Data.db&apos;); will rebuild it&lt;/p&gt;

&lt;p&gt;I&apos;m not sure why it&apos;s scrubbing &quot;WebsiteWajams&quot; CF as I asked for &quot;Wajam&quot; (nodetool -h 127.0.0.1 scrub Wajam Wajam) ... Either way, this sstable is messed up too so that&apos;s fine.&lt;/p&gt;

&lt;p&gt;Hopefully it won&apos;t just do like v4 that ran all night and was still echoing invalid bloom filter for the same sstable in the log this morning, Looks like it was stuck in a infinite loop or something.&lt;/p&gt;

&lt;p&gt;It looks like it&apos;s scrubbing another sstable now so that&apos;s already an improvment.&lt;/p&gt;

&lt;p&gt;Will keep you guys updated!&lt;/p&gt;

</comment>
                            <comment id="13000923" author="wajam" created="Tue, 1 Mar 2011 15:48:53 +0000"  >&lt;p&gt; INFO 15:42:52,690 Scrub of SSTableReader(path=&apos;/var/lib/cassandra/data/Wajam/WebsiteWajams-f-155-Data.db&apos;) complete: 3271113 in new sstable&lt;/p&gt;

&lt;p&gt;&quot;3271113 in new sstable&quot;... I&apos;m not sure it&apos;s 3271113 what... Looks like &quot;good rows&quot; according to the patch, might want to specify! &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;I think it&apos;s the first time I see this line tho so it&apos;s good news. Is there any way the &quot;invalid bloom filter, will rebuild it&quot; line can only appear once per sstable ? I&apos;m guessing its generating useless IO writing about 1000 of those lines/second in the log!&lt;/p&gt;

&lt;p&gt;This should be definitly included in 0.7.3 which hopefully will be released soon!&lt;/p&gt;

&lt;p&gt;Good work guys, very appreciated &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="13000931" author="wajam" created="Tue, 1 Mar 2011 16:10:17 +0000"  >&lt;p&gt;I did see a few exceptions every now and then. Not sure if you need to do anything about this. Sorry for all these posts, hopefully it help &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;:&lt;/p&gt;

&lt;p&gt;224574- INFO 16:06:40,744 Retrying from row index; data is 245642090 bytes starting at 42&lt;br/&gt;
224657- WARN 16:06:40,744 Retry failed too.  Skipping to next row (retry&apos;s stacktrace follows)&lt;br/&gt;
224745-java.io.IOError: java.io.EOFException&lt;br/&gt;
224783- at org.apache.cassandra.io.sstable.SSTableIdentityIterator.&amp;lt;init&amp;gt;(SSTableIdentityIterator.java:117)&lt;br/&gt;
224884: at org.apache.cassandra.db.CompactionManager.doScrub(CompactionManager.java:610)&lt;br/&gt;
224966- at org.apache.cassandra.db.CompactionManager.access$600(CompactionManager.java:56)&lt;br/&gt;
225050- at org.apache.cassandra.db.CompactionManager$3.call(CompactionManager.java:195)&lt;br/&gt;
225131- at java.util.concurrent.FutureTask$Sync.innerRun(FutureTask.java:334)&lt;br/&gt;
225202- at java.util.concurrent.FutureTask.run(FutureTask.java:166)&lt;br/&gt;
225263- at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1110)&lt;br/&gt;
225347- at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:603)&lt;br/&gt;
225431- at java.lang.Thread.run(Thread.java:636)&lt;br/&gt;
225473-Caused by: java.io.EOFException&lt;br/&gt;
225505- at java.io.DataInputStream.readInt(DataInputStream.java:392)&lt;br/&gt;
225567- at org.apache.cassandra.utils.BloomFilterSerializer.deserialize(BloomFilterSerializer.java:47)&lt;/p&gt;</comment>
                            <comment id="13000932" author="jbellis" created="Tue, 1 Mar 2011 16:10:31 +0000"  >&lt;p&gt;committed w/ update to goodRows message and moving the BF/row header messages to debug level&lt;/p&gt;

&lt;p&gt;thanks!&lt;/p&gt;</comment>
                            <comment id="13000935" author="jbellis" created="Tue, 1 Mar 2011 16:14:37 +0000"  >&lt;blockquote&gt;&lt;p&gt;I did see a few exceptions every now and then&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Did you see any &quot;Error reading index file&quot; lines before that?  That&apos;s the only way I can think that it would come up with such a strange row size.&lt;/p&gt;</comment>
                            <comment id="13000938" author="wajam" created="Tue, 1 Mar 2011 16:22:00 +0000"  >&lt;p&gt;Yep I did see error reading index file before that.&lt;/p&gt;

&lt;p&gt;Any chance to include this in 0.7.3 release ? I&apos;m sure it would help a ton of people &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="13000944" author="jbellis" created="Tue, 1 Mar 2011 16:30:43 +0000"  >&lt;p&gt;Yes, we&apos;ll get this into 0.7.3.&lt;/p&gt;</comment>
                            <comment id="13000953" author="hudson" created="Tue, 1 Mar 2011 16:53:37 +0000"  >&lt;p&gt;Integrated in Cassandra-0.7 #336 (See &lt;a href=&quot;https://hudson.apache.org/hudson/job/Cassandra-0.7/336/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://hudson.apache.org/hudson/job/Cassandra-0.7/336/&lt;/a&gt;)&lt;br/&gt;
    make nodetool scrub more robust&lt;br/&gt;
patch by jbellis and slebresne; tested by S&#233;bastien Giroux for &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-2240&quot; title=&quot;nodetool scrub hangs or throws an exception&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-2240&quot;&gt;&lt;del&gt;CASSANDRA-2240&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13001088" author="kunda" created="Tue, 1 Mar 2011 20:15:08 +0000"  >&lt;p&gt;Thank you so much, my sstables are finally clean!&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12499367">CASSANDRA-2217</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12472270" name="2240-v2.txt" size="15062" author="jbellis" created="Tue, 1 Mar 2011 02:49:57 +0000"/>
                            <attachment id="12472278" name="2240-v3.txt" size="15519" author="jbellis" created="Tue, 1 Mar 2011 04:45:19 +0000"/>
                            <attachment id="12472305" name="2240-v5.patch" size="17724" author="slebresne" created="Tue, 1 Mar 2011 13:22:15 +0000"/>
                            <attachment id="12472313" name="2240-v6.txt" size="13802" author="jbellis" created="Tue, 1 Mar 2011 14:46:08 +0000"/>
                            <attachment id="12472279" name="2240.txt" size="12394" author="jbellis" created="Tue, 1 Mar 2011 05:30:34 +0000"/>
                            <attachment id="12472250" name="2240.txt" size="12394" author="jbellis" created="Mon, 28 Feb 2011 23:16:57 +0000"/>
                            <attachment id="12472102" name="exception2.txt" size="1907" author="kunda" created="Sun, 27 Feb 2011 10:44:31 +0000"/>
                            <attachment id="12472100" name="jstack1.txt" size="12113" author="kunda" created="Sun, 27 Feb 2011 10:34:29 +0000"/>
                            <attachment id="12472101" name="signatureBuckets-f-104.tar.gz" size="2817415" author="kunda" created="Sun, 27 Feb 2011 10:34:29 +0000"/>
                            <attachment id="12472152" name="system.log.2.gz" size="17025" author="kunda" created="Mon, 28 Feb 2011 08:07:13 +0000"/>
                            <attachment id="12472151" name="system.log.gz" size="103625" author="kunda" created="Mon, 28 Feb 2011 08:01:16 +0000"/>
                            <attachment id="12471844" name="test-0.6.x-tables.tar.gz" size="388" author="kunda" created="Thu, 24 Feb 2011 15:41:48 +0000"/>
                            <attachment id="12472103" name="userChannelFilter-f-210.tar.gz" size="1041" author="kunda" created="Sun, 27 Feb 2011 10:44:31 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>13.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[jbellis]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>20521</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            14 years, 39 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0ga6v:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>93081</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>slebresne</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[slebresne]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12962"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>