<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 23:09:54 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-13813] Don&apos;t let user drop (or generally break) tables in system_distributed</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-13813</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;There is not currently no particular restrictions on schema modifications to tables of the &lt;tt&gt;system_distributed&lt;/tt&gt; keyspace. This does mean you can drop those tables, or even alter them in wrong ways like dropping or renaming columns. All of which is guaranteed to break stuffs (that is, repair if you mess up with on of it&apos;s table, or MVs if you mess up with &lt;tt&gt;view_build_status&lt;/tt&gt;).&lt;/p&gt;

&lt;p&gt;I&apos;m pretty sure this was never intended and is an oversight of the condition on &lt;tt&gt;ALTERABLE_SYSTEM_KEYSPACES&lt;/tt&gt; in &lt;a href=&quot;https://github.com/apache/cassandra/blob/trunk/src/java/org/apache/cassandra/service/ClientState.java#L397&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;ClientState&lt;/a&gt;. That condition is such that any keyspace not listed in &lt;tt&gt;ALTERABLE_SYSTEM_KEYSPACES&lt;/tt&gt; (which happens to be the case for &lt;tt&gt;system_distributed&lt;/tt&gt;) has no specific restrictions whatsoever, while given the naming it&apos;s fair to assume the intention that exactly the opposite.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13097898">CASSANDRA-13813</key>
            <summary>Don&apos;t let user drop (or generally break) tables in system_distributed</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10002" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Normal</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="aleksey">Aleksey Yeschenko</assignee>
                                    <reporter username="slebresne">Sylvain Lebresne</reporter>
                        <labels>
                    </labels>
                <created>Mon, 28 Aug 2017 07:25:40 +0000</created>
                <updated>Tue, 14 Oct 2025 12:13:58 +0000</updated>
                            <resolved>Tue, 17 Oct 2017 12:44:32 +0000</resolved>
                                        <fixVersion>3.0.16</fixVersion>
                    <fixVersion>3.11.2</fixVersion>
                                    <component>Legacy/Distributed Metadata</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>10</watches>
                                                                                                                <comments>
                            <comment id="16145105" author="iamaleksey" created="Tue, 29 Aug 2017 10:53:06 +0000"  >&lt;p&gt;The reason it isn&apos;t listed is because we want to allow changing the replication strategy/factor on those keyspaces themselves.&lt;/p&gt;

&lt;p&gt;It&apos;s just that it&apos;s been implemented sub-diligently. So we want reject any changes to the tables (including dropping them), reject dropping of those keyspaces, but allow altering keyspace params. Also reject: creating of new tables in those keyspaces.&lt;/p&gt;</comment>
                            <comment id="16145207" author="slebresne" created="Tue, 29 Aug 2017 12:31:30 +0000"  >&lt;blockquote&gt;&lt;p&gt;The reason it isn&apos;t listed is because we want to allow changing the replication strategy/factor on those keyspaces themselves.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;The name of the set makes it clear what the &lt;em&gt;intention&lt;/em&gt; was. What I&apos;m saying is that the code doesn&apos;t implement that intention. Currently, you can alter the replication strategy/factor of &lt;em&gt;all&lt;/em&gt; system distributed keyspace, even &lt;tt&gt;system_distributed&lt;/tt&gt;, and I&apos;m reasonably convinced that wasn&apos;t the intention. This certainly isn&apos;t hard to fix though.&lt;/p&gt;

&lt;p&gt;Now with that said, I  happen to not particularly see a terribly good reason to limit which of the system distributed keyspace can have their strategy/factor changed (and again, despite the original code intention, we currently &lt;em&gt;don&apos;t&lt;/em&gt; have such limit), so instead of simply making the check on &lt;tt&gt;ALTERABLE_SYSTEM_KEYSPACES&lt;/tt&gt; work as originally intended (and thus starting to forbid changing the RF on &lt;tt&gt;system_distributed&lt;/tt&gt;), I&apos;d advocate for just removing &lt;tt&gt;ALTERABLE_SYSTEM_KEYSPACES&lt;/tt&gt; and deal with all those keyspace consistently. Just my 2 cents though.&lt;/p&gt;</comment>
                            <comment id="16145227" author="iamaleksey" created="Tue, 29 Aug 2017 12:50:46 +0000"  >&lt;p&gt;Not having &lt;tt&gt;system_distributed&lt;/tt&gt; in &lt;tt&gt;ALTERABLE_SYSTEM_KEYSPACES&lt;/tt&gt; is an oversight from the patch that added &lt;tt&gt;system_distributed&lt;/tt&gt;.&lt;/p&gt;

&lt;p&gt;Had it been added correctly, &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-13812&quot; title=&quot;Missing system keyspace tables are not created&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-13812&quot;&gt;&lt;del&gt;CASSANDRA-13812&lt;/del&gt;&lt;/a&gt; would not be a problem - &lt;tt&gt;ClientState.preventSystemKSSchemaModification()&lt;/tt&gt; would&apos;ve forbidden those drops.&lt;/p&gt;

&lt;p&gt;The constant is there to enumerate the keyspace whose tables cannot be modified, and that&apos;s the purpose it serves. It might not have the best possible name, though, or be ideally documented.&lt;/p&gt;

&lt;p&gt;I&apos;d start with adding &lt;tt&gt;system_distributed&lt;/tt&gt; to &lt;tt&gt;ALTERABLE_SYSTEM_KEYSPACES&lt;/tt&gt; - that would immediately fix &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-13812&quot; title=&quot;Missing system keyspace tables are not created&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-13812&quot;&gt;&lt;del&gt;CASSANDRA-13812&lt;/del&gt;&lt;/a&gt; and this ticket. Then rename &lt;tt&gt;ALTERABLE_SYSTEM_KEYSPACES&lt;/tt&gt; to something more descriptive (even &lt;tt&gt;PARTIALLY_ALTERABLE_SYSTEM_KEYSPACES&lt;/tt&gt; would be a start. And document the intent.&lt;/p&gt;

&lt;p&gt;EDIT: As Sylvain reminded me offline, we don&apos;t really need &lt;tt&gt;ALTERABLE_SYSTEM_KEYSPACES&lt;/tt&gt; at all. The intended set of keyspaces in there is duplicated in &lt;tt&gt;Schema.REPLICATED_SYSTEM_KEYSPACE_NAMES&lt;/tt&gt;, which is what we should be using instead - directly or via &lt;tt&gt;SchemaConstants.isReplicatedSystemKeyspace()&lt;/tt&gt;.&lt;/p&gt;</comment>
                            <comment id="16193296" author="iamaleksey" created="Thu, 5 Oct 2017 17:41:54 +0000"  >&lt;p&gt;Fixes for &lt;a href=&quot;https://github.com/iamaleksey/cassandra/tree/13813-3.0&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;3.0&lt;/a&gt;, &lt;a href=&quot;https://github.com/iamaleksey/cassandra/tree/13813-3.11&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;3.11&lt;/a&gt;, &lt;a href=&quot;https://github.com/iamaleksey/cassandra/tree/13813-4.0&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;4.0&lt;/a&gt; and a new &lt;a href=&quot;https://github.com/iamaleksey/cassandra-dtest/tree/13813&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;dtest&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;Utests and dtests queued up.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=slebresne&quot; class=&quot;user-hover&quot; rel=&quot;slebresne&quot;&gt;slebresne&lt;/a&gt; Any chance you could review? I&apos;ve implemented what we talked about on IRC - and renamed some confusingly named things while at it.&lt;/p&gt;</comment>
                            <comment id="16194441" author="slebresne" created="Fri, 6 Oct 2017 10:46:20 +0000"  >&lt;p&gt;So the thing is that due to how the existing code is work, we currently allow anything on the tables of the &lt;tt&gt;system_distributed&lt;/tt&gt; tables. And while I doubt there is any debate that we shouldn&apos;t let use drop those tables, or even drop/rename columns of those tables, some user may have been relying on altering these table &lt;em&gt;properties&lt;/em&gt;. &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-12701&quot; title=&quot;Repair history tables should have TTL and TWCS&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-12701&quot;&gt;&lt;del&gt;CASSANDRA-12701&lt;/del&gt;&lt;/a&gt; particularly comes to mind here: it&apos;s kind of a bug that the repair tables in there don&apos;t have TTLs and so user may have legitimately work around it by adding the table TTL themselves. The attached patch will remove the ability for this work-around (to be extra precise, user that have already changed the properties would obviously be fine, it&apos;s new user wanting to do it that wouldn&apos;t be able to), and this feels uncomfortable to do in minor releases at least.&lt;/p&gt;

&lt;p&gt;I guess, if we make sure to commit &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-12701&quot; title=&quot;Repair history tables should have TTL and TWCS&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-12701&quot;&gt;&lt;del&gt;CASSANDRA-12701&lt;/del&gt;&lt;/a&gt; before this, we at least remove one imo legitimate reason to modify those tables params and that would be better. Even without that though, modifying some system tables params isn&apos;t an entirely crazy idea (we can debate whether that&apos;s truly useful, but it&apos;s not crazy) and this remove that ability. Don&apos;t get me wrong btw, I know that we currently only allow this for &lt;tt&gt;system_distributed&lt;/tt&gt; tables and so it&apos;s inconsistent with other system keyspace in the first place, and I&apos;m not definitively saying we should allow modifying params on all system tables. I&apos;m just raising the point that the patch removes something that could be considered as useful by some, and doing so in a minor concerns me a little bit.&lt;/p&gt;</comment>
                            <comment id="16194557" author="iamaleksey" created="Fri, 6 Oct 2017 13:08:36 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=slebresne&quot; class=&quot;user-hover&quot; rel=&quot;slebresne&quot;&gt;slebresne&lt;/a&gt; I don&apos;t believe it&apos;s reasonable to keep bugs in the codebase just because they mask out other bugs. Leaving this ability is dangerous, as it breaks the assumptions we make about replicated system keyspaces, and the way we alter them. Those who make these changes manually - because we weren&apos;t careful enough and haven&apos;t shielded them from being able to - might have to pay the price later, when their cluster are unable to pick up our altered defaults, because of our bumped hardcoded timestamps being smaller than the new ones set via &lt;tt&gt;ALTER TABLE&lt;/tt&gt;.&lt;/p&gt;

&lt;p&gt;FWIW, those who are really keen to work around this issue, might as well alter &lt;tt&gt;system_schema.tables&lt;/tt&gt; manually, and get the desired result. With just as much risk.&lt;/p&gt;

&lt;p&gt;Either way, again, I don&apos;t believe that keeping the bug in just because it masks the bug in &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-12701&quot; title=&quot;Repair history tables should have TTL and TWCS&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-12701&quot;&gt;&lt;del&gt;CASSANDRA-12701&lt;/del&gt;&lt;/a&gt; is reasonable. So if you are only slightly concerned and don&apos;t mind really strongly, I&apos;d prefer to go ahead and fix this issue here and now, before more people shoot themselves in the feet.&lt;/p&gt;
</comment>
                            <comment id="16194621" author="slebresne" created="Fri, 6 Oct 2017 14:04:35 +0000"  >&lt;blockquote&gt;&lt;p&gt;I don&apos;t believe it&apos;s reasonable to keep bugs in the codebase just because they mask out other bugs.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Just to make sure my position is clear, I&apos;m not suggesting we leave this ticket unsolved. What I&apos;m suggesting is that it would be possible to forbid truly harmful changes (droping tables and adding/removing/renaming columns; that part is the real bug to me) while still allowing the altering of table parameters (which actually don&apos;t seem that problematic to me on principle). Sure, it requires adding some special casing in &lt;tt&gt;AlterTableStatement&lt;/tt&gt;, but it&apos;s not very complex either.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;when their cluster are unable to pick up our altered defaults, because of our bumped hardcoded timestamps being smaller than the new ones set via ALTER TABLE&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I&apos;m not sure I understand the problem. If user have manually and knowingly updated some table params, my guess is that they expect (even rely on) future changes to defaults to not override their changes. Isn&apos;t the whole point why we&apos;ve picked 0 for our hardcoded timestamp in fact?&lt;/p&gt;

&lt;p&gt;But if there is genunine reason I&apos;m missing that make it dangerous for user to alter those parameters, that&apos;s certainly important to  understand.  I&apos;m pretty sure some user &lt;em&gt;have&lt;/em&gt; done it (at least to work around &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-12701&quot; title=&quot;Repair history tables should have TTL and TWCS&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-12701&quot;&gt;&lt;del&gt;CASSANDRA-12701&lt;/del&gt;&lt;/a&gt;, possibly for other reasons), and if their change is a time-bomb, we kind of owe them to disarm that bomb.&lt;/p&gt;

&lt;p&gt;But anyway, to sum it up, the patch lgtm from a technical level, and I&apos;m definitively on board with forbidding clearly harmful changes. The only specific part I&apos;m unsure is the &quot;altering table parameters&quot; part. In light of my current understanding, it doesn&apos;t look obviously harmful (I can even see it being desirable if I&apos;m being honest), so I&apos;m uncomfortable removing the ability in a minor release.&lt;/p&gt;

&lt;p&gt;Happy to gather a few other opinions though and if the concensus is that the patch is fine the way it currently is, no problem, not trying to veto this in any way.&lt;/p&gt;</comment>
                            <comment id="16196789" author="iamaleksey" created="Mon, 9 Oct 2017 10:14:48 +0000"  >&lt;blockquote&gt;&lt;p&gt;I&apos;m not sure I understand the problem. If user have manually and knowingly updated some table params, my guess is that they expect (even rely on) future changes to defaults to not override their changes. Isn&apos;t the whole point why we&apos;ve picked 0 for our hardcoded timestamp in fact?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Right. But the way ALTER works, we serialise the whole table, including all params and all columns, with the new timestamp in &lt;tt&gt;system_schema.*&lt;/tt&gt; tables. Which makes it impossible for us to change the defaults later, even those that the user didn&apos;t modify on purpose. And this isn&apos;t something we can change very easily in a minor I&apos;m afraid.&lt;/p&gt;

&lt;p&gt;This is why we don&apos;t allow altering anything beyond keyspace params, and why this issue is, as it stands, a serious bug, and was never intended to be allowed.&lt;/p&gt;</comment>
                            <comment id="16196803" author="iamaleksey" created="Mon, 9 Oct 2017 10:38:19 +0000"  >&lt;p&gt;FWIW, I&apos;ll be the first to admit that the current situation is not ideal. It wasn&apos;t me who came up with it, but I share part of the blame - replicated system keyspaces are a bit of a mess, and this has already caused us some issues, and hassle with &lt;tt&gt;system_auth&lt;/tt&gt;, and it won&apos;t be the last.&lt;/p&gt;

&lt;p&gt;We can&apos;t even fix &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-12701&quot; title=&quot;Repair history tables should have TTL and TWCS&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-12701&quot;&gt;&lt;del&gt;CASSANDRA-12701&lt;/del&gt;&lt;/a&gt; properly in a minor without causing migration mismatch fun. So all things considered, my personal preference would be to shield existing users from causing further issues for themselves by accidentally or intentionally modifying those tables. At least until we have a good answer to these related issues, which I don&apos;t &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/sad.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="16196920" author="slebresne" created="Mon, 9 Oct 2017 13:04:47 +0000"  >&lt;blockquote&gt;&lt;p&gt;But the way ALTER works, we serialise the whole table, including all params and all columns&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Good point, I hadn&apos;t though about that part. Sad!&lt;/p&gt;

&lt;p&gt;So I guess I would agree in principle about shielding user against clearly dysfunctional behaviors. The problem is that in practice I know for a fact that &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-12701&quot; title=&quot;Repair history tables should have TTL and TWCS&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-12701&quot;&gt;&lt;del&gt;CASSANDRA-12701&lt;/del&gt;&lt;/a&gt; has been an issue for some users, where the tables had been growing way too much, to the point that being able to work-around that by setting a TTL manually probably override concerns about hypothetical future changes to defaults not being picked up.&lt;/p&gt;

&lt;p&gt;Or to put it another way, none of this is ideal, but I wonder is &quot;repair history tables regularly grows out of control regularly&quot; isn&apos;t a bigger problem in practice than &quot;future defaults changes to system tables may not be picked up&quot;. Anyway, again, not opposed on the current patch personally, but uneased by it, so wouldn&apos;t mind a few additional opinion to see if it&apos;s just me being difficult (which is possible).&lt;/p&gt;</comment>
                            <comment id="16196923" author="iamaleksey" created="Mon, 9 Oct 2017 13:09:20 +0000"  >&lt;blockquote&gt;&lt;p&gt;so wouldn&apos;t mind a few additional opinion to see if it&apos;s just me being difficult (which is possible).&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Oh, you&apos;ve never been difficult. Neither have I. FWIW I don&apos;t feel very strongly about this going to 3.0.x vs. this going to 4.0 only. Worst case I&apos;ll just fix this for us internally.&lt;/p&gt;

&lt;p&gt;Seeing that neither of us feels really strongly about this, I don&apos;t mind getting some opinions from others, either. I&apos;ll throw a signal on IRC and hopefully someone will reply. Either way it&apos;s not urgent.&lt;/p&gt;</comment>
                            <comment id="16197002" author="JIRAUSER308715" created="Mon, 9 Oct 2017 13:53:05 +0000"  >&lt;p&gt;I am a little concerned about this change not letting anything be updated, but I do understand the reasons, and I can&apos;t really see a way around them. Given that an experience person can still get around this restriction by doing inserts into the schema tables, that is probably enough if there are any future bugs to be worked around.  Un-experienced users should not be changing these values by themselves.&lt;/p&gt;</comment>
                            <comment id="16197996" author="kurtg" created="Tue, 10 Oct 2017 01:23:04 +0000"  >&lt;p&gt;I think if we can&apos;t provide a data model for our tables that works for all scenarios then we need to allow operators to make changes. I&apos;ve had quite a few occasions where modifying &quot;system&quot; tables was necessary, and I&apos;m sure more tables will be introduced that don&apos;t work in all scenarios in the future. &lt;/p&gt;

&lt;p&gt;While there is the workaround of just inserting into the system_schema tables that is fraught with peril, and far more likely for them to do something that breaks things. I can&apos;t see someone saying &quot;woops I accidentally DROPped/ALTERed a random column in system_distributed.view_build_status&quot;, but I can definitely see someone trying to insert into system_schema.tables and making mistakes. As soon as we make them replicated we hand over some responsibility to the operator to manage them (not that the non-replicated keyspaces have a history of being perfect though), and I&apos;d expect to be able to change table properties that potentially affect the cluster.&lt;/p&gt;

&lt;p&gt;Cassandra already requires you to know what your doing as an operator, this really doesn&apos;t increase that expectation. There are a million other bad choices you could make when managing a cluster that would be far more catastrophic (and far more likely). I would like to move away from that, but a lot of that sort of thing requires major changes to fix. As in this case it seems we&apos;ll need the capability limitation framework or other major changes to make a reasonable compromise. &lt;/p&gt;</comment>
                            <comment id="16198456" author="slebresne" created="Tue, 10 Oct 2017 09:58:58 +0000"  >&lt;blockquote&gt;&lt;p&gt;an experience person can still get around this restriction by doing inserts into the schema tables&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I also just realized that doing so actually avoids the issue we currently have with &lt;tt&gt;ALTER&lt;/tt&gt; that it rewrites all columns, so it makes it a somewhat better work-around (of course, still a work-around and that don&apos;t dispense us for fixing all this more cleanly). My only bother is that while I haven&apos;t actually tried it recently, last time I did try updating the schema tables manually, it was annoying because the changes were not automatically picked-up and in fact tended to be overridden, so I had to force a reload in weird ways (altering some other unrelated table in the keyspace, which here would actually be an issue). So it would be nice if we added a JMX call to force reload schema tables from disk to make this easier (should be easy). If we do, I&apos;m warming up to the idea of considering this is the only really safe work-around until we find a better way to deal with all thise.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;if we can&apos;t provide a data model for our tables that works for all scenarios then we need to allow operators to make changes.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I&apos;m not sure what you are trying to mean by that. If it&apos;s a reference to &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-12701&quot; title=&quot;Repair history tables should have TTL and TWCS&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-12701&quot;&gt;&lt;del&gt;CASSANDRA-12701&lt;/del&gt;&lt;/a&gt;, then what makes that change problematic is the very same reason why leaving &lt;tt&gt;ALTER&lt;/tt&gt; working here is problematic. So feel free to suggest a concrete solution to those problems if you have one, but otherwise, I&apos;m not sure how this statement helps make a decision on this issue.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;I&apos;ve had quite a few occasions where modifying &quot;system&quot; tables was necessary, and I&apos;m sure more tables will be introduced that don&apos;t work in all scenarios in the future.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;First, it would be nice if you could be a bit more concrete on those time where it was &quot;necessary&quot;: which tables, what modification and why what it necessary? We&apos;re trying to find the best course of action for a very concrete problem and we are all experienced C* developers: let&apos;s be specific.&lt;/p&gt;

&lt;p&gt;Second, I&apos;m not sure how to re-conciliate that sentence as a whole to the concrete problem at end. Let&apos;s remind that we do &lt;em&gt;already&lt;/em&gt; refuse &lt;tt&gt;ALTER&lt;/tt&gt; on most system tables, and this ticket is not about discussing whether we should allow &lt;tt&gt;ALTER&lt;/tt&gt; on system tables &lt;em&gt;in general&lt;/em&gt;. If you want to discuss that, I&apos;m good with it (outside of the fact that we will have to solve the technical gotcha mentioned above) and your arguments seem to really be applied to such change, but please open a separate ticket and let&apos;s not divert that one.&lt;/p&gt;</comment>
                            <comment id="16198482" author="iamaleksey" created="Tue, 10 Oct 2017 10:24:58 +0000"  >&lt;blockquote&gt;&lt;p&gt;My only bother is that while I haven&apos;t actually tried it recently, last time I did try updating the schema tables manually, it was annoying because the changes were not automatically picked-up and in fact tended to be overridden, so I had to force a reload in weird ways (altering some other unrelated table in the keyspace, which here would actually be an issue). So it would be nice if we added a JMX call to force reload schema tables from disk to make this easier (should be easy). If we do, I&apos;m warming up to the idea of considering this is the only really safe work-around until we find a better way to deal with all thise.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Yep. You either do an unrelated &lt;tt&gt;ALTER&lt;/tt&gt; (usually &lt;tt&gt;WITH comment = ...&lt;/tt&gt;) or bounce the node. Also wouldn&apos;t mind at all adding the new JMX call, as a companion to &lt;tt&gt;resetlocalschema&lt;/tt&gt;.&lt;/p&gt;</comment>
                            <comment id="16198490" author="iamaleksey" created="Tue, 10 Oct 2017 10:30:35 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=slebresne&quot; class=&quot;user-hover&quot; rel=&quot;slebresne&quot;&gt;slebresne&lt;/a&gt; I can/will extend the patch with a new &lt;tt&gt;reloadlocalschema&lt;/tt&gt; JMX call and a nodetool cmd when/if you warm up to it sufficiently (:&lt;/p&gt;

&lt;p&gt;EDIT: Actually, never mind. I&apos;ll do it either way, in a separate JIRA, for cleanliness sake, and it&apos;s independently useful anyway. Will poke you on it once ready.&lt;/p&gt;</comment>
                            <comment id="16203638" author="iamaleksey" created="Fri, 13 Oct 2017 14:33:37 +0000"  >&lt;p&gt;Created &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-13954&quot; title=&quot;Provide a JMX call to sync schema with local storage&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-13954&quot;&gt;&lt;del&gt;CASSANDRA-13954&lt;/del&gt;&lt;/a&gt; for jmx/nodetool work.&lt;/p&gt;</comment>
                            <comment id="16205377" author="kurtg" created="Mon, 16 Oct 2017 02:17:40 +0000"  >&lt;blockquote&gt;&lt;p&gt;I&apos;m not sure what you are trying to mean by that.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Not sure how to make this clearer. If we can&apos;t provide a one-size-fits-all solution for our system distributed tables, which we can&apos;t, we should allow for them to be modified by operators. In &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-12701&quot; title=&quot;Repair history tables should have TTL and TWCS&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-12701&quot;&gt;&lt;del&gt;CASSANDRA-12701&lt;/del&gt;&lt;/a&gt; we can&apos;t set a TTL because we can&apos;t pick a TTL that&apos;s appropriate for all use cases (or compaction strategy for that matter). Users have to pick their own, thus we should allow them to change these properties. So far it only may be that TTL is the one that users need to change, but I&apos;m sure there are potentially others, and I&apos;m sure there will be more in the future.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;First, it would be nice if you could be a bit more concrete on those time where it was &quot;necessary&quot;&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Sure, I&apos;ve had to change TTL as per &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-12701&quot; title=&quot;Repair history tables should have TTL and TWCS&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-12701&quot;&gt;&lt;del&gt;CASSANDRA-12701&lt;/del&gt;&lt;/a&gt; multiple times. I&apos;ve never bothered changing compaction strategy but obviously that would be beneficial.&lt;br/&gt;
I&apos;ve also had to set up jobs to routinely truncate system_traces. This may sound absurd, but in environments where you don&apos;t necessarily have control over clients, it is applicable. Being able to TTL on this keyspace would improve things here.&lt;br/&gt;
I&apos;ve also had to drop tables in system_distributed on occasion when for some reason or another they got corrupt/different ID&apos;s across the cluster. This has also occured for system_traces, but obviously had to delete manually from system_schema.&lt;br/&gt;
Obviously also the usual system_auth changes, however so far that only relates to modifying RF, but I&apos;ll note that we do require dropping tables in that keyspace for conversion to role based access.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;this ticket is not about discussing whether we should allow ALTER on system tables in general.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Yep, I was never talking about system tables in general, just the distributed ones. I thought this would be obvious considering that&apos;s what the ticket was about.&lt;/p&gt;

&lt;p&gt;I think it&apos;s worth pointing out the following as well, because it&apos;s been raised that having alterable system_distributed tables is a major defect.&lt;br/&gt;
This issue (and related ones) were raised by developers as &quot;major&quot; issues.&lt;br/&gt;
There appears to be no evidence so far that this issue has actually affected users.&lt;br/&gt;
We&apos;re rushing to fix it because for some reason, all of a sudden, we&apos;ve determined that users breaking their own cluster by doing funny things is a huge problem. This is odd to me, considering users routinely break their clusters by running repairs, but I&apos;ve never heard of anyone breaking their cluster because they altered a system &quot;distributed&quot; keyspace.&lt;br/&gt;
There appears to be no evidence that you can really do catastrophic damage by altering these tables. If we fixed the fact that they don&apos;t get recreated automatically anymore I&apos;m pretty sure any issues created by doing odd changes on the tables (which is very unlikely) would easily be resolved by dropping the tables and restarting a node. On that note, not sure if repair actually will break if the history tables are broken, but as far as MV are concerned, they keep working even if you truncate/drop the tables.&lt;br/&gt;
The suggested fix still leaves a workaround to make the changes we&apos;d be blocking here, and this is on purpose. This kind of implies that we&apos;re perfectly OK with users making these changes. I mean, if this is an actual issue surely we should also create a ticket &quot;Don&apos;t let user insert garbage into system_schema&quot;.&lt;/p&gt;

&lt;p&gt;I&apos;m really not convinced that this is such a major high priority issue that we can&apos;t just put it off until 4 and fix it with something more reasonable like the capability limitation framework, while maintaining the current behaviour. &lt;/p&gt;</comment>
                            <comment id="16207161" author="slebresne" created="Tue, 17 Oct 2017 08:19:47 +0000"  >&lt;p&gt;As suggested earlier, I&apos;m personally +1 on the patch here now that we have &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-13954&quot; title=&quot;Provide a JMX call to sync schema with local storage&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-13954&quot;&gt;&lt;del&gt;CASSANDRA-13954&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="16207589" author="iamaleksey" created="Tue, 17 Oct 2017 12:44:11 +0000"  >&lt;p&gt;Thanks. Committed to 3.0 as &lt;a href=&quot;https://github.com/apache/cassandra/commit/9e37967e17a1b223df35c1c7cec4dc4adf0b2d91&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;9e37967e17a1b223df35c1c7cec4dc4adf0b2d91&lt;/a&gt; and merged up with 3.11 and trunk. Dtest committed as &lt;a href=&quot;https://github.com/apache/cassandra-dtest/commit/957ae2bc455c56835632193e1aa251495c3724f8&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;957ae2bc455c56835632193e1aa251495c3724f8&lt;/a&gt;.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310040">
                    <name>Required</name>
                                            <outwardlinks description="requires">
                                        <issuelink>
            <issuekey id="13109274">CASSANDRA-13954</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                            <issuelinktype id="12310051">
                    <name>Supercedes</name>
                                            <outwardlinks description="supercedes">
                                        <issuelink>
            <issuekey id="13097875">CASSANDRA-13812</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[aleksey]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 5 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3jc8v:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>slebresne</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[slebresne]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12962"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>