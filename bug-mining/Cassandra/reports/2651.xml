<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 22:43:17 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-6526] CQLSSTableWriter addRow(Map&lt;String, Object&gt; values) does not work as documented.</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-6526</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;There are 2 bugs in the method&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;addRow(Map&amp;lt;&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;, &lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt;&amp;gt; values)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;First issue is that the map &amp;lt;b&amp;gt;must&amp;lt;/b&amp;gt; contain all the column names as keys in the map otherwise the addRow fails (with InvalidRequestException &quot;Invalid number of arguments, expecting %d values but got %d&quot;).&lt;/p&gt;

&lt;p&gt;Second Issue is that the keys in the map must be in lower-case otherwise they may not be found in the map, which will result in a NPE during decompose.&lt;/p&gt;
&lt;h6&gt;&lt;a name=&quot;SUGGESTEDSOLUTION%3A&quot;&gt;&lt;/a&gt;SUGGESTED SOLUTION:&lt;/h6&gt;
&lt;p&gt;Fix the addRow method with:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; CQLSSTableWriter addRow(Map&amp;lt;&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;, &lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt;&amp;gt; values)
    &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; InvalidRequestException, IOException
{
    &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; size = boundNames.size();
    Map&amp;lt;&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;, ByteBuffer&amp;gt; rawValues = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; HashMap&amp;lt;&amp;gt;(size);
    &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; (&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; i = 0; i &amp;lt; size; i++) {
        ColumnSpecification spec = boundNames.get(i);
        &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; colName = spec.name.toString();
        rawValues.put(colName, values.get(colName) == &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; ? &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; : ((AbstractType)spec.type).decompose(values.get(colName)));
    }
    &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; rawAddRow(rawValues);
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;When creating the new Map for the insert we need to go over all columns and apply null to missing columns.&lt;/p&gt;

&lt;p&gt;Fix the method documentation add this line:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;     * &amp;lt;p&amp;gt;
     * Keys in the map &amp;lt;b&amp;gt;must&amp;lt;/b&amp;gt; be in lower &lt;span class=&quot;code-keyword&quot;&gt;case&lt;/span&gt;, otherwise their value will be &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;.
     *
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="12686352">CASSANDRA-6526</key>
            <summary>CQLSSTableWriter addRow(Map&lt;String, Object&gt; values) does not work as documented.</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10002" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Normal</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="slebresne">Sylvain Lebresne</assignee>
                                    <reporter username="yarix">Yariv Amar</reporter>
                        <labels>
                    </labels>
                <created>Wed, 25 Dec 2013 13:09:52 +0000</created>
                <updated>Tue, 16 Apr 2019 09:31:57 +0000</updated>
                            <resolved>Thu, 6 Mar 2014 09:14:19 +0000</resolved>
                                        <fixVersion>2.0.6</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                    <workratio workratioPercent="0"/>
                                    <progress percentage="0">
                                    <originalProgress>
                                                    <row percentage="100" backgroundColor="#89afd7"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="0" backgroundColor="#51a825"/>
                                                    <row percentage="100" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="0">
                                    <originalProgress>
                                                    <row percentage="100" backgroundColor="#89afd7"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="0" backgroundColor="#51a825"/>
                                                    <row percentage="100" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                    <timeoriginalestimate seconds="86400">24h</timeoriginalestimate>
                            <timeestimate seconds="86400">24h</timeestimate>
                                        <comments>
                            <comment id="13856594" author="yarix" created="Wed, 25 Dec 2013 13:10:43 +0000"  >&lt;p&gt;below is a test case:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;@Test
&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void testAddRow() &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; Exception
{
	&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; KS = &lt;span class=&quot;code-quote&quot;&gt;&quot;cql_keyspace&quot;&lt;/span&gt;;
	&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; TABLE = &lt;span class=&quot;code-quote&quot;&gt;&quot;table1&quot;&lt;/span&gt;;
	
	File tempdir = Files.createTempDir();
	File dataDir = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; File(tempdir.getAbsolutePath() + File.separator + KS + File.separator + TABLE);
	assertTrue( dataDir.mkdirs());
	
	&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; schema = &lt;span class=&quot;code-quote&quot;&gt;&quot;CREATE TABLE cql_keyspace.table1 (&quot;&lt;/span&gt;
			+ &lt;span class=&quot;code-quote&quot;&gt;&quot;  k &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; PRIMARY KEY,&quot;&lt;/span&gt;
			+ &lt;span class=&quot;code-quote&quot;&gt;&quot;  v1 text,&quot;&lt;/span&gt;
			+ &lt;span class=&quot;code-quote&quot;&gt;&quot;  v2 &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;&quot;&lt;/span&gt;
			+ &lt;span class=&quot;code-quote&quot;&gt;&quot;)&quot;&lt;/span&gt;;
	&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; insert = &lt;span class=&quot;code-quote&quot;&gt;&quot;INSERT INTO cql_keyspace.table1 (k, v1, v2) VALUES (?, ?, ?)&quot;&lt;/span&gt;;
	CQLSSTableWriter writer = CQLSSTableWriter.builder()
			.inDirectory(dataDir)
			.forTable(schema)
			.withPartitioner(StorageService.instance.getPartitioner())
			.using(insert).build();
	
	Map&amp;lt;&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;, &lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt;&amp;gt; values = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; HashMap&amp;lt;&amp;gt;();
	values.put( &lt;span class=&quot;code-quote&quot;&gt;&quot;k&quot;&lt;/span&gt;, 0 );
	values.put( &lt;span class=&quot;code-quote&quot;&gt;&quot;v1&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;test1&quot;&lt;/span&gt; );
	values.put( &lt;span class=&quot;code-quote&quot;&gt;&quot;v2&quot;&lt;/span&gt;, 24 );
	writer.addRow( values );
	
	values.clear();  
	values.put( &lt;span class=&quot;code-quote&quot;&gt;&quot;k&quot;&lt;/span&gt;, 1 );
	values.put( &lt;span class=&quot;code-quote&quot;&gt;&quot;v1&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;test2&quot;&lt;/span&gt; );
&lt;span class=&quot;code-comment&quot;&gt;//    	values.put( &lt;span class=&quot;code-quote&quot;&gt;&quot;v2&quot;&lt;/span&gt;, &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; ); //commented intentionally so that v2 will get &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; by the writer.
&lt;/span&gt;	writer.addRow( values );
	
	values.clear();
	values.put( &lt;span class=&quot;code-quote&quot;&gt;&quot;k&quot;&lt;/span&gt;, 2 );
	values.put( &lt;span class=&quot;code-quote&quot;&gt;&quot;V1&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;test3 - will not be found, since V1 is not lowercase&quot;&lt;/span&gt; );
	values.put( &lt;span class=&quot;code-quote&quot;&gt;&quot;v2&quot;&lt;/span&gt;, 42 );
	values.put( &lt;span class=&quot;code-quote&quot;&gt;&quot;v3&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;some ignored key&quot;&lt;/span&gt; );
	writer.addRow( values );
	
	writer.close();
	
	SSTableLoader loader = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; SSTableLoader(dataDir, &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; SSTableLoader.Client()
	{
		&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void init(&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; keyspace)
		{
			&lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; (Range&amp;lt;Token&amp;gt; range : StorageService.instance.getLocalRanges(&lt;span class=&quot;code-quote&quot;&gt;&quot;cql_keyspace&quot;&lt;/span&gt;))
				addRangeForEndpoint(range, FBUtilities.getBroadcastAddress());
			setPartitioner(StorageService.getPartitioner());
		}
		
		&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; CFMetaData getCFMetaData(&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; keyspace, &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; cfName)
		{
			&lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; Schema.instance.getCFMetaData(keyspace, cfName);
		}
	}, &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; OutputHandler.SystemOutput(&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;, &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;));
	
	loader.stream().get();
	
	UntypedResultSet rs = QueryProcessor.processInternal(&lt;span class=&quot;code-quote&quot;&gt;&quot;SELECT * FROM cql_keyspace.table1;&quot;&lt;/span&gt;);
	assertEquals(3, rs.size());
	
	Iterator&amp;lt;UntypedResultSet.Row&amp;gt; iter = rs.iterator();
	UntypedResultSet.Row row;
	
	row = iter.next();
	assertEquals(0, row.getInt(&lt;span class=&quot;code-quote&quot;&gt;&quot;k&quot;&lt;/span&gt;));
	assertEquals(&lt;span class=&quot;code-quote&quot;&gt;&quot;test1&quot;&lt;/span&gt;, row.getString(&lt;span class=&quot;code-quote&quot;&gt;&quot;v1&quot;&lt;/span&gt;));
	assertEquals(24, row.getInt(&lt;span class=&quot;code-quote&quot;&gt;&quot;v2&quot;&lt;/span&gt;));
	
	row = iter.next();
	assertEquals(1, row.getInt(&lt;span class=&quot;code-quote&quot;&gt;&quot;k&quot;&lt;/span&gt;));
	assertEquals(&lt;span class=&quot;code-quote&quot;&gt;&quot;test2&quot;&lt;/span&gt;, row.getString(&lt;span class=&quot;code-quote&quot;&gt;&quot;v1&quot;&lt;/span&gt;));
	assertFalse(row.has(&lt;span class=&quot;code-quote&quot;&gt;&quot;v2&quot;&lt;/span&gt;));
	
	row = iter.next();
	assertEquals(2, row.getInt(&lt;span class=&quot;code-quote&quot;&gt;&quot;k&quot;&lt;/span&gt;));
	assertFalse(row.has(&lt;span class=&quot;code-quote&quot;&gt;&quot;v1&quot;&lt;/span&gt;));
	assertEquals(42, row.getInt(&lt;span class=&quot;code-quote&quot;&gt;&quot;v2&quot;&lt;/span&gt;));
	assertFalse(row.has(&lt;span class=&quot;code-quote&quot;&gt;&quot;v3&quot;&lt;/span&gt;));

}

&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="13856618" author="jbellis" created="Wed, 25 Dec 2013 16:45:36 +0000"  >&lt;blockquote&gt;&lt;p&gt;First issue is that the map &amp;lt;b&amp;gt;must&amp;lt;/b&amp;gt; contain all the column names as keys in the map &lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;This is a bug.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;the keys in the map must be in lower-case &lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;This is not a bug.&lt;/p&gt;</comment>
                            <comment id="13858434" author="yarix" created="Sun, 29 Dec 2013 20:33:12 +0000"  >&lt;p&gt;I agree. Yet, I think that adding a documentation (JavaDoc) to the second issue can be very helpful. &lt;/p&gt;</comment>
                            <comment id="13917952" author="slebresne" created="Mon, 3 Mar 2014 11:06:42 +0000"  >&lt;p&gt;Attaching simple patch to fix the bug mentioned and add some doc on when you should lowercase column names.&lt;/p&gt;</comment>
                            <comment id="13921240" author="thobbs" created="Wed, 5 Mar 2014 19:13:19 +0000"  >&lt;p&gt;+1&lt;/p&gt;</comment>
                            <comment id="13922190" author="slebresne" created="Thu, 6 Mar 2014 09:14:19 +0000"  >&lt;p&gt;Committed, thanks&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12632224" name="6526.txt" size="3890" author="slebresne" created="Mon, 3 Mar 2014 11:06:42 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[slebresne]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>365336</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            11 years, 37 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1qyyn:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>365638</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>thobbs</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[thobbs]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12962"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12311420" key="com.atlassian.jira.plugin.system.customfieldtypes:version">
                        <customfieldname>Since Version</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="12325023">2.0.2</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>