<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 22:57:24 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-10159] Incorrect last update time causes dtest to fail due to unexpected errors</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-10159</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;Some dtests are failing as follows:&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://cassci.datastax.com/job/cassandra-3.0_dtest/96/testReport/counter_tests/TestCounters/upgrade_test/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://cassci.datastax.com/job/cassandra-3.0_dtest/96/testReport/counter_tests/TestCounters/upgrade_test/&lt;/a&gt;&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;Unexpected error in node2 node log: [&apos;ERROR [main] 2015-08-23 11:25:52,701 TransactionLog.java:246 - Possible disk corruption detected &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; sstable [ma-2-big], record [REMOVE:[ma-2-big,1440329048000,8]]: last update time [Thu Jan 01 00:00:00 UTC 1970] should have been [Sun Aug 23 11:24:08 UTC 2015] ERROR [main] 2015-08-23 11:25:52,709 TransactionLog.java:992 - Possible disk corruption: failed to read transaction log /mnt/tmp/dtest-E0OvQC/test/node2/data/system/local-7ad54392bcdd35a684174e047860b377/ma_txn_compaction_90eda9f0-4989-11e5-86bd-f32569933441.log org.apache.cassandra.db.lifecycle.TransactionLog$CorruptTransactionLogException: Failed to verify transaction 90eda9f0-4989-11e5-86bd-f32569933441 record [REMOVE:[ma-2-big,1440329048000,8]]: possible disk corruption, aborting \tat org.apache.cassandra.db.lifecycle.TransactionLog$TransactionFile.readRecords(TransactionLog.java:349) ~[main/:na] \tat org.apache.cassandra.db.lifecycle.TransactionLog$TransactionData.readLogFile(TransactionLog.java:574) ~[main/:na] \tat org.apache.cassandra.db.lifecycle.TransactionLog.removeUnfinishedLeftovers(TransactionLog.java:988) ~[main/:na] \tat org.apache.cassandra.db.lifecycle.LifecycleTransaction.removeUnfinishedLeftovers(LifecycleTransaction.java:548) [main/:na] \tat org.apache.cassandra.db.ColumnFamilyStore.scrubDataDirectories(ColumnFamilyStore.java:584) [main/:na] \tat org.apache.cassandra.service.StartupChecks$7.execute(StartupChecks.java:274) [main/:na] \tat org.apache.cassandra.service.StartupChecks.verify(StartupChecks.java:103) [main/:na] \tat org.apache.cassandra.service.CassandraDaemon.setup(CassandraDaemon.java:166) [main/:na] \tat org.apache.cassandra.service.CassandraDaemon.activate(CassandraDaemon.java:516) [main/:na] \tat org.apache.cassandra.service.CassandraDaemon.main(CassandraDaemon.java:622) [main/:na] ERROR [main] 2015-08-23 11:25:52,710 TransactionLog.java:998 - Failed to remove unfinished transaction leftovers org.apache.cassandra.db.lifecycle.TransactionLog$CorruptTransactionLogException: Failed to verify transaction 90eda9f0-4989-11e5-86bd-f32569933441 record [REMOVE:[ma-2-big,1440329048000,8]]: possible disk corruption, aborting \tat org.apache.cassandra.db.lifecycle.TransactionLog$TransactionFile.readRecords(TransactionLog.java:349) ~[main/:na] \tat org.apache.cassandra.db.lifecycle.TransactionLog$TransactionData.readLogFile(TransactionLog.java:574) ~[main/:na] \tat org.apache.cassandra.db.lifecycle.TransactionLog.removeUnfinishedLeftovers(TransactionLog.java:988) ~[main/:na] \tat org.apache.cassandra.db.lifecycle.LifecycleTransaction.removeUnfinishedLeftovers(LifecycleTransaction.java:548) [main/:na] \tat org.apache.cassandra.db.ColumnFamilyStore.scrubDataDirectories(ColumnFamilyStore.java:584) [main/:na] \tat org.apache.cassandra.service.StartupChecks$7.execute(StartupChecks.java:274) [main/:na] \tat org.apache.cassandra.service.StartupChecks.verify(StartupChecks.java:103) [main/:na] \tat org.apache.cassandra.service.CassandraDaemon.setup(CassandraDaemon.java:166) [main/:na] \tat org.apache.cassandra.service.CassandraDaemon.activate(CassandraDaemon.java:516) [main/:na] \tat 
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;My best guess is that before reading the update time we should check that the file actually exists.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12858220">CASSANDRA-10159</key>
            <summary>Incorrect last update time causes dtest to fail due to unexpected errors</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10002" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Normal</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="stefania">Stefania Alborghetti</assignee>
                                    <reporter username="stefania">Stefania Alborghetti</reporter>
                        <labels>
                    </labels>
                <created>Mon, 24 Aug 2015 08:27:22 +0000</created>
                <updated>Tue, 16 Apr 2019 09:30:59 +0000</updated>
                            <resolved>Thu, 27 Aug 2015 16:31:35 +0000</resolved>
                                        <fixVersion>3.0 beta 2</fixVersion>
                                    <component>Legacy/Local Write-Read Paths</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                                                                <comments>
                            <comment id="14710761" author="stefania" created="Tue, 25 Aug 2015 07:16:46 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=benedict&quot; class=&quot;user-hover&quot; rel=&quot;benedict&quot;&gt;benedict&lt;/a&gt; would you mind reviewing? &lt;/p&gt;

&lt;p&gt;We should not check the last update time if there are no files. I&apos;ve also increased the number of attempts when listing files, as Jenkins machines are a bit slower. &lt;/p&gt;

&lt;p&gt;I&apos;ve added a unit test that reproduces the problem and fixed some warnings in &lt;tt&gt;TransactionLogTest&lt;/tt&gt;.&lt;/p&gt;

&lt;p&gt;Patch: &lt;a href=&quot;https://github.com/stef1927/cassandra/commits/10159-3.0&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/stef1927/cassandra/commits/10159-3.0&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;CI:&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/stef1927/job/stef1927-10159-3.0-dtest/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://cassci.datastax.com/view/Dev/view/stef1927/job/stef1927-10159-3.0-dtest/&lt;/a&gt;&lt;br/&gt;
&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/stef1927/job/stef1927-10159-3.0-testall/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://cassci.datastax.com/view/Dev/view/stef1927/job/stef1927-10159-3.0-testall/&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14710777" author="benedict" created="Tue, 25 Aug 2015 07:25:38 +0000"  >&lt;p&gt;Looks good.&lt;/p&gt;

&lt;p&gt;I&apos;m a little concerned that we had to up MAX_ATTEMPTS, however. Not that I mind having a higher number (I&apos;d be happy with it being higher still), but if we&apos;re hitting it with any frequency I suspect something else is up other than jenkins&apos; servers being slow (and if so, we&apos;re at risk of hitting this in production). The loop is only to avoid race conditions - repeating once should ordinarily be sufficient, as the race has (or should have) already passed by the time we&apos;re done. So this would imply we&apos;re hitting five races in a row, which seems like it should be a very rare event. Are we perhaps missing something?&lt;/p&gt;</comment>
                            <comment id="14710821" author="stefania" created="Tue, 25 Aug 2015 07:52:42 +0000"  >&lt;p&gt;I&apos;ve attached the log file of the node that caused the problem on Jenkins. In this specific case, it failed to complete the transaction when restarting because of checking the last update time even when no files exist, which is what we fixed here. This highlights another problem however, if for any reason we cannot complete a transaction, chances are we won&apos;t be able to list temporary files for this table either, regardless of the number of attempts. So my idea to increase MAX_ATTEMPTS is actually not required. This observation increases the importance of &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-10112&quot; title=&quot;Refuse to start and print txn log information in case of disk corruption&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-10112&quot;&gt;&lt;del&gt;CASSANDRA-10112&lt;/del&gt;&lt;/a&gt;. If we decide to carry on, corrupt log files should be stashed or removed.&lt;/p&gt;</comment>
                            <comment id="14710847" author="benedict" created="Tue, 25 Aug 2015 08:14:12 +0000"  >&lt;p&gt;Ah, ok. I&apos;ll note I&apos;m still happy to increase it, since it&apos;s not a problem, and there&apos;s no point failing completely if someone in the wild does encounter a surprising number in a row.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;if for any reason we cannot complete a transaction, chances are we won&apos;t be able to list temporary files for this table either&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;If we fail to complete a transaction, we should just immediately delete the log file, no? (Or leave it in a state where we can do so on restart)&lt;/p&gt;

&lt;p&gt;(BTW: I think we should change the message for this branch, as it&apos;s not really disk corruption we&apos;re trying to detect here, but manual interference with the sstables)&lt;/p&gt;
</comment>
                            <comment id="14710858" author="stefania" created="Tue, 25 Aug 2015 08:24:57 +0000"  >&lt;blockquote&gt;&lt;p&gt;If we fail to complete a transaction, we should just immediately delete the log file, no? &lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I meant on startup when we remove the leftovers, sorry. &lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;(Or leave it in a state where we can do so on restart)&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;That&apos;s what we aim to achieve but if there is a bug or manual intervention we may not be able to.&lt;/p&gt;

&lt;p&gt;We can change the log message, &quot;Possible disk corruption&quot; is an attempt to draw the attention of the operators, any preferences?&lt;/p&gt;</comment>
                            <comment id="14710980" author="benedict" created="Tue, 25 Aug 2015 09:24:39 +0000"  >&lt;p&gt;In this instance it&apos;s more that the disk &lt;em&gt;state&lt;/em&gt; is unexpected, not that there&apos;s necessarily been corruption. I don&apos;t mind terribly though, it just occurs to me this may be a little confusing for operators&lt;/p&gt;</comment>
                            <comment id="14712263" author="stefania" created="Wed, 26 Aug 2015 00:44:37 +0000"  >&lt;p&gt;I&apos;ve replaced &lt;em&gt;possible disk corruption&lt;/em&gt; with either &lt;em&gt;unexpected files detected for sstable&lt;/em&gt; or &lt;em&gt;unexpected disk state&lt;/em&gt;, as applicable.&lt;/p&gt;</comment>
                            <comment id="14717002" author="benedict" created="Thu, 27 Aug 2015 16:31:35 +0000"  >&lt;p&gt;Committed as b5b32a4291590f61d39877eaa3b39c40f7710218&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12752179" name="node2.log" size="218174" author="stefania" created="Tue, 25 Aug 2015 07:44:56 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[stefania]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 12 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2j9u7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>benedict</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[benedict]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12962"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>