<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 22:24:07 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-3198] debian packaging installation problem when installing for the first time</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-3198</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;when installing cassandra through the debian packaging for the first time, there is permission problem when starting Cassandra.&lt;/p&gt;

&lt;p&gt;Normally, the postinst script change owner of /var/log/cassandra and /var/lib/cassandra from root to cassandra user.&lt;/p&gt;

&lt;p&gt;there is a problem with the test which verify if threre is a need to change the owner of these directory or not.&lt;/p&gt;

&lt;p&gt;On a new install, the $2 parameter is not set and the the test is false and the owner is not changed.&lt;/p&gt;

&lt;p&gt;(simply, i think replace &quot;&amp;amp;&amp;amp;&quot; with &quot;||&quot; might work)&lt;/p&gt;</description>
                <environment></environment>
        <key id="12522884">CASSANDRA-3198</key>
            <summary>debian packaging installation problem when installing for the first time</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10002" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Normal</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="jsevellec">J&#233;r&#233;my Sevellec</assignee>
                                    <reporter username="jsevellec">J&#233;r&#233;my Sevellec</reporter>
                        <labels>
                    </labels>
                <created>Tue, 13 Sep 2011 11:59:54 +0000</created>
                <updated>Tue, 16 Apr 2019 09:32:51 +0000</updated>
                            <resolved>Mon, 3 Oct 2011 21:53:16 +0000</resolved>
                                        <fixVersion>0.8.7</fixVersion>
                                    <component>Packaging</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                                                                <comments>
                            <comment id="13103649" author="jsevellec" created="Tue, 13 Sep 2011 14:15:21 +0000"  >&lt;p&gt;here is the patch&lt;/p&gt;</comment>
                            <comment id="13104078" author="shyamal" created="Tue, 13 Sep 2011 23:35:21 +0000"  >&lt;p&gt;I believe this is the correct patch. It sets permissions on first install, or failing that, when upgrading from earlier than 0.6.4-2 per &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-1004&quot; title=&quot;Debian packaging should allow a specific user name and optionally create it as &amp;quot;cassandra&amp;quot; on install&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-1004&quot;&gt;&lt;del&gt;CASSANDRA-1004&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13104501" author="slebresne" created="Wed, 14 Sep 2011 13:46:59 +0000"  >&lt;p&gt;That second patch looks good, but maybe we should change that 0.6.4-2 to 0.8.6. Eric, since you initially added that test, an opinion ?&lt;/p&gt;</comment>
                            <comment id="13104583" author="urandom" created="Wed, 14 Sep 2011 15:43:38 +0000"  >&lt;p&gt;The comparison to 0.6.4-2 can be safely removed now, so it should look something like:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;if [ -z &quot;$2&quot; ]; then
    chown -R cassandra: /var/lib/cassandra
    chown -R cassandra: /var/log/cassandra
fi
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="13104604" author="slebresne" created="Wed, 14 Sep 2011 16:02:17 +0000"  >&lt;blockquote&gt;&lt;p&gt;The comparison to 0.6.4-2 can be safely removed now&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Hum, the goal of this ticket is that anyone that have started using the deb package after 0.6.4-2 have /var/&lt;/p&gt;
{lib,log}
&lt;p&gt;/cassandra owned by root.root, which was not intended. So we can decide that we want to leave all those people with those &quot;wrong&quot; permissions, but it&apos;s not safer to remove the comparison now that it was when the patch was initially committed.&lt;/p&gt;</comment>
                            <comment id="13104787" author="urandom" created="Wed, 14 Sep 2011 19:02:36 +0000"  >&lt;blockquote&gt;
&lt;p&gt;Hum, the goal of this ticket is that anyone that have started using the deb package after 0.6.4-2 have /var/&lt;/p&gt;
&lt;div class=&quot;error&quot;&gt;&lt;span class=&quot;error&quot;&gt;Unknown macro: {lib,log}&lt;/span&gt; &lt;/div&gt;
&lt;p&gt;/cassandra owned by root.root, which was not intended. So we can decide that we want to leave all those people with those &quot;wrong&quot; permissions, but it&apos;s not safer to remove the comparison now that it was when the patch was initially committed.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I think that statement was always bugged.  What it &lt;em&gt;should&lt;/em&gt; do is to ensure that /var/&lt;/p&gt;
{lib,log}
&lt;p&gt;/cassandra are owned by user cassandra on new installs only, not upgrades (allowing the user to override that ownership).&lt;/p&gt;

&lt;p&gt;At this point, I&apos;m not sure what the comparison to 0.6.4-2 was supposed to accomplish, I assume it was a (misguided )attempt at applying this policy to versions greater than or equal to 0.6.4-2 (we didn&apos;t always create the cassandra user and chown in postinst).  Either way, the current packaging will never be used to upgrade from an 0.6.x release directly, so there is no danger in removing it.&lt;/p&gt;

&lt;p&gt;So, looking at that (untested )snippet again:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;if [ -z &quot;$2&quot; ]; then
    chown -R cassandra: /var/lib/cassandra
    chown -R cassandra: /var/log/cassandra
fi
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;would only apply ownership changes if argument #2 is empty, that is to say, there is no previously configured version (i.e. not an upgrade).&lt;/p&gt;</comment>
                            <comment id="13104791" author="jsevellec" created="Wed, 14 Sep 2011 19:07:42 +0000"  >&lt;p&gt;I agree with that too&lt;/p&gt;</comment>
                            <comment id="13105042" author="shyamal" created="Thu, 15 Sep 2011 00:59:43 +0000"  >&lt;p&gt;BTW, I tested the snippet in Eric&apos;s comment with the additional pre-0.6.4-2 check (my patch) pretty extensively: install, upgrade to package with new version, remove and reinstall etc. It certainly looks right, and I am sure it works because I tried it, several ways. I did not test the upgrade from 0.6.4-2 since I did not completely understand why it was important, but I left it in once I traced it down to &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-1004&quot; title=&quot;Debian packaging should allow a specific user name and optionally create it as &amp;quot;cassandra&amp;quot; on install&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-1004&quot;&gt;&lt;del&gt;CASSANDRA-1004&lt;/del&gt;&lt;/a&gt;. As I suspected  there&apos;s people out there that know better &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;(BTW, in testing I found one minor irritation that /var/log/cassandra/output.log gets created owned by root after installation. I suspect this is because it is created before jsvc switches the user to after allowing privileged operations to complete...once I&apos;m sure the problem is real I&apos;ll file it separately....but it was a good test case for the patch!)&lt;/p&gt;
</comment>
                            <comment id="13105262" author="slebresne" created="Thu, 15 Sep 2011 10:48:30 +0000"  >&lt;blockquote&gt;&lt;p&gt;we didn&apos;t always create the cassandra user and chown in postinst&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Yes, and to make it clear what my point is: while we do create the cassandra user since 0.6.4-2, we &lt;b&gt;never&lt;/b&gt; chown in the postinst &lt;em&gt;excepted&lt;/em&gt; for people that upgraded &lt;b&gt;all the way&lt;/b&gt; since a pre 0.6.4 release. That is, any current new installation (say of 0.8.5) &lt;b&gt;does not&lt;/b&gt; chown in the postint and /var/lib/cassandra and /var/log/cassandra (the directories) are owned by root, not cassandra.&lt;/p&gt;

&lt;p&gt;Now I&apos;m perfectly fine saying that there is no point in changing things during upgrades and to only fix the chown in the postinst for new installs, but just wanted to make it clear that this has nothing to do with upgrades from some 0.6.x versions.&lt;/p&gt;

</comment>
                            <comment id="13116564" author="shyamal" created="Wed, 28 Sep 2011 15:53:23 +0000"  >&lt;p&gt;Any chance this can be fixed for the upcoming 1.0.0 release?&lt;/p&gt;</comment>
                            <comment id="13116613" author="slebresne" created="Wed, 28 Sep 2011 17:15:04 +0000"  >&lt;p&gt;Yes, there is probably no reason for not fixing this. Attaching the simple patch that only chown the directories on new installs.&lt;/p&gt;

&lt;p&gt;I still don&apos;t really understand how previous install have worked so far with /var/lib/cassandra being own by root but the cassandra process being run as the cassandra user, but it costs nothing to be conservative: let&apos;s fix it for new install and do nothing for upgrade for now.&lt;/p&gt;

&lt;p&gt;We can always keep debating on the best way to &quot;fix&quot; old installs, but let&apos;s have clean new install right now. &lt;/p&gt;</comment>
                            <comment id="13116834" author="shyamal" created="Wed, 28 Sep 2011 21:43:43 +0000"  >&lt;p&gt;Agree completely, Thanks!&lt;/p&gt;</comment>
                            <comment id="13119661" author="urandom" created="Mon, 3 Oct 2011 21:53:16 +0000"  >&lt;p&gt;committed&lt;/p&gt;</comment>
                            <comment id="13119712" author="hudson" created="Mon, 3 Oct 2011 22:57:15 +0000"  >&lt;p&gt;Integrated in Cassandra-0.8 #358 (See &lt;a href=&quot;https://builds.apache.org/job/Cassandra-0.8/358/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/Cassandra-0.8/358/&lt;/a&gt;)&lt;br/&gt;
    set ownership on new installs&lt;/p&gt;

&lt;p&gt;Patch by Sylvain Lebresne; reviewed by eevans for &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-3198&quot; title=&quot;debian packaging installation problem when installing for the first time&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-3198&quot;&gt;&lt;del&gt;CASSANDRA-3198&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;eevans : &lt;a href=&quot;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1178592&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1178592&lt;/a&gt;&lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/cassandra/branches/cassandra-0.8/debian/cassandra.postinst&lt;/li&gt;
&lt;/ul&gt;
</comment>
                    </comments>
                    <attachments>
                            <attachment id="12496899" name="3198.patch" size="735" author="slebresne" created="Wed, 28 Sep 2011 17:15:04 +0000"/>
                            <attachment id="12494343" name="debian-postinst-fixperms.patch" size="516" author="shyamal" created="Tue, 13 Sep 2011 23:35:21 +0000"/>
                            <attachment id="12494233" name="trunk-3198-v1.patch" size="495" author="jsevellec" created="Tue, 13 Sep 2011 14:15:21 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[jsevellec]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>20971</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            14 years, 8 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0ggzz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>94184</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>urandom</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[urandom]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12962"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>