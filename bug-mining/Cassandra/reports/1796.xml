<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 22:35:18 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-4621] AssertionError in StorageProxy.getRestrictedRange</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-4621</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;On a freshly built cassandra from trunk, I can create a column family with a composite row key using the syntax:&lt;/p&gt;

&lt;p&gt;for instance a standard eventlog CF:&lt;/p&gt;

&lt;p&gt;     CREATE TABLE events (&lt;br/&gt;
       facility text,&lt;br/&gt;
       prio int,&lt;br/&gt;
       message text,&lt;br/&gt;
       PRIMARY KEY ( (facility, prio) )&lt;br/&gt;
     );&lt;/p&gt;

&lt;p&gt;A simple query will then generate exceptions:&lt;/p&gt;

&lt;p&gt;SELECT * FROM events; will yield:&lt;/p&gt;

&lt;p&gt;ERROR 15:33:40,383 Exception in thread Thread&lt;span class=&quot;error&quot;&gt;&amp;#91;Thrift:1,5,main&amp;#93;&lt;/span&gt;&lt;br/&gt;
java.lang.AssertionError: &lt;span class=&quot;error&quot;&gt;&amp;#91;min(0),max(-8021625467324731134)&amp;#93;&lt;/span&gt;&lt;br/&gt;
	at org.apache.cassandra.dht.Bounds.&amp;lt;init&amp;gt;(Bounds.java:41)&lt;br/&gt;
	at org.apache.cassandra.dht.Bounds.split(Bounds.java:59)&lt;br/&gt;
	at org.apache.cassandra.service.StorageProxy.getRestrictedRanges(StorageProxy.java:1073)&lt;br/&gt;
	at org.apache.cassandra.service.StorageProxy.getRangeSlice(StorageProxy.java:879)&lt;br/&gt;
	at org.apache.cassandra.cql3.statements.SelectStatement.multiRangeSlice(SelectStatement.java:209)&lt;br/&gt;
	at org.apache.cassandra.cql3.statements.SelectStatement.executeInternal(SelectStatement.java:128)&lt;br/&gt;
	at org.apache.cassandra.cql3.statements.SelectStatement.execute(SelectStatement.java:118)&lt;br/&gt;
	at org.apache.cassandra.cql3.statements.SelectStatement.execute(SelectStatement.java:62)&lt;br/&gt;
	at org.apache.cassandra.cql3.QueryProcessor.processStatement(QueryProcessor.java:107)&lt;br/&gt;
	at org.apache.cassandra.cql3.QueryProcessor.process(QueryProcessor.java:115)&lt;br/&gt;
	at org.apache.cassandra.thrift.CassandraServer.execute_cql_query(CassandraServer.java:1521)&lt;br/&gt;
	at org.apache.cassandra.thrift.Cassandra$Processor$execute_cql_query.getResult(Cassandra.java:3618)&lt;br/&gt;
	at org.apache.cassandra.thrift.Cassandra$Processor$execute_cql_query.getResult(Cassandra.java:3606)&lt;br/&gt;
	at org.apache.thrift.ProcessFunction.process(ProcessFunction.java:32)&lt;br/&gt;
	at org.apache.thrift.TBaseProcessor.process(TBaseProcessor.java:34)&lt;br/&gt;
	at org.apache.cassandra.thrift.CustomTThreadPoolServer$WorkerProcess.run(CustomTThreadPoolServer.java:184)&lt;br/&gt;
	at java.util.concurrent.ThreadPoolExecutor.runWorker(Unknown Source)&lt;br/&gt;
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(Unknown Source)&lt;br/&gt;
	at java.lang.Thread.run(Unknown Source)&lt;/p&gt;
</description>
                <environment>&lt;p&gt;archlinux, openjdk7&lt;/p&gt;</environment>
        <key id="12606245">CASSANDRA-4621</key>
            <summary>AssertionError in StorageProxy.getRestrictedRange</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10002" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Normal</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="slebresne">Sylvain Lebresne</assignee>
                                    <reporter username="pyritschard">Pierre-Yves Ritschard</reporter>
                        <labels>
                    </labels>
                <created>Wed, 5 Sep 2012 13:35:40 +0000</created>
                <updated>Tue, 16 Apr 2019 09:32:28 +0000</updated>
                            <resolved>Tue, 18 Sep 2012 14:42:39 +0000</resolved>
                                        <fixVersion>1.2.0 beta 1</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="13452253" author="slebresne" created="Mon, 10 Sep 2012 18:05:15 +0000"  >&lt;p&gt;Pretty sure this has nothing to do with CQL. But the trace shows a token that is negative, which should not happen. So my guess is that it&apos;s because the new Murmur3Partitioner can generate negative token while it shouldn&apos;t. Patch attached to fix (there was 2 places where a negative could be generated, one was because the special case of Long.MIN_VALUE wasn&apos;t handled, the other was that we weren&apos;t taking the absolute value at all for random token. Both should be fixed though this is probably the latter that produced the error here since it&apos;s way more likely to happen).&lt;/p&gt;</comment>
                            <comment id="13452258" author="jbellis" created="Mon, 10 Sep 2012 18:10:37 +0000"  >&lt;p&gt;What if we just made the minimum token for M3P Long.MIN_VALUE instead?&lt;/p&gt;</comment>
                            <comment id="13452269" author="slebresne" created="Mon, 10 Sep 2012 18:17:48 +0000"  >&lt;p&gt;A priori, I don&apos;t think that would be a problem (and if it&apos;s fine we should). We could also avoid using BigInteger to generate the middle of two longs &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="13452270" author="slebresne" created="Mon, 10 Sep 2012 18:18:20 +0000"  >&lt;p&gt;(I&apos;ll have a shot at both)&lt;/p&gt;</comment>
                            <comment id="13452286" author="slebresne" created="Mon, 10 Sep 2012 18:37:21 +0000"  >&lt;p&gt;I also think that it&apos;s a problem that Murmur3Partitioner has a MINIMUM token that is a &quot;valid&quot; token (one that correspond to actual keys). Indeed (min, X] is suppose to include everything smaller than token X, but if min is a actual token, it is not contained in (min, X]. &lt;/p&gt;</comment>
                            <comment id="13452290" author="jbellis" created="Mon, 10 Sep 2012 18:38:58 +0000"  >&lt;p&gt;Hmm.  Forgot that we changed MINIMUM to &amp;lt; ZERO for RP.&lt;/p&gt;</comment>
                            <comment id="13452829" author="slebresne" created="Tue, 11 Sep 2012 09:00:06 +0000"  >&lt;p&gt;Attaching patch that:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;Don&apos;t force positive tokens in Murmur3Partitioner (thus using all the bits of the LongToken).&lt;/li&gt;
	&lt;li&gt;Exclude Long.MIN_VALUE from the possible tokens of a key (since it&apos;s now the MINIMUM token).&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;I note that this means tokens can be negative and that we&apos;ll have to update a number of documentation relating to computing tokens. Though this was already the case before this patch (but maybe to a slightly lesser extend). And hopefully vnodes will make (manual) token computations a thing of the past.&lt;/p&gt;</comment>
                            <comment id="13453101" author="jbellis" created="Tue, 11 Sep 2012 15:26:37 +0000"  >&lt;p&gt;LGTM.&lt;/p&gt;</comment>
                            <comment id="13453122" author="slebresne" created="Tue, 11 Sep 2012 15:44:18 +0000"  >&lt;p&gt;Committed, thanks&lt;/p&gt;</comment>
                            <comment id="13457715" author="slebresne" created="Tue, 18 Sep 2012 09:28:07 +0000"  >&lt;p&gt;Reopening this since the midpoint calculation for murmur3Partitioner is actually broken by having negative tokens (concretely, Murmur3PartitionerTest is failing). Attaching patch to fix it.&lt;/p&gt;</comment>
                            <comment id="13457859" author="jbellis" created="Tue, 18 Sep 2012 14:42:39 +0000"  >&lt;p&gt;committed w/ additional comments&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12545544" name="4621-followup.txt" size="1187" author="slebresne" created="Tue, 18 Sep 2012 09:28:16 +0000"/>
                            <attachment id="12544611" name="4621.txt" size="2760" author="slebresne" created="Tue, 11 Sep 2012 09:00:06 +0000"/>
                            <attachment id="12544496" name="4621.txt" size="1799" author="slebresne" created="Mon, 10 Sep 2012 18:05:15 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[slebresne]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>256292</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            13 years, 10 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0gxrr:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>96901</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>jbellis</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[jbellis]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12962"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>