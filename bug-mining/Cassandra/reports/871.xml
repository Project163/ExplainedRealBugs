<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 22:20:44 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-2528] NPE from PrecompactedRow</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-2528</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;received a NPE from trunk (0.8) on PrecompactedRow:&lt;/p&gt;

&lt;p&gt;ERROR &lt;span class=&quot;error&quot;&gt;&amp;#91;CompactionExecutor:2&amp;#93;&lt;/span&gt; 2011-04-21 17:21:31,610 AbstractCassandraDaemon.java (line 112) Fatal exception in thread Thread&lt;span class=&quot;error&quot;&gt;&amp;#91;CompactionExecutor:2,1,main&amp;#93;&lt;/span&gt;&lt;br/&gt;
java.lang.NullPointerException&lt;br/&gt;
        at org.apache.cassandra.io.PrecompactedRow.&amp;lt;init&amp;gt;(PrecompactedRow.java:86)&lt;br/&gt;
        at org.apache.cassandra.io.CompactionIterator.getCompactedRow(CompactionIterator.java:167)&lt;br/&gt;
        at org.apache.cassandra.io.CompactionIterator.getReduced(CompactionIterator.java:124)&lt;br/&gt;
        at org.apache.cassandra.io.CompactionIterator.getReduced(CompactionIterator.java:44)&lt;br/&gt;
        at org.apache.cassandra.utils.ReducingIterator.computeNext(ReducingIterator.java:74)&lt;br/&gt;
        at com.google.common.collect.AbstractIterator.tryToComputeNext(AbstractIterator.java:140)&lt;br/&gt;
        at com.google.common.collect.AbstractIterator.hasNext(AbstractIterator.java:135)&lt;br/&gt;
        at org.apache.commons.collections.iterators.FilterIterator.setNextObject(FilterIterator.java:183)&lt;br/&gt;
        at org.apache.commons.collections.iterators.FilterIterator.hasNext(FilterIterator.java:94)&lt;br/&gt;
        at org.apache.cassandra.db.CompactionManager.doCompaction(CompactionManager.java:553)&lt;br/&gt;
        at org.apache.cassandra.db.CompactionManager$1.call(CompactionManager.java:146)&lt;br/&gt;
        at org.apache.cassandra.db.CompactionManager$1.call(CompactionManager.java:112)&lt;br/&gt;
        at java.util.concurrent.FutureTask$Sync.innerRun(FutureTask.java:303)&lt;br/&gt;
        at java.util.concurrent.FutureTask.run(FutureTask.java:138)&lt;br/&gt;
        at java.util.concurrent.ThreadPoolExecutor$Worker.runTask(ThreadPoolExecutor.java:886)&lt;br/&gt;
        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:908)&lt;br/&gt;
        at java.lang.Thread.run(Thread.java:662)&lt;/p&gt;


&lt;p&gt;size of data in /var/lib/cassandra is 11G on this, but there is also report that 1.7G also see the same.&lt;/p&gt;

&lt;p&gt;data was previously populated from 0.7.4 cassandra&lt;/p&gt;

&lt;p&gt;added debug logging, not sure how much this help (this is logged before the exception.)&lt;/p&gt;

&lt;p&gt; INFO &lt;span class=&quot;error&quot;&gt;&amp;#91;CompactionExecutor:2&amp;#93;&lt;/span&gt; 2011-04-21 17:21:31,588 CompactionManager.java (line 534) Compacting Major: &lt;span class=&quot;error&quot;&gt;&amp;#91;SSTableReader(path=&amp;#39;/var/lib/cassandra/data/cfs/inode.path-f-10-Data.db&amp;#39;), SSTableReader(path=&amp;#39;/var/lib/cassandra/data/cfs/inode.path-f-7-Data.db&amp;#39;), SSTableReader(path=&amp;#39;/var/lib/cassandra/data/cfs/inode.path-f-6-Data.db&amp;#39;), SSTableReader(path=&amp;#39;/var/lib/cassandra/data/cfs/inode.path-f-8-Data.db&amp;#39;), SSTableReader(path=&amp;#39;/var/lib/cassandra/data/cfs/inode.path-f-9-Data.db&amp;#39;)&amp;#93;&lt;/span&gt;&lt;br/&gt;
DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;CompactionExecutor:2&amp;#93;&lt;/span&gt; 2011-04-21 17:21:31,588 SSTableReader.java (line 132) index size for bloom filter calc for file  : /var/lib/cassandra/data/cfs/inode.path-f-10-Data.db   : 256&lt;br/&gt;
DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;CompactionExecutor:2&amp;#93;&lt;/span&gt; 2011-04-21 17:21:31,588 SSTableReader.java (line 132) index size for bloom filter calc for file  : /var/lib/cassandra/data/cfs/inode.path-f-7-Data.db   : 512&lt;br/&gt;
DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;CompactionExecutor:2&amp;#93;&lt;/span&gt; 2011-04-21 17:21:31,588 SSTableReader.java (line 132) index size for bloom filter calc for file  : /var/lib/cassandra/data/cfs/inode.path-f-6-Data.db   : 768&lt;br/&gt;
DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;CompactionExecutor:2&amp;#93;&lt;/span&gt; 2011-04-21 17:21:31,589 SSTableReader.java (line 132) index size for bloom filter calc for file  : /var/lib/cassandra/data/cfs/inode.path-f-8-Data.db   : 1024&lt;br/&gt;
DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;CompactionExecutor:2&amp;#93;&lt;/span&gt; 2011-04-21 17:21:31,589 SSTableReader.java (line 132) index size for bloom filter calc for file  : /var/lib/cassandra/data/cfs/inode.path-f-9-Data.db   : 1280&lt;br/&gt;
 INFO &lt;span class=&quot;error&quot;&gt;&amp;#91;CompactionExecutor:2&amp;#93;&lt;/span&gt; 2011-04-21 17:21:31,609 CompactionIterator.java (line 185) Major@1181554512(cfs, inode.path, 523/10895) now compacting at 16777 bytes/ms.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12504909">CASSANDRA-2528</key>
            <summary>NPE from PrecompactedRow</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10002" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Normal</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="jbellis">Jonathan Ellis</assignee>
                                    <reporter username="cywjackson">Jackson Chung</reporter>
                        <labels>
                    </labels>
                <created>Thu, 21 Apr 2011 17:55:31 +0000</created>
                <updated>Tue, 16 Apr 2019 09:33:01 +0000</updated>
                            <resolved>Thu, 21 Apr 2011 22:48:33 +0000</resolved>
                                        <fixVersion>0.8.0 beta 2</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                                                                <comments>
                            <comment id="13022863" author="patricioe" created="Thu, 21 Apr 2011 18:29:22 +0000"  >&lt;p&gt;I&apos;m seeing the same stacktrace when writing 1GB of data. &lt;/p&gt;</comment>
                            <comment id="13022878" author="jbellis" created="Thu, 21 Apr 2011 19:18:30 +0000"  >&lt;p&gt;can you try w/ this patch?  it adds additional asserts to narrow down where the error is&lt;/p&gt;</comment>
                            <comment id="13022884" author="cywjackson" created="Thu, 21 Apr 2011 19:38:11 +0000"  >&lt;p&gt;sure, here is the Assertion Error, the null is on metadata:&lt;/p&gt;</comment>
                            <comment id="13022885" author="cywjackson" created="Thu, 21 Apr 2011 19:38:21 +0000"  >&lt;p&gt;DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;CompactionExecutor:2&amp;#93;&lt;/span&gt; 2011-04-21 19:31:46,797 PrecompactedRow.java (line 85) debugging controoler true&lt;br/&gt;
DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;CompactionExecutor:2&amp;#93;&lt;/span&gt; 2011-04-21 19:31:46,798 PrecompactedRow.java (line 87) debugging compactedCF: ColumnFamily(&amp;lt;anonymous&amp;gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;3636363663643736663936393536343639653762653339643735306363376439:false:0@1303340825329,&amp;#93;&lt;/span&gt;)&lt;br/&gt;
 INFO &lt;span class=&quot;error&quot;&gt;&amp;#91;CompactionExecutor:2&amp;#93;&lt;/span&gt; 2011-04-21 19:31:46,799 CompactionIterator.java (line 185) Major@31583366(cfs, inode.path, 772/11720) now compacting at 8388 bytes/ms.&lt;br/&gt;
ERROR &lt;span class=&quot;error&quot;&gt;&amp;#91;CompactionExecutor:2&amp;#93;&lt;/span&gt; 2011-04-21 19:31:46,850 AbstractCassandraDaemon.java (line 112) Fatal exception in thread Thread&lt;span class=&quot;error&quot;&gt;&amp;#91;CompactionExecutor:2,1,main&amp;#93;&lt;/span&gt;&lt;br/&gt;
java.lang.AssertionError&lt;br/&gt;
    at org.apache.cassandra.io.PrecompactedRow.&amp;lt;init&amp;gt;(PrecompactedRow.java:91)&lt;br/&gt;
    at org.apache.cassandra.io.CompactionIterator.getCompactedRow(CompactionIterator.java:167)&lt;br/&gt;
    at org.apache.cassandra.io.CompactionIterator.getReduced(CompactionIterator.java:124)&lt;br/&gt;
    at org.apache.cassandra.io.CompactionIterator.getReduced(CompactionIterator.java:44)&lt;br/&gt;
    at org.apache.cassandra.utils.ReducingIterator.computeNext(ReducingIterator.java:74)&lt;br/&gt;
    at com.google.common.collect.AbstractIterator.tryToComputeNext(AbstractIterator.java:140)&lt;br/&gt;
    at com.google.common.collect.AbstractIterator.hasNext(AbstractIterator.java:135)&lt;br/&gt;
    at org.apache.commons.collections.iterators.FilterIterator.setNextObject(FilterIterator.java:183)&lt;br/&gt;
    at org.apache.commons.collections.iterators.FilterIterator.hasNext(FilterIterator.java:94)&lt;br/&gt;
    at org.apache.cassandra.db.CompactionManager.doCompaction(CompactionManager.java:553)&lt;br/&gt;
    at org.apache.cassandra.db.CompactionManager$1.call(CompactionManager.java:146)&lt;br/&gt;
    at org.apache.cassandra.db.CompactionManager$1.call(CompactionManager.java:112)&lt;br/&gt;
    at java.util.concurrent.FutureTask$Sync.innerRun(FutureTask.java:303)&lt;br/&gt;
    at java.util.concurrent.FutureTask.run(FutureTask.java:138)&lt;br/&gt;
    at java.util.concurrent.ThreadPoolExecutor$Worker.runTask(ThreadPoolExecutor.java:886)&lt;br/&gt;
    at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:908)&lt;br/&gt;
    at java.lang.Thread.run(Thread.java:662)&lt;/p&gt;</comment>
                            <comment id="13022886" author="cywjackson" created="Thu, 21 Apr 2011 19:39:20 +0000"  >&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeHeader panelHeader&quot; style=&quot;border-bottom-width: 1px;&quot;&gt;&lt;b&gt;PrepcompactedRow.java&lt;/b&gt;&lt;/div&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;    85          logger.debug(&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;.format(&lt;span class=&quot;code-quote&quot;&gt;&quot;debugging controoler %b&quot;&lt;/span&gt;, controller.shouldPurge(key)));
    86          compactedCf = controller.shouldPurge(key) ? ColumnFamilyStore.removeDeleted(cf, controller.gcBefore) : cf;
    87          logger.debug(&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;.format(&lt;span class=&quot;code-quote&quot;&gt;&quot;debugging compactedCF: %s&quot;&lt;/span&gt;, compactedCf.toString()));
    88          &lt;span class=&quot;code-comment&quot;&gt;//&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (compactedCf != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; &amp;amp;&amp;amp; compactedCf.metadata().getDefaultValidator().isCommutative())
&lt;/span&gt;    89          &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (compactedCf != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;)
    90          {
    91                  &lt;span class=&quot;code-keyword&quot;&gt;assert&lt;/span&gt; compactedCf.metadata() != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;;
    92                  &lt;span class=&quot;code-keyword&quot;&gt;assert&lt;/span&gt; compactedCf.metadata().getDefaultValidator() != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;;
    93                  &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (compactedCf.metadata().getDefaultValidator().isCommutative())
    94                  {
    95                          CounterColumn.removeOldShards(compactedCf, controller.gcBefore);
    96                  }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="13022887" author="cywjackson" created="Thu, 21 Apr 2011 19:40:21 +0000"  >&lt;p&gt;$ grep java.lang.AssertionError -A3 /var/log/cassandra/system.log &lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;
java.lang.AssertionError
        at org.apache.cassandra.io.PrecompactedRow.&amp;lt;init&amp;gt;(PrecompactedRow.java:91)
        at org.apache.cassandra.io.CompactionIterator.getCompactedRow(CompactionIterator.java:167)
        at org.apache.cassandra.io.CompactionIterator.getReduced(CompactionIterator.java:124)
--
java.lang.AssertionError
        at org.apache.cassandra.io.PrecompactedRow.&amp;lt;init&amp;gt;(PrecompactedRow.java:91)
        at org.apache.cassandra.io.CompactionIterator.getCompactedRow(CompactionIterator.java:167)
        at org.apache.cassandra.io.CompactionIterator.getReduced(CompactionIterator.java:124)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="13022919" author="jbellis" created="Thu, 21 Apr 2011 21:04:01 +0000"  >&lt;p&gt;Patch to preserve the CFMetaData object used to construct the ColumnFamily, instead of looking it up from the registry (which does not contain metadata for index CFs).&lt;/p&gt;</comment>
                            <comment id="13022962" author="cywjackson" created="Thu, 21 Apr 2011 22:38:11 +0000"  >&lt;p&gt;the fix does address the NPE as now all CF has metadata.&lt;/p&gt;</comment>
                            <comment id="13022966" author="jbellis" created="Thu, 21 Apr 2011 22:48:33 +0000"  >&lt;p&gt;committed&lt;/p&gt;</comment>
                            <comment id="13022977" author="hudson" created="Thu, 21 Apr 2011 23:18:50 +0000"  >&lt;p&gt;Integrated in Cassandra-0.8 #32 (See &lt;a href=&quot;https://builds.apache.org/hudson/job/Cassandra-0.8/32/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/hudson/job/Cassandra-0.8/32/&lt;/a&gt;)&lt;br/&gt;
    fix NPE compacting index CFs&lt;br/&gt;
patch by jbellis; reviewed by Jackson Chung for &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-2528&quot; title=&quot;NPE from PrecompactedRow&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-2528&quot;&gt;&lt;del&gt;CASSANDRA-2528&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12477037" name="2528.txt" size="5653" author="jbellis" created="Thu, 21 Apr 2011 21:04:01 +0000"/>
                            <attachment id="12477027" name="2528.txt" size="998" author="jbellis" created="Thu, 21 Apr 2011 19:18:30 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[jbellis]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>20676</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            14 years, 31 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0gbw7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>93357</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>cywjackson</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[cywjackson]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12962"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>