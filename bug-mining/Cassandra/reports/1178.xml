<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 22:23:49 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-3243] Node which was decommissioned and shut-down reappears on a single node</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-3243</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;I decommissioned a node several days ago. It was no longer in the ring list on any node in the ring. However, it was in the dead gossip list.&lt;/p&gt;

&lt;p&gt;In an attempt to clean it out of the dead gossip list so I could truncate, I shut down the entire ring and bought it back up. Once the ring came back up, one node showed the decommissioned node as still in the ring in a state of &apos;Down&apos;. No other node in the ring shows this info.&lt;/p&gt;

&lt;p&gt;I successfully ran removetoken on the node to get that phantom node out. However, it is back in the dead gossip list, preventing me from truncating.&lt;/p&gt;

&lt;p&gt;Where might the info on this decommissioned node be being stored? Is HH possibly trying to deliver to the removed node, thus putting it back in the ring on one node?&lt;/p&gt;

&lt;p&gt;I find it extremely curious that none of the other nodes in the ring showed the phantom node. Shouldn&apos;t gossip have propagated the node everywhere, even if it was down?&lt;/p&gt;</description>
                <environment></environment>
        <key id="12524242">CASSANDRA-3243</key>
            <summary>Node which was decommissioned and shut-down reappears on a single node</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10003" iconUrl="https://issues.apache.org/jira/images/icons/priorities/trivial.svg">Low</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="brandon.williams">Brandon Williams</assignee>
                                    <reporter username="alienth">Jason Harvey</reporter>
                        <labels>
                    </labels>
                <created>Thu, 22 Sep 2011 07:19:44 +0000</created>
                <updated>Tue, 16 Apr 2019 09:32:50 +0000</updated>
                            <resolved>Fri, 30 Sep 2011 20:15:08 +0000</resolved>
                                        <fixVersion>0.8.7</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                                                                <comments>
                            <comment id="13112382" author="alienth" created="Thu, 22 Sep 2011 07:27:04 +0000"  >&lt;p&gt;Looking through the logs, the node which saw the decommissioned node didn&apos;t print anything about discovering it via gossip. The very first log line I have regarding the phantom node is when I forced a removetoken.&lt;/p&gt;</comment>
                            <comment id="13112460" author="brandon.williams" created="Thu, 22 Sep 2011 10:32:45 +0000"  >&lt;p&gt;Can you explain what you mean by &quot;dead gossip list&quot; and how this prevents truncate?&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;Where might the info on this decommissioned node be being stored?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;After &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-2496&quot; title=&quot;Gossip should handle &amp;#39;dead&amp;#39; states&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-2496&quot;&gt;&lt;del&gt;CASSANDRA-2496&lt;/del&gt;&lt;/a&gt;, we store dead gossip states for 3 days, so that any other nodes that were down at the time of removal can know later not to repopulate the ring with the removed node, but this isn&apos;t persisted anywhere, so since you did a full ring restart, the only candidate left is the persisted endpoints, though all nodes should have removed it from there after the decommission/removetoken.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;Is HH possibly trying to deliver to the removed node, thus putting it back in the ring on one node?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;No, HH will only attempt delivery on an onAlive event, and it doesn&apos;t inject any gossip states.&lt;/p&gt;</comment>
                            <comment id="13112852" author="alienth" created="Thu, 22 Sep 2011 19:39:11 +0000"  >&lt;blockquote&gt;&lt;p&gt;Can you explain what you mean by &quot;dead gossip list&quot; and how this prevents truncate?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;The decommissioned node is showing up in the &apos;UNREACHABLE&apos; list when calling &apos;describe cluster&apos;. When I attempt to run truncate, the command returns that truncate cannot occur due to a node being down.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;After &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-2496&quot; title=&quot;Gossip should handle &amp;#39;dead&amp;#39; states&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-2496&quot;&gt;&lt;del&gt;CASSANDRA-2496&lt;/del&gt;&lt;/a&gt;, we store dead gossip states for 3 days, so that any other nodes that were down at the time of removal can know later not to repopulate the ring with the removed node, but this isn&apos;t persisted anywhere, so since you did a full ring restart, the only candidate left is the persisted endpoints, though all nodes should have removed it from there after the decommission/removetoken.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Is there a way I can get a list of endpoints to see how this node showed back up?&lt;/p&gt;


&lt;p&gt;Also, any thoughts on why this node only re-appeared on a single node?&lt;/p&gt;

&lt;p&gt;Thanks!&lt;br/&gt;
Jason&lt;/p&gt;</comment>
                            <comment id="13112970" author="brandon.williams" created="Thu, 22 Sep 2011 22:29:16 +0000"  >&lt;blockquote&gt;&lt;p&gt;Is there a way I can get a list of endpoints to see how this node showed back up?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;It must be a saved endpoint, if you can attached the latest LocationInfo sstable from that machine (and tell me the IP and/or token) I can take a look.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;Also, any thoughts on why this node only re-appeared on a single node?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I&apos;m not sure, let&apos;s see if it was still persisted first.&lt;/p&gt;</comment>
                            <comment id="13113173" author="alienth" created="Fri, 23 Sep 2011 06:00:13 +0000"  >&lt;p&gt;LocationInfo from the node which re-added the dead node back to the ring.&lt;/p&gt;

&lt;p&gt;This LocationInfo is from &lt;b&gt;after&lt;/b&gt; the decommission of the phantom node, but before the restart which resulted in the node re-adding the phantom node.&lt;/p&gt;

&lt;p&gt;The phantom node&apos;s token was 120000000000000000000000000000000000000.&lt;/p&gt;</comment>
                            <comment id="13113174" author="alienth" created="Fri, 23 Sep 2011 06:00:50 +0000"  >&lt;p&gt;LocationInfo from the node which re-added the dead node back to the ring.&lt;/p&gt;

&lt;p&gt;This LocationInfo is from &lt;b&gt;after&lt;/b&gt; the restart which resulted in the phantom node re-appearing. It is also after the forced token removal of the phantom node.&lt;/p&gt;

&lt;p&gt;The phantom node&apos;s token was 120000000000000000000000000000000000000.&lt;/p&gt;</comment>
                            <comment id="13113713" author="brandon.williams" created="Fri, 23 Sep 2011 20:02:59 +0000"  >&lt;p&gt;0919 is missing the LOCATION_KEY (the node&apos;s own token) which is odd, because cassandra will refuse to startup with this table since it should not exist without this key. It does show itself in the saved endpoints, but no other nodes.&lt;/p&gt;

&lt;p&gt;0922 is complete in that it contains LOCATION_KEY and cassandra starts right up with it, and I can see the removed token in the saved endpoints with an ip address of 10.34.22.201.  However the strange thing is the timestamp on that column is approximately 2 days &lt;em&gt;older&lt;/em&gt; than the one for the local node itself, which should be impossible.  Is there any chance this node&apos;s clock was way off or changed?&lt;/p&gt;</comment>
                            <comment id="13113812" author="alienth" created="Fri, 23 Sep 2011 22:28:14 +0000"  >&lt;p&gt;Clock on these boxes seems fine. We keep ntpd running at all times. I&apos;ve also verified via logging that it has been consistent.&lt;/p&gt;

&lt;p&gt;How do I go about getting that endpoint &lt;b&gt;out&lt;/b&gt; of the LocationInfo?&lt;/p&gt;</comment>
                            <comment id="13113819" author="alienth" created="Fri, 23 Sep 2011 23:03:58 +0000"  >&lt;p&gt;For outside reference:&lt;/p&gt;

&lt;p&gt;Brandon recommended I delete the &apos;Ring&apos; key from the LocationInfo on this node and then restart to resolve the weirdness.&lt;/p&gt;</comment>
                            <comment id="13113827" author="brandon.williams" created="Fri, 23 Sep 2011 23:16:47 +0000"  >&lt;p&gt;The best explanation I have for how you could get here is that SystemTable only forces a flush on the updateToken(Token token) signature.  removeToken and updateToken(InetAddress ep, Token token) do not, so if the machine is restarted before the commitlog is synced, the update/removal can be lost.  Patch to address this.&lt;/p&gt;</comment>
                            <comment id="13118360" author="bcoverston" created="Fri, 30 Sep 2011 20:05:37 +0000"  >&lt;p&gt;+1 on the patch&lt;/p&gt;</comment>
                            <comment id="13118381" author="brandon.williams" created="Fri, 30 Sep 2011 20:15:08 +0000"  >&lt;p&gt;Committed.  Please reopen if you see this again after 0.8.7.&lt;/p&gt;</comment>
                            <comment id="13118490" author="hudson" created="Fri, 30 Sep 2011 21:49:04 +0000"  >&lt;p&gt;Integrated in Cassandra-0.8 #351 (See &lt;a href=&quot;https://builds.apache.org/job/Cassandra-0.8/351/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/Cassandra-0.8/351/&lt;/a&gt;)&lt;br/&gt;
    Flush system table after updating or removing tokens.&lt;br/&gt;
Patch by brandonwilliams, reviewed by Ben Coverston for &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-3243&quot; title=&quot;Node which was decommissioned and shut-down reappears on a single node&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-3243&quot;&gt;&lt;del&gt;CASSANDRA-3243&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;brandonwilliams : &lt;a href=&quot;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1177810&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1177810&lt;/a&gt;&lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/cassandra/branches/cassandra-0.8/src/java/org/apache/cassandra/db/SystemTable.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                    </comments>
                    <attachments>
                            <attachment id="12496337" name="3243.txt" size="669" author="brandon.williams" created="Fri, 23 Sep 2011 23:16:47 +0000"/>
                            <attachment id="12496228" name="locationinfo_0919.tgz" size="1057" author="alienth" created="Fri, 23 Sep 2011 06:00:13 +0000"/>
                            <attachment id="12496229" name="locationinfo_0922.tgz" size="1673" author="alienth" created="Fri, 23 Sep 2011 06:00:50 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[brandon.williams]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3528</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            14 years, 8 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0ghjr:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>94273</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>bcoverston</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[bcoverston]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12961"><![CDATA[Low]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>