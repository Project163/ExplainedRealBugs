<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 22:57:30 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-9414] Windows: deleteWithConfirm errors on various unit tests</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-9414</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;Failure is intermittent enough that bisect is proving to be more hassle than it&apos;s worth. Seems pretty consistent in CI.&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;    [junit] Testcase: testDeleteIfNotDirty(org.apache.cassandra.db.CommitLogTest):      Caused an ERROR
    [junit] java.nio.file.AccessDeniedException: build\test\cassandra\commitlog;0\CommitLog-5-1431965988394.log
    [junit] FSWriteError in build\test\cassandra\commitlog;0\CommitLog-5-1431965988394.log
    [junit]     at org.apache.cassandra.io.util.FileUtils.deleteWithConfirm(FileUtils.java:131)
    [junit]     at org.apache.cassandra.io.util.FileUtils.deleteWithConfirm(FileUtils.java:148)
    [junit]     at org.apache.cassandra.db.commitlog.CommitLogSegmentManager.recycleSegment(CommitLogSegmentManager.java:360)
    [junit]     at org.apache.cassandra.db.commitlog.CommitLog.recover(CommitLog.java:166)
    [junit]     at org.apache.cassandra.db.commitlog.CommitLog.startUnsafe(CommitLog.java:416)
    [junit]     at org.apache.cassandra.db.commitlog.CommitLog.resetUnsafe(CommitLog.java:389)
    [junit]     at org.apache.cassandra.db.CommitLogTest.testDeleteIfNotDirty(CommitLogTest.java:178)
    [junit] Caused by: java.nio.file.AccessDeniedException: build\test\cassandra\commitlog;0\CommitLog-5-1431965988394.log
    [junit]     at sun.nio.fs.WindowsException.translateToIOException(WindowsException.java:83)
    [junit]     at sun.nio.fs.WindowsException.rethrowAsIOException(WindowsException.java:97)
    [junit]     at sun.nio.fs.WindowsException.rethrowAsIOException(WindowsException.java:102)
    [junit]     at sun.nio.fs.WindowsFileSystemProvider.implDelete(WindowsFileSystemProvider.java:269)
    [junit]     at sun.nio.fs.AbstractFileSystemProvider.delete(AbstractFileSystemProvider.java:103)
    [junit]     at java.nio.file.Files.delete(Files.java:1126)
    [junit]     at org.apache.cassandra.io.util.FileUtils.deleteWithConfirm(FileUtils.java:125)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="12830731">CASSANDRA-9414</key>
            <summary>Windows: deleteWithConfirm errors on various unit tests</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10003" iconUrl="https://issues.apache.org/jira/images/icons/priorities/trivial.svg">Low</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="jmckenzie">Josh McKenzie</assignee>
                                    <reporter username="jmckenzie">Josh McKenzie</reporter>
                        <labels>
                            <label>Windows</label>
                    </labels>
                <created>Mon, 18 May 2015 16:21:49 +0000</created>
                <updated>Wed, 15 Oct 2025 09:49:06 +0000</updated>
                            <resolved>Fri, 28 Aug 2015 15:05:23 +0000</resolved>
                                        <fixVersion>2.2.2</fixVersion>
                                    <component>Legacy/Local Write-Read Paths</component>
                    <component>Legacy/Testing</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="14550572" author="jmckenzie" created="Tue, 19 May 2015 15:00:12 +0000"  >&lt;p&gt;No longer occurring either locally or on CI box on 15 runs (was about 90% failure rate when I opened this ticket).&lt;/p&gt;

&lt;p&gt;Closing as Not a Problem as there&apos;s enough other things to fix (see &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-9418&quot; title=&quot;Fix dtests on 2.2 branch on Windows&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-9418&quot;&gt;&lt;del&gt;CASSANDRA-9418&lt;/del&gt;&lt;/a&gt;) that it&apos;s not worth chasing a transient utest failure right now.&lt;/p&gt;</comment>
                            <comment id="14628226" author="jmckenzie" created="Wed, 15 Jul 2015 15:22:09 +0000"  >&lt;p&gt;Looks like this one&apos;s back with more consistency:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;   [junit] Testcase: testTruncateWithoutSnapshotNonDurable(org.apache.cassandra.db.CommitLogTest): Caused an ERROR
    [junit] java.nio.file.AccessDeniedException: build\test\cassandra\commitlog;0\CommitLog-5-1436973311962.log
    [junit] FSWriteError in build\test\cassandra\commitlog;0\CommitLog-5-1436973311962.log
    [junit]     at org.apache.cassandra.io.util.FileUtils.deleteWithConfirm(FileUtils.java:132)
    [junit]     at org.apache.cassandra.io.util.FileUtils.deleteWithConfirm(FileUtils.java:149)
    [junit]     at org.apache.cassandra.db.commitlog.CommitLogSegmentManager.recycleSegment(CommitLogSegmentManager.java:359)
    [junit]     at org.apache.cassandra.db.commitlog.CommitLog.recover(CommitLog.java:167)
    [junit]     at org.apache.cassandra.db.commitlog.CommitLog.startUnsafe(CommitLog.java:439)
    [junit]     at org.apache.cassandra.db.commitlog.CommitLog.resetUnsafe(CommitLog.java:412)
    [junit]     at org.apache.cassandra.db.CommitLogTest.testTruncateWithoutSnapshotNonDurable(CommitLogTest.java:345)
    [junit] Caused by: java.nio.file.AccessDeniedException: build\test\cassandra\commitlog;0\CommitLog-5-1436973311962.log
    [junit]     at sun.nio.fs.WindowsException.translateToIOException(WindowsException.java:83)
    [junit]     at sun.nio.fs.WindowsException.rethrowAsIOException(WindowsException.java:97)
    [junit]     at sun.nio.fs.WindowsException.rethrowAsIOException(WindowsException.java:102)
    [junit]     at sun.nio.fs.WindowsFileSystemProvider.implDelete(WindowsFileSystemProvider.java:269)
    [junit]     at sun.nio.fs.AbstractFileSystemProvider.delete(AbstractFileSystemProvider.java:103)
    [junit]     at java.nio.file.Files.delete(Files.java:1126)
    [junit]     at org.apache.cassandra.io.util.FileUtils.deleteWithConfirm(FileUtils.java:126)

    [junit] ------------- ---------------- ---------------
    [junit] Testcase: testTruncateWithoutSnapshotNonDurable(org.apache.cassandra.db.CommitLogTest): Caused an ERROR
    [junit] java.nio.file.AccessDeniedException: build\test\cassandra\commitlog;0\CommitLog-5-1436973311962.log
    [junit] FSWriteError in build\test\cassandra\commitlog;0\CommitLog-5-1436973311962.log
    [junit]     at org.apache.cassandra.io.util.FileUtils.deleteWithConfirm(FileUtils.java:132)
    [junit]     at org.apache.cassandra.io.util.FileUtils.deleteWithConfirm(FileUtils.java:149)
    [junit]     at org.apache.cassandra.db.commitlog.CommitLogSegmentManager.recycleSegment(CommitLogSegmentManager.java:359)
    [junit]     at org.apache.cassandra.db.commitlog.CommitLog.recover(CommitLog.java:167)
    [junit]     at org.apache.cassandra.db.commitlog.CommitLog.startUnsafe(CommitLog.java:439)
    [junit]     at org.apache.cassandra.db.commitlog.CommitLog.resetUnsafe(CommitLog.java:412)
    [junit]     at org.apache.cassandra.db.CommitLogTest.testTruncateWithoutSnapshotNonDurable(CommitLogTest.java:345)
    [junit] Caused by: java.nio.file.AccessDeniedException: build\test\cassandra\commitlog;0\CommitLog-5-1436973311962.log
    [junit]     at sun.nio.fs.WindowsException.translateToIOException(WindowsException.java:83)
    [junit]     at sun.nio.fs.WindowsException.rethrowAsIOException(WindowsException.java:97)
    [junit]     at sun.nio.fs.WindowsException.rethrowAsIOException(WindowsException.java:102)
    [junit]     at sun.nio.fs.WindowsFileSystemProvider.implDelete(WindowsFileSystemProvider.java:269)
    [junit]     at sun.nio.fs.AbstractFileSystemProvider.delete(AbstractFileSystemProvider.java:103)
    [junit]     at java.nio.file.Files.delete(Files.java:1126)
    [junit]     at org.apache.cassandra.io.util.FileUtils.deleteWithConfirm(FileUtils.java:126)
    [junit]
    [junit]
    [junit] Test org.apache.cassandra.db.CommitLogTest FAILED
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="14699717" author="jmckenzie" created="Mon, 17 Aug 2015 15:51:50 +0000"  >&lt;p&gt;Going to hijack this ticket (since it&apos;s quite possibly the descendant of the original flaky test failure).&lt;/p&gt;

&lt;p&gt;Error:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Error Message

java.nio.file.AccessDeniedException: build\test\cassandra\commitlog;69\CommitLog-5-1439816200722.log
Stacktrace

FSWriteError in build\test\cassandra\commitlog;69\CommitLog-5-1439816200722.log
	at org.apache.cassandra.io.util.FileUtils.deleteWithConfirm(FileUtils.java:132)
	at org.apache.cassandra.io.util.FileUtils.deleteWithConfirm(FileUtils.java:149)
	at org.apache.cassandra.db.commitlog.CommitLogSegmentManager.recycleSegment(CommitLogSegmentManager.java:359)
	at org.apache.cassandra.db.commitlog.CommitLog.recover(CommitLog.java:167)
	at org.apache.cassandra.db.commitlog.CommitLog.startUnsafe(CommitLog.java:439)
	at org.apache.cassandra.db.commitlog.CommitLog.resetUnsafe(CommitLog.java:412)
	at org.apache.cassandra.db.CommitLogTest.testDeleteIfNotDirty(CommitLogTest.java:186)
Caused by: java.nio.file.AccessDeniedException: build\test\cassandra\commitlog;69\CommitLog-5-1439816200722.log
	at sun.nio.fs.WindowsException.translateToIOException(WindowsException.java:83)
	at sun.nio.fs.WindowsException.rethrowAsIOException(WindowsException.java:97)
	at sun.nio.fs.WindowsException.rethrowAsIOException(WindowsException.java:102)
	at sun.nio.fs.WindowsFileSystemProvider.implDelete(WindowsFileSystemProvider.java:269)
	at sun.nio.fs.AbstractFileSystemProvider.delete(AbstractFileSystemProvider.java:103)
	at java.nio.file.Files.delete(Files.java:1126)
	at org.apache.cassandra.io.util.FileUtils.deleteWithConfirm(FileUtils.java:126)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Consistency: &lt;a href=&quot;http://cassci.datastax.com/view/cassandra-2.2/job/cassandra-2.2_utest_win32/lastCompletedBuild/testReport/org.apache.cassandra.db/CommitLogTest/testDeleteIfNotDirty/history/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;Flaky&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Env: CI only. Cannot repro locally.&lt;/p&gt;</comment>
                            <comment id="14704072" author="pauloricardomg" created="Thu, 20 Aug 2015 00:55:31 +0000"  >&lt;p&gt;Sometimes I get a variant of this error even with dtest:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;======================================================================
ERROR: split_test (sstablesplit_test.TestSSTableSplit)
----------------------------------------------------------------------
Traceback (most recent call last):
  File &quot;C:\Users\Paulo\Repositories\cassandra-dtest\dtest.py&quot;, line 542, in tearDown
    self._cleanup_cluster()
  File &quot;C:\Users\Paulo\Repositories\cassandra-dtest\dtest.py&quot;, line 239, in _cleanup_cluster
    self.cluster.remove()
  File &quot;c:\users\paulo\repositories\ccm\ccmlib\cluster.py&quot;, line 223, in remove
    common.rmdirs(self.get_path())
  File &quot;c:\users\paulo\repositories\ccm\ccmlib\common.py&quot;, line 156, in rmdirs
    shutil.rmtree(u&quot;\\\\?\\&quot; + path)
  File &quot;C:\tools\python2\lib\shutil.py&quot;, line 247, in rmtree
    rmtree(fullname, ignore_errors, onerror)
  File &quot;C:\tools\python2\lib\shutil.py&quot;, line 247, in rmtree
    rmtree(fullname, ignore_errors, onerror)
  File &quot;C:\tools\python2\lib\shutil.py&quot;, line 252, in rmtree
    onerror(os.remove, fullname, sys.exc_info())
  File &quot;C:\tools\python2\lib\shutil.py&quot;, line 250, in rmtree
    os.remove(fullname)
WindowsError: [Error 5] Access is denied: u&apos;\\\\?\\c:\\users\\paulo\\appdata\\local\\temp\\dtest-6dz1zm\\test\\node1\\commitlogs\\CommitLog-6-1440042394664.log&apos;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="14711875" author="jmckenzie" created="Tue, 25 Aug 2015 20:03:18 +0000"  >&lt;p&gt;I&apos;ve hit this from every direction I can think of today and can&apos;t figure out what is holding the reference to the CommitLogs that are causing these deletions to fail. Addition of anything that slows down CLSM.start() (debug prints, adding volatile state variables I can then snapshot in recover, etc) all make the race stop happening, but from tracing through the code in the stop/start pathway around this test, I can&apos;t find any holes in our coordination between the stop/start thread and CLSM&apos;s managerThread.&lt;/p&gt;

&lt;p&gt;That&apos;s not to say that there aren&apos;t problems between them; we&apos;ve had at least a few tickets in the past dealing with this stop/start logic being brittle and flawed w/regards to timing, races, and Windows, just that I&apos;m not able to track it down.&lt;/p&gt;

&lt;p&gt;As protection against this test-specific failure and potential future failures, i&apos;m linking a branch that just swallows FSWriteErrors and returns 0 from resetUnsafe. This is a test-only change and should only swallow/silence test failures where we fail to delete vestigial CommitLogSegments on test start.&lt;/p&gt;</comment>
                            <comment id="14717697" author="pauloricardomg" created="Thu, 27 Aug 2015 22:51:34 +0000"  >&lt;p&gt;I&apos;d just do a more specific check for Windows, or log a warn, so we don&apos;t mask any other problem while swallowing a &lt;tt&gt;FSWriteError&lt;/tt&gt; on &lt;tt&gt;CommitLog.startUnsafe()&lt;/tt&gt; (although unlikely, you never know). You&apos;ll probably also need to rebase to 3.0. Other than that it&apos;s +1.&lt;/p&gt;</comment>
                            <comment id="14719317" author="jmckenzie" created="Fri, 28 Aug 2015 15:05:23 +0000"  >&lt;p&gt;Good points - made check Windows only, logged a warning. Committed as &lt;tt&gt;c5158e53e8ac9386603f607c67ec7fbaa827c5ae&lt;/tt&gt;.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                                                <inwardlinks description="is duplicated by">
                                        <issuelink>
            <issuekey id="12859702">CASSANDRA-10210</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12696033">CASSANDRA-6736</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12857256">CASSANDRA-10129</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[jmckenzie]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 12 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2evnj:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>pauloricardomg</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[pauloricardomg]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12961"><![CDATA[Low]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>