<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 23:26:27 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-14013] Keyspace named &quot;snapshots&quot; is empty after service restart</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-14013</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;I am posting this bug in hope to discover the stupid mistake I am doing because I can&apos;t imagine a reasonable answer for the behavior I see right now &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;In short words, I do observe data loss in a keyspace called &lt;b&gt;snapshots&lt;/b&gt; after restarting the Cassandra service. Say I do have 1000 records in a table called &lt;b&gt;snapshots.test_idx&lt;/b&gt; then after restart the table has less entries or is even empty.&lt;/p&gt;

&lt;p&gt;My kind of &quot;mysterious&quot; observation is that it happens only in a keyspace called &lt;b&gt;snapshots&lt;/b&gt;...&lt;/p&gt;

&lt;h3&gt;&lt;a name=&quot;Stepstoreproduce&quot;&gt;&lt;/a&gt;Steps to reproduce&lt;/h3&gt;

&lt;p&gt;These steps to reproduce show the described behavior in &quot;most&quot; attempts (not every single time though).&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
# create keyspace
CREATE KEYSPACE snapshots WITH replication = {&lt;span class=&quot;code-quote&quot;&gt;&apos;class&apos;&lt;/span&gt;: &lt;span class=&quot;code-quote&quot;&gt;&apos;SimpleStrategy&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;replication_factor&apos;&lt;/span&gt;: 1};

# create table
CREATE TABLE snapshots.test_idx (key text, seqno bigint, primary key(key));

# insert some test data
INSERT INTO snapshots.test_idx (key,seqno) values (&lt;span class=&quot;code-quote&quot;&gt;&apos;key1&apos;&lt;/span&gt;, 1);
...
INSERT INTO snapshots.test_idx (key,seqno) values (&lt;span class=&quot;code-quote&quot;&gt;&apos;key1000&apos;&lt;/span&gt;, 1000);

# count entries
SELECT count(*) FROM snapshots.test_idx;
1000

# restart service
kill &amp;lt;cassandra-pid&amp;gt;
cassandra -f

# count entries
SELECT count(*) FROM snapshots.test_idx;
0
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I hope someone can point me to the obvious mistake I am doing &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;This happened to me using both Cassandra 3.9 and 3.11.0&lt;/p&gt;</description>
                <environment></environment>
        <key id="13118000">CASSANDRA-14013</key>
            <summary>Keyspace named &quot;snapshots&quot; is empty after service restart</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10002" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Normal</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="smiklosovic">Stefan Miklosovic</assignee>
                                    <reporter username="kongo2002">Gregor Uhlenheuer</reporter>
                        <labels>
                    </labels>
                <created>Mon, 13 Nov 2017 16:30:18 +0000</created>
                <updated>Fri, 10 Oct 2025 08:47:59 +0000</updated>
                            <resolved>Tue, 17 Jan 2023 03:55:46 +0000</resolved>
                                        <fixVersion>4.0.8</fixVersion>
                    <fixVersion>4.1.1</fixVersion>
                    <fixVersion>5.0-alpha1</fixVersion>
                    <fixVersion>5.0</fixVersion>
                                    <component>Legacy/Core</component>
                    <component>Local/Snapshots</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>13</watches>
                                                    <progress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                            <timeestimate seconds="0">0h</timeestimate>
                            <timespent seconds="1800">0.5h</timespent>
                                <comments>
                            <comment id="16249851" author="kohlisankalp" created="Mon, 13 Nov 2017 17:25:45 +0000"  >&lt;p&gt;Which commit log mode are you using? &lt;/p&gt;</comment>
                            <comment id="16249896" author="kongo2002" created="Mon, 13 Nov 2017 18:02:41 +0000"  >&lt;p&gt;It&apos;s the default (which is &lt;tt&gt;periodic&lt;/tt&gt; if I recall correctly) since I tested with the vanilla configuration.&lt;/p&gt;</comment>
                            <comment id="16249947" author="kongo2002" created="Mon, 13 Nov 2017 18:32:29 +0000"  >&lt;p&gt;What additionally throws me off is that similar &lt;tt&gt;INSERTs&lt;/tt&gt; into another keyspace with the exact same schema and settings do survive every restart without any issues.&lt;/p&gt;</comment>
                            <comment id="16250357" author="jasobrown" created="Mon, 13 Nov 2017 22:19:34 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=kongo2002&quot; class=&quot;user-hover&quot; rel=&quot;kongo2002&quot;&gt;kongo2002&lt;/a&gt; After you perform the inserts, how long do you wait before bouncing cassandra? If you wait for &amp;gt;= 10 seconds (or whatever &lt;tt&gt;commitlog_sync_period_in_ms&lt;/tt&gt; is set to in the &lt;tt&gt;cassandra.yaml&lt;/tt&gt;), do you still have the same problem?&lt;/p&gt;

&lt;p&gt;I believe &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-13987&quot; title=&quot;Multithreaded commitlog subtly changed durability&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-13987&quot;&gt;&lt;del&gt;CASSANDRA-13987&lt;/del&gt;&lt;/a&gt; addresses the same issue that you are raising here. You can read that ticket for all the gory details.&lt;/p&gt;</comment>
                            <comment id="16250381" author="kongo2002" created="Mon, 13 Nov 2017 22:31:14 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jasobrown&quot; class=&quot;user-hover&quot; rel=&quot;jasobrown&quot;&gt;jasobrown&lt;/a&gt; Thanks for the pointer to &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-13987&quot; title=&quot;Multithreaded commitlog subtly changed durability&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-13987&quot;&gt;&lt;del&gt;CASSANDRA-13987&lt;/del&gt;&lt;/a&gt; - although I don&apos;t think this is the same problem as I do wait for more than 10 seconds indeed. It actually appears that I can pretty much restart the service a couple of times until the table in the &lt;b&gt;snapshots&lt;/b&gt; keyspace is completely empty. I just tried again on a different machine with the same behavior.&lt;/p&gt;</comment>
                            <comment id="16250453" author="jasobrown" created="Mon, 13 Nov 2017 23:03:28 +0000"  >&lt;p&gt;OK, I walked through &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=kongo2002&quot; class=&quot;user-hover&quot; rel=&quot;kongo2002&quot;&gt;kongo2002&lt;/a&gt;&apos;s example script above on the 3.11 branch, and indeed I am able to reproduce. I tried on 3.0, and I think it did not repro (would need to do it again, tbqh).&lt;/p&gt;

&lt;p&gt;I don&apos;t have time to dig in for the next few days, but I suspect it&apos;s because you named the keyspace &quot;&lt;tt&gt;snapshots&lt;/tt&gt;&quot;, and cassandra might be getting confused by trying to clean up any data it thinks is &quot;snapshot&quot; data. Especially as you have other keyspaces by other names, and you are not seeing this problem, I&apos;m guessing we have a bug in the handling of subdirectories names &quot;snapshots&quot;&lt;/p&gt;</comment>
                            <comment id="16251160" author="vincentwhite" created="Tue, 14 Nov 2017 09:53:06 +0000"  >&lt;p&gt;I took a look at this today and found the cause of this issue. It is indeed that the name &quot;snapshots&quot; is causing confusion as C* tries to retrieve the keyspace and column family names from the file paths here: &lt;/p&gt;


&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeHeader panelHeader&quot; style=&quot;border-bottom-width: 1px;&quot;&gt;&lt;b&gt;org.apache.cassandra.io.sstable.Descriptor#fromFilename()&lt;/b&gt;&lt;/div&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
  &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (cfDirectory.getParentFile().getName().equals(Directories.SNAPSHOT_SUBDIR))
            {
                cfDirectory = cfDirectory.getParentFile().getParentFile();
            }
            cfname = cfDirectory.getName().split(&lt;span class=&quot;code-quote&quot;&gt;&quot;-&quot;&lt;/span&gt;)[0] + indexName;
            ksname = cfDirectory.getParentFile().getName();

&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I wrote a quick patch &lt;a href=&quot;https://github.com/vincewhite/cassandra/commits/14013-test&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;here&lt;/a&gt; and would really appreciate some suggestions on improving it (or a different approach). I didn&apos;t have a chance to test 3.0.x but the code at least in this area appears to be the same. I should have time to tidy this up and add a test this week.&lt;/p&gt;

&lt;p&gt;Cheers,&lt;br/&gt;
-vince&lt;/p&gt;</comment>
                            <comment id="16268963" author="jasobrown" created="Tue, 28 Nov 2017 16:01:55 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=VincentWhite&quot; class=&quot;user-hover&quot; rel=&quot;VincentWhite&quot;&gt;VincentWhite&lt;/a&gt; Thanks for looking at this. Did you have a chance to clean up/add a test? I can review.&lt;/p&gt;

&lt;p&gt;UPDATE: reread your comment, where you are looking for feedback. I will do so later today.&lt;/p&gt;</comment>
                            <comment id="16273709" author="vincentwhite" created="Fri, 1 Dec 2017 00:16:44 +0000"  >&lt;p&gt;I&apos;ve create a patch for 3.0.x and trunk using the same method. I guess it should be safe to work with just absolute paths rather than canonical paths here, I haven&apos;t made that change on the 3.x.x patches yet. I also had to fiddle with the unit tests since there is now a dependancy on DatabaseDescriptor and passing in file paths that exist in the configured data directory.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/vincewhite/cassandra/commits/14013-30&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;3.0.x&lt;/a&gt;&lt;br/&gt;
&lt;a href=&quot;https://github.com/vincewhite/cassandra/commits/14013-test&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;3.11.x&lt;/a&gt;&lt;br/&gt;
&lt;a href=&quot;https://github.com/vincewhite/cassandra/commits/14013-trunk&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;trunk&lt;/a&gt;&lt;/p&gt;
</comment>
                            <comment id="16955186" author="michaelsembwever" created="Sat, 19 Oct 2019 14:50:49 +0000"  >&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;branch&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;circleci&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;asf jenkins testall&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;asf jenkins dtests&lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/apache/cassandra/compare/trunk...vincewhite:14013-30&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;cassandra-3.0_14013&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://circleci.com/gh/vincewhite/workflows/cassandra/tree/14013-30&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;circleci&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://builds.apache.org/view/A-D/view/Cassandra/job/Cassandra-devbranch-testall/59/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;&lt;span class=&quot;image-wrap&quot; style=&quot;&quot;&gt;&lt;img src=&quot;https://builds.apache.org/view/A-D/view/Cassandra/job/Cassandra-devbranch-testall/59//badge/icon&quot; style=&quot;border: 0px solid black&quot; /&gt;&lt;/span&gt;&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://builds.apache.org/view/A-D/view/Cassandra/job/Cassandra-devbranch-dtest/694&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;&lt;span class=&quot;image-wrap&quot; style=&quot;&quot;&gt;&lt;img src=&quot;https://builds.apache.org/view/A-D/view/Cassandra/job/Cassandra-devbranch-dtest/694//badge/icon&quot; style=&quot;border: 0px solid black&quot; /&gt;&lt;/span&gt;&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/apache/cassandra/compare/trunk...vincewhite:14013-test&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;cassandra-3.11_14013&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://circleci.com/gh/vincewhite/workflows/cassandra/tree/14013-test&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;circleci&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://builds.apache.org/view/A-D/view/Cassandra/job/Cassandra-devbranch-testall/60/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;&lt;span class=&quot;image-wrap&quot; style=&quot;&quot;&gt;&lt;img src=&quot;https://builds.apache.org/view/A-D/view/Cassandra/job/Cassandra-devbranch-testall/60//badge/icon&quot; style=&quot;border: 0px solid black&quot; /&gt;&lt;/span&gt;&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://builds.apache.org/view/A-D/view/Cassandra/job/Cassandra-devbranch-dtest/695&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;&lt;span class=&quot;image-wrap&quot; style=&quot;&quot;&gt;&lt;img src=&quot;https://builds.apache.org/view/A-D/view/Cassandra/job/Cassandra-devbranch-dtest/695//badge/icon&quot; style=&quot;border: 0px solid black&quot; /&gt;&lt;/span&gt;&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/apache/cassandra/compare/trunk...vincewhite:14013-trunk&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;trunk_14013&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://circleci.com/gh/vincewhite/workflows/cassandra/tree/14013-trunk&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;circleci&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://builds.apache.org/view/A-D/view/Cassandra/job/Cassandra-devbranch-testall/61/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;&lt;span class=&quot;image-wrap&quot; style=&quot;&quot;&gt;&lt;img src=&quot;https://builds.apache.org/view/A-D/view/Cassandra/job/Cassandra-devbranch-testall/61//badge/icon&quot; style=&quot;border: 0px solid black&quot; /&gt;&lt;/span&gt;&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://builds.apache.org/view/A-D/view/Cassandra/job/Cassandra-devbranch-dtest/699&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;&lt;span class=&quot;image-wrap&quot; style=&quot;&quot;&gt;&lt;img src=&quot;https://builds.apache.org/view/A-D/view/Cassandra/job/Cassandra-devbranch-dtest/699//badge/icon&quot; style=&quot;border: 0px solid black&quot; /&gt;&lt;/span&gt;&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;
</comment>
                            <comment id="17006470" author="michaelsembwever" created="Wed, 1 Jan 2020 19:22:48 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=VincentWhite&quot; class=&quot;user-hover&quot; rel=&quot;VincentWhite&quot;&gt;VincentWhite&lt;/a&gt;, there&apos;s a few unit tests failing here, see &lt;tt&gt;SSTableLoaderTest&lt;/tt&gt; and &lt;tt&gt;CQLSSTableWriterTest&lt;/tt&gt;. A fair few dtests look to be failing too (see for example &lt;tt&gt;snapshot_test&lt;/tt&gt;.&lt;/p&gt;</comment>
                            <comment id="17223066" author="stefan.miklosovic" created="Thu, 29 Oct 2020 17:16:41 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mck&quot; class=&quot;user-hover&quot; rel=&quot;mck&quot;&gt;mck&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;I wanted to approach this more robustly and I think I am getting there but for some strange reason the bunch of tests are failing. I am not sure what is wrong here as they do not seem to fail locally.&lt;/p&gt;

&lt;p&gt;The current solution does not count on the fact that for example there might be also a snapshot / table called &quot;snapshot&quot; as well as &quot;backups&quot; for example - same for indexes and indexes in backups and snapshots. There might be also a snapshot called &quot;snapshot&quot; for a keyspace which is called &quot;snapshot&quot; and table which is called &quot;snapshot&quot; too and so on ...&lt;/p&gt;

&lt;p&gt;That code solves all these issues.&lt;/p&gt;

&lt;p&gt;The fact that the original tests were failing was that tests do not use data locations from descriptor but sstables are somewhere in /tmp/ which furtherly complicates things.&lt;/p&gt;

&lt;p&gt;PR: &lt;a href=&quot;https://github.com/apache/cassandra/pull/798&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/cassandra/pull/798&lt;/a&gt;&#160;(there is link to build too).&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;EDIT: some of them do fail locally, I am on it.&lt;/p&gt;</comment>
                            <comment id="17223582" author="michaelsembwever" created="Fri, 30 Oct 2020 11:29:17 +0000"  >&lt;blockquote&gt;&lt;p&gt;The current solution does not count on the fact that for example there might be also a snapshot / table called &quot;snapshot&quot; as well as &quot;backups&quot; for example - same for indexes and indexes in backups and snapshots. There might be also a snapshot called &quot;snapshot&quot; for a keyspace which is called &quot;snapshot&quot; and table which is called &quot;snapshot&quot; too and so on ...&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Sounds good. Thanks. &lt;/p&gt;</comment>
                            <comment id="17226269" author="blerer" created="Wed, 4 Nov 2020 16:51:30 +0000"  >&lt;blockquote&gt;&lt;p&gt;The current solution does not count on the fact that for example there might be also a snapshot / table called &quot;snapshots&quot; as well as &quot;backups&quot; for example - same for indexes and indexes in backups and snapshots. There might be also a snapshot called &quot;snapshot&quot; for a keyspace which is called &quot;snapshots&quot; and table which is called &quot;snapshots&quot; too and so on ... &lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=stefan.miklosovic&quot; class=&quot;user-hover&quot; rel=&quot;stefan.miklosovic&quot;&gt;stefan.miklosovic&lt;/a&gt; I do not believe that tables or indexes named &lt;tt&gt;snapshots&lt;/tt&gt; or &lt;tt&gt;backups&lt;/tt&gt; are trully a problem because their corresponding directories will have different names.&lt;br/&gt;
The directory name for a table named &lt;tt&gt;snapshots&lt;/tt&gt; is &lt;tt&gt;snapshots-&amp;lt;TableID&amp;gt;&lt;/tt&gt; and the directory name for an index named &lt;tt&gt;snapshots&lt;/tt&gt; is &lt;tt&gt;.snapshots&lt;/tt&gt;.&lt;/p&gt;

&lt;p&gt;The &lt;tt&gt;testKeyspaceTableParsing&lt;/tt&gt; is incorrect because it assumes that a table named &lt;tt&gt;snapshots&lt;/tt&gt; will result in a directory called &lt;tt&gt;snapshots&lt;/tt&gt;.  &lt;/p&gt;</comment>
                            <comment id="17226291" author="blerer" created="Wed, 4 Nov 2020 17:16:14 +0000"  >&lt;p&gt;It seems to me that when we hit a directory named &lt;tt&gt;snapshots&lt;/tt&gt;, it can either be the &lt;tt&gt;snapshots&lt;/tt&gt; directory or the keyspace directory.&lt;br/&gt;
If the directory is the &lt;tt&gt;snapshots&lt;/tt&gt; directory then we know that its parent will be the table directory and will have a name with the pattern &lt;tt&gt;&amp;lt;tableName&amp;gt;-&amp;lt;TableID&amp;gt;&lt;/tt&gt;.  By consequence determining if the name is the &lt;tt&gt;snapshots&lt;/tt&gt; directory or the keyspace directory should be relatively easy.&lt;/p&gt;</comment>
                            <comment id="17226324" author="stefan.miklosovic" created="Wed, 4 Nov 2020 18:21:13 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=blerer&quot; class=&quot;user-hover&quot; rel=&quot;blerer&quot;&gt;blerer&lt;/a&gt;&#160;I put this together&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/apache/cassandra/pull/798&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/cassandra/pull/798&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17226335" author="stefan.miklosovic" created="Wed, 4 Nov 2020 18:34:50 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=blerer&quot; class=&quot;user-hover&quot; rel=&quot;blerer&quot;&gt;blerer&lt;/a&gt;&#160;more to it, I have just added that &quot;tableId&quot; into test, that is just minor detail, the implementation already copes with that.&lt;/p&gt;

&lt;p&gt;Devil is in details, for example, for sstableloader, people might put sstable into /tmp/some/path/mykeyspace/mytable/(data files), and that &quot;mytable&quot; will not have any &quot;id&quot; on it ... the solution works with both scenarios. Plus this &quot;path&quot; might be arbitrary, different from the actual data locations specified in cassandra.yaml etc ...&#160;&lt;/p&gt;

&lt;p&gt;What I do not like in particular is that the whole solution feels rather &quot;spaghetti-like&quot; (I do not want to offend here anybody). I based my solution on regular expressions.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;It seems to me that when we hit a directory named snapshots, it can either be the snapshots directory or the keyspace directory.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;And you can have also a snapshot taken which is called &quot;snapshots&quot; &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; That complicates things ever further. Now what, you have a &quot;snapshots&quot; dir where snapshots are and there you might have &quot;snapshots&quot; dir which represents the snapshot taken etc etc ... &lt;/p&gt;</comment>
                            <comment id="17226641" author="blerer" created="Thu, 5 Nov 2020 10:56:09 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=stefan.miklosovic&quot; class=&quot;user-hover&quot; rel=&quot;stefan.miklosovic&quot;&gt;stefan.miklosovic&lt;/a&gt;&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;for example, for sstableloader, people might put sstable into /tmp/some/path/mykeyspace/mytable/(data files), and that &quot;mytable&quot; will not have any &quot;id&quot; on it ...&lt;/p&gt;&lt;/blockquote&gt; 

&lt;p&gt;&lt;tt&gt;SSTableLoader&lt;/tt&gt; does not rely on the code of &lt;tt&gt;Descriptor::fromFilenameWithComponent&lt;/tt&gt; for creating the &lt;tt&gt;Descriptor&lt;/tt&gt; instances, it has its own mechanism which assume that there will be no &lt;tt&gt;TableID&lt;/tt&gt;.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;And you can have also a snapshot taken which is called &quot;snapshots&quot; That complicates things ever further.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;It does not. I did a quick proof of concept and used your PR test to validate it &lt;a href=&quot;https://github.com/apache/cassandra/compare/trunk...blerer:CASSANDRA-14013-review&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;here&lt;/a&gt;. Of course, the test to check if a directory is a table one or not might be done better.&lt;/p&gt;

&lt;p&gt;We know that, outside of this &lt;tt&gt;snapshots&lt;/tt&gt; keyspace problem, this code work and has been battle tested. By consequence, being pragmatic and pretty paranoiac &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/wink.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;, it feels safer to me to not reimplement the all thing. Specially if we take into account that we have to backport the fix to 3.11 and 3.0 (not sure for 2.2).  &lt;/p&gt;</comment>
                            <comment id="17227009" author="stefan.miklosovic" created="Thu, 5 Nov 2020 21:32:22 +0000"  >&lt;p&gt;&lt;cite&gt;SSTableLoader does not rely on the code of Descriptor::fromFilenameWithComponent for creating the Descriptor instances, it has its own mechanism which assume that there will be no TableID.&lt;/cite&gt;&lt;/p&gt;

&lt;p&gt;That is not true, it does, follow the rabbit hole:&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/apache/cassandra/blob/trunk/src/java/org/apache/cassandra/io/sstable/SSTableLoader.java#L88&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/cassandra/blob/trunk/src/java/org/apache/cassandra/io/sstable/SSTableLoader.java#L88&lt;/a&gt; &lt;/p&gt;</comment>
                            <comment id="17227268" author="blerer" created="Fri, 6 Nov 2020 09:23:22 +0000"  >&lt;blockquote&gt;&lt;p&gt;That is not true&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;You are right, I should open my eyes properly &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/wink.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;Then unless I am mistaken (again &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/wink.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;), we cannot rely on &lt;tt&gt;DatabaseDescriptor.getAllDataFileLocations()&lt;/tt&gt; as those directories will not be the same as the one in which is stored the input directory for the SSTableLoader.&lt;/p&gt;
</comment>
                            <comment id="17227347" author="blerer" created="Fri, 6 Nov 2020 11:28:21 +0000"  >&lt;p&gt;Trying to summarize the problem:&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;SSTables used within the C* data directories should be within the data directories returned by &lt;tt&gt;DatabaseDescriptor.getAllDataFileLocations()&lt;/tt&gt; and the table directories should be in the form &lt;tt&gt;&amp;lt;table name&amp;gt;-&amp;lt;TableID&amp;gt;&lt;/tt&gt;. In this case the problem come mainly from keyspace being named &lt;tt&gt;backups&lt;/tt&gt; or &lt;tt&gt;snapshots&lt;/tt&gt;.&lt;/li&gt;
	&lt;li&gt;Files coming from SSTableLoader should be outside of the data directories and the table name should be without the TableID. In this case, keyspaces and tables with a&lt;br/&gt;
&lt;tt&gt;backups&lt;/tt&gt; or &lt;tt&gt;snapshots&lt;/tt&gt; name will be having issues.&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;To be honest, the documentation I found on the SSTableloader is pretty confusing and I imagine that some people might try to use it directly on the C* data directories in which case the table directory will contains the TableID. This case is somehow the same than the &lt;tt&gt;1.&lt;/tt&gt; above.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=stefan.miklosovic&quot; class=&quot;user-hover&quot; rel=&quot;stefan.miklosovic&quot;&gt;stefan.miklosovic&lt;/a&gt; As you pointed out there are several scenario that we never tested. &lt;tt&gt;nodetool snapshot&lt;/tt&gt; with a &lt;tt&gt;snapshots&lt;/tt&gt; or &lt;tt&gt;backups&lt;/tt&gt; tag name. SSTableLoader for a &lt;tt&gt;snapshots&lt;/tt&gt; table (the &lt;tt&gt;backups&lt;/tt&gt; name was tested by &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-16235&quot; title=&quot;SSTableLoader issue when restoring a table named backups&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-16235&quot;&gt;&lt;del&gt;CASSANDRA-16235&lt;/del&gt;&lt;/a&gt;). The patch should add some tests for those scenarios.&lt;br/&gt;
We should also probably test &lt;tt&gt;nodetool refresh&lt;/tt&gt; with a &lt;tt&gt;snapshots&lt;/tt&gt; or &lt;tt&gt;backups&lt;/tt&gt; keyspace.&lt;/p&gt;

&lt;p&gt;Pinging &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=e.dimitrova&quot; class=&quot;user-hover&quot; rel=&quot;e.dimitrova&quot;&gt;e.dimitrova&lt;/a&gt; as she was involved in &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-16235&quot; title=&quot;SSTableLoader issue when restoring a table named backups&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-16235&quot;&gt;&lt;del&gt;CASSANDRA-16235&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="17227423" author="edimitrova" created="Fri, 6 Nov 2020 14:10:59 +0000"  >&lt;p&gt;&lt;cite&gt;To be honest, the documentation I found on the SSTableloader is pretty confusing and I imagine that some people might try to use it directly on the C* data directories in which case the table directory will contains the TableID. This case is somehow the same than the &lt;tt&gt;1.&lt;/tt&gt; above.&lt;/cite&gt;&lt;/p&gt;

&lt;p&gt;To support this, the first time I was reading for the SSTableLoader and trying to use it, I did exactly what you said and got really frustrated &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; &lt;/p&gt;

&lt;p&gt;I will open a ticket to &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=lorina%40datastax.com&quot; class=&quot;user-hover&quot; rel=&quot;lorina@datastax.com&quot;&gt;lorina@datastax.com&lt;/a&gt; to do her magic &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; &lt;/p&gt;</comment>
                            <comment id="17645384" author="smiklosovic" created="Fri, 9 Dec 2022 16:42:01 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=blerer&quot; class=&quot;user-hover&quot; rel=&quot;blerer&quot;&gt;blerer&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=e.dimitrova&quot; class=&quot;user-hover&quot; rel=&quot;e.dimitrova&quot;&gt;e.dimitrova&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;I finally returned to this ticket. This is branch for trunk (1). I ll backport that to  4.0 and 4.1 after we have 4.1 out to lower the buzz. CI for trunk branch in (1) is in (2). &lt;/p&gt;

&lt;p&gt;I have added tests for exotic names to snapshot tests and their listing. I have also added test for importing sstables (refresh uses that too). I have also added backup / snapshot cases. There is also added cases for parsing sstables with that new format.&lt;/p&gt;

&lt;p&gt;The changes introduced here basically simplify this so much that we effectively do not need logic introduced in &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-16235&quot; title=&quot;SSTableLoader issue when restoring a table named backups&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-16235&quot;&gt;&lt;del&gt;CASSANDRA-16235&lt;/del&gt;&lt;/a&gt; anymore.&lt;/p&gt;

&lt;p&gt;(1) &lt;a href=&quot;https://github.com/instaclustr/cassandra/tree/CASSANDRA-14013&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/instaclustr/cassandra/tree/CASSANDRA-14013&lt;/a&gt;&lt;br/&gt;
(2) &lt;a href=&quot;https://app.circleci.com/pipelines/github/instaclustr/cassandra/1657/workflows/41a2840d-4189-4f7e-b0df-63ed8698f1ee&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://app.circleci.com/pipelines/github/instaclustr/cassandra/1657/workflows/41a2840d-4189-4f7e-b0df-63ed8698f1ee&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17647625" author="paulo" created="Wed, 14 Dec 2022 17:19:24 +0000"  >&lt;p&gt;I think the proposed fix looks reasonable, with the caveat that it will remove support for pre-2.1 backups/snapshots, since the &quot;-&quot; separator is not present in pre-2.1 table directories. I don&apos;t think this is a big issue since we no longer support pre-2.1 format and there is an easy workaround.&lt;/p&gt;

&lt;p&gt;I agree with the sentiment expressed in this ticket that the current approach to extract keyspace/index/table from sstable directories is fragile and needs improvement.&lt;/p&gt;

&lt;p&gt;In order to make the extracton of keyspace/table/index more robust, I propose encoding the expected sstable directory structure into the following regex:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;{keyspace}/{tableName}-{tableId}[\backups|\snapshots\{tag}][.indexName]/{component}.db
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;This simplifies the extraction of information from directories to:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;    if (regex.matches(fullSstablePath))
    {
        keyspaceName = regex.group(&quot;keyspace&quot;);
        tableName =  regex.group(&quot;tableName&quot;);
        String indexName =  regex.group(&quot;indexName&quot;);
        if (indexName != null)
        {
            tableName = String.format(&quot;%s.%s&quot;, tableName, indexName);
        }
    }
    else if (validateDirs)
    {
        throw invalidSSTable(name, &quot;cannot extract keyspace and table name; make sure the sstable is in the proper sub-directories&quot;);
    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;The deterministic regex allow to fail-fast when an illegal directory structure is found. Furthermore it can simplify supporting more complex or multiple directory structures if needed.&lt;/p&gt;

&lt;p&gt;For example, in order to make tools read sstable in pre-2.1 directory format, we can update the code above to:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;    regex =  SSTABLE_DIR_PATTERN;
    if (!regex.matches(fullSstablePath)){
            logger.info(&quot;Regex failed, falling back to legacy sstable format&quot;);
            regex = LEGACY_SSTABLE_DIR_PATTERN;
    }
    if (regex.matches(fullSstablePath))
    {
        keyspaceName = regex.group(&quot;keyspace&quot;);
        tableName =  regex.group(&quot;tableName&quot;);
        String indexName =  regex.group(&quot;indexName&quot;);
        if (indexName != null)
        {
            tableName = String.format(&quot;%s.%s&quot;, tableName, indexName);
        }
    }
    else if (validateDirs)
    {
        throw invalidSSTable(name, &quot;cannot extract keyspace and table name; make sure the sstable is in the proper sub-directories&quot;);
    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;I came up with the following tentative regex for sstable directory structure:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;(?&amp;lt;keyspace&amp;gt;\w+)\/(?&amp;lt;tableName&amp;gt;\w+)-(?&amp;lt;tableId&amp;gt;[0-9a-f]{32})\/(backups\/|(snapshots\/(?&amp;lt;tag&amp;gt;[\w-]+)\/))?(\.(?&amp;lt;indexName&amp;gt;[\w-]+)\/)?(?&amp;lt;component&amp;gt;[\w-]+)\.db
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Breaking down into components:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;* keyspace: any word &quot;\w+ &quot;
* tableName: any word  &quot;\w+&quot;
* tableId: 32 HEX characters  &quot;[0-9a-f]{32}&quot;
* optional &quot;/backups&quot; or &quot;/snapshots/{tag}&quot; pre-directories: &quot;(backups\/|(snapshots\/(?&amp;lt;tag&amp;gt;[\w-]+)\/))?&quot;
* optional &quot;.{indexName}&quot; pre-directory: any word with dashes &quot;(.(?&amp;lt;indexName&amp;gt;[\w-]+)\/)?&quot;
* sstable component {component}.db: any word with dashes {{(?&amp;lt;component&amp;gt;[\w-]+)\.db$}}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;The above probably needs validation to check if anything is wrong/missing ^. We can further refine component regex parsing if needed (ie. to extract individual component name for example).&lt;/p&gt;

&lt;p&gt;You can give it a try on the regex above on &lt;a href=&quot;https://regexr.com/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://regexr.com/&lt;/a&gt; with the examples below:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;/path/to/cassandra/data/dir2/dir5/dir6/ks1/tab1-34234234234234234234234234234234/na-1-big-Index.db
/tmp/some/path/tests/keyspace/table-34234234234234234234234234234234/snapshots/snapshots/.index/nb-3g1m_0nuf_3vj5m2k1125165rxa7-big-Index.db
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;I implemented the above approach on this commit: &lt;a href=&quot;https://github.com/pauloricardomg/cassandra/commit/402e7e3b521d92ed12592daf10a9cdbf47846a60&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/pauloricardomg/cassandra/commit/402e7e3b521d92ed12592daf10a9cdbf47846a60&lt;/a&gt;&#160;&lt;/p&gt;

&lt;p&gt;When fixing the tests, I noticed that some examples in the tests were not conforming to the expected directory structure, for example:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;/path/to/cassandra/data/dir2/dir5/dir6/ks1/tab1-3424234234324/backups/nb-3g1m_0nuf_3vj5m2k1125165rxa7-big-Index.db
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;As can be seen, the table id did not have 32 characters that is expected for the table uuid - so I fxed these examples to use UUID &quot;34234234234234234234234234234234&quot; instead.&lt;/p&gt;

&lt;p&gt;I noticed that &lt;tt&gt;DescriptorTest.validateNames()&lt;/tt&gt; expects to read Descriptors from sstables not conforming to the expected directory structure, when it&apos;s not possible to extract keyspace/table information. I believe this is used by external tools. In other to allow these &quot;unsafe&quot; usages by offline tools, I have added a &lt;a href=&quot;https://github.com/apache/cassandra/commit/402e7e3b521d92ed12592daf10a9cdbf47846a60#diff-69de3dfecd03ec3ea98d88bef04bf3a2bca2a02b488fd20e677c04ffad322bbdR282&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;validateDirs&lt;/a&gt; parameter to &lt;tt&gt;Descriptor.fromFilenameWithComponent&lt;/tt&gt; that throws an error when the directory does not match the expected structure. Tools that do not require fail-behavior can set validateDirs=false, but for online sstable reading this would throw an error when an illegal directory structure is found.&lt;/p&gt;

&lt;p&gt;I agree with &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=e.dimitrova&quot; class=&quot;user-hover&quot; rel=&quot;e.dimitrova&quot;&gt;e.dimitrova&lt;/a&gt; suggestion that we should include keyspace/table/index name in a sstable component to avoid needing to parse directory structure to find out this information.&lt;/p&gt;

&lt;p&gt;I propose applying the simpler fix on earlier versions (4.x), and the improved regex-based fix on trunk. What do you think?&lt;/p&gt;</comment>
                            <comment id="17647978" author="smiklosovic" created="Thu, 15 Dec 2022 10:03:46 +0000"  >&lt;p&gt;That is all fine for me, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=paulo&quot; class=&quot;user-hover&quot; rel=&quot;paulo&quot;&gt;paulo&lt;/a&gt; . If you scroll up enough, there is my original PR which was also trying to base the solution to this problem on regexp (1) but then we kind of abandoned that in favor of more concise and &quot;less invasive&quot; patch. What I see is that you managed to still do regexp but it looks way shorter which I am glad for.&lt;/p&gt;

&lt;p&gt;What do you consider to be the simpler fix? The one I put together without your stuff on top? If yes, why do you want to have simpler in 4.0 and 4.1 and this new stuff in trunk only? Is not it better to just have one approach committed everywhere?&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;Also,&#160; SSTableLoaderTest#testLoadingBackupsTable is failing for me locally while testLoadingSnapshotsTable is not. Maybe your patch is not covering something?&lt;/p&gt;

&lt;p&gt;(1) &lt;a href=&quot;https://github.com/apache/cassandra/pull/798/files&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/cassandra/pull/798/files&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17648152" author="paulo" created="Thu, 15 Dec 2022 16:19:16 +0000"  >&lt;blockquote&gt;&lt;p&gt;If you scroll up enough, there is my original PR which was also trying to base the solution to this problem on regexp (1) but then we kind of abandoned that in favor of more concise and &quot;less invasive&quot; patch.&#160;&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Sorry, I missed that.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;If yes, why do you want to have simpler in 4.0 and 4.1 and this new stuff in trunk only? Is not it better to just have one approach committed everywhere?&#160;&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;The simpler fix is less invasive so less riskier for released versions, we probably will no longer touch this code. The regex fix changes the way directories are parsed but is more robust and future-proof so we would adopt that moving forward in trunk, at least until we have the proper fix of encoding keyspace/table/index info in the sstable metadata.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;Also, &#160;SSTableLoaderTest#testLoadingBackupsTable is failing for me locally while testLoadingSnapshotsTable is not. Maybe your patch is not covering something?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I haven&apos;t checked tests other than &lt;tt&gt;DescriptorTest&lt;/tt&gt;, I&apos;ll take a look and submit a full CI run.&lt;/p&gt;</comment>
                            <comment id="17648253" author="paulo" created="Thu, 15 Dec 2022 21:24:46 +0000"  >&lt;p&gt;The reason why &lt;tt&gt;SSTableLoaderTest#testLoadingBackupsTable&lt;/tt&gt; was failing was because this test was using the legacy table directory format which does not have &lt;tt&gt;-{uuid&lt;/tt&gt;} part and the regex was failing to pick up this case.&lt;/p&gt;

&lt;p&gt;On &lt;a href=&quot;https://github.com/pauloricardomg/cassandra/commit/59f42ce2e58f7846355ebb9f3395fceb28c76631&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;this commit&lt;/a&gt;, I added the &lt;tt&gt;./*&lt;/tt&gt; prefix to the regex which made it pick up the case of a &quot;backups&quot; table in the legacy directory format without the table uuid. I also updated &lt;tt&gt;SSTableLoaderTest&lt;/tt&gt; to use the new &lt;a href=&quot;https://github.com/pauloricardomg/cassandra/commit/59f42ce2e58f7846355ebb9f3395fceb28c76631#diff-7caf9acb4092d0f8da99e009b74cab5832ee797d5c9b191ab2e3b394a533812fR333&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;table directory format&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;We did not have a test on &lt;tt&gt;DescriptorTest#testKeyspaceTableParsing&lt;/tt&gt; to pick up the scenario of a legacy &quot;backups&quot; table directory and keyspace, when the table id suffix is missing so I added it &lt;a href=&quot;https://github.com/pauloricardomg/cassandra/commit/59f42ce2e58f7846355ebb9f3395fceb28c76631#diff-f1003299495ea8593e83c86e261e77d7d6d7a57a52c61f52e51e7e816fcdad5eR223&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;here&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;However, neither the solutions are able to correctly parse a snapshot in a legacy &quot;backups&quot; table, for example&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;/path/to/cassandra/data/dir2/dir5/dir6/backups/backups/snapshots/snapshots/na-1-big-Index.db
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Both approaches consider this an sstable on the &quot;snapshots&quot; table of the &quot;snapshots&quot; directory, and not a snapshot on the &quot;backups&quot; table of the &quot;backups&quot; keyspace. However I don&apos;t think we need to fix for this case as we should no longer support directories in the legacy format moving forward.&lt;/p&gt;

&lt;p&gt;I have submitted a CI run for the latest branch &lt;a href=&quot;https://ci-cassandra.apache.org/view/patches/job/Cassandra-devbranch/2106/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;here&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=smiklosovic&quot; class=&quot;user-hover&quot; rel=&quot;smiklosovic&quot;&gt;smiklosovic&lt;/a&gt; if tests look good and you&apos;re ok I can prepare patch for earlier versions with the simpler fix, and the regex fix on trunk. Should we do just 4.x or 3.X too?&lt;/p&gt;</comment>
                            <comment id="17648276" author="smiklosovic" created="Thu, 15 Dec 2022 22:31:54 +0000"  >&lt;p&gt;&lt;em&gt;We did not have a test on DescriptorTest#testKeyspaceTableParsing to pick up the scenario of a legacy &quot;backups&quot; table directory and keyspace, when the table id suffix is missing so I added it here.&lt;/em&gt;&lt;/p&gt;

&lt;p&gt;So, we &lt;em&gt;do&lt;/em&gt; support that, still, right? In that case, could you add a test in SSTableLoaderTest as it was, that it is loading it just fine without uuid as well? Just same thing as it was before.&lt;/p&gt;

&lt;p&gt;When it comes to branches, more branches better it is &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/biggrin.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; I made the peace with having it in 4.0+, you will have bonus points for anything older. However, having data being lost on this kind of stuff is rather embarrassing in 2022 (almost 2023!)&lt;/p&gt;</comment>
                            <comment id="17649434" author="paulo" created="Mon, 19 Dec 2022 18:37:22 +0000"  >&lt;blockquote&gt;&lt;p&gt;&#160;In that case, could you add a test in SSTableLoaderTest as it was, that it is loading it just fine without uuid as well?&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;done &lt;a href=&quot;https://github.com/pauloricardomg/cassandra/commit/9cc0f63171c60e927af18eb3256eb63a29916a43&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;here&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;During a &lt;a href=&quot;https://ci-cassandra.apache.org/view/patches/job/Cassandra-devbranch/2114/testReport/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;CI run&lt;/a&gt; of the trunk patch, I realized the original regex was only accepting &quot;.db&quot; sstable files, so it was failing to correctly parse other extensions (such as .txt or .crc32). So I updated the regex to accept any extension on &lt;a href=&quot;https://github.com/pauloricardomg/cassandra/commit/345222a3e2504a84ef91eb25e35ae23762c34178&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;this commit&lt;/a&gt;. We could make the regex more prescriptive with only supported extensions, but I don&apos;t think this is needed for now.&lt;/p&gt;

&lt;p&gt;I prepared 4.0/4.1 patches with the less disruptive fix, and the trunk patch with the improved regex-based fix:&lt;/p&gt;
&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;branch&lt;/td&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;CI&lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/pauloricardomg/cassandra/tree/CASSANDRA-14013-4.0&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;CASSANDRA-14013-4.0&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://ci-cassandra.apache.org/view/patches/job/Cassandra-devbranch/2115/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;#2115&lt;/a&gt; (finished)&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/pauloricardomg/cassandra/tree/CASSANDRA-14013-4.1&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;CASSANDRA-14013-4.1&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://ci-cassandra.apache.org/view/patches/job/Cassandra-devbranch/2121/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;#2121&lt;/a&gt; (finished)&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/pauloricardomg/cassandra/tree/CASSANDRA-14013-trunk&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;CASSANDRA-14013-trunk&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://ci-cassandra.apache.org/view/patches/job/Cassandra-devbranch/2125/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;#2125&lt;/a&gt; (running)&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;


&lt;p&gt;(will update state when CI is finished)&lt;/p&gt;


&lt;p&gt;Are you ok with the improved regex fix to trunk &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=blerer&quot; class=&quot;user-hover&quot; rel=&quot;blerer&quot;&gt;blerer&lt;/a&gt;, while having the simpler fix on 4.x to reduce risk on released versions?&lt;/p&gt;</comment>
                            <comment id="17650130" author="smiklosovic" created="Wed, 21 Dec 2022 07:33:01 +0000"  >&lt;p&gt;I think there is a regression in the trunk patch (1)&lt;/p&gt;

&lt;p&gt;(1) &lt;a href=&quot;https://ci-cassandra.apache.org/view/patches/job/Cassandra-devbranch/2125/testReport/junit/org.apache.cassandra.io.sstable/LegacySSTableTest/testStreamLegacyCqlTables_compression_2/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://ci-cassandra.apache.org/view/patches/job/Cassandra-devbranch/2125/testReport/junit/org.apache.cassandra.io.sstable/LegacySSTableTest/testStreamLegacyCqlTables_compression_2/&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17654500" author="smiklosovic" created="Wed, 4 Jan 2023 15:09:21 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=paulo&quot; class=&quot;user-hover&quot; rel=&quot;paulo&quot;&gt;paulo&lt;/a&gt; do you plan to take a look at this again? I feel we are super-close to finish line here.&lt;/p&gt;</comment>
                            <comment id="17656028" author="smiklosovic" created="Mon, 9 Jan 2023 10:46:39 +0000"  >&lt;p&gt;The problem is that when we are trying to get a descriptor for a legacy sstable, the test is going to find the first file in the dir and it might happen that it will return &quot;.txt&quot; file. But Descriptor.LEGACY_SSTABLE_DIR_PATTERN is ending on &quot;.db&quot;. We should just do this &lt;a href=&quot;https://github.com/pauloricardomg/cassandra/pull/2&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/pauloricardomg/cassandra/pull/2&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;I am running the build for trunk with that PR included here &lt;a href=&quot;https://ci-cassandra.apache.org/view/patches/job/Cassandra-devbranch/2166/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://ci-cassandra.apache.org/view/patches/job/Cassandra-devbranch/2166/&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17656359" author="paulo" created="Tue, 10 Jan 2023 01:08:27 +0000"  >&lt;p&gt;Good catch! I&apos;ve added two test cases on &lt;tt&gt;DescriptorTest&lt;/tt&gt; for non .db files &lt;a href=&quot;https://github.com/pauloricardomg/cassandra/commit/d5232cbc225b7d7d7b1adf67bd819dfea0d00b79&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;on this commit&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;I&apos;ve incorporated &lt;a href=&quot;https://github.com/pauloricardomg/cassandra/pull/2/commits/d5eb3b69bb4d7262fd19368082dbd466b77e7b90&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;your commit&lt;/a&gt; + the test change &lt;a href=&quot;https://github.com/pauloricardomg/cassandra/commit/d5232cbc225b7d7d7b1adf67bd819dfea0d00b79&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;above&lt;/a&gt; into the trunk branch, rebased and resubmitted CI for all branches:&lt;/p&gt;
&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;branch&lt;/td&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;CI&lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/pauloricardomg/cassandra/tree/CASSANDRA-14013-4.0&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;CASSANDRA-14013-4.0&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://ci-cassandra.apache.org/view/patches/job/Cassandra-devbranch/2171/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;#2171&lt;/a&gt; (running)&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/pauloricardomg/cassandra/tree/CASSANDRA-14013-4.1&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;CASSANDRA-14013-4.1&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://ci-cassandra.apache.org/view/patches/job/Cassandra-devbranch/2170/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;#2170&lt;/a&gt; (running)&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/pauloricardomg/cassandra/tree/CASSANDRA-14013-trunk&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;CASSANDRA-14013-trunk&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://ci-cassandra.apache.org/view/patches/job/Cassandra-devbranch/2169/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;#2169&lt;/a&gt; (running)&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;


&lt;p&gt;After CI looks good for all branches this should be good to go from my side.&lt;/p&gt;</comment>
                            <comment id="17675958" author="smiklosovic" created="Thu, 12 Jan 2023 11:41:29 +0000"  >&lt;p&gt;seems good to me but 4.1 build somehow finished in half? (too low number of tests run and it returned as errorneous), I will rerun 4.1 branch.&lt;/p&gt;</comment>
                            <comment id="17676406" author="paulo" created="Fri, 13 Jan 2023 03:04:06 +0000"  >&lt;p&gt;Resubmitted 4.1 CI on &lt;a href=&quot;https://ci-cassandra.apache.org/view/patches/job/Cassandra-devbranch/2187/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://ci-cassandra.apache.org/view/patches/job/Cassandra-devbranch/2187/&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17676583" author="smiklosovic" created="Fri, 13 Jan 2023 11:10:34 +0000"  >&lt;p&gt;looks great! +1. Lets ship this!&lt;/p&gt;</comment>
                            <comment id="17677588" author="paulo" created="Tue, 17 Jan 2023 03:55:46 +0000"  >&lt;p&gt;Committed as&#160;&lt;a href=&quot;https://github.com/apache/cassandra/commit/6e6846892a5d7ec2feaf2c35d380ed5975d09517&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;6e6846892a5d7ec2feaf2c35d380ed5975d09517&lt;/a&gt; to &lt;tt&gt;cassandra-4.0&lt;/tt&gt; and merged to &lt;a href=&quot;https://github.com/apache/cassandra/commit/c9968a8e95253a23846be1b5f502773a1eeea48d&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;cassandra-4.1&lt;/a&gt; and &lt;a href=&quot;https://github.com/apache/cassandra/commit/6501f576e7c663d285a4db207e6b3dc7f887e8f4&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;trunk&lt;/a&gt; (regex-based version).&lt;/p&gt;



&lt;p&gt;Created &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-18168&quot; title=&quot;Serialize sstable keyspace and table metadata on StatsMetadata component&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-18168&quot;&gt;CASSANDRA-18168&lt;/a&gt; to serialize keyspace/table metadata on &lt;tt&gt;StatsMetadata&lt;/tt&gt; component.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="13519838">CASSANDRA-18168</issuekey>
        </issuelink>
                            </outwardlinks>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="13337881">CASSANDRA-16235</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="13618122">CASSANDRA-20649</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="13339183">CASSANDRA-16251</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[smiklosovic]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            2 years, 43 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3mpuf:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[paulo]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12962"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12311420" key="com.atlassian.jira.plugin.system.customfieldtypes:version">
                        <customfieldname>Since Version</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="12333891">3.0.0</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313924" key="com.atlassian.jira.plugin.system.customfieldtypes:textfield">
                        <customfieldname>Source Control Link</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>&lt;p&gt;&lt;a href=&quot;https://github.com/apache/cassandra/commit/6e6846892a5d7ec2feaf2c35d380ed5975d09517&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/cassandra/commit/6e6846892a5d7ec2feaf2c35d380ed5975d09517&lt;/a&gt;&lt;/p&gt;</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313823" key="com.atlassian.jira.plugin.system.customfieldtypes:textarea">
                        <customfieldname>Test and Documentation Plan</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>&lt;p&gt;CI and added tests&lt;/p&gt;</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>