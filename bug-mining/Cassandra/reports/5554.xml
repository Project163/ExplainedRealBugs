<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 23:18:14 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-15214] Internode messaging catches OOMs and does not rethrow</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-15214</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;Netty (at least, and perhaps elsewhere in Executors) catches all exceptions, so presently there is no way to ensure that an OOM reaches the JVM handler to trigger a crash/heapdump.&lt;/p&gt;

&lt;p&gt;It may be that the simplest most consistent way to do this would be to have a single thread spawned at startup that waits for any exceptions we must propagate to the Runtime.&lt;/p&gt;

&lt;p&gt;We could probably submit a patch upstream to Netty, but for a guaranteed future proof approach, it may be worth paying the cost of a single thread.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13245157">CASSANDRA-15214</key>
            <summary>Internode messaging catches OOMs and does not rethrow</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10002" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Normal</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="yifanc">Yifan Cai</assignee>
                                    <reporter username="benedict">Benedict Elliott Smith</reporter>
                        <labels>
                    </labels>
                <created>Tue, 16 Jul 2019 09:31:49 +0000</created>
                <updated>Wed, 16 Mar 2022 14:20:19 +0000</updated>
                            <resolved>Thu, 19 Nov 2020 19:22:19 +0000</resolved>
                                        <fixVersion>4.0-beta4</fixVersion>
                    <fixVersion>4.0</fixVersion>
                                    <component>Messaging/Client</component>
                    <component>Messaging/Internode</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>15</watches>
                                                    <progress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                            <timeestimate seconds="0">0h</timeestimate>
                            <timespent seconds="6600">1h 50m</timespent>
                                <comments>
                            <comment id="16886475" author="jolynch" created="Tue, 16 Jul 2019 21:34:18 +0000"  >&lt;p&gt;We&apos;ve (Netlfix) found handling OOMs to be generally hard to do correctly in all the various Java codebases we have so we built an agent solution which attaches to the JVM in &lt;a href=&quot;https://github.com/Netflix-Skunkworks/jvmquake&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/Netflix-Skunkworks/jvmquake&lt;/a&gt;. I think the only reason that we couldn&apos;t just directly include that in C* is because it&apos;s a C JVMTI agent instead of a Java one, but perhaps we could just solve this with some documentation and making it really easy to include agents (which is useful regardless)?&#160; I can also spend some time and see if I can make it a java agent instead of a c one.&lt;/p&gt;

&lt;p&gt;The following is the patch for supporting easy pluggable agents for C*:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;diff --git a/conf/cassandra-env.sh b/conf/cassandra-env.sh
index d6c48be0a3..92061db3ab 100644
--- a/conf/cassandra-env.sh
+++ b/conf/cassandra-env.sh
@@ -134,6 +134,29 @@ do
   JVM_OPTS=&quot;$JVM_OPTS $opt&quot;
 done
 
+# Pull in any agents present in CASSANDRA_HOME
+for agent_file in ${CASSANDRA_HOME}/agents/*.jar; do
+  if [ -e &quot;${agent_file}&quot; ]; then
+    base_file=&quot;${agent_file%.jar}&quot;
+    if [ -s &quot;${base_file}.options&quot; ]; then
+      options=`cat ${base_file}.options`
+      agent_file=&quot;${agent_file}=${options}&quot;
+    fi
+    JVM_OPTS=&quot;$JVM_OPTS -javaagent:${agent_file}&quot;
+  fi
+done
+
+for agent_file in ${CASSANDRA_HOME}/agents/*.so; do
+  if [ -e &quot;${agent_file}&quot; ]; then
+    base_file=&quot;${agent_file%.so}&quot;
+    if [ -s &quot;${base_file}.options&quot; ]; then
+      options=`cat ${base_file}.options`
+      agent_file=&quot;${agent_file}=${options}&quot;
+    fi
+    JVM_OPTS=&quot;$JVM_OPTS -agentpath:${agent_file}&quot;
+  fi
+done
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Then we can just drop agents into the &lt;tt&gt;CASSANDRA_HOME/agents&lt;/tt&gt;&#160;folder and they are loaded automatically by Cassandra. From a security perspective this is identical to &quot;drop a jar&quot;.&lt;/p&gt;</comment>
                            <comment id="16889767" author="shestakov" created="Sun, 21 Jul 2019 17:07:21 +0000"  >&lt;p&gt;There is two options to handle &lt;b&gt;OOM&lt;/b&gt; in java version &amp;gt;= 8u92&#160; &lt;a href=&quot;https://www.oracle.com/technetwork/java/javase/8u92-relnotes-2949471.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://www.oracle.com/technetwork/java/javase/8u92-relnotes-2949471.html&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;-XX:+ExitOnOutOfMemoryError&lt;/p&gt;

&lt;p&gt;-XX:+CrashOnOutOfMemoryError&lt;/p&gt;</comment>
                            <comment id="16900379" author="djoshi3" created="Mon, 5 Aug 2019 20:07:04 +0000"  >&lt;p&gt;I think this issue might be related to &lt;a href=&quot;https://bugs.openjdk.java.net/browse/JDK-8027434&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://bugs.openjdk.java.net/browse/JDK-8027434&lt;/a&gt;. Other projects that use the JVM have run into a similar issue and the usual solution is to use &lt;a href=&quot;https://github.com/airlift/jvmkill&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;jvmkill&lt;/a&gt;. The issue at hand is that when a JVM runs out of memory (heap or otherwise), it enters an undefined state. In this situation, I would not expect the handlers to work as expected. I think we should either use jvmkill or &lt;a href=&quot;https://github.com/Netflix-Skunkworks/jvmquake&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;jvmquake&lt;/a&gt; to solve this issue as it has proven to be reliable and Netflix, Facebook and other large JVM users are actively using it.&lt;/p&gt;</comment>
                            <comment id="16900394" author="benedict" created="Mon, 5 Aug 2019 20:31:15 +0000"  >&lt;p&gt;Sorry, I completely forgot to respond to this ticket so thanks for bumping it &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=djoshi3&quot; class=&quot;user-hover&quot; rel=&quot;djoshi3&quot;&gt;djoshi3&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;From my POV, including a C JVMTI agent is absolutely fine, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jolynch&quot; class=&quot;user-hover&quot; rel=&quot;jolynch&quot;&gt;jolynch&lt;/a&gt;.  We&apos;d have to take a closer look at jvmkill and jvmquake, and do our own brief audit of the version we include to ensure it seems to behave reasonably.  But I don&apos;t see any problem with utilising non-Java functionality.&lt;/p&gt;</comment>
                            <comment id="16900410" author="djoshi3" created="Mon, 5 Aug 2019 21:04:38 +0000"  >&lt;p&gt;Sounds great. &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=benedict&quot; class=&quot;user-hover&quot; rel=&quot;benedict&quot;&gt;benedict&lt;/a&gt; who would be able to take up the audit? Is this something I can help with?&lt;/p&gt;</comment>
                            <comment id="16901497" author="yifanc" created="Tue, 6 Aug 2019 21:46:26 +0000"  >&lt;p&gt;Several experiments of the OOM scenario are made to check if the HotSpot handlers work as expected, namely kill the process.&#160;&lt;br/&gt;
&#160;&lt;br/&gt;
The result shows that the handlers,&#160;OnOutOfMemoryError&#160;and&#160;ExitOnOutOfMemoryError, are only effective for heap OOM.&#160;&lt;br/&gt;
&#160;&lt;br/&gt;
&lt;b&gt;Experiments&lt;/b&gt;&lt;br/&gt;
&#160;&lt;br/&gt;
The experiments are designed to emulate what happens in C* while being minimal. They have the&#160;Thread.setDefaultUncaughtExceptionHandler&#160;installed and just re-throw the OOM error hoping the handlers can take care.&#160;&lt;br/&gt;
&#160;&lt;br/&gt;
OpenJDK&#160;8 was used.&lt;br/&gt;
&#160;&lt;br/&gt;
&#160;&lt;br/&gt;
You can find all the 5 experiments in&#160;the attached &lt;span class=&quot;nobr&quot;&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12976875/12976875_oom-experiments.zip&quot; title=&quot;oom-experiments.zip attached to CASSANDRA-15214&quot;&gt;oom-experiments.zip&lt;sup&gt;&lt;img class=&quot;rendericon&quot; src=&quot;https://issues.apache.org/jira/images/icons/link_attachment_7.gif&quot; height=&quot;7&quot; width=&quot;7&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/sup&gt;&lt;/a&gt;&lt;/span&gt;.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&#9500;&#9472;&#9472; OomExperimentExceedsDirectBuffer.java
&#9500;&#9472;&#9472; OomExperimentExceedsDirectBufferRapidAlloc.java
&#9500;&#9472;&#9472; OomExperimentExceedsHeap.java
&#9500;&#9472;&#9472; OomExperimentSimple.java
&#9492;&#9472;&#9472; OomExperimentSimpleJustExit.java&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Among those experiments, there is only one (OomExperimentExceedsHeap) can successfully trigger the handlers.&#160;&lt;br/&gt;
&#160;&lt;br/&gt;
The rest do throw the OutOfMemoryError, but the handlers are not triggered.&#160;&lt;br/&gt;
&#160;&lt;br/&gt;
&lt;b&gt;Some Research&lt;/b&gt;&lt;br/&gt;
&#160;&lt;br/&gt;
The cause could be due to the difference of the code path in JVM implementation to allocate memory on heap and for direct buffer. (OpenJDK8 is the reference)&lt;br/&gt;
&#160;&lt;br/&gt;
Heap memory allocation happens at&#160;&lt;a href=&quot;https://github.com/AdoptOpenJDK/openjdk-jdk8u/blob/aa318070b27849f1fe00d14684b2a40f7b29bf79/hotspot/src/share/vm/gc_interface/collectedHeap.inline.hpp#L149&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;collectedHeap.inline.hpp#CollectedHeap::common_mem_allocate_noinit&lt;/a&gt;. When it failed, it calls&#160;&lt;a href=&quot;https://github.com/AdoptOpenJDK/openjdk-jdk8u/blob/aa318070b27849f1fe00d14684b2a40f7b29bf79/hotspot/src/share/vm/utilities/debug.cpp#L287&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;report_java_out_of_memory&lt;/a&gt;, which is responsible to create a heap dump on OOM and run the handlers.&#160;&lt;br/&gt;
&#160;&lt;br/&gt;
Meanwhile, allocating direct buffer take a different path. In&#160;java.nio.DirectByteBuffer, OOM can happen at 2 places.&#160;&lt;br/&gt;
1.&#160;Bits.reserveMemory,&#160;finds out there is not enough direct memory and throws OOM. In this case, I do not think the OOM is caught and handled in JVM to trigger&#160;report_java_out_of_memory.&lt;br/&gt;
2.&#160;unsafe.allocateMemory, which calls malloc directly, but&#160;&lt;a href=&quot;https://github.com/AdoptOpenJDK/openjdk-jdk8u/blob/aa318070b27849f1fe00d14684b2a40f7b29bf79/hotspot/src/share/vm/prims/unsafe.cpp#L606&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;failed to allocate and throws OOM&lt;/a&gt;. Again, such OOM was throw in order to let the application to handle.&#160;&lt;br/&gt;
&#160;&lt;br/&gt;
Another proof is that&#160;&lt;a href=&quot;https://github.com/AdoptOpenJDK/openjdk-jdk8u/blob/aa318070b27849f1fe00d14684b2a40f7b29bf79/hotspot/src/share/vm/utilities/debug.cpp#L287&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;report_java_out_of_memory&lt;/a&gt;, the only place to trigger the handler, was not invoked during unsafe.allocateMemory. Here are&#160;&lt;a href=&quot;https://github.com/AdoptOpenJDK/openjdk-jdk8u/search?q=report_java_out_of_memory&amp;amp;unscoped_q=report_java_out_of_memory&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;all the references of the method invocation&lt;/a&gt;.&lt;br/&gt;
&#160;&lt;br/&gt;
Because of that, jvmkill or jvmquake mentioned in the ticket&#160;might not work. The tool replies on the notification of the&#160;&lt;a href=&quot;https://github.com/AdoptOpenJDK/openjdk-jdk8u/blob/aa318070b27849f1fe00d14684b2a40f7b29bf79/hotspot/src/share/vm/gc_interface/collectedHeap.inline.hpp#L153&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;JvmtiExport::post_resource_exhausted&lt;/a&gt;, which does not present in the 2 places that direct buffer OOM can happen. Here is the implementation of&#160;&lt;a href=&quot;https://github.com/airlift/jvmkill/blob/master/jvmkill.c#L24&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;jvmkill&lt;/a&gt;&#160;(less than 100 lines).&lt;/p&gt;</comment>
                            <comment id="16901555" author="jolynch" created="Tue, 6 Aug 2019 23:25:12 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=yifanc&quot; class=&quot;user-hover&quot; rel=&quot;yifanc&quot;&gt;yifanc&lt;/a&gt; If you are ok with it I can add your test cases to &lt;a href=&quot;https://github.com/Netflix-Skunkworks/jvmquake/tree/master/tests&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;jvmquake&lt;/a&gt; to ensure it handles all edge cases. For what it&apos;s worth jvmquake is a strict superset of jvmkill and I wouldn&apos;t advocate for using jvmkill (I&apos;m biased though). In my production experience jvmquake actually works at detecting GC spirals of death that C* runs into while jvmkill simply doesn&apos;t work as C* doesn&apos;t actually go OOM, it just death spirals. See the &quot;hard oom&quot;&#160; &lt;a href=&quot;https://github.com/Netflix-Skunkworks/jvmquake/blob/master/tests/test_hard_ooms.py&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;test cases&lt;/a&gt; for example where jvmkill won&apos;t work while jvmquake will work.&lt;/p&gt;</comment>
                            <comment id="16901558" author="yifanc" created="Tue, 6 Aug 2019 23:42:57 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jolynch&quot; class=&quot;user-hover&quot; rel=&quot;jolynch&quot;&gt;jolynch&lt;/a&gt;, you are welcome. Please use them.&lt;/p&gt;

&lt;p&gt;The test cases attached are more on the `Unsafe.allocateMemory` path. As far as I can see, they are different from&#160;the ones included in the jvmquake&apos;s test cases that only check the heap OOM.&#160;&lt;/p&gt;</comment>
                            <comment id="17059535" author="djoshi3" created="Sun, 15 Mar 2020 02:29:48 +0000"  >&lt;p&gt;Followed up with &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jolynch&quot; class=&quot;user-hover&quot; rel=&quot;jolynch&quot;&gt;jolynch&lt;/a&gt; regarding his original comment about including C JVMTI agents in C*. If we build the agent for the officially supported JVMs, we should be good. We need to detect the platform, JVM combo and load it up. If the agent is unavailable for the specific VM/Platform combination, it can be disabled with a warning in the logs much like what we do with `NativeLibrary` except this will need to happen as part of the startup script.&lt;/p&gt;</comment>
                            <comment id="17077743" author="manish.c.ghildiyal@gmail.com" created="Wed, 8 Apr 2020 01:56:26 +0000"  >&lt;p&gt;Please let me know if I can contribute here.&lt;/p&gt;</comment>
                            <comment id="17099546" author="jolynch" created="Tue, 5 May 2020 05:56:48 +0000"  >&lt;p&gt;Quick update on this from the jvmquake side we are now building &lt;a href=&quot;https://github.com/Netflix-Skunkworks/jvmquake/releases&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;architecture specific artifacts&lt;/a&gt; that will work with any JVM newer than Java 8, they link only against the platform specific libc (we&apos;re also now testing on Java 8 and 11, on both zulu and openjdk JVMs). I think this means it would be plausible to include the &lt;tt&gt;libjvmquake-linux-x86_64.so&lt;/tt&gt; in &lt;tt&gt;libs&lt;/tt&gt; and then have a switch on uname -s -m to determine to pick it up or not. Right now we&apos;re only building for linux amd64 but if there is interest I can generate more architectures (linux arm probably makes sense, and could do osx). I also still like the idea of having a agents/available and agents/enabled folder like apache does for modules, users can just symlink agents from one to the other to include them (and we can symlink jamm and jvmquake by default).&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=yifanc&quot; class=&quot;user-hover&quot; rel=&quot;yifanc&quot;&gt;yifanc&lt;/a&gt; I agree that the OutOfMemory conditions that do not result in &quot;true&quot; JVM OOM (meaning that it would cause a heapdump via &lt;tt&gt;HeapDumpOnOutOfMemory&lt;/tt&gt;) such as direct buffer allocations will not get caught by jvmquake, my testing confirms your findings, although the jvmquake GC instability algorithm will still trigger in various real world scenarios I&apos;ve run into.&lt;/p&gt;

&lt;p&gt;I feel like the right move might be to walk back a small bit of &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-13006&quot; title=&quot;Disable automatic heap dumps on OOM error&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-13006&quot;&gt;&lt;del&gt;CASSANDRA-13006&lt;/del&gt;&lt;/a&gt; where we stopped forcibly killing the JVM ourselves and let the JVM do it. Specifically if the OOM message contains &quot;Direct buffer memory&quot; we could do what jvmquake does and force the JVM into a &quot;normal&quot; OOM by &lt;a href=&quot;https://github.com/Netflix-Skunkworks/jvmquake/blob/master/src/jvmquake.c#L103&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;allocating large long arrays&lt;/a&gt;. This will then trigger a proper OOM and get us heap dumping. It&apos;s relatively easy to ignore the &quot;sacrificial&quot; long array in a heap dump and we could log clearly what is happening.&lt;/p&gt;</comment>
                            <comment id="17099582" author="yifanc" created="Tue, 5 May 2020 07:07:20 +0000"  >&lt;p&gt;Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jolynch&quot; class=&quot;user-hover&quot; rel=&quot;jolynch&quot;&gt;jolynch&lt;/a&gt; for the update.&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;force the JVM into a &quot;normal&quot; OOM by &lt;a href=&quot;https://github.com/Netflix-Skunkworks/jvmquake/blob/master/src/jvmquake.c#L103&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;allocating large long arrays&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;An alternative way could be programmatically grab the heap dump via &lt;a href=&quot;https://github.com/AdoptOpenJDK/openjdk-jdk11/blob/master/src/jdk.management/share/classes/com/sun/management/HotSpotDiagnosticMXBean.java#L75&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;JMX&lt;/a&gt; and exit.&lt;/p&gt;</comment>
                            <comment id="17100063" author="jolynch" created="Tue, 5 May 2020 16:44:39 +0000"  >&lt;p&gt;&amp;gt; An alternative way could be programmatically grab the heap dump via &lt;a href=&quot;https://github.com/AdoptOpenJDK/openjdk-jdk11/blob/master/src/jdk.management/share/classes/com/sun/management/HotSpotDiagnosticMXBean.java#L75&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;JMX&lt;/a&gt; and exit.&lt;/p&gt;

&lt;p&gt;I believe that was more or less what C* was doing before &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-13006&quot; title=&quot;Disable automatic heap dumps on OOM error&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-13006&quot;&gt;&lt;del&gt;CASSANDRA-13006&lt;/del&gt;&lt;/a&gt; if I&apos;m reading the patch in &lt;a href=&quot;https://github.com/apache/cassandra/commit/02aba73&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;02aba73&lt;/a&gt; correctly, and Eric Evans pointed out this approach in general can cause the C*&apos;s jmap heap dump to race with the JVM heap dump and advocated for just letting the JVM handle it with built in options. The nice thing about the jvmquake technique of just running the heap out of memory is all the normal JVM options work as expected (logging and dumping heap to a particular location on disk mostly). That being said, I think that for the direct buffer issue in particular this won&apos;t be a problem since as we&apos;ve established the JVM OOM report_java_out_of_memory isn&apos;t triggered on direct memory allocation failures.&lt;/p&gt;</comment>
                            <comment id="17100193" author="yifanc" created="Tue, 5 May 2020 19:10:27 +0000"  >&lt;p&gt;Got it. I did not look closely enough at the discussions in&#160; &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-13006&quot; title=&quot;Disable automatic heap dumps on OOM error&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-13006&quot;&gt;&lt;del&gt;CASSANDRA-13006&lt;/del&gt;&lt;/a&gt;.&#160;&lt;/p&gt;

&lt;p&gt;I agree that leaving it to JVM is a more clean and general solution. Also as you mentioned, &quot;It&apos;s relatively easy to ignore the &quot;sacrificial&quot; long array in a heap dump and we could log clearly what is happening.&quot;&lt;/p&gt;

&lt;p&gt;Since one should be able to trigger the OOM by looping allocating large chunk of memory, e.g. array, in the java code. What is the benefit of doing it so using jvmquake? I can see that in the&#160;killer_thread&#160;callback function, it also does long array allocation once notified by the gc callback.&#160;&lt;/p&gt;

&lt;p&gt;The comment of the callback says&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;the only way to reliably trigger OutOfMemory&lt;br/&gt;
 when we are not actually out of memory (e.g. due to GC behavior) that I&lt;br/&gt;
 could find was to make JNI calls that allocate large blobs of memory which&lt;br/&gt;
 can only be done from outside of the GC callbacks.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Can you elaborate more about preferring jvmquake?&#160;&lt;/p&gt;</comment>
                            <comment id="17100330" author="jolynch" created="Tue, 5 May 2020 23:49:14 +0000"  >&lt;p&gt;&amp;gt; Since one should be able to trigger the OOM by looping allocating large chunk of memory, e.g. array, in the java code. What is the benefit of doing it so using jvmquake? I can see that in the&#160;killer_thread&#160;callback function, it also does long array allocation once notified by the gc callback.&#160;&lt;/p&gt;

&lt;p&gt;Ah sorry I was not clear. I think the JVMStabilityDetector (which we call into via inspectThrowable all over the place) should allocate the long array if we see an OutOfMemoryError with message &quot;Direct buffer memory&quot;, in turn triggering a Heap OOM (which will trigger the normal resource exhausted mechanism). Since we&apos;re not out of&#160;&lt;em&gt;heap&lt;/em&gt; memory we can trust that JVMStatbilityDetector can run.&lt;/p&gt;

&lt;p&gt;I guess my proposal is to include jvmquake by default for linux deployments (I can add more architectures if we want more, easy to opt out), and if JVMStabilityDetector sees a &quot;Direct buffer memory&quot; OOM it should force the JVM into a heap OOM, triggering jvmquake&apos;s resource exhausted handler.&lt;/p&gt;

&lt;p&gt;This setup would guarantee that C* dies (and produces a heap dump) if any of the following conditions hold:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;The JVM is out of heap memory&lt;/li&gt;
	&lt;li&gt;The JVM has accumulated 30s of GC debt with 1:5 runtime weight (meaning that we had &amp;lt;85% throughput for at least 30s): aka &quot;GC spirals of death&quot;&lt;/li&gt;
	&lt;li&gt;The JVM is out of metaspace memory&lt;/li&gt;
	&lt;li&gt;The JVM is out of threads&lt;/li&gt;
	&lt;li&gt;(best effort, likely true) The JVM is out of native memory (so basically C* is using 2x the heap size) -&amp;gt; triggers a heap oom -&amp;gt; triggers the first case&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Unlike the built in JVM options jvmquake really actually works in these edge cases (not only is there a test suite to prove it that the built in Java options don&apos;t work but if you run inside the heap you fundamentally can&apos;t guarantee you will run, e.g. why the kill -9 approach never really works).&lt;/p&gt;</comment>
                            <comment id="17103019" author="yifanc" created="Sat, 9 May 2020 00:10:57 +0000"  >&lt;p&gt;Sounds good &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jolynch&quot; class=&quot;user-hover&quot; rel=&quot;jolynch&quot;&gt;jolynch&lt;/a&gt;. &lt;/p&gt;

&lt;p&gt;So for this ticket, the goal is to force JVM to trigger a Heap OOM upon receiving the direct buffer OOM. (I can work on it.) &lt;/p&gt;

&lt;p&gt;Do you want to the jvmquake integration be addressed in a different ticket? &lt;/p&gt;</comment>
                            <comment id="17150869" author="snazy" created="Fri, 3 Jul 2020 09:33:45 +0000"  >&lt;p&gt;Just read this ticket and the approach looks absolutely reasonable to me.&lt;/p&gt;

&lt;p&gt;One thing though is that the the (off-heap) row-cache isn&apos;t covered here - let me know whether it&apos;s reasonable to add some support regarding this ticket. IMHO, people shouldn&apos;t use the row-cache, but I&apos;m not sure whether there are reasonable use cases out there in the wild. Don&apos;t want to start a discussion about the row-cache in this, just a heads-up.&lt;/p&gt;</comment>
                            <comment id="17198034" author="yifanc" created="Fri, 18 Sep 2020 00:27:40 +0000"  >&lt;p&gt;&amp;gt; Netty (at least, and perhaps elsewhere in Executors) catches all exceptions, so presently there is no way to ensure that an OOM reaches the JVM handler to trigger a crash/heapdump.&lt;/p&gt;

&lt;p&gt;Running a code inspection, the exception/throwable from Netty is already handled. &lt;br/&gt;
For inbound, the &lt;tt&gt;InboundMessageHandler&lt;/tt&gt; implements &lt;tt&gt;exceptionCaught()&lt;/tt&gt; which invokes &lt;tt&gt;JVMStabilityInspector&lt;/tt&gt;. The message handler is the last one in the inbound direction, and there is no previous handler that handles exceptions. So the message handler should handle all exceptions from that direction. However, the &lt;tt&gt;exceptionCaught()&lt;/tt&gt; override in &lt;tt&gt;StreamingInboundHandler&lt;/tt&gt; does not invoke  &lt;tt&gt;JVMStabilityInspector&lt;/tt&gt;. It could swallow OOM errors. &lt;br/&gt;
For outbound, &lt;tt&gt;JVMStabilityInspector&lt;/tt&gt; is invoked when the channel future fails, and several other places. &lt;/p&gt;

&lt;p&gt;All the above callsites call &lt;tt&gt;JVMStabilityInspector&lt;/tt&gt; with &lt;tt&gt;propagateOutOfMemory&lt;/tt&gt; disabled. So the inspector just swallows the OOM errors and not let JVM to handle. &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=benedict&quot; class=&quot;user-hover&quot; rel=&quot;benedict&quot;&gt;benedict&lt;/a&gt;, what is the reason for doing so in the inbound/outbound connections? &lt;/p&gt;</comment>
                            <comment id="17198233" author="benedict" created="Fri, 18 Sep 2020 09:05:13 +0000"  >&lt;p&gt;Zoom out a bit - where would that exception end up if it were rethrown? &#160;I can&apos;t remember precisely, but it is caught by Netty&apos;s default exception handling and iirc simply logged.&lt;/p&gt;</comment>
                            <comment id="17198585" author="yifanc" created="Fri, 18 Sep 2020 23:26:23 +0000"  >&lt;p&gt;&amp;gt; where would that exception end up if it were rethrown&lt;/p&gt;

&lt;p&gt;&lt;tt&gt;JVMStabilityInspector&lt;/tt&gt; only re-throws &lt;tt&gt;OutOfMemoryError&lt;/tt&gt;. Depending on the presence of those OOM-related JVM options, &lt;tt&gt;OnOutOfMemoryError&lt;/tt&gt;, &lt;tt&gt;ExitOnOutOfMemoryError&lt;/tt&gt; or &lt;tt&gt;HeapDumpOnOutOfMemoryError&lt;/tt&gt;, the JVM exits and trigger a heap dump if it is a heap space OOM error. &lt;/p&gt;

&lt;p&gt;However, the call-sites indicate to not re-throw OOM error (e.g. &lt;a href=&quot;https://github.com/apache/cassandra/blob/trunk/src/java/org/apache/cassandra/net/InboundMessageHandler.java#L647-L659&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;here&lt;/a&gt;), which I&apos;d like to learn why we do not let the JVM to exit.&lt;/p&gt;

&lt;p&gt;Netty by default just logs the exception, when &lt;tt&gt;exceptionCaught()&lt;/tt&gt; is &lt;em&gt;not&lt;/em&gt; implemented in any of the handler in the inbound direction. For the outbound, client code handles exception by adding listener to &lt;tt&gt;ChannelFuture&lt;/tt&gt; or &lt;tt&gt;ChannelPromise&lt;/tt&gt;. We have the handling in both directions. &lt;br/&gt;
Besides the inbound/outbound pathes, it looks like that Netty does do a lot of catch-&lt;tt&gt;Throwable&lt;/tt&gt;-and-swallow things in its code base. So it is possible that errors from Netty internal are not bubbled up. For example, this &lt;a href=&quot;https://github.com/netty/netty/issues/6096&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;issue&lt;/a&gt;. &lt;/p&gt;</comment>
                            <comment id="17198670" author="benedict" created="Sat, 19 Sep 2020 07:09:44 +0000"  >&lt;blockquote&gt;&lt;p&gt;So it is possible that errors from Netty internal are not bubbled up&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;As I have said, they are not, and that is the reason this ticket was filed. &#160;I ascertained this at a time when I was intimately familiar with Netty&#8217;s workings, which I am not any longer. &#160;I may have made a mistake, or Netty may have been updated to a version where this changed, but let&apos;s operate under the assumption I was correct at the time of filing this ticket, until proven otherwise.&lt;/p&gt;

&lt;p&gt;The non-propagation of OOM by inspectThrowable was probably used precisely because propagating it was thought to achieve nothing besides logging against Netty&apos;s internal loggers (and failing to shutdown would leave the channel in a worse state, as we would not have finished tidying up as a result of the exception), but I agree we should have left a TODO directly in the code.&lt;/p&gt;</comment>
                            <comment id="17204348" author="yifanc" created="Tue, 29 Sep 2020 22:55:16 +0000"  >&lt;p&gt;Talked with Benedict on Slack and cleaned up my confusion. So the &lt;tt&gt;JVMStabilityInspector&lt;/tt&gt;&#160;is able to inspect the OOM error. But after it re-throws, Netty catches all throwables and simply logs. It happens &lt;a href=&quot;https://github.com/netty/netty/blob/4.1/transport/src/main/java/io/netty/channel/AbstractChannelHandlerContext.java#L303-L316&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;here&lt;/a&gt;. Therefore, the &lt;tt&gt;propagateOutOfMemory&lt;/tt&gt; parameter was added. &lt;/p&gt;

&lt;p&gt;I submitted a PR that allows to produce a heap space OOM error forcefully when catching a direct buffer OOM. &lt;br/&gt;
The PR also removes the parameter &lt;tt&gt;propagateOutOfMemory&lt;/tt&gt; in the &lt;tt&gt;JVMStabilityInspector&lt;/tt&gt;. Because it makes sure the instance can crash/exit properly on OOM. (see the gist below)&lt;/p&gt;

&lt;p&gt;PR: &lt;a href=&quot;https://github.com/apache/cassandra/pull/761&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/cassandra/pull/761&lt;/a&gt;&lt;br/&gt;
CI: &lt;a href=&quot;https://app.circleci.com/pipelines/github/yifan-c/cassandra/112/workflows/293a4334-d2df-43f9-b532-1d79876701c1&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://app.circleci.com/pipelines/github/yifan-c/cassandra/112/workflows/293a4334-d2df-43f9-b532-1d79876701c1&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;I have also created a separate demo to prove that JVM invokes the OOM handler even if such OOM error (not including the direct buffer one) is to be swallowed by a catch block. &lt;br/&gt;
The code and the output can be found at the gist: &lt;a href=&quot;https://gist.github.com/yifan-c/82ff4fd7fbe83fe41113f6f14cba4907&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gist.github.com/yifan-c/82ff4fd7fbe83fe41113f6f14cba4907&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="17227604" author="dcapwell" created="Fri, 6 Nov 2020 20:40:50 +0000"  >&lt;p&gt;+1 from me with small comment, see PR.&lt;/p&gt;

&lt;p&gt;I tested this patch by breaking byte buffer allocation to run out of direct memory, in doing so found an edge case on client (.transport package) code, so once that is fixed client and internode shut down on OOM.&lt;/p&gt;</comment>
                            <comment id="17228865" author="dcapwell" created="Mon, 9 Nov 2020 23:51:51 +0000"  >&lt;p&gt;+1&lt;/p&gt;

&lt;p&gt;Need second reviewer, can merge after.&lt;/p&gt;</comment>
                            <comment id="17230089" author="jrwest" created="Wed, 11 Nov 2020 16:49:36 +0000"  >&lt;p&gt;Left a couple minor comments on GH. Overall the patch looks good. I would like to see test runs for upgrade jvm dtests and the python dtests before merging.&#160;&lt;/p&gt;</comment>
                            <comment id="17230243" author="yifanc" created="Wed, 11 Nov 2020 21:31:25 +0000"  >&lt;p&gt;Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jwest&quot; class=&quot;user-hover&quot; rel=&quot;jwest&quot;&gt;jwest&lt;/a&gt;. Addressed you comments and run CI (unit, jvm dtest and dtest) after rebasing. There are a few test failures, but do not look related to the change. &lt;/p&gt;

&lt;p&gt;CI result: &lt;a href=&quot;https://app.circleci.com/pipelines/github/yifan-c/cassandra/159/workflows/a37b8a85-b705-479e-b7ca-846bb71b36dc&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://app.circleci.com/pipelines/github/yifan-c/cassandra/159/workflows/a37b8a85-b705-479e-b7ca-846bb71b36dc&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17235604" author="dcapwell" created="Thu, 19 Nov 2020 17:16:16 +0000"  >&lt;p&gt;CI Results: Yellow.  Expected COMPACT STORAGE upgrade test that Alex is looking into, and org.apache.cassandra.distributed.test.SimpleReadWriteTest, though that test passes when I reran locally&lt;/p&gt;
&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;Branch&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;Source&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;Circle CI&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;Jenkins&lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;trunk&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/dcapwell/cassandra/tree/commit_remote_branch/CASSANDRA-15214-trunk-C01561D4-BCE5-4B0B-B8F3-4D57E308657A&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;branch&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://app.circleci.com/pipelines/github/dcapwell/cassandra?branch=commit_remote_branch%2FCASSANDRA-15214-trunk-C01561D4-BCE5-4B0B-B8F3-4D57E308657A&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;build&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://ci-cassandra.apache.org/job/Cassandra-devbranch/221/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;build&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;
</comment>
                            <comment id="17462918" author="paulo" created="Tue, 21 Dec 2021 02:01:45 +0000"  >&lt;p&gt;I noticed that after this patch we produce the synthetic heap OOM even if the crash/exit on oom flags are not set, which can happen if the user upgrades from an older version without updating &quot;cassandra-env.sh&quot;. This can potentially leave the JVM in a worse state if we fill the heap and the JVM is not killed. Do you think it makes sense to only generate the Heap OOM when the crash/exit on OOM flags are set &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jolynch&quot; class=&quot;user-hover&quot; rel=&quot;jolynch&quot;&gt;jolynch&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=yifanc&quot; class=&quot;user-hover&quot; rel=&quot;yifanc&quot;&gt;yifanc&lt;/a&gt; ?&lt;/p&gt;</comment>
                            <comment id="17463991" author="yifanc" created="Wed, 22 Dec 2021 17:42:36 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=paulo&quot; class=&quot;user-hover&quot; rel=&quot;paulo&quot;&gt;paulo&lt;/a&gt;, your suggestion makes sense. The synthetic heap OOM assumes users run cassandra with the on OOM flags. So it is reasonable to check the existence of the related options. I started a separate ticket: &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-17227&quot; title=&quot;Synthetic heap OOM generation should only run with the presence of on OOM JVM options&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-17227&quot;&gt;CASSANDRA-17227&lt;/a&gt;. &lt;br/&gt;
Would the JVM result into a worse state due to the synthetic heap OOM? Probably not. The (actual) OOM happened and the JVM is in a bad state already. &lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12976875" name="oom-experiments.zip" size="60453" author="yifanc" created="Tue, 6 Aug 2019 21:45:37 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[yifanc]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12313825" key="com.atlassian.jira.plugin.system.customfieldtypes:cascadingselect">
                        <customfieldname>Bug Category</customfieldname>
                        <customfieldvalues>
                                                    <customfieldvalue key="12983" cascade-level=""><![CDATA[Availability]]></customfieldvalue>
                                <customfieldvalue key="12992" cascade-level="1"><![CDATA[Process Crash]]></customfieldvalue>
            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12313821" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Complexity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12964"><![CDATA[Low Hanging Fruit]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313822" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Discovered By</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12975"><![CDATA[Code Inspection]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12313922" key="jira.plugin.projectspecificselectfield.jpssf:multicftype">
                        <customfieldname>Impacts</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="13100"><![CDATA[None]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            3 years, 46 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12313921" key="jira.plugin.projectspecificselectfield.jpssf:multicftype">
                        <customfieldname>Platform</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="13076"><![CDATA[All]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z04pj4:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[dcapwell]]></customfieldvalue>
        <customfieldvalue><![CDATA[jwest]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12962"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12311420" key="com.atlassian.jira.plugin.system.customfieldtypes:version">
                        <customfieldname>Since Version</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="12348609">4.0-beta2</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313924" key="com.atlassian.jira.plugin.system.customfieldtypes:textfield">
                        <customfieldname>Source Control Link</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>&lt;p&gt;&lt;a href=&quot;https://github.com/apache/cassandra/commit/46ee939b957528185dc6bbd3028c1d6e695163e7&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/cassandra/commit/46ee939b957528185dc6bbd3028c1d6e695163e7&lt;/a&gt;&lt;/p&gt;</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313823" key="com.atlassian.jira.plugin.system.customfieldtypes:textarea">
                        <customfieldname>Test and Documentation Plan</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>&lt;p&gt;ci&lt;/p&gt;</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>