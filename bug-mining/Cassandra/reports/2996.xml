<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 22:46:56 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-7636] Data is not filtered out when using WHERE clause on cluster column on Column Family with row cache on.</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-7636</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;My pretty simplified case looks like the following:&lt;/p&gt;

&lt;p&gt;I create a table with partition and cluster column. I set key caching to NONE and row caching to ALL.  &lt;br/&gt;
When I&apos;m running some SELECTs with WHERE clause filtering on cluster columns, the rows sometimes are not getting filtered out. When? Probably when the row gets loaded to row cache (By some previous query).&lt;/p&gt;

&lt;p&gt;Look at this scenario: &lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;cqlsh:xxx&amp;gt; create KEYSPACE test_keyspace WITH replication = {&lt;span class=&quot;code-quote&quot;&gt;&apos;class&apos;&lt;/span&gt;: &lt;span class=&quot;code-quote&quot;&gt;&apos;SimpleStrategy&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;replication_factor&apos;&lt;/span&gt;: 1};
cqlsh:xxx&amp;gt; use test_keyspace ;
cqlsh:test_keyspace&amp;gt; CREATE TABLE test (p1 bigint, c1 &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;, PRIMARY KEY (p1, c1) )  WITH caching = &lt;span class=&quot;code-quote&quot;&gt;&apos;{&lt;span class=&quot;code-quote&quot;&gt;&quot;keys&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;NONE&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;rows_per_partition&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;ALL&quot;&lt;/span&gt;}&apos;&lt;/span&gt;;
cqlsh:test_keyspace&amp;gt; insert into test (p1, c1 ) values ( 123, 10);

cqlsh:test_keyspace&amp;gt; select * from test where p1 = 123 and c1 &amp;gt; 10;

(0 rows)

cqlsh:test_keyspace&amp;gt; select * from test where p1 = 123 and c1 &amp;gt; 9;

 p1  | c1
-----+----
 123 | 10

(1 rows)

cqlsh:test_keyspace&amp;gt; select * from test where p1 = 123 and c1 &amp;gt; 10;

 p1  | c1
-----+----
 123 | 10

(1 rows)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Running the same scenario, but with row cache turned OFF works fine. &lt;br/&gt;
The filtering on other (partition) columns runs fine. Only the clustering column is somewhat malfunctioning. &lt;/p&gt;</description>
                <environment>&lt;p&gt;Cassandra 2.1.0-rc4&lt;/p&gt;</environment>
        <key id="12730414">CASSANDRA-7636</key>
            <summary>Data is not filtered out when using WHERE clause on cluster column on Column Family with row cache on.</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10002" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Normal</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="marcuse">Marcus Eriksson</assignee>
                                    <reporter username="zarzyk">Krzysztof Zarzycki</reporter>
                        <labels>
                    </labels>
                <created>Tue, 29 Jul 2014 06:24:18 +0000</created>
                <updated>Tue, 16 Apr 2019 09:31:39 +0000</updated>
                            <resolved>Thu, 31 Jul 2014 17:39:39 +0000</resolved>
                                        <fixVersion>2.1 rc5</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="14077701" author="brandon.williams" created="Tue, 29 Jul 2014 13:23:48 +0000"  >&lt;p&gt;As a first step, perhaps tracing the query would shed some light.&lt;/p&gt;</comment>
                            <comment id="14080114" author="zarzyk" created="Wed, 30 Jul 2014 22:49:14 +0000"  >&lt;p&gt;OK, I investigated the issue more deeply and came up with a very simple reproducing example. I rewrote the description completely according to what I found. I hope it would be clear now where the bug is. &lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=brandon.williams&quot; class=&quot;user-hover&quot; rel=&quot;brandon.williams&quot;&gt;brandon.williams&lt;/a&gt;, here I paste the output of tracing of the query. Unfortunately, it&apos;s pretty poor and does not give much of details. &lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;cqlsh:test_keyspace&amp;gt; select * from test where p1 = 123 and c1 &amp;gt; 10;

 p1  | c1
-----+----
 123 | 10

(1 rows)


Tracing session: 4be8e9d0-183b-11e4-b8f4-9b0bde0fbcd8

 activity                                                                                 | timestamp                  | source    | source_elapsed
------------------------------------------------------------------------------------------+----------------------------+-----------+----------------
                                                                       Execute CQL3 query | 2014-07-31 00:46:08.365000 | 127.0.0.1 |              0
 Parsing select * from test where p1 = 123 and c1 &amp;gt; 10 LIMIT 10000; [SharedPool-Worker-3] | 2014-07-31 00:46:08.365000 | 127.0.0.1 |             42
                                                Preparing statement [SharedPool-Worker-3] | 2014-07-31 00:46:08.365000 | 127.0.0.1 |             74
                                                                         Request complete | 2014-07-31 00:46:08.365218 | 127.0.0.1 |            218

&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="14080126" author="brandon.williams" created="Wed, 30 Jul 2014 22:56:11 +0000"  >&lt;p&gt;Doesn&apos;t repro for me against 2.1.0-HEAD:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;cqlsh:test_keyspace&amp;gt; select * from test where p1 = 123 and c1 &amp;gt; 9;

 p1  | c1
-----+----
 123 | 10

(1 rows)

cqlsh:test_keyspace&amp;gt; select * from test where p1 = 123 and c1 &amp;gt; 10;

(0 rows)

cqlsh:test_keyspace&amp;gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Not sure what fixed it, though.&lt;/p&gt;</comment>
                            <comment id="14080157" author="zarzyk" created="Wed, 30 Jul 2014 23:10:20 +0000"  >&lt;p&gt;Dammit, do you know when a new candidate would be released? I wanted to run cassandra 2.1 on production as I hoped RC versions are already pretty stable. &lt;/p&gt;</comment>
                            <comment id="14080183" author="brandon.williams" created="Wed, 30 Jul 2014 23:25:40 +0000"  >&lt;p&gt;There are currently two issues to close, then a new rc.  But I did try this against rc4 now too, and still it didn&apos;t repro following your example to the letter.&lt;/p&gt;</comment>
                            <comment id="14080208" author="zarzyk" created="Wed, 30 Jul 2014 23:40:10 +0000"  >&lt;p&gt;And I did try my example against cassandra-2.1 branch and I reproduced the issue. So it seems like there is something specific with my environment that causes issues...&lt;br/&gt;
Let&apos;s try to enumerate it:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;I create a table with caching by  &quot;WITH caching = &apos;
{&quot;keys&quot;:&quot;NONE&quot;, &quot;rows_per_partition&quot;:&quot;ALL&quot;}
&lt;p&gt;&apos;;&quot;&lt;/p&gt;&lt;/li&gt;
	&lt;li&gt;The cluster was upgraded from version 2.0.8 and now I have cassandra-2.1.0-rc4&lt;/li&gt;
	&lt;li&gt;I run it on Oracle JDK 1.8, but I&apos;ve tried running on openjdk 1.7 and had the same effect&lt;/li&gt;
&lt;/ul&gt;

</comment>
                            <comment id="14080271" author="zarzyk" created="Thu, 31 Jul 2014 00:13:21 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=brandon.williams&quot; class=&quot;user-hover&quot; rel=&quot;brandon.williams&quot;&gt;brandon.williams&lt;/a&gt; I probably know, why you can&apos;t reproduce. You probably haven&apos;t enabled row cache in cassandra.yaml (or by jmx) by setting some non-zero size to it.  &lt;br/&gt;
I just created a fresh cluster with clean config from repo, with cache disabled, issue didn&apos;t show up. Then enabled the cache and issue showed up.&lt;/p&gt;

&lt;p&gt;So finally, for me: it looks like a bug in source code, definitely.&lt;/p&gt;</comment>
                            <comment id="14080282" author="brandon.williams" created="Thu, 31 Jul 2014 00:19:28 +0000"  >&lt;p&gt;You&apos;re exactly right, nice catch.  I can repro now and I took your example a little further and this looks fairly serious:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;cqlsh:test_keyspace&amp;gt; select * from test where p1 = 123 and c1 &amp;gt; 9999;

 p1  | c1
-----+----
 123 | 10
 123 | 20

(2 rows)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="14080285" author="brandon.williams" created="Thu, 31 Jul 2014 00:21:05 +0000"  >&lt;p&gt;Definitely related to row cache since if you restart without a saved cache you get this:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;cqlsh:test_keyspace&amp;gt; select * from test where p1 = 123 and c1 &amp;gt; 9999;

 p1 | c1
----+----

(0 rows)
cqlsh:test_keyspace&amp;gt; select * from test where p1 = 123 and c1 &amp;gt; 9999;

 p1  | c1
-----+----
 123 | 10
 123 | 20

(2 rows)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="14080609" author="krummas" created="Thu, 31 Jul 2014 07:35:50 +0000"  >&lt;p&gt;Attaching patch to actually use the filter when we get a cache hit&lt;/p&gt;</comment>
                            <comment id="14080640" author="zarzyk" created="Thu, 31 Jul 2014 08:22:40 +0000"  >&lt;p&gt;I confirm that the patch works! Thank you&lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;Now I understand it has to go through review and then you&apos;ll add it to the new RC, right?&lt;/p&gt;</comment>
                            <comment id="14080642" author="krummas" created="Thu, 31 Jul 2014 08:24:52 +0000"  >&lt;blockquote&gt;&lt;p&gt;it has to go through review and then you&apos;ll add it to the new RC, right?&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;correct&lt;/p&gt;</comment>
                            <comment id="14080947" author="iamaleksey" created="Thu, 31 Jul 2014 14:45:14 +0000"  >&lt;p&gt;LGTM, +1&lt;/p&gt;</comment>
                            <comment id="14081173" author="brandon.williams" created="Thu, 31 Jul 2014 17:39:39 +0000"  >&lt;p&gt;I committed this.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12658860" name="0001-actually-filter-the-cached-result.patch" size="3140" author="marcuse" created="Thu, 31 Jul 2014 07:35:50 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[marcuse]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>408487</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            11 years, 16 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1yabr:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>408485</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>aleksey</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[aleksey]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12962"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12311420" key="com.atlassian.jira.plugin.system.customfieldtypes:version">
                        <customfieldname>Since Version</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="12327458">2.1 rc4</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>