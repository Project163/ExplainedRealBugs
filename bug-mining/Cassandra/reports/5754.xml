<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 23:20:53 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-16690] Flaky NativeAllocatorTest.testBookKeeping</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-16690</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;Flaky &lt;a href=&quot;https://ci-cassandra.apache.org/job/Cassandra-4.0/52/testReport/junit/org.apache.cassandra.utils.memory/NativeAllocatorTest/testBookKeeping_cdc/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;here&lt;/a&gt;&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Error Message

java.lang.AssertionError: expected:&amp;lt;0&amp;gt; but was:&amp;lt;1&amp;gt;

Stacktrace

java.util.concurrent.ExecutionException: java.lang.AssertionError: expected:&amp;lt;0&amp;gt; but was:&amp;lt;1&amp;gt;
	at java.base/java.util.concurrent.FutureTask.report(FutureTask.java:122)
	at java.base/java.util.concurrent.FutureTask.get(FutureTask.java:191)
	at org.apache.cassandra.utils.memory.NativeAllocatorTest.testBookKeeping(NativeAllocatorTest.java:154)
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
Caused by: java.lang.AssertionError: expected:&amp;lt;0&amp;gt; but was:&amp;lt;1&amp;gt;
	at org.apache.cassandra.utils.memory.NativeAllocatorTest.lambda$testBookKeeping$2(NativeAllocatorTest.java:131)
	at java.base/java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:515)
	at java.base/java.util.concurrent.FutureTask.run(FutureTask.java:264)
	at java.base/java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:304)
	at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1128)
	at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:628)
	at java.base/java.lang.Thread.run(Thread.java:834)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="13380037">CASSANDRA-16690</key>
            <summary>Flaky NativeAllocatorTest.testBookKeeping</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10002" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Normal</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="edimitrova">Ekaterina Dimitrova</assignee>
                                    <reporter username="bereng">Berenguer Blasi</reporter>
                        <labels>
                    </labels>
                <created>Mon, 24 May 2021 07:47:51 +0000</created>
                <updated>Fri, 10 Oct 2025 08:47:58 +0000</updated>
                            <resolved>Tue, 8 Jun 2021 16:46:52 +0000</resolved>
                                        <fixVersion>3.0.25</fixVersion>
                    <fixVersion>3.11.11</fixVersion>
                    <fixVersion>4.0-rc2</fixVersion>
                    <fixVersion>4.0</fixVersion>
                    <fixVersion>4.1-alpha1</fixVersion>
                    <fixVersion>4.1</fixVersion>
                                    <component>Test/unit</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="17352103" author="edimitrova" created="Wed, 26 May 2021 22:19:02 +0000"  >&lt;p&gt;It shows again passed when I open the link. If I search in the runs I found it failed with cdc once.&lt;br/&gt;
But then I ran it with Java 8 and Java 11 1000 times and nothing so I close as not  reproducible.....&lt;br/&gt;
&lt;a href=&quot;https://app.circleci.com/pipelines/github/ekaterinadimitrova2/cassandra/903/workflows/aeb8aea1-92d5-445a-a257-21c2295a5681/jobs/5378&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://app.circleci.com/pipelines/github/ekaterinadimitrova2/cassandra/903/workflows/aeb8aea1-92d5-445a-a257-21c2295a5681/jobs/5378&lt;/a&gt;&lt;br/&gt;
&lt;a href=&quot;https://app.circleci.com/pipelines/github/ekaterinadimitrova2/cassandra/903/workflows/35333c7f-0548-4e54-b372-f6d861ffc10d/jobs/5373&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://app.circleci.com/pipelines/github/ekaterinadimitrova2/cassandra/903/workflows/35333c7f-0548-4e54-b372-f6d861ffc10d/jobs/5373&lt;/a&gt;&lt;br/&gt;
&lt;a href=&quot;https://app.circleci.com/pipelines/github/ekaterinadimitrova2/cassandra/903/workflows/aeb8aea1-92d5-445a-a257-21c2295a5681/jobs/5375&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://app.circleci.com/pipelines/github/ekaterinadimitrova2/cassandra/903/workflows/aeb8aea1-92d5-445a-a257-21c2295a5681/jobs/5375&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17352104" author="edimitrova" created="Wed, 26 May 2021 22:19:55 +0000"  >&lt;p&gt;Please reopen if by chance you see it again&lt;/p&gt;</comment>
                            <comment id="17352279" author="bereng" created="Thu, 27 May 2021 04:45:20 +0000"  >&lt;p&gt;Stage test reports don&apos;t do the fail/pass/fail thing: &lt;a href=&quot;https://ci-cassandra.apache.org/job/Cassandra-4.0-test-cdc/47/jdk=jdk_11_latest,label=cassandra,split=8/testReport/junit/org.apache.cassandra.utils.memory/NativeAllocatorTest/testBookKeeping_cdc/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://ci-cassandra.apache.org/job/Cassandra-4.0-test-cdc/47/jdk=jdk_11_latest,label=cassandra,split=8/testReport/junit/org.apache.cassandra.utils.memory/NativeAllocatorTest/testBookKeeping_cdc/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Did you try looping locally?&lt;/p&gt;</comment>
                            <comment id="17352470" author="edimitrova" created="Thu, 27 May 2021 13:21:39 +0000"  >&lt;p&gt;Yes, I  did...&lt;/p&gt;</comment>
                            <comment id="17358793" author="edimitrova" created="Mon, 7 Jun 2021 18:44:49 +0000"  >&lt;p&gt;Ok, failed again in Jenkins...&#160;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://jenkins-cm4.apache.org/job/Cassandra-4.0.0/13/testReport/junit/org.apache.cassandra.utils.memory/NativeAllocatorTest/testBookKeeping_cdc/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://jenkins-cm4.apache.org/job/Cassandra-4.0.0/13/testReport/junit/org.apache.cassandra.utils.memory/NativeAllocatorTest/testBookKeeping_cdc/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/sad.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="17358826" author="edimitrova" created="Mon, 7 Jun 2021 19:45:20 +0000"  >&lt;p&gt;BUT here a tiny patch comes.&#160;&lt;/p&gt;

&lt;p&gt;I think that the time of 10ms probably sometimes it is not enough for the cleaner. I raised the time to 20 MILISECONDS plus added an assertion &lt;a href=&quot;https://github.com/ekaterinadimitrova2/cassandra/pull/136/commits/3888fbace8ae96ab0426853d2583d5adc62a5d97&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;here&lt;/a&gt;. I was not able to reproduce the issue but my assumption is based on reviewing the code.&#160;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=adelapena&quot; class=&quot;user-hover&quot; rel=&quot;adelapena&quot;&gt;adelapena&lt;/a&gt;&#160;or &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=maedhroz&quot; class=&quot;user-hover&quot; rel=&quot;maedhroz&quot;&gt;maedhroz&lt;/a&gt;, does anyone of you have the time to look at this, please? As you were reviewing my changes in that area of the code at the beginning of the year. This wasn&apos;t a new test added but somehow related.&#160;&lt;/p&gt;

&lt;p&gt;Thank you in advance. I can&apos;t reproduce the issue locally, CircleCI Multiplexer and in our company Jenkins multiplexer. I just pushed a CI run in cassandra Jenkins, dev - &lt;a href=&quot;https://jenkins-cm4.apache.org/job/Cassandra-devbranch/851/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://jenkins-cm4.apache.org/job/Cassandra-devbranch/851/&lt;/a&gt;&#160;I suggest we push the commit if there is no failure in Jenkins.&#160;&lt;/p&gt;</comment>
                            <comment id="17358848" author="adelapena" created="Mon, 7 Jun 2021 20:22:17 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=e.dimitrova&quot; class=&quot;user-hover&quot; rel=&quot;e.dimitrova&quot;&gt;e.dimitrova&lt;/a&gt;&#160;sure, I can review&lt;/p&gt;</comment>
                            <comment id="17359005" author="edimitrova" created="Tue, 8 Jun 2021 02:42:58 +0000"  >&lt;p&gt;Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=adelapena&quot; class=&quot;user-hover&quot; rel=&quot;adelapena&quot;&gt;adelapena&lt;/a&gt;! In the meanwhile, the Jenkins run finished and I don&apos;t see the test failing...at least in this run.&lt;/p&gt;</comment>
                            <comment id="17359176" author="bereng" created="Tue, 8 Jun 2021 09:16:27 +0000"  >&lt;p&gt;It&apos;s easy to repro adding a Thread.sleep() before &lt;tt&gt;isClean.countDown()&lt;/tt&gt; in the cleaner code. Adding the assertion, to check for a successful clean, and raising the wait timeout is the way to go +1. But I would raise it to 500ms or so, then we won&apos;t have to fight this again the day we timeout on 20ms. At the end of the day that timeout being high has no semantics.&lt;/p&gt;</comment>
                            <comment id="17359245" author="adelapena" created="Tue, 8 Jun 2021 10:44:04 +0000"  >&lt;p&gt;Agree, raising the timeout and adding the assertion looks good to me. I would also raise the timeout, perhaps to even longer than 500ms since we have seen longer pauses in CircleCI, maybe something like 5-10 seconds to be on the safe side. I think that the patch should also be applied to 3.0 and 3.11, since those branches also have the 10ms timeout.&lt;/p&gt;</comment>
                            <comment id="17359373" author="edimitrova" created="Tue, 8 Jun 2021 13:51:48 +0000"  >&lt;p&gt;Thank you both, I will apply the patch to 3,3.11 and 4 with the suggested raised timeout of 10 seconds.&lt;/p&gt;</comment>
                            <comment id="17359463" author="edimitrova" created="Tue, 8 Jun 2021 16:45:36 +0000"  >&lt;p&gt;Pushed to all branches after I ran successfully locally the test on all branches:&lt;/p&gt;

&lt;p&gt;To &lt;a href=&quot;https://github.com/apache/cassandra.git&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/cassandra.git&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&#160;&#160; 0e1f217079..a9f472c432&#160; cassandra-3.0 -&amp;gt; cassandra-3.0&lt;/p&gt;

&lt;p&gt;&#160;&#160; dc8ccb7fb9..27f4cb68f2&#160; cassandra-3.11 -&amp;gt; cassandra-3.11&lt;/p&gt;

&lt;p&gt;&#160;&#160; f83f2a3570..7d1c0131f6&#160; cassandra-4.0 -&amp;gt; cassandra-4.0&lt;/p&gt;

&lt;p&gt;&#160;&#160; 159469834a..82bd4567e2&#160; cassandra-4.0.0 -&amp;gt; cassandra-4.0.0&lt;/p&gt;

&lt;p&gt;&#160;&#160; 33ff36cc42..3b97e4bd7b&#160; trunk -&amp;gt; trunk&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[edimitrova]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12313825" key="com.atlassian.jira.plugin.system.customfieldtypes:cascadingselect">
                        <customfieldname>Bug Category</customfieldname>
                        <customfieldvalues>
                                                    <customfieldvalue key="12982" cascade-level=""><![CDATA[Correctness]]></customfieldvalue>
            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12313821" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Complexity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12965"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313822" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Discovered By</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12970"><![CDATA[Unit Test]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12313922" key="jira.plugin.projectspecificselectfield.jpssf:multicftype">
                        <customfieldname>Impacts</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="13100"><![CDATA[None]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            4 years, 23 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12313921" key="jira.plugin.projectspecificselectfield.jpssf:multicftype">
                        <customfieldname>Platform</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="13076"><![CDATA[All]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0razc:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[adelapena]]></customfieldvalue>
        <customfieldvalue><![CDATA[bereng]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12962"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12313924" key="com.atlassian.jira.plugin.system.customfieldtypes:textfield">
                        <customfieldname>Source Control Link</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>&lt;p&gt;&lt;a href=&quot;https://github.com/apache/cassandra/commit/a9f472c432fbe5c45662837f7d7ee578f59fd862&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/cassandra/commit/a9f472c432fbe5c45662837f7d7ee578f59fd862&lt;/a&gt;&lt;/p&gt;</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313823" key="com.atlassian.jira.plugin.system.customfieldtypes:textarea">
                        <customfieldname>Test and Documentation Plan</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>&lt;p&gt;Test issue so we just fixed the current test to prevent potential flakiness:&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/ekaterinadimitrova2/cassandra/pull/136/commits/3888fbace8ae96ab0426853d2583d5adc62a5d97&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/ekaterinadimitrova2/cassandra/pull/136/commits/3888fbace8ae96ab0426853d2583d5adc62a5d97&lt;/a&gt;&lt;/p&gt;</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>