<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 23:10:23 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-14108] Improve commit log chain marker updating</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-14108</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-13987&quot; title=&quot;Multithreaded commitlog subtly changed durability&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-13987&quot;&gt;&lt;del&gt;CASSANDRA-13987&lt;/del&gt;&lt;/a&gt; addressed the commit log behavior change that was introduced with &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-3578&quot; title=&quot;Multithreaded commitlog&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-3578&quot;&gt;&lt;del&gt;CASSANDRA-3578&lt;/del&gt;&lt;/a&gt;. After that patch was committed, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=aweisberg&quot; class=&quot;user-hover&quot; rel=&quot;aweisberg&quot;&gt;aweisberg&lt;/a&gt; did his own review and found a bug as well as having some concerns about the configuration. He and I discussed offline, and agreed on some improvements. &lt;/p&gt;

&lt;p&gt;Instead of requiring users to configure a deep, dark implementation detail like the commit log chained markers (via &lt;tt&gt;commitlog_marker_period_in_ms&lt;/tt&gt; in the yaml), we decided it is best to eliminate thew configuration and always update the chained markers (when in periodic mode). &lt;/p&gt;

&lt;p&gt;The bug &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=aweisberg&quot; class=&quot;user-hover&quot; rel=&quot;aweisberg&quot;&gt;aweisberg&lt;/a&gt; found was when the chained marker update is not a value that evenly divides into the periodic sync mode value, we would not sync in an expected manner. For example if the marker interval is 9 seconds, and the sync interval is 10 seconds, we would update the markers at time9, but we would then sleep for another 9 seconds, and when we wake up at time18, it is then that we flush - 8 seconds later than we should have. &lt;/p&gt;</description>
                <environment></environment>
        <key id="13124410">CASSANDRA-14108</key>
            <summary>Improve commit log chain marker updating</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10002" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Normal</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="jasobrown">Jason Brown</assignee>
                                    <reporter username="jasobrown">Jason Brown</reporter>
                        <labels>
                    </labels>
                <created>Tue, 12 Dec 2017 16:43:07 +0000</created>
                <updated>Fri, 15 May 2020 08:05:28 +0000</updated>
                            <resolved>Thu, 14 Dec 2017 03:55:18 +0000</resolved>
                                        <fixVersion>3.0.16</fixVersion>
                    <fixVersion>3.11.2</fixVersion>
                    <fixVersion>4.0-alpha1</fixVersion>
                    <fixVersion>4.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="16287856" author="jasobrown" created="Tue, 12 Dec 2017 16:43:23 +0000"  >&lt;p&gt;Branches and tests here:&lt;/p&gt;

&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;3.0&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;3.11&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;trunk&lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/jasobrown/cassandra/tree/13987-followup-3.0&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;branch&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/jasobrown/cassandra/tree/13987-followup-3.11&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;branch&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/jasobrown/cassandra/tree/13987-followup-trunk&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;branch&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://circleci.com/gh/jasobrown/workflows/cassandra/tree/13987-followup-3.0&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;utests &amp;amp; dtests&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://circleci.com/gh/jasobrown/workflows/cassandra/tree/13987-followup-3.11&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;utests &amp;amp; dtests&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://circleci.com/gh/jasobrown/workflows/cassandra/tree/13987-followup-trunk&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;utests &amp;amp; dtests&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;


&lt;p&gt;I&apos;ve removed the confusing (and confusingly described) yaml property for setting the &lt;tt&gt;commitlog_marker_period_in_ms&lt;/tt&gt;. Instead, I&apos;ve hardcoded the marker interval to 100ms and it is always applied when a) using periodic mode, and b) not using compression or encryption.&lt;/p&gt;

&lt;p&gt;I&apos;ve fixed the bug that @ariel found by quantizing the &lt;tt&gt;commitlog_sync_period_in_ms&lt;/tt&gt; to a multiple of the marker interval. At the worst, this would change the &lt;tt&gt;commitlog_sync_period_in_ms&lt;/tt&gt; by up to 50 ms. I don&apos;t think anyone will really notice those milliseconds at a practical level, and if they do, they should be using batch or group mode.&lt;/p&gt;

&lt;p&gt;I&apos;ve also refactored &lt;tt&gt;AbstractCommitLogService&lt;/tt&gt; so we can actually unit test it. The anonymous &lt;tt&gt;Runnable&lt;/tt&gt; class that had 90% of the functionality of  &lt;tt&gt;AbstractCommitLogService&lt;/tt&gt; is now a full-fledged, named, and accessible nested class, &lt;tt&gt;AbstractCommitLogService.SyncRunnable&lt;/tt&gt;. To avoid being bound by actual wall clock timings for correctness testing, &lt;tt&gt;AbstractCommitLogService.SyncRunnable&lt;/tt&gt; is using the &lt;tt&gt;Clock&lt;/tt&gt; abstraction; this makes testing sane, safe, and repeatable. &lt;tt&gt;Clock&lt;/tt&gt; was introduced in &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-12016&quot; title=&quot;Create MessagingService mocking classes&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-12016&quot;&gt;&lt;del&gt;CASSANDRA-12016&lt;/del&gt;&lt;/a&gt;, and committed to 3.10. I&apos;ve backported it to 3.0, but I feel it&apos;s quite safe and doesn&apos;t affect anything outside of itself.&lt;/p&gt;</comment>
                            <comment id="16287857" author="jasobrown" created="Tue, 12 Dec 2017 16:44:02 +0000"  >&lt;p&gt;I&apos;ve assigned &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=aweisberg&quot; class=&quot;user-hover&quot; rel=&quot;aweisberg&quot;&gt;aweisberg&lt;/a&gt; as reviewer, but it&apos;d be fantastic if &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=beobal&quot; class=&quot;user-hover&quot; rel=&quot;beobal&quot;&gt;beobal&lt;/a&gt; could take a look, as well.&lt;/p&gt;</comment>
                            <comment id="16288075" author="aweisberg" created="Tue, 12 Dec 2017 18:56:41 +0000"  >&lt;p&gt;I am a little surprised we did this change originally to 3.0 and 3.11 since it&apos;s more of an enhancement.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/apache/cassandra/compare/trunk...jasobrown:13987-followup-trunk?expand=1#diff-8e54554f3635ce0e8411435dd5896f4dR81&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;Extra line break&lt;/a&gt;. It&apos;s on all 3 branches.&lt;br/&gt;
&lt;a href=&quot;#diff-8e54554f3635ce0e8411435dd5896f4dR241&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;Another extra line break.https://github.com/apache/cassandra/compare/trunk...jasobrown:13987-followup-trunk?expand=1#diff-8e54554f3635ce0e8411435dd5896f4dR241&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;I like the approach of quantizing. It&apos;s simple. Besides the whitespace +1.&lt;/p&gt;</comment>
                            <comment id="16289243" author="beobal" created="Wed, 13 Dec 2017 13:23:02 +0000"  >&lt;p&gt;Looks good to me, I just have a couple of trivial nits:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;The debug log in the ACLS constructor would be more informative if it included the sync interval. As is, the marker interval it does log will always be &lt;tt&gt;DEFAULT_MARKER_INTERVAL_MILLIS&lt;/tt&gt;.&lt;/li&gt;
	&lt;li&gt;There&apos;s an extra whitespace introduced by this patch in the 3 arg ACLS constructor.&lt;/li&gt;
	&lt;li&gt;(3.0 only) The string format specifier for the exception message in ACLS::start should be &apos;%d&apos;, not &apos;%f&apos; as we&apos;re just printing the value in millis.&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="16290303" author="jasobrown" created="Thu, 14 Dec 2017 03:55:18 +0000"  >&lt;p&gt;committed as sha &lt;tt&gt;db788fe860dfd69f06ab97ae35fa67fcf2517b6d&lt;/tt&gt;. Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=aweisberg&quot; class=&quot;user-hover&quot; rel=&quot;aweisberg&quot;&gt;aweisberg&lt;/a&gt; and &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=beobal&quot; class=&quot;user-hover&quot; rel=&quot;beobal&quot;&gt;beobal&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="16807242" author="cscotta" created="Mon, 1 Apr 2019 22:41:40 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jasobrown&quot; class=&quot;user-hover&quot; rel=&quot;jasobrown&quot;&gt;jasobrown&lt;/a&gt; Sorry for the assignment change; I hit the key combo by mistake while viewing this issue.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310560">
                    <name>Problem/Incident</name>
                                            <outwardlinks description="causes">
                                        <issuelink>
            <issuekey id="13142731">CASSANDRA-14292</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[jasobrown]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            6 years, 33 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3nt8v:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>aweisberg</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[aweisberg]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12962"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>