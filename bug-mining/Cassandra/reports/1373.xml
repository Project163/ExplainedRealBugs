<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 22:28:23 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-3624] Hinted Handoff - related OOM</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-3624</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;One of our nodes had collected alot of hints for another node, so when the dead node came back and the row mutations were read back from disk, the node died with an OOM-exception (and kept dying after restart, even with increased heap (from 8G to 12G)). The heap dump contained alot of SuperColumns and our application does not use those (but HH does). &lt;/p&gt;

&lt;p&gt;I&apos;m guessing that each mutation is big so that PAGE_SIZE*&amp;lt;mutation_size&amp;gt; does not fit in memory (will check this tomorrow)&lt;/p&gt;

&lt;p&gt;A simple fix (if my assumption above is correct) would be to reduce the PAGE_SIZE in HintedHandOffManager.java to something like 10 (or even 1?) to reduce the memory pressure. The performance hit would be small since we are doing the hinted handoff throttle delay sleep before sending every &lt;b&gt;mutation&lt;/b&gt; anyway (not every page), thoughts?&lt;/p&gt;

&lt;p&gt;If anyone runs in to the same problem, I got the node started again by simply removing the HintsColumnFamily* files.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12535015">CASSANDRA-3624</key>
            <summary>Hinted Handoff - related OOM</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10002" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Normal</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="jbellis">Jonathan Ellis</assignee>
                                    <reporter username="marcuse">Marcus Eriksson</reporter>
                        <labels>
                            <label>hintedhandoff</label>
                    </labels>
                <created>Tue, 13 Dec 2011 20:34:48 +0000</created>
                <updated>Tue, 16 Apr 2019 09:32:44 +0000</updated>
                            <resolved>Wed, 4 Jan 2012 16:04:13 +0000</resolved>
                                        <fixVersion>1.0.7</fixVersion>
                                        <due></due>
                            <votes>1</votes>
                                    <watches>1</watches>
                                                                                                                <comments>
                            <comment id="13169051" author="jbellis" created="Wed, 14 Dec 2011 03:36:46 +0000"  >&lt;p&gt;That makes sense.  (How big are your mutations?)&lt;/p&gt;

&lt;p&gt;We added adaptive page sizing back in &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-2652&quot; title=&quot;Hinted handoff needs to adjust page size for lage columns to avoid OOM&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-2652&quot;&gt;&lt;del&gt;CASSANDRA-2652&lt;/del&gt;&lt;/a&gt;, but apparently removed it for the &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-2045&quot; title=&quot;Simplify HH to decrease read load when nodes come back&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-2045&quot;&gt;&lt;del&gt;CASSANDRA-2045&lt;/del&gt;&lt;/a&gt; redesign.&lt;/p&gt;</comment>
                            <comment id="13169053" author="jbellis" created="Wed, 14 Dec 2011 03:42:55 +0000"  >&lt;p&gt;Patch to add back adaptive page sizing, and drops the default size to 128 columns.&lt;/p&gt;</comment>
                            <comment id="13169056" author="jbellis" created="Wed, 14 Dec 2011 03:46:13 +0000"  >&lt;blockquote&gt;&lt;p&gt;The performance hit would be small since we are doing the hinted handoff throttle delay sleep before sending every mutation anyway &lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;True, but this is likely to change (see Jake&apos;s comments to &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-3554&quot; title=&quot;Hints are not replayed unless node was marked down&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-3554&quot;&gt;&lt;del&gt;CASSANDRA-3554&lt;/del&gt;&lt;/a&gt;).&lt;/p&gt;</comment>
                            <comment id="13175062" author="jbellis" created="Thu, 22 Dec 2011 21:06:33 +0000"  >&lt;p&gt;Marcus, are you able to test the attached patch?&lt;/p&gt;</comment>
                            <comment id="13175302" author="krummas" created="Fri, 23 Dec 2011 06:10:56 +0000"  >&lt;p&gt;not yet, i might be able to do it today though&lt;/p&gt;

&lt;p&gt;this happened in a production cluster so i will have to try to reproduce somewhere else&lt;/p&gt;</comment>
                            <comment id="13175332" author="hsn" created="Fri, 23 Dec 2011 08:49:09 +0000"  >&lt;p&gt;I have this problem too but i do not have large rows, i have huge number of small rows (max 180 bytes serialized)&lt;/p&gt;</comment>
                            <comment id="13176600" author="hsn" created="Wed, 28 Dec 2011 10:47:29 +0000"  >&lt;p&gt;My OOM during HH must have been caused by something else, most likely background compaction. I tried to use HH to deliver 2 million rows on 750MB heap and it worked fine. &lt;/p&gt;</comment>
                            <comment id="13176960" author="jbellis" created="Thu, 29 Dec 2011 02:58:51 +0000"  >&lt;p&gt;rebased&lt;/p&gt;</comment>
                            <comment id="13179557" author="brandon.williams" created="Wed, 4 Jan 2012 15:31:32 +0000"  >&lt;p&gt;+1&lt;/p&gt;</comment>
                            <comment id="13179578" author="brandon.williams" created="Wed, 4 Jan 2012 15:50:55 +0000"  >&lt;p&gt;minor nit: typo in &apos;behavr&apos; in the comment&lt;/p&gt;</comment>
                            <comment id="13179586" author="jbellis" created="Wed, 4 Jan 2012 16:04:14 +0000"  >&lt;p&gt;fixed typo and committed&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12508815" name="3624-rebased.txt" size="2410" author="jbellis" created="Thu, 29 Dec 2011 02:58:51 +0000"/>
                            <attachment id="12507299" name="3624.txt" size="2268" author="jbellis" created="Wed, 14 Dec 2011 03:42:55 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[jbellis]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>220699</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            13 years, 46 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0gm6v:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>95025</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>brandon.williams</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[brandon.williams]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12962"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>