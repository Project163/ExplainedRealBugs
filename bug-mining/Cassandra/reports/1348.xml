<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 22:28:04 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-3250] fsync the directory after new sstable or commit log segment are created</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-3250</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;The mannual of fsync said:&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;Calling  fsync()  does  not  necessarily  ensure  that  the entry in the directory containing the file has also reached disk.  For that an explicit fsync() on a file descriptor for the directory is also needed.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;At least on ext4, syncing the directory is a must to have step, as described by &lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt;. Otherwise, the new sstables or commit logs could be missed after crash even if itself is synced. &lt;/p&gt;

&lt;p&gt;Unfortunately, JVM does not provide an approach to sync the directory...&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt; &lt;a href=&quot;http://www.linuxfoundation.org/news-media/blogs/browse/2009/03/don%E2%80%99t-fear-fsync&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://www.linuxfoundation.org/news-media/blogs/browse/2009/03/don%E2%80%99t-fear-fsync&lt;/a&gt;&lt;/p&gt;</description>
                <environment></environment>
        <key id="12524426">CASSANDRA-3250</key>
            <summary>fsync the directory after new sstable or commit log segment are created</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10003" iconUrl="https://issues.apache.org/jira/images/icons/priorities/trivial.svg">Low</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="xedin">Pavel Yaskevich</assignee>
                                    <reporter username="hanzhu">Zhu Han</reporter>
                        <labels>
                    </labels>
                <created>Fri, 23 Sep 2011 14:39:16 +0000</created>
                <updated>Tue, 16 Apr 2019 09:32:50 +0000</updated>
                            <resolved>Mon, 19 Dec 2011 23:50:49 +0000</resolved>
                                        <fixVersion>1.1.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="13113488" author="hanzhu" created="Fri, 23 Sep 2011 14:42:51 +0000"  >&lt;p&gt;There is a relative discussion on PostgreSQL.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://postgresql.1045698.n5.nabble.com/fsync-reliability-td4330289.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://postgresql.1045698.n5.nabble.com/fsync-reliability-td4330289.html&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13114471" author="hanzhu" created="Mon, 26 Sep 2011 05:32:55 +0000"  >&lt;p&gt;On XFS, this is not a problem per the developer&apos;s response&lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt;.&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt; &lt;a href=&quot;http://www.spinics.net/lists/xfs/msg07229.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://www.spinics.net/lists/xfs/msg07229.html&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13170543" author="jbellis" created="Thu, 15 Dec 2011 22:43:33 +0000"  >&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;shouldn&apos;t the directory cache be per-Writer, not static?&lt;/li&gt;
	&lt;li&gt;why would the FD be null?  if it shouldn&apos;t be, let&apos;s use an assert there&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13170553" author="xedin" created="Thu, 15 Dec 2011 22:54:05 +0000"  >&lt;blockquote&gt;&lt;p&gt;shouldn&apos;t the directory cache be per-Writer, not static?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;It&apos;s useful to make it static instead of instantiation per-Writer because we need every writer to be able to see already open directories.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;why would the FD be null? if it shouldn&apos;t be, let&apos;s use an assert there&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Directory FD could be null when it&apos;s the first time we see directory e.g. first time for commitlog, different data directories, also I made it that way because of &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-2749&quot; title=&quot;fine-grained control over data directories&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-2749&quot;&gt;&lt;del&gt;CASSANDRA-2749&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="13171465" author="jbellis" created="Sat, 17 Dec 2011 05:19:25 +0000"  >&lt;blockquote&gt;&lt;p&gt;we need every writer to be able to see already open directories&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;While it doesn&apos;t really matter with the current directory-per-keyspace, syncing every directory open globally when any sstable is written could be problematic with &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-2749&quot; title=&quot;fine-grained control over data directories&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-2749&quot;&gt;&lt;del&gt;CASSANDRA-2749&lt;/del&gt;&lt;/a&gt; (especially with leveled compaction, which does lots of small sstable writes).  What&apos;s the problem with just having writers sync directories for files they&apos;re writing?&lt;/p&gt;</comment>
                            <comment id="13171561" author="xedin" created="Sat, 17 Dec 2011 13:25:28 +0000"  >&lt;p&gt;No problem with that, here is the version where SequentialWriter syncs only directory for file it writes.&lt;/p&gt;</comment>
                            <comment id="13171579" author="xedin" created="Sat, 17 Dec 2011 14:36:20 +0000"  >&lt;p&gt;re-attached v2 which does only one directory sync per file (after first file sync).&lt;/p&gt;</comment>
                            <comment id="13171784" author="jbellis" created="Sun, 18 Dec 2011 06:28:11 +0000"  >&lt;p&gt;v2 looks a lot simpler, I like it.&lt;/p&gt;

&lt;p&gt;Is there a reason to limit this to Linux-only?  If open + fsync + close exist, it should work.  (And if they don&apos;t, we already have the link error to tell us that.)&lt;/p&gt;</comment>
                            <comment id="13171857" author="xedin" created="Sun, 18 Dec 2011 12:56:05 +0000"  >&lt;p&gt;The reason is O_DIRECTORY is a Linux-specific flag.&lt;/p&gt;</comment>
                            <comment id="13171888" author="jbellis" created="Sun, 18 Dec 2011 16:00:54 +0000"  >&lt;p&gt;Is O_DIRECTORY necessary for the sync to work?  Or is that just a &quot;make sure this path is actually a directory&quot; flag?  If the latter, then we can leave it out, since we know the path is a directory by construction.&lt;/p&gt;</comment>
                            <comment id="13171895" author="xedin" created="Sun, 18 Dec 2011 16:27:24 +0000"  >&lt;p&gt;Ok, v3 O_DIRECTORY changed to O_RDONLY and checks for linux are removed from CLibrary.&lt;/p&gt;

&lt;p&gt;O_DIRECTORY just causes open to fail if given path is not a directory, so it seems we can live without it &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="13172029" author="jbellis" created="Mon, 19 Dec 2011 04:54:45 +0000"  >&lt;p&gt;+1&lt;/p&gt;</comment>
                            <comment id="13172126" author="xedin" created="Mon, 19 Dec 2011 09:23:39 +0000"  >&lt;p&gt;Committed.&lt;/p&gt;</comment>
                            <comment id="13172732" author="jbellis" created="Mon, 19 Dec 2011 23:25:01 +0000"  >&lt;p&gt;... actually, can you back this out of 1.0 and put it in 1.1 instead?  It &lt;b&gt;should&lt;/b&gt; be fine but let&apos;s not take chances with regressions.&lt;/p&gt;</comment>
                            <comment id="13172744" author="xedin" created="Mon, 19 Dec 2011 23:50:49 +0000"  >&lt;p&gt;Changed to 1.1 only.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12660490">HDFS-5042</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12507780" name="CASSANDRA-3250-v2.patch" size="5088" author="xedin" created="Sat, 17 Dec 2011 14:36:20 +0000"/>
                            <attachment id="12507839" name="CASSANDRA-3250-v3.patch" size="4874" author="xedin" created="Sun, 18 Dec 2011 16:27:24 +0000"/>
                            <attachment id="12506992" name="CASSANDRA-3250.patch" size="7397" author="xedin" created="Mon, 12 Dec 2011 11:38:52 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[xedin]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1835</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            13 years, 49 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0ghmn:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>94286</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>jbellis</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[jbellis]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12961"><![CDATA[Low]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>