<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 22:55:36 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-9884] Error on encrypted node communication upgrading from 2.1.6 to 2.2.0</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-9884</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;After updating to Cassandra 2.2.0 from 2.1.6 I am having SSL issues.&lt;/p&gt;

&lt;p&gt;The configuration had not changed from one version to the other, the JVM is still the same however on 2.2.0 it is erroring. I am yet to investigate the source code for it. But for now, this is the information I have to share on it:&lt;/p&gt;

&lt;p&gt;My JVM is java version &quot;1.8.0_45&quot;&lt;br/&gt;
Java(TM) SE Runtime Environment (build 1.8.0_45-b14)&lt;br/&gt;
Java HotSpot(TM) 64-Bit Server VM (build 25.45-b02, mixed mode)&lt;/p&gt;

&lt;p&gt;Ubuntu 14.04.2 LTS is on all nodes, they are the same.&lt;/p&gt;

&lt;p&gt;Below is the encryption settings from cassandra.yaml of all nodes.&lt;/p&gt;

&lt;p&gt;I am using the same keystore and trustore as I had used before on 2.1.6&lt;/p&gt;


&lt;ol&gt;
	&lt;li&gt;Enable or disable inter-node encryption&lt;/li&gt;
	&lt;li&gt;Default settings are TLS v1, RSA 1024-bit keys (it is imperative that&lt;/li&gt;
	&lt;li&gt;users generate their own keys) TLS_RSA_WITH_AES_128_CBC_SHA as the cipher&lt;/li&gt;
	&lt;li&gt;suite for authentication, key exchange and encryption of the actual data transfers.&lt;/li&gt;
	&lt;li&gt;Use the DHE/ECDHE ciphers if running in FIPS 140 compliant mode.&lt;/li&gt;
	&lt;li&gt;NOTE: No custom encryption options are enabled at the moment&lt;/li&gt;
	&lt;li&gt;The available internode options are : all, none, dc, rack&lt;br/&gt;
#&lt;/li&gt;
	&lt;li&gt;If set to dc cassandra will encrypt the traffic between the DCs&lt;/li&gt;
	&lt;li&gt;If set to rack cassandra will encrypt the traffic between the racks&lt;br/&gt;
#&lt;/li&gt;
	&lt;li&gt;The passwords used in these options must match the passwords used when generating&lt;/li&gt;
	&lt;li&gt;the keystore and truststore.  For instructions on generating these files, see:&lt;/li&gt;
	&lt;li&gt;&lt;a href=&quot;http://download.oracle.com/javase/6/docs/technotes/guides/security/jsse/JSSERefGuide.html#CreateKeystore&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://download.oracle.com/javase/6/docs/technotes/guides/security/jsse/JSSERefGuide.html#CreateKeystore&lt;/a&gt;&lt;br/&gt;
#&lt;br/&gt;
server_encryption_options:&lt;br/&gt;
    internode_encryption: all&lt;br/&gt;
    keystore: /etc/cassandra/certs/node.keystore&lt;br/&gt;
    keystore_password: mypasswd&lt;br/&gt;
    truststore: /etc/cassandra/certs/global.truststore&lt;br/&gt;
    truststore_password: mypasswd&lt;/li&gt;
	&lt;li&gt;More advanced defaults below:&lt;/li&gt;
	&lt;li&gt;protocol: TLS&lt;/li&gt;
	&lt;li&gt;algorithm: SunX509&lt;/li&gt;
	&lt;li&gt;store_type: JKS&lt;br/&gt;
    cipher_suites: &lt;span class=&quot;error&quot;&gt;&amp;#91;TLS_RSA_WITH_AES_128_CBC_SHA,TLS_RSA_WITH_AES_256_CBC_SHA,TLS_DHE_RSA_WITH_AES_128_CBC_SHA,TLS_DHE_RSA_WITH_AES_256_CBC_SHA,TLS_ECDHE_RSA_WITH_AES_128_CBC_SHA,TLS_ECDHE_RSA_WITH_AES_256_CBC_SHA&amp;#93;&lt;/span&gt;&lt;br/&gt;
    require_client_auth: false&lt;/li&gt;
&lt;/ol&gt;


&lt;ol&gt;
	&lt;li&gt;enable or disable client/server encryption.&lt;/li&gt;
&lt;/ol&gt;



&lt;p&gt;Nodes cannot talk to each other as per SSL errors bellow.&lt;/p&gt;

&lt;p&gt;WARN  &lt;span class=&quot;error&quot;&gt;&amp;#91;MessagingService-Outgoing-/192.168.1.31&amp;#93;&lt;/span&gt; 2015-07-22 17:29:48,764 SSLFactory.java:163 - Filtering out TLS_DHE_RSA_WITH_AES_256_CBC_SHA,TLS_RSA_WITH_AES_256_CBC_SHA,TLS_ECDHE_RSA_WITH_AES_256_CBC_SHA as it isnt supported by the socket&lt;br/&gt;
ERROR &lt;span class=&quot;error&quot;&gt;&amp;#91;MessagingService-Outgoing-/192.168.1.31&amp;#93;&lt;/span&gt; 2015-07-22 17:29:48,764 OutboundTcpConnection.java:229 - error processing a message intended for /192.168.1.31&lt;br/&gt;
java.lang.NullPointerException: null&lt;br/&gt;
	at com.google.common.base.Preconditions.checkNotNull(Preconditions.java:213) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;guava-16.0.jar:na&amp;#93;&lt;/span&gt;&lt;br/&gt;
	at org.apache.cassandra.io.util.BufferedDataOutputStreamPlus.&amp;lt;init&amp;gt;(BufferedDataOutputStreamPlus.java:74) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;apache-cassandra-2.2.0.jar:2.2.0&amp;#93;&lt;/span&gt;&lt;br/&gt;
	at org.apache.cassandra.net.OutboundTcpConnection.connect(OutboundTcpConnection.java:404) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;apache-cassandra-2.2.0.jar:2.2.0&amp;#93;&lt;/span&gt;&lt;br/&gt;
	at org.apache.cassandra.net.OutboundTcpConnection.run(OutboundTcpConnection.java:218) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;apache-cassandra-2.2.0.jar:2.2.0&amp;#93;&lt;/span&gt;&lt;br/&gt;
ERROR &lt;span class=&quot;error&quot;&gt;&amp;#91;MessagingService-Outgoing-/192.168.1.31&amp;#93;&lt;/span&gt; 2015-07-22 17:29:48,764 OutboundTcpConnection.java:316 - error writing to /192.168.1.31&lt;br/&gt;
java.lang.NullPointerException: null&lt;br/&gt;
	at org.apache.cassandra.net.OutboundTcpConnection.writeInternal(OutboundTcpConnection.java:323) &lt;span class=&quot;error&quot;&gt;&amp;#91;apache-cassandra-2.2.0.jar:2.2.0&amp;#93;&lt;/span&gt;&lt;br/&gt;
	at org.apache.cassandra.net.OutboundTcpConnection.writeConnected(OutboundTcpConnection.java:285) &lt;span class=&quot;error&quot;&gt;&amp;#91;apache-cassandra-2.2.0.jar:2.2.0&amp;#93;&lt;/span&gt;&lt;br/&gt;
	at org.apache.cassandra.net.OutboundTcpConnection.run(OutboundTcpConnection.java:219) &lt;span class=&quot;error&quot;&gt;&amp;#91;apache-cassandra-2.2.0.jar:2.2.0&amp;#93;&lt;/span&gt;&lt;br/&gt;
WARN  &lt;span class=&quot;error&quot;&gt;&amp;#91;MessagingService-Outgoing-/192.168.1.33&amp;#93;&lt;/span&gt; 2015-07-22 17:29:49,764 SSLFactory.java:163 - Filtering out TLS_DHE_RSA_WITH_AES_256_CBC_SHA,TLS_RSA_WITH_AES_256_CBC_SHA,TLS_ECDHE_RSA_WITH_AES_256_CBC_SHA as it isnt supported by the socket&lt;br/&gt;
WARN  &lt;span class=&quot;error&quot;&gt;&amp;#91;MessagingService-Outgoing-/192.168.1.31&amp;#93;&lt;/span&gt; 2015-07-22 17:29:49,764 SSLFactory.java:163 - Filtering out TLS_DHE_RSA_WITH_AES_256_CBC_SHA,TLS_RSA_WITH_AES_256_CBC_SHA,TLS_ECDHE_RSA_WITH_AES_256_CBC_SHA as it isnt supported by the socket&lt;br/&gt;
ERROR &lt;span class=&quot;error&quot;&gt;&amp;#91;MessagingService-Outgoing-/192.168.1.33&amp;#93;&lt;/span&gt; 2015-07-22 17:29:49,764 OutboundTcpConnection.java:229 - error processing a message intended for /192.168.1.33&lt;br/&gt;
java.lang.NullPointerException: null&lt;br/&gt;
	at com.google.common.base.Preconditions.checkNotNull(Preconditions.java:213) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;guava-16.0.jar:na&amp;#93;&lt;/span&gt;&lt;br/&gt;
	at org.apache.cassandra.io.util.BufferedDataOutputStreamPlus.&amp;lt;init&amp;gt;(BufferedDataOutputStreamPlus.java:74) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;apache-cassandra-2.2.0.jar:2.2.0&amp;#93;&lt;/span&gt;&lt;br/&gt;
	at org.apache.cassandra.net.OutboundTcpConnection.connect(OutboundTcpConnection.java:404) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;apache-cassandra-2.2.0.jar:2.2.0&amp;#93;&lt;/span&gt;&lt;br/&gt;
	at org.apache.cassandra.net.OutboundTcpConnection.run(OutboundTcpConnection.java:218) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;apache-cassandra-2.2.0.jar:2.2.0&amp;#93;&lt;/span&gt;&lt;br/&gt;
ERROR &lt;span class=&quot;error&quot;&gt;&amp;#91;MessagingService-Outgoing-/192.168.1.31&amp;#93;&lt;/span&gt; 2015-07-22 17:29:49,764 OutboundTcpConnection.java:229 - error processing a message intended for /192.168.1.31&lt;br/&gt;
java.lang.NullPointerException: null&lt;br/&gt;
	at com.google.common.base.Preconditions.checkNotNull(Preconditions.java:213) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;guava-16.0.jar:na&amp;#93;&lt;/span&gt;&lt;br/&gt;
	at org.apache.cassandra.io.util.BufferedDataOutputStreamPlus.&amp;lt;init&amp;gt;(BufferedDataOutputStreamPlus.java:74) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;apache-cassandra-2.2.0.jar:2.2.0&amp;#93;&lt;/span&gt;&lt;br/&gt;
	at org.apache.cassandra.net.OutboundTcpConnection.connect(OutboundTcpConnection.java:404) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;apache-cassandra-2.2.0.jar:2.2.0&amp;#93;&lt;/span&gt;&lt;br/&gt;
	at org.apache.cassandra.net.OutboundTcpConnection.run(OutboundTcpConnection.java:218) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;apache-cassandra-2.2.0.jar:2.2.0&amp;#93;&lt;/span&gt;&lt;br/&gt;
ERROR &lt;span class=&quot;error&quot;&gt;&amp;#91;MessagingService-Outgoing-/192.168.1.31&amp;#93;&lt;/span&gt; 2015-07-22 17:29:50,763 OutboundTcpConnection.java:316 - error writing to /192.168.1.31&lt;br/&gt;
java.lang.NullPointerException: null&lt;br/&gt;
	at org.apache.cassandra.net.OutboundTcpConnection.writeInternal(OutboundTcpConnection.java:323) &lt;span class=&quot;error&quot;&gt;&amp;#91;apache-cassandra-2.2.0.jar:2.2.0&amp;#93;&lt;/span&gt;&lt;br/&gt;
	at org.apache.cassandra.net.OutboundTcpConnection.writeConnected(OutboundTcpConnection.java:285) &lt;span class=&quot;error&quot;&gt;&amp;#91;apache-cassandra-2.2.0.jar:2.2.0&amp;#93;&lt;/span&gt;&lt;br/&gt;
	at org.apache.cassandra.net.OutboundTcpConnection.run(OutboundTcpConnection.java:219) &lt;span class=&quot;error&quot;&gt;&amp;#91;apache-cassandra-2.2.0.jar:2.2.0&amp;#93;&lt;/span&gt;&lt;br/&gt;
WARN  &lt;span class=&quot;error&quot;&gt;&amp;#91;MessagingService-Outgoing-/192.168.1.31&amp;#93;&lt;/span&gt; 2015-07-22 17:29:51,766 SSLFactory.java:163 - Filtering out TLS_DHE_RSA_WITH_AES_256_CBC_SHA,TLS_RSA_WITH_AES_256_CBC_SHA,TLS_ECDHE_RSA_WITH_AES_256_CBC_SHA as it isnt supported by the socket&lt;br/&gt;
ERROR &lt;span class=&quot;error&quot;&gt;&amp;#91;MessagingService-Outgoing-/192.168.1.31&amp;#93;&lt;/span&gt; 2015-07-22 17:29:51,767 OutboundTcpConnection.java:229 - error processing a message intended for /192.168.1.31&lt;br/&gt;
java.lang.NullPointerException: null&lt;br/&gt;
	at com.google.common.base.Preconditions.checkNotNull(Preconditions.java:213) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;guava-16.0.jar:na&amp;#93;&lt;/span&gt;&lt;br/&gt;
	at org.apache.cassandra.io.util.BufferedDataOutputStreamPlus.&amp;lt;init&amp;gt;(BufferedDataOutputStreamPlus.java:74) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;apache-cassandra-2.2.0.jar:2.2.0&amp;#93;&lt;/span&gt;&lt;br/&gt;
	at org.apache.cassandra.net.OutboundTcpConnection.connect(OutboundTcpConnection.java:404) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;apache-cassandra-2.2.0.jar:2.2.0&amp;#93;&lt;/span&gt;&lt;br/&gt;
	at org.apache.cassandra.net.OutboundTcpConnection.run(OutboundTcpConnection.java:218) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;apache-cassandra-2.2.0.jar:2.2.0&amp;#93;&lt;/span&gt;&lt;br/&gt;
ERROR &lt;span class=&quot;error&quot;&gt;&amp;#91;MessagingService-Outgoing-/192.168.1.33&amp;#93;&lt;/span&gt; 2015-07-22 17:29:52,764 OutboundTcpConnection.java:316 - error writing to /192.168.1.33&lt;br/&gt;
java.lang.NullPointerException: null&lt;br/&gt;
	at org.apache.cassandra.net.OutboundTcpConnection.writeInternal(OutboundTcpConnection.java:323) &lt;span class=&quot;error&quot;&gt;&amp;#91;apache-cassandra-2.2.0.jar:2.2.0&amp;#93;&lt;/span&gt;&lt;br/&gt;
	at org.apache.cassandra.net.OutboundTcpConnection.writeConnected(OutboundTcpConnection.java:285) &lt;span class=&quot;error&quot;&gt;&amp;#91;apache-cassandra-2.2.0.jar:2.2.0&amp;#93;&lt;/span&gt;&lt;br/&gt;
	at org.apache.cassandra.net.OutboundTcpConnection.run(OutboundTcpConnection.java:219) &lt;span class=&quot;error&quot;&gt;&amp;#91;apache-cassandra-2.2.0.jar:2.2.0&amp;#93;&lt;/span&gt;&lt;br/&gt;
ERROR &lt;span class=&quot;error&quot;&gt;&amp;#91;MessagingService-Outgoing-/192.168.1.31&amp;#93;&lt;/span&gt; 2015-07-22 17:29:52,764 OutboundTcpConnection.java:316 - error writing to /192.168.1.31&lt;br/&gt;
java.lang.NullPointerException: null&lt;br/&gt;
	at org.apache.cassandra.net.OutboundTcpConnection.writeInternal(OutboundTcpConnection.java:323) &lt;span class=&quot;error&quot;&gt;&amp;#91;apache-cassandra-2.2.0.jar:2.2.0&amp;#93;&lt;/span&gt;&lt;br/&gt;
	at org.apache.cassandra.net.OutboundTcpConnection.writeConnected(OutboundTcpConnection.java:285) &lt;span class=&quot;error&quot;&gt;&amp;#91;apache-cassandra-2.2.0.jar:2.2.0&amp;#93;&lt;/span&gt;&lt;br/&gt;
	at org.apache.cassandra.net.OutboundTcpConnection.run(OutboundTcpConnection.java:219) &lt;span class=&quot;error&quot;&gt;&amp;#91;apache-cassandra-2.2.0.jar:2.2.0&amp;#93;&lt;/span&gt;&lt;br/&gt;
WARN  &lt;span class=&quot;error&quot;&gt;&amp;#91;MessagingService-Outgoing-/192.168.1.31&amp;#93;&lt;/span&gt; 2015-07-22 17:29:53,767 SSLFactory.java:163 - Filtering out TLS_DHE_RSA_WITH_AES_256_CBC_SHA,TLS_RSA_WITH_AES_256_CBC_SHA,TLS_ECDHE_RSA_WITH_AES_256_CBC_SHA as it isnt supported by the socket&lt;br/&gt;
ERROR &lt;span class=&quot;error&quot;&gt;&amp;#91;MessagingService-Outgoing-/192.168.1.31&amp;#93;&lt;/span&gt; 2015-07-22 17:29:53,767 OutboundTcpConnection.java:229 - error processing a message intended for /192.168.1.31&lt;br/&gt;
java.lang.NullPointerException: null&lt;br/&gt;
	at com.google.common.base.Preconditions.checkNotNull(Preconditions.java:213) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;guava-16.0.jar:na&amp;#93;&lt;/span&gt;&lt;br/&gt;
	at org.apache.cassandra.io.util.BufferedDataOutputStreamPlus.&amp;lt;init&amp;gt;(BufferedDataOutputStreamPlus.java:74) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;apache-cassandra-2.2.0.jar:2.2.0&amp;#93;&lt;/span&gt;&lt;br/&gt;
	at org.apache.cassandra.net.OutboundTcpConnection.connect(OutboundTcpConnection.java:404) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;apache-cassandra-2.2.0.jar:2.2.0&amp;#93;&lt;/span&gt;&lt;br/&gt;
	at org.apache.cassandra.net.OutboundTcpConnection.run(OutboundTcpConnection.java:218) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;apache-cassandra-2.2.0.jar:2.2.0&amp;#93;&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;I had also tried to have the unrestricted JCE for Java 8 in and the error has changed.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://www.oracle.com/technetwork/java/javase/downloads/jce8-download-2133166.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://www.oracle.com/technetwork/java/javase/downloads/jce8-download-2133166.html&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;From:&lt;/p&gt;

&lt;p&gt;java.lang.NullPointerException: null&lt;br/&gt;
	at com.google.common.base.Preconditions.checkNotNull(Preconditions.java:213) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;guava-16.0.jar:na&amp;#93;&lt;/span&gt;&lt;br/&gt;
	at org.apache.cassandra.io.util.BufferedDataOutputStreamPlus.&amp;lt;init&amp;gt;(BufferedDataOutputStreamPlus.java:74) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;apache-cassandra-2.2.0.jar:2.2.0&amp;#93;&lt;/span&gt;&lt;br/&gt;
	at org.apache.cassandra.net.OutboundTcpConnection.connect(OutboundTcpConnection.java:404) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;apache-cassandra-2.2.0.jar:2.2.0&amp;#93;&lt;/span&gt;&lt;br/&gt;
	at org.apache.cassandra.net.OutboundTcpConnection.run(OutboundTcpConnection.java:218) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;apache-cassandra-2.2.0.jar:2.2.0&amp;#93;&lt;/span&gt;&lt;br/&gt;
ERROR &lt;span class=&quot;error&quot;&gt;&amp;#91;MessagingService-Outgoing-/192.168.1.33&amp;#93;&lt;/span&gt; 2015-07-22 17:29:52,764 OutboundTcpConnection.java:316 - error writing to /192.168.1.33&lt;/p&gt;

&lt;p&gt;To:&lt;/p&gt;

&lt;p&gt;ERROR &lt;span class=&quot;error&quot;&gt;&amp;#91;MessagingService-Outgoing-/192.168.1.33&amp;#93;&lt;/span&gt; 2015-07-23 14:51:01,319 OutboundTcpConnection.java:229 - error processing a message intended for /192.168.1.33&lt;br/&gt;
java.lang.NullPointerException: null&lt;br/&gt;
	at com.google.common.base.Preconditions.checkNotNull(Preconditions.java:213) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;guava-16.0.jar:na&amp;#93;&lt;/span&gt;&lt;br/&gt;
	at org.apache.cassandra.io.util.BufferedDataOutputStreamPlus.&amp;lt;init&amp;gt;(BufferedDataOutputStreamPlus.java:74) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;apache-cassandra-2.2.0.jar:2.2.0&amp;#93;&lt;/span&gt;&lt;br/&gt;
	at org.apache.cassandra.net.OutboundTcpConnection.connect(OutboundTcpConnection.java:404) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;apache-cassandra-2.2.0.jar:2.2.0&amp;#93;&lt;/span&gt;&lt;br/&gt;
	at org.apache.cassandra.net.OutboundTcpConnection.run(OutboundTcpConnection.java:218) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;apache-cassandra-2.2.0.jar:2.2.0&amp;#93;&lt;/span&gt;&lt;/p&gt;</description>
                <environment>&lt;p&gt;Ubuntu 14.04.2 LTS 64 bits.&lt;br/&gt;
Java version &quot;1.8.0_45&quot;&lt;br/&gt;
Java(TM) SE Runtime Environment (build 1.8.0_45-b14)&lt;br/&gt;
Java HotSpot(TM) 64-Bit Server VM (build 25.45-b02, mixed mode)&lt;/p&gt;</environment>
        <key id="12848693">CASSANDRA-9884</key>
            <summary>Error on encrypted node communication upgrading from 2.1.6 to 2.2.0</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10000" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Urgent</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="yukim">Yuki Morishita</assignee>
                                    <reporter username="scheidecker">Carlos Scheidecker</reporter>
                        <labels>
                            <label>security</label>
                    </labels>
                <created>Thu, 23 Jul 2015 21:02:17 +0000</created>
                <updated>Tue, 14 Oct 2025 12:13:58 +0000</updated>
                            <resolved>Fri, 7 Aug 2015 03:06:44 +0000</resolved>
                                        <fixVersion>2.2.1</fixVersion>
                                    <component>Local/Config</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>9</watches>
                                                                                                                <comments>
                            <comment id="14639586" author="scheidecker" created="Thu, 23 Jul 2015 21:57:16 +0000"  >&lt;p&gt;The issue happens on the connect method of the OutboundTcpConnection class.&lt;/p&gt;

&lt;p&gt;On 2.1.8 the outbound connection is initialized as out = new DataOutputStreamPlus(new BufferedOutputStream(socket.getOutputStream(), BUFFER_SIZE));&lt;/p&gt;

&lt;p&gt;While on 2.2.0 it is:&lt;/p&gt;

&lt;p&gt;out = new BufferedDataOutputStreamPlus(socket.getChannel(), BUFFER_SIZE);&lt;/p&gt;

&lt;p&gt;Mostly due to refactoring.&lt;/p&gt;

&lt;p&gt;Possibly the issue is before that on Google&apos;s guava-16.0 library which I would need more time to investigate and might be able to do it after work.&lt;/p&gt;</comment>
                            <comment id="14639608" author="yukim" created="Thu, 23 Jul 2015 22:21:06 +0000"  >&lt;p&gt;Sine SSLSocket is used, it does not have SocketChannel associated with.&lt;br/&gt;
We need to check null and use wrapped WritableByteChannel instead.&lt;/p&gt;

&lt;p&gt;patch: &lt;a href=&quot;https://github.com/yukim/cassandra/tree/9884&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/yukim/cassandra/tree/9884&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14639654" author="jasobrown" created="Thu, 23 Jul 2015 23:11:31 +0000"  >&lt;p&gt;+1&lt;/p&gt;</comment>
                            <comment id="14639781" author="scheidecker" created="Fri, 24 Jul 2015 01:22:49 +0000"  >&lt;p&gt;Still not corrected Yuki, but thanks. I had it recompiled and tested on all 4 nodes. Still has a null pointer error. This time, up on the code at writeConnected(QueuedMessage qm, boolean flush) and run() functions.&lt;/p&gt;

&lt;p&gt;ERROR &lt;span class=&quot;error&quot;&gt;&amp;#91;MessagingService-Outgoing-/192.168.1.34&amp;#93;&lt;/span&gt; 2015-07-23 19:18:34,686 OutboundTcpConnection.java:229 - error processing a message intended for /192.168.1.34&lt;br/&gt;
java.lang.NullPointerException: null&lt;br/&gt;
	at com.google.common.base.Preconditions.checkNotNull(Preconditions.java:213) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;guava-16.0.jar:na&amp;#93;&lt;/span&gt;&lt;br/&gt;
	at org.apache.cassandra.io.util.BufferedDataOutputStreamPlus.&amp;lt;init&amp;gt;(BufferedDataOutputStreamPlus.java:74) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;apache-cassandra-2.2.0-SNAPSHOT.jar:2.2.0-SNAPSHOT&amp;#93;&lt;/span&gt;&lt;br/&gt;
	at org.apache.cassandra.net.OutboundTcpConnection.connect(OutboundTcpConnection.java:404) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;apache-cassandra-2.2.0-SNAPSHOT.jar:2.2.0-SNAPSHOT&amp;#93;&lt;/span&gt;&lt;br/&gt;
	at org.apache.cassandra.net.OutboundTcpConnection.run(OutboundTcpConnection.java:218) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;apache-cassandra-2.2.0-SNAPSHOT.jar:2.2.0-SNAPSHOT&amp;#93;&lt;/span&gt;&lt;br/&gt;
ERROR &lt;span class=&quot;error&quot;&gt;&amp;#91;MessagingService-Outgoing-/192.168.1.34&amp;#93;&lt;/span&gt; 2015-07-23 19:18:35,683 OutboundTcpConnection.java:316 - error writing to /192.168.1.34&lt;br/&gt;
java.lang.NullPointerException: null&lt;br/&gt;
	at org.apache.cassandra.net.OutboundTcpConnection.writeInternal(OutboundTcpConnection.java:323) &lt;span class=&quot;error&quot;&gt;&amp;#91;apache-cassandra-2.2.0-SNAPSHOT.jar:2.2.0-SNAPSHOT&amp;#93;&lt;/span&gt;&lt;br/&gt;
	at org.apache.cassandra.net.OutboundTcpConnection.writeConnected(OutboundTcpConnection.java:285) &lt;span class=&quot;error&quot;&gt;&amp;#91;apache-cassandra-2.2.0-SNAPSHOT.jar:2.2.0-SNAPSHOT&amp;#93;&lt;/span&gt;&lt;br/&gt;
	at org.apache.cassandra.net.OutboundTcpConnection.run(OutboundTcpConnection.java:219) &lt;span class=&quot;error&quot;&gt;&amp;#91;apache-cassandra-2.2.0-SNAPSHOT.jar:2.2.0-SNAPSHOT&amp;#93;&lt;/span&gt;&lt;br/&gt;
ERROR &lt;span class=&quot;error&quot;&gt;&amp;#91;MessagingService-Outgoing-/192.168.1.33&amp;#93;&lt;/span&gt; 2015-07-23 19:18:35,683 OutboundTcpConnection.java:316 - error writing to /192.168.1.33&lt;br/&gt;
java.lang.NullPointerException: null&lt;br/&gt;
	at org.apache.cassandra.net.OutboundTcpConnection.writeInternal(OutboundTcpConnection.java:323) &lt;span class=&quot;error&quot;&gt;&amp;#91;apache-cassandra-2.2.0-SNAPSHOT.jar:2.2.0-SNAPSHOT&amp;#93;&lt;/span&gt;&lt;br/&gt;
	at org.apache.cassandra.net.OutboundTcpConnection.writeConnected(OutboundTcpConnection.java:285) &lt;span class=&quot;error&quot;&gt;&amp;#91;apache-cassandra-2.2.0-SNAPSHOT.jar:2.2.0-SNAPSHOT&amp;#93;&lt;/span&gt;&lt;br/&gt;
	at org.apache.cassandra.net.OutboundTcpConnection.run(OutboundTcpConnection.java:219) &lt;span class=&quot;error&quot;&gt;&amp;#91;apache-cassandra-2.2.0-SNAPSHOT.jar:2.2.0-SNAPSHOT&amp;#93;&lt;/span&gt;&lt;/p&gt;</comment>
                            <comment id="14639787" author="scheidecker" created="Fri, 24 Jul 2015 01:25:22 +0000"  >&lt;p&gt;Maybe I should get access to the repository and start contributing/helping more. Sorry about this guys.&lt;/p&gt;</comment>
                            <comment id="14639887" author="yukim" created="Fri, 24 Jul 2015 04:16:05 +0000"  >&lt;p&gt;Can you check if the patch is correctly applied?&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;OutboundTcpConnection.connect(OutboundTcpConnection.java:404)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;is the same line number as your original report. Patch added null check so NPE shouldn&apos;t happen in there.&lt;/p&gt;</comment>
                            <comment id="14645991" author="kel" created="Wed, 29 Jul 2015 12:48:52 +0000"  >&lt;p&gt;I&apos;m having the issue as well. However, the same configuration works on 2.1.8.&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;ERROR 12:09:22 error processing a message intended for /&amp;lt;IP&amp;gt;
java.lang.NullPointerException: null
	at com.google.common.base.Preconditions.checkNotNull(Preconditions.java:213) ~[guava-16.0.jar:na]
	at org.apache.cassandra.io.util.BufferedDataOutputStreamPlus.&amp;lt;init&amp;gt;(BufferedDataOutputStreamPlus.java:74) ~[apache-cassandra-2.2.0.jar:2.2.0]
	at org.apache.cassandra.net.OutboundTcpConnection.connect(OutboundTcpConnection.java:404) ~[apache-cassandra-2.2.0.jar:2.2.0]
	at org.apache.cassandra.net.OutboundTcpConnection.run(OutboundTcpConnection.java:218) ~[apache-cassandra-2.2.0.jar:2.2.0]
ERROR 12:09:23 error writing to /104.155.5.100
java.lang.NullPointerException: null
	at org.apache.cassandra.net.OutboundTcpConnection.writeInternal(OutboundTcpConnection.java:323) [apache-cassandra-2.2.0.jar:2.2.0]
	at org.apache.cassandra.net.OutboundTcpConnection.writeConnected(OutboundTcpConnection.java:285) [apache-cassandra-2.2.0.jar:2.2.0]
	at org.apache.cassandra.net.OutboundTcpConnection.run(OutboundTcpConnection.java:219) [apache-cassandra-2.2.0.jar:2.2.0]
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="14646629" author="nutbunnies" created="Wed, 29 Jul 2015 19:19:19 +0000"  >&lt;p&gt;This appears to be just a 2.2 issue and not related to the process of upgrading from 2.1.x to 2.2.  As far as I can tell no new configuration is need for internode SSL communication on 2.2 and a fresh 2.2 cluster shows this failure.  &lt;/p&gt;

&lt;p&gt;Applying the above patch does resolve the issue in my testing.  I have added a simple internode SSL verification test and updated the upgrading test to run with/without internode SSL to casasandra-dtest.  &lt;a href=&quot;https://github.com/riptano/cassandra-dtest/pull/427&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/riptano/cassandra-dtest/pull/427&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14646644" author="yukim" created="Wed, 29 Jul 2015 19:40:45 +0000"  >&lt;p&gt;Thanks for testing! I appreciate your effort to add internode SSL test to dtest.&lt;/p&gt;

&lt;p&gt;Committed to 2.2 and trunk.&lt;/p&gt;</comment>
                            <comment id="14654155" author="yukim" created="Tue, 4 Aug 2015 18:55:27 +0000"  >&lt;p&gt;Looks like there is one more place we need to patch when internode compresssion is off.&lt;br/&gt;
Reopening.&lt;/p&gt;</comment>
                            <comment id="14654359" author="yukim" created="Tue, 4 Aug 2015 21:19:14 +0000"  >&lt;p&gt;IncomingTcpConnection also needs to be fixed.&lt;/p&gt;

&lt;p&gt;patch here: &lt;a href=&quot;https://github.com/riptano/cassandra-dtest/pull/440&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/riptano/cassandra-dtest/pull/440&lt;/a&gt;&lt;br/&gt;
dtest is added for this scenario: &lt;a href=&quot;https://github.com/riptano/cassandra-dtest/pull/440&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/riptano/cassandra-dtest/pull/440&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14660797" author="JIRAUSER308715" created="Thu, 6 Aug 2015 21:10:42 +0000"  >&lt;p&gt;I assume you mean patch here: &lt;a href=&quot;https://github.com/yukim/cassandra/tree/9884-followup&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/yukim/cassandra/tree/9884-followup&lt;/a&gt; ?&lt;/p&gt;</comment>
                            <comment id="14660850" author="yukim" created="Thu, 6 Aug 2015 21:40:44 +0000"  >&lt;p&gt;Yes, that one, sorry.&lt;/p&gt;</comment>
                            <comment id="14660882" author="JIRAUSER308715" created="Thu, 6 Aug 2015 22:13:39 +0000"  >&lt;p&gt;+1 from me for the new patch, it fixes the issue I was seeing.&lt;/p&gt;</comment>
                            <comment id="14661243" author="yukim" created="Fri, 7 Aug 2015 03:06:44 +0000"  >&lt;p&gt;Committed, thanks!&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[yukim]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310250" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10431"><![CDATA[Important]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 15 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2hv13:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12311421" key="com.atlassian.jira.plugin.system.customfieldtypes:multiversion">
                        <customfieldname>Reproduced In</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="12332983">2.2.0</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>jasobrown</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[jasobrown]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12963"><![CDATA[Critical]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12311420" key="com.atlassian.jira.plugin.system.customfieldtypes:version">
                        <customfieldname>Since Version</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="12332983">2.2.0</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12311124" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Tester</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>nutbunnies</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>