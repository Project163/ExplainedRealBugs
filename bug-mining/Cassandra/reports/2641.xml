<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 22:43:12 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-6636] sstableloader fails when attempting to load data from a single node into a multi-node cluster</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-6636</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;I&apos;m running into this exception when trying to use sstableloader to bring in data from another cluster:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;rhatch@whatup:~/.ccm/test_cluster_1391031988/node1$ bin/sstableloader -d 127.0.0.1 ~/tmp/Keyspace1/Standard1
Established connection to initial hosts
Opening sstables and calculating sections to stream
Streaming relevant part of /home/rhatch/tmp/Keyspace1/Standard1/Keyspace1-Standard1-jb-5-Data.db /home/rhatch/tmp/Keyspace1/Standard1/Keyspace1-Standard1-jb-6-Data.db to [/127.0.0.1, /127.0.0.2, /127.0.0.3]
Exception in thread &quot;STREAM-OUT-/127.0.0.1&quot; java.lang.NullPointerException
	at org.apache.cassandra.streaming.ConnectionHandler$MessageHandler.signalCloseDone(ConnectionHandler.java:249)
	at org.apache.cassandra.streaming.ConnectionHandler$OutgoingMessageHandler.run(ConnectionHandler.java:375)
	at java.lang.Thread.run(Thread.java:744)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This is what I see in the node system.log:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;==&amp;gt; ./test_cluster_1391031988/node1/logs/system.log &amp;lt;==
 INFO [STREAM-INIT-/127.0.0.1:60971] 2014-01-29 14:57:25,375 StreamResultFuture.java (line 116) [Stream #564ded70-8930-11e3-84e9-2766c3cc4197] Received streaming plan for Bulk Load
 INFO [STREAM-IN-/127.0.1.1] 2014-01-29 14:57:25,375 StreamResultFuture.java (line 168) [Stream #564ded70-8930-11e3-84e9-2766c3cc4197] Prepare completed. Receiving 2 files(91047224 bytes), sending 0 files(0 bytes)

&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;steps to reproduce:&lt;/p&gt;

&lt;p&gt;create a 3 node cluster with ccm&lt;/p&gt;

&lt;p&gt;run stress on one node with &apos;ccm node1 stress&apos;&lt;/p&gt;

&lt;p&gt;copy the node&apos;s data from the data/Keyspace1/Standard1 directory to save it for re-loading (preserve the directory structure for sstableloader)&lt;/p&gt;

&lt;p&gt;remove the cluster, and create a new 3 node cluster&lt;/p&gt;

&lt;p&gt;pick a node and run bin/nodetool -d localhost ~/saved_data_location/Keyspace1/Standard1&lt;/p&gt;</description>
                <environment>&lt;p&gt;java version &quot;1.7.0_51&quot;&lt;br/&gt;
cassandra from cassandra-2.0 branch (0be424...)&lt;/p&gt;</environment>
        <key id="12692155">CASSANDRA-6636</key>
            <summary>sstableloader fails when attempting to load data from a single node into a multi-node cluster</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10003" iconUrl="https://issues.apache.org/jira/images/icons/priorities/trivial.svg">Low</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="yukim">Yuki Morishita</assignee>
                                    <reporter username="rhatch">Russ Hatch</reporter>
                        <labels>
                    </labels>
                <created>Wed, 29 Jan 2014 22:04:32 +0000</created>
                <updated>Tue, 16 Apr 2019 09:31:55 +0000</updated>
                            <resolved>Fri, 28 Feb 2014 21:35:26 +0000</resolved>
                                        <fixVersion>2.0.6</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="13885883" author="rhatch" created="Wed, 29 Jan 2014 22:05:51 +0000"  >&lt;p&gt;I reproduced this with the latest code on the cassandra-2.0 branch.&lt;/p&gt;

&lt;p&gt;I should also note that the sstableloader command succeeds if I attempt importing into a single node cluster (instead of into a 3 node cluster).&lt;/p&gt;</comment>
                            <comment id="13885931" author="rhatch" created="Wed, 29 Jan 2014 22:40:41 +0000"  >&lt;p&gt;One other strange thing to note: I was able to successfully load data into node2 and node3. After that, the load also worked on node1.&lt;/p&gt;</comment>
                            <comment id="13885941" author="yukim" created="Wed, 29 Jan 2014 22:47:41 +0000"  >&lt;p&gt;I can reproduced in my box. I will investigate.&lt;/p&gt;</comment>
                            <comment id="13887088" author="yukim" created="Thu, 30 Jan 2014 21:33:41 +0000"  >&lt;p&gt;So the root cause I tracked down is actually NPE when showing progress.&lt;br/&gt;
BulkLoader expects to receive StreamEvent PREPARE to setup progress indicator. But when you get the exception, event listener is registered after streaming emits PREPARE event. I think this is more likely to happen in dev environment like ccm.&lt;/p&gt;</comment>
                            <comment id="13900888" author="jbellis" created="Thu, 13 Feb 2014 23:31:01 +0000"  >&lt;p&gt;How involved would fixing this be?&lt;/p&gt;</comment>
                            <comment id="13909421" author="yukim" created="Sat, 22 Feb 2014 16:15:24 +0000"  >&lt;blockquote&gt;&lt;p&gt;How involved would fixing this be?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Not much. I attached patch to add event handler through StreamPlan so that BulkLoader can attach progress handler before receiving any stream event.&lt;/p&gt;</comment>
                            <comment id="13909444" author="jbellis" created="Sat, 22 Feb 2014 17:18:20 +0000"  >&lt;p&gt;Can you review, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=kohlisankalp&quot; class=&quot;user-hover&quot; rel=&quot;kohlisankalp&quot;&gt;kohlisankalp&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13910577" author="kohlisankalp" created="Mon, 24 Feb 2014 17:54:41 +0000"  >&lt;p&gt;Sure.&lt;/p&gt;</comment>
                            <comment id="13916263" author="kohlisankalp" created="Fri, 28 Feb 2014 19:50:34 +0000"  >&lt;p&gt;The StreamPlan.handlers is not thread safe but here it is set by same thread so it is good.&lt;br/&gt;
So looks good.  &lt;/p&gt;</comment>
                            <comment id="13916425" author="yukim" created="Fri, 28 Feb 2014 21:35:26 +0000"  >&lt;p&gt;Right, StreamPlan is not intended to be used from multiple threads.&lt;/p&gt;

&lt;p&gt;Thanks for the review. Committed.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12630482" name="6636-2.0.txt" size="4494" author="yukim" created="Sat, 22 Feb 2014 16:15:24 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[yukim]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>370746</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            11 years, 38 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1rwbb:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>371054</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12311421" key="com.atlassian.jira.plugin.system.customfieldtypes:multiversion">
                        <customfieldname>Reproduced In</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="12325761">2.0.5</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>kohlisankalp</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[kohlisankalp]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12961"><![CDATA[Low]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>