<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 22:19:21 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-2169] user created with debian packaging is unable to increase memlock</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-2169</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;To reproduce:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Install a fresh copy of ubuntu 10.04.&lt;/li&gt;
	&lt;li&gt;Install sun&apos;s java6 jdk.&lt;/li&gt;
	&lt;li&gt;Install libjna-java 3.2.7 into /usr/share/java.&lt;/li&gt;
	&lt;li&gt;Install cassandra 0.7.0 from the apache debian packages.&lt;/li&gt;
	&lt;li&gt;Start cassandra using /etc/init.d/cassandra&lt;br/&gt;
In the output.log there will be the following error:
&lt;blockquote&gt;
&lt;p&gt;Unable to lock JVM memory (ENOMEM). This can result in part of the JVM being swapped out, especially with mmapped I/O enabled. Increase RLIMIT_MEMLOCK or run Cassandra as root.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;This shouldn&apos;t be as the debian package creates /etc/security/limits.d/cassandra.conf and sets the cassandra user&apos;s memlock limit to &apos;unlimited&apos;.&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;I tried a variety of things including making the memlock unlimited for all users in /etc/security/limits.conf.  I was able to run cassandra using root with jna symbolically linked into /usr/share/cassandra from /usr/share/java, but I could never get the init.d script to work and get beyond that error.&lt;/p&gt;

&lt;p&gt;Based on all the trial and error, I think it might have to do with the cassandra user itself, but my debian/ubuntu fu isn&apos;t as good as others&apos;.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12498679">CASSANDRA-2169</key>
            <summary>user created with debian packaging is unable to increase memlock</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10003" iconUrl="https://issues.apache.org/jira/images/icons/priorities/trivial.svg">Low</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="jeromatron">Jeremy Hanna</assignee>
                                    <reporter username="jeromatron">Jeremy Hanna</reporter>
                        <labels>
                    </labels>
                <created>Tue, 15 Feb 2011 19:36:01 +0000</created>
                <updated>Tue, 16 Apr 2019 09:33:06 +0000</updated>
                            <resolved>Sat, 19 Feb 2011 22:54:19 +0000</resolved>
                                        <fixVersion>0.7.3</fixVersion>
                                    <component>Packaging</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="12994961" author="jeromatron" created="Tue, 15 Feb 2011 19:46:44 +0000"  >&lt;p&gt;Upgraded to 0.7.1 and still appears to have the same issue.&lt;/p&gt;</comment>
                            <comment id="12995446" author="brandon.williams" created="Wed, 16 Feb 2011 18:39:19 +0000"  >&lt;p&gt;What happens if you su to the cassandra user and check ulimit?&lt;/p&gt;</comment>
                            <comment id="12995449" author="jeromatron" created="Wed, 16 Feb 2011 18:50:33 +0000"  >&lt;p&gt;&quot;ulimit -l&quot; always returns 64.&lt;/p&gt;

&lt;p&gt;I gave the cassandra user a shell so I can su to that user.  When I do, the memlock doesn&apos;t ever take - whether it&apos;s defined in /etc/security/limits.conf for the cassandra user, for all users &apos;*&apos;, or in the /etc/security/limits.d/cassandra.conf.&lt;/p&gt;</comment>
                            <comment id="12995451" author="brandon.williams" created="Wed, 16 Feb 2011 18:53:38 +0000"  >&lt;p&gt;Just to be certain limits.conf is taking effect, have you tried rebooting the box since changing it?&lt;/p&gt;</comment>
                            <comment id="12995455" author="jeromatron" created="Wed, 16 Feb 2011 18:56:19 +0000"  >&lt;p&gt;I made sure it took effect for the user I originally logged in as - ubuntu for my ec2 instance and jeremy for my local vm.  It took effect for those users whenever I changed it.  I also tried rebooting.  That was the way it took effect for the ec2 server&apos;s ubuntu user iirc.  But it didn&apos;t take effect for the cassandra user.&lt;/p&gt;</comment>
                            <comment id="12995524" author="jeromatron" created="Wed, 16 Feb 2011 21:17:29 +0000"  >&lt;p&gt;Based on a suggestion from jake and brandon, I added &lt;blockquote&gt;&lt;p&gt;session required pam_limits.so&lt;/p&gt;&lt;/blockquote&gt; to /etc/pam.d/common-session and rebooted.  That made it so the memlock value was set correctly.  However, for some reason, using /etc/init.d/cassandra still gives the memory locking error.  I su to the cassandra user and run &lt;blockquote&gt;&lt;p&gt;/usr/sbin/cassandra -f&lt;/p&gt;&lt;/blockquote&gt; and it is able to lock the memory.&lt;/p&gt;

&lt;p&gt;For the pam setting, see &lt;a href=&quot;http://posidev.com/blog/2009/06/04/set-ulimit-parameters-on-ubuntu/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://posidev.com/blog/2009/06/04/set-ulimit-parameters-on-ubuntu/&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="12996240" author="thepaul" created="Fri, 18 Feb 2011 05:10:22 +0000"  >&lt;p&gt;I grepped through jsvc&apos;s source, and I don&apos;t see any references to pam at all. So unless the jre has some special &quot;switch users and set up a pam session&quot; functionality I don&apos;t know about, jsvc isn&apos;t setting up a pam session when switching users.&lt;/p&gt;

&lt;p&gt;This means limits.conf (and limits.d/cassandra.conf) are useless, except in what they define for root&apos;s resource limits.&lt;/p&gt;

&lt;p&gt;If we want to use both limits.conf and jsvc, then hrm. Maybe we could switch users in the initscript using /bin/su, but afaik default debian and ubuntu systems all comment out pam_limits.so from /etc/pam.d/su , so that wouldn&apos;t work without monkeying with users&apos; conffiles.&lt;/p&gt;

&lt;p&gt;We could switch users in the initscript with sudo, but it&apos;s pretty hard to be sure the user hasn&apos;t done something funky with their sudoers file which would break our startup.&lt;/p&gt;

&lt;p&gt;I can only come up with 2 halfway-decent options: both involve ditching limits.d/cassandra.conf.&lt;/p&gt;

&lt;p&gt;1: just /bin/su in the initscript and do a &apos;ulimit -l unlimited&apos; in the child before exec&apos;ing jsvc.&lt;/p&gt;

&lt;p&gt;2: implement limit setting and user switching in cassandra itself. is there any good way to do setrlimit() and setuid() in java?&lt;/p&gt;</comment>
                            <comment id="12996242" author="jbellis" created="Fri, 18 Feb 2011 05:19:55 +0000"  >&lt;blockquote&gt;&lt;p&gt;2: implement limit setting and user switching in cassandra itself. is there any good way to do setrlimit() and setuid() in java?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;No, you&apos;d have to write a JNI wrapper or use JNA.  (Which I guess is technically feasible since JNA is packaged for both deb and rpm but eww. &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="12996243" author="thepaul" created="Fri, 18 Feb 2011 05:23:28 +0000"  >&lt;p&gt;Actually, durr, you could just do &apos;ulimit -l unlimited&apos; in sh before switching users. It should stick. Sorry, I&apos;m slow tonight.&lt;/p&gt;

&lt;p&gt;Still might be a good idea to keep limits.d/cassandra.conf around, in case people want to su or sudo to the cassandra user for testing stuff.&lt;/p&gt;</comment>
                            <comment id="12996493" author="jeromatron" created="Fri, 18 Feb 2011 16:21:10 +0000"  >&lt;p&gt;Paul: so is that something that would go in the /debian configuration as a change?  Would you like me to try that in my test server and see if that resolves the problem?&lt;/p&gt;</comment>
                            <comment id="12996562" author="jeromatron" created="Fri, 18 Feb 2011 18:49:08 +0000"  >&lt;p&gt;so adding that manually to the /etc/init.d/cassandra script does the trick.  I will submit a patch that adds that.  Thanks guys!&lt;/p&gt;</comment>
                            <comment id="12996596" author="jeromatron" created="Fri, 18 Feb 2011 21:14:26 +0000"  >&lt;p&gt;One line patch to fix the ulimit stuff.&lt;/p&gt;</comment>
                            <comment id="12996924" author="urandom" created="Sat, 19 Feb 2011 22:54:19 +0000"  >&lt;p&gt;committed; thanks!&lt;/p&gt;</comment>
                            <comment id="12996929" author="hudson" created="Sat, 19 Feb 2011 23:16:39 +0000"  >&lt;p&gt;Integrated in Cassandra-0.7 #299 (See &lt;a href=&quot;https://hudson.apache.org/hudson/job/Cassandra-0.7/299/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://hudson.apache.org/hudson/job/Cassandra-0.7/299/&lt;/a&gt;)&lt;br/&gt;
    increase memlock at daemon startup&lt;/p&gt;

&lt;p&gt;Patch by Jeremy Hanna; reviewed by eevans for &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-2169&quot; title=&quot;user created with debian packaging is unable to increase memlock&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-2169&quot;&gt;&lt;del&gt;CASSANDRA-2169&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12471439" name="2169-0_7.txt" size="392" author="jeromatron" created="Fri, 18 Feb 2011 21:14:51 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[jeromatron]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>20478</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            14 years, 40 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0g9qn:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>93008</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>urandom</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[urandom]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12961"><![CDATA[Low]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>