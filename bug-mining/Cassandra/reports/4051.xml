<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 23:00:34 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-10477] java.lang.AssertionError in StorageProxy.submitHint</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-10477</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;A few days after updating from 2.0.15 to 2.1.9 we have the following log entry on 2 of 5 machines:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;ERROR [EXPIRING-MAP-REAPER:1] 2015-10-07 17:01:08,041 CassandraDaemon.java:223 - Exception in thread Thread[EXPIRING-MAP-REAPER:1,5,main]
java.lang.AssertionError: /192.168.11.88
        at org.apache.cassandra.service.StorageProxy.submitHint(StorageProxy.java:949) ~[apache-cassandra-2.1.9.jar:2.1.9]
        at org.apache.cassandra.net.MessagingService$5.apply(MessagingService.java:383) ~[apache-cassandra-2.1.9.jar:2.1.9]
        at org.apache.cassandra.net.MessagingService$5.apply(MessagingService.java:363) ~[apache-cassandra-2.1.9.jar:2.1.9]
        at org.apache.cassandra.utils.ExpiringMap$1.run(ExpiringMap.java:98) ~[apache-cassandra-2.1.9.jar:2.1.9]
        at org.apache.cassandra.concurrent.DebuggableScheduledThreadPoolExecutor$UncomplainingRunnable.run(DebuggableScheduledThreadPoolExecutor.java:118) ~[apache-cassandra-2.1.9.jar:2.1.9]
        at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511) [na:1.8.0_45]
        at java.util.concurrent.FutureTask.runAndReset(FutureTask.java:308) [na:1.8.0_45]
        at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.access$301(ScheduledThreadPoolExecutor.java:180) [na:1.8.0_45]
        at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:294) [na:1.8.0_45]
        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1142) [na:1.8.0_45]
        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:617) [na:1.8.0_45]
        at java.lang.Thread.run(Thread.java:745) [na:1.8.0_45]
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;192.168.11.88 is the broadcast address of the local machine.&lt;/p&gt;

&lt;p&gt;When this is logged the read request latency of the whole cluster becomes very bad, from 6 ms/op to more than 100 ms/op according to OpsCenter. Clients get a lot of timeouts. We need to restart the affected Cassandra node to get back normal read latencies. It seems write latency is not affected.&lt;/p&gt;

&lt;p&gt;Disabling hinted handoff using &lt;tt&gt;nodetool disablehandoff&lt;/tt&gt; only prevents the assert from being logged. At some point the read latency becomes bad again. Restarting the node where hinted handoff was disabled results in the read latency being better again.&lt;/p&gt;</description>
                <environment>&lt;p&gt;CentOS 6, Oracle JVM 1.8.45&lt;/p&gt;</environment>
        <key id="12903277">CASSANDRA-10477</key>
            <summary>java.lang.AssertionError in StorageProxy.submitHint</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10002" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Normal</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="aweisberg">Ariel Weisberg</assignee>
                                    <reporter username="leonhardt">Severin Leonhardt</reporter>
                        <labels>
                    </labels>
                <created>Thu, 8 Oct 2015 07:57:05 +0000</created>
                <updated>Tue, 16 Apr 2019 09:30:54 +0000</updated>
                            <resolved>Wed, 13 Jan 2016 10:38:44 +0000</resolved>
                                        <fixVersion>2.1.13</fixVersion>
                    <fixVersion>2.2.5</fixVersion>
                    <fixVersion>3.0.3</fixVersion>
                    <fixVersion>3.3</fixVersion>
                                    <component>Legacy/Local Write-Read Paths</component>
                        <due></due>
                            <votes>3</votes>
                                    <watches>12</watches>
                                                                                                                <comments>
                            <comment id="14950826" author="philipthompson" created="Fri, 9 Oct 2015 17:32:09 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=iamaleksey&quot; class=&quot;user-hover&quot; rel=&quot;iamaleksey&quot;&gt;iamaleksey&lt;/a&gt;, who should be assigned to this?&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=leonhardt&quot; class=&quot;user-hover&quot; rel=&quot;leonhardt&quot;&gt;leonhardt&lt;/a&gt;, can you attach the system.log file from one of the affected nodes?&lt;/p&gt;</comment>
                            <comment id="14953112" author="leonhardt" created="Mon, 12 Oct 2015 13:27:08 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=philipthompson&quot; class=&quot;user-hover&quot; rel=&quot;philipthompson&quot;&gt;philipthompson&lt;/a&gt; I can&apos;t make the logfile publicly accessible but I can share it by mail. Let me know to whom I should send it.&lt;/p&gt;</comment>
                            <comment id="14953262" author="philipthompson" created="Mon, 12 Oct 2015 16:16:56 +0000"  >&lt;p&gt;Once I find someone to work on this, they&apos;ll share their contact info with you. Thanks.&lt;/p&gt;</comment>
                            <comment id="14999369" author="aweisberg" created="Tue, 10 Nov 2015 21:20:35 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=leonhardt&quot; class=&quot;user-hover&quot; rel=&quot;leonhardt&quot;&gt;leonhardt&lt;/a&gt; can you email me the log file to the address in my profile?&lt;/p&gt;</comment>
                            <comment id="14999379" author="aweisberg" created="Tue, 10 Nov 2015 21:29:25 +0000"  >&lt;p&gt;This assertion makes it look like the node either think it&apos;s broadcast address is that of another node, or alternatively it is connecting with itself which is causing it to submit hints to itself which is what the assertion is checking for. Neither condition should occur.&lt;/p&gt;

&lt;p&gt;If you could also get me the output of &quot;netstat -tlnp&quot; along with node tool status, ring, and netstats when the problem occurs that would be helpful. You could do it now just to see if something shows up, but definitely when the problem occurs.&lt;/p&gt;</comment>
                            <comment id="14999962" author="hbcheng" created="Wed, 11 Nov 2015 05:37:34 +0000"  >&lt;p&gt;Hello, we just observed this on a cluster running 2.1.11, Oracle Java 1.8.0_66.&lt;/p&gt;

&lt;p&gt;A single machine experienced this issue, causing our entire cluster to grind to a halt on any quorum operations.&lt;/p&gt;

&lt;p&gt;Our logs feature an extremely large number of:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;ERROR [EXPIRING-MAP-REAPER:1] 2015-11-11 05:10:22,894 CassandraDaemon.java:227 - Exception in threa
d &lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;[EXPIRING-MAP-REAPER:1,5,main]
java.lang.AssertionError: /172.31.3.33
        at org.apache.cassandra.service.StorageProxy.submitHint(StorageProxy.java:949) ~[apache-cas
sandra-2.1.11.jar:2.1.11]
        at org.apache.cassandra.net.MessagingService$5.apply(MessagingService.java:383) ~[apache-ca
ssandra-2.1.11.jar:2.1.11]
        at org.apache.cassandra.net.MessagingService$5.apply(MessagingService.java:363) ~[apache-ca
ssandra-2.1.11.jar:2.1.11]
        at org.apache.cassandra.utils.ExpiringMap$1.run(ExpiringMap.java:98) ~[apache-cassandra-2.1
.11.jar:2.1.11]
        at org.apache.cassandra.concurrent.DebuggableScheduledThreadPoolExecutor$UncomplainingRunna
ble.run(DebuggableScheduledThreadPoolExecutor.java:118) ~[apache-cassandra-2.1.11.jar:2.1.11]
        at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511) [na:1.8.0_66]
        at java.util.concurrent.FutureTask.runAndReset(FutureTask.java:308) [na:1.8.0_66]
        at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.access$301(Schedule
dThreadPoolExecutor.java:180) [na:1.8.0_66]
        at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThread
PoolExecutor.java:294) [na:1.8.0_66]
        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1142) [na:1.8.
0_66]
        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:617) [na:1.8.
0_66]
        at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:745) [na:1.8.0_66]
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Additionally, this is interspersed with every nearly every other neighbor node being marked down:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;INFO  [GossipStage:1] 2015-11-11 04:14:25,369 Gossiper.java:1020 - Node /172.31.55.172 has restarted, now UP
INFO  [GossipStage:1] 2015-11-11 04:14:25,369 TokenMetadata.java:414 - Updating topology &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; /172.31.55.172
INFO  [GossipStage:1] 2015-11-11 04:14:25,369 TokenMetadata.java:414 - Updating topology &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; /172.31.55.172
INFO  [GossipStage:1] 2015-11-11 04:14:25,370 StorageService.java:1698 - Node /172.31.55.172 state jump to normal
INFO  [GossipStage:1] 2015-11-11 04:14:25,372 TokenMetadata.java:414 - Updating topology &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; /172.31.55.172
INFO  [GossipStage:1] 2015-11-11 04:14:25,372 TokenMetadata.java:414 - Updating topology &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; /172.31.55.172
INFO  [SharedPool-Worker-3] 2015-11-11 04:14:25,531 Gossiper.java:987 - InetAddress /172.31.55.172 is now UP
INFO  [SharedPool-Worker-5] 2015-11-11 04:14:25,536 Gossiper.java:987 - InetAddress /172.31.55.172 is now UP
INFO  [SharedPool-Worker-3] 2015-11-11 04:14:25,536 Gossiper.java:987 - InetAddress /172.31.55.172 is now UP
INFO  [SharedPool-Worker-1] 2015-11-11 04:14:25,536 Gossiper.java:987 - InetAddress /172.31.55.172 is now UP
INFO  [SharedPool-Worker-4] 2015-11-11 04:14:25,536 Gossiper.java:987 - InetAddress /172.31.55.172 is now UP
INFO  [HANDSHAKE-/172.31.55.172] 2015-11-11 04:14:25,537 OutboundTcpConnection.java:485 - Handshaking version with /172.31.55.172
[snipped]
WARN  [GossipTasks:1] 2015-11-11 04:18:26,379 Gossiper.java:747 - Gossip stage has 15 pending tasks
; skipping status check (no nodes will be marked down)
WARN  [GossipTasks:1] 2015-11-11 04:18:27,480 Gossiper.java:747 - Gossip stage has 17 pending tasks
; skipping status check (no nodes will be marked down)
WARN  [GossipTasks:1] 2015-11-11 04:18:28,580 Gossiper.java:747 - Gossip stage has 19 pending tasks
; skipping status check (no nodes will be marked down)
WARN  [GossipTasks:1] 2015-11-11 04:18:29,681 Gossiper.java:747 - Gossip stage has 21 pending tasks
; skipping status check (no nodes will be marked down)
WARN  [GossipTasks:1] 2015-11-11 04:18:30,781 Gossiper.java:747 - Gossip stage has 25 pending tasks
; skipping status check (no nodes will be marked down)
...
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;No other nodes were restarted in this time frame.&lt;/p&gt;

&lt;p&gt;Please let us know if there is any additional information we can provide.&lt;/p&gt;</comment>
                            <comment id="15000004" author="hbcheng" created="Wed, 11 Nov 2015 06:36:35 +0000"  >&lt;p&gt;A few additional details:&lt;/p&gt;

&lt;p&gt;Unfortunately, I didn&apos;t get any data while the issue was happening. Afterwards, netstat, nodetool status, etc. are all nominal.&lt;/p&gt;

&lt;p&gt;During the period of time when this node was experiencing difficulty, no other nodes reported any unhealthy hosts. However, we do have our phi convict threshold tuned up from 8 to 10, due to running on AWS.&lt;/p&gt;

&lt;p&gt;This event was localized to one node out of 12. Keyspace RF ranges from 3-5. Queries at LOCAL_QUORUM were timing out with insufficient responses.&lt;/p&gt;</comment>
                            <comment id="15007923" author="hbcheng" created="Tue, 17 Nov 2015 03:09:09 +0000"  >&lt;p&gt;Just observed this issue again. Node was undergoing anticompaction when it occurred- once again brought the ring to a halt.&lt;/p&gt;

&lt;p&gt;Couldn&apos;t get all the required information due to the urgency of the situation, but did confirm that nodetool status reported the node as up with no issue (on another node).&lt;/p&gt;

&lt;p&gt;I have fresh logs to offer out-of-band to anyone who is investigating this issue- feel free to email or ping here.&lt;/p&gt;</comment>
                            <comment id="15009335" author="aweisberg" created="Tue, 17 Nov 2015 19:33:37 +0000"  >&lt;p&gt;Can you attach or send me the yaml&apos;s your are using at each node?&lt;/p&gt;</comment>
                            <comment id="15009725" author="aweisberg" created="Tue, 17 Nov 2015 22:31:40 +0000"  >&lt;p&gt;Theory time. &lt;a href=&quot;https://github.com/apache/cassandra/blob/cassandra-2.1.9/src/java/org/apache/cassandra/service/StorageProxy.java#L1027&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;There is a path by which tasks that are supposed to go through the local hint process for inserts need to use.&lt;/a&gt; Since we have a case where an insert does not go down this path it kind of implies that one of the other call sites for inserts is incorrect and is going through the remote message service path.&lt;/p&gt;

&lt;p&gt;It only happens when the node is overloaded and local inserts start timing out. The reason you don&apos;t normally see it is that local inserts probably don&apos;t time out most of the time. One thing you could do is increase the mutation timeouts to see if you can get past the low performance period without timing out and hitting this.&lt;/p&gt;

&lt;p&gt;However I think that the assertion is a symptom of a different problem and not the cause for the performance/availability issues. It&apos;s the canary in the coal mine letting you know this broken path is being taken due timeouts of local mutations.&lt;/p&gt;

&lt;p&gt;I think the thing to do is search the call hierarchy of &lt;tt&gt;&lt;a href=&quot;https://github.com/apache/cassandra/blob/cassandra-2.1.9/src/java/org/apache/cassandra/service/StorageProxy.java#L944&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;StorageProxy.submitHint&lt;/a&gt;&lt;/tt&gt; to find a  path where it can be reached when timing out a local write. We know it&apos;s coming through MessageService in this instance which makes it a little trickier because the type of the callback isn&apos;t known. It looks like PAXOS might in some cases go down this path incorrectly.&lt;/p&gt;

&lt;p&gt;I am going to try running a few things locally with some assertions to see if I can get it to send a message with hint delivery to itself.&lt;/p&gt;</comment>
                            <comment id="15011365" author="aweisberg" created="Wed, 18 Nov 2015 16:43:48 +0000"  >&lt;p&gt;Good news is that I am at least partially correct and PAXOS is heading down the road to submitting hints for the local node.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/apache/cassandra/compare/cassandra-2.1...aweisberg:CASSANDRA-10477-test?expand=1#diff-5e7d892105f1fa0706dbedf919b5dd99L46&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;New failing utests from this assertion&lt;/a&gt;&lt;br/&gt;
&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/aweisberg/job/aweisberg-CASSANDRA-10477-test-testall/1/testReport/junit/org.apache.cassandra.triggers/TriggersTest/executeTriggerOnCqlInsertWithConditions/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://cassci.datastax.com/view/Dev/view/aweisberg/job/aweisberg-CASSANDRA-10477-test-testall/1/testReport/junit/org.apache.cassandra.triggers/TriggersTest/executeTriggerOnCqlInsertWithConditions/&lt;/a&gt;&lt;br/&gt;
&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/aweisberg/job/aweisberg-CASSANDRA-10477-test-testall/1/testReport/junit/org.apache.cassandra.triggers/TriggersTest/executeTriggerOnCqlBatchWithConditions/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://cassci.datastax.com/view/Dev/view/aweisberg/job/aweisberg-CASSANDRA-10477-test-testall/1/testReport/junit/org.apache.cassandra.triggers/TriggersTest/executeTriggerOnCqlBatchWithConditions/&lt;/a&gt;&lt;br/&gt;
&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/aweisberg/job/aweisberg-CASSANDRA-10477-test-testall/1/testReport/junit/org.apache.cassandra.triggers/TriggersTest/executeTriggerOnThriftCASOperation/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://cassci.datastax.com/view/Dev/view/aweisberg/job/aweisberg-CASSANDRA-10477-test-testall/1/testReport/junit/org.apache.cassandra.triggers/TriggersTest/executeTriggerOnThriftCASOperation/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Also several &lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/aweisberg/job/aweisberg-CASSANDRA-10477-test-dtest/1/#showFailuresLink&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;failing dtests&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;I&apos;ll try getting the PAXOS code to do something similar to the insertLocal where it doesn&apos;t submit a real hint.&lt;/p&gt;</comment>
                            <comment id="15011402" author="aweisberg" created="Wed, 18 Nov 2015 17:04:16 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=bdeggleston&quot; class=&quot;user-hover&quot; rel=&quot;bdeggleston&quot;&gt;bdeggleston&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=slebresne&quot; class=&quot;user-hover&quot; rel=&quot;slebresne&quot;&gt;slebresne&lt;/a&gt; can you chime in on whether I am on the right track here?&lt;/p&gt;

&lt;p&gt;Should &lt;tt&gt;&lt;a href=&quot;https://github.com/apache/cassandra/blob/cassandra-2.1.11/src/java/org/apache/cassandra/service/StorageProxy.java#L494&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;StorageProxy.commitPaxos&lt;/a&gt;&lt;/tt&gt; not be sending messages to the local node that are eligible for hinting on timeout?&lt;/p&gt;</comment>
                            <comment id="15011675" author="bdeggleston" created="Wed, 18 Nov 2015 18:56:01 +0000"  >&lt;p&gt;It seems like adding a paxos commit equivalent of StorageProxy.insertLocal, and submitting local commits that way would be the safest thing to do here. In theory, you should be able to add a check against the local address to StorageProxy.shouldHint and just drop the commit message if the node is overloaded, it should get back up to speed on the next paxos round. However there may be subtleties and edge cases that I&apos;m not thinking of, so I don&apos;t want to recommend that without giving this more thought.&lt;/p&gt;</comment>
                            <comment id="15012348" author="aweisberg" created="Wed, 18 Nov 2015 23:25:43 +0000"  >&lt;p&gt;Proposed fix&lt;/p&gt;

&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/apache/cassandra/compare/cassandra-2.1...aweisberg:CASSANDRA-10477-test&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;2.1 code&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/aweisberg/job/aweisberg-CASSANDRA-10477-test-testall/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;utests&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/aweisberg/job/aweisberg-CASSANDRA-10477-test-dtest/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;dtests&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/apache/cassandra/compare/cassandra-3.0...aweisberg:CASSANDRA-10477-3.0&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;3.0 code&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/aweisberg/job/aweisberg-CASSANDRA-10477-3.0-testall/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;utests&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/aweisberg/job/aweisberg-CASSANDRA-10477-3.0-dtest/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;dtests&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;
</comment>
                            <comment id="15041410" author="slebresne" created="Fri, 4 Dec 2015 10:52:23 +0000"  >&lt;ul&gt;
	&lt;li&gt;The failure detector will never return false for the local host, so the changes in the 2nd branch of commitPaxos are unnecessary.&lt;/li&gt;
	&lt;li&gt;We&apos;re kind of dodging the hint &quot;overload&quot; protection on the paxos path as we don&apos;t use &lt;tt&gt;sendToHintedEndpoints&lt;/tt&gt; (which in particular makes the comment on &lt;tt&gt;commitPaxosLocal&lt;/tt&gt; misleading as it suggests otherwise). I think the simplest solution is to move the overload test from &lt;tt&gt;sendToHintedEndpoints&lt;/tt&gt; to some &lt;tt&gt;checkOverloaded()&lt;/tt&gt; method and call that in &lt;tt&gt;commitPaxos&lt;/tt&gt; too.&lt;/li&gt;
	&lt;li&gt;Instead of adding the &lt;tt&gt;droppable()&lt;/tt&gt; method to &lt;tt&gt;LocalMutationRunnable&lt;/tt&gt;, we should probably use &lt;tt&gt;MessagingService.DROPPABLE_VERBS.contains(verb)&lt;/tt&gt;.&lt;/li&gt;
	&lt;li&gt;In theory, we could still run into the problem of that ticket if &lt;tt&gt;OPTIMIZE_LOCAL_REQUESTS&lt;/tt&gt; is &lt;tt&gt;false&lt;/tt&gt;. And in fact, I believe this option is unsafe since at least &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-4753&quot; title=&quot;Timeout reporter writes hints for the local node&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-4753&quot;&gt;&lt;del&gt;CASSANDRA-4753&lt;/del&gt;&lt;/a&gt; as we somewhat strongly assume writes to the localhost do &lt;b&gt;not&lt;/b&gt; go through &lt;tt&gt;MessagingService&lt;/tt&gt;. So I would suggest ditching that option. Not only is it unsafe, but it&apos;s not used anywhere by the code and it&apos;s hardcoded so you have to change the code and recompile to even use it (which means I doubt anyone has even tried it in a long long time). And if we end up needing it in the future, we&apos;ll have to figure out how to make it safe.&lt;/li&gt;
	&lt;li&gt;Why isn&apos;t the added assertion in &lt;tt&gt;WriteCallbackInfo&lt;/tt&gt; on 3.0 not using &lt;tt&gt;!shouldHint&lt;/tt&gt; lie in the 2.1 patch?&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="15041786" author="aweisberg" created="Fri, 4 Dec 2015 17:13:17 +0000"  >&lt;blockquote&gt;&lt;p&gt;We&apos;re kind of dodging the hint &quot;overload&quot; protection on the paxos path as we don&apos;t use sendToHintedEndpoints (which in particular makes the comment on commitPaxosLocal misleading as it suggests otherwise). I think the simplest solution is to move the overload test from sendToHintedEndpoints to some checkOverloaded() method and call that in commitPaxos too.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Which aspect of hint &quot;overload&quot; protection is missing? &lt;a href=&quot;https://github.com/apache/cassandra/blob/cassandra-2.1/src/java/org/apache/cassandra/service/StorageProxy.java#L976&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;I see it increments a counter which I thought was the signal upstream.&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Looking at it further is it because it doesn&apos;t throw &lt;tt&gt;OverloadedException&lt;/tt&gt;? So a better behavior would be to have the check and exception in a helper method and use that in commitPaxos() so that it can now throw &lt;tt&gt;OverloadedException&lt;/tt&gt;?&lt;/p&gt;

&lt;p&gt;I do wonder what the unforeseen consequences of having &lt;tt&gt;CAS&lt;/tt&gt; capable of throwing &lt;tt&gt;OE&lt;/tt&gt; is going to do that we haven&apos;t seen or tested before. Where this gets interesting is that the read path now throws &lt;tt&gt;OE&lt;/tt&gt; where it didn&apos;t before because apparently serial consistency reads can end up calling &lt;tt&gt;beginAndRepairPaxos&lt;/tt&gt;. I need to take a close look at how we test this path to make sure it&apos;s going to behave well once exercised.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;In theory, we could still run into the problem of that ticket if OPTIMIZE_LOCAL_REQUESTS is false. And in fact, I believe this option is unsafe since at least &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-4753&quot; title=&quot;Timeout reporter writes hints for the local node&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-4753&quot;&gt;&lt;del&gt;CASSANDRA-4753&lt;/del&gt;&lt;/a&gt; as we somewhat strongly assume writes to the localhost do not go through MessagingService. So I would suggest ditching that option. Not only is it unsafe, but it&apos;s not used anywhere by the code and it&apos;s hardcoded so you have to change the code and recompile to even use it (which means I doubt anyone has even tried it in a long long time). And if we end up needing it in the future, we&apos;ll have to figure out how to make it safe.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;It&apos;s already removed from 2.2. Yeah I don&apos;t think anyone uses it.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;Why isn&apos;t the added assertion in WriteCallbackInfo on 3.0 not using !shouldHint lie in the 2.1 patch?&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;It&apos;s an oversight from merging.&lt;/p&gt;</comment>
                            <comment id="15041862" author="slebresne" created="Fri, 4 Dec 2015 17:57:31 +0000"  >&lt;blockquote&gt;&lt;p&gt;Which aspect of hint &quot;overload&quot; protection is missing? I see it increments a counter which I thought was the signal upstream.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;This is about whom is looking at said counter (to do something about it if it&apos;s too high). The normal write path is, and so incrementing the counter in CAS will potentially apply back-pressure on normal write, but not on CAS request themselves.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;Looking at it further is it because it doesn&apos;t throw OverloadedException? So a better behavior would be to have the check and exception in a helper method and use that in commitPaxos() so that it can now throw OverloadedException?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Exactly.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;I do wonder what the unforeseen consequences of having CAS capable of throwing OE is going to do that we haven&apos;t seen or tested before.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;It&apos;s a good question, and to be honest I&apos;m not sure we have any test that cover &lt;tt&gt;OverloadException&lt;/tt&gt; at all (but I could be wrong). But in general, the commit part of Paxos is not very &quot;sensible&quot;: worst case, if not enough replica get the commit, the next serial operation (including a read) on the partition will re-commit. So the main question is whether potentially throwing &lt;tt&gt;OverloadedException&lt;/tt&gt; would surprise people. I would argue it shouldn&apos;t because normal writes can do so and we never specified it was any different for CAS. That said, if we&apos;re uncomfortable with it, I&apos;m totally fine committing that part of the change only in 3.2 (aka trunk currently).&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;the read path now throws OE where it didn&apos;t before&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Right. That&apos;s probably more justification for keeping that part in 3.2 only.&lt;/p&gt;
</comment>
                            <comment id="15042198" author="aweisberg" created="Fri, 4 Dec 2015 20:39:25 +0000"  >&lt;blockquote&gt;&lt;p&gt;Why isn&apos;t the added assertion in WriteCallbackInfo on 3.0 not using !shouldHint lie in the 2.1 patch?&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;This turns out to be because shouldHint() has additional stuff that the assertion doesn&apos;t want. The assertion doesn&apos;t care if hints are disabled along with several of the other things that are added.&lt;/p&gt;

&lt;p&gt;I think I managed to shuffle everything correctly. Going to let the tests run and prognosticate on how I want to test OE. I grepped the dtests and unit tests for OverloadedException and didn&apos;t get a single hit!&lt;/p&gt;

&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/apache/cassandra/compare/cassandra-2.1...aweisberg:CASSANDRA-10477-test&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;2.1 code&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/aweisberg/job/aweisberg-CASSANDRA-10477-test-testall/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;utests&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/aweisberg/job/aweisberg-CASSANDRA-10477-test-dtest/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;dtests&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/apache/cassandra/compare/cassandra-3.0...aweisberg:CASSANDRA-10477-3.0&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;3.0 code&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/aweisberg/job/aweisberg-CASSANDRA-10477-3.0-testall/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;utests&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/aweisberg/job/aweisberg-CASSANDRA-10477-3.0-dtest/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;dtests&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/apache/cassandra/compare/trunk...aweisberg:CASSANDRA-10477-trunk&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;Trunk code&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/aweisberg/job/aweisberg-CASSANDRA-10477-trunk-testall/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;utests&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/aweisberg/job/aweisberg-CASSANDRA-10477-trunk-dtest/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;dtests&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;
</comment>
                            <comment id="15044588" author="slebresne" created="Mon, 7 Dec 2015 09:00:30 +0000"  >&lt;blockquote&gt;&lt;p&gt;The assertion doesn&apos;t care if hints are disabled along with several of the other things that are added.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;First, I still don&apos;t understand why it&apos;s not consistent between 2.1 and 3.0. As far as I can tell, the &lt;tt&gt;WriteCallbackInfo.shouldHint()&lt;/tt&gt; mostly method calls &lt;tt&gt;StorageProxy.shouldHint()&lt;/tt&gt; which does pretty much the same thing in both versions.  Second, I&apos;d argue the assertion &lt;em&gt;must&lt;/em&gt; use &lt;tt&gt;!shouldHint()&lt;/tt&gt; because what we&apos;re trying to assert is that &lt;tt&gt;submitHint&lt;/tt&gt; is never called for localhost on the expiration of a callback, and that depends on the result of &lt;tt&gt;shouldHint()&lt;/tt&gt;. That said, I think it would almost be better to have the assertion just be &lt;tt&gt;!target.equals(FBUtilities.getBroadcastAddress())&lt;/tt&gt; as we&apos;re basically saying a local write should always use the specific local path, not &lt;tt&gt;MessagingService&lt;/tt&gt;. In any case, I think the assertion is worth a quick comment to explain why we&apos;re asserting that here.&lt;/p&gt;

&lt;p&gt;The rest of the changes lgtm, but the unit tests on 3.0 don&apos;t seem to have run due to some problem with an &lt;tt&gt;@Override&lt;/tt&gt;.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;and prognosticate on how I want to test OE&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;The lack of coverage of OE is certainly something we should fix (it&apos;s not trivial though), but I would suggest not blocking that fix for that since it&apos;s not directly related (meaning, we should probably open a separate ticket for it).&lt;/p&gt;</comment>
                            <comment id="15091779" author="jhb" created="Mon, 11 Jan 2016 11:17:46 +0000"  >&lt;p&gt;I&apos;m having the same problem on 2.2.3:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;10:55:54.203 [ERROR] CassandraDaemon                - Exception in thread &lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;[EXPIRING-MAP-REAPER:1,5,UCS-Threads] java.lang.AssertionError: &amp;lt;hostname&amp;gt;/&amp;lt;host ip&amp;gt;
        at org.apache.cassandra.service.StorageProxy.submitHint(StorageProxy.java:978)
        at org.apache.cassandra.net.MessagingService$5.apply(MessagingService.java:399)
        at org.apache.cassandra.net.MessagingService$5.apply(MessagingService.java:379)
        at org.apache.cassandra.utils.ExpiringMap$1.run(ExpiringMap.java:98)
        at org.apache.cassandra.concurrent.DebuggableScheduledThreadPoolExecutor$UncomplainingRunnable.run(DebuggableScheduledThreadPoolExecutor.java:118)
        at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)
        at java.util.concurrent.FutureTask.runAndReset(FutureTask.java:308)
        at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.access$301(ScheduledThreadPoolExecutor.java:180)
        at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:294)
        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1142)
        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:617)
        at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:745)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;What is the status on this issue? Can I expect this to be fixed in 2.2.x branch?&lt;/p&gt;</comment>
                            <comment id="15091802" author="slebresne" created="Mon, 11 Jan 2016 11:33:53 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=aweisberg&quot; class=&quot;user-hover&quot; rel=&quot;aweisberg&quot;&gt;aweisberg&lt;/a&gt; the ball is in your court I believe.&lt;/p&gt;</comment>
                            <comment id="15092170" author="aweisberg" created="Mon, 11 Jan 2016 15:52:02 +0000"  >&lt;p&gt;The tests are passing, but enough time has passed that I should rebase and test again. Will do that today.&lt;/p&gt;</comment>
                            <comment id="15092200" author="slebresne" created="Mon, 11 Jan 2016 16:17:51 +0000"  >&lt;p&gt;Can you also answer my comments on the assertion?&lt;/p&gt;</comment>
                            <comment id="15092221" author="aweisberg" created="Mon, 11 Jan 2016 16:28:13 +0000"  >&lt;p&gt;I agree the assertion should just be on the address. Already made the change back in December just need to get the tests done.&lt;/p&gt;</comment>
                            <comment id="15092336" author="aweisberg" created="Mon, 11 Jan 2016 17:33:00 +0000"  >&lt;p&gt;Rebased, updated commit message, updated test matrix, started tests.&lt;/p&gt;
&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/apache/cassandra/compare/cassandra-2.1...aweisberg:CASSANDRA-10477-test&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;2.1 code&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/aweisberg/job/aweisberg-CASSANDRA-10477-test-testall/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;utests&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/aweisberg/job/aweisberg-CASSANDRA-10477-test-dtest/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;dtests&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/apache/cassandra/compare/cassandra-3.0...aweisberg:CASSANDRA-10477-3.0&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;3.0 code&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/aweisberg/job/aweisberg-CASSANDRA-10477-3.0-testall/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;utests&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/aweisberg/job/aweisberg-CASSANDRA-10477-3.0-dtest/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;dtests&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/apache/cassandra/compare/cassandra-3.3...aweisberg:CASSANDRA-10477-3.3&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;3.3 code&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/aweisberg/job/aweisberg-CASSANDRA-10477-3.3-testall/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;utests&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/aweisberg/job/aweisberg-CASSANDRA-10477-3.3-dtest/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;dtests&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/apache/cassandra/compare/trunk...aweisberg:CASSANDRA-10477-trunk&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;Trunk code&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/aweisberg/job/aweisberg-CASSANDRA-10477-trunk-testall/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;utests&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/aweisberg/job/aweisberg-CASSANDRA-10477-trunk-dtest/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;dtests&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;
</comment>
                            <comment id="15093552" author="jhb" created="Tue, 12 Jan 2016 08:53:44 +0000"  >&lt;p&gt;Will it be fixed in 2.2.x too?&lt;/p&gt;</comment>
                            <comment id="15093874" author="slebresne" created="Tue, 12 Jan 2016 13:36:43 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=aweisberg&quot; class=&quot;user-hover&quot; rel=&quot;aweisberg&quot;&gt;aweisberg&lt;/a&gt; I think you have a bad merge on 3.0 (though strangely the 3.3 and trunk branches seem fine), the test run failed at compilation time.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;Will it be fixed in 2.2.x too?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;It will.&lt;/p&gt;</comment>
                            <comment id="15094149" author="aweisberg" created="Tue, 12 Jan 2016 16:05:40 +0000"  >&lt;p&gt;Fixed 3.0 compilation issue. Added 2.2 branch and updated test matrix.&lt;/p&gt;
&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/apache/cassandra/compare/cassandra-2.1...aweisberg:CASSANDRA-10477-test&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;2.1 code&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/aweisberg/job/aweisberg-CASSANDRA-10477-test-testall/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;utests&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/aweisberg/job/aweisberg-CASSANDRA-10477-test-dtest/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;dtests&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/apache/cassandra/compare/cassandra-2.2...aweisberg:CASSANDRA-10477-2.2&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;2.2 code&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/aweisberg/job/aweisberg-CASSANDRA-10477-2.2-testall/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;utests&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/aweisberg/job/aweisberg-CASSANDRA-10477-2.2-dtest/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;dtests&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/apache/cassandra/compare/cassandra-3.0...aweisberg:CASSANDRA-10477-3.0&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;3.0 code&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/aweisberg/job/aweisberg-CASSANDRA-10477-3.0-testall/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;utests&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/aweisberg/job/aweisberg-CASSANDRA-10477-3.0-dtest/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;dtests&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/apache/cassandra/compare/cassandra-3.3...aweisberg:CASSANDRA-10477-3.3&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;3.3 code&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/aweisberg/job/aweisberg-CASSANDRA-10477-3.3-testall/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;utests&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/aweisberg/job/aweisberg-CASSANDRA-10477-3.3-dtest/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;dtests&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/apache/cassandra/compare/trunk...aweisberg:CASSANDRA-10477-trunk&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;Trunk code&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/aweisberg/job/aweisberg-CASSANDRA-10477-trunk-testall/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;utests&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/aweisberg/job/aweisberg-CASSANDRA-10477-trunk-dtest/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;dtests&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;
</comment>
                            <comment id="15094166" author="jhb" created="Tue, 12 Jan 2016 16:13:00 +0000"  >&lt;p&gt;Great, thank you.&lt;/p&gt;</comment>
                            <comment id="15095985" author="slebresne" created="Wed, 13 Jan 2016 10:38:44 +0000"  >&lt;p&gt;Committed, thanks.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310050">
                    <name>Regression</name>
                                                                <inwardlinks description="is broken by">
                                        <issuelink>
            <issuekey id="12718022">CASSANDRA-7342</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[aweisberg]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 44 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2mqkv:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12311421" key="com.atlassian.jira.plugin.system.customfieldtypes:multiversion">
                        <customfieldname>Reproduced In</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="12332984">2.1.9</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>slebresne</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[slebresne]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12962"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>