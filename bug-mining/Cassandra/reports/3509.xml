<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 22:52:24 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-9225] CompactionAwareWriterTest is broken with compression</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-9225</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;&lt;tt&gt;CompactionAwareWriterTest&lt;/tt&gt; generates a relatively small sstable and expect different types of compaction to split it at relatively precise sizes. However, the implementations of &lt;tt&gt;CompactionAwareWriter&lt;/tt&gt; use &lt;tt&gt;writer.getOnDiskFilePointer()&lt;/tt&gt; to decide when to split and with compression that value is updated only when an compressed block is written. Which means that with compression the splitting is not as precise as the test expects it to be and the test fails.&lt;/p&gt;

&lt;p&gt;Note that this imprecision in splitting is not a big deal in practice (you might even call it a feature) since you expect to split sstables at sizes that are a lot bigger than the compression block size (besides, we already know we are imprecise in our splitting size since we only split at partition boundaries). But this does make things a bit harder to test.&lt;/p&gt;

&lt;p&gt;So I guess we could either:&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;make the test use much bigger values so it&apos;s not affected by the imprecision (with the small downside that it will make the test slower)&lt;/li&gt;
	&lt;li&gt;remove that imprecision by making the &lt;tt&gt;CompactionAwareWriter&lt;/tt&gt; implementations use &lt;tt&gt;writer.getFilePointer()&lt;/tt&gt;.&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;I don&apos;t have much personal preference but using &lt;tt&gt;getFilePointer&lt;/tt&gt; sounds like the simpler fix, and it feels overall more predictable.&lt;/p&gt;

&lt;p&gt;Note that the test is not failing on trunk because unit tests do not use compression, you have to call &lt;tt&gt;ant test-compression&lt;/tt&gt; for that (in which case it will fail). We might want to make compression one our randomized parameter of tests in the near future as I&apos;m not sure anyone is really running &lt;tt&gt;ant test-compression&lt;/tt&gt; on a regular basis.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12823074">CASSANDRA-9225</key>
            <summary>CompactionAwareWriterTest is broken with compression</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10003" iconUrl="https://issues.apache.org/jira/images/icons/priorities/trivial.svg">Low</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="marcuse">Marcus Eriksson</assignee>
                                    <reporter username="slebresne">Sylvain Lebresne</reporter>
                        <labels>
                    </labels>
                <created>Wed, 22 Apr 2015 15:44:05 +0000</created>
                <updated>Tue, 16 Apr 2019 09:31:13 +0000</updated>
                            <resolved>Fri, 24 Apr 2015 08:43:06 +0000</resolved>
                                        <fixVersion>2.2.0 beta 1</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="14509133" author="krummas" created="Thu, 23 Apr 2015 14:17:59 +0000"  >&lt;p&gt;We want to split sstables based on their compressed size (users would be very confused if LCS suddenly started measuring uncompressed files), so I went for option 1&lt;/p&gt;</comment>
                            <comment id="14510636" author="slebresne" created="Fri, 24 Apr 2015 08:19:33 +0000"  >&lt;blockquote&gt;&lt;p&gt;We want to split sstables based on their compressed size&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Of course, I wasn&apos;t thinking clearly. Patch fixes the test with compression, +1.&lt;/p&gt;</comment>
                            <comment id="14510653" author="krummas" created="Fri, 24 Apr 2015 08:43:06 +0000"  >&lt;p&gt;committed&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12727621" name="0001-9225.patch" size="7020" author="marcuse" created="Thu, 23 Apr 2015 14:18:14 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[marcuse]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 30 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2dlwf:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>slebresne</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[slebresne]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12961"><![CDATA[Low]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>