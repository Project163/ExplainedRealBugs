<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 23:18:46 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-16201] Reduce amount of allocations during batch statement execution</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-16201</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;In a Cas 2.1 / 3.0 / 3.11 / 4.0b2 comparison test with the same load profile, we see 4.0b2 going OOM from time to time. According to a heap dump, we have multiple NTR threads in a 3-digit MB range.&lt;/p&gt;

&lt;p&gt;This is likely related to object array pre-allocations at the size of &lt;tt&gt;BatchUpdatesCollector.updatedRows&lt;/tt&gt; per &lt;tt&gt;BTree&lt;/tt&gt; although there is always only 1 &lt;tt&gt;BTreeRow&lt;/tt&gt; in the &lt;tt&gt;BTree&lt;/tt&gt;.&lt;br/&gt;
 &lt;span class=&quot;image-wrap&quot; style=&quot;&quot;&gt;&lt;img src=&quot;https://issues.apache.org/jira/secure/attachment/13013242/13013242_screenshot-1.png&quot; width=&quot;100%&quot; style=&quot;border: 0px solid black&quot; /&gt;&lt;/span&gt; &lt;/p&gt;

&lt;p&gt;So it seems we have many, many 20K elemnts pre-allocated object arrays resulting in a shallow heap of 80K each, although there is only one element in the array.&lt;/p&gt;

&lt;p&gt;This sort of pre-allocation is causing a lot of memory pressure.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13334428">CASSANDRA-16201</key>
            <summary>Reduce amount of allocations during batch statement execution</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10002" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Normal</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="marcuse">Marcus Eriksson</assignee>
                                    <reporter username="tsteinmaurer">Thomas Steinmaurer</reporter>
                        <labels>
                    </labels>
                <created>Thu, 8 Oct 2020 13:34:05 +0000</created>
                <updated>Fri, 22 Jan 2021 11:21:30 +0000</updated>
                            <resolved>Fri, 22 Jan 2021 10:03:31 +0000</resolved>
                                        <fixVersion>3.11.10</fixVersion>
                    <fixVersion>4.0-rc1</fixVersion>
                    <fixVersion>4.0</fixVersion>
                                    <component>Local/Other</component>
                        <due></due>
                            <votes>1</votes>
                                    <watches>9</watches>
                                                                                                                <comments>
                            <comment id="17210234" author="krummas" created="Thu, 8 Oct 2020 14:00:27 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tsteinmaurer&quot; class=&quot;user-hover&quot; rel=&quot;tsteinmaurer&quot;&gt;tsteinmaurer&lt;/a&gt; you sure you don&apos;t see this in 3.11? looks like we ignore &lt;tt&gt;initialCapacity&lt;/tt&gt; in 3.0 here: &lt;a href=&quot;https://github.com/apache/cassandra/blob/cassandra-3.0/src/java/org/apache/cassandra/utils/btree/BTree.java#L752&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/cassandra/blob/cassandra-3.0/src/java/org/apache/cassandra/utils/btree/BTree.java#L752&lt;/a&gt; but not in 3.11: &lt;a href=&quot;https://github.com/apache/cassandra/blob/cassandra-3.11/src/java/org/apache/cassandra/utils/btree/BTree.java#L777&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/cassandra/blob/cassandra-3.11/src/java/org/apache/cassandra/utils/btree/BTree.java#L777&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17210238" author="tsteinmaurer" created="Thu, 8 Oct 2020 14:13:33 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=marcuse&quot; class=&quot;user-hover&quot; rel=&quot;marcuse&quot;&gt;marcuse&lt;/a&gt;, yes I think so. &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; TRUNK, locally checked out, calling hierarchy from &lt;tt&gt;BatchUpdatesCollector.getPartitionUpdateBuilder&lt;/tt&gt; up to &lt;tt&gt;PartitionUpdate.Builder.rowBuilder&lt;/tt&gt;&lt;/p&gt;

&lt;p&gt; &lt;span class=&quot;image-wrap&quot; style=&quot;&quot;&gt;&lt;img src=&quot;https://issues.apache.org/jira/secure/attachment/13013246/13013246_screenshot-2.png&quot; width=&quot;100%&quot; style=&quot;border: 0px solid black&quot; /&gt;&lt;/span&gt; &lt;/p&gt;

&lt;p&gt;Thanks again.&lt;/p&gt;</comment>
                            <comment id="17210246" author="dcapwell" created="Thu, 8 Oct 2020 14:23:05 +0000"  >&lt;p&gt;Can you describe the workload used?  Work has been done to lower the heap usage so possible trunk is already fixed (but not in a beta release); would be good to try to replicate the reported issue &lt;/p&gt;</comment>
                            <comment id="17210249" author="tsteinmaurer" created="Thu, 8 Oct 2020 14:30:36 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=dcapwell&quot; class=&quot;user-hover&quot; rel=&quot;dcapwell&quot;&gt;dcapwell&lt;/a&gt;, code screen above is from local TRUNK, thus not strictly Beta2. &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=marcuse&quot; class=&quot;user-hover&quot; rel=&quot;marcuse&quot;&gt;marcuse&lt;/a&gt; already contacted me via Slack. Thanks for your attention&lt;/p&gt;</comment>
                            <comment id="17210270" author="krummas" created="Thu, 8 Oct 2020 14:58:05 +0000"  >&lt;p&gt;In &lt;tt&gt;BatchStatement&lt;/tt&gt; we have &lt;tt&gt;updatedRows()&lt;/tt&gt; which is simply the number of statements in the batch - then we pre-size each partition update with that initial capacity. If the batch touches many different partitions we still use &lt;tt&gt;initialCapacity = statements.size()&lt;/tt&gt; for each partition update which is what causes this. I&apos;ll work on a patch. &lt;/p&gt;

&lt;p&gt;Affects 3.11 and 4.0 but not earlier, before that we &lt;a href=&quot;https://github.com/apache/cassandra/blob/cassandra-3.0/src/java/org/apache/cassandra/utils/btree/BTree.java#L752&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;ignored&lt;/a&gt; &lt;tt&gt;initialCapacity&lt;/tt&gt; &lt;/p&gt;</comment>
                            <comment id="17212674" author="michaelsembwever" created="Mon, 12 Oct 2020 21:13:44 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=marcuse&quot; class=&quot;user-hover&quot; rel=&quot;marcuse&quot;&gt;marcuse&lt;/a&gt;, looking at &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-15430&quot; title=&quot;Cassandra 3.0.18: BatchMessage.execute - 10x more on-heap allocations compared to 2.1.18&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-15430&quot;&gt;&lt;del&gt;CASSANDRA-15430&lt;/del&gt;&lt;/a&gt; it looks like &lt;tt&gt;initialCapacity&lt;/tt&gt; (&lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-13929&quot; title=&quot;BTree$Builder / io.netty.util.Recycler$Stack leaking memory&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-13929&quot;&gt;&lt;del&gt;CASSANDRA-13929&lt;/del&gt;&lt;/a&gt;) needs to be back-ported to 3.0, and this ticket also applied to 3.0. wdyt?&lt;/p&gt;</comment>
                            <comment id="17218229" author="krummas" created="Wed, 21 Oct 2020 11:07:06 +0000"  >&lt;p&gt;4.0: &lt;a href=&quot;https://github.com/krummas/cassandra/commits/marcuse/16201-4.0-new&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;patch&lt;/a&gt;, &lt;a href=&quot;https://app.circleci.com/pipelines/github/krummas/cassandra?branch=marcuse%2F16201-4.0-new&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;cci&lt;/a&gt;&lt;br/&gt;
3.11: &lt;a href=&quot;https://github.com/krummas/cassandra/commits/marcuse/16201-3.11-new&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;patch&lt;/a&gt;, &lt;a href=&quot;https://app.circleci.com/pipelines/github/krummas/cassandra?branch=marcuse%2F16201-3.11-new&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;cci&lt;/a&gt;&lt;br/&gt;
3.0: &lt;a href=&quot;https://github.com/krummas/cassandra/commits/marcuse/16201-3.0-new&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;patch&lt;/a&gt;, &lt;a href=&quot;https://app.circleci.com/pipelines/github/krummas/cassandra?branch=marcuse%2F16201-3.0-new&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;cci&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;this focuses only on getMutations as that is where the OOM happened - there is much more to do, but I think these fixes are fairly safe and make performance slightly more acceptable&lt;/p&gt;</comment>
                            <comment id="17218301" author="tsteinmaurer" created="Wed, 21 Oct 2020 13:53:47 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=marcuse&quot; class=&quot;user-hover&quot; rel=&quot;marcuse&quot;&gt;marcuse&lt;/a&gt;, first impression from our comparison infrastructure regarding the 3.0, 3.11 and 4.0 patches.&lt;/p&gt;

&lt;p&gt;When having a look on 2 high-level metrics:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;JVM suspension, marked as &quot;1&quot; in the dashboard below&lt;/li&gt;
	&lt;li&gt;Cassandra dropped messages, marked as &quot;2&quot; in the dashboard below&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt; &lt;span class=&quot;image-wrap&quot; style=&quot;&quot;&gt;&lt;img src=&quot;https://issues.apache.org/jira/secure/attachment/13013933/13013933_screenshot-3.png&quot; width=&quot;100%&quot; style=&quot;border: 0px solid black&quot; /&gt;&lt;/span&gt; &lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;Cassandra 3.0: No positive impact on suspension&lt;/li&gt;
	&lt;li&gt;Cassandra 3.11: Huge positive impact on suspension&lt;/li&gt;
	&lt;li&gt;Cassandra 4.0: Huge positive impact on suspension + no dropped messages with the patch&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;I will keep that running over the night and provide another set of JFR files for 3.0, 3.11 and 4.0 with the patch.&lt;/p&gt;

&lt;p&gt;Thanks for your efforts!&lt;/p&gt;</comment>
                            <comment id="17222647" author="yifanc" created="Thu, 29 Oct 2020 01:28:42 +0000"  >&lt;p&gt;Just went over the 40 patch. It looks good to me overall. Listing the nits/feedbacks below.&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;&lt;tt&gt;BatchStatement#updatedRows&lt;/tt&gt; is no longer used. Please remove it&lt;/li&gt;
	&lt;li&gt;Maybe change the single table update detection from &quot;&lt;tt&gt;!stmt.metadata.equals(metadata)&quot;&lt;/tt&gt; to &quot;&lt;tt&gt;metadata != null &amp;amp;&amp;amp; !stmt.metadata.equals(metadata)&quot;&lt;/tt&gt; in order to avoid the unnecessary&#160;comparison, although the cost of comparing with null should be negligible.&lt;/li&gt;
	&lt;li&gt;Please update the comments for &lt;tt&gt;perPartitionKeyCounts&lt;/tt&gt; in both &lt;tt&gt;BatchUpdatesCollector&lt;/tt&gt; and &lt;tt&gt;SingleTableUpdatesCollector&lt;/tt&gt;, since the count is no longer an estimation.&lt;/li&gt;
	&lt;li&gt;Maybe remove the comment in &lt;tt&gt;ModificationStatement#requiresRead&lt;/tt&gt; since the original implementation is removed.&lt;/li&gt;
	&lt;li&gt;The new implementation of &lt;tt&gt;BatchUpdatesCollector#getMutationBuilder&lt;/tt&gt; is essentially the same as the previous &lt;tt&gt;computeIfAbsent&lt;/tt&gt; except calling dk.getKey() twice. In the case of NativeDecoratedKey, the new implementation is slightly more expensive.&lt;/li&gt;
	&lt;li&gt;Similarly, the new implementation of &lt;tt&gt;BatchUpdatesCollector#keyspaceMap&lt;/tt&gt; is equivalent to the previous &lt;tt&gt;computeIfAbsent&lt;/tt&gt; except the supplied map being different. I think the &lt;tt&gt;computeIfAbsent&lt;/tt&gt; approach looks more elegant. But it is just a style thing.&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="17223585" author="tsteinmaurer" created="Fri, 30 Oct 2020 11:42:34 +0000"  >&lt;blockquote&gt;
&lt;p&gt;I will keep that running over the night and provide another set of JFR files for 3.0, 3.11 and 4.0 with the patch.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mck&quot; class=&quot;user-hover&quot; rel=&quot;mck&quot;&gt;mck&lt;/a&gt;, in my provided OneDrive share provided on Oct 12, 2020 to you, there is now an additional sub-directory called &lt;tt&gt;_perffixes_jfr_20201027&lt;/tt&gt;, which contains a new set of JFR files for all versions (including 2.1), with the patch applied to 3.0, 3.11 and 4.0.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=marcuse&quot; class=&quot;user-hover&quot; rel=&quot;marcuse&quot;&gt;marcuse&lt;/a&gt;, let me know if/how I could share the new JFR files with you as well.&lt;/p&gt;</comment>
                            <comment id="17223593" author="michaelsembwever" created="Fri, 30 Oct 2020 11:52:34 +0000"  >&lt;p&gt;Thank you &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tsteinmaurer&quot; class=&quot;user-hover&quot; rel=&quot;tsteinmaurer&quot;&gt;tsteinmaurer&lt;/a&gt;. I will take a look straight away.&lt;/p&gt;</comment>
                            <comment id="17225523" author="michaelsembwever" created="Tue, 3 Nov 2020 16:26:42 +0000"  >&lt;p&gt;Re-doing the screenshots as done in &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-15430&quot; title=&quot;Cassandra 3.0.18: BatchMessage.execute - 10x more on-heap allocations compared to 2.1.18&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-15430&quot;&gt;&lt;del&gt;CASSANDRA-15430&lt;/del&gt;&lt;/a&gt; for comparison.&lt;/p&gt;

&lt;h4&gt;&lt;a name=&quot;2.1.18&quot;&gt;&lt;/a&gt;2.1.18&lt;/h4&gt;
&lt;p&gt;Skipping these results as its based on the same C* code as in 15430, and I&apos;ve confirmed the allocation counts and object sizes proportionally match. &lt;/p&gt;


&lt;h4&gt;&lt;a name=&quot;3.0.23&quot;&gt;&lt;/a&gt;3.0.23&lt;/h4&gt;
&lt;p&gt;Allocations&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;BatchMessage.execute - 1926411
	&lt;ul&gt;
		&lt;li&gt;BatchStatement.getMutations =&amp;gt; 1008170 == 52% ( previously 60%)&lt;/li&gt;
		&lt;li&gt;BatchStatement.executeWithoutConditions =&amp;gt; 692322 == 36% ( previously 30%)&lt;br/&gt;
 &lt;span class=&quot;image-wrap&quot; style=&quot;&quot;&gt;&lt;img src=&quot;https://issues.apache.org/jira/secure/attachment/13014648/13014648_16201_jfr_3023_alloc.png&quot; width=&quot;1000&quot; style=&quot;border: 0px solid black&quot; /&gt;&lt;/span&gt; &lt;br/&gt;
Sizes by object under &lt;tt&gt;BatchStatement.getMutations&lt;/tt&gt;&lt;br/&gt;
 &lt;span class=&quot;image-wrap&quot; style=&quot;&quot;&gt;&lt;img src=&quot;https://issues.apache.org/jira/secure/attachment/13014649/13014649_16201_jfr_3023_obj.png&quot; width=&quot;600&quot; style=&quot;border: 0px solid black&quot; /&gt;&lt;/span&gt; &lt;br/&gt;
With the invocation count only a 1%  decrease, the &lt;tt&gt;Object[]&lt;/tt&gt; size has gone from 29.8GB down to 18.7GB, or 37% reduction. &lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;h4&gt;&lt;a name=&quot;3.11.9&quot;&gt;&lt;/a&gt;3.11.9&lt;/h4&gt;
&lt;p&gt;Allocations&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;BatchMessage.execute - 1210873
	&lt;ul&gt;
		&lt;li&gt;BatchStatement.getMutations =&amp;gt; 396645 == 33% ( previously 62%)&lt;/li&gt;
		&lt;li&gt;BatchStatement.executeWithoutConditions =&amp;gt; 664650 == 55% ( previously 30%)&lt;br/&gt;
 &lt;span class=&quot;image-wrap&quot; style=&quot;&quot;&gt;&lt;img src=&quot;https://issues.apache.org/jira/secure/attachment/13014645/13014645_16201_jfr_3118_alloc.png&quot; width=&quot;1000&quot; style=&quot;border: 0px solid black&quot; /&gt;&lt;/span&gt; &lt;br/&gt;
Sizes by object under &lt;tt&gt;BatchStatement.getMutations&lt;/tt&gt;&lt;br/&gt;
 &lt;span class=&quot;image-wrap&quot; style=&quot;&quot;&gt;&lt;img src=&quot;https://issues.apache.org/jira/secure/attachment/13014646/13014646_16201_jfr_3118_obj.png&quot; width=&quot;600&quot; style=&quot;border: 0px solid black&quot; /&gt;&lt;/span&gt; &lt;br/&gt;
The &lt;tt&gt;Object[]&lt;/tt&gt; size has gone from 116GB down to 8.14GB. With the invocation count 40% that from &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-15430&quot; title=&quot;Cassandra 3.0.18: BatchMessage.execute - 10x more on-heap allocations compared to 2.1.18&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-15430&quot;&gt;&lt;del&gt;CASSANDRA-15430&lt;/del&gt;&lt;/a&gt;, proportionally this is a 82% reduction.&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;h4&gt;&lt;a name=&quot;4.0beta3&quot;&gt;&lt;/a&gt;4.0-beta3&lt;/h4&gt;
&lt;p&gt;Allocations&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;BatchMessage.execute - 969189
	&lt;ul&gt;
		&lt;li&gt;BatchStatement.getMutations =&amp;gt; 410739  ==  42% ( previously 70%)&lt;/li&gt;
		&lt;li&gt;BatchStatement.executeWithoutConditions =&amp;gt; 425337 == 44% ( previously 23%)&lt;br/&gt;
 &lt;span class=&quot;image-wrap&quot; style=&quot;&quot;&gt;&lt;img src=&quot;https://issues.apache.org/jira/secure/attachment/13014643/13014643_16201_jfr_40b3_alloc.png&quot; width=&quot;1000&quot; style=&quot;border: 0px solid black&quot; /&gt;&lt;/span&gt; &lt;br/&gt;
Sizes by object under &lt;tt&gt;BatchStatement.getMutations&lt;/tt&gt;&lt;br/&gt;
 &lt;span class=&quot;image-wrap&quot; style=&quot;&quot;&gt;&lt;img src=&quot;https://issues.apache.org/jira/secure/attachment/13014644/13014644_16201_jfr_40b3_obj.png&quot; width=&quot;600&quot; style=&quot;border: 0px solid black&quot; /&gt;&lt;/span&gt; &lt;br/&gt;
The &lt;tt&gt;Object[]&lt;/tt&gt; size has gone from 129GB down to 8.52GB. With the invocation count 30% that from &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-15430&quot; title=&quot;Cassandra 3.0.18: BatchMessage.execute - 10x more on-heap allocations compared to 2.1.18&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-15430&quot;&gt;&lt;del&gt;CASSANDRA-15430&lt;/del&gt;&lt;/a&gt;, proportionally this is a 78% reduction.&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;

</comment>
                            <comment id="17225543" author="michaelsembwever" created="Tue, 3 Nov 2020 16:42:48 +0000"  >&lt;p&gt;Similar to the metrics shown above from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tsteinmaurer&quot; class=&quot;user-hover&quot; rel=&quot;tsteinmaurer&quot;&gt;tsteinmaurer&lt;/a&gt;, 3.11 and 4.0 patches show the most improvement. From my understanding of 15430 and this patch, this makes sense.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=marcuse&quot; class=&quot;user-hover&quot; rel=&quot;marcuse&quot;&gt;marcuse&lt;/a&gt;, can you check these^ numbers and see if they align with your expectations.&lt;/p&gt;</comment>
                            <comment id="17225957" author="tsteinmaurer" created="Wed, 4 Nov 2020 09:55:08 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mck&quot; class=&quot;user-hover&quot; rel=&quot;mck&quot;&gt;mck&lt;/a&gt;, thanks a lot for the extensive follow-up. In our tests, from where the actual JFR files come from, we now see, that Cassandra 3.11 and Cassandra 4.0 is basically on the same level than 3.0 again, or even slightly better than 3.0, but 2.1 unbeaten &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;Do you see any further improvements in regard to 2.1 vs. 3.0/3.11/4.0? Following chart is an AVG for last 24hrs on a bunch of metrics, for all versions with the patch applied for 3.0/3.11/4.0, processing the same ingest. The only main difference here is, that 2.1 is using STCS for our timeseries tables, whereas 3.0+ is using TWCS.&lt;br/&gt;
 &lt;span class=&quot;image-wrap&quot; style=&quot;&quot;&gt;&lt;img src=&quot;https://issues.apache.org/jira/secure/attachment/13014685/13014685_screenshot-4.png&quot; width=&quot;100%&quot; style=&quot;border: 0px solid black&quot; /&gt;&lt;/span&gt; &lt;/p&gt;

&lt;p&gt;So, in short:&lt;/p&gt;
&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;&amp;nbsp;&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;Cassandra 2.1&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;Cassandra 3.0 Patched (Rel. diff to 2.1)&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;Cassandra 3.11 Patched (Rel. diff to 2.1)&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;Cassandra 4.0 Patched (Rel. diff to 2.1)&lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;AVG CPU&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;52,86%&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;61,43% (+16,2%)&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;61,04% (+15,5%)&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;75,06% (+42%)&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;AVG Suspension&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;3,76%&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;6,13% (+63%)&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;5,74% (+52,7%)&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;5,60% (+48,9%)&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;


&lt;p&gt;But for &lt;b&gt;Cassandra 3.11&lt;/b&gt; and &lt;b&gt;Cassandra 4.0&lt;/b&gt;, this was a huge step forward! Thanks a lot!&lt;/p&gt;</comment>
                            <comment id="17225960" author="krummas" created="Wed, 4 Nov 2020 10:01:30 +0000"  >&lt;p&gt;The numbers make sense, we should file a followup ticket for more improvement but given the obvious bug fix for the multi-partition batch statement case, I think we should get these patches reviewed and committed&lt;/p&gt;</comment>
                            <comment id="17231443" author="michaelsembwever" created="Fri, 13 Nov 2020 13:18:12 +0000"  >&lt;p&gt;Out of the ticket scope&#8230; why are the microbench classes all in the &lt;tt&gt;org.apache.cassandra.test.microbench&lt;/tt&gt; ? They are already separate under &lt;tt&gt;src/testmicrobench/&lt;/tt&gt;, and by re-packaging them like this it means accessed methods: eg &lt;tt&gt;bs.getMutations(..)&lt;/tt&gt; ; have to be made public instead of package-protected. It would be nice to keep methods package-protected where possible.&lt;/p&gt;

&lt;p&gt;AFAIK we also don&apos;t CI run the microbench classes anywhere, so there&apos;s no guarantee they remain runnable over time. I could add them to the ci-cassandra pipeline, though ideally a dedicated bare-metal server would be needed to make &lt;a href=&quot;https://plugins.jenkins.io/jmh-report/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;use&lt;/a&gt; of the runtime &lt;a href=&quot;https://www.jenkins.io/blog/2019/06/21/performance-testing-jenkins/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;reports&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;+1 on all branch patches (including &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=yifanc&quot; class=&quot;user-hover&quot; rel=&quot;yifanc&quot;&gt;yifanc&lt;/a&gt; review comments above).&lt;/p&gt;</comment>
                            <comment id="17239087" author="tsteinmaurer" created="Thu, 26 Nov 2020 06:42:47 +0000"  >&lt;p&gt;Do we have an ETA for the patch being included/merged?&lt;/p&gt;</comment>
                            <comment id="17239104" author="krummas" created="Thu, 26 Nov 2020 07:30:36 +0000"  >&lt;p&gt;I&apos;ll try to get back to this next week&lt;/p&gt;</comment>
                            <comment id="17253586" author="krummas" created="Tue, 22 Dec 2020 15:50:06 +0000"  >&lt;p&gt;rebased the branches and fixed Yifans comments (not all, but the non-style ones)&lt;/p&gt;

&lt;p&gt;Also pushed another commit to the branches improving this a bit more - in the 3.0 case it is a slightly smaller backport of &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-12153&quot; title=&quot;RestrictionSet.hasIN() is slow&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-12153&quot;&gt;&lt;del&gt;CASSANDRA-12153&lt;/del&gt;&lt;/a&gt; to avoid allocating the LinkedHashSet every time we iterate the restrictions. &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=blerer&quot; class=&quot;user-hover&quot; rel=&quot;blerer&quot;&gt;blerer&lt;/a&gt; - any chance you have time to review this?&lt;/p&gt;</comment>
                            <comment id="17253642" author="blerer" created="Tue, 22 Dec 2020 17:30:01 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=marcuse&quot; class=&quot;user-hover&quot; rel=&quot;marcuse&quot;&gt;marcuse&lt;/a&gt; I guessed that you just wanted me to review the last commit in the 3.0 branch. &lt;br/&gt;
I let some minor comments on the commit. Otherwise, I am +1 with the change.  &lt;/p&gt;</comment>
                            <comment id="17253761" author="yifanc" created="Tue, 22 Dec 2020 20:48:49 +0000"  >&lt;p&gt;+1 &lt;/p&gt;

&lt;p&gt;I am able to run the benchmark and also observe the improvement with the change, especially when using uniquePartitions. However, I have to change the memory allocation to 1GB (&lt;tt&gt;@Fork(value = 1,jvmArgsAppend = &quot;-Xmx1g&quot;)&lt;/tt&gt;) in order to avoid OOME when using uniquePartitions and w/o the change. &lt;/p&gt;</comment>
                            <comment id="17264975" author="tsteinmaurer" created="Thu, 14 Jan 2021 15:53:41 +0000"  >&lt;p&gt;Any ideas if this will make it into 3.0.24?&lt;/p&gt;</comment>
                            <comment id="17265117" author="krummas" created="Thu, 14 Jan 2021 18:37:16 +0000"  >&lt;p&gt;I haven&apos;t seen any plans to cut 3.0.24 soon, so yes, most likely&lt;/p&gt;</comment>
                            <comment id="17265653" author="yifanc" created="Fri, 15 Jan 2021 03:04:11 +0000"  >&lt;p&gt;+1 on all branches.&#160;&lt;/p&gt;

&lt;p&gt;Rebased the branch to the head of each branch and kicked off CI&lt;/p&gt;

&lt;p&gt;trunk: &lt;a href=&quot;https://app.circleci.com/pipelines/github/yifan-c/cassandra?branch=r%2Fkrummas_marcuse%2F16201-4.0-new&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://app.circleci.com/pipelines/github/yifan-c/cassandra?branch=r%2Fkrummas_marcuse%2F16201-4.0-new&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;3.11: &lt;a href=&quot;https://app.circleci.com/pipelines/github/yifan-c/cassandra?branch=r%2Fkrummas_marcuse%2F16201-3.11-new&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://app.circleci.com/pipelines/github/yifan-c/cassandra?branch=r%2Fkrummas_marcuse%2F16201-3.11-new&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;3.0: &lt;a href=&quot;https://app.circleci.com/pipelines/github/yifan-c/cassandra?branch=r%2Fkrummas_marcuse%2F16201-3.0-new&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://app.circleci.com/pipelines/github/yifan-c/cassandra?branch=r%2Fkrummas_marcuse%2F16201-3.0-new&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;EDIT: update the CI result&lt;/p&gt;

&lt;p&gt;The test &apos;testIndexMemtableSwitching - org.apache.cassandra.index.sasi.SASIIndexTest&apos; has been failed. It is tracked already in &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-15995&quot; title=&quot;Fix flaky test testIndexMemtableSwitching - org.apache.cassandra.index.sasi.SASIIndexTest&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-15995&quot;&gt;&lt;del&gt;CASSANDRA-15995&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;There are bunch of dtest failures. Scanned the failures and they do not look relevant to the change. &lt;a href=&quot;https://app.circleci.com/pipelines/github/yifan-c/cassandra/176/workflows/a6c6eaaf-b627-40e6-8af8-851f7a0174c6/jobs/923&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://app.circleci.com/pipelines/github/yifan-c/cassandra/176/workflows/a6c6eaaf-b627-40e6-8af8-851f7a0174c6/jobs/923&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;There are failures from 2 jvm dtest, &apos;org.apache.cassandra.distributed.test.SimpleReadWriteTest&apos; and &apos;org.apache.cassandra.distributed.test.CASTest&apos;, all due to &apos;java.lang.OutOfMemoryError: Java heap space&apos;. I am able to run the test successfully from my local. So the failures do not look relevant. Some flaky tests in the &apos;CASTest&apos; are tracked in&#160;&lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-16355&quot; title=&quot;Fix flaky test incompletePropose - org.apache.cassandra.distributed.test.CASTest&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-16355&quot;&gt;&lt;del&gt;CASSANDRA-16355&lt;/del&gt;&lt;/a&gt; and&#160;&lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-16317&quot; title=&quot;Fix flaky test incompleteCommit - org.apache.cassandra.distributed.test.CASTest&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-16317&quot;&gt;&lt;del&gt;CASSANDRA-16317&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="17266226" author="blerer" created="Fri, 15 Jan 2021 17:35:09 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=marcuse&quot; class=&quot;user-hover&quot; rel=&quot;marcuse&quot;&gt;marcuse&lt;/a&gt; I did not have the time to go through all the branches yet.&lt;br/&gt;
For the 4.0 branch I got a few comments:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;Would it not make sense to use an &lt;tt&gt;HashMultiset&amp;lt;ByteBuffer&amp;gt;&lt;/tt&gt; rathen than a &lt;tt&gt;Map&amp;lt;ByteBuffer, Integer&amp;gt;&lt;/tt&gt;? according to the &lt;a href=&quot;https://github.com/google/guava/wiki/NewCollectionTypesExplained#multiset&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;guava documentation&lt;/a&gt; they seems to have been developped with that scenario in mind.&lt;/li&gt;
	&lt;li&gt;In &lt;tt&gt;BatchStatement.getMutations&lt;/tt&gt;:
    &lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
            partitionCounts.computeIfAbsent(stmt.metadata.id, k -&amp;gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; HashMap&amp;lt;&amp;gt;());
            Map&amp;lt;ByteBuffer, &lt;span class=&quot;code-object&quot;&gt;Integer&lt;/span&gt;&amp;gt; perKeyCounts = partitionCounts.get(stmt.metadata.id);
    &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;   Should be:&lt;/p&gt;
    &lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
            Map&amp;lt;ByteBuffer, &lt;span class=&quot;code-object&quot;&gt;Integer&lt;/span&gt;&amp;gt; perKeyCounts = partitionCounts.computeIfAbsent(stmt.metadata.id, k -&amp;gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; HashMap&amp;lt;&amp;gt;());
    &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;    Will it make sense to extract &lt;tt&gt;k -&amp;gt; new HashMap&amp;lt;&amp;gt;()&lt;/tt&gt; in a variable initialized before the loop ?&lt;/p&gt;&lt;/li&gt;
	&lt;li&gt;Regarding the  single table update detection, I wonder if it will not be more efficient to do the comparison on the &lt;tt&gt;TableId&lt;/tt&gt; rather than the metadata.&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="17267393" author="blerer" created="Mon, 18 Jan 2021 16:15:30 +0000"  >&lt;p&gt;I went to the other branches today. &lt;br/&gt;
I just have the following small nit: Rather than having &lt;tt&gt;(int) (createdAt / 1000)&lt;/tt&gt; at several places in the code, should we not create a &lt;tt&gt;toSeconds&lt;/tt&gt; method in &lt;tt&gt;FBUtilities&lt;/tt&gt; and use it for the conversions?&lt;/p&gt;

&lt;p&gt;+1 for the patches&lt;/p&gt;
</comment>
                            <comment id="17270038" author="krummas" created="Fri, 22 Jan 2021 10:03:31 +0000"  >&lt;p&gt;And committed, thanks everyone&lt;/p&gt;

&lt;p&gt;Decided to not merge the 3.0 patch as the improvement there was quite small - if anyone has a benchmark showing big 3.0 improvements I&apos;d be happy to commit it as well.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310361">
                    <name>Blocked</name>
                                            <outwardlinks description="Blocked">
                                        <issuelink>
            <issuekey id="13104727">CASSANDRA-13900</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                                                <inwardlinks description="is duplicated by">
                                        <issuelink>
            <issuekey id="13268572">CASSANDRA-15430</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="13268572">CASSANDRA-15430</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="13014648" name="16201_jfr_3023_alloc.png" size="2573637" author="mck" created="Tue, 3 Nov 2020 15:15:20 +0000"/>
                            <attachment id="13014649" name="16201_jfr_3023_obj.png" size="717028" author="mck" created="Tue, 3 Nov 2020 15:19:15 +0000"/>
                            <attachment id="13014645" name="16201_jfr_3118_alloc.png" size="2610518" author="mck" created="Tue, 3 Nov 2020 14:52:46 +0000"/>
                            <attachment id="13014646" name="16201_jfr_3118_obj.png" size="747261" author="mck" created="Tue, 3 Nov 2020 14:54:23 +0000"/>
                            <attachment id="13014643" name="16201_jfr_40b3_alloc.png" size="2647581" author="mck" created="Tue, 3 Nov 2020 14:47:27 +0000"/>
                            <attachment id="13014644" name="16201_jfr_40b3_obj.png" size="730436" author="mck" created="Tue, 3 Nov 2020 14:48:04 +0000"/>
                            <attachment id="13013242" name="screenshot-1.png" size="170863" author="tsteinmaurer" created="Thu, 8 Oct 2020 13:45:46 +0000"/>
                            <attachment id="13013246" name="screenshot-2.png" size="311102" author="tsteinmaurer" created="Thu, 8 Oct 2020 14:13:22 +0000"/>
                            <attachment id="13013933" name="screenshot-3.png" size="308500" author="tsteinmaurer" created="Wed, 21 Oct 2020 13:50:01 +0000"/>
                            <attachment id="13014685" name="screenshot-4.png" size="156715" author="tsteinmaurer" created="Wed, 4 Nov 2020 09:48:28 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>10.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[marcuse]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12313825" key="com.atlassian.jira.plugin.system.customfieldtypes:cascadingselect">
                        <customfieldname>Bug Category</customfieldname>
                        <customfieldvalues>
                                                    <customfieldvalue key="12984" cascade-level=""><![CDATA[Degradation]]></customfieldvalue>
                                <customfieldvalue key="12995" cascade-level="1"><![CDATA[Resource Management]]></customfieldvalue>
            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12313821" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Complexity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12965"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313822" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Discovered By</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12969"><![CDATA[User Report]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12313922" key="jira.plugin.projectspecificselectfield.jpssf:multicftype">
                        <customfieldname>Impacts</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="13100"><![CDATA[None]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            4 years, 42 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12313921" key="jira.plugin.projectspecificselectfield.jpssf:multicftype">
                        <customfieldname>Platform</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="13076"><![CDATA[All]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0jj2w:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[blerer]]></customfieldvalue>
        <customfieldvalue><![CDATA[mck]]></customfieldvalue>
        <customfieldvalue><![CDATA[yifanc]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12962"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12311420" key="com.atlassian.jira.plugin.system.customfieldtypes:version">
                        <customfieldname>Since Version</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="12332361">3.0 alpha 1</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313924" key="com.atlassian.jira.plugin.system.customfieldtypes:textfield">
                        <customfieldname>Source Control Link</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>&lt;p&gt;&lt;a href=&quot;https://github.com/apache/cassandra/commit/8333d0b0890f6299fac1fd219f58aee0c62cbf9c&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/cassandra/commit/8333d0b0890f6299fac1fd219f58aee0c62cbf9c&lt;/a&gt;&lt;/p&gt;</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313823" key="com.atlassian.jira.plugin.system.customfieldtypes:textarea">
                        <customfieldname>Test and Documentation Plan</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>&lt;p&gt;cci runs&lt;/p&gt;</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>